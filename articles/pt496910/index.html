<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëáüèø üç® üöî Crie e personalize sua CDN üòÜ üë®üèª‚Äçüîß üßíüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As redes de entrega de conte√∫do (CDNs) s√£o usadas em sites e aplicativos principalmente para acelerar o carregamento de elementos est√°ticos. Isso acon...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Crie e personalize sua CDN</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/496910/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As redes de entrega de conte√∫do (CDNs) s√£o usadas em sites e aplicativos principalmente para acelerar o carregamento de elementos est√°ticos. Isso acontece devido ao armazenamento em cache de arquivos em servidores CDN localizados em diferentes regi√µes geogr√°ficas. Ap√≥s solicitar os dados via CDN, o usu√°rio os recebe do servidor mais pr√≥ximo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O princ√≠pio de opera√ß√£o e funcionalidade de todas as redes de entrega de conte√∫do √© aproximadamente o mesmo. Depois de receber uma solicita√ß√£o para baixar um arquivo, o servidor CDN o pega no servidor original e o entrega ao usu√°rio, ao mesmo tempo em cache por um determinado per√≠odo de tempo. Todas as solicita√ß√µes subsequentes s√£o respondidas do cache. Todas as CDNs t√™m op√ß√µes para pr√©-carregar arquivos, limpar o cache, definir seu per√≠odo de reten√ß√£o e muito mais.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ocorre que, por um motivo ou outro, voc√™ precisa organizar sua pr√≥pria rede de entrega de conte√∫do e, em seguida, deixe-nos ajud√°-lo a construir outra bicicleta. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qf/rw/ss/qfrwss0k86-bdbbbpztdh3d0nkq.jpeg"><br>
<font color="#B1B1B1"><sup><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fonte: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Infogr√°fico vetor criado por pikisuperstar - www.freepik.com</font></font></a></i></sup></font><a name="habracut"></a><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quando voc√™ precisa do seu pr√≥prio CDN</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considere os casos em que iniciar seu pr√≥prio CDN faz sentido:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quando voc√™ deseja economizar, e os custos de opera√ß√£o, mesmo ao usar CDNs baratas como o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BunnyCDN,</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> s√£o v√°rias centenas de d√≥lares por m√™s</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se queremos obter um cache permanente ou um cache sem vizinhos no servidor e no canal</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na regi√£o que voc√™ precisa, os servi√ßos CDN n√£o t√™m pontos de presen√ßa</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quaisquer configura√ß√µes especiais de entrega de conte√∫do necess√°rias</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">queremos acelerar a entrega de conte√∫do din√¢mico, aproximando-nos dos usu√°rios do servidor de produ√ß√£o</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">existe a preocupa√ß√£o de que um servi√ßo CDN de terceiros possa coletar ou usar ilegalmente informa√ß√µes sobre o comportamento do usu√°rio (para servi√ßos sem conformidade com o GDPR) ou se envolver em outras a√ß√µes ilegais</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na maioria dos outros casos, √© melhor usar as solu√ß√µes prontas existentes.</font></font><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que voc√™ precisa para executar</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â maravilhoso se voc√™ tiver seu pr√≥prio sistema aut√¥nomo (AS). </font><font style="vertical-align: inherit;">Com ele, voc√™ pode atribuir o mesmo IP a v√°rios servidores e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seguir estas instru√ß√µes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no n√≠vel da rede para direcionar os usu√°rios para o </font><font style="vertical-align: inherit;">servidor </font><font style="vertical-align: inherit;">mais pr√≥ximo. </font><font style="vertical-align: inherit;">Vale dizer que, mesmo com o bloco de endere√ßos / 24, √© poss√≠vel construir uma rede de entrega de conte√∫do. </font><font style="vertical-align: inherit;">Alguns provedores de servidores permitem que voc√™ fa√ßa um an√∫ncio para uso em todas as regi√µes dispon√≠veis para eles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ n√£o √© um propriet√°rio feliz de um bloco de endere√ßos IP, para executar uma CDN simples, ser√° necess√°rio:</font></font><br>
<br>
<ul>
<li>   </li>
<li>     .     ,   </li>
<li>geoDNS .    ,   ,     </li>
</ul><br>
<br>
<h2>    </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com o registro de dom√≠nio, tudo √© simples - registre-se em qualquer zona com qualquer registrador. Voc√™ tamb√©m pode usar um subdom√≠nio para uma CDN, como algo como </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cdn.namedomain.com</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Na verdade, em nosso exemplo, faremos isso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quanto ao pedido de servidores, eles devem ser alugados nas regi√µes e nos pa√≠ses em que seu p√∫blico-alvo est√° localizado. Se o projeto for intercontinental, √© conveniente escolher provedores de hospedagem que ofere√ßam servidores em todo o mundo imediatamente. Exemplos: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OVH</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leaseweb</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100Tb</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para servidores dedicados, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vultr</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DigitalOcean</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para nuvem virtual *. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para nossa CDN privada, solicitamos 3 servidores virtuais em diferentes continentes. At </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vultr</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no servidor por </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">US $ 5 / m√™s,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> temos </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">25 GB de</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> espa√ßo </font><b><font style="vertical-align: inherit;">SSD</font></b><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 TB de tr√°fego</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ao instalar, selecione o √∫ltimo Debian. </font><font style="vertical-align: inherit;">Nossos servidores: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jy/di/f1/jydif1phgm45zpwjbety-fw_d-g.png" width="30"> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Frankfurt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ip: 199.247.18.199 </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uk/wh/v1/ukwhv1lwwsr8snoiqc_yyzquo5s.png" width="30"> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chicago</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ip: 149.28.121.123 </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3f/qk/6e/3fqk6endcgzeybs-yjlkkphep50.png" width="30"> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cingapura</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ip: 157.230.240.216 </font></font><br>
<br>
<font color="#B1B1B1"><sup><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* A Vultr e a DigitalOcean prometem um empr√©stimo de US $ 100 aos usu√°rios registrados usando os links do artigo imediatamente ap√≥s adicionar um m√©todo de pagamento. </font><font style="vertical-align: inherit;">O autor tamb√©m recebe um pequeno elogio disso, o que √© muito significativo para ele agora. </font><font style="vertical-align: inherit;">Por favor, seja compreensivo.</font></font></i></sup></font><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configurar geoDNS</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para que quando um usu√°rio acessa um dom√≠nio ou subdom√≠nio CDN, ele √© direcionado para o servidor desejado (mais pr√≥ximo a ele), precisamos de um servidor DNS com a fun√ß√£o geoDNS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O princ√≠pio e o procedimento do geoDNS s√£o os seguintes:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Define o IP do cliente que enviou a solicita√ß√£o DNS ou o IP do servidor DNS recursivo usado para processar a solicita√ß√£o do cliente. </font><font style="vertical-align: inherit;">Esses servidores recursivos geralmente s√£o provedores de DNS.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por IP, o cliente conhece seu pa√≠s ou regi√£o. </font><font style="vertical-align: inherit;">Para isso, s√£o utilizadas as bases GeoIP, das quais existem muitas hoje. </font><font style="vertical-align: inherit;">Existem algumas boas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">op√ß√µes gratuitas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dependendo da localiza√ß√£o do cliente, ele fornece o endere√ßo IP do servidor CDN mais pr√≥ximo.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">criar um</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> servidor DNS com a fun√ß√£o geoDNS </font><font style="vertical-align: inherit;">, mas √© melhor usar solu√ß√µes prontas com uma rede de servidores DNS ao redor do mundo e o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anycast</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pronto para uso </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">louDNS</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> US $ 9,95 / m√™s</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tarifa GeoDNS, por padr√£o, h√° um failover de DNS</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zilore</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> US $ 25 / m√™s</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , failover de DNS ativado</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amazon Route 53</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> US $ 35 / m√™s</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para solicita√ß√µes geogr√°ficas l√≠quidas de 50 milh√µes. </font><font style="vertical-align: inherit;">O failover de DNS √© cobrado separadamente</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNS facilitado a</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> partir de</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> US $ 125 / m√™s</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , h√° 10 failover de DNS</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cloudflare</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , recurso de dire√ß√£o geogr√°fica dispon√≠vel em tarifas corporativas</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao fazer o pedido do geoDNS, voc√™ deve prestar aten√ß√£o ao n√∫mero de solicita√ß√µes inclu√≠das na tarifa e levar em considera√ß√£o que o n√∫mero real de chamadas para o dom√≠nio pode exceder as expectativas v√°rias vezes. Milh√µes de aranhas, scanners, spammers e outros esp√≠ritos malignos trabalham incansavelmente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quase todos os servi√ßos DNS incluem um indispens√°vel para a cria√ß√£o de um servi√ßo CDN - Failover DNS. Com ele, voc√™ pode configurar o monitoramento de seus servidores e, na aus√™ncia de sinais de vida, substituir automaticamente o endere√ßo do servidor que n√£o est√° funcionando por um servidor de backup nas respostas DNS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para construir nossa CDN, usaremos o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ClouDNS</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , a tarifa do GeoDNS.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adicione uma nova zona DNS √† sua conta, indicando seu dom√≠nio. </font><font style="vertical-align: inherit;">Se criarmos a CDN em um subdom√≠nio e o dom√≠nio principal j√° estiver em uso, imediatamente ap√≥s adicionar a zona, n√£o esque√ßa de adicionar os registros DNS em funcionamento existentes. </font><font style="vertical-align: inherit;">O pr√≥ximo passo √© criar para o dom√≠nio / subdom√≠nio CDN v√°rios registros A, cada um dos quais ser√° aplicado √† regi√£o que definimos. </font><font style="vertical-align: inherit;">Voc√™ pode especificar continentes ou pa√≠ses como regi√µes; as sub-regi√µes est√£o dispon√≠veis para os EUA e o Canad√°. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No nosso caso, o CDN ser√° levantado na </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cdn.sayt.in</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> subdom√≠nio </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Adicionando a zona </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sayt.in</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , crie o primeiro registro A para o subdom√≠nio e direcione toda a Am√©rica do Norte para o servidor em Chicago:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/0x/z_/zt/0xz_ztazcrmz8wqlruylrz4iqh4.png" width="500"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Repita o procedimento para outras regi√µes, lembrando-se de criar uma entrada para as regi√µes padr√£o. </font><font style="vertical-align: inherit;">Aqui est√° o resultado:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/io/js/zy/iojszykgez_pu7wf3mzd8lvmffa.jpeg" width="600"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O √∫ltimo registro padr√£o na captura de tela significa que todas as regi√µes indeterminadas (como Europa, √Åfrica, usu√°rios de Internet via sat√©lite etc.) ser√£o enviadas para um servidor em Frankfurt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso completa a configura√ß√£o b√°sica do DNS. </font><font style="vertical-align: inherit;">Resta acessar o site do registrador de dom√≠nios e substituir os NSs de dom√≠nio atuais pelos emitidos pelo ClouDNS. </font><font style="vertical-align: inherit;">E enquanto os NSs ser√£o atualizados, prepararemos o servidor.</font></font><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instalar certificados SSL</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nossa CDN funcionar√° em HTTPS; portanto, se voc√™ j√° possui certificados SSL para um dom√≠nio ou subdom√≠nio, fa√ßa o upload para todos os servidores, por exemplo, no diret√≥rio </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ etc / ssl / yourdomain /</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Se n√£o houver certificados, voc√™ pode obter um gr√°tis em Let's Encrypt. O </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">script ACME Shell √©</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> perfeito para isso </font><font style="vertical-align: inherit;">. O cliente √© conveniente, f√°cil de configurar e, o mais importante - permite validar o dom√≠nio / subdom√≠nio do DNS por meio da API do ClouDNS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instalaremos o acme.sh somente em um dos servidores - europeu 199.247.18.199, a partir do qual os certificados ser√£o copiados para todos os outros. Para instalar, fa√ßa:</font></font><br>
<br>
<pre><code class="plaintext hljs">root@cdn:~# wget -O - https://get.acme.sh | bash; source ~/.bashrc</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante a instala√ß√£o do script, uma tarefa CRON ser√° criada para renova√ß√£o adicional de certificados sem a nossa participa√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A verifica√ß√£o do dom√≠nio ao emitir um certificado ser√° realizada usando DNS usando a API. Portanto, na conta pessoal ClouDNS no menu API do revendedor, voc√™ precisa criar uma nova API de usu√°rio e definir uma senha para ela. </font><font style="vertical-align: inherit;">O auth-id resultante com a senha ser√° gravada no arquivo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">~ / .acme.sh / DnsApi / dns_cloudns.sh</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (para n√£o ser confundido com o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dns_clou </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> arquivo dns.sh</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Aqui est√£o as linhas para remover o coment√°rio e editar:</font></font><br>
<br>
<pre><code class="plaintext hljs">CLOUDNS_AUTH_ID=&lt;auth-id&gt;<font></font>
CLOUDNS_AUTH_PASSWORD="&lt;&gt;"<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora </font><b><font style="vertical-align: inherit;">pedimos</font></b><font style="vertical-align: inherit;"> um certificado SSL para </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cdn.sayt.in</font></font></b><br>
<br>
<pre><code class="plaintext hljs">root@cdn:~# acme.sh --issue --dns dns_cloudns -d cdn.sayt.in --reloadcmd "service nginx reload"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nos par√¢metros para o futuro, especificamos um comando para recarregar automaticamente a configura√ß√£o do servidor da web ap√≥s cada renova√ß√£o do per√≠odo de validade do certificado no futuro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo o processo de obten√ß√£o de um certificado pode levar at√© 2 minutos, n√£o o interrompa. </font><font style="vertical-align: inherit;">Se ocorrer um erro de valida√ß√£o de dom√≠nio, tente executar o comando novamente. </font><font style="vertical-align: inherit;">No final, veremos onde os certificados foram carregados: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/l6/qv/16/l6qv16mchqhhaokxuvbwmnnw6xu.png" width="952"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lembre </font><font style="vertical-align: inherit;">- </font><font style="vertical-align: inherit;">se desses caminhos, eles precisar√£o ser especificados ao copiar o certificado para outros servidores, bem como nas configura√ß√µes do servidor web. </font><font style="vertical-align: inherit;">N√£o prestamos aten√ß√£o ao erro ao recarregar os arquivos de configura√ß√£o do Nginx - em um servidor totalmente configurado, ele n√£o estar√° presente ao renovar certificados.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo o que resta para n√≥s atrav√©s do SSL √© copiar o certificado recebido para dois outros servidores, salvando o caminho para os arquivos. </font><font style="vertical-align: inherit;">Crie os mesmos diret√≥rios em cada um deles e fa√ßa uma c√≥pia:</font></font><br>
<br>
<pre><code class="plaintext hljs">root@cdn:~# mkdir -p /root/.acme.sh/cdn.sayt.in/<font></font>
root@cdn:~# scp -r root@199.247.18.199:/root/.acme.sh/cdn.sayt.in/* /root/.acme.sh/cdn.sayt.in/<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para que a renova√ß√£o do certificado seja regular, criaremos uma tarefa CRON di√°ria nos dois servidores com o comando:</font></font><br>
<blockquote><code>scp -r root@199.247.18.199:/root/.acme.sh/cdn.sayt.in/* /root/.acme.sh/cdn.sayt.in/ &amp;&amp; service nginx reload</code></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse caso, o acesso ao servidor de origem remoto deve ser configurado </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">por chave</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ou seja, </font><font style="vertical-align: inherit;">sem digitar uma senha. </font><font style="vertical-align: inherit;">N√£o se esque√ßa de faz√™-lo.</font></font><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instale e configure o Nginx</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para retornar conte√∫do est√°tico, usaremos o Nginx, configurado como um servidor proxy de cache. </font><font style="vertical-align: inherit;">Atualize a lista de pacotes e instale-a nos tr√™s servidores:</font></font><br>
<br>
<pre><code class="plaintext hljs">root@cdn:~# apt update<font></font>
root@cdn:~# apt install nginx</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em vez do padr√£o, use a configura√ß√£o do spoiler abaixo:</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nginx.conf</font></font></b><div class="spoiler_text"><pre><code class="nginx hljs"><span class="hljs-attribute">user</span> www-data;
<span class="hljs-attribute">worker_processes</span> auto;
<span class="hljs-attribute">pid</span> /run/nginx.pid;<font></font>
<font></font>
<span class="hljs-section">events</span> {
    <span class="hljs-attribute">worker_connections</span> <span class="hljs-number">4096</span>;
    <span class="hljs-attribute">multi_accept</span> <span class="hljs-literal">on</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-section">http</span> {
    <span class="hljs-attribute">sendfile</span> <span class="hljs-literal">on</span>;
    <span class="hljs-attribute">tcp_nopush</span> <span class="hljs-literal">on</span>;
    <span class="hljs-attribute">tcp_nodelay</span> <span class="hljs-literal">on</span>;
    <span class="hljs-attribute">types_hash_max_size</span> <span class="hljs-number">2048</span>;<font></font>
<font></font>
    <span class="hljs-attribute">include</span> /etc/nginx/mime.types;
    <span class="hljs-attribute">default_type</span> application/octet-stream;<font></font>
<font></font>
    <span class="hljs-attribute">access_log</span> <span class="hljs-literal">off</span>;
    <span class="hljs-attribute">error_log</span> /var/log/nginx/error.log;<font></font>
<font></font>
    <span class="hljs-attribute">gzip</span> <span class="hljs-literal">on</span>;
    <span class="hljs-attribute">gzip_disable</span> <span class="hljs-string">"msie6"</span>;
    <span class="hljs-attribute">gzip_comp_level</span> <span class="hljs-number">6</span>;
    <span class="hljs-attribute">gzip_proxied</span> any;
    <span class="hljs-attribute">gzip_vary</span> <span class="hljs-literal">on</span>;
    <span class="hljs-attribute">gzip_types</span> text/plain application/javascript text/javascript text/css application/json application/xml text/xml application/rss+xml;
    <span class="hljs-attribute">gunzip</span> <span class="hljs-literal">on</span>;            <font></font>
<font></font>
    <span class="hljs-attribute">proxy_temp_path</span>    /var/cache/tmp;
    <span class="hljs-attribute">proxy_cache_path</span>   /var/cache/cdn levels=<span class="hljs-number">1</span>:<span class="hljs-number">2</span> keys_zone=cdn:<span class="hljs-number">64m</span> max_size=<span class="hljs-number">20g</span> inactive=<span class="hljs-number">7d</span>;
    <span class="hljs-attribute">proxy_cache_bypass</span> <span class="hljs-variable">$http_x_update</span>;<font></font>
<font></font>
<span class="hljs-section">server</span> {
  <span class="hljs-attribute">listen</span> <span class="hljs-number">443</span> ssl;
  <span class="hljs-attribute">server_name</span> cdn.sayt.in;<font></font>
<font></font>
  <span class="hljs-attribute">ssl_certificate</span> /root/.acme.sh/cdn.sayt.in/cdn.sayt.in.cer;
  <span class="hljs-attribute">ssl_certificate_key</span> /root/.acme.sh/cdn.sayt.in/cdn.sayt.in.key;<font></font>
<font></font>
  <span class="hljs-attribute">location</span> / {
    <span class="hljs-attribute">proxy_cache</span> cdn;
    <span class="hljs-attribute">proxy_cache_key</span> <span class="hljs-variable">$uri</span><span class="hljs-variable">$is_args</span><span class="hljs-variable">$args</span>;
    <span class="hljs-attribute">proxy_cache_valid</span> <span class="hljs-number">90d</span>;
    <span class="hljs-attribute">proxy_pass</span> https://sayt.in;<font></font>
    }<font></font>
  }<font></font>
}</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na configura√ß√£o, edite:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">max_size</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - tamanho do cache que n√£o excede o espa√ßo em disco dispon√≠vel</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inativo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - tempo de armazenamento para dados em cache que ningu√©m acessou</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssl_certificate</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssl_certificate_key</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - caminhos para o certificado SSL e os arquivos de chave</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proxy_cache_valid</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - tempo de armazenamento para dados em cache</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proxy_pass</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - o endere√ßo do servidor original do qual a CDN solicitar√° arquivos para armazenamento em cache. </font><font style="vertical-align: inherit;">No nosso exemplo, isso √© </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sayt.in</font></font></i></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como voc√™ pode ver, tudo √© simples. </font><font style="vertical-align: inherit;">A complexidade s√≥ pode surgir na configura√ß√£o do tempo de cache devido √† semelhan√ßa das </font><i><font style="vertical-align: inherit;">diretivas </font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inativas</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proxy_cache_valid</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vamos analis√°-los em nosso exemplo. </font><font style="vertical-align: inherit;">Aqui est√° o que acontece com </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inactive = 7d</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proxy_cache_valid 90d</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se a solicita√ß√£o n√£o for repetida dentro de sete dias, os dados ser√£o exclu√≠dos do cache ap√≥s esse per√≠odo</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se a solicita√ß√£o for repetida pelo menos uma vez a cada 7 dias, os dados no cache ser√£o considerados desatualizados ap√≥s 90 dias e, na pr√≥xima solicita√ß√£o, o Nginx os atualizar√° retirando-os do servidor original</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s terminar de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">editar o nginx.conf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , recarregue a configura√ß√£o:</font></font><br>
<br>
<pre><code class="plaintext hljs">root@cdn:~# service nginx reload</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nossa CDN est√° completamente pronta. </font><font style="vertical-align: inherit;">Por US $ 15 / m√™s </font><font style="vertical-align: inherit;">temos pontos de presen√ßa em tr√™s continentes e 3 TB de tr√°fego: 1 TB em cada local.</font></font><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verificando o funcionamento da CDN</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vejamos os pings para nossa CDN de diferentes localiza√ß√µes geogr√°ficas. </font><font style="vertical-align: inherit;">Para isso, qualquer servi√ßo de ping √© adequado.</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ponto de lan√ßamento</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hospedeiro</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IP</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tempo m√©dio, ms</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alemanha Berlim</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cdn.sayt.in</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">199.247.18.199</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9,6</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Holanda, Amsterd√£</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cdn.sayt.in</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">199.247.18.199</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.1</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fran√ßa Paris</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cdn.sayt.in</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">199.247.18.199</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16,3</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gr√£-Bretanha, Londres</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cdn.sayt.in</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">199.247.18.199</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14,9</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Canad√° Toronto</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cdn.sayt.in</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">149.28.121.123</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16,2</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EUA, S√£o Francisco</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cdn.sayt.in</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">149.28.121.123</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">52,7</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EUA, Dallas</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cdn.sayt.in</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">149.28.121.123</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">23,1</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EUA, Chicago</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cdn.sayt.in</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">149.28.121.123</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.6</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EUA, Nova Iorque</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cdn.sayt.in</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">149.28.121.123</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19,8</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cingapura</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cdn.sayt.in</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">157.230.240.216</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.7</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jap√£o T√≥quio</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cdn.sayt.in</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">157.230.240.216</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">74,8</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Austr√°lia, Sydney</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cdn.sayt.in</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">157.230.240.216</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">95,9</font></font></td>
</tr>
</tbody></table></div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os resultados s√£o bons. </font><font style="vertical-align: inherit;">Agora, colocaremos a imagem de teste </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">test.jpg</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na raiz do site principal </font><font style="vertical-align: inherit;">e verificaremos a velocidade do seu download via CDN. </font><font style="vertical-align: inherit;">Mal disse o que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fez</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">O conte√∫do √© entregue rapidamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Escreveremos um pequeno script caso desejemos limpar o cache no ponto CDN.</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">purge.sh</font></font></b><div class="spoiler_text"><pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ]
<span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Purging all cache"</span><font></font>
    rm -rf /var/cache/cdn/*<font></font>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Purging <span class="hljs-variable">$1</span>"</span>
    FILE=`<span class="hljs-built_in">echo</span> -n <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> | md5sum | awk <span class="hljs-string">'{print $1}'</span>`<font></font>
    FULLPATH=/var/cache/cdn/<span class="hljs-variable">${FILE:31:1}</span>/<span class="hljs-variable">${FILE:29:2}</span>/<span class="hljs-variable">${FILE}</span>
    rm -f <span class="hljs-string">"<span class="hljs-variable">${FULLPATH}</span>"</span>
<span class="hljs-keyword">fi</span>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para excluir todo o cache, basta execut√°-lo, um arquivo separado pode ser limpo assim:</font></font><br>
<br>
<pre><code class="plaintext hljs">root@cdn:~# ./purge.sh /test.jpg</code></pre><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em vez de conclus√µes</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finalmente, quero dar algumas dicas √∫teis para passar imediatamente pelo rake, o que ao mesmo tempo deixou minha cabe√ßa dolorida:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para aumentar a toler√¢ncia a falhas da CDN, √© recomend√°vel configurar o Failover de DNS, o que ajuda a alterar rapidamente um registro A em caso de falha do servidor. </font><font style="vertical-align: inherit;">Isso √© feito no painel de controle dos registros DNS do dom√≠nio</font></font></li>
<li>           CDN,    .            CDN,      6-7 : ,   (),   (), , ,   </li>
<li>         CDN. ,          ,       -</li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">  </a>,  ,           </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tente verificar </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pings de diferentes lugares</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nos seus servidores. </font><font style="vertical-align: inherit;">Assim, voc√™ pode ver as regi√µes mais pr√≥ximas aos pontos CDN e configurar o GeoDNS corretamente</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dependendo das tarefas, n√£o √© impr√≥prio configurar o Nginx para requisitos espec√≠ficos de armazenamento em cache e levando em considera√ß√£o a carga no servidor. </font><font style="vertical-align: inherit;">Os artigos sobre o cache do Nginx - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e a acelera√ß√£o do trabalho sob cargas pesadas: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">aqui</font></a><font style="vertical-align: inherit;"> me ajudaram bastante.</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"></font></a></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt496886/index.html">Elon Musk revelou o objetivo da c√¢mera sobre o espelho retrovisor no Tesla Model 3</a></li>
<li><a href="../pt496888/index.html">Inicializa√ß√£o usa IA para procurar mol√©culas que ajudar√£o a combater o coronav√≠rus</a></li>
<li><a href="../pt496892/index.html">Todo o Habr em uma base. Coment√°rios e aplicativo da web</a></li>
<li><a href="../pt496894/index.html">Backlog perfeito do produto</a></li>
<li><a href="../pt496900/index.html">Importe USRLE por meio do Apache NiFi. Etapa 1 - Baixar arquivos via HTTPS</a></li>
<li><a href="../pt496912/index.html">ThinkPad E480 Intel no Windows VS ThinkPad E495 AMD no Ubuntu existe alguma diferen√ßa?</a></li>
<li><a href="../pt496914/index.html">O menor programa decimal</a></li>
<li><a href="../pt496916/index.html">Ensinando, negociando e consultando remotamente - Parte 3: Yealink Meeting Server e 4 ofertas especiais</a></li>
<li><a href="../pt496920/index.html">Construindo uma casa inteligente com o ASP.NET Core e o Arduino</a></li>
<li><a href="../pt496922/index.html">Guia sobre cliente-servidor reverso apk no exemplo do trabalho NeoQUEST-2020</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>