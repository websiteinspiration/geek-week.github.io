<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📓 🧔🏻 👩🏽‍⚖️ Controle de motor sem fio da Lego usando o Steam Controller ☝🏾 🌵 😰</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quando eu era jovem, eu sempre quis ter kits Lego Technics para coletar todo tipo de coisas legais deles. Tanques autônomos com torres rotativas dispa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Controle de motor sem fio da Lego usando o Steam Controller</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/500668/"><img src="https://habrastorage.org/webt/to/-q/fh/to-qfh-f6as72siykacsf0u_8du.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando eu era jovem, eu sempre quis ter kits Lego Technics para coletar todo tipo de coisas legais deles. Tanques autônomos com torres rotativas disparando tijolos de Lego. Mas então eu não tinha esse conjunto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E mesmo os tijolos habituais da Lego não eram. Eu tinha apenas um amigo cujo irmão tinha todos esses brinquedos caros. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E agora eu tenho um filho da sua idade. E ele constrói tanques que ... estupidamente se mantêm à frente até atingirem a parede :) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E agora chegou a hora do ESP32 e a magia do ferro de soldar - montaremos o controle remoto certo para eles!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Não, é claro, eu sei sobre a existência de tais controles remotos. </font><font style="vertical-align: inherit;">Mas nenhum deles combina comigo completamente. </font><font style="vertical-align: inherit;">Eles são infravermelhos, com tecnologia dos anos 80, ou muito grandes. </font><font style="vertical-align: inherit;">Ou caro. </font><font style="vertical-align: inherit;">E o mais importante: não posso dizer ao meu filho sobre nenhum deles: "Eu fiz isso especialmente para você!" </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Então, vamos criar um controle remoto novo e aprimorado para governar todos!</font></font><br>
<a name="habracut"></a><br>
<img src="https://habrastorage.org/getpro/habr/post_images/ffa/c72/7fd/ffac727fd7f9547d36657745fe7ea3a1.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ingredientes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP32-WROOM-32D | </font><font style="vertical-align: inherit;">WiFi, BLE e um processador com E / S - suficiente para controlar dois </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">motores</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LED</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DRV8833 | </font><font style="vertical-align: inherit;">ponte H dupla com potência suficiente para motores.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TPS62162 </font><font style="vertical-align: inherit;">redução da tensão para 17 V, bem como para entretenimento ao soldar o gabinete WSON-8 2 × 2 mm</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CP2104 </font><font style="vertical-align: inherit;">para programação ESP32</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"></a>     .      ,   Lego  .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo isso estará localizado em uma placa pequena - aqui está sua aparência no editor EasyEDA: O </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/3c8/4af/b81/3c84afb81433206ebf31adbfde2b8700.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fio que é visível na foto do cabeçalho não é necessário para corrigir erros, mas para fornecer energia a partir de USB. Pode não ser suficiente para o motor, mas, infelizmente, os contatos da China ainda não chegaram até mim. Portanto, verifico primeiro a operação dos LEDs. Para a beleza da foto, eu apenas coloquei o conector do motor na placa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na versão 1.1 da minha placa (diferente da versão 1.2, que já está no EasyEDA), não havia LEDs, então soldei dois diodos anti-paralelos na saída para que o que estava acontecendo fosse visível. Se você observar atentamente, o vídeo mostra a inclusão alternativa de um par de diodos 0603, indicando movimento para frente / trás.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/UX0iBoP1utU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quanto ao painel de controle, no começo eu só queria coletar uma placa adicional com botões e outro ESP32 - um controle remoto clássico. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, lembrei-me de que os controladores de vapor têm um modo de baixa energia Bluetooth (BLE). Decidi abordar esse problema e, depois de algumas horas, aprendi a receber pacotes do controlador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para fazer isso, basta procurar o dispositivo HID que se chama SteamController e conectar-se a ele. E use o serviço não documentado da Valve e alguns </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comandos não documentados</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que permitem transferências de pacotes. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/2f7/fb5/877/2f7fb5877ff2dae71c57c405b3e4c5d4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E também me deparei com um formato de relatório não documentado, que analisei manualmente.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/22c/8ab/3db/22c8ab3db50e5ac2a0fb6c0c48a2701e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Após cerca de uma hora, o significado dos sinalizadores e valores ficou claro para mim e consegui piscar o LED usando o controlador Steam e o ESP32. </font><font style="vertical-align: inherit;">¯ \ _ (ツ) _ / ¯</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arquivos</font></font></h2><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Placa de circuito EasyEDA e placa </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">easyeda.com/EFS-GH/legoremote</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fontes para Arduino: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/g3gg0/LegoRemote</font></font></a></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v1.0:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> “tentativa de abordagem” </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - a primeira opção para a qual escolhi o regulador de tensão errado. O TPS62291 aumenta a tensão apenas para 6 V. Desenvolvi vários projetos em paralelo e esqueci que o dispositivo precisa funcionar com 9 V. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v1.1:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> “bom o suficiente” </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - essa opção é visível nos comerciais e tudo funciona </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v1.2:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> “final” </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Adicionado LEDs indicadores na saída e otimizado o tamanho e o layout da placa.O </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
próximo vídeo curto mostra a fase de conexão (1-3 segundos após ligar a alimentação) e o controle das saídas do motor. O conector Lego ainda não está conectado. Irá para um espaço vazio ao lado dos outros conectores, marcado com um retângulo branco.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/-2-QGO-eoNQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meu filho agora usa regularmente esse controlador para controlar os dispositivos que ele montou. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante o teste de estresse, encontrei apenas um problema: achei que o modo de “decaimento rápido” do motorista funcionaria melhor, mas, por causa disso, após alguns segundos de operação, a velocidade do motor diminuiria muito. </font><font style="vertical-align: inherit;">Então mudei o código para que ele usasse "decaimento lento". </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/c1e/e09/921/c1ee09921222a6c99fa4dce4395ca4a7.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Até agora, não tenho certeza de como o DRV funciona e por que o motor gira primeiro rapidamente e, depois de 10 segundos, começa a desacelerar gradualmente. </font><font style="vertical-align: inherit;">Talvez os MOSFETs estejam esquentando e sua resistência aumente demais.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/aIFafodKasQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Espero que este exemplo de uso do Arduino inspire facilmente outras pessoas e permita que elas apresentem seus filhos à eletrônica.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt500648/index.html">O que é um modelo arquitetural de maturidade da empresa?</a></li>
<li><a href="../pt500654/index.html">WebRTC no Android: como habilitar a codificação de hardware em vários dispositivos</a></li>
<li><a href="../pt500656/index.html">Log hierárquico do aplicativo no banco de dados</a></li>
<li><a href="../pt500660/index.html">Uma história simplificada e muito curta do desenvolvimento de "nuvens"</a></li>
<li><a href="../pt500666/index.html">Certificação online da Microsoft - você, seu espaço e seu computador</a></li>
<li><a href="../pt500670/index.html">Como criamos nosso produto. Parte Um, Pesquisa</a></li>
<li><a href="../pt500672/index.html">Continuação do fluxo para testadores e não apenas</a></li>
<li><a href="../pt500676/index.html">Anúncio de um workshop on-line sobre automação de testes</a></li>
<li><a href="../pt500678/index.html">ClickHouse para usuários avançados em perguntas e respostas</a></li>
<li><a href="../pt500688/index.html">Trabalhando com um banco de dados no Flask: de junho a junho</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>