<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â›¹ğŸ½ ğŸ¤œğŸ¿ â›“ï¸ Hack Age of Empires III pour modifier les paramÃ¨tres de qualitÃ© du shader ğŸ‘¨ğŸ»â€ğŸ“ ğŸ‘¨ğŸ¾â€ğŸ« ğŸ“§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="DÃ©but mai 2020 - si vous Ãªtes comme moi, alors la quarantaine vous a fait refaire des jeux qui n'avaient pas Ã©tÃ© lancÃ©s depuis de nombreuses annÃ©es. 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Hack Age of Empires III pour modifier les paramÃ¨tres de qualitÃ© du shader</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/500542/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DÃ©but mai 2020 - si vous Ãªtes comme moi, alors la quarantaine vous a fait refaire des jeux qui n'avaient pas Ã©tÃ© lancÃ©s depuis de nombreuses annÃ©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et si vous Ãªtes encore plus comme moi, alors vous pourriez avoir un disque d'Age of Empires 3. Peut-Ãªtre que vous jouez sur un Mac, peut-Ãªtre que vous n'avez pas encore mis Ã  niveau vers Catalina et que vous souhaitez commander Morgan Black. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, vous dÃ©marrez le jeu, entrez dans le menu principal et remarquez immÃ©diatement que quelque chose ne va pas ... Le menu a l'air </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dÃ©goÃ»tant</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5be/dfa/a66/5bedfaa660037faa86c176d9586f9d1a.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous vous demandez ce qu'est exactement Â«dÃ©goÃ»tantÂ», alors faites attention Ã  l'eau. </font><font style="vertical-align: inherit;">Tout le reste est terrible aussi, mais c'est moins Ã©vident.</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/578/2d3/34f/5782d334f3be69385a0b69072ef6b7ed.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, vous allez dans les options, augmentez tous les paramÃ¨tres au maximum ... Mais le jeu est toujours moche. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous remarquez que les options Â« </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shader Quality</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Â» </font><font style="vertical-align: inherit;">sont </font><font style="vertical-align: inherit;">Ã©trangement verrouillÃ©es sur Â« </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Low</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Â».</font></font><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tentative n Â° 1 - pirater les paramÃ¨tres</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ã€ ce stade, vous commencez Ã  rechercher le dossier du jeu, qui aurait Ã©tÃ© crÃ©Ã© quelque part dans le dossier Documents, car le jeu Ã©tait en 2005, puis tout le monde l'a fait. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Que cherchons-nous? Bien sÃ»r, le fichier dans lequel les paramÃ¨tres sont stockÃ©s. L'interface de menu ne nous permet pas de modifier les paramÃ¨tres, mais nous sommes dÃ©licats, non? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous trouvons le XML requis, car le jeu est 2005 et c'est, bien sÃ»r, XML, oÃ¹ nous </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tombons</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur l'option " </font><em><font style="vertical-align: inherit;">optiongrfxshaderquality</font></em><font style="vertical-align: inherit;"> ", qui est dÃ©finie sur 0. Il semble que nous le cherchions, alors nous augmentons la valeur Ã  100, car il n'y a pas beaucoup de qualitÃ©. Ici, je suis d'accord avec vous.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/61d/de5/d85/61dde5d85e5442f781fe9c4eaeb46a55.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez Ã©galement remarquer qu'il s'agit d'une utilisation terrible de XML. Heureusement, il n'a pas de bonnes utilisations.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Satisfait de nous-mÃªmes, nous lanÃ§ons le jeu. HÃ©las, rien n'a changÃ©. En regardant Ã  nouveau le fichier XML, nous voyons que le paramÃ¨tre est Ã  nouveau rÃ©glÃ© sur 0. Ensemble Studios (qu'il repose en paix) regarde avec mÃ©pris toute votre ingÃ©niositÃ©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AprÃ¨s cela, nous </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pourrions abandonner</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Il s'agit d'un Mac, par consÃ©quent, les correctifs Ã©crits par les utilisateurs sont peu susceptibles d'Ãªtre trouvÃ©s (en fait, j'ai vÃ©rifiÃ© - il existe toutes sortes de solutions douteuses qui peuvent fonctionner). Tout tourne autour des graphismes. Il semble que le problÃ¨me sera difficile Ã  rÃ©soudre.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais nous n'abandonnerons pas. </font><font style="vertical-align: inherit;">Parce que nous nous souvenons Ã  quoi devrait ressembler l'Ã‚ge 3. Nous nous souvenons de la faÃ§on dont nous admirions cette belle eau ondulÃ©e. </font><font style="vertical-align: inherit;">Ces effets de particules. </font><font style="vertical-align: inherit;">Ces Ã©normes navires qui ne rentrent tout simplement pas dans le cadre. </font><font style="vertical-align: inherit;">Et c'est juste que la camÃ©ra a Ã©tÃ© zoomÃ©e, Ã  quoi pensais-je juste?</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tentative n Â° 1 - piratage de donnÃ©es</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au tout dÃ©but du dossier dans Documents, il y a un fichier journal. Le jeu y a Ã©crit une carte graphique et a signalÃ© qu'il avait sÃ©lectionnÃ© le paramÃ¨tre Â«dx7 gÃ©nÃ©riqueÂ». Il indique que vous avez installÃ© Intel GMA 950, qui Ã©tait vraiment sur l'ordinateur prÃ©cÃ©dent. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais lÃ -dessus, vous avez Intel Iris Graphics 6100. Quelque chose ne va vraiment pas. Vous faites une hypothÃ¨se - le jeu dÃ©termine les capacitÃ©s graphiques de l'ordinateur, en le comparant avec une base de donnÃ©es de cartes graphiques au lieu de vÃ©rifier les capacitÃ©s de la carte elle-mÃªme. Parce que c'est exactement ce que font les dÃ©veloppeurs AAA, et si vous avez travaillÃ© sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTS open-source</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , vous savez comment cela se produit.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b6e/8b3/fb2/b6e8b3fb28030917e8300cdce5653fac.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le contenu du fichier journal. Si vous trouvez drÃ´le qu'Intel soit dÃ©signÃ© comme 0x8086, alors vous avez choisi l'article appropriÃ©.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Par hasard, vous trouvez d'anciennes </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">notes de mise Ã  jour</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qui confirment vos prÃ©occupations. Vous regardez dans le dossier GameData, mais il n'y a que des </font><em><font style="vertical-align: inherit;">fichiers </font></em></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.bar</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.xmb</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qui sont pour la plupart illisibles. </font><em><font style="vertical-align: inherit;">Vous recherchez</font></em><font style="vertical-align: inherit;"> grep " </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intel</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " et " </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dx7</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". Rien ne se passe. Supprimer plusieurs fichiers ... Rien ne se passe. Mais vous savez que les jeux AAA peuvent stocker des ressources dans des endroits Ã©tranges, et c'est le portage des jeux Windows sur Mac, donc tout peut Ãªtre trÃ¨s bizarre ici.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fin de compte, vous trouvez le fichier Â«render.barÂ», si vous le dÃ©placez, le jeu plante au dÃ©marrage. Ce n'est pas trÃ¨s clair, mais pas mal. Nous ouvrons le fichier dans </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hex Fiend</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , car ce programme vous permet gÃ©nÃ©ralement d'apprendre quelque chose sur les fichiers binaires. Et il s'avÃ¨re donc. Une partie de ces donnÃ©es est du texte lisible. Certains d'entre eux sont des shaders. Mais la plupart des donnÃ©es sont Ã©trangement divisÃ©es par un espace vide ...</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9d1/3a2/6f5/9d13a26f5dfff14c2b44f59dbc69b673.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interface Hex Fiend C'est minimaliste, mais Ã§a marche. Les premiers octets sont les lettres Â«ESPNÂ», qui sont trÃ¨s probablement l'en-tÃªte .bar.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Vous vous exclamez: "Ã‰videmment, c'est UTF-16!" Le jeu a Ã©tÃ© crÃ©Ã© pour Windows, il est donc logique qu'il stocke du texte en UTF-16, gaspillant prÃ¨s de la moitiÃ© d'un fichier de donnÃ©es de 30 mÃ©gaoctets. AprÃ¨s tout, Windows adorait l'UTF-16 (bien </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qu'il ne devrait pas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), alors pourquoi ne pas utiliser cet encodage et ces shaders ASCII dans un seul fichier. C'est une idÃ©e logique! </font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(En fait, il m'a fallu environ un jour pour le comprendre)</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Hex Fiend a la possibilitÃ© d'analyser les octets comme UTF-16, donc nous recherchons Ã  nouveau la chaÃ®ne grep dx7. Il y a plusieurs entrÃ©es. Nous les remplaÃ§ons par la ligne dx9, qui se trouve Ã©galement dans les donnÃ©es, enregistrons le fichier et lancons le jeu.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ouais De nouveau, les journaux n'affichent pas "dx9". Cela se situe probablement ailleurs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essayons autre chose. Supposons que le jeu reconnaisse les cartes graphiques et que leurs identificateurs hexadÃ©cimaux soient stockÃ©s dans les journaux (dans mon cas, 0x8086 est Intel, et Ã©galement 0x2773). Nous recherchons Â«8086Â» dans Hex Fiend, nous trouvons quelque chose et une partie du texte semble prometteuse. L'Intel 9 Series est la sÃ©rie GMA 950, et Age 3 n'a probablement pas trÃ¨s bien fonctionnÃ©.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/af6/b22/f44/af6b22f4473691b673cb5dba2fd197f0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Certains numÃ©ros sont comme des identifiants de carte (2582, 2592); peut-Ãªtre que si vous les remplacez, quelque chose changera. Nous avons quand mÃªme fait une copie du fichier, vous pouvez donc essayer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HÃ©las, c'est aussi une impasse. En fait, nous Ã©tudions le mauvais dossier. Heureusement, je peux vous dire cela parce que j'y ai passÃ© beaucoup de temps et que j'ai </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trop</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> essayÃ© </font><font style="vertical-align: inherit;">. Cette fichue chose a pris environ 20 heures. Et cela ne compte pas le temps pour toutes les captures d'Ã©cran ... Le </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fichier souhaitÃ© s'appelle "DataP.bar", et si nous remplaÃ§ons judicieusement l'ID, nous verrons quelque chose de complÃ¨tement nouveau dans les journaux:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/445/e79/6a2/445e796a2ca507e1f1a056da1cbd30a3.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je ne comprends pas trÃ¨s bien pourquoi ce Â«dx7 gÃ©nÃ©riqueÂ» n'est pas le mÃªme que dans la capture d'Ã©cran ci-dessus. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sÃ»r, dans le jeu, nous sommes toujours limitÃ©s par les paramÃ¨tres Â«basÂ», c'est-Ã -dire que les journaux ne mentent pas. </font><font style="vertical-align: inherit;">Nous espÃ©rions un Medium, mais </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hÃ©las</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il semble que plus de piratage de donnÃ©es ne puisse Ãªtre rÃ©alisÃ©. </font><font style="vertical-align: inherit;">Il est temps de prendre les outils au sÃ©rieux.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tentative n Â° 2 - piratage</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, si rien ne rÃ©ussit, il nous reste une derniÃ¨re chose: changer le fichier exÃ©cutable lui-mÃªme (c'est-Ã -dire, comme ils l'ont dit en 2005, Â«le casserÂ»). </font><font style="vertical-align: inherit;">Il semble qu'aujourd'hui, il soit simplement appelÃ© piratage, mais ce terme a Ã©tÃ© conservÃ© dans le domaine du piratage de jeux (bien sÃ»r, je </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne l'ai jamais</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fait personnellement). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous passons Ã  la partie la plus intÃ©ressante de l'article (oui, vous avez dÃ©jÃ  lu mille mots, mais n'Ã©tait-ce pas curieux?).</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TrÃ©mie de dÃ©montage</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A ce stade, notre outil sera un dÃ©sassembleur: une application qui reÃ§oit le code binaire du fichier exÃ©cutable et le transforme en code assembleur lisible (ha ha). Le plus populaire d'entre eux est IDA Pro, mais il est incroyablement cher et je ne sais pas si cela fonctionne sur un Mac, donc j'utiliserai </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hopper</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ce n'est pas gratuit (coÃ»te 90 $), mais il peut Ãªtre utilisÃ© librement pendant 30 minutes Ã  la fois avec presque toutes les fonctions nÃ©cessaires. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne vais pas expliquer l'interface en dÃ©tail, car </font><font style="vertical-align: inherit;">tout est bien prÃ©sentÃ© </font><font style="vertical-align: inherit;">dans le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tutoriel Hopper</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais je vais vous dire ce que je vais faire et essayer de prendre suffisamment de captures d'Ã©cran pour que vous puissiez apprendre quelque chose.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous devez d'abord dire: il m'a fallu cinq jours pour rÃ©soudre, et de nombreuses tentatives infructueuses ont Ã©tÃ© faites. Fondamentalement, je parlerai des Ã©tapes rÃ©ussies, donc cela semblera magique. Mais c'Ã©tait </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">difficile</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ne vous inquiÃ©tez pas si vous avez des problÃ¨mes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et encore une remarque: le Â«crackingÂ» est le plus souvent illÃ©gal et / ou effectuÃ© Ã  des fins illÃ©gales. Je dÃ©montre un exemple assez rare d'une utilisation assez lÃ©gitime, qui en mÃªme temps est complÃ¨tement Â«chapeau blancÂ», donc tout est en ordre ici. Je suppose que, Ã  strictement parler, cela est illÃ©gal / contraire Ã  l'accord de l'utilisateur final, mais, bien sÃ»r, il s'agit d'un cas de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">force majeure</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Quoi qu'il en soit, payez ce que vous aimez, et seulement pour cela, car l'anti-consumÃ©risme est cool.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a04/597/b6a/a04597b6a9ad1979e14216547ecf61d6.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/db3/dfb/1e3/db3dfb1e3ec50890530001d69a22cdd2.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/605/66d/e69/60566de69653b745f83d196f56679263.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Faites glisser l'application Age 3 pour l'ouvrir. </font><font style="vertical-align: inherit;">SÃ©lectionnez simplement "x86" au lieu de powerPC, car le jeu date de 2005.</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã‰tape 1 - recherchez le fragment souhaitÃ©</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ã‰tonnamment, cela peut Ãªtre le plus difficile. </font><font style="vertical-align: inherit;">Nous avons un code dÃ©sassemblÃ©, mais nous ne savons pas oÃ¹ chercher. </font><font style="vertical-align: inherit;">Oui, certains jeux ont des symboles de dÃ©bogage, vous pouvez donc lire les noms des fonctions, mais pas dans notre cas. </font><font style="vertical-align: inherit;">Hopper nous donne des noms comme "sub_a8cbb6", que nous devons gÃ©rer seuls. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Heureusement, nous avons une longueur d'avance: notre </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fichier journal</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il est trÃ¨s probable que </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">des littÃ©raux de chaÃ®ne</font></a><font style="vertical-align: inherit;"> soient utilisÃ©s lors de l'Ã©criture dans le journal</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, c'est-Ã -dire que l'ASCII est flashÃ© dans le fichier exÃ©cutable. </font><font style="vertical-align: inherit;">Nous pouvons les rechercher avec grep, car nous ne nous en dÃ©barrasserons par aucune compilation (cependant, ils peuvent Ãªtre cachÃ©s par un obscurcissement de code. Heureusement, cela ne s'est pas produit.). </font><font style="vertical-align: inherit;">La recherche de littÃ©raux de chaÃ®ne grep est gÃ©nÃ©ralement la premiÃ¨re chose qu'ils font lors du dÃ©montage d'un programme. </font><font style="vertical-align: inherit;">Alors, saisissons Â«vendeur trouvÃ©Â» dans la boÃ®te de recherche de la trÃ©mie et il trouvera quelque chose:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/da7/114/b61/da7114b61ecba23df73633ad41ab338f.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oh oui, les littÃ©raux Ã  cordes, je les adore. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En soi, cela ne nous a pas tellement avancÃ©s. </font><font style="vertical-align: inherit;">Mais comme l'adresse de cette "chaÃ®ne de littÃ©raux" est codÃ©e en dur, nous pouvons y trouver des liens. </font><font style="vertical-align: inherit;">Hopper les a surlignÃ©s en vert Ã  droite: "DATA XREF = sub_1d5908 + 1252." </font><font style="vertical-align: inherit;">Double-cliquez sur la ligne, nous allons passer Ã  notre procÃ©dure hero - </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sub_1d5908</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d6d/d6a/e8b/d6dd6ae8bbe346215273e7beb930b0a7.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, nous trouvons le code assembleur. </font><font style="vertical-align: inherit;">On pense qu'il est difficile Ã  lire, mais ce n'est pas le cas. </font><font style="vertical-align: inherit;">Le plus difficile est de le comprendre. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par dÃ©faut, Hopper utilise la "syntaxe Intel", c'est-Ã -dire que le premier opÃ©rande est le rÃ©cepteur et le second la source. </font><font style="vertical-align: inherit;">Dans la ligne en surbrillance, nous voyons </font></font><code>mov dword [esp+0x1DC8+var_1DC4], aXmlRenderConfi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Faisons-le.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notre premiÃ¨re ligne d'assembleur</font></font></h2><br>
<code>mov</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Est une Ã©quipe MOV connue pour Ãªtre sur x86 </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Turing-complete</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Il dÃ©place (copie en fait) les donnÃ©es de A vers B, ce qui signifie essentiellement lire A et Ã©crire dans B. Sur la base de ce qui prÃ©cÃ¨de, </font></font><code>aXmlRenderConfi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c'est A, et </font></font><code>dword [esp+0x1DC8+var_1DC4]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c'est B, le destinataire. Examinons cela de plus prÃ¨s. </font></font><br>
<br>
<code>aXmlRenderConfi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- c'est la valeur que Hopper nous aide. Il s'agit en fait d'un alias pour l'adresse mÃ©moire du littÃ©ral de chaÃ®ne sur lequel nous avons cliquÃ© il y a quelques secondes. Si vous divisez la fenÃªtre et regardez le code en mode Hex (qui est le </font><font style="vertical-align: inherit;">mode </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prÃ©fÃ©rÃ©</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> des hackers), nous le verrons </font></font><code>88 18 83 00</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0d3/d74/31d/0d3d7431d27f6a03c2af6142f27c9a9b.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hopper met en Ã©vidence les mÃªmes fragments sÃ©lectionnÃ©s dans les deux fenÃªtres.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Si la valeur Â«flipÂ» est correcte, nous obtiendrons 0x00831888 - l'adresse mÃ©moire du littÃ©ral de chaÃ®ne (dans l'une des captures d'Ã©cran ci-dessus, elle est mÃªme surlignÃ©e en jaune). Ainsi, une Ã©nigme est rÃ©solue: le code exÃ©cute MOV, c'est-Ã -dire qu'il Ã©crit l'adresse 0x00831888. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pourquoi est-il Ã©crit comme Ã§a </font></font><code>88 18 83 00</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, pas comment </font></font><code>00 83 18 88</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? Cela s'est produit en raison de l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ordre des octets</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - un sujet plutÃ´t dÃ©routant qui a gÃ©nÃ©ralement peu d'impact. C'est l'une de ces choses qui font dire aux gens que Â«les ordinateurs ne fonctionnent pasÂ». Pour nous, cela signifie que ce problÃ¨me se produira dans tous les nombres avec lesquels nous travaillerons aujourd'hui.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous remarquerez peut-Ãªtre que j'ai dit "Ã©crivez l'adresse", et c'est vrai: nous ne nous soucions pas vraiment du contenu, qui s'est avÃ©rÃ© Ãªtre un littÃ©ral de chaÃ®ne avec un octet zÃ©ro Ã  la fin. Nous notons l'adresse car le code fera plus tard rÃ©fÃ©rence Ã  cette adresse. Ceci est un pointeur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et alors </font></font><code>dword [esp+0x1DC8+var_1DC4]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? Ici, tout est plus compliquÃ©. </font></font><code>dword</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">signifie que nous travaillons avec des "mots doubles (mots doubles)", c'est-Ã -dire avec 16 * 2 bits. Autrement dit, nous copions 32 bits. Rappel: notre adresse est</font></font><code>0x00831888</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, c'est-Ã -dire 8 caractÃ¨res hexadÃ©cimaux, et chaque caractÃ¨re hexadÃ©cimal peut avoir 16 valeurs, soit 4 bits de donnÃ©es. Nous obtenons donc 8 * 4 = 32. Soit dit en passant, la notation Â«32 bitsÂ» pour les systÃ¨mes informatiques est venue d'ici. Si nous utilisions 64 bits, l'adresse mÃ©moire serait Ã©crite comme 0x001122334455667788, serait deux fois plus longue et 2 ^ 32 fois plus grande, et nous devions copier 16 octets. Nous aurions donc beaucoup plus de mÃ©moire, mais la copie du pointeur nÃ©cessiterait deux fois plus de travail, et donc 64 bits ne sont en fait pas deux fois plus rapides que 32 bits. Soit dit en passant, une explication plus dÃ©taillÃ©e du terme Â«motÂ» peut Ãªtre trouvÃ©e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Parce que c'est, bien sÃ»r, plus compliquÃ© que mon explication.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alors, qu'en est-il de la partie entre crochets? Les crochets signifient que nous calculons ce qui est Ã  l'intÃ©rieur et le considÃ©rons comme un pointeur. Par consÃ©quent, la commande MOV Ã©crira Ã  l'adresse mÃ©moire obtenue Ã  partir des calculs. Examinons-le Ã  nouveau plus en dÃ©tail (et ne vous inquiÃ©tez pas, lorsque vous aurez terminÃ©, vous saurez essentiellement lire le code assembleur avec la syntaxe Intel). </font></font><br>
<br>
<code>esp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c'est un </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">registre</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qui dans l'assembleur est l'Ã©quivalent le plus proche d'une variable. Il existe de nombreux registres dans lâ€™architecture x86, et diffÃ©rents registres ont des modes dâ€™application diffÃ©rents, mais cela nous importe peu. Apprenez-en plus </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Sachez simplement qu'il existe des registres spÃ©ciaux pour les nombres Ã  virgule flottante, ainsi que des Â«indicateursÂ» qui sont utilisÃ©s pour les comparaisons et les opÃ©rations similaires. Tout le reste n'est que des nombres hexadÃ©cimaux que Hopper a retravaillÃ© un peu pour nous aider. </font></font><code>var_1DC4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- ceci </font></font><code>-0x1DC4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, nous pouvons le voir au dÃ©but de la procÃ©dure, ou dans le panneau de droite. Cela signifie que le rÃ©sultat du calcul </font></font><code>[esp+0x1DC8+var_1DC4]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sera </font></font><code>[esp + 0x1DC8 â€” 0x1DC4]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã©gal Ã  </font></font><code>[esp + 4]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Essentiellement, cela signifie Â«prendre la valeur 32 bits du registre ESP, ajouter 4 et interprÃ©ter le rÃ©sultat comme une adresse mÃ©moireÂ». </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, nous rÃ©pÃ©tons: nous Ã©crivons l'adresse du littÃ©ral de chaÃ®ne en Â«esp + 4Â». Ce sont des informations correctes, mais elles sont complÃ¨tement inutiles. Qu'est-ce que Ã§a veut dire?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est la difficultÃ© de lire le code assembleur: en analysant ce qu'il doit faire. </font><font style="vertical-align: inherit;">Ici, nous avons une longueur d'avance: nous savons qu'il Ã©crit trÃ¨s probablement quelque chose dans le journal. </font><font style="vertical-align: inherit;">Par consÃ©quent, nous pouvons nous attendre Ã  un appel Ã  une fonction qui Ã©crit dans le journal. </font><font style="vertical-align: inherit;">Cherchons pour elle.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c57/7f8/827/c577f8827feb59247a7c69ed0467fef2.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la capture d'Ã©cran ci-dessus, il existe plusieurs appels similaires, ainsi que la commande </font></font><code>call</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui appelle la procÃ©dure. </font><font style="vertical-align: inherit;">Hopper en parle gÃ©nÃ©ralement (je ne sais pas pourquoi il ne l'a pas fait ici), mais en substance, nous donnons des arguments pour appeler la fonction. </font><font style="vertical-align: inherit;">Si vous cliquez sur diffÃ©rents appels de sous-programme, nous trouvons quelque chose appelÃ© imp___jump_table___Z22StringVPrintfExWorkerAPcmmPS_PmmPKcS_. </font><font style="vertical-align: inherit;">C'est le </font><font style="vertical-align: inherit;">nom </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dÃ©codÃ©</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de la fonction, et la partie Â«PrintfÂ» suffit pour comprendre qu'elle sort vraiment quelque chose. </font><font style="vertical-align: inherit;">Peu nous importe comment elle le fait.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prendre du recul</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ã€ ce stade, nous nous sommes complÃ¨tement Ã©cartÃ©s de ce que nous avons fait: nous avons essayÃ© de convaincre le jeu que notre carte graphique 2015 Ã©tait suffisamment puissante pour lancer le jeu 2005. RÃ©sumons. Nous avons trouvÃ© l'endroit oÃ¹ le journal est enregistrÃ©. Si nous avons de la chance, voici le code qui vÃ©rifie les paramÃ¨tres et les capacitÃ©s des cartes graphiques. Heureusement, nous avons vraiment eu de la chance (il y a de fortes chances que sinon cet article ne l'aurait pas Ã©tÃ©). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour avoir une vue d'ensemble, nous utiliserons la fonction Hopper Control Flow Graph, qui divise le code en petits blocs et trace des flÃ¨ches indiquant diffÃ©rentes transitions. C'est beaucoup plus facile Ã  comprendre que dans un assembleur ordinaire, dans lequel souvent tout est en dÃ©sordre.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e3a/4bd/1b1/e3a4bd1b1528d0344f4f1174b16be79c.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'appel Ã  l'entrÃ©e du journal est au milieu d'une fonction terriblement longue, car cela se produit gÃ©nÃ©ralement dans les jeux AAA. </font><font style="vertical-align: inherit;">Ici, nous devons rechercher d'autres littÃ©raux et "astuces" de chaÃ®ne Hopper, dans l'espoir de trouver quelque chose. </font><font style="vertical-align: inherit;">Au dÃ©but de la procÃ©dure se trouve le reste de la journalisation, et ci-dessous il y a des parties intÃ©ressantes sur les options de Â«forÃ§age dx7Â» et Â«TrÃ¨s Ã©levÃ©Â», ainsi qu'un problÃ¨me avec la version des pixel shaders ... </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que nous avons.</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le journal de nos donnÃ©es "piratÃ©es" a rapportÃ© que nous avions des pixel shaders de la version 0.0, et ils sont incompatibles avec les paramÃ¨tres "High". </font><font style="vertical-align: inherit;">Ce code est situÃ© dans le coin infÃ©rieur gauche de notre fonction, et si vous regardez attentivement, vous pouvez voir quelque chose de curieux (mis en Ã©vidence par votre humble serviteur): il s'agit du mÃªme code rÃ©pÃ©tÃ© quatre fois pour les paramÃ¨tres "TrÃ¨s Ã©levÃ©", "Haut", "Moyen" et "Bas". </font><font style="vertical-align: inherit;">Et oui, il m'a fallu plusieurs heures pour trouver cela.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/27b/132/603/27b13260328e5da3cbef4323e840563f.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'ai surlignÃ© en bleu le bloc dans lequel Â«pixel shader version 0.0 HighÂ» est affichÃ© dans le journal. J'ai mis en Ã©vidence des parties similaires avec d'autres belles couleurs.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Les seules diffÃ©rences sont que nous Ã©crivons Â«0x0Â», Â«0x1Â», Â«0x2Â» et Â«0x3Â» Ã  diffÃ©rents endroits. Ceci est Ã©trangement similaire au fichier de paramÃ¨tres que nous avons examinÃ© ci-dessus et au paramÃ¨tre </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">optiongrfxshaderquality</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (vous ne le comprenez peut-Ãªtre pas encore. Mais il l'est, croyez-moi). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ã€ ce stade, nous pouvons essayer d'aller de diffÃ©rentes maniÃ¨res, ce que j'ai fait. Mais je serai bref - nous ferons le plus nÃ©cessaire: dÃ©couvrez pourquoi la vÃ©rification du pixel shader Ã©choue. Cherchons une branche. Le bloc de sortie du journal est linÃ©aire, ce qui signifie qu'il devrait Ãªtre quelque part au-dessus.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/724/d53/3a7/724d533a7f9af2353f611c6bea4f15b7.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les fans de SEMVER, voir un format de version plus avancÃ©: les nombres Ã  virgule flottante.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Et en fait, juste au-dessus, il y a </font></font><code>jb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">une commande de transition (pensez Ã  Â«gotoÂ»). Il s'agit d'un " </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">saut conditionnel</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " et la condition est " </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si moins</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". Les Â«ifsÂ» de l'assembleur fonctionnent via </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des indicateurs de registre</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dont j'ai briÃ¨vement parlÃ© ci-dessus. Il suffit de savoir que nous devons regarder la commande ci-dessus: trÃ¨s probablement, elle dÃ©finit le drapeau. Il s'agit souvent d'une commande </font></font><code>cmp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>test</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais utilisÃ©e ici </font></font><code>ucomiss</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. C'est de la barbarie. Mais elle google facilement: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ucomiss</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Il s'agit d'une commande de comparaison Ã  virgule flottante, ce qui explique pourquoi le code a</font></font><code>xmm0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: Il s'agit d'un registre de nombres Ã  virgule flottante. C'est logique: les journaux indiquent que notre version des pixel shaders est Â«0.0Â», qui est une valeur Ã  virgule flottante. Alors, qu'est-ce qui se trouve Ã  l'adresse mÃ©moire 0x89034c? Les donnÃ©es hexadÃ©cimales ont un aspect </font></font><code>00 00 00 40</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et elles peuvent Ãªtre dÃ©routantes. Mais nous savons que nous devons nous attendre Ã  des nombres Ã  virgule flottante, alors interprÃ©tons les donnÃ©es comme Ã§a: cela signifie </font></font><code>2.0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Qui est une valeur logique Ã  virgule flottante pour la version des pixel shaders que Microsoft a rÃ©ellement utilisÃ©e dans son </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">langage d'ombrage de haut niveau</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur lequel les shaders DirectX sont Ã©crits. </font><font style="vertical-align: inherit;">Et Age 3 est un jeu DirectX, mÃªme si le port sur Mac utilise OpenGL. </font><font style="vertical-align: inherit;">Il est Ã©galement logique qu'en 2005, des pixel shaders de la version 2.0 soient nÃ©cessaires pour activer le paramÃ¨tre High, nous allons donc dans la bonne direction. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment rÃ©parons nous Ã§a? </font><font style="vertical-align: inherit;">Cette instruction de comparaison effectue une comparaison avec la valeur Ã  </font></font><code>xmm0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">laquelle est donnÃ©e dans la ligne ci - </font><font style="vertical-align: inherit;">dessus: </font></font><code>movss xmm0, dword [eax+0xA2A8]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">MOVSS est une commande spÃ©ciale de Â«dÃ©placementÂ» pour les registres Ã  virgule flottante, et nous Ã©crivons 32 bits Ã  partir de l'adresse, qui est le rÃ©sultat de l'Ã©valuation de eax + 0xA2A8. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vraisemblablement, cette valeur n'est pas de 2,0, mais plutÃ´t de 0,0. </font><font style="vertical-align: inherit;">Corrigeons-le.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Faire du vrai piratage</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enfin, nous sommes prÃªts Ã  accÃ©der aux paramÃ¨tres du jeu High. Nous voulons suivre le chemin "rouge" et sauter toute la logique avec la "mauvaise version des pixel shaders". Cela peut Ãªtre fait en passant avec succÃ¨s la comparaison, c'est-Ã -dire en inversant la condition de transition, mais nous avons une astuce de plus: le code est composÃ© de telle maniÃ¨re que lors de la suppression de la transition, nous irons dans le sens "rouge". RemplaÃ§ons simplement la transition par </font></font><code>nop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">une opÃ©ration qui ne fait rien (il est impossible de simplement supprimer ou ajouter des donnÃ©es au fichier exÃ©cutable car un dÃ©calage se produira et tout se cassera). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je recommande de quitter CFG pour cela, car sinon Hopper commence Ã  devenir fou. Si tout est fait correctement, alors dans la fenÃªtre Hex, nous verrons des lignes rouges.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/903/09d/db2/90309ddb2fecf42031e8bf9d4a6abe88.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/010/d39/b35/010d39b355b0cb7e5b55fc83007e17ae.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le rouge montre les changements que nous avons apportÃ©s. </font><font style="vertical-align: inherit;">Ã€ ce stade, si vous avez payÃ© Hopper, vous pouvez simplement enregistrer le fichier. </font><font style="vertical-align: inherit;">Mais je n'ai pas payÃ©, je vais donc ouvrir le fichier exÃ©cutable dans Hex Fiend, trouver la zone souhaitÃ©e (en copiant la zone de Hopper dans l'onglet Rechercher Ã  l'intÃ©rieur de Hex Fiend) et la modifier manuellement. </font><font style="vertical-align: inherit;">Faites attention ici, vous pouvez tout casser, donc je recommande de copier quelque part le fichier exÃ©cutable source. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela fait, lancez le jeu, allez dans les options ... Et bravo - nous pouvons sÃ©lectionner "High". </font><font style="vertical-align: inherit;">Mais on ne peut pas choisir "moyen". </font><font style="vertical-align: inherit;">Et nous ne pouvons pas utiliser les paramÃ¨tres Ã©levÃ©s des ombres. </font><font style="vertical-align: inherit;">NÃ©anmoins, nous progressons!</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3df/3a2/bba/3df3a2bbaa02e57ce2997e53137bdb56.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jetez un Å“il Ã  ces magnifiques reflets dans l'eau!</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AmÃ©liorations</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, vous pouvez rÃ©soudre ce problÃ¨me de la meilleure faÃ§on. Notre solution a fonctionnÃ©, mais nous pouvons faire en sorte que la condition soit remplie correctement: faire croire au jeu que notre carte graphique a en fait des shaders de la version 2.0. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme nous nous en souvenons, le jeu charge la valeur Ã  l'adresse </font></font><code>eax+0xA2A8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Vous pouvez utiliser Hopper pour dÃ©couvrir ce qui a Ã©tÃ© enregistrÃ© Ã  l'origine. Nous devons trouver une commande dans laquelle 0xA2A8 est utilisÃ© comme opÃ©rande destinataire (j'ai choisi 0xA2A8 parce que c'est une valeur assez spÃ©cifique, et nous ne pouvons pas Ãªtre sÃ»rs que le mÃªme registre n'est pas utilisÃ© ailleurs). Ici, le rÃ©tro-Ã©clairage de la trÃ©mie nous est trÃ¨s utile, car nous pouvons simplement cliquer sur 0xA2A8 et rechercher les parties jaunes dans CFG.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bbd/5ed/75b/bbd5ed75b7b712a39861769efc3f63cd.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notre victoire est un peu plus Ã©levÃ©e: comme prÃ©vu, nous Ã©crivons la valeur d'une sorte de registre Ã  virgule flottante. J'avoue que je ne comprends pas vraiment ce qui se passe avant cela (ma meilleure supposition: le jeu vÃ©rifie la possibilitÃ© de compression de texture), mais ce n'est pas particuliÃ¨rement important. Ã‰crivons Â«2.0Â» et continuons le travail. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour ce faire, nous utiliserons les Â«instructions d'assemblageÂ» de l'application Hopper, puis effectuerons les mÃªmes manipulations dans Hex Fiend.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/92d/3d1/637/92d3d1637e2c46321c9983f68ffda742.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/784/a8f/f5b/784a8ff5bb2755f378143d4740d4201f.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9b6/fed/ff0/9b6fedff0d7cbbeb9713c34513776468.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous utilisons MOV au lieu de MOVSS car nous Ã©crivons la valeur habituelle, et non la valeur spÃ©ciale du registre Ã  virgule flottante. De plus, il est en ordre d'octets direct, c'est-Ã -dire inversÃ©.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Vous remarquerez qu'il se passe quelque chose d'Ã©trange: nous avons Â«mangÃ©Â» l'Ã©quipe </font></font><code>jb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Cela est arrivÃ© parce que la nouvelle commande prend plus d'octets que la prÃ©cÃ©dente, et comme je l'ai dit, nous ne pouvons pas ajouter ou supprimer des donnÃ©es du fichier exÃ©cutable pour enregistrer les dÃ©calages. Par consÃ©quent, Hopper n'a d'autre choix que de dÃ©truire l'Ã©quipe </font></font><code>jb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Cela peut devenir un problÃ¨me et nous pouvons l'Ã©liminer en dÃ©plaÃ§ant la commande vers le haut (aprÃ¨s tout, nous n'avons plus besoin d'Ã©crire la valeur xmm3). Cela fonctionnera ici, car dans tous les cas, nous faisons le branchement sur le bon chemin. Chanceux.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous dÃ©marrez le jeu ... alors rien ne changera beaucoup. </font><font style="vertical-align: inherit;">J'ai suggÃ©rÃ© que la sÃ©rie Intel 9 n'est pas assez rapide, donc le jeu se plaint. </font><font style="vertical-align: inherit;">Ce n'est pas un problÃ¨me, car en rÃ©alitÃ© nous nous efforÃ§ons de Â«trÃ¨s Ã©levÃ©Â». </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quelle Ã©tait la carte la plus puissante autour de 2004? </font><font style="vertical-align: inherit;">NVIDIA GeforceFX 6800. Voyons comment convaincre le jeu que nous l'avons installÃ©.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans le trou de lapin</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oui, c'est une toute nouvelle section. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous savons que le jeu utilise des codes Hex pour dÃ©signer les cartes graphiques et qu'il reÃ§oit des informations des fichiers de donnÃ©es. Nous savons que cela devrait se produire dans la fonction que nous Ã©tudions (au moins ce serait Ã©trange si ce n'Ã©tait pas le cas). Nous pouvons donc trouver le code qui fait cela. Mais cela peut encore Ãªtre difficile, car nous ne savons pas exactement quoi chercher. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons un indice: les options se comportent Ã©trangement; il y a Low / High, mais pas de Medium. Il y a donc peut-Ãªtre un autre code qui gÃ¨re tous ces Â«trÃ¨s hautÂ», Â«hautÂ», Â«moyenÂ» et Â«basÂ». Et il est en fait, dans la mÃªme fonction. Il est beaucoup plus tÃ´t au CFG et semble intÃ©ressant.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e73/73a/ea1/e7373aea138358b603c609d8704cfed0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous pouvons supposer que les donnÃ©es brutes sont stockÃ©es dans une sorte de XML, car il est trÃ¨s probable, car il existe plusieurs autres fichiers de donnÃ©es qui sont XML. Et XML est essentiellement un tas de pointeurs et d'attributs. Par consÃ©quent, le code ici vÃ©rifie trÃ¨s probablement certains attributs XML (et en fait, ci-dessous est Â«attendu un ID, trÃ¨s Ã©levÃ© ...Â», ce qui est trÃ¨s similaire Ã  la vÃ©rification de l'exactitude du fichier). Nous pouvons imaginer une structure XML similaire dans laquelle les valeurs boolÃ©ennes dÃ©terminent la qualitÃ© des shaders:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4e8/bf7/411/4e8bf7411dd677f1415ae71c887cbef5.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il convient de considÃ©rer qu'il s'agit d'une supposition trÃ¨s arbitraire. </font><font style="vertical-align: inherit;">Tout peut sembler un peu diffÃ©rent. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une partie trÃ¨s intÃ©ressante est affichÃ©e sur le cÃ´tÃ© gauche du CFG (pour vous, cela peut Ãªtre Ã  droite, mais Ã  gauche dans la capture d'Ã©cran): nous voyons le mÃªme </font></font><code>var_CC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui est utilisÃ© dans le code qui Ã©crit l'ID de l'appareil dans le journal. </font><font style="vertical-align: inherit;">Autrement dit </font></font><code>ebp+var_CC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, se rÃ©fÃ¨re probablement Ã  l'ID de notre appareil, 0x2773. </font><font style="vertical-align: inherit;">Ce qui est Ã©trange, c'est qu'il n'y a pas de littÃ©ral de chaÃ®ne dans la premiÃ¨re Â«vÃ©rificationÂ», mais il s'agit d'un bogue Hopper: l'adresse 0x0089da8e contient des donnÃ©es hexadÃ©cimales 69006400, qui en UTF-16 signifie Â«idÂ» (en fait, probablement Hopper n'a pas pu comprendre cela Ã  cause de UTF16). </font><font style="vertical-align: inherit;">Et nous </font><font style="vertical-align: inherit;">cherchons </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">juste</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> une piÃ¨ce d'identitÃ©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous savez quoi? </font><font style="vertical-align: inherit;">LanÃ§ons le dÃ©bogueur et vÃ©rifions tout dans la rÃ©alitÃ©.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DÃ©bogage du jeu</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ouvrez une fenÃªtre de terminal et exÃ©cutez lldb (tapez simplement lldb et appuyez sur EntrÃ©e). Nous devons d'abord dire Ã  LLDB de suivre l'Ã¢ge de 3 ans, puis nous pouvons commencer le jeu en appelant </font></font><code>run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Le jeu dÃ©marre et nous n'obtenons rien d'utile.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/47b/0f2/279/47b0f227957a0414bc739002abafb432.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, nous devons ajouter un point d'arrÃªt: pour confirmer nos hypothÃ¨ses, nous voulons arrÃªter l'exÃ©cution lorsque nous arrivons au code indiquÃ© ci-dessus. Nous n'avons pas de code source, mais cela n'a pas d'importance: nous pouvons dÃ©finir un point d'arrÃªt Ã  l'adresse mÃ©moire. Et nous avons l'adresse dans le code. Ajoutons un arrÃªt Ã  un appel MOV qui reÃ§oit un "id", son adresse est 0x001d5e68. Pour ajouter un point d'arrÃªt, entrez simplement </font></font><code>br set -a 001D5E68</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. AprÃ¨s avoir dÃ©marrÃ© le jeu, il s'arrÃªte et LLDB affiche le code dÃ©sassemblÃ© (dans la syntaxe AT&amp;T, pas Intel, donc tous les opÃ©randes sont inversÃ©s, mais on voit que c'est le mÃªme code). Vous pouvez remarquer que LLDB dans ce cas est en fait plus intelligent que Hopper; il nous dit que nous effectuons des opÃ©rations liÃ©es Ã  XML et Ã  la sortie printf.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cd0/2fa/07c/cd02fa07c9a2dbd13ed07558f0983595.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/95d/fa6/710/95dfa671088f1c7097b439851f586b24.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Envie d'un hacker? </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour continuer, prenons une Â«instruction par Ã©tapesÂ». </font><font style="vertical-align: inherit;">Une commande courte pour cela </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 est </font></font><code>ni</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">En rÃ©pÃ©tant plusieurs fois, nous remarquons que nous revenons Ã  notre point de dÃ©part. </font><font style="vertical-align: inherit;">Ceci est un cycle! </font><font style="vertical-align: inherit;">Et c'est tout Ã  fait logique: nous itÃ©rons probablement autour d'une sorte de XML. </font><font style="vertical-align: inherit;">En fait, Hopper nous l'a montrÃ© - si nous suivons le CFG, nous verrons un cycle (possible).</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/70f/63f/fdd/70f63ffddb8c3c073dcc257af70581d8.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cela signifie:</font></font><code>if (*(ebp+var_CC) == *(ebp+var_28)) { *(ebp+var_1D84)=edi }</code></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Sa condition de sortie est que la valeur </font></font><code>ebp+var_1D84</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">soit diffÃ©rente de zÃ©ro. </font><font style="vertical-align: inherit;">Et nous voyons un paramÃ¨tre de code intÃ©ressant dans celui mis en Ã©vidence par moi </font></font><code>var_CC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ajoutons un point d'arrÃªt sur celui-ci </font></font><code>cmp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et nous le dÃ©couvrirons.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9a3/c32/d3a/9a3c32d3a01dd202e192648f5ef6609c.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/593/bc4/34d/593bc434d505cb29799846d61cb177bb.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gauche: dÃ©finissez un point d'arrÃªt sur le CMP et poursuivez l'exÃ©cution. A droite, nous surveillons les registres et la mÃ©moire.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nous regardons les registres avec </font></font><code>reg r</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et la valeur de la mÃ©moire avec </font></font><code>mem read $ebp-0x28</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><code>eax</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et contient rÃ©ellement 0x2773, et la valeur en mÃ©moire est maintenant 0x00A0. Si vous l'exÃ©cutez plusieurs fois </font></font><code>thread c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, nous verrons que l'itÃ©ration se produit sur diffÃ©rents ID Ã  la recherche de correspondances. Ã€ un certain stade, les valeurs coÃ¯ncideront, la boucle se terminera et le jeu commencera. Maintenant, nous savons comment le gÃ©rer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rappelez-vous le fichier journal: il a identifiÃ© Ã  la fois l'appareil et le fabricant. Quelque part, il y a probablement un cycle similaire pour les noms des fabricants. Et en fait, il est trÃ¨s similaire et situÃ© dans le CFG directement au-dessus de notre cycle. Cette boucle est un peu plus simple, et nous recherchons la chaÃ®ne Â«vendorÂ». </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette fois, la comparaison est effectuÃ©e avec</font></font><code>var_D0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Cette variable est en fait utilisÃ©e comme ID fabricant. </font><font style="vertical-align: inherit;">Si nous mettons un point d'arrÃªt ici et vÃ©rifions tout, nous verrons le 0x8086 familier Ã  </font></font><code>eax</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et en mÃªme temps, une comparaison avec 0x10DE se produit. </font><font style="vertical-align: inherit;">Ã‰crivons-le </font></font><code>eax</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et voyons ce qui se passe.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e4a/014/fd5/e4a014fd58bcc6408f48de1411db83b8.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/03b/9ce/7d0/03b9ce7d056048ecdf69987c3e8d774a.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sensationnel. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Autrement dit, 0x10DE est NVIDIA. </font><font style="vertical-align: inherit;">En fait, on pourrait comprendre cela en Ã©tudiant un fichier de donnÃ©es, mais ce n'est pas trÃ¨s intÃ©ressant. </font><font style="vertical-align: inherit;">Maintenant, la question est: quel est l'identifiant du GeforceFX 6800? </font><font style="vertical-align: inherit;">Nous pouvons utiliser LLDB et vÃ©rifier simplement chaque identifiant, mais cela prendra du temps (il y en a beaucoup, j'ai essayÃ© de trouver le bon). </font><font style="vertical-align: inherit;">Jetons donc un coup d'Å“il Ã  render.bar cette fois.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cbc/605/7f4/cbc6057f454e5ee95865324fea40e271.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supposons qu'il s'agisse de Â«XMBÂ», la reprÃ©sentation binaire de XML utilisÃ©e Ã  l'age 3.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ce fichier est assez chaotique. Mais aprÃ¨s les balises Geforce FX 6800, nous voyons plusieurs identifiants. TrÃ¨s probablement, nous en avons besoin. Essayons 00F1. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le moyen le plus simple de tester cela est d'utiliser LLDB et de dÃ©finir les points d'arrÃªt souhaitÃ©s. Je vais sauter cette Ã©tape, mais je dirai que 00F1 est apparu (heureusement). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ã€ ce stade, nous devons rÃ©pondre Ã  la question: Â«Comment rendre ce changement permanent?Â» Il semble qu'il sera plus facile de changer les valeurs </font></font><code>var_CC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>var_D0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur 0X00F1 et 0X10DE. Pour ce faire, nous avons juste besoin d'avoir de l'espace pour le code.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une solution simple serait de remplacer l'un des appels d'enregistrement de journal par un NOP, par exemple, un appel de sous-systÃ¨me. </font><font style="vertical-align: inherit;">Cela nous libÃ©rera plusieurs dizaines d'octets, et c'est encore plus que nÃ©cessaire. </font><font style="vertical-align: inherit;">SÃ©lectionnons tout cela et remplaÃ§ons-le par NOP. </font><font style="vertical-align: inherit;">Ensuite, nous avons juste besoin d'Ã©crire des informations en utilisant les variables MOV: assembleur </font></font><code>mov dword [ebp+var_CC], 0xF1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>mov dword [ebp+var_D0], 0x10DE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e6f/eb6/d19/e6feb6d1903ca8305714594fe1911413.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/79c/096/783/79c096783f59920be40a85fdac85f44f.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avant et aprÃ¨s</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
LanÃ§ons le jeu. </font><font style="vertical-align: inherit;">Enfin, nous avons rÃ©alisÃ© quelque chose: vous pouvez choisir entre Faible, Moyen ou Ã‰levÃ©, ainsi qu'activer les paramÃ¨tres Ã‰levÃ©s pour les ombres.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/370/8b5/7cb/3708b57cb8d0d5e405e54e4c5ee99eb8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais nous ne pouvons toujours pas activer TrÃ¨s Ã©levÃ©, et c'est triste. </font><font style="vertical-align: inherit;">Que ce passe-t-il?</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e16/2e6/732/e162e673279757ba3cac035fa5f9b0f6.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ah, j'ai compris.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Il s'est avÃ©rÃ© que le Geforce FX 6800 devrait prendre en charge la version 3.0 pixel shaders, et nous ne dÃ©finissons que la version 2.0. Maintenant, il est facile pour nous de le rÃ©parer: il suffit d'Ã©crire 3.0 en virgule flottante </font></font><code>ebp+0xA2A8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Cette valeur est 0x40400000. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enfin, le jeu n'est plus capricieux, et nous pouvons profiter de paramÃ¨tres trÃ¨s Ã©levÃ©s.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f3c/24e/2c1/f3c24e2c156feb16f1d34bf67aa33d5a.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã‰trange, mais Ã§a a l'air complÃ¨tement diffÃ©rent. Les couleurs sont beaucoup moins vibrantes et un brouillard dÃ©pendant de la plage est apparu. Il y a aussi un petit problÃ¨me de conflit d'ombres (il est Ã©galement dans les captures d'Ã©cran ci-dessus, cela est dÃ» aux paramÃ¨tres d'ombre Ã©levÃ©s, pas Ã  la qualitÃ© des shaders), que je n'ai pas encore pu rÃ©soudre.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Et c'est la fin de notre voyage, merci pour la lecture. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, je donnerai des exemples de l'apparence de chacun des paramÃ¨tres du jeu, car toutes les captures d'Ã©cran trouvÃ©es en ligne sont terribles ou incomplÃ¨tes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les graphismes sur Medium sont tout Ã  fait acceptables, mais souffrent d'un manque d'ombres. Pour autant que je sache, trÃ¨s Ã©levÃ© ajoute pour la plupart une LUT complÃ¨tement diffÃ©rente (une bonne explication de ce terme peut Ãªtre trouvÃ©e dans la section Gradation des couleurs de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cet article.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), du brouillard au loin et peut-Ãªtre mÃªme un modÃ¨le d'Ã©clairage complÃ¨tement diffÃ©rent? </font><font style="vertical-align: inherit;">L'image est trÃ¨s diffÃ©rente et c'est plutÃ´t Ã©trange.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b5a/ed3/00d/b5aed300d967d53f67bf3e8798615525.jpg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1c8/0b8/bd7/1c80b8bd77a9cdfb4fdbd1da13146035.jpg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/45a/73b/776/45a73b7760497a9424b4e92984071e2c.jpg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/817/12a/54c/81712a54ca17e71925eea886f628db3f.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De haut en bas: trÃ¨s Ã©levÃ©, Ã©levÃ© (avec les options d'ombre Ã©levÃ©e), moyen (juste avec l'ombre activÃ©e), faible (avec l'ombre dÃ©sactivÃ©e).</font></font></i><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Autres liens utiles</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le blog que j'ai liÃ© ci-dessus contient une merveilleuse analyse des pipelines de rendu modernes: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://www.adriancourreges.com/blog/</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Rate 0 AD est un jeu RTS open-source du mÃªme genre: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://play0ad.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Elle a besoin de dÃ©veloppeurs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous voulez en savoir plus sur le format XMB, vous pouvez lire </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">son code en 0 AD</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Je n'ai pas vÃ©rifiÃ©, mais je suis sÃ»r que c'est le mÃªme format, car la personne qui a Ã©crit </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le dÃ©codeur XMB pour Age 3 sur Age of Empires heaven a</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ã©galement implÃ©mentÃ© ces fichiers dans le code source 0 AD en 2004. Donc, ce sera une leÃ§on amusante en palÃ©ontologie de code. Merci pour tout le travail, Ykkrosh.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je me souviens exactement que j'ai lu un excellent tutoriel sur l'utilisation de Hopper, mais maintenant je ne trouve pas le lien. </font><font style="vertical-align: inherit;">Si quelqu'un sait de quoi je parle, supprimez le lien. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au final, je voudrais mentionner le projet Cosmic Frontier: un remake de la sÃ©rie classique Escape Velocity (plus d'Override, mais il est Ã©galement compatible avec Nova). </font><font style="vertical-align: inherit;">C'est un jeu incroyable et il est trÃ¨s triste que peu de gens le connaissent. </font><font style="vertical-align: inherit;">Maintenant, les crÃ©ateurs ont lancÃ© une campagne sur Kickstarter, et le dÃ©veloppeur principal a un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">blog de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dÃ©veloppement trÃ¨s intÃ©ressant </font><font style="vertical-align: inherit;">, qui parle d'utiliser Hex Fiend pour inverser les formats de donnÃ©es du jeu original. </font><font style="vertical-align: inherit;">Ceci est une excellente lecture. </font><font style="vertical-align: inherit;">Si vous pensez que </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mon article</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ã©tait fou. </font><font style="vertical-align: inherit;">puis dans l'un des postes, ils:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons lancÃ© l'Ã©mulateur Mac classique pour utiliser les API obsolÃ¨tes depuis longtemps pour lire un fichier de donnÃ©es cryptÃ©.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cryptage d'ingÃ©nierie inverse Ã  partir du code du jeu</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ils ont utilisÃ© un hack de systÃ¨me de fichiers pour accÃ©der aux mÃªmes donnÃ©es sur un Mac moderne.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oui, ce sont des gens vraiment passionnÃ©s, et j'espÃ¨re que leur projet sera menÃ© Ã  bien, car EV Nova est mon jeu prÃ©fÃ©rÃ©.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr500516/index.html">Transfert rapide depuis les messageries instantanÃ©es - Portefeuille Android QIWI</a></li>
<li><a href="../fr500518/index.html">ItÃ©rations d'introduction de Scrum dans une entreprise</a></li>
<li><a href="../fr500520/index.html">Comment utiliser vos applications dans le monde entier: 10 conseils du PDG Wachanga</a></li>
<li><a href="../fr500528/index.html">Ã€ propos de la traduction de "pratique" / "pratique" sans pratique / pratique</a></li>
<li><a href="../fr500530/index.html">MÃ©mo API Canvas</a></li>
<li><a href="../fr500546/index.html">CrÃ©er un document de tableau simple Ã  l'aide de la boÃ®te Ã  outils ODF</a></li>
<li><a href="../fr500552/index.html">Comment accÃ©lÃ©rer la rÃ©vision du code</a></li>
<li><a href="../fr500554/index.html">ModÃ¨le de serveur d'arriÃ¨re-plan Golang - partie 2 (API REST)</a></li>
<li><a href="../fr500556/index.html">Deux ans de transformation numÃ©rique en deux mois</a></li>
<li><a href="../fr500558/index.html">Une sÃ©lection d'articles sur l'apprentissage automatique: Ã©tudes de cas, guides et recherches pour avril 2020</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>