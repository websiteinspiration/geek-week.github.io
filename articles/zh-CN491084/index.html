<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â™¦ï¸ ğŸ–•ğŸ¿ ğŸ‘©ğŸ½â€ğŸ”¬ saneex.cï¼šå°è¯•/æ•è·/æœ€ç»ˆåŸºäºsetjmp / longjmpï¼ˆC99ï¼‰çš„é€Ÿåº¦æ¯”æ ‡å‡†C ++ä¾‹å¤–Â¹ ğŸ›€ğŸ½ ğŸ™ ğŸ”“</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨Habræ’°å†™è¿™ç¯‡çº¯æŠ€æœ¯æ–‡ç« çš„è¿‡ç¨‹ä¸­ï¼ŒHabrè®¾æ³•æˆä¸ºäº†WHOçš„ä¸€ä¸ªå½“åœ°åŠäº‹å¤„ï¼Œç°åœ¨æˆ‘ä»€è‡³æ„Ÿåˆ°ç¾è€»åœ°å‡ºç‰ˆäº†è¯¥æ–‡ç« â€¦â€¦ä½†äººä»¬å¯¹ITäººå‘˜å°šæœªé€ƒç¦»çš„å¸Œæœ›å……æ»¡äº†å¸Œæœ›ï¼Œå¥¹å°†æ‰¾åˆ°å¥¹çš„è¯»è€…ã€‚æˆ–ä¸ï¼Ÿ
 
 

æ ‡å‡†Cåº“å’ŒCæœ¬èº«ä¸€ç›´ä»¤æˆ‘èµå¹ä¸å·²ï¼Œå°½ç®¡å®ƒå…·æœ‰æç®€ä¸»ä¹‰ï¼Œä½†å®ƒä»ç„¶éœ‡æ’¼äº†æœ€åˆçš„é‚£äº›äººçš„ç²¾ç¥ã€‚ çº¢çœ¼ éª‡å®¢ã€‚ç¬¬ä¸€...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>saneex.cï¼šå°è¯•/æ•è·/æœ€ç»ˆåŸºäºsetjmp / longjmpï¼ˆC99ï¼‰çš„é€Ÿåº¦æ¯”æ ‡å‡†C ++ä¾‹å¤–Â¹</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/491084/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨Habræ’°å†™è¿™ç¯‡çº¯æŠ€æœ¯æ–‡ç« çš„è¿‡ç¨‹ä¸­ï¼ŒHabrè®¾æ³•æˆä¸ºäº†WHOçš„ä¸€ä¸ªå½“åœ°åŠäº‹å¤„ï¼Œç°åœ¨æˆ‘ä»€è‡³æ„Ÿåˆ°ç¾è€»åœ°å‡ºç‰ˆäº†è¯¥æ–‡ç« â€¦â€¦ä½†äººä»¬å¯¹ITäººå‘˜å°šæœªé€ƒç¦»çš„å¸Œæœ›å……æ»¡äº†å¸Œæœ›ï¼Œå¥¹å°†æ‰¾åˆ°å¥¹çš„è¯»è€…ã€‚</font><font style="vertical-align: inherit;">æˆ–ä¸ï¼Ÿ</font></font></p><br>
<hr><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ ‡å‡†Cåº“å’ŒCæœ¬èº«ä¸€ç›´ä»¤æˆ‘èµå¹ä¸å·²ï¼Œå°½ç®¡å®ƒå…·æœ‰æç®€ä¸»ä¹‰ï¼Œä½†å®ƒä»ç„¶éœ‡æ’¼äº†æœ€åˆçš„é‚£äº›äººçš„ç²¾ç¥ã€‚ </font></font><del><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çº¢çœ¼</font></font></del> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éª‡å®¢</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚ç¬¬</font><font style="vertical-align: inherit;">ä¸€ä¸ªæ­£å¼æ ‡å‡†ï¼ˆANSI Cï¼Œä¹Ÿç§°ä¸ºC89ï¼Œ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">åˆç§°ä¸º</font></a><font style="vertical-align: inherit;"> ANS X3.159-1989ï¼Œåæ¥ï¼ŒC90å’ŒIEC 9899ï¼š1990ï¼‰</font><font style="vertical-align: inherit;">çš„</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è‰æ¡ˆ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®šä¹‰äº†145ä¸ªåŠŸèƒ½å’Œå®ï¼Œå…¶ä¸­çº¦æœ‰25ä¸ªæ˜¯å˜ä½“ï¼ˆç”±äºç¼ºå°‘ç”¨é‡è½½è¯­è¨€è¡¨ç¤ºï¼‰ï¼Œè€Œ26çº¯ç²¹æ˜¯æ•°å­¦ä¸Šçš„ã€‚</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">åœ¨ç¬¬äºŒç‰ˆä¸­ï¼ŒKï¼†R</font></a><font style="vertical-align: inherit;">å¼•ç”¨äº†114ä¸ªå‡½æ•°ï¼ˆåŠ ä¸Šæ•°å­¦å‡½æ•°ï¼‰ï¼Œå¹¶å°†å…¶ä½™å‡½æ•°è§†ä¸ºå¥‡å¼‚å‡½æ•°ã€‚åœ¨</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">è‰æ¡ˆC11</font></a><font style="vertical-align: inherit;">ä¸­ï¼Œå·²ç»æœ‰348ä¸ªå‡½æ•°ï¼Œä½†æ˜¯æ•°å­¦ä¸­æœ‰ä¸€ç™¾å¤šä¸ªå‡½æ•°ï¼Œè€Œâ€œè¿‡è½½â€åˆ™æœ‰90å¤šä¸ªã€‚ç°åœ¨è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹Boostï¼Œé‚£é‡Œ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">åªæœ‰160ä¸ªåº“</font></a><font style="vertical-align: inherit;">ã€‚ huræˆ‘...</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è¿™ä¸€ç™¾é›¶äº”ç§å‡½æ•°ä¸­ï¼Œæ€»æœ‰ï¼šä¿¡å·å¤„ç†ï¼Œå˜åŒ–å‡½æ•°ï¼ˆ25å¹´åæ‰è¾¾åˆ°è§£é‡ŠPHPçš„æ°´å¹³ï¼Œè€Œåœ¨æ›¾ç»è“¬å‹ƒå‘å±•çš„Delphiä¸­ï¼Œå®ƒä»¬ä»ç„¶ç¼ºå¤±ï¼‰å’Œå¤§çº¦50ä¸ªå­—ç¬¦ä¸²å‡½æ•°ï¼Œå¦‚</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printfï¼ˆï¼‰</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆ</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mmm</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ... JavaScriptï¼‰ï¼Œ</font><strong><font style="vertical-align: inherit;">strftimeï¼ˆï¼‰</font></strong><font style="vertical-align: inherit;">ï¼ˆ...ï¼‰å’Œ</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">scanfï¼ˆï¼‰</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆæ˜¯å¸¸è§„çš„å»‰ä»·æ›¿ä»£å“ï¼‰ã€‚</font></font></p><br>
<a name="r4"></a><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€ç›´éƒ½æœ‰</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">setjmpï¼ˆï¼‰</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">longjmpï¼ˆï¼‰</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå®ƒå…è®¸æ‚¨å®ç°å…¶ä»–è¯­è¨€ä¸­ç†Ÿæ‚‰çš„å¼‚å¸¸æœºåˆ¶ï¼Œè€Œä¸ä¼šè¶…å‡ºå¯ç§»æ¤Cçš„èŒƒå›´ã€‚</font><font style="vertical-align: inherit;">è¿™é‡Œæ˜¯å…³äºå®ƒä»¬çš„è®¨è®º</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-Quake World</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå †æ ˆï¼Œå¯„å­˜å™¨ï¼Œæ±‡ç¼–å™¨å’Œå…¶ä»–</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç‰©æ–™</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œcherryæ˜¯ä¸€ä¸ªå¥‡æ€ªçš„ç»Ÿè®¡æ•°æ®ï¼ˆ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç ´åè€…</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šVisual Studioå¹¶ä¸æ˜¯æ’å®šçš„ï¼Œå› ä¸ºä¸‰æœˆçš„é‡å…”ï¼Œå¹¶ä¸”</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŠ•å…¥</font></font></strong> <code>saneex.c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">äº†ä¸€åŠçš„æ—¶é—´ï¼‰ã€‚</font></font></p><br>
<img src="https://habrastorage.org/webt/cx/fz/jq/cxfzjqci2ud94mxrbl5bwitnobo.png"><a name="habracut"></a><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éšè—æ–‡å­—</font></font></b><div class="spoiler_text"><p>Â¹  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a>  .</p><br>
<p>Â² ,  . 270 ,   80&nbsp;â€”    .                ,     . <del><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">K&amp;R</a>&nbsp;â€”  , .</del></p><br>
<p>Â³  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">  </a> ,     ANSI  ISO   ,   .    .</p><br>
<p>â´ ,     Â«Â»  TinyURL,     URL         ,  Ñ– .    , -.    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">urlex.org</a>.</p></div></div><br>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç›®å½•ï¼š</font></font></strong></p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">setjmpï¼ˆï¼‰</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font><strong><font style="vertical-align: inherit;">longjmpï¼ˆï¼‰å¦‚ä½•</font></strong><font style="vertical-align: inherit;">å·¥ä½œ</font></font><strong><font style="vertical-align: inherit;"></font></strong></a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯„å­˜å™¨ï¼Œå †æ ˆå’Œæ‰€æœ‰æ‰€æœ‰</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ··æ­å˜é‡ï¼Œæˆ–è€…ç”¨ä¿„è¯­ç ´å</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><strong><font style="vertical-align: inherit;">æŒ¥å‘æ€§</font></strong><font style="vertical-align: inherit;">é¢„é€‰èµ›</font></font><strong><font style="vertical-align: inherit;"></font></strong></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨IRLçš„æ¡ˆä¾‹</font></font></a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ€§èƒ½</font></font></a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æµ‹è¯•ç¯å¢ƒ</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»“æœ</font></font></a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åº†ç¥æ´»åŠ¨çš„ç½ªé­ç¥¸é¦–-saneex.c</font></font></a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…¶ä½™çš„â€œåŠŸèƒ½â€</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> Â« Â»</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">:   </a></li>
</ul></li>
</ul><br>
<p>,   &nbsp;â€” <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">setjmp()</a>/<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">longjmp()</a>,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">setjmp.h</a>,      Â«SJLJÂ» (     ,     ).    C89 ,  -,   ,       (   &nbsp;â€”  ,  &nbsp;â€”  ).</p><br>
<p>   ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> ,   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">zzeng</a>.   , , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"> </a>,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"> </a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"> </a>Â¹, ,   , <del>    </del>       ( ,    ),      .</p><br>
<p>Â¹ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">CException</a>   &nbsp;â€”  60 , ,   ,  ANSI C,     <strong>finally</strong>   ,     .</p><br>
<p>,    &nbsp;â€”   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">  </a>   ,    ,     ,   ,          ,     Â«       Â». (,    ,       -  Â«Â»  ,   <strong>errno</strong>      . &nbsp;â€”   ,   .)</p><br>
<p>     ,  :</p><br>
<ul>
<li>     ,  -    ,             (  ,   &nbsp;â€”   ,  <code>if (error) return -1;</code>)</li>
<li> -     &nbsp;â€”     ,             ,    </li>
</ul><br>
<p>    . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">    </a>,   .</p><br>
<a name="sjlj"></a><br>
<h2 id="kak-rabotayut-setjmplongjmp">  <strong>setjmp()</strong>/<strong>longjmp()</strong></h2><br>
<a name="matan"></a><br>
<h3 id="registry-stek-i-vse-vse-vsehttplibruanekdoty9600txt">,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">--</a></h3><br>
<p>  , <strong>longjmp()</strong>&nbsp;â€”   <strong>goto</strong>,  <strong>setjmp()</strong>&nbsp;â€” <del> </del>     <strong>goto</strong>  run-time. , Â«<strong>goto</strong>  Â». ,    ,  , <strong>goto</strong>,       &nbsp;â€”     ,   <strong>goto</strong>   .       ,   - ,     (  &nbsp;â€”         Â«tryÂ»).</p><br>
<p>,    ,    , ,  <code>setjmp.h</code>   <del>^W</del> ?  ,   <strong>setjmp()</strong>  ,    <strong>  </strong> (,  , ). ,    <del></del>       ,   <del> </del>    ,         .  .</p><br>
<p> , ,     <strong>setjmp()</strong>&nbsp;â€” <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">fork()</a>  POSIX    .  ,      *nixâ€™ API       WinAPI,    &nbsp;â€”      ,       .   &nbsp;â€” Â« ,   ?Â»â€¦   .</p><br>
<a name="r6"></a><br>
<p>,    ,    &nbsp;â€”  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"></a>,      ()    .   &nbsp;â€”   (  Intelâ€™&nbsp;â€” ), &nbsp;â€”  ( Intelâ€™&nbsp;â€” -, ).  : </p><br>
<pre><code class="plaintext hljs">void sub(int s) {<font></font>
  char buf[256];<font></font>
  sub(2);<font></font>
}<font></font>
<font></font>
int main(int m) {<font></font>
  sub(1);<font></font>
}</code></pre><br>
<p>   &nbsp;â€” <strong>tcc</strong> (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Tiny C Compiler</a>)   - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">. </a>. <strong>tcc</strong>             .      <strong>sub()</strong> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"> Intel</a>,    ): </p><br>
<pre><code class="plaintext hljs">sub     esp, 100h       ;     <font></font>
mov     eax, 2          ;  <font></font>
push    eax<font></font>
call    sub_401000      ;  sub()<font></font>
add     esp, 4          ;     (= cdecl)</code></pre><br>
<p>    :</p><br>
<img src="https://habrastorage.org/webt/xt/mz/lc/xtmzlclm6cujy23wvupm7cxmm1k.png"><br>
<p>     &nbsp;â€”      (  Intelâ€¦ ,  ).     <strong>ESP</strong> (<strong>RSP</strong>  x86_64). <strong>setjmp()</strong>    <strong>ESP</strong>/<strong>RSP</strong>,    ,    <strong>jmp_buf</strong>,    .    <strong>longjmp()</strong>    (      )&nbsp;â€”    ,       ,    <strong>setjmp()</strong>,        ().    , Â«undoÂ»   (,   ).</p><br>
<p>   <strong>setjmp()</strong>   <strong>jmp</strong>   <code>FEF8h</code> (<code>FDF0h</code>  ..&nbsp;â€”     )    ,  : </p><br>
<pre><code class="plaintext hljs">void sub(int s) {<font></font>
  char buf[256];<font></font>
  jmp_buf jmp;<font></font>
  setjmp(jmp);<font></font>
  sub(2);<font></font>
}</code></pre><br>
<p>, ,  â„¢:</p><br>
<ul>
<li>    (<strong>setjmp()</strong>  , <strong>longjmp()</strong>  ),  , ,     </li>
<li> ,   <strong>setjmp()</strong>,  ,  Â«Â»   &nbsp;â€”    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">undefined behavior</a> (   )</li>
</ul><br>
<a name="r1"></a><br>
<ul>
<li>     &nbsp;â€” ,  ,  !&nbsp;â€”  , ,     ,  <strong>setjmp()</strong>       ,   <strong>longjmp()</strong>  ,       <strong>setjmp()</strong></li>
</ul><br>
<a name="clob"></a><br>
<h3 id="zatiranie-peremennyh-ili-po-russki-clobbering">  , -, clobbering</h3><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a>  . : </p><br>
<pre><code class="plaintext hljs">#include &lt;stdlib.h&gt;<font></font>
#include &lt;stdio.h&gt;<font></font>
#include &lt;setjmp.h&gt;<font></font>
<font></font>
int main(void) {<font></font>
  int i;<font></font>
  jmp_buf jmp;<font></font>
  i = rand();<font></font>
  if (setjmp(jmp) == 0) {<font></font>
    i = rand();<font></font>
    printf("%d\n", i);<font></font>
    longjmp(jmp, 1);<font></font>
  } else {<font></font>
    printf("%d\n", i);<font></font>
  }<font></font>
}</code></pre><br>
<p> :      ?</p><br>
<p> :    . <del>-!</del></p><br>
<p>,     <strong>gcc</strong>.    <strong>-O0</strong>,    ,       : </p><br>
<pre><code class="plaintext hljs">; int main(void) {<font></font>
  push    ebp             ;  ( stack frame)<font></font>
  mov     ebp, esp        ; EBP     ESP (  )<font></font>
  sub     esp, E0h<font></font>
  ...<font></font>
  call    _rand           ;    EAX<font></font>
  mov     [ebp-D4h], eax  ;  i = rand();  i   (EBP-D4h)<font></font>
  ...<font></font>
; if (... == 0) {         ;  setjmp()      <font></font>
  call    _rand<font></font>
  mov     [ebp-D4h], eax  ;  i = rand();  <font></font>
; printf("%d\n", i);<font></font>
  mov     eax, [ebp-D4h]  ;  i    <font></font>
  mov     esi, eax<font></font>
  lea     edi, format     ;   "%d\n"<font></font>
  mov     eax, 0<font></font>
  call    _printf<font></font>
  ...<font></font>
; } else {                ;    setjmp()  <font></font>
  mov     eax, [ebp-D4h]  ;   i,    <font></font>
  mov     esi, eax<font></font>
  lea     edi, format     ; "%d\n"<font></font>
  mov     eax, 0<font></font>
  call    _printf</code></pre><br>
<p> ,       <strong>i</strong>   (  <code>EBP - D4h</code>).       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a>, :</p><br>
<ul>
<li>   256 <strong>char</strong>   <strong>int</strong>  <strong>jmp_buf</strong>,      4  200  ,  20   -  ,         224  (E0h)  100h,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a></li>
<li><strong>ESP</strong>    <strong>setjmp()</strong>  <code>FFF8h - E0h = FF18h</code> ( <code>FEF8h</code>),      <strong>jmp</strong><br>
<ul>
<li>,   ,     </li>
</ul></li>
<li>   <strong>i</strong>,     <strong>i</strong>   (  <code>FF18h</code>)</li>
<li><strong>longjmp()</strong>      <code>FF18h</code>, ,    <strong>i</strong>     ,  - ,      (<strong>jmp</strong>),   <strong>main()</strong> (  )<br>
<ul>
<li>   <strong>ESP</strong>    ,  <strong>longjmp()</strong>       ,   <strong>main()</strong></li>
</ul></li>
</ul><br>
<p>      <strong>-O1</strong>,   : </p><br>
<pre><code class="plaintext hljs">;   stack frame  ,   ESP <font></font>
  sub     esp, E8h<font></font>
  ...<font></font>
  call    _rand<font></font>
  mov     [esp+E8h-DCh], eax  ; i = rand();  ,    -O0<font></font>
  ...<font></font>
; -O1 - ,   else  , <font></font>
; if (setjmp() == 0) ( - ),  <font></font>
;  ;       <font></font>
; if (... == 0) {<font></font>
  call    _rand<font></font>
  mov     esi, eax            ; !  i  <font></font>
; printf("%d\n", i);<font></font>
  lea     edi, format     ; "%d\n"<font></font>
  mov     eax, 0<font></font>
  call    _printf<font></font>
  ...<font></font>
; } else {<font></font>
  mov     esi, [esp+E8h-DCh]  ; !  i  <font></font>
  lea     edi, format     ; "%d\n"<font></font>
  mov     eax, 0<font></font>
  call    _printf</code></pre><br>
<p>,  <strong>-O1</strong> <strong>gcc</strong>     : </p><br>
<pre><code class="plaintext hljs">test.c:6:11: warning: variable â€˜iâ€™ might be clobbered by â€˜longjmpâ€™ or â€˜vforkâ€™ [-Wclobbered]</code></pre><br>
<p>   ?  <strong>i</strong>   ,     ( <strong>if</strong>) <strong>gcc</strong>,   <strong>i</strong>     <strong>printf()</strong>,      <strong>ESI</strong>,     ( <strong>ESI</strong>     <strong>printf()</strong>, . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ABI, . 22</a>&nbsp;â€” RDI (<strong>format</strong>), RSI (<strong>i</strong>),&nbsp;â€¦). - :</p><br>
<ul>
<li>    <code>ESP + E8h - DCh</code>    <strong>rand()</strong></li>
<li> <strong>ESI</strong>   </li>
<li><strong>printf()</strong> ( )  ()   </li>
<li><strong>longjmp()</strong>   ,     ,         </li>
<li>  <strong>printf()</strong> ( <strong>else</strong>)  ,  ,  ,   <br>
<ul>
<li>       <strong>ESI</strong>,          (,  <strong>printf()</strong>   <strong>longjmp()</strong>)</li>
</ul></li>
</ul><br>
<a name="r2"></a><br>
<p>,      : </p><br>
<pre><code class="plaintext hljs">stack[i] = rand();          // i = rand();   (1)<font></font>
if (setjmp(jmp) == 0) {<font></font>
  ESI = rand();             // i = rand();   (2)<font></font>
  printf("%d\n", ESI);      //   (2)<font></font>
  longjmp(jmp, 1);          // <font></font>
} else {<font></font>
  printf("%d\n", stack[i]); //   (1)<font></font>
  //     :<font></font>
  printf("%d\n", ESI);      //  ,   -<font></font>
                            // "" ( printf()  longjmp())<font></font>
}</code></pre><br>
<div class="spoiler"><b class="spoiler_title"> </b><div class="spoiler_text"><p> ,   ,  <strong>gcc</strong>   <strong>rand()</strong>     <strong>ESI</strong>     (  <strong>-O3</strong>).  <abbr title="StackOverflow.com">SO</abbr> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"></a>,    x86_64 (    )   ,  <strong>EAX</strong>.     ?  ,  <strong>gcc</strong>  <strong>printf()</strong>  <strong>else</strong>  <strong>longjmp()</strong>,     <strong>rand()</strong>   <strong>printf()</strong>&nbsp;â€”   , <strong>i</strong>      .</p><br>
<p>       &nbsp;â€”   .</p></div></div><br>
<a name="vol"></a><br>
<h3 id="kvalifikator-volatile"> <strong>volatile</strong></h3><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> Â« Â»&nbsp;â€”  <strong>volatile</strong> (&nbsp;â€” Â«Â»).        ,     ,  ,    : </p><br>
<pre><code class="plaintext hljs">volatile int i;</code></pre><br>
<p>   <strong>-O1</strong>    <strong>if</strong>: </p><br>
<pre><code class="plaintext hljs">; :<font></font>
  call    _rand<font></font>
  mov     esi, eax<font></font>
; :<font></font>
  call    _rand<font></font>
  mov     [rsp+E8h-DCh], eax<font></font>
  mov     esi, [rsp+E8h-DCh]<font></font>
;    :<font></font>
  call    _rand<font></font>
  mov     esi, eax<font></font>
  mov     [rsp+E8h-DCh], eax</code></pre><br>
<p> ,      (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a>): </p><br>
<pre><code class="plaintext hljs">if (setjmp(jmp) == 0) {<font></font>
  ESI = stack[i] = rand();</code></pre><br>
<a name="irl"></a><br>
<h3 id="sluchai-ispolzovaniya-abbr-titlein-real-lifeirlabbr">  <abbr title="åœ¨çœŸå®ç”Ÿæ´»ä¸­">IRL</abbr></h3><br>
<p>,    &nbsp;â€”             -<strong>volatile</strong>   ,  SJLJ          .        &nbsp;â€”  ,  SJLJ   <del>  </del>  :</p><br>
<ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"></a>        (   &nbsp;â€”     ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">ldir</a>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a>)</li>
<li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">alexkalmuk</a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-     SJLJ</a> (+ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a>),  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">dzeban</a>&nbsp;â€”  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  Linux</a></li>
<li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">   </a> (:     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">Atakua</a>),  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">   x86emu</a> (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">NWOcs</a>)  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> libpng</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">libjpeg-turbo</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"></a>)</li>
<li> 2017 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">Skapix</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  <strong>pthreads</strong></a>,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">kutelev</a>&nbsp;â€”  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">   </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"> </a>,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Symbian</a></li>
<li>  <strong>Quake World</strong>    &nbsp;â€” . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  </a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">PatientZero</a> , , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"></a> (     )</li>
</ul><br>
<p> ,   ,  &nbsp;â€”      ,    Â«  Â»,   ,        ,  -    (). , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  </a>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">DrMefistO</a>.</p><br>
<p>  <strong>Quake World</strong>     <strong>WinMain()</strong>,      <strong>jmp_buf</strong>,       ,    Â« <strong>continue</strong>Â»: </p><br>
<pre><code class="plaintext hljs">// WinQuake/host.c<font></font>
jmp_buf         host_abortserver;<font></font>
<font></font>
void Host_EndGame (char *message, ...)<font></font>
{<font></font>
  ...<font></font>
<font></font>
  if (cls.demonum != -1)<font></font>
    CL_NextDemo ();<font></font>
  else<font></font>
    CL_Disconnect ();<font></font>
<font></font>
  longjmp (host_abortserver, 1);<font></font>
}<font></font>
<font></font>
void Host_Error (char *error, ...)<font></font>
{<font></font>
  ...<font></font>
<font></font>
  if (cls.state == ca_dedicated)<font></font>
    Sys_Error ("Host_Error: %s\n",string);  // dedicated servers exit<font></font>
<font></font>
  CL_Disconnect ();<font></font>
  cls.demonum = -1;<font></font>
<font></font>
  inerror = false;<font></font>
<font></font>
  longjmp (host_abortserver, 1);<font></font>
}<font></font>
<font></font>
void _Host_Frame (float time)<font></font>
{<font></font>
  static double           time1 = 0;<font></font>
  static double           time2 = 0;<font></font>
  static double           time3 = 0;<font></font>
  int                     pass1, pass2, pass3;<font></font>
<font></font>
  if (setjmp (host_abortserver) )<font></font>
    return;                 // something bad happened, or the server disconnected<font></font>
<font></font>
  ...<font></font>
}<font></font>
<font></font>
// QW/client/sys_win.c<font></font>
int WINAPI WinMain (...)<font></font>
{<font></font>
  ...<font></font>
<font></font>
  while (1)<font></font>
  {<font></font>
    ...<font></font>
    newtime = Sys_DoubleTime ();<font></font>
    time = newtime - oldtime;<font></font>
    Host_Frame (time);<font></font>
    oldtime = newtime;<font></font>
  }<font></font>
<font></font>
  /* return success of application */<font></font>
  return TRUE;<font></font>
}</code></pre><br>
<a name="perf"></a><br>
<h2 id="proizvoditelnost"></h2><br>
<p>  ,     &nbsp;â€”     .  ,   <strong>setjmp()</strong>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">glibc</a> ,        .   :</p><br>
<ul>
<li>  ,     ,  SJLJ/<code>saneex.c</code>          </li>
<li> -â€¦- (<del>,    </del>) ,    - &nbsp;â€”     ,     </li>
<li>  ,   &nbsp;â€”   zero-cost exceptions (, , zero-cost <strong>try</strong>),         <strong>try</strong>,        ()&nbsp;â€”       <strong>goto</strong>   , ,   ,     Â«Â» , -,  </li>
</ul><br>
<p>Â«Â» zero-cost exceptions     ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">volatile</a>-,     ,     (      <strong>longjmp()</strong>).   ,         :</p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"> Windows</a>  <abbr title="ç»“æ„åŒ–å¼‚å¸¸å¤„ç†">SEH</abbr>  <abbr title="å‘é‡å¼‚å¸¸å¤„ç†">VEH</abbr>,    XP.</li>
<li> <strong>gcc</strong>    &nbsp;â€”    SJLJ,  DWARF,        (DWARF    <strong>clang</strong>).    .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">zzeng</a>: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a>,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">dwarfstd.org</a>.</li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">nuit</a>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">libunwind</a>,      &nbsp;â€”        ( ).</li>
</ul><br>
<p>,  <code>saneex.c</code>     zero-cost ( &nbsp;â€”  ),     <strong>setjmp()</strong>,   ? ,  ?    &nbsp;â€” .</p><br>
<a name="bench"></a><br>
<h3 id="testovaya-sreda"> </h3><br>
<p>    Â« Â»,   <strong>main()</strong>   100      <strong>try</strong>/<strong>catch</strong>      <strong>throw()</strong>.</p><br>
<p>   C:</p><br>
<pre><code class="plaintext hljs">#include &lt;stdio.h&gt;<font></font>
#include &lt;time.h&gt;<font></font>
#include "saneex.h"<font></font>
<font></font>
int main(void) {<font></font>
  for (int i = 0; i &lt; 100000; i++) {<font></font>
    try {<font></font>
      //  ("" = ):<font></font>
      throw(msgex("A quick fox jumped over a red dog and a nyancat was spawned"));<font></font>
      //  ("" = ):<font></font>
      time(NULL);<font></font>
    } catchall {<font></font>
      fprintf(stderr, "%s\n", curex().message);<font></font>
    } endtry<font></font>
  }<font></font>
}</code></pre><br>
<p>  ++ (    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"></a>,        <code>cerr &lt;&lt;</code>  <strong>fprintf()</strong>):</p><br>
<pre><code class="plaintext hljs">#include &lt;iostream&gt;<font></font>
#include &lt;vector&gt;<font></font>
#include &lt;stdexcept&gt;<font></font>
#include &lt;time.h&gt;<font></font>
<font></font>
int main() {<font></font>
  std::vector&lt;int&gt; vec{ 3, 4, 3, 1 };<font></font>
<font></font>
  for (int i = 0; i &lt; 100000; i++) {<font></font>
    try {<font></font>
      //  ("" = ):<font></font>
      int i{ vec.at(4) };<font></font>
      //  ("" = ):<font></font>
      time(NULL);<font></font>
    }<font></font>
    catch (std::out_of_range &amp; e) {<font></font>
      // &lt;&lt;  fprintf()     25-50%<font></font>
      //std::cerr &lt;&lt; "Accessing a non-existent element: " &lt;&lt; e.what() &lt;&lt; '\n';<font></font>
      fprintf(stderr, "%s\n", e.what());<font></font>
    }<font></font>
    catch (std::exception &amp; e) {<font></font>
      //std::cerr &lt;&lt; "Exception thrown: " &lt;&lt; e.what() &lt;&lt; '\n';<font></font>
      fprintf(stderr, "%s\n", e.what());<font></font>
    }<font></font>
    catch (...) {<font></font>
      //std::cerr &lt;&lt; "Some fatal error\n";<font></font>
      fprintf(stderr, "Some fatal error");<font></font>
    }<font></font>
  }<font></font>
<font></font>
  return 0;<font></font>
}</code></pre><br>
<p>        ( 64-):</p><br>
<ul>
<li>Windows 10 2019 LTSC  PowerShell   <code>Measure-Command { test.exe 2&gt;$null }</code></li>
<li> Live CD <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Ubuntu</a>    <strong>time</strong></li>
</ul><br>
<p>      Windows   <strong>__try</strong>/<strong>__except</strong>,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">   </a>:</p><br>
<pre><code class="plaintext hljs">#include &lt;windows.h&gt;<font></font>
#include &lt;stdio.h&gt;<font></font>
#include &lt;vector&gt;<font></font>
<font></font>
int filterExpression(EXCEPTION_POINTERS* ep) {<font></font>
  ep-&gt;ContextRecord-&gt;Eip += 8;<font></font>
  return EXCEPTION_EXECUTE_HANDLER;<font></font>
}<font></font>
<font></font>
int main() {<font></font>
  static int zero;<font></font>
  for (int i = 0; i &lt; 100000; i++) {<font></font>
    __try {<font></font>
      zero = 1 / zero;<font></font>
      __asm {<font></font>
        nop<font></font>
        nop<font></font>
        nop<font></font>
        nop<font></font>
        nop<font></font>
        nop<font></font>
        nop<font></font>
      }<font></font>
      printf("Past the exception.\n");<font></font>
    }<font></font>
    __except (filterExpression(GetExceptionInformation())) {<font></font>
      printf("Handler called.\n");<font></font>
    }<font></font>
  }<font></font>
}</code></pre><br>
<p>      &nbsp;â€”  , : </p><br>
<pre><code class="plaintext hljs">error C2712: Cannot use __try in functions that require object unwinding</code></pre><br>
<p>          ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a>,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a>.   1100-1300  (Debug  Release, x86)&nbsp;â€” ,     <abbr title="è§†è§‰å·¥ä½œå®¤">VS</abbr>,    ,     g++.</p><br>
<a name="benchres"></a><br>
<h3 id="rezultaty"></h3><br>
<pre><code class="plaintext hljs">â„–                     ()Â¹           saneex <font></font>
<font></font>
1.  VS 2019 v16.0.0   Debug     x64   saneex.c        9713  / 8728  = 1.1    1.8 / 1.8<font></font>
2.  VS 2019 v16.0.0   Debug     x64   saneex.c       95    / 46    = 2      4.5 / 2.3<font></font>
3.  VS 2019 v16.0.0   Debug     x64   C++             5449  / 4750Â² = 1.6<font></font>
4.  VS 2019 v16.0.0   Debug     x64   C++            21    / 20    = 1<font></font>
5.  VS 2019 v16.0.0   Release   x64   saneex.c        8542Â³ / 182   = 47     1.8 / 0.4<font></font>
6.  VS 2019 v16.0.0   Release   x64   saneex.c       80Â³   / 23    = 3.5    8   / 1.8<font></font>
7.  VS 2019 v16.0.0   Release   x64   C++             4669Â³ / 420   = 11<font></font>
8.  VS 2019 v16.0.0   Release   x64   C++            10Â³   / 13    = 0.8<font></font>
9.  gcc 9.2.1         -O0       x64   saneex.c        71    / 351   = 0.2    0.2 / 0.6<font></font>
10. gcc 9.2.1         -O0       x64   saneex.c       6     / 39    = 0.2    1.5 / 1.1<font></font>
11. g++ 9.2.1         -O0       x64   C++             378   / 630   = 0.6<font></font>
12. g++ 9.2.1         -O0       x64   C++            4     / 37    = 0.1<font></font>
13. gcc 9.2.1         -O3       x64   saneex.c        66    / 360   = 0.2    0.2 / 0.6<font></font>
14. gcc 9.2.1         -O3       x64   saneex.c       5     / 23    = 0.2    1   / 0.6<font></font>
15. g++ 9.2.1         -O3       x64   C++             356   / 605   = 0.6<font></font>
16. g++ 9.2.1         -O3       x64   C++            5     / 38    = 0.1</code></pre><br>
<div class="spoiler"><b class="spoiler_title"> </b><div class="spoiler_text"><p>Â¹   <strong></strong>       Windows 7 SP1 x64  VS 2017 v15.9.17  gcc  cygwin.</p><br>
<p>Â²   :  <strong>fprintf()</strong>   <code>cerr &lt;&lt;</code>,    <strong></strong>  3 : 1386/1527 .</p><br>
<p>Â³ VS          ,        .</p></div></div><br>
<p> â€¦ :</p><br>
<ul>
<li>      /    Â«Â» VS.   &nbsp;â€” .</li>
<li> <code>cerr &lt;&lt;</code>  <strong>fprintf()</strong>       VS       3-4  ( 3). <abbr title="æˆ‘ç©¶ç«Ÿåšé”™äº†ä»€ä¹ˆ"></abbr>?</li>
<li>      <strong>try</strong>   <strong>throw</strong>&nbsp;â€”  (4-28   100  ).</li>
<li>  Â«Â» Debug  VS,    <code>saneex.c</code> ,      ( 2.3   VS,  5   <strong>gcc</strong>/g++),  <strong>try</strong>  <strong>throw</strong>&nbsp;â€” ,      .   !</li>
</ul><br>
<p>   â€¦    .    !</p><br>
<p>    use-case&nbsp;â€”    <strong>try</strong>    <strong>throw</strong> (Â« ,  Â»),        <strong>setjmp()</strong>,   ,   ,    ,   .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">  </a>,      ,    <strong>setjmp()</strong>       OpenBSD   (1.45)&nbsp;â€”  Solaris.     2005 .  Â«Â»&nbsp;â€”     ,      .</p><br>
<p>,  â€¦</p><br>
<a name="saneex"></a><br>
<h2 id="vinovnik-torzhestva-saneexc"> &nbsp;â€” <code>saneex.c</code></h2><br>
<p>,     <abbr title="å›¾ç‰‡å¸å¼•æ³¨æ„"></abbr>:</p><br>
<ul>
<li>    Visual Studio</li>
<li>   , <strong>throw()</strong>   , <strong>finally</strong>   <strong>catch</strong>   (  )</li>
<li>       (  <strong>static</strong>)</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a>- (<strong>__thread</strong>/<strong>_Thread_local</strong>)</li>
<li> public domain (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">CC0</a>)</li>
</ul><br>
<a name="r5"></a><br>
<p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">    GitHub</a>.       ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a>.    <code>saneex-demo.c</code>  : </p><br>
<pre><code class="plaintext hljs">01.    #include &lt;stdio.h&gt;<font></font>
02.    #include "saneex.h"<font></font>
03.<font></font>
04.    int main(void) {<font></font>
05.      sxTag = "SaneC's Exceptions Demo";<font></font>
06.<font></font>
07.      try {<font></font>
08.        printf("Enter a message to fail with: [] [1] [2] [!] ");<font></font>
09.<font></font>
10.        char msg[50];<font></font>
11.        thrif(!fgets(msg, sizeof(msg), stdin), "fgets() error");<font></font>
12.<font></font>
13.        int i = strlen(msg) - 1;<font></font>
14.        while (i &gt;= 0 &amp;&amp; msg[i] &lt;= ' ') { msg[i--] = 0; }<font></font>
15.<font></font>
16.        if (msg[0]) {<font></font>
17.          errno = atoi(msg);<font></font>
18.          struct SxTraceEntry e = newex();<font></font>
19.          e = sxprintf(e, "Your message: %s", msg);<font></font>
20.          e.uncatchable = msg[0] == '!';<font></font>
21.          throw(e);<font></font>
22.        }<font></font>
23.<font></font>
24.        puts("End of try body");<font></font>
25.<font></font>
26.      } catch (1) {<font></font>
27.        puts("Caught in catch (1)");<font></font>
28.        sxPrintTrace();<font></font>
29.<font></font>
30.      } catch (2) {<font></font>
31.        puts("Caught in catch (2)");<font></font>
32.        errno = 123;<font></font>
33.        rethrow(msgex("calling rethrow() with code 123"));<font></font>
34.<font></font>
35.      } catchall {<font></font>
36.        printf("Caught in catchall, message is: %s\n", curex().message);<font></font>
37.<font></font>
38.      } finally {<font></font>
39.        puts("Now in finally");<font></font>
40.<font></font>
41.      } endtry<font></font>
42.<font></font>
43.      puts("End of main()");<font></font>
44.    }</code></pre><br>
<p>   ,          :</p><br>
<ul>
<li>   &nbsp;â€”    ,   : </li>
</ul><br>
<pre><code class="plaintext hljs">End of try body<font></font>
Now in finally<font></font>
End of main()</code></pre><br>
<ul>
<li>  ,   ,        (<strong>1</strong>),       <code>catch (1)</code> (26.),    : </li>
</ul><br>
<pre><code class="plaintext hljs">Caught in catch (1)<font></font>
Your message: 1 hello, habr!<font></font>
    ...at saneex-demo.c:18, code 1<font></font>
Now in finally<font></font>
End of main()</code></pre><br>
<ul>
<li>  ,     (30.),   (  ,   )       (33.),       : </li>
</ul><br>
<pre><code class="plaintext hljs">Caught in catch (2)<font></font>
Now in finally<font></font>
<font></font>
Uncaught exception (code 123) - terminating. Tag: SaneC's Exceptions Demo<font></font>
Your message: 2 TM! kak tam blok4ain?<font></font>
    ...at saneex-demo.c:18, code 2<font></font>
calling rethrow() with code 123<font></font>
    ...at saneex-demo.c:33, code 123<font></font>
rethrown by ENDTRY<font></font>
    ...at saneex-demo.c:41, code 123</code></pre><br>
<ul>
<li>  <code>!</code>,    Â«Â» (<strong>uncatchable</strong>; 20.)&nbsp;â€”      <strong>try</strong>   ,    ( <strong>catch</strong>,   <strong>finally</strong>),         &nbsp;â€”   <strong>abort()</strong>: </li>
</ul><br>
<pre><code class="plaintext hljs">Caught in catch (1)<font></font>
Your message: ! it is a good day to die<font></font>
    ...UNCATCHABLE at saneex-demo.c:18, code 0<font></font>
Now in finally<font></font>
<font></font>
Uncaught exception (code 0) - terminating. Tag: SaneC's Exceptions Demo<font></font>
Your message: ! it is a good day to die<font></font>
    ...UNCATCHABLE at saneex-demo.c:18, code 0<font></font>
UNCATCHABLE rethrown by ENDTRY<font></font>
    ...at saneex-demo.c:41, code 0</code></pre><br>
<ul>
<li>,   ,     <strong>catchall</strong> (35.),      : </li>
</ul><br>
<pre><code class="plaintext hljs">Caught in catchall, message is: Your message: 3 we need more gold<font></font>
Now in finally<font></font>
End of main()</code></pre><br>
<a name="sexfeat"></a><br>
<h3 id="ostalnye-fichi"> Â«Â»</h3><br>
<a name="sexmt"></a><br>
<p><strong>.</strong>    ,       ( MSVCÂ¹),  C11             (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">TLS</a>): </p><br>
<pre><code class="plaintext hljs">#define SX_THREAD_LOCAL _Thread_local</code></pre><br>
<p>Â¹    Microsoft <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">-</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"></a>   open source,  <del> </del> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"></a>  ,   ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">8  </a>,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"> </a>.</p><br>
<p><strong>sxTag</strong> (05.)&nbsp;â€” ,        <strong>stderr</strong>.  &nbsp;â€”     (<strong>__DATE__</strong> <strong>__TIME__</strong>).</p><br>
<p><strong> SxTraceEntry</strong> (  stack trace).    &nbsp;â€”   <code>(struct SxTraceEntry) {...}</code>:</p><br>
<ul>
<li><code>newex()</code>&nbsp;â€”    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a>;  <strong>__FILE__</strong>, <strong>__LINE__</strong>    = <strong>errno</strong> (       ,     <strong>fgets()</strong>; 11.)<br>
<ul>
<li>  1  1 ( <strong>setjmp()</strong>  0    ),  <code>catch (0)</code>   </li>
</ul></li>
<li><code>msgex(m)</code>&nbsp;â€”  <strong>newex()</strong>,      ( )</li>
<li><code>exex(m, e)</code>&nbsp;â€”  <strong>msgex()</strong>,       ;      <strong>free()</strong> : </li>
</ul><br>
<pre><code class="plaintext hljs">try {<font></font>
  TimeoutException *e = malloc(sizeof(*e));<font></font>
  e-&gt;elapsed = timeElapsed;<font></font>
  e-&gt;limit = MAX_TIMEOUT;<font></font>
  errno = 146;<font></font>
  throw(exex("Connection timed out", e));<font></font>
} catch (146) {<font></font>
  printf("%s after %d\n", curex().message,<font></font>
    //   void *SxTraceEntry.extra:<font></font>
    ((TimeoutException *) curex().extra)-&gt;elapsed);<font></font>
} endtry</code></pre><br>
<p>, ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">designated initializers</a>     C99 (  Visual Studio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">2013+</a>): </p><br>
<pre><code class="plaintext hljs">throw( (struct SxTraceEntry) {.message = "kaboom!"} );</code></pre><br>
<p><strong> :</strong></p><br>
<ul>
<li><code>throw(e)</code>&nbsp;â€”   <strong>SxTraceEntry</strong></li>
<li><code>rethrow(e)</code>&nbsp;â€”  <strong>throw()</strong>,     stack trace;     <strong>catch</strong>/<strong>catchall</strong></li>
<li><code>thrif(x, m)</code>&nbsp;â€” ;  <code>if (x)</code>  <strong>SxTraceEntry</strong>   <strong>x</strong> + <strong>m</strong>  Â«Â» </li>
<li><code>thri(x)</code>&nbsp;â€”  <strong>thrif()</strong>,    <strong>m</strong></li>
</ul><br>
<p>    Â«Â»      &nbsp;â€”   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a>  <strong>fgets()</strong> (11.),      .   <strong>fgets()</strong>      (    <abbr title="æ–‡ä»¶ç»“æŸ">EOF</abbr>: <code>./a.out &lt;/dev/null</code>),         .   :</p><br>
<pre><code class="plaintext hljs">thri(read(0xBaaD, buf, nbyte));<font></font>
// errno = 9, "Bad file descriptor"<font></font>
// Assertion error: read(0xBaaD, buf, nbyte);</code></pre><br>
<a name="sexpit"></a><br>
<h3 id="i-osobennosti-realizacii">â€¦ Â« Â»</h3><br>
<p>     (  !):</p><br>
<ul>
<li>    <strong>endtry</strong>&nbsp;â€”        ( <strong>try</strong>)   <br>
<ul>
<li>  ,  , ,  <strong>try</strong>   <code>{</code>,  <strong>endtry</strong>  </li>
</ul></li>
<li><strong>  return  try  endtry</strong>&nbsp;â€”    ,         ;    <abbr title="æ‹‰å–è¦æ±‚">PR</abbr><br>
<ul>
<li>, <strong>goto</strong>      ,    - ? <code>&lt;/sarcasm&gt;</code></li>
</ul></li>
</ul><br>
<p>  Â«Â»,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a> <strong>volatile</strong>. Â«Â» &nbsp;â€”       (. <strong>longjmp()</strong>), ,        <strong>try</strong>,        <strong>catch</strong>/<strong>catchall</strong>/<strong>finally</strong>   <strong>endtry</strong>,      <strong>volatile</strong>.      .   : </p><br>
<pre><code class="plaintext hljs">int foo = 1;<font></font>
try {<font></font>
  foo = 2;<font></font>
  //    foo<font></font>
} catchall {<font></font>
  //    !<font></font>
} finally {<font></font>
  //   !<font></font>
} endtry<font></font>
//   !</code></pre><br>
<p> <strong>volatile</strong>     : </p><br>
<pre><code class="plaintext hljs">volatile int foo = 1;<font></font>
try {<font></font>
  ...</code></pre><br>
<a name="sexside"></a><br>
<h3 id="itog-kak-eto-rabotaet">:   </h3><br>
<p>     - () :</p><br>
<ul>
<li><code>struct SxTryContext</code>&nbsp;â€”    <strong>try</strong>,     &nbsp;â€”  , <strong>jmp_buf</strong>    ; ,   : </li>
</ul><br>
<pre><code class="plaintext hljs">try {<font></font>
  try {<font></font>
    //  <font></font>
  } endtry<font></font>
} endtry</code></pre><br>
<ul>
<li><code>struct SxTraceEntry</code>&nbsp;â€”  stack trace,   ,      ;      ,   <strong>try</strong>: </li>
</ul><br>
<pre><code class="plaintext hljs">try {         //  SxTryContext<font></font>
  try {       //  SxTryContext<font></font>
              //  SxTraceEntry<font></font>
    throw(msgex(" !"));<font></font>
              //  SxTraceEntry<font></font>
  } catchall {<font></font>
              //  SxTraceEntry<font></font>
    rethrow(msgex("   !"));<font></font>
              //  SxTraceEntry (*)<font></font>
  } endtry<font></font>
} endtry</code></pre><br>
<p>     <strong>rethrow()</strong>  <strong>throw()</strong>,   <strong>SxTraceEntry</strong> <code>(*)</code>   ,  &nbsp;â€”    (stack trace  ).  ,        <code>sxAddTraceEntry(e)</code>.</p><br>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">try</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œå…¶ä»–ç»“æ„å…ƒç´ æ˜¯å®ï¼ˆ-æ‚¨çš„</font></font><abbr title="é˜Ÿé•¿æ˜æ˜¾"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">K.O.</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ã€‚</font></font><code>{ }</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åé¢çš„</font><font style="vertical-align: inherit;">æ‹¬å·</font><font style="vertical-align: inherit;">æ˜¯å¯é€‰çš„ã€‚</font><font style="vertical-align: inherit;">æœ€åï¼Œä¸€åˆ‡éƒ½å½’ç»“ä¸ºä»¥ä¸‹ä¼ªä»£ç ï¼š</font></font></p><br>
<pre><code class="plaintext hljs">try {                             int _sxLastJumpCode = setjmp(add_context()Â¹);<font></font>
                                  bool handled = false;<font></font>
                                  if (_sxLastJumpCode == 0) {<font></font>
  throw(msgex("Mama mia!"));        clearTrace();<font></font>
                                    sxAddTraceEntry(msgex(...));<font></font>
                                    if (count_contexts() == 0) {<font></font>
                                      fprintf(stderr, "Shurik, vs propalo!");<font></font>
                                      sxPrintTrace();<font></font>
                                      exit(curex().code);<font></font>
                                    } else {<font></font>
                                      longjmp(top_context());<font></font>
                                    }<font></font>
} catch (9000) {                  } else if (_sxLastJumpCode == 9000) {<font></font>
                                    handled = true;<font></font>
} catchall {                      } else {<font></font>
                                    handled = true;<font></font>
} finally {                       }<font></font>
                                  //    finally { }<font></font>
} endtry                          remove_context();<font></font>
                                  if (!handled) {<font></font>
                                    //    throw()<font></font>
                                  }</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Â¹å¸¦</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„åç§°</font><font style="vertical-align: inherit;">æœªåœ¨åº“ä¸­ä½¿ç”¨ï¼Œå®ƒä»¬æ˜¯æŠ½è±¡çš„ã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘è®¤ä¸ºï¼Œåœ¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SJLJçš„å·¥ä½œåŸç†</font><font style="vertical-align: inherit;">è¿›è¡Œ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">è¯¦ç»†è¯´æ˜</font></a><font style="vertical-align: inherit;">ä¹‹å</font><font style="vertical-align: inherit;">ï¼Œè¿™é‡Œä¸éœ€è¦è¯„è®ºå…¶ä»–å†…å®¹ï¼Œå› æ­¤ï¼Œè®©æˆ‘è¯·æ‚¨å‘è¨€ã€‚</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN491054/index.html">å¦‚ä½•ä½¿ç”¨PKCSï¼ƒ11ä»¤ç‰Œä¸GPGå¯†é’¥ç­¾ç½²ç”µå­é‚®ä»¶é€šä¿¡</a></li>
<li><a href="../zh-CN491056/index.html">Ampere Altra-ä¸–ç•Œä¸Šç¬¬ä¸€ä¸ª80æ ¸ARMå¤„ç†å™¨</a></li>
<li><a href="../zh-CN491058/index.html">æ­»äº¡ç‡ï¼Œæ­»äº¡ç‡ï¼Œå† çŠ¶ç—…æ¯’å’Œmatan</a></li>
<li><a href="../zh-CN491062/index.html">Angularï¼šåˆ›å»ºè‡ªå®šä¹‰è¡¨å•å…ƒç´ å¹¶å°†è¡¨å•çŠ¶æ€ä¼ é€’ç»™å®ƒ</a></li>
<li><a href="../zh-CN491076/index.html">åœ¨NestJSä¸­å·§å¦™åœ°ä½¿ç”¨RabbitMQ</a></li>
<li><a href="../zh-CN491086/index.html">Webix JavaScriptåº“é€šè¿‡åˆå­¦è€…çš„çœ¼å…‰ã€‚ç¬¬6éƒ¨åˆ†ã€‚æœåŠ¡å™¨äº¤äº’</a></li>
<li><a href="../zh-CN491088/index.html">GitHubï¼šOSINTçš„æ–°å¼€æºåº“</a></li>
<li><a href="../zh-CN491090/index.html">åœ¨Cï¼ƒä¸­å°†æ–‡æœ¬æ–‡æ¡£è½¬æ¢ä¸ºxml</a></li>
<li><a href="../zh-CN491092/index.html">Bandicootå¦‚ä½•å´©æºƒå¯¼è‡´Playstationå´©æºƒ</a></li>
<li><a href="../zh-CN491094/index.html">åœ¨ç°ä»£Linuxç‰ˆæœ¬ä¸Šå®‰è£…Firebird 3ï¼šCentOS8å’ŒUbuntu 19</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>