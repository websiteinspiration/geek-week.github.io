<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎃 👆🏽 👩🏼‍🔧 DBMSでの単体テスト-Sportmasterでそれを行う方法、パート1 🕤 ⛲️ 🥟</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="こんにちは、ハブル！
 
 私の名前はマキシムポノマレンコで、スポーツマスターの開発者です。 IT分野で10年の経験があります。彼はキャリアを手動テストから始め、その後データベース開発に切り替えました。過去4年間、テストと開発で得た知識を蓄積し、DBMSレベルでのテスト自動化に携わってきました。
 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>DBMSでの単体テスト-Sportmasterでそれを行う方法、パート1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sportmaster_lab/blog/464335/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こんにちは、ハブル！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の名前はマキシムポノマレンコで、スポーツマスターの開発者です。 IT分野で10年の経験があります。彼はキャリアを手動テストから始め、その後データベース開発に切り替えました。過去4年間、テストと開発で得た知識を蓄積し、DBMSレベルでのテスト自動化に携わってきました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は1年以上スポーツマスターチームに所属しており、主要なプロジェクトの1つで自動テストの開発に従事しています。 4月に、Sportmaster Labの皆さんとクラスノダールでの会議で話しました。私のレポートは、DBMSのユニットテストと呼ばれていました。今、それを皆さんと共有したいと思います。テキストがたくさんあるので、レポートを2つの投稿に分割することにしました。最初のセクションでは、自動テストとテスト全般について説明し、2番目のセクションでは、ユニットテストシステムとその適用結果について詳しく説明します。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/3_/bq/ny/3_bqnyzzwyxryj57cjiswfqguva.png"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初は少しつまらない理論。自動テストとは何ですか？これはソフトウェアによって実行されるテストであり、最近のITではソフトウェア開発でますます使用されています。これは、企業が成長し、情報システムが成長しているため、テストする必要のある機能の量が増えているためです。手動テストの実施はますます高価になっています。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は1つの大企業で働いていました。同時に、1か月で12人のテスターが手で機能を確認しました。開発者の小さなチームによる自動化の導入のおかげで、テスト時間を1年半で2週間に減らすことができました。テストの速度だけでなく、品質も向上させました。自動テストは定期的に実行され、常にそれらに固有のテストの全コースを完了します。つまり、人的要因を除外します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現代のITの特徴は、開発者は製品コードを記述するだけでなく、このコードを検証する単体テストを記述する必要があるということです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、システムが主にサーバーロジックに基づいている場合はどうでしょうか。</font><font style="vertical-align: inherit;">市場には、ワンストップソリューションやベストプラクティスはありません。</font><font style="vertical-align: inherit;">原則として、企業は独自の自己記述型テストシステムを作成することでこの問題を解決します。</font><font style="vertical-align: inherit;">このような独自の自動作成自動テストシステムは私たちのプロジェクトで作成されたものであり、レポートで説明します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wy/aa/c-/wyaac--1ljrnkedj_vuu9g6g2x8.png" width="900"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">忠誠心のテスト</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初に、自動テストシステムを展開したプロジェクトについて説明します。</font><font style="vertical-align: inherit;">私たちのプロジェクトはSportmasterのロイヤルティシステムです（ちなみに、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクトについてはすでに</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">この投稿で説明しています</font></a><font style="vertical-align: inherit;">）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
会社が十分に大きい場合、ロイヤルティシステムには3つの標準プロパティがあります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">システムに大きな負荷がかかります。</font></font></li>
<li>      </li>
<li>    . </li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
順番に行きましょう。 Sportmasterは活発に販売している多くの店を持っています。当然、ポイントシステムは負荷の高いシステムです。また、プロジェクトが積極的に使用されているため、ソフトウェアの間違いは多額の金銭、評判、その他の損失であるため、最高の品質基準を提供する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同時に、Sportmasterでは100を超えるさまざまなプロモーションが機能しています。シェアは非常に異なります。商品のもの、曜日の時間指定、特定の店舗に関連付けられているもの、小切手の金額のシェア、商品の数などがあります。一般的に、弱くない。顧客にはボーナスがあります。ショッピングの際に使用されるプロモーションコードがあります。これはすべて、次数の計算が非常に重要なタスクであるという事実につながります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注文処理を実装するアルゴリズムは本当にひどくて複雑です。そして、このアルゴリズムへの変更はかなり危険なことです。最も外側のマイナーな変更があり、予測できない影響をもたらす可能性があるようです。しかし、それはまさにこのような複雑な計算プロセスであり、自動化の最良の候補である重要な機能を実装しているだけではありません。同じタイプの数十のケースを手で確認するのは非常に時間がかかります。また、プロセスのエントリポイントは変更されていないため、一度説明すると、自動テストにすばやくスタンプを押して、機能を確認できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちのシステムは積極的に使用されているため、ビジネスはあなたに何か新しいものを求め、最新の状態に保ち、顧客志向になるでしょう。ロイヤルティシステムでは、リリースは2か月ごとにリリースされます。したがって、2か月ごとにシステム全体の完全な回帰を実行する必要があります。同時に、もちろん、他の最新のITのように、開発はすぐに開発者から本番に移行しません。それは開発者の回路で発生し、テストベンチ、リリース、受け入れに順次合格し、それから初めて本番稼働になります。少なくともテストおよびリリース回路では、システム全体の完全な回帰を実行する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
説明されているプロパティは、ほとんどすべてのポイントシステムの標準です。私たちのプロジェクトの特徴について話しましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
技術的には、ロイヤリティシステムのロジックの90％はサーバーベースであり、Oracleに実装されています。 Delphiには公開されたクライアントがあり、AWP管理者の機能を実行します。外部アプリケーション（Webサイトなど）用の公開されたWebサービスがあります。したがって、自動テストシステムを導入する場合、Oracleでそれを実行することは非常に論理的です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sportmasterのロイヤルティシステムは7年以上存在し、1人の開発者によって作成されました...この7年間のプロジェクトの平均開発者数は3〜4人でした。しかし、昨年、私たちのチームは大幅に成長し、現在10人がプロジェクトに取り組んでいます。つまり、一般的なタスク、プロセス、アーキテクチャに慣れていない人がプロジェクトに参加します。また、エラーをスキップするリスクが高まります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このプロジェクトの特徴は、スタッフユニットとして専任のテスターがいないことです。テストはもちろんですが、アナリストは他の主要な責任に加えて、テストに従事しています：ビジネス顧客、ユーザーとのコミュニケーション、システム要件の検討など。 etc ...テストは非常に定性的に行われるという事実にもかかわらず（アナリストの1人がこのレポートの目を引く可能性があるため、これは特に言及するのに適切です）、1つの事柄に対する専門化と集中の効果を取り消す人はいません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記のすべてを考慮すると、発行された製品の品質を向上させ、開発時間を短縮するために、プロジェクトで自動化をテストするという考えは非常に論理的であるように見えます。</font><font style="vertical-align: inherit;">また、ポイントシステムの存在のさまざまな段階で、個々の開発者はコードを単体テストでカバーするように努力しました。</font><font style="vertical-align: inherit;">それは一般に、誰もがアーキテクチャと方法を使用する、かなり異なるプロセスでした。</font><font style="vertical-align: inherit;">単一の結果は単体テストに共通でした。テストは開発され、しばらく使用され、バージョン管理されたファイルストレージにスタックされましたが、ある時点で開始が停止し、忘れられました。</font><font style="vertical-align: inherit;">これは主に、テストがプロジェクトではなく特定の実行者に結び付けられていたためです。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UtPLSQLが助けになります</font></font></h2><br>
<img src="https://habrastorage.org/webt/o-/l4/60/o-l460kfyehubgizartw4soydlo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Stephen Feuersteinについて何か知っていますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、彼のキャリアの長い部分をOracleとPL / SQLでの作業に費やした賢い人であり、この主題についてかなり多くの作品を書いています。彼の有名な本の1つが「Oracle PL / SQL」です。専門家向け。」 utPLSQLソリューションの開発を担当しているのはStevenです。つまり、Oracle PL / SQLの単体テストフレームワークです。 utPLSQLソリューションは2016年に作成されましたが、積極的に取り組み、新しいバージョンをリリースしています。報告時点での最新版の日付は、2019年3月24日です。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それは何ですか。これは別のオープンソースプロジェクトです。例とドキュメントを考慮に入れると、数メガバイトの重さがあります。物理的には、単体テストを整理するための一連のパッケージとテーブルを備えたORACLEデータベースの個別のスキームです。インストールには数秒かかります。 utPLSQLの特徴は、使いやすさです。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
全体的に、utPLSQLはユニットテストを実行するためのメカニズムであり、ユニットテストは通常​​のOracleバッチプロシージャを参照し、その編成は特定のルールに従います。起動に加えて、utPLSQLはすべてのテスト実行のログを保存し、内部レポートシステムもあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この手法で実装された単体テストコードの例を見てみましょう。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ko/kr/jg/kokrjgtp4wb348t3wkbm9bryjnc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、画面には単体テストを含むパッケージの標準仕様のコードが表示されます。必要な要件は何ですか？パッケージには接頭辞utp_が必要です。テストを使用するすべてのプロシージャには、まったく同じプレフィックスを付ける必要があります。パッケージには、「utp_setup」と「utp_teardown」の2つの標準プロシージャが含まれている必要があります。最初の手順は、各ユニットテストを再起動することによって呼び出され、2番目の手順は開始後に呼び出されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「Utp_setup」は、原則として、ユニットテストを実行するためにシステムを準備します。たとえば、テストデータを作成します。 「Utp_teardown」-逆に、すべてが元の設定に戻り、起動結果がリセットされます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
入力した顧客の電話番号が、ロイヤルティシステムの標準的な外観に正規化されているかどうかをチェックする最も単純な単体テストの例を次に示します。単体テストで手順を記述するための必須の標準はありません。原則として、テスト中のシステムのメソッドが呼び出され、このメソッドによって返された結果が参照の結果と比較されます。参照結果と結果の比較は、標準のutPLSQLメソッドを使用して行うことが重要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
単体テストには、チェックをいくつでも含めることができます。例からわかるように、テスト済みのメソッドを4回連続して呼び出して電話番号を正規化し、各呼び出しの後に結果を評価します。単体テストを開発するときは、システムにまったく影響を与えないチェックがあることを考慮に入れる必要があり、しばらくすると、システムの初期状態にロールバックする必要があります。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、提示された単体テストでは、入力電話番号をフォーマットするだけで、ロイヤルティシステムに影響を与えません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、新しいクライアントを作成する方法を使用して単体テストを作成すると、各チェックの後にシステムに新しいクライアントが作成され、テストのその後の起動に影響する可能性があります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wy/q7/p9/wyq7p9dwwjh_ir0kq2uxc8xutsy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、単体テストの実行方法です。</font><font style="vertical-align: inherit;">2つの可能な起動オプションがあります。特定のパッケージからすべての単体テストを開始するか、特定のパッケージで特定の単体テストを開始します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yd/a9/jm/yda9jm5ob7kcvcsjz9p_tplnvyo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは内部報告システムの例です。</font><font style="vertical-align: inherit;">単体テストの結果によると、utPLSQLは小さなレポートを作成します。</font><font style="vertical-align: inherit;">その中に、特定の各テストの結果と単体テストの全体的な結果が表示されます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自動テストの6つのルール</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ポイントシステムの自動テスト用の新しいシステムの作成を開始する前に、経営陣とともに、将来の自動テストが準拠すべき原則を決定しました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/c_/tn/wg/c_tnwghfmcumhbuoq_q8osnv5wc.png"><br>
<br>
<ol>
<li>       .    ,     ,  -      ,     .          ,     .     .    ,      ,      ,     .      -  ,     .</li>
<li>  .          ,     .   ,     .</li>
<li>   .     ,      ,          .  ,   ,           .</li>
<li>        .       . -      ,  -    .        ,    .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自動テストの開発は柔軟でなければなりません。</font><font style="vertical-align: inherit;">まだ機能していない、または他の確信があるために、機能のテストを拒否することは望ましくありません。</font><font style="vertical-align: inherit;">utPLSQLは開発の制限を課さず、Oracleは原則として、さまざまなものを実装できます。</font><font style="vertical-align: inherit;">ほとんどのタスクには解決策があり、唯一の問題は時間と労力です。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">展開可能性。</font><font style="vertical-align: inherit;">テストを実行する必要があるスタンドがいくつかあります。</font><font style="vertical-align: inherit;">各スタンドでは、データダンプをいつでも更新できます。</font><font style="vertical-align: inherit;">完全または部分的なインストールを簡単に実行できるように、自動テストを使用してプロジェクトを実施する必要があります。</font></font></li>
</ol><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして数日後の2番目の投稿では、私たちが何をしたか、そしてどのような結果が達成されたかをお伝えします。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja464315/index.html">土の入ったフィルム。Yandexの研究と意味による検索の簡単な歴史</a></li>
<li><a href="../ja464317/index.html">こんばんわプロジェクト</a></li>
<li><a href="../ja464327/index.html">さまざまなツールキットGUIのメモリ使用量の比較</a></li>
<li><a href="../ja464331/index.html">役に立たない利点：カシューナッツからの紫外線吸収化学物質の合成</a></li>
<li><a href="../ja464333/index.html">ペンチやテープなしでユーザーのライフサイクルを追跡</a></li>
<li><a href="../ja464337/index.html">captchaをバイパスする方法：Tensorflow、Keras、python v数値ノイズの多いcaptchaのニューラルネットワーク</a></li>
<li><a href="../ja464345/index.html">ドイツにITスタートアップを設立する5つの理由</a></li>
<li><a href="../ja464347/index.html">依存性注入、JavaScript、およびES6モジュール</a></li>
<li><a href="../ja464351/index.html">PoE IPカメラ、特別な要件、トラブルのない操作-すべてをまとめる</a></li>
<li><a href="../ja464353/index.html">1C：ERP VS 1C：KA 2.0。食品メーカーは何を選択すべきですか？</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>