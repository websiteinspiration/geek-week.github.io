<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§¥üèæ üëÉüèæ üíÉüèø √Ä propos du cluster de serveurs 1C ‚¨ÖÔ∏è ü§∑ üêà</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Un cluster est un type de syst√®me parall√®le 
 ou distribu√© qui: 
 1. se compose de plusieurs 
 ordinateurs interconnect√©s ; 
 2. Utilis√© comme une 
 r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>√Ä propos du cluster de serveurs 1C</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/1c/blog/493008/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un cluster est un type de syst√®me parall√®le </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ou distribu√© qui: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. se compose de plusieurs </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ordinateurs </font><font style="vertical-align: inherit;">interconnect√©s </font><font style="vertical-align: inherit;">; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. Utilis√© comme une </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ressource informatique </font><font style="vertical-align: inherit;">unique et </font><font style="vertical-align: inherit;">unifi√©e </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gregory F. Pfister, ¬´A la recherche de clusters¬ª. </font></font></a></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âtant donn√©:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> il existe une application m√©tier (par exemple, un syst√®me ERP) avec laquelle des milliers (voire des dizaines de milliers) d'utilisateurs travaillent simultan√©ment. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C'est requis:</font></font></b><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rendre l'application √©volutive, de sorte qu'avec une augmentation du nombre d'utilisateurs, il est possible en raison de l'augmentation des ressources mat√©rielles de fournir les performances d'application n√©cessaires.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rendre l'application r√©sistante √† la d√©faillance des composants du syst√®me (logiciels et mat√©riels), √† la perte de connexion entre les composants et √† d'autres probl√®mes possibles.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilisez les ressources syst√®me aussi efficacement que possible et fournissez les performances d'application souhait√©es.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rendez le syst√®me facile √† d√©ployer et √† administrer.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour r√©soudre ces probl√®mes, nous utilisons l'architecture de cluster dans la plateforme 1C: Enterprise. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous n'avons pas imm√©diatement atteint le r√©sultat souhait√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet article, nous parlerons du type de clusters, de la fa√ßon dont nous avons choisi le type de cluster qui nous convient et de l'√©volution de notre cluster d'une version √† l'autre, et des approches qui nous ont finalement permis de cr√©er un syst√®me qui dessert des </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dizaines de </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">milliers d'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilisateurs simultan√©s.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0g/mo/rq/0gmorqiise6fvaouym5mwpabl7y.png" alt="image"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme Gregory Pfister, l'auteur de l'√©pigraphe de cet article, l'a √©crit dans son livre "A la recherche de clusters", le cluster n'a pas √©t√© invent√© par un fabricant particulier de mat√©riel ou de logiciels, mais par des clients qui n'avaient pas la puissance d'un ordinateur ou qui avaient besoin de redondance. </font><font style="vertical-align: inherit;">Cela s'est produit, selon Pfister, dans les ann√©es 60 du si√®cle dernier. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Distinguez traditionnellement les principaux types de grappes suivants:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clusters de basculement (HA, clusters haute disponibilit√©)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clusters d'√©quilibrage de charge (LBC)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clusters de calcul (clusters de calcul haute performance, HPC)</font></font></li>
<li>   (grid)      ,              .   grid-      ,    .  grid-    HPC-,      .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour r√©soudre nos probl√®mes (r√©sistance √† la d√©faillance des composants du syst√®me et utilisation efficace des ressources), nous devions combiner les fonctionnalit√©s d'un cluster √† s√©curit√© int√©gr√©e et d'un cluster avec √©quilibrage de charge. </font><font style="vertical-align: inherit;">Nous n'avons pas pris cette d√©cision tout de suite, mais nous l'avons abord√©e de mani√®re √©volutive, √©tape par √©tape. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour ceux qui ne sont pas √† jour, je vais vous expliquer bri√®vement comment sont organis√©es les applications m√©tiers 1C. </font><font style="vertical-align: inherit;">Ce sont des applications √©crites dans un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">langage th√©matique</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , "aff√ªt√©" pour l'automatisation des t√¢ches m√©tiers comptables. </font><font style="vertical-align: inherit;">Pour ex√©cuter des applications √©crites dans cette langue, un runtime de plate-forme 1C: Enterprise doit √™tre install√© sur l'ordinateur.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1C: Enterprise 8.0</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La premi√®re version du serveur d'applications 1C (pas encore un cluster) est apparue dans la version 8.0 de la plateforme. Avant cela, 1C fonctionnait dans la version client-serveur, les donn√©es √©taient stock√©es dans un fichier SGBD ou MS SQL, et la logique m√©tier fonctionnait exclusivement sur le client. Dans la version 8.0, une transition a √©t√© effectu√©e vers l'architecture √† trois niveaux "client - serveur d'applications - SGBD". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le serveur 1C dans la plate-forme 8.0 √©tait </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COM +</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un serveur capable d'ex√©cuter du code d'application en 1C. </font><font style="vertical-align: inherit;">L'utilisation de COM + nous a fourni un transport pr√™t √† l'emploi, permettant aux applications clientes de communiquer avec le serveur via le r√©seau. </font><font style="vertical-align: inherit;">Beaucoup de choses dans l'architecture de l'interaction client-serveur et des objets d'application disponibles pour le d√©veloppeur 1C ont √©t√© con√ßues en tenant compte de l'utilisation de COM +. </font><font style="vertical-align: inherit;">√Ä ce moment-l√†, la tol√©rance aux pannes n'√©tait pas int√©gr√©e √† l'architecture et une panne de serveur a entra√Æn√© l'arr√™t de tous les clients. </font><font style="vertical-align: inherit;">Lorsque l'application serveur s'est arr√™t√©e, COM + l'a lev√©e lorsque le premier client y a acc√©d√©, et les clients ont commenc√© leur travail depuis le d√©but - depuis la connexion au serveur. </font><font style="vertical-align: inherit;">√Ä cette √©poque, tous les clients √©taient servis par un seul processus.</font></font><br>
<img src="https://habrastorage.org/webt/fg/oo/en/fgooenmx-pqv5tuizcfcvbvbaqg.png" alt="image"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1C: Enterprise 8.1</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la prochaine version, nous voulions:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fournir une tol√©rance aux pannes √† nos clients afin que les accidents et les erreurs de certains utilisateurs ne conduisent pas √† des accidents et des erreurs d'autres utilisateurs. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©barrassez-vous de la technologie COM +. </font><font style="vertical-align: inherit;">COM + ne fonctionnait que sous Windows, et √† cette √©poque la possibilit√© de travailler sous Linux devenait d√©j√† pertinente.</font></font></li>
</ul> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le m√™me temps, nous ne voulions pas d√©velopper une nouvelle version de la plateforme √† partir de z√©ro - elle serait trop gourmande en ressources. </font><font style="vertical-align: inherit;">Nous voulions utiliser au maximum nos r√©alisations, ainsi que maintenir la compatibilit√© avec les applications d√©velopp√©es pour la version 8.0. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, dans la version 8.1, le premier cluster est apparu. </font><font style="vertical-align: inherit;">Nous avons impl√©ment√© notre protocole d'appel de proc√©dure √† distance (en plus de TCP), qui en apparence ressemblait presque √† COM + pour le client final (c'est-√†-dire que nous n'avions pratiquement pas √† r√©√©crire le code responsable des appels client-serveur). </font><font style="vertical-align: inherit;">Dans le m√™me temps, nous avons rendu le serveur impl√©ment√© ind√©pendant de la plateforme C ++, capable de fonctionner √† la fois sur Windows et Linux.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La version 8.0 du serveur monolithique a √©t√© remplac√©e par 3 types de processus - un processus de travail qui sert les clients et 2 processus de service qui prennent en charge le fonctionnement du cluster:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rphost est un workflow au service des clients et ex√©cutant du code d'application. </font><font style="vertical-align: inherit;">Un cluster peut avoir plusieurs workflows, diff√©rents workflows peuvent √™tre ex√©cut√©s sur diff√©rents serveurs physiques - en raison de cette √©volutivit√©.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ragent - un processus d'agent de serveur qui d√©marre tous les autres types de processus, ainsi qu'une premi√®re liste de clusters situ√©s sur ce serveur.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rmngr est un gestionnaire de cluster qui contr√¥le le fonctionnement de l'ensemble du cluster (mais le code d'application ne fonctionne pas dessus). </font></font></li>
</ul><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sous la coupe se trouve le diagramme de fonctionnement de ces trois processus dans le cluster.</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/webt/mn/yh/tc/mnyhtcaf9zf3_nqddsbfq4xgpsg.png" alt="image"><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendant la session, le client a travaill√© avec un seul flux de travail, la baisse du flux de travail signifiait pour tous les clients que ce processus servait, la session s'est termin√©e de fa√ßon anormale. </font><font style="vertical-align: inherit;">Les autres clients ont continu√© de travailler.</font></font><br>
<img src="https://habrastorage.org/webt/wm/tm/mc/wmtmmcct7xd6v2ecl6vi7nlx5dk.png" alt="image"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1C: Enterprise 8.2</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la version 8.2, nous voulions que les applications 1C puissent s'ex√©cuter non seulement dans le client natif (ex√©cutable), mais aussi dans le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">navigateur</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (sans modifier le code de l'application). </font><font style="vertical-align: inherit;">√Ä cet √©gard, en particulier, la t√¢che s'est pos√©e de d√©coupler l'√©tat actuel de l'application de la connexion actuelle avec le flux de travail rphost et de le rendre sans √©tat. </font><font style="vertical-align: inherit;">En cons√©quence, le concept d'une session et de donn√©es de session est apparu qui devait √™tre stock√© en dehors du workflow (car il √©tait sans √©tat). </font><font style="vertical-align: inherit;">Un service de donn√©es de session a √©t√© d√©velopp√© qui stocke et met en cache les informations de session. </font><font style="vertical-align: inherit;">D'autres services sont √©galement apparus - un service de verrous transactionnels g√©r√©s, un service de recherche en texte int√©gral, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette version a √©galement introduit plusieurs innovations importantes - une meilleure tol√©rance aux pannes, un √©quilibrage de charge et un m√©canisme de redondance de cluster.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tol√©rance aux pannes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√âtant donn√© que le processus de travail est devenu sans √©tat et que toutes les donn√©es n√©cessaires au travail ont √©t√© stock√©es en dehors de la connexion client-flux de travail actuelle, en cas de panne de flux de travail, le client est pass√© √† un autre flux de travail "en direct" la prochaine fois qu'il a acc√©d√© au serveur. Dans la plupart des cas, un tel commutateur √©tait invisible pour le client.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le m√©canisme fonctionne comme √ßa. Si, pour une raison quelconque, l'appel du client au flux de travail n'a pas pu aboutir, la partie client est en mesure, apr√®s avoir re√ßu une erreur d'appel, de r√©p√©ter cet appel en r√©tablissant la connexion au m√™me flux de travail ou √† un autre. Mais vous ne pouvez pas toujours r√©p√©ter un appel; R√©p√©ter l'appel signifie que nous avons envoy√© l'appel au serveur, mais que nous n'avons pas re√ßu le r√©sultat. Nous essayons de r√©p√©ter l'appel, tout en effectuant le deuxi√®me appel, nous √©valuons le r√©sultat de l'appel pr√©c√©dent sur le serveur (les informations √† ce sujet sont stock√©es sur le serveur dans les donn√©es de session), car si l'appel a eu le temps de ¬´h√©riter¬ª l√† (fermer la transaction, enregistrer les donn√©es de session etc.) - il est tout simplement impossible de le r√©p√©ter, cela entra√Ænera une incoh√©rence des donn√©es. Si l'appel ne peut pas √™tre r√©p√©t√©, le client recevra un message concernant une erreur irr√©cup√©rable,et l'application cliente devra red√©marrer. Si vous n'avez pas r√©ussi √† ¬´h√©riter¬ª de l'appel (et c'est la situation la plus courante, car de nombreux appels ne modifient pas les donn√©es, par exemple, les rapports, l'affichage des donn√©es sur un formulaire, etc., et ceux qui modifient les donn√©es n'ont pas de transaction ou jusqu'√† ce qu'un changement des donn√©es de session ait √©t√© envoy√© au gestionnaire - il n'y a aucune trace de l'appel) - il peut √™tre r√©p√©t√© sans risque d'incoh√©rence des donn√©es. Si le flux de travail est tomb√© en panne ou si une connexion r√©seau a √©t√© interrompue, un tel appel est r√©p√©t√© et ce ¬´d√©sastre¬ª pour l'application client se produit compl√®tement inaper√ßu.qui modifient les donn√©es - jusqu'√† ce que la transaction soit valid√©e ou jusqu'√† ce que la modification des donn√©es de session soit envoy√©e au gestionnaire - il n'y a aucune trace de l'appel) - elle peut √™tre r√©p√©t√©e sans risque d'incoh√©rence des donn√©es. Si le flux de travail est tomb√© en panne ou si une connexion r√©seau a √©t√© interrompue, un tel appel est r√©p√©t√© et ce ¬´d√©sastre¬ª pour l'application client se produit compl√®tement inaper√ßu.qui modifient les donn√©es - jusqu'√† ce que la transaction soit valid√©e ou jusqu'√† ce que la modification des donn√©es de session soit envoy√©e au gestionnaire - il n'y a aucune trace de l'appel) - elle peut √™tre r√©p√©t√©e sans risque d'incoh√©rence des donn√©es. Si le flux de travail est tomb√© en panne ou si une connexion r√©seau a √©t√© interrompue, un tel appel est r√©p√©t√© et ce ¬´d√©sastre¬ª pour l'application client se produit compl√®tement inaper√ßu.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'√©quilibrage de charge</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La t√¢che d'√©quilibrage de charge dans notre cas est la suivante: un nouveau client entre dans le syst√®me (ou un client d√©j√† en fonction fait un autre appel). </font><font style="vertical-align: inherit;">Nous devons choisir le serveur et le workflow auxquels envoyer l'appel du client afin de fournir au client une vitesse maximale. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'agit d'une t√¢che standard pour un cluster √† charge √©quilibr√©e. </font><font style="vertical-align: inherit;">Il existe plusieurs algorithmes typiques pour le r√©soudre, par exemple:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Round-Robin ()</a> ‚Äì    ,      ,   ‚Äì    . .    .           .    ,          ¬´¬ª .           (   )    .</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Weighted Round Robin</a> ‚Äì  Round-Robin:          ,    ÃÅ    .</li>
<li>Least Connections:     ,       .</li>
<li>Least Response Time:       :    ,    .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour notre cluster, nous avons choisi un algorithme qui est essentiellement proche du temps de r√©ponse le plus faible. Nous avons un m√©canisme qui collecte des statistiques sur les performances des workflows sur tous les serveurs du cluster. Il effectue un appel de r√©f√©rence √† chaque processus serveur du cluster; l'appel de r√©f√©rence implique un sous-ensemble des fonctions du sous-syst√®me de disque, de la m√©moire, du processeur et √©value la rapidit√© avec laquelle un tel appel est effectu√©. Le r√©sultat de ces mesures, moyenn√© au cours des 10 derni√®res minutes, est un crit√®re - quel serveur du cluster est le plus productif et pr√©f√©r√© pour lui envoyer des connexions client dans une p√©riode de temps donn√©e. Les demandes des clients sont r√©parties de mani√®re √† mieux charger le serveur le plus productif - chargez celui qui a de la chance.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La demande du nouveau client est adress√©e au serveur le plus productif du moment. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une demande d'un client existant est dans la plupart des cas adress√©e √† ce serveur et au workflow auquel sa demande pr√©c√©dente a √©t√© adress√©e. </font><font style="vertical-align: inherit;">Un ensemble complet de donn√©es sur le serveur est associ√© √† un client qui fonctionne; le transf√©rer entre des processus (et plus encore entre des serveurs) est assez cher (bien que nous puissions le faire aussi). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une demande d'un client existant est transf√©r√©e vers un autre workflow dans deux cas:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il n'y a plus de processus: le workflow avec lequel le client a pr√©c√©demment interagi n'est plus disponible (le processus est tomb√©, le serveur est devenu indisponible, etc.).</font></font></li>
<li>   :     ,            ,     ,   ,              .         ,  ,     ‚Äì             .    ‚Äì      (..   ).</li>
</ol><br>
<br>
<h3> </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons d√©cid√© d'augmenter la r√©silience du cluster en recourant au sch√©ma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">actif / passif</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il y avait une opportunit√© de configurer deux clusters - fonctionnant et r√©servant. </font><font style="vertical-align: inherit;">Si le cluster principal n'est pas disponible (probl√®mes de r√©seau ou, par exemple, maintenance planifi√©e), les appels clients sont redirig√©s vers le cluster de sauvegarde. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, cette conception √©tait assez difficile √† configurer. </font><font style="vertical-align: inherit;">L'administrateur a d√ª assembler manuellement deux groupes de serveurs en clusters et les configurer. </font><font style="vertical-align: inherit;">Parfois, les administrateurs ont fait des erreurs en d√©finissant des param√®tres conflictuels, comme </font><font style="vertical-align: inherit;">il n'y avait pas de m√©canisme centralis√© pour v√©rifier les param√®tres. </font><font style="vertical-align: inherit;">Mais, n√©anmoins, cette approche a augment√© la tol√©rance aux pannes du syst√®me.</font></font><br>
<img src="https://habrastorage.org/webt/ik/k7/06/ikk7062chdd8qtpk0kzvfncq7vu.png" alt="image"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1C: Enterprise 8.3</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la version 8.3, nous avons consid√©rablement r√©√©crit le code c√¥t√© serveur responsable de la tol√©rance aux pannes. Nous avons d√©cid√© d'abandonner le sch√©ma de cluster actif / passif en raison de la complexit√© de sa configuration. Un seul cluster tol√©rant aux pannes est rest√© dans le syst√®me, compos√© d'un nombre quelconque de serveurs - ce qui est plus proche du sch√©ma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">actif / actif</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans lequel les demandes pour un n≈ìud d√©faillant sont r√©parties entre les n≈ìuds de travail restants. Pour cette raison, le cluster est devenu plus facile √† configurer. Un certain nombre d'op√©rations qui augmentent la tol√©rance aux pannes et am√©liorent l'√©quilibrage de charge sont devenues automatis√©es. Des innovations importantes:</font></font><br>
<br>
<ul>
<li>   ¬´ ¬ª: , ,               .                ,           ¬´¬ª          .</li>
<li>     ,  ,            .</li>
<li>  ,     ,     ,   ,   ,    :</li>
</ul><br>
<img src="https://habrastorage.org/webt/o7/aw/pz/o7awpzltn3jxnderotcyf_wbahm.png" alt="image"><br>
<br>
<img src="https://habrastorage.org/webt/v5/kc/rj/v5kcrjv3ldm96l3ovj1seqobrga.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'id√©e principale de ces d√©veloppements est de simplifier le travail de l'administrateur, lui permettant de configurer le cluster dans des termes qui lui sont familiers, au niveau du fonctionnement du serveur, sans descendre plus bas, et aussi de minimiser le niveau de ¬´contr√¥le manuel¬ª du travail du cluster, en donnant au cluster des m√©canismes pour r√©soudre la plupart des t√¢ches et probl√®mes possibles ¬ª sur le pilote automatique. "</font></font><br>
<br>
<img src="https://habrastorage.org/webt/da/9i/zy/da9izy3cj4wlf80nr8s35tqnp3e.png" alt="image"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trois maillons de tol√©rance aux pannes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous le savez, m√™me si les composants du syst√®me sont fiables s√©par√©ment, des probl√®mes peuvent survenir lorsque les composants du syst√®me se causent mutuellement. </font><font style="vertical-align: inherit;">Nous voulions minimiser le nombre de places critiques pour les performances du syst√®me. </font><font style="vertical-align: inherit;">Une consid√©ration suppl√©mentaire importante √©tait la minimisation des alt√©rations des m√©canismes appliqu√©s dans la plate-forme et l'exclusion des changements dans les solutions appliqu√©es. </font><font style="vertical-align: inherit;">Dans la version 8.3, il y avait 3 liens pour assurer la tol√©rance de panne ¬´au niveau des joints¬ª:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kb/1g/s1/kb1gs1mfus_rsminiyizg4t5dma.png" alt="image"><br>
<ol>
<li>  ,   HTTP(S),  -.   -     -.    ,   HTTP  -,    (     HTTP)    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">libcurl</a>    . </li>
<li>  ,                     .</li>
<li>  -   .       1,   -     .    -            .       ,         .           ,     ‚Äì    .    -         (,     ,   ,         ) ‚Äì          .</li>
<li>     ,    rmngr.    20 (    ) ‚Äî   ,     ..                .     1:          .</li>
</ol><br>
<br>
<h2> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gr√¢ce au m√©canisme de tol√©rance aux pannes, les applications cr√©√©es sur la plate-forme 1C: Enterprise survivent avec succ√®s √† divers types de d√©faillances des serveurs de production du cluster, tandis que la plupart des clients continuent de fonctionner sans red√©marrer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a des situations o√π nous ne pouvons pas r√©p√©ter l'appel, ou un crash de serveur attrape la plateforme √† un moment tr√®s malheureux, par exemple, au milieu d'une transaction et il n'est pas tr√®s clair que faire avec eux. Nous essayons d'assurer une survie statistiquement satisfaisante des clients lorsque les serveurs tombent dans le cluster. En r√®gle g√©n√©rale, la perte moyenne de clients en cas de d√©faillance du serveur est de quelques pour cent. Dans ce cas, tous les clients "perdus" peuvent continuer √† fonctionner dans le cluster apr√®s le red√©marrage de l'application cliente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fiabilit√© du cluster de serveurs 1C dans la version 8.3 a consid√©rablement augment√©. </font><font style="vertical-align: inherit;">Il n'est pas rare depuis longtemps d'introduire des produits 1C, o√π le nombre d'utilisateurs travaillant simultan√©ment atteint plusieurs milliers. </font><font style="vertical-align: inherit;">Il existe des impl√©mentations dans lesquelles 5 000 et 10 000 utilisateurs travaillent simultan√©ment - par exemple, l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">introduction √† Beeline</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o√π l'application 1C: Trade Management dessert tous les </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">points de</font></a><font style="vertical-align: inherit;"> vente Beeline en Russie, ou la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mise en ≈ìuvre de Business Lines chez le transporteur de marchandises.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o√π l'application, cr√©√©e de mani√®re ind√©pendante par les d√©veloppeurs du d√©partement informatique des m√©tiers sur la plateforme 1C: Enterprise, dessert le cycle complet du transport de marchandises. </font><font style="vertical-align: inherit;">Nos tests de charge de cluster interne simulent le fonctionnement simultan√© de jusqu'√† 20 000 utilisateurs.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conclusion, je voudrais √©num√©rer bri√®vement ce qui est utile dans notre cluster (la liste est incompl√®te):</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a>,         . ,             ,   .</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  </a> ‚Äì ,   ,   ,   (      ‚Äì <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">   </a>  ..)      . ,   ,      (, )     ,   ERP, ,           ERP.</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  </a> ‚Äì ,     (,  ,    ..).  ,  ,    ,     ,   ,        .</li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr492994/index.html">Nouveaut√©s de TestMace, partie 1. Synchronisation dans le cloud, interface mise √† jour, etc.</a></li>
<li><a href="../fr492996/index.html">Marshaling et d√©-marshalling des formats de date personnalis√©s dans Go</a></li>
<li><a href="../fr492998/index.html">Comment nous nous sommes tromp√©s sur la pige pour un centre de donn√©es et ce qui en est arriv√©</a></li>
<li><a href="../fr493000/index.html">M√©thodes de traitement du code h√©rit√© en utilisant GitLab comme exemple</a></li>
<li><a href="../fr493002/index.html">350 personnes √† distance: comment c'√©tait</a></li>
<li><a href="../fr493010/index.html">Comment Quarkus combine la programmation imp√©rative et r√©active</a></li>
<li><a href="../fr493012/index.html">Air, relais, c√¢ble par la fen√™tre: comment ne pas tomber sur un fournisseur monopoliste dans un centre d'affaires</a></li>
<li><a href="../fr493014/index.html">Entretien avec Vyacheslav Utochkin, directeur des programmes de d√©veloppement √©ducatif √† la Higher School of Economics, Higher School of Economics, Higher School of Economics; 20 questions sur Gamedev</a></li>
<li><a href="../fr493016/index.html">La rubrique ¬´Lisez des articles pour vous¬ª. Janvier - f√©vrier 2020</a></li>
<li><a href="../fr493018/index.html">Le d√©veloppeur a appr√©ci√© la complexit√© des navigateurs modernes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>