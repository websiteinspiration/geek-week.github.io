<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🦅 🧜 👨🏻‍🎓 用于在Swift 5中使用Combine并在SwiftUI中使用HTTP请求的现代代码。第1部分 🐄 🌍 🏩</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="查询HTTP是开发iOS应用程序时需要获得的最重要的技能之一。在早期版本Swift（版本5之前）中，无论您是从头开始生成这些请求还是使用知名的Alamofire框架，最终都会产生来自该callback 类型的  复杂代码completionHandler: @escaping(Result<T, A...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>用于在Swift 5中使用Combine并在SwiftUI中使用HTTP请求的现代代码。第1部分</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488442/"><img src="https://habrastorage.org/webt/uk/tq/y4/uktqy4xvl1cqefjbmvzdzydqj-g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询</font></font><code>HTTP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是开发</font></font><code>iOS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序</font><font style="vertical-align: inherit;">时需要获得的最重要的技能之一</font><font style="vertical-align: inherit;">。在早期版本</font></font><code>Swift</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（版本5之前）中，无论您是从头开始生成这些请求还是使用知名的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alamofire</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">框架</font><font style="vertical-align: inherit;">，最终都会产生来自该</font></font><code>callback </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型的&nbsp; </font><font style="vertical-align: inherit;">复杂代码</font></font><code>completionHandler: @escaping(Result&lt;T, APIError&gt;) -&gt; Void</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">功能反应式编程</font><font style="vertical-align: inherit;">在</font><font style="vertical-align: inherit;">新框架中的</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
外观</font><font style="vertical-align: inherit;">与现有结合在一起</font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">为您提供了独立编写非常紧凑的代码以从Internet提取数据所需的所有工具。</font><font style="vertical-align: inherit;">
在本文中，按照概念，</font><font style="vertical-align: inherit;">我们将创建“发布者”</font></font><code>Swift 5</code><font style="vertical-align: inherit;"></font><code>Combine</code><font style="vertical-align: inherit;"></font><code>URLSession</code><font style="vertical-align: inherit;"></font><code>Codable</code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><code>Combine</code><font style="vertical-align: inherit;"></font><code>Publisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以从Internet中选择数据，将来我们可以轻松地“订阅” </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些数据，&nbsp; </font></font><code>UIKit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并在有帮助的情况下进行&nbsp; </font><font style="vertical-align: inherit;">设计时使用</font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
由于&nbsp; </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它看起来更简洁，更有效，因为“出版商”的作用&nbsp; </font></font><code>Publisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并不限于样本数据，并进一步延伸到用户界面控件（</font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。事实是，</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">具有</font><font style="vertical-align: inherit;">属性的</font><font style="vertical-align: inherit;">类</font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来</font></font><code>View </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行</font><font style="vertical-align: inherit;">数据分离&nbsp; </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该类的更改会&nbsp; </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动监控并完全重绘</font></font><code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在这些&nbsp; </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类中，您可以非常简单地放置应用程序的某些业务逻辑，如果其中一些</font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;属性是同步和/或异步变换其他的结果</font></font><code>@Published </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;可以直接改变所述用户接口的这样的“活性”的元素（属性</font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），为文本框</font></font><code>TextField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>Picker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>Stepper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>Toggle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了清楚说明问题所在，我将举一些具体例子。现在，</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &nbsp;和</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hacker News之</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类的许多服务都</font><font style="vertical-align: inherit;">提供</font><font style="vertical-align: inherit;">新闻聚合器，以&nbsp; </font><font style="vertical-align: inherit;">使用户可以根据他们的兴趣选择不同的文章集。对于</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新闻&nbsp; </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">聚合器，</font></a><font style="vertical-align: inherit;">它可以是最新新闻</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">，</font></a><font style="vertical-align: inherit;">也可以是某些类别的新闻-“体育”，“健康”，“科学”，“技术”，“商业”或特定信息源“ CNN”的新闻，ABC新闻，彭博社等用户通常以</font></font><code>Endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">形成对他必要</font><font style="vertical-align: inherit;">的形式的</font><font style="vertical-align: inherit;">形式</font><font style="vertical-align: inherit;">来“表达”他对服务的期望</font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，使用该框架&nbsp; </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您可以</font></font><code>ObservableObject </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类使用非常紧凑的代码（在大多数情况下不超过10-12行）一次以</font></font><code>Endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“被动” </font></font><code>@Published </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性到“主动” </font></font><code>@Published </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">的“订阅”形式形成对</font><font style="vertical-align: inherit;">商品列表的同步和/或异步依赖&nbsp; </font><font style="vertical-align: inherit;">。该“订阅”将在</font></font><code>ObservableObject </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类</font><font style="vertical-align: inherit;">实例的整个“生命周期”内有效&nbsp; </font><font style="vertical-align: inherit;">。然后，</font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;您将使用户有机会仅管理</font></font><code>@Published </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表单中</font><font style="vertical-align: inherit;">的“活动” </font><font style="vertical-align: inherit;">属性</font></font><code>Endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，即他希望看到的内容：是最新消息的文章还是“健康”部分的文章。</font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;这些</font></font><code>ObservableObject </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类及其“被动” @Published属性</font><font style="vertical-align: inherit;">将自动提供&nbsp; </font><font style="vertical-align: inherit;">文章本身的外观以及“健康”部分中的最新新闻或文章</font><font style="vertical-align: inherit;">。在代码中</font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;您将不需要显式请求选择文章，因为</font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发挥作用的类</font><font style="vertical-align: inherit;">负责它们在屏幕上的正确和同步显示&nbsp; </font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在一系列文章中，</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我将向您展示如何与&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &nbsp;和</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hacker News</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TMDb</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">电影</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">数据库</font></a><font style="vertical-align: inherit;">一起使用。在这三种情况下，大约都可以使用相同的使用模式&nbsp; </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为在这种应用程序中，您始终必须创建电影或文章的清单，选择它们随附的“照片”（图像），然后使用搜索栏搜索所需电影或文章的数据库。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
访问此类服务时，例如由于您指定了错误的密钥</font></font><code>API-key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或超出了允许的请求数量或其他</font><font style="vertical-align: inherit;">原因，可能会发生错误</font><font style="vertical-align: inherit;">。您需要处理此类错误，否则您将冒着使用户完全陷入空白屏幕的风险。因此，您不仅需要能够使用</font></font><code>&nbsp;Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;从Internet中</font><font style="vertical-align: inherit;">选择</font><font style="vertical-align: inherit;">数据，而且还需要报告采样期间可能发生的错误，并控制它们在屏幕上的显示。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过开发与</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">NewsAPI.org</font></a><font style="vertical-align: inherit;">新闻</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">聚合器</font></a><font style="vertical-align: inherit;">交互的应用程序来开始制定策略&nbsp; </font><font style="vertical-align: inherit;">。我必须说，在此应用程序中，</font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它将最小程度地使用</font><font style="vertical-align: inherit;">它，</font><font style="vertical-align: inherit;">而没有任何多余的装饰，仅仅是为了说明如何</font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与“发布者”一起使用</font></font><code>Publisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和“订阅” </font></font><code>Subscription</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">受到影响</font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
建议您在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网站上注册</font><font style="vertical-align: inherit;">并接收</font></font><code>API</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完成对</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务的所有请求所需</font><font style="vertical-align: inherit;">的密钥</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您必须将其放置</font><font style="vertical-align: inherit;">在结构</font><font style="vertical-align: inherit;">中的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.swift</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">中</font></font><code>APIConstants</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
本文的应用程序代码在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Github上</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">NewsAPI.org</font></a><font style="vertical-align: inherit;">服务数据模型和API</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a></h2><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
服务&nbsp; </font><font style="vertical-align: inherit;">使</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">您</font></a><font style="vertical-align: inherit;">可以选择有关当前新闻文章</font></font><code> [Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">及其来源的信息&nbsp; </font></font><code>[Source]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们的数据模型将非常简单，它位于</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Articles.swift</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中&nbsp; </font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">import</span> Foundation<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">NewsResponse</span>: <span class="hljs-title">Codable</span> </span>{
    <span class="hljs-keyword">let</span> status: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> totalResults: <span class="hljs-type">Int?</span>
    <span class="hljs-keyword">let</span> articles: [<span class="hljs-type">Article</span>]<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Article</span>: <span class="hljs-title">Codable</span>, <span class="hljs-title">Identifiable</span> </span>{
    <span class="hljs-keyword">let</span> id = <span class="hljs-type">UUID</span>()
    <span class="hljs-keyword">let</span> title: <span class="hljs-type">String</span>
    <span class="hljs-keyword">let</span> description: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> author: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> urlToImage: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> publishedAt: <span class="hljs-type">Date?</span>
    <span class="hljs-keyword">let</span> source: <span class="hljs-type">Source</span><font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SourcesResponse</span>: <span class="hljs-title">Codable</span> </span>{
    <span class="hljs-keyword">let</span> status: <span class="hljs-type">String</span>
    <span class="hljs-keyword">let</span> sources: [<span class="hljs-type">Source</span>]<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Source</span>: <span class="hljs-title">Codable</span>,<span class="hljs-title">Identifiable</span> </span>{
    <span class="hljs-keyword">let</span> id: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> name: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> description: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> country: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> category: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> url: <span class="hljs-type">String?</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该文章</font></font><code>Article</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将包含标识符</font></font><code>id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，标题</font></font><code> title</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，描述</font></font><code>&nbsp;description</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，作者</font></font><code>author</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，“图片”的URL </font></font><code>urlToImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，出版日期和出版物</font></font><code>publishedAt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来源</font></font><code>source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。在文章上方</font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个加载项，</font></font><code>NewsResponse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在该</font><font style="vertical-align: inherit;">加载项</font><font style="vertical-align: inherit;">中，我们仅对property属性感兴趣，该属性</font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一系列文章。根结构</font></font><code>NewsResponse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和结构</font></font><code>&nbsp;Article</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font><code>Codable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这将使我们能够从字面上看两行代码，将</font></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据</font><font style="vertical-align: inherit;">解码</font><font style="vertical-align: inherit;">为模型。</font><font style="vertical-align: inherit;">如果我们想使自己更轻松地将一组文章显示</font><font style="vertical-align: inherit;">为列表</font><font style="vertical-align: inherit;">&nbsp;中</font><font style="vertical-align: inherit;">的列表&nbsp; </font><font style="vertical-align: inherit;">，则</font><font style="vertical-align: inherit;">结构&nbsp; </font></font><code>Article</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;也应该是</font></font><code>Identifiable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这样</font><font style="vertical-align: inherit;">。协议</font><font style="vertical-align: inherit;">要求存在一个属性</font></font><code>[Article]</code><font style="vertical-align: inherit;"></font><code>List</code><font style="vertical-align: inherit;"></font><code>SwiftUI</code><font style="vertical-align: inherit;"></font><code>Identifiable </code><font style="vertical-align: inherit;"></font><code>id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将提供一个人工的唯一标识符</font></font><code>UUID()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
信息来源&nbsp; </font></font><code>Source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将包含标识符</font></font><code> id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，名称</font></font><code> name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，描述&nbsp; </font></font><code>description</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，国家</font></font><code> country</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，出版物来源类别</font></font><code>category</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，站点URL </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。在信息源上方&nbsp; </font></font><code>[Source] </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有一个加载项，</font></font><code>SourcesResponse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在该</font><font style="vertical-align: inherit;">加载项&nbsp; </font><font style="vertical-align: inherit;">中，我们仅对一个属性感兴趣，该属性</font></font><code>sources</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一组信息源。根结构</font></font><code>SourcesResponse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和结构&nbsp; </font></font><code>Source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font><code>Codable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这将使我们能够非常轻松地将</font></font><code> JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据</font><font style="vertical-align: inherit;">解码</font><font style="vertical-align: inherit;">为模型。该结构&nbsp; </font></font><code>Source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;也应该是</font></font><code>Identifiable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如果我们要促进信息源阵列的显示</font></font><code>&nbsp;[Source]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在列表的形式</font></font><code>&nbsp;List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;在</font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该协议</font></font><code>Identifiable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要求存在</font></font><code>id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们已经拥有</font><font style="vertical-align: inherit;">的属性</font><font style="vertical-align: inherit;">，因此不需要我们付出额外的努力。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在考虑我们&nbsp; </font></font><code>API</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务的需求&nbsp; </font><font style="vertical-align: inherit;">，并将其放置在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.swift</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中&nbsp; </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们的中心部分</font></font><code>API</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;是一个类</font></font><code>NewsAPI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，提供了两种从</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新闻</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">聚合器中</font></a><font style="vertical-align: inherit;">选择数据的方法&nbsp;&nbsp; </font><font style="vertical-align: inherit;">-文章&nbsp; </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和信息来源</font></font><code>&nbsp;[Source]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<ul>
<li><code>fetchArticles (from endpoint: Endpoint) -&gt; AnyPublisher&lt;[Article], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp; - </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据参数</font><font style="vertical-align: inherit;">选择文章&nbsp; </font></font><code>endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></li>
<li><code>fetchSources (for country: String)&nbsp;-&gt; AnyPublisher&lt;[Source], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><code>[Source]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为特定国家/地区</font><font style="vertical-align: inherit;">选择信息来源</font></font><code> country</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这些方法不仅返回文章数组&nbsp; </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;或信息源数组</font></font><code>&nbsp;[Source]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而且还返回</font></font><code>Publisher </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新框架</font><font style="vertical-align: inherit;">的相应“发布者”&nbsp; </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">两家出版商均未返回任何错误- </font></font><code>Never</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且如果仍然发生抽样或编码​​错误，则将返回空的文章</font></font><code>[Article]()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;或信息源&nbsp; </font><font style="vertical-align: inherit;">数组，&nbsp; </font></font><code>[Source]()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而没有任何消息说明这些数组为空。&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们希望从</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器中选择哪些文章或信息源</font><font style="vertical-align: inherit;">，我们将使用枚举进行指示</font></font><code>enum Endpoint:</code><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">Endpoint</span> </span>{
    <span class="hljs-keyword">case</span> topHeadLines
    <span class="hljs-keyword">case</span> articlesFromCategory(<span class="hljs-number">_</span> category: <span class="hljs-type">String</span>)
    <span class="hljs-keyword">case</span> articlesFromSource(<span class="hljs-number">_</span> source: <span class="hljs-type">String</span>)
    <span class="hljs-keyword">case</span> search (searchFilter: <span class="hljs-type">String</span>)
    <span class="hljs-keyword">case</span> sources (country: <span class="hljs-type">String</span>)<font></font>
    <font></font>
    <span class="hljs-keyword">var</span> baseURL:<span class="hljs-type">URL</span> {<span class="hljs-type">URL</span>(string: <span class="hljs-string">"https://newsapi.org/v2/"</span>)!}<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">path</span><span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">String</span> {
        <span class="hljs-keyword">switch</span> <span class="hljs-keyword">self</span> {
        <span class="hljs-keyword">case</span> .topHeadLines, .articlesFromCategory:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"top-headlines"</span>
        <span class="hljs-keyword">case</span> .search,.articlesFromSource:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"everything"</span>
        <span class="hljs-keyword">case</span> .sources:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"sources"</span><font></font>
        }<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
它：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最新消息&nbsp; </font></font><code>.topHeadLines</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">某一类别的新闻（体育，健康，科学，商业，技术）&nbsp; </font></font><code>.articlesFromCategory(_ category: String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自特定信息来源的新闻（CNN，ABC新闻，Fox新闻等）</font></font><code>&nbsp;.articlesFromSource(_ source: String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何</font></font><code>.search (searchFilter: String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">符合特定条件的</font><font style="vertical-align: inherit;">新闻&nbsp; </font></font><code>searchFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></li>
<li><font style="vertical-align: inherit;"></font><code>.sources (country:String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定国家</font><font style="vertical-align: inherit;">的信息来源</font></font><code>country</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了方便我们需要的选项的初始化，我们</font><font style="vertical-align: inherit;">根据索引</font><font style="vertical-align: inherit;">和字符串</font><font style="vertical-align: inherit;">对各种文章和信息源列表的</font><font style="vertical-align: inherit;">枚举添加了一个</font></font><code>Endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初始化器</font><font style="vertical-align: inherit;">，这对于不同的枚举选项具有不同的含义：</font></font><code>init?</code><font style="vertical-align: inherit;"></font><code>index&nbsp;</code><font style="vertical-align: inherit;"></font><code> text</code><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">init</span>? (index: <span class="hljs-type">Int</span>, text: <span class="hljs-type">String</span> = <span class="hljs-string">"sports"</span>) {
        <span class="hljs-keyword">switch</span> index {
        <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>: <span class="hljs-keyword">self</span> = .topHeadLines
        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <span class="hljs-keyword">self</span> = .search(searchFilter: text)
        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>: <span class="hljs-keyword">self</span> = .articlesFromCategory(text)
        <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>: <span class="hljs-keyword">self</span> = .articlesFromSource(text)
        <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>: <span class="hljs-keyword">self</span> = .sources (country: text)
        <span class="hljs-keyword">default</span>: <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><font></font>
        }<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们回到该类</font></font><code> NewsAPI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;并更详细地考虑第一种方法</font></font><code>fetchArticles (from endpoint: Endpoint)-&gt; AnyPublisher&lt;[Article], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，该</font><font style="vertical-align: inherit;">方法&nbsp; </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据参数</font><font style="vertical-align: inherit;">选择文章</font></font><code>endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且不返回任何错误- </font></font><code>Never</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fetchArticles</span><span class="hljs-params">(from endpoint: Endpoint)</span></span> -&gt; <span class="hljs-type">AnyPublisher</span>&lt;[<span class="hljs-type">Article</span>], <span class="hljs-type">Never</span>&gt; {
        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> url = endpoint.absoluteURL <span class="hljs-keyword">else</span> {              <span class="hljs-comment">// 0</span>
                    <span class="hljs-keyword">return</span> <span class="hljs-type">Just</span>([<span class="hljs-type">Article</span>]()).eraseToAnyPublisher()<font></font>
        }<font></font>
           <span class="hljs-keyword">return</span>
            <span class="hljs-type">URLSession</span>.shared.dataTaskPublisher(<span class="hljs-keyword">for</span>:url)        <span class="hljs-comment">// 1</span>
            .<span class="hljs-built_in">map</span>{$<span class="hljs-number">0</span>.data}                                       <span class="hljs-comment">// 2</span>
            .decode(type: <span class="hljs-type">NewsResponse</span>.<span class="hljs-keyword">self</span>,                    <span class="hljs-comment">// 3</span>
                    decoder: <span class="hljs-type">APIConstants</span> .jsonDecoder)<font></font>
            .<span class="hljs-built_in">map</span>{$<span class="hljs-number">0</span>.articles}                                   <span class="hljs-comment">// 4</span>
            .replaceError(with: [])                             <span class="hljs-comment">// 5</span>
            .receive(on: <span class="hljs-type">RunLoop</span>.main)                          <span class="hljs-comment">// 6</span>
            .eraseToAnyPublisher()                              <span class="hljs-comment">// 7</span>
    }</code></pre><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据</font><font style="vertical-align: inherit;">请求</font><font style="vertical-align: inherit;">的</font></font><code>endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;形式</font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获得所需的文章列表</font></font><code>endpoint.absoluteURL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如果无法完成，则返回一个空的文章数组</font></font><code>[Article]()</code></li>
<li> «» <code>dataTaskPublisher(for:)</code>,     <code>Output </code>  <code>(data: Data, response: URLResponse)</code>, &nbsp; <code>Failure</code>&nbsp;-&nbsp;<code>URLError</code>,</li>
<li>  <code>map { }</code>       <code>(data: Data, response: URLResponse)</code>  &nbsp;<code>data</code>,&nbsp;</li>
<li> <code>JSON </code>&nbsp;<code>data</code>   ,   &nbsp;<code>NewsResponse</code>,    <code>articles:&nbsp;[Atricle]</code></li>
<li>  <code>map { }&nbsp;</code>        -&nbsp;<code>articles</code>,&nbsp;</li>
<li>  -        <code>[ ]</code>,</li>
<li>   <code>main </code>,          <code>UI</code>,</li>
<li>«»  «»   <code>eraseToAnyPublisher()</code>    <code>AnyPublisher</code>.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
选择信息源的任务已分配给第二种方法- </font></font><code>fetchSources (for country: String)&nbsp;-&gt; AnyPublisher&lt;[Source], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是</font><font style="vertical-align: inherit;">第一种方法</font><font style="vertical-align: inherit;">的精确语义副本，只是这次</font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将选择信息源</font><font style="vertical-align: inherit;">而不是文章</font></font><code>[Source]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fetchSources</span><span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">AnyPublisher</span>&lt;[<span class="hljs-type">Source</span>], <span class="hljs-type">Never</span>&gt; {
        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> url = <span class="hljs-type">Endpoint</span>.sources.absoluteURL <span class="hljs-keyword">else</span> {      <span class="hljs-comment">// 0</span>
                       <span class="hljs-keyword">return</span> <span class="hljs-type">Just</span>([<span class="hljs-type">Source</span>]()).eraseToAnyPublisher()<font></font>
           }<font></font>
              <span class="hljs-keyword">return</span>
               <span class="hljs-type">URLSession</span>.shared.dataTaskPublisher(<span class="hljs-keyword">for</span>:url)      <span class="hljs-comment">// 1</span>
               .<span class="hljs-built_in">map</span>{$<span class="hljs-number">0</span>.data}                                     <span class="hljs-comment">// 2</span>
               .decode(type: <span class="hljs-type">SourcesResponse</span>.<span class="hljs-keyword">self</span>,               <span class="hljs-comment">// 3</span>
                       decoder: <span class="hljs-type">APIConstants</span> .jsonDecoder)<font></font>
               .<span class="hljs-built_in">map</span>{$<span class="hljs-number">0</span>.sources}                                  <span class="hljs-comment">// 4</span>
               .replaceError(with: [])                           <span class="hljs-comment">// 5</span>
               .receive(on: <span class="hljs-type">RunLoop</span>.main)                        <span class="hljs-comment">// 6</span>
               .eraseToAnyPublisher()                            <span class="hljs-comment">// 7</span>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
它以</font></font><code>AnyPublisher &lt;[Source], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个信息源数组的形式</font><font style="vertical-align: inherit;">返回</font><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">的“发布者” </font><font style="vertical-align: inherit;">，</font></font><code>[Source] </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且没有错误</font></font><code>&nbsp;Never</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;（如果有错误，则返回一个空的源数组&nbsp; </font></font><code>[ ]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们将挑选出这两种方法的共同部分，安排它作为一个</font></font><code>Generic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font></font><code>fetch(_ url: URL) -&gt; AnyPublisher&lt;T, Error&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回的&nbsp; </font></font><code>Generic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“发行” </font></font><code>AnyPublisher&lt;T, Error&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基础上</font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-comment">//     URL</span>
     <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fetch</span>&lt;T: Decodable&gt;<span class="hljs-params">(<span class="hljs-number">_</span> url: URL)</span></span> -&gt; <span class="hljs-type">AnyPublisher</span>&lt;<span class="hljs-type">T</span>, <span class="hljs-type">Error</span>&gt; {
                   <span class="hljs-type">URLSession</span>.shared.dataTaskPublisher(<span class="hljs-keyword">for</span>: url)             <span class="hljs-comment">// 1</span>
                    .<span class="hljs-built_in">map</span> { $<span class="hljs-number">0</span>.data}                                          <span class="hljs-comment">// 2</span>
                    .decode(type: <span class="hljs-type">T</span>.<span class="hljs-keyword">self</span>, decoder: <span class="hljs-type">APIConstants</span>.jsonDecoder) <span class="hljs-comment">// 3</span>
                    .receive(on: <span class="hljs-type">RunLoop</span>.main)                               <span class="hljs-comment">// 4</span>
                    .eraseToAnyPublisher()                                   <span class="hljs-comment">// 5</span>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这将简化前两种方法：</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-comment">//   </span>
     <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fetchArticles</span><span class="hljs-params">(from endpoint: Endpoint)</span></span>
                                     -&gt; <span class="hljs-type">AnyPublisher</span>&lt;[<span class="hljs-type">Article</span>], <span class="hljs-type">Never</span>&gt; {
         <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> url = endpoint.absoluteURL <span class="hljs-keyword">else</span> {
                     <span class="hljs-keyword">return</span> <span class="hljs-type">Just</span>([<span class="hljs-type">Article</span>]()).eraseToAnyPublisher() <span class="hljs-comment">// 0</span><font></font>
         }<font></font>
         <span class="hljs-keyword">return</span> fetch(url)                                          <span class="hljs-comment">// 1</span>
             .<span class="hljs-built_in">map</span> { (response: <span class="hljs-type">NewsResponse</span>) -&gt; [<span class="hljs-type">Article</span>] <span class="hljs-keyword">in</span>        <span class="hljs-comment">// 2</span>
                             <span class="hljs-keyword">return</span> response.articles }<font></font>
                .replaceError(with: [<span class="hljs-type">Article</span>]())                    <span class="hljs-comment">// 3</span>
                .eraseToAnyPublisher()                              <span class="hljs-comment">// 4</span><font></font>
     }<font></font>
    <font></font>
    <span class="hljs-comment">//    </span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fetchSources</span><span class="hljs-params">(<span class="hljs-keyword">for</span> country: String)</span></span>
                                       -&gt; <span class="hljs-type">AnyPublisher</span>&lt;[<span class="hljs-type">Source</span>], <span class="hljs-type">Never</span>&gt; {
        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> url = <span class="hljs-type">Endpoint</span>.sources(country: country).absoluteURL
            <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">return</span> <span class="hljs-type">Just</span>([<span class="hljs-type">Source</span>]()).eraseToAnyPublisher() <span class="hljs-comment">// 0</span><font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> fetch(url)                                         <span class="hljs-comment">// 1</span>
            .<span class="hljs-built_in">map</span> { (response: <span class="hljs-type">SourcesResponse</span>) -&gt; [<span class="hljs-type">Source</span>] <span class="hljs-keyword">in</span>     <span class="hljs-comment">// 2</span><font></font>
                            response.sources }<font></font>
               .replaceError(with: [<span class="hljs-type">Source</span>]())                    <span class="hljs-comment">// 3</span>
               .eraseToAnyPublisher()                             <span class="hljs-comment">// 4</span>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这样获得的“发布者”在有人“订阅”之前不会交付任何东西。</font><font style="vertical-align: inherit;">我们可以在设计时做到这一点</font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“出版商” </font></font><code>Publisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为</font></font><code>View Model </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code> SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">文章清单。</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在介绍一下运作的逻辑</font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">&nbsp;他们所响应的“外部变化” </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
的</font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">唯一抽象</font></font><code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是“发布者” </font></font><code>Publisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。 “外部更改”可以理解为计时器</font></font><code> Timer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>NotificationCenter </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">带有</font><font style="vertical-align: inherit;">Model对象的</font><font style="vertical-align: inherit;">通知</font><font style="vertical-align: inherit;">，使用协议</font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以将其转换为外部单个“真理来源”（真理来源）。&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于普通的“发布者”类型</font></font><code>Timer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>NotificationCenter</code> <code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用方法进行反应</font></font><code>onReceive (_: perform:)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><code>Timer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们稍后将在关于</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hacker News</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的应用程序的第三篇文章中介绍</font><font style="vertical-align: inherit;">使用“发布者”的示例</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在本文中，我们将重点介绍如何为&nbsp;</font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外部“真理之源”（真理之源）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，让我们看一下在</font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示各种类型文章的特定示例中，最终的“发布者”应</font><font style="vertical-align: inherit;">如何</font><font style="vertical-align: inherit;">发挥作用：</font></font><br>
<br>
<code>.topHeadLines</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-最新新闻，&nbsp; </font></font><code>.articlesFromCategory(_ category: String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;-特定类别的</font></font><code>&nbsp;.articlesFromSource(_ source: String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;新闻</font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">-特定信息源的新闻，</font></font><code>.search (searchFilter: String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;-根据特定条件选择的新闻。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zr/ua/uv/zruauv9msu2nulm2ksuflhtxusi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
根据</font></font><code> Endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择的用户，我们需要更新</font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择</font><font style="vertical-align: inherit;">的文章列表</font><font style="vertical-align: inherit;">。为此，我们将创建一个非常简单的类</font></font><code>&nbsp;ArticlesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">该类</font><font style="vertical-align: inherit;">实现</font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;具有三个&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">的协议</font><font style="vertical-align: inherit;">：</font></font><br>
&nbsp;<br>
<img src="https://habrastorage.org/webt/ty/xj/cs/tyxjcsfctbxerl9oiyr6ljvda8c.png"><br>
<br>
<ul>
<li><code>@Published var indexEndpoint: Int</code> —   <code>Endpoint</code> (    «»,        <code>View</code>),&nbsp;&nbsp;</li>
<li><code>@Published var searchString: String</code> —  ,             &nbsp;&nbsp;(     «»,        <code>View</code>&nbsp;    <code>TextField</code>),</li>
<li><code>@Published var articles: [Article]</code>&nbsp;-    ( «»,          <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">NewsAPI.org</a>,  «»).</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一旦设置了&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;属性</font></font><code>indexEndpoint&nbsp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code> searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们就可以将它们同时用作简单属性&nbsp; </font></font><code>indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;和&nbsp; </font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以及作为“发布者”&nbsp; </font></font><code>$indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和&nbsp; </font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在一个类中&nbsp; </font></font><code>ArticlesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您不仅可以声明我们感兴趣的属性，还可以规定它们交互的业务逻辑。为此，在初始化类的实例时&nbsp; </font></font><code>ArticlesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;，</font></font><code>init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以创建一个“订阅”，该“订阅”将在该类实例的整个“生命周期”中起作用，&nbsp; </font></font><code>ArticlesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并重现文章列表</font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对索引&nbsp; </font></font><code>indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;和搜索字符串</font><font style="vertical-align: inherit;">的依赖性</font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为此，</font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们扩展了“发布者”链</font></font><code>$indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;并</font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出“发布者”</font></font><code>AnyPublisher&lt;[Article], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其值是文章列表&nbsp; </font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。然后，我们使用运算符“订阅”它，</font></font><code>assign&nbsp;(to: \.articles, on: self)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并获得所需的文章列表</font></font><code>articles </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为</font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;定义</font><font style="vertical-align: inherit;">的“输出”&nbsp; </font><font style="vertical-align: inherit;">属性</font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们必须从性质拉动链条不要直接&nbsp; </font></font><code>indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，即从“出版商” </font></font><code> $indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">谁参与创作</font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的帮助下</font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们将有使用用户界面元素更改它们&nbsp; </font></font><code>Picker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>TextField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们将如何做？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们</font></font><code>fetchArticles (from: Endpoint)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的类库中&nbsp; </font><font style="vertical-align: inherit;">已经有一个函数，该函数</font><font style="vertical-align: inherit;">根据值</font></font><code>NewsAPI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回“发布者”</font></font><code>AnyPublisher&lt;[Article], Never&gt;</code><font style="vertical-align: inherit;"></font><code>Endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而我们只能以某种方式使用“发布者”的值&nbsp; </font></font><code>$indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并将&nbsp; </font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其转换</font></font><code>endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为该函数</font><font style="vertical-align: inherit;">的参数</font><font style="vertical-align: inherit;">。&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，将“发布者” </font></font><code>$indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;和&nbsp; </font><font style="vertical-align: inherit;">结合在一起&nbsp; </font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。为此，该</font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作员存在</font></font><code>Publishers.CombineLatest </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ci/pg/wd/cipgwdfx2fxmlevrmkf8nnkc6u4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要基于从先前“发布者”接收到的数据创建一个新的“发布</font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;者</font><font style="vertical-align: inherit;">” </font><font style="vertical-align: inherit;">，请使用该操作符&nbsp; </font></font><code>flatMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ln/s7/ur/lns7urzc9l64o8mswhliuggsyp4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来，我们使用非常简单的“订阅者”“订阅”该新接收的“发布者”，&nbsp; </font></font><code>assign (to: \.articles, on: self)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并从“由于</font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;数组的&nbsp; </font><font style="vertical-align: inherit;">值是发布者“的值&nbsp; </font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/su/io/xi/suioxibgc3t31oewzgkbfaljina.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们刚刚创建了一个</font></font><code>init( )</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">异步的发布者”，并“订阅了”</font></font><code>AnyCancellable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“订阅”，这很容易验证我们是否将我们的“订阅”保持为常数</font></font><code>let subscription</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">“订阅” </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gw/ig/ml/gwigml-zqpprclh76lzfnjhvzda.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
的主要属性</font></font><code>AnyCancellable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是，一旦它离开范围，它所占用的内存就会自动释放。因此，一旦</font></font><code>init( ) </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完成，该“预订”将被删除</font></font><code>ARC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而没有时间将接收到的具有时延的异步信息分配给阵列</font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。从字面上看，异步信息根本就无处“着陆”，“地球已经从它的脚下掉下来了”。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了保存这样的“订阅”，有必要创建一个超出初始化程序的</font></font><code> init() </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font><font style="vertical-align: inherit;">，该变量将在类实例的整个“生命周期” </font></font><code>var&nbsp;cancellableSet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中将我们的</font></font><code>AnyCancellable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“订阅” </font><font style="vertical-align: inherit;">保存&nbsp; </font><font style="vertical-align: inherit;">在该变量中&nbsp;  </font></font><code>ArticlesViewMode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，我们删除了常数</font></font><code>let subscription</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并记住我们的</font></font><code>AnyCancellable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“订阅”中的变量&nbsp; </font></font><code>cancellableSet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用操作</font></font><code>.store ( in: &amp;self.cancellableSet)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/my/gt/xw/mygtxwz7uhcurfyfnblva9irfku.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
“订阅”异步“发行人”，我们创造了</font></font><code>init( )</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整个类实例的整个“生命周期”将被保留&nbsp; </font></font><code>ArticlesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们可以任意更改``发布者'' </font></font><code>$indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和/或&nbsp; </font><font style="vertical-align: inherit;">的含义&nbsp; </font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且始终要感谢创建的``订阅''，我们将</font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无需花费额外的精力</font><font style="vertical-align: inherit;">就可以拥有与这两个发布者的价值相对应的一系列文章&nbsp; </font><font style="vertical-align: inherit;">。这个&nbsp; </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类通常被称为&nbsp; </font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了减少键入搜索字符串时服务器的调用次数</font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们不应该使用搜索字符串本身的“发布者”&nbsp;</font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以及它的修改版本</font></font><code>validString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kh/ir/2z/khir2z1rrmou-hks2rtfuq31bnm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，我们已经</font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">准备好撰写文章，</font><font style="vertical-align: inherit;">让我们</font><font style="vertical-align: inherit;">开始创建用户界面（</font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。为了</font><font style="vertical-align: inherit;">与</font><font style="vertical-align: inherit;">&nbsp;模型</font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同步，</font></font><code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用了</font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个</font></font><code>@ObservedObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font><font style="vertical-align: inherit;">，该</font><font style="vertical-align: inherit;">变量引用此模型的类的实例。这是对-&nbsp; </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;类和</font></font><code>@ObservedObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引用该类实例</font><font style="vertical-align: inherit;">的&nbsp; </font><font style="vertical-align: inherit;">变量-控制in中用户界面（</font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）&nbsp; </font><font style="vertical-align: inherit;">的更改</font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们以</font><font style="vertical-align: inherit;">变量的形式</font><font style="vertical-align: inherit;">将结构的</font></font><code>ContentView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;实例</font><font style="vertical-align: inherit;">添加到结构</font></font><code>ArticleViewModel </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中，</font></font><code>var articleViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并替换</font></font><code>Text ("Hello, World!")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为文章列表，</font></font><code>ArticlesList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在其中放置</font></font><code>articlesViewModel.articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从我们</font><font style="vertical-align: inherit;">的文章中</font><font style="vertical-align: inherit;">获得&nbsp; </font><font style="vertical-align: inherit;">的文章&nbsp;</font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。结果，我们获得了固定索引和默认索引的文章列表&nbsp; </font></font><code>indexEndpoint = 0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，即</font></font><code>.topHeadLines</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;最新新闻：</font><font style="vertical-align: inherit;">在</font></font><br>
<br>
<img src="https://habrastorage.org/webt/je/_f/j-/je_fj-0m2xews-ih7vptprkdpoy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
屏幕上添加一个&nbsp; </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素，以控制要显示的文章集。我们将使用&nbsp; </font></font><code>Picker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引更改</font></font><code>$articlesViewModel.indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。符号的存在是&nbsp; </font></font><code>$</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">强制性的，因为这意味着</font></font><code>@Published&nbsp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“发布者” </font><font style="vertical-align: inherit;">提供的值将发生更改&nbsp; </font><font style="vertical-align: inherit;">。该“发布者”的“订阅”会立即触发，我们在此启动</font></font><code>init ()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，“输出”&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“发布者” </font></font><code>&nbsp;articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;将更改，并且我们将在屏幕上看到不同的文章列表：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zx/sd/pp/zxsdppfkp5y0nuk-j99uhovvmu8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这样，我们可以接收所有三个选项的文章数组-“ topHeadLines”，“搜索” “和”来自类别“：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jm/yc/a_/jmyca_mvm0n2___cswvcamuuqqm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...，但使用固定和默认的搜索字符串</font></font><code>searchString = "sports"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（需要时）：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zq/pi/tw/zqpitwdhh3fsnciz9p2scvn1sas.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，对于此选项，&nbsp; </font></font><code>"search"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;您必须为用户提供</font></font><code>SearchView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于输入搜索字符串</font><font style="vertical-align: inherit;">的文本字段</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xk/d1/uu/xkd1uu0tmepthmsjlkzu--wlwse.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
结果，用户可以通过键入的搜索字符串来搜索任何新闻：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/x4/ch/5a/x4ch5apliuwesqxjzeds58ab1t8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于该选项，&nbsp; </font></font><code>"from category"&nbsp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有必要向用户提供有机会选择一个类别，我们开始与类别</font></font><code>science</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/2i/8e/3v/2i8e3vvly1r_ipfuflxwbtepglq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
作为一个结果，用户可以搜索任何新闻对新闻选择的类别- ，</font></font><code>science</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code> health</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，&nbsp; </font><font style="vertical-align: inherit;">：</font></font><code>business</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> </font><font style="vertical-align: inherit;">
我们可以看到一个非常简单的&nbsp; </font><font style="vertical-align: inherit;">&nbsp;模型，有两个用户控制</font><font style="vertical-align: inherit;">功能- </font><font style="vertical-align: inherit;">&nbsp;和</font></font><code>technology</code><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/webt/p_/pn/li/p_pnli0chxenoalmms3ltch-iwo.png"><br>
<br><font style="vertical-align: inherit;"></font><code>ObservableObject</code><font style="vertical-align: inherit;"></font><code>@Published </code><font style="vertical-align: inherit;"></font><code>indexEndpoint</code><font style="vertical-align: inherit;"></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-使您可以从</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网站中选择各种信息&nbsp; </font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息来源清单</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们看一下</font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;NewsAPI类中接收到的信息源</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">“发布者”将如何运行</font></font><code>fetchSources (for country: String)&nbsp;-&gt; AnyPublisher&lt;[Source], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们将获得不同国家/地区的信息资源列表：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hr/oh/le/hrohle3hq8pkyhnjf6frali7yao.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...以及按名称搜索</font><font style="vertical-align: inherit;">信息</font><font style="vertical-align: inherit;">的能力：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kg/ea/ll/kgeallzwaxnkvekct18th7knkyo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...以及有关选定来源的详细信息：其名称，类别，国家/地区，简短说明和网站链接：&nbsp; </font></font><br>
<br>
<img src="https://habrastorage.org/webt/k_/b7/9w/k_b79wirynz07feigtlhgdeyik4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果单击链接，我们将转到此网站信息来源。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了使所有这些都能起作用，您需要一个非常简单的&nbsp; </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Model，该Model仅具有两个用户控制的</font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性- </font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;和&nbsp; </font></font><code>country</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rs/id/4b/rsid4bb5xmkjdkwuptkmwvhi-yc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同样，我们使用相同的方案：在初始化类的</font></font><code>SourcesViewModel </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类</font><font style="vertical-align: inherit;">实例时</font><font style="vertical-align: inherit;">，</font></font><code> init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们创建了一个“订阅”，该订阅将在类实例的整个“生命周期”中运行，</font></font><code>&nbsp;SourcesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并确保信息源列表取决于&nbsp; </font></font><code>sources</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">国家&nbsp; </font></font><code>country</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和搜索字符串</font></font><code>&nbsp;searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在帮助下，&nbsp; </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将链从“发布者”中拉出，</font></font><code>$searchString </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code>$country</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出“发布者” </font></font><code>AnyPublisher&lt;[Source], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其值是信息源列表。我们使用运算符“订阅”它</font></font><code>assign&nbsp;(to: \.sources, on: self)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，得到所需信息源的列表&nbsp; </font></font><code>sources</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。并</font><font style="vertical-align: inherit;">使用运算符</font><font style="vertical-align: inherit;">将收到的</font></font><code>AnyCancellable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“订阅” </font><font style="vertical-align: inherit;">记住&nbsp; </font><font style="vertical-align: inherit;">在变量中&nbsp; </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">
现在我们有了</font><font style="vertical-align: inherit;">信息源，</font><font style="vertical-align: inherit;">让我们</font><font style="vertical-align: inherit;">开始创建</font><font style="vertical-align: inherit;">。 B </font><font style="vertical-align: inherit;">同步</font><font style="vertical-align: inherit;">c</font></font><code>cancellableSet</code><font style="vertical-align: inherit;"></font><code>.store ( in: &amp;self.cancellableSet)</code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><code>View Model</code><font style="vertical-align: inherit;"></font><code> UI</code><font style="vertical-align: inherit;"></font><code>SwiftUI</code><font style="vertical-align: inherit;"></font><code> View</code><font style="vertical-align: inherit;"></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;该模型使用一个</font></font><code>@ObservedObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量，</font><font style="vertical-align: inherit;">该</font><font style="vertical-align: inherit;">变量引用此Model类的实例。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将</font></font><code>ContentViewSources</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;类实例</font><font style="vertical-align: inherit;">以</font></font><code>SourcesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量的形式</font><font style="vertical-align: inherit;">添加到结构&nbsp; </font><font style="vertical-align: inherit;">中</font></font><code>var sourcesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，删除&nbsp; </font></font><code>Text ("Hello, World!")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;并放置</font></font><code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3个</font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性中的</font><font style="vertical-align: inherit;">每个&nbsp; </font><font style="vertical-align: inherit;">属性</font></font><code>&nbsp;sourcesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;：</font></font><br>
<br>
&nbsp;<ul>
<li><font style="vertical-align: inherit;"></font><code>SearchView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索栏的&nbsp; </font><font style="vertical-align: inherit;">文本框&nbsp; </font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></li>
<li>&nbsp;<code>Picker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;为了国家</font></font><code>country</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></li>
<li><font style="vertical-align: inherit;"></font><code>SourcesList&nbsp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息来源</font><font style="vertical-align: inherit;">清单&nbsp;</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/td/tk/kn/tdtkknev57l3b5avb8y0uheu7fa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
结果，我们得到了所需的信息</font></font><code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jw/gg/ly/jwgglycniqr2e-jhpifypfzx4m8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在此屏幕上，我们仅使用文本框管理搜索字符串，并使用来管理</font></font><code>SearchView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“国家/地区”&nbsp; </font></font><code>Picker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其余的将自动进行。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
信息源列表仅</font></font><code>SourcesList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含有关每个源的最少信息-名称</font></font><code>source.name </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和简短说明</font></font><code>source.description</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sj/zi/1z/sjzi1zh-7leadeujwarkuka_ii8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... ...但是，您可以使用以下链接获得有关所选源的更详细的信息：在该链接</font></font><code>NavigationLink</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中，</font></font><code>destination</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们指示&nbsp; </font></font><code>DetailSourceView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哪些源数据是信息源&nbsp; </font></font><code>source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及所需的类实例</font></font><code>ArticlesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，得到他的文章清单</font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ix/j_/uh/ixj_uheqhclwopwidsihztunn5e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
看看我们如何在信息来源列表中获得选定信息来源的文章列表&nbsp; </font></font><code>SourcesList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们的老朋友对我们有帮助- </font></font><code>ArticlesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们必须为这两个</font><font style="vertical-align: inherit;">类&nbsp; </font><font style="vertical-align: inherit;">设置“输入”&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">index&nbsp; </font></font><code>indexEndpoint = 3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，即</font></font><code>.articlesFromSource (_source:String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对应于固定来源文章选择</font><font style="vertical-align: inherit;">的选项&nbsp; </font></font><code>source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符串&nbsp; </font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;作为源本身（或更确切地说是其标识符）</font></font><code>source.id&nbsp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/ia/xi/lr/iaxilr4rlcyippxuvkbd46kequ4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通常，如果您查看整个</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsApp</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序</font><font style="vertical-align: inherit;">，则不会看到我们明确要求</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsNews.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网站上提供文章或信息来源的任何地方&nbsp; </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们仅管理&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;数据，但会</font></font><code>View Model </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">做我们的工作：选择所需的文章和信息来源。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下载</font></font><code>UIImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文章</font><font style="vertical-align: inherit;">图片</font></font><code>Article</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
本文的模型&nbsp; </font></font><code>Article&nbsp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含一个</font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附带</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">图像&nbsp; </font></font><code>urlToImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/om/ny/fv/omnyfvhlcegrhltunqvjvyaq6l4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
基于此，&nbsp; </font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将来我们必须</font></font><code>UIImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;从</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网站上&nbsp; </font><font style="vertical-align: inherit;">获取图像本身</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们已经熟悉此任务。</font><font style="vertical-align: inherit;">在该类中</font></font><code>ImageLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，使用函数</font></font><code>fetchImage(for url: URL?) -&gt; AnyPublisher&lt;UIImage?, Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建一个</font></font><code>AnyPublisher&lt;UIImage?, Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有图像值&nbsp; </font></font><code>UIImage?</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;且没有错误&nbsp; </font><font style="vertical-align: inherit;">的“发布者”&nbsp;  </font></font><code>Never</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（实际上，如果发生错误，则返回图像</font></font><code> nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><code>UIImage?</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;在设计用户界面（</font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">时，</font><font style="vertical-align: inherit;">您可以“订阅”该“发布者”以接收图像&nbsp; </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该函数的源数据</font></font><code>fetchImage(for url: URL?)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是&nbsp; </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们有：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/do/a-/hg/doa-hg5idk0ukdghj0snu0-nubm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们知道，</font><font style="vertical-align: inherit;">
让我们详细考虑在</font></font><code> Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“发布者” </font><font style="vertical-align: inherit;">的帮助下如何进行</font><font style="vertical-align: inherit;">：</font></font><code>AnyPublisher &lt;UIImage?, Never&gt;</code><font style="vertical-align: inherit;"></font><code>url</code><font style="vertical-align: inherit;"></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相等</font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，返回</font></font><code>Just(nil)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于</font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“发布者” </font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">形式</font></font><code>dataTaskPublisher(for:)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其输出值为</font></font><code>Output</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元组</font></font><code>(data: Data, response: URLResponse)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和错误</font></font><code>&nbsp;Failure</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-&nbsp; </font></font><code>URLError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们采取</font><font style="vertical-align: inherit;">仅数据</font></font><code>map {}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从元组</font></font><code>(data: Data, response: URLResponse)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以供进一步处理&nbsp; </font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和形式</font></font><code>UIImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果前面的步骤返回错误</font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将结果传递到</font></font><code>main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">流中，因为我们假定在设计中进一步使用它</font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“擦除”“发布者”的类型并返回副本</font></font><code>AnyPublisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您会看到代码非常紧凑且可读性强，没有任何代码</font></font><code>callbacks</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们开始</font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;为图像</font><font style="vertical-align: inherit;">创建&nbsp; </font></font><code>UIImage?</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这是一个</font></font><code>ImageLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现protocol </font><font style="vertical-align: inherit;">的类</font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，具有两个&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性：</font></font><br>
<br>
<ul>
<li><code>@Published url: URL?</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;是</font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像</font></font></li>
<li><code>@Published var image: UIImage?</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;是来自</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的图片本身</font><font style="vertical-align: inherit;">：</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/li/o6/kr/lio6krhn0v1eyeiwg_cgpwcigia.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
再一次，初始化类的实例时，&nbsp; </font></font><code>ImageLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;我们必须将链从输入“ publisher”&nbsp; </font></font><code>$url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;延伸到输出“ publisher” </font></font><code>AnyPublisher&lt;UIImage?, Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，稍后将</font><font style="vertical-align: inherit;">&nbsp;“订阅” </font><font style="vertical-align: inherit;">到输出并获得所需的图像</font></font><code>image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ba/gi/2s/bagi2swivajzz0pkgqzzsswudww.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们使用运算符</font></font><code>&nbsp;flatMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和一个非常简单的“ subscriber” </font></font><code>assign (to: \image, on: self)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将其分配给来自“ publisher”的</font><font style="vertical-align: inherit;">接收者&nbsp; </font><font style="vertical-align: inherit;">``属性值</font></font><code>@Published image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/eq/3k/4-/eq3k4-0pbruhk4qbcu8hmyinfmg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
再次</font><font style="vertical-align: inherit;">使用操作符</font></font><code>cancellableSet </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储</font><font style="vertical-align: inherit;">在变量&nbsp; </font></font><code>AnyCancellable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">''预订''中&nbsp; </font></font><code>store(in: &amp;self.cancellableSet)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
此“图像下载器”的逻辑是，您从</font></font><code> nil URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有预加载</font><font style="vertical-align: inherit;">的图像之外的其他位置下载图像</font><font style="vertical-align: inherit;">，即</font></font><code>image == nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。如果在下载过程中检测到任何错误，则图像将不存在，即</font></font><code>image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它将保持相等</font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在</font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的帮助</font></font><code>ArticleImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下，</font></font><code>imageLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;该类</font><font style="vertical-align: inherit;">的实例使用此</font><font style="vertical-align: inherit;">图像来显示图像</font></font><code>ImageLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。如果他的图像图像不相等</font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则使用来显示</font></font><code> Image (...)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但如果相等</font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则根据</font><font style="vertical-align: inherit;">图像的相等性</font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">不</font><font style="vertical-align: inherit;">显示</font></font><code>url </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何内容</font></font><code>EmptyView()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或者显示</font></font><code>Rectangle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有旋转文本T </font><font style="vertical-align: inherit;">的矩形</font></font><code>ext("Loading...")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mh/nq/yi/mhnqyirurke0w6yibfxm86gap1i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
此逻辑适用于这种情况当您肯定知道的时候（&nbsp; </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了&nbsp; </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获得图片）</font></font><code>image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，电影电影数据库就是这种情况。&nbsp;</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TMDb</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。使用</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新闻聚合器&nbsp; </font><font style="vertical-align: inherit;">&nbsp; 就不同了。某些信息来源的文章与</font></font><code>nil&nbsp;URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像</font><font style="vertical-align: inherit;">提供了不同的信息&nbsp; </font><font style="vertical-align: inherit;">，但是对它的访问是封闭的，我们得到了一个</font></font><code>Rectangle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有旋转文本</font><font style="vertical-align: inherit;">的矩形</font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">该矩形</font></font><code>Text("Loading...")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将永远不会被替换：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sh/tq/lp/shtqlpz4wx-iobt19-wv9j2pb7w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在这种情况下，如果</font></font><code>&nbsp;URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像不同于&nbsp; </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则</font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像&nbsp; </font><font style="vertical-align: inherit;">的相等性&nbsp; </font></font><code>image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能意味着图像正在加载以及加载时发生错误的事实，我们将永远不会得到图片</font></font><code>image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。为了区分这两种情况，我们向该类中</font></font><code>ImageLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;的两个现有</font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">添加了&nbsp; </font><font style="vertical-align: inherit;">一个：&nbsp;</font></font><br>
<br>
<code>&nbsp;@Published var noData = false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;-这是一个布尔值，通过它我们将指示由于选择过程中的错误而导致图像数据不存在的情况：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kp/jc/sq/kpjcsqugrsfzyghmefnge0unscy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
创建“订阅”时，我们将</font></font><code> init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">捕获</font></font><code> Error</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加载图像时发生的</font><font style="vertical-align: inherit;">所有错误</font><font style="vertical-align: inherit;">并在</font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性中</font><font style="vertical-align: inherit;">累积它们的存在&nbsp; </font></font><code>self.noData = true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。如果下载成功，则获得图像</font></font><code>image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">
我们</font><font style="vertical-align: inherit;">&nbsp;基于以下&nbsp; </font><font style="vertical-align: inherit;">&nbsp;函数</font><font style="vertical-align: inherit;">创建</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
“发布者”&nbsp; </font><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">我们</font><font style="vertical-align: inherit;">通过初始化“发布者”&nbsp; </font><font style="vertical-align: inherit;">开始创建方法</font><font style="vertical-align: inherit;">，该方法可用于</font><font style="vertical-align: inherit;">使用闭包</font><font style="vertical-align: inherit;">异步获取单个TYPE值</font><font style="vertical-align: inherit;">。闭包有一个参数- </font><font style="vertical-align: inherit;">这是TYPE的函数&nbsp; </font><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">我们将</font><font style="vertical-align: inherit;">
结果</font><font style="vertical-align: inherit;">转换为</font></font><code>AnyPublisher&lt;UIImage?, Error&gt;</code><font style="vertical-align: inherit;"></font><code>url</code><font style="vertical-align: inherit;"></font><code>fetchImageErr (for url: URL?)</code><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/webt/7f/ek/jf/7fekjfrbihaieypuxaovub1-op8.png"><br>
<br><font style="vertical-align: inherit;"></font><code>fetchImageErr</code><font style="vertical-align: inherit;"></font><code>Future</code><font style="vertical-align: inherit;"></font><code>Result</code><font style="vertical-align: inherit;"></font><code>Promise</code><font style="vertical-align: inherit;"></font><code>(Result&lt;Output, Failure&gt;) → Void</code><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/webt/iu/ch/_u/iuch_uvhdkz42-mfyuiuq3jiosg.png"><br>
<br><font style="vertical-align: inherit;"></font><code>Future</code><font style="vertical-align: inherit;"></font><code>AnyPublisher &lt;UIImage?, Error&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在“擦除类型”运算符的帮助下</font></font><code>eraseToAnyPublisher()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来，我们将执行下列步骤，考虑到所有可能出现的错误（我们不会识别错误，那简直是重要的，我们知道有一个错误）：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
0检查</font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于</font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;和&nbsp; </font></font><code>noData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上</font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果是这样，则返回错误，如果不是，传输：</font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过进一步链，</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1.创建一个</font></font><code>dataTaskPublisher(for:)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入为- </font><font style="vertical-align: inherit;">的“发布者” </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且输出值为</font></font><code>Output</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个元组</font></font><code>(data: Data, response: URLResponse)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和一个错误&nbsp; </font></font><code>URLError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2.使用</font></font><code> tryMap { }</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;结果元组</font><font style="vertical-align: inherit;">进行分析</font></font><code>(data: Data, response: URLResponse)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：如果它</font></font><code>response.statusCode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在范围内</font></font><code>200...299</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则为了进行进一步处理，我们仅获取数据&nbsp; </font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。否则，我们会“抛出”错误（无论如何），</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3.我们</font></font><code>map { }</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转换数据</font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font></font><code>UIImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4传递结果到</font></font><code>main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">流，因为我们认为我们将在设计中用到它</font><font style="vertical-align: inherit;">的过程</font></font><code>UI</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -我们“订阅”接收到的“发行人”用</font></font><code>sink</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自己的封闭</font></font><code>receiveCompletion</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>receiveValue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - 5。如果我们</font></font><code>receiveCompletion</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;发现错误</font><font style="vertical-align: inherit;">在封闭&nbsp; </font></font><code>error</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们报告使用它</font></font><code>promise (.failure(error)))</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -在封闭6，&nbsp; </font></font><code>receiveValue </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们告知成功接收的使用物品的阵列</font></font><code> promise (.success($0))</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在可变7.我们记得收到“订阅”&nbsp; </font></font><code>cancellableSet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以保证类实例的“生命周期”内的生存能力</font></font><code>ImageLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
8大家“擦除”的“出版商” TYPE并返回实例</font></font><code>AnyPublisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们回到</font></font><code>ArticleImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用新&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量的地方</font></font><code>noData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果没有图像数据，那么我们将不显示任何内容，即</font></font><code>EmptyView ()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3k/wr/v_/3kwrv_cecjy2f8jea3rgnnpkzri.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最后，我们将把显示</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新闻</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">聚合器</font></a><font style="vertical-align: inherit;">中</font><font style="vertical-align: inherit;">数据的所有可能性打包</font><font style="vertical-align: inherit;">在</font></font><code>TabView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yq/xb/ra/yqxbraupq1d0tgeygy2lb05o4xo.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器获取和解码JSON数据时显示错误&nbsp; </font><font style="vertical-align: inherit;">。</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
访问</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器时，&nbsp; </font><font style="vertical-align: inherit;">可能会发生</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">错误</font></a><font style="vertical-align: inherit;">，例如，由于您指定了错误的密钥，</font></font><code>API-key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者由于开发人员的费用不计任何费用，超出了允许的请求数量或其他原因。同时，</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器&nbsp; </font><font style="vertical-align: inherit;">&nbsp;为您提供</font></font><code>HTTP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码和相应的消息：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_f/2n/zv/_f2nzv5bndlu8auo9cygjyk9fta.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
必须处理这种服务器错误。否则，您的应用程序用户将陷入突然的情况，无缘无故，</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器&nbsp; </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">将</font></a><font style="vertical-align: inherit;"> &nbsp;停止处理任何请求，使用户完全茫然，出现空白屏幕。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
到目前为止，</font><font style="vertical-align: inherit;">从</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">NewsAPI.org</font></a><font style="vertical-align: inherit;">服务器&nbsp; </font><font style="vertical-align: inherit;">选择文章&nbsp; </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和信息来源时&nbsp;</font></font><code>[Source]</code><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;我们忽略了所有错误，并且在错误出现的情况下返回空数组</font></font><code>[Article]()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，&nbsp; </font><font style="vertical-align: inherit;">结果是&nbsp; </font></font><code>[Source]()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从错误处理开始，让我们基于现有的</font></font><code>fetchArticles (from endpoint: Endpoint) -&gt; AnyPublisher&lt;[Article], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;文章选择</font></font><code>NewsAPI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;方法</font><font style="vertical-align: inherit;">在类中创建</font><font style="vertical-align: inherit;">另一个方法</font><font style="vertical-align: inherit;">，该&nbsp; </font><font style="vertical-align: inherit;">方法</font></font><code>fetchArticlesErr (from endpoint: Endpoint) -&gt; AnyPublisher&lt;[Article], NewsError&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不仅将返回文章数组</font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而且还可能返回错误&nbsp; </font></font><code>NewsError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fetchArticlesErr</span><span class="hljs-params">(from endpoint: Endpoint)</span></span> -&gt;
                            <span class="hljs-type">AnyPublisher</span>&lt;[<span class="hljs-type">Article</span>], <span class="hljs-type">NewsError</span>&gt; {<font></font>
<font></font>
. . . . . . . .<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
此方法与方法一样</font></font><code>fetchArticles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，在输入处接受</font></font><code>endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;并返回带有文章数组形式的值的“发布者” </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但不是没有错误</font></font><code>Never</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而是由枚举定义了一个错误</font></font><code>NewsError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/x9/es/ey/x9eseyq8jbapjkmgdoj7aggc6f0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们通过初始化“发布者”开始创建新方法&nbsp; </font></font><code>Future</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，该方法用于</font></font><code>Result</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用闭包</font><font style="vertical-align: inherit;">异步获取单个TYPE值</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">闭包有一个参数- </font></font><code>Promise</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是TYPE的函数&nbsp; </font></font><code>(Result&lt;Output, Failure&gt;) -&gt; Void</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">我们将</font><font style="vertical-align: inherit;">使用“ TYPE Erase”运算符</font><font style="vertical-align: inherit;">将</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3w/bw/ct/3wbwctuso0qweiz3a8qk_h1aiom.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接收</font></font><code>Future</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到的信息转换成我们需要的“ publisher”&nbsp; </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">
在新方法中，</font><font style="vertical-align: inherit;">我们将重复执行该方法中的所有步骤&nbsp;</font></font><code>AnyPublisher &lt;[Article], NewsError&gt;</code><font style="vertical-align: inherit;"></font><code>eraseToAnyPublisher()</code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><code>fetchArticlesErr</code><font style="vertical-align: inherit;"></font><code>fetchArticles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但我们会考虑所有可能的错误：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pb/xz/i0/pbxzi0rn5-cuandt3rtu74ofj8s.png"><br>
<br>
<ul>
<li>0.   endpoint&nbsp; <code>URL endpoint.absoluteURL </code>    , <code> url </code> <code>nil</code>:  <code>nil</code>,    <code>.urlError</code>,   —  <code>url</code>   ,</li>
<li>1.  «» <code>dataTaskPublisher(for:)</code>,     — <code>url</code>,    <code>Output</code>   <code>(data: Data, response: URLResponse)</code>  &nbsp;<code>URLError</code>,</li>
<li>2.    <code>tryMap { }</code>&nbsp;  <code>(data: Data, response: URLResponse)</code>:  <code>response.statusCode</code>    <code>200...299</code>,       &nbsp;<code>data</code>.    «»  <code>.responseError</code>,  &nbsp;&nbsp;<code>data</code>,    <code>String</code>,    ,</li>
<li>3. <code> JSON</code>    ,   &nbsp;<code>NewsResponse</code>,</li>
<li>4.    <code>main</code> ,         <code>UI</code></li>
<li>«»   «»   <code>sink</code>    <code>receiveCompletion</code>  <code>receiveValue</code>,<br>
 <ul>
<li>5.&nbsp; &nbsp;&nbsp;<code>receiveCompletion</code>&nbsp;  <code>error</code>,       <code>promise (.failure(...)))</code>,</li>
<li> 6.&nbsp;&nbsp;&nbsp;<code>receiveValue</code>         <code>promise (.success($0.articles))</code>,</li>
</ul>&nbsp;</li>
<li>7.&nbsp;  «»  &nbsp;<code>var subscriptions</code>,       « »   <code>NewsAPI</code>,</li>
<li>8. «»  «»    <code>AnyPublisher</code>.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
应该注意的是，“发布者”&nbsp; </font></font><code>dataTaskPublisher(for:)</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它的原型的</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">不同之处</font></a></font><code>dataTask</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在于，如果</font><font style="vertical-align: inherit;">不在</font></font><code>response.statusCode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;范围内</font><font style="vertical-align: inherit;">时发生服务器错误</font></font><code>200...299</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它仍然以元组的形式传递成功的值</font></font><code>(data: Data, response: URLResponse)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而不是形式上的错误</font></font><code>(Error, URLResponse?)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。在这种情况下，真实的服务器错误信息包含在中</font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果客户端发生错误（无法与服务器联系，安全系统禁令</font><font style="vertical-align: inherit;">等）</font><font style="vertical-align: inherit;">，则</font><font style="vertical-align: inherit;">“发布者” </font></font><code>dataTaskPublisher(for:)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;将发送错误&nbsp; </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">
如果要在中显示错误</font><font style="vertical-align: inherit;">，则需要相应的</font><font style="vertical-align: inherit;">错误</font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">我们将其称为&nbsp; </font><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">
在</font><font style="vertical-align: inherit;">实现协议</font><font style="vertical-align: inherit;">的类</font><font style="vertical-align: inherit;">中</font><font style="vertical-align: inherit;">，这次我们有四个&nbsp; </font><font style="vertical-align: inherit;">属性：</font></font><code>URLError</code><font style="vertical-align: inherit;"></font><code>ATS</code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><code>SwiftUI</code><font style="vertical-align: inherit;"></font><code>View Model</code><font style="vertical-align: inherit;"></font><code>ArticlesViewModelErr</code><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/webt/em/1o/qy/em1oqy5ob60o8xzmz_-kpdvzs4a.png"><br>
<br><font style="vertical-align: inherit;"></font><code>&nbsp;ArticlesViewModelErr</code><font style="vertical-align: inherit;"></font><code>ObservableObject </code><font style="vertical-align: inherit;"></font><code>@Published</code><font style="vertical-align: inherit;"></font><br>
<br>
<ol>
<li><code>@Published var indexEndpoint: Int</code> —   <code>Endpoint</code> (    «»,     <code> View</code>),&nbsp;</li>
<li><code>@Published var searchString: String</code> —   ,    &nbsp;<code>Endpoint</code>:    «» ,       (      «»,        <code>View</code>),&nbsp;</li>
<li>&nbsp;<code>@Published var articles: [Article]</code>&nbsp;-    ( «»,        &nbsp;<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">NewsAPI.org&nbsp;</a>)</li>
<li>&nbsp;&nbsp;<code>@Published var articlesError: NewsError?</code>&nbsp;-  ,      &nbsp;    &nbsp;<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">NewsAPI.org&nbsp;</a>.</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当您初始化一个类的实例时</font></font><code>ArticlesViewModelErr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们必须再次从输入“ publishers” </font><font style="vertical-align: inherit;">到输出“ publisher”&nbsp; </font><font style="vertical-align: inherit;">扩展一条链，</font></font><code>$indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font><font style="vertical-align: inherit;">用“ Subscriber”对其进行“签名”，从而</font><font style="vertical-align: inherit;">得到很多文章</font><font style="vertical-align: inherit;">或错误&nbsp; </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">
在我们的课堂上，</font><font style="vertical-align: inherit;">我们已经构造了&nbsp; </font><font style="vertical-align: inherit;">一个</font><font style="vertical-align: inherit;">根据值</font><font style="vertical-align: inherit;">返回``发布者''&nbsp; </font><font style="vertical-align: inherit;">的函数</font><font style="vertical-align: inherit;">，我们只需要以某种方式使用``发布者''的值&nbsp; </font><font style="vertical-align: inherit;">并将&nbsp; </font><font style="vertical-align: inherit;">它们变成该函数的参数即可</font><font style="vertical-align: inherit;">。&nbsp; </font><font style="vertical-align: inherit;">
首先，我们将结合“发布者”&nbsp; </font><font style="vertical-align: inherit;">&nbsp;和&nbsp; </font><font style="vertical-align: inherit;">。为此，</font><font style="vertical-align: inherit;">有一个运算符</font><font style="vertical-align: inherit;">：</font></font><code>$searchString</code><font style="vertical-align: inherit;"></font><code>AnyPublisher&lt;[Article],NewsError&gt;</code><font style="vertical-align: inherit;"></font><code>sink</code><font style="vertical-align: inherit;"></font><code>articles</code><font style="vertical-align: inherit;"></font><code>articlesError</code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><code>NewsAPI</code><font style="vertical-align: inherit;"></font><code>fetchArticlesErr (from endpoint: Endpoint)</code><font style="vertical-align: inherit;"></font><code>AnyPublisher&lt;[Article], NewsError&gt;</code><font style="vertical-align: inherit;"></font><code>endpoint</code><font style="vertical-align: inherit;"></font><code>$indexEndpoint</code><font style="vertical-align: inherit;"></font><code>$searchString</code><font style="vertical-align: inherit;"></font><code>endpoint</code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><code>$indexEndpoint</code><font style="vertical-align: inherit;"></font><code>$searchString</code><font style="vertical-align: inherit;"></font><code>Combine</code><font style="vertical-align: inherit;"></font><code>Publishers.CombineLatest</code><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/webt/5i/lz/zh/5ilzzh6h5_aity8uvzd6eladg7q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后，我们必须将错误类型TYPE“ publisher”设置为所需的值&nbsp; </font></font><code>NewsError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/oe/85/tt/oe85tthmperdfzf6yqiy5fmy2b4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来，我们要使用</font></font><code>fetchArticlesErr (from endpoint: Endpoint) </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类中</font><font style="vertical-align: inherit;">的函数&nbsp; </font></font><code>NewsAPI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。像往常一样，我们将在操作员的帮助下执行此操作</font></font><code>flatMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">该操作员&nbsp; </font><font style="vertical-align: inherit;">将根据从先前“发布者”接收到的数据创建一个新的“发布者”：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bh/bu/kx/bhbukxfbhg2q9otl4rp-ksponec.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后，在“订阅者”的帮助下“订阅”该新收到的“发布者” </font></font><code>sink</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并使用其闭包</font></font><code>receiveCompletion</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>receiveValue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以便从“发布者”接收文章数组的值&nbsp; </font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或错误</font></font><code>articlesError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cq/x8/iy/cqx8iyvnwanwmv1vselki10ytv4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
自然地，有必要记住某些外部</font></font><code>init()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量中</font><font style="vertical-align: inherit;">的结果“订阅” </font></font><code>cancellableSet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。否则，我们将无法异步获取该值</font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或错误</font></font><code>articlesError </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完成后</font></font><code>init()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kh/wh/_a/khwh_ao98y7zy9cdpenc0nzvntq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了键入搜索字符串时降低呼叫服务器的数量</font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们不应该使用搜索栏本身的“发行人”&nbsp; </font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但它的修改版本</font></font><code>validString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fl/op/ss/flopssp-pjixvbtesqabmpp1h2s.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
“订阅”异步“发行人”，我们创造了</font></font><code>init( )</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将在类实例的整个“生命周期”中都保持不变&nbsp; </font></font><code>ArticlesViewModelErr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nt/iw/k4/ntiwk4eju6aneam-1wlymjqyu9a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们进行更正</font></font><code> UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以显示其上可能的数据采样错误。在</font></font><code>SwiftU</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I中，在现有结构中，我们&nbsp; </font></font><code>ContentVieArticles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &nbsp;使用另一个刚获得的结构&nbsp; </font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，只是在名称中添加字母“ Err”。这是该类的一个实例。&nbsp;&nbsp;</font></font><code>ArticlesViewModelErr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它“捕获”了从</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器选择和/或解码文章数据的&nbsp; </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">错误</font></a><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kw/vy/uv/kwvyuvbthb08tcalkcdpnucqfbq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
并且，如果出现错误</font></font><code>Alert</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;，</font><font style="vertical-align: inherit;">我们还添加了紧急消息的显示&nbsp; </font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例如，如果错误的API密钥是：</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">APIConstants</span> </span>{
    <span class="hljs-comment">// News  API key url: https://newsapi.org</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> apiKey: <span class="hljs-type">String</span> = <span class="hljs-string">"API_KEY"</span> <font></font>
    <font></font>
   .  .  .  .  .  .  .  .  .  .  .  .  .<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
......然后我们会收到以下消息：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nb/ws/si/nbwssihj8ldlqqtcbti4tjwcv7o.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果请求的限制已经用完，我们会收到以下消息：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cz/de/ux/czdeuxquiscc-6qklciy5a0w3jm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
回到选择文章的方法&nbsp; </font></font><code>[Article] </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有可能出现的错误&nbsp; </font></font><code>NewsError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们可以简化它的代码，如果我们使用&nbsp; </font></font><code>Generic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;“出版商” </font></font><code>AnyPublisher&lt;T,NewsError&gt;,</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该&nbsp; </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接收</font></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息</font><font style="vertical-align: inherit;">异步</font><font style="vertical-align: inherit;">和直接地在</font></font><code>Codable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模型中</font></font><code>T</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;并报告错误&nbsp; </font></font><code>NewsError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lc/v7/m9/lcv7m9fmdbq20ih5phivj7hl1go.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
众所周知，如果该代码的来源数据</font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">NewsAPI.org</font></a></font><code>Endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新闻&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">汇总者</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &nbsp;或国家/地区&nbsp; </font><font style="vertical-align: inherit;">，则很容易使用此代码来获取特定的“发布者”</font></font><code>country</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 信息源，并且输出需要各种模型-例如，文章列表或信息源：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ig/ff/4q/igff4qjqmxcxloixsshjbc36uxy.png"><br>
<br>
<img src="https://habrastorage.org/webt/bh/o_/7n/bho_7nbyxpl5yxth1ihweasjbec.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结论</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们了解到</font></font><code>HTTP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">借助</font></font><code> Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其</font></font><code>URLSession</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“发布者” </font></font><code>dataTaskPublisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">来满足</font><font style="vertical-align: inherit;">请求</font><font style="vertical-align: inherit;">是多么容易</font></font><code>Codable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。如果您不需要跟踪错误，则可</font></font><code> Generic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以为“发布者” </font><font style="vertical-align: inherit;">获得一个非常简单的</font><font style="vertical-align: inherit;">5行代码，该代码</font></font><code>AnyPublisher&lt;T, Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以异步接收</font></font><code>JSON </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息并将其</font><font style="vertical-align: inherit;">&nbsp;基于给定的&nbsp; </font><font style="vertical-align: inherit;">信息直接放置在</font></font><code>Codable </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模型中</font><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">
如果源数据</font><font style="vertical-align: inherit;">是，</font><font style="vertical-align: inherit;">此代码非常容易获得特定的发布者</font><font style="vertical-align: inherit;">，例如</font><font style="vertical-align: inherit;">，并且输出需要各种模型-例如，一组文章或信息源列表。</font><font style="vertical-align: inherit;">
如果您需要考虑错误，那么</font><font style="vertical-align: inherit;">“发布者” </font><font style="vertical-align: inherit;">的代码&nbsp; </font><font style="vertical-align: inherit;">将稍微复杂一些，但是仍然是非常简单的代码，没有任何回调：</font></font><code>T</code><font style="vertical-align: inherit;"></font><code>url</code><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/webt/2i/r_/6w/2ir_6wkuga1u9jcxsmqijle480e.png"><br>
<br><font style="vertical-align: inherit;"></font><code>url </code><font style="vertical-align: inherit;"></font><code>Endpoint</code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><code>Generic</code><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/webt/fi/4d/ep/fi4depxf-hbngki4p5y3ktunbny.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通过使用使用的</font></font><code>HTTP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询</font><font style="vertical-align: inherit;">执行技术</font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您可以创建一个“发布者” </font></font><code>AnyPublisher&lt;UIImage?, Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来异步选择数据并接收UIImage图像吗？基于</font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。图像</font></font><code>ImageLoade</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下载器r缓存在内存中，以避免重复的异步数据检索。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可以在ObservableObject类中非常容易地使获得的各种“发布者”工作，这些类使用它们的@Published属性来控制使用SwiftUI设计的UI。这些类通常具有视图模型的作用，因为它们具有与活动UI元素（TextField，Stepper，Picker文本框，Toggle单选按钮等）相对应的所谓“ input” @Published属性和输出@Published属性，它主要由被动UI元素（文本文本，图像图像，Circle（）几何形状，Rectangle（）等）组成。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这种想法贯穿了</font><font style="vertical-align: inherit;">本文介绍</font><font style="vertical-align: inherit;">的整个</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新闻聚合器</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">应用程序</font></a><font style="vertical-align: inherit;">。相当普遍，在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font></font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TMDb </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">电影</font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">数据库</font></a><font style="vertical-align: inherit;">和</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hacker News</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新闻聚合器&nbsp; </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">开发应用程序</font></a><font style="vertical-align: inherit;">，将在以后的文章中进行讨论。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
本文的应用程序代码在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Github上</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1.我想引起您的注意的事实是，如果您对本文中介绍的应用程序使用模拟器，则应该知道</font></font><code>NavigationLink</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模拟器会出现错误。您可以使用</font></font><code>NavigationLink</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在模拟器上只有1次。</font><font style="vertical-align: inherit;">那些。</font><font style="vertical-align: inherit;">您使用了链接，然后返回，单击相同的链接-没有任何反应。</font><font style="vertical-align: inherit;">在使用另一个链接之前，第一个链接将不起作用，但是第二个链接将变得不可访问。</font><font style="vertical-align: inherit;">但这只能在模拟器上观察到，在真实设备上一切正常。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2.一些信息源仍然</font></font><code>http</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代替</font></font><code>https</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其文章的“图片”。</font><font style="vertical-align: inherit;">如果您确实想查看这些“图片”，但无法控制其外观的来源，则必须配置安全系统</font></font><code>ATS ( App Transport Security)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以接收这些</font></font><code>http</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“图片”，但这当然不是一个</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">好主意</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您可以使用</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更安全的选项</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参考文献：</font></font></h4><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">    HTTP   Swift 5   Combine     SwiftUI.  1 .</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Modern Networking in Swift 5 with URLSession, Combine and Codable.</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">URLSession.DataTaskPublisher’s failure type</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Combine: Asynchronous Programming with Swift</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">«SwiftUI &amp; Combine:  »</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Introducing Combine — WWDC 2019 — Videos — Apple Developer. session 722</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">(  722 «  Combine»   )</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Combine in Practice — WWDC 2019 — Videos — Apple Developer. session 721</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">(  721 «  Combine»   )</a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN488428/index.html">我们如何预测Yandex搜索的未来：从错误修复到发现查询</a></li>
<li><a href="../zh-CN488432/index.html">Snoop Project是Internet情报不可思议的工具，RuNet用户已经等待了很长时间-已提供</a></li>
<li><a href="../zh-CN488436/index.html">快速创建开源Chiptune音乐</a></li>
<li><a href="../zh-CN488438/index.html">电影音频格式的历史：德国人对小型盒带的回答-发展的命运如何</a></li>
<li><a href="../zh-CN488440/index.html">末日之王：两个人如何创建狂热的射击游戏并撼动了视频游戏产业</a></li>
<li><a href="../zh-CN488446/index.html">俄罗斯仪器：我们将您的设计放在手指上</a></li>
<li><a href="../zh-CN488448/index.html">乘坐ITMO University：我们的大师班，讲习班，讲座和学生比赛</a></li>
<li><a href="../zh-CN488450/index.html">新一代的网上银行如何运作</a></li>
<li><a href="../zh-CN488456/index.html">高校的项目活动及其带来的好处</a></li>
<li><a href="../zh-CN488458/index.html">FunCode后端Java / Kotlin挑战：获奖者宣布</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>