<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéä ü§¥ üë©üèæ‚Äç‚öñÔ∏è ¬øQu√© oportunidades ofrece Spring para personalizar su comportamiento? üë®üèª‚Äçüé® üë∏üèº üóëÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos. En contacto Vladislav Rodin. Actualmente, soy el jefe del curso High Load Architect en OTUS, y tambi√©n doy cursos sobre arquitectura de ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>¬øQu√© oportunidades ofrece Spring para personalizar su comportamiento?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/501930/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hola a todos. </font><font style="vertical-align: inherit;">En contacto Vladislav Rodin. </font><font style="vertical-align: inherit;">Actualmente, soy el jefe del curso High Load Architect en OTUS, y tambi√©n doy cursos sobre arquitectura de software. </font></font></i><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adem√°s de la ense√±anza, tambi√©n estoy escribiendo material de copyright para el blog OTUS en el Haber y quiero coincidir con el art√≠culo de hoy para lanzar el curso </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Desarrollador en el Marco de Primavera"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que ahora est√° abierto para reclutamiento.</font></font></i></b><br>
<br>
<img src="https://habrastorage.org/webt/pz/w4/uv/pzw4uv5fvldfmljzvc4v3flumdc.png"><br>
<hr><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introducci√≥n</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desde el punto de vista del lector, el c√≥digo de la aplicaci√≥n que usa Spring parece bastante simple: se declaran algunos beans, las clases se marcan con anotaciones, y luego se inyectan los beans cuando es necesario, todo funciona bien. Pero un lector curioso tiene una pregunta: ‚Äú¬øC√≥mo funciona? ¬øQu√© esta pasando?". En este art√≠culo trataremos de responder esta pregunta, pero no por satisfacer una curiosidad ociosa.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Spring Framework es conocido por ser lo suficientemente flexible y ofrece opciones para personalizar el comportamiento del marco. </font><font style="vertical-align: inherit;">Spring tambi√©n abunda en una serie de reglas bastante interesantes para aplicar ciertas anotaciones (por ejemplo, Transaccional). </font><font style="vertical-align: inherit;">Para comprender el significado de estas reglas, para poder derivarlas, y tambi√©n para comprender qu√© y c√≥mo se puede configurar en Spring, debe comprender varios principios de funcionamiento de lo que hay en Spring bajo el cap√≥. </font><font style="vertical-align: inherit;">Como saben, el conocimiento de varios principios exime del conocimiento de muchos hechos. </font><font style="vertical-align: inherit;">Le sugiero que se familiarice con estos principios a continuaci√≥n si, por supuesto, a√∫n no los conoce.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuraciones de lectura</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al principio, debe analizar las configuraciones que est√°n en su aplicaci√≥n. </font><font style="vertical-align: inherit;">Dado que hay varios tipos de configuraciones (configuraci√≥n xml, groovy, java, configuraci√≥n basada en anotaciones), se utilizan diferentes m√©todos para leerlas. </font><font style="vertical-align: inherit;">De una forma u otra, se recopila un mapa de la forma Map &lt;String, BeanDefinition&gt;, en el que los nombres de beans se asignan a sus definiciones de bean. </font><font style="vertical-align: inherit;">Los objetos de la clase BeanDefinition son metainformaciones sobre beans y contienen la identificaci√≥n del bean, su nombre, su clase, los m√©todos de destrucci√≥n e inicio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ejemplos de clases involucradas en este proceso: GroovyBeanDefinitionReader, XmlBeanDefinitionReader, AnnotatedBeanDefinitionReader, implementando la interfaz </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BeanDefinitionReader</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configurar Beandefinitions</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, tenemos descripciones de beans, pero no hay beans en s√≠ mismos, todav√≠a no se han creado. </font><font style="vertical-align: inherit;">Antes de crear beans, Spring ofrece la posibilidad de personalizar las BeanDefinitions resultantes. </font><font style="vertical-align: inherit;">Para estos fines, se </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utiliza la</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> interfaz </font><b><font style="vertical-align: inherit;">BeanFactoryPostProcessor</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Se parece a esto:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BeanFactoryPostProcessor</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">postProcessBeanFactory</span><span class="hljs-params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="hljs-keyword">throws</span> BeansException</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El par√°metro de m√©todo de esta interfaz permite usar su propio m√©todo getBeanDefinitionNames para obtener los nombres con los que puede obtener BeanDefinitions del mapa y editarlos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øPor qu√© podr√≠a ser necesario? </font><font style="vertical-align: inherit;">Supongamos que algunos beans requieren detalles para conectarse a un sistema externo, como una base de datos. </font><font style="vertical-align: inherit;">Queremos que los beans se creen ya con los detalles, pero los detalles se almacenan en el archivo de propiedades. </font><font style="vertical-align: inherit;">Podemos aplicar uno de los BeanFactoryPostProcessors est√°ndar: PropertySourcesPlaceholderConfigurer, que reemplazar√° la propiedad de nombre en BeanDefinition con el valor real almacenado en el archivo de propiedades. </font><font style="vertical-align: inherit;">Es decir, en realidad reemplazar√° Value ("usuario") con Value ("root") en BeanDefinion. </font><font style="vertical-align: inherit;">Para que esto funcione, el PropertySourcesPlaceholderConfigurer, por supuesto, necesita estar conectado. </font><font style="vertical-align: inherit;">Pero esto no se limita a esto; puede registrar su BeanFactoryPostProcessor, para implementar cualquier l√≥gica que necesite para procesar BeanDefinitions.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Creando Frijoles</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En esta etapa, tenemos un mapa que tiene los nombres de los beans ubicados por las claves, y las BeanDefinitions configuradas por los valores. Ahora necesitas crear estos frijoles. Esto es </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lo que hace BeanFactory</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Pero aqu√≠ puede agregar personalizaci√≥n escribiendo y registrando su </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FactoryBean</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . FactoryBean es una interfaz de la forma:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">FactoryBean</span> </span>{
    <span class="hljs-function">T <span class="hljs-title">getObject</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception</span>;<font></font>
    Class&lt;?&gt; getObjectType();<font></font>
    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isSingleton</span><span class="hljs-params">()</span></span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, un BeanFactory crea un bean en s√≠ mismo si no hay FactoryBean correspondiente a la clase de bean, o le pide a FactoryBean que cree este bean. </font><font style="vertical-align: inherit;">Hay un peque√±o matiz: si el alcance del bean es singleteone, entonces el bean se crea en esta etapa, si es un prototipo, cada vez que se necesite este bean, se solicitar√° a BeanFactory. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, nuevamente obtenemos un mapa, pero ya es un poco diferente: las claves contienen los nombres de los beans y los valores de los beans. </font><font style="vertical-align: inherit;">Pero esto es cierto solo para singletones.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configurando Frijoles</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora viene la etapa m√°s interesante. Tenemos un mapa que contiene los beans creados, pero estos beans a√∫n no se han configurado. Es decir, no procesamos anotaciones que establezcan el estado del bean: Autowired, Value. Tampoco procesamos anotaciones que cambien el comportamiento del bean: Transactional, Async. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BeanPostProcessors</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que nuevamente son implementaciones de la interfaz correspondiente, </font><font style="vertical-align: inherit;">nos permiten resolver este problema </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BeanPostProcessor</span> </span>{
    <span class="hljs-function">Object <span class="hljs-title">postProcessBeforeInitialization</span><span class="hljs-params">(Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException</span>;
    <span class="hljs-function">Object <span class="hljs-title">postProcessAfterInitialization</span><span class="hljs-params">(Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vemos 2 m√©todos con nombres aterradores pero completos. Ambos m√©todos toman un bean como entrada, desde el cual puedes preguntar de qu√© clase es, y luego usar la API de Reflection para procesar anotaciones. M√©todos de devoluci√≥n de beans, posiblemente reemplazados por proxy. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para cada bean antes de colocarlo en el contexto, sucede lo siguiente: los m√©todos postProcessBeforeInitialization se activan para todos los BeanPostProcessors, luego se activa el m√©todo init y luego se activan los m√©todos postProcessAfterInitialization para todos los BeanPostProcessors.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estos dos m√©todos tienen una sem√°ntica diferente: postProcessBeforeInitialization procesa las anotaciones de estado, postProcessAfterInitialization procesa el comportamiento, porque el proxy se usa para procesar el comportamiento, lo que puede conducir a la p√©rdida de anotaciones. Es por eso que el comportamiento cambia en √∫ltimo lugar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øD√≥nde est√° la personalizaci√≥n? Podemos escribir nuestra anotaci√≥n, BeanPostProcessor para ello, y Spring la procesar√°. Sin embargo, para que BeanPostProcessor funcione, tambi√©n debe estar registrado como un bean. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por ejemplo, para incrustar un n√∫mero aleatorio en el campo, creamos una anotaci√≥n InjectRandomInt (colgada en los campos), creamos y registramos un InjectRandomIntBeanPostProcessor, en el primer m√©todo del cual procesamos la anotaci√≥n creada, y en el segundo m√©todo, simplemente devolvemos el bean entrante.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para perfilar los beans, cree una anotaci√≥n de perfil que se transmita a los m√©todos, cree y registre un ProfileBeanPostProcessor, en el primer m√©todo del cual devolveremos el bean entrante, y en el segundo m√©todo, devolveremos un proxy que envuelve la llamada al m√©todo original con registro de tiempo y ejecuci√≥n.</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aprende m√°s sobre el curso</font></font></a><br>
<br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es501914/index.html">Stream Modern Web Live 2020: las mejores pr√°cticas de experiencia de usuario en tiempos indefinidos</a></li>
<li><a href="../es501918/index.html">El libro "Dise√±o de juegos. Recetas para el √©xito de los mejores juegos de computadora, desde Super Mario y Doom hasta Assassin's Creed y m√°s ¬ª</a></li>
<li><a href="../es501922/index.html">IoT donde no esperaste. Desarrollo y pruebas (parte 1)</a></li>
<li><a href="../es501924/index.html">¬øC√≥mo construir un diagrama de Venn con 50 c√≠rculos? Visualizaci√≥n de conjuntos y la historia de mi proyecto Python de c√≥digo abierto</a></li>
<li><a href="../es501928/index.html">PM mitap en l√≠nea con altavoces de Atlassian (Jira), Wrike y Productboard</a></li>
<li><a href="../es501932/index.html">Acelerar la implementaci√≥n de proyectos de IA en la explotaci√≥n forestal Segezha</a></li>
<li><a href="../es501934/index.html">Publicar la biblioteca de dise√±o de componentes VKUI en Figma</a></li>
<li><a href="../es501938/index.html">Prometeo, no vayas: 6 herramientas alternativas de monitoreo para Kubernetes</a></li>
<li><a href="../es501940/index.html">Un poco sobre Neutralino.js</a></li>
<li><a href="../es501942/index.html">M√©todo Kanban: Entendiendo su proceso como un proceso de aprendizaje colectivo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>