<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👸🏻 🎒 👩🏿‍🔧 CI / CDプロセスの更新：octopusデプロイ 🤰 🈵 😉</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="記事の3番目の部分は、CI / CDプロセスの更新についてです。  
 
 この段階で、CIがどのように機能するか、入力で何が得られるか、CIから結果を取得する方法、およびビルド出力が本格的なプロジェクトモジュールになり、開始するために何をする必要があるかを理解しています（少なくとも理解しているはず...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>CI / CDプロセスの更新：octopusデプロイ</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/497112/"><img src="https://habrastorage.org/webt/ll/fr/wq/llfrwqyrix6tk6l50b5sk86rqtm.png" alt="画像" align="left" width="300"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記事の3番目の部分は、CI / CDプロセスの更新についてです。&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この段階で、CIがどのように機能するか、入力で何が得られるか、CIから結果を取得する方法、およびビルド出力が本格的なプロジェクトモジュールになり、開始するために何をする必要があるかを理解しています（少なくとも理解しているはずです）。同様に確立されたタコ（できればLTS）。最後の部分では、teamcityをセットアップするプロセスを検討しました。コードがリポジトリーに入れられた瞬間から、準備ができたアーカイブを解凍できるまで、そして理論的には機能するはずです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
目次を思い出します：</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート1：どういうものか、なぜそうでないのか、計画、ちょっとしたバッシュ。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私はこの部分をほぼテクニカルと呼んでいます。</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート2：teamcity。</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート3：タコの展開。</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パート4：舞台裏。</font><font style="vertical-align: inherit;">不愉快な瞬間、将来の計画、おそらくFAQ。</font><font style="vertical-align: inherit;">ほとんどの場合、ほぼテクニカルと呼ばれることもあります。</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タコ：一般</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
入力にはコード、出力にはアセンブリアーティファクトがあり、ここではすべてが明確です。</font><font style="vertical-align: inherit;">ただし、各モジュールの結果は、コアパッケージ（ビルド自体の結果）と個別パッケージ（一意の構成とライブラリ）の2つの部分で構成されます。</font><font style="vertical-align: inherit;">したがって、特定のモジュールが機能するためには、次のようなものが必要です。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">独自のプールを持ち、ドキュメントルートを「見る」IISのインスタンス。</font><font style="vertical-align: inherit;">モジュールごとに個別のプールが割り当てられます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメントルートのコアパッケージファイル。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメントルート内の個々のパッケージファイル。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この前に、ドキュメントルートの古いコンテンツをバックアップすることをお勧めします。</font><font style="vertical-align: inherit;">もちろん、私たちは自信を持っていますが、人々は2つのタイプに分けられ</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">バックアップしない人と</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すでに</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バックアップしている人</font><font style="vertical-align: inherit;">です。&nbsp;</font></font></li>
<li>  ( )       ( ).    ,     ,   .</li>
<li>   ,    ,    .</li>
<li>   ,   .</li>
<li>    ()    .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それほどではありませんが、十分ではありません。</font><font style="vertical-align: inherit;">手順1で問題はありません。</font><font style="vertical-align: inherit;">OctopusにはIISへの展開テンプレートがあり、必要なものがすべて揃っています。</font><font style="vertical-align: inherit;">手順2と3では、以下で詳しく説明します。</font><font style="vertical-align: inherit;">ステップ4では、プロンプトされた変数で十分です。これはteamcityから渡します。</font><font style="vertical-align: inherit;">手順5はPowerShellスクリプトです。</font><font style="vertical-align: inherit;">また、バックアップをローテーションします。</font><font style="vertical-align: inherit;">それらをすべて保存する必要があるのはなぜですか、古いものは削除できます。</font><font style="vertical-align: inherit;">ステップ6もpowershellです。</font><font style="vertical-align: inherit;">ステップ7-完成したSlack-詳細通知テンプレート。</font><font style="vertical-align: inherit;">ステップ8-再びpowershell。</font><font style="vertical-align: inherit;">計画のように聞こえるので、実装します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">入居者</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ステップ2と3についてもう少し詳しく説明します。読者はタコのデプロイに慣れていると思います。そうでない場合-ハブにすぐそこに素晴らしい（そして唯一の）記事があります彼らは基本的な理解を与えることができます。ここではそれらは：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第二</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。したがって、プロジェクト、インフラストラクチャ、テナント、ライブラリ、現在のタスクと設定のタブがあります。必要-テナント。テナントという単語の直訳はテナントです。この文脈では、おそらく顧客であるクライアントが意図されていました。 Oktopusは、テナントを使用すると、プロジェクトのさまざまなインスタンスを一度に多くのクライアント（テナント）にデプロイできると説明しています。これは彼らのリストのあるページです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gf/u-/xr/gfu-xrcwm5ehwz023dggr3e-vhs.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場合、テナントの使用方法は少し異なります。各テナントは個々のクライアントを表します。テナントには、デプロイ時に起動されるプロジェクトを追加する機会があります。したがって、コアプロジェクトと個別プロジェクトがあります。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各テナントには次の2つのタグがあります。&nbsp; </font></font><br>
<br>
<img src="https://habrastorage.org/webt/k5/iu/0f/k5iu0fknzckzncis11o2y0xmkd4.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後のタコはtimcityからパラメーターとして受信され、現在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デプロイされ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ているモジュール（</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Deploy.EnvおよびDeploy.2</font></a><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">を識別します</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
画面からわかるように、特定の組織にモジュールをデプロイすると、コアプロジェクトが最初に開始されます（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deploy.2 teamcity step</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）、次に個々のプロジェクト（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップdeploy.3およびdeploy.4 teamcity</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">各テナントは、それに含まれるすべてのプロジェクトの変数と、テナント自体の変数（変数セットに収集され、ModNameタグを含む）にアクセスできます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sk/zs/3c/skzs3cxhjryge9jcrvu8alp2skg.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&nbsp;デプロイメントのテナントは、チームで次のように選択されます。&nbsp;</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.tenantRoleTag変数-TenantRole（タコのテナントタグ名）とその実際の値が含まれます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.modName-タコのModNameタグの値。</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変数はプロジェクトの重要な部分であり、正しく構成する必要があります。</font><font style="vertical-align: inherit;">このプロジェクトでは、タコ変数は3つのタイプに分類されます。すべてのプロジェクトに共通（ライブラリセット「環境」に収集）、各プロジェクトに個別（プロジェクトに直接構成）、およびテナント（ライブラリセットにも）から直接変数。</font><font style="vertical-align: inherit;">環境では、すでに述べたように、すべてのプロジェクトに共通するすべてのもの、特に：&nbsp;</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメントルートへのベースパス（たとえば、C：\ inetpub \）;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ベースURL（たとえば、すべてのモジュールの共通ドメインはorganization.comです）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データベースへのアクセス（バックアップを整理するために必要）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
大きなプラスは、各環境のタコに変数値が存在する可能性があることです。分離は何でもかまいません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/59/qx/ag/59qxag_xyk4vlnmqwxgc9tphyuu.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、画面の3、6、7行目です。 3行目が一般的なケースです。本番環境に展開する必要があるすべてがここにあります。 6行目と7行目は、非常に具体的なケースを説明します。たとえば、「CompanyWebsite」ロールの実稼働環境（行6）と、テナントタグ「orgznizationX」の実稼働環境です。これは、たとえば、organizationXの場合、別のサーバーが割り当てられるため、パッケージを取得するサーバーを識別するために必要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロジェクトの変数には、その他すべてが含まれます。</font><font style="vertical-align: inherit;">一般的ではなく、モジュールの完全修飾ドメイン名など、環境によって異なるもの。</font><font style="vertical-align: inherit;">通常、{{Tenant.ModName}。＃{BaseModuleDomain}としてコンパイルされますが、場合によっては異なる場合があります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ne/19/cx/ne19cx7wbn5t0k8rctfcc53-ocq.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&nbsp;まさにそのようなケースが写真に提示されています。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チャンネル</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
チャンネルについて話し合う価値があります。</font><font style="vertical-align: inherit;">簡潔かつ迅速に-チャネルを使用すると、デプロイメントロジックを設定できます。</font><font style="vertical-align: inherit;">非常に簡単です。これは公式ドキュメント、特に</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で説明されてい</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">たとえば、安定したタグのみを持つリリースは、本番チャネルに入ることができます。</font><font style="vertical-align: inherit;">プロジェクトには、環境（開発、テスト、ステージング、本番）と一致する4つのチャネルがあります。</font><font style="vertical-align: inherit;">リリースはプレリリースタグに従ってそれらに分類されます。</font><font style="vertical-align: inherit;">ビルド番号形式teamcity（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">teamcity</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に関する部分の</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Build.General</font></a><font style="vertical-align: inherit;">設定）で</font><font style="vertical-align: inherit;">示されてい</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">teamcityから、チャンネルはステップ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deploy.2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で追加のコマンドライン引数フィールド（--channelパラメーター）に転送されます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パターン</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
teamcityに関する記事を読みながらテンプレートを使用することのすべての利点をまだ理解していない場合は、今がその時です。十分に一般的なカスタムステップをテンプレート化することをお勧めします。編集を行う必要がある場合は、このステップが適用される場所を覚えておいて、同様の場所をクリックして、このステップの使用回数だけ編集を行う必要があります。このプロジェクトでは、サイトの状態をチェックし、ドメインのリストをteamcityに送信するためのテンプレートが作成されました。テンプレートを作成するプロセスを簡単に検討します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
モジュールのデプロイ後に毎回実行する必要があるPowerShellスクリプトがあります。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$url</span> = <span class="hljs-string">"<span class="hljs-variable">$scheme</span>"</span> + <span class="hljs-string">"://"</span> + <span class="hljs-string">"<span class="hljs-variable">$domain</span>"</span>
<span class="hljs-built_in">Write-Host</span> <span class="hljs-string">"Requesting '<span class="hljs-variable">$url</span>'"</span>
[<span class="hljs-type">Net.ServicePointManager</span>]::SecurityProtocol = [<span class="hljs-type">Net.SecurityProtocolType</span>]::Tls12
<span class="hljs-variable">$request</span> = [<span class="hljs-type">System.Net.WebRequest</span>]::Create(<span class="hljs-variable">$url</span>)
<span class="hljs-variable">$request</span>.Timeout = <span class="hljs-variable">$timeout</span>
<span class="hljs-variable">$response</span> = <span class="hljs-variable">$request</span>.GetResponse()
<span class="hljs-variable">$response</span>.Close()
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スクリプトは、入力スキーム、ドメイン、およびタイムアウトを受け入れます。その後、サイトは稼働していないと見なされます。</font><font style="vertical-align: inherit;">ライブラリ-ステップテンプレートでテンプレートを作成できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
名前を入力し、ロゴを選択します。</font><font style="vertical-align: inherit;">次に、入力パラメーターとそのデフォルト値を構成します。</font><font style="vertical-align: inherit;">デフォルト値は、指定された変数の値にすることもできます（変数の値＃{HostName}は、入力パラメーターのデフォルト値＃{Domain}）。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sm/1b/hd/sm1bhd7tlanxkhokj5ykkwndnqy.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、スクリプトを少し変更して、実行ステップとして追加</font></font><br>
<br>
<img src="https://habrastorage.org/webt/an/ae/jo/anaejohklygki3oeyvzdf9wzwf8.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
します。完了。</font><font style="vertical-align: inherit;">出力では、作業に適したステップテンプレートが得られます。また、作業がない場合、同僚はあいまいなスクリプトを読み取らずにフィールド値を把握できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zn/wh/cb/znwhcbju96vpkpnojnkahezaink.png" alt="画像"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タコ：プロセスの詳細</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのプロジェクトはグループに分けられ、モジュールグループの例で説明が行われます。</font><font style="vertical-align: inherit;">次のプロジェクトが含まれています。&nbsp;</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">芯;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">個々のモジュールプロジェクト。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コアプロジェクトから始めましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここに概要ページがあります：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/h1/ej/l8/h1ejl8qvrwpp86te_6pls3nkkwi.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、カーネルのどのバージョンを入手したかを明確に見ることができます。</font><font style="vertical-align: inherit;">バージョン番号の混乱をお詫び申し上げます。現在、gitタグに関連付けられたバージョン管理に切り替えており、本番以外のすべての場所で新しいバージョン管理をすでに使用しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、一部のテナントには定義された環境がありません。</font><font style="vertical-align: inherit;">それらはまだ作成されていないか、予測されていません。&nbsp;</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">展開プロセスのコア</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
カーネル配信の段階では、サービス操作の一部、つまりデータベースのバックアップ（必要な場合）、以前のバージョンのファイルのバックアップ、バックアップのローテーション、カーネルのデプロイも実行されます。&nbsp;</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mq/xe/jn/mqxejndhfnxbgb80o5bvfery-ls.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ステップ1：データベースをバックアップします。</font><font style="vertical-align: inherit;">これはオプションであり、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デプロイ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップのteamcityから</font><font style="vertical-align: inherit;">追加のコマンドライン引数フィールドに</font><font style="vertical-align: inherit;">渡される変数パラメーターの値に基づいています</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">データベースのバックアップはオンデマンドでのみ行う必要があるため、常にではなく、この変数はデフォルトでfalseに設定されています。</font><font style="vertical-align: inherit;">チームシティでは、このパラメーターの変更から開始すると、次のようになります（実行ボタンの横にある省略記号をクリックする必要があります）。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ru/48/s3/ru48s3ycp-wc53-ikai6vjwzqy0.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
タコでは、次のようになります&nbsp; </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ec/ua/xo/ecuaxoycij2hzotqmux4sjjrcmw.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。</font><font style="vertical-align: inherit;">テンプレートによるzip内のファイルのバックアップコピー、バックアップローテーション（スクリプトは少し低くなります）、およびテンプレートによるカーネルデプロイメント。&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意すべき点：&nbsp;</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重要なパラメータはすべて変数によって設定されます。これにより、プロセス設定を深く掘り下げることなく、1つの場所でそれらの値をすばやく変更できます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IISプール名はインスタンス名とサービスドメイン名と一致します（便宜上）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IISの展開ステップでは、既存のバインディングとのマージが置き換えではなくインストールされます。</font><font style="vertical-align: inherit;">サービス1に加えて、各インスタンスにはまだ多数のクライアントドメインがあります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメントルートのクリーンアップ（インストール前にこのディレクトリをチェックマークで削除）は失敗します。</font><font style="vertical-align: inherit;">コピーすると、新しいファイルが古いファイルを置き換えます。</font><font style="vertical-align: inherit;">これは、展開中にサイトが「クラッシュ」しないようにするためです。</font><font style="vertical-align: inherit;">ページの読み込みの遅延は、死の画面よりはるかに優れています。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バックアップローテーションスクリプト：</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$days</span> = <span class="hljs-variable">$OctopusParameters</span>[<span class="hljs-string">"DaysStoreBackups"</span>]
<span class="hljs-variable">$limit</span> = (<span class="hljs-built_in">Get-Date</span>).AddDays(-<span class="hljs-variable">$days</span>)
<span class="hljs-variable">$pathDb</span> = <span class="hljs-variable">$OctopusParameters</span>[<span class="hljs-string">"DbBackupDir"</span>]
<span class="hljs-variable">$pathFiles</span> = <span class="hljs-variable">$OctopusParameters</span>[<span class="hljs-string">"FilesBackupDir"</span>] + <span class="hljs-string">'\'</span> + <span class="hljs-variable">$OctopusParameters</span>[<span class="hljs-string">"HostName"</span>]<font></font>
<font></font>
<span class="hljs-comment"># Delete files older than the $limit.</span>
<span class="hljs-built_in">Get-ChildItem</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$pathDb</span> <span class="hljs-literal">-Recurse</span> <span class="hljs-literal">-Force</span> | <span class="hljs-built_in">Where-Object</span> { !<span class="hljs-variable">$_</span>.PSIsContainer <span class="hljs-operator">-and</span> <span class="hljs-variable">$_</span>.CreationTime <span class="hljs-operator">-lt</span> <span class="hljs-variable">$limit</span> } | <span class="hljs-built_in">Remove-Item</span> <span class="hljs-literal">-Force</span>
<span class="hljs-comment"># Delete any empty directories left behind after deleting the old files.</span>
<span class="hljs-built_in">Get-ChildItem</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$pathDb</span> <span class="hljs-literal">-Recurse</span> <span class="hljs-literal">-Force</span> | <span class="hljs-built_in">Where-Object</span> { <span class="hljs-variable">$_</span>.PSIsContainer <span class="hljs-operator">-and</span> (<span class="hljs-built_in">Get-ChildItem</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$_</span>.FullName <span class="hljs-literal">-Recurse</span> <span class="hljs-literal">-Force</span> | <span class="hljs-built_in">Where-Object</span> { !<span class="hljs-variable">$_</span>.PSIsContainer }) <span class="hljs-operator">-eq</span> <span class="hljs-variable">$null</span> } | <span class="hljs-built_in">Remove-Item</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-Recurse</span><font></font>
<font></font>
<span class="hljs-comment"># Delete files older than the $limit.</span>
<span class="hljs-built_in">Get-ChildItem</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$pathFiles</span> <span class="hljs-literal">-Recurse</span> <span class="hljs-literal">-Force</span> | <span class="hljs-built_in">Where-Object</span> { !<span class="hljs-variable">$_</span>.PSIsContainer <span class="hljs-operator">-and</span> <span class="hljs-variable">$_</span>.CreationTime <span class="hljs-operator">-lt</span> <span class="hljs-variable">$limit</span> } | <span class="hljs-built_in">Remove-Item</span> <span class="hljs-literal">-Force</span>
<span class="hljs-comment"># Delete any empty directories left behind after deleting the old files.</span>
<span class="hljs-built_in">Get-ChildItem</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$pathFiles</span> <span class="hljs-literal">-Recurse</span> <span class="hljs-literal">-Force</span> | <span class="hljs-built_in">Where-Object</span> { <span class="hljs-variable">$_</span>.PSIsContainer <span class="hljs-operator">-and</span> (<span class="hljs-built_in">Get-ChildItem</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$_</span>.FullName <span class="hljs-literal">-Recurse</span> <span class="hljs-literal">-Force</span> | <span class="hljs-built_in">Where-Object</span> { !<span class="hljs-variable">$_</span>.PSIsContainer }) <span class="hljs-operator">-eq</span> <span class="hljs-variable">$null</span> } | <span class="hljs-built_in">Remove-Item</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-Recurse</span>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">個別パッケージの展開プロセス</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
個々のモジュールパッケージの配信の段階で、構成と一意のライブラリが展開され、ファイルが検索または名前変更され、サイトが要求されます（最初に、.net上のサイトが初めて初めてロードされます。この手順により、この手順をすぐに実行でき、次に、理解することができます。サイトの読み込み時にエラーがあるかどうか）。</font><font style="vertical-align: inherit;">通知もslackに送信され、このモジュールに属するすべてのドメインの実際のリストがteamcityに転送されます。&nbsp;</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zh/vk/pr/zhvkprmelbx8edaxft0imsokmja.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要から：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デプロイ手順では、ドキュメントルートはクリーンアップされません（新しいコアパッケージはすでにそこにあります）。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ステップ3、スクリプト。</font><font style="vertical-align: inherit;">テンプレートの説明は少し高かったです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ステップ5. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">teamcityのdeploy.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップ</font><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">も関連付けられてい</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
タコでは、次のようになります。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$baseDomain</span> = <span class="hljs-variable">$OctopusParameters</span>[<span class="hljs-string">"HostName"</span>]
<span class="hljs-variable">$domains</span> = (<span class="hljs-built_in">Get-WebBinding</span> <span class="hljs-variable">$baseDomain</span>).bindingInformation | %{ <span class="hljs-variable">$_</span>.Split(<span class="hljs-string">':'</span>)[<span class="hljs-number">2</span>] } | <span class="hljs-built_in">Sort-Object</span> | <span class="hljs-built_in">Get-Unique</span>
<span class="hljs-built_in">Write-Host</span> <span class="hljs-string">"##teamcity[setParameter name='AllInstanceDomains' value='<span class="hljs-variable">$domains</span>']"</span>
<span class="hljs-built_in">Write-Host</span> <span class="hljs-string">"##teamcity[setParameter name='ServiceDomain' value='<span class="hljs-variable">$baseDomain</span>']"</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
構文</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">## teamcity ...を</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用すると、teamcityでビルドパラメーターを設定できます。</font><font style="vertical-align: inherit;">実際には、このステップは次のようになります。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Write-Host</span> <span class="hljs-string">"All domains on instance %ServiceDomain% :"</span>
<span class="hljs-variable">$domains</span> = <span class="hljs-string">"%AllInstanceDomains%"</span>
<span class="hljs-variable">$domains</span> = <span class="hljs-variable">$</span>(<span class="hljs-variable">$domains</span>.Split(<span class="hljs-string">" "</span>) | <span class="hljs-built_in">ForEach-Object</span> {<span class="hljs-string">"http://<span class="hljs-variable">$_</span>"</span>} | <span class="hljs-built_in">Out-String</span>)
<span class="hljs-built_in">Write-Host</span> <span class="hljs-variable">$domains</span>
<span class="hljs-built_in">Write-Host</span> <span class="hljs-string">"Service domain: http://%ServiceDomain%"</span>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タコ：結果</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
全体のビルドプロセスは次のとおりです。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コードは特定のブランチ（環境に対応）から収集されます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アセンブリ（アーティファクト）の結果はタコに渡され、カーネルと個別のモジュールパッケージの2つの部分で構成されます。</font><font style="vertical-align: inherit;">これにより、ディスク領域の効率的な使用が可能になり、全体的な更新配信時間を節約できます。&nbsp;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各パッケージには、番号と、このリリースが適用されるチャネルと環境を定義するプレリリースタグで構成されるバージョンがあります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Octopusは、入力によってリリースを作成し、組織データ（テナントタグ）、チャネル（プレリリースタグ）、および追加の指示（オプションでデータベースのバックアップ）に案内されて、適切なサーバーにパケットを配信し、モジュールのパフォーマンスの基本的なチェックも行います。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そんな感じです。</font><font style="vertical-align: inherit;">おそらく、別の技術に近い記事、いわば舞台裏があります。</font><font style="vertical-align: inherit;">ここには入力しなかったすべてのものが含まれます。詳細、作業の過程で新しくなったもの、これを決定した人が直面する可能性のあること、プロジェクトの修正と更新、よくある質問/回答など。</font><font style="vertical-align: inherit;">ご清聴ありがとうございました。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja497098/index.html">世界でビデオ分析のコンバインハーベスターの最初の自動操縦をどのように作成したか</a></li>
<li><a href="../ja497100/index.html">Jupyterを軌道LXDで起動する</a></li>
<li><a href="../ja497106/index.html">ネットワークシミュレータチュートリアルns-3。1.2章</a></li>
<li><a href="../ja497108/index.html">Covid-2019との戦い：大転換</a></li>
<li><a href="../ja497110/index.html">ゲームに関するビデオクリップに声優が必要ですか？</a></li>
<li><a href="../ja497114/index.html">Пора на свалку</a></li>
<li><a href="../ja497116/index.html">Starsky Roboticsの無人トラックが終了</a></li>
<li><a href="../ja497118/index.html">[予報]無人トラックはすべて終わりますか、それともStarsky Roboticsだけですか？</a></li>
<li><a href="../ja497126/index.html">バックログのスコアリングと優先順位付けの手法</a></li>
<li><a href="../ja497132/index.html">#SaveFirstイニシアチブで社会的に重要なプロジェクトをサポート</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>