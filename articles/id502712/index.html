<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸŒ— ğŸš– ğŸ¤šğŸ¿ Bagaimana cara kerja alamat strip dipimpin? ğŸ‘ ğŸ–ğŸ¼ ğŸ‘ˆ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mungkin pertanyaan ini "bagaimana cara kerjanya" tampaknya konyol bagi banyak orang. Jawabannya hampir jelas: strip LED yang dapat dialamatkan terdiri...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Bagaimana cara kerja alamat strip dipimpin?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/502712/"><img src="https://habrastorage.org/webt/vo/6r/d2/vo6rd2jupdaxgzun1zl3_iyp-k4.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mungkin pertanyaan ini "bagaimana cara kerjanya" tampaknya konyol bagi banyak orang. Jawabannya hampir jelas: strip LED yang dapat dialamatkan terdiri dari sejumlah "smart LED" yang dihubungkan secara seri. Ini dapat dilihat hanya dengan melihat perangkat rekaman. Anda dapat melihat masing-masing sirkuit mikro disolder ke kabel yang fleksibel, Anda dapat melihat sambungannya: sirkuit mikro terhubung secara seri dengan hanya tiga kabel, dan dua di antaranya adalah daya dan ground. Hanya satu kawat mentransmisikan data warna piksel. Bagaimana itu? Apa itu LED pintar? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selanjutnya, saya akan berbicara tentang protokol transfer data yang digunakan dalam strip LED berdasarkan WS2812B, dan, lebih lanjut, saya hampir akan membuat "chip strip LED" saya sendiri dalam chip FPGA.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, rekaman itu menggunakan transmisi serial melalui sinyal data tunggal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bit nol ditransmisikan sebagai impuls positif pendek dan jeda, yang kira-kira dua kali lebih lebar dari denyut nadi. Unit bit ditransmisikan sebagai impuls positif lebar dan jeda singkat: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6n/e9/d-/6ne9d-mfj_ah8zurj1i6fnrevgy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika tidak ada transmisi lebih dari 50 mikrodetik, pita kembali ke keadaan semula, siap menerima piksel mulai dari yang pertama. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setiap 24 bit secara berurutan adalah 3 byte untuk tiga warna RGB. Dan faktanya urutannya adalah GRB. Bit G7 yang tinggi diutamakan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Urutan 24 bit pertama adalah satu piksel, yang akan menerima LED pertama dalam rekaman itu. Sampai LED pertama jenuh, itu tidak mentransfer data lebih jauh ke LED berikutnya. Setelah LED pertama menerima bagiannya dari 24x RGB bits, ia membuka transmisi ke yang berikutnya. Secara primitif, orang dapat membayangkan urutan LED sebagai riam kendi yang berturut-turut diisi dengan air: Yang </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pv/8d/rz/pv8drz6goxvaujnutaw38e0tvbi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pertama, kemudian yang kedua, kemudian yang ketiga, dan seterusnya, akan terisi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, saya percaya bahwa protokol transfer telah disortir.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apakah mungkin untuk mencoba merancang "LED pintar" seperti itu sendiri? Tentu saja, ini masuk akal praktis, tetapi untuk pendidikan diri dan memperluas wawasan seseorang, ini adalah tugas yang menarik. Mari kita coba untuk menggambarkan logika chip dalam bahasa pemrograman Verilog HDL. Tentu saja, ini bukan desain chip nyata, akan ada batasan. Salah satu batasan paling penting - saya akan memerlukan jam eksternal untuk sirkuit mikro saya. Dalam LED cerdas nyata, generator seperti itu juga ada, tetapi sudah terintegrasi ke dalam chip. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita mulai modul Verilog seperti ini:</font></font><br>
<br>
<pre><code class="vhdl hljs">module WS2812B(<font></font>
	input wire clk,<font></font>
	input wire <span class="hljs-keyword">in</span>,<font></font>
	output wire <span class="hljs-keyword">out</span>,<font></font>
	output reg r,<font></font>
	output reg g,<font></font>
	output reg b<font></font>
);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya pikir semuanya jelas di sini: frekuensi clock clk, sinyal input dan output dari "LED pintar" masuk dan keluar, dan, tentu saja, sinyal output r, g, b di mana saya akan mengontrol LED eksternal nyata merah, hijau dan biru. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya akan menangkap sinyal input dalam register geser dua-bit dan dari keadaan saat ini dalam bit yang ditangkap ini, saya dapat menentukan awal dari tepi positif sinyal di:</font></font><br>
<br>
<pre><code class="vhdl hljs">reg [<span class="hljs-number">1</span>:<span class="hljs-number">0</span>]r_in = <span class="hljs-number">0</span>;<font></font>
always @( posedge clk )<font></font>
	r_in &lt;= { r_in[<span class="hljs-number">0</span>],<span class="hljs-keyword">in</span> };<font></font>
<font></font>
wire in_pos_edge; assign in_pos_edge = (r_in==<span class="hljs-number">2</span><span class="hljs-symbol">'b01</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selain itu, penting untuk menentukan status reset pita ketika pengontrol kontrol berhenti sebelum memulai transmisi baru:</font></font><br>
<br>
<pre><code class="vhdl hljs">localparam reset_level = <span class="hljs-number">3000</span>;<font></font>
reg [<span class="hljs-number">15</span>:<span class="hljs-number">0</span>]reset_counter = <span class="hljs-number">0</span>;<font></font>
always @( posedge clk )<font></font>
	<span class="hljs-keyword">if</span>( r_in[<span class="hljs-number">0</span>] )<font></font>
		reset_counter &lt;= <span class="hljs-number">0</span>;
	<span class="hljs-keyword">else</span>
	<span class="hljs-keyword">if</span>( reset_counter&lt;reset_level )<font></font>
		reset_counter &lt;= reset_counter+<span class="hljs-number">1</span>;<font></font>
<font></font>
wire reset; assign reset = (reset_counter==reset_level);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selanjutnya, dari sisi positif in_pos_edge, Anda perlu menahan beberapa jeda untuk mendapatkan momen memperbaiki bit baru:</font></font><br>
<br>
<pre><code class="vhdl hljs">localparam fix_level   = <span class="hljs-number">50</span>;<font></font>
reg [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>]bit_length_cnt;<font></font>
always @( posedge clk )<font></font>
	<span class="hljs-keyword">if</span>( in_pos_edge )<font></font>
		bit_length_cnt &lt;= <span class="hljs-number">0</span>;
	<span class="hljs-keyword">else</span>
	<span class="hljs-keyword">if</span>( bit_length_cnt&lt;(fix_level+<span class="hljs-number">1</span>) &amp;&amp; !pass )<font></font>
		bit_length_cnt &lt;= bit_length_cnt + <span class="hljs-number">1</span>;<font></font>
<font></font>
wire bit_fix; assign bit_fix = (bit_length_cnt==fix_level);<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jumlah bit yang sudah diterima dalam chip dianggap sebagai berikut:</font></font><br>
<br>
<pre><code class="vhdl hljs">reg pass = <span class="hljs-number">0</span>;<font></font>
reg [<span class="hljs-number">5</span>:<span class="hljs-number">0</span>]bits_captured = <span class="hljs-number">0</span>;<font></font>
<font></font>
always @( posedge clk )<font></font>
	<span class="hljs-keyword">if</span>( reset )<font></font>
		bits_captured &lt;= <span class="hljs-number">1</span><span class="hljs-symbol">'b0</span>;
	<span class="hljs-keyword">else</span>
	<span class="hljs-keyword">if</span>( ~pass &amp;&amp; bit_fix )<font></font>
		bits_captured &lt;= bits_captured+<span class="hljs-number">1</span><span class="hljs-symbol">'b1</span>;</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sinyal lulus penting diperkenalkan di sini, yang hanya menentukan pengalihan aliran input ke output. </font><font style="vertical-align: inherit;">Setelah menerima bit 24x piksel, sinyal lulus diatur ke satu:</font></font><br>
<br>
<pre><code class="vhdl hljs">always @( posedge clk )
	<span class="hljs-keyword">if</span>( reset )<font></font>
		pass &lt;= <span class="hljs-number">1</span><span class="hljs-symbol">'b0</span>;
	<span class="hljs-keyword">else</span>
	<span class="hljs-keyword">if</span>( bits_captured==<span class="hljs-number">23</span> &amp;&amp; bit_fix )<font></font>
		pass &lt;= <span class="hljs-number">1</span><span class="hljs-symbol">'b1</span>;<font></font>
		<font></font>
reg pass_final;<font></font>
always @( posedge clk )<font></font>
	<span class="hljs-keyword">if</span>( reset )<font></font>
		pass_final &lt;= <span class="hljs-number">1</span><span class="hljs-symbol">'b0</span>;
	<span class="hljs-keyword">else</span>
	<span class="hljs-keyword">if</span>( r_in!=<span class="hljs-number">2</span><span class="hljs-symbol">'b11</span> )<font></font>
		pass_final &lt;= pass;<font></font>
		<font></font>
assign <span class="hljs-keyword">out</span> = pass_final ? <span class="hljs-keyword">in</span> : <span class="hljs-number">1</span><span class="hljs-symbol">'b0</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Input out adalah multiplexed ke output ketika sinyal pass_final adalah satu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yah, tentu saja, kita perlu register geser, tempat 24 bit piksel yang diterima terakumulasi:</font></font><br>
<br>
<pre><code class="vhdl hljs">reg [<span class="hljs-number">23</span>:<span class="hljs-number">0</span>]shift_rgb;<font></font>
always @( posedge clk )<font></font>
	<span class="hljs-keyword">if</span>( bit_fix )<font></font>
		shift_rgb &lt;= { <span class="hljs-keyword">in</span>, shift_rgb[<span class="hljs-number">23</span>:<span class="hljs-number">1</span>] };<font></font>
<font></font>
reg [<span class="hljs-number">23</span>:<span class="hljs-number">0</span>]fix_rgb;<font></font>
always @( posedge clk )<font></font>
	<span class="hljs-keyword">if</span>( bits_captured==<span class="hljs-number">23</span> &amp;&amp; bit_fix )<font></font>
		fix_rgb &lt;= { <span class="hljs-keyword">in</span>, shift_rgb[<span class="hljs-number">23</span>:<span class="hljs-number">1</span>] };</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah menerima semua 24 bit, mereka juga disalin ke register 24 bit terakhir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang masalahnya tetap kecil. </font><font style="vertical-align: inherit;">Penting untuk menerapkan sinyal PWM (Latitudinal Pulse Modulation) untuk mengirimkan kecerahan ke LED eksternal nyata sesuai dengan byte RGB yang diterima:</font></font><br>
<br>
<pre><code class="vhdl hljs">wire [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>]wgreen; assign wgreen = { fix_rgb[<span class="hljs-number">0</span> ], fix_rgb[<span class="hljs-number">1</span> ], fix_rgb[<span class="hljs-number">2</span> ], fix_rgb[<span class="hljs-number">3</span> ], fix_rgb[<span class="hljs-number">4</span> ], fix_rgb[<span class="hljs-number">5</span> ], fix_rgb[<span class="hljs-number">6</span> ], fix_rgb[<span class="hljs-number">7</span> ] };<font></font>
wire [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>]wred;   assign wred   = { fix_rgb[<span class="hljs-number">8</span> ], fix_rgb[<span class="hljs-number">9</span> ], fix_rgb[<span class="hljs-number">10</span>], fix_rgb[<span class="hljs-number">11</span>], fix_rgb[<span class="hljs-number">12</span>], fix_rgb[<span class="hljs-number">13</span>], fix_rgb[<span class="hljs-number">14</span>], fix_rgb[<span class="hljs-number">15</span>] };<font></font>
wire [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>]wblue;  assign wblue  = { fix_rgb[<span class="hljs-number">16</span>], fix_rgb[<span class="hljs-number">17</span>], fix_rgb[<span class="hljs-number">18</span>], fix_rgb[<span class="hljs-number">19</span>], fix_rgb[<span class="hljs-number">20</span>], fix_rgb[<span class="hljs-number">21</span>], fix_rgb[<span class="hljs-number">22</span>], fix_rgb[<span class="hljs-number">23</span>] };<font></font>
<font></font>
reg [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>]pwm_cnt;<font></font>
<font></font>
always @( posedge clk )<font></font>
<span class="hljs-keyword">begin</span>
	pwm_cnt &lt;= pwm_cnt+<span class="hljs-number">1</span>;<font></font>
	r &lt;= pwm_cnt&lt;wred;<font></font>
	g &lt;= pwm_cnt&lt;wgreen;<font></font>
	b &lt;= pwm_cnt&lt;wblue;<font></font>
<span class="hljs-keyword">end</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sepertinya hanya itu saja. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Detail kecil tetap - bagaimana mengalami semuanya? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya mengambil beberapa motherboard sederhana dengan FPGA MAX II (ini adalah kartu seri Mars rover) dan mem-flash semuanya dengan proyek dengan kode Verilog ini. Sudah ada 8 LED di papan, tapi semuanya berwarna kuning. Pada masing-masing papan, saya mengganti 3 LED dengan R, G, B. Saya menghubungkan papan secara seri dan, apalagi, menghubungkannya ke strip LED nyata. Jadi, saya memperpanjang rekaman nyata dengan LED buatan saya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Koneksi ini berubah seperti ini: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-u/5k/sh/-u5kshz_kj4zwuj1uewj7wstrdk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada kenyataannya, terlihat seperti ini: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/v1/rm/qt/v1rmqtb1_pbswak3fy8ewtl0-k0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang, menerapkan gambar tertentu ke kaset, saya melihat bahwa "LED pintar" saya berperilaku persis sama dengan yang asli dari rekaman itu:</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/s7GkTgyDVCc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ternyata logika yang saya implementasikan dalam FPGA berfungsi penuh! </font><font style="vertical-align: inherit;">Sebagai perkiraan pertama, saya bisa melakukan sesuatu yang mirip dengan chip LED pintar nyata. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebenarnya, saya suka strip LED. </font><font style="vertical-align: inherit;">Atas dasar mereka, setiap orang dapat menciptakan sesuatu sendiri: pencahayaan cerdas, layar, efek ambilight. </font><font style="vertical-align: inherit;">Suatu kali saya bahkan menerapkan musik berwarna pada pita LED yang menjalankan FPGA. </font><font style="vertical-align: inherit;">Tapi itu </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cerita lain</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id502696/index.html">Bagaimana Penyedia Layanan Internet Menghindari Pemadaman Global Selama Wabah</a></li>
<li><a href="../id502700/index.html">Pencipta Stack Overflow: "Pengembanglah yang menulis skrip untuk masa depan"</a></li>
<li><a href="../id502702/index.html">Tentang menyimpan token JWT di browser</a></li>
<li><a href="../id502704/index.html">Bagaimana kami melatih kembali dukungan untuk berbicara secara manusiawi, dan apa yang terjadi</a></li>
<li><a href="../id502706/index.html">Keadaan soft skill</a></li>
<li><a href="../id502714/index.html">Ekspor data OpenStreetMap menggunakan editor visual di rete.js</a></li>
<li><a href="../id502716/index.html">Tidak dapat berbagi komputer di rumah Anda? Buat satu dari dua</a></li>
<li><a href="../id502718/index.html">Proyek Talking Head, atau sejarah pengembangan perangkat lunak untuk robot telepresence</a></li>
<li><a href="../id502720/index.html">Tren Pengujian untuk Diperhatikan pada 2020</a></li>
<li><a href="../id502722/index.html">Lembah Silikon dalam bahasa Rusia. Bagaimana # ITX5 bekerja di Innopolis</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>