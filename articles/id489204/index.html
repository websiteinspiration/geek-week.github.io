<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ™ŒğŸ¾ ğŸ¥‘ ğŸ‘©â€ğŸ‘¦ Pandangan dari Dalam tentang Keandalan Layanan Facebook ğŸ˜’ ğŸš£ğŸ¾ ğŸ‘©ğŸ½â€ğŸ¤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ketika Facebook "berbohong", orang berpikir itu karena peretas atau serangan DDoS, tetapi itu bukan. Semua "jatuh" selama beberapa tahun terakhir tela...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Pandangan dari Dalam tentang Keandalan Layanan Facebook</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/489204/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ketika Facebook "berbohong", orang berpikir itu karena peretas atau serangan DDoS, tetapi itu bukan. Semua "jatuh" selama beberapa tahun terakhir telah disebabkan oleh perubahan internal atau gangguan. Untuk mengajari karyawan baru agar tidak melanggar Facebook dengan contoh, semua insiden besar diberi nama, misalnya, "Panggil Polisi" atau "CAPSLOCK". Yang pertama dinamai karena ketika suatu hari jaringan sosial jatuh, pengguna menelepon polisi Los Angeles dan meminta untuk memperbaikinya, dan sheriff putus asa di Twitter meminta untuk tidak mengganggu mereka tentang hal ini. Selama insiden kedua pada mesin cache, antarmuka jaringan turun dan tidak naik, dan semua mesin restart dengan tangan. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elina Lobanova</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">telah bekerja di Facebook selama 4 tahun terakhir di tim Web Foundation. Anggota tim disebut insinyur produksi dan memantau keandalan dan kinerja seluruh backend, mengeluarkan Facebook saat aktif, menulis pemantauan dan otomatisasi untuk membuat hidup lebih mudah bagi diri mereka sendiri dan orang lain. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jf/9x/nj/jf9xnjbzmqg3ufk-km_bqmgkrya.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam sebuah artikel berdasarkan laporan Elina tentang </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HighLoad ++ 2019</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , kami akan </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;">menunjukkan</font></a><font style="vertical-align: inherit;"> bagaimana para insinyur produksi memantau backend Facebook, alat apa yang mereka gunakan, yang menyebabkan crash besar dan bagaimana menghadapinya.</font></font><br>
<a name="habracut"></a><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/wuV5DLiUuaI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nama saya Elina, hampir 5 tahun yang lalu saya dipanggil di Facebook sebagai pengembang biasa, tempat saya pertama kali menemukan sistem yang sarat muatan - ini tidak diajarkan di institut. </font><font style="vertical-align: inherit;">Perusahaan tidak menyewa tim, tetapi kantor, jadi saya tiba di London, memilih tim yang memantau pekerjaan facebook.com dan berada di antara insinyur produksi.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Insinyur Produksi</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk memulai, saya akan memberi tahu Anda apa yang kami lakukan dan mengapa kami disebut Insinyur Produksi, dan bukan SRE seperti Google, misalnya.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2009. SRE</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Model standar yang masih digunakan di banyak perusahaan adalah "pengembang - penguji - operasi". </font><font style="vertical-align: inherit;">Seringkali mereka terpecah: mereka duduk di lantai yang berbeda, kadang-kadang bahkan di negara yang berbeda, dan tidak saling berkomunikasi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada 2009, Facebook sudah memiliki SRE. </font><font style="vertical-align: inherit;">Di Google, SRE memulai lebih awal, mereka tahu cara mencapai DevOps, dan telah menuliskannya di buku mereka â€œ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rekayasa Keandalan Situs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> â€. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6h/o6/1l/6ho61luejwigg_bb6v_7441tlty.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di Facebook pada tahun 2009, tidak ada yang seperti ini. </font><font style="vertical-align: inherit;">Kami dipanggil SRE, tetapi kami melakukan pekerjaan yang sama dengan Ops di seluruh dunia: tenaga kerja manual, tanpa otomatisasi, penyebaran semua layanan dengan tangan Anda, memantau entah bagaimana, hanya memanggil semua, seperangkat skrip shell.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2010. SRO dan AppOps</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini semua tidak skala, karena jumlah pengguna pada waktu itu tumbuh 3 kali per tahun, dan jumlah layanan bertambah. </font><font style="vertical-align: inherit;">Pada tahun 2010, keputusan yang keras dari Ops dibagi menjadi dua kelompok. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kelompok pertama adalah </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SRO</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , di mana "O" adalah "operasi", yang terlibat dalam pengembangan, otomatisasi, dan pemantauan situs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kelompok kedua adalah </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AppOps</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mereka diintegrasikan ke dalam tim, masing-masing untuk layanan besar. </font><font style="vertical-align: inherit;">AppOps sudah dekat dengan ide DevOps. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pemisahan untuk sementara waktu menyelamatkan semua orang.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2012. Insinyur Produksi</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada 2012, AppOps hanya mengganti nama </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">insinyur produksi</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Selain namanya, tidak ada yang berubah, tetapi telah menjadi lebih nyaman. </font><font style="vertical-align: inherit;">Saat Anda memanggil kapal pesiar, kapal itu akan berlayar, dan kami tidak ingin berlayar seperti Ops. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SRO masih ada, Facebook tumbuh, dan memonitor semua layanan sekaligus sulit. </font><font style="vertical-align: inherit;">Seseorang yang dipanggil bahkan tidak diizinkan pergi ke toilet: dia meminta seseorang untuk menggantikannya, karena dia terus-menerus terbakar.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2014. Menutup SRO</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada satu titik, pihak berwenang memindahkan semua orang untuk menelepon. </font><font style="vertical-align: inherit;">"Semua orang" berarti pengembang juga: tulis kode Anda, inilah Anda dan jawab untuk kode ini! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Insinyur produksi telah diintegrasikan ke dalam tim yang paling penting untuk bantuan, dan sisanya tidak beruntung. </font><font style="vertical-align: inherit;">Kami mulai dengan tim besar dan dalam beberapa tahun mentransfer semua orang di Facebook ke panggilan. </font><font style="vertical-align: inherit;">Di antara pengembang ada kegembiraan besar: seseorang berhenti, seseorang menulis posting yang buruk. </font><font style="vertical-align: inherit;">Tapi semuanya tenang, dan pada 2014 SRO ditutup karena tidak diperlukan lagi. </font><font style="vertical-align: inherit;">Jadi kita hidup sampai hari ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kata "SRE" di perusahaan itu terkenal, tetapi kami terlihat seperti SRE di Google. </font><font style="vertical-align: inherit;">Ada perbedaan.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">selalu dibangun dalam tim. </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami tidak memiliki pencarian SRE secara umum, seperti di Google, ini untuk setiap layanan pencarian secara terpisah.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tidak dalam produk</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , hanya dalam infrastruktur yang dikelola sendiri oleh produk.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">terhubung</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dengan pengembang.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami memiliki sedikit lebih banyak pengalaman dalam sistem dan jaringan, jadi kami </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fokus pada pemantauan</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan memadamkan layanan ketika mereka menyala dengan cerah. </font><font style="vertical-align: inherit;">Kami memperbaiki kesalahan sebelumnya yang dapat menyebabkan kerusakan dan memengaruhi arsitektur layanan baru sejak awal, sehingga nantinya dapat berfungsi dengan baik dalam produksi.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pemantauan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Itu yang paling penting. </font><font style="vertical-align: inherit;">Bagaimana kita melakukan ini? </font><font style="vertical-align: inherit;">Seperti semua orang: tanpa sihir hitam, di rumah mereka sendiri. </font><font style="vertical-align: inherit;">Tetapi iblis, seperti biasa, akan memberi tahu Anda tentang mereka secara terperinci.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DI ATAS</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita mulai dari bawah. Semua orang tahu TOP di Linux, dan kami menggunakan ATOP, di mana "A" "maju" - monitor kinerja sistem. Manfaat utama ATOP adalah menyimpan riwayat: Anda dapat mengonfigurasinya untuk menyimpan snapshot ke disk. ATOP kami beroperasi pada semua mesin setiap 5 detik. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berikut adalah contoh server yang menjalankan PHP backend untuk facebook.com. Kami menulis mesin virtual kami untuk mengeksekusi kode PHP, itu disebut </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HHVM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (HipHop Virtual Machine). Menurut metrik yang diekspor, kami menemukan bahwa beberapa mesin tidak memproses hampir satu permintaan dalam satu menit. Mari kita lihat mengapa, buka ATOP 30 detik sebelum hang.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/p2/vt/wf/p2vtwfqsucdo-shyennmf64opy8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dapat dilihat bahwa dengan masalah prosesor, kami memuatnya terlalu banyak. </font><font style="vertical-align: inherit;">Ada juga masalah dengan memori, hanya 1,5 GB yang tersisa di cache, dan setelah 5 detik hanya 800 MB. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dz/q-/_x/dzq-_x7xjizrcgynj3gdayuh8u0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah 5 detik berikutnya, CPU dibebaskan, tidak ada yang dijalankan. </font><font style="vertical-align: inherit;">ATOP mengatakan lihat garis bawahnya, kita menulis ke disk, tapi apa? </font><font style="vertical-align: inherit;">Ternyata kami menulis swap. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4z/-j/v1/4z-jv12mgthgjnezqlvbznu6ync.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Siapa yang melakukan ini? </font><font style="vertical-align: inherit;">Proses yang diambil dari memori 0,5 GB dan dimasukkan ke swap. </font><font style="vertical-align: inherit;">Di tempat mereka muncul dua proses Python yang mencurigakan, yang kemudian dapat dilihat sebagai baris perintah.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8y/ej/uk/8yejuk2y3eeswlw7astqbiaaste.jpeg"><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ATOP itu indah, kami menggunakannya terus-menerus.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika Anda tidak memilikinya, saya sangat merekomendasikan menggunakannya. </font><font style="vertical-align: inherit;">Jangan takut untuk drive, ATOP makan hanya 200-300 MB per hari setiap 5 detik.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP Malloc</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kepada Bahama dan insiden besar, kami memberi nama. Ada satu bug menyenangkan yang terkait dengan ATOP yang disebut Malloc HTTP. Kami memulai debutnya dengan ATOP dan strace. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menggunakan barang bekas di mana-mana sebagai RPC. Dalam versi awal parsernya ada bug luar biasa yang bekerja seperti ini: sebuah pesan tiba di mana 4 byte pertama adalah ukuran data, lalu data itu sendiri, dan byte pertama ditambahkan ke pesan berikutnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tapi begitu salah satu program daripada pergi ke layanan Thrift, saya pergi ke HTTP, dan mendapat respon Â«HTTP Bad MemintaÂ»: </font></font><code>HTTP/1.1 400</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah itu mengambil HTTP dan dialokasikan menggunakan malloc HTTP jumlah byte.</font></font><br>
<br>
<pre><code class="bash hljs">Thrift message<font></font>
HTTP/1.1 400<font></font>
<span class="hljs-string">"HTTP"</span> == 0x48545450</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tidak apa-apa, kami memiliki overkomit, mari mengalokasikan lebih banyak memori! </font><font style="vertical-align: inherit;">Kami dialokasikan dengan malloc, dan sampai kami menulis dan membaca di sana, mereka tidak akan memberi kami memori nyata. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tapi itu tidak ada di sana! </font><font style="vertical-align: inherit;">Jika kita ingin melakukan fork, fork akan mengembalikan kesalahan - tidak ada cukup memori.</font></font><br>
<br>
<pre><code class="bash hljs">malloc(<span class="hljs-string">"HTTP"</span>)<font></font>
pid = fork(); // errno = ENOMEM</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tapi mengapa, ada ingatan? </font><font style="vertical-align: inherit;">Memahami manual, kami menemukan bahwa semuanya sangat sederhana: konfigurasi overcommit saat ini sedemikian rupa sehingga merupakan heuristik ajaib, dan kernel itu sendiri memutuskan kapan banyak dan kapan tidak:</font></font><br>
<br>
<pre><code class="bash hljs">malloc(<span class="hljs-string">"HTTP"</span>)<font></font>
pid = fork(); // errno = ENOMEM<font></font>
<font></font>
// 0: heuristic overcommit<font></font>
vm.overcommit_memory = 0</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk proses kerja, ini normal, Anda dapat memilih malloc hingga TB, tetapi untuk proses baru - tidak. </font><font style="vertical-align: inherit;">Dan bagian dari pemantauan pada kami terkait dengan fakta bahwa proses utama bercabang skrip kecil untuk pengumpulan data. </font><font style="vertical-align: inherit;">Akibatnya, bagian pemantauan kami rusak, karena kami tidak bisa lagi bercabang.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FB303</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FB303 adalah sistem pemantauan dasar kami. </font><font style="vertical-align: inherit;">Itu dinamai synthesizer bass standar 1982. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/t2/x3/f4/t2x3f4of3j794hnfskzti5lk3va.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prinsipnya sederhana, oleh karena itu, ia masih berfungsi: setiap layanan mengimplementasikan antarmuka getCounters Thrift.</font></font><br>
<br>
<pre><code class="php hljs">Service FacebookService {<font></font>
    map&lt;<span class="hljs-keyword">string</span>, i64&gt; getCounters()<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bahkan, dia tidak mengimplementasikannya, karena perpustakaan sudah ditulis, semuanya dilakukan dalam kode </font></font><code>increment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atau </font></font><code>set</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="php hljs">incrementCounter(<span class="hljs-keyword">string</span>&amp; key);<font></font>
<font></font>
setCounter(<span class="hljs-keyword">string</span>&amp; key, int64_t value);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Akibatnya, setiap layanan mengekspor penghitung di port yang terdaftar dengan Service Discovery. Di bawah ini adalah contoh dari mesin yang menghasilkan feed berita dan mengekspor sekitar 5,5 ribu pasang (string, angka): memori, produksi, apa pun. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sl/sb/fj/slsbfj9kapkaqsi3quo_do4q64a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setiap mesin menjalankan proses biner yang melewati semua layanan di sekitar, mengumpulkan penghitung ini dan menempatkannya di penyimpanan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini adalah apa yang tampak seperti </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GUI penyimpanan</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sh/lt/li/shltlimradfvsovwo1vp1xzudmu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sangat mirip dengan Prometheus dan Grafana, tetapi ternyata tidak. Entri FB303 pertama di GitHub adalah pada tahun 2009, dan Prometheus pada tahun 2012. Ini adalah penjelasan dari semua "do-it-yourselfers" dari Facebook: kami melakukannya ketika tidak ada yang normal di Open Source. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Misalnya, ada pencarian nama-nama penghitung. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vb/b3/ya/vbb3yabg-lhlypl1y7_zwf9dolw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Grafiknya sendiri terlihat seperti ini.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/b7/td/lj/b7tdljhxpmw6d5rt1fpguoon3ru.jpeg"><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gambar dari grup dalam tempat kami memposting gambar yang indah. </font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perbedaan penting antara tumpukan pemantauan kami dan Prometheus dan Grafana adalah bahwa </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kami menyimpan data selamanya</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Pemantauan kami akan sampel ulang data, dan setelah 2 minggu kami akan memiliki satu poin untuk setiap 5 menit, dan setelah satu tahun untuk setiap jam. </font><font style="vertical-align: inherit;">Karena itu, mereka dapat disimpan begitu banyak. </font><font style="vertical-align: inherit;">Secara otomatis ini tidak dikonfigurasi di mana saja. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi jika kita berbicara tentang fitur pemantauan Facebook, maka saya akan menggambarkannya dengan satu kata Inggris " </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">observability"</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Observabilitas</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada "kotak hitam", ada "kotak putih", dan kami memiliki "kotak" transparan kaca. </font><font style="vertical-align: inherit;">Ini berarti bahwa ketika kita menulis kode, kita menulis semua yang mungkin dalam log, dan tidak secara selektif. </font><font style="vertical-align: inherit;">Pengambilan sampel dilakukan dengan baik di mana-mana, sehingga backend untuk penyimpanan, penghitung, dan yang lainnya hidup dengan baik. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada saat yang sama, kami dapat membangun dasbor kami di atas penghitung yang ada. </font><font style="vertical-align: inherit;">Dalam hal mempelajari dasbor ini, ini bukan titik akhir dengan 10 grafik, tetapi yang pertama, dari mana kita pergi ke UI kita dan menemukan segala sesuatu di sana yang mungkin.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scuba</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inilah klimaks dari gagasan observabilitas. Ini adalah tumpukan ELK kami. Prinsipnya sama: kita menulis dalam JSON tanpa skema khusus, lalu kita meminta dalam bentuk </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tabel</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , rangkaian waktu data, atau 10 opsi visualisasi lainnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Log scuba dalam urutan ratusan gigabyte per detik. Semuanya diminta dengan sangat cepat, karena itu bukan Elasticsearch, dan semuanya ada di memori pada mesin yang kuat. Ya, uang dihabiskan untuk itu, tetapi betapa indahnya itu! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Misalnya, di bawah Scuba UI, salah satu tabel paling populer dibuka di dalamnya, di mana semua klien dari semua layanan Hemat menulis log. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dj/ah/ad/djahadigvrtru4luney67766slw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Grafik menunjukkan bahwa pada akhirnya, ada yang salah dalam layanan. Untuk mengetahui penundaan, buka daftar penghitung, pilih penundaan, agregasi, klik "Menyelam". </font></font><br>
<br>
<img src="https://habrastorage.org/webt/m2/c-/y8/m2c-y8pfnqyrz4hivxhxyszwvnw.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jawabannya datang dalam 2 detik.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j6/ac/kg/j6ackggq0o7xk93vejg0yfbyrhi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dapat dilihat bahwa pada saat itu sesuatu terjadi dan penundaan meningkat secara signifikan. </font><font style="vertical-align: inherit;">Untuk mempelajari lebih lanjut, Anda dapat mengelompokkan berdasarkan parameter yang berbeda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada ratusan meja seperti itu.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tabel yang memperlihatkan versi file biner, paket, berapa banyak memori yang dimakan pada jutaan mesin. </font><font style="vertical-align: inherit;">Pada setiap host, PS dibuat satu jam sekali dan dikirim ke Scuba.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semua dmesg, semua dump memori, dikirim ke tabel lain. </font><font style="vertical-align: inherit;">Kami menjalankan Perf sekali setiap 10 menit pada setiap mesin, jadi kami tahu jejak tumpukan yang kami miliki di kernel dan apa yang dapat dimuat CPU global.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debug PHP</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Scuba juga menyediakan backend untuk alat debugging inti PHP kami. Ribuan insinyur menulis kode PHP, dan entah bagaimana Anda perlu menyimpan repositori global dari hal-hal buruk. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagaimana cara kerjanya? PHP juga menulis jejak stack untuk setiap log. Scuba (Elasticsearch kami) tidak dapat menampung jejak stack dari semua log dari semua mesin. Sebelum memasukkan log ke dalam Scuba, kami mengonversi jejak tumpukan menjadi hash, sampel dengan hash dan hanya menyimpannya. Jejak tumpukan itu sendiri dikirim ke Memcached. Kemudian, di alat internal, Anda dapat menarik jejak tumpukan tertentu dari Memcached dengan cukup cepat. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ch/w_/im/chw_im8wjuue2nolmyzgcfappnq.jpeg"><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Visualisasi dengan pengelompokan hash dari log dan jejak stack.</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Kami men-debug kode menggunakan metode </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pencocokan pola</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : buka Scuba, lihat bagaimana grafik kesalahannya.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nd/op/nx/ndopnxibxeidsb8cmyy0rokasjm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami pergi ke LogView, ada kesalahan yang sudah dikelompokkan berdasarkan jejak tumpukan. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yx/0f/t3/yx0ft3lf_mnoskzxba7oqw3wtai.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jejak tumpukan dimuat dari Memcached, dan di atasnya Anda sudah dapat menemukan diff (komit dalam repositori PHP), yang diposting pada waktu yang hampir bersamaan, dan memutar kembali. </font><font style="vertical-align: inherit;">Siapa pun dapat mundur dan berkomitmen dengan kami, tidak ada izin yang diperlukan untuk ini.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kh/eu/ck/kheuck1w2losbdhiyasysemlvnk.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dasbor</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya akan mengakhiri topik pemantauan dengan dasbor. Kami memiliki beberapa dari mereka - hanya dua per tiga indikator. Dasbornya sendiri agak tidak biasa. Saya ingin berbicara lebih banyak tentang dia. Di bawah ini adalah dasbor standar dengan satu set grafik. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kh/eu/ck/kheuck1w2losbdhiyasysemlvnk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sayangnya, tidak begitu sederhana dengannya. Faktanya adalah bahwa garis ungu pada satu grafik adalah layanan yang sama dengan garis biru sesuai dengan pada grafik lainnya, dan grafik lain dapat dalam satu hari dan lainnya dalam sebulan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menggunakan dasbor kami berdasarkan </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cubism</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - pustaka JS Open Source. Itu ditulis di Square dan dirilis di bawah lisensi Apache. Mereka memiliki dukungan bawaan untuk Graphite dan Cube. Tetapi mudah untuk berkembang, yang telah kami lakukan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dasbor di bawah ini menunjukkan satu hari pada satu piksel per menit. </font><font style="vertical-align: inherit;">Setiap baris adalah wilayah: pusat data yang ada di dekatnya. </font><font style="vertical-align: inherit;">Mereka menampilkan jumlah log yang ditulis backend Facebook dalam byte per detik. </font><font style="vertical-align: inherit;">Di bawah ini adalah penjelasan untuk tim di Amerika untuk melihat apa yang telah kami perbaiki dari apa yang terjadi pada siang hari. </font><font style="vertical-align: inherit;">Sangat mudah untuk mencari korelasi dalam gambar ini. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fx/3u/8f/fx3u8f42urcs2ernp8cu_gvxj6q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di bawah ini adalah jumlah kesalahan 500. Apa di sebelah kiri tidak masalah bagi pengguna, dan jelas mereka tidak suka garis hijau gelap di tengah. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jy/dp/g1/jydpg1dmhrcxiirkeba3dhmtxcs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berikutnya adalah latensi persentil ke-99. </font><font style="vertical-align: inherit;">Pada saat yang sama, seperti pada grafik di atas, dapat dilihat bahwa latensi menurun. </font><font style="vertical-align: inherit;">Untuk mengembalikan kesalahan, tidak perlu menghabiskan banyak waktu.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/og/4w/it/og4witypnhr2n091yaiwzjqctsg.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana itu bekerja</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada grafik setinggi 120 piksel, semuanya terlihat. Tetapi banyak dari ini tidak dapat ditempatkan di satu dasbor, jadi kami akan menekan ke 30. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/48/-t/-2/48-t-2gfcbcmotwnkifz2tln_9u.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sayangnya, kemudian kami mendapatkan semacam boa constrictor. Mari kita kembali dan melihat apa yang dilakukan Kubisme dengannya. Dia memecah grafik menjadi 4 bagian: semakin tinggi, semakin gelap, dan kemudian runtuh. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zg/s-/48/zgs-48iqemvyyyyxuh1g949aoji.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang kita memiliki jadwal yang sama seperti sebelumnya, tetapi semuanya terlihat jelas: semakin gelap hijau, semakin buruk. Sekarang jauh lebih jelas apa yang terjadi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sebelah kiri Anda dapat melihat gelombang ketika naik, dan di tengah, di mana hijau gelap, semuanya sangat buruk. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ql/0f/xu/ql0fxubdkifq0ax-mwhbn00ndxi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubisme hanyalah awal. Diperlukan untuk visualisasi, untuk memahami apakah semuanya buruk sekarang atau tidak. Untuk setiap tabel, sudah ada dashboard dengan grafik terperinci.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_p/zx/u-/_pzxu-sbu9xc5p2gpoyrekvbybc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pemantauan dengan sendirinya membantu untuk memahami keadaan sistem dan merespons jika rusak. </font><font style="vertical-align: inherit;">Di Facebook, setiap karyawan yang dipanggil harus dapat memperbaiki semuanya. </font><font style="vertical-align: inherit;">Jika menyala terang, maka semuanya dihidupkan, tetapi terutama insinyur produksi dengan pengalaman administrator sistem, karena mereka tahu bagaimana menyelesaikan masalah dengan cepat.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saat Facebook berbaring</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terkadang insiden terjadi, dan Facebook berbohong. Biasanya orang berpikir bahwa Facebook berbohong karena diserang DDoS atau peretas, tetapi dalam 5 tahun itu tidak pernah terjadi. Alasannya selalu menjadi insinyur kami. Mereka tidak sengaja: sistemnya sangat kompleks dan dapat rusak di mana Anda tidak menunggu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami memberikan nama untuk semua insiden besar sehingga mudah untuk menyebutkan dan memberi tahu pendatang baru tentang mereka agar tidak mengulangi kesalahan di masa depan. Sang juara dengan nama terlucu adalah insiden </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Call the Cops</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Orang-orang memanggil polisi Los Angeles dan meminta untuk memperbaiki Facebook karena berbohong. Sherif Los Angeles begitu muak sehingga ia menulis tweet, "Tolong jangan panggil kami!" Kami tidak bertanggung jawab untuk ini! " </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4p/tl/nv/4ptlnvj0sppjmmmdt3zjowumd-u.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kejadian favorit saya di mana saya berpartisipasi disebut </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CAPSLOCK.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Sangat menarik karena menunjukkan bahwa apa pun bisa terjadi. Dan inilah yang terjadi. Ini alamat obychnyyIP: </font></font><code>fd3b:5679:92eb:9ce4::1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Facebook menggunakan Chef untuk menyesuaikan OS. Inventaris Layanan menyimpan konfigurasi host dalam basis datanya, dan Chef menerima file konfigurasi dari layanan. Setelah layanan mengubah versinya, mulai membaca alamat IP dari database segera dalam format MySQL dan meletakkannya dalam file. Alamat baru sekarang ditulis di ibukota: </font></font><code>FD3B:5679:92EB:9CE4::1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dia melihat file baru dan melihat bahwa alamat IP telah "berubah" karena membandingkan, bukan dalam bentuk biner, tetapi dengan string. Alamat IP adalah "baru", yang berarti Anda harus menurunkan antarmuka dan menaikkan antarmuka. Pada semua jutaan mobil dalam 15 menit, antarmuka turun dan naik.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tampaknya tidak apa-apa - kapasitas menurun saat jaringan terbaring di beberapa mesin. </font><font style="vertical-align: inherit;">Tetapi sebuah bug tiba-tiba terbuka di driver jaringan kartu jaringan khusus kami: saat startup, mereka membutuhkan 0,5 GB memori fisik berurutan. </font><font style="vertical-align: inherit;">Pada mesin cache, 0,5 GB itu menghilang saat kami menurunkan dan menaikkan antarmuka. </font><font style="vertical-align: inherit;">Oleh karena itu, pada mesin cache, antarmuka jaringan turun dan tidak naik, dan tidak ada yang berhasil tanpa cache. </font><font style="vertical-align: inherit;">Kami duduk dan menyalakan kembali mesin-mesin ini dengan tangan kami. </font><font style="vertical-align: inherit;">Itu menyenangkan.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portal Manajer Insiden</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika Facebook "terbakar", diperlukan untuk mengatur pekerjaan "pemadam kebakaran", dan yang paling penting, untuk memahami di mana ia terbakar, karena di sebuah perusahaan besar ia dapat "mencium bau terbakar" di satu tempat, tetapi masalahnya ada di tempat lain. </font><font style="vertical-align: inherit;">Alat UI yang disebut </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portal Insiden Manajer</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> membantu kami dalam hal ini </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Itu ditulis oleh insinyur produksi, dan ini terbuka untuk semua. </font><font style="vertical-align: inherit;">Segera setelah sesuatu terjadi, kami memulai insiden di sana: nama, awal, deskripsi.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hj/px/sm/hjpxsmys_lbno7lkm9r9osacq7o.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami memiliki orang yang terlatih khusus - Incident Manager On-Call (IMOC). </font><font style="vertical-align: inherit;">Ini bukan posisi permanen; manajer secara teratur berubah. </font><font style="vertical-align: inherit;">Dalam kasus kebakaran besar, IMOC mengatur dan mengoordinasikan orang untuk diperbaiki, tetapi tidak harus memperbaikinya sendiri. </font><font style="vertical-align: inherit;">Segera setelah insiden dengan tingkat bahaya tinggi dibuat, IMOC menerima SMS dan mulai membantu mengatur segalanya. </font><font style="vertical-align: inherit;">Dalam sistem yang besar, orang-orang seperti itu tidak dapat disingkirkan.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pencegahan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Facebook tidak begitu umum. </font><font style="vertical-align: inherit;">Sebagian besar waktu kami tidak memadamkan api dan tidak me-restart mesin cache, tapi kami memperbaiki bug sebelumnya, dan, jika mungkin, untuk semua orang sekaligus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah kami menemukan dan memperbaiki "masalah antrian." </font><font style="vertical-align: inherit;">Jumlah permintaan meningkat sebesar 50%, dan kesalahan sebesar 100%, karena tidak ada pelambatan yang mengimplementasikan terlebih dahulu, terutama dalam layanan kecil. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menemukan contoh beberapa layanan dan secara kasar mendefinisikan model perilaku.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Di bawah beban normal, permintaan tiba, diproses dan dikembalikan ke klien.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dengan beban tinggi, permintaan menunggu dalam antrian karena semua utas untuk memproses permintaan sibuk. </font><font style="vertical-align: inherit;">Penundaan meningkat, tetapi sejauh ini semuanya baik-baik saja.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Garis tumbuh, beban meningkat. </font><font style="vertical-align: inherit;">Pada titik tertentu, semua yang dijalankan server pada klien diakhiri dengan batas waktu respons, dan klien terjatuh karena kesalahan. </font><font style="vertical-align: inherit;">Pada titik ini, hasil dari server dapat dibuang begitu saja.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/0b/c1/b1/0bc1b11xgg49wz266m-tvoximls.jpeg"><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Batas waktu klien disorot dalam warna merah. </font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan klien mengulangi lagi! </font><font style="vertical-align: inherit;">Ternyata semua permintaan yang kami jalankan dibuang ke tempat sampah dan tidak ada yang membutuhkannya lagi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagaimana mengatasi masalah ini untuk semua orang sekaligus? </font><font style="vertical-align: inherit;">Memperkenalkan batas waktu tunggu dalam antrian. </font><font style="vertical-align: inherit;">Jika permintaan dalam antrian lebih dari yang diharapkan, kami membuangnya dan tidak memprosesnya di server, kami tidak membuang CPU di atasnya. </font><font style="vertical-align: inherit;">Kami mendapatkan permainan yang jujur: kami membuang semua yang tidak dapat kami proses, dan semua yang kami bisa - diproses.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pembatasan ini memungkinkan, sambil meningkatkan beban hingga 50% di atas batas maksimum, untuk tetap memproses 66% permintaan dan hanya menerima 33% kesalahan. </font><font style="vertical-align: inherit;">Pengembang kerangka kerja untuk Dispatch menerapkan ini di sisi server, dan kami, insinyur produksi, dengan lembut menyelesaikan batas waktu 100 ms dalam antrian untuk semua orang. </font><font style="vertical-align: inherit;">Jadi semua layanan segera mendapat pembatasan dasar murah.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alat</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ideologi SRE mengatakan bahwa jika Anda memiliki armada besar mobil, banyak layanan, dan tidak ada hubungannya dengan tangan Anda, maka Anda perlu mengotomatisasi. </font><font style="vertical-align: inherit;">Karena itu, separuh waktu kita menulis kode dan membangun alat.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubisme</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> terintegrasi </font><font style="vertical-align: inherit;">ke dalam sistem.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FBAR adalah "pekerja keras" yang datang dan memperbaiki, jadi tidak ada yang khawatir tentang satu mobil yang rusak. </font><font style="vertical-align: inherit;">Ini adalah tugas utama FBAR, tetapi sekarang ia memiliki lebih banyak tugas.</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Coredumper</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang kami tulis bersama dua rekan </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ini memantau coredumps pada semua mesin dan menjatuhkan mereka di satu tempat bersama dengan jejak tumpukan dengan semua informasi host: di mana letaknya, bagaimana menemukan ukuran apa. </font><font style="vertical-align: inherit;">Tapi yang paling penting, jejak stack gratis, tanpa memulai GDB menggunakan program BPF.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Polling</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hal terakhir yang kami lakukan adalah berbicara dengan orang-orang, mewawancarai mereka. </font><font style="vertical-align: inherit;">Tampaknya bagi kita ini sangat penting. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Satu jajak pendapat yang berguna adalah tentang keandalan. </font><font style="vertical-align: inherit;">Kami bertanya tentang sudah menjalankan layanan dalam kutipan kunci dari kuesioner kami:</font></font><br>
<blockquote><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Tanggung jawab utama perangkat lunak sistem harus terus berjalan. </font><font style="vertical-align: inherit;">Memberikan layanan harus dilihat sebagai efek samping yang menguntungkan dari kelanjutan operasi Â»</font></font></em></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ini berarti bahwa tugas utama sistem adalah untuk terus bekerja, dan fakta bahwa ia menyediakan semacam layanan adalah bonus tambahan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Survei hanya untuk layanan menengah, yang besar sendiri mengerti. </font><font style="vertical-align: inherit;">Kami memberikan kuesioner di mana kami menanyakan hal-hal dasar tentang arsitektur, SLO, pengujian, misalnya.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Apa yang terjadi jika sistem Anda mendapat 10% dari beban?" </font><font style="vertical-align: inherit;">Ketika orang berpikir: "Tapi sungguh, apa?" </font><font style="vertical-align: inherit;">- wawasan muncul, dan bahkan banyak yang memerintah sistem mereka. </font><font style="vertical-align: inherit;">Sebelumnya, mereka tidak memikirkannya, tetapi setelah pertanyaan ada alasan.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Siapa yang pertama kali biasanya melihat masalah dengan layanan Anda - Anda atau pengguna Anda?" </font><font style="vertical-align: inherit;">Pengembang mulai mengingat ketika ini terjadi dan: "... Mungkin Anda perlu menambahkan peringatan."</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Apa rasa sakit terbesarmu saat menelepon?" </font><font style="vertical-align: inherit;">Ini tidak biasa bagi pengembang, terutama yang baru. </font><font style="vertical-align: inherit;">Mereka segera berkata: â€œKami memiliki banyak peringatan! </font><font style="vertical-align: inherit;">Mari kita bersihkan dan singkirkan yang tidak. â€</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Seberapa sering pelepasanmu?" </font><font style="vertical-align: inherit;">Pertama mereka ingat bahwa mereka melepaskannya dengan tangan mereka, dan kemudian mereka memiliki penyebaran kustom mereka sendiri.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tidak ada pengkodean dalam kuesioner, itu terstandarisasi dan berubah setiap enam bulan. </font><font style="vertical-align: inherit;">Ini adalah dokumen dua halaman yang kami bantu isi 2-3 minggu lagi. </font><font style="vertical-align: inherit;">Dan kemudian kami mengatur reli dua jam dan menemukan solusi untuk banyak rasa sakit. </font><font style="vertical-align: inherit;">Alat sederhana ini bekerja dengan baik bersama kami dan dapat membantu Anda.</font></font><br>
<br>
<blockquote>6-7         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Saint HighLoad++</a>,          .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> </a>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> </a>   (,   ,  ). <br>
   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">telegram-</a>  .   !</blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id489192/index.html">Smart Engine memasuki tiga besar dalam peringkat FWCI di antara organisasi dasar FizTech</a></li>
<li><a href="../id489194/index.html">Bagaimana OpenShift mengubah struktur organisasi organisasi TI. Evolusi model organisasi ketika pindah ke PaaS</a></li>
<li><a href="../id489196/index.html">Asap Ajaib: Mikrokontroler vs. Regulator Linier</a></li>
<li><a href="../id489198/index.html">Bagaimana tidak menembak diri sendiri di kaki menggunakan Liquibase</a></li>
<li><a href="../id489200/index.html">Apa yang dicari startups untuk Y Combinator pada tahun 2020</a></li>
<li><a href="../id489206/index.html">Hancurkan cerita dengan Patroni, atau Cara menjatuhkan kluster PostgreSQL</a></li>
<li><a href="../id489210/index.html">Pengujian kinerja kode Linux dengan contoh-contoh</a></li>
<li><a href="../id489212/index.html">1C-Bitrix mencegah berhenti berlangganan buletin dengan persyaratan untuk mengirimkan data pribadi mereka</a></li>
<li><a href="../id489214/index.html">Pendekatan modern untuk menguji lokalisasi di iOS</a></li>
<li><a href="../id489218/index.html">Itu naif. Super: kode dan arsitektur gim sederhana</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>