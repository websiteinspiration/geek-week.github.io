<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∏üèΩ üôãüèæ ü§±üèª Au lieu de 100 lancements d'applications - un autotest, ou comment sauver un ing√©nieur QA 20 ans de vie üêΩ ‚è∫Ô∏è üôå</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour √† tous, je m'appelle Evgeny Demidenko. Depuis quelques ann√©es, je d√©veloppe un syst√®me de test de jeu automatis√© chez Pixonic. Aujourd'hui, je...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Au lieu de 100 lancements d'applications - un autotest, ou comment sauver un ing√©nieur QA 20 ans de vie</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pixonic/blog/503704/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bonjour √† tous, je m'appelle Evgeny Demidenko. Depuis quelques ann√©es, je d√©veloppe un syst√®me de test de jeu automatis√© chez Pixonic. Aujourd'hui, je voulais partager notre exp√©rience dans le d√©veloppement, le support et l'utilisation d'un tel syst√®me sur le projet War Robots. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour commencer, nous allons d√©couvrir ce que nous automatisons avec ce syst√®me. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, ce sont les tests d'interface de r√©gression, les tests du gameplay de base et l'automatisation des benchmarks. Les trois syst√®mes dans leur ensemble permettent de r√©duire la charge du service AQ avant les versions, d'√™tre plus confiants dans le refactoring √† grande √©chelle et en profondeur, et de maintenir constamment une √©valuation globale des performances de l'application, ainsi que de ses diff√©rentes parties. Un autre point que je veux noter est l'automatisation de la routine, par exemple - le test de toute hypoth√®se.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/x-/p8/li/x-p8lisenhooudwb_qghpki8oew.gif" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je vais vous donner quelques chiffres. Maintenant, plus de 600 tests d'interface utilisateur et environ 100 tests de base ont √©t√© √©crits pour les robots de guerre. Sur ce seul projet, nous avons effectu√© environ un million de lancements de nos scripts de test, dont chacun a pris environ 80 secondes. Si nous avions v√©rifi√© ces sc√©narios manuellement, nous aurions pass√© au moins cinq minutes chacun. De plus, nous avons lanc√© plus de 700 000 benchmarks. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parmi les plateformes, nous utilisons Android et iOS - seulement 12 appareils dans le parc. Deux programmeurs sont impliqu√©s dans le d√©veloppement et le support du syst√®me, et un ing√©nieur QA √©crit et analyse les tests.</font></font><br>
<br>
<a name="habracut"></a><br>
<img src="https://habrastorage.org/webt/uf/yw/0w/ufyw0wcb6rt75dkydnmcqfg2zly.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/yt/x1/9g/ytx19guugufvzvniufmworpua6e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quant √† la pile logicielle, nous utilisons NUnit dans notre base de donn√©es, mais pas pour les tests unitaires, mais pour les tests d'int√©gration et de syst√®me. </font><font style="vertical-align: inherit;">Pour le gameplay de base et les tests de v√©rification de build, nous utilisons la solution int√©gr√©e d'Unity - Unity Test Tools. </font><font style="vertical-align: inherit;">Pour r√©diger et analyser des rapports apr√®s ces tests, le rapport de test Allure de Yandex est utilis√©, ainsi que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TeamCity</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - comme syst√®me d'int√©gration continue pour la cr√©ation d'applications, le d√©ploiement de serveurs et l'ex√©cution de tests. </font><font style="vertical-align: inherit;">Nous utilisons le r√©f√©rentiel Nexus et la base de donn√©es PostgreSQL pour stocker nos artefacts.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/u6/3q/mo/u63qmozjx0tp1pcl6ym9ykqnrwa.jpeg"><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment cr√©er, analyser et ex√©cuter des tests</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supposons que nous voulons √©crire un test simple qui, dans la fen√™tre des param√®tres du jeu, v√©rifiera l'ic√¥ne pour activer et d√©sactiver le son. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons donc √©crit un test et l'avons valid√© dans une branche sp√©cifique de notre r√©f√©rentiel de tests. Nous avons choisi les tests que nous voulons ex√©cuter, choisi une build √† ex√©cuter, ou peut-√™tre un commit sp√©cifique, sur lequel la build sera assembl√©e. Ex√©cutez maintenant le test, attendez un moment et obtenez le r√©sultat. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yh/lh/zh/yhlhzh-ks_cwipqs8r0rz6sgcdk.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/58/g2/vc/58g2vcabu81mbxprwuoalnf9p34.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce cas, 575 tests ont √©t√© lanc√©s, dont 97% ont r√©ussi. Il nous a fallu environ trois heures pour terminer tous les tests. √Ä titre de comparaison, les m√™mes tests, s'ils √©taient effectu√©s manuellement, prendraient au moins 50 heures de fonctionnement continu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alors, qu'est-il arriv√© √† ces 3% des tests qui ont √©chou√©? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous ouvrons un test sp√©cifique et voyons un message indiquant qu'une erreur s'est produite lors de la correspondance des captures d'√©cran.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sk/ae/tl/skaetlvcp3-ivmp5aqkzhmolbac.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous ouvrons la capture d'√©cran, qui √©tait √† ce moment sur l'appareil, et nous voyons que les zones qui ne correspondent pas √† l'original sont marqu√©es avec des pixels rouges. </font><font style="vertical-align: inherit;">A titre de comparaison, nous lui donnons. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/am/h2/vn/amh2vnpzgkyhqtkrfsnski3y1sy.png"><br>
<br>
<img src="https://habrastorage.org/webt/s3/7o/zl/s37ozlopkihi4vpcpwrbslws05i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Naturellement, apr√®s cela, l'ing√©nieur QA doit soit faire un bug pour que le comportement de la construction ne corresponde pas au document de conception de jeu, soit mettre √† jour les captures d'√©cran originales, car le document de conception de jeu a chang√©, et maintenant ces √©l√©ments ne seront plus dans le jeu.</font></font><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√áa a l'air cool. </font><font style="vertical-align: inherit;">Pourquoi tout cela est-il n√©cessaire?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a quelque temps, sur le projet War Robots, nous devions faire une petite refactorisation. </font><font style="vertical-align: inherit;">Elle consistait √† r√©√©crire quelques morceaux de code pour tirer des armes - en particulier des mitrailleuses.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors des tests, nous avons trouv√© une nuance int√©ressante: le taux de mitrailleuses d√©pendait directement du FPS. Un tel bogue serait irr√©aliste √† d√©tecter lors des tests manuels: d'une part, en raison des caract√©ristiques du calcul r√©seau des dommages sur le projet, et d'autre part, du fait que l'application War Robots est assez bien optimis√©e et √† ce moment-l√†, elle fonctionnait sur tous appareils avec approximativement le m√™me FPS - 30 images / s. Bien s√ªr, il y avait de petites d√©viations, mais elles n'√©taient pas suffisantes pour remarquer une augmentation des dommages caus√©s par le tir des armes lors des tests manuels. Ensuite, nous nous sommes demand√©: combien de bogues avons-nous encore et combien peuvent appara√Ætre lors de la refactorisation?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme nous ne voulions pas r√©duire le nombre de tests, mais plut√¥t l'augmenter, puisque nous avions pr√©vu des mises √† jour majeures et une augmentation du nombre de contenus, nous ne voulions pas cro√Ætre horizontalement et augmenter le nombre d'employ√©s AQ. </font><font style="vertical-align: inherit;">Au lieu de cela, nous avons planifi√© une croissance verticale avec une r√©duction de la routine des employ√©s actuels et une simplification de leur vie lors des tests d'int√©gration de nouveaux contenus.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sh/yf/_w/shyf_wvrx43ugfrojh0q57lozoa.jpeg"><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quels outils utilisons-nous</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque nous avons commenc√© √† automatiser les tests, nous avons tout d'abord attir√© l'attention sur les outils de test d'int√©gration Unity, qui √©taient int√©gr√©s √† l'√©poque √† Unity √† l'√©poque. Nous y avons √©crit plusieurs interfaces utilisateur et tests de base, termin√© le refactoring que nous avons commenc√© plus t√¥t, et nous en sommes satisfaits, car la solution fonctionnait d√©j√†, ce qui signifie que nos hypoth√®ses √©taient correctes, et nous avons d√ª passer √† autre chose. Le seul point n√©gatif de cette solution, mais tr√®s significatif pour nous, √©tait que les tests ne pouvaient pas √™tre ex√©cut√©s sur des appareils mobiles.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, nous avons eu l'id√©e d'utiliser le framework Appium. Ceci est une fourchette d'un autre cadre de test bien connu - Selenium. √Ä son tour, c'est peut-√™tre le cadre le plus c√©l√®bre pour tester des applications Web, dont le concept principal est de travailler avec des √©l√©ments d'interface utilisateur, d'obtenir leurs coordonn√©es et d'organiser les entr√©es dans ces √©l√©ments d'interface utilisateur. Appium a adopt√© ce concept et, en plus des pilotes Web existants dans Selenium, a √©galement ajout√© des pilotes iOS et Android: ils utilisent des cadres de test natifs pour chacune de ces plates-formes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puisqu'il n'y a pas d'√©l√©ments d'interface utilisateur natifs dans Unity, et qu'il n'y a qu'un seul √©l√©ment d'interface utilisateur dans lequel l'image est rendue, j'ai d√ª ajouter en plus d'Appium UnityDriver, qui vous permet de travailler avec la hi√©rarchie de sc√®ne, d'obtenir des objets de sc√®ne, et bien plus encore.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä ce moment-l√†, un ing√©nieur QA √©tait d√©j√† apparu sur le projet, les choses ont commenc√© √† couler, le nombre de sc√©narios de test a commenc√© √† augmenter de mani√®re significative, que nous avons progressivement automatis√©. Nous avons commenc√© √† les lancer sur des appareils, et en g√©n√©ral, notre travail a d√©j√† cherch√© la fa√ßon dont nous voulions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä l'avenir, en plus des tests d'interface utilisateur, des tests de base et d'autres outils bas√©s sur notre syst√®me ont commenc√© √† appara√Ætre, √† la suite de quoi nous avons rencontr√© des performances et une qualit√© de travail sur divers appareils, ajout√© la prise en charge de plusieurs autres appareils, des tests parall√®les et abandonn√© Appium dans b√©n√©ficier de votre propre framework. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lv/mn/sv/lvmnsvmwhtnp3ewe2mpofdem-e4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le seul probl√®me qui est rest√© avec nous - et est toujours - √©tait la hi√©rarchie de l'interface utilisateur. Parce que si une hi√©rarchie change dans une sc√®ne en raison d'un refactoring de l'interface utilisateur ou d'un travail sur la sc√®ne, cela doit √™tre pris en charge dans les tests.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s les prochaines innovations et r√©visions, l'architecture de l'ensemble du syst√®me a commenc√© √† se pr√©senter comme suit. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yu/52/ho/yu52hohx3nmookj9vajusrl7uyg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous prenons la construction War Robots, prenons nos tests, qui sont dans un r√©f√©rentiel s√©par√©, ajoutons des param√®tres √† ex√©cuter l√†-bas qui nous permettent de configurer le lancement des tests dans chaque cas, et de tout envoyer √† l'agent TeamCity sur un PC distant. L'agent TeamCity lance nos tests, leur transmet les param√®tres de construction et de lancement du robot, apr√®s quoi les tests commencent √† fonctionner et √† ¬´communiquer¬ª ind√©pendamment avec les appareils connect√©s √† l'agent TeamCity par fil: mettez des builds dessus, ex√©cutez-les, ex√©cutez certains scripts, supprimez versions, red√©marrez l'application et ainsi de suite.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√âtant donn√© que les tests et l'application elle-m√™me s'ex√©cutent sur des appareils physiquement diff√©rents - sur un t√©l√©phone mobile et un Mac mini - nous devions mettre en ≈ìuvre la communication entre notre framework, l'API War Robots et l'API Unity. </font><font style="vertical-align: inherit;">Nous avons ajout√© un petit serveur UDP √† l'application, qui re√ßoit les commandes du framework et communique avec l'API de l'application et Unity via des gestionnaires. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sq/rt/qf/sqrtqfu4f-swgarbf1zgsysocea.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La t√¢che principale de notre framework est d'organiser le travail des tests: la pr√©paration correcte, l'ach√®vement et la gestion des appareils. </font><font style="vertical-align: inherit;">En particulier, la parall√©lisation pour acc√©l√©rer le travail, le bon choix d'appareils et de captures d'√©cran, la communication avec la build. </font><font style="vertical-align: inherit;">Apr√®s avoir termin√© les tests, notre framework doit enregistrer tous les artefacts g√©n√©r√©s et g√©n√©rer un rapport.</font></font><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conseils pour choisir les appareils</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
S√©par√©ment, je veux faire attention au choix des appareils √† tester. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une attention consid√©rable devrait √™tre accord√©e aux hubs. Si vous souhaitez ex√©cuter des tests de performances sur vos appareils - en particulier s'il s'agit d'appareils Android - ils seront √† court de puissance. Les concentrateurs doivent fournir l'alimentation n√©cessaire aux appareils utilis√©s. Il existe une autre caract√©ristique tr√®s subtile: certains concentrateurs ont une puissance active, et cette alimentation s'√©teint apr√®s des surtensions, apr√®s quoi elle est activ√©e uniquement en appuyant physiquement sur un bouton. Nous avons de tels hubs, ce qui est tr√®s g√™nant.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous souhaitez ex√©cuter des tests d'interface de r√©gression et tester la logique sur des appareils, ne prenez pas d'autres appareils. </font><font style="vertical-align: inherit;">Prenez les m√™mes appareils - mieux les plus productifs que vous pouvez vous permettre, car de cette fa√ßon, vous √©conomiserez du temps sur les freins des appareils, la commodit√© de travailler avec eux et le comportement de l'application sur tous les appareils seront les m√™mes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un autre probl√®me est l'utilisation des fermes de cloud. </font><font style="vertical-align: inherit;">Nous ne les utilisons pas encore, bien que nous ayons fait des recherches sur eux: ce qu'ils sont, combien ils co√ªtent et comment ex√©cuter nos tests sur eux - mais jusqu'√† pr√©sent, nous avons suffisamment de notre parc d'appareils interne pour couvrir nos demandes.</font></font><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rapports de test</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une fois les tests termin√©s, nous g√©n√©rons un rapport d'allure, qui comprend tous les artefacts cr√©√©s lors de notre test. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le principal ¬´cheval de bataille¬ª pour analyser ce qui s'est pass√© et identifier les causes de l'accident pendant le test est les journaux. Tout d'abord, nous les collectons √† partir de notre framework, qui nous renseigne sur l'√©tat du script et sur ce qui s'est pass√© dans ce script. Nous divisons les journaux dans le syst√®me (plus d√©taill√©) et le journal pour QA (plus compact et pratique pour l'analyse). Nous collectons √©galement les journaux syst√®me des appareils (par exemple, logcat) et les journaux d'une application Unity.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendant la chute des tests, nous prenons √©galement une capture d'√©cran pour comprendre ce qui se passait sur les appareils au moment de la chute, enregistrer une vid√©o pour comprendre ce qui s'est pass√© avant le crash, et essayer de collecter des informations sur l'√©tat de l'appareil, telles que nos pings de serveur et les informations ifconfig, au maximum pour savoir si l'appareil a une IP. </font><font style="vertical-align: inherit;">Vous serez surpris, cependant, si vous lancez l'application manuellement 50 fois, tout ira bien, mais si vous l'ex√©cutez 50000 fois en mode automatique, vous constaterez que l'Internet sur l'appareil peut √™tre perdu, et ce ne sera pas clair pendant le test, s'il y avait une connexion avant et apr√®s la chute. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous collectons √©galement une liste des processus, la puissance de la batterie, la temp√©rature et g√©n√©ralement tout ce que nous pouvons atteindre.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/du/vk/o3/duvko3ve8ep_2fsl2wcm5m129wk.jpeg"><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelles sont les bonnes captures d'√©cran et vid√©os</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a quelque temps, notre ing√©nieur QA a sugg√©r√©, en plus de prendre des captures d'√©cran √† l'automne, √† certains endroits des tests de comparer ces captures d'√©cran avec les mod√®les qui se trouvent dans notre r√©f√©rentiel. Ainsi, il a propos√© de gagner du temps sur le nombre d'ex√©cutions de test et de r√©duire la taille de la base de code. Autrement dit, avec un test, nous pourrions v√©rifier la logique et la partie visuelle. Du point de vue du concept de tests unitaires, ce n'est pas tr√®s correct, car dans un test, nous ne devons pas tester plusieurs hypoth√®ses. Mais c'est une √©tape d√©lib√©r√©e: nous savons analyser tout cela correctement, nous nous sommes donc aventur√©s √† ajouter des fonctionnalit√©s similaires.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, nous avons pens√© √† ajouter des biblioth√®ques pour faire correspondre les captures d'√©cran, mais nous avons r√©alis√© que l'utilisation d'images avec des r√©solutions diff√©rentes n'est pas tr√®s fiable, nous nous sommes donc arr√™t√©s sur des appareils avec la m√™me r√©solution et comparons simplement les images avec un certain seuil pixel par pixel.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mk/er/0l/mker0lc9w32qaca97jmykzsdae8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un effet tr√®s int√©ressant de l'utilisation de la correspondance des captures d'√©cran est que si certains processus sont difficiles √† automatiser, nous les automatiserons dans la mesure du possible, puis nous examinerons simplement les captures d'√©cran manuellement. C'est exactement ce que nous avons fait avec la localisation des tests. Nous avons re√ßu une demande pour tester la localisation de nos applications, alors nous avons commenc√© √† chercher des biblioth√®ques qui permettent la reconnaissance de texte - mais nous nous sommes rendu compte que c'√©tait plut√¥t peu fiable, et en cons√©quence, nous avons √©crit plusieurs scripts qui ¬´marchent¬ª sur diff√©rents √©crans et provoquent des pop-ups diff√©rents. ups, et √† ce moment des captures d'√©cran sont cr√©√©es. Avant de d√©marrer un tel script, nous modifions les param√®tres r√©gionaux sur l'appareil, ex√©cutons le script, prenons des captures d'√©cran, modifions √† nouveau les param√®tres r√©gionaux et r√©ex√©cutons le script. Ainsi, tous les tests sont ex√©cut√©s la nuit,afin que le matin, l'ing√©nieur QA puisse regarder 500 captures d'√©cran et analyser imm√©diatement s'il y a des probl√®mes de localisation quelque part. Oui, les captures d'√©cran doivent encore √™tre regard√©es, mais cela est beaucoup plus rapide que de passer manuellement √† travers tous les √©crans de l'appareil.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parfois, les captures d'√©cran et les journaux ne suffisent pas: quelque chose d'√©trange commence √† se produire sur les appareils, mais comme ils sont situ√©s √† distance, vous ne pouvez pas aller √©valuer ce qui s'y est pass√©. </font><font style="vertical-align: inherit;">De plus, il est parfois difficile de savoir ce qui s'est pass√© litt√©ralement quelques instants avant la chute du test. </font><font style="vertical-align: inherit;">Par cons√©quent, nous avons ajout√© un enregistrement vid√©o de l'appareil, qui commence au d√©but du test et n'est sauvegard√© qu'en cas de chute. </font><font style="vertical-align: inherit;">Avec l'aide de telles vid√©os, il est tr√®s pratique de suivre les plantages et les blocages d'applications.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tv/yi/jk/tvyijk8fgyl3_sgkyykx4tdjc2g.jpeg"><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Que peut faire d'autre notre syst√®me?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a quelque temps, du d√©partement de test de QA, nous avons re√ßu une demande pour d√©velopper un outil de collecte de m√©triques lors de tests manuels. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pourquoi est-ce? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela est n√©cessaire pour que les ing√©nieurs QA, apr√®s un test de lecture manuel, puissent en outre analyser le comportement du FPS et la consommation de m√©moire dans l'application, en regardant simultan√©ment des captures d'√©cran et des vid√©os refl√©tant ce qui se passait sur cet appareil.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le syst√®me d√©velopp√© par nous a fonctionn√© comme suit. L'ing√©nieur QA a lanc√© War Robots sur l'appareil, a activ√© l'enregistrement de la session playbench - notre analogue du gamebench - a jou√© le playtest, puis a cliqu√© sur "mettre fin √† la session playbench", le rapport g√©n√©r√© a √©t√© enregistr√© dans le r√©f√©rentiel, apr√®s quoi l'ing√©nieur avec les donn√©es pour ce playtest pourrait atteindre son travail machines et voir le rapport: quels √©taient les rabattements sur FPS, quelle consommation de m√©moire, ce qui se passait sur l'appareil.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons √©galement automatis√© le lancement de rep√®res sur le projet War Robots, en regroupant essentiellement les rep√®res existants dans un lancement automatique. Le r√©sultat des rep√®res est g√©n√©ralement √† un chiffre. Dans notre cas, il s'agit g√©n√©ralement du FPS moyen par r√©f√©rence. En plus du lancement automatique, nous avons d√©cid√© d'ajouter une autre session de playbench et avons ainsi re√ßu non seulement un chiffre sp√©cifique, le fonctionnement du benchmark, mais aussi des informations gr√¢ce auxquelles nous pouvons analyser ce qui est arriv√© au benchmark √† ce moment.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il faut √©galement mentionner le test de demande de pull. </font><font style="vertical-align: inherit;">Cette fois, c'√©tait plus pour aider l'√©quipe de d√©veloppement client que les ing√©nieurs QA. </font><font style="vertical-align: inherit;">Nous ex√©cutons le test de v√©rification de construction pour chaque demande de tirage. </font><font style="vertical-align: inherit;">Vous pouvez les ex√©cuter √† la fois sur les appareils et dans l'√©diteur Unity pour acc√©l√©rer le travail de v√©rification de la logique. </font><font style="vertical-align: inherit;">Nous ex√©cutons √©galement un ensemble de core-tests dans des branches distinctes, o√π une sorte de refonte de certains √©l√©ments ou de refactorisation de code a lieu.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6x/xj/t8/6xxjt8np3nxlfacdadgagz-qxry.jpeg"><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et d'autres fonctionnalit√©s utiles</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fin de compte, je veux m'attarder sur certains cas int√©ressants que nous avons rencontr√©s au cours des derni√®res ann√©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'un des cas les plus int√©ressants qui sont apparus r√©cemment avec nous est celui des r√©f√©rences lors des combats avec des bots.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour le nouveau projet, Pixonic Dino Squad a d√©velopp√© un syst√®me dans lequel l'ing√©nieur QA pourrait jouer un test de jeu avec des bots, afin de ne pas attendre ses coll√®gues, mais de tester une hypoth√®se. Notre ing√©nieur QA, √† son tour, a demand√© d'ajouter la possibilit√© non seulement de jouer avec les bots, mais aussi pour que les bots puissent jouer les uns avec les autres. Ainsi, nous lan√ßons simplement l'application, et √† ce moment le bot commence √† jouer avec d'autres bots. En m√™me temps, toute l'interaction est en r√©seau, avec de vrais serveurs, juste au lieu de joueurs jouant sur un ordinateur. Tout cela est emball√© dans des rep√®res et une session de playbench avec des d√©clencheurs pour les d√©marrages nocturnes. Ainsi, la nuit, nous commen√ßons plusieurs batailles entre les bots et les bots, √† ce moment, les FPS et la consommation de m√©moire sont √©crits, des captures d'√©cran sont prises et des vid√©os sont enregistr√©es. Le matin, un ing√©nieur QA vient et peut voir,quels tests ont √©t√© organis√©s et ce qui s'est pass√© sur eux.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fuite de texture m√©rite √©galement d'√™tre v√©rifi√©e. </font><font style="vertical-align: inherit;">Il s'agit d'une sorte de sous-analyse de l'utilisation de la m√©moire - mais ici, nous v√©rifions principalement l'utilisation, par exemple, des textures de garage au combat. </font><font style="vertical-align: inherit;">Par cons√©quent, dans la bataille, il ne devrait pas y avoir d'atlas utilis√©s dans le garage, et lorsque nous quittons la bataille, les textures qui ont √©t√© utilis√©es dans la bataille ne doivent pas rester en m√©moire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un effet secondaire int√©ressant de notre syst√®me est que presque depuis le tout d√©but de son utilisation, nous avons suivi le temps de chargement de l'application. </font><font style="vertical-align: inherit;">Dans le cas des robots de guerre, cette fois n'est pas forte, mais elle est en constante augmentation, car de nouveaux contenus sont ajout√©s et la qualit√© de ce contenu s'am√©liore - mais nous pouvons garder ce param√®tre sous contr√¥le et toujours √™tre conscient de sa taille.</font></font><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Au lieu d'une conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fin de compte, je voudrais attirer l'attention sur les probl√®mes que nous connaissons et que nous aimerions r√©soudre en premier lieu. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/s3/8o/ow/s38oowcmbceqawngd_udbsvt3eq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le premier et le plus douloureux concerne les modifications de l'interface utilisateur. Puisque nous travaillons avec une bo√Æte noire, nous n'int√©grons rien dans l'application War Robots √† l'exception de notre serveur - c'est-√†-dire que nous testons tout de la m√™me mani√®re qu'un ing√©nieur QA le ferait. Mais d'une mani√®re ou d'une autre, nous devons acc√©der aux √©l√©ments de la sc√®ne. Et nous les trouvons le long du chemin absolu. Ainsi, lorsque quelque chose change sur la sc√®ne, en particulier √† un haut niveau de hi√©rarchie, nous devons accompagner ces changements dans un grand nombre de tests. Malheureusement, nous ne pouvons rien faire pour le moment. Bien s√ªr, il existe des solutions, mais elles apportent leurs probl√®mes suppl√©mentaires.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le deuxi√®me gros probl√®me est l‚Äôinfrastructure. Comme je l'ai dit, si vous ex√©cutez votre application 50 fois avec vos mains, vous ne remarquerez pas la plupart des probl√®mes qui appara√Ætront si vous ex√©cutez votre application 50 000 fois. Ces probl√®mes qui peuvent √™tre facilement r√©solus en mode manuel - par exemple, la r√©installation de builds ou le red√©marrage d'Internet - se r√©v√©leront √™tre une v√©ritable douleur dans l'automatisation, car tous ces probl√®mes doivent √™tre correctement g√©r√©s, un message d'erreur affich√© et √† condition qu'ils puissent se produire du tout. En particulier, nous devons d√©terminer pourquoi les tests ont √©chou√©: en raison d'une logique d√©fectueuse ou d'une sorte de probl√®me d'infrastructure, ou pour toute autre raison. Il y a beaucoup de probl√®mes avec les appareils bas de gamme: ils n'ont pas de builds, Internet tombe en panne, les appareils g√®lent, tombent en panne, ne s'allument pas, sont rapidement d√©charg√©s, etc.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je voudrais √©galement interagir avec des interfaces utilisateur natives, mais jusqu'√† pr√©sent, nous n'avons pas une telle opportunit√©. </font><font style="vertical-align: inherit;">Nous savons comment proc√©der, mais la pr√©sence d'autres demandes de fonctionnalit√©s ne nous permet pas d'y parvenir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et personnellement, mon d√©sir est de respecter les normes qui existent dans l'industrie, mais c'est aussi dans les plans pour l'avenir, peut-√™tre m√™me cette ann√©e.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr503690/index.html">Meilleures pratiques Kubernetes. Mise √† niveau du cluster Kubernetes Zero Downtime</a></li>
<li><a href="../fr503696/index.html">Gears of war: quand les ordinateurs analogiques m√©caniques gouvernaient la mer</a></li>
<li><a href="../fr503698/index.html">Comptabilit√© √† distance - comme avantage commercial</a></li>
<li><a href="../fr503700/index.html">Cr√©ation de formulaires React en 2020</a></li>
<li><a href="../fr503702/index.html">Utilisation des donn√©es brutes dans Google Analytics en pratique</a></li>
<li><a href="../fr503706/index.html">Pourquoi ces r√®gles m√©t√©orologiques ennuyeuses sont-elles n√©cessaires pour lancer et atterrir des roquettes?</a></li>
<li><a href="../fr503710/index.html">PyDoma [PyData Moscow Meetup # 12]: 26 mai 2020</a></li>
<li><a href="../fr503712/index.html">Statut et performances des solutions de stockage persistant Kubernetes</a></li>
<li><a href="../fr503716/index.html">Avez-vous besoin de nuages ‚Äã‚Äãdans l'espace</a></li>
<li><a href="../fr503718/index.html">Avocat robot, application de collecte des ordures et bien plus encore: un hackathon en ligne avec une pizza en ligne conquiert la crise</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>