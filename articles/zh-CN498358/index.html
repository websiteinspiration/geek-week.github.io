<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕗 ✈️ 🍦 学习法语或如何从PSA诊断扫描仪获取通用适配器 🆗 🔩 🖐🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="为了防止自我孤立时智商下降，人们希望做一些对自己有用的事情，如果幸运的话，不仅可以。切开公寓周围的第n个圆圈，我的眼睛被汽车扫描仪吸引住了，我从朋友那里带走了汽车扫描仪，这就是Lexia 3，又名Actia XS Evolution。这是一个：
 
 它的巨大缺点是只有设计用于诊断Peugeout ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>学习法语或如何从PSA诊断扫描仪获取通用适配器</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/498358/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了防止自我孤立时智商下降，人们希望做一些对自己有用的事情，如果幸运的话，不仅可以。</font><font style="vertical-align: inherit;">切开公寓周围的第n个圆圈，我的眼睛被汽车扫描仪吸引住了，我从朋友那里带走了汽车扫描仪，这就是Lexia 3，又名Actia XS Evolution。</font><font style="vertical-align: inherit;">这是一个：</font></font><br>
<img src="https://habrastorage.org/webt/8k/pd/yu/8kpdyuolcbvw8jvbs03qqbkqtys.jpeg" alt="图片"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
它的巨大缺点是只有设计用于诊断Peugeout / Citroen汽车的DiagBox软件才能使用它。</font><font style="vertical-align: inherit;">不可能忍受后者，因此提出了一个想法，即如果迫使该扫描仪向车辆的CAN总线发送和接收任意消息，从而将其转变为通用适配器。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，行动计划：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收集PC与患者之间的USB通信。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了解适配器驱动程序和软件之间如何进行通信。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重复进行交换，并感觉良好（破坏者：事实证明它要复杂一些）。</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.交流</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DiagBox软件复合体可自由浏览Internet，因此第1步没有任何困难，特别是因为它带有一个用于识别适配器的小实用程序，从某种程度上简化了第2步的任务。当通过USB接收交换时，</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">USBLyzer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的试用版提供了</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">帮助</font></a><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们将走向成功。</font><font style="vertical-align: inherit;">在图中，发送的数据包，调度程序中的设备类型以及相同的实用程序。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/n_/ev/n1/n_evn1nmme3s8mrog8zea5lj_fu.png" alt="图片"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查看打开设备并与之交换时的IRP，我们可以得出结论，该工作是通过标准Windows I / O机制完成的，即打开设备的虚拟文件CreateFile函数以及用于交换的DeviceIOControl。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hz/3r/gr/hz3rgrrv-hbc_h13gg9zluh4m0q.png" alt="图片"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.汇报</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
收集数据，接收到IOCTL ID和标志，但对于较小的情况仍然如此，请打开文件设备并在其中发送字节数据包。</font><font style="vertical-align: inherit;">刚打开吗？</font><font style="vertical-align: inherit;">通过WinObj进行搜索没有给出任何结果，连接后适配器没有确切的名称，只有具有不断变化的ID的隐式链接，也就是说，仅打开像COM端口这样的设备是行不通的</font></font><br>
<br>
<pre><code class="cpp hljs">CreateFile(<span class="hljs-string">"\\\\.\\COM1"</span>, ...)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通过仔细研究程序文件，发现一切都非常简单-适配器具有自己独特的GUID，在操作系统的帮助下，要求操作系统提供具有此类GUID的所有设备的列表，如果存在，我们将获得指向该设备的链接，</font></font><br>
<code>\\?\USB#VID_103A&amp;PID_F000#6&amp;268bff9b&amp;0&amp;7#{75a835f4-d77d-4402-8585-c42247f25b76}\vcommusb0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打开该链接将成功。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数返回路径而不是GUID：</font></font><br>
<br>
<pre><code class="cpp hljs">CM_Get_Device_Interface_List(InterfaceClassGuid, pDeviceID, Buffer, BufferLen, ulFlags);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
“文件”成功打开，不要忘记通过USBLyzer获得的标志</font></font><br>
<br>
<pre><code class="cpp hljs">Device = CreateFile(DeviceName, GENERIC_WRITE | GENERIC_READ, FILE_SHARE_WRITE | FILE_SHARE_READ, <span class="hljs-literal">NULL</span>, OPEN_EXISTING, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>);</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.决赛</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们发送一个字节的数据包，作为回应-沉默...</font></font><br>
<br>
<pre><code class="cpp hljs">bStatus = DeviceIoControl(Device, <span class="hljs-number">0x220003</span>, send_buf, send_len, out_buf, max_out_len, &amp;returned_len, <span class="hljs-literal">NULL</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我坐了很长时间，看着监视器，这里是相同的交换，这里是设备的答案，这里是标志，与我重复的完全相同，但没有任何结果。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qw/cy/kx/qwcykx8st4jbyqhrk28d4k5qxcs.jpeg" alt="图片"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
终于失去了一切成功的希望，我还有最后一件事-用OllyDbg程序从Hacker杂志以磁盘的形式装上重型火炮。</font><font style="vertical-align: inherit;">我们开始，附加到该过程，将断点放在DeviceIoControl函数和我们看到的内容上。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/en/nq/cf/ennqcflp-6n8tmii2x1qutuntp8.png" alt="图片"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
国王不是真实的。</font><font style="vertical-align: inherit;">完全不同的IOCTL代码，数据根本不像通过USBLyzer看到的那样。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
发送到设备的内容：</font></font><br>
<br>
<pre><code class="plaintext hljs">&lt;b&gt;00 FA&lt;/b&gt; &lt;i&gt;AA&lt;/i&gt; BA 7C 15 00 00 00 00 00 00</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后通过USB：</font></font><br>
<br>
<pre><code class="plaintext hljs">40 05 15 C0 &lt;b&gt;00 FA&lt;/b&gt; 00 00 &lt;i&gt;AA&lt;/i&gt; 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 41</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
提示是在任务管理器中可见的设备名称中。我</font><font style="vertical-align: inherit;">在</font><font style="vertical-align: inherit;">Microsoft网站</font><font style="vertical-align: inherit;">上</font><font style="vertical-align: inherit;">找到</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关UMDF USB驱动程序的文章。清晰的框图：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/d2/wc/gd/d2wcgdfeky6nkjd3oe8x2eh7h8g.png" alt="图片"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
事实证明，我们在USBLyzer中看到的是客户端数据传输的传输层，该传输层是在UMDF驱动程序（图中的方向7）中实现的，而我们将数据传输到设备（图中的方向2）时，首先将进入驱动程序，然后进入USB总线。我希望我能清楚地解释。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，所有其他IOCTL ID和数据都来自哪里。嗯，它甚至更简单，您不必费心去实现传输，我们拥有最简单的请求-响应界面。同样在程序文件中，交换协议（部分）的描述被意外重载，仅法语是一个遗憾。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/p1/y4/5e/p1y45e74qzrcfbffatkfde5osxm.png" alt="图片"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
据他介绍，在上述消息中，请求了固件版本（00 FA），并通过APPLI_XS_Fuji_ P106138A V4.3.0 @ACTIA 02.01.12这行收到了响应。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
所有。</font><font style="vertical-align: inherit;">我们配置CAN，使用ISO-TP协议发送请求响应地址以进行通信，并获得与汽车完全兼容的适配器。</font><font style="vertical-align: inherit;">为了易于使用，编写了尽可能符合PassThru J2534标准的包装器，以便该适配器可与包括其自身设计在内的各种汽车软件一起使用。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
工作视频（为方便调试，stdout输出到控制台）：</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/pG5GZoDYQoM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来源可以在这里找到</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN498340/index.html">关于新的IDA主页（评论）</a></li>
<li><a href="../zh-CN498346/index.html">GoLand 2020.1-增强了对Go模块的支持，很多自动完成功能以及更多功能</a></li>
<li><a href="../zh-CN498350/index.html">最好的面试和求职材料</a></li>
<li><a href="../zh-CN498352/index.html">SHISHUA：世界上最快的伪随机数生成器</a></li>
<li><a href="../zh-CN498354/index.html">如何将“愿望清单”转换为“硬件”或半理想的半移动半桌面</a></li>
<li><a href="../zh-CN498360/index.html">集成服务器负载指标评估</a></li>
<li><a href="../zh-CN498362/index.html">金士顿在固态硬盘出货量方面保持领先地位：我们如何做到这一点？</a></li>
<li><a href="../zh-CN498366/index.html">Yandex开发人员每天执行哪些算法</a></li>
<li><a href="../zh-CN498368/index.html">一键开关的故事</a></li>
<li><a href="../zh-CN498370/index.html">SAP UI5和确认窗口：关于上下文</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>