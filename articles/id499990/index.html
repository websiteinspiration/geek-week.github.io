<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚩 🤟🏿 ♐️ Geocoding Bagaimana cara mengikat 250 ribu alamat ke koordinat dalam 10 menit? ⚔️ 🐲 👨🏿‍✈️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo, Habr! 
 
 Dalam artikel ini, saya ingin berbagi pengalaman saya dalam memecahkan masalah kecil dengan sejumlah besar alamat. Jika Anda pernah be...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Geocoding Bagaimana cara mengikat 250 ribu alamat ke koordinat dalam 10 menit?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/499990/"><img src="https://habrastorage.org/webt/6b/g3/oo/6bg3ooc_jcrhty63bg_33x8inta.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Halo, Habr! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam artikel ini, saya ingin berbagi pengalaman saya dalam memecahkan masalah kecil dengan sejumlah besar alamat. </font><font style="vertical-align: inherit;">Jika Anda pernah bekerja dengan geocoding API atau alat online yang digunakan, maka saya pikir Anda berbagi rasa sakit saya menunggu hasilnya selama beberapa jam, atau bahkan lebih. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini bukan tentang algoritma optimasi yang kompleks, tetapi tentang menggunakan layanan geocoding paket yang mengambil daftar alamat sebagai input dan mengembalikan file dengan hasilnya. </font><font style="vertical-align: inherit;">Ini dapat mengurangi waktu pemrosesan dari beberapa jam menjadi beberapa menit.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hal pertama yang pertama:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Latar Belakang</font></font></h3></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Batch Geocoding</font></font></h3></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Memilih Penyedia Paket Geocoder</font></font></h3></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Panduan Layanan Python</font></font></h3></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deskripsi Kelas Penuh</font></font></h3></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analisis Hasil</font></font></h3></a></li>
</ul><br>
<a name="history"></a><h3><font color="#9cc2ce"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Latar Belakang</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tugas tiba - "Mengikat koordinat 24 ribu alamat." </font><font style="vertical-align: inherit;">Hanya dua solusi untuk masalah terjadi:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aplikasi web untuk geocoding, yang digunakan di universitas;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tulis skrip berdasarkan REST API geocoder.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam kasus pertama, ternyata aplikasi web mogok setelah memproses ribuan alamat. Mendistribusikan data antar kolega adalah ide yang segera ditinggalkan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oleh karena itu, Anda perlu menggunakan API REST dari geocoder untuk menulis skrip Anda sendiri, dengan hasil disimpan (ini bukan cara yang sepenuhnya legal dan Anda perlu membaca ketentuan penggunaan layanan). Masalah baru muncul - itu adalah satu hal ketika kami menggunakan pencarian alamat dalam aplikasi dan segera mendapatkan hasilnya, tetapi ketika tugasnya adalah memproses lebih dari sepuluh ribu alamat dengan pengawetan, pekerjaan skrip sangat tertunda. Anda dapat menunggu satu atau dua jam, tetapi sejuta alamat harus memiliki geocode "waktu yang sangat banyak", jadi Anda perlu mencari solusi lain dan itu!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penyedia besar layanan geolokasi, selain layanan geocoding biasa, menawarkan paket geocoder (Batch Geocoder), hanya untuk memproses sejumlah besar alamat dalam satu permintaan.</font></font><br>
<br>
<a name="batch"></a><h3><font color="#9cc2ce"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Batch Geocoding</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nama layanan berbicara untuk dirinya sendiri - kami memiliki paket (misalnya, file csv dengan daftar alamat dalam bentuk tabel), yang kami unggah ke server, dan itu semua berfungsi untuk kami. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prosesnya terlihat seperti ini:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mempersiapkan dataset sehingga layanan dapat menerimanya tanpa kesalahan;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengatur parameter hasil pekerjaan (pemilihan kolom, pemisah ...);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unggah file ke cloud;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menunggu pemrosesan selesai;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unduh file yang sudah selesai.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berkat kekuatan komputasi awan, apa yang dilakukan dengan skrip yang ditulis sendiri dalam 1 jam selesai dalam 1 menit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Langkah selanjutnya adalah memilih perusahaan dengan ketentuan penggunaan paket geocoder yang paling loyal. </font><font style="vertical-align: inherit;">Pertama, tidak semua orang memiliki layanan seperti itu, yang lain memungkinkan Anda untuk menguji layanan dengan batasan yang serius. </font><font style="vertical-align: inherit;">Juga, jika Anda memiliki volume yang sangat besar, Anda perlu memperhatikan biaya transaksi tambahan, jika batas paket gratis terlampaui.</font></font><br>
<br>
<a name="provider"></a><h3><font color="#9cc2ce"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Memilih Penyedia Layanan Geocoding Batch</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di pasar global untuk layanan geolokasi, posisi utama ditempati oleh: </font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google Maps</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SINI Teknologi; </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MapBox</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TomTom </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESRI.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentu saja, jangan lupa tentang Yandex Technologies, yang memiliki posisi cukup kuat di Rusia. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya mengambil parameter berikut sebagai dasar untuk memilih penyedia:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jumlah permintaan ke layanan geocoding per bulan adalah gratis;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Batasi jumlah transaksi per hari;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ketersediaan layanan geocoding batch;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kemampuan untuk menggunakan geocoder paket dalam paket gratis. </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setiap perusahaan memiliki model monetisasi sendiri. </font><font style="vertical-align: inherit;">Tergantung pada proyeknya, satu atau model lain dapat bermain ke tangan atau sebaliknya menjadi batasan yang signifikan.</font></font><br>
<br>
<h4><font color="#9cc2ce"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google maps</font></font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk memulai dengan layanan geo Google, hal pertama yang perlu Anda lakukan adalah menambahkan informasi kartu kredit ke akun Anda. Batas bulanan 200 dolar virtual, kemudian muncul pembayaran transaksi tambahan dari kartu yang ditautkan. Dalam batas ini, Anda dapat menggunakan berbagai layanan, tetapi setiap transaksi dianggap berbeda. Misalnya, seribu permintaan geocoding akan menelan biaya $ 5, tetapi layanan pembangunan rute dua kali lebih mahal. Rincian lebih lanjut dapat ditemukan di situs, kami hanya tertarik pada layanan geocoding.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika $ 200 per bulan, maka mudah untuk menghitung jumlah transaksi gratis - 40.000 (layanan geocoding). </font><font style="vertical-align: inherit;">Tidak ada paket geocoder di antara layanan. </font><font style="vertical-align: inherit;">Ini berarti Anda harus menulis skrip sendiri dan hasilnya adalah sekitar 1 alamat per detik, yaitu enam jam untuk 24 ribu alamat. </font><font style="vertical-align: inherit;">Untuk mempercepat prosesnya, Anda dapat mencoba menjalankan skrip pada platform Google Cloud API, tetapi saya memutuskan untuk mencari solusi alternatif. </font><font style="vertical-align: inherit;">Tidak ada batasan jumlah transaksi per hari, jadi semua empat puluh ribu dapat dihabiskan sekaligus.</font></font><br>
<br>
<h4><font color="#9cc2ce"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SINI Teknologi</font></font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di masa lalu, Nokia Maps, dan di masa lalu yang lebih dalam, Navteq, menyediakan 250.000 transaksi setiap bulan secara gratis. Sama halnya dengan Google Maps, nomor ini berlaku untuk semua layanan dan masing-masing dianggap berbeda. Saat menggunakan paket gratis, Anda tidak perlu melampirkan kartu bank. Jika Anda melebihi batas, maka untuk setiap seribu transaksi tambahan Anda harus membayar $ 1. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penting untuk memiliki geocoder paket sebagai layanan terpisah, yang termasuk dalam paket gratis. Transaksi di dalamnya diperhitungkan sesuai dengan model yang sama seperti yang biasa, yaitu, setiap alamat dalam file, geocoder paket akan melihat dalam satu transaksi.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan judul artikel, jelas bahwa saya menggunakan geocoder batch HERE, karena Anda dapat menghabiskan semua transaksi pada geocoder dan melakukan 250.000 operasi geocoding per bulan. </font><font style="vertical-align: inherit;">Tetapi ini bukan satu-satunya pilihan, jadi kami melihat apa yang dimiliki perusahaan lain.</font></font><br>
<br>
<h4><font color="#9cc2ce"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kotak Map</font></font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat menggunakan geocoder MapBox, tersedia 100 ribu transaksi per bulan. </font><font style="vertical-align: inherit;">Perusahaan menganut model monetisasi yang sama dengan pembayaran untuk transaksi tambahan. </font><font style="vertical-align: inherit;">Hanya ada opsi yang menarik untuk "grosir" - semakin banyak transaksi yang Anda miliki, semakin sedikit biayanya (tentu saja ada batas pengurangan harga). </font><font style="vertical-align: inherit;">Misalnya, dari 100 ribu hingga 500 ribu, seribu permintaan tambahan akan dikenakan biaya $ 0,75, dari 500 ribu hingga 1 juta - $ 0,60, dll., Untuk lebih jelasnya, lihat situs web. </font><font style="vertical-align: inherit;">Sayangnya, batch geocoder hanya tersedia di akun berbayar.</font></font><br>
<br>
<h4><font color="#9cc2ce"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tomtom</font></font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Platform ini memungkinkan untuk melakukan 2.500 transaksi per hari, sekitar 75.000 per bulan. </font><font style="vertical-align: inherit;">Selama pengujian dan pengembangan, batas harian tidak terlihat sangat menarik dibandingkan dengan pesaing, tetapi pembayaran untuk transaksi tambahan adalah yang paling fleksibel. </font><font style="vertical-align: inherit;">Ada 8 opsi pembayaran untuk seribu permintaan tambahan dan harganya dikurangi dari $ 0,5 menjadi $ 0,42. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di antara layanan ada geocoder batch dengan kemampuan untuk memproses hingga 10 ribu alamat per permintaan (namun, batas harian harus diperhitungkan).</font></font><br>
<br>
<h4><font color="#9cc2ce"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teknologi Yandex</font></font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebuah model dengan batas transaksi harian untuk Yandex, tetapi lebih setia 25 ribu permintaan. </font><font style="vertical-align: inherit;">Jika Anda mengalikan angka ini dengan jumlah hari dalam sebulan, Anda mendapatkan angka yang mengesankan 750 ribu. </font><font style="vertical-align: inherit;">Situs ini menyajikan harga untuk seribu transaksi tambahan dalam rubel mulai dari 120 rubel. </font><font style="vertical-align: inherit;">hingga 11 rubel </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Paket geocoder sebagai layanan tidak disajikan, sehingga untuk mencapai beberapa jenis optimasi akan gagal.</font></font><br>
<br>
<h4><font color="#9cc2ce"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESRI</font></font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Paket gratis yang sangat menggoda dengan 1 juta transaksi per bulan. </font><font style="vertical-align: inherit;">Perusahaan juga membebankan 50 kredit untuk setiap akun (kurang lebih setara dengan $ 5). </font><font style="vertical-align: inherit;">Perlu dicatat bahwa ini adalah rencana paling setia untuk penggunaan layanan geolokasi. </font><font style="vertical-align: inherit;">Ada juga layanan geocoding batch, tetapi Anda dapat menggunakannya hanya jika Anda memiliki akun perusahaan di platform ArcGIS Online.</font></font><br>
<br>
<h4><font color="#9cc2ce"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apa yang harus dipilih pada akhirnya?</font></font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cara termudah adalah membuat pilihan dengan menyusun tabel kecil: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kg/xy/b1/kgxyb1kmzemqxqicwajfi7hggva.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Akibatnya, pilihan saya jatuh di SINI karena itu adalah pilihan terbaik untuk menyelesaikan masalah saya. </font><font style="vertical-align: inherit;">Tentu saja, saya melakukan jauh dari analisis lengkap, idealnya Anda perlu menjalankan dataset Anda melalui semua geocoder untuk menilai kualitas. </font><font style="vertical-align: inherit;">Plus, jika Anda memiliki beberapa juta alamat, Anda harus memikirkan paket berbayar dan kemudian Anda perlu memperhitungkan biaya penambahan. </font><font style="vertical-align: inherit;">transaksi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tujuan artikel ini bukan untuk membandingkan perusahaan, tetapi untuk memecahkan masalah mengoptimalkan geocoding dari sejumlah besar alamat. </font><font style="vertical-align: inherit;">Saya baru saja menunjukkan pikiran saya ketika memilih penyedia layanan.</font></font><br>
<br>
<a name="guide"></a><h3><font color="#9cc2ce"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Panduan Layanan Python</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama, Anda perlu membuat akun di portal untuk pengembang dan menghasilkan REST API KEY di bagian proyek. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang Anda dapat bekerja dengan platform. </font><font style="vertical-align: inherit;">Saya hanya akan menjelaskan sebagian dari fungsi yang dimiliki geocoder paket HERE: memuat data, memeriksa status, menyimpan hasil. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, mari kita mulai dengan mengimpor perpustakaan yang diperlukan:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> zipfile
<span class="hljs-keyword">import</span> io
<span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selanjutnya, jika tidak ada kesalahan terjadi, buat kelas:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Batch</span>:</span><font></font>
<font></font>
    SERVICE_URL = <span class="hljs-string">"https://batch.geocoder.ls.hereapi.com/6.2/jobs"</span>
    jobId = <span class="hljs-literal">None</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, apikey=<span class="hljs-string">"your_api_key"</span></span>):</span><font></font>
        self.apikey = apikey<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Artinya, selama inisialisasi, kelas harus melewati kuncinya sendiri untuk REST API. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Variabel SERVICE_URL adalah URL dasar untuk bekerja dengan layanan geocoding batch. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan dalam jobId pengidentifikasi pekerjaan geocoder saat ini akan disimpan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Poin penting adalah struktur data yang benar berdasarkan permintaan. </font><font style="vertical-align: inherit;">File harus berisi dua kolom yang diperlukan: recId dan searchText. </font><font style="vertical-align: inherit;">Jika tidak, layanan akan mengembalikan respons dengan informasi tentang kesalahan unduhan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berikut ini contoh dataset:</font></font><br>
<br>
<pre><code class="plaintext hljs">   recId; searchText<font></font>
   1; -, . , 6<font></font>
   2; ,  1,  -., 72<font></font>
   3; 425 W Randolph St Chicago IL 60606<font></font>
   4; , DJ106 20-30, Sibiu 557260<font></font>
   5; 200 S Mathilda Ave Sunnyvale CA 94086<font></font>
  </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fungsi untuk mengunggah file ke cloud:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start</span>(<span class="hljs-params">self, filename, indelim=<span class="hljs-string">";"</span>, outdelim=<span class="hljs-string">";"</span></span>):</span><font></font>
        <font></font>
        file = open(filename, <span class="hljs-string">'rb'</span>)<font></font>
<font></font>
        params = {<font></font>
            <span class="hljs-string">"action"</span>: <span class="hljs-string">"run"</span>,
            <span class="hljs-string">"apiKey"</span>: self.apikey,
            <span class="hljs-string">"politicalview"</span>:<span class="hljs-string">"RUS"</span>,
            <span class="hljs-string">"gen"</span>: <span class="hljs-number">9</span>,
            <span class="hljs-string">"maxresults"</span>: <span class="hljs-string">"1"</span>,
            <span class="hljs-string">"header"</span>: <span class="hljs-string">"true"</span>,
            <span class="hljs-string">"indelim"</span>: indelim,
            <span class="hljs-string">"outdelim"</span>: outdelim,
            <span class="hljs-string">"outcols"</span>: <span class="hljs-string">"displayLatitude,displayLongitude,locationLabel,houseNumber,street,district,city,postalCode,county,state,country"</span>,
            <span class="hljs-string">"outputcombined"</span>: <span class="hljs-string">"true"</span>,<font></font>
        }<font></font>
<font></font>
        response = requests.post(self.SERVICE_URL, params=params, data=file)<font></font>
        self.__stats (response)<font></font>
        file.close()<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semuanya cukup sederhana, buka file dengan daftar alamat untuk dibaca, bentuk kamus dari parameter permintaan GET. </font><font style="vertical-align: inherit;">Beberapa parameter layak dijelaskan:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Aksi": "jalankan" - mulai pemrosesan alamat;</font></font></li>
<li>“politicalView”: “RUS” –    .         (    );</li>
<li>“gen”: 9 –   (   );</li>
<li>“maxresults”: 1 –          ;</li>
<li>“header”: true –        ;</li>
<li>“indelim”: “;” –   ,  ;</li>
<li>“outdelim”: “;” –    ;</li>
<li>“outcols”: “” –  ,      ;</li>
<li>“outcombined”: true –                .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selanjutnya, cukup kirim permintaan menggunakan perpustakaan permintaan dan tampilkan statistik. </font><font style="vertical-align: inherit;">Tentu saja, Anda harus menutup file di akhir fungsi. </font><font style="vertical-align: inherit;">Fungsi __stats mem-parsing respons server, yang berisi Id dari pekerjaan yang sedang berjalan, dan juga menampilkan informasi umum tentang operasi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Langkah selanjutnya adalah memeriksa status pekerjaan. </font><font style="vertical-align: inherit;">Permintaan dibentuk dengan cara yang sama, hanya perlu untuk mentransfer ID operasi. </font><font style="vertical-align: inherit;">Parameter tindakan harus mengandung nilai "status". </font><font style="vertical-align: inherit;">Fungsi __stats menampilkan statistik lengkap ke konsol untuk memperkirakan waktu shutdown geocoder.</font></font><br>
<br>
<pre><code class="python hljs">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">status</span> (<span class="hljs-params">self, jobId = None</span>):</span><font></font>
<font></font>
        <span class="hljs-keyword">if</span> jobId <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<font></font>
            self.jobId = jobId<font></font>
        <font></font>
        statusUrl = self.SERVICE_URL + <span class="hljs-string">"/"</span> + self.jobId<font></font>
        <font></font>
        params = {<font></font>
            <span class="hljs-string">"action"</span>: <span class="hljs-string">"status"</span>,
            <span class="hljs-string">"apiKey"</span>: self.apikey,<font></font>
        }<font></font>
        <font></font>
        response = requests.get(statusUrl, params=params)<font></font>
        self.__stats (response)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Salah satu fungsi terpenting adalah menyimpan hasilnya. </font><font style="vertical-align: inherit;">Untuk kenyamanan, lebih baik segera unzip file yang berasal dari server. </font><font style="vertical-align: inherit;">Permintaan untuk menyimpan file identik dengan memeriksa status, cukup tambahkan / hasil di akhir.</font></font><br>
<br>
<pre><code class="python hljs">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">result</span> (<span class="hljs-params">self, jobId = None</span>):</span><font></font>
<font></font>
        <span class="hljs-keyword">if</span> jobId <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<font></font>
            self.jobId = jobId<font></font>
        <font></font>
        print(<span class="hljs-string">"Requesting result data ..."</span>)<font></font>
        <font></font>
        resultUrl = self.SERVICE_URL + <span class="hljs-string">"/"</span> + self.jobId + <span class="hljs-string">"/result"</span><font></font>
        <font></font>
        params = {<font></font>
            <span class="hljs-string">"apiKey"</span>: self.apikey<font></font>
        }<font></font>
        <font></font>
        response = requests.get(resultUrl, params=params, stream=<span class="hljs-literal">True</span>)<font></font>
        <font></font>
        <span class="hljs-keyword">if</span> (response.ok):    <font></font>
            zipResult = zipfile.ZipFile(io.BytesIO(response.content))<font></font>
            zipResult.extractall()<font></font>
            print(<span class="hljs-string">"File saved successfully"</span>)<font></font>
        <font></font>
        <span class="hljs-keyword">else</span>:<font></font>
            print(<span class="hljs-string">"Error"</span>)<font></font>
            print(response.text)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fungsi terakhir untuk mem-parsing respons layanan. </font><font style="vertical-align: inherit;">Juga tugasnya adalah untuk menyimpan pengidentifikasi tugas geocoding saat ini:</font></font><br>
<br>
<pre><code class="python hljs">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__stats</span> (<span class="hljs-params">self, response</span>):</span>
        <span class="hljs-keyword">if</span> (response.ok):<font></font>
            parsedXMLResponse = BeautifulSoup(response.text, <span class="hljs-string">"lxml"</span>)<font></font>
<font></font>
            self.jobId = parsedXMLResponse.find(<span class="hljs-string">'requestid'</span>).get_text()<font></font>
            <font></font>
            <span class="hljs-keyword">for</span> stat <span class="hljs-keyword">in</span> parsedXMLResponse.find(<span class="hljs-string">'response'</span>).findChildren():
                <span class="hljs-keyword">if</span>(len(stat.findChildren()) == <span class="hljs-number">0</span>):<font></font>
                    print(<span class="hljs-string">"{name}: {data}"</span>.format(name=stat.name, data=stat.get_text()))<font></font>
<font></font>
        <span class="hljs-keyword">else</span>:<font></font>
            print(response.text)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mengujinya, jalankan interpreter Python di folder skrip. </font><font style="vertical-align: inherit;">Kelas Batch ada di file </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">geocoder.py</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt;&gt;&gt; from geocoder import Batch<font></font>
&gt;&gt;&gt; service = Batch(apikey="   REST API")<font></font>
&gt;&gt;&gt; service.start("big_data_addresses.csv", indelim=";", outdelim=";")<font></font>
<font></font>
requestid: "  Id "<font></font>
status: accepted<font></font>
totalcount: 0<font></font>
validcount: 0<font></font>
invalidcount: 0<font></font>
processedcount: 0<font></font>
pendingcount: 0<font></font>
successcount: 0<font></font>
errorcount: 0<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pekerjaan bagus dimulai. </font><font style="vertical-align: inherit;">Periksa status:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt;&gt;&gt; service.status()<font></font>
<font></font>
requestid: "  Id "<font></font>
status: completed<font></font>
jobstarted: 2020-04-27T10:09:58.000Z<font></font>
jobfinished: 2020-04-27T10:17:18.000Z<font></font>
totalcount: 249999<font></font>
validcount: 249999<font></font>
invalidcount: 0<font></font>
processedcount: 249999<font></font>
pendingcount: 0<font></font>
successcount: 249978<font></font>
errorcount: 21<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami melihat bahwa pemrosesan dataset selesai. </font><font style="vertical-align: inherit;">Hanya dalam tujuh menit, dimungkinkan untuk memprogram 250 ribu alamat (tidak termasuk kesalahan - kesalahan). </font><font style="vertical-align: inherit;">Tetap menyimpan hasilnya:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt;&gt;&gt; service.result()<font></font>
Requesting result data ...<font></font>
File saved successfully<font></font>
</code></pre><br>
<a name="code"></a><h3><font color="#9cc2ce"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deskripsi Kelas Penuh</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya pikir tidak ada salahnya menambahkan skrip sepenuhnya:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> zipfile
<span class="hljs-keyword">import</span> io
<span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Batch</span>:</span><font></font>
<font></font>
    SERVICE_URL = <span class="hljs-string">"https://batch.geocoder.ls.hereapi.com/6.2/jobs"</span>
    jobId = <span class="hljs-literal">None</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, apikey=<span class="hljs-string">"   REST API "</span></span>):</span><font></font>
        self.apikey = apikey<font></font>
        <font></font>
            <font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start</span>(<span class="hljs-params">self, filename, indelim=<span class="hljs-string">";"</span>, outdelim=<span class="hljs-string">";"</span></span>):</span><font></font>
        <font></font>
        file = open(filename, <span class="hljs-string">'rb'</span>)<font></font>
<font></font>
        params = {<font></font>
            <span class="hljs-string">"action"</span>: <span class="hljs-string">"run"</span>,
            <span class="hljs-string">"apiKey"</span>: self.apikey,
            <span class="hljs-string">"politicalview"</span>:<span class="hljs-string">"RUS"</span>,
            <span class="hljs-string">"gen"</span>: <span class="hljs-number">9</span>,
            <span class="hljs-string">"maxresults"</span>: <span class="hljs-string">"1"</span>,
            <span class="hljs-string">"header"</span>: <span class="hljs-string">"true"</span>,
            <span class="hljs-string">"indelim"</span>: indelim,
            <span class="hljs-string">"outdelim"</span>: outdelim,
            <span class="hljs-string">"outcols"</span>: <span class="hljs-string">"displayLatitude,displayLongitude,locationLabel,houseNumber,street,district,city,postalCode,county,state,country"</span>,
            <span class="hljs-string">"outputcombined"</span>: <span class="hljs-string">"true"</span>,<font></font>
        }<font></font>
<font></font>
        response = requests.post(self.SERVICE_URL, params=params, data=file)<font></font>
        self.__stats (response)<font></font>
        file.close()<font></font>
    <font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">status</span> (<span class="hljs-params">self, jobId = None</span>):</span><font></font>
<font></font>
        <span class="hljs-keyword">if</span> jobId <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<font></font>
            self.jobId = jobId<font></font>
        <font></font>
        statusUrl = self.SERVICE_URL + <span class="hljs-string">"/"</span> + self.jobId<font></font>
        <font></font>
        params = {<font></font>
            <span class="hljs-string">"action"</span>: <span class="hljs-string">"status"</span>,
            <span class="hljs-string">"apiKey"</span>: self.apikey,<font></font>
        }<font></font>
        <font></font>
        response = requests.get(statusUrl, params=params)<font></font>
        self.__stats (response)<font></font>
        <font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">result</span> (<span class="hljs-params">self, jobId = None</span>):</span><font></font>
<font></font>
        <span class="hljs-keyword">if</span> jobId <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<font></font>
            self.jobId = jobId<font></font>
        <font></font>
        print(<span class="hljs-string">"Requesting result data ..."</span>)<font></font>
        <font></font>
        resultUrl = self.SERVICE_URL + <span class="hljs-string">"/"</span> + self.jobId + <span class="hljs-string">"/result"</span><font></font>
        <font></font>
        params = {<font></font>
            <span class="hljs-string">"apiKey"</span>: self.apikey<font></font>
        }<font></font>
        <font></font>
        response = requests.get(resultUrl, params=params, stream=<span class="hljs-literal">True</span>)<font></font>
        <font></font>
        <span class="hljs-keyword">if</span> (response.ok):    <font></font>
            zipResult = zipfile.ZipFile(io.BytesIO(response.content))<font></font>
            zipResult.extractall()<font></font>
            print(<span class="hljs-string">"File saved successfully"</span>)<font></font>
        <font></font>
        <span class="hljs-keyword">else</span>:<font></font>
            print(<span class="hljs-string">"Error"</span>)<font></font>
            print(response.text)<font></font>
    <font></font>
<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__stats</span> (<span class="hljs-params">self, response</span>):</span>
        <span class="hljs-keyword">if</span> (response.ok):<font></font>
            parsedXMLResponse = BeautifulSoup(response.text, <span class="hljs-string">"lxml"</span>)<font></font>
<font></font>
            self.jobId = parsedXMLResponse.find(<span class="hljs-string">'requestid'</span>).get_text()<font></font>
            <font></font>
            <span class="hljs-keyword">for</span> stat <span class="hljs-keyword">in</span> parsedXMLResponse.find(<span class="hljs-string">'response'</span>).findChildren():
                <span class="hljs-keyword">if</span>(len(stat.findChildren()) == <span class="hljs-number">0</span>):<font></font>
                    print(<span class="hljs-string">"{name}: {data}"</span>.format(name=stat.name, data=stat.get_text()))<font></font>
<font></font>
        <span class="hljs-keyword">else</span>:<font></font>
            print(response.text)<font></font>
</code></pre><br>
<a name="result"></a><h3><font color="#9cc2ce"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analisis Hasil</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai hasilnya, saya beralih dari aplikasi online yang bekerja lambat ke layanan geocoding batch. </font><font style="vertical-align: inherit;">Pilihan penyedia layanan geografis bergantung sepenuhnya pada tugas yang Anda hadapi. </font><font style="vertical-align: inherit;">Saya secara teratur menerima permintaan untuk memproses sejumlah besar alamat dan pendekatan yang dijelaskan dalam artikel membantu mengurangi waktu secara signifikan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya harap artikel ini bermanfaat dan tentu saja saya terbuka untuk komentar dan tambahan!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id499974/index.html">Game 3D di Instagram Javascript, atau jalur penerbangan sosis</a></li>
<li><a href="../id499978/index.html">Terjemahan buku Andrew Un, Passion for Machine Learning, Bab 36 dan 37</a></li>
<li><a href="../id499982/index.html">Rencana Penguji Pemula: Dari "Masukkan TI" ke "Saya Seorang Insinyur!"</a></li>
<li><a href="../id499986/index.html">Dan lagi tentang tertanam: mencari bug di proyek Embox</a></li>
<li><a href="../id499988/index.html">Gula dan COVID-19</a></li>
<li><a href="../id499992/index.html">Desain teknologi untuk implementasi sistem penagihan untuk klien korporat (bagian 2)</a></li>
<li><a href="../id499994/index.html">Kapan coronavirus akan berakhir</a></li>
<li><a href="../id500000/index.html">Untuk Radio Day. Komunikasi - saraf perang</a></li>
<li><a href="../id500002/index.html">Spesialis TI vs salesman: dan dunia terbelah menjadi dua</a></li>
<li><a href="../id500008/index.html">Temui para pemain tingkat atas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>