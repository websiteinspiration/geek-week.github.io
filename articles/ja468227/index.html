<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔖 🚧 🕞 アクセラレーションinstagram.com。パート1 👮 😀 🍒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="近年、instagram.comにはたくさんの新しいものが登場しています。沢山の。たとえば、ストーリーテリングツール、フィルター、クリエイティブツール、通知、ダイレクトメッセージ。しかし、プロジェクトが成長するにつれ、これにより1つの悲しい副作用が生じました。それは、instagram.comのパフ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>アクセラレーションinstagram.com。パート1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/468227/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">近年</font><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instagram.comに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はたくさんの新しい</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">もの</font></a><font style="vertical-align: inherit;">が登場</font><font style="vertical-align: inherit;">してい</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">沢山の。</font><font style="vertical-align: inherit;">たとえば、ストーリーテリングツール、フィルター、クリエイティブツール、通知、ダイレクトメッセージ。</font><font style="vertical-align: inherit;">しかし、プロジェクトが成長するにつれ、これにより1つの悲しい副作用が生じました。それは、instagram.comのパフォーマンスが低下し始めたことです。</font><font style="vertical-align: inherit;">過去1年間、Instagram開発チームはこれを修正するために継続的に努力してきました。</font><font style="vertical-align: inherit;">これにより、Instagramフィード（フィードページ）の総読み込み時間がほぼ50％短縮されました。</font><font style="vertical-align: inherit;">
今日、私たちは、instagram.comがどのように高速化されたかという話に捧げられた一連の記事の最初の資料の翻訳を公開します。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/wl/oy/ns/wloynshoivqpdf3vtudd3xypwxq.jpeg"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Webプロジェクトのパフォーマンスの最適化について</font></font></font></h2><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/032/871/987/0328719872d42adf9b7690c1a6b63693.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">過去1年間のパフォーマンスの向上（Instagramフィード、表示完了メトリック、ms）</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Webアプリケーションのパフォーマンスを改善するための最も重要なアプローチの1つは、読み込みと処理のリソースに適切に優先順位を付け、ページの読み込み中のブラウザのダウンタイムを減らすことです。私たちの場合、これらの最適化の多くは、コードのサイズを削減するよりも効果的であることが証明されています。原則として、コードのサイズに関する不満はありませんでした。十分コンパクトでした。その寸法は、プロジェクトに多くの小さな改良が加えられた後にのみ、私たちを悩ませ始めました（コードサイズの最適化についても報告する予定です）。さらに、このような改善により、プロジェクト開発プロセスへの影響も少なくなりました。彼らはより少ないコード変更とより少ないリファクタリングを必要としました。その結果、当初はこの分野に的を絞って取り組みましたが、リソースのプリロードから始めます。</font></font><br>
<br>
<h2><font color="#3AC1EF">    , JavaScript-  ,    ,    ,     </font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最適化の一般的な原則は、ページをロードするために必要なリソースについてブラウザにできるだけ早く通知することでした。私たちは、プロジェクト開発者として、多くの場合、これに正確に何が必要かを事前に知っていました。しかし、ブラウザは、ページマテリアルの特定の部分がロードされて処理されるまで、これを理解できませんでした。問題のリソースには、ほとんどの場合、JavaScriptを使用して動的にロードされるリソース（たとえば、他のスクリプト、画像、XHRリクエストの実行に必要な素材）が含まれていました。実際、ブラウザは、JavaScriptコードを解析して実行するまで、これらの依存リソースを検出できません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ブラウザ自体がこれらのリソースを見つけるまで待つのではなく、ヒントを与えて、すぐにリソースのダウンロードを開始できます。 HTML属性を使用してこれを行いました</font></font><code>preload</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。次のようになります。</font></font><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"preload"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"my-js-file.js"</span> <span class="hljs-attr">as</span>=<span class="hljs-string">"script"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span> /&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要なページ読み込みパスの2種類のリソースに同様のヒントを使用します。これは、動的に読み込まれるJavaScriptコードと、データを受信するためのGraphQL XHRリクエストの動的に読み込まれるマテリアルです。動的に読み込まれるスクリプトは</font></font><code>import('...')</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、特定のクライアントルートの</font><font style="vertical-align: inherit;">ビュー構成</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">使用して読み込まれるスクリプトです</font><font style="vertical-align: inherit;">。サーバーエントリポイントとクライアントルートスクリプトの対応リストを保持しています。その結果、サーバー上でページをロードするリクエストを受け取ったときに、クライアントがダウンロードする必要のあるルーティング用のスクリプトがわかります。その結果、ページのHTMLコードを生成するときに、適切なヒントをページに追加できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、エントリポイントの操作</font></font><code>FeedPage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クライアントルーターが最終的にダウンロード要求を完了することはわかっています</font></font><code>FeedPageContainer.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">その結果、次の構成をページコードに追加できます。</font></font><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"preload"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/static/FeedPageContainer.js"</span> <span class="hljs-attr">as</span>=<span class="hljs-string">"script"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span> /&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同様に、特定のページのエントリポイントに対してGraphQLクエリの実行が計画されていることがわかっている場合、これは、このクエリの実行を促進するためにマテリアルを事前にロードする必要があることを意味します。</font><font style="vertical-align: inherit;">このようなGraphQLクエリの実行には時間がかかる場合があり、クエリ結果が返されるまでページをレンダリングできないため、これは特に重要です。</font><font style="vertical-align: inherit;">このため、できるだけ早くサーバーにそのような要求への応答の形成に従事させる必要があります。</font></font><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"preload"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/graphql/query?id=12345"</span> <span class="hljs-attr">as</span>=<span class="hljs-string">"fetch"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"application/json"</span> /&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ページ読み込み機能の変更は、接続が遅い場合に特に顕著です。高速3G接続（リソースのプリロードが使用されない状況を示す最初のウォーターフォールチャート）を</font></font><code>FeedPageContainer.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シミュレートすると、それに関連付けられているGraphQLクエリの</font><font style="vertical-align: inherit;">ロード</font><font style="vertical-align: inherit;">と実行が、ダウンロードが完了した後にのみ開始されることがわかります</font></font><code>Consumer.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。ただし、プリロードが使用されている場合、スクリプトのロード</font></font><code>FeedPageContainer.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">とGraphQLクエリの実行は、HTMLページが利用可能になった直後に開始できます。これにより、遅延読み込みメカニズムを使用するセカンダリスクリプトのダウンロードに必要な時間が短縮されます。ここ</font></font><code>FeedSidebarContainer.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>ActivityFeedBox.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（これは</font></font><code>FeedPageContainer.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）処理が完了した直後にロードが開始されます</font></font><code>Consumer.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fe0/10c/222/fe010c2222b31034b109f5cc0d378613.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">予圧未使用</font></font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e3f/e33/b78/e3fe33b78b3b5fe1c04fa3175809e25d.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">予圧使用</font></font></font></i><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プリロードを優先するメリット</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この属性を</font></font><code>preload</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用すると、リソースのロードをより速く開始できる</font><font style="vertical-align: inherit;">という事実に加えて、</font><font style="vertical-align: inherit;">このメカニズムの使用には別の利点があります。これは、非同期スクリプトの読み込みのネットワーク優先度を上げることです。クリティカルパスで非同期に読み込まれるスクリプトを使用してページを読み込む場合、デフォルトで優先度が低いため、これは重要になります。その結果、ユーザーに表示されるページの領域に関連するXHRリクエストと画像の優先度は、表示領域外のマテリアルの優先度よりも高くなります。しかし、これにより、ページのレンダリングに必要な重要なスクリプトがブロックされるか、帯域幅を他のリソースと共有するように強制される状況が発生する可能性があります。興味があれば- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちら</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chromeのアセットの優先順位に関する包括的なウォークスルー。</font><font style="vertical-align: inherit;">プリロードメカニズムを慎重に使用すると（これについては以下で詳しく説明します）、開発者はブラウザがページを最初にロードするプロセスに優先順位を付ける方法をある程度制御できます。</font><font style="vertical-align: inherit;">これは、ページを正しく表示するために重要なリソースが開発者にわかっている場合に特に当てはまります。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プリロードの優先順位付けの問題</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リソースのプリロードの問題は、リソースのロードの優先順位に影響を与えるために開発者に追加のレバレッジを与えるという事実に正確にあります。これは、開発者が適切な優先順位付けに対してより多くの責任を負うことを意味します。たとえば、モバイルおよびWiFiネットワークの速度が非常に遅く、パケット損失の割合が高い地域でサイトをテストすると、デザインの処理中に実行され</font></font><code>&lt;link rel="preload" as="script"&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">たリクエストは、実行されたリクエストよりも優先度が高い</font><font style="vertical-align: inherit;">ことがわかりました</font></font><code>&lt;script /&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ミッションクリティカルなページのレンダリングパスで使用されるJavaScriptバンドル</font><font style="vertical-align: inherit;">タグを処理するとき</font><font style="vertical-align: inherit;">。これにより、ページ全体の読み込み時間が長くなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この問題の原因は、ページにプリロードタグをどのように配置したかです。</font><font style="vertical-align: inherit;">つまり、現在のページの一部であるバンドルに対してのみプリロードヒントを追加しました。これは、クライアントルーターと非同期でロードする予定でした。</font></font><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-comment">&lt;!--   ,    --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"preload"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"SomeConsumerRoute.js"</span> <span class="hljs-attr">as</span>=<span class="hljs-string">"script"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"preload"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"..."</span> <span class="hljs-attr">as</span>=<span class="hljs-string">"script"</span> /&gt;</span><font></font>
...<font></font>
<font></font>
<span class="hljs-comment">&lt;!-- ,      --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"Common.js"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"Consumer.js"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例えば、ログアウトページに、私たちはロード</font></font><code>SomeConsumerRoute.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font></font><code>Common.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">して</font></font><code>Consumer.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、予圧リソースが優先してロードされますが、それらが解析されていないので、このブロックは、パース</font></font><code>Common.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>Consumer.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">Chrome Data Saver開発チームは同様のプリロードの問題を発見し、</font><font style="vertical-align: inherit;">この問題の解決策</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">について説明し</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ました。</font><font style="vertical-align: inherit;">彼らの場合、タグの後に常に非同期リソースをプリロードするための構造を配置することが決定されました</font></font><code>&lt;script /&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これらの非同期リソースを使用するリソース。</font><font style="vertical-align: inherit;">すべてのスクリプトをプリロードし、対応する構文を必要な順序でコードに配置することにしました。</font><font style="vertical-align: inherit;">これにより、ページのすべてのスクリプトリソースのプリロードをできるだけ早く開始できます。</font><font style="vertical-align: inherit;">これには、特定のサーバーデータがページに配置されるまでHTMLに追加できないスクリプトを同期的に読み込むためのタグが含まれます。</font><font style="vertical-align: inherit;">これにより、スクリプトの読み込み順序を制御できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下は、すべてのJavaScriptバンドルをプリロードするマークアップです。</font></font><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-comment">&lt;!--      --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"preload"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"Common.js"</span> <span class="hljs-attr">as</span>=<span class="hljs-string">"script"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"preload"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"Consumer.js"</span> <span class="hljs-attr">as</span>=<span class="hljs-string">"script"</span> /&gt;</span>
<span class="hljs-comment">&lt;!--   ,    --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"preload"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"SomeConsumerRoute.js"</span> <span class="hljs-attr">as</span>=<span class="hljs-string">"script"</span> /&gt;</span><font></font>
...<font></font>
<span class="hljs-comment">&lt;!-- ,      --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"Common.js"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"Consumer.js"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"SomeConsumerRoute.js"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span> <span class="hljs-attr">async</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">画像のプリロード</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
instagram.comの主要な作業領域の1つはFeedです。無限スクロールをサポートする画像とビデオのページです。このページはこのように記入します。まず、最初のパブリケーションセットをダウンロードし、次にユーザーがページをスクロールしながら、追加のマテリアルセットをロードします。ただし、ユーザーがテープの底に達するたびに新しい材料がロードされるのを待つことは望ましくありません。そのため、このページでの作業を便利にするために、ユーザーがテープの最後に到達する前に新しいマテリアルセットをアップロードします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際には、これはいくつかの理由で簡単な作業ではありません。</font></font><br>
<br>
<ul>
<li> ,   ,   ,          ,   .</li>
<li>        ,       ,       . ,   ,         ,      ,   «»   .</li>
<li> instagram.com             .       ,   <code>srcset</code>  <code>&lt;img&gt;</code>.    ,   ,    ,     .  ,          ,    .   ,     ,     .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この問題を解決するために使用したアプローチは、非同期タスクのキューイングを担当する優先順位付けタスクの抽象化を作成することでした（この場合、これらは、出力用の次のパブリケーションセットをテープにプリロードするためのタスクです）。同様のタスクが最初に優先度付きでキューに入れられます</font></font><code>idle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（ここで使用</font></font><code>requestIdleCallback</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。つまり、ブラウザが他の重要な作業でビジーになるまで、そのようなタスクは開始されません。ただし、ユーザーがダウンロードしたパブリケーションの現在のセットが終了する場所の近くまでユーザーがページをスクロールすると、資料をプリロードするこのタスクの優先度は次のように変わります。</font></font><code>high</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。これは、スタンバイコールバックをキャンセルすることによって行われ、その後、プリロードプロセスがすぐに開始されます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b62/701/f67/b62701f67c074ca53154fe434123c756.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テープの最初と途中では、データをプリロードするタスクの優先度はアイドルで、テープの最後では優先度が高くなっ</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ています。JSONデータが次のパブリケーションのバッチのロードを完了した後、このバッチから画像をプリロードするための繰り返しのバックグラウンドタスクをキューに入れます。画像のプリロードは、パブリケーションが並行してではなく、フィードに表示される順序で実行されます。これにより、ユーザーが目にするページ上の場所に最も近いパブリケーションのデータをロードして画像を表示するタスクに優先順位を付けることができます。正しいサイズの画像をダウンロードするには、非表示のメディアコンポーネントを使用します。そのパラメーターは、現在のテープのパラメーターに対応しています。このコンポーネント内に</font></font><code>&lt;img&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、属性を使用</font><font style="vertical-align: inherit;">する要素</font><font style="vertical-align: inherit;">があります</font></font><code>srcset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、実際の出版物をフィードに表示するために使用されるものと同じです。つまり、どの画像をプリロードするかを決定する機能をブラウザーに提供できます。その結果、ブラウザーは、画像をプリロードするときに使用したのと同じロジックを使用して画像を表示します。また、同様のメディアコンポーネントを使用して、サイトの他の領域の画像をプリロードできることも意味します。ユーザープロファイルページなど。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記の改善の全体的な効果により、写真のアップロードに必要な時間が25％短縮されました。</font><font style="vertical-align: inherit;">ここでは、パブリケーションコードがDOMに追加されてから、パブリケーションの画像が読み込まれて表示されるまでの時間について説明します。</font><font style="vertical-align: inherit;">さらに、これにより、フィードの最後に到達したユーザーが新しい資料のダウンロードを待つために費やす時間が56％削減されました。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">読者の皆様！</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データのプリロードメカニズムを使用してWebプロジェクトを最適化していますか？</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/it/t5/3p/itt53pns2iucwylb3bwn1fmmtnu.png"></div></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja468213/index.html">tinc-boot-痛みのないフルメッシュネットワーク</a></li>
<li><a href="../ja468217/index.html">ジキル博士とハイド氏の企業文化</a></li>
<li><a href="../ja468219/index.html">JavaScriptの拡張可能な拡張メカニズム</a></li>
<li><a href="../ja468223/index.html">Habr Weekly＃19 /猫のBTドア、AIがだまされている理由、将来の雇用主に何を尋ねるべきか、iPhone 11 Proの1日</a></li>
<li><a href="../ja468225/index.html">Webpack AnalyzerとReact Lazy / Suspenseを使用してバンドルサイズを縮小する</a></li>
<li><a href="../ja468229/index.html">JavaScriptとTypeScriptのvoidに関する注意</a></li>
<li><a href="../ja468231/index.html">AEMのセキュリティはプラットフォームまたは実装の問題ですか？</a></li>
<li><a href="../ja468233/index.html">400万行のPythonコードを型チェックする方法。パート1</a></li>
<li><a href="../ja468235/index.html">400万行のPythonコードを型チェックする方法。パート2</a></li>
<li><a href="../ja468237/index.html">400万行のPythonコードを型チェックする方法。パート3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>