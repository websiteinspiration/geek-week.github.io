<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üí¥ üàµ üîØ Nous assemblons le r√©seau ZigBee le plus simple, programme sous Mbed, communiquons via MQTT üîå üç≥ üèöÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cet article est un excellent atelier de formation d'entr√©e de gamme sur l'utilisation du module XBee en conjonction avec un microcontr√¥leur dot√© de Mb...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Nous assemblons le r√©seau ZigBee le plus simple, programme sous Mbed, communiquons via MQTT</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/samsung/blog/497200/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cet article est un excellent atelier de formation d'entr√©e de gamme sur l'utilisation du module XBee en conjonction avec un microcontr√¥leur dot√© de Mbed OS. ZigBee est un standard long et solidement ancr√© dans les syst√®mes Smart Home (par exemple, il est utilis√© avec Z-Wave dans le hub Samsung SmartThings, voir notre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), il se caract√©rise par une faible consommation d'√©nergie, une facilit√© d'utilisation et, plus int√©ressant encore, la possibilit√© de cr√©er r√©seaux maill√©s auto-configurables. Vous verrez de l'atelier qu'il en est bien ainsi - nous examinerons la structure d'un tel r√©seau √† travers un utilitaire de visualisation pratique.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On suppose que vous savez d√©j√† ce qu'est ZigBee et √† quoi il sert. </font><font style="vertical-align: inherit;">Maintenant, vous voulez connecter votre premier module XBee et r√©soudre vos probl√®mes avec lui, sans entrer dans la programmation du module lui-m√™me, mais seulement en l'utilisant comme interface de communication. </font><font style="vertical-align: inherit;">Au final, nous enverrons toutes les donn√©es via une passerelle de fortune MQTT n'importe o√π, m√™me vers un serveur local, voire vers Internet. </font><font style="vertical-align: inherit;">Nous avons d√©cid√© de tout montrer sur l'exemple de Mbed comme le RTOS le plus simple et le plus accessible pour les d√©butants. </font><font style="vertical-align: inherit;">Vous serez convaincu que tout fonctionne ¬´pr√™t √† l'emploi¬ª et vous pouvez imm√©diatement commencer √† r√©aliser votre projet, m√™me si auparavant vous ne faisiez affaire qu'avec Arduino.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bp/5i/ot/bp5iota_umzhimxdl5yhgnmflzg.png"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le manuel comprendra les parties suivantes:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connexion et configuration du module XBee</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connectez les modules au r√©seau</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous configurons le module sans le retirer du bouclier</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©cup√©ration de donn√©es</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Envoi de donn√©es</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cr√©ation d'une passerelle MQTT simple</font></font><br>
</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais d'abord, une liste de composants: ce qui est souhaitable d'avoir pour faire tout ce qui pr√©c√®de.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Composants requis</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deux cartes compatibles Mbed. </font><font style="vertical-align: inherit;">Nous recommandons la carte de formation STM32 Nucleo comme relativement peu co√ªteuse et populaire √† des fins √©ducatives. </font><font style="vertical-align: inherit;">Le processus de programmation y est au maximum simplifi√©: r√©cup√©rez le programme dans un IDE gratuit en ligne, t√©l√©chargez le firmware assembl√© et ¬´d√©posez-le¬ª sur la carte, qui appara√Ætra dans le syst√®me comme un lecteur flash. </font><font style="vertical-align: inherit;">Quel mod√®le sp√©cifique √† prendre n'est pas important, mais ne prenez pas le plus ancien, faites attention √† la quantit√© de m√©moire. </font><font style="vertical-align: inherit;">Par exemple, F401RE - nous donnons juste pour √™tre pr√©cis, afin que vous ne vous trompiez pas dans leur diversit√© et dans un premier temps des codes alphab√©tiques incompr√©hensibles des processeurs STM.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ec/y3/nx/ecy3nxhuys7vlrzai3mq4yfzhy8.png" width="350"> <img src="https://habrastorage.org/webt/ec/y3/nx/ecy3nxhuys7vlrzai3mq4yfzhy8.png" width="350"><br>
</li>
<li> XBee-.      Digi.  ¬´¬ª ,  ,  , MBee,  ,    ,     ,      . /        :      ,      .   /  Pro:      ,      ,   Pro   .<br>
<img src="https://habrastorage.org/webt/r2/ed/ew/r2edew1y1gkdpcw9soz-vunnu9q.png"><img src="https://habrastorage.org/webt/m6/-n/aq/m6-naqf0x0qqrjpj-soxa6aulj0.png"><img src="https://habrastorage.org/webt/t2/x5/ng/t2x5ng0wfuoehd4oujmvhf1spha.png" width="200"><br>
</li>
<li>  XBee Shield V2 ( SeeedStudio).      -     ,        RX  TX XBee-.<br>
<img src="https://habrastorage.org/webt/jk/sv/75/jksv75ger3mv3zfwzfji4tliub0.png"><img src="https://habrastorage.org/webt/jk/sv/75/jksv75ger3mv3zfwzfji4tliub0.png"><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un convertisseur USB-UART avec connecteur pour XBee. </font><font style="vertical-align: inherit;">Il est n√©cessaire pour la configuration initiale. </font><font style="vertical-align: inherit;">Les modules XBee eux-m√™mes ne sont pas √©quip√©s d'une interface USB (ils n'y sont pour rien). </font><font style="vertical-align: inherit;">L'USB est n√©cessaire uniquement et exclusivement pour la communication entre le module et l'ordinateur, et dans l'appareil, il peut fonctionner sur un UART beaucoup plus simple. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le pas de fente des modules XBee est de 2,0 mm - pour l'√©lectronique, il n'est pas standard, dans le syst√®me m√©trique (nous sommes g√©n√©ralement habitu√©s √† voir l'√©tape 2.54 selon les normes am√©ricaines). </font><font style="vertical-align: inherit;">Par cons√©quent, malheureusement, ces modules ne sont pas ins√©r√©s dans la maquette et ils ont toujours besoin d'un adaptateur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout adaptateur convient ici, nous avons pris celui-ci de Waveshare:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/04/md/y5/04mdy5mhmm6cfwuj-a21a5eqagy.png" width="300"></li>
</ul><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connexion et configuration du module XBee</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La chose la plus simple que vous puissiez faire avec le module est de le connecter directement √† l'ordinateur via USB. </font><font style="vertical-align: inherit;">Nous aurons imm√©diatement acc√®s √† ses param√®tres de configuration.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installer XCTU</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour travailler avec XBee, il existe un programme officiel XCTU. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T√©l√©chargez-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> le et installez. </font><font style="vertical-align: inherit;">La documentation indique que dans Ubuntu, vous devez ajouter un utilisateur √† un groupe </font></font><code>dialout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour travailler avec des ports qui ne proviennent pas d'un superutilisateur - faites-le si vous ne l'avez pas encore fait:</font></font><br>
<br>
<pre><code class="bash hljs">sudo usermod -a -G dialout &lt;username&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
T√©l√©chargez l'archive zip √† partir du lien, elle contiendra un fichier </font></font><code>.run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Il doit √™tre rendu ex√©cutable (via </font></font><code>chmod +x _</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans la console ou: bouton droit de la souris - Propri√©t√©s - Autorisations) et ex√©cut√© </font></font><code>./40002881_V.run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est important de d√©marrer l'installation non pas √† partir de la racine (sans </font></font><code>sudo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), sinon il y aura des probl√®mes plus tard. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La configuration ressemble √† ceci:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/44/kg/iz/44kgizj3bjlvchzakcksvrh1i_u.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Programme XCTU</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s l'installation, vous pouvez d√©marrer le programme en ex√©cutant le fichier </font></font><code>app</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans le r√©pertoire o√π vous avez install√© le programme (par d√©faut - </font></font><code>~/Digi/XCTU-NG</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'apparence sera la suivante: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qr/wz/y0/qrwzy0nbyhomwp8g-k26jrluio4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce programme, vous pouvez ajouter votre module existant connect√© au port USB via un adaptateur. Cliquez sur le bouton D√©couvrir avec une loupe. Une fen√™tre appara√Æt vous demandant de s√©lectionner un port - comme vous pouvez le voir, le programme a correctement d√©tect√© le port dans le syst√®me </font></font><code>/dev/ttyUSB0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, il s'agit de notre adaptateur USB-UART.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rs/qr/h1/rsqrh1y2if1z6nr_zl844kdba4o.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fen√™tre sugg√®re de cocher la recherche. </font><font style="vertical-align: inherit;">Bien s√ªr, il y a une tentation de v√©rifier tout d'un coup pour trouver s√ªrement votre module. </font><font style="vertical-align: inherit;">Mais alors la recherche se poursuivra tr√®s longtemps. </font><font style="vertical-align: inherit;">En pratique, il est logique de laisser les cases coch√©es par d√©faut et de choisir les options les plus courantes pour la vitesse de transfert de donn√©es, comme dans l'image ci-dessous. </font><font style="vertical-align: inherit;">Habituellement, les nouveaux modules par d√©faut √† 9600, et √† des fins de formation, c'est plus que suffisant, la vitesse ici n'est pas critique pour nous. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/l2/dj/ve/l2djvekjunxaxpxesaxo786q3le.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, si tout r√©ussit, il vous sera demand√© de s√©lectionner le module trouv√©: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4z/dq/le/4zdqledgifvp92zr4lvm6bat2km.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un petit bug a √©t√© remarqu√©: parfois le module n'√©tait pas √† une vitesse non standard, r√©initialisation manuelle du module avec le bouton Reset lors de la recherche et r√©initialisation de son d√©bit en bauds au standard (9600) aid√©.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modifier les param√®tres du module</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, nous sommes engag√©s dans la configuration des modules. Un tas de param√®tres vont dispara√Ætre, dont la plupart sont initialement incompr√©hensibles. Heureusement, seuls quelques-uns d'entre eux devront √™tre chang√©s pour un d√©marrage rapide. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID r√©seau - ID PAN.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Une cl√© de r√©seau commune, elle doit √™tre la m√™me pour tous les appareils afin qu'ils soient connect√©s ind√©pendamment au r√©seau. Mettez n'importe quel nombre, dans notre cas, nous en avons fait 42. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/t7/dg/lk/t7dglkxhvbkban2romlxiu97qpi.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CE - Coordinateur activ√©.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> S'il y en a 1, alors ce module fait office de coordinateur. S'il est √©gal √† 0, le module agit comme un routeur (routeur) - en fait, il garantit simplement que les paquets traversent le r√©seau √† travers lui-m√™me. La plupart des h√¥tes sont g√©n√©ralement des routeurs. Nous avons besoin d'un coordinateur et de deux routeurs dans notre r√©seau, alors mettez-en un ici.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a aussi le r√¥le ¬´End device¬ª - c'est un module qui n'effectue pas de travail sur le transfert de paquets, mais qui communique uniquement avec d'autres routeurs et ex√©cute ses fonctionnalit√©s utiles. Habituellement, il est juste en mode veille et se r√©veille √† intervalles fixes et d√©couvre s'il y a des messages. Un tel module peut √™tre aliment√© par une batterie, tandis que le routeur et le coordinateur doivent toujours √™tre ¬´en ligne¬ª et, par cons√©quent, avoir besoin d'une alimentation constante pour maintenir l'ensemble du r√©seau. Nous ne consid√©rerons pas un tel exemple maintenant, car il est plus int√©ressant pour tout le monde d'attribuer le r√¥le de routeurs et d'observer comment le r√©seau changera automatiquement sa configuration. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0m/zp/e3/0mzpe3yptscx6la-wummlbiixks.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AP - Activer API.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mode de fonctionnement. Les modules XBee peuvent fonctionner en deux modes: AT ou API. Le mode AT est plus facile pour les d√©butants, c'est un remplacement transparent du port s√©rie et fonctionne avec le module via les commandes AT. Cependant, le mode API est beaucoup plus riche en fonctionnalit√©s, il vous permet de configurer √† distance les modules, contient l'adresse de l'exp√©diteur, retourne le statut de livraison du package, et bien plus encore. De plus, les biblioth√®ques d'interaction avec XBee supposent que l'appareil est utilis√© en mode API. Par cons√©quent, remplacez-le imm√©diatement par le mode API, cela se fait en d√©finissant l'unit√© dans le champ correspondant. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ra/wv/ng/rawvngogy6biagddxsxxx08fhao.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le nom du module est Node Identifier.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Une option pratique pour donner √† votre module un nom lisible par l'homme. Donnons-lui un tel nom - Coordinateur. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xi/h2/fy/xih2fygnbxffyqcyhuwbvn8zhqc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s cela, vous pouvez flasher les param√®tres dans le module en appuyant sur le bouton avec un crayon:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pi/8g/xm/pi8gxmplnffs0qmxtckhrfmxrqe.png"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Connectez les modules au r√©seau</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous allons maintenant voir quel type de r√©seau nous obtiendrons si nous configurons trois modules. </font><font style="vertical-align: inherit;">Le programme XCTU a un visualiseur de r√©seau assez pratique, nous verrons clairement la topologie. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous allons configurer les trois modules tour √† tour avec les param√®tres suivants:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PAN ID - nombre total, par exemple 42</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AP (API Enable) - d√©fini sur 1 (fonctionne en mode API)</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NI (Node Identifier) ‚Äã‚Äã- donnez aux modules des noms compr√©hensibles (coordinateur, lampe et commutateur, si nous faisons, par exemple, un mod√®le du syst√®me Smart Home).</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CE (Coordinateur activ√©) - d√©finissez l'un des modules sur 1, ce sera le coordinateur.</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mettez ensuite tous les modules sous tension. Positionnez-les comme ceci: le coordinateur sera dans le convertisseur USB-UART, et les deux autres (routeurs) seront situ√©s sur les cartes XBee Shield au-dessus de Nucleo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous avez tout fait avec soin, la belle se produira. Les modules se connecteront automatiquement au r√©seau. Vous pouvez communiquer avec des routeurs √† distance via le coordinateur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela ressemble √† ceci. Cliquez sur le bouton "D√©couvrir les n≈ìuds radio dans le m√™me r√©seau". </font></font><br>
<br>
<img src="https://habrastorage.org/webt/em/nf/mx/emnfmxivn4xxt3wtx0pe0f54m8q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous verrez que deux modules ont √©t√© automatiquement d√©tect√©s et ajout√©s: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/j3/ev/gf/j3evgfx0nj0xowanzz3ovdctyks.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
et vous pouvez modifier leurs param√®tres √† la vol√©e!&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce qui est encore g√©nial: vous pouvez maintenant voir la carte du r√©seau si vous passez en mode de travail R√©seau en haut √† droite.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sf/2v/ma/sf2vmarm8agrkfjtepgib28sxuq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir r√©parti les n≈ìuds du r√©seau avec la souris, vous verrez un triangle. </font><font style="vertical-align: inherit;">Veuillez noter que le trafic vers le module le plus √† droite peut aller de deux mani√®res. </font><font style="vertical-align: inherit;">Et si vous d√©placez les modules dans l'espace, vous verrez que l'image a chang√©, et maintenant, peut-√™tre, un autre module deviendra ¬´extr√™me¬ª. </font><font style="vertical-align: inherit;">C'est l'essence m√™me d'un r√©seau auto-configurable.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Installez le module XBee sans le retirer du blindage</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien s√ªr, il sera plus int√©ressant de travailler avec le module XBee non pas via un ordinateur, mais en le contr√¥lant √† l'aide d'un programme sur le microcontr√¥leur. </font><font style="vertical-align: inherit;">Autrement dit, le connecter √† la carte STM32Nucleo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons comment le module XBee peut communiquer avec le microcontr√¥leur. </font><font style="vertical-align: inherit;">Et commen√ßons par une petite t√¢che: comment configurer un module sans le retirer du bouclier d'extension? </font><font style="vertical-align: inherit;">Vous devez admettre que d√©placer le module d'avant en arri√®re n'est pas pratique, en m√™me temps que vous voulez exp√©rimenter avec les param√®tres et c'est √©trange pourquoi vous avez besoin d'un module USB-UART s√©par√©, car en th√©orie il y en a un dans la carte STM32Nucleo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La solution est simple: nous devons transformer la carte Nucleo en pont entre le module XBee et le convertisseur USB de la carte.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description g√©n√©rale de l'id√©e</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le microcontr√¥leur STM32 que nous utilisons poss√®de plusieurs interfaces UART √† bord. Chacune de ces interfaces repr√©sente un canal de communication. L'un d'eux est connect√© au convertisseur USB-UART afin que nous puissions communiquer avec l'ordinateur via USB dans le terminal. Deux autres ne sont pas encore utilis√©s. Nous allons connecter le module XBee √† l'un d'eux, qui dispose √©galement d'un tel canal de communication. Vous pouvez choisir n'importe quel UART, nous avons choisi pour la d√©finition UART1.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le brochage peut √™tre visualis√© en MBed en haut √† droite, en appuyant sur le bouton de s√©lection de la carte, puis sur l'onglet Brochage. </font><font style="vertical-align: inherit;">Par habitude, il peut √™tre assez difficile de percevoir cette image color√©e. </font><font style="vertical-align: inherit;">Il y a beaucoup de choses ici, car la carte a de nombreuses interfaces, et il y a deux num√©ros de broches: par rapport au microcontr√¥leur (PA_5, PA_6 - num√©rotation des broches), et par rapport √† la carte (D13, D12 - inscriptions sur la carte Nucleo, les m√™mes num√©ros pr√®s des terminaux). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/97/dp/mq/97dpmqw9dmy9lcqtb1hf6i_gyz0.png"><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'av√®re que sur le microcontr√¥leur, l'interface UART1 communiquera avec le module XBee et UART2 - comme auparavant, avec l'ordinateur. </font><font style="vertical-align: inherit;">Le code interne redirigera UART1 vers UART2 et vice versa. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rp/vk/5w/rpvk5wsdsb8qnz5i_m7dk8q-wwc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par connexions, cela ressemblera √† ceci:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tp/g7/cs/tpg7cslaiomjx-ogqje-su3q-7s.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Faire un ¬´pont¬ª √† partir d'un microcontr√¥leur</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans notre cas, nous pouvons utiliser des cavaliers sur le bouclier pour d√©finir les num√©ros auxquels nous voulons connecter le module ZigBee. Le module de communication TX sera connect√© √† la broche 2 de la carte (PA_9 sur le microcontr√¥leur) et RX √† la broche 8 (alias PA_10). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela ressemblera √† ceci: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/oh/ce/3s/ohce3sq3y1_0_jewruer0dmn36a.png"><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le code que</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous avons pris s'appelle le pont s√©rie. Il s'agit du ¬´pont¬ª entre les deux canaux de communication. Nous chargeons le code dans le microcontr√¥leur, qui transmet tout ce qui arrive √† l'entr√©e de l'ordinateur via UART2, √† UART1, et vice versa. Comme si on ins√©rait un tube entre deux sources d'information (Linuxsoids comprendra). Nous avons connect√© un module XBee √† UART1. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code est tr√®s simple, la seule chose que vous devez changer est le num√©ro de broche auquel l'appareil est connect√©. Autrement dit, faites-les PA_9 et PA_10, comme indiqu√© ci-dessus.</font></font><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"mbed.h"</span></span>
<span class="hljs-comment">// Make a serial bridge from a serial I/O device on mbed to the PC</span>
<span class="hljs-function">Serial <span class="hljs-title">pc</span><span class="hljs-params">(USBTX, USBRX)</span></span>; <span class="hljs-comment">// tx, rx</span>
<span class="hljs-function">Serial <span class="hljs-title">device</span><span class="hljs-params">(PA_9, PA_10)</span></span>; <span class="hljs-comment">// tx, rx</span>
<span class="hljs-comment">// Defaults to 9600 baud on each device - use .baud(baudrate) to change</span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{<font></font>
&nbsp;pc.<span class="hljs-built_in">printf</span>(<span class="hljs-string">"Hello!"</span>);
&nbsp;<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>) {
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>(pc.readable()) {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;device.putc(pc.getc());<font></font>
&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>(device.readable()) {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pc.putc(device.getc());<font></font>
&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est important que si vous confondez l'ordre des conclusions - par exemple, vous faites une erreur et √©crivez PA_10, PA_9 au lieu de PA_9, PA_10 - le mauvais ordre, le compilateur ne vous signalera pas une erreur et le programme affichera une erreur dans la console au red√©marrage:</font></font><br>
<pre><code class="plaintext hljs">pinmap not found for peripheral</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
et ne progressera pas, c'est-√†-dire qu'en principe rien ne fonctionnera. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir t√©l√©charg√© ce code et install√© correctement les cavaliers sur le bouclier, vous pouvez vous connecter en toute s√©curit√© au module XBee √† partir de l'ordinateur, comme vous l'avez fait pr√©c√©demment avec l'adaptateur USB-UART sans le retirer du bouclier. </font><font style="vertical-align: inherit;">Il sera r√©guli√®rement d√©tect√© par le programme XCTU. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
M√™me si vous n'avez pas besoin de cette fonctionnalit√©, v√©rifiez toujours que le programme fonctionne, car dans l'exemple suivant, nous communiquerons avec le module XBee √† partir du microcontr√¥leur, et la connexion via UART1 devrait d√©j√† √™tre √©tablie (c'est-√†-dire que les cavaliers sont correctement d√©finis et les num√©ros de broches sont indiqu√©s dans le programme) .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Acquisition de donn√©es</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Regardons deux exemples simples: comment recevoir et envoyer des donn√©es au niveau du microcontr√¥leur, en utilisant le module XBee comme interface de communication externe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">biblioth√®que</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> officielle </font><font style="vertical-align: inherit;">des fabricants - des soci√©t√©s Digi. </font><font style="vertical-align: inherit;">Il r√©side dans le r√©f√©rentiel Mbed, il y a des commentaires utiles sur l'utilisation et la logique du code. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, nous apprendrons comment obtenir des donn√©es - il existe un exemple plus simple. </font><font style="vertical-align: inherit;">Nous aurons un module XBee connect√© au convertisseur USB-UART, enverrons un message d'accueil √† la carte Nucleo et il imprimera ce message d'accueil √† la console. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zg/ic/u5/zgicu5mh8dvsy8y8aegzetdoew8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ouvrez le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">projet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans cette biblioth√®que. </font><font style="vertical-align: inherit;">Comme toujours, importez-le dans le compilateur en ligne en tant que programme.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Correction des biblioth√®ques pour les modules S2C</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gardez √† l'esprit que si vous avez des modules de la s√©rie S2C: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hc/vr/kb/hcvrkbswx5s8hspbos6djkmxfko.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
au lieu de la biblioth√®que standard, vous devez utiliser le correctif: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XBeeLib_Fixed</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Sinon, ces programmes ne fonctionneront pas. </font><font style="vertical-align: inherit;">Il est ajout√© au projet simplement en supprimant la biblioth√®que XBeeLib de l√† et en l'important dans le projet XBeeLibFix. </font><font style="vertical-align: inherit;">Rien de plus n'a besoin d'√™tre chang√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc: importez cette biblioth√®que dans le compilateur en ligne: La </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ko/vq/e9/kovqe9zqdl7553_kivabf8bedv0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fen√™tre d'importation du projet appara√Ætra. </font><font style="vertical-align: inherit;">L√†, vous devez choisir la cible - o√π nous importons: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bx/pt/vt/bxptvt2ctwcv87vl-b1qi5upi4s.png" width="500"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En tant que projet cible, s√©lectionnez notre exemple XBeeZB_Receive_Data. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7q/lj/hg/7qljhgp7jx5yt9875cqijnfopcs.png" width="500"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s quoi la biblioth√®que sera import√©e dans le projet, puis avec un mouvement audacieux nous supprimons la mauvaise version de XBeeLib.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/iw/hz/or/iwhzor7bqjopgpigyi4_lfiv43e.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemple de compilation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous avez donc import√© l'exemple et remplac√© la biblioth√®que si n√©cessaire. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Regardez l'exemple de code, c'est assez simple. </font><font style="vertical-align: inherit;">Il d√©finit une fonction de rappel qui est appel√©e lorsqu'un paquet est re√ßu. </font><font style="vertical-align: inherit;">Cette fonction imprime le contenu du paquet re√ßu sur la console. </font><font style="vertical-align: inherit;">Donc, si nous lui envoyons un message d'accueil, elle l'imprimera √©galement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour que l'exemple soit compil√©, vous devez √©crire dans l'exemple les conclusions selon lesquelles nous sommes responsables de la communication avec le module XBee, car le programme ne sait pas √† quelles conclusions nous avons connect√© le mat√©riel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, nous allons dans le fichier config.h et les lignes qu'il contient:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//#define RADIO_TX NC /* <span class="hljs-doctag">TODO:</span> specify your setup's Serial TX pin connected to the XBee module DIN pin */</span>
<span class="hljs-comment">//#define RADIO_RX NC /* <span class="hljs-doctag">TODO:</span> specify your setup's Serial RX pin connected to the XBee module DOUT pin */</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D√©commenter, et au lieu de NC, nous √©crivons, conform√©ment aux conclusions que nous avons connect√©s les cavaliers:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RADIO_TX PA_9</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RADIO_RX PA_10</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De m√™me, nous modifions les lignes:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//#define DEBUG_TX NC /* <span class="hljs-doctag">TODO:</span> specify your setup's Serial TX for debugging */</span>
<span class="hljs-comment">//#define DEBUG_RX NC /* <span class="hljs-doctag">TODO:</span> specify your setup's Serial RX for debugging (optional) */</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous √©crivons:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DEBUG_TX USBTX</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DEBUG_RX USBRX</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous rencontrez une erreur lors de la compilation que vous ne pouvez pas trouver </font></font><code>device.h</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mettez simplement √† jour la biblioth√®que Mbed dans l'arborescence du projet (faites un clic droit dessus -&gt; Mettre √† jour). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s cela, le programme se compilera avec succ√®s, et vous pouvez le t√©l√©charger sur la carte.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemple d'ex√©cution</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir regard√© la console ce que la carte Nucleo √©crit, vous verrez ce qui suit: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/as/mk/fb/asmkfbne30jznt7bzqvr2vjhl5e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment envoyons-nous les donn√©es? </font><font style="vertical-align: inherit;">L'option la plus simple: via la console du programme XCTU. </font><font style="vertical-align: inherit;">S√©lectionnez dans le menu principal du programme: Outils - Envoyer des paquets. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ko/9b/7q/ko9b7qwhvwszyezghvzpbs1py74.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En bas, il y a une fen√™tre avec les mots Envoyer des paquets. </font><font style="vertical-align: inherit;">Cr√©ez un nouveau package en cliquant sur le ¬´plus¬ª √† droite. </font><font style="vertical-align: inherit;">Une fen√™tre de cr√©ation d'un nouveau package appara√Ætra. </font><font style="vertical-align: inherit;">S√©lectionnez l'onglet HEX ici. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jc/cf/wz/jccfwz6aesmjic-ncukw8ot1ls8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entrez l√† un tel envoi de donn√©es: </font></font><br>
<code>7E 00 19 10 01 00 00 00 00 00 00 FF FF FF FE 00 00 48 65 6C 6C 6F 20 58 42 65 65 21 5A</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(en utilisant le bouton "Envoyer le paquet s√©lectionn√©" √† droite de la liste des paquets) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous verrez le r√©sultat dans la console du module d'√©coute:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/55/tg/mk/55tgmkipu_8dk33yhqdxxqa90du.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veuillez noter qu'il n'a imprim√© que la derni√®re partie du jeu d'octets que vous avez envoy√©. </font><font style="vertical-align: inherit;">Il s'agit de la charge utile r√©elle du message. </font><font style="vertical-align: inherit;">Notez √©galement que si vous envoyez ¬´uniquement des octets¬ª (toute combinaison al√©atoire d'octets), le r√©cepteur ne les √©mettra pas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous mettez un ensemble d'octets:&nbsp; </font></font><br>
<code>48 65 6C 6C 6F 20 58 42 65 65 21</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
dans n'importe quel convertisseur HEX-ASCIII (par exemple, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), assurez-vous que cela signifie "Bonjour XBee!" </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une t√¢che tr√®s simple pour une ex√©cution ind√©pendante: modifiez l'exemple de code pour qu'il affiche le texte du message en ASCII, pas HEX, et vous pourrez lire ce texte dans le terminal.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Envoi de donn√©es</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par analogie avec l'exemple pr√©c√©dent, nous envisageons maintenant d'envoyer des donn√©es. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bp/5i/ot/bp5iota_umzhimxdl5yhgnmflzg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout est l√†, comme dans l'exemple pr√©c√©dent. </font><font style="vertical-align: inherit;">Seulement avec la diff√©rence que nous </font><font style="vertical-align: inherit;">ouvrons </font><font style="vertical-align: inherit;">maintenant l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exemple</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> XBeeZB_Send_Data.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemple de compilation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est important que si vous avez un module S2C (il est clairement √©crit dessus), </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hc/vr/kb/hcvrkbswx5s8hspbos6djkmxfko.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
vous connecterez √† nouveau la biblioth√®que avec un correctif, sinon rien ne fonctionnera pour vous. La proc√©dure √† suivre est d√©crite dans l'exemple pr√©c√©dent.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, ici, pour une compilation r√©ussie, vous devez sp√©cifier les broches du contr√¥leur utilis√©es, vous pouvez simplement les copier √† partir de l'exemple pr√©c√©dent. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous regardons l'exemple de code lui-m√™me. Il </font></font><code>main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilise plusieurs m√©thodes pour envoyer des donn√©es. Choisissez la plus simple: envoyez les donn√©es au coordinateur. Nous n'avons m√™me pas besoin d'enregistrer l'adresse du coordinateur, car il est d√©j√† inscrit sur le r√©seau. Par cons√©quent, sans modifier l'√©chantillon, nous commentons toutes les lignes √† la fin:</font></font><br>
<pre><code class="cpp hljs">send_data_to_coordinator(xbee);
<span class="hljs-comment">//send_broadcast_data(xbee);</span>
<span class="hljs-comment">//send_data_to_remote_node(xbee, remoteDevice);</span>
<span class="hljs-comment">//send_explicit_data_to_remote_node(xbee, remoteDevice);</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et lorsque vous commencez, vous verrez ceci: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/su/pp/sj/suppsjbb95cdiavs1svsj1ixctm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(si vous ne le voyez pas, red√©marrez simplement le tableau) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment puis-je m'assurer que les donn√©es parviennent au coordinateur? Par exemple, XCTU a le mode console r√©seau. Allum√© par le bouton en haut √† droite. Dans ce mode, vous verrez tous les paquets sur le r√©seau. Bien s√ªr, en m√™me temps, vous devez avoir une connexion s√©rie avec le coordinateur. Et n'oubliez pas de cliquer sur le bouton Ouvrir en haut √† gauche pour le rendre vert. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yz/st/vy/yzstvyfb4ed2rkbgvmgushy1gkg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez voir des informations d√©taill√©es sur chaque paquet sur le r√©seau en le s√©lectionnant dans la liste de gauche: En faisant </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fl/2w/_f/fl2w_fotyjqzbmdpt9tp6fvyyba.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
d√©filer jusqu'√† la fin du contenu du paquet, vous verrez une ligne avec le texte "send_data_to_coordinator":</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vm/da/ha/vmdahazkjgs7ttk_d-hg6osq7oi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez essayer d'autres m√©thodes d'envoi de donn√©es, mais l√† (par exemple, pour envoyer √† un n≈ìud s√©lectionn√© s√©par√©), vous devez enregistrer l'adresse du n≈ìud. </font><font style="vertical-align: inherit;">Vous pouvez voir les adresses de tous les modules dans le programme XCTU. </font><font style="vertical-align: inherit;">Comment enregistrer des adresses sp√©cifiques est d√©crit de mani√®re exhaustive dans l'exemple.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. Nous cr√©ons la passerelle MQTT</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout est super, mais maintenant je voudrais en quelque sorte travailler avec ces donn√©es en dehors du r√©seau XBee, par exemple sur Internet. </font><font style="vertical-align: inherit;">Une fa√ßon de le faire est de mettre le traducteur de XBee dans le protocole MQTT populaire. </font><font style="vertical-align: inherit;">Ensuite, de la mani√®re habituelle, nous pouvons nous abonner aux notifications d'√©v√©nements et envoyer des commandes √† partir de l'interface utilisateur, et ce programme peut √™tre localis√© n'importe o√π (si vous utilisez un serveur MQTT externe plut√¥t que local), et pas seulement sur notre ordinateur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici une instruction. </font><font style="vertical-align: inherit;">En bref, le programme lanc√© sur l'ordinateur va √©changer des donn√©es du coordinateur de r√©seau via une connexion USB. </font><font style="vertical-align: inherit;">Elle transmettra ces donn√©es au protocole MQTT.</font></font><br>
<img src="https://habrastorage.org/webt/t0/yo/dx/t0yodx2oqigqjepdzr0w8exjwaq.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installer et configurer XBMQ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le programme que nous utiliserons comme passerelle MQTT s'appelle XBMQ, il est ouvert et gratuit. </font><font style="vertical-align: inherit;">Existe en deux versions:</font></font><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NodeJS</font></font></a><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La version Java sera prise en compte, bien que ce ne soit pas trop fondamental: nous ne la programmerons pas de toute fa√ßon, nous allons seulement l'installer et l'utiliser. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour que le programme fonctionne, vous aurez besoin de la biblioth√®que RXTX, elle peut √™tre install√©e simplement √† partir du r√©f√©rentiel:</font></font><br>
<pre><code class="bash hljs">sudo apt-get install librxtx-java</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et bien s√ªr, vous avez besoin du JDK (Java Development Kit). </font><font style="vertical-align: inherit;">Il existe en deux versions - d'Oracle et OpenJDK, la seconde est recommand√©e. </font><font style="vertical-align: inherit;">Tr√®s probablement, OpenJDK est d√©j√† install√© sur votre syst√®me; sinon, r√©installez-le. </font><font style="vertical-align: inherit;">Java a besoin d'un maximum de 8, car </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">javax.xml.bind est exclu de Java 11</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et vous devez choisir une alternative avec JDK-8 comme option par d√©faut, ou cr√©er une configuration pour ce cas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
T√©l√©chargez le r√©f√©rentiel du programme XBMQ:</font></font><br>
<pre><code class="bash hljs">git <span class="hljs-built_in">clone</span> https://github.com/angryelectron/xbmq-java</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir t√©l√©charg√© les codes sources, nous collecterons le fichier binaire du programme. </font><font style="vertical-align: inherit;">√âquipe</font></font><br>
<pre><code class="bash hljs">ant dist</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
assemblera un projet pour tous les principaux syst√®mes d'exploitation. </font><font style="vertical-align: inherit;">Le programme compil√© final sera dans le dossier </font></font><code>dist</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Configurez maintenant ce programme. </font><font style="vertical-align: inherit;">Fichier ouvert</font></font><pre><code class="plaintext hljs">dist/xbmq.properties</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 et voyez l√†:</font></font><br>
<pre><code class="bash hljs"><span class="hljs-comment">#</span>
<span class="hljs-comment"># Xbmq Properties.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#port = /dev/ttyUSB0</span>
<span class="hljs-comment">#baud = 9600</span>
<span class="hljs-comment">#rootTopic = ab123</span>
<span class="hljs-comment">#broker = tcp://test.mosquitto.org:1883</span>
<span class="hljs-comment">#username = user</span>
<span class="hljs-comment">#password = password</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D√©commentez et modifiez vos param√®tres. </font><font style="vertical-align: inherit;">Les param√®tres sont les suivants: port de connexion du coordinateur ZigBee, vitesse, sujet racine (toutes les donn√©es y tomberont), adresse du serveur MQTT, nom d'utilisateur et mot de passe (si le serveur en a besoin). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet exemple, seule l'adresse du serveur a chang√© - vers le serveur mqtt local (moustique standard sous Linux). </font><font style="vertical-align: inherit;">Tout le reste a √©t√© laiss√© par d√©faut:</font></font><br>
<pre><code class="bash hljs"><font></font>
port = /dev/ttyUSB0<font></font>
baud = 9600<font></font>
rootTopic = ab123<font></font>
broker = tcp://127.0.0.1:1883<font></font>
username = user<font></font>
password = password<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avant l'√©tape suivante, vous devez installer et ex√©cuter le serveur MQTT mosquitto local:&nbsp;</font></font><br>
<pre><code class="bash hljs">sudo apt-get install mosquitto</code></pre><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lancement de XBMQ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enfin, le programme peut √™tre lanc√©. </font><font style="vertical-align: inherit;">Apr√®s avoir connect√© le convertisseur USB-UART avec le module de coordination ins√©r√©, ex√©cutez le programme:</font></font><br>
<pre><code class="bash hljs">./dist/xbmq.sh</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque vous ex√©cutez le script, nous voyons la ligne dans la console:</font></font><br>
<pre><code class="bash hljs">INFO - Starting XBMQ gateway ab123/0013A2004154EA46</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dernier - c'est exactement l'adresse de notre coordinateur. </font><font style="vertical-align: inherit;">Si vous vous abonnez √† tous les sujets avec un client MQTT externe, vous verrez imm√©diatement 2 messages:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans le sujet </font></font><code>ab123/0013A2004154EA46/online</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- sera 1, c'est Last Will (un bon exemple de la fa√ßon dont ces param√®tres "sp√©ciaux" sont utilis√©s dans la vie r√©elle)</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le sujet </font></font><code>ab123/0013A2004154EA46/log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contiendra la m√™me phrase de d√©bogage ¬´D√©marrage de la passerelle XBMQ ...¬ª que vous avez d√©j√† vue dans la console</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essayez maintenant d'envoyer un message √† partir d'un autre module XBee externe - par exemple, prenez un exemple avec l'envoi de donn√©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, dans le programme MQTT.fx, si vous vous abonnez √† tous les sujets (#), vous verrez ceci: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hy/56/5l/hy565luregquqnizlxf7pejdn40.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La fen√™tre du programme MQTT.fx.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
C'est-√†-dire, en commen√ßant l'exemple √©tudi√© pr√©c√©demment avec l'envoi d'un message au coordinateur, nous verrons ce texte (¬´send_data_to_coordinator¬ª) comme une partie Package MQTT. Le sujet parent commun pour nous est celui sp√©cifi√© dans la configuration du programme ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ab123</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , vous pouvez le changer pour le v√¥tre). Vient ensuite l'adresse du coordinateur, puis l'adresse du module d'o√π provient le message. Enfin, cette rubrique est appel√©e DataOut, car il s'agit de donn√©es sortantes.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien s√ªr, vous verrez une telle image dans n'importe quel autre client MQTT, que ce soit MQTTLens ou m√™me simplement</font></font><code>mosquitto_sub</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans la console. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quelques commentaires finaux:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans le bon sens, ce programme devrait fonctionner en mode d√©mon. </font><font style="vertical-align: inherit;">Il existe un fichier xbmqd pour cela, et README indique comment l'utiliser.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gardez √† l'esprit que puisqu'il </font></font><code>xbmq</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©tient le port, nous ne pouvons pas ex√©cuter ce programme en m√™me temps que XCTU.</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez maintenant travailler avec votre syst√®me en utilisant le protocole MQTT et √©crire des programmes complexes et int√©ressants! </font></font><br>
<br>
<img src="https://habrastorage.org/webt/g8/kt/h0/g8kth04siprq-9s2uwlli2fp6ae.jpeg" align="left"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tatyana Volkova - L'auteur du programme de formation sur l'Internet des objets suit ¬´Samsung IT Academy¬ª, sp√©cialiste des programmes de responsabilit√© sociale des entreprises au Samsung Research Center</font></font><br>
</i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr497178/index.html">¬´1C: ERP¬ª et ¬´1C: CRM¬ª: fonctionnalit√© et analyse comparative des configurations</a></li>
<li><a href="../fr497184/index.html">Un regard sur les domaines prometteurs du d√©veloppement des syst√®mes de gestion des donn√©es g√©ologiques, g√©ophysiques et de terrain</a></li>
<li><a href="../fr497186/index.html">Comment se passe la recherche d'un vaccin contre le coronavirus</a></li>
<li><a href="../fr497192/index.html">Fonctionnement √† distance de l'informatique: conseils pour g√©rer des √©quipes r√©parties</a></li>
<li><a href="../fr497194/index.html">Tinder en sait plus sur votre vie intime que vos amis</a></li>
<li><a href="../fr497204/index.html">Digital 2020: fixer les tendances</a></li>
<li><a href="../fr497206/index.html">√Ä propos de la programmation orient√©e objet</a></li>
<li><a href="../fr497212/index.html">[Instruction] Utilisation de Google-disk, Google-Site, Google-Form pour cr√©er une banque de donn√©es et des syst√®mes de r√©troaction</a></li>
<li><a href="../fr497214/index.html">Ing√©nieur et Data Scientist: ce qu'ils peuvent et combien ils gagnent</a></li>
<li><a href="../fr497216/index.html">Nous avons fait une √©pid√©mie de coronavirus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>