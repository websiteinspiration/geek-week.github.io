<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>♣️ 💅 ⌛️ Helmデバイスとその落とし穴 👊🏽 👨‍🌾 🚴🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Typhonの貨物運送業者のコンセプト、Anton Swanepoel
 
 私の名前はDmitry Sugrobovです。私はLeroy Merlinの開発者です。記事では、Helmが必要な理由、Kubernetesでの作業を簡素化する方法、3番目のバージョンでの変更点、それを使用してダウンタイム...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Helmデバイスとその落とし穴</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/488192/"><img src="https://habrastorage.org/webt/vn/ta/1i/vnta1ig3umh8lzaeaemhnn4zvuw.jpeg"><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Typhonの貨物運送業者のコンセプト、Anton Swanepoel</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
私の名前はDmitry Sugrobovです。私はLeroy Merlinの開発者です。</font><font style="vertical-align: inherit;">記事では、Helmが必要な理由、Kubernetesでの作業を簡素化する方法、3番目のバージョンでの変更点、それを使用してダウンタイムなしで本番環境のアプリケーションを更新する方法について説明します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ Kubernetes Conference</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> by </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mail.ru Cloud Solutions</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カンファレンスでのスピーチに基づいた概要です</font><font style="vertical-align: inherit;">。読みたくない場合は、ビデオを</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ご覧</font></a><font style="vertical-align: inherit;">ください。</font></font><br>
<a name="habracut"></a><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/w1PhTe9gnOI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本番環境でKubernetesを使用する理由</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Leroy Merlinは、ロシアとヨーロッパのDIY小売市場のリーダーです。当社には100人以上の開発者、33,000人の社内従業員、ハイパーマーケットやサイトを訪れる膨大な数の人々がいます。それらすべてを幸せにするために、業界の標準的なアプローチに従うことにしました。マイクロサービスアーキテクチャを使用して新しいアプリケーションを開発します。環境の隔離と適切な配送のためにコンテナを使用します。オーケストレーションにはKubernetesを使用します。オーケストレーターの使用価格は急速に安くなっています。テクノロジーを備えたエンジニアの数は市場で増加しており、プロバイダーはKubernetesをサービスとして提供しているようです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、Kubernetesが行うすべてのことは他の方法で行うことができます。たとえば、スクリプトをいくつかのJenkinsとdocker-composeでコーティングするなどですが、既製の信頼できるソリューションがあると、なぜ生活が複雑になるのでしょうか。</font><font style="vertical-align: inherit;">そのため、Kubernetesに来て、1年間実稼働で使用しています。</font><font style="vertical-align: inherit;">現在、24のKubernetesクラスタがあり、最も古いものは1年以上前のもので、約200のポッドが含まれています。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetesで多くのYAMLファイルを呪う</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetesでマイクロサービスを開始するには、少なくとも5つのYAMLファイル（Deployment、Service、Ingress、ConfigMap、Secrets）を作成し、それをクラスターに送信します。</font><font style="vertical-align: inherit;">次のアプリケーションでは、Jamliksの同じパッケージを作成します。</font><font style="vertical-align: inherit;">ドキュメントの数に環境の数を掛けると、すでに数百のファイルが得られますが、これには動的環境が考慮されていません。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ba9/848/18b/ba984818be4ba31829a8ca17367f4015.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
中心的なメンテナーHelmであるAdam Reeseは、「</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetesでの開発サイクル</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」という概念を導入しました</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">YAMLをコピー-YAMLファイルをコピーします。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">YAMLを貼り付け-貼り付けます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インデントを修正-インデントを修正します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">繰り返し-もう一度繰り返します。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
オプションは機能していますが、YAMLファイルを何度もコピーする必要があります。</font><font style="vertical-align: inherit;">このサイクルを変更し、ヘルムを思いついた。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヘルムとは</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、Helmは、</font><font style="vertical-align: inherit;">必要なプログラムを見つけてインストールするのに役立つ</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パッケージマネージャー</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。たとえば、MongoDBをインストールするには、公式Webサイトにアクセスしてバイナリをダウンロードする必要はありません</font></font><code>helm install stable/mongodb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">コマンドを実行するだけ</font><font style="vertical-align: inherit;">です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、Helmは</font><font style="vertical-align: inherit;">ファイルのパラメーター化を支援</font><font style="vertical-align: inherit;">する</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テンプレートエンジン</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。 KubernetesのYAMLファイルの状況に戻りましょう。同じYAMLファイルを記述し、それにいくつかのプレースホルダーを追加する方が簡単です。Helmがその値に置き換えます。つまり、小さなボックスの大きなセットの代わりに、必要な値が適切なタイミングで置き換えられるテンプレートのセット（テンプレート）があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3番目に、Helmは</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デプロイメントウィザード</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。これを使用すると、アプリケーションをインストール、ロールバック、および更新できます。それを行う方法を理解しましょう。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9be/c3f/c96/9bec3fc96cd5cdc5586c3c4d58169f48.jpg"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Helmを使用してネイティブアプリケーションをデプロイする方法</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
公式の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指示</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に従って、コンピューターにHelmクライアントをインストールします</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">次に、YAMLファイルのセットを作成します。</font><font style="vertical-align: inherit;">特定の値を指定する代わりに、Helmが将来情報を入力するプレースホルダーを残します。</font><font style="vertical-align: inherit;">このようなファイルのセットはHelmチャートと呼ばれます。</font><font style="vertical-align: inherit;">次の3つの方法でHelmコンソールクライアントに送信できます。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テンプレートでパパを指定します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アーカイブを.tarにパックし、それをポイントします。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テンプレートをリモートリポジトリに配置し、Helmクライアントでリポジトリへのリンクを追加します。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それでも値-values.yamlを含むファイルが必要です。</font><font style="vertical-align: inherit;">そこからのデータはテンプレートに置き換えられます。</font><font style="vertical-align: inherit;">それも作成しましょう。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c5e/7a2/5f9/c5e7a25f9b100fe55a67474c36433555.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Helmの2番目のバージョンには、追加のサーバーアプリケーション-Tillerがあります。</font><font style="vertical-align: inherit;">Kubernetesの外部でハングし、Helmクライアントからのリクエストを待機します。呼び出されると、テンプレート内の必要な値を置き換えて、Kubernetesに送信します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/593/7cc/6d2/5937cc6d2d2439593ff2b4d0b7b3f3e1.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Helm 3はより単純です。サーバーでテンプレートを処理する代わりに、情報はHelmクライアントの側で完全に処理され、Kubernetes APIに直接送信されます。</font><font style="vertical-align: inherit;">この簡素化により、クラスターのセキュリティが向上し、ロールアウトスキームが容易になります。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてがどのように機能するか、</font></font></strong><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
私たちはチームを始め</font></font><code>helm install</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">アプリケーションリリースの名前を指定し、values.yamlへのパスを指定します。</font><font style="vertical-align: inherit;">最後に、チャートが置かれているリポジトリとチャートの名前を示します。</font><font style="vertical-align: inherit;">この例では、これらはそれぞれ「lmru」と「bestchart」です。</font></font><br>
<br>
<pre><code class="plaintext hljs">helm install --name bestapp --values values.yaml lmru/bestchart
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コマンドの実行は1回のみ可能</font><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">再実行する</font></font><code>install</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合は、</font><font style="vertical-align: inherit;">代わり</font><font style="vertical-align: inherit;">に使用する必要があります</font></font><code>upgrade</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">簡単にするために、2つのコマンドの代わりに</font></font><code>upgrade</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、追加のキー</font><font style="vertical-align: inherit;">を使用してコマンド</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">実行でき</font><font style="vertical-align: inherit;">ます</font></font><code>--install</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">Helmは最初の実行時に、リリースをインストールするコマンドを送信し、将来的にはそれを更新します。</font></font><br>
<br>
<pre><code class="plaintext hljs">helm upgrade --install bestapp --values values.yaml lmru/bestchart
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Helmを使用したアプリケーションの新しいバージョンのデプロイの落とし穴</font></font></h2><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ストーリーのこの時点で、「億万長者になりたい人」の聴衆と遊んで、Helmにアプリケーションのバージョンを更新させる方法を理解しました。</font></font></i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビデオをご覧ください</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Helmの作業を調べたとき、実行中のアプリケーションのバージョンを更新しようとしたときの奇妙な動作に驚きました。アプリケーションコードを更新し、新しいイメージをdocker-registersにアップロードし、デプロイするコマンドを送信しましたが、何も起こりませんでした。以下は、アプリケーションを更新するための完全に成功していないいくつかの方法です。それぞれを詳細に検討すると、機器の内部構造と、この明らかでない動作の理由を理解し始めます。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法1. </font></font></strong><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">公式ウェブサイトに</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
よると</font><strong><font style="vertical-align: inherit;">、前回の起動以降に情報を変更しないでください</font></strong></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Helm氏は、「Kubernetesのチャートは大きくて複雑なので、Helmは何にも触れないようにもう一度試みています。」</font><font style="vertical-align: inherit;">したがって、Dockerレジストリでアプリケーションイメージの最新バージョンを更新してコマンドを実行して</font></font><code>helm upgrade</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">も、何も起こりません。</font><font style="vertical-align: inherit;">Helmは何も変更されていないと考え、アプリケーションを更新するコマンドをKubernetesに送信する必要はありません。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下、最新のタグは一例です。</font><font style="vertical-align: inherit;">このタグを指定すると、Kubernetesは、imagePullPolicyパラメータに関係なく、毎回dockerレジストリからイメージをダウンロードします。</font><font style="vertical-align: inherit;">最新の製品を使用することは望ましくなく、副作用を引き起こします。</font></font></blockquote><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法2.画像内のLABELを更新</font></font></strong><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
する同じ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメントに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記載されて</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">いるように</font></a><font style="vertical-align: inherit;">、「Helmは、前回のリリース以降に変更された場合にのみアプリケーションを更新します。」これの論理的なオプションは、Dockerイメージ自体のLABELラベルを更新することです。ただし、Helmはアプリケーションイメージを調べず、それらの変更については何も知りません。そのため、Helmイメージのラベルを更新するときに、それらを認識せず、Kubernetesのアプリケーション更新コマンドを受信しません。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法3.キーを使用する</font></font><code>--force</code></strong><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/639/0ec/d80/6390ecd8043360f6d66cc22f53e8623f.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マニュアルを参照して、目的のキーを探します。キーは意味で最も適切</font></font><code>--force</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。しゃべる名前にもかかわらず、動作は予想とは異なります。強制的なアプリケーションの更新の代わりに、その真の目的は、失敗したリリースを復元することです。このキーを使用しない場合は、コマンドを順番に実行する必要があります</font></font><code>helm delete &amp;&amp; helm install --replace</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。代わりに、</font></font><code>--force</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これらのコマンドの順次実行を自動化</font><font style="vertical-align: inherit;">するキー</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">使用することをお勧めし</font><font style="vertical-align: inherit;">ます。詳細については、この</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プルリクエストを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ご覧ください</font><font style="vertical-align: inherit;">。 Helmにアプリケーションのバージョンを更新するよう指示するため、残念ながらこのキーは機能しません。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法4. Kubernetesでラベルを直接変更する</font></font></strong><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/106/4c9/47d/1064c947d8cb0b6bfe32b9b2e9632fb0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コマンドを使用してクラスター内でラベルを直接更新すること</font></font><code>kubectl edit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はお勧めできません。</font><font style="vertical-align: inherit;">このアクションにより、実行中のアプリケーションと、最初にデプロイメントに送信されたものとの間の情報に不整合が生じます。</font><font style="vertical-align: inherit;">この場合のデプロイメント時のHelmの動作は、バージョンとは異なります。Helm2は何もせず、Helm 3はアプリケーションの新しいバージョンをデプロイします。</font><font style="vertical-align: inherit;">その理由を理解するには、Helmの仕組みを理解する必要があります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヘルムはどうですか</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Helmは、前回のリリース以降にアプリケーションが変更されたかどうかを判断するために、以下を使用できます。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetesでアプリケーションを実行する。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しいvalues.yamlと現在のグラフ。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Helm内部リリース情報。</font></font></li>
</ul><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最も興味深いのは、Helmは内部リリース情報をどこに保存するのですか？</font></font></b><div class="spoiler_text">  <code>helm history</code>,      ,    Helm.<br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cfd/ca8/e1d/cfdca8e1d69f39039f37e7184268eb84.png"></div><br>
        .    :<br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/532/817/22f/53281722f6ddf995ba88d7f67723b639.png"></div><br>
   Helm       ,   Tiller (  — kube-system),  ConfigMap,   «OWNER=TILLER»:<br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b91/5fe/9c4/b915fe9c416f1e6f388454a576e09cda.png"></div><br>
     Helm    ,     ,   .               .        ,   ,      .<br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/17c/674/aba/17c674aba6235391cf609ec1c4861839.png"></div><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目のHelmは、更新が必要かどうかを理解しようとするとき、2つの情報源のみを使用します。現在提供されているものと、ConfigMapにある内部リリース情報です。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/21d/af0/9b6/21daf09b6e0c94e80735fa57b40e1fba.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3番目のHelmは3者間マージ戦略を使用します。その情報に加えて、現在Kubernetesで動作しているアプリケーションも考慮されます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/47c/870/fd2/47c870fd2c99e2d4effafeb38210d69e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このため、古いバージョンのHelmはクラスター内のアプリケーション情報を考慮しないため、何もしませんが、Helm 3は変更を受け取り、新しいアプリケーションをデプロイに送信します。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法5.キー--recreate-ポッド</font></font></strong><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
キーを使用して、</font></font><code>--recreate-pods</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あなたはもともとキーを使用して得られることが計画されたものを達成することができます</font></font><code>--force</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。コンテナーが再起動し、imagePullPolicy：常に最新のタグのポリシー（詳細は上記の脚注を参照）に従って、Kubernetesが新しいバージョンのイメージをダウンロードして起動します。これは最善の方法で行われるわけではありません。StrategyTypeデプロイメントを考慮せずに、アプリケーションのすべての古いインスタンスを大幅にオフにし、新しいインスタンスの起動を開始します。再起動中、システムは機能せず、ユーザーは苦しみます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetes自体にも、同様の問題が長い間存在していました。</font><font style="vertical-align: inherit;">そして、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Issue</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のオープンから4年後に</font><font style="vertical-align: inherit;">問題が修正され、Kubernetesの1.15バージョンから、ローリングリスタートポッドの可能性が現れました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Helmはすべてのアプリケーションをオフにし、近くの新しいコンテナーを起動します。</font><font style="vertical-align: inherit;">本番環境では、これは単純なアプリケーションを引き起こさないようにすることはできません。</font><font style="vertical-align: inherit;">これは開発のニーズにのみ必要です。ステージ環境でのみ実行できます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Helmを使用してアプリケーションのバージョンを更新するにはどうすればよいですか？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Helmに送信される値を変更します。</font><font style="vertical-align: inherit;">原則として、これらはイメージタグの代わりに置き換えられた値です。</font><font style="vertical-align: inherit;">非生産的な環境で頻繁に使用される最新の場合、可変情報の役割はアノテーションであり、Kubernetes自体には役に立たず、Helmはアプリケーションを更新する必要があることを示すシグナルとして機能します。</font><font style="vertical-align: inherit;">アノテーション値を入力するためのオプション：</font></font><br>
<br>
<ol>
<li><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">標準関数を使用した</font><strong><font style="vertical-align: inherit;">ランダム値</font></strong><font style="vertical-align: inherit;"> - </font></font><code>{{ randAlphaNum 6 }}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ニュアンスがあります。そのような変数を含むチャートを使用して展開するたびに、アノテーション値は一意になり、Helmは変更があると想定します。</font><font style="vertical-align: inherit;">バージョンを変更していなくても、常にアプリケーションを再起動することがわかりました。</font><font style="vertical-align: inherit;">ダウンタイムは発生しないため、これは重要ではありませんが、それでも不快です。</font></font></li>
<li>  <strong>  </strong> — <code>{{ .Release.Date }}</code>. <br>
        .</li>
<li>   —  <strong> </strong>.  SHA   SHA     — <code>{{ .Values.sha }}</code>. <br>
       Helm    ,   .   ,     . , Helm     ,  .</li>
</ol><br>
<h2>  </h2><br>
<ul>
<li>Helm     ,         Docker Registry    :      .</li>
<li> <code>--force</code>           .</li>
<li> <code>--recreate-pods</code>   ,     :    .    ,      .</li>
<li>     Kubernetes    <code>kubectl edit</code>  :  ,         Helm.</li>
<li>    Helm   . Issues   Helm   ,     .</li>
<li>        .     ,  .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「世界平和」のカテゴリーから考え、人生のあらゆる分野で働いています。使用後は使用前に読んでください。</font><font style="vertical-align: inherit;">完全な情報を所有することのみが、信頼性の高いシステムを構築し、ユーザーを幸せにすることを可能にします。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">その他の関連リンク：</font></font></strong><br>
<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Helm</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3の</font><font style="vertical-align: inherit;">紹介</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公式サイトHelm</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github上のHelmリポジトリ</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">25の便利なKubernetesツール：デプロイと管理</font></font></a></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この講演は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ Kubernetesカンファレンス</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">でMail.ru Cloud Solutionsによって</font><font style="vertical-align: inherit;">最初に行われました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">他のパフォーマンスの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビデオを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">見て</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、Mail.ru Groupの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Telegram </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Around Kubernetesの</font></a><font style="vertical-align: inherit;">イベントのお知らせを購読して</font><font style="vertical-align: inherit;">ください。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja488182/index.html">Snake / EKANSランサムウェアは産業用制御システムを標的としています</a></li>
<li><a href="../ja488184/index.html">ZeroTierを搭載。仮想ネットワークを構築するための実用的なガイド。パート2</a></li>
<li><a href="../ja488186/index.html">私のQAエンジニアパス：バーンアウトから高度なテストまで</a></li>
<li><a href="../ja488188/index.html">火事後の森林再生：ナノ粒子がいかにして樹木マイクロクローンを保護するか</a></li>
<li><a href="../ja488190/index.html">もう一度感情的なバーンアウトについて</a></li>
<li><a href="../ja488194/index.html">なぜこんなに質の悪いプログラムを書いているのですか？</a></li>
<li><a href="../ja488196/index.html">Androidインセット：恐れへの対処とAndroid Qの準備</a></li>
<li><a href="../ja488198/index.html">ティムリッドは何を恐れており、なぜこれをやめるべきか</a></li>
<li><a href="../ja488200/index.html">最初のプログラミング言語に関する議論：最終決定</a></li>
<li><a href="../ja488202/index.html">PVS-StudioがChocolateyになりました：Azure DevOpsからChocolateyをチェックしています</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>