<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üï∏Ô∏è ‚ô£Ô∏è üåÑ Panggil perpustakaan bersama dari Similink üé∞ üà≥ ‚õπüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hai, Habr! 
 Saya mempersembahkan kepada Anda terjemahan sebuah artikel oleh rekan saya Mikhail tentang metode untuk memohon perpustakaan bersama di S...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Panggil perpustakaan bersama dari Similink</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/503908/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hai, Habr! </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya mempersembahkan kepada Anda terjemahan sebuah artikel oleh rekan saya Mikhail tentang metode untuk memohon perpustakaan bersama di Simulink. Mengapa itu diciptakan sama sekali? Faktanya adalah bahwa banyak perusahaan sudah memiliki banyak model warisan yang ingin kami gunakan kembali dan kami sering mengajukan pertanyaan: ‚ÄúBagaimana saya bisa mengintegrasikan warisan ke dalam Simulink? Dan jika warisan saya dalam bentuk DLL? " Karena itu, artikel aslinya ditulis. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di bawah kucing, beberapa cara untuk memanggil perpustakaan bersama di Simulink dibahas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semua perubahan pada kode dibuat dengan izin Mikhail dan dibuat agar tidak membebani artikel.</font></font><br>
<br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Artikel ini menunjukkan cara menggunakan fungsi dari pustaka bersama dalam model Simulink. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Katakanlah kita perlu menyematkan perpustakaan exlib di Simulink. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kodenya</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> terkandung dalam sumber-sumber </font><i><font style="vertical-align: inherit;">exlib.c</font></i><font style="vertical-align: inherit;"> dan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exlib.h</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ini adalah pustaka yang sangat sederhana yang berisi tiga fungsi: </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void exlib_init (void)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - membuka file untuk ditulis. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">membatalkan exlib_print (data float)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - menulis data ke file. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void exlib_term (void)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - menutup file.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Majelis perpustakaan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama, kompilasi perpustakaan. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Langkah ini tidak diperlukan jika perpustakaan dikompilasi dan dikirim sebagai file biner. Dalam hal ini, Anda bisa langsung pergi ke langkah 3, tetapi ingat bahwa untuk bekerja dengan perpustakaan Anda perlu mendapatkan file .dll (atau .so untuk Linux) dan file header yang sesuai (.h) dari penyedia perpustakaan. Untuk Windows, Anda juga akan memerlukan file .lib, yang bukan perpustakaan statis, tetapi yang disebut perpustakaan impor. Pustaka impor ini diperlukan untuk menghubungkan secara implisit. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama, kita akan menggunakan perintah MATLAB mex, yang memanggil kompilator host aktif saat ini untuk mengkompilasi perpustakaan bersama (exlib.dll pada Windows dan exlib.so di Linux). Penting untuk memastikan bahwa perintah telah dijalankan terlebih dahulu.</font></font><br>
<pre><code class="matlab hljs">mex -setup
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
untuk memilih </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kompiler yang didukung</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang gunakan mex untuk mengkompilasi perpustakaan:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kode untuk membangun perpustakaan</font></font></b>
                        <div class="spoiler_text"><pre><code class="matlab hljs">mingw = strfind(mex.getCompilerConfigurations(<span class="hljs-string">'C'</span>,<span class="hljs-string">'Selected'</span>).Name,<span class="hljs-string">'MinGW64 Compiler'</span>);
<span class="hljs-keyword">if</span> isunix
    <span class="hljs-comment">% GCC</span>
    mex(<span class="hljs-string">'LDEXT=.so'</span>,<span class="hljs-string">'LINKEXPORT='</span>,<span class="hljs-string">'LINKEXPORTVER='</span>,<span class="hljs-string">'LINKLIBS='</span>,<span class="hljs-string">'exlib.c'</span>);
<span class="hljs-keyword">elseif</span> mingw
    <span class="hljs-comment">% MinGW builds static shared library, so dll and lib files are the same</span>
    <span class="hljs-comment">% loadlibrary uses the dll file, while legacy code tool looks for the lib file</span>
    mex(<span class="hljs-string">'LDEXT=.lib'</span>,<span class="hljs-string">'LINKEXPORT='</span>,<span class="hljs-string">'LINKEXPORTVER='</span>,<span class="hljs-string">'LINKLIBS='</span>,<span class="hljs-string">'exlib.c'</span>);<font></font>
    mex(<span class="hljs-string">'LDEXT=.dll'</span>,<span class="hljs-string">'LINKEXPORT='</span>,<span class="hljs-string">'LINKEXPORTVER='</span>,<span class="hljs-string">'LINKLIBS='</span>,<span class="hljs-string">'exlib.c'</span>);
<span class="hljs-keyword">else</span>
    <span class="hljs-comment">% Visual</span>
    mex(<span class="hljs-string">'LDEXT=.dll'</span>,<span class="hljs-string">'LINKEXPORT='</span>,<span class="hljs-string">'LINKEXPORTVER='</span>,<span class="hljs-string">'CMDLINE300="del exlib.exp exlib.dll.manifest"'</span>,<span class="hljs-string">'exlib.c'</span>);
<span class="hljs-keyword">end</span>
Building with <span class="hljs-string">'gcc'</span>.<font></font>
MEX completed successfully.</code></pre><br>
</div>
                    </div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Memeriksa perpustakaan yang dikompilasi</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah kompilasi, Anda perlu memastikan bahwa pustaka yang dihasilkan dapat dimuat dan digunakan di MATLAB:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kode untuk memeriksa perpustakaan</font></font></b>
                        <div class="spoiler_text"><pre><code class="matlab hljs"><span class="hljs-comment">% Load the library</span>
[~,~] = loadlibrary([<span class="hljs-string">'exlib'</span>,system_dependent(<span class="hljs-string">'GetSharedLibExt'</span>)],<span class="hljs-string">'exlib.h'</span>);
<span class="hljs-comment">% Display functions available in the library</span>
libfunctionsview(<span class="hljs-string">'exlib'</span>);
<span class="hljs-comment">% Initialize</span>
calllib(<span class="hljs-string">'exlib'</span>,<span class="hljs-string">'exlib_init'</span>);
<span class="hljs-comment">% Step</span>
<span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span> = <span class="hljs-number">1</span>:<span class="hljs-number">10</span>
    calllib(<span class="hljs-string">'exlib'</span>,<span class="hljs-string">'exlib_print'</span>,single(<span class="hljs-built_in">i</span>));
<span class="hljs-keyword">end</span>
<span class="hljs-comment">% Terminate</span>
calllib(<span class="hljs-string">'exlib'</span>,<span class="hljs-string">'exlib_term'</span>);
<span class="hljs-comment">% Unload the library</span>
unloadlibrary(<span class="hljs-string">'exlib'</span>);
<span class="hljs-comment">% Show contents of generated file</span>
<span class="hljs-built_in">type</span>(<span class="hljs-string">'exlib.txt'</span>);
<span class="hljs-number">0.000000</span>
<span class="hljs-number">1.000000</span>
<span class="hljs-number">2.000000</span>
<span class="hljs-number">3.000000</span>
<span class="hljs-number">4.000000</span>
<span class="hljs-number">5.000000</span>
<span class="hljs-number">6.000000</span>
<span class="hljs-number">7.000000</span>
<span class="hljs-number">8.000000</span>
<span class="hljs-number">9.000000</span>
<span class="hljs-number">10.000000</span>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang setelah kami memastikan semuanya bekerja, mari kita mulai dengan Simulink!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meminta pustaka bersama menggunakan fungsi S</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fungsi S memungkinkan Anda menggunakan kode-C di Simulink. </font><font style="vertical-align: inherit;">Pendekatan ini memungkinkan pengguna untuk mengembangkan kode C yang diperlukan untuk memuat perpustakaan dan memanggil fungsinya. </font><font style="vertical-align: inherit;">Kemudian, kode ini dikompilasi menjadi file biner yang dikenali oleh Simulink dan ditautkan ke perpustakaan bersama. </font><font style="vertical-align: inherit;">Biner ini disebut fungsi S. </font><font style="vertical-align: inherit;">Simulink memiliki blok untuk memanggil fungsi S ini. </font><font style="vertical-align: inherit;">Ada beberapa pendekatan untuk membuat fungsi-S di Simulink.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menggunakan Alat Kode Lama</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendekatan pertama adalah menggunakan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Legacy Code Tool</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , alat yang membantu Anda secara otomatis membuat fungsi-S sesuai dengan spesifikasi yang dibuat menggunakan MATLAB. </font><font style="vertical-align: inherit;">Dalam contoh ini, fungsi-S dihubungkan ke perpustakaan impor (pada Windows kita memerlukan file * .lib yang sesuai) dan fungsi-fungsi perpustakaan dipanggil. </font><font style="vertical-align: inherit;">Pendekatan ini disebut tautan implisit. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama, Anda perlu menginisialisasi struktur untuk Alat Kode Legacy</font></font><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kode untuk menginisialisasi struktur Alat Kode Lama</font></font></b>
                        <div class="spoiler_text"><pre><code class="matlab hljs">specs = legacy_code(<span class="hljs-string">'initialize'</span>);
<span class="hljs-comment">% Prototype for the initialization function</span>
specs.StartFcnSpec = <span class="hljs-string">'exlib_init()'</span>;
<span class="hljs-comment">% Prototype for the step function</span>
specs.OutputFcnSpec = <span class="hljs-string">'exlib_print(single u1)'</span>;
<span class="hljs-comment">% Prototype for the terminate function</span>
specs.TerminateFcnSpec = <span class="hljs-string">'exlib_term()'</span>;
<span class="hljs-comment">% Shared library to link with (.so on Linux and .dll on Windows)</span>
specs.HostLibFiles = {[<span class="hljs-string">'exlib'</span>,strrep(system_dependent(<span class="hljs-string">'GetSharedLibExt'</span>),<span class="hljs-string">'.dll'</span>,<span class="hljs-string">'.lib'</span>)]};
<span class="hljs-comment">% We must supply header file when linking with shared library, otherwise</span>
<span class="hljs-comment">% compiler might make wrong assumptions about function's prototype.</span>
specs.HeaderFiles = {<span class="hljs-string">'exlib.h'</span>};<font></font>
specs.SFunctionName = <span class="hljs-string">'sfun_exlib'</span>;
</code></pre><br>
</div>
                    </div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Buat fungsi-S, kompilasi dan tautkan:</font></font><br>
<pre><code class="matlab hljs">legacy_code(<span class="hljs-string">'generate_for_sim'</span>,specs);<font></font>
### Start Compiling sfun_exlib<font></font>
    mex(<span class="hljs-string">'sfun_exlib.c'</span>, <span class="hljs-string">'-I/tmp/simulink_shrlib_fex'</span>, <span class="hljs-string">'/tmp/simulink_shrlib_fex/exlib.so'</span>)<font></font>
Building with <span class="hljs-string">'gcc'</span>.<font></font>
MEX completed successfully.<font></font>
### Finish Compiling sfun_exlib<font></font>
### Exit<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terakhir, buat blok Simulink:</font></font><br>
<pre><code class="matlab hljs">legacy_code(<span class="hljs-string">'slblock_generate'</span>,specs);
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jalankan simulasi:</font></font><br>
<pre><code class="matlab hljs">open_system(<span class="hljs-string">'simlib_test'</span>);<font></font>
snapnow;<font></font>
sim(<span class="hljs-string">'simlib_test'</span>);
<span class="hljs-comment">% Observe the results:</span>
<span class="hljs-built_in">type</span>(<span class="hljs-string">'exlib.txt'</span>);
<span class="hljs-number">0.000000</span>
<span class="hljs-number">1.000000</span>
<span class="hljs-number">2.000000</span>
<span class="hljs-number">3.000000</span>
<span class="hljs-number">4.000000</span>
<span class="hljs-number">5.000000</span>
<span class="hljs-number">6.000000</span>
<span class="hljs-number">7.000000</span>
<span class="hljs-number">8.000000</span>
<span class="hljs-number">9.000000</span>
<span class="hljs-number">10.000000</span></code></pre><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fungsi Menulis S Secara Manual</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendekatan kedua adalah menulis fungsi-S Anda sendiri untuk memuat pustaka bersama dan fungsi panggilan dari pustaka ini. </font><font style="vertical-align: inherit;">Pendekatan ini akan menggunakan tautan eksplisit, juga disebut tautan runtime. </font><font style="vertical-align: inherit;">Solusi termudah adalah dengan mengadaptasi fungsi-S yang secara otomatis dihasilkan sebelumnya oleh Legacy Code Tool. </font><font style="vertical-align: inherit;">Dalam contoh ini, fungsi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mdlStart</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mdlOutputs,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mdlTerminate dimodifikasi</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Begini cara fungsi-fungsi ini terlihat setelah modifikasi:</font></font><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lihat kode</font></font></b>
                        <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">mdlStart</span><span class="hljs-params">(SimStruct *S)</span>
</span>{
  <span class="hljs-comment">/*
   * Load the dynamic library
   */</span><font></font>
<font></font>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> defined(__GNUC__) &amp;&amp; !defined(__MINGW32__)</span>
    <span class="hljs-keyword">void</span> (*exlib_init_ptr)(<span class="hljs-keyword">void</span>);<font></font>
    dllHandle = dlopen(<span class="hljs-string">"./exlib.so"</span>,RTLD_LAZY);<font></font>
    exlib_init_ptr = dlsym(dllHandle, <span class="hljs-string">"exlib_init"</span>);
  <span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
    exlib_init_type exlib_init_ptr = <span class="hljs-literal">NULL</span>;<font></font>
    dllHandle = LoadLibrary(<span class="hljs-string">"exlib.dll"</span>);<font></font>
    exlib_init_ptr = (exlib_init_type)GetProcAddress(dllHandle,<span class="hljs-string">"exlib_init"</span>);
  <span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
  exlib_init_ptr();<font></font>
}<font></font>
</code></pre><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">mdlOutputs</span><span class="hljs-params">(SimStruct *S, int_T tid)</span>
</span>{<font></font>
  real32_T *u1 = <span class="hljs-number">0</span>;<font></font>
<font></font>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> defined(__GNUC__) &amp;&amp; !defined(__MINGW32__)</span>
    <span class="hljs-keyword">void</span> (*exlib_print_ptr)(<span class="hljs-keyword">float</span>);<font></font>
    exlib_print_ptr = dlsym(dllHandle,<span class="hljs-string">"exlib_print"</span>);
  <span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
    exlib_print_type exlib_print_ptr = <span class="hljs-literal">NULL</span>;<font></font>
    exlib_print_ptr = (exlib_print_type)GetProcAddress(dllHandle,<span class="hljs-string">"exlib_print"</span>);
  <span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
  <span class="hljs-comment">/*
   * Get access to Parameter/Input/Output/DWork/size information
   */</span>
  u1 = (real32_T *) ssGetInputPortSignal(S, <span class="hljs-number">0</span>);<font></font>
<font></font>
  <span class="hljs-comment">/*
   * Call the function from library
   */</span><font></font>
  exlib_print_ptr( *u1);<font></font>
}<font></font>
</code></pre><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">mdlTerminate</span><span class="hljs-params">(SimStruct *S)</span>
</span>{
  <span class="hljs-comment">/*
   * Unload the dynamic library
   */</span><font></font>
<font></font>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> defined(__GNUC__) &amp;&amp; !defined(__MINGW32__)</span>
    <span class="hljs-keyword">void</span> (*exlib_term_ptr)(<span class="hljs-keyword">void</span>);<font></font>
    exlib_term_ptr = dlsym(dllHandle,<span class="hljs-string">"exlib_term"</span>);<font></font>
    exlib_term_ptr();<font></font>
    dlclose(dllHandle);<font></font>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
    exlib_term_type exlib_term_ptr = <span class="hljs-literal">NULL</span>;<font></font>
    exlib_term_ptr = (exlib_term_type)GetProcAddress(dllHandle,<span class="hljs-string">"exlib_term"</span>);<font></font>
    exlib_term_ptr();<font></font>
    FreeLibrary(dllHandle);<font></font>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kompilasi S-function yang dihasilkan:</font></font><br>
<pre><code class="matlab hljs"><span class="hljs-keyword">if</span> isunix<font></font>
    mex(<span class="hljs-string">'sfun_exlib_dyn.c'</span>,<span class="hljs-string">'-ldl'</span>);
<span class="hljs-keyword">else</span>
    mex(<span class="hljs-string">'sfun_exlib_dyn.c'</span>);
<span class="hljs-keyword">end</span>
Building with <span class="hljs-string">'gcc'</span>.<font></font>
MEX completed successfully.</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan jalankan simulasi:</font></font><br>
<pre><code class="matlab hljs">open_system(<span class="hljs-string">'simlib_test_dyn'</span>);<font></font>
sim(<span class="hljs-string">'simlib_test_dyn'</span>);
<span class="hljs-comment">% Observe the results:</span>
<span class="hljs-built_in">type</span>(<span class="hljs-string">'exlib.txt'</span>);
<span class="hljs-number">0.000000</span>
<span class="hljs-number">1.000000</span>
<span class="hljs-number">2.000000</span>
<span class="hljs-number">3.000000</span>
<span class="hljs-number">4.000000</span>
<span class="hljs-number">5.000000</span>
<span class="hljs-number">6.000000</span>
<span class="hljs-number">7.000000</span>
<span class="hljs-number">8.000000</span>
<span class="hljs-number">9.000000</span>
<span class="hljs-number">10.000000</span></code></pre><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menggunakan S-Function Builder</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendekatan lain adalah dengan menggunakan blok </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S-Function Builder</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ini adalah unit khusus yang dapat dilihat sebagai persilangan antara Legacy Code Tool dan S-functions yang ditulis tangan dalam hal kompleksitas. </font><font style="vertical-align: inherit;">S-Function Builder menyediakan antarmuka grafis yang menggambarkan karakteristik fungsi-S Anda, dan fungsi-S dibuat secara otomatis. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada beberapa batasan kinerja dan masalah dengan menggunakan S-Function Builder. </font><font style="vertical-align: inherit;">Saat ini, ini dianggap sebagai pendekatan usang untuk membuat fungsi-S. </font><font style="vertical-align: inherit;">Disarankan untuk menggunakan blok fungsi C, yang muncul dalam rilis R2020a dan dibahas nanti.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meminta pustaka bersama menggunakan Fungsi MATLAB </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Blok </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fungsi MATLAB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> memungkinkan Anda untuk menggunakan bahasa MATLAB untuk mendeskripsikan algoritma khusus di Simulink. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk memanggil pustaka bersama dari fungsi MATLAB, gunakan fungsi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coder.ceval</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang hanya dapat digunakan di tubuh Fungsi MATLAB (dan bukan MATLAB). </font><font style="vertical-align: inherit;">Coder.ceval tidak membutuhkan MATLAB Coder untuk berfungsi. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode untuk blok Fungsi MATLAB memanggil pustaka bersama:</font></font><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lihat kode</font></font></b>
                        <div class="spoiler_text"><pre><code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fcn</span><span class="hljs-params">(u)</span></span>
<span class="hljs-comment">%#codegen</span><font></font>
<font></font>
<span class="hljs-comment">% Keep track of initialization and runtime count</span>
<span class="hljs-keyword">persistent</span> runTimeCnt<font></font>
<font></font>
<span class="hljs-comment">% Generate library path on the fly (current directory in this case)</span>
coder.extrinsic(<span class="hljs-string">'pwd'</span>,<span class="hljs-string">'system_dependent'</span>);<font></font>
libpath = coder.const(pwd);<font></font>
<span class="hljs-comment">% Shared library to link with</span>
libname = coder.const([<span class="hljs-string">'exlib'</span>,strrep(system_dependent(<span class="hljs-string">'GetSharedLibExt'</span>),<span class="hljs-string">'.dll'</span>,<span class="hljs-string">'.lib'</span>)]);
<span class="hljs-comment">% Add the external library. Mark it as precompiled, so it won't appear as</span>
<span class="hljs-comment">% makefile target during code generation.</span>
coder.updateBuildInfo(<span class="hljs-string">'addLinkObjects'</span>,libname,libpath,<span class="hljs-number">1000</span>,<span class="hljs-built_in">true</span>,<span class="hljs-built_in">true</span>);<font></font>
coder.updateBuildInfo(<span class="hljs-string">'addIncludePaths'</span>,libpath);<font></font>
coder.cinclude(<span class="hljs-string">'exlib.h'</span>);<font></font>
<font></font>
<span class="hljs-keyword">if</span> <span class="hljs-built_in">isempty</span>(runTimeCnt)
    <span class="hljs-comment">% Initialize</span>
    coder.ceval(<span class="hljs-string">'exlib_init'</span>);<font></font>
    runTimeCnt = <span class="hljs-number">0</span>;
<span class="hljs-keyword">end</span>
<span class="hljs-comment">% Step</span>
coder.ceval(<span class="hljs-string">'exlib_print'</span>,single(u));<font></font>
runTimeCnt = runTimeCnt+<span class="hljs-number">1</span>;
<span class="hljs-comment">% Terminate on the 10th step</span>
<span class="hljs-keyword">if</span> (runTimeCnt == <span class="hljs-number">11</span>)<font></font>
    coder.ceval(<span class="hljs-string">'exlib_term'</span>);
<span class="hljs-keyword">end</span>
</code></pre><br>
</div>
                    </div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendekatan ini memiliki satu kelemahan - kurangnya cara yang baik untuk memanggil fungsi penyelesaian pada akhir simulasi (dibandingkan dengan blok Sistem MATLAB). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda dapat menentukan fungsi penyelesaian untuk model dengan mengatur exlib_term (); dalam pengaturan model dalam kategori </font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Target Simulasi -&gt; Kode Kustom -&gt; Hentikan fungsi</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CATATAN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Jika parameter "Impor kode kustom" diatur dalam pengaturan model, maka Anda perlu menentukan semua dependensi kode di panel "Target Simulasi" (alih-alih menggunakan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coder.cinclude</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coder.updateBuildInfo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Jika parameter ini tidak disetel, maka Anda dapat menggabungkan pengaturan dari Simulasi Target, coder.cinclude dan coder.updateBuildInfo.</font></font><br>
</i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Cara lain adalah mempertahankan dependensi menggunakan</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coder.cinclude</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coder.updateBuildInfo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dan panggil </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exlib_term ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dengan konvensi, seperti yang ditunjukkan pada contoh di atas. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jalankan simulasi:</font></font><br>
<pre><code class="matlab hljs">open_system(<span class="hljs-string">'simlib_test_mlf'</span>);<font></font>
sim(<span class="hljs-string">'simlib_test_mlf'</span>);
<span class="hljs-comment">% Observe the results:</span>
<span class="hljs-built_in">type</span>(<span class="hljs-string">'exlib.txt'</span>);
<span class="hljs-number">0.000000</span>
<span class="hljs-number">1.000000</span>
<span class="hljs-number">2.000000</span>
<span class="hljs-number">3.000000</span>
<span class="hljs-number">4.000000</span>
<span class="hljs-number">5.000000</span>
<span class="hljs-number">6.000000</span>
<span class="hljs-number">7.000000</span>
<span class="hljs-number">8.000000</span>
<span class="hljs-number">9.000000</span>
<span class="hljs-number">10.000000</span></code></pre><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meminta pustaka bersama dari Stateflow </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda ingin menggunakan fungsi pustaka bersama dalam diagram </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stateflow</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , maka fungsi-fungsi ini harus dipanggil langsung dari Stateflow. Dokumentasi Stateflow memiliki contoh yang menunjukkan cara melakukan ini. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Memanggil fungsi eksternal dalam Stateflow sangat sederhana - Anda perlu menentukan nama fungsi dalam diagram Stateflow: </font></font><br>
<img src="https://habrastorage.org/webt/_f/3m/z7/_f3mz7djr11eebq8egiisjpk9ru.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selain itu, Anda perlu mengkonfigurasi parameter model sehingga Stateflow tahu ke mana harus mencari fungsi-fungsi eksternal ini. Dalam pengaturan </font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Target Simulasi -&gt; Kode Kustom -&gt; Perpustakaan, Anda</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> harus memasukkan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exlib.lib (atau exlib.so di Linux)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dalam </font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sasaran Simulasi -&gt; Kode Kustom -&gt; File Header, Anda</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> harus memasukkan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#include "exlib.h"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Penting juga untuk tidak lupa menentukan fungsi penyelesaian. DI</font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Target Simulasi -&gt; Kode Kustom -&gt; Hentikan fungsi</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> harus menentukan</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> exlib_term (); </font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jalankan simulasi:</font></font><br>
<pre><code class="matlab hljs"><span class="hljs-keyword">if</span> isunix<font></font>
    set_param(<span class="hljs-string">'simlib_test_sf'</span>,<span class="hljs-string">'SimUserLibraries'</span>,<span class="hljs-string">'exlib.so'</span>);
<span class="hljs-keyword">end</span>
sim(<span class="hljs-string">'simlib_test_sf'</span>);
<span class="hljs-comment">% Observe the results:</span>
<span class="hljs-built_in">type</span>(<span class="hljs-string">'exlib.txt'</span>);
<span class="hljs-number">0.000000</span>
<span class="hljs-number">1.000000</span>
<span class="hljs-number">2.000000</span>
<span class="hljs-number">3.000000</span>
<span class="hljs-number">4.000000</span>
<span class="hljs-number">5.000000</span>
<span class="hljs-number">6.000000</span>
<span class="hljs-number">7.000000</span>
<span class="hljs-number">8.000000</span>
<span class="hljs-number">9.000000</span>
<span class="hljs-number">10.000000</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perhatikan bahwa informasi dalam bagian ini berlaku untuk Stateflow diagram yang menggunakan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bahasa C tindakan</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Jika diagram Stateflow menggunakan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bahasa tindakan MATLAB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , maka </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coder.ceval diperlukan</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , seperti halnya dengan Fungsi MATLAB.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meminta pustaka bersama menggunakan blok Sistem MATLAB </font></font></h2> <br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blok Sistem MATLAB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> memungkinkan Anda untuk menggunakan objek sistem di Simulink. </font><font style="vertical-align: inherit;">Informasi lebih lanjut tentang blok ini dapat ditemukan dalam dokumentasi. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dukungan untuk objek sistem muncul di Simulink dalam rilis R2013b. </font><font style="vertical-align: inherit;">Banyak orang menggunakan objek sistem karena memudahkan mendefinisikan fungsi inisialisasi, simulasi, dan penyelesaian. </font><font style="vertical-align: inherit;">Juga, objek sistem dapat menggunakan kode MATLAB tambahan untuk fungsi-fungsi ini - misalnya, untuk data pra-dan pasca-pemrosesan fungsi langkah - semua tanpa menulis kode C. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inilah yang terlihat seperti objek sistem yang digunakan dalam blok Sistem MATLAB:</font></font><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kode Obyek Sistem</font></font></b>
                        <div class="spoiler_text"><pre><code class="matlab hljs"><span class="hljs-keyword">classdef</span> exlib &lt; matlab.System
    <span class="hljs-comment">% Call exlib shared library</span>
    <span class="hljs-comment">%</span>
    <span class="hljs-comment">% This example shows how to call shared library from Simulink using</span>
    <span class="hljs-comment">% MATLAB System block.</span>
    <span class="hljs-keyword">properties</span> (Nontunable,Access=private)<font></font>
        libName = exlib.getLibName;<font></font>
        libPath = pwd;<font></font>
        libHeader = <span class="hljs-string">'exlib.h'</span>;
    <span class="hljs-keyword">end</span><font></font>
    <font></font>
    <span class="hljs-keyword">methods</span> (Static)
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">libName</span> = <span class="hljs-title">getLibName</span></span>
            <span class="hljs-keyword">if</span> isunix<font></font>
                libName = <span class="hljs-string">'exlib.so'</span>;
            <span class="hljs-keyword">else</span>
                libName = <span class="hljs-string">'exlib.lib'</span>;
            <span class="hljs-keyword">end</span>
        <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span><font></font>
    <font></font>
    <span class="hljs-keyword">methods</span> (Access=protected)
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setupImpl</span><span class="hljs-params">(obj, ~)</span></span>
            <span class="hljs-comment">% Initialize.</span>
            coder.updateBuildInfo(<span class="hljs-string">'addLinkObjects'</span>,obj.libName,obj.libPath,<span class="hljs-number">1000</span>,<span class="hljs-built_in">true</span>,<span class="hljs-built_in">true</span>);<font></font>
            coder.updateBuildInfo(<span class="hljs-string">'addIncludePaths'</span>,obj.libPath);<font></font>
            coder.cinclude(obj.libHeader);<font></font>
            coder.ceval(<span class="hljs-string">'exlib_init'</span>);
        <span class="hljs-keyword">end</span><font></font>
        <font></font>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stepImpl</span><span class="hljs-params">(~, u)</span></span>
            <span class="hljs-comment">% Step.</span>
            coder.ceval(<span class="hljs-string">'exlib_print'</span>,u);
        <span class="hljs-keyword">end</span><font></font>
        <font></font>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">releaseImpl</span><span class="hljs-params">(~)</span></span>
            <span class="hljs-comment">% Terminate.</span>
            coder.ceval(<span class="hljs-string">'exlib_term'</span>);
        <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></code></pre><br>
</div>
                    </div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jalankan simulasi:</font></font><br>
<pre><code class="matlab hljs">open_system(<span class="hljs-string">'simlib_test_mls'</span>);<font></font>
sim(<span class="hljs-string">'simlib_test_mls'</span>);
<span class="hljs-comment">% Observe the results:</span>
<span class="hljs-built_in">type</span>(<span class="hljs-string">'exlib.txt'</span>);
<span class="hljs-number">0.000000</span>
<span class="hljs-number">1.000000</span>
<span class="hljs-number">2.000000</span>
<span class="hljs-number">3.000000</span>
<span class="hljs-number">4.000000</span>
<span class="hljs-number">5.000000</span>
<span class="hljs-number">6.000000</span>
<span class="hljs-number">7.000000</span>
<span class="hljs-number">8.000000</span>
<span class="hljs-number">9.000000</span>
<span class="hljs-number">10.000000</span></code></pre><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Panggil perpustakaan bersama menggunakan blok C Caller </font></font></h2> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Blok </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C Caller</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> memungkinkan Anda untuk memanggil fungsi C langsung dari Simulink. Informasi lebih lanjut tentang blok ini dapat ditemukan dalam dokumentasi. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini adalah pendekatan yang relatif baru yang pertama kali muncul di MATLAB R2018b. Tujuan utamanya adalah membuat panggilan fungsi dan pustaka C di Simulink sangat sederhana. Tetapi memiliki keterbatasan, yang dapat Anda baca di dokumentasi untuk blok ini. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exlib.so/exlib.lib telah</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ditambahkan ke </font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simulasi Target -&gt; Perpustakaan</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#include "exlib.h"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> di </font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simulasi Target -&gt; Header</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dalam pengaturan model, cukup klik tombol "Refresh kode kustom" di blok C Caller, untuk melihat semua fungsi yang ada di perpustakaan.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah memilih </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exlib_print</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fungsi </font><font style="vertical-align: inherit;">, dialog spesifikasi port diisi secara otomatis: </font></font><br>
<img src="https://habrastorage.org/webt/4s/sz/bd/4sszbddxgbpffb3urxzbw2dv-ua.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan lagi, Anda perlu menambahkan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exlib_init</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exlib_term</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fungsi panggilan </font><font style="vertical-align: inherit;">untuk Target Simulasi. </font><font style="vertical-align: inherit;">Anda juga dapat menambahkan beberapa blok Caller C lainnya untuk secara langsung memanggil fungsi inisialisasi dan terminasi. </font><font style="vertical-align: inherit;">Blok-blok Penelepon C ini perlu ditempatkan dalam subsistem Fungsi Inisialisasi dan Fungsi Hentikan. </font><font style="vertical-align: inherit;">Anda juga dapat mempertimbangkan contoh berikut dari Stateflow: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jadwalkan Subsistem untuk</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Dijalankan </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">pada Waktu Tertentu</font></a><font style="vertical-align: inherit;"> Jalankan simulasi:</font></font><br>
<pre><code class="matlab hljs">open_system(<span class="hljs-string">'simlib_test_ccaller'</span>);
<span class="hljs-keyword">if</span> isunix<font></font>
    set_param(<span class="hljs-string">'simlib_test_ccaller'</span>,<span class="hljs-string">'SimUserLibraries'</span>,<span class="hljs-string">'exlib.so'</span>);
<span class="hljs-keyword">end</span>
sim(<span class="hljs-string">'simlib_test_ccaller'</span>);
<span class="hljs-comment">% Observe the results:</span>
<span class="hljs-built_in">type</span>(<span class="hljs-string">'exlib.txt'</span>);
<span class="hljs-number">0.000000</span>
<span class="hljs-number">1.000000</span>
<span class="hljs-number">2.000000</span>
<span class="hljs-number">3.000000</span>
<span class="hljs-number">4.000000</span>
<span class="hljs-number">5.000000</span>
<span class="hljs-number">6.000000</span>
<span class="hljs-number">7.000000</span>
<span class="hljs-number">8.000000</span>
<span class="hljs-number">9.000000</span>
<span class="hljs-number">10.000000</span></code></pre><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meminta pustaka bersama menggunakan blok Fungsi C</font></font></h2> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penambahan terbaru untuk mengintegrasikan kode eksternal ke Simulink adalah </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C Fungsi</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> blok </font><font style="vertical-align: inherit;">. Dia muncul di R2020a. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini menyerupai blok C Caller dalam hal kemudahan penggunaan, tetapi memungkinkan Anda untuk membuat pembungkus C di sekitar fungsi yang diimpor (dengan demikian, blok ini menyerupai S-Function Builder). Tetapi, kemungkinan besar, skenario utama untuk menggunakan blok Fungsi C bukan untuk memanggil fungsi C yang ada, tetapi untuk menulis potongan kecil kode C, jika kode tersebut diperlukan dalam aplikasi. Misalnya, Anda mungkin memerlukan akses ke register perangkat keras atau fungsi bawaan kompiler. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jangan lupa untuk menambahkan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exlib.so/exlib.lib</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ke pengaturan </font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Target Simulasi -&gt; Perpustakaan"</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#sertakan "exlib.h"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dalam pengaturan </font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Simulasi Target -&gt; file Header"</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dalam pengaturan model. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah itu, dalam pengaturan blok Fungsi C, Anda perlu menambahkan karakter untuk data input dengan tipe data tunggal dan tentukan output, mulai dan kode akhir:</font></font><br>
<img src="https://habrastorage.org/webt/pm/ek/uz/pmekuz8kkzafgxf8ky1v8coqqla.png"><br>
<br>
<pre><code class="matlab hljs">open_system(<span class="hljs-string">'simlib_test_cfunction'</span>);
<span class="hljs-keyword">if</span> isunix<font></font>
    set_param(<span class="hljs-string">'simlib_test_cfunction'</span>,<span class="hljs-string">'SimUserLibraries'</span>,<span class="hljs-string">'exlib.so'</span>);
<span class="hljs-keyword">end</span>
sim(<span class="hljs-string">'simlib_test_cfunction'</span>);
<span class="hljs-comment">% Observe the results:</span>
<span class="hljs-built_in">type</span>(<span class="hljs-string">'exlib.txt'</span>);
<span class="hljs-number">0.000000</span>
<span class="hljs-number">1.000000</span>
<span class="hljs-number">2.000000</span>
<span class="hljs-number">3.000000</span>
<span class="hljs-number">4.000000</span>
<span class="hljs-number">5.000000</span>
<span class="hljs-number">6.000000</span>
<span class="hljs-number">7.000000</span>
<span class="hljs-number">8.000000</span>
<span class="hljs-number">9.000000</span>
<span class="hljs-number">10.000000</span></code></pre><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meminta pustaka bersama yang dibuat menggunakan Embedded Coder </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Salah satu skenario untuk menggunakan Embedded Coder adalah pembuatan kode-C otomatis dari model Simulink dan pengemasan kode ini di perpustakaan bersama. Dokumentasi ini juga memiliki contoh yang menunjukkan cara membuat pustaka bersama secara otomatis dan menyebutnya dari aplikasi eksternal yang ditulis dalam C. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perhatikan bahwa jika Anda hanya perlu menjalankan algoritme atau bagian dari algoritma sebagai kode C dalam model Simulink yang sama, maka lebih baik menggunakan S-fungsi dari Simulink Coder atau simulasi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">software-in-the-loop</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Namun, jika pustaka bersama yang dihasilkan oleh Embedded Coder digunakan untuk pemodelan semi-alami, Anda mungkin perlu mengintegrasikan pustaka yang sama ke dalam model yang lebih besar yang digunakan oleh pengembang lain dan dengan demikian melindungi kekayaan intelektual Anda. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bekerja dengan pustaka bersama yang dihasilkan oleh Embedded Coder tidak berbeda dengan bekerja dengan pustaka bersama, yang digunakan dalam artikel. </font><font style="vertical-align: inherit;">Pertimbangkan model sederhana yang memiliki dua input dan satu output:</font></font><br>
<pre><code class="matlab hljs">open_system(<span class="hljs-string">'simlib_test_ert'</span>);<font></font>
snapnow;<font></font>
</code></pre><br>
<img src="https://habrastorage.org/webt/wt/vo/wu/wtvowu3jc24ttsqd1qfgok9jxpc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah merakit model, kami mendapatkan file .dll (.so di Linux), file .lib (impor library untuk .dll), dan file .exp (file ekspor untuk berkomunikasi dengan .dll).</font></font><br>
<pre><code class="matlab hljs"><span class="hljs-keyword">if</span> isunix<font></font>
    set_param(<span class="hljs-string">'simlib_test_ert'</span>,<span class="hljs-string">'CustomHeaderCode'</span>,<span class="hljs-string">'#include &lt;stddef.h&gt;'</span>);
<span class="hljs-keyword">end</span>
rtwbuild(<span class="hljs-string">'simlib_test_ert'</span>);<font></font>
### Starting build procedure <span class="hljs-keyword">for</span>: simlib_test_ert<font></font>
### Successful completion of build procedure <span class="hljs-keyword">for</span>: simlib_test_ert</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pustaka bersama yang dihasilkan mengekspor karakter berikut:</font></font><br>
<pre><code class="cpp hljs"><span class="hljs-function">ex_init
<span class="hljs-keyword">double</span> <span class="hljs-title">ex_step</span><span class="hljs-params">(<span class="hljs-keyword">double</span>, <span class="hljs-keyword">double</span>)</span>
simlib_test_ert_terminate</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara default, input dan output diekspor sebagai karakter global, dan fungsi inisialisasi, langkah, dan penyelesaian mengikuti konvensi penamaan model. </font><font style="vertical-align: inherit;">Jika perlu, Anda dapat mengonfigurasi prototipe fungsi, nama simbol, dan lainnya (diskusi tentang pengaturan ini berada di luar cakupan artikel ini). </font><font style="vertical-align: inherit;">Dalam model ini, prototipe fungsi langkah dari model didefinisikan sebagai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Out1 = ex_step (In1, In2)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk memanggil fungsi-fungsi ini, Anda perlu menggunakan salah satu metode yang tercantum di atas. </font><font style="vertical-align: inherit;">Misalnya, Anda dapat menggunakan Fungsi MATLAB (untuk kesederhanaan, kami hanya memanggil fungsi langkah):</font></font><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lihat kode</font></font></b>
                        <div class="spoiler_text"><pre><code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">y</span> = <span class="hljs-title">fcn</span><span class="hljs-params">(u1, u2)</span></span>
<span class="hljs-comment">%#codegen</span><font></font>
<font></font>
<span class="hljs-comment">% Generate library path on the fly</span>
coder.extrinsic(<span class="hljs-string">'RTW.getBuildDir'</span>,<span class="hljs-string">'fullfile'</span>);<font></font>
buildDir = coder.const(RTW.getBuildDir(<span class="hljs-string">'simlib_test_ert'</span>));<font></font>
libpath = coder.const(buildDir.CodeGenFolder);<font></font>
incpath = coder.const(fullfile(buildDir.BuildDirectory,<span class="hljs-string">'simlib_test_ert.h'</span>));
<span class="hljs-comment">% Shared library to link with</span>
<span class="hljs-keyword">if</span> isunix<font></font>
    ext = <span class="hljs-string">'.so'</span>;<font></font>
    libname = [<span class="hljs-string">'simlib_test_ert'</span>,ext];
<span class="hljs-keyword">else</span>
    ext = <span class="hljs-string">'.lib'</span>;<font></font>
    libname = [<span class="hljs-string">'simlib_test_ert_'</span>,computer(<span class="hljs-string">'arch'</span>),ext];
<span class="hljs-keyword">end</span>
<span class="hljs-comment">% Add the external library. Mark it as precompiled, so it won't appear as</span>
<span class="hljs-comment">% makefile target during code generation.</span>
coder.updateBuildInfo(<span class="hljs-string">'addLinkObjects'</span>,libname,libpath,<span class="hljs-number">1000</span>,<span class="hljs-built_in">true</span>,<span class="hljs-built_in">true</span>);<font></font>
coder.updateBuildInfo(<span class="hljs-string">'addIncludePaths'</span>,libpath);<font></font>
coder.cinclude(incpath);<font></font>
<font></font>
<span class="hljs-comment">% Initialize output</span>
y = <span class="hljs-number">0</span>;
<span class="hljs-comment">% Step</span>
y = coder.ceval(<span class="hljs-string">'ex_step'</span>,u1,u2);</code></pre><br>
</div>
                    </div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jalankan simulasi dan lihat hasilnya:</font></font><br>
<pre><code class="matlab hljs">open_system(<span class="hljs-string">'simlib_test_callert'</span>);<font></font>
sim(<span class="hljs-string">'simlib_test_callert'</span>);<font></font>
snapnow;<font></font>
</code></pre><br>
<img src="https://habrastorage.org/webt/ga/qw/vt/gaqwvt2gg4g87wrtxufr78pezxa.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">temuan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Artikel ini menjelaskan berbagai pendekatan untuk memohon pustaka bersama dari model Simulink. </font><font style="vertical-align: inherit;">Baik tautan implisit maupun eksplisit dipertimbangkan. </font><font style="vertical-align: inherit;">Semua metode memiliki pro dan kontra, dan kesesuaiannya tergantung pada alur kerja, persyaratan, dan tujuan tertentu. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendekatan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Legacy Code Tool</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> berfungsi paling baik ketika menerapkan tautan implisit dengan pustaka bersama, karena dalam hal ini kita bisa memanggil fungsi langsung dari pustaka, dan penghubung akan mengurus sisanya. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blok Sistem MATLAB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah pendekatan lain yang memberikan manfaat berikut:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kepatuhan luar biasa terhadap paradigma fungsi inisialisasi, langkah dan penyelesaian, memungkinkan Anda untuk mempertahankan semua fungsi ini di dalam blok itu sendiri, dan bukan pada skala model</font></font><br>
</li>
<li>       <br>
</li>
<li>    MATLAB     MATLAB<br>
</li>
<li> MATLAB System           (,    S-)<br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kerugian menggunakan blok Fungsi MATLAB adalah penggunaannya dapat menyebabkan overhead tambahan selama pembuatan kode. Dengan demikian, Legacy Code Tool dan fungsi S masih lebih disukai untuk menghasilkan kode produksi. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fungsi S yang ditulis tangan paling cocok untuk menerapkan tautan eksplisit ke pustaka bersama. Dalam hal ini, Anda harus menggunakan fungsi seperti </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LoadLibrary / dlopen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetProcAddress / dlsym</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FreeLibrary / dlclose</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> agar dapat memanggil fungsi. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blok C Caller yang</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diperkenalkan di R2018b sejauh ini merupakan cara termudah untuk memanggil fungsi C, tetapi memiliki keterbatasan. Hal yang sama dapat dikatakan untuk blok </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fungsi C.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yang merupakan tambahan terbaru untuk R2020a. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unduh sumber dan model </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">di sini</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id503894/index.html">Pengumuman pertemuan online NskTechTalks # 12: di mana pengembang front-end dapat tumbuh dan bagaimana jika tidak ada yang datang darinya?</a></li>
<li><a href="../id503898/index.html">Satu hari front-end terpencil</a></li>
<li><a href="../id503902/index.html">Bagaimana membuat tetangga bekerja di proyek mereka, atau InnerSource untuk bank</a></li>
<li><a href="../id503904/index.html">Dunia dan dunia, atau matematika untuk humaniora</a></li>
<li><a href="../id503906/index.html">LabVIEW NXG - Jenis Data Sederhana dan Jenis Pemaksaan</a></li>
<li><a href="../id503910/index.html">Eksperimen pada orang yang telah pergi ke "udalenka"</a></li>
<li><a href="../id503916/index.html">Belajar berdagang di bursa. Bagian satu: mengatur lingkungan pengujian</a></li>
<li><a href="../id503918/index.html">Mengelola Paket dengan Modul Go: A Pragmatic Guide</a></li>
<li><a href="../id503920/index.html">Bagaimana kami menguji sistem mikrofon pada STM32: pengalaman pengembang perangkat Yandex</a></li>
<li><a href="../id503922/index.html">Mengapa UE memberantas dinding cookie</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>