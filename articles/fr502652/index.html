<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚òùüèø üì¥ üöÉ Les march√©s publics, comment assurer leur coh√©rence üëñ üö£üèø üö•</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="- Votre syst√®me comprend-il de nombreux services interconnect√©s?
- mettre √† jour manuellement le code de service lors du changement de l'API publique?...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Les march√©s publics, comment assurer leur coh√©rence</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/directum/blog/502652/"><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Votre syst√®me comprend-il de nombreux services interconnect√©s?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mettre √† jour manuellement le code de service lors du changement de l'API publique?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les changements dans vos services sapent souvent le travail des autres, et les autres d√©veloppeurs vous d√©testent pour cela?</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous avez r√©pondu oui au moins une fois, alors bienvenue!</font></font><br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">termes</font></font></h4><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">March√©s publics, sp√©cifications</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - interfaces publiques √† travers lesquelles vous pouvez interagir avec le service. </font><font style="vertical-align: inherit;">Dans le texte, ils signifient la m√™me chose.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quel est le sujet de cet article</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apprenez √† r√©duire le temps consacr√© au d√©veloppement de services Web √† l'aide d'outils de description unifi√©e des contrats et de g√©n√©ration automatique de code. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une bonne utilisation des techniques et outils d√©crits ci-dessous vous permettra de d√©ployer rapidement de nouvelles fonctionnalit√©s et de ne pas casser les anciennes.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Ä quoi ressemble le probl√®me</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe un syst√®me compos√© de plusieurs services. </font><font style="vertical-align: inherit;">Ces services sont attribu√©s √† diff√©rentes √©quipes. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-e/nt/tj/-enttjd6jjg8qoq2c51pw4fha0a.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les services aux consommateurs d√©pendent du fournisseur de services. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le syst√®me √©volue et un jour le prestataire de services modifie ses march√©s publics. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hk/sf/qs/hksfqs6qfhp-ptvnfidpouif2ki.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si les services aux consommateurs ne sont pas pr√™ts √† changer, le syst√®me cesse de fonctionner pleinement.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/1u/iv/iq/1uiviq4rc31xzihqfa4rc2qzgdy.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment r√©soudre ce probl√®me</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'√©quipe du service fournisseur r√©parera tout</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela peut √™tre fait si l'√©quipe du fournisseur est propri√©taire du domaine des autres services et a acc√®s √† ses r√©f√©rentiels git. </font><font style="vertical-align: inherit;">Cela ne fonctionnera que dans les petits projets lorsqu'il y a peu de services d√©pendants. </font><font style="vertical-align: inherit;">C'est l'option la moins ch√®re. </font><font style="vertical-align: inherit;">Si possible, vous devez l'utiliser.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mettre √† jour le code de votre service aupr√®s de l'√©quipe consommateur</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pourquoi les autres se cassent, mais r√©parons-nous? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, la question principale est de savoir comment r√©parer votre service, √† quoi ressemble le contrat maintenant? </font><font style="vertical-align: inherit;">Vous devez apprendre le nouveau code de service du fournisseur ou contacter leur √©quipe. </font><font style="vertical-align: inherit;">Nous passons du temps √† √©tudier le code et √† interagir avec une autre √©quipe.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pensez √† quoi faire pour √©viter que le probl√®me n'apparaisse</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'option la plus raisonnable √† long terme. </font><font style="vertical-align: inherit;">Consid√©rez-le dans la section suivante.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment pr√©venir la manifestation d'un probl√®me </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le cycle de vie du d√©veloppement logiciel peut √™tre repr√©sent√© en trois √©tapes: conception, impl√©mentation et test. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chacune des √©tapes doit √™tre d√©velopp√©e comme suit:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">au stade de la conception, d√©finir de mani√®re d√©clarative les contrats;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lors de la mise en ≈ìuvre, nous g√©n√©rons le code serveur et client sous contrat;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lors des tests, nous v√©rifions les contrats et essayons de prendre en compte les besoins des clients (CDC).</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chacune des √©tapes est expliqu√©e plus loin comme un exemple de notre probl√®me.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A quoi ressemble le probl√®me avec nous</font></font></h3><br>
<img src="https://habrastorage.org/webt/ws/qh/3j/wsqh3j_vzqriz0hufhvw5k4j_1i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voil√† √† quoi ressemble notre √©cosyst√®me. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les cercles sont des services et les fl√®ches sont des canaux de communication entre eux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Frontend est une application cliente bas√©e sur le Web. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La plupart des fl√®ches m√®nent au service de stockage. Il stocke des documents. C'est le service le plus important. Apr√®s tout, notre produit est un syst√®me de gestion √©lectronique de documents. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si ce service modifie ses contrats, le syst√®me cessera imm√©diatement de fonctionner. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4t/mx/xx/4tmxxxgjb3e888bmekaqofdxhq8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les sources de notre syst√®me sont principalement √©crites en c #, mais il existe √©galement des services en Go et en Python. Dans ce contexte, peu importe ce que font les autres services de la figure. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rt/qw/pu/rtqwpuk7eea5fyotxyspnctk2iq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chaque service a sa propre impl√©mentation client pour travailler avec le service de stockage. Lors de la modification des contrats, vous devez mettre √† jour manuellement le code dans chaque projet.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je voudrais m'√©loigner de la mise √† jour manuelle vers automatique. </font><font style="vertical-align: inherit;">Cela aidera √† augmenter la vitesse √† laquelle le code client change et √† r√©duire les erreurs. </font><font style="vertical-align: inherit;">Les erreurs sont des fautes de frappe dans l'URL, des erreurs dues √† la n√©gligence, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, cette approche ne corrige pas les erreurs dans la logique m√©tier du client. </font><font style="vertical-align: inherit;">Vous ne pouvez l'ajuster que manuellement.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Du probl√®me √† la t√¢che</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans notre cas, il est n√©cessaire d'impl√©menter </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la g√©n√©ration automatique de code client. </font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce faisant, les √©l√©ments suivants doivent √™tre pris en consid√©ration:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√¥t√© serveur - les contr√¥leurs sont d√©j√† √©crits;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le navigateur est client du service;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les services communiquent via HTTP.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la g√©n√©ration doit √™tre r√©gl√©e. </font><font style="vertical-align: inherit;">Par exemple, pour prendre en charge JWT.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Des questions</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au cours de la r√©solution du probl√®me, des questions se sont pos√©es:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quel outil choisir;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comment obtenir des contrats;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o√π placer les contrats;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o√π placer le code client;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√† quel moment faire la g√©n√©ration.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici les r√©ponses √† ces questions.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quel outil choisir</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les outils pour travailler avec les contrats sont pr√©sent√©s dans deux directions - RPC et REST. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wy/3e/3k/wy3e3k54sqffxjda4tvynid6rcy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RPC peut √™tre compris comme un simple appel distant, tandis que REST requiert des conditions suppl√©mentaires pour les verbes HTTP et les URL.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les diff√©rences d'appels RPC et REST sont pr√©sent√©es ici.</font></font></b>
                        <div class="spoiler_text"><div class="scrollable-table"><table>
<tbody><tr>
<td colspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RPC - Appel de proc√©dure √† distance</font></font></td>
<td colspan="2">REST Representational State Transfer</td>
</tr>
<tr>
<td colspan="2">  </td>
<td colspan="2">, HTTP-  URL</td>
</tr>
<tr>
<td></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Restaurant</a>:8080/Orders/PlaceOrder</td>
<td>POST</td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Restaurant</a>:8080/Orders</td>
</tr>
<tr>
<td></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Restaurant</a>:8080/Orders/GetOrder?OrderNumber=1</td>
<td>GET</td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Restaurant</a>:8080/Orders/1</td>
</tr>
<tr>
<td></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Restaurant</a>:8080/Orders/UpdateOrder</td>
<td>PUT</td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Restaurant</a>:8080/Orders/1</td>
</tr>
</tbody></table></div><br>
</div>
                    </div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outils</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le tableau pr√©sente une comparaison des outils pour travailler avec REST et RPC.</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Propri√©t√©s</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Openapi</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wsdl</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âpargne</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gRPC</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un type</font></font></td>
<td colspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DU REPOS</font></font></td>
<td colspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rpc</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plate-forme</font></font></td>
<td colspan="4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ne d√©pend pas</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Langue</font></font></td>
<td colspan="4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ne d√©pend pas</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S√©quence de d√©veloppement *</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code d'abord, sp√©cification d'abord</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code d'abord, sp√©cification d'abord</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">spec first</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code d'abord, sp√©cification d'abord</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protocole de transport</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP / 1.1</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tout (REST n√©cessite HTTP)</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">poss√©der</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP / 2</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vue</font></font></td>
<td colspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sp√©cification</font></font></td>
<td colspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cadre </font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Commentaire</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seuil d'entr√©e bas, beaucoup de documentation</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redondance XML, SOAP, etc.</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seuil d'entr√©e √©lev√©, peu de documentation</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seuil d'entr√©e moyen, meilleure documentation</font></font></td>
</tr>
</tbody></table></div><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code d'abord</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - nous √©crivons d'abord la partie serveur, puis nous obtenons des contrats dessus. </font><font style="vertical-align: inherit;">C'est pratique lorsque le c√¥t√© serveur est d√©j√† √©crit. </font><font style="vertical-align: inherit;">Pas besoin de d√©crire manuellement les contrats. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spec first</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - nous d√©finissons d'abord les contrats, puis nous obtenons la partie client et la partie serveur. </font><font style="vertical-align: inherit;">C'est pratique au d√©but du d√©veloppement quand il n'y a pas encore de code. </font><font style="vertical-align: inherit;">
La </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sortie</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> WSDL ne convient pas en raison de sa redondance. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apache Thrift est trop exotique et difficile √† apprendre.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GRPC n√©cessite Net Core 3.0 et Net Standard 2.1. </font><font style="vertical-align: inherit;">Au moment de l'analyse, le Core 2.2 net et le Standard 2.0 net √©taient utilis√©s. </font><font style="vertical-align: inherit;">Il n'y a pas de support GRPC dans le navigateur pr√™t √† l'emploi, une solution suppl√©mentaire est requise. </font><font style="vertical-align: inherit;">GRPC utilise Protobuf et la s√©rialisation binaire HTTP / 2. </font><font style="vertical-align: inherit;">Pour cette raison, la gamme d'utilitaires pour tester les API telles que Postman, etc., se r√©duit. </font><font style="vertical-align: inherit;">Les tests de charge via certains JMeter peuvent n√©cessiter des efforts suppl√©mentaires. </font><font style="vertical-align: inherit;">Ne convient pas, le passage √† GRPC n√©cessite beaucoup de ressources. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenAPI ne n√©cessite pas de mises √† jour suppl√©mentaires. </font><font style="vertical-align: inherit;">Il captive une abondance d'outils qui prennent en charge le travail avec REST et cette sp√©cification. </font><font style="vertical-align: inherit;">Nous le s√©lectionnons.</font></font></b><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outils pour travailler avec OpenAPI</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le tableau pr√©sente une comparaison des outils pour travailler avec OpenAPI.</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outils</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">swashbuckle</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NSwag</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Openapitools</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Versions de sp√©cifications prises en charge</font></font></td>
<td colspan="3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peut g√©n√©rer des sp√©cifications au format OpenApi v2, v3</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prise en charge du code en premier</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il y a</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il y a</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Non</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Langues de serveur prises en charge</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Non</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C #</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beaucoup de</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Langues client prises en charge</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Non</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C #, TypeScript, AngularJS, Angular (v2 +), window.fetch API</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beaucoup de</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Param√®tres de g√©n√©ration</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Non</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il y a</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il y a</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vue</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Forfait Nuget</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paquet Nuget + utilitaire s√©par√©</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilitaire s√©par√©</font></font></td>
</tr>
</tbody></table></div><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La conclusion de</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Swashbuckle ne convient pas, car </font><font style="vertical-align: inherit;">vous permet d'obtenir uniquement la sp√©cification. </font><font style="vertical-align: inherit;">Pour g√©n√©rer du code client, vous devez utiliser une solution suppl√©mentaire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OpenApiTools est un outil int√©ressant avec un tas de param√®tres, mais il ne prend pas en charge le code en premier. </font><font style="vertical-align: inherit;">Son avantage est la possibilit√© de g√©n√©rer du code serveur dans de nombreuses langues. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NSwag est pratique car il s'agit d'un package Nuget. </font><font style="vertical-align: inherit;">Il est facile de se connecter lors de la construction d'un projet. </font><font style="vertical-align: inherit;">Prend en charge tout ce dont nous avons besoin: premi√®re approche du code et g√©n√©ration de code client en c #. </font><font style="vertical-align: inherit;">Nous le s√©lectionnons.</font></font></b><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O√π organiser les contrats. </font><font style="vertical-align: inherit;">Comment acc√©der aux services des contrats</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici des solutions pour organiser le stockage sous contrat. </font><font style="vertical-align: inherit;">Les solutions sont r√©pertori√©es par ordre croissant de complexit√©.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le dossier de projet du service fournisseur est l'option la plus simple. </font><font style="vertical-align: inherit;">Si vous devez ex√©cuter l'approche, choisissez-la.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un dossier partag√© est une option valide si les projets souhait√©s se trouvent dans le m√™me r√©f√©rentiel. </font><font style="vertical-align: inherit;">√Ä long terme, il sera difficile de maintenir l'int√©grit√© des contrats dans le dossier. </font><font style="vertical-align: inherit;">Cela peut n√©cessiter un outil suppl√©mentaire pour tenir compte des diff√©rentes versions des contrats, etc.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r√©f√©rentiel s√©par√© pour les sp√©cifications - si les projets se trouvent dans diff√©rents r√©f√©rentiels, les contrats doivent √™tre plac√©s dans un lieu public. </font><font style="vertical-align: inherit;">Les inconv√©nients sont les m√™mes que pour le dossier partag√©.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">via l'API de service (swagger.ui, swaggerhub) - un service distinct qui traite de la gestion des sp√©cifications.</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons d√©cid√© d'utiliser l'option la plus simple: stocker les contrats dans le dossier de projet du fournisseur de services. </font><font style="vertical-align: inherit;">Cela nous suffit √† ce stade, alors pourquoi payer plus?</font></font></b><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Ä quel moment g√©n√©rez-vous</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous devez maintenant d√©cider √† quel moment effectuer la g√©n√©ration de code. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si les contrats √©taient partag√©s, les services aux consommateurs pourraient recevoir les contrats et g√©n√©rer le code eux-m√™mes si n√©cessaire. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons d√©cid√© de placer les contrats dans le dossier avec le projet du prestataire de services. </font><font style="vertical-align: inherit;">Cela signifie que la g√©n√©ration peut √™tre effectu√©e apr√®s l'assemblage du projet de service fournisseur lui-m√™me.</font></font></b><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O√π placer le code client</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code client sera g√©n√©r√© par contrat. </font><font style="vertical-align: inherit;">Reste √† savoir o√π le placer. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il semble judicieux de placer le code client dans un projet StorageServiceClientProxy distinct. </font><font style="vertical-align: inherit;">Chaque projet pourra connecter cet assemblage. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avantages de cette solution:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le code client est proche de son service et est constamment √† jour;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les consommateurs peuvent utiliser le lien vers le projet dans un r√©f√©rentiel.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D√©savantages:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne fonctionnera pas si vous devez g√©n√©rer un client dans une autre partie du syst√®me, par exemple, un r√©f√©rentiel diff√©rent. </font><font style="vertical-align: inherit;">Il est r√©solu en utilisant au moins un dossier partag√© pour les contrats;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les consommateurs doivent √™tre r√©dig√©s dans la m√™me langue. </font><font style="vertical-align: inherit;">Si vous avez besoin d'un client dans une autre langue, vous devez utiliser OpenApiTools.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous fixons NSwag</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Attributs du contr√¥leur</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Besoin de dire √† NSwag comment g√©n√©rer les sp√©cifications correctes pour nos contr√¥leurs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour ce faire, vous devez organiser les attributs.</font></font><br>
<br>
<pre><code class="cs hljs">[<span class="hljs-meta">Microsoft.AspNetCore.Mvc.Routing.Route(<span class="hljs-meta-string">"[controller]"</span>)</span>]  <span class="hljs-comment">//  url</span>
[<span class="hljs-meta">Microsoft.AspNetCore.Mvc.ApiController</span>] <span class="hljs-comment">//     </span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DescriptionController</span> : <span class="hljs-title">ControllerBase</span> {<font></font>
[<span class="hljs-meta">NSwag.Annotations.OpenApiOperation(<span class="hljs-meta-string">"GetDescription"</span>)</span>] <span class="hljs-comment">//    </span>
[<span class="hljs-meta">Microsoft.AspNetCore.Mvc.ProducesResponseType(typeof(ConversionDescription), 200)</span>] <span class="hljs-comment">//    200  </span>
[<span class="hljs-meta">Microsoft.AspNetCore.Mvc.ProducesResponseType(401)</span>] <span class="hljs-comment">//    401</span>
[<span class="hljs-meta">Microsoft.AspNetCore.Mvc.ProducesResponseType(403)</span>] <span class="hljs-comment">//    403</span>
[<span class="hljs-meta">Microsoft.AspNetCore.Mvc.HttpGet(<span class="hljs-meta-string">"{pluginName}/{binaryDataId}"</span>)</span>] <span class="hljs-comment">//  url</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> ActionResult&lt;ConversionDescription&gt; <span class="hljs-title">GetDescription</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> pluginName, Guid binaryDataId</span>)</span> { 
 <span class="hljs-comment">// ... </span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par d√©faut, NSwag ne peut pas g√©n√©rer la sp√©cification correcte pour le type d'application / flux d'octets MIME. </font><font style="vertical-align: inherit;">Par exemple, cela peut se produire lors du transfert de fichiers. </font><font style="vertical-align: inherit;">Pour r√©soudre ce probl√®me, vous devez √©crire votre attribut et votre processeur pour cr√©er la sp√©cification.</font></font><br>
<br>
<pre><code class="cs hljs">[<span class="hljs-meta">Microsoft.AspNetCore.Mvc.Route(<span class="hljs-meta-string">"[controller]"</span>)</span>]<font></font>
[<span class="hljs-meta">Microsoft.AspNetCore.Mvc.ApiController</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">FileController</span> : <span class="hljs-title">ControllerBase</span> {<font></font>
[<span class="hljs-meta">NSwag.Annotations.OpenApiOperation(<span class="hljs-meta-string">"SaveFile"</span>)</span>]<font></font>
[<span class="hljs-meta">Microsoft.AspNetCore.Mvc.ProducesResponseType(401)</span>]<font></font>
[<span class="hljs-meta">Microsoft.AspNetCore.Mvc.ProducesResponseType(403)</span>]<font></font>
[<span class="hljs-meta">Microsoft.AspNetCore.Mvc.HttpPost(<span class="hljs-meta-string">"{pluginName}/{binaryDataId}/{fileName}"</span>)</span>]<font></font>
[<span class="hljs-meta">OurNamespace.FileUploadOperation</span>] <span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">SaveFile</span>(<span class="hljs-params"></span>)</span> { <span class="hljs-comment">// ... }</span>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Processeur pour g√©n√©rer des sp√©cifications pour les op√©rations sur les fichiers</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'id√©e est que vous pouvez √©crire votre attribut et votre processeur pour g√©rer cet attribut. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous suspendons l'attribut au contr√¥leur et lorsque NSwag le rencontre, il le traite √† l'aide de notre processeur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour impl√©menter cela, NSwag fournit les classes OpenApiOperationProcessorAttribute et IOperationProcessor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans notre projet, nous avons fait nos h√©ritiers:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FileUploadOperationAttribute: OpenApiOperationProcessorAttribute</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FileUploadOperationProcessor: IOperationProcessor</font></font></li>
</ul><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En savoir plus sur l'utilisation des processeurs ici.</font></font></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuration de NSwag pour la g√©n√©ration de sp√©cifications et de code</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la config 3 sections principales:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">runtime - Sp√©cifie le runtime .net. </font><font style="vertical-align: inherit;">Par exemple, NetCore22;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documentGenerator - d√©crit comment g√©n√©rer une sp√©cification;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">codeGenerators - d√©finit comment g√©n√©rer du code selon la sp√©cification.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NSwag contient un tas de param√®tres, ce qui pr√™te √† confusion au d√©but. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour plus de commodit√©, vous pouvez utiliser NSwag Studio. </font><font style="vertical-align: inherit;">En l'utilisant, vous pouvez voir en temps r√©el comment divers param√®tres affectent le r√©sultat de la g√©n√©ration de code ou des sp√©cifications. </font><font style="vertical-align: inherit;">Apr√®s cela, s√©lectionnez manuellement les param√®tres s√©lectionn√©s dans le fichier de configuration. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En savoir plus sur les param√®tres de configuration ici</font></font></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous g√©n√©rons la sp√©cification et le code client lors de l'assemblage du projet du prestataire</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour qu'apr√®s l'assemblage du projet de fournisseur de services, la sp√©cification et le code soient g√©n√©r√©s, proc√©dez comme suit:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons cr√©√© un projet WebApi pour le client.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons √©crit une configuration pour Nswag CLI - Nswag.json (d√©crite dans la section pr√©c√©dente).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons √©crit une cible PostBuild dans le projet de fournisseur de services csproj.</font></font></li>
</ol><br>
<code>&lt;Target Name="GenerateWebApiProxyClient‚Äú AfterTargets="PostBuildEvent"&gt;<br>
&lt;Exec Command="$(NSwagExe_Core22) run nswag.json‚Äù/&gt;<br>
</code><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ (NSwagExe_Core22) run nswag.json - ex√©cutez l'utilitaire NSwag sous .bet runtine netCore 2.2 avec la configuration nswag.json </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Target fait ce qui suit:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NSwag g√©n√®re une sp√©cification √† partir d'un assembly de service fournisseur.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NSwag g√©n√®re du code client selon les sp√©cifications.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s chaque assemblage du projet de fournisseur de services, le projet client est mis √† jour. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le projet du client et du prestataire de services sont dans la m√™me solution. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'assemblage a lieu dans le cadre de la solution. </font><font style="vertical-align: inherit;">La solution est configur√©e pour que le projet du client soit assembl√© apr√®s le projet de service du fournisseur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NSwag vous permet √©galement de personnaliser imp√©rativement la g√©n√©ration de sp√©cifications / code via l'API logicielle.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment ajouter la prise en charge de JWT</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous devons prot√©ger notre service contre les demandes non autoris√©es. </font><font style="vertical-align: inherit;">Pour cela, nous utiliserons des jetons JWT. </font><font style="vertical-align: inherit;">Ils doivent √™tre envoy√©s dans les en-t√™tes de chaque demande HTTP afin que le fournisseur de services puisse les v√©rifier et d√©cider de r√©pondre ou non √† la demande. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plus d' </font><font style="vertical-align: inherit;">informations sur JWT ici </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jwt.io</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La t√¢che se r√©sume √† la n√©cessit√© de modifier les en-t√™tes de la requ√™te HTTP sortante. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour ce faire, le g√©n√©rateur de code NSwag peut g√©n√©rer un point d'extension - la m√©thode CreateHttpRequestMessageAsync. </font><font style="vertical-align: inherit;">A l'int√©rieur de cette m√©thode, il y a acc√®s √† la requ√™te HTTP avant son envoi.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemple de code</font></font></b>
                        <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> Task&lt;HttpRequestMessage&gt; <span class="hljs-title">CreateHttpRequestMessageAsync</span>(<span class="hljs-params">CancellationToken cancellationToken</span>)</span> {
      <span class="hljs-keyword">var</span> message = <span class="hljs-keyword">new</span> HttpRequestMessage();<font></font>
<font></font>
      <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">string</span>.IsNullOrWhiteSpace(<span class="hljs-keyword">this</span>.AuthorizationToken)) {<font></font>
        message.Headers.Authorization =<font></font>
          <span class="hljs-keyword">new</span> System.Net.Http.Headers.AuthenticationHeaderValue(BearerScheme, <span class="hljs-keyword">this</span>.AuthorizationToken);<font></font>
      }<font></font>
<font></font>
      <span class="hljs-keyword">return</span> Task.FromResult(message);<font></font>
    }<font></font>
</code></pre><br>
</div>
                    </div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons choisi l'option avec OpenAPI, car </font><font style="vertical-align: inherit;">Il est facile √† mettre en ≈ìuvre et les outils pour travailler avec cette sp√©cification sont tr√®s d√©velopp√©s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Conclusions sur OpenAPI et GRPC: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenAPI</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la sp√©cification est d√©taill√©e;</font></font></li>
<li>          ,  ;</li>
<li>     ;</li>
<li>    .</li>
</ul><br>
<b>GRPC</b><br>
<br>
<ul>
<li>  ,      URL, HTTP  ..;</li>
<li>      OpenAPI;</li>
<li>    ;</li>
<li>           ;</li>
<li>     HTTP/2.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, nous avons re√ßu une sp√©cification bas√©e sur le code d√©j√† √©crit des contr√¥leurs. </font><font style="vertical-align: inherit;">Pour ce faire, il fallait accrocher des attributs sp√©ciaux sur les contr√¥leurs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, sur la base des sp√©cifications re√ßues, nous avons impl√©ment√© la g√©n√©ration de code client. </font><font style="vertical-align: inherit;">Maintenant, nous n'avons pas besoin de mettre √† jour manuellement le code client. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Des √©tudes ont √©t√© men√©es dans le domaine des contrats de version et de test. </font><font style="vertical-align: inherit;">Cependant, il n'a pas √©t√© possible de tester le tout dans la pratique en raison du manque de ressources.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gestion des versions des contrats publics</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourquoi versionner les march√©s publics?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s des changements de fournisseurs de services, l'ensemble du syst√®me doit rester dans un √©tat op√©rationnel coh√©rent. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les changements de rupture dans l'API publique doivent √™tre √©vit√©s afin de ne pas casser les clients.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Options de solution</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sans versionner les march√©s publics</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'√©quipe du fournisseur de services fixe elle-m√™me les services aux consommateurs. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/f0/k3/_6/f0k3_6ed1gt10sz1k5ol2brrj80.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette approche ne fonctionnera pas si l'√©quipe du fournisseur de services n'a pas acc√®s aux r√©f√©rentiels de services aux consommateurs ou manque de comp√©tences. </font><font style="vertical-align: inherit;">S'il n'y a pas de tels probl√®mes, vous pouvez vous passer de la gestion des versions.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-8/dd/ri/-8ddri4wch4oiugyd2bvz28zvzk.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utiliser le versioning des march√©s publics</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'√©quipe du prestataire de services quitte la version pr√©c√©dente des contrats. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-v/xg/e9/-vxge9yyrzws2i3lbm5b6rrvbyq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette approche ne pr√©sente pas les inconv√©nients de la pr√©c√©dente, mais ajoute d'autres difficult√©s. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous devez d√©cider des √©l√©ments suivants:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quel outil utiliser;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quand introduire une nouvelle version;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">combien de temps pour conserver les anciennes versions.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quel outil utiliser</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le tableau pr√©sente les fonctionnalit√©s d'OpeanAPI et de GRPC associ√©es au contr√¥le de version.</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gRPC</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Openapi</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Attribut de version</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Au niveau du protobuf, il existe un package d'attributs [packageName]. [Version]</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Au niveau de la sp√©cification, il existe des attributs basePath (pour URL) et Version</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Attribut d√©conseill√© pour les m√©thodes</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oui, mais non pris en compte par le g√©n√©rateur de code sous C #</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oui, il est marqu√© comme obsol√®te </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
. NSwag n'est pas pris en charge avec le code d'abord, vous devez √©crire votre processeur</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Attribut d√©conseill√© pour les param√®tres</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Est marqu√© comme obsol√®te</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oui, il est marqu√© comme obsol√®te </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
. NSwag n'est pas pris en charge avec le code d'abord, vous devez √©crire votre processeur</font></font><br>
</td>
</tr>
</tbody></table></div><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obsol√®te</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> signifie que cette API ne vaut plus la peine d'√™tre utilis√©e. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les deux outils prennent en charge la version et les attributs obsol√®tes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous utilisez OpenAPI et la premi√®re approche du code, vous devez √† nouveau √©crire des processeurs pour cr√©er la bonne sp√©cification.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quand introduire une nouvelle version</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La nouvelle version doit √™tre introduite lorsque les modifications des contrats ne pr√©servent pas la compatibilit√© descendante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment v√©rifier que les modifications violent la compatibilit√© entre la nouvelle et l'ancienne version des contrats?</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour OpenAPI, il existe un outil Azure opeanapi-diff pour v√©rifier la compatibilit√© entre 2 sp√©cifications </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/Azure/openapi-diff;</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aucun outil automatique n'a √©t√© trouv√© pour gRPC, il n'y a que des politiques de version; </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">general </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/grpc/grpc/blob/master/doc/versioning.md;</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sous .Net </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docs.microsoft.com/en-us/aspnet/core/grpc/versioning?view=aspnetcore-3.1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Combien de temps pour maintenir les versions</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il n'y a pas de bonne r√©ponse √† cette question. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour supprimer la prise en charge de l'ancienne version, vous devez savoir qui utilise votre service. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce sera mauvais si la version est supprim√©e et que quelqu'un d'autre l'utilise. </font><font style="vertical-align: inherit;">C'est particuli√®rement difficile si vous ne contr√¥lez pas vos clients. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alors, que peut-on faire dans cette situation?</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">informer les clients que l'ancienne version ne sera plus prise en charge. </font><font style="vertical-align: inherit;">Dans ce cas, nous pouvons perdre le revenu de nos clients;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prendre en charge l'ensemble des versions. </font><font style="vertical-align: inherit;">Le co√ªt du support logiciel augmente;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour r√©pondre √† cette question, vous devez vous poser la question suivante: les revenus des anciens clients d√©passent-ils le co√ªt de prise en charge des anciennes versions de logiciels? </font><font style="vertical-align: inherit;">Serait-il plus rentable de demander aux clients de mettre √† niveau?</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le seul conseil dans cette situation est d'accorder plus d'attention aux march√©s publics afin de r√©duire la fr√©quence de leurs √©volutions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si les march√©s publics sont utilis√©s dans un syst√®me ferm√©, vous pouvez utiliser l'approche CDC. </font><font style="vertical-align: inherit;">Nous pouvons donc savoir quand les clients ont cess√© d'utiliser les anciennes versions du logiciel. </font><font style="vertical-align: inherit;">Apr√®s cela, vous pouvez supprimer le support de l'ancienne version.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N'utilisez le contr√¥le de version que si vous ne pouvez pas vous en passer. </font><font style="vertical-align: inherit;">Si vous d√©cidez d'utiliser la gestion des versions, lors de la conception des contrats, pensez √† la compatibilit√© des versions. </font><font style="vertical-align: inherit;">Un √©quilibre doit √™tre trouv√© entre le co√ªt de la prise en charge des anciennes versions et les avantages qu'il offre. </font><font style="vertical-align: inherit;">Il convient √©galement de d√©cider quand vous pouvez arr√™ter de prendre en charge l'ancienne version.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contrats de test et CDC</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette section est illumin√©e superficiellement, comme </font><font style="vertical-align: inherit;">Il n'y a pas de conditions pr√©alables s√©rieuses pour la mise en ≈ìuvre de cette approche.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contrats ax√©s sur le consommateur (CDC)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CDC est la r√©ponse √† la question de savoir comment s'assurer que le fournisseur et le consommateur utilisent les m√™mes contrats. </font><font style="vertical-align: inherit;">Il s'agit d'une sorte de tests d'int√©gration visant √† v√©rifier les contrats. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'id√©e est la suivante:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le consommateur d√©crit le contrat.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le fournisseur ex√©cute ce contrat √† domicile.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce contrat est utilis√© dans le processus CI chez le consommateur et le fournisseur. </font><font style="vertical-align: inherit;">Si le processus est viol√©, alors quelqu'un a cess√© de se conformer au contrat.</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pacte</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PACT est un outil qui met en ≈ìuvre cette id√©e.</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le consommateur √©crit des tests √† l'aide de la biblioth√®que PACT.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ces tests sont convertis en fichier d'artefact-pacte. </font><font style="vertical-align: inherit;">Il contient des informations sur les contrats.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le fournisseur et le consommateur utilisent le fichier pacte pour ex√©cuter les tests.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendant les tests client, un stub fournisseur est cr√©√© et pendant les tests fournisseur, un stub client est cr√©√©. </font><font style="vertical-align: inherit;">Ces deux talons utilisent un fichier pacte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un comportement de cr√©ation de stub similaire peut √™tre obtenu via le Swagger Mock Validator </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bitbucket.org/atlassian/swagger-mock-validator/src/master</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liens utiles sur Pacte</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pact Broker - Solution de gestion de fichiers </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pact docs.pact.io/pact_broker</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pact ne prend pas encore en charge GRPC. </font><font style="vertical-align: inherit;">En savoir plus sur la feuille de route Pact </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pact.canny.io</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plus d' </font><font style="vertical-align: inherit;">informations sur PACT sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docs.pact.io</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourquoi utiliser PACT </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docs.pact.io/faq/convinceme</font></font></a></li>
</ul><br>
<img src="https://habrastorage.org/webt/0u/qv/-f/0uqv-fhceairtmtcfyv6fy9b-xg.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment CDC peut √™tre int√©gr√© dans CI</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©ployer Pact + Pact Broker vous-m√™me;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">acheter une solution Pact Flow SaaS pr√™te √† l'emploi.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un pacte est n√©cessaire pour garantir la conformit√© du contrat. </font><font style="vertical-align: inherit;">Il montrera quand les changements dans les contrats violent les attentes des services aux consommateurs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cet outil convient lorsque le fournisseur s'adapte au client - le client. </font><font style="vertical-align: inherit;">Cela n'est possible qu'√† l'int√©rieur d'un syst√®me isol√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous rendez service au monde ext√©rieur et que vous ne savez pas qui sont vos clients, alors Pact n'est pas pour vous.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr502636/index.html">Business et cyberpunk: m√©langer, maintenir, utiliser</a></li>
<li><a href="../fr502638/index.html">Comment d√©velopper un blog sur Instagram en 2020: analyse du cas de Sasha Mitroshina</a></li>
<li><a href="../fr502642/index.html">Mettre le jeu "Snake" sur la planche √† pain. Partie 2: affichage ¬´vectoriel¬ª</a></li>
<li><a href="../fr502644/index.html">Comment Sherpaa a transmis ses attentes irr√©alistes en mati√®re de capital-risque</a></li>
<li><a href="../fr502648/index.html">10 id√©es fausses sur le portage de Hadoop dans le cloud</a></li>
<li><a href="../fr502654/index.html">Jack Ma a beaucoup d'erreurs en anglais, mais ses comp√©tences orales sont plus √©lev√©es que la plupart des √©tudiants. Pourquoi donc?</a></li>
<li><a href="../fr502656/index.html">Microminiaturisation: semi-conducteur magn√©tique √† deux atomes</a></li>
<li><a href="../fr502660/index.html">Comment traduire "participation" / "participants" sans partie / participer</a></li>
<li><a href="../fr502662/index.html">Vie quotidienne "alchimiste"</a></li>
<li><a href="../fr502666/index.html">Assemblage 486 - s√©lection des composants</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>