<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏽‍🤝‍👨🏼 👆🏻 ♐️ Ennemi AI: pourchasser un joueur sans Navigation2D et trouver le chemin A * 🤦🏿 🤙🏾 🤱🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Créer un jeu dans lequel les ennemis doivent chasser un joueur? Tout commence par un simple - nous faisons courir l'ennemi vers le joueur. Mais que se...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Ennemi AI: pourchasser un joueur sans Navigation2D et trouver le chemin A *</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/496878/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Créer un jeu dans lequel les ennemis doivent chasser un joueur? </font><font style="vertical-align: inherit;">Tout commence par un simple - nous faisons courir l'ennemi vers le joueur. </font><font style="vertical-align: inherit;">Mais que se passe-t-il s'il se trouve derrière un arbre ou au coin d'un mur? </font><font style="vertical-align: inherit;">Eh bien, maintenant l'ennemi aura l'air assez stupide - il rencontrera un objet, se doigtera en place. </font><font style="vertical-align: inherit;">Pas très bien! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour résoudre ce problème, vous pouvez utiliser les nœuds Navigation2D ou AStar intégrés à Godot ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voici le tutoriel GDQuest sur les deux nœuds</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Mais dans </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Helms of Fury,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous avons utilisé une méthode différente qui fonctionnait très bien pour notre jeu, et nous voulons la partager dans ce tutoriel. </font><font style="vertical-align: inherit;">Voici à quoi ça ressemble:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/2d/ub/ss/2dubss3iyd2rns37pn9pzrjjybk.gif"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se rendre au travail</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous supposons que vous créez des ennemis en tant qu'objets KinematicBody2D et utilisez une machine à états pour contrôler leurs états. </font><font style="vertical-align: inherit;">Vous ne savez pas ce qu'est une machine d'état? </font><font style="vertical-align: inherit;">J'aime </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cet article expliquant les machines à états</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et comment les utiliser. </font><font style="vertical-align: inherit;">Voici un autre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">article sur l'implémentation de machines à états simples dans Godot</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Commençons par un simple état Chase pour un ennemi stupide qui court vers sa cible et se retrouve coincé quelque part en cours de route:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># ChaseState.gd</span><font></font>
<font></font>
func _init(enemy, params):<font></font>
  enemy.dir = (enemy.target.position - enemy.position).normalized()<font></font>
<font></font>
func _physics_process(delta):<font></font>
  var motion = enemy.dir * enemy.speed<font></font>
  enemy.move_and_slide(motion)</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Traces d'odeur</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour améliorer l'état, nous obligerons le joueur à laisser une trace de ses positions précédentes lors de son déplacement. </font><font style="vertical-align: inherit;">Grâce à cela, lorsque l'ennemi ne voit pas le joueur, il vérifiera si l'une de ses positions passées peut être vue, puis les suivra jusqu'au joueur. </font><font style="vertical-align: inherit;">Comme cela est similaire à la façon dont un chien prend une empreinte, nous l'appellerons une empreinte d'odeur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour que la trace de l'odeur fonctionne, nous devons ajouter le nœud Timer au lecteur, lui permettre de démarrer automatiquement et de définir wait_time (nous avons utilisé 0,1 s), puis d'ajouter le code afin que le joueur laisse une odeur à la fin du compte à rebours.</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># Player.gd</span><font></font>
extends KinematicBody2D<font></font>
<font></font>
const scent_scene = preload(<span class="hljs-string">"res://Player/Scent.tscn"</span>)<font></font>
<font></font>
var scent_trail = []<font></font>
<font></font>
func _ready():<font></font>
  $ScentTimer.connect(<span class="hljs-string">"timeout"</span>, self, <span class="hljs-string">"add_scent"</span>)<font></font>
<font></font>
func add_scent():<font></font>
  var scent      = scent_scene.instance()<font></font>
  scent.player   = player<font></font>
  scent.position = player.position<font></font>
<font></font>
  Game.level.effects.add_child(scent)<font></font>
  scent_trail.push_front(scent)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, vous devez ajouter le Scent.tscn abandonné lui-même. </font><font style="vertical-align: inherit;">Il s'agit d'une simple scène Node2D contenant une minuterie afin que l'odeur expire.</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># Player.gd</span><font></font>
extends KinematicBody2D<font></font>
<font></font>
const scent_scene = preload(<span class="hljs-string">"res://Player/Scent.tscn"</span>)<font></font>
<font></font>
var scent_trail = []<font></font>
<font></font>
func _ready():<font></font>
  $ScentTimer.connect(<span class="hljs-string">"timeout"</span>, self, <span class="hljs-string">"add_scent"</span>)<font></font>
<font></font>
func add_scent():<font></font>
  var scent      = scent_scene.instance()<font></font>
  scent.player   = player<font></font>
  scent.position = player.position<font></font>
<font></font>
  Game.level.effects.add_child(scent)<font></font>
  scent_trail.push_front(scent)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous souhaitez que les odeurs soient visibles pendant le débogage, vous pouvez leur ajouter un nœud ColorRect, puis le masquer. </font><font style="vertical-align: inherit;">Cela fait, vous verrez qu'en courant après le joueur, il y a une trace d'odeur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, nous devons réveiller les ennemis des limiers internes afin qu'ils suivent ces nouvelles odeurs lorsqu'ils ne voient pas le joueur. </font><font style="vertical-align: inherit;">Mais pour cela, nous devons ajouter des nœuds RayCast2D aux ennemis et configurer des couches physiques dans Godot afin que le faisceau sache avec quoi il peut faire des collisions.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Couches de physique</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour configurer les couches physiques dans Godot, vous devez cliquer sur Projet dans le menu supérieur puis sur Paramètres du projet, puis allez dans la section Noms des couches dans le coin inférieur gauche, puis sélectionnez Physique 2D.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://s3.amazonaws.com/manakeep/users/58991d6d3c545a24383fe280/2020-04-06/physics_layers.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donnez-leur un nom approprié. </font><font style="vertical-align: inherit;">Après cela, accédez aux objets du jeu et développez Collision dans la barre latérale de l'inspecteur des propriétés, puis cliquez sur ·· pour les affecter. </font><font style="vertical-align: inherit;">Pour les objets, ils doivent être affectés en tant que couches.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://s3.amazonaws.com/manakeep/users/58991d6d3c545a24383fe280/2020-04-06/picking_physics_layers.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir affecté les couches physiques aux objets, vous devez modifier le RayCast2D des ennemis afin qu'il vérifie les couches à travers lesquelles les ennemis ne peuvent pas se déplacer (dans notre cas, il s'agit de solide, objet, caisse, trou, gate_closed). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir configuré les couches physiques, la dernière étape consiste à modifier l'état de la poursuite.</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># ChaseState.gd</span><font></font>
<font></font>
func _init(enemy, params):<font></font>
  chase_target()<font></font>
<font></font>
func chase_target():<font></font>
  var look     = enemy.get_node(<span class="hljs-string">"RayCast2D"</span>)<font></font>
  look.cast_to = (enemy.target.position - enemy.position)<font></font>
  look.force_raycast_update()<font></font>
<font></font>
  <span class="hljs-comment"># if we can see the target, chase it</span>
  <span class="hljs-keyword">if</span> !look.is_colliding():<font></font>
    enemy.dir = look.cast_to.normalized()<font></font>
<font></font>
  <span class="hljs-comment"># or chase first scent we can see</span>
  <span class="hljs-keyword">else</span>:
    <span class="hljs-keyword">for</span> scent <span class="hljs-keyword">in</span> enemy.target.scent_trail:<font></font>
      look.cast_to = (scent.position - enemy.position)<font></font>
      look.force_raycast_update()<font></font>
<font></font>
      <span class="hljs-keyword">if</span> !look.is_colliding():<font></font>
        enemy.dir = look.cast_to.normalized()<font></font>
        <span class="hljs-keyword">break</span><font></font>
<font></font>
func _physics_process(delta):<font></font>
  var motion = enemy.dir * enemy.speed<font></font>
  enemy.move_and_slide(motion)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, lorsque l'ennemi entre dans l'état Chase, il commence à essayer de relancer le joueur, et s'il n'y a rien sur son chemin, il le suivra! </font><font style="vertical-align: inherit;">S'il y a quelque chose sur le chemin, alors il va aux traces de l'odorat et essaie de refondre chacun d'eux jusqu'à ce qu'il en trouve un, puis - le poursuit!</font></font><br>
<br>
<div style="text-align:center;"><img src="https://s3.amazonaws.com/manakeep/users/58991d6d3c545a24383fe280/2020-04-06/twitter-700x400.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et maintenant tout fonctionne, les ennemis se sont transformés en limiers. </font><font style="vertical-align: inherit;">Pour améliorer le système, il est possible de mettre en place un système permettant d'éviter les collisions entre ennemis, mais c'est un sujet pour un article séparé.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr496868/index.html">Small Space Symphony</a></li>
<li><a href="../fr496870/index.html">Programmation déclarative Android d'applications client-serveur</a></li>
<li><a href="../fr496872/index.html">Nouveau tissu Hyperledger: modèle de logiciel Go SDK</a></li>
<li><a href="../fr496874/index.html">Nous étudions le moteur VoIP Mediastreamer2. Partie 9</a></li>
<li><a href="../fr496876/index.html">Le condensé de matières fraîches du monde du front-end de la dernière semaine n ° 410 (6-12 avril 2020)</a></li>
<li><a href="../fr496880/index.html">VDI Skala-R BPM. Qu'est-ce que c'est et d'où vient-il</a></li>
<li><a href="../fr496882/index.html">Comment commencer à utiliser USB Type-C dans vos conceptions</a></li>
<li><a href="../fr496884/index.html">Théorie des «g-groups»</a></li>
<li><a href="../fr496886/index.html">Elon Musk a révélé le but de la caméra sur le rétroviseur de Tesla Model 3</a></li>
<li><a href="../fr496888/index.html">Une startup utilise l'IA pour rechercher des molécules qui aideront à combattre le coronavirus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>