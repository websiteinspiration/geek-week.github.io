<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚Ü™Ô∏è üë®üèº‚Äçü§ù‚Äçüë®üèª üìô HighLoad ++, Mikhail Makurov, Maxim Chernetsov (Intersvyaz): Zabbix, 100kNVPS en un servidor üëßüèª üôãüèø üë©‚Äçüë¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La pr√≥xima conferencia HighLoad ++ se llevar√° a cabo los d√≠as 6 y 7 de abril de 2020 en San Petersburgo. Detalles y entradas aqu√≠ . HighLoad ++ Mosc√∫ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>HighLoad ++, Mikhail Makurov, Maxim Chernetsov (Intersvyaz): Zabbix, 100kNVPS en un servidor</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/486540/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La pr√≥xima conferencia HighLoad ++ se llevar√° a cabo los d√≠as 6 y 7 de abril de 2020 en San Petersburgo. Detalles y entradas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . HighLoad ++ Mosc√∫ 2018. Sal√≥n de Mosc√∫. 9 de noviembre, 3 p.m. Res√∫menes y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">presentaci√≥n</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sa/dm/mu/sadmmupp8vt5l5vl5obukgut36a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Monitoreo - en l√≠nea y an√°lisis. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Las principales limitaciones de la plataforma ZABBIX. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Soluci√≥n para escalar el almacenamiento de an√°lisis. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Optimizaci√≥n del servidor ZABBIX. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Optimizaci√≥n de la interfaz de usuario. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Experiencia en la operaci√≥n del sistema con cargas de m√°s de 40k NVPS. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Brevemente conclusiones.</font></font><a name="habracut"></a><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Makurov (en adelante - MM):</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ¬°Hola a todos! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maxim Chernetsov (en adelante - MCH):</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ¬°Buenas tardes! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Perm√≠tanme presentarles a Maxim. Max es un ingeniero talentoso, el mejor networker que conozco. Maxim trata con redes y servicios, su desarrollo y operaci√≥n. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uj/pn/q6/ujpnq61idhrrwq2dszdhb3hxjza.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Y me gustar√≠a hablar sobre Michael. Michael es un desarrollador C. Escribi√≥ algunas soluciones de procesamiento de tr√°fico altamente cargadas para nuestra empresa. Vivimos y trabajamos en los Urales, en la ciudad de campesinos severos de Chelyabinsk, en la compa√±√≠a Intersvyaz. Nuestra empresa es proveedora de servicios de Internet y televisi√≥n por cable para un mill√≥n de personas en 16 ciudades. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Y vale la pena decir que Intersvyaz es mucho m√°s que un simple proveedor, es una empresa de TI. </font><font style="vertical-align: inherit;">La mayor√≠a de nuestras decisiones las toma nuestro departamento de TI. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> desde servidores que procesan tr√°fico, hasta el centro de llamadas y la aplicaci√≥n m√≥vil. </font><font style="vertical-align: inherit;">Hay alrededor de 80 personas en el departamento de TI con competencias muy, muy diversas.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sobre Zabbix y su arquitectura</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Y ahora intentar√© establecer un r√©cord personal y decir en un minuto qu√© es Zabbix (en adelante - "Zabbiks"). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zabbix se posiciona como un sistema de monitoreo "listo para usar" a nivel empresarial. </font><font style="vertical-align: inherit;">Tiene muchas caracter√≠sticas que simplifican la vida: reglas avanzadas de escalaci√≥n, API para integraci√≥n, agrupaci√≥n y detecci√≥n autom√°tica de hosts y m√©tricas. </font><font style="vertical-align: inherit;">En Zabbix hay las llamadas herramientas de escalado: proxies. </font><font style="vertical-align: inherit;">Zabbix es un sistema de c√≥digo abierto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Brevemente sobre arquitectura. </font><font style="vertical-align: inherit;">Podemos decir que consta de tres componentes:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/oc/fn/xv/ocfnxvdx0gy8qi4055lipyifl1q.jpeg"><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Servidor. </font><font style="vertical-align: inherit;">Est√° escrito en C. </font><font style="vertical-align: inherit;">Con un procesamiento bastante complicado y la transmisi√≥n de informaci√≥n entre flujos. </font><font style="vertical-align: inherit;">Todo el procesamiento tiene lugar en √©l: desde recibir hasta guardar en la base de datos.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todos los datos se almacenan en la base de datos. </font><font style="vertical-align: inherit;">Zabbix es compatible con MySQL, PostreSQL y Oracle.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La interfaz web est√° escrita en PHP. </font><font style="vertical-align: inherit;">En la mayor√≠a de los sistemas, viene con un servidor Apache, pero funciona de manera m√°s eficiente en el paquete nginx + php.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hoy nos gustar√≠a contar de la vida de nuestra empresa una historia relacionada con Zabbix ...</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Historia de vida de la empresa Intersvyaz. </font><font style="vertical-align: inherit;">¬øQu√© tenemos y qu√© se necesita?</font></font></h3><br>
<img src="https://habrastorage.org/webt/d2/cr/rk/d2crrkodjpn2arv0aojibu6vsq4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hace 5 o 6 meses. Una vez despu√©s del trabajo ... </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ¬°Misha, hola! Me alegro de que pude atraparte, hay una conversaci√≥n. Nuevamente tuvimos problemas con el monitoreo. Durante un accidente grave, todo se ralentiz√≥ y no hubo informaci√≥n sobre el estado de la red. Lamentablemente, esta no es la primera vez que se repite. Necesito tu ayuda. ¬°Hagamos que nuestro monitoreo funcione bajo cualquier circunstancia! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Pero sincronicemos primero. No he buscado all√≠ por un par de a√±os. Hasta donde recuerdo, rechazamos a Nagios y nos cambiamos a Zabbix hace 8 a√±os. Y ahora parece que tenemos 6 servidores potentes y alrededor de una docena de servidores proxy. ¬øEstoy confundiendo algo? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Casi. 15 servidores, algunos de los cuales son m√°quinas virtuales. Lo m√°s importante, esto no nos salva en el momento en que m√°s lo necesitamos. Como un accidente: los servidores se est√°n ralentizando y no se ve nada. Intentamos optimizar la configuraci√≥n, pero esto no proporciona la ganancia de rendimiento √≥ptima. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ya veo. ¬øBuscaste algo, cavaste algo del diagn√≥stico? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Lo primero con lo que tiene que lidiar es solo la base de datos. </font><font style="vertical-align: inherit;">MySQL se carga constantemente, preservando nuevas m√©tricas, y cuando Zabbix comienza a generar un mont√≥n de eventos, la base de datos entra literalmente en s√≠ misma durante varias horas. </font><font style="vertical-align: inherit;">Ya le cont√© sobre la optimizaci√≥n de la configuraci√≥n, pero literalmente este a√±o actualizamos el hardware: hay m√°s de cien gigabytes de memoria en los servidores y las matrices de discos en SSD RAID-ahs; no tiene sentido crecer linealmente. </font><font style="vertical-align: inherit;">qu√© hacemos? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ya veo. </font><font style="vertical-align: inherit;">En general, MySQL es una base de datos LTP. </font><font style="vertical-align: inherit;">Aparentemente, ya no es adecuado para almacenar un archivo de m√©tricas de nuestro tama√±o. </font><font style="vertical-align: inherit;">Vamos a resolverlo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH: ¬°</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vamos!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La integraci√≥n de Zabbix y Clickhouse como resultado del hackathon</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de un tiempo, recibimos datos interesantes: la </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2r/vp/of/2rvpofn2alwwhizhv4e7qrwhpsm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mayor parte del espacio en nuestra base de datos estaba ocupada por el archivo de m√©tricas y menos del 1% se usaba para la configuraci√≥n, las plantillas y la configuraci√≥n. </font><font style="vertical-align: inherit;">En ese momento, durante m√°s de un a√±o ya hab√≠amos estado operando la soluci√≥n Big Data basada en Clickhouse. </font><font style="vertical-align: inherit;">La direcci√≥n del movimiento era obvia para nosotros. </font><font style="vertical-align: inherit;">En nuestro Hackathon de primavera, escribi√≥ la integraci√≥n de Zabbix con Clickhouse para el servidor y la interfaz. </font><font style="vertical-align: inherit;">En ese momento, Zabbix ya ten√≠a soporte para ElasticSearch, y decidimos compararlos.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bg/jv/hq/bgjvhq9lwget5l-hy1xt9zz2mvo.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compare Clickhouse y Elasticsearch</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - En comparaci√≥n, generamos la misma carga que proporciona el servidor Zabbix y analizamos c√≥mo se comportar√≠an los sistemas. Escribimos datos en lotes de 1000 l√≠neas, usamos CURL. Anteriormente sugerimos que Clickhouse ser√≠a m√°s efectivo para el perfil de carga que hace Zabbix. Los resultados incluso excedieron nuestras expectativas: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zz/iz/pj/zzizpjgv0rf9zjuuasv7mds7is8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bajo las mismas condiciones de prueba, Clickhouse escribi√≥ tres veces m√°s datos. Al mismo tiempo, ambos sistemas consumieron de manera muy eficiente (una peque√±a cantidad de recursos) mientras le√≠an datos. Pero "Elastix" requer√≠a una gran cantidad de procesador al grabar:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zz/iz/pj/zzizpjgv0rf9zjuuasv7mds7is8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En total, Clickhouse super√≥ significativamente a Elastix en el consumo y la velocidad del procesador. Al mismo tiempo, debido a la compresi√≥n de datos, "Clickhouse" usa 11 veces menos en el disco duro y realiza aproximadamente 30 veces menos operaciones de disco: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yf/0u/ce/yf0uceb3lvfa4e3mdwz1fsgufkw.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - S√≠, trabajar con el subsistema de disco en "Clickhouse" es muy efectivo. Debajo de las bases, puede usar enormes discos SATA y obtener una velocidad de escritura de cientos de miles de l√≠neas por segundo. El sistema "listo para usar" admite fragmentaci√≥n, replicaci√≥n, es muy f√°cil de configurar. Estamos m√°s que contentos con su funcionamiento durante un a√±o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para optimizar los recursos, puede instalar "Clickhouse" junto a la base principal existente y as√≠ ahorrar mucho tiempo de procesador y operaciones de disco. Sacamos el archivo de m√©tricas a los cl√∫steres existentes de "Clickhouse":</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qu/xr/p9/quxrp9ah4u-nhwlbkkcgynf2to0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Descargamos la base de datos MySQL principal tanto que pudimos combinarla en la misma m√°quina con el servidor Zabbix y abandonar el servidor dedicado para MySQL.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øC√≥mo funciona el sondeo en Zabbix?</font></font></h3><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hace 4 meses </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Bueno, ¬øpuedes olvidarte de los problemas con la base? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ¬°Eso es seguro! Otro problema que debemos resolver es la recolecci√≥n lenta de datos. Ahora todos nuestros 15 servidores proxy est√°n sobrecargados con SNMP y procesos de votaci√≥n. Y no hay otro que configurar servidores nuevos y nuevos. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Genial. Pero primero dime c√≥mo funciona el sondeo en Zabbix. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - En resumen, hay 20 tipos de m√©tricas y una docena de formas de obtenerlas. Zabbix puede recopilar datos ya sea en el modo "solicitud-respuesta", o esperar nuevos datos a trav√©s de la "Interfaz Trapper". </font></font><br>
<br>
<img src="https://habrastorage.org/webt/f1/dd/jc/f1ddjcw--iidqz7psmv82znkwk0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vale la pena se√±alar que en el Zabbix original, este m√©todo (Trapper) es el m√°s r√°pido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay proxies para el equilibrio de carga:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ql/n3/2v/qln32vd8mjkz2xbe0bowbswrpsu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los proxies pueden realizar las mismas funciones de recopilaci√≥n que el servidor Zabbix, recibir tareas de √©l y enviar m√©tricas recopiladas a trav√©s de la interfaz Trapper. </font><font style="vertical-align: inherit;">Este es el m√©todo de equilibrio de carga recomendado oficialmente. </font><font style="vertical-align: inherit;">Adem√°s, los proxies son √∫tiles para monitorear una infraestructura remota que funciona a trav√©s de NAT o un canal lento: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ba/uv/mh/bauvmh-9-mcmokuu7ldhtx59--0.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Todo est√° claro con la arquitectura. </font><font style="vertical-align: inherit;">Debemos mirar la fuente ... </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un par de d√≠as despu√©s</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuento de c√≥mo gan√≥ nmap fping</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Parece que desenterr√© algo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ¬°Dime! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Encontr√© que durante las verificaciones de disponibilidad, Zabbix realiza una verificaci√≥n de hasta 128 hosts a la vez. Trat√© de aumentar esta cifra a 500 y elimin√© el intervalo entre paquetes en su ping (ping); esto aument√≥ el rendimiento en un factor de dos. Pero me gustar√≠a grandes n√∫meros. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - En mi pr√°ctica, a veces tengo que verificar la disponibilidad de miles de hosts, y no he visto nada m√°s r√°pido que nmap. Estoy seguro de que esta es la forma m√°s r√°pida. ¬°Vamos a intentarlo! Necesita aumentar significativamente el n√∫mero de hosts en una iteraci√≥n. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ¬øVerifica m√°s de quinientos? 600? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Al menos un par de miles. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Bueno. Lo m√°s importante que quer√≠a decir: descubr√≠ que la mayor√≠a de las encuestas en Zabbix se realizaban sincr√≥nicamente. Debemos rehacerlo asincr√≥nicamente. Entonces podemos aumentar dr√°sticamente el n√∫mero de m√©tricas recopiladas por los encuestadores, especialmente si aumentamos el n√∫mero de m√©tricas en una iteraci√≥n. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬°Genial! ¬øY cuando? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Como siempre, ayer. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Comparamos ambas versiones de fping y nmap:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qo/du/ii/qoduiid8hzk_wy8sxvgityvungo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En una gran cantidad de hosts, se esperaba que nmap fuera hasta cinco veces m√°s eficiente. </font><font style="vertical-align: inherit;">Dado que nmap solo verifica el hecho de la disponibilidad y el tiempo de respuesta, transferimos el c√°lculo de p√©rdida a los desencadenantes y redujimos significativamente los intervalos de verificaci√≥n de disponibilidad. </font><font style="vertical-align: inherit;">Encontramos el n√∫mero √≥ptimo de hosts para nmap en la regi√≥n de 4 mil por iteraci√≥n. </font><font style="vertical-align: inherit;">Nmap nos permiti√≥ reducir los costos de CPU para verificaciones de disponibilidad en tres veces y reducir el intervalo de 120 segundos a 10.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Optimizaci√≥n de sondeo</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Luego fuimos por los encuestadores. Est√°bamos principalmente interesados ‚Äã‚Äãen la eliminaci√≥n de SNMP y agentes. En Zabbix, las encuestas se realizaron sincr√≥nicamente y se tomaron medidas especiales para aumentar la eficiencia del sistema. En modo s√≠ncrono, la indisponibilidad del host provoca una degradaci√≥n significativa de los sondeos. Hay un sistema completo de estados, hay procesos especiales: los llamados sondeos inalcanzables que funcionan solo con hosts inaccesibles: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3g/h1/fm/3gh1fmfnq3nqxkpwsow7j4h80ra.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
este es un comentario que demuestra la matriz de estados, toda la complejidad del sistema de transici√≥n que se requiere para que el sistema siga siendo efectivo. Adem√°s, el sondeo sincr√≥nico en s√≠ mismo es bastante lento:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/h7/0r/tm/h70rtmvjonmj3itlmq4wk44vpr8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es por eso que miles de hilos de votaci√≥n en una docena de servidores proxy no pudieron recopilar la cantidad de datos necesaria para nosotros. La implementaci√≥n asincr√≥nica resolvi√≥ no solo los problemas con el n√∫mero de subprocesos, sino que tambi√©n simplific√≥ significativamente el sistema de estado de los hosts inaccesibles, porque para cualquier n√∫mero verificado en una iteraci√≥n de sondeo, el tiempo m√°ximo de espera fue 1 tiempo de espera: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/re/te/bj/retebjsm9vthvrjy7rmpobeiwqa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
adem√°s, modificamos y mejoramos el sistema de sondeo para SNMP- consultas El hecho es que la mayor√≠a no puede responder a m√∫ltiples solicitudes SNMP al mismo tiempo. Por lo tanto, creamos un modo h√≠brido cuando el sondeo SNMP del mismo host se realiza de forma as√≠ncrona: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mj/9a/sj/mj9asjfzaisviljstpkdjpvmnya.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
esto se hace para todo el paquete de hosts. Al final, este modo no es m√°s lento que completamente as√≠ncrono, ya que sondear un centenar y medio de valores SNMP es mucho m√°s r√°pido que 1 tiempo de espera.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nuestros experimentos mostraron que el n√∫mero √≥ptimo de solicitudes en una iteraci√≥n es de aproximadamente 8 mil con sondeo SNMP. </font><font style="vertical-align: inherit;">En total, la transici√≥n al modo asincr√≥nico permiti√≥ acelerar el rendimiento del sondeo 200 veces, varios cientos de veces. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Las optimizaciones de sondeo obtenidas mostraron que no solo podemos deshacernos de todos los proxies, sino tambi√©n reducir los intervalos para muchas comprobaciones, y los proxies no ser√°n necesarios como una forma de compartir la carga. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hace unos tres meses</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cambie la arquitectura, ¬°aumente la carga!</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Bueno, Max, ¬øes hora de ser productivo? Necesito un servidor potente y un buen ingeniero. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Bueno, lo planeamos. Es hora de despegar a 5.000 m√©tricas por segundo. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ma√±ana despu√©s de la actualizaci√≥n de </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Misha, actualizamos, pero retrocedimos por la ma√±ana ... ¬øAdivina qu√© velocidad alcanzaste? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Mil 20 como m√°ximo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ¬°S√≠, 25! Desafortunadamente, estamos donde comenzamos. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ¬øY entonces? ¬øRecibi√≥ alg√∫n diagn√≥stico? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - S√≠, por supuesto! Aqu√≠, por ejemplo, un top interesante: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6c/zv/6s/6czv6sdkoykmdkm0vn-sddnbbpw.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Veamos. Veo que probamos una gran cantidad de hilos de votaci√≥n: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qb/a0/cl/qba0clfwpherpsufnk_7fbn5ioy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pero al mismo tiempo no pudimos utilizar el sistema ni siquiera a la mitad:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sp/wv/8b/spwv8blrzyggfwo5ps-objpypak.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y el rendimiento general es bastante peque√±o, alrededor de 4 mil m√©tricas por segundo: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tt/6o/zr/tt6ozrt2ortiof4kckeghltzrnq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øhay algo m√°s? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - S√≠, parte de uno de los encuestadores: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/p8/ny/y3/p8nyy3kb_ffjhsjynlpz4wjfh8w.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Aqu√≠ se ve claramente que el proceso de votaci√≥n est√° esperando "sem√°foros". Estos son bloqueos: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/z7/ks/mh/z7ksmh8kes9yc23tm0vuyu5g8r8.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - No est√° claro. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Mira, esto es como una situaci√≥n en la que un mont√≥n de hilos intentan trabajar con recursos con los que solo uno puede trabajar a la vez. Entonces, todo lo que pueden hacer es compartir este recurso por tiempo: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/in/ce/mo/incemofethgxpp3fwyabr8kstd4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
y la productividad total de trabajar con dicho recurso est√° limitada por la velocidad de un n√∫cleo: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/oq/oh/9f/oqoh9fqs9ppftn5mab3aivoo2nq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
hay dos formas de resolver este problema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Actualice la m√°quina de planchar, cambie a n√∫cleos m√°s r√°pidos:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/io/bd/zi/iobdziopu3g_vkfoengg2zhhcro.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O cambie la arquitectura y </font><font style="vertical-align: inherit;">, al mismo tiempo </font><font style="vertical-align: inherit;">, la carga: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nu/sl/wt/nuslwtjkx-poqob5ciqyyfifq48.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Por cierto, usaremos menos n√∫cleos en una m√°quina de prueba que en una de combate, ¬°pero ser√°n 1.5 veces m√°s r√°pidas en frecuencia por n√∫cleo! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ¬ø </font><b><font style="vertical-align: inherit;">Eso</font></b><font style="vertical-align: inherit;"> est√° claro? </font><font style="vertical-align: inherit;">Es necesario mirar el c√≥digo del servidor.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ruta de datos en el servidor Zabbix</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Para entenderlo, comenzamos a analizar c√≥mo se transmiten los datos dentro del servidor Zabbix: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/v9/iu/a2/v9iua26a6om3flgzj_vb3te0hak.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imagen genial, ¬øverdad? Veamos paso a paso para aclarar m√°s o menos. Hay flujos y servicios responsables de recopilar datos: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/h3/m9/kt/h3m9ktuwhpgwe1g4mbqjiw8l_zs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
transfieren las m√©tricas recopiladas a trav√©s del socket al administrador del preprocesador, donde se ponen en cola: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9d/ct/fv/9dctfvdiw2zaves1vn34gliuvmu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Preprocessor-manager "transfiere datos a sus trabajadores que ejecutan las instrucciones de preprocesamiento y los devuelven a trav√©s del mismo socket: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ma/qd/ss/maqdssje-vzlzzpfzl0x2cuthwo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
despu√©s de eso, el preprocesador -manager los guarda en el cach√© del historial:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5r/9q/vw/5r9qvwyriydt0pcroma7n-14fsa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A partir de ah√≠, son recogidos por los hundidores del historial que realizan muchas funciones: por ejemplo, calcular disparadores, llenar el cach√© de valores y, lo m√°s importante, guardar m√©tricas en el almac√©n de historial. </font><font style="vertical-align: inherit;">En general, el proceso es complejo y muy confuso. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/f7/o8/ih/f7o8ihzf_g5_2ecganu1t0zoss0.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Lo primero que vimos es que la mayor√≠a de los hilos compiten por el llamado "cach√© de configuraci√≥n" (un √°rea de memoria donde se almacenan todas las configuraciones del servidor). </font><font style="vertical-align: inherit;">Las secuencias responsables de la recopilaci√≥n de datos realizan una gran cantidad de bloqueos: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ba/oo/48/baoo48qthdg_pcp0ojgqh0de5us.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... ya que la configuraci√≥n almacena no solo m√©tricas con sus par√°metros, sino tambi√©n colas, de las cuales los encuestadores toman informaci√≥n sobre qu√© hacer a continuaci√≥n. </font><font style="vertical-align: inherit;">Cuando hay muchos encuestadores, y uno bloquea la configuraci√≥n, el resto espera solicitudes:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/y5/zb/np/y5zbnpqumrszencyhaasflytwvm.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los encuestadores no deben entrar en conflicto</font></font></h3><br>
<img src="https://habrastorage.org/webt/kw/11/4f/kw114ff5k91eqlycs-yg8p8bmem.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, lo primero que hicimos fue dividir la cola en 4 partes y permitir que los encuestadores bloqueen de manera segura estas colas, estas partes al mismo tiempo: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/la/gi/xu/lagixuseh1aghovklgd6m3blkxu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
esto elimin√≥ la competencia por la cach√© de configuraci√≥n y la velocidad de los encuestadores aument√≥ significativamente. </font><font style="vertical-align: inherit;">Pero luego nos enfrentamos con el hecho de que el gerente del preprocesador comenz√≥ a acumular una cola de trabajo:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ui/0c/4i/ui0c4i7aae8kqdvkdtorchzft-y.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El administrador del preprocesador deber√≠a poder priorizar</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto sucedi√≥ cuando le faltaba productividad. </font><font style="vertical-align: inherit;">Entonces todo lo que pod√≠a hacer era solicitudes acumulan a partir de los procesos de recolecci√≥n de datos y su memoria intermedia hasta que se come toda la memoria y se bloquea: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9y/iy/oz/9yiyozxavyibcw8pog3tidwy-xc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para resolver este problema, hemos a√±adido una segunda toma, que fue asignado espec√≠ficamente para los trabajadores: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rb/sz/25/rbsz25axpkn6a832h9k7otp9je4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto , el administrador del preprocesador tuvo la oportunidad de priorizar su trabajo y, en caso de que el buffer crezca, la tarea es reducir la velocidad de la comida, dando a los trabajadores la oportunidad de recoger este buffer: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qi/og/cg/qiogcgztt1an1ewlrear7oqxt7g.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces descubrimos que una de las razones de la desaceleraci√≥n era porque los trabajadores mismos estaban compitiendo por </font><font style="vertical-align: inherit;">recurso vital para su trabajo. </font><font style="vertical-align: inherit;">Registramos este problema con una correcci√≥n de errores, y en las nuevas versiones de Zabbix ya se ha resuelto:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yd/6q/lr/yd6qlrqamuxreroffkeracyrnim.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aumentamos el n√∫mero de tomas: obtenemos el resultado</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, el administrador del preprocesador se convirti√≥ en un enlace estrecho, ya que es un hilo √∫nico. </font><font style="vertical-align: inherit;">Se basaba en la velocidad del n√∫cleo, dando una velocidad m√°xima de aproximadamente 70 mil m√©tricas por segundo: por lo </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uk/s1/2_/uks12_i65kx3ohfqdfmvedyqdqw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
tanto, hicimos cuatro, con cuatro conjuntos de enchufes, trabajadores: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qt/-u/ws/qt-uwsmlriplii491ao0we3jhg4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
y esto nos permiti√≥ aumentar la velocidad a aproximadamente 130 mil m√©tricas: la </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ql/vp/cf/qlvpcfggoinhdxc4dfkniaz9po8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
no linealidad del crecimiento se explica por el hecho de que hab√≠a competencia por el cach√© cuentos. </font><font style="vertical-align: inherit;">Para √©l, compitieron 4 gerentes de preprocesadores y sincronizadores hist√≥ricos. </font><font style="vertical-align: inherit;">En este punto, recibimos aproximadamente 130 mil m√©tricas por segundo en una m√°quina de prueba, utiliz√°ndolas en aproximadamente un 95% en el procesador: hace </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yo/7l/mh/yo7lmhcfcdbhek5blp5xdz0osfy.jpeg"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aproximadamente 2.5 meses</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El rechazo de la comunidad snmp aument√≥ los NVP una vez y media</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Max, ¬°necesito una nueva m√°quina de prueba! Ya no encajamos en el actual. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ¬øY qu√© es ahora? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ahora - 130k NVPs y un procesador "estante". </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ¬°Guau! ¬°Frio! Espera, tengo dos preguntas. Seg√∫n mis c√°lculos, nuestra necesidad est√° en la regi√≥n de 15-20 mil m√©tricas por segundo. ¬øPor qu√© necesitamos m√°s? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Quiero terminar el trabajo hasta el final. Quiero ver cu√°nto podemos sacar de este sistema. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Pero ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Pero es in√∫til para los negocios. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ya veo. Y la segunda pregunta: lo que tenemos ahora, ¬øpodemos apoyarnos sin la ayuda de un desarrollador? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- No creo. Cambiar la cach√© de configuraci√≥n es un problema. Se ocupa de los cambios en la mayor√≠a de los hilos y es dif√≠cil de mantener. Lo m√°s probable es que apoyarla sea muy dif√≠cil. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Entonces necesitas alg√∫n tipo de alternativa. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Existe tal opci√≥n. Podemos cambiar a n√∫cleos r√°pidos, mientras abandonamos el nuevo sistema de bloqueo. A√∫n obtenemos el rendimiento de 60-80 mil m√©tricas. En este caso, podemos dejar el resto del c√≥digo. Clickhouse, el sondeo as√≠ncrono funcionar√°. Y ser√° f√°cil de mantener. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬°Genial! Propongo detenerme en esto.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de optimizar el lado del servidor, finalmente pudimos ejecutar el nuevo c√≥digo en el productivo. </font><font style="vertical-align: inherit;">Abandonamos parte de los cambios a favor de cambiar a una m√°quina con n√∫cleos r√°pidos y minimizar la cantidad de cambios en el c√≥digo. </font><font style="vertical-align: inherit;">Tambi√©n simplificamos la configuraci√≥n y, si es posible, abandonamos las macros en los elementos de datos, ya que son la fuente de bloqueos adicionales. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bk/v7/tp/bkv7tps-i9usalann4sbqpdbkqm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por ejemplo, el rechazo de la macro snmp-community, que a menudo se encuentra en la documentaci√≥n y los ejemplos, en nuestro caso nos permiti√≥ acelerar adicionalmente las NVP aproximadamente 1.5 veces. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Despu√©s de dos d√≠as en producci√≥n.</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eliminar ventanas emergentes del historial de incidentes</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Misha, usamos el sistema durante dos d√≠as, y todo funciona. ¬°Pero solo cuando todo funciona! Hab√≠amos planeado trabajar con la transferencia de un segmento suficientemente grande de la red, y nuevamente con nuestras manos verificamos que hab√≠a aumentado, que no lo hab√≠a hecho. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ¬°No puede ser! Revisamos todo 10 veces. El servidor procesa incluso la inaccesibilidad completa de la red al instante. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - S√≠, entiendo todo: servidor, base, superior, austat, registros - todo es r√°pido ... Pero miramos la interfaz web, y ah√≠ tenemos el procesador "en el estante" en el servidor y esto: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vj/un/p2/vjunp2evh3whasvpw4hwsipeshk.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ya veo. Miremos la web. Descubrimos que en una situaci√≥n en la que hab√≠a una gran cantidad de incidentes activos, la mayor√≠a de los widgets operativos comenzaron a funcionar muy lentamente:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nz/vw/kz/nzvwkzfbeg-4r1iue0y4178eg2q.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La raz√≥n de esto fue la generaci√≥n de ventanas emergentes con un historial de incidentes que se generan para cada elemento de la lista. </font><font style="vertical-align: inherit;">Por lo tanto, nos negamos a generar estas ventanas (comentamos 5 l√≠neas en el c√≥digo), y esto resolvi√≥ nuestros problemas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El tiempo de carga del widget, incluso cuando es completamente inaccesible, se redujo de unos pocos minutos a lo aceptable para nosotros de 10 a 15 segundos, y el historial a√∫n se puede ver haciendo clic en el tiempo: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hu/dc/4l/hudc4lsz_skbshg7jphleuprc4a.jpeg"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Despu√©s del trabajo. </font><font style="vertical-align: inherit;">Hace 2 meses </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Misha, ¬øte vas? </font><font style="vertical-align: inherit;">Tenemos que hablar. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - No voy a hacerlo. </font><font style="vertical-align: inherit;">¬øOtra vez algo con Zabbix? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ¬°Oh no, rel√°jate! </font><font style="vertical-align: inherit;">Solo quer√≠a decir: todo funciona, ¬°gracias! </font><font style="vertical-align: inherit;">Cerveza conmigo.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zabbix es efectivo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zabbix es un sistema y una funci√≥n bastante vers√°tiles y ricos. </font><font style="vertical-align: inherit;">Se puede utilizar para peque√±as instalaciones de f√°brica, pero con el crecimiento de las necesidades, debe optimizarse. </font><font style="vertical-align: inherit;">Para almacenar un gran archivo de m√©tricas, use el almacenamiento apropiado:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Puede utilizar las herramientas integradas en forma de integraci√≥n con Elastixerch o cargar el historial en archivos de texto (disponible desde la cuarta versi√≥n);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Puede aprovechar nuestra experiencia e integraci√≥n con Clickhouse.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para aumentar dr√°sticamente la velocidad de recopilaci√≥n de m√©tricas, rec√≥jalas de forma as√≠ncrona y transfi√©ralas a trav√©s de la interfaz de trapper al servidor Zabbix; </font><font style="vertical-align: inherit;">o puede usar el parche para los buscadores as√≠ncronos de Zabbix. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zabbix est√° escrito en C y es bastante efectivo. </font><font style="vertical-align: inherit;">La soluci√≥n de varios lugares arquitect√≥nicos estrechos permite aumentar a√∫n m√°s su productividad y, en nuestra experiencia, recibir m√°s de 100 mil m√©tricas en una m√°quina de un solo procesador.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5r/db/d2/5rdbd2jcvr75sosfvfa6ziniwps.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El mismo parche de Zabbix</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Quiero agregar un par de puntos. </font><font style="vertical-align: inherit;">El informe actual completo, todas las pruebas, los n√∫meros se dan para la configuraci√≥n que se utiliza con nosotros. </font><font style="vertical-align: inherit;">Ahora estamos tomando alrededor de 20 mil m√©tricas por segundo. </font><font style="vertical-align: inherit;">Si est√° tratando de entender si esto funcionar√° para usted, puede comparar. </font><font style="vertical-align: inherit;">Lo que hablaron hoy est√° publicado en GitHub como un parche: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/miklert/zabbix</font></font></a><br>
<br>
<img src="https://habrastorage.org/webt/xb/wd/y1/xbwdy18hq9dolceyxku_2wxsj4a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
El parche incluye:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">integraci√≥n completa con Clickhouse (servidor Zabbix y frontend);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">resolver problemas con el administrador del preprocesador;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sondeo asincr√≥nico.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El parche es compatible con todas las versiones 4, incluidos los lts. </font><font style="vertical-align: inherit;">Lo m√°s probable, con cambios m√≠nimos, funcionar√° en la versi√≥n 3.4. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gracias por la atenci√≥n.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Preguntas</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pregunta de la audiencia (en adelante - A): - ¬°Buenas tardes! D√≠game, ¬øtiene planes para una interacci√≥n intensiva con el equipo de Zabbix o tienen ellos con usted para que esto no sea un parche, sino el comportamiento normal de Zabbix? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - S√≠, ciertamente comprometeremos parte de los cambios. Algo ser√°, algo quedar√° en el parche. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Muchas gracias por el excelente informe. D√≠game, por favor, despu√©s de aplicar el parche, el soporte del lado de Zabbix permanecer√° y ¬øc√≥mo continuar actualizando a versiones superiores? ¬øSer√° posible actualizar Zabbix despu√©s de su parche a 4.2, 5.0? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- No puedo decir sobre el soporte. Si yo fuera el soporte t√©cnico de Zabbix, probablemente dir√≠a que no, porque este es el c√≥digo de otra persona. En cuanto a la base de c√≥digo 4.2, nuestra posici√≥n es esta: "Iremos con el tiempo, y seremos actualizados en la pr√≥xima versi√≥n". Por lo tanto, durante alg√∫n tiempo cargaremos el parche en versiones actualizadas. Ya dije en el informe: el n√∫mero de cambios con las versiones todav√≠a es bastante peque√±o. Creo que la transici√≥n de 3.4 a 4 nos llev√≥, al parecer, unos 15 minutos. Algo ha cambiado all√≠, pero no es muy importante. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ¬øEntonces planea mantener su parche y puede ponerlo en producci√≥n de manera segura, en el futuro recibiendo actualizaciones de alguna manera? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Lo recomendamos encarecidamente. Esto nos resuelve muchos problemas. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Una vez m√°s, me gustar√≠a enfatizar que los cambios que no se relacionan con la arquitectura y no se relacionan con bloqueos, colas, son modulares, est√°n en m√≥dulos separados. Incluso por s√≠ solos con cambios menores, se pueden mantener con bastante facilidad. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Si los detalles son interesantes, entonces "Clickhouse" utiliza la llamada biblioteca de historial. No est√° vinculado: esta es una copia del soporte de Elastic, es decir, es configurable. El sondeo solo cambia a los encuestadores. Creemos que esto funcionar√° durante mucho tiempo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Muchas gracias. Pero dime, ¬øhay alguna documentaci√≥n de los cambios realizados? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/r7/vv/h3/r7vvh3optatasclqsm9tjftkmja.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- La documentaci√≥n es un parche. </font><font style="vertical-align: inherit;">Obviamente, con la introducci√≥n de "Clickhouse", con la introducci√≥n de nuevos tipos de sondeos, surgen nuevas opciones de configuraci√≥n. </font><font style="vertical-align: inherit;">El enlace de la √∫ltima diapositiva tiene una breve descripci√≥n de c√≥mo usarlo.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acerca de reemplazar fping con nmap</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ¬øC√≥mo finalmente implementaste esto? </font><font style="vertical-align: inherit;">¬øPuedes dar ejemplos espec√≠ficos: son tus tirantes y un script externo? </font><font style="vertical-align: inherit;">¬øQu√© es lo que finalmente verifica tantos hosts tan r√°pidamente? </font><font style="vertical-align: inherit;">¬øC√≥mo se obtienen estos hosts? </font><font style="vertical-align: inherit;">¬øNmap necesita alimentarlos de alguna manera, obtenerlos de alguna parte, ponerlos, comenzar algo? ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Frio. Pregunta muy correcta! El punto es este. Modificamos la biblioteca (ping ICMP, parte de Zabbix) para verificaciones ICMP, que indican el n√∫mero de paquetes - unidad (1), y el c√≥digo intenta usar nmap. Es decir, este es el trabajo interno de Zabbix, se ha convertido en el trabajo interno del pinger. En consecuencia, no se requiere sincronizaci√≥n o uso de un trampero. Esto se hizo deliberadamente para dejar el sistema coherente y no participar en la sincronizaci√≥n de dos sistemas b√°sicos: qu√© verificar, completar a trav√©s del sondeo y si el relleno se ha roto en nosotros? Esto es mucho m√°s simple. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><b><font style="vertical-align: inherit;">¬øFunciona</font></b><font style="vertical-align: inherit;"> tambi√©n para un proxy? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - S√≠, pero no lo comprobamos. El c√≥digo de sondeo es el mismo tanto en Zabbix como en el servidor. Deberia trabajar. Destaco nuevamente: el rendimiento del sistema es tal que no necesitamos un proxy.</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - La respuesta correcta a la pregunta es: "¬øPor qu√© necesita un proxy con dicho sistema?" </font><font style="vertical-align: inherit;">Solo por NAT'a o para monitorear a trav√©s de un canal lento algunos ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Y usas Zabbix como al√©rgeno, si lo entiendo correctamente. </font><font style="vertical-align: inherit;">¬øO los gr√°ficos (d√≥nde est√° la capa de archivo) que dej√≥ para otro sistema, como Grafana? </font><font style="vertical-align: inherit;">¬øO no est√°s usando esta funcionalidad? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Lo enfatizar√© una vez m√°s: hemos hecho una integraci√≥n total. </font><font style="vertical-align: inherit;">Vertimos la historia en "Clickhouse", pero al mismo tiempo cambiamos la interfaz php. </font><font style="vertical-align: inherit;">Php-frontend va a "Clickhouse" y hace todos los gr√°ficos desde all√≠. </font><font style="vertical-align: inherit;">Al mismo tiempo, para ser honesto, tenemos una parte que se construye a partir del mismo "Clickhouse", a partir de los mismos datos de Zabbix, datos en otros sistemas de visualizaci√≥n gr√°fica. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - En "Grafan" tambi√©n.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øC√≥mo se tom√≥ la decisi√≥n de asignar recursos?</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Comparte un poco de cocina interior. </font><font style="vertical-align: inherit;">¬øC√≥mo se tom√≥ la decisi√≥n de asignar recursos para el procesamiento serio del producto? </font><font style="vertical-align: inherit;">Estos son, en general, ciertos riesgos. </font><font style="vertical-align: inherit;">Y d√≠game, en el contexto del hecho de que va a admitir nuevas versiones: ¬øc√≥mo se justifica esta decisi√≥n desde el punto de vista de la administraci√≥n? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Aparentemente, no contamos muy bien el drama de la historia. </font><font style="vertical-align: inherit;">Nos encontramos en una situaci√≥n en la que hab√≠a que hacer algo, y seguimos esencialmente dos comandos paralelos:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uno estaba involucrado en el lanzamiento de un sistema de monitoreo utilizando nuevos m√©todos: monitoreo como servicio, un conjunto est√°ndar de soluciones de c√≥digo abierto que combinamos y luego intentamos cambiar el proceso comercial para trabajar con el nuevo sistema de monitoreo.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paralelamente, tuvimos un programador entusiasta que estaba haciendo esto (sobre s√≠ mismo). </font><font style="vertical-align: inherit;">Dio la casualidad de que gan√≥.</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ¬øY cu√°l es el tama√±o del equipo? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ella est√° frente a ti. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Es decir, como siempre, ¬øse necesita un apasionado? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - No s√© lo que es un apasionado. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - En este caso, aparentemente, usted. </font><font style="vertical-align: inherit;">Muchas gracias, eres genial. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Gracias.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sobre parches para Zabbix</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Para un sistema que usa proxies (por ejemplo, en algunos sistemas distribuidos), ¬øes posible que usted decida adaptar y parchear, por ejemplo, sondeos, proxies y parcialmente el preprocesador del propio Zabbix; y su interacci√≥n? ¬øEs posible optimizar los desarrollos existentes para un sistema con m√∫ltiples servidores proxy? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - S√© que el servidor Zabbix se ensambla utilizando un proxy (se compila y se obtiene el c√≥digo). No probamos esto en el producto. No estoy seguro de esto, pero, en mi opini√≥n, el administrador del preprocesador no se usa en el proxy. La tarea del proxy es tomar un conjunto de m√©tricas de Zabbix, completarlas (tambi√©n escribe la configuraci√≥n, la base de datos local) y devolverlo al servidor de Zabbix. Luego, el servidor mismo realizar√° el preprocesamiento cuando lo reciba.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El inter√©s por los poderes es comprensible. </font><font style="vertical-align: inherit;">Verificaremos esto. </font><font style="vertical-align: inherit;">Este es un tema interesante. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - La idea era esta: si puede parchear los pollers, se pueden parchear en proxies e parchear la interacci√≥n con el servidor, y el preprocesador se puede adaptar para estos prop√≥sitos solo en el servidor. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Creo que todo es a√∫n m√°s simple. </font><font style="vertical-align: inherit;">Usted toma el c√≥digo, aplica el parche, luego lo configura seg√∫n lo necesite: recopile los servidores proxy (por ejemplo, con ODBC) y distribuya el c√≥digo parcheado a los sistemas. </font><font style="vertical-align: inherit;">Donde sea necesario: recopile proxies, donde sea necesario: servidor. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Adem√°s, ¬øno tendr√° que parchear la transmisi√≥n del proxy al servidor, lo m√°s probable? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - No, es est√°ndar. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- En realidad, una de las ideas no son√≥. </font><font style="vertical-align: inherit;">Siempre mantuvimos un equilibrio entre una explosi√≥n de ideas y la cantidad de cambios, la facilidad de soporte.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/3yRt9jSwrlg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un poco de publicidad :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gracias por estar con nosotros. ¬øTe gustan nuestros art√≠culos? ¬øQuieres ver m√°s materiales interesantes? Ap√≥yenos haciendo un pedido o recomendando a sus amigos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS basado en la nube para desarrolladores desde $ 4.99</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , un </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">an√°logo √∫nico de servidores de nivel b√°sico que inventamos para usted: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toda la verdad sobre VPS (KVM) E5-2697 v3 (6 n√∫cleos) 10GB DDR4 480GB SSD 1Gbps desde $ 19 o c√≥mo dividir el servidor?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (las opciones est√°n disponibles con RAID1 y RAID10, hasta 24 n√∫cleos y hasta 40GB DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2 veces m√°s barato en el centro de datos Equinix Tier IV en Amsterdam?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬°Solo tenemos </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV desde $ 199</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en los Pa√≠ses Bajos!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - ¬°desde $ 99! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lea sobre</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C√≥mo construir un edificio de infraestructura. </font><font style="vertical-align: inherit;">clase c con servidores Dell R730xd E5-2650 v4 que cuestan 9,000 euros por un centavo?</font></font></a></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es486540/">https://habr.com/ru/post/es486540/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es486518/index.html">Hace 20 a√±os</a></li>
<li><a href="../es486528/index.html">Esta es la norma - 3: tipos de mapas normales</a></li>
<li><a href="../es486530/index.html">Convencional. Trabajadores honorarios. Novela biografica</a></li>
<li><a href="../es486532/index.html">Copia de seguridad de datos usando un mont√≥n de FreeFileSync y 7-zip</a></li>
<li><a href="../es486538/index.html">C√≥mo cargu√© habilidades sociales en l√≠nea y qu√© me dio</a></li>
<li><a href="../es486542/index.html">Analiza el sonido de un m√≥dem de acceso telef√≥nico</a></li>
<li><a href="../es486544/index.html">Dos horas y 3.5 d√≥lares. C√≥mo hice un sitio simple con visualizaci√≥n de la distribuci√≥n de coronavirus</a></li>
<li><a href="../es486548/index.html">Funciones recursivas primitivas y funci√≥n Ackerman</a></li>
<li><a href="../es486552/index.html">"C√≥digo cultural: los secretos de grupos y organizaciones extremadamente exitosos" - notas del libro</a></li>
<li><a href="../es486554/index.html">Slurm DevOps. Tres d√≠as de inmersi√≥n en DevOps. Y una conferencia de Anatoly Wasserman "El problema computacional del socialismo"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>