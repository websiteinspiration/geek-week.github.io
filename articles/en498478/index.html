<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üóûÔ∏è ‚ò∏Ô∏è üë©‚ÄçüöÄ What is Windows PowerShell and what does it eat? Part 5: Access to external objects üêæ üëßüèª üöÖ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Windows operating systems support a variety of object infrastructures. You can use application programming interfaces (APIs) to access them, but devel...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>What is Windows PowerShell and what does it eat? Part 5: Access to external objects</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/498478/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/-b/i_/73/-bi_73lwdxmnzvtveeghrwvtqay.png"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Windows operating systems support a variety of object infrastructures. </font><font style="vertical-align: inherit;">You can use application programming interfaces (APIs) to access them, but developing full-fledged applications is not always justified. </font><font style="vertical-align: inherit;">PowerShell has special cmdlets that allow you to access .NET, COM, WMI (CIM), and ADSI objects interactively. </font><font style="vertical-align: inherit;">In the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fourth part of the series,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> we learned the basics with a focus on .NET Core classes, and now we want to deepen the topic and understand the features of PowerShell interaction with external objects.</font></font><a name="habracut"></a><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Table of contents:</font></font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Work with JSON, XML and CSV </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Work with WMI and CIM </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Work with COM objects </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Work with ADSI directory service </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formatting output</font></font></a><br>
<br>
<a name="section1"></a><h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Work with JSON, XML and CSV</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In PowerShell scripts, you often have to parse JSON, XML, and CSV data. Usually this need arises when working with Internet services or with configuration files. Some administrators try to parse data using regular expressions, but it is not necessary to make such sacrifices: PowerShell has special cmdlets for conversion, moreover, in both directions.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ep/q6/tr/epq6trkxgw_sfw21p1wmfixyrfk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The JSON format allows you to describe a variety of objects and, in essence, is a hashtable that can be nested. </font><font style="vertical-align: inherit;">Converting a JSON object to a .NET object accordingly using PowerShell is easy. </font><font style="vertical-align: inherit;">Since Internet services usually give a very long line instead of a beautifully formatted file, this conversion can also be useful for working in interactive mode. </font><font style="vertical-align: inherit;">In the example below, we used a multiline text variable to describe the JSON object:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$user</span> = <span class="hljs-string">@"
{
   "firstName": "Ivan",
   "lastName": "Danko",
   "address": {
       "streetAddress": "Kremlin",
       "city": "Moscow"
   },
   "phoneNumbers": [
       "+7 495 1234567",
       "+7 499 1234567"
   ]
}
"@</span> | <span class="hljs-built_in">ConvertFrom-Json</span>
</code></pre><br>
<img src="https://habrastorage.org/webt/vu/2j/x6/vu2jx6vrks90qvsuoehs6ky43ke.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The inverse problem is solved in a similar way:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$file</span> = <span class="hljs-built_in">Get-ChildItem</span> C:\Windows\System32\notepad.exe
<span class="hljs-variable">$file</span>.VersionInfo | <span class="hljs-built_in">ConvertTo-Json</span></code></pre><br>
<img src="https://habrastorage.org/webt/rd/tb/dq/rdtbdqlfwsepqmnggw_2uk7omkw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The resulting JSON format string is easy to send to another application over the network. </font><font style="vertical-align: inherit;">It can be, for example, some RESTful service. </font><font style="vertical-align: inherit;">Work with the ConvertFrom-Csv, ConvertTo-Csv and ConvertTo-Xml cmdlets is built in approximately the same way, we suggest readers to study it themselves. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To work with XML and CSV, we will need other cmdlets: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jz/hy/m7/jzhym7nqvb5id7fvdys9ao59meq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Using these tools, you need to understand that converting a binary object to a text format saves only the value of its properties, but not the methods. </font><font style="vertical-align: inherit;">Converting JSON, XML, or CSV data to a .NET object using PowerShell is only possible if it is valid.</font></font><br>
<br>
<a name="section2"></a><h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Work with WMI and CIM</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Windows Management Instrumentation (WMI) is a Microsoft-developed and Windows-adapted implementation of the WBEM (Web-Based Enterprise Management) standard. It is based on the idea of ‚Äã‚Äãcreating a universal solution for monitoring the distributed information environment of an enterprise and managing its components. The WBEM data structure, in turn, is based on the Common Information Model (CIM), which implements an object-oriented approach to the representation of computer systems. Further development and support of WMI in Windows has been discontinued; Microsoft recommends using a similar mechanism for managing infrastructure - CIM objects. To work with them, special cmdlets appeared in PowerShell 3.0, which we will consider in parallel with WMI counterparts. If the code contains cmdlet calls for working with WMI, it should be rewritten if possible.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/h6/io/mw/h6iomwnjjrssdkl_tw7gi0mwjhm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Within the framework of the CIM model (it is also used in WMI), the operating system data is presented in the form of classes with properties and methods. Classes are grouped in hierarchically ordered and logically related by namespace technology or management area. There is a root Root namespace that has subspaces: CIMv2, Default, Secutiry, and WMI. For unambiguous identification of an instance of a class (object) and description of the state of the corresponding resource, class properties are used, which are usually read-only. Methods are used to manage the resource. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The class instance can be accessed by the full path, which has the following form:</font></font><br>
<br>
<pre><code class="powershell hljs">[\\<span class="hljs-type">ComputerName</span>\<span class="hljs-type">NameSpace</span>][:<span class="hljs-type">ClassName</span>][<span class="hljs-type">.KeyProperty1</span>=<span class="hljs-type">Value1</span>][,<span class="hljs-type">KeyProperty2</span>=<span class="hljs-type">Value2</span>]‚Ä¶]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
where </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ComputerName is the name of the computer; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NameSpace - namespace; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ClassName - the name of the class; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
KeyProperty1 = Value1, KeyProperty2 = Value2 - the properties of the object and the values ‚Äã‚Äãby which it is identified.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Before PowerShell, a simple WMI tool did not exist. </font><font style="vertical-align: inherit;">To access the objects, you had to write rather complex programs in high-level languages ‚Äã‚Äã(C ++, Visual Basic, Java Script) or study the WMIC shell (WMI Command Line, which is also discontinued) with its own language. </font><font style="vertical-align: inherit;">Through PowerShell, WMI objects are accessible to the average user from the command line or in scripts. </font><font style="vertical-align: inherit;">First, connect to the WMI subsystem and get a list of available classes using the Get-WmiObject cmdlet (alias gwmi). </font><font style="vertical-align: inherit;">To get a list of CIM classes, use the Get-CimClass cmdlet.</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-CimClass</span>
<span class="hljs-built_in">Get-WmiObject</span> <span class="hljs-literal">-List</span></code></pre><br>
<img src="https://habrastorage.org/webt/g7/1z/wz/g71zwzueejpnyrgwqkoqpxlwn7a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We have listed the classes on the local computer, but you can connect to the remote:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-CimClass</span> <span class="hljs-literal">-ComputerName</span> IP- 
<span class="hljs-built_in">Get-CimClass</span> <span class="hljs-literal">-ComputerName</span> _</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
or</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-WmiObject</span> <span class="hljs-literal">-ComputerName</span> IP- <span class="hljs-literal">-List</span>
<span class="hljs-built_in">Get-WmiObject</span> <span class="hljs-literal">-ComputerName</span> _ <span class="hljs-literal">-List</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By default, the Get-CimClass and Get-WmiObject cmdlets connect to the Root \ CIMV2 namespace, which stores a large number of classes for managing the system. </font><font style="vertical-align: inherit;">To change the namespace, use the -Namespace parameter:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-CimClass</span> <span class="hljs-literal">-Namespace</span> Root
<span class="hljs-built_in">Get-WmiObject</span> <span class="hljs-literal">-Namespace</span> Root <span class="hljs-literal">-List</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Knowing the name of the class, it is not difficult to get instances of it. </font><font style="vertical-align: inherit;">The following command returns all instances of Win32_Service, i.e. </font><font style="vertical-align: inherit;">services registered on the local machine:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-WmiObject</span> Win32_Service</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As with other types of objects, a list of properties and methods is displayed using Get-Member. </font><font style="vertical-align: inherit;">WMI object methods can be accessed directly or using the Invoke-WmiMethod cmdlet. </font><font style="vertical-align: inherit;">You can also use cmdlets for WMI objects to sort, filter, group, etc.</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-WmiObject</span> Win32_Service | <span class="hljs-built_in">Get-Member</span></code></pre><br>
<img src="https://habrastorage.org/webt/pq/rn/nk/pqrnnkbv1abfqzn5hlnsgunzamu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To get CIM objects (instances of classes), use the Get-CimInstance cmdlet. </font><font style="vertical-align: inherit;">Unlike WMI, the resulting CIM objects (resultant object or class instances) do not contain class methods. </font><font style="vertical-align: inherit;">Because you cannot directly extract a method, you must invoke the Invoke-CimMethod cmdlet. </font><font style="vertical-align: inherit;">Consider the Win32_Service class - services running on the system) and its instance for the spooler service on the local machine:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-CimInstance</span> Win32_service <span class="hljs-literal">-filter</span> <span class="hljs-string">"Name='spooler'"</span> </code></pre><br>
<img src="https://habrastorage.org/webt/qm/jf/cz/qmjfcz-_u-le6js9tibb3qc5y2i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's look at the structure of the resulting object:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-CimInstance</span> Win32_service <span class="hljs-literal">-filter</span> <span class="hljs-string">"Name='spooler'"</span> | <span class="hljs-built_in">Get-Member</span></code></pre><br>
<img src="https://habrastorage.org/webt/t4/uo/ub/t4uoublc7mxrlb6khyrycfozod4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At this point, the benefits of cmdlets for working with CIM objects are not obvious. </font><font style="vertical-align: inherit;">They primarily relate to remote work in a distributed environment and will be discussed in detail in the last article in the series devoted to solving practical problems of administration. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is also a WMI-specific toolkit: the WMI Query Language (WQL), a SQL-like query language. </font><font style="vertical-align: inherit;">A WQL query to search for all start-ups when starting a service system looks like this:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">select</span> * from win32_service <span class="hljs-built_in">where</span> startmode=<span class="hljs-string">"Auto"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
From PowerShell, they are executed as follows:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-WmiObject</span> <span class="hljs-literal">-Query</span> <span class="hljs-string">'select * from win32_service where startmode="Auto"'</span></code></pre><br>
<img src="https://habrastorage.org/webt/wc/y7/wf/wcy7wfk7619yx_9es0cjz9bi4vw.png"><br>
<br>
<a name="section3"></a><h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Work with COM objects</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To ensure the interaction between applications in Windows, a technology for linking and embedding objects (Object Linking and Embedding or OLE) was developed. Later, OLE Automation technology appeared, with the help of which automation client applications could call functions of other applications - automation servers. OLE and OLE Automation were based on the core technology of the Component Object Model (COM), which offers a single binary standard for software components. Objects created using it and registered in the operating system can be used in other applications using executable files or dynamic libraries.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Around the mid-nineties, instead of OLE, another term began to be used - ActiveX. </font><font style="vertical-align: inherit;">Prior to the advent of the .NET platform, ActiveX technology was considered key, and COM objects are still actively used to integrate applications into Windows - many Microsoft and third-party products are automation servers and provide access to their services through them. </font><font style="vertical-align: inherit;">To access objects, ProgID is used - a symbolic identifier that is assigned to them when registering in the Windows registry. </font><font style="vertical-align: inherit;">It has the following form:</font></font><br>
<br>
<pre><code class="powershell hljs">_..</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The version is usually not indicated:</font></font><br>
<br>
<pre><code class="powershell hljs">_.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Some examples of available ProgIDs are: InternetExplorer.Application (Internet Explorer application), Word.Application (Microsoft Word application), WScript.Shell (Shell class from the Windows Script Host or WSH script server object model). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can create an instance of the object using the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">New-Object cmdlet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> discussed in the previous article </font><font style="vertical-align: inherit;">, and see its structure using Get-Member:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$myshell</span> = <span class="hljs-built_in">New-Object</span> <span class="hljs-literal">-ComObject</span> WScript.Shell
<span class="hljs-variable">$myshell</span> | <span class="hljs-built_in">Get-Member</span></code></pre><br>
<img src="https://habrastorage.org/webt/bk/s5/fh/bks5fhq3q-yhle1fwb4-vjkqpk0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To work with objects, properties and methods are used. </font><font style="vertical-align: inherit;">Say, to create a shortcut on the user's desktop, you need to call the CreateShortcut () method:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$link</span> = <span class="hljs-variable">$myshell</span>.CreateShortcut(<span class="hljs-string">"<span class="hljs-variable">$Home</span>\Desktop\Home.lnk"</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Note that the shortcut is also a COM object:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$link</span> | <span class="hljs-built_in">Get-Member</span></code></pre><br>
<img src="https://habrastorage.org/webt/05/d8/4_/05d84_-mbzmfuffczrmr76khfyg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It remains for us to fill out its properties and save:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$link</span>.TargetPath = <span class="hljs-variable">$Home</span>
<span class="hljs-variable">$link</span>.Save()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this way, we created a shortcut on the desktop of the active user, and now we will analyze working with external automation services using the example of the Shell.Application COM object. </font><font style="vertical-align: inherit;">With it, you can automate some actions in Windows Explorer:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$myshell</span>=<span class="hljs-built_in">New-Object</span> <span class="hljs-literal">-ComObject</span> Shell.Application</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
or for short:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$myshell</span>=<span class="hljs-built_in">New-Object</span> <span class="hljs-literal">-com</span> Shell.Application
<span class="hljs-variable">$myshell</span> | <span class="hljs-built_in">Get-Member</span></code></pre><br>
<img src="https://habrastorage.org/webt/__/iu/qy/__iuqyjf29nliwugz-jybihkfj0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The Shell.Application object has quite a few different window management methods. </font><font style="vertical-align: inherit;">For example, to display the contents of a given directory, Explore () is used:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$myshell</span>.Explore(<span class="hljs-string">"c:\"</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The help system is called using the Help () method:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$myshell</span>.Help()</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are also three methods for invoking search dialogs: FindFiles (), FindComputer (), and FindPrinter ().</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$myshell</span>.FindFiles()
<span class="hljs-variable">$myshell</span>.FindComputer()
<span class="hljs-variable">$myshell</span>.FindPrinter()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can open the program launch dialog using the FileRun () method, and to call the date / time setting window, you need the SetTime () method. </font><font style="vertical-align: inherit;">There are, for example, methods for calling up the taskbar settings window, control panel elements indicating one of the available cpl files, for managing open windows:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$myshell</span>.MinimizeAll()
<span class="hljs-variable">$myshell</span>.UndoMinimizeAll()
<span class="hljs-variable">$myshell</span>.TileHorizontally()
<span class="hljs-variable">$myshell</span>.TileVertically()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The Windows () method allows you to access the collection of open windows in Explorer or in Internet Explorer. </font><font style="vertical-align: inherit;">Let's see the properties and methods available for this collection:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$myshell</span>.Windows() | <span class="hljs-built_in">Get-Member</span></code></pre><br>
<img src="https://habrastorage.org/webt/dq/ls/yo/dqlsyokgkrtk6rc-okuskmpwsvo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are other useful COM objects, the number of which depends on the software installed in the system. </font><font style="vertical-align: inherit;">Once upon a time, the main automation tool in Windows was the WSH script server, the object model of which also includes COM objects: designed to work with the network functions of WScript.Network and the WScript.Shell that we already mentioned. </font><font style="vertical-align: inherit;">The latter not only creates shortcuts on the desktop, with its help you can, for example, display information windows with messages and buttons, switch between applications, launch programs or simulate keystrokes.</font></font><br>
<br>
<a name="section4"></a><h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Working with the ADSI Directory Service</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In general, a catalog refers to a source of information in which data about some objects is stored. By directory service, we mean part of a distributed computer system that allows you to access and manipulate stored objects. A directory service can combine data about network objects and the services that manipulate them ‚Äî it represents a single entry point for interacting with network resources. There can be many such services in a heterogeneous computer network: a local SAM (Security Account Manager) for non-domain computers, Active Directory, etc.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Interaction with different directory services requires different tools, which creates certain inconveniences. Beginning in Windows 2000, Microsoft has introduced the unified Active Directory Service Interface (ADSI) technology for operating systems that does not depend on a specific network access protocol. To find objects, a namespace is defined for the directory. Because different directory services use different naming methods, ADSI defines a convention that uniquely identifies any object. The concept of two-part binding strings or ADsPath is introduced. The first part of the name defines the directory service (ADSI provider), and the second - the location of the object in the directory. Here are examples of designating different ADSI providers: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LDAP: //</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">used for LDAP-based directory services, including </font><font style="vertical-align: inherit;">for Active Directory; </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WinNT: //</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> used for local computers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are no special cmdlets for working with ADSI in PowerShell. </font><font style="vertical-align: inherit;">Instead, the cast operator [ADSI] is used followed by a binding string. </font><font style="vertical-align: inherit;">For example, to connect to the user Ivanov from the domain test.ru, the following construction is needed:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$user</span> = [<span class="hljs-type">ADSI</span>]<span class="hljs-string">"LDAP://CN=Ivanov,DC=TEST,DC=RU"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To work with local accounts, you will have to connect to the computer with the corresponding name (to connect to the local computer, just use the dot instead of the name):</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$computer</span> = [<span class="hljs-type">ADSI</span>]<span class="hljs-string">"WinNT://."</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For example, create a new user, Ivanov, on the local machine:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$user</span> = <span class="hljs-variable">$computer</span>.Create(<span class="hljs-string">"user"</span>,<span class="hljs-string">"Ivanov"</span>)
<span class="hljs-variable">$user</span>.Put(<span class="hljs-string">"Description"</span>,<span class="hljs-string">"  PowerShell"</span>)
<span class="hljs-variable">$user</span>.SetInfo()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now connect to it:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$user1</span> = [<span class="hljs-type">ADSI</span>]<span class="hljs-string">"WinNT://./Ivanov,user"</span>
<span class="hljs-variable">$user1</span>.Description</code></pre><br>
<img src="https://habrastorage.org/webt/pb/9l/5m/pb9l5mpw09oocoetnw3x4iawzmm.png"><br>
<br>
<a name="section5"></a><h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Output formatting</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Interactive work often requires displaying data. In other shells, the commands and utilities themselves are engaged in formatting the output, but binary objects returned by functions and cmdlets usually do not know how to do this. In PowerShell, the output is formatted by four special cmdlets that feed objects through the pipeline. More detailed information can be obtained using Get-Help: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Format-Table</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> formats the output in the form of a table whose columns contain the values ‚Äã‚Äãof the object's properties or calculated values. The ability to group data is supported; </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Format-List</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> displays the object as a list of properties, each of which is displayed on a new line. The ability to group data is supported; </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Format-custom</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">formats output using a custom view; </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Format-Wide</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> formats objects in the form of a wide table in which only one property of each object is displayed. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If none of the listed cmdlets is called, the formatting module appropriate to the type of data displayed is used. Display rules are stored in configuration files in XML format with the extension .ps1xml, which are located in the $ PSHome directory. A list of them can be obtained using the following command:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">dir</span> <span class="hljs-variable">$pshome</span>\*format*.ps1xm</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Manually editing configuration files is not recommended; it is better to create your own and include them in the list of downloaded files using the Update-FormatData cmdlet. If the default formatter for the type you want is not defined, PowerShell displays the properties of the object on the screen in a list. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This concludes the description of working with objects in PowerShell, and the final article in the series will be devoted to solving practical problems of managing a distributed information environment of an enterprise. In it, all the described tools are useful to us. The main focus will be on CIM objects and their comparison with WMI. Past parts can be found at the links below.</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="> 1:   Windows PowerShell</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="> 2:     Windows PowerShell</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="> 3:      ,  </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="> 4:   ,  </a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/iq/fi/b4/iqfib45pgphfrxv--zfemt0qnmw.jpeg"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en498458/index.html">Video calls with virtual background and open source tools</a></li>
<li><a href="../en498462/index.html">Infinite scroll with banners, or How to do with three views</a></li>
<li><a href="../en498466/index.html">How lasers and sensors help keep judges nervous</a></li>
<li><a href="../en498472/index.html">Single Page Application Docker Image</a></li>
<li><a href="../en498476/index.html">Accessibility How to make the application accessible to users with disabilities</a></li>
<li><a href="../en498482/index.html">Situation: US providers are asked to remove thresholds for downloading data - which in the end</a></li>
<li><a href="../en498484/index.html">Wi-Fi 6 and Huawei P40: where is the connection?</a></li>
<li><a href="../en498486/index.html">How to expand English-language semantics for search advertising in a narrow niche</a></li>
<li><a href="../en498490/index.html">An effective certification system that will allow you to become a better leader</a></li>
<li><a href="../en498492/index.html">Honey, we kill bureaucracy: how digitalization is changing the dialogue between suppliers and X5</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>