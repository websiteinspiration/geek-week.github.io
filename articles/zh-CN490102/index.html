<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏷️ 🕚 🥨 wc到D：712个字符（无单个分支） 🐤 🤱🏼 🍨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="阅读在Hacker News上找到的“在Haskell上用80行程序击败Beat ”之后，我决定D可能会更好。我在 D.Note.per中写了wc 。我建议翻译上面的文章
 
0xd34df00d，但他更愿意根据他的著作《用Haskell的20条线取胜：写你的Wc》来制作。现在，这些文章正像重新生成...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>wc到D：712个字符（无单个分支）</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/490102/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阅读</font><font style="vertical-align: inherit;">在</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">Hacker News</font></a><font style="vertical-align: inherit;">上找到的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“在Haskell上用80行程序击败Beat</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”之后</font><font style="vertical-align: inherit;">，我决定D可能会更好。</font><font style="vertical-align: inherit;">我在</font><font style="vertical-align: inherit;">
D.Note.per中</font><font style="vertical-align: inherit;">写了wc </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我建议翻译上面的文章</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xd34df00d</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但他更愿意根据他的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">著作《用Haskell的20条线取胜：写你的Wc》来制作</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">现在，这些</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文章</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正像重新生成“铸造的硬币”一样</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">繁衍</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">程序</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
包含一个文件-34行和712个字符。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">源代码</font></font></b><div class="spoiler_text"><pre><code class="swift hljs"><span class="hljs-keyword">import</span> std.stdio : writefln, File;
<span class="hljs-keyword">import</span> std.algorithm : map, fold, splitter;
<span class="hljs-keyword">import</span> std.range : walkLength;
<span class="hljs-keyword">import</span> std.typecons : Yes;
<span class="hljs-keyword">import</span> std.uni : byCodePoint;<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Line</span> </span>{<font></font>
	size_t chars;<font></font>
	size_t words;<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Output</span> </span>{<font></font>
	size_t lines;<font></font>
	size_t words;<font></font>
	size_t chars;<font></font>
}<font></font>
<font></font>
<span class="hljs-type">Output</span> combine(<span class="hljs-type">Output</span> a, <span class="hljs-type">Line</span> b) pure nothrow {
	<span class="hljs-keyword">return</span> <span class="hljs-type">Output</span>(a.lines + <span class="hljs-number">1</span>, a.words + b.words, a.chars + b.chars);<font></font>
}<font></font>
<font></font>
<span class="hljs-type">Line</span> toLine(char[] l) pure {
	<span class="hljs-keyword">return</span> <span class="hljs-type">Line</span>(l.byCodePoint.walkLength, l.splitter.walkLength);<font></font>
}<font></font>
<font></font>
void main(string[] args) {<font></font>
	auto f = <span class="hljs-type">File</span>(args[<span class="hljs-number">1</span>]);
	<span class="hljs-type">Output</span> o = f<font></font>
		.byLine(<span class="hljs-type">Yes</span>.keepTerminator)<font></font>
		.<span class="hljs-built_in">map</span>!(l =&gt; toLine(l))<font></font>
		.fold!(combine)(<span class="hljs-type">Output</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>));<font></font>
<font></font>
	writefln!<span class="hljs-string">"%u %u %u %s"</span>(o.lines, o.words, o.chars, args[<span class="hljs-number">1</span>]);<font></font>
}</code></pre><br>
</div></div><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当然，他使用</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D标准库Phobos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但是为什么不呢？</font><font style="vertical-align: inherit;">Phobos很漂亮，并且随每个D编译器一起提供，程序本身不包含任何if语句。</font><font style="vertical-align: inherit;">在Haskell的wc实现中，使用了多个if。</font><font style="vertical-align: inherit;">除了主程序外，D程序还包含三个其他小功能。</font><font style="vertical-align: inherit;">我可以轻松地将所有功能放在一个范围链中，但是每行可能会超过80个字符。</font><font style="vertical-align: inherit;">这是代码样式的基本原理。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">性能</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
是D上的wc比coreutils wc快吗？</font><font style="vertical-align: inherit;">不，但是我花了15分钟来编写我的版本（我不得不寻找walkLength，因为我忘记了函数的名称）。</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">资料档案</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字节</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coreutils</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈斯克尔</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程式</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">46</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">906</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.5毫秒±1.9毫秒</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">39.6毫秒±7.8毫秒</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.9毫秒±2.1毫秒</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">big.txt</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">862</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">64k</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.7毫秒±2.0毫秒</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">39.6毫秒±7.8毫秒</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.8毫秒±2.1毫秒</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vbig.txt</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">170万</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">96M</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">658.6毫秒±24.5毫秒</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">226.4毫秒±29.5毫秒</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.102秒±0.022秒</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vbig2.txt</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1210万</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">671M</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4秒±0.058秒</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1秒±0.039秒</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4秒±0.085秒</font></font></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
记忆：</font></font><div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">资料档案</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coreutils</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈斯克尔</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程式</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2052千</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7228K</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7708K</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">big.txt</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2112K</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7512K</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7616千</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vbig.txt</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2288千</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">42620K</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7712K</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vbig2.txt</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2360千</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50860千</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7736千</font></font></td>
</tr>
</tbody></table></div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在Haskell上工作更快？</font><font style="vertical-align: inherit;">当然，对于大文件，它使用多线程。</font><font style="vertical-align: inherit;">对于小文件，GNU coreutils仍然胜出。</font><font style="vertical-align: inherit;">在此阶段，我的版本很可能受到IO的限制，无论如何，它都非常快。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我不会说一种语言比另一种语言快。</font><font style="vertical-align: inherit;">如果您花时间优化微基准测试，您很可能会获胜。</font><font style="vertical-align: inherit;">但是在现实生活中却不是。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是我会争辩说，D中的函数式编程几乎可以赶上Haskell中的FP。</font></font></b><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于D的范围</font></font></h3><br>
<img src="https://habrastorage.org/webt/gp/qe/oo/gpqeookkvehf2hdsowdegomcqai.png" align="left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">range是可以迭代而无需接触基础集合（如果有）的抽象。</font><font style="vertical-align: inherit;">从技术上讲，范围可以是实现一个或多个Range接口的结构或类。</font><font style="vertical-align: inherit;">最简单的形式InputRange需要一个函数</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">popFront</span><span class="hljs-params">()</span></span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和两个成员或属性 </font></font><br>
<br>
<pre><code class="cpp hljs">T front;
<span class="hljs-keyword">bool</span> empty;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
T是元素的一种通用类型，它在范围内进行迭代。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D范围是特定类型。</font><font style="vertical-align: inherit;">当范围落入foreach语句时，编译器会进行一些小的修改。</font></font><br>
<br>
<pre><code class="cpp hljs">foreach (e; range) { ... }</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
变成 </font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> __r = range; !__r.empty; __r.popFront()) {
    <span class="hljs-keyword">auto</span> e = __r.front;<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
auto e =计算类型，并等于T e =。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
考虑到这一点，很容易创建可被foreach使用的范围。</font></font><br>
<br>
<pre><code class="java hljs">struct Iota {
	<span class="hljs-keyword">int</span> front;
	<span class="hljs-keyword">int</span> end;<font></font>
<font></font>
	<span class="hljs-meta">@property</span> <span class="hljs-function">bool <span class="hljs-title">empty</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.front == <span class="hljs-keyword">this</span>.end;<font></font>
	}<font></font>
<font></font>
	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">popFront</span><span class="hljs-params">()</span> </span>{<font></font>
		++<span class="hljs-keyword">this</span>.front;<font></font>
	}<font></font>
}<font></font>
<font></font>
unittest {<font></font>
	<span class="hljs-keyword">import</span> std.stdio;<font></font>
	foreach(it; Iota(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>)) {<font></font>
		writeln(it);<font></font>
	}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IOTA是范围的一个非常简单的示例。</font><font style="vertical-align: inherit;">它充当生成器，而没有基础集合。</font><font style="vertical-align: inherit;">从头到尾以1为增量迭代整数。</font><font style="vertical-align: inherit;">该代码段显示了一些D语法。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@property</span> <span class="hljs-function">bool <span class="hljs-title">empty</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@属性</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
属性</font><font style="vertical-align: inherit;">允许您以</font><font style="vertical-align: inherit;">与成员变量相同的方式</font><font style="vertical-align: inherit;">使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">（调用不带括号的函数）。最后的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">意味着我们不会修改我们称为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">empty</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的实例数据</font><font style="vertical-align: inherit;">。内置的单元测试可打印从0到10的数字。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
另一个小功能是缺少显式构造函数。 Iota结构具有两个int成员变量。在测试的foreach语句中，我们创建一个Iota实例，就好像它具有接受两个整数的构造函数一样。这是结构文字。当编译器D看到这一点，但结构没有相应的构造函数时，则按照变量声明的顺序-结构成员将被分配为int。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这三个成员之间的关系很简单。</font><font style="vertical-align: inherit;">如果empty为false，则保证在调用popFront之后，front可以在迭代之后返回一个新元素。</font><font style="vertical-align: inherit;">调用popFront之后，空值可能会更改。</font><font style="vertical-align: inherit;">如果为真，则意味着不再有要迭代的元素，并且对front的进一步调用无效。</font><font style="vertical-align: inherit;">根据</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InputRange文档</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅当空返回或将返回false时，才能正确计算front。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以调用多次front而不用调用popFront或以其他方式更改范围或基础数据，并且每次计算都得出相同的结果。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用foreach表达式或循环不是很有功能。</font><font style="vertical-align: inherit;">假设我们要过滤掉Iota的所有奇数。</font><font style="vertical-align: inherit;">我们可以在ifeach块中放入if，但这只会使情况更糟。</font><font style="vertical-align: inherit;">如果我们有一个接受范围的范围和一个决定一个元素是否合适的谓词，那就更好了。</font></font><br>
<br>
<pre><code class="java hljs">struct Filter {<font></font>
	Iota input;<font></font>
	<span class="hljs-function">bool <span class="hljs-title">function</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span> predicate</span>;<font></font>
<font></font>
	<span class="hljs-keyword">this</span>(Iota input, <span class="hljs-function">bool <span class="hljs-title">function</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span> predicate) </span>{
		<span class="hljs-keyword">this</span>.input = input;
		<span class="hljs-keyword">this</span>.predicate = predicate;
		<span class="hljs-keyword">this</span>.testAndIterate();<font></font>
	}<font></font>
<font></font>
	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testAndIterate</span><span class="hljs-params">()</span> </span>{
		<span class="hljs-keyword">while</span>(!<span class="hljs-keyword">this</span>.input.empty<font></font>
				&amp;&amp; !<span class="hljs-keyword">this</span>.predicate(<span class="hljs-keyword">this</span>.input.front))<font></font>
		{<font></font>
			<span class="hljs-keyword">this</span>.input.popFront();<font></font>
		}<font></font>
	}<font></font>
<font></font>
	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">popFront</span><span class="hljs-params">()</span> </span>{
		<span class="hljs-keyword">this</span>.input.popFront();
		<span class="hljs-keyword">this</span>.testAndIterate();<font></font>
	}<font></font>
<font></font>
	<span class="hljs-meta">@property</span> <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">front</span><span class="hljs-params">()</span> </span>{
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.input.front;<font></font>
	}<font></font>
<font></font>
	<span class="hljs-meta">@property</span> <span class="hljs-function">bool <span class="hljs-title">empty</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.input.empty;<font></font>
	}<font></font>
}<font></font>
<font></font>
<span class="hljs-function">bool <span class="hljs-title">isEven</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a)</span> </span>{
	<span class="hljs-keyword">return</span> a % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
unittest {<font></font>
	foreach(it; Filter(Iota(<span class="hljs-number">0</span>,<span class="hljs-number">10</span>), &amp;isEven)) {<font></font>
		writeln(it);<font></font>
	}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
过滤器也非常简单：需要Iota和函数指针。</font><font style="vertical-align: inherit;">在构造Filter时，我们调用testAndIterate，它从Iota中获取元素，直到它为空或谓词返回false。</font><font style="vertical-align: inherit;">这个想法是谓词决定要过滤的内容和要保留的内容。</font><font style="vertical-align: inherit;">front和empty属性仅转换为Iota。</font><font style="vertical-align: inherit;">真正完成这项工作的唯一一件事就是popFront。</font><font style="vertical-align: inherit;">它返回当前项目并调用testAndIterate。</font><font style="vertical-align: inherit;">就这样。</font><font style="vertical-align: inherit;">这是一个过滤器实现。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当然，testAndIterate有一个while循环，但是在我看来，使用递归重写它只是愚蠢的。 D的出色之处在于，您可以为每个任务使用适当的方法。函数式编程是好的，并且经常炫耀，但有时不是。如果需要一点嵌入式汇编程序，或者更有趣，请使用。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调用Filter看起来仍然不太好。</font><font style="vertical-align: inherit;">假设您习惯于从左到右阅读，“过滤器”将在Iota之前显示，即使它在Iota之后运行。</font><font style="vertical-align: inherit;">D不提供管道语句，而是使用统一函数调用语法（UFCS）。</font><font style="vertical-align: inherit;">如果可以将表达式隐式转换为函数的第一个参数，则可以像该表达式的成员函数一样调用该函数。</font><font style="vertical-align: inherit;">我知道这很复杂。</font><font style="vertical-align: inherit;">一个例子会有所帮助：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">foo</span><span class="hljs-params">(<span class="hljs-built_in">string</span> a)</span> </span>{
	<span class="hljs-keyword">return</span> a ~ <span class="hljs-string">"World"</span>;<font></font>
}<font></font>
<font></font>
unittest {<font></font>
	<span class="hljs-built_in">string</span> a = foo(<span class="hljs-string">"Hello "</span>);
	<span class="hljs-built_in">string</span> b = <span class="hljs-string">"Hello "</span>.foo();<font></font>
	assert(a == b);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上面的示例显示了对foo函数的两次调用。</font><font style="vertical-align: inherit;">正如断言所暗示的，两个调用都是等效的。</font><font style="vertical-align: inherit;">这对于我们的Io​​ta筛选器示例意味着什么？</font><font style="vertical-align: inherit;">UFCS允许我们这样重写单元测试：</font></font><br>
<br>
<pre><code class="swift hljs">unittest {<font></font>
	foreach(it; <span class="hljs-type">Iota</span>(<span class="hljs-number">1</span>,<span class="hljs-number">10</span>).<span class="hljs-type">Filter</span>(&amp;isEven)) {<font></font>
		writeln(it);<font></font>
	}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，每个读者都可以访问范围的地图/变换实现。</font><font style="vertical-align: inherit;">当然，可以使用模板使过滤器更抽象，但这只是细节，从概念上讲并不是什么新鲜事。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当然，存在不同类型的范围，例如双向。</font><font style="vertical-align: inherit;">猜猜这给您带来了什么机会。</font><font style="vertical-align: inherit;">快速提示：双向范围内有两个新的原语，称为back和popBack。</font><font style="vertical-align: inherit;">范围还有其他类型，但是在两次理解上面显示的输入范围之后，您几乎都可以识别它们。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS只是为了清楚起见，请勿实现自己的过滤器，地图或折叠；</font><font style="vertical-align: inherit;">Phobos D标准库可满足您的所有需求。</font><font style="vertical-align: inherit;">看一下</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">std.algorithm</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">std.range</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于作者</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Robert Schadeck在奥尔登堡大学获得计算机科学硕士学位。</font><font style="vertical-align: inherit;">他的硕士论文题目为“ DMCD-具有缓存的分布式多线程D编译器”，在那里他从头开始创建D编译器。</font><font style="vertical-align: inherit;">他于2012-2018年毕业于计算机科学专业。</font><font style="vertical-align: inherit;">在奥尔登堡大学。</font><font style="vertical-align: inherit;">他的博士学位论文着重于定额系统和图形。</font><font style="vertical-align: inherit;">自2018年以来，他很高兴在Symmetry Investments的日常工作中使用D.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于对称投资</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Symmetry Investments是一家全球投资公司，在香港，新加坡和伦敦设有办事处。</font><font style="vertical-align: inherit;">自从一家主要的纽约对冲基金成功分离后，我们自2014年以来一直开展业务。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在Symmetry，我们努力合理地冒险，为我们的客户，合作伙伴和员工创造价值。从广义上讲，我们从产生双赢合同的能力中受益。双赢是我们的基本道德和战略原则。通过产生双赢的选择，我们可以创建独特的解决方案，结合通常被认为是不兼容或相反的观点，并涵盖各方能够提供的所有最佳方法。我们正在将固定收益仲裁与全球宏观战略重新整合。我们发明并开发了一种专注于人机集成潜力的技术。我们创建的系统中，机器可以发挥最大作用，为这样他们才能做到最好。我们正在建立基于协作的精英管理：一种文化，在这种文化中，个人贡献既可以实现个人目标，也可以实现集体目标，并因此得到回报。我们既重视主人翁意识，也重视合作，自我实现和社区的团队精神。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
自2014年以来，Symmetry Investments人们一直是社区D的活跃成员。</font><font style="vertical-align: inherit;">我们赞助了excel-d，dpp，autowrap，libmir等项目的开发。</font><font style="vertical-align: inherit;">我们于2018年启动了Symmetry秋季代码大会，并在伦敦举办了DConf 2019。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
大约 </font><font style="vertical-align: inherit;">由于翻译员像往常一样喝醉了，因此我无法保证某些人类术语的准确性，并且在上一节中我什么都不懂。</font><font style="vertical-align: inherit;">因此，请发送个人更正中的更正。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN490088/index.html">如何继续在UE4中创建地图</a></li>
<li><a href="../zh-CN490092/index.html">亚历山大·特鲁汉诺夫（Alexander Trukhanov）的安德烈·扎雷茨基（Andrei Zaretsky）：“这笔费用足以喝咖啡”</a></li>
<li><a href="../zh-CN490094/index.html">追溯到根源：我们直接从MBR驱动计算机</a></li>
<li><a href="../zh-CN490096/index.html">为Raspberry Pi制作微型USB集线器的简便方法</a></li>
<li><a href="../zh-CN490100/index.html">开发用于分散式踏板车租赁的软件。谁说会容易？</a></li>
<li><a href="../zh-CN490104/index.html">博世的智能遮阳板。原型测试</a></li>
<li><a href="../zh-CN490110/index.html">从开发人员到经理，反之亦然</a></li>
<li><a href="../zh-CN490112/index.html">Монады как паттерн переиспользования кода</a></li>
<li><a href="../zh-CN490114/index.html">Yandex.Practicum-数据分析师。毕业</a></li>
<li><a href="../zh-CN490118/index.html">关于SERM的10个最重要的事实</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>