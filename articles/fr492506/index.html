<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💲 🚕 ◾️ 3 façons de rendre de grandes listes en angulaire 👩🏾‍🤝‍👩🏼 🐧 🕳️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En 2020, les cadres frontaux sont devenus meilleurs, plus efficaces et plus rapides. Mais, même dans cet esprit, le rendu de grandes listes sans geler...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>3 façons de rendre de grandes listes en angulaire</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/492506/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En 2020, les cadres frontaux sont devenus meilleurs, plus efficaces et plus rapides. Mais, même dans cet esprit, le rendu de grandes listes sans geler le navigateur peut toujours être une tâche intimidante même pour les cadres existants les plus rapides. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est l'un de ces cas où «le cadre est rapide et le code est lent». </font><font style="vertical-align: inherit;">
Il existe de nombreuses approches qui vous permettent d'afficher un grand nombre d'éléments sans bloquer l'interaction de l'utilisateur avec la page Web. </font><font style="vertical-align: inherit;">
L'auteur de l'article, dont nous publions aujourd'hui la traduction, souhaite explorer les méthodes existantes d'affichage de grandes listes sur des pages Web et parler de leurs domaines d'application.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/ql/ap/04/qlap04o-7mdhzho6nedwbgz64gk.jpeg"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien que ce matériel soit destiné à Angular, ce qui est discuté ici s'applique à d'autres frameworks et projets qui sont écrits en JavaScript pur. </font><font style="vertical-align: inherit;">En particulier, les approches suivantes pour rendre de grandes listes seront considérées ici:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Défilement virtuel (en utilisant Angular CDK).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rendu manuel.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rendu progressif.</font></font></li>
</ul><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Défilement virtuel</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le défilement virtuel est peut-être le moyen le plus efficace de travailler avec de grandes listes. </font><font style="vertical-align: inherit;">Certes, il a quelques inconvénients. </font><font style="vertical-align: inherit;">Le défilement virtuel, grâce au </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Angular CDK</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et à d'autres plugins, est très facile à implémenter dans n'importe quel composant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'idée derrière le défilement virtuel est simple, mais pas toujours facile à mettre en œuvre. </font><font style="vertical-align: inherit;">L'essentiel ici est que nous avons un conteneur et une liste d'éléments. </font><font style="vertical-align: inherit;">Un élément n'est rendu que s'il se trouve dans la zone visible du conteneur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous utiliserons le module </font></font><code>scrolling</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">du CDK angulaire, qui est conçu pour organiser le défilement virtuel. </font><font style="vertical-align: inherit;">Pour ce faire, vous devez d'abord installer le CDK:</font></font><br>
<br>
<pre><code class="bash hljs">npm i @angular/cdk
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, vous devez importer le module:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { ScrollingModule } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/cdk/scrolling'</span>;<font></font>
@NgModule({<font></font>
&nbsp;...<font></font>
&nbsp;imports: [ ScrollingModule, ...]<font></font>
})<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppModule</span> </span>{}
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après cela, dans les composants, vous pouvez utiliser </font></font><code>cdk-virtual-scroll-viewport</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">cdk-virtual-scroll-viewport</span> <span class="hljs-attr">itemSize</span>=<span class="hljs-string">"50"</span>&gt;</span>
&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">cdkVirtualFor</span>=<span class="hljs-string">"let item of items"</span>&gt;</span><font></font>
&nbsp;&nbsp;&nbsp;{{ item }}<font></font>
&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">cdk-virtual-scroll-viewport</span>&gt;</span>
</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> un exemple de projet qui utilise cette approche pour organiser le défilement virtuel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir, les mécanismes angulaires standard permettent, sans trop de difficulté, d'obtenir des résultats impressionnants. Le composant dans l'exemple rend plusieurs milliers d'éléments sans aucun problème. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si le défilement virtuel est si bon et s'il est si facile à mettre en œuvre, la question se pose de savoir pourquoi étudier d'autres façons de rendre de grandes listes. J'étais également intéressé par cette question. Il s'est avéré que cette situation a plusieurs raisons:</font></font><br>
<br>
<ul>
<li>,      ,     .        ,     . ,      <code>Autocomplete</code> (    ).  , ,    ,   ,  .     —        .</li>
<li>      —    ,    .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il y a quelques problèmes d'accessibilité et de facilité d'utilisation du contenu d'une liste avec défilement virtuel. </font><font style="vertical-align: inherit;">Les éléments masqués ne sont pas rendus - cela signifie qu'ils ne seront pas disponibles pour les lecteurs d'écran et qu'ils ne peuvent pas être trouvés sur la page à l'aide des mécanismes de navigateur standard.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le défilement virtuel est idéal dans un certain nombre de situations (à condition que cela fonctionne):</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans ce cas, si vous souhaitez afficher des listes dont la taille n'est pas connue à l'avance, ou celles qui peuvent être énormes (selon une estimation approximative, des listes qui comprennent plus de 5000 éléments, mais cela dépend grandement de la complexité de chaque élément).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans le cas où vous devez organiser un défilement sans fin.</font></font></li>
</ul><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rendu manuel</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'une des façons de travailler avec des listes que j'ai essayé d'accélérer la sortie d'un grand ensemble d'éléments est d'utiliser à la place le rendu manuel à l'aide de l'API angulaire </font></font><code>*ngFor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons un modèle simple qui utilise une boucle organisée en utilisant la directive *</font></font><code>ngFor</code><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&nbsp;
*<span class="hljs-attr">ngFor</span>=<span class="hljs-string">"let item of data; trackBy: trackById; let isEven = even; let isOdd = odd"</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">class</span>=<span class="hljs-string">"h-12"</span>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="hljs-attr">class.bg-gray-400</span>]=<span class="hljs-string">"isEven"</span>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="hljs-attr">class.bg-gray-500</span>]=<span class="hljs-string">"isOdd"</span>
&gt;</span>
&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"py-2 px-4"</span>&gt;</span>{{ item.id }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><font></font>
<font></font>
&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{{ item.label }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><font></font>
<font></font>
&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"py-2 px-4 rounded (click)="</span><span class="hljs-attr">remove</span>(<span class="hljs-attr">item</span>)"&gt;</span>x<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour mesurer les performances de rendu de 10 000 éléments simples, j'ai utilisé un benchmark basé sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">js-frameworks-benchmark</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, j'ai examiné les performances d'une liste, qui utilise une boucle régulière pour sortir </font></font><code>*ngFor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">En conséquence, il s'est avéré que l'exécution du code (Scripting) a pris 1099 ms., Le rendu (Rendering) a pris 1553 ms., Et le dessin (Painting) - 3 ms.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bdc/65d/617/bdc65d6174798028877e98bdcc7830d8.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une étude des performances de la liste, qui utilise * ngFor pour afficher la sortie. Les</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
éléments de la</font><i><font color="#999999"><font style="vertical-align: inherit;"> liste</font></font></i><font style="vertical-align: inherit;"> peuvent être rendus manuellement à l'aide de l'API angulaire:</font></font><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span>
&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">ng-container</span> #<span class="hljs-attr">itemsContainer</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ng-container</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">ng-template</span> #<span class="hljs-attr">item</span> <span class="hljs-attr">let-item</span>=<span class="hljs-string">"item"</span> <span class="hljs-attr">let-isEven</span>=<span class="hljs-string">"isEven"</span>&gt;</span>
&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"h-12 "</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="hljs-attr">class.bg-gray-400</span>]=<span class="hljs-string">"isEven"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="hljs-attr">class.bg-gray-500</span>]=<span class="hljs-string">"!isEven"</span>
&nbsp;&nbsp;&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"py-2 px-4"</span>&gt;</span>{{ item.id }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{{ item.label }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"py-2 px-4 rounded"</span> (<span class="hljs-attr">click</span>)=<span class="hljs-string">"remove(item)"</span>&gt;</span>x<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ng-template</span>&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parlons de la façon dont le code du contrôleur a changé. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons déclaré un modèle et un conteneur:</font></font><br>
<br>
<pre><code class="html hljs xml">@ViewChild('itemsContainer', { read: ViewContainerRef }) container: ViewContainerRef;<font></font>
@ViewChild('item', { read: TemplateRef }) template: TemplateRef<span class="hljs-tag">&lt;<span class="hljs-name">any</span>&gt;</span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors de la génération de données, nous les rendons à l'aide de la méthode d' </font></font><code>createEmbeddedView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entité </font></font><code>ViewContainerRef</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="html hljs xml">private buildData(length: number) {<font></font>
&nbsp;&nbsp;const start = this.data.length;<font></font>
&nbsp;&nbsp;const end = start + length;<font></font>
<font></font>
&nbsp;&nbsp;for (let n = start; n <span class="hljs-tag">&lt;<span class="hljs-name">=</span> <span class="hljs-attr">end</span>; <span class="hljs-attr">n</span>++) {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">this.container.createEmbeddedView</span>(<span class="hljs-attr">this.template</span>, {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">item:</span> {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">id:</span> <span class="hljs-attr">n</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">label:</span> <span class="hljs-attr">Math.random</span>()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">isEven:</span> <span class="hljs-attr">n</span> % <span class="hljs-attr">2</span> === <span class="hljs-string">0</span>
&nbsp;&nbsp;&nbsp;&nbsp;});
&nbsp;&nbsp;}
}
</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conséquence, les indicateurs caractérisant les performances de la liste ont été légèrement améliorés. </font><font style="vertical-align: inherit;">A savoir, il a fallu 734 ms pour exécuter le code, 1443 ms pour restituer, 2 ms pour dessiner.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a67/3dd/0c5/a673dd0c5ca9c97dc057124d056646e7.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La recherche des performances d'une liste qui utilise l'API angulaire pour afficher</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
True, dans la pratique, cela signifie que la liste est toujours extrêmement lente. </font><font style="vertical-align: inherit;">Lorsque vous cliquez sur le bouton approprié, le navigateur «se fige» pendant quelques secondes. </font><font style="vertical-align: inherit;">Si cela apparaissait en production, les utilisateurs ne l'apprécieraient certainement pas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici à quoi cela ressemble (ici, à l'aide de la souris, j'imite l'indicateur de chargement).</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f45/5a3/6bc/f455a36bc281147be801caed867b1f1f.gif"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ralentissement de la liste</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Maintenant, pour améliorer le rendu manuel des listes, nous allons essayer d'appliquer la technologie de rendu progressif.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rendu progressif</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'idée du rendu progressif est simple. </font><font style="vertical-align: inherit;">Il consiste à restituer progressivement un sous-ensemble d'éléments, à reporter le rendu des autres éléments dans la boucle d'événement. </font><font style="vertical-align: inherit;">Cela permet au navigateur d'afficher tous les éléments sans "ralentir". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code ci-dessous qui implémente le rendu de liste progressif est très simple:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D'abord, en utilisant ceci </font></font><code>setInterval</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, nous établissons un appel régulier, toutes les 10 ms. Une fonction qui rend 500 éléments lorsqu'elle est appelée.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une fois tous les éléments déduits, que nous déterminons sur la base de l'analyse de l'index de l'élément courant, nous arrêtons l'appel de fonction régulier et interrompons le cycle.</font></font></li>
</ul><br>
<pre><code class="javascript hljs">private buildData(length: number) {
&nbsp;&nbsp;<span class="hljs-keyword">const</span> ITEMS_RENDERED_AT_ONCE = <span class="hljs-number">500</span>;
&nbsp;&nbsp;<span class="hljs-keyword">const</span> INTERVAL_IN_MS = <span class="hljs-number">10</span>;<font></font>
<font></font>
&nbsp;&nbsp;<span class="hljs-keyword">let</span> currentIndex = <span class="hljs-number">0</span>;<font></font>
<font></font>
&nbsp;&nbsp;<span class="hljs-keyword">const</span> interval = setInterval(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span> nextIndex = currentIndex + ITEMS_RENDERED_AT_ONCE;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> n = currentIndex; n &lt;= nextIndex ; n++) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> (n &gt;= length) {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clearInterval(interval);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">break</span>;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span> context = {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">item</span>: {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">id</span>: n,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">label</span>: <span class="hljs-built_in">Math</span>.random()<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">isEven</span>: n % <span class="hljs-number">2</span> === <span class="hljs-number">0</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.container.createEmbeddedView(<span class="hljs-keyword">this</span>.template, context);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;currentIndex += ITEMS_RENDERED_AT_ONCE;<font></font>
&nbsp;&nbsp;}, INTERVAL_IN_MS);<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veuillez noter que le nombre d'éléments affichés par appel à la fonction en cours de transfert </font></font><code>setInterval</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ainsi que la fréquence de l'appel à cette fonction, dépendent entièrement des circonstances. Par exemple, si les éléments de la liste affichée sont très complexes, la sortie de 500 de ces éléments en une seule fois sera trop lente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En mesurant les performances de cette solution, j'ai obtenu des résultats plus mauvais que ceux que j'ai reçus plus tôt. Exécution de code - 907 ms., Rendu - 2555 ms., Dessin - 16 ms.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8eb/91e/bdc/8eb91ebdce039a630cb7ff043afdcb38.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rechercher les performances d'une liste, dont la sortie utilise un rendu progressif,</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
mais l'utilisateur, travaillant avec une telle liste, ressentira des sensations beaucoup plus agréables qu'auparavant. </font><font style="vertical-align: inherit;">Bien que le temps requis pour rendre la liste ait augmenté, l'utilisateur ne le remarquera pas. </font><font style="vertical-align: inherit;">Nous rendons en une seule fois 500 éléments. </font><font style="vertical-align: inherit;">Dans ce cas, le rendu est effectué en dehors des limites du conteneur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, certains problèmes peuvent survenir du fait que le conteneur change de taille pendant le rendu ou que la position du défilement de contenu change. </font><font style="vertical-align: inherit;">Si cela se produit, vous devrez faire face à des problèmes similaires. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici à quoi ressemble une telle liste.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d85/34a/33c/d8534a33c099a4f62a561802db2ff995.gif"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La liste est rapide</font></font></font></i><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sommaire</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les techniques de rendu manuel et progressif pour les grandes listes sont certainement utiles dans certaines situations. </font><font style="vertical-align: inherit;">Je les ai utilisés dans des cas où le défilement virtuel pour une raison quelconque ne me convenait pas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Compte tenu de ce qui précède, nous pouvons dire que le plus souvent le défilement virtuel, construit sur la base d'une bonne bibliothèque, comme le CDK angulaire, est le meilleur moyen d'afficher de grandes listes. </font><font style="vertical-align: inherit;">Mais si pour une raison quelconque le défilement virtuel ne peut pas être utilisé, le développeur a d'autres possibilités. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chers lecteurs! </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment sortez-vous de grandes listes dans vos projets Web?</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr492492/index.html">NikiRobot - une évolution de la robotique éducative</a></li>
<li><a href="../fr492496/index.html">Exemple de SPA Simple Notes sur Mithril.js</a></li>
<li><a href="../fr492500/index.html">Garage scientifique en russe. Expérience de traduction d'un spectacle américain</a></li>
<li><a href="../fr492502/index.html">MIP * = RE: preuve historique du domaine de l'informatique qui a provoqué l'effet domino en physique et en mathématiques</a></li>
<li><a href="../fr492504/index.html">Que se passe-t-il lorsqu'un module JS est importé deux fois?</a></li>
<li><a href="../fr492508/index.html">Réservez Kubernetes pour DevOps</a></li>
<li><a href="../fr492510/index.html">Modules ES6 dans le navigateur: sont-ils prêts ou non?</a></li>
<li><a href="../fr492512/index.html">CSS: aventures au pays de la translucidité</a></li>
<li><a href="../fr492514/index.html">Comment établir un flux de documents électroniques juridiquement significatif des contreparties en Russie et au Kazakhstan?</a></li>
<li><a href="../fr492518/index.html">L'épidémie de virus nécessite un travail à distance, ce qui signifie la signature numérique des documents</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>