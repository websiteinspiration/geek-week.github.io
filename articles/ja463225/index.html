<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕡 😁 🕝 WiFiエンタープライズ。FreeRadius + FreeIPA + Ubiquiti 🎪 👨🏽 🎅</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="企業WiFiのいくつかの例はすでに説明されています。ここでは、同様のソリューションを実装する方法と、さまざまなデバイスに接続するときに直面しなければならない問題について説明します。確立されたユーザーで既存のLDAPを使用し、FreeRadiusを上げ、UbntコントローラーでWPA2-Enterpr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>WiFiエンタープライズ。FreeRadius + FreeIPA + Ubiquiti</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/463225/"><img src="https://habrastorage.org/webt/2w/tm/tw/2wtmtwbdgzq2u6yp-ujvywpl4rw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
企業WiFiのいくつかの例はすでに説明されています。</font><font style="vertical-align: inherit;">ここでは、同様のソリューションを実装する方法と、さまざまなデバイスに接続するときに直面しなければならない問題について説明します。</font><font style="vertical-align: inherit;">確立されたユーザーで既存のLDAPを使用し、FreeRadiusを上げ、UbntコントローラーでWPA2-Enterpriseを構成します。</font><font style="vertical-align: inherit;">すべてが単純なようです。</font><font style="vertical-align: inherit;">様子を見よう…</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EAPメソッドについて少し</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
タスクに進む前に、ソリューションで使用する認証方法を決定する必要があります。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウィキペディアから：</font></font></b><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EAPは、ワイヤレスネットワークやポイントツーポイント接続でよく使用される認証フレームワークです。</font><font style="vertical-align: inherit;">この形式は、RFC 3748で最初に説明され、RFC 5247で更新されました。EAP </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
は、認証方法の選択、キーの転送、およびEAPメソッドと呼ばれるプラグインによるこれらのキーの処理に使用されます。</font><font style="vertical-align: inherit;">多くのEAP方式があり、両方ともEAP自体で定義されています。</font><font style="vertical-align: inherit;">EAPはリンク層を定義せず、メッセージ形式のみを定義します。</font><font style="vertical-align: inherit;">EAPを使用する各プロトコルには、EAPメッセージをカプセル化するための独自のプロトコルがあります。</font></font></blockquote><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッド自体：</font></font></b><br>
<br>
<ul>
<li>LEAP —  ,  CISCO.  .       </li>
<li> EAP-TLS —      .   ,    SSL .    .     .     </li>
<li> EAP-TTLS —     ,   ,  PKI      </li>
<li> EAP-MD5 —   .   . ,        </li>
<li> EAP-IKEv2 —   Internet Key Exchange Protocol version 2.            </li>
<li> PEAP —   CISCO, Microsoft  RSA Security   .    ,    .   EAP-TTLS,       </li>
<li> PEAPv0/EAP-MSCHAPv2 —  EAP-TLS,       .  -   Microsoft, Cisco, Apple, Linux </li>
<li> PEAPv1/EAP-GTC —  Cisco   PEAPv0/EAP-MSCHAPv2.       .    Windows OS </li>
<li> EAP-FAST — ,  Cisco    LEAP.  Protected Access Credential (PAC).    </li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このすべての多様性の中で、選択はまだ大きくありません。</font><font style="vertical-align: inherit;">認証方法が必要でした：優れたセキュリティ、すべてのデバイス（Windows 10、macOS、Linux、Android、iOS）でのサポート、そして実際、シンプルな方が良いです。</font><font style="vertical-align: inherit;">そのため、PAPプロトコルと組み合わせてEAP-TTLSを選択することになりました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おそらく疑問が生じる-なぜPAPを使うのか？</font><font style="vertical-align: inherit;">それはパスワードをクリアテキストで転送するからですか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
はい、そうです。</font><font style="vertical-align: inherit;">FreeRadiusとFreeIPAの間の通信は、この方法で行われます。</font><font style="vertical-align: inherit;">デバッグモードでは、ユーザー名とパスワードの送信方法を追跡できます。</font><font style="vertical-align: inherit;">はい、許可します。FreeRadiusサーバーにアクセスできるのはあなただけです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
EAP-TTLSの詳細については、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちらをご覧ください。</font></font><br>
</a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フリーラディウス</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CentOS 7.6でFreeRadiusを上げます。</font><font style="vertical-align: inherit;">ここでは何も複雑ではなく、通常の方法で設定します。</font></font><br>
<br>
<pre><code class="bash hljs">yum install freeradius freeradius-utils freeradius-ldap -y</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パッケージからバージョン3.0.13が入れられます。</font><font style="vertical-align: inherit;">後者は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://freeradius.org/</font></font></a></i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">で取得できます</font></i><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">。</font></a></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
その後、FreeRadiusはすでに機能しています。</font><font style="vertical-align: inherit;">/ etc / raddb / usersの行のコメントを解除できます</font></font><br>
<br>
<pre><code class="bash hljs">steve   Cleartext-Password := <span class="hljs-string">"testing"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デバッグモードでサーバーに実行する</font></font><br>
<br>
<pre><code class="bash hljs">freeradius -X</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、ローカルホストとのテスト接続を行います</font></font><br>
<br>
<pre><code class="bash hljs">radtest steve testing 127.0.0.1 1812 testing123</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">127.0.0.1:1812から127.0.0.1►6081の長さ20の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
応答</font><i><font style="vertical-align: inherit;">Received Access-Accept Id 115を受け取った</font></i><font style="vertical-align: inherit;">場合、すべて問題ありません。</font><font style="vertical-align: inherit;">進め。</font><i><b><font style="vertical-align: inherit;">LDAP</font></b></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
モジュールを接続します</font><font style="vertical-align: inherit;">。</font></font><i><b><font style="vertical-align: inherit;"></font></b></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="bash hljs">ln -s /etc/raddb/mods-available/ldap /etc/raddb/mods-enabled/ldap</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そしてすぐにそれを変更します。</font><font style="vertical-align: inherit;">FreeIPAにアクセスするにはFreeRadiusが必要です</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mods対応/ ldap</font></font></b><div class="spoiler_text"><pre><code class="bash hljs">ldap {<font></font>
server=<span class="hljs-string">"ldap://ldap.server.com"</span><font></font>
port=636<font></font>
start_tls=yes<font></font>
identity=<span class="hljs-string">"uid=admin,cn=users,dc=server,dc=com"</span><font></font>
password=**********<font></font>
base_dn=<span class="hljs-string">"cn=users,dc=server,dc=com"</span><font></font>
set_auth_type=yes<font></font>
...<font></font>
user {<font></font>
base_dn=<span class="hljs-string">"<span class="hljs-variable">${..base_dn}</span>"</span>
filter=<span class="hljs-string">"(uid=%{%{Stripped-User-Name}:-%{User-Name}})"</span><font></font>
}<font></font>
...</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RADIUSサーバーを再起動し、LDAPユーザーの同期を確認します。</font></font><br>
<br>
<pre><code class="bash hljs">radtest user_ldap password_ldap localhost 1812 testing123</code></pre><br><font style="vertical-align: inherit;"></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mods-enabled / eap</font></font></b></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
での</font><font style="vertical-align: inherit;">
eapの編集</font><font style="vertical-align: inherit;">ここでは、2つのeapインスタンスを追加します。</font><font style="vertical-align: inherit;">これらは、証明書とキーのみが異なります。</font><font style="vertical-align: inherit;">その理由を以下で説明します</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mods対応/ eap</font></font></b><div class="spoiler_text"><pre><code class="bash hljs">eap eap-client {                                                                                                                                                                                                                           default_eap_type = ttls                                                                                                                                                                                                                 timer_expire = 60                                                                                                                                                                                                                       ignore_unknown_eap_types = no                                                                                                                                                                                                          cisco_accounting_username_bug = no                                                                                                                                                                                                      max_sessions = <span class="hljs-variable">${max_requests}</span><font></font>
           tls-config tls-common {<font></font>
           private_key_file = <span class="hljs-variable">${certdir}</span>/fisrt.key<font></font>
           certificate_file = <span class="hljs-variable">${certdir}</span>/first.crt<font></font>
           dh_file = <span class="hljs-variable">${certdir}</span>/dh<font></font>
           ca_path = <span class="hljs-variable">${cadir}</span>
           cipher_list = <span class="hljs-string">"HIGH"</span><font></font>
           cipher_server_preference = no<font></font>
           ecdh_curve = <span class="hljs-string">"prime256v1"</span><font></font>
           check_crl = no<font></font>
           }<font></font>
                                                                                                                                                                                                                                                                                                                                                                                                                                                 <font></font>
           ttls {<font></font>
           tls = tls-common<font></font>
           default_eap_type = md5<font></font>
           copy_request_to_tunnel = no<font></font>
           use_tunneled_reply = yes<font></font>
           virtual_server = <span class="hljs-string">"inner-tunnel"</span><font></font>
           }<font></font>
}<font></font>
eap eap-guest {<font></font>
default_eap_type = ttls                                                                                                                                                                                                                 timer_expire = 60                                                                                                                                                                                                                       ignore_unknown_eap_types = no                                                                                                                                                                                                          cisco_accounting_username_bug = no                                                                                                                                                                                                      max_sessions = <span class="hljs-variable">${max_requests}</span><font></font>
           tls-config tls-common {<font></font>
           private_key_password=blablabla<font></font>
           private_key_file = <span class="hljs-variable">${certdir}</span>/server.key<font></font>
           certificate_file = <span class="hljs-variable">${certdir}</span>/server.crt<font></font>
           dh_file = <span class="hljs-variable">${certdir}</span>/dh<font></font>
           ca_path = <span class="hljs-variable">${cadir}</span>
           cipher_list = <span class="hljs-string">"HIGH"</span><font></font>
           cipher_server_preference = no<font></font>
           ecdh_curve = <span class="hljs-string">"prime256v1"</span><font></font>
           check_crl = no<font></font>
           }<font></font>
                                                                                                                                                                                                                                                                                                                                                                                                                                                 <font></font>
           ttls {<font></font>
           tls = tls-common<font></font>
           default_eap_type = md5<font></font>
           copy_request_to_tunnel = no<font></font>
           use_tunneled_reply = yes<font></font>
           virtual_server = <span class="hljs-string">"inner-tunnel"</span><font></font>
           }<font></font>
}</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、</font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サイト有効/デフォルトを</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">編集し</font><i><b><font style="vertical-align: inherit;">ます</font></b></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">承認セクションと認証セクションに関心があります。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サイト対応/デフォルト</font></font></b><div class="spoiler_text"><pre><code class="bash hljs">authorize {<font></font>
  filter_username<font></font>
  preprocess<font></font>
  <span class="hljs-keyword">if</span> (&amp;User-Name == <span class="hljs-string">"guest"</span>) {<font></font>
   eap-guest {<font></font>
       ok = <span class="hljs-built_in">return</span><font></font>
   }<font></font>
  }<font></font>
  elsif (&amp;User-Name == <span class="hljs-string">"client"</span>) {<font></font>
    eap-client {<font></font>
       ok = <span class="hljs-built_in">return</span> <font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span> {<font></font>
    eap-guest {<font></font>
       ok = <span class="hljs-built_in">return</span><font></font>
    }<font></font>
  }<font></font>
  ldap<font></font>
  <span class="hljs-keyword">if</span> ((ok || updated) &amp;&amp; User-Password) {<font></font>
    update {<font></font>
        control:Auth-Type := ldap<font></font>
    }<font></font>
  }<font></font>
  expiration<font></font>
  logintime<font></font>
  pap<font></font>
  }<font></font>
<font></font>
authenticate {<font></font>
  Auth-Type LDAP {<font></font>
    ldap<font></font>
  }<font></font>
  Auth-Type eap-guest {<font></font>
    eap-guest<font></font>
  }<font></font>
  Auth-Type eap-client {<font></font>
    eap-client<font></font>
  }<font></font>
  pap<font></font>
}</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
承認セクションでは、不要なモジュールをすべて削除します。</font><font style="vertical-align: inherit;">LDAPのみを残します。</font><font style="vertical-align: inherit;">ユーザー名によるクライアント認証を追加します。</font><font style="vertical-align: inherit;">上記の2つのeapインスタンスを追加したのはそのためです。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マルチイープ</font></font></b><div class="spoiler_text">  ,            .          .        ,       .          . Samsung   Android =&lt; 6      .       eap-guest   .       eap-client c  . User-Name    Anonymous   .    3 : Guest, Client   .   .    .    <br>
</div></div><br><font style="vertical-align: inherit;"><i><b><font style="vertical-align: inherit;">サイト対応/内部トンネルの</font></b></i><font style="vertical-align: inherit;"> 
セクションを承認および認証するための編集</font></font><i><b><font style="vertical-align: inherit;"></font></b></i><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サイト対応/内部トンネル</font></font></b><div class="spoiler_text"><pre><code class="bash hljs">authorize {<font></font>
  filter_username<font></font>
  filter_inner_identity<font></font>
  update control {<font></font>
   &amp;Proxy-To-Realm := LOCAL<font></font>
  }<font></font>
  ldap<font></font>
  <span class="hljs-keyword">if</span> ((ok || updated) &amp;&amp; User-Password) {<font></font>
    update {<font></font>
        control:Auth-Type := ldap<font></font>
    }<font></font>
  }<font></font>
  expiration<font></font>
  digest<font></font>
  logintime<font></font>
  pap<font></font>
  }<font></font>
<font></font>
authenticate {<font></font>
  Auth-Type eap-guest {<font></font>
    eap-guest<font></font>
  }<font></font>
  Auth-Type eap-client {<font></font>
    eap-client<font></font>
  }<font></font>
  Auth-Type PAP {<font></font>
    pap<font></font>
  }<font></font>
  ldap<font></font>
}</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、匿名ログインに使用できる名前をポリシーで指定する必要があります。</font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">policy.d / filterを</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">編集し</font><b><i><font style="vertical-align: inherit;">ます</font></i></b><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のような行を見つける必要があります。</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-keyword">if</span> (&amp;outer.request:User-Name !~ /^(anon|@)/) {<font></font>
  update request {<font></font>
    Module-Failure-Message = <span class="hljs-string">"User-Name is not anonymized"</span><font></font>
  }<font></font>
  reject<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、以下のelsifに必要な値を追加します。</font></font><br>
<br>
<pre><code class="bash hljs">elsif (&amp;outer.request:User-Name !~ /^(guest|client|@)/) {<font></font>
  update request {<font></font>
    Module-Failure-Message = <span class="hljs-string">"User-Name is not anonymized"</span><font></font>
  }<font></font>
  reject<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、</font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">certs</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ディレクトリに移動する必要があり</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">ここでは、信頼できる認証局からの鍵と証明書を配置する必要があります。これは、すでに持っており、eap-guestの自己署名証明書を生成する必要があります。</font><b><i><font style="vertical-align: inherit;">ca.cnf</font></i></b></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ファイルのパラメータを変更します</font><font style="vertical-align: inherit;">。</font></font><b><i><font style="vertical-align: inherit;"></font></i></b><font style="vertical-align: inherit;"></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ca.cnf</font></font></b><div class="spoiler_text"><pre><code class="bash hljs"><font></font>
...<font></font>
default_days = 3650<font></font>
default_md = sha256<font></font>
...<font></font>
input_password = blablabla<font></font>
output_password = blablabla<font></font>
...<font></font>
countryName = RU<font></font>
stateOrProvinceNmae = State<font></font>
localityNmae = City<font></font>
organizationName = NONAME<font></font>
emailAddress = admin@admin.ru<font></font>
commonName = <span class="hljs-string">"CA FreeRadius"</span></code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同じ値が</font></font><b><i><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">server.cnf</font></font></i></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルで指定されています</font><font style="vertical-align: inherit;">。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commonName</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のみを変更し</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">server.cnf</font></font></b><div class="spoiler_text"><pre><code class="bash hljs"><font></font>
...<font></font>
default_days = 3650<font></font>
default_md = sha256<font></font>
...<font></font>
input_password = blablabla<font></font>
output_password = blablabla<font></font>
...<font></font>
countryName = RU<font></font>
stateOrProvinceNmae = State<font></font>
localityNmae = City<font></font>
organizationName = NONAME<font></font>
emailAddress = admin@admin.ru<font></font>
commonName = <span class="hljs-string">"Server Certificate FreeRadius"</span></code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは作成します：</font></font><br>
<br>
<pre><code class="bash hljs">make</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
できました。</font><font style="vertical-align: inherit;">結果の</font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">server.crt</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">server.key</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、すでにeap-guestに登録されてい</font><b><i><font style="vertical-align: inherit;">ます</font></i></b><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、アクセスポイントを</font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">client.conf</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルに追加します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">各ポイントを個別に追加しないように、それらが配置されているネットワークのみを登録します（別のVLANにアクセスポイントがあります）。</font></font><br>
<br>
<pre><code class="bash hljs">client APs {<font></font>
ipaddr = 192.168.100.0/24<font></font>
password = password_AP<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユビキティコントローラー</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コントローラでは、別のネットワークを発生させます。</font><font style="vertical-align: inherit;">それを192.168.2.0/24に</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
します設定に移動します-&gt;プロファイル </font><font style="vertical-align: inherit;">私たちは、新しいものを作成します。私たちは、</font></font><br>
<br>
<img src="https://habrastorage.org/webt/n4/mj/_s/n4mj_shukldt1eogoqnpphaal3e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アドレスとRADIUSサーバのポートと、我々はに登録されたパスワード書き留め</font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">clients.confの</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルを</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6x/8e/km/6x8ekm2bbnrzghk0rv5qbdggnam.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ワイヤレスネットワークの新しい名前を作成します。</font><font style="vertical-align: inherit;">認証方法として、WPA-EAP（Enterprise）を選択し、作成したRADIUSプロファイルを指定します</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5i/ku/9n/5iku9n_j-r3fqsxvppyekim8aqi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。すべて</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">保存して適用し、</font><font style="vertical-align: inherit;">次に進みます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">顧客の設定</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最も難しいものから始めましょう！</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウインドウズ10</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
複雑さは、Windowsがまだドメインによって企業のWiFiに接続できないという事実に帰着します。したがって、証明書をトラストストアに手動でアップロードする必要があります。ここでは、自己署名と証明機関の両方を使用できます。 2つ目を使用します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、新しい接続を作成する必要があります。これを行うには、ネットワークとインターネットの設定-&gt;ネットワークと共有センター-&gt;新しい接続またはネットワークを作成して構成します</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7d/9e/ix/7d9eixr7yfn94zmiv56f1kqpm_o.png"><br>
<br>
<img src="https://habrastorage.org/webt/-z/iy/dp/-ziydpjwwwqxkgisvkxmj4kpfse.png"><br>
<br>
<img src="https://habrastorage.org/webt/jg/hd/w3/jghdw32jkf-d-9gxs71ca2o-q9y.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。ネットワーク名を手動で登録し、セキュリティの種類を変更します。 [ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接続設定の変更</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]をクリックした後、[ </font><font style="vertical-align: inherit;">セキュリティ]セクションでネットワーク認証-EAP-TTLSを選択します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gq/tg/x6/gqtgx6svylvh5sqmxrcjmovj-10.png"><br>
<br>
<img src="https://habrastorage.org/webt/kn/7l/a8/kn7la8fhk6a2fh8vkjtwvsji1gu.png"><br>
<br>
<img src="https://habrastorage.org/webt/y1/tl/gv/y1tlgv2-xbwqn-lcupnyiwpxz3s.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パラメータに入り、認証の機密性を規定し</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;"> - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クライアント</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">信頼された証明機関として、追加した証明書を選択し、[サーバーを承認できない場合はユーザーにプロンプ​​トを表示しない]チェックボックスをオンにして、認証方法-暗号化されていないパスワード（PAP）を選択します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5x/ww/3j/5xww3jjmvmf1rhkdxcqvoxh0l18.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、追加のパラメーターに移動し、「認証モードを指定する」にチェックマークを付けます。</font><font style="vertical-align: inherit;">「ユーザー認証」の項目を選択し、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">資格情報の保存</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をクリックし</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ここで、username_ldapとpassword_ldapを入力する必要が</font></font><br>
<br>
<img src="https://habrastorage.org/webt/e5/lv/xu/e5lvxualbxusv6ksq1iqwhiodyi.png"><br>
<br>
<img src="https://habrastorage.org/webt/om/he/tc/omhetcqvchjagt5mcqjo_e5hq0m.png"><br>
<br>
<img src="https://habrastorage.org/webt/2p/ni/oc/2pniocysbjtvvzgoa5yqw5ahl_g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あります。すべて</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">保存して適用し、閉じます。</font><font style="vertical-align: inherit;">新しいネットワークに接続できます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ubuntu 18.04、18.10、Fedora 29、30を確認しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、自分用の証明書をダウンロードします。</font><font style="vertical-align: inherit;">Linuxでは、システム証明書を使用できるかどうか、そのようなストレージがそこにあるかどうかはわかりませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ドメインで接続します。</font><font style="vertical-align: inherit;">したがって、証明書を購入した証明機関からの証明書が必要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべての接続は1つのウィンドウで行われます。</font><font style="vertical-align: inherit;">ネットワークを選択してください：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_b/bv/ks/_bbvksnhgramkno1xteuugeiicu.png"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">匿名-クライアント</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ドメイン-証明書が発行されるドメイン</font></font><br>
</i><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アンドロイド</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サムスンではない</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バージョン7以降、WiFiに接続するときに、ドメインのみを指定してシステム証明書を使用できます。domain- </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ft/ma/cl/ftmaclvd6hgnr6l61f1ntqx4pho.png"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">証明書が</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
匿名</font><font style="vertical-align: inherit;">で発行されるドメイン</font><font style="vertical-align: inherit;">-client</font></font><br>
</i><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サムスン</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前述のように、Samsungデバイスは、WiFiに接続するときにシステム証明書を使用する方法を認識していないため、ドメインごとに接続することができません。</font><font style="vertical-align: inherit;">したがって、証明機関のルート証明書を手動で追加する必要があります（ca.pem、Radiusサーバーで取得します）。</font><font style="vertical-align: inherit;">これは自己署名を使用する場所です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
証明書をデバイスにダウンロードしてインストールします。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">証明書のインストール</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/webt/jw/vn/p6/jwvnp6k3hcvgr_-sxahbjjfwuma.png"><br>
<br>
<img src="https://habrastorage.org/webt/vw/-u/2c/vw-u2crpfqhzv2hewbw4fvcm0k8.png"><br>
<br>
<img src="https://habrastorage.org/webt/fn/n-/i6/fnn-i6gkkzzt6w9hxjpv5fgo_sk.png"><br>
<br>
<img src="https://habrastorage.org/webt/xk/pc/-2/xkpc-2wufsgnckjexjhmiv79avy.png"><br>
<br>
 ,      , -  ,     :<br>
<br>
<img src="https://habrastorage.org/webt/_w/aa/px/_waapxwklsloxwpvo3oe8mrdwek.png"><br>
<br>
<img src="https://habrastorage.org/webt/v6/nx/k1/v6nxk1ts6ej-j8sffb1kpqfx9ae.png"><br>
<br>
<i>     .         .</i><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
証明書がインストールされたら、接続に進むことができます：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rr/9l/vx/rr9lvx4jov8ohepj-hetehl4g1s.png"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">証明書- </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
匿名ユーザーが</font><font style="vertical-align: inherit;">インストールしたものを指定</font><font style="vertical-align: inherit;">-ゲスト</font></font><br>
</i><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マックOS</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AppleデバイスはそのままではEAP-TLSにしか接続できませんが、証明書をドロップする必要があります。</font><font style="vertical-align: inherit;">別の接続方法を指定するには、Apple Configurator 2を使用する必要があります。したがって、まずそれをケシにダウンロードし、新しいプロファイルを作成して、必要なすべてのWiFi設定を追加する必要があります。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apple Configurator</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/webt/tg/mj/zi/tgmjzi_qpkrel011yzj5q5h23qs.png"><br>
<br>
<img src="https://habrastorage.org/webt/dw/dd/dl/dwdddlobqibczjpygjt1f-cnbp8.png"><br>
<br>
<i>    <br>
Security Type — WPA2 Enterprise<br>
Accepted EAP Types — TTLS<br>
User Name  Password —  <br>
Inner Authentication — PAP<br>
Outer Identity — client <br>
</i><br>
<br>
<i> Trust.    </i><br>
<br>
.   ,     <br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロファイルの準備ができたら、ポピーにダウンロードしてインストールする必要があります。</font><font style="vertical-align: inherit;">インストールプロセス中に、usernmae_ldapおよびpassword_ldapユーザーを指定する必要があります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_z/um/7m/_zum7mpbqlszgaq5d9cm6k7-why.png"><br>
<br>
<img src="https://habrastorage.org/webt/hb/iq/ig/hbiqigx3cy7zdklsbnx22zmb0e4.png"><br>
<br>
<img src="https://habrastorage.org/webt/u4/tb/-8/u4tb-8v3jbt9t5gs9zz9tplbnt0.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iOS</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロセスはmacOSに似ています。</font><font style="vertical-align: inherit;">プロファイルを使用する必要があります（macOSの場合と同じです。AppleConfiguratorでプロファイルを作成する方法については、上記を参照してください）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロファイルをダウンロードし、インストールし、認証情報を入力し、接続し</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pi/gx/3m/pigx3mjskrdwyuk07xs0m6zh-v4.png"><br>
<br>
<img src="https://habrastorage.org/webt/y9/hk/6g/y9hk6gm7k5jkdrvms-stzkdmu9s.png"><br>
<br>
<img src="https://habrastorage.org/webt/ie/xt/a-/iexta-krrvub6rrozdvmk7adh_s.png"><br>
<br>
<img src="https://habrastorage.org/webt/ej/oo/wj/ejoowjqmtjojl31jmau1z3np7mi.png"><br>
<br>
<img src="https://habrastorage.org/webt/pw/s4/en/pws4enrdkqc97p009eglr3wpiy0.png"><br>
<br>
<img src="https://habrastorage.org/webt/zj/z_/5f/zjz_5f7hqthgj52z_nnigigrcm4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ます。これですべてです。</font><font style="vertical-align: inherit;">Radiusサーバーをセットアップし、FreeIPAと同期させ、WPA2-EAPを使用するようにUbiquitiアクセスポイントに指示しました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">考えられる質問</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロファイル/証明書を従業員に転送する方法は？</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウェブ経由でアクセスできるFTPに保存するすべての証明書/プロファイル。 ftpを除いて、速度制限とインターネットアクセスのみでゲストネットワークを発生させました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
認証は2日間続き、その後リセットされ、クライアントはインターネットなしで放置されます。に。従業員がWiFiに接続する場合は、まずゲストネットワークに接続し、FTPにアクセスして、必要な証明書またはプロファイルをダウンロードし、インストールしてから、企業ネットワークに接続できます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MSCHAPv2でスキーマを使用しないのはなぜですか？彼女はより安全です！</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">約：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">まず、このようなスキームはNPS（Windowsネットワークポリシーシステム）で適切に機能します。この実装では、LDAP（FreeIpa）をさらに構成し、パスワードハッシュをサーバーに保存する必要があります。追加。設定はお勧めできません。これは、超音波の同期のさまざまな問題につながる可能性があります。 2番目に、ハッシュはMD4であるため、セキュリティはそれほど向上しません</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。Q：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Macアドレスを使用してデバイスを承認できますか？</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いいえ、これは安全ではありません。攻撃者はポピーアドレスを代用できます。さらに、ポピーアドレスの認証は多くのデバイスでサポートされていません</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これらの証明書をすべて使用するのはなぜですか？それらなしで接続することもできます</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">証明書はサーバーを認証するために使用されます。</font><font style="vertical-align: inherit;">それら。</font><font style="vertical-align: inherit;">デバイスは、接続されると、信頼できるサーバーであるかどうかを確認します。</font><font style="vertical-align: inherit;">1つの場合、認証はさらに進み、そうでない場合、接続は閉じられます。</font><font style="vertical-align: inherit;">証明書がなくても接続できますが、攻撃者またはネイバーが同じ名前のRADIUSサーバーとアクセスポイントを取得した場合、ユーザーの資格情報を簡単に傍受できます（それらがクリアテキストで送信されることを忘れないでください）。</font><font style="vertical-align: inherit;">証明書が使用されると、敵はログに架空のユーザー名（ゲストまたはクライアント）とタイプのエラー（不明なCA証明書）のみを表示します</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">macOSの詳細</font></font></b><div class="spoiler_text">  macOS     .        WiFi,        WiFi,   .      ,   WPA2-PSK, ,    .         .     2015 ,        )<br>
</div></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja463207/index.html">チャットボットの開発（電報+ YouTube）</a></li>
<li><a href="../ja463213/index.html">初心者C＃開発者の誤解。標準的な質問に答えようとする</a></li>
<li><a href="../ja463215/index.html">エンジニアと建築家はすでに月の集落を設計しています</a></li>
<li><a href="../ja463221/index.html">太陽を見る：5種類のガジェット、5ドルから5,000ドル</a></li>
<li><a href="../ja463223/index.html">モバイル＃310開発者向けの興味深い資料のダイジェスト（8月5〜11日）</a></li>
<li><a href="../ja463227/index.html">pwnable.kr 19でジョブを解決する-リンクを解除します。ヒープバッファオーバーフロー</a></li>
<li><a href="../ja463229/index.html">文化の中のジェットパック：映画</a></li>
<li><a href="../ja463231/index.html">Cisco 200-125 CCNA v3.0のトレーニング。14日目。VTP、プルーニング、ネイティブVLAN</a></li>
<li><a href="../ja463233/index.html">Cisco 200-125 CCNA v3.0のトレーニング。15日目遅い通信とポートセキュリティ</a></li>
<li><a href="../ja463237/index.html">ニューラルネットワークv 2.0で音楽を再生する方法</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>