<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¸ğŸ¾ ğŸ‘¹ ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦â€ğŸ‘¦ ProxySQL - alat untuk koneksi demultiplexing ğŸ§–ğŸ¾ ğŸ‘´ğŸ¿ ğŸ¤¾ğŸ¾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo, nama saya Alexander Yakovlev, saya bekerja untuk Citimobil dan beroperasi. Hari ini saya akan memberi tahu Anda tentang produk ProxySQL yang san...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ProxySQL - alat untuk koneksi demultiplexing</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/citymobil/blog/501730/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Halo, nama saya Alexander Yakovlev, saya bekerja untuk Citimobil dan beroperasi. </font><font style="vertical-align: inherit;">Hari ini saya akan memberi tahu Anda tentang produk ProxySQL yang sangat menarik - ini adalah Proxy MySQL kinerja tinggi yang dapat melakukan banyak hal - menangkap dan membunuh permintaan dengan mask, dengan itu Anda dapat mencari injeksi sql, menduplikasi beban dan banyak lagi. </font><font style="vertical-align: inherit;">Saya akan berbicara tentang pengalaman kami dengannya.</font></font><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cepat atau lambat, setiap proyek TI besar, pengembangan yang dimulai dengan sepasang server, akan menghadapi situasi yang dijelaskan di bawah ini. Bayangkan proyek awalnya hanya memiliki satu database - server master. Perlahan-lahan, sekelompok budak ditambahkan ke dalamnya. Kemudian mereka memperkenalkan sharding. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan suatu hari, beban tiba-tiba meningkat 10 kali lipat. Misalnya, karena pesaing utama Anda telah jatuh, dan pelanggan bergegas ke Anda. Pada titik ini, tampaknya bagi Anda bahwa Anda dapat dengan mudah mengukur beban dengan menambahkan server web. Tetapi setelah Anda melakukan ini, muncul situasi yang tidak menyenangkan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perhatikan contoh satu master. Katakanlah Anda memiliki 50 server web dan pada setiap 200 proses php-fpm. Kemudian 50 * 200 koneksi akan tiba di master, dan pada saat itu 50 * 200 / jumlah budak akan datang ke masing-masing budak (jika, tentu saja, roundrobin dikonfigurasi dalam haproxy) - lihat gambar di bawah ini. Tentu saja, 10 ribu koneksi ke master sangat banyak, tetapi masih dapat diterima, dan jika ada 200 situs web, jumlah koneksi akan lebih banyak lagi, dan satu koneksi = satu utas. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam kemacetan inilah kami bertemu. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/7b2/bb3/e2b/7b2bb3e2b3ff265076397aece6d0da81.jpg" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kemudian kami mulai berdebat: koneksi ke wizard selalu diinstal dalam kode, tetapi apakah itu perlu untuk semua proses fpm? Mungkin tidak. Kami memperhatikan bahwa sejumlah besar koneksi yang bertahan dengan master cukup menggantung. Dan mereka memutuskan bahwa kita perlu demultiplexing.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/df8/8e7/595/df88e75958437543e14e00a08603a7b8.jpg" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk melakukan ini, kami menarik perhatian ke produk yang disebut ProxySQL. Ini bekerja seperti proxy terbalik normal: koneksi dibuat untuk itu, dan itu mendistribusikan kembali lalu lintas sesuai dengan aturan tertentu yang ditentukan dalam konfigurasi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menginstal ProxySQL di semua server web kami, dan dalam konfigurasi aplikasi, kami menetapkan bahwa panggilan ke master database dilakukan di alamat 127.0.0.1. Jika sebelum 200 pekerja FPM di setiap server web berarti 200 koneksi ke pangkalan utama dari mesin ini, sekarang situasinya telah berubah. 200 koneksi ini datang dalam ProxySQL, dan 50-70 keluar pada waktu yang berbeda. Artinya, ProxySQL dapat menggunakan kembali koneksi yang ada.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berkat demultiplexing, kami mengurangi jumlah koneksi sebanyak 3-10 kali pada semua master, lihat grafik koneksi saat ini dari salah satu master di bawah ini. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/87b/285/e02/87b285e02729e752ccf931994d4253e6.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berkat ProxySQL, kami menyingkirkan hambatan di atas. Tetapi ini bukan satu-satunya alur kerja yang telah kami tingkatkan dengan alat ini. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami belum menyelesaikan proses kedua, tetapi sangat dekat dengan penyelesaian. Menggunakan ProxySQL, kami berencana untuk menduplikasi beban nyata di lingkungan pengujian. Ini diperlukan untuk memeriksa fitur-fitur baru dengan traffic tempur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagaimana ini akan diterapkan? Aplikasi masuk ke ProxySQL, dan mengirimkan lalu lintas di sepanjang dua rute: ke database pertempuran agar aplikasi berfungsi, dan ke lingkungan pengujian untuk memeriksa fitur-fitur baru yang sedang dimuat.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fitur ProxySQL adalah bahwa ada konfigurasi, yang dalam kasus kami diluncurkan melalui boneka (untuk boneka ada modul ProxySQL), tetapi ada juga konsep zona runtime ketika, untuk melakukan perubahan (menambah server, menambah pengguna, menghapus server dan pengguna ), Anda tidak perlu restart / reload., Semuanya dilakukan melalui konsol ProxySQL, misalnya seperti ini.</font></font><br>
<br>
<pre><code class="plaintext hljs">mysql -ulogin -ppassword -h 127.0.0.1 -P6032 -e "INSERT INTO mysql_users(username,password,default_hostgroup) VALUES ('sm_username','pass',1);;LOAD MYSQL USERS TO RUNTIME;SAVE MYSQL USERS TO DISK;"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lebih detail, tentu saja, di dokumentasi resmi </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proxysql.com/documentation</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Terima kasih atas perhatian Anda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Konfigurasi kami, yang dengannya kami memecahkan masalah yang dijelaskan di atas, lihat di bawah. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Konfigurasi kami</font></font><br>
<br>
<pre><code class="plaintext hljs">datadir="/var/lib/proxysql"<font></font>
<font></font>
admin_variables=<font></font>
{<font></font>
    admin_credentials="user:pass"<font></font>
    mysql_ifaces="0.0.0.0:6032"<font></font>
    refresh_interval=2000<font></font>
    web_enabled=true<font></font>
    web_port=6080<font></font>
    stats_credentials="stats:admin"<font></font>
}<font></font>
<font></font>
mysql_variables =<font></font>
{<font></font>
    threads = 1000<font></font>
    max_connections = 2000<font></font>
    default_query_delay= 0<font></font>
    default_query_timeout=1<font></font>
    have_compress=true<font></font>
    poll_timeout=2000<font></font>
    interfaces="0.0.0.0:6033;/tmp/proxysql.sock"<font></font>
    default_schema="information_schema"<font></font>
    stacksize=1048576<font></font>
    server_version="5.7.22"<font></font>
    connect_timeout_server=10000<font></font>
    monitor_history=60000<font></font>
    monitor_connect_interval=200000<font></font>
    monitor_ping_interval=200000<font></font>
    ping_interval_server_msec=5000<font></font>
    ping_timeout_server=200<font></font>
    commands_stats=true<font></font>
    sessions_sort=true<font></font>
    monitor_username="root"<font></font>
    monitor_password="password"<font></font>
    monitor_galera_healthcheck_interval=200<font></font>
    monitor_galera_healthcheck_timeout=80<font></font>
}<font></font>
<font></font>
mysql_servers =<font></font>
(<font></font>
  {<font></font>
    address = "ip_real_mysql_server",<font></font>
    port = 3306,<font></font>
    max_connections = 10000,<font></font>
    host_group = 1,<font></font>
  })<font></font>
mysql_users =<font></font>
(<font></font>
  {<font></font>
    username = "user",<font></font>
    password = "pass",<font></font>
    default_hostgroup = 1,<font></font>
    transaction_persistent = 0,<font></font>
    active = 1,<font></font>
  })<font></font>
</code></pre></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id501712/index.html">Berbicara tentang tes: beberapa cerita dan survei</a></li>
<li><a href="../id501714/index.html">Sekolah 42 sebagai jawaban utama untuk kehidupan TI, semesta pemrograman dan semua itu</a></li>
<li><a href="../id501716/index.html">Tantangan diterima atau tugas apa yang dipecahkan insinyur Lamoda</a></li>
<li><a href="../id501722/index.html">Kerangka Comet - PHP untuk API REST cepat</a></li>
<li><a href="../id501724/index.html">Bekerja dengan cookie dalam JavaScript murni tanpa sakit kepala</a></li>
<li><a href="../id501734/index.html">[Geektimes-style] Masa depan teknologi kami: prediksi dari para ahli</a></li>
<li><a href="../id501736/index.html">Bagaimana kami beralih ke udalenka enam bulan lalu karena optik cincang</a></li>
<li><a href="../id501738/index.html">13 Mei Java Digest</a></li>
<li><a href="../id501742/index.html">Transportasi pada 13 Mei: uiiii, kami mengambil tempat kedua dalam hal jumlah pasien, saatnya untuk menghilangkan pembatasan</a></li>
<li><a href="../id501744/index.html">Perancang bukanlah orang yang melukis dengan indah, ini adalah orang yang membantu bisnis memahami pengguna</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>