<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🆔 👨🏾‍🎨 🏘️ wc para D: 712 caracteres sem uma única ramificação 🎛️ 👩‍👧‍👧 ⚙️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Depois de ler “ Beat With a 80-Line Program on Haskell”, que encontrei no Hacker News , decidi que D poderia ser melhor. E eu escrevi wc em D. 
 
 Not...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>wc para D: 712 caracteres sem uma única ramificação</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/490102/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Depois de ler “ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beat With a 80-Line Program on Haskell”,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que encontrei no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hacker News</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , decidi que D poderia ser melhor. </font><font style="vertical-align: inherit;">E eu escrevi wc em D. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Note.per. </font><font style="vertical-align: inherit;">Eu sugeri traduzir o artigo acima</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xd34df00d</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mas ele preferiu fazer com base em seu </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Vencendo com vinte linhas de Haskell: Writing Your Wc"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">E agora os </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">artigos </font></font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">estão se multiplicando</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> como repetições "moeda cunhada".</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Programa</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consiste em um arquivo - 34 linhas e 712 caracteres.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Código fonte</font></font></b><div class="spoiler_text"><pre><code class="swift hljs"><span class="hljs-keyword">import</span> std.stdio : writefln, File;
<span class="hljs-keyword">import</span> std.algorithm : map, fold, splitter;
<span class="hljs-keyword">import</span> std.range : walkLength;
<span class="hljs-keyword">import</span> std.typecons : Yes;
<span class="hljs-keyword">import</span> std.uni : byCodePoint;<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Line</span> </span>{<font></font>
	size_t chars;<font></font>
	size_t words;<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Output</span> </span>{<font></font>
	size_t lines;<font></font>
	size_t words;<font></font>
	size_t chars;<font></font>
}<font></font>
<font></font>
<span class="hljs-type">Output</span> combine(<span class="hljs-type">Output</span> a, <span class="hljs-type">Line</span> b) pure nothrow {
	<span class="hljs-keyword">return</span> <span class="hljs-type">Output</span>(a.lines + <span class="hljs-number">1</span>, a.words + b.words, a.chars + b.chars);<font></font>
}<font></font>
<font></font>
<span class="hljs-type">Line</span> toLine(char[] l) pure {
	<span class="hljs-keyword">return</span> <span class="hljs-type">Line</span>(l.byCodePoint.walkLength, l.splitter.walkLength);<font></font>
}<font></font>
<font></font>
void main(string[] args) {<font></font>
	auto f = <span class="hljs-type">File</span>(args[<span class="hljs-number">1</span>]);
	<span class="hljs-type">Output</span> o = f<font></font>
		.byLine(<span class="hljs-type">Yes</span>.keepTerminator)<font></font>
		.<span class="hljs-built_in">map</span>!(l =&gt; toLine(l))<font></font>
		.fold!(combine)(<span class="hljs-type">Output</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>));<font></font>
<font></font>
	writefln!<span class="hljs-string">"%u %u %u %s"</span>(o.lines, o.words, o.chars, args[<span class="hljs-number">1</span>]);<font></font>
}</code></pre><br>
</div></div><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Claro, ele usa </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Phobos, a biblioteca padrão D</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mas por que não? </font><font style="vertical-align: inherit;">Phobos é bonito e vem com todo compilador D. O programa em si não contém nenhuma instrução if. </font><font style="vertical-align: inherit;">E na implementação wc no Haskell, vários se forem usados. </font><font style="vertical-align: inherit;">O programa D, além do principal, contém mais três pequenas funções. </font><font style="vertical-align: inherit;">Eu poderia facilmente colocar toda a funcionalidade em uma cadeia de intervalo, mas provavelmente excederia 80 caracteres por linha. </font><font style="vertical-align: inherit;">Este é o princípio básico do estilo de código.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atuação</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O wc em D é mais rápido que o coreutils wc? </font><font style="vertical-align: inherit;">Não, mas levei 15 minutos para escrever minha versão (eu tive que procurar walkLength porque esqueci o nome da função).</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arquivo de dados</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">linhas</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">byte</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coreutils</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">haskell</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">app.d</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">46.</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">906</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3,5 ms ± 1,9 ms</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">39,6 ms ± 7,8 ms</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8,9 ms ± 2,1 ms</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">big.txt</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">862</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">64k</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4,7 ms ± 2,0 ms</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">39,6 ms ± 7,8 ms</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9,8 ms ± 2,1 ms</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vbig.txt</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.7M</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">96 milhões</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">658.6ms ± 24.5ms</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">226,4 ms ± 29,5 ms</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,102 s ± 0,022 s</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vbig2.txt</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12,1 milhões</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">671M</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4,4 s ± 0,058 s</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,1 s ± 0,039 s</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7,4 s ± 0,085 s</font></font></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Memória:</font></font><div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arquivo de dados</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coreutils</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">haskell</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">app.d</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2052K</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7228K</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7708K</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">big.txt</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2112K</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7512K</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7616K</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vbig.txt</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2288K</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">42620K</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7712K</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vbig2.txt</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2360K</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50860K</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7736K</font></font></td>
</tr>
</tbody></table></div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wc em Haskell mais rápido? </font><font style="vertical-align: inherit;">Para arquivos grandes, certamente, mas usa multithreading. </font><font style="vertical-align: inherit;">Para arquivos pequenos, o GNU coreutils ainda vence. </font><font style="vertical-align: inherit;">Nesta fase, minha versão provavelmente é limitada pelo IO e, em qualquer caso, é bastante rápida. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Não vou argumentar que um idioma é mais rápido que outro. </font><font style="vertical-align: inherit;">Se você gastar tempo otimizando o micro benchmark, provavelmente ganhará. </font><font style="vertical-align: inherit;">Mas não na vida real. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas argumentarei que a programação funcional em D quase alcança o FP em Haskell.</font></font></b><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um pouco sobre o alcance em D</font></font></h3><br>
<img src="https://habrastorage.org/webt/gp/qe/oo/gpqeookkvehf2hdsowdegomcqai.png" align="left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">range é uma abstração que pode ser iterada sem tocar na coleção subjacente (se houver). </font><font style="vertical-align: inherit;">Tecnicamente, o intervalo pode ser uma estrutura ou classe que implementa uma ou mais interfaces de intervalo. </font><font style="vertical-align: inherit;">A forma mais simples, InputRange, requer uma função</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">popFront</span><span class="hljs-params">()</span></span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
e dois membros ou propriedades </font></font><br>
<br>
<pre><code class="cpp hljs">T front;
<span class="hljs-keyword">bool</span> empty;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
T é um tipo genérico de elemento cujo intervalo é repetido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os intervalos D são tipos específicos. </font><font style="vertical-align: inherit;">Quando o intervalo cai na instrução foreach, o compilador executa uma pequena modificação.</font></font><br>
<br>
<pre><code class="cpp hljs">foreach (e; range) { ... }</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
torna-se em </font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> __r = range; !__r.empty; __r.popFront()) {
    <span class="hljs-keyword">auto</span> e = __r.front;<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
auto e = calcula o tipo e é equivalente a T e =. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com isso em mente, é fácil criar um intervalo que possa ser usado pelo foreach.</font></font><br>
<br>
<pre><code class="java hljs">struct Iota {
	<span class="hljs-keyword">int</span> front;
	<span class="hljs-keyword">int</span> end;<font></font>
<font></font>
	<span class="hljs-meta">@property</span> <span class="hljs-function">bool <span class="hljs-title">empty</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.front == <span class="hljs-keyword">this</span>.end;<font></font>
	}<font></font>
<font></font>
	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">popFront</span><span class="hljs-params">()</span> </span>{<font></font>
		++<span class="hljs-keyword">this</span>.front;<font></font>
	}<font></font>
}<font></font>
<font></font>
unittest {<font></font>
	<span class="hljs-keyword">import</span> std.stdio;<font></font>
	foreach(it; Iota(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>)) {<font></font>
		writeln(it);<font></font>
	}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Iota é um exemplo muito simples de alcance. </font><font style="vertical-align: inherit;">Funciona como um gerador, sem a coleção subjacente. </font><font style="vertical-align: inherit;">Ele percorre números inteiros do início ao fim em incrementos de um. </font><font style="vertical-align: inherit;">Este trecho revela um pouco da sintaxe D.</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@property</span> <span class="hljs-function">bool <span class="hljs-title">empty</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O atributo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ property</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> permite que você use a função </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vazia</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> da mesma maneira que uma variável de membro (chamando uma função sem parênteses). O atributo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no final significa que não estamos modificando os dados da instância para os quais chamamos </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vazios</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . O teste de unidade interno imprime números de 0 a 10. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outro pequeno recurso é a falta de um construtor explícito. A estrutura Iota possui duas variáveis ​​de membro int. Na instrução foreach do teste, criamos uma instância Iota como se ela tivesse um construtor que aceite duas entradas. Este é um literal estrutural. Quando o compilador D vê isso, mas a estrutura não possui um construtor correspondente, de acordo com a ordem de declaração das variáveis ​​- os membros da estrutura receberão int.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O relacionamento entre os três membros é simples. </font><font style="vertical-align: inherit;">Se vazio for falso, front é garantido para retornar um novo elemento após a iteração após chamar popFront. </font><font style="vertical-align: inherit;">Depois de chamar popFront, o valor vazio pode mudar. </font><font style="vertical-align: inherit;">Se isso for verdade, significa que não há mais elementos para iterar e outras chamadas para frente são inválidas. </font><font style="vertical-align: inherit;">De acordo com </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a documentação do InputRange</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">front pode ser calculado corretamente se e somente se retornar vazio ou retornar falso.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">front pode ser calculado várias vezes sem chamar popFront ou alterar o intervalo ou os dados subjacentes, e fornece o mesmo resultado para cada cálculo.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usar expressões foreach, ou loops, não é muito funcional. </font><font style="vertical-align: inherit;">Suponha que desejemos filtrar todos os números ímpares para Iota. </font><font style="vertical-align: inherit;">Poderíamos colocar um if dentro de um bloco foreach, mas isso só pioraria. </font><font style="vertical-align: inherit;">Seria melhor se tivéssemos um intervalo que aceite um intervalo e um predicado que decida se um elemento é adequado ou não.</font></font><br>
<br>
<pre><code class="java hljs">struct Filter {<font></font>
	Iota input;<font></font>
	<span class="hljs-function">bool <span class="hljs-title">function</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span> predicate</span>;<font></font>
<font></font>
	<span class="hljs-keyword">this</span>(Iota input, <span class="hljs-function">bool <span class="hljs-title">function</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span> predicate) </span>{
		<span class="hljs-keyword">this</span>.input = input;
		<span class="hljs-keyword">this</span>.predicate = predicate;
		<span class="hljs-keyword">this</span>.testAndIterate();<font></font>
	}<font></font>
<font></font>
	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testAndIterate</span><span class="hljs-params">()</span> </span>{
		<span class="hljs-keyword">while</span>(!<span class="hljs-keyword">this</span>.input.empty<font></font>
				&amp;&amp; !<span class="hljs-keyword">this</span>.predicate(<span class="hljs-keyword">this</span>.input.front))<font></font>
		{<font></font>
			<span class="hljs-keyword">this</span>.input.popFront();<font></font>
		}<font></font>
	}<font></font>
<font></font>
	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">popFront</span><span class="hljs-params">()</span> </span>{
		<span class="hljs-keyword">this</span>.input.popFront();
		<span class="hljs-keyword">this</span>.testAndIterate();<font></font>
	}<font></font>
<font></font>
	<span class="hljs-meta">@property</span> <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">front</span><span class="hljs-params">()</span> </span>{
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.input.front;<font></font>
	}<font></font>
<font></font>
	<span class="hljs-meta">@property</span> <span class="hljs-function">bool <span class="hljs-title">empty</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.input.empty;<font></font>
	}<font></font>
}<font></font>
<font></font>
<span class="hljs-function">bool <span class="hljs-title">isEven</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a)</span> </span>{
	<span class="hljs-keyword">return</span> a % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
unittest {<font></font>
	foreach(it; Filter(Iota(<span class="hljs-number">0</span>,<span class="hljs-number">10</span>), &amp;isEven)) {<font></font>
		writeln(it);<font></font>
	}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O filtro é novamente muito simples: são necessários Iota e um ponteiro de função. </font><font style="vertical-align: inherit;">Ao construir o filtro, chamamos testAndIterate, que leva elementos de Iota até que estejam vazios ou que o predicado retorne falso. </font><font style="vertical-align: inherit;">A idéia é que o predicado decida o que filtrar e o que deixar. </font><font style="vertical-align: inherit;">As propriedades front e empty são simplesmente traduzidas para Iota. </font><font style="vertical-align: inherit;">A única coisa que realmente faz o trabalho é popFront. </font><font style="vertical-align: inherit;">Retorna o item atual e chama testAndIterate. </font><font style="vertical-align: inherit;">Isso é tudo. </font><font style="vertical-align: inherit;">Esta é uma implementação de filtro.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, testAndIterate tem um loop while, mas reescrevê-lo usando recursão, na minha opinião, é simplesmente estúpido. O que torna D ótimo é que você pode usar o método apropriado para cada tarefa. A programação funcional é boa e muitas vezes ostenta, mas às vezes não é. Se um pequeno montador embutido for necessário ou mais agradável, use.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O filtro de chamadas ainda não parece muito bom. </font><font style="vertical-align: inherit;">Supondo que você esteja acostumado a ler da esquerda para a direita, o Filtro aparece antes do Iota, mesmo que seja executado depois do Iota. </font><font style="vertical-align: inherit;">D não fornece uma instrução de pipe, mas usa a sintaxe da chamada de função unificada (UFCS). </font><font style="vertical-align: inherit;">Se uma expressão puder ser convertida implicitamente no primeiro parâmetro de uma função, a função poderá ser chamada como se fosse uma função membro dessa expressão. </font><font style="vertical-align: inherit;">Isso é bastante complicado, eu entendo. </font><font style="vertical-align: inherit;">Um exemplo ajudará:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">foo</span><span class="hljs-params">(<span class="hljs-built_in">string</span> a)</span> </span>{
	<span class="hljs-keyword">return</span> a ~ <span class="hljs-string">"World"</span>;<font></font>
}<font></font>
<font></font>
unittest {<font></font>
	<span class="hljs-built_in">string</span> a = foo(<span class="hljs-string">"Hello "</span>);
	<span class="hljs-built_in">string</span> b = <span class="hljs-string">"Hello "</span>.foo();<font></font>
	assert(a == b);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O exemplo acima mostra duas chamadas para a função foo. </font><font style="vertical-align: inherit;">Como afirma implica, ambas as chamadas são equivalentes. </font><font style="vertical-align: inherit;">O que isso significa para o nosso exemplo de filtro Iota? </font><font style="vertical-align: inherit;">O UFCS nos permite reescrever o teste de unidade assim:</font></font><br>
<br>
<pre><code class="swift hljs">unittest {<font></font>
	foreach(it; <span class="hljs-type">Iota</span>(<span class="hljs-number">1</span>,<span class="hljs-number">10</span>).<span class="hljs-type">Filter</span>(&amp;isEven)) {<font></font>
		writeln(it);<font></font>
	}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A implementação de mapa / transformação para o intervalo agora deve estar acessível a todos os leitores. </font><font style="vertical-align: inherit;">Obviamente, um filtro pode ser mais abstrato usando modelos, mas esses são apenas detalhes, nada conceitualmente novo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, existem diferentes tipos de intervalo, por exemplo, bidirecional. </font><font style="vertical-align: inherit;">Adivinhe quais oportunidades isso oferece a você. </font><font style="vertical-align: inherit;">Uma dica rápida: existem duas novas primitivas no intervalo bidirecional chamadas back e popBack. </font><font style="vertical-align: inherit;">Existem outros tipos de intervalo, mas depois de entender o intervalo de entrada mostrado acima duas vezes, você quase todos os reconhece. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS Apenas para maior clareza, não implemente seu próprio filtro, mapa ou dobra; </font><font style="vertical-align: inherit;">a biblioteca padrão do Phobos D tem tudo o que você precisa. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dê uma</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> olhada em </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">std.algorithm</font></a><font style="vertical-align: inherit;"> e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">std.range</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sobre o autor</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Robert Schadeck obteve um mestrado em ciência da computação pela Universidade de Oldenburg. </font><font style="vertical-align: inherit;">Sua tese de mestrado foi intitulada “DMCD - D Compithread Multithreaded distribuído com cache”, onde trabalhou na criação de um compilador D a partir do zero. </font><font style="vertical-align: inherit;">Ele era um estudante de graduação em ciência da computação em 2012-2018. </font><font style="vertical-align: inherit;">na Universidade de Oldenburg. </font><font style="vertical-align: inherit;">Sua tese de doutorado se concentra em sistemas de quórum em conjunto com gráficos. </font><font style="vertical-align: inherit;">Desde 2018, ele tem o prazer de usar D em seu trabalho diário, trabalhando para a Symmetry Investments.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sobre os investimentos em simetria</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A Symmetry Investments é uma empresa de investimento global com escritórios em Hong Kong, Cingapura e Londres. </font><font style="vertical-align: inherit;">Trabalhamos desde 2014, depois de nos separarmos com sucesso de um grande fundo de hedge de Nova York.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na Symmetry, nos esforçamos para correr riscos razoavelmente para criar valor para nossos clientes, parceiros e funcionários. Nós nos beneficiamos de nossa capacidade de gerar contratos ganha-ganha - no sentido mais amplo da palavra. Win-Win é o nosso princípio ético e estratégico fundamental. Ao gerar opções ganha-ganha, podemos criar soluções exclusivas que combinam perspectivas que geralmente são consideradas incompatíveis ou opostas e cobrem o melhor que cada uma das partes pode oferecer. Estamos reintegrando a arbitragem de renda fixa com macro estratégias globais. Inventamos e desenvolvemos uma tecnologia que se concentra no potencial da integração homem-máquina. Criamos sistemas nos quais as máquinas fazem o que fazem de melhor, apoiando as pessoas empara que eles façam o que fazem melhor. Criamos uma meritocracia baseada na cooperação: uma cultura na qual a contribuição individual serve tanto a objetivos pessoais quanto coletivos - e é recompensada de acordo. Valorizamos o senso de propriedade e o espírito de equipe de cooperação, auto-realização e comunidade.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O pessoal da Symmetry Investments é membro ativo da Comunidade D desde 2014. </font><font style="vertical-align: inherit;">Patrocinamos o desenvolvimento de projetos excel-d, dpp, autowrap, libmir e outros. </font><font style="vertical-align: inherit;">Lançamos o Symmetry Autumn of Code em 2018 e hospedamos o DConf 2019 em Londres. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aproximadamente. </font><font style="vertical-align: inherit;">Como o tradutor, como sempre, estava bêbado, não posso garantir a precisão de alguns termos humanos e não entendo nada na última seção. </font><font style="vertical-align: inherit;">Portanto, envie correções nas comunicações pessoais.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt490088/index.html">Como continuar a criar um mapa no UE4</a></li>
<li><a href="../pt490092/index.html">Andrei Zaretsky, Alexander Trukhanov: “A taxa era suficiente para tomar café”</a></li>
<li><a href="../pt490094/index.html">De volta às raízes: dirigimos um computador diretamente do MBR</a></li>
<li><a href="../pt490096/index.html">Maneira fácil de criar um pequeno hub USB para Raspberry Pi</a></li>
<li><a href="../pt490100/index.html">Desenvolva software para aluguel de scooter descentralizado. Quem disse que seria fácil?</a></li>
<li><a href="../pt490104/index.html">Pala de sol inteligente da Bosch. Teste de protótipo</a></li>
<li><a href="../pt490110/index.html">De desenvolvedor a gerentes e vice-versa</a></li>
<li><a href="../pt490112/index.html">Mônadas como um padrão de reutilização de código</a></li>
<li><a href="../pt490114/index.html">Yandex.Practicum - Analista de Dados. Graduação</a></li>
<li><a href="../pt490118/index.html">10 fatos mais importantes sobre o SERM</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>