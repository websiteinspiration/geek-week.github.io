<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤙🏾 💾 👨🏻‍🍳 Optimierung der Check Point-API mit dem Python SDK ⛷️ 🧗🏻 🤓</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die gesamte Leistungsfähigkeit der Interaktion mit der API wird in Verbindung mit Programmcode offengelegt, wenn es möglich wird, API-Anforderungen un...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Optimierung der Check Point-API mit dem Python SDK</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/505510/"><img src="https://habrastorage.org/webt/xf/kx/d6/xfkxd68ynnabb65k6ygvksmoyzw.png" alt="Bild"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die gesamte Leistungsfähigkeit der Interaktion mit der API wird in Verbindung mit Programmcode offengelegt, wenn es möglich wird, API-Anforderungen und Tools zur Analyse von API-Antworten dynamisch zu generieren. Das </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python Software Development Kit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (im Folgenden als Python SDK bezeichnet) für die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Check Point Management-API</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bleibt </font><font style="vertical-align: inherit;">jedoch vergeblich </font><font style="vertical-align: inherit;">unsichtbar </font><font style="vertical-align: inherit;">. Dies vereinfacht das Leben von Entwicklern und Automatisierungsliebhabern erheblich. Python hat in letzter Zeit eine immense Popularität erlangt und ich habe mich entschlossen, diese Lücke zu schließen und einen Überblick über die Hauptfunktionen des </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Check Point API Python Development Kit zu geben</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dieser Artikel ist eine hervorragende Ergänzung zu einem anderen Artikel über die Habré </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Check Point R80.10 API. Verwaltung über CLI, Skripte und mehr</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Wir werden uns überlegen, wie Skripte mit dem Python SDK geschrieben werden, und die neue Management-API-Funktionalität in Version 1.6 (unterstützt seit R80.40) genauer untersuchen. </font><font style="vertical-align: inherit;">Um den Artikel zu verstehen, benötigen Sie Grundkenntnisse in der Arbeit mit APIs und Python.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Check Point entwickelt die API aktiv und im Moment gibt es:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Check Point Management API (aktuelle Version 1.6)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Arbeiten Sie mit dem Management Server über die API (und der Möglichkeit, Skripts auf Gateways unter der Kontrolle des Management Servers auszuführen).</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Check Point GAIA API (aktuelle Version 1.4)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Arbeiten Sie mit Sicherheitsgateways</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Threat Prevention API 1.0</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Sandboxing in der Check Point Cloud</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Identity Awareness API</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Arbeiten mit dem Identity Awareness Blade auf Gateways</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Security Management Portal API</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Arbeiten mit dem SMB Gateway Management Portal ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Weitere </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Informationen </font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">zu SMB Gateways</font></a><font style="vertical-align: inherit;"> )</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IoT API</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Interaktion mit IoT-Controllern</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CloudGuard Connect API</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Arbeiten mit </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CloudGuard Connect</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (SD-WAN-Sicherheitslösung)</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dome9 API</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Arbeiten mit </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dome9</font></font></a> </li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Python SDK unterstützt derzeit nur die Interaktion mit der Management-API und der </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gaia-API</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">In diesem Modul werden die wichtigsten Klassen, Methoden und Variablen behandelt.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7v/vt/1x/7vvt1xvikrzesgwntw5mrx8tqlu.jpeg" alt="Bild"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modulinstallation</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cpapi-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Modul </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lässt sich</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mit </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pip</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> schnell und einfach aus dem </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">offiziellen Check Point-Repository auf github</font></a><font style="vertical-align: inherit;"> installieren </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Detaillierte Installationsanweisungen finden Sie in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">README.md</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dieses Modul ist für die Arbeit mit Versionen von Python 2.7 und 3.7 angepasst. </font><font style="vertical-align: inherit;">In diesem Artikel werden Beispiele mit Python 3.7 gegeben. </font><font style="vertical-align: inherit;">Das Python SDK kann jedoch direkt vom Check Point-Verwaltungsserver (Smart Management) ausgeführt werden, unterstützt jedoch nur Python 2.7, sodass der letzte Abschnitt Code für Version 2.7 enthält. </font><font style="vertical-align: inherit;">Ich empfehle, sich unmittelbar nach der Installation des Moduls die Beispiele in den Verzeichnissen </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">examples_python2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">examples_python3</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> anzusehen </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arbeitsbeginn</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Damit wir mit den Komponenten des cpapi-Moduls arbeiten können </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, müssen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mindestens zwei erforderliche Klassen </font><font style="vertical-align: inherit;">aus dem </font><b><font style="vertical-align: inherit;">cpapi-</font></b><font style="vertical-align: inherit;"> Modul importiert werden </font><font style="vertical-align: inherit;">: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIClient</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIClientArgs</font></font></b><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> cpapi <span class="hljs-keyword">import</span> APIClient, APIClientArgs
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIClientArgs-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Klasse </font><b><font style="vertical-align: inherit;">ist</font></b><font style="vertical-align: inherit;"> für die Verbindung zum API-Server verantwortlich, und die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIClient-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Klasse </font><b><font style="vertical-align: inherit;">ist</font></b><font style="vertical-align: inherit;"> für die Interaktion mit der API verantwortlich.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir bestimmen die Verbindungsparameter</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um verschiedene Parameter für die Verbindung mit der API zu definieren, müssen Sie eine Instanz der </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIClientArgs-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Klasse </font><b><font style="vertical-align: inherit;">erstellen</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Im Prinzip sind die Parameter vordefiniert und können beim Ausführen des Skripts auf dem Verwaltungsserver weggelassen werden.</font></font><br>
<br>
<pre><code class="python hljs">client_args = APIClientArgs()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie jedoch auf einem Host eines Drittanbieters starten, müssen Sie mindestens die IP-Adresse oder den Hostnamen des API-Servers angeben (es handelt sich auch um einen Verwaltungsserver). </font><font style="vertical-align: inherit;">Im folgenden Beispiel definieren wir den Serververbindungsparameter und weisen ihm die IP-Adresse des Verwaltungsservers als Zeichenfolge zu.</font></font><br>
<br>
<pre><code class="python hljs">client_args = APIClientArgs(server=<span class="hljs-string">'192.168.47.241'</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schauen wir uns alle Parameter und ihre Standardwerte an, die beim Herstellen einer Verbindung zum API-Server verwendet werden können:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Argumente für die __init__ -Methode der APIClientArgs-Klasse</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">APIClientArgs</span>:</span>
    <span class="hljs-string">"""
    This class provides arguments for APIClient configuration.
    All the arguments are configured with their default values.
    """</span><font></font>
<font></font>
    <span class="hljs-comment"># port is set to None by default, but it gets replaced with 443 if not specified</span>
    <span class="hljs-comment"># context possible values - web_api (default) or gaia_api</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, port=None, fingerprint=None, sid=None, server=<span class="hljs-string">"127.0.0.1"</span>, http_debug_level=<span class="hljs-number">0</span>,
                 api_calls=None, debug_file=<span class="hljs-string">""</span>, proxy_host=None, proxy_port=<span class="hljs-number">8080</span>,
                 api_version=None, unsafe=False, unsafe_auto_accept=False, context=<span class="hljs-string">"web_api"</span></span>):</span><font></font>
        self.port = port<font></font>
        <span class="hljs-comment"># management server fingerprint</span><font></font>
        self.fingerprint = fingerprint<font></font>
        <span class="hljs-comment"># session-id.</span><font></font>
        self.sid = sid<font></font>
        <span class="hljs-comment"># management server name or IP-address</span><font></font>
        self.server = server<font></font>
        <span class="hljs-comment"># debug level</span><font></font>
        self.http_debug_level = http_debug_level<font></font>
        <span class="hljs-comment"># an array with all the api calls (for debug purposes)</span>
        self.api_calls = api_calls <span class="hljs-keyword">if</span> api_calls <span class="hljs-keyword">else</span> []
        <span class="hljs-comment"># name of debug file. If left empty, debug data will not be saved to disk.</span><font></font>
        self.debug_file = debug_file<font></font>
        <span class="hljs-comment"># HTTP proxy server address (without "http://")</span><font></font>
        self.proxy_host = proxy_host<font></font>
        <span class="hljs-comment"># HTTP proxy port</span><font></font>
        self.proxy_port = proxy_port<font></font>
        <span class="hljs-comment"># Management server's API version</span><font></font>
        self.api_version = api_version<font></font>
        <span class="hljs-comment"># Indicates that the client should not check the server's certificate</span><font></font>
        self.unsafe = unsafe<font></font>
        <span class="hljs-comment"># Indicates that the client should automatically accept and save the server's certificate</span><font></font>
        self.unsafe_auto_accept = unsafe_auto_accept<font></font>
        <span class="hljs-comment"># The context of using the client - defaults to web_api</span>
        self.context = context</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich glaube, dass die Argumente, die in Instanzen der APIClientArgs-Klasse verwendet werden können, für Check Point-Administratoren intuitiv sind und keine zusätzlichen Kommentare benötigen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stellen Sie eine Verbindung über APIClient und den Kontextmanager her</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIClient-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Klasse wird </font><b><font style="vertical-align: inherit;">am</font></b><font style="vertical-align: inherit;"> bequemsten über den Kontextmanager verwendet. </font><font style="vertical-align: inherit;">Alles, was Sie an eine Instanz der APIClient-Klasse übergeben müssen, sind die Verbindungsparameter, die im letzten Schritt definiert wurden.</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">with</span> APIClient(client_args) <span class="hljs-keyword">as</span> client:
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Kontextmanager führt nicht automatisch einen Anmeldeaufruf beim API-Server durch, sondern beim Beenden einen Abmeldeaufruf. </font><font style="vertical-align: inherit;">Wenn Sie sich aus irgendeinem Grund am Ende des API-Aufrufs nicht abmelden müssen, müssen Sie die Arbeit ohne Verwendung des Kontextmanagers beginnen:</font></font><br>
<br>
<pre><code class="python hljs">client = APIClient(clieng_args)</code></pre><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verbindungsprüfung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der einfachste Weg zu überprüfen, ob eine Verbindung die angegebenen Parameter durchläuft, ist die Verwendung der </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">check_fingerprint-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Methode </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Wenn die Überprüfung des sha1-Hashs für den Fingerabdruck des Server-API-Zertifikats nicht bestanden wurde (die Methode hat </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">False zurückgegeben</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), wird dies normalerweise durch Verbindungsprobleme verursacht und wir können das Programm stoppen (oder dem Benutzer erlauben, die Verbindungsdaten zu reparieren):</font></font><br>
<br>
<pre><code class="python hljs">    <span class="hljs-keyword">if</span> client.check_fingerprint() <span class="hljs-keyword">is</span> <span class="hljs-literal">False</span>:<font></font>
        print(<span class="hljs-string">"Could not get the server's fingerprint - Check connectivity with the server."</span>)<font></font>
        exit(<span class="hljs-number">1</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beachten Sie, dass die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIClient-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Klasse in </font><font style="vertical-align: inherit;">Zukunft bei jedem API-Aufruf ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">api_call-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">api_query-Methoden</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , wir werden etwas weiter darüber sprechen) das sha1-Fingerabdruckzertifikat auf dem API-Server überprüft. </font><font style="vertical-align: inherit;">Wenn jedoch beim Überprüfen des sha1-Fingerabdrucks des Server-API-Zertifikats ein Fehler festgestellt wird (das Zertifikat ist unbekannt oder wurde geändert), </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bietet die</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Methode </font><b><font style="vertical-align: inherit;">check_fingerprint</font></b><font style="vertical-align: inherit;"> die Möglichkeit, im automatischen Modus Informationen auf dem lokalen Computer hinzuzufügen / zu ändern. </font><font style="vertical-align: inherit;">Diese Prüfung kann mithilfe des APIClientArgs-Arguments - </font><b><font style="vertical-align: inherit;">unsafe_auto_accept</font></b><font style="vertical-align: inherit;"> vollständig </font><b><font style="vertical-align: inherit;">deaktiviert</font></b><font style="vertical-align: inherit;"> werden (dies kann jedoch nur empfohlen werden, wenn Skripts auf dem API-Server selbst ausgeführt werden, wenn eine Verbindung zu 127.0.0.1 besteht)</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Weitere Informationen zu APIClientArgs finden Sie weiter oben unter „Definieren von Verbindungsparametern“.)</font></font><br>
<br>
<pre><code class="python hljs">client_args = APIClientArgs(unsafe_auto_accept=<span class="hljs-literal">True</span>)</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Melden Sie sich beim API-Server an</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIClient</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> haben bis zu 3 Anmeldemethoden auf dem API-Server, und jeder von ihnen zaponimaet Wert </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sid</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (die Sitzungs-ID), die automatisch in jedem nachfolgenden API </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-Aufruf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> im Header verwendet wird (der Name des Titels in dieser Einstellung - </font><b><font style="vertical-align: inherit;">die X-CHKP-sid</font></b><font style="vertical-align: inherit;"> ), also dass Sie diesen Parameter nicht weiter verarbeiten müssen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anmeldemethode</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Option unter Verwendung des Benutzernamens und des Kennworts (im Beispiel werden der Benutzername admin und das Kennwort 1q2w3e als Positionsargumente übergeben):</font></font><br>
<br>
<pre><code class="python hljs">     login = client.login(<span class="hljs-string">'admin'</span>, <span class="hljs-string">'1q2w3e'</span>)  </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die optionalen optionalen Parameter sind auch in der Anmeldemethode verfügbar. Ich liste ihre Namen und Standardwerte auf: </font></font><br>
<br>
<pre><code class="python hljs">continue_last_session=<span class="hljs-literal">False</span>, domain=<span class="hljs-literal">None</span>, read_only=<span class="hljs-literal">False</span>, payload=<span class="hljs-literal">None</span></code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Login_with_api_key Methode</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine Variante, die den API-Schlüssel verwendet (unterstützt seit der Verwaltungsversion R80.40 / Management API v1.6, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">„3TsbPJ8ZKjaJGvFyoFqHFA ==“,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist der Wert des API-Schlüssels für einen der Benutzer auf dem Verwaltungsserver mit der API-Schlüsselautorisierungsmethode):</font></font><br>
<br>
<pre><code class="python hljs">     login = client.login_with_api_key(<span class="hljs-string">'3TsbPJ8ZKjaJGvFyoFqHFA=='</span>) </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der Methode </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">login_with_api_key</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> stehen dieselben optionalen Parameter zur Verfügung wie in der Methode </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">login</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Login_as_root-Methode</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Anmeldeoption für den lokalen Computer mit dem API-Server:</font></font><br>
<br>
<pre><code class="python hljs">     login = client.login_as_root()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für diese Methode stehen nur zwei optionale Parameter zur Verfügung:</font></font><br>
<br>
<pre><code class="python hljs">domain=<span class="hljs-literal">None</span>, payload=<span class="hljs-literal">None</span></code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schließlich ruft sich die API selbst auf</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben zwei Möglichkeiten, API-Aufrufe über die </font><b><font style="vertical-align: inherit;">Methoden </font></b></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">api_call</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">api_query durchzuführen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Lassen Sie uns herausfinden, was der Unterschied zwischen ihnen ist.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">api_call</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Methode gilt für alle Anrufe. </font><font style="vertical-align: inherit;">Bei Bedarf müssen wir den letzten Teil für den API-Aufruf und die Nutzdaten im Anfragetext übergeben. </font><font style="vertical-align: inherit;">Wenn die Nutzlast leer ist, können Sie sie überhaupt nicht übertragen:</font></font><br>
<br>
<pre><code class="python hljs">api_versions = client.api_call(<span class="hljs-string">'show-api-versions'</span>) </code></pre><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Ausgabe für diese Anfrage unter cat:</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs">In [<span class="hljs-number">23</span>]: api_versions                                                           <font></font>
Out[<span class="hljs-number">23</span>]: <font></font>
APIResponse({<font></font>
    <span class="hljs-string">"data"</span>: {
        <span class="hljs-string">"current-version"</span>: <span class="hljs-string">"1.6"</span>,
        <span class="hljs-string">"supported-versions"</span>: [
            <span class="hljs-string">"1"</span>,
            <span class="hljs-string">"1.1"</span>,
            <span class="hljs-string">"1.2"</span>,
            <span class="hljs-string">"1.3"</span>,
            <span class="hljs-string">"1.4"</span>,
            <span class="hljs-string">"1.5"</span>,
            <span class="hljs-string">"1.6"</span><font></font>
        ]<font></font>
    },<font></font>
    <span class="hljs-string">"res_obj"</span>: {
        <span class="hljs-string">"data"</span>: {
            <span class="hljs-string">"current-version"</span>: <span class="hljs-string">"1.6"</span>,
            <span class="hljs-string">"supported-versions"</span>: [
                <span class="hljs-string">"1"</span>,
                <span class="hljs-string">"1.1"</span>,
                <span class="hljs-string">"1.2"</span>,
                <span class="hljs-string">"1.3"</span>,
                <span class="hljs-string">"1.4"</span>,
                <span class="hljs-string">"1.5"</span>,
                <span class="hljs-string">"1.6"</span><font></font>
            ]<font></font>
        },<font></font>
        <span class="hljs-string">"status_code"</span>: <span class="hljs-number">200</span><font></font>
    },<font></font>
    <span class="hljs-string">"status_code"</span>: <span class="hljs-number">200</span>,
    <span class="hljs-string">"success"</span>: true<font></font>
})<font></font>
</code></pre><br>
</div>
                    </div><br>
<pre><code class="python hljs">show_host = client.api_call(<span class="hljs-string">'show-host'</span>, {<span class="hljs-string">'name'</span> : <span class="hljs-string">'h_8.8.8.8'</span>})</code></pre><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Ausgabe für diese Anfrage unter cat:</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs">In [<span class="hljs-number">25</span>]: show_host                                                              <font></font>
Out[<span class="hljs-number">25</span>]: <font></font>
APIResponse({<font></font>
    <span class="hljs-string">"data"</span>: {
        <span class="hljs-string">"color"</span>: <span class="hljs-string">"black"</span>,
        <span class="hljs-string">"comments"</span>: <span class="hljs-string">""</span>,
        <span class="hljs-string">"domain"</span>: {
            <span class="hljs-string">"domain-type"</span>: <span class="hljs-string">"domain"</span>,
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"SMC User"</span>,
            <span class="hljs-string">"uid"</span>: <span class="hljs-string">"41e821a0-3720-11e3-aa6e-0800200c9fde"</span><font></font>
        },<font></font>
        <span class="hljs-string">"groups"</span>: [],
        <span class="hljs-string">"icon"</span>: <span class="hljs-string">"Objects/host"</span>,
        <span class="hljs-string">"interfaces"</span>: [],
        <span class="hljs-string">"ipv4-address"</span>: <span class="hljs-string">"8.8.8.8"</span>,
        <span class="hljs-string">"meta-info"</span>: {
            <span class="hljs-string">"creation-time"</span>: {
                <span class="hljs-string">"iso-8601"</span>: <span class="hljs-string">"2020-05-01T21:49+0300"</span>,
                <span class="hljs-string">"posix"</span>: <span class="hljs-number">1588358973517</span><font></font>
            },<font></font>
            <span class="hljs-string">"creator"</span>: <span class="hljs-string">"admin"</span>,
            <span class="hljs-string">"last-modifier"</span>: <span class="hljs-string">"admin"</span>,
            <span class="hljs-string">"last-modify-time"</span>: {
                <span class="hljs-string">"iso-8601"</span>: <span class="hljs-string">"2020-05-01T21:49+0300"</span>,
                <span class="hljs-string">"posix"</span>: <span class="hljs-number">1588358973517</span><font></font>
            },<font></font>
            <span class="hljs-string">"lock"</span>: <span class="hljs-string">"unlocked"</span>,
            <span class="hljs-string">"validation-state"</span>: <span class="hljs-string">"ok"</span><font></font>
        },<font></font>
        <span class="hljs-string">"name"</span>: <span class="hljs-string">"h_8.8.8.8"</span>,
        <span class="hljs-string">"nat-settings"</span>: {
            <span class="hljs-string">"auto-rule"</span>: false<font></font>
        },<font></font>
        <span class="hljs-string">"read-only"</span>: false,
        <span class="hljs-string">"tags"</span>: [],
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"host"</span>,
        <span class="hljs-string">"uid"</span>: <span class="hljs-string">"c210af07-1939-49d3-a351-953a9c471d9e"</span><font></font>
    },<font></font>
    <span class="hljs-string">"res_obj"</span>: {
        <span class="hljs-string">"data"</span>: {
            <span class="hljs-string">"color"</span>: <span class="hljs-string">"black"</span>,
            <span class="hljs-string">"comments"</span>: <span class="hljs-string">""</span>,
            <span class="hljs-string">"domain"</span>: {
                <span class="hljs-string">"domain-type"</span>: <span class="hljs-string">"domain"</span>,
                <span class="hljs-string">"name"</span>: <span class="hljs-string">"SMC User"</span>,
                <span class="hljs-string">"uid"</span>: <span class="hljs-string">"41e821a0-3720-11e3-aa6e-0800200c9fde"</span><font></font>
            },<font></font>
            <span class="hljs-string">"groups"</span>: [],
            <span class="hljs-string">"icon"</span>: <span class="hljs-string">"Objects/host"</span>,
            <span class="hljs-string">"interfaces"</span>: [],
            <span class="hljs-string">"ipv4-address"</span>: <span class="hljs-string">"8.8.8.8"</span>,
            <span class="hljs-string">"meta-info"</span>: {
                <span class="hljs-string">"creation-time"</span>: {
                    <span class="hljs-string">"iso-8601"</span>: <span class="hljs-string">"2020-05-01T21:49+0300"</span>,
                    <span class="hljs-string">"posix"</span>: <span class="hljs-number">1588358973517</span><font></font>
                },<font></font>
                <span class="hljs-string">"creator"</span>: <span class="hljs-string">"admin"</span>,
                <span class="hljs-string">"last-modifier"</span>: <span class="hljs-string">"admin"</span>,
                <span class="hljs-string">"last-modify-time"</span>: {
                    <span class="hljs-string">"iso-8601"</span>: <span class="hljs-string">"2020-05-01T21:49+0300"</span>,
                    <span class="hljs-string">"posix"</span>: <span class="hljs-number">1588358973517</span><font></font>
                },<font></font>
                <span class="hljs-string">"lock"</span>: <span class="hljs-string">"unlocked"</span>,
                <span class="hljs-string">"validation-state"</span>: <span class="hljs-string">"ok"</span><font></font>
            },<font></font>
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"h_8.8.8.8"</span>,
            <span class="hljs-string">"nat-settings"</span>: {
                <span class="hljs-string">"auto-rule"</span>: false<font></font>
            },<font></font>
            <span class="hljs-string">"read-only"</span>: false,
            <span class="hljs-string">"tags"</span>: [],
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"host"</span>,
            <span class="hljs-string">"uid"</span>: <span class="hljs-string">"c210af07-1939-49d3-a351-953a9c471d9e"</span><font></font>
        },<font></font>
        <span class="hljs-string">"status_code"</span>: <span class="hljs-number">200</span><font></font>
    },<font></font>
    <span class="hljs-string">"status_code"</span>: <span class="hljs-number">200</span>,
    <span class="hljs-string">"success"</span>: true<font></font>
})<font></font>
</code></pre><br>
</div>
                    </div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">api_query</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Machen Sie sofort einen Vorbehalt, dass diese Methode nur für Anrufe gilt, deren Ausgabe Offset (Shift) beinhaltet. Diese Schlussfolgerung tritt auf, wenn sie eine große Menge an Informationen enthält oder enthalten kann. Dies kann beispielsweise eine Anforderung für eine Liste aller auf dem Verwaltungsserver erstellten Objekte vom Typ Host sein. Für solche Anforderungen gibt die API standardmäßig eine Liste mit 50 Objekten zurück (Sie können das Limit in der Antwort auf 500 Objekte erhöhen). Und um die Informationen nicht mehrmals abzurufen und den Offset-Parameter in der API-Anforderung zu ändern, gibt es eine api_query-Methode, die dies automatisch erledigt. Beispiele für Aufrufe, bei denen diese Methode benötigt wird: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Show-Sessions, Show-Hosts, Show-Netzwerke, Show-Wildcards, Show-Gruppen, Show-Adressbereiche, Show-Simple-Gateways, Show-Simple-Cluster, Show-Access- Rollen, Show-Trusted-Clients, Show-Pakete</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Tatsächlich sehen wir im Namen dieser API-Aufrufe mehrere Wörter, sodass diese Aufrufe über </font><b><font style="vertical-align: inherit;">api_query</font></b><font style="vertical-align: inherit;"> einfacher zu handhaben </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sind</font></font></b><br>
<br>
<pre><code class="python hljs">show_hosts = client.api_query(<span class="hljs-string">'show-hosts'</span>) </code></pre><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Ausgabe für diese Anfrage unter cat:</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs">In [<span class="hljs-number">21</span>]: show_hosts                                                             <font></font>
Out[<span class="hljs-number">21</span>]: <font></font>
APIResponse({<font></font>
    <span class="hljs-string">"data"</span>: [<font></font>
        {<font></font>
            <span class="hljs-string">"domain"</span>: {
                <span class="hljs-string">"domain-type"</span>: <span class="hljs-string">"domain"</span>,
                <span class="hljs-string">"name"</span>: <span class="hljs-string">"SMC User"</span>,
                <span class="hljs-string">"uid"</span>: <span class="hljs-string">"41e821a0-3720-11e3-aa6e-0800200c9fde"</span><font></font>
            },<font></font>
            <span class="hljs-string">"ipv4-address"</span>: <span class="hljs-string">"192.168.47.1"</span>,
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"h_192.168.47.1"</span>,
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"host"</span>,
            <span class="hljs-string">"uid"</span>: <span class="hljs-string">"5d7d7086-d70b-4995-971a-0583b15a2bfc"</span><font></font>
        },<font></font>
        {<font></font>
            <span class="hljs-string">"domain"</span>: {
                <span class="hljs-string">"domain-type"</span>: <span class="hljs-string">"domain"</span>,
                <span class="hljs-string">"name"</span>: <span class="hljs-string">"SMC User"</span>,
                <span class="hljs-string">"uid"</span>: <span class="hljs-string">"41e821a0-3720-11e3-aa6e-0800200c9fde"</span><font></font>
            },<font></font>
            <span class="hljs-string">"ipv4-address"</span>: <span class="hljs-string">"8.8.8.8"</span>,
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"h_8.8.8.8"</span>,
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"host"</span>,
            <span class="hljs-string">"uid"</span>: <span class="hljs-string">"c210af07-1939-49d3-a351-953a9c471d9e"</span><font></font>
        }<font></font>
    ],<font></font>
    <span class="hljs-string">"res_obj"</span>: {
        <span class="hljs-string">"data"</span>: {
            <span class="hljs-string">"from"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"objects"</span>: [<font></font>
                {<font></font>
                    <span class="hljs-string">"domain"</span>: {
                        <span class="hljs-string">"domain-type"</span>: <span class="hljs-string">"domain"</span>,
                        <span class="hljs-string">"name"</span>: <span class="hljs-string">"SMC User"</span>,
                        <span class="hljs-string">"uid"</span>: <span class="hljs-string">"41e821a0-3720-11e3-aa6e-0800200c9fde"</span><font></font>
                    },<font></font>
                    <span class="hljs-string">"ipv4-address"</span>: <span class="hljs-string">"192.168.47.1"</span>,
                    <span class="hljs-string">"name"</span>: <span class="hljs-string">"h_192.168.47.1"</span>,
                    <span class="hljs-string">"type"</span>: <span class="hljs-string">"host"</span>,
                    <span class="hljs-string">"uid"</span>: <span class="hljs-string">"5d7d7086-d70b-4995-971a-0583b15a2bfc"</span><font></font>
                },<font></font>
                {<font></font>
                    <span class="hljs-string">"domain"</span>: {
                        <span class="hljs-string">"domain-type"</span>: <span class="hljs-string">"domain"</span>,
                        <span class="hljs-string">"name"</span>: <span class="hljs-string">"SMC User"</span>,
                        <span class="hljs-string">"uid"</span>: <span class="hljs-string">"41e821a0-3720-11e3-aa6e-0800200c9fde"</span><font></font>
                    },<font></font>
                    <span class="hljs-string">"ipv4-address"</span>: <span class="hljs-string">"8.8.8.8"</span>,
                    <span class="hljs-string">"name"</span>: <span class="hljs-string">"h_8.8.8.8"</span>,
                    <span class="hljs-string">"type"</span>: <span class="hljs-string">"host"</span>,
                    <span class="hljs-string">"uid"</span>: <span class="hljs-string">"c210af07-1939-49d3-a351-953a9c471d9e"</span><font></font>
                }<font></font>
            ],<font></font>
            <span class="hljs-string">"to"</span>: <span class="hljs-number">2</span>,
            <span class="hljs-string">"total"</span>: <span class="hljs-number">2</span><font></font>
        },<font></font>
        <span class="hljs-string">"status_code"</span>: <span class="hljs-number">200</span><font></font>
    },<font></font>
    <span class="hljs-string">"status_code"</span>: <span class="hljs-number">200</span>,
    <span class="hljs-string">"success"</span>: true<font></font>
})<font></font>
</code></pre><br>
</div>
                    </div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verarbeiten von API-Aufrufergebnissen</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Danach können Sie die Variablen und Methoden der </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIResponse-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Klasse verwenden </font><font style="vertical-align: inherit;">(sowohl innerhalb als auch außerhalb des Kontextmanagers). </font><font style="vertical-align: inherit;">Die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIResponse-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Klasse </font><b><font style="vertical-align: inherit;">verfügt über</font></b><font style="vertical-align: inherit;"> 4 vordefinierte Methoden und 5 vordefinierte Variablen. Wir werden uns näher mit den wichtigsten </font><b><font style="vertical-align: inherit;">befassen</font></b><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yb/1q/av/yb1qavksjibe6qizmrjxsaprdp4.jpeg" alt="Bild"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erfolg</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zunächst wäre es schön, sicherzustellen, dass der API-Aufruf erfolgreich war und das Ergebnis zurückgibt. </font><font style="vertical-align: inherit;">Hierfür gibt es eine </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erfolgsmethode</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="python hljs">In [<span class="hljs-number">49</span>]: api_versions.success                                                   <font></font>
Out[<span class="hljs-number">49</span>]: <span class="hljs-literal">True</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gibt True zurück, wenn der API-Aufruf erfolgreich war (Antwortcode ist 200) und False, wenn er nicht erfolgreich war (jeder andere Antwortcode). </font><font style="vertical-align: inherit;">Es ist praktisch, unmittelbar nach dem API-Aufruf zu verwenden, sodass Sie je nach Antwortcode unterschiedliche Informationen anzeigen können.</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">if</span> api_ver.success: <font></font>
    print(api_versions.data) <font></font>
<span class="hljs-keyword">else</span>: <font></font>
    print(api_versions.err_message) </code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Statuscode</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gibt den Antwortcode nach einem API-Aufruf zurück.</font></font><br>
<br>
<pre><code class="python hljs">In [<span class="hljs-number">62</span>]: api_versions.status_code                                               <font></font>
Out[<span class="hljs-number">62</span>]: <span class="hljs-number">400</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mögliche Antwortcodes: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">200.400.401.403.404.409.500.501</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set_success_status</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Möglicherweise muss der Wert des Erfolgsstatus geändert werden. </font><font style="vertical-align: inherit;">Technisch kann man dort alles platzieren, sogar eine gewöhnliche Saite. </font><font style="vertical-align: inherit;">Ein reales Beispiel wäre jedoch, diesen Parameter unter bestimmten Begleitbedingungen auf False zurückzusetzen. </font><font style="vertical-align: inherit;">Beachten Sie im Folgenden ein Beispiel für Aufgaben, die auf dem Verwaltungsserver ausgeführt werden. Diese Anforderung wird jedoch als nicht erfolgreich angesehen (setzen Sie die Erfolgsvariable auf </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">False</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , obwohl der API-Aufruf erfolgreich war und Code 200 zurückgegeben hat).</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> task <span class="hljs-keyword">in</span> task_result.data[<span class="hljs-string">"tasks"</span>]:
    <span class="hljs-keyword">if</span> task[<span class="hljs-string">"status"</span>] == <span class="hljs-string">"failed"</span> <span class="hljs-keyword">or</span> task[<span class="hljs-string">"status"</span>] == <span class="hljs-string">"partially succeeded"</span>:<font></font>
        task_result.set_success_status(<span class="hljs-literal">False</span>)
        <span class="hljs-keyword">break</span></code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antwort ()</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit der Antwortmethode können Sie das Wörterbuch mit dem Antwortcode (status_code) und mit dem Antworttext (body) anzeigen.</font></font><br>
<br>
<pre><code class="python hljs">In [<span class="hljs-number">94</span>]: api_versions.response()                                                <font></font>
Out[<span class="hljs-number">94</span>]: <font></font>
{<span class="hljs-string">'status_code'</span>: <span class="hljs-number">200</span>,
 <span class="hljs-string">'data'</span>: {<span class="hljs-string">'current-version'</span>: <span class="hljs-string">'1.6'</span>,
  <span class="hljs-string">'supported-versions'</span>: [<span class="hljs-string">'1'</span>, <span class="hljs-string">'1.1'</span>, <span class="hljs-string">'1.2'</span>, <span class="hljs-string">'1.3'</span>, <span class="hljs-string">'1.4'</span>, <span class="hljs-string">'1.5'</span>, <span class="hljs-string">'1.6'</span>]}}
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daten</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ermöglicht es Ihnen, nur den Textkörper der Antwort (Textkörper) ohne unnötige Informationen anzuzeigen.</font></font><br>
<br>
<pre><code class="python hljs">In [<span class="hljs-number">93</span>]: api_versions.data                                                      <font></font>
Out[<span class="hljs-number">93</span>]: <font></font>
{<span class="hljs-string">'current-version'</span>: <span class="hljs-string">'1.6'</span>,
 <span class="hljs-string">'supported-versions'</span>: [<span class="hljs-string">'1'</span>, <span class="hljs-string">'1.1'</span>, <span class="hljs-string">'1.2'</span>, <span class="hljs-string">'1.3'</span>, <span class="hljs-string">'1.4'</span>, <span class="hljs-string">'1.5'</span>, <span class="hljs-string">'1.6'</span>]}
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fehlermeldung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Informationen sind nur verfügbar, wenn bei der Verarbeitung der Anforderungs-API ein Fehler aufgetreten ist (Antwortcode ist </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nicht</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 200). </font><font style="vertical-align: inherit;">Ausgabebeispiel</font></font><br>
<pre><code class="python hljs">In [<span class="hljs-number">107</span>]: api_versions.error_message                                            <font></font>
Out[<span class="hljs-number">107</span>]: <span class="hljs-string">'code: generic_err_invalid_parameter_name\nmessage: Unrecognized parameter [1]\n'</span>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nützliche Beispiele</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Folgenden finden Sie Beispiele für API-Aufrufe, die der Verwaltungs-API 1.6 hinzugefügt wurden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berücksichtigen Sie zunächst den Vorgang des </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aufrufs</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> von </font><b><font style="vertical-align: inherit;">Add-Host-</font></b><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add-Address-Range-Bereichen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Angenommen, wir müssen alle IP-Adressen des Subnetzes 192.168.0.0/24 als Objekte des Hosttyps erstellen, dessen letztes Oktett 5 ist, und alle anderen IP-Adressen als Adressbereichsobjekte schreiben. In diesem Fall sollten die Subnetzadresse und die Broadcast-Adresse ausgeschlossen werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Folgenden finden Sie ein Skript, das dieses Problem löst und 50 Objekte vom Hosttyp und 51 Objekte vom Typ Adressbereich erstellt. Um das Problem zu lösen, sind 101 API-Aufrufe erforderlich (ohne den letzten Veröffentlichungsaufruf). Außerdem berechnen wir mithilfe des timeit-Moduls die Zeit, die zum Ausführen des Skripts benötigt wird, bis die Änderungen veröffentlicht werden.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Skript mit add-host und add-address-range</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> timeit
<span class="hljs-keyword">from</span> cpapi <span class="hljs-keyword">import</span> APIClient, APIClientArgs<font></font>
<font></font>
start = timeit.default_timer()<font></font>
<font></font>
first_ip = <span class="hljs-number">1</span>
last_ip = <span class="hljs-number">4</span><font></font>
<font></font>
client_args = APIClientArgs(server=<span class="hljs-string">"192.168.47.240"</span>)<font></font>
<font></font>
<span class="hljs-keyword">with</span> APIClient(client_args) <span class="hljs-keyword">as</span> client: <font></font>
     login = client.login_with_api_key(<span class="hljs-string">'3TsbPJ8ZKjaJGvFyoFqHFA=='</span>)
     <span class="hljs-keyword">for</span> ip <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>,<span class="hljs-number">255</span>,<span class="hljs-number">5</span>):<font></font>
         add_host = client.api_call(<span class="hljs-string">"add-host"</span>, {<span class="hljs-string">"name"</span> : <span class="hljs-string">f"h_192.168.0.<span class="hljs-subst">{ip}</span>"</span>, <span class="hljs-string">"ip-address"</span>: <span class="hljs-string">f'192.168.0.<span class="hljs-subst">{ip}</span>'</span>})
     <span class="hljs-keyword">while</span> last_ip &lt; <span class="hljs-number">255</span>:<font></font>
         add_range = client.api_call(<span class="hljs-string">"add-address-range"</span>, {<span class="hljs-string">"name"</span>: <span class="hljs-string">f"r_192.168.0.<span class="hljs-subst">{first_ip}</span>-<span class="hljs-subst">{last_ip}</span>"</span>, <span class="hljs-string">"ip-address-first"</span>: <span class="hljs-string">f"192.168.0.<span class="hljs-subst">{first_ip}</span>"</span>, <span class="hljs-string">"ip-address-last"</span>: <span class="hljs-string">f"192.168.0.<span class="hljs-subst">{last_ip}</span>"</span>})<font></font>
         first_ip+=<span class="hljs-number">5</span>
         last_ip+=<span class="hljs-number">5</span><font></font>
     stop = timeit.default_timer() <font></font>
     publish = client.api_call(<span class="hljs-string">"publish"</span>)<font></font>
     <font></font>
print(<span class="hljs-string">f'Time to execute batch request: <span class="hljs-subst">{stop - start}</span> seconds'</span>)<font></font>
<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In meiner Laborumgebung dauert die Ausführung dieses Skripts je nach Auslastung des Verwaltungsservers 30 bis 50 Sekunden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lassen Sie uns nun sehen, wie Sie dasselbe Problem mithilfe der API zum Aufrufen von </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objekten-Batch-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Aufrufen lösen können </font><font style="vertical-align: inherit;">, deren Unterstützung zu API-Version 1.6 hinzugefügt wurde. </font><font style="vertical-align: inherit;">Mit diesem Aufruf können Sie mehrere Objekte gleichzeitig in einer API-Anforderung erstellen. </font><font style="vertical-align: inherit;">Darüber hinaus können dies Objekte unterschiedlichen Typs sein (z. B. Hosts, Subnetze und Adressbereiche). </font><font style="vertical-align: inherit;">Somit kann unsere Aufgabe im Rahmen eines einzelnen API-Aufrufs gelöst werden.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Skript mit Add-Objects-Batch</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> timeit
<span class="hljs-keyword">from</span> cpapi <span class="hljs-keyword">import</span> APIClient, APIClientArgs<font></font>
<font></font>
start = timeit.default_timer()<font></font>
<font></font>
client_args = APIClientArgs(server=<span class="hljs-string">"192.168.47.240"</span>)<font></font>
<font></font>
objects_list_ip = []<font></font>
objects_list_range = []<font></font>
<font></font>
<span class="hljs-keyword">for</span> ip <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>,<span class="hljs-number">255</span>,<span class="hljs-number">5</span>):<font></font>
    data = {<span class="hljs-string">"name"</span>: <span class="hljs-string">f'h_192.168.0.<span class="hljs-subst">{ip}</span>'</span>, <span class="hljs-string">"ip-address"</span>: <span class="hljs-string">f'192.168.0.<span class="hljs-subst">{ip}</span>'</span>}<font></font>
    objects_list_ip.append(data)<font></font>
    <font></font>
first_ip = <span class="hljs-number">1</span>
last_ip = <span class="hljs-number">4</span><font></font>
<font></font>
<font></font>
<span class="hljs-keyword">while</span> last_ip &lt; <span class="hljs-number">255</span>:<font></font>
    data = {<span class="hljs-string">"name"</span>: <span class="hljs-string">f"r_192.168.0.<span class="hljs-subst">{first_ip}</span>-<span class="hljs-subst">{last_ip}</span>"</span>, <span class="hljs-string">"ip-address-first"</span>: <span class="hljs-string">f"192.168.0.<span class="hljs-subst">{first_ip}</span>"</span>, <span class="hljs-string">"ip-address-last"</span>: <span class="hljs-string">f"192.168.0.<span class="hljs-subst">{last_ip}</span>"</span>}<font></font>
    objects_list_range.append(data)<font></font>
    first_ip+=<span class="hljs-number">5</span>
    last_ip+=<span class="hljs-number">5</span><font></font>
<font></font>
data_for_batch = {<font></font>
  <span class="hljs-string">"objects"</span> : [ {
    <span class="hljs-string">"type"</span> : <span class="hljs-string">"host"</span>,
    <span class="hljs-string">"list"</span> : objects_list_ip<font></font>
}, {<font></font>
    <span class="hljs-string">"type"</span> : <span class="hljs-string">"address-range"</span>,
    <span class="hljs-string">"list"</span> : objects_list_range<font></font>
  }]<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">with</span> APIClient(client_args) <span class="hljs-keyword">as</span> client: <font></font>
     login = client.login_with_api_key(<span class="hljs-string">'3TsbPJ8ZKjaJGvFyoFqHFA=='</span>)<font></font>
     add_objects_batch = client.api_call(<span class="hljs-string">"add-objects-batch"</span>, data_for_batch)<font></font>
     stop = timeit.default_timer() <font></font>
     publish = client.api_call(<span class="hljs-string">"publish"</span>)<font></font>
     <font></font>
print(<span class="hljs-string">f'Time to execute batch request: <span class="hljs-subst">{stop - start}</span> seconds'</span>)
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Ausführung dieses Skripts in meiner Laborumgebung dauert je nach Auslastung des Verwaltungsservers 3 bis 7 Sekunden. </font><font style="vertical-align: inherit;">Das heißt, bei einem 101-API-Objekt wird ein Stapelaufruf durchschnittlich zehnmal schneller ausgeführt. </font><font style="vertical-align: inherit;">Bei mehr Objekten wird der Unterschied noch beeindruckender. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun wollen wir sehen, wie man mit </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Set-Objects-Batch arbeitet</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Mit diesem API-Aufruf können wir jeden Parameter massiv ändern. </font><font style="vertical-align: inherit;">Lassen Sie uns die erste Hälfte der Adressen aus dem vorherigen Beispiel (auf .124 Hosts und Bereiche auch) die Farbe Siena und die zweite Hälfte der Adressen die Farbe Khaki zuweisen.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ändern Sie die Farbe der im vorherigen Beispiel erstellten Objekte</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">from</span> cpapi <span class="hljs-keyword">import</span> APIClient, APIClientArgs<font></font>
<font></font>
client_args = APIClientArgs(server=<span class="hljs-string">"192.168.47.240"</span>)<font></font>
<font></font>
objects_list_ip_first = []<font></font>
objects_list_range_first = []<font></font>
objects_list_ip_second = []<font></font>
objects_list_range_second = []<font></font>
<font></font>
<span class="hljs-keyword">for</span> ip <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>,<span class="hljs-number">125</span>,<span class="hljs-number">5</span>):<font></font>
    data = {<span class="hljs-string">"name"</span>: <span class="hljs-string">f'h_192.168.0.<span class="hljs-subst">{ip}</span>'</span>, <span class="hljs-string">"color"</span>: <span class="hljs-string">"sienna"</span>}<font></font>
    objects_list_ip_first.append(data)<font></font>
    <font></font>
<span class="hljs-keyword">for</span> ip <span class="hljs-keyword">in</span> range(<span class="hljs-number">125</span>,<span class="hljs-number">255</span>,<span class="hljs-number">5</span>):<font></font>
    data = {<span class="hljs-string">"name"</span>: <span class="hljs-string">f'h_192.168.0.<span class="hljs-subst">{ip}</span>'</span>, <span class="hljs-string">"color"</span>: <span class="hljs-string">"khaki"</span>}<font></font>
    objects_list_ip_second.append(data)<font></font>
    <font></font>
first_ip = <span class="hljs-number">1</span>
last_ip = <span class="hljs-number">4</span>
<span class="hljs-keyword">while</span> last_ip &lt; <span class="hljs-number">125</span>:<font></font>
    data = {<span class="hljs-string">"name"</span>: <span class="hljs-string">f"r_192.168.0.<span class="hljs-subst">{first_ip}</span>-<span class="hljs-subst">{last_ip}</span>"</span>, <span class="hljs-string">"color"</span>: <span class="hljs-string">"sienna"</span>}<font></font>
    objects_list_range_first.append(data)<font></font>
    first_ip+=<span class="hljs-number">5</span>
    last_ip+=<span class="hljs-number">5</span><font></font>
    <font></font>
<span class="hljs-keyword">while</span> last_ip &lt; <span class="hljs-number">255</span>:<font></font>
    data = {<span class="hljs-string">"name"</span>: <span class="hljs-string">f"r_192.168.0.<span class="hljs-subst">{first_ip}</span>-<span class="hljs-subst">{last_ip}</span>"</span>, <span class="hljs-string">"color"</span>: <span class="hljs-string">"khaki"</span>}<font></font>
    objects_list_range_second.append(data)<font></font>
    first_ip+=<span class="hljs-number">5</span>
    last_ip+=<span class="hljs-number">5</span><font></font>
<font></font>
data_for_batch_first  = {<font></font>
  <span class="hljs-string">"objects"</span> : [ {
    <span class="hljs-string">"type"</span> : <span class="hljs-string">"host"</span>,
    <span class="hljs-string">"list"</span> : objects_list_ip_first<font></font>
}, {<font></font>
    <span class="hljs-string">"type"</span> : <span class="hljs-string">"address-range"</span>,
    <span class="hljs-string">"list"</span> : objects_list_range_first<font></font>
  }]<font></font>
}<font></font>
<font></font>
data_for_batch_second  = {<font></font>
  <span class="hljs-string">"objects"</span> : [ {
    <span class="hljs-string">"type"</span> : <span class="hljs-string">"host"</span>,
    <span class="hljs-string">"list"</span> : objects_list_ip_second<font></font>
}, {<font></font>
    <span class="hljs-string">"type"</span> : <span class="hljs-string">"address-range"</span>,
    <span class="hljs-string">"list"</span> : objects_list_range_second<font></font>
  }]<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">with</span> APIClient(client_args) <span class="hljs-keyword">as</span> client: <font></font>
     login = client.login_with_api_key(<span class="hljs-string">'3TsbPJ8ZKjaJGvFyoFqHFA=='</span>) <font></font>
     set_objects_batch_first = client.api_call(<span class="hljs-string">"set-objects-batch"</span>, data_for_batch_first)<font></font>
     set_objects_batch_second = client.api_call(<span class="hljs-string">"set-objects-batch"</span>, data_for_batch_second)<font></font>
     publish = client.api_call(<span class="hljs-string">"publish"</span>)
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie können viele Objekte in einem API-Aufruf mit </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">delete-objects-batch löschen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Schauen wir uns nun ein Beispiel für einen Code an, der alle zuvor durch </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add-Objects-Batch</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erstellten Hosts löscht </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objekte mit delete-object-batch löschen</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">from</span> cpapi <span class="hljs-keyword">import</span> APIClient, APIClientArgs<font></font>
<font></font>
client_args = APIClientArgs(server=<span class="hljs-string">"192.168.47.240"</span>)<font></font>
<font></font>
objects_list_ip = []<font></font>
objects_list_range = []<font></font>
<font></font>
<span class="hljs-keyword">for</span> ip <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>,<span class="hljs-number">255</span>,<span class="hljs-number">5</span>):<font></font>
    data = {<span class="hljs-string">"name"</span>: <span class="hljs-string">f'h_192.168.0.<span class="hljs-subst">{ip}</span>'</span>}<font></font>
    objects_list_ip.append(data)<font></font>
<font></font>
first_ip = <span class="hljs-number">1</span>
last_ip = <span class="hljs-number">4</span>
<span class="hljs-keyword">while</span> last_ip &lt; <span class="hljs-number">255</span>:<font></font>
    data = {<span class="hljs-string">"name"</span>: <span class="hljs-string">f"r_192.168.0.<span class="hljs-subst">{first_ip}</span>-<span class="hljs-subst">{last_ip}</span>"</span>}<font></font>
    objects_list_range.append(data)<font></font>
    first_ip+=<span class="hljs-number">5</span>
    last_ip+=<span class="hljs-number">5</span><font></font>
<font></font>
data_for_batch = {<font></font>
  <span class="hljs-string">"objects"</span> : [ {
    <span class="hljs-string">"type"</span> : <span class="hljs-string">"host"</span>,
    <span class="hljs-string">"list"</span> : objects_list_ip<font></font>
}, {<font></font>
    <span class="hljs-string">"type"</span> : <span class="hljs-string">"address-range"</span>,
    <span class="hljs-string">"list"</span> : objects_list_range<font></font>
  }]<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">with</span> APIClient(client_args) <span class="hljs-keyword">as</span> client: <font></font>
     login = client.login_with_api_key(<span class="hljs-string">'3TsbPJ8ZKjaJGvFyoFqHFA=='</span>)<font></font>
     delete_objects_batch = client.api_call(<span class="hljs-string">"delete-objects-batch"</span>, data_for_batch)<font></font>
     publish = client.api_call(<span class="hljs-string">"publish"</span>)<font></font>
<font></font>
print(delete_objects_batch.data)<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alle Funktionen, die in neuen Versionen der Check Point-Software enthalten sind, erhalten sofort API-Aufrufe. </font><font style="vertical-align: inherit;">So erschienen in R80.40 solche "Funktionen" wie "Auf Revision zurücksetzen" und "Smart Task" und bereiteten für sie sofort die entsprechenden API-Aufrufe vor. </font><font style="vertical-align: inherit;">Darüber hinaus erhalten alle Funktionen beim Wechsel von Legacy-Konsolen in den Unified Policy-Modus auch API-Unterstützung. </font><font style="vertical-align: inherit;">Das lang erwartete Update in der Softwareversion R80.40 war beispielsweise die Übertragung der HTTPS-Inspektionsrichtlinie vom Legacy-Modus in den Unified Policy-Modus, und diese Funktionalität erhielt sofort API-Aufrufe. </font><font style="vertical-align: inherit;">Hier ist ein Beispiel für einen Code, der der obersten Position der HTTPS-Inspektionsrichtlinie eine Regel hinzufügt, die 3 Kategorien (Gesundheit, Finanzen, öffentliche Dienste) von der Inspektion ausschließt, deren Inspektion gemäß den gesetzlichen Bestimmungen in einer Reihe von Ländern verboten ist.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Regel zur HTTPS-Inspektionsrichtlinie hinzufügen</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">from</span> cpapi <span class="hljs-keyword">import</span> APIClient, APIClientArgs<font></font>
<font></font>
client_args = APIClientArgs(server=<span class="hljs-string">"192.168.47.240"</span>)<font></font>
<font></font>
data = {<font></font>
  <span class="hljs-string">"layer"</span> : <span class="hljs-string">"Default Layer"</span>,
  <span class="hljs-string">"position"</span> : <span class="hljs-string">"top"</span>,
  <span class="hljs-string">"name"</span> : <span class="hljs-string">"Legal Requirements"</span>,
  <span class="hljs-string">"action"</span>: <span class="hljs-string">"bypass"</span>,
  <span class="hljs-string">"site-category"</span>: [<span class="hljs-string">"Health"</span>, <span class="hljs-string">"Government / Military"</span>, <span class="hljs-string">"Financial Services"</span>]<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">with</span> APIClient(client_args) <span class="hljs-keyword">as</span> client: <font></font>
     login = client.login_with_api_key(<span class="hljs-string">'3TsbPJ8ZKjaJGvFyoFqHFA=='</span>)<font></font>
     add_https_rule = client.api_call(<span class="hljs-string">"add-https-rule"</span>, data)<font></font>
     publish = client.api_call(<span class="hljs-string">"publish"</span>)
</code></pre><br>
</div>
                    </div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ausführen von Python-Skripten auf einem Check Point-Verwaltungsserver</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alles in derselben </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">README.md</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> enthält Informationen zum Ausführen von Python-Skripten direkt vom Verwaltungsserver. </font><font style="vertical-align: inherit;">Dies kann praktisch sein, wenn Sie von einem anderen Computer aus keine Verbindung zum API-Server herstellen können. </font><font style="vertical-align: inherit;">Ich habe ein sechsminütiges Video aufgenommen, in dem ich über die Installation des </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cpapi-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Moduls </font><font style="vertical-align: inherit;">und die Funktionen zum Ausführen von Python-Skripten auf dem Verwaltungsserver </font><b><font style="vertical-align: inherit;">nachdenke</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Beispielsweise wird ein Skript ausgeführt, das die Konfiguration eines neuen Gateways für eine Aufgabe wie die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Überwachung</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> des </font><b><font style="vertical-align: inherit;">Security CheckUp-</font></b><font style="vertical-align: inherit;"> Netzwerks </font><b><font style="vertical-align: inherit;">automatisiert</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Von den Funktionen, denen ich mich stellen musste: In Python 2.7 ist die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eingabefunktion</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> noch nicht erschienen </font><font style="vertical-align: inherit;">, daher wird die Funktion </font><b><font style="vertical-align: inherit;">raw_input</font></b><font style="vertical-align: inherit;"> verwendet, um die vom Benutzer </font><b><font style="vertical-align: inherit;">eingegebenen</font></b><font style="vertical-align: inherit;"> Informationen zu verarbeiten</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Andernfalls ist der Code derselbe wie beim Starten von anderen Computern, nur ist es bequemer, die Funktion </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">login_as_root</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zu verwenden </font><font style="vertical-align: inherit;">, um Ihren eigenen Benutzernamen, Ihr Kennwort und Ihre IP-Adresse des Verwaltungsservers nicht erneut anzugeben.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/8B6pgCLT8Pg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Skript zur schnellen Einrichtung Security CheckUp</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> print_function
<span class="hljs-keyword">import</span> getpass
<span class="hljs-keyword">import</span> sys, os<font></font>
sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), <span class="hljs-string">'..'</span>)))
<span class="hljs-keyword">from</span> cpapi <span class="hljs-keyword">import</span> APIClient, APIClientArgs<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>
    <span class="hljs-keyword">with</span> APIClient() <span class="hljs-keyword">as</span> client:
       <span class="hljs-comment"># if client.check_fingerprint() is False:</span>
       <span class="hljs-comment">#     print("Could not get the server's fingerprint - Check connectivity with the server.")</span>
       <span class="hljs-comment">#     exit(1)</span><font></font>
        login_res = client.login_as_root()<font></font>
<font></font>
        <span class="hljs-keyword">if</span> login_res.success <span class="hljs-keyword">is</span> <span class="hljs-literal">False</span>:<font></font>
            print(<span class="hljs-string">"Login failed:\n{}"</span>.format(login_res.error_message))<font></font>
            exit(<span class="hljs-number">1</span>)<font></font>
<font></font>
        gw_name = raw_input(<span class="hljs-string">"Enter the gateway name:"</span>)<font></font>
        gw_ip = raw_input(<span class="hljs-string">"Enter the gateway IP address:"</span>)
        <span class="hljs-keyword">if</span> sys.stdin.isatty():<font></font>
            sic = getpass.getpass(<span class="hljs-string">"Enter one-time password for the gateway(SIC): "</span>)
        <span class="hljs-keyword">else</span>:<font></font>
            print(<span class="hljs-string">"Attention! Your password will be shown on the screen!"</span>)<font></font>
            sic = raw_input(<span class="hljs-string">"Enter one-time password for the gateway(SIC): "</span>)<font></font>
        version = raw_input(<span class="hljs-string">"Enter the gateway version(like RXX.YY):"</span>)<font></font>
        add_gw = client.api_call(<span class="hljs-string">"add-simple-gateway"</span>, {<span class="hljs-string">'name'</span> : gw_name, <span class="hljs-string">'ipv4-address'</span> : gw_ip, <span class="hljs-string">'one-time-password'</span> : sic, <span class="hljs-string">'version'</span>: version.capitalize(), <span class="hljs-string">'application-control'</span> : <span class="hljs-string">'true'</span>, <span class="hljs-string">'url-filtering'</span> : <span class="hljs-string">'true'</span>, <span class="hljs-string">'ips'</span> : <span class="hljs-string">'true'</span>, <span class="hljs-string">'anti-bot'</span> : <span class="hljs-string">'true'</span>, <span class="hljs-string">'anti-virus'</span> : <span class="hljs-string">'true'</span>, <span class="hljs-string">'threat-emulation'</span> : <span class="hljs-string">'true'</span>})
        <span class="hljs-keyword">if</span> add_gw.success <span class="hljs-keyword">and</span> add_gw.data[<span class="hljs-string">'sic-state'</span>] != <span class="hljs-string">"communicating"</span>:<font></font>
            print(<span class="hljs-string">"Secure connection with the gateway hasn't established!"</span>)<font></font>
            exit(<span class="hljs-number">1</span>)
        <span class="hljs-keyword">elif</span> add_gw.success:<font></font>
            print(<span class="hljs-string">"The gateway was added successfully."</span>)<font></font>
            gw_uid = add_gw.data[<span class="hljs-string">'uid'</span>]<font></font>
            gw_name = add_gw.data[<span class="hljs-string">'name'</span>]
        <span class="hljs-keyword">else</span>:<font></font>
            print(<span class="hljs-string">"Failed to add the gateway - {}"</span>.format(add_gw.error_message))<font></font>
            exit(<span class="hljs-number">1</span>)<font></font>
<font></font>
        change_policy = client.api_call(<span class="hljs-string">"set-access-layer"</span>, {<span class="hljs-string">"name"</span> : <span class="hljs-string">"Network"</span>, <span class="hljs-string">"applications-and-url-filtering"</span>: <span class="hljs-string">"true"</span>, <span class="hljs-string">"content-awareness"</span>: <span class="hljs-string">"true"</span>})
        <span class="hljs-keyword">if</span> change_policy.success:<font></font>
            print(<span class="hljs-string">"The policy has been changed successfully"</span>)
        <span class="hljs-keyword">else</span>:<font></font>
            print(<span class="hljs-string">"Failed to change the policy- {}"</span>.format(change_policy.error_message))<font></font>
        change_rule = client.api_call(<span class="hljs-string">"set-access-rule"</span>, {<span class="hljs-string">"name"</span> : <span class="hljs-string">"Cleanup rule"</span>, <span class="hljs-string">"layer"</span> : <span class="hljs-string">"Network"</span>, <span class="hljs-string">"action"</span>: <span class="hljs-string">"Accept"</span>, <span class="hljs-string">"track"</span>: {<span class="hljs-string">"type"</span>: <span class="hljs-string">"Detailed Log"</span>, <span class="hljs-string">"accounting"</span>: <span class="hljs-string">"true"</span>}})
        <span class="hljs-keyword">if</span> change_rule.success:<font></font>
            print(<span class="hljs-string">"The cleanup rule has been changed successfully"</span>)
        <span class="hljs-keyword">else</span>:<font></font>
            print(<span class="hljs-string">"Failed to change the cleanup rule- {}"</span>.format(change_rule.error_message))<font></font>
<font></font>
        <span class="hljs-comment"># publish the result</span>
        publish_res = client.api_call(<span class="hljs-string">"publish"</span>, {})
        <span class="hljs-keyword">if</span> publish_res.success:<font></font>
            print(<span class="hljs-string">"The changes were published successfully."</span>)
        <span class="hljs-keyword">else</span>:<font></font>
                print(<span class="hljs-string">"Failed to publish the changes - {}"</span>.format(install_tp_policy.error_message))<font></font>
<font></font>
        install_access_policy = client.api_call(<span class="hljs-string">"install-policy"</span>, {<span class="hljs-string">"policy-package"</span> : <span class="hljs-string">"Standard"</span>, <span class="hljs-string">"access"</span> : <span class="hljs-string">'true'</span>,  <span class="hljs-string">"threat-prevention"</span> : <span class="hljs-string">'false'</span>, <span class="hljs-string">"targets"</span> : gw_uid})
        <span class="hljs-keyword">if</span> install_access_policy.success:<font></font>
            print(<span class="hljs-string">"The access policy has been installed"</span>)
        <span class="hljs-keyword">else</span>:<font></font>
                print(<span class="hljs-string">"Failed to install access policy - {}"</span>.format(install_tp_policy.error_message))<font></font>
<font></font>
        install_tp_policy = client.api_call(<span class="hljs-string">"install-policy"</span>, {<span class="hljs-string">"policy-package"</span> : <span class="hljs-string">"Standard"</span>, <span class="hljs-string">"access"</span> : <span class="hljs-string">'false'</span>,  <span class="hljs-string">"threat-prevention"</span> : <span class="hljs-string">'true'</span>, <span class="hljs-string">"targets"</span> : gw_uid})
        <span class="hljs-keyword">if</span> install_tp_policy.success:<font></font>
            print(<span class="hljs-string">"The threat prevention policy has been installed"</span>)
        <span class="hljs-keyword">else</span>:<font></font>
            print(<span class="hljs-string">"Failed to install threat prevention policy - {}"</span>.format(install_tp_policy.error_message))<font></font>
        <font></font>
        <span class="hljs-comment"># add passwords and passphrases to dictionary</span>
        <span class="hljs-keyword">with</span> open(<span class="hljs-string">'additional_pass.conf'</span>) <span class="hljs-keyword">as</span> f:<font></font>
            line_num = <span class="hljs-number">0</span>
            <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f:<font></font>
                line_num += <span class="hljs-number">1</span>
                add_password_dictionary = client.api_call(<span class="hljs-string">"run-script"</span>, {<span class="hljs-string">"script-name"</span> : <span class="hljs-string">"Add passwords and passphrases"</span>, <span class="hljs-string">"script"</span> : <span class="hljs-string">"printf \"{}\" &gt;&gt; $FWDIR/conf/additional_pass.conf"</span>.format(line), <span class="hljs-string">"targets"</span> : gw_name})
                <span class="hljs-keyword">if</span> add_password_dictionary.success:<font></font>
                    print(<span class="hljs-string">"The password dictionary line {} was added successfully"</span>.format(line_num))
                <span class="hljs-keyword">else</span>:<font></font>
                    print(<span class="hljs-string">"Failed to add the dictionary - {}"</span>.format(add_password_dictionary.error_message))<font></font>
<font></font>
main()</code></pre><br>
</div>
                    </div><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiel für eine Kennwortwörterbuchdatei Additional_pass.conf</font></font></b>
                        <div class="spoiler_text"><code>{<br>
"passwords" : ["malware","malicious","infected","Infected"],<br>
"phrases" : ["password","Password","Pass","pass","codigo","key","pwd","","","","","",""]<br>
}</code><br>
</div>
                    </div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Artikel werden nur die grundlegenden Funktionen des </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python SDK</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und des </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cpapi-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Moduls behandelt </font><font style="vertical-align: inherit;">(wie Sie vielleicht vermutet haben, handelt es sich tatsächlich um Synonyme). </font><b><font style="vertical-align: inherit;">Wenn</font></b><font style="vertical-align: inherit;"> Sie den Code in diesem Modul studieren, werden Sie noch mehr Möglichkeiten entdecken, damit zu arbeiten. </font><font style="vertical-align: inherit;">Möglicherweise möchten Sie es mit Ihren Klassen, Funktionen, Methoden und Variablen ergänzen. </font><font style="vertical-align: inherit;">Sie können jederzeit ihre Erfahrungen teilen und andere Skripte für den Abschnitt </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CodeHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Community </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CheckMates anzeigen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , in dem Produktentwickler und Benutzer kombiniert werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Viel Spaß beim Codieren und vielen Dank für das Lesen bis zum Ende!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de505496/index.html">Flutter Dev Podcast mit CTO Meduza Boris Goryachev: Die Hauptsache über die Meduz-Anwendung und die Medienentwicklung</a></li>
<li><a href="../de505498/index.html">Wie wir das Problem des nicht initialisierten Stapelspeichers in Windows lösen</a></li>
<li><a href="../de505502/index.html">Omnichannel im Kundenservice: Worauf muss man achten und wie kann man alles richtig machen?</a></li>
<li><a href="../de505506/index.html">Er beißt nicht: wie man Industrieroboter für Arbeiter sicher macht</a></li>
<li><a href="../de505508/index.html">Nicht nur unbemannte Technologie: Die Zukunft der Automobilindustrie</a></li>
<li><a href="../de505516/index.html">Maschinelles Lernen: Wo soll ich anfangen oder wie erstelle ich das erste Modell?</a></li>
<li><a href="../de505522/index.html">Monetarisierung in Online-Spielen: Wie Sie die Erfahrung eines anderen für Ihre eigenen Bedürfnisse nutzen können</a></li>
<li><a href="../de505528/index.html">Das Wichtigste in Wi-Fi 6. Nein, im Ernst</a></li>
<li><a href="../de505530/index.html">Google stellt seinen Prozessor her und AMD bereitet sich darauf vor, Qualcomm zu zerstören</a></li>
<li><a href="../de505532/index.html">Telegrammkanäle zur Spieleentwicklung: Teil 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>