<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¦ ğŸ‘¨ğŸ¿â€ğŸ”§ â™¨ï¸ Bangun C ++ dengan bazel ğŸŠ ğŸˆ·ï¸ ğŸ˜¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pengantar dan Motivasi
 Baru-baru ini, posting telah muncul di Habr bahwa cmake dan c ++ adalah teman, contoh diberikan tentang cara mengumpulkan perp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Bangun C ++ dengan bazel</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/489566/"><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pengantar dan Motivasi</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Baru-baru ini, posting telah muncul di Habr bahwa cmake dan c ++ adalah teman, contoh diberikan tentang cara mengumpulkan perpustakaan hanya header dan tidak hanya, tetapi tidak ada ikhtisar setidaknya beberapa sistem membangun baru - bazel, buck, gn, dan lainnya. </font><font style="vertical-align: inherit;">Jika Anda, seperti saya, menulis dalam C ++ di 2k20, maka saya sarankan Anda berkenalan dengan bazel sebagai sistem build untuk proyek c ++. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami akan meninggalkan pertanyaan tentang apa cmake dan sistem lain yang ada buruk untuk dan berkonsentrasi pada apa yang bisa dilakukan bazel sendiri. </font><font style="vertical-align: inherit;">Untuk memutuskan apa yang terbaik khusus untuk Anda, saya meninggalkannya khusus untuk Anda.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita mulai dengan definisi dan motivasi. </font><font style="vertical-align: inherit;">Bazel adalah sistem multi-bahasa Google build yang dapat membangun proyek-proyek c ++. </font><font style="vertical-align: inherit;">Mengapa kita harus melihat sistem build lain? </font><font style="vertical-align: inherit;">Pertama, karena beberapa proyek besar sudah berjalan kepadanya, misalnya Tensorflow, Kubernetes dan Gtest, dan karenanya, untuk berintegrasi dengan mereka, Anda sudah harus dapat menggunakan bazel. </font><font style="vertical-align: inherit;">Kedua, selain itu bazel google masih menggunakan spaceX, nvidia dan perusahaan lain yang dinilai dari kinerja mereka di bazelcon. </font><font style="vertical-align: inherit;">Akhirnya, bazel adalah proyek open source yang cukup populer di github, jadi patut dicoba dan dicoba.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contoh 1. Sepele</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada main.cc dan Anda harus mengompilasinya: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
main.cc</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
   <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Hello, habr"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
   <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semuanya dimulai dengan deklarasi ruang kerja. Dalam hal ruang kerja bazel, ini adalah direktori tempat semua file sumber Anda berada. Untuk menunjuk ruang kerja ini, Anda perlu membuat file kosong dengan nama WORKSPACE di direktori yang kami butuhkan, biasanya ini adalah direktori src. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unit minimum untuk mengatur kode di bazel adalah sebuah paket. Paket ini ditentukan oleh direktori sumber dan file BUILD khusus yang menjelaskan bagaimana sumber-sumber ini dikumpulkan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambahkan paket utama ke proyek kami: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wq/dq/7l/wqdq7lk5ecrf91hqc2u7og0y3do.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam file BUILD, kita sekarang harus menjelaskan apa yang ingin kita bangun dari main kita. Secara alami, kami ingin mengkompilasi biner yang dapat dieksekusi, jadi kami akan menggunakan aturan cc_binary. Bazel sudah mendukung C ++ di luar kotak, jadi sudah ada seperangkat aturan tertentu untuk membangun tujuan c ++, kita akan mengenal sisanya nanti.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambahkan aturan cc_binary ke file BUILD, ia memiliki nama yang akan memiliki file yang dapat dieksekusi dan berbagai sumber yang akan diteruskan ke kompiler. </font><font style="vertical-align: inherit;">Semua ini dijelaskan dalam starlark, yang merupakan python terpotong.</font></font><br>
<br>
<pre><code class="python hljs">cc_binary(<font></font>
  name = <span class="hljs-string">"hello_world"</span>,<font></font>
  srcs = <span class="hljs-string">"main.cc"</span><font></font>
)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bazel, tidak seperti cmake, tidak didasarkan pada perintah, tetapi memungkinkan deklaratif menjelaskan dependensi melalui aturan. </font><font style="vertical-align: inherit;">Pada dasarnya, aturan menghubungkan beberapa artefak dengan operasi tertentu. </font><font style="vertical-align: inherit;">Menggunakannya, bazel membuat grafik perintah, yang kemudian di-cache dan dieksekusi. </font><font style="vertical-align: inherit;">Dalam kasus kami, file sumber main.cc dikaitkan dengan operasi kompilasi, yang hasilnya adalah artefact hello_world - file biner yang dapat dieksekusi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk sekarang dapat dieksekusi, kita harus pergi ke direktori dengan ruang kerja dan ketik:</font></font><br>
<br>
<pre><code class="bash hljs">bazel build //main:hello_world
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sistem build menerima perintah build dan jalur ke tujuan kami, mulai dari akar proyek kami. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Biner yang dihasilkan akan berlokasi di bazel-bin / main / hello_world.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contoh 2. Bangun dengan perpustakaan Anda</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untungnya, tidak ada yang membutuhkan proyek sederhana seperti itu, jadi mari kita lihat bagaimana cara menambahkan fungsionalitas ke proyek kami. </font><font style="vertical-align: inherit;">Tambahkan perpustakaan yang akan dibangun secara terpisah dan ditautkan ke utama kami. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Biarkan Square, perpustakaan yang akan menyediakan fungsi kuadrat yang jelas. </font><font style="vertical-align: inherit;">Menambahkan pustaka baru berarti menambahkan paket baru, mari kita sebut saja kuadrat. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kv/kr/0o/kvkr0o7nryy4fddsibmtge2dabo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
square.h</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> SQUQRE_SQUARE_H_</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SQUQRE_SQUARE_H_</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Square</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span></span>;<font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">// SQUQRE_SQUARE_H_</span></span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
square.cc</font></font><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"square/square.h"</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Square</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>{
  <span class="hljs-keyword">return</span> x * x;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perhatikan koneksi file header, saya melakukannya melalui jalur dari ruang kerja, meskipun file tersebut ada di direktori yang sama. Pendekatan ini diadopsi dalam panduan gaya kode kromium, yang diwarisi dari panduan gaya google c ++. Metode ini memungkinkan Anda untuk segera memahami dari mana file header terhubung. Jangan khawatir, akan ada file, bazel akan menambahkan path untuk mencari file header, tetapi jika Anda tidak mengikuti aturan ini, maka file header mungkin tidak ditemukan selama pembuatan bazel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam file BUILD perpustakaan kami, kami menjelaskan aturan untuk membangun perpustakaan cc_library:</font></font><br>
<br>
<pre><code class="python hljs">cc_library(<font></font>
  name = <span class="hljs-string">"square"</span>,<font></font>
  srcs = [<span class="hljs-string">"square.cc"</span>],<font></font>
  hdrs = [<span class="hljs-string">"square.h"</span>],<font></font>
  visibility = [<span class="hljs-string">"//visibility:public"</span>]<font></font>
)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini kami mencantumkan secara terpisah sumber dan file header, dan juga menentukan visibilitas di depan umum. </font><font style="vertical-align: inherit;">Yang terakhir ini diperlukan agar kami dapat bergantung pada perpustakaan kami di mana saja dalam proyek kami. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di main.cc kami menggunakan perpustakaan kami:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"square/square.h"</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Hello, bazel!"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; Square(<span class="hljs-number">2</span>) &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekali lagi, saya menarik perhatian pada fakta bahwa kami menyertakan file header perpustakaan melalui path dari workspace. </font><font style="vertical-align: inherit;">Ini sudah mutlak diperlukan di sini, karena bazel menggunakan wadah Linux di bawah tenda untuk memastikan tingkat keketatan minimum perakitan dan, karenanya, akan memasang file header pustaka kuadrat hanya agar mereka terletak melalui jalur dari ruang kerja. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan kami menggambarkan ketergantungan dalam aturan perakitan untuk utama di perpustakaan kuadrat.</font></font><br>
<br>
<pre><code class="python hljs">cc_binary(<font></font>
  name = <span class="hljs-string">"hello_world"</span>,<font></font>
  srcs = [<span class="hljs-string">"main.cc"</span>],<font></font>
  deps = [<span class="hljs-string">"//square:square"</span>]<font></font>
)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seluruh program kami dirakit dengan cara yang sama seperti tanpa menggunakan perpustakaan, bazel sendiri akan memahami apa yang tergantung, membangun grafik, menyimpan hasil dan membangun kembali hanya apa yang perlu dibangun kembali.</font></font><br>
<br>
<pre><code class="bash hljs">bazel build //main:hello_world
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contoh 3. Menghubungkan tes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagaimana cara hidup tanpa tes? </font><font style="vertical-align: inherit;">Tidak mungkin! </font><font style="vertical-align: inherit;">Untuk terhubung ke bazel GTest, yang omong-omong sudah mendukung perakitan dengan bazel, Anda perlu menambahkan ketergantungan eksternal. </font><font style="vertical-align: inherit;">Ini dilakukan dalam file WORKSPACE:</font></font><br>
<br>
<pre><code class="python hljs">load(<span class="hljs-string">"@bazel_tools//tools/build_defs/repo:git.bzl"</span>, <span class="hljs-string">"git_repository"</span>)<font></font>
<font></font>
git_repository(<font></font>
  name = <span class="hljs-string">"googletest"</span>,<font></font>
  remote = <span class="hljs-string">"https://github.com/google/googletest"</span>,<font></font>
  tag = <span class="hljs-string">"release-1.8.1"</span><font></font>
)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti halnya hipsters, mereka menghubungkan aturan git_repository dan memberi tahu bazel versi mana yang harus diunduh. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selanjutnya, kami membuat paket terpisah untuk tes pengujian dan menambahkan tes ke perpustakaan kami ke dalamnya: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
square_unittest.cc</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"gtest/gtest.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"square/square.h"</span></span><font></font>
<font></font>
TEST(SquareTests, Basics) {<font></font>
    EXPECT_EQ(Square(<span class="hljs-number">-1</span>), <span class="hljs-number">1</span>);<font></font>
    EXPECT_EQ(Square(<span class="hljs-number">1</span>), <span class="hljs-number">1</span>);<font></font>
    EXPECT_EQ(Square(<span class="hljs-number">2</span>), <span class="hljs-number">4</span>);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang giliran untuk menentukan aturan untuk pengujian.</font></font><br>
<br>
<pre><code class="python hljs">cc_test(<font></font>
  name = <span class="hljs-string">"unittests"</span>,<font></font>
  srcs = [<span class="hljs-string">"square_unittest.cc"</span>],<font></font>
  deps = [<font></font>
   <span class="hljs-string">"//square:square"</span>,
   <span class="hljs-string">"@googletest//:gtest_main"</span><font></font>
  ]<font></font>
)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menambahkan dependensi pada perpustakaan kami dan pada gtest_main sehingga perpustakaan gtest itu sendiri akan memberi kami implementasi peluncur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tes dijalankan dengan perintah:</font></font><br>
<br>
<pre><code class="bash hljs">bazel <span class="hljs-built_in">test</span> //<span class="hljs-built_in">test</span>:unittests
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bazel akan mengunduh dan membangun GTest sendiri, menautkan semua yang diperlukan untuk pengujian dan menjalankan tes itu sendiri. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya menyebutkan bahwa bazel juga tahu bagaimana melakukan cakupan kode:</font></font><br>
<br>
<pre><code class="bash hljs">bazel coverage //<span class="hljs-built_in">test</span>:unittests
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan jika Anda perlu melakukan debug tes, maka Anda dapat mengkompilasi semuanya dalam mode debug dengan karakter seperti ini:</font></font><br>
<br>
<pre><code class="bash hljs">bazel build //<span class="hljs-built_in">test</span>:unittests --compilation_mode=dbg -s
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contoh 4. Menghubungkan perpustakaan lain yang tidak tahu cara bazel</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentu saja, dunia tidak dibangun di atas bazel saja, jadi Anda harus dapat menghubungkan perpustakaan lain juga. </font><font style="vertical-align: inherit;">Baru-baru ini, dalam proyek saya, saya membutuhkan perpustakaan untuk mengurai argumen baris perintah. </font><font style="vertical-align: inherit;">Nah, jangan menulis kepada saya di 2k20 perpustakaan Anda sendiri dan terganggu dari pekerjaan utama. </font><font style="vertical-align: inherit;">Saya benar-benar tidak ingin menggunakan setengah tindakan, seperti Getops, serta menyeret dorongan ke dalam proyek saya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bukan untuk iklan, kami akan menghubungkan perpustakaan CLI11, yang menggunakan tidak lebih dari stl standar C ++ 11 dan menyediakan antarmuka yang lebih atau kurang nyaman. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pustaka adalah hanya header, yang membuat menghubungkannya sangat mudah. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hubungkan ketergantungan eksternal di WORKSPACE:</font></font><br>
<br>
<pre><code class="python hljs">load(<span class="hljs-string">"@bazel_tools//tools/build_defs/repo:http.bzl"</span>, <span class="hljs-string">"http_file"</span>)<font></font>
<font></font>
http_file(<font></font>
  name = <span class="hljs-string">"CLI11"</span>,<font></font>
  downloaded_file_path = <span class="hljs-string">"CLI11.hpp"</span>,<font></font>
  urls = [<span class="hljs-string">"https://github.com/CLIUtils/CLI11/releases/download/v1.9.0/CLI11.hpp"</span>],<font></font>
  sha256 = <span class="hljs-string">"6f0a1d8846ed7fa4c2b66da3eb252aa03d27170258df..."</span>,<font></font>
)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menambahkan direktori pihak ketiga dan menambahkan paket CLI11 untuk kenyamanan membangun dependensi pada perpustakaan ini:</font></font><br>
<br>
<pre><code class="python hljs">cc_library(<font></font>
  name = <span class="hljs-string">"CLI11"</span>,<font></font>
  hdrs = [<span class="hljs-string">"@CLI11//file"</span>],<font></font>
  strip_include_prefix = <span class="hljs-string">"/external/CLI11/file"</span>,<font></font>
  include_prefix = <span class="hljs-string">"CLI11"</span>,<font></font>
  linkstatic = <span class="hljs-literal">True</span>,<font></font>
  visibility = [<span class="hljs-string">"//visibility:public"</span>],<font></font>
)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bazel secara default akan mencari file library dengan path / eksternal / CLI11 sehingga kami mengubah path sedikit untuk menghubungkannya melalui CLI11 /. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
main.cc</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"CLI11/CLI11.hpp"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"square/square.h"</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Hello, bazel!"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; Square(<span class="hljs-number">2</span>) &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bergantung pada main, tambahkan "// third_party / CLI11: CLI11" dan semuanya mulai bekerja. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya tidak tahu tentang Anda, tetapi menghubungkan beberapa perpustakaan yang tidak dikenal dan menggunakannya dalam proyek c ++ dalam formulir ini membuat saya senang. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ya, dengan pustaka header-saja Anda akan mengatakan bahwa semuanya sederhana, tetapi dengan pustaka non-header-saja yang belum dibangun dengan bazel semuanya sama sederhana. </font><font style="vertical-align: inherit;">Anda cukup mengunduhnya melalui http_archive atau git_repository dan menambahkan file BUILD eksternal ke direktori pihak ketiga, tempat Anda menjelaskan cara membangun perpustakaan Anda. </font><font style="vertical-align: inherit;">Bazel mendukung memanggil cmd dan bahkan memanggil cmake, melalui aturan cmake_external.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contoh 5. Skrip dan otomatisasi</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Siapa yang butuh proyek di bare c ++ di 2k20 tanpa skrip untuk otomatisasi? </font><font style="vertical-align: inherit;">Biasanya, skrip seperti itu diperlukan untuk menjalankan tes perf atau untuk menyebarkan artefak Anda di suatu tempat ke CI. </font><font style="vertical-align: inherit;">Yah, biasanya mereka ditulis dengan python. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk ini, bazel juga cocok, karena dapat digunakan di hampir semua bahasa populer dan dirancang untuk mengumpulkan solyanka seperti itu dari berbagai bahasa pemrograman yang begitu sering ditemukan dalam proyek nyata. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita sambungkan skrip python yang akan menjalankan main kita. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambahkan paket tes perf:</font></font><br>
<br>
<pre><code class="python hljs">py_binary(<font></font>
  name = <span class="hljs-string">"perf_tests"</span>,<font></font>
  srcs = [<span class="hljs-string">"perf_tests.py"</span>],<font></font>
  data = [<font></font>
    <span class="hljs-string">"//main:hello_world"</span>,<font></font>
  ],<font></font>
)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai ketergantungan data, tambahkan dependensi biner hello_world. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
perf_tests.py</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> subprocess
<span class="hljs-keyword">import</span> time<font></font>
<font></font>
start_time = time.time()<font></font>
process = subprocess.run([<span class="hljs-string">'main/hello_world, '</span>param1<span class="hljs-string">', ],
                         stdout=subprocess.PIPE,
                         universal_newlines=True)
end_time = time.time()
print("--- %s seconds ---" % (end_time - start_time))
</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menjalankan tes kami, kami cukup menulis:</font></font><br>
<pre><code class="bash hljs">bazel run //perf-tests:perf_tests
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kesimpulan dan apa yang tidak disentuh</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami secara singkat melihat bazel dan fitur utamanya untuk merakit file dan perpustakaan yang dapat dieksekusi, baik pihak ketiga maupun milik kami. </font><font style="vertical-align: inherit;">Untuk seleraku, ternyata cukup singkat dan sangat cepat. </font><font style="vertical-align: inherit;">Tidak perlu menderita dan mencari tutorial cmake untuk melakukan beberapa hal sepele dan membersihkan CmakeCache. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda tertarik, masih banyak yang tersisa: buffer protokol, pembersih, pengaturan toolchain untuk dikompilasi untuk berbagai platform / arsitektur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terima kasih telah membaca, dan saya harap saya bermanfaat bagi Anda.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id489554/index.html">Sedikit kehalusan java.lang.String</a></li>
<li><a href="../id489556/index.html">Jangan beri nama ke utas dari ThreadPool saat debugging di VS</a></li>
<li><a href="../id489558/index.html">Tentang Samsung memperbarui TV utama: Q950 - perubahan, jambs, serta perkiraan untuk perangkat baru</a></li>
<li><a href="../id489560/index.html">Bereaksi Formulir Umpan Balik Asli Menggunakan AWS + Telegram</a></li>
<li><a href="../id489562/index.html">Menguji di Kotlin dengan Spock</a></li>
<li><a href="../id489568/index.html">Konferensi DEFCON 27. Duplikasi kunci mekanis dengan akses terbatas. Bagian 1</a></li>
<li><a href="../id489576/index.html">ĞÑĞ°Ğ½ÑÑ‹ ÑĞ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ¼ĞµĞ´Ğ¸Ñ†Ğ¸Ğ½Ñ‹</a></li>
<li><a href="../id489582/index.html">Mencari Godzilla. Jaringan saraf dan kutipan perkiraan berdasarkan pertukaran dan data "eksternal"</a></li>
<li><a href="../id489584/index.html">Cara meningkatkan layanan API Anda di node.js. Bagian 1</a></li>
<li><a href="../id489586/index.html">Visualisasi suara pada lampu vintage</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>