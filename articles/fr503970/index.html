<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🦇 🕴🏻 🤹🏿 PuppetConf 2016. Kubernetes pour les administrateurs système. Partie 1 🏰 🛀🏽 💛</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je suis administrateur système, je travaille avec des ordinateurs et aujourd'hui nous parlerons de Kubernetes. J'essaierai d'approfondir le sujet, en ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>PuppetConf 2016. Kubernetes pour les administrateurs système. Partie 1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/503970/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je suis administrateur système, je travaille avec des ordinateurs et aujourd'hui nous parlerons de Kubernetes. J'essaierai d'approfondir le sujet, en considérant les problèmes que l'administrateur système peut résoudre avec cette application, et j'aborderai également certains aspects du fonctionnement de Puppet, qui semblaient entrer dans ce monde à l'aide d'un nouvel ensemble d'abstractions pour que l'application fonctionne. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a cinq ou six ans, Luis Andre Barroso et Urs Hoesl dans l'article «Data Center as a Computer» ont suggéré que nous devrions percevoir le centre de données comme un ordinateur massif. Il est nécessaire de faire abstraction du fait que le centre de données se compose de machines distinctes et de le considérer comme une entité logique. Dès que vous essayez d'utiliser cette idée dans la pratique, vous pouvez appliquer les principes de la construction de systèmes distribués et de l'informatique distribuée aux centres de données.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/w9/q7/sg/w9q7sgxchzl3fuuhlrymsv4xcsa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour traiter le centre de données comme un ordinateur, vous avez besoin d'un système d'exploitation. Il ressemble beaucoup à celui que vous utilisez sur un ordinateur séparé, mais doit avoir une interface différente, car vous n'avez pas besoin d'accéder à une machine distincte et vous n'avez pas besoin d'accéder au noyau. Alors, considérons le centre de données comme un gros ordinateur. Aujourd'hui, je vais vous dire quoi faire si vous semblez être privé de la possibilité de contrôler n'importe quelle machine utilisant SSH. Vous ne pourrez pas vous connecter, et bien que certaines personnes croient que sans cela, il est impossible de contrôler le système, je vais vous dire ce qui peut être fait avec Kubernetes. Tout d'abord, vous devez considérer Kubernetes comme un cadre pour la création de plates-formes distribuées.</font></font><a name="habracut"></a><br>
<br>
<img src="https://habrastorage.org/webt/wf/d2/5c/wfd25cjupilzhtu1ndkpci11cfs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela ne signifie pas qu'après avoir téléchargé Kubernetes, vous obtiendrez une interface utilisateur qui vous fournira tout ce que vous voulez faire avec le système. Non, ce n'est que le fondement de la création des outils dont vous avez besoin pour exécuter votre infrastructure. Je vais vous montrer comment créer une intégration à l'aide de l'Autorité de certification Let's Encrypt pour automatiser le processus de certificat pour mon application en utilisant Kubernetes comme cadre.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ol/ty/g3/oltyg3s-gtbgticzc-omgefrq04.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beaucoup de gens demandent exactement à quoi Kubernetes est bon. J'ai travaillé avec Puppet Labs pendant de nombreuses années et j'ai vu que cette chose était installée sur des ordinateurs afin de fournir au système une API qui n'existait pas jusqu'à présent. Au lieu de Bash, de scripts YAML et d'autres choses similaires, Puppet a fourni un utilisateur DSL qui lui a permis d'interagir par programme avec les machines sans scripts shell. La différence entre Kubernetes est qu'il est situé au-dessus du niveau de "fer". Concentrons-nous non pas tant sur l'automatisation et l'abstraction de ce système que sur les relations, ou sur le contrat, entre notre infrastructure et nos applications que nous allons tirer de n'importe quel nœud. Dans Kubernetes, nous n’affectons aucune application aux machines, il n’existe pas de «manifeste de nœud», le planificateur considère les nœuds individuels simplement comme des ressources de centre de données,représentant un gros ordinateur.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Questions: "Kubernetes fonctionne-t-il sur OpenStack, sur VMware, sur Bare Metal, dans le cloud?" ça n'a pas de sens. La bonne question est: «Puis-je exécuter l'agent Kubernetes pour récupérer ces ressources?» Et la réponse sera «oui». Parce que le fonctionnement de cette application est totalement indépendant de la plateforme que vous choisissez. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/an/km/hl/ankmhlzzmnaitmix8t0hppm8idi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetes est indépendant de la plateforme. Kubernetes est déclaratif de la même manière que Puppet. Par conséquent, vous signalez pour quelle application vous allez l'utiliser - dans cet exemple, il s'agit de nginx. Il s'agit d'un contrat entre vous, le développeur et Kubernetes comme moyen de créer des images de conteneur.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'aime utiliser l'analogie avec la société de messagerie FedEx - vous ne pouvez pas les faire glisser tout un wagon de choses et attendre qu'ils trient tout et l'envoient à l'endroit où il devrait être. Ils ont une règle: mettez vos affaires dans une boîte. Une fois que vous le ferez, ils enverront votre boîte et pourront dire quand elle arrivera à destination. "Si vous n'avez pas de boîte, vous ne pourrez pas travailler avec notre système."</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par conséquent, lorsque vous travaillez avec des conteneurs, il est inutile de discuter de ce que vous avez - Python, Java et ou quelque chose d'autre, peu importe - prenez simplement toutes vos dépendances et placez-les dans le conteneur. Beaucoup de gens disent que les conteneurs semblent résoudre les problèmes de l'ensemble de l'infrastructure. Cependant, le problème est que les gens ne perçoivent pas les conteneurs comme deux choses différentes qu’ils sont réellement. La première chose est l'idée d'un format d'emballage, la seconde est l'idée d'un runtime de conteneur. Ce sont deux choses différentes qui ne nécessitent pas nécessairement les mêmes outils.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Laquelle des personnes présentes a créé les conteneurs? Et qui utilise Puppet pour construire des conteneurs? C'est vrai, je ne suis pas d'accord non plus! Vous pouvez dire: «comment cela? Vous êtes à la conférence Puppet, vous devez être d'accord! » La raison pour laquelle je ne suis pas d'accord avec l'idée de construire des conteneurs dans Puppet est la suivante: je ne sais pas si nous en avons besoin, car les choses dont nous avons besoin pour créer une image sont différentes de celles dont nous avons besoin pour démarrer le processus de production. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imaginons-le comme la création d'un pipeline logiciel et jetons un œil à ce Dockerfile. Fermez les yeux sur ceux qui n'ont jamais vu ces fichiers, car pour vous, ils peuvent sembler intimidants. Ce fichier montre comment créer une application Ruby on Rails - une application Ruby avec un framework Rails.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/f3/ra/3r/f3ra3rkhngjp08t7beuyoeihc7i.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il indique «FROM ruby ​​2.3.1», qui insérera probablement l'intégralité du système d'exploitation dans le conteneur, dans ce cas l'image de base alpin-linux Ruby. Est-ce que quelqu'un sait pourquoi nous incorporons des images Ubuntu ou Red Hat dans ces conteneurs? La plupart des gens ne savent pas ce que sont les dépendances et utilisent une approche aléatoire, simplement en fourrant l'ensemble du système d'exploitation dans un conteneur pour s'assurer qu'ils ont leurs dépendances quelque part à l'intérieur. Donc, après avoir construit cette chose, vous ne devez l'exécuter qu'une seule fois. C'est de là que vient le malentendu: si cette chose ne fonctionne pas, changez la ligne de code jusqu'à ce qu'elle fonctionne. Vérifiez simplement! Vous n'avez pas besoin d'être trop intelligent avec ces fichiers, votre objectif est de construire une représentation hors ligne de votre application avec toutes les dépendances. Ce n'est qu'une béquille que nous utilisons d'Ubuntu comme point de départ.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous venez de créer l'application et de la lancer, vous utiliseriez quelque chose comme un lien statique. Aucune dépendance à l'hôte, dans votre conteneur, vous auriez juste un binaire d'un fichier Docker sur une seule ligne et aucune image de base. En fait, c'est juste un transfert de choses auxquelles nous sommes habitués. Voyez à quoi ressemblera cet assemblage. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jf/pr/uq/jfpruqpgtrrrwwchkadl34kxn_y.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai déjà créé ce fichier, mais il ressemble généralement à une tentative de création d'Internet entier. J'ai un peu peur de cet assemblage, car je ne suis pas sûr que l'Internet local puisse gérer Ruby. Voyez ce qui s'est passé.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jo/1i/a6/jo1ia6qqo37wr63tazkn-yco38e.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment aimez-vous ce volume de 1 Gig? De plus, le fichier source, c'est-à-dire votre application elle-même, ne peut occuper, disons, que 100 Ko. Alors, comment avons-nous obtenu un gigaoctet entier? En effet, nous utilisons des outils inefficaces pour créer des applications autonomes. Tous sont conçus pour fonctionner sur des ordinateurs et utiliser des bibliothèques dynamiques chargées à partir de l'environnement externe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous allons maintenant essayer de faire ce que nous faisons sur un téléphone mobile - des versions portables d'applications pour lesquelles il existe un contrat entre vous et l'infrastructure. Dès que nous aurons un tel contrat, nous serons en mesure de dire exactement au système ce qu'il doit faire, et il ne se souciera pas de ce qu'il doit faire.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous n'avez aucune application spéciale spécialement créée. Je suis tombé sur des entreprises qui disent: «nous avons une application spéciale!». Je dis: "Imaginons ce qu'il fait: il démarre, se lie au port, reçoit du trafic, fait quelque chose avec les données", et ils sont: "Wow, comment savez-vous cela?" Je sais, car il n'y a rien de spécial ici!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, nous prenons l'échantillon que nous avons placé dans le conteneur et l'envoyons au serveur API. Ensuite, nous devons transformer cela en quelque chose qui fonctionnera sur notre machine. Cependant, afin de collecter des ressources de la machine, nous devons installer plusieurs choses: un runtime de conteneur pour le fichier Docker, un agent qui comprend comment communiquer avec l'assistant afin d'exécuter tout le nécessaire, quelle devrait être la réponse du système pour que l'application commence à fonctionner . Cet agent observe simplement - il n'y a pas d'intervalle de 30 secondes, des contrôles répétés, rien de tel. Il observe simplement en disant: «s'il y a du travail pour moi, faites-le moi savoir, je vais commencer et je vous informerai en permanence de l'état d'avancement du processus», afin que vous sachiez qu'il fonctionne.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/2q/s1/dq/2qs1dq2ks5exprh4iljfwyiyydu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dès que nous le faisons en voiture, nous avons besoin d'un planificateur. Combien de personnes utilisent le planificateur? Vous devez tous lever la main! C'est la même chose que la réponse à la question: "Lequel d'entre vous a un ordinateur portable avec plus d'un processeur monocœur?". En effet, lorsque je pose une question sur le planificateur, la plupart ne lèvent pas la main. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque vous démarrez votre processus sur une machine, quelque chose devrait choisir le processeur à utiliser. Qui fait ce travail? C'est vrai, le noyau. Je vais maintenant vous expliquer ce qu'est un planificateur. Le moyen le plus rapide de le faire est de jouer à Tetris. La première chose dont nous allons discuter est le déploiement automatique.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/on/qu/bb/onqubbexwsv2hscesmqhfvanli4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Combien d'entre vous ont utilisé un déploiement entièrement automatique? De toute évidence, je pense que c'est pourquoi nous sommes tous ici. Donc, j'appuie sur le bouton, les blocs commencent à tomber d'en haut, et maintenant vous pouvez aller prendre une bière. Mais remarquez ce qui se passe à gauche et à droite: votre processeur et votre mémoire se transforment en poubelle. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9c/gc/nd/9cgcndnl9ybdbg7t5fdhjei0930.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela se produit car la plupart des gens n'utilisent pas plus de 5% des ressources informatiques. Vous automatisez les processus, mais perdez une tonne d'argent. Je travaille en tant que fournisseur de cloud, j'ai d'énormes réserves de ressources, mais c'est tout simplement horrible lorsque les gens dépensent de l'argent de la même manière.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque vous utilisez le planificateur, par analogie avec Tetris, contrôlez le terrain de jeu et contrôlez chaque bloc, en le dirigeant au bon endroit, c'est-à-dire, utilisez les ressources de la machine de la manière la plus optimale. Kubernetes utilise pour cela deux algorithmes. L'algorithme principal s'appelle Bin Packing - le même «Tetris» aidera à le comprendre. Kubernetes reçoit une charge de travail de différentes formes et tailles, et notre tâche est de l'emballer dans des machines de manière optimale.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notre objectif est de réutiliser toutes les ressources qui deviennent disponibles au fur et à mesure de l'avancement des travaux. Toutes les charges de travail ne sont pas identiques, il est donc difficile de les mettre dans la même boîte. Mais dans Kubernetes, lorsqu'un «morceau» de la charge de travail apparaît (ou le bloc Tetris, si nous continuons notre analogie), il y a toujours le bon cluster où vous pouvez le placer et l'exécuter. Et comme pour tout traitement par lots, une fois la tâche terminée, nous récupérons toutes les ressources précédemment occupées afin de pouvoir les utiliser pour de futures tâches. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puisque nous ne vivons pas dans le jeu, mais dans le monde réel, vous avez développé des solutions il y a de nombreuses années. Ensuite, vous devenez administrateur système, les employeurs vous montrent leur production et vous remarquez que leur déploiement n'est pas suffisant.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/2u/h_/hs/2uh_hsyrdmkfnkg5pnes9jlopr4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez installer des gestionnaires de cluster sur des parties de vos machines et les laisser gérer certaines ressources. Dans ce cas particulier, vous pouvez utiliser Kubernetes, qui commencera à remplir les espaces vides de votre Tetris à mesure que vous avancerez. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Que ceux qui travaillent dans l'industrie lèvent la main. Oui, c'est un classique appelé salaire. Supposons que vous rencontriez plusieurs problèmes dans votre entreprise. La première est que tout est écrit en Java ou même en COBOL - généralement personne n'est prêt pour cela.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le deuxième problème souvent rencontré dans les entreprises est le SGBD Oracle. C'est une telle chose, qui est située à l'arrière du logiciel et dit: "N'essayez pas d'automatiser quoi que ce soit!". Si vous automatisez le logiciel, votre coût augmentera. Par conséquent, pas d'automatisation - nous faisons la promotion de notre écosystème de conseil! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans de telles circonstances, les gens demandent généralement si Kubernetes peut simplement être utilisé pour résoudre ces problèmes. Je réponds: «non», car dans une situation similaire à la défaite à Tetris, rien ne vous aidera. Vous devez faire autre chose, à savoir utiliser le planificateur. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant que nous avons un planificateur qui comprend avec succès les charges de travail, vous pouvez simplement tout mettre dans des boîtes et le planificateur commencera son travail.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rg/yz/ei/rgyzeivhzivkgknoock70b7rcym.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parlons des entités clés de Kubernetes. Premièrement, ce sont des pods Pods, qui sont une collection de conteneurs. Dans la plupart des cas, une application se compose de plusieurs composants. Vous pouvez vous attacher une application écrite sans scripts Java, mais vous voudrez peut-être utiliser nginx pour terminer TLS et juste un proxy en arrière-plan de l'application, puis ces choses devraient être connectées ensemble, car ce sont des dépendances codées en dur. Une dépendance faiblement couplée est une base de données que vous mettez à l'échelle indépendamment. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/e4/ca/zh/e4cazhfmbeim5egpejksnv42ce8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La deuxième chose importante est le Replication Controller, qui est un gestionnaire des processus se produisant dans le cluster Kubernetes. Il vous permet de créer plusieurs instances de foyers et de surveiller leur état.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque vous dites que vous souhaitez démarrer un processus, cela signifie qu'il fonctionnera tout le temps quelque part dans le cluster. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le troisième élément important est le Service, un ensemble de foyers collaboratifs. Votre déploiement est basé sur la détermination dynamique de l'état souhaité - où les applications doivent fonctionner, avec quelle adresse IP, etc., vous avez donc besoin d'une certaine forme de service.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le quatrième élément est les référentiels Volumes, qui peuvent être vus comme des répertoires disponibles pour les conteneurs dans l'âtre. Kubernetes possède différents types de volumes qui déterminent comment ce magasin est créé et ce qu'il contient. Le concept de volume était également présent dans Docker, mais le problème était que le stockage y était limité à un foyer spécifique. Dès que under a cessé d'exister, Volume a disparu avec lui. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le stockage créé par Kubernetes n'est limité à aucun conteneur. Il prend en charge tout ou partie des conteneurs déployés à l'intérieur du foyer. Un avantage clé de Kubernetes Volume est sa prise en charge de divers types de stockage que Pod peut utiliser simultanément.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons ce qu'est un conteneur. Il s'agit du format d'image dans lequel notre application avec toutes les dépendances est compressée, et la configuration principale de l'environnement d'exécution, montrant comment cette application devrait fonctionner. Ce sont deux éléments différents, bien que vous puissiez emballer tout ce que vous aimez dans cette chose, en particulier, le système de fichiers racine en tant que fichier tar Tarball compressé qui contient de nombreux fichiers de configuration pour un système spécifique. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ed/lg/9w/edlg9wz2ttlinfb3udleerb0id0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous pouvons effectuer la distribution, un processus que vous connaissez tous - RPM ou un autre système de référentiel est utilisé ici. Vous prenez toutes ces choses et les mettez dans le référentiel. Ce processus est très similaire à ce que nous faisons avec les packages OS, uniquement pour les conteneurs créés à partir d'images.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pe/4p/dg/pe4pdggvudbe3l5ufp5l6gei6pc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pod vous permet de composer tout ce dont notre application logique a besoin. Une application logique est un outil de gestion de plusieurs applications dans le même profil système. Un sous-ensemble est un package de ressources qui comprend un ou plusieurs conteneurs et stockages, un espace de noms commun et une adresse IP par sous-marin. Les coffres peuvent être répartis entre les conteneurs.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ht/rw/cf/htrwcfvuetyk6vhgqjh6zgsjeoe.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En général, la conception du foyer ressemble à une machine virtuelle. Il garantit que l'application démarrera et s'arrêtera en tant qu'unité atomique. La diapositive suivante montre à quoi ressemble le contrôleur de réplication. Si j'envoie cette déclaration au serveur et dis: «Hé, je veux qu'une réplique de l'application Foo fonctionne!», Le contrôleur la créera à partir du modèle et l'enverra au planificateur, qui placera l'application sur le nœud 1. Nous ne précisons sur quelle machine il doit fonctionner, bien que nous puissions le faire. Augmentez maintenant le nombre de répliques à 3. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ta/qe/ld/taqeldbd6scvq7oyst2ff3dooyu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quelles actions attendez-vous du système si l'une des machines tombe en panne? Dans ce cas, le contrôleur de réplication amènera l'état actuel du système à l'état souhaité, en le déplaçant sous le conteneur de la troisième machine non fonctionnelle à la seconde.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/oy/d7/_i/oyd7_i1a1dvfpllkj_s7hek_37e.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous n'avez pas besoin de vous plonger dans ce processus et de le diriger - en confiant le travail au contrôleur, vous pouvez être sûr que le travail des applications sera correctement assuré en surveillant constamment les changements dans l'état actuel de l'infrastructure et en prenant des décisions qui garantissent le fonctionnement du système. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces choses sont en avance sur leur temps - vous dites simplement au système: "Je veux que ces trois machines fonctionnent!", Et c'est là que votre contrôle s'arrête. Cette approche est très différente de l'écriture de scripts et de l'automatisation pure, lorsque vous avez vraiment besoin de gérer ce qui se passe en ce moment pour influencer la décision future. Vous ne pouvez pas codifier tout cela sans avoir la possibilité de recevoir les informations entrantes afin de répondre correctement à la situation. L'approche décrite ci-dessus vous offre cette opportunité.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment imaginez-vous la configuration - le concept de fichiers de configuration pour les services? Beaucoup de gens sont silencieux sur ce problème quand il s'agit de conteneurs, mais nous avons encore besoin de configuration, il ne disparaît nulle part! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetes utilise également le concept Secrets, qui est utilisé pour stocker et transférer des données chiffrées entre les gestionnaires et les nœuds Nods. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous n'exécutons jamais Puppet dans un conteneur car il n'y a aucune raison de le faire. Vous pouvez utiliser Puppet pour générer un fichier de configuration, mais vous souhaitez toujours le stocker dans Kubernetis car il vous permet de le distribuer à l'aide du runtime. Voyons à quoi ça ressemble.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vv/i3/f3/vvi3f3c-8dhftpdedfe23me1xbg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet exemple, nous créons un secret à partir d'un fichier et l'enregistrons sur le serveur API Kubernetes. Vous pouvez imaginer que vous avez remplacé cette partie par quelque chose comme Puppet, qui utilise le modèle eRB et des données cachées pour remplir le contenu du secret - peu importe qui le fait, mais vous pouvez le faire quand même. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une fois le secret en place, il peut servir de lien pour créer un déploiement qui dit: «Je veux utiliser ce secret!» Dans ce cas, Kubernetes effectue les opérations suivantes.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cm/um/nu/cmumnufkw4ffxmhcggn2ppulcva.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il crée un pod, prend les données du secret, les place dans un système de fichiers temporaire et les présente comme un conteneur, tout comme Puppet crée une copie sur une machine. Cela suit le cycle de vie de l'application et lorsque l'application meurt, la configuration disparaît avec elle. Si vous avez besoin de 10 000 instances d'application, vous devrez créer et injecter dans moins de 10 000 systèmes de fichiers temporaires. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les services vous permettent d'exécuter tous ces éléments dans un cluster et de les synchroniser avec un autre point de terminaison. En fait, un service est un groupe de foyers qui fonctionnent comme un seul foyer. Il contient une adresse IP et un port permanents, fournit une intégration dans DNS, utilise l'équilibrage de charge et est mis à jour lorsque le micrologiciel change.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8t/cr/co/8tcrcolf5hrgnqfcrdf3nzkdr2a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons maintenant la collaboration des composants conceptuels de Kubernetes. Nous avons des briques et des configurations Lego qui doivent interagir les unes avec les autres. Si vous avez l'intention d'exécuter une base de données dans un cluster, vous pouvez vraiment le faire sur Kubernetes. Beaucoup disent que vous ne pourrez pas exécuter des applications avec état dans des conteneurs, mais c'est complètement faux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous pensez au fonctionnement des hyperviseurs, vous pouvez comprendre qu'ils font presque la même chose que vous: créer une machine virtuelle, le planificateur la déplace vers l'hyperviseur et attache le stockage. Parfois, vous travaillez avec un stockage local qui provient de l'hyperviseur, et il n'y a aucune raison pour que les conteneurs ne puissent pas faire de même.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, le problème avec les conteneurs est que la plupart des gens ne sont pas habitués à avoir une liste explicite de chemins de fichiers qu'ils doivent fournir à l'application. La plupart des gens ne pourront pas vous dire exactement les appareils et les fichiers dont l'entrepôt de données a besoin. Ils emballent tout dans des conteneurs, et en conséquence, rien de bon n'en sort. Par conséquent, ne croyez pas que les conteneurs ne sont pas capables d'exécuter des applications économisant l'état - vous pouvez très bien le faire. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bj/hm/ve/bjhmvetwbvkbjbqirup-xb_ya-0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur la diapositive, vous voyez un exemple de Ruby-on-Rails, et avant de pouvoir utiliser notre application, nous devons migrer la base de données. Passons à la démo en direct du programme. Afin d'effectuer le déploiement, j'utilise MY_SQL, et vous voyez beaucoup de données à l'écran.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dp/ai/or/dpaioryaowiq9c4yevmvd9uqkqg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je vous montre tout cela parce qu'en tant qu'administrateur système, vous devez comprendre beaucoup de choses. Dans ce déploiement, j'affine certaines des métadonnées de mon application, mais la chose principale que je vais souligner en gris: je veux démarrer 1 copie de l'application mysql et utiliser la version 5.6.32 du conteneur mysql. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qv/kr/ev/qvkrev67_otmvqqvdhtiha07mec.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notez que je sélectionne ici un secret de Kubernetes en tant que liens, que dans ce cas je vais injecter en tant que variables d'environnement. Plus tard, je vous montrerai un autre cas lorsque nous les insérerons dans le système de fichiers. Ainsi, je n'ai pas besoin de "cuire" des secrets dans ma configuration. La prochaine ligne importante est le bloc de ressources.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hm/b4/jt/hmb4jtgyd1dupdt4dfoapzcppli.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous ne pouvez pas jouer à Tetris tant que vous ne connaissez pas la taille des blocs. </font><font style="vertical-align: inherit;">De nombreuses personnes commencent à se déployer sans utiliser de limites de ressources pour ce processus. </font><font style="vertical-align: inherit;">En conséquence, la RAM est complètement obstruée et vous "empilez" tout le serveur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
22:09 min </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A suivre très prochainement ...</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/HlAXp0-M6SY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un peu de publicité :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Merci de rester avec nous. Aimez-vous nos articles? Vous voulez voir des matériaux plus intéressants? Soutenez-nous en passant une commande ou en recommandant à vos amis </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des VPS basés sur le cloud pour les développeurs à partir de 4,99 $</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , un </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">analogue unique de serveurs d'entrée de gamme que nous avons inventés pour vous: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toute la vérité sur les VPS (KVM) E5-2697 v3 (6 cœurs) 10 Go DDR4 480 Go SSD 1 Gbit / s à partir de 19 $ ou comment diviser le serveur?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (les options sont disponibles avec RAID1 et RAID10, jusqu'à 24 cœurs et jusqu'à 40 Go de DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2 fois moins cher au centre de données Equinix Tier IV à Amsterdam?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nous avons seulement </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV à partir de 199 $</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aux Pays-Bas!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - à partir de 99 $! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En savoir plus sur la</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> création d'un bâtiment d'infrastructure. </font><font style="vertical-align: inherit;">classe c utilisant des serveurs Dell R730xd E5-2650 v4 coûtant 9 000 euros pour un sou?</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr503960/index.html">Comment Linux trie les chaînes</a></li>
<li><a href="../fr503962/index.html">Conduite autonome - battage médiatique dans les voitures, mais la nécessité de services de réseau de centre de données</a></li>
<li><a href="../fr503964/index.html">DataStore - CRUD (Créer la suppression de la mise à jour en lecture)</a></li>
<li><a href="../fr503966/index.html">L'application Social Monitoring a été créée à partir d'un suivi de camion à ordures</a></li>
<li><a href="../fr503968/index.html">Comment faire bouger le robot avec précision? Présentation et fonctionnalités de Studuino Platform Robotics</a></li>
<li><a href="../fr503972/index.html">Test de streaming sur 4 réseaux sociaux et choix de la meilleure option</a></li>
<li><a href="../fr503980/index.html">Surveillance de la température sur un site éloigné par des moyens «improvisés»</a></li>
<li><a href="../fr503982/index.html">A propos des orcs et des frameworks</a></li>
<li><a href="../fr503988/index.html">Comment la "lumière tourbillonnante" est entrée dans les réseaux optiques</a></li>
<li><a href="../fr503990/index.html">Je suis fatigué du fait que les programmeurs ordinaires usurpent l'identité de développeurs et déshonorent l'industrie. Ils rendent le monde pire</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>