<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶á üï¥üèª ü§πüèø PuppetConf 2016. Kubernetes pour les administrateurs syst√®me. Partie 1 üè∞ üõÄüèΩ üíõ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je suis administrateur syst√®me, je travaille avec des ordinateurs et aujourd'hui nous parlerons de Kubernetes. J'essaierai d'approfondir le sujet, en ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>PuppetConf 2016. Kubernetes pour les administrateurs syst√®me. Partie 1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/503970/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je suis administrateur syst√®me, je travaille avec des ordinateurs et aujourd'hui nous parlerons de Kubernetes. J'essaierai d'approfondir le sujet, en consid√©rant les probl√®mes que l'administrateur syst√®me peut r√©soudre avec cette application, et j'aborderai √©galement certains aspects du fonctionnement de Puppet, qui semblaient entrer dans ce monde √† l'aide d'un nouvel ensemble d'abstractions pour que l'application fonctionne. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a cinq ou six ans, Luis Andre Barroso et Urs Hoesl dans l'article ¬´Data Center as a Computer¬ª ont sugg√©r√© que nous devrions percevoir le centre de donn√©es comme un ordinateur massif. Il est n√©cessaire de faire abstraction du fait que le centre de donn√©es se compose de machines distinctes et de le consid√©rer comme une entit√© logique. D√®s que vous essayez d'utiliser cette id√©e dans la pratique, vous pouvez appliquer les principes de la construction de syst√®mes distribu√©s et de l'informatique distribu√©e aux centres de donn√©es.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/w9/q7/sg/w9q7sgxchzl3fuuhlrymsv4xcsa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour traiter le centre de donn√©es comme un ordinateur, vous avez besoin d'un syst√®me d'exploitation. Il ressemble beaucoup √† celui que vous utilisez sur un ordinateur s√©par√©, mais doit avoir une interface diff√©rente, car vous n'avez pas besoin d'acc√©der √† une machine distincte et vous n'avez pas besoin d'acc√©der au noyau. Alors, consid√©rons le centre de donn√©es comme un gros ordinateur. Aujourd'hui, je vais vous dire quoi faire si vous semblez √™tre priv√© de la possibilit√© de contr√¥ler n'importe quelle machine utilisant SSH. Vous ne pourrez pas vous connecter, et bien que certaines personnes croient que sans cela, il est impossible de contr√¥ler le syst√®me, je vais vous dire ce qui peut √™tre fait avec Kubernetes. Tout d'abord, vous devez consid√©rer Kubernetes comme un cadre pour la cr√©ation de plates-formes distribu√©es.</font></font><a name="habracut"></a><br>
<br>
<img src="https://habrastorage.org/webt/wf/d2/5c/wfd25cjupilzhtu1ndkpci11cfs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela ne signifie pas qu'apr√®s avoir t√©l√©charg√© Kubernetes, vous obtiendrez une interface utilisateur qui vous fournira tout ce que vous voulez faire avec le syst√®me. Non, ce n'est que le fondement de la cr√©ation des outils dont vous avez besoin pour ex√©cuter votre infrastructure. Je vais vous montrer comment cr√©er une int√©gration √† l'aide de l'Autorit√© de certification Let's Encrypt pour automatiser le processus de certificat pour mon application en utilisant Kubernetes comme cadre.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ol/ty/g3/oltyg3s-gtbgticzc-omgefrq04.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beaucoup de gens demandent exactement √† quoi Kubernetes est bon. J'ai travaill√© avec Puppet Labs pendant de nombreuses ann√©es et j'ai vu que cette chose √©tait install√©e sur des ordinateurs afin de fournir au syst√®me une API qui n'existait pas jusqu'√† pr√©sent. Au lieu de Bash, de scripts YAML et d'autres choses similaires, Puppet a fourni un utilisateur DSL qui lui a permis d'interagir par programme avec les machines sans scripts shell. La diff√©rence entre Kubernetes est qu'il est situ√© au-dessus du niveau de "fer". Concentrons-nous non pas tant sur l'automatisation et l'abstraction de ce syst√®me que sur les relations, ou sur le contrat, entre notre infrastructure et nos applications que nous allons tirer de n'importe quel n≈ìud. Dans Kubernetes, nous n‚Äôaffectons aucune application aux machines, il n‚Äôexiste pas de ¬´manifeste de n≈ìud¬ª, le planificateur consid√®re les n≈ìuds individuels simplement comme des ressources de centre de donn√©es,repr√©sentant un gros ordinateur.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Questions: "Kubernetes fonctionne-t-il sur OpenStack, sur VMware, sur Bare Metal, dans le cloud?" √ßa n'a pas de sens. La bonne question est: ¬´Puis-je ex√©cuter l'agent Kubernetes pour r√©cup√©rer ces ressources?¬ª Et la r√©ponse sera ¬´oui¬ª. Parce que le fonctionnement de cette application est totalement ind√©pendant de la plateforme que vous choisissez. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/an/km/hl/ankmhlzzmnaitmix8t0hppm8idi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetes est ind√©pendant de la plateforme. Kubernetes est d√©claratif de la m√™me mani√®re que Puppet. Par cons√©quent, vous signalez pour quelle application vous allez l'utiliser - dans cet exemple, il s'agit de nginx. Il s'agit d'un contrat entre vous, le d√©veloppeur et Kubernetes comme moyen de cr√©er des images de conteneur.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'aime utiliser l'analogie avec la soci√©t√© de messagerie FedEx - vous ne pouvez pas les faire glisser tout un wagon de choses et attendre qu'ils trient tout et l'envoient √† l'endroit o√π il devrait √™tre. Ils ont une r√®gle: mettez vos affaires dans une bo√Æte. Une fois que vous le ferez, ils enverront votre bo√Æte et pourront dire quand elle arrivera √† destination. "Si vous n'avez pas de bo√Æte, vous ne pourrez pas travailler avec notre syst√®me."</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, lorsque vous travaillez avec des conteneurs, il est inutile de discuter de ce que vous avez - Python, Java et ou quelque chose d'autre, peu importe - prenez simplement toutes vos d√©pendances et placez-les dans le conteneur. Beaucoup de gens disent que les conteneurs semblent r√©soudre les probl√®mes de l'ensemble de l'infrastructure. Cependant, le probl√®me est que les gens ne per√ßoivent pas les conteneurs comme deux choses diff√©rentes qu‚Äôils sont r√©ellement. La premi√®re chose est l'id√©e d'un format d'emballage, la seconde est l'id√©e d'un runtime de conteneur. Ce sont deux choses diff√©rentes qui ne n√©cessitent pas n√©cessairement les m√™mes outils.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Laquelle des personnes pr√©sentes a cr√©√© les conteneurs? Et qui utilise Puppet pour construire des conteneurs? C'est vrai, je ne suis pas d'accord non plus! Vous pouvez dire: ¬´comment cela? Vous √™tes √† la conf√©rence Puppet, vous devez √™tre d'accord! ¬ª La raison pour laquelle je ne suis pas d'accord avec l'id√©e de construire des conteneurs dans Puppet est la suivante: je ne sais pas si nous en avons besoin, car les choses dont nous avons besoin pour cr√©er une image sont diff√©rentes de celles dont nous avons besoin pour d√©marrer le processus de production. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imaginons-le comme la cr√©ation d'un pipeline logiciel et jetons un ≈ìil √† ce Dockerfile. Fermez les yeux sur ceux qui n'ont jamais vu ces fichiers, car pour vous, ils peuvent sembler intimidants. Ce fichier montre comment cr√©er une application Ruby on Rails - une application Ruby avec un framework Rails.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/f3/ra/3r/f3ra3rkhngjp08t7beuyoeihc7i.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il indique ¬´FROM ruby ‚Äã‚Äã2.3.1¬ª, qui ins√©rera probablement l'int√©gralit√© du syst√®me d'exploitation dans le conteneur, dans ce cas l'image de base alpin-linux Ruby. Est-ce que quelqu'un sait pourquoi nous incorporons des images Ubuntu ou Red Hat dans ces conteneurs? La plupart des gens ne savent pas ce que sont les d√©pendances et utilisent une approche al√©atoire, simplement en fourrant l'ensemble du syst√®me d'exploitation dans un conteneur pour s'assurer qu'ils ont leurs d√©pendances quelque part √† l'int√©rieur. Donc, apr√®s avoir construit cette chose, vous ne devez l'ex√©cuter qu'une seule fois. C'est de l√† que vient le malentendu: si cette chose ne fonctionne pas, changez la ligne de code jusqu'√† ce qu'elle fonctionne. V√©rifiez simplement! Vous n'avez pas besoin d'√™tre trop intelligent avec ces fichiers, votre objectif est de construire une repr√©sentation hors ligne de votre application avec toutes les d√©pendances. Ce n'est qu'une b√©quille que nous utilisons d'Ubuntu comme point de d√©part.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous venez de cr√©er l'application et de la lancer, vous utiliseriez quelque chose comme un lien statique. Aucune d√©pendance √† l'h√¥te, dans votre conteneur, vous auriez juste un binaire d'un fichier Docker sur une seule ligne et aucune image de base. En fait, c'est juste un transfert de choses auxquelles nous sommes habitu√©s. Voyez √† quoi ressemblera cet assemblage. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jf/pr/uq/jfpruqpgtrrrwwchkadl34kxn_y.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai d√©j√† cr√©√© ce fichier, mais il ressemble g√©n√©ralement √† une tentative de cr√©ation d'Internet entier. J'ai un peu peur de cet assemblage, car je ne suis pas s√ªr que l'Internet local puisse g√©rer Ruby. Voyez ce qui s'est pass√©.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jo/1i/a6/jo1ia6qqo37wr63tazkn-yco38e.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment aimez-vous ce volume de 1 Gig? De plus, le fichier source, c'est-√†-dire votre application elle-m√™me, ne peut occuper, disons, que 100 Ko. Alors, comment avons-nous obtenu un gigaoctet entier? En effet, nous utilisons des outils inefficaces pour cr√©er des applications autonomes. Tous sont con√ßus pour fonctionner sur des ordinateurs et utiliser des biblioth√®ques dynamiques charg√©es √† partir de l'environnement externe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous allons maintenant essayer de faire ce que nous faisons sur un t√©l√©phone mobile - des versions portables d'applications pour lesquelles il existe un contrat entre vous et l'infrastructure. D√®s que nous aurons un tel contrat, nous serons en mesure de dire exactement au syst√®me ce qu'il doit faire, et il ne se souciera pas de ce qu'il doit faire.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous n'avez aucune application sp√©ciale sp√©cialement cr√©√©e. Je suis tomb√© sur des entreprises qui disent: ¬´nous avons une application sp√©ciale!¬ª. Je dis: "Imaginons ce qu'il fait: il d√©marre, se lie au port, re√ßoit du trafic, fait quelque chose avec les donn√©es", et ils sont: "Wow, comment savez-vous cela?" Je sais, car il n'y a rien de sp√©cial ici!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, nous prenons l'√©chantillon que nous avons plac√© dans le conteneur et l'envoyons au serveur API. Ensuite, nous devons transformer cela en quelque chose qui fonctionnera sur notre machine. Cependant, afin de collecter des ressources de la machine, nous devons installer plusieurs choses: un runtime de conteneur pour le fichier Docker, un agent qui comprend comment communiquer avec l'assistant afin d'ex√©cuter tout le n√©cessaire, quelle devrait √™tre la r√©ponse du syst√®me pour que l'application commence √† fonctionner . Cet agent observe simplement - il n'y a pas d'intervalle de 30 secondes, des contr√¥les r√©p√©t√©s, rien de tel. Il observe simplement en disant: ¬´s'il y a du travail pour moi, faites-le moi savoir, je vais commencer et je vous informerai en permanence de l'√©tat d'avancement du processus¬ª, afin que vous sachiez qu'il fonctionne.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/2q/s1/dq/2qs1dq2ks5exprh4iljfwyiyydu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D√®s que nous le faisons en voiture, nous avons besoin d'un planificateur. Combien de personnes utilisent le planificateur? Vous devez tous lever la main! C'est la m√™me chose que la r√©ponse √† la question: "Lequel d'entre vous a un ordinateur portable avec plus d'un processeur monoc≈ìur?". En effet, lorsque je pose une question sur le planificateur, la plupart ne l√®vent pas la main. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque vous d√©marrez votre processus sur une machine, quelque chose devrait choisir le processeur √† utiliser. Qui fait ce travail? C'est vrai, le noyau. Je vais maintenant vous expliquer ce qu'est un planificateur. Le moyen le plus rapide de le faire est de jouer √† Tetris. La premi√®re chose dont nous allons discuter est le d√©ploiement automatique.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/on/qu/bb/onqubbexwsv2hscesmqhfvanli4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Combien d'entre vous ont utilis√© un d√©ploiement enti√®rement automatique? De toute √©vidence, je pense que c'est pourquoi nous sommes tous ici. Donc, j'appuie sur le bouton, les blocs commencent √† tomber d'en haut, et maintenant vous pouvez aller prendre une bi√®re. Mais remarquez ce qui se passe √† gauche et √† droite: votre processeur et votre m√©moire se transforment en poubelle. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9c/gc/nd/9cgcndnl9ybdbg7t5fdhjei0930.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela se produit car la plupart des gens n'utilisent pas plus de 5% des ressources informatiques. Vous automatisez les processus, mais perdez une tonne d'argent. Je travaille en tant que fournisseur de cloud, j'ai d'√©normes r√©serves de ressources, mais c'est tout simplement horrible lorsque les gens d√©pensent de l'argent de la m√™me mani√®re.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque vous utilisez le planificateur, par analogie avec Tetris, contr√¥lez le terrain de jeu et contr√¥lez chaque bloc, en le dirigeant au bon endroit, c'est-√†-dire, utilisez les ressources de la machine de la mani√®re la plus optimale. Kubernetes utilise pour cela deux algorithmes. L'algorithme principal s'appelle Bin Packing - le m√™me ¬´Tetris¬ª aidera √† le comprendre. Kubernetes re√ßoit une charge de travail de diff√©rentes formes et tailles, et notre t√¢che est de l'emballer dans des machines de mani√®re optimale.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notre objectif est de r√©utiliser toutes les ressources qui deviennent disponibles au fur et √† mesure de l'avancement des travaux. Toutes les charges de travail ne sont pas identiques, il est donc difficile de les mettre dans la m√™me bo√Æte. Mais dans Kubernetes, lorsqu'un ¬´morceau¬ª de la charge de travail appara√Æt (ou le bloc Tetris, si nous continuons notre analogie), il y a toujours le bon cluster o√π vous pouvez le placer et l'ex√©cuter. Et comme pour tout traitement par lots, une fois la t√¢che termin√©e, nous r√©cup√©rons toutes les ressources pr√©c√©demment occup√©es afin de pouvoir les utiliser pour de futures t√¢ches. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puisque nous ne vivons pas dans le jeu, mais dans le monde r√©el, vous avez d√©velopp√© des solutions il y a de nombreuses ann√©es. Ensuite, vous devenez administrateur syst√®me, les employeurs vous montrent leur production et vous remarquez que leur d√©ploiement n'est pas suffisant.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/2u/h_/hs/2uh_hsyrdmkfnkg5pnes9jlopr4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez installer des gestionnaires de cluster sur des parties de vos machines et les laisser g√©rer certaines ressources. Dans ce cas particulier, vous pouvez utiliser Kubernetes, qui commencera √† remplir les espaces vides de votre Tetris √† mesure que vous avancerez. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Que ceux qui travaillent dans l'industrie l√®vent la main. Oui, c'est un classique appel√© salaire. Supposons que vous rencontriez plusieurs probl√®mes dans votre entreprise. La premi√®re est que tout est √©crit en Java ou m√™me en COBOL - g√©n√©ralement personne n'est pr√™t pour cela.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le deuxi√®me probl√®me souvent rencontr√© dans les entreprises est le SGBD Oracle. C'est une telle chose, qui est situ√©e √† l'arri√®re du logiciel et dit: "N'essayez pas d'automatiser quoi que ce soit!". Si vous automatisez le logiciel, votre co√ªt augmentera. Par cons√©quent, pas d'automatisation - nous faisons la promotion de notre √©cosyst√®me de conseil! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans de telles circonstances, les gens demandent g√©n√©ralement si Kubernetes peut simplement √™tre utilis√© pour r√©soudre ces probl√®mes. Je r√©ponds: ¬´non¬ª, car dans une situation similaire √† la d√©faite √† Tetris, rien ne vous aidera. Vous devez faire autre chose, √† savoir utiliser le planificateur. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant que nous avons un planificateur qui comprend avec succ√®s les charges de travail, vous pouvez simplement tout mettre dans des bo√Ætes et le planificateur commencera son travail.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rg/yz/ei/rgyzeivhzivkgknoock70b7rcym.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parlons des entit√©s cl√©s de Kubernetes. Premi√®rement, ce sont des pods Pods, qui sont une collection de conteneurs. Dans la plupart des cas, une application se compose de plusieurs composants. Vous pouvez vous attacher une application √©crite sans scripts Java, mais vous voudrez peut-√™tre utiliser nginx pour terminer TLS et juste un proxy en arri√®re-plan de l'application, puis ces choses devraient √™tre connect√©es ensemble, car ce sont des d√©pendances cod√©es en dur. Une d√©pendance faiblement coupl√©e est une base de donn√©es que vous mettez √† l'√©chelle ind√©pendamment. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/e4/ca/zh/e4cazhfmbeim5egpejksnv42ce8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La deuxi√®me chose importante est le Replication Controller, qui est un gestionnaire des processus se produisant dans le cluster Kubernetes. Il vous permet de cr√©er plusieurs instances de foyers et de surveiller leur √©tat.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque vous dites que vous souhaitez d√©marrer un processus, cela signifie qu'il fonctionnera tout le temps quelque part dans le cluster. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le troisi√®me √©l√©ment important est le Service, un ensemble de foyers collaboratifs. Votre d√©ploiement est bas√© sur la d√©termination dynamique de l'√©tat souhait√© - o√π les applications doivent fonctionner, avec quelle adresse IP, etc., vous avez donc besoin d'une certaine forme de service.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le quatri√®me √©l√©ment est les r√©f√©rentiels Volumes, qui peuvent √™tre vus comme des r√©pertoires disponibles pour les conteneurs dans l'√¢tre. Kubernetes poss√®de diff√©rents types de volumes qui d√©terminent comment ce magasin est cr√©√© et ce qu'il contient. Le concept de volume √©tait √©galement pr√©sent dans Docker, mais le probl√®me √©tait que le stockage y √©tait limit√© √† un foyer sp√©cifique. D√®s que under a cess√© d'exister, Volume a disparu avec lui. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le stockage cr√©√© par Kubernetes n'est limit√© √† aucun conteneur. Il prend en charge tout ou partie des conteneurs d√©ploy√©s √† l'int√©rieur du foyer. Un avantage cl√© de Kubernetes Volume est sa prise en charge de divers types de stockage que Pod peut utiliser simultan√©ment.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons ce qu'est un conteneur. Il s'agit du format d'image dans lequel notre application avec toutes les d√©pendances est compress√©e, et la configuration principale de l'environnement d'ex√©cution, montrant comment cette application devrait fonctionner. Ce sont deux √©l√©ments diff√©rents, bien que vous puissiez emballer tout ce que vous aimez dans cette chose, en particulier, le syst√®me de fichiers racine en tant que fichier tar Tarball compress√© qui contient de nombreux fichiers de configuration pour un syst√®me sp√©cifique. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ed/lg/9w/edlg9wz2ttlinfb3udleerb0id0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous pouvons effectuer la distribution, un processus que vous connaissez tous - RPM ou un autre syst√®me de r√©f√©rentiel est utilis√© ici. Vous prenez toutes ces choses et les mettez dans le r√©f√©rentiel. Ce processus est tr√®s similaire √† ce que nous faisons avec les packages OS, uniquement pour les conteneurs cr√©√©s √† partir d'images.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pe/4p/dg/pe4pdggvudbe3l5ufp5l6gei6pc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pod vous permet de composer tout ce dont notre application logique a besoin. Une application logique est un outil de gestion de plusieurs applications dans le m√™me profil syst√®me. Un sous-ensemble est un package de ressources qui comprend un ou plusieurs conteneurs et stockages, un espace de noms commun et une adresse IP par sous-marin. Les coffres peuvent √™tre r√©partis entre les conteneurs.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ht/rw/cf/htrwcfvuetyk6vhgqjh6zgsjeoe.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En g√©n√©ral, la conception du foyer ressemble √† une machine virtuelle. Il garantit que l'application d√©marrera et s'arr√™tera en tant qu'unit√© atomique. La diapositive suivante montre √† quoi ressemble le contr√¥leur de r√©plication. Si j'envoie cette d√©claration au serveur et dis: ¬´H√©, je veux qu'une r√©plique de l'application Foo fonctionne!¬ª, Le contr√¥leur la cr√©era √† partir du mod√®le et l'enverra au planificateur, qui placera l'application sur le n≈ìud 1. Nous ne pr√©cisons sur quelle machine il doit fonctionner, bien que nous puissions le faire. Augmentez maintenant le nombre de r√©pliques √† 3. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ta/qe/ld/taqeldbd6scvq7oyst2ff3dooyu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quelles actions attendez-vous du syst√®me si l'une des machines tombe en panne? Dans ce cas, le contr√¥leur de r√©plication am√®nera l'√©tat actuel du syst√®me √† l'√©tat souhait√©, en le d√©pla√ßant sous le conteneur de la troisi√®me machine non fonctionnelle √† la seconde.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/oy/d7/_i/oyd7_i1a1dvfpllkj_s7hek_37e.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous n'avez pas besoin de vous plonger dans ce processus et de le diriger - en confiant le travail au contr√¥leur, vous pouvez √™tre s√ªr que le travail des applications sera correctement assur√© en surveillant constamment les changements dans l'√©tat actuel de l'infrastructure et en prenant des d√©cisions qui garantissent le fonctionnement du syst√®me. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces choses sont en avance sur leur temps - vous dites simplement au syst√®me: "Je veux que ces trois machines fonctionnent!", Et c'est l√† que votre contr√¥le s'arr√™te. Cette approche est tr√®s diff√©rente de l'√©criture de scripts et de l'automatisation pure, lorsque vous avez vraiment besoin de g√©rer ce qui se passe en ce moment pour influencer la d√©cision future. Vous ne pouvez pas codifier tout cela sans avoir la possibilit√© de recevoir les informations entrantes afin de r√©pondre correctement √† la situation. L'approche d√©crite ci-dessus vous offre cette opportunit√©.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment imaginez-vous la configuration - le concept de fichiers de configuration pour les services? Beaucoup de gens sont silencieux sur ce probl√®me quand il s'agit de conteneurs, mais nous avons encore besoin de configuration, il ne dispara√Æt nulle part! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetes utilise √©galement le concept Secrets, qui est utilis√© pour stocker et transf√©rer des donn√©es chiffr√©es entre les gestionnaires et les n≈ìuds Nods. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous n'ex√©cutons jamais Puppet dans un conteneur car il n'y a aucune raison de le faire. Vous pouvez utiliser Puppet pour g√©n√©rer un fichier de configuration, mais vous souhaitez toujours le stocker dans Kubernetis car il vous permet de le distribuer √† l'aide du runtime. Voyons √† quoi √ßa ressemble.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vv/i3/f3/vvi3f3c-8dhftpdedfe23me1xbg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet exemple, nous cr√©ons un secret √† partir d'un fichier et l'enregistrons sur le serveur API Kubernetes. Vous pouvez imaginer que vous avez remplac√© cette partie par quelque chose comme Puppet, qui utilise le mod√®le eRB et des donn√©es cach√©es pour remplir le contenu du secret - peu importe qui le fait, mais vous pouvez le faire quand m√™me. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une fois le secret en place, il peut servir de lien pour cr√©er un d√©ploiement qui dit: ¬´Je veux utiliser ce secret!¬ª Dans ce cas, Kubernetes effectue les op√©rations suivantes.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cm/um/nu/cmumnufkw4ffxmhcggn2ppulcva.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il cr√©e un pod, prend les donn√©es du secret, les place dans un syst√®me de fichiers temporaire et les pr√©sente comme un conteneur, tout comme Puppet cr√©e une copie sur une machine. Cela suit le cycle de vie de l'application et lorsque l'application meurt, la configuration dispara√Æt avec elle. Si vous avez besoin de 10 000 instances d'application, vous devrez cr√©er et injecter dans moins de 10 000 syst√®mes de fichiers temporaires. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les services vous permettent d'ex√©cuter tous ces √©l√©ments dans un cluster et de les synchroniser avec un autre point de terminaison. En fait, un service est un groupe de foyers qui fonctionnent comme un seul foyer. Il contient une adresse IP et un port permanents, fournit une int√©gration dans DNS, utilise l'√©quilibrage de charge et est mis √† jour lorsque le micrologiciel change.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8t/cr/co/8tcrcolf5hrgnqfcrdf3nzkdr2a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons maintenant la collaboration des composants conceptuels de Kubernetes. Nous avons des briques et des configurations Lego qui doivent interagir les unes avec les autres. Si vous avez l'intention d'ex√©cuter une base de donn√©es dans un cluster, vous pouvez vraiment le faire sur Kubernetes. Beaucoup disent que vous ne pourrez pas ex√©cuter des applications avec √©tat dans des conteneurs, mais c'est compl√®tement faux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous pensez au fonctionnement des hyperviseurs, vous pouvez comprendre qu'ils font presque la m√™me chose que vous: cr√©er une machine virtuelle, le planificateur la d√©place vers l'hyperviseur et attache le stockage. Parfois, vous travaillez avec un stockage local qui provient de l'hyperviseur, et il n'y a aucune raison pour que les conteneurs ne puissent pas faire de m√™me.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, le probl√®me avec les conteneurs est que la plupart des gens ne sont pas habitu√©s √† avoir une liste explicite de chemins de fichiers qu'ils doivent fournir √† l'application. La plupart des gens ne pourront pas vous dire exactement les appareils et les fichiers dont l'entrep√¥t de donn√©es a besoin. Ils emballent tout dans des conteneurs, et en cons√©quence, rien de bon n'en sort. Par cons√©quent, ne croyez pas que les conteneurs ne sont pas capables d'ex√©cuter des applications √©conomisant l'√©tat - vous pouvez tr√®s bien le faire. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bj/hm/ve/bjhmvetwbvkbjbqirup-xb_ya-0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur la diapositive, vous voyez un exemple de Ruby-on-Rails, et avant de pouvoir utiliser notre application, nous devons migrer la base de donn√©es. Passons √† la d√©mo en direct du programme. Afin d'effectuer le d√©ploiement, j'utilise MY_SQL, et vous voyez beaucoup de donn√©es √† l'√©cran.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dp/ai/or/dpaioryaowiq9c4yevmvd9uqkqg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je vous montre tout cela parce qu'en tant qu'administrateur syst√®me, vous devez comprendre beaucoup de choses. Dans ce d√©ploiement, j'affine certaines des m√©tadonn√©es de mon application, mais la chose principale que je vais souligner en gris: je veux d√©marrer 1 copie de l'application mysql et utiliser la version 5.6.32 du conteneur mysql. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qv/kr/ev/qvkrev67_otmvqqvdhtiha07mec.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notez que je s√©lectionne ici un secret de Kubernetes en tant que liens, que dans ce cas je vais injecter en tant que variables d'environnement. Plus tard, je vous montrerai un autre cas lorsque nous les ins√©rerons dans le syst√®me de fichiers. Ainsi, je n'ai pas besoin de "cuire" des secrets dans ma configuration. La prochaine ligne importante est le bloc de ressources.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hm/b4/jt/hmb4jtgyd1dupdt4dfoapzcppli.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous ne pouvez pas jouer √† Tetris tant que vous ne connaissez pas la taille des blocs. </font><font style="vertical-align: inherit;">De nombreuses personnes commencent √† se d√©ployer sans utiliser de limites de ressources pour ce processus. </font><font style="vertical-align: inherit;">En cons√©quence, la RAM est compl√®tement obstru√©e et vous "empilez" tout le serveur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
22:09 min </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A suivre tr√®s prochainement ...</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/HlAXp0-M6SY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un peu de publicit√© :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Merci de rester avec nous. Aimez-vous nos articles? Vous voulez voir des mat√©riaux plus int√©ressants? Soutenez-nous en passant une commande ou en recommandant √† vos amis </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des VPS bas√©s sur le cloud pour les d√©veloppeurs √† partir de 4,99 $</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , un </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">analogue unique de serveurs d'entr√©e de gamme que nous avons invent√©s pour vous: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toute la v√©rit√© sur les VPS (KVM) E5-2697 v3 (6 c≈ìurs) 10 Go DDR4 480 Go SSD 1 Gbit / s √† partir de 19 $ ou comment diviser le serveur?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (les options sont disponibles avec RAID1 et RAID10, jusqu'√† 24 c≈ìurs et jusqu'√† 40 Go de DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2 fois moins cher au centre de donn√©es Equinix Tier IV √† Amsterdam?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nous avons seulement </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV √† partir de 199 $</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aux Pays-Bas!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - √† partir de 99 $! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En savoir plus sur la</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cr√©ation d'un b√¢timent d'infrastructure. </font><font style="vertical-align: inherit;">classe c utilisant des serveurs Dell R730xd E5-2650 v4 co√ªtant 9 000 euros pour un sou?</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr503960/index.html">Comment Linux trie les cha√Ænes</a></li>
<li><a href="../fr503962/index.html">Conduite autonome - battage m√©diatique dans les voitures, mais la n√©cessit√© de services de r√©seau de centre de donn√©es</a></li>
<li><a href="../fr503964/index.html">DataStore - CRUD (Cr√©er la suppression de la mise √† jour en lecture)</a></li>
<li><a href="../fr503966/index.html">L'application Social Monitoring a √©t√© cr√©√©e √† partir d'un suivi de camion √† ordures</a></li>
<li><a href="../fr503968/index.html">Comment faire bouger le robot avec pr√©cision? Pr√©sentation et fonctionnalit√©s de Studuino Platform Robotics</a></li>
<li><a href="../fr503972/index.html">Test de streaming sur 4 r√©seaux sociaux et choix de la meilleure option</a></li>
<li><a href="../fr503980/index.html">Surveillance de la temp√©rature sur un site √©loign√© par des moyens ¬´improvis√©s¬ª</a></li>
<li><a href="../fr503982/index.html">A propos des orcs et des frameworks</a></li>
<li><a href="../fr503988/index.html">Comment la "lumi√®re tourbillonnante" est entr√©e dans les r√©seaux optiques</a></li>
<li><a href="../fr503990/index.html">Je suis fatigu√© du fait que les programmeurs ordinaires usurpent l'identit√© de d√©veloppeurs et d√©shonorent l'industrie. Ils rendent le monde pire</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>