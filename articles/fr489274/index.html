<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏼‍🌾 🧙🏽 🤴🏾 Affirmer des messages dans les tests 😸 🛀🏻 🎺</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Rebonjour. En prévision du début du cours «Développeur C #», nous avons traduit du matériel intéressant sur les messages d'affirmation dans les tests ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Affirmer des messages dans les tests</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/489274/"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rebonjour. </font><font style="vertical-align: inherit;">En prévision du début du cours </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«Développeur C #», nous avons</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> traduit du matériel intéressant sur les messages d'affirmation dans les tests et sommes heureux de partager la traduction avec vous.</font></font></b></i><br>
<br>
<img src="https://habrastorage.org/webt/ib/ig/bo/ibigbo8btlszevaqfb4awgpmml0.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet article, nous verrons si vous devez utiliser les messages Assert dans vos tests. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai reçu une question intéressante d'un collègue lecteur, sur laquelle j'aimerais m'attarder plus en détail: </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'ai une question sur les messages Assert: dois-je utiliser la surcharge contenant le paramètre message et l'utiliser pour envoyer une chaîne décrivant la raison de l'échec d'Assert (également «Revendications») ?</font></font></i><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La réponse à cette question se résume à deux aspects:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lisibilité du test - à quel point il est facile de comprendre ce que fait le test.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Facilité de diagnostic - à quel point il est facile de comprendre pourquoi le test échoue.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Discutons chacun d'eux individuellement</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Test de lisibilité</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les gens utilisent souvent les messages Assert pour aider les membres de l'équipe et eux-mêmes à l'avenir à comprendre ce qui se passe dans le test. </font><font style="vertical-align: inherit;">Regardons l'exemple suivant:</font></font><br>
<br>
<pre><code class="cs hljs">[<span class="hljs-meta">Test</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Hiring_a_new_team_member</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">var</span> company = <span class="hljs-keyword">new</span> Company();
    <span class="hljs-keyword">var</span> person = <span class="hljs-keyword">new</span> Person(UserType.Customer);<font></font>
<font></font>
    company.HireNewMember(person);<font></font>
<font></font>
    Assert.AreEqual(UserType.Employee, person.Type); <span class="hljs-comment">//  </span>
    Assert.AreEqual(<span class="hljs-number">1</span>, company.NumberOfEmployees); <span class="hljs-comment">//  </span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au lieu d'une assertion nue, vous pouvez également indiquer la raison pour laquelle l'assertion de test valide quelque chose:</font></font><br>
<br>
<pre><code class="cs hljs">[<span class="hljs-meta">Test</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Hiring_a_new_team_member</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">var</span> company = <span class="hljs-keyword">new</span> Company();
    <span class="hljs-keyword">var</span> person = <span class="hljs-keyword">new</span> Person(UserType.Customer);<font></font>
<font></font>
    company.HireNewMember(person);<font></font>
<font></font>
    Assert.AreEqual(UserType.Employee, person.Type, <span class="hljs-string">"Person must become an employee after hiring"</span>);<font></font>
    Assert.AreEqual(<span class="hljs-number">1</span>, company.NumberOfEmployees, <span class="hljs-string">"Number of employees must increase"</span>);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De telles déclarations aident, mais elles ont un prix. </font><font style="vertical-align: inherit;">Ces messages vous demandent</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Passez du temps à les écrire</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Continuez à les faire avancer</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, l'ensemble des avantages et des inconvénients est le même que dans les commentaires sur le code. Et, comme dans le cas des commentaires, je vous conseille: n'écrivez pas de messages d'affirmation uniquement à des fins de lisibilité. Si vous pensez que le test n'est pas évident sans messages d'affirmation, essayez plutôt de le refactoriser. À long terme, il est plus facile de faire parler le test de lui-même que de le synchroniser avec les messages d’affirmation (et ce n’est qu’une question de temps avant que la synchronisation ne soit interrompue). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entrez des messages d'affirmation uniquement lorsque cela est absolument nécessaire - lorsque vous ne pouvez pas améliorer la lisibilité du test d'une autre manière. Mais même alors, inclinez-vous à choisir de ne pas les écrire.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le moyen le plus simple d'obtenir un gain rapide de lisibilité du test est de passer à un enregistrement d'instructions lisible. </font><font style="vertical-align: inherit;">Par exemple, NUnit dispose d'un modèle d'instruction basé sur des contraintes spéciales qui vous aide à écrire vos instructions de la manière suivante:</font></font><br>
<br>
<pre><code class="cs hljs">[<span class="hljs-meta">Test</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Hiring_a_new_team_member</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">var</span> company = <span class="hljs-keyword">new</span> Company();
    <span class="hljs-keyword">var</span> person = <span class="hljs-keyword">new</span> Person(UserType.Customer);<font></font>
<font></font>
    company.HireNewMember(person);<font></font>
<font></font>
    Assert.That(person.Type, Is.EqualTo(UserType.Employee));<font></font>
    Assert.That(company.NumberOfEmployees, Is.EqualTo(<span class="hljs-number">1</span>));<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou vous pouvez utiliser mes </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">assertions Fluent</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> préférées </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="cs hljs">[<span class="hljs-meta">Test</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Hiring_a_new_team_member</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">var</span> company = <span class="hljs-keyword">new</span> Company();
    <span class="hljs-keyword">var</span> person = <span class="hljs-keyword">new</span> Person(UserType.Customer);<font></font>
<font></font>
    company.HireNewMember(person);<font></font>
<font></font>
    person.Type.Should().Be(UserType.Employee);<font></font>
    company.NumberOfEmployees.Should().Be(<span class="hljs-number">1</span>);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces instructions sont lues dans un anglais simple - exactement de la manière dont vous souhaitez que tout votre code soit lu. </font><font style="vertical-align: inherit;">Nous, les humains, préférons percevoir les informations sous forme d'histoires. </font><font style="vertical-align: inherit;">Toutes les histoires adhèrent à ce modèle:</font></font><br>
<br>
<pre><code class="plaintext hljs">[] [] [].</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple,</font></font><br>
<br>
<pre><code class="plaintext hljs">  .</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici </font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- le sujet, </font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- l'action et </font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- l'objet. </font><font style="vertical-align: inherit;">Il en va de même pour le code. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette version</font></font><br>
<br>
<pre><code class="cs hljs">company.NumberOfEmployees.Should().Be(<span class="hljs-number">1</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
lit mieux que</font></font><br>
<br>
<pre><code class="cs hljs">Assert.AreEqual(<span class="hljs-number">1</span>, company.NumberOfEmployees);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
précisément parce que l'histoire est retracée ici.</font></font><br>
<blockquote><i>,        .        ,     .</i></blockquote><h3> </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une autre vue des messages d'affirmation est en termes de facilité de diagnostic. En d'autres termes, la simplicité de comprendre la cause d'un échec de test sans examiner le code de ce test. Ceci est utile lors de la lecture des résultats d'un assemblage CI. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D'un point de vue diagnostic, suivez ce guide: si vous pouvez facilement redémarrer le test localement, ce test n'a pas besoin d'un message d'assertion. Cela est vrai pour tous les tests unitaires (car ils ne fonctionnent pas avec des dépendances hors processus), mais dans une moindre mesure pour les tests d'intégration et de bout en bout. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/om/xu/iv/omxuivj5p6pgy71y_yisnf9gl0c.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Test de la pyramide</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Lorsque vous montez plus haut dans la pyramide des tests, vous aurez peut-être besoin d'informations plus détaillées, car les tests d'intégration (et en particulier de bout en bout) sont plus lents et vous ne pourrez peut-être pas les réexécuter à volonté.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais même avec des tests d'intégration et de bout en bout, il existe des moyens de faciliter les diagnostics sans recourir à des messages de confirmation:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Faites du test test un module de comportement - lorsqu'un test vérifie une chose, il est souvent facile de déterminer ce qui a mal tourné. </font><font style="vertical-align: inherit;">(Cela ne s'applique pas toujours aux tests de bout en bout, car vous souhaiterez peut-être que ces tests vérifient comment plusieurs unités de comportement fonctionnent étroitement).</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nommez vos tests unitaires en conséquence</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Le nom de test idéal décrit le comportement de l'application en termes commerciaux afin que même un non-programmeur puisse le comprendre.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et n'oubliez pas que même sans instructions utilisateur, vous avez toujours les messages que l'environnement de test unitaire génère pour vous. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, une erreur dans l'instruction suivante:</font></font><br>
<br>
<pre><code class="cs hljs">person.Type.Should().Be(UserType.Employee);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
donne le message d'erreur suivant:</font></font><br>
<br>
<pre><code class="cs hljs">Xunit.Sdk.EqualException: Assert.Equal() Failure<font></font>
Expected: Employee<font></font>
Actual:   Customer</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La combinaison de ces messages générés par l'environnement et des noms de test lisibles par l'homme rend inutile 90% des messages affirmés par l'utilisateur, même en termes de facilité de diagnostic. </font><font style="vertical-align: inherit;">La seule exception est les longs tests de bout en bout. </font><font style="vertical-align: inherit;">Ils contiennent souvent des vérifications en plusieurs étapes, il est donc judicieux d'utiliser des messages d'assertion supplémentaires pour comprendre laquelle des étapes a échoué. </font><font style="vertical-align: inherit;">Cependant, il ne devrait pas y avoir beaucoup de ces tests de bout en bout. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sûr, afin de tirer parti des messages d'erreur générés par le framework, vous devez éviter les comparaisons booléennes courantes, telles que:</font></font><br>
<br>
<pre><code class="cs hljs">(person.Type == UserType.Employee).Should().BeTrue();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parce qu'ils conduisent au message d'erreur suivant:</font></font><br>
<br>
<pre><code class="cs hljs">Xunit.Sdk.TrueException: Assert.True() Failure<font></font>
Expected: True<font></font>
Actual:   False</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce qui n'aide pas du tout au diagnostic.</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sommaire</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous sentez-vous souvent paresseux lorsqu'il s'agit de rédiger des déclarations? </font><font style="vertical-align: inherit;">Eh bien, maintenant vous pouvez le justifier et envoyer vos collègues à cet article. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ft/yo/-f/ftyo-f1errhnirhqufowrtbn0ee.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Je suis content que cela ait un nom"</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Blagues à part, cependant, voici un résumé:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'utilisation des messages d'assertion comporte deux aspects:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lisibilité du test (à quel point il est facile de comprendre ce que fait le test).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Facilité de diagnostic (à quel point il est facile de comprendre pourquoi le test échoue lors de la construction de CI).</font></font></li>
</ul></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En termes de lisibilité des tests, les messages d'affirmation sont des commentaires de code. </font><font style="vertical-align: inherit;">Au lieu de vous y fier, refactorisez votre test pour atteindre la lisibilité.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En termes de facilité de diagnostic, la meilleure alternative pour affirmer des messages est:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Test d'un module de comportement unique par un test</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tests de dénomination en termes commerciaux</font></font></li>
</ul></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La seule exception est les longs tests de bout en bout.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est tout. </font><font style="vertical-align: inherit;">Vous pouvez en savoir plus sur notre cours lors du </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">webinaire gratuit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui se tiendra aujourd'hui.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr489260/index.html">Comment concevoir un système automatisé à grande échelle pour une grande entreprise en sept étapes</a></li>
<li><a href="../fr489262/index.html">Pourquoi il n'est pas facile de donner aux développeurs la liberté de choix</a></li>
<li><a href="../fr489268/index.html">Mise en œuvre du processus de téléchargement d'un fichier depuis un conteneur avec un navigateur vers un framework de test</a></li>
<li><a href="../fr489270/index.html">WebAuthn dans la vraie vie</a></li>
<li><a href="../fr489272/index.html">Yeux, cerveau, qualité vidéo: réflexions sur 120fps, 8K, HDR, baguettes, cônes et «effet feuilleton»</a></li>
<li><a href="../fr489276/index.html">Test sanguin pour le fer - comment contrôler le niveau, diagnostiquer les raisons pour lesquelles il est important</a></li>
<li><a href="../fr489280/index.html">Envoyez un ping à tous les hôtes IPv6 sur le canal</a></li>
<li><a href="../fr489282/index.html">DirectX 12 - De Léonard de Vinci à l'art contemporain</a></li>
<li><a href="../fr489284/index.html">Mes outils de développement Chrome préférés</a></li>
<li><a href="../fr489286/index.html">Slips, chaussettes et blaireau: anti-cotation des cadeaux le 23 février</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>