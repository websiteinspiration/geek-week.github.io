<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔎 👩🏿‍💻 🥦 BFCache、またはThereおよびback。Yandexレポート ✊🏾 🧕🏾 🤮</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="人々はブラウザーの前のページに戻るボタンを頻繁に使用します-おそらくあなたが思っているよりも頻繁に。もしそうなら、なぜブラウザのメモリからすぐにページをスローし、2番目の時間を費やしてトラフィックを再開したのでしょうか。ユーザーがすぐに戻ることができるように、インターフェースを開発するときに覚えてお...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>BFCache、またはThereおよびback。Yandexレポート</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/496360/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">人々はブラウザーの前のページに戻るボタンを頻繁に使用します-おそらくあなたが思っているよりも頻繁に。</font><font style="vertical-align: inherit;">もしそうなら、なぜブラウザのメモリからすぐにページをスローし、2番目の時間を費やしてトラフィックを再開したのでしょうか。</font><font style="vertical-align: inherit;">ユーザーがすぐに戻ることができるように、インターフェースを開発するときに覚えておくことが重要なBFCacheテクノロジーが発明されました。</font><font style="vertical-align: inherit;">ビクター・ホミャコフ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビクターホミヤコフ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 「往復キャッシュ」を理解し、異なるAPIでBFCache互換性テーブルをコンパイルしました。</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/vz2IsHcSaKE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-こんにちは、私の名前はビクターです。</font><font style="vertical-align: inherit;">私は検索ページを扱うかなり大きなチームの一員として働いています。</font></font><br>
<a name="habracut"></a><br>
<img src="https://habrastorage.org/webt/ai/mc/ut/aimcutfjg_xnumc1xre2li547vw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
少なくとも、Googleで同じまたは同様のページを既に表示している。特に、このページのダウンロード速度の問題に対処します。これにより、ページがサーバー上で可能な限り迅速にレンダリングされ、ダウンロードしてクライアントに可能な限り迅速に表示されます。どうしてそれが重要ですか？クライアントがページが読み込まれるのを待つ時間が少なければ少ないほど、彼が待たずにあなたを離れない可能性は低くなります。そして、クライアントが別の何かに正常に変換される可能性が高いほど、正味のプロモーションスコアは高くなります。つまり、クライアントは、これがすごいクールなページであることを知っている全員に喜んで伝えます-非常に速くロードされ、使用するのに非常に便利です。そして最終的に、より多くのお金を稼ぐことができます。またはあなたの会社、それからそれはあなたに賞を与えるでしょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有名企業の例をいくつか挙げます。グーグルは実験を行った。彼らは意図的に遅延を検索ページに埋め込み、これがパフォーマンスにどのように影響するかを測定しました。ユーザーあたりの検索数は平均して0.5％少ないことがわかりました。半パーセントとは何ですか？計算：Googleの何億人ものユーザーの50％はかなり大きな数です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bingも同じ実験を行いました。彼らはグーグルを信じなかった、彼らは再確認することを決めた。彼らは同様の結果を得ました。ページが遅くなると、ユーザーあたりの収入が著しく少なくなります。なぜ減速するのですか？同じ速度で高速化するよりも、実際のページで正確にミリ秒単位で低速化した方が簡単に再現できるためです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AliExpressの例。サイトを36％高速化し、ユーザーからの注文を大幅に増やしました。注文は直接金です。一般的に、速度が非常に重要であることはすでに誰にとっても明らかであり、特定の数のメトリックを通じて、獲得したお金に影響を与えます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そしてもう一つの要因。今日</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すでに</font><font style="vertical-align: inherit;">画像の最適化</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">について話しました</font></a><font style="vertical-align: inherit;">。トラフィックを最適化し、ダウンロードの数を減らすことにより、発信トラフィックに対してホスティング業者に支払う金額が少なくなります。これはあなたのポケットに残るお金でもあります。制限や条件なしに突然ホストからのトラフィックを10％割引した場合はどうなりますか？また、ページの共有（たとえば、10％）がユーザーによってほぼ瞬時に読み込まれるようにすることを提案した場合、誰も拒否しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今日お話ししようとするテクノロジーは、使用するスタックやテクノロジーにいくつかの制限を課す可能性のあるソリューションの1つですが、同時に、このようなかなりの利益をもたらすと約束しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、Googleはこれらのブラウザがブラウザでどのように使用されているかに関する統計を収集します。そして、彼らはそのような数を発表しました：それは、平均して、すべてのページの開き、モバイルChromeのすべてのナビゲーションの中で、約19％がストーリーの前後の動きであることがわかります。どういう意味だと思いますか？丸めた場合、ナビゲーションの20％がユーザーが移動したページに移動していることがわかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちにとって、ページの作成者と同様に、これは次のことを意味します。つまり、ユーザーがページを離れたとしても、ユーザーが戻って来る可能性はかなりあります。一方で、これはまさに携帯電話の問題である可能性があります。すべてが小さく、指を見落とし、リンクをクリックしてページを離れるのは簡単です。帰りたい」しかし、デスクトップでも状況はほぼ同じです。数値は少なくなりますが、それでもかなりの割合の収益があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在、私たちは何をしていますか？ユーザーの時間とトラフィックに無駄に費やしています。つまり、同じページを再度読み込み、解析し、DOMを再作成し、画面上のすべてを再描画し、JavaScriptをロードして実行します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ブラウザはかなり強力なものです。彼は可能な限りキャッシュを使用しようとしています。そして、ほとんどのリソースは彼のキャッシュにあるかもしれません。ネットワークからそれらを待つことはありませんが、キャッシュから直接取得します。たとえば、V8エンジンでは、JavaScriptの解析結果もキャッシュされます。つまり、ブラウザはJSを再ロードおよび解析せず、ほとんどの場合、すぐに実行します。しかし、それでも、DOMの再構築、キャッシュされていないリソースの再読み込み、JSの実行にはかなりの時間がかかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
解決策はそれ自体を示唆しています。何してるの？ユーザーがページを離れても、すぐにはクリーンアップしません。その状態を保存してユーザーから視覚的に隠すだけで、内部的にはブラウザの自由に使用できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユーザーが戻ることにした場合はどうしますか？</font><font style="vertical-align: inherit;">保存した同じページを彼に見せてください。</font><font style="vertical-align: inherit;">ほとんど瞬時に表示できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ax/xm/7d/axxm7doualef_atc2j8_ufybr2i.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このテクノロジーは、「前後」という言葉から、バック/フォワードキャッシュと呼ばれます。</font><font style="vertical-align: inherit;">bfcacheの略。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下は、bfcacheがオフおよびオンの場合に、同じブラウザ、同じアセンブリがどのように動作するかの例です。</font><font style="vertical-align: inherit;">最初のページを開くのは、あちこちで等しく遅くなります。</font><font style="vertical-align: inherit;">さらに、ストーリーを前後に移動し始めると、左側に一時停止が目立ち、右側には一時停止がありません。</font><font style="vertical-align: inherit;">左側では、通常の履歴の移動にはかなりの時間がかかります。</font><font style="vertical-align: inherit;">右側では、すべてが非常に速く行われます。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GIFを表示</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/webt/lf/0n/h1/lf0nh1gnji5qf1w9kj_irqcagrm.gif" width="350"><img src="https://habrastorage.org/webt/og/ca/_n/ogca_ny6xmytv-_iqvdl4xslpcq.gif" width="350"></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
検索からの同様の例。左側はmacOS上の通常のSafariで、bfcacheが無効になっています。右側は同じSafariで、デフォルト設定とbfcacheが有効になっています。これはかなり一般的なケースです。人が検索に来て、探しているものが正確にわからない場合や、いくつかのクエリオプションを要求する場合があります。私は最初の要求を尋ねました-何かが正しくありません。 2番目のリクエストの方が良いようです。 3番目-いいえ、さらに悪いことに、前のリクエストに戻ります。そして今のところ、彼を待たせないのはとても良いことです。彼はこの前のリクエストを見ただけで、すぐにそれを示します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
または、ページネーションがあり、問題についていくつかのページがある場合は、2番目のオプション。問題をめくる男。私は2、3、4ページ目に行って見ました-いいえ、何か問題があります。戻ってきます。また、前のページをほぼ瞬時に表示できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要な問題はセキュリティです。ユーザーが非表示になっていないページは、電話やコンピューターのハードウェアステータスを読み取るためのさまざまなAPIにアクセスできます。すぐに頭に浮かんだことの簡単なリストは次のとおりです。ジオロケーション、デバイスの空間での位置の変更、カメラへのアクセス、マイクからの音。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、ページが表示されたときに、非表示になっている間に発生したすべてのイベントにアクセスできないことが重要です。</font><font style="vertical-align: inherit;">それ以外の場合は、ユーザーをスパイするための追加のチャネルが開きます。</font><font style="vertical-align: inherit;">彼女がこの間ずっとあなたの動きの履歴とマイクとカメラの録音の履歴を取得しないことが重要です。</font><font style="vertical-align: inherit;">ブラウザ開発者もこれを忘れてはなりません。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIとブラウザーのサポート</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
トピックにより近い。私がすでにあなたを説得したとしましょう、あなたはそうです：「はい、良い話題です、私たちはこれで働かなければなりません。」どのAPIを自由に使用できるか、bfcacheを考慮に入れることに同意した場合、どのAPIを使用できますか？これはブラウザーによってどのようにサポートされますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bfcacheはすでにどこにありますか、どこで確認できますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-これは、ブラウザーのFirefox、Safari（およびmacOS、iOS）、およびInternet Explorer 11（！）に長い間実装されています。通常、マイクロソフトの開発者を叱りますが、ここでは彼らが試したところです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-UCブラウザー11/12、Android版のブラウザーに実装されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-突然、彼はChromeに参加しなくなりました。また、Chromiumではこの機能は開発中です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_v/dh/yq/_vdhyq6ph84lnnb05f2ffw75ud4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、Chromiumでこれを行うと、これらのブラウザのほとんどすべて（これは完全なリストではありません）が遅かれ早かれこの機能を取得します-SMSと登録なしで無料で。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
なんらかのAPIはありますか？私はbfcacheを管理したいのですが、JavaScriptから直接オン/オフを切り替えて、bfcacheにページがあるかどうかを確認します。そのようなAPIはどうですか？そのようなAPIはありません。そして、これは意識的に行われました：ページはbfcacheをオンにしたりオフにしたりすべきではありません。または、このbfcacheに誰かがいるかどうかを調べます。これはすべてセキュリティによるものです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/4m/5i/ra/4m5iragmxqrikl_7i8dqp-0ijcy.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スライドからリンク</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、何がありますか？ナビゲーションのタイプ。リンクのタイプがあります-事前にページをレンダリングしたい場合、リンクのプリレンダーです。彼には特別なタイプのナビゲーションがあります。このページはNavigationType“ prerender”で開かれます。ブラウザでページを開くだけの場合は、「ナビゲート」があります。 「更新」ボタンをクリックすると、「再読み込み」になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは「back_forward」ナビゲーションタイプに関心があります。これは、ユーザーがストーリーを前後に移動したことを明確に示しています。これは、bfcacheで使用できるナビゲーションのタイプです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ud/8o/o_/ud8oo_rhzpnyzjfdymvr11pfg4i.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別のAPIは、pageshow pagehideイベントです。彼らはすでにブラウザに存在していました。したがって、ページがブラウザでユーザーに表示されたときにpageshowがトリガーされ、何らかの理由でページが非表示になっているときにpagehideがトリガーされます。そして、それらは永続的なフィールドによって補足されました。ページが非表示であり、同時にbfcacheに配置される場合、persistedフィールドはtrueになります。 bfcacheからページを上げるときにページが表示される場合、永続化フィールドは再びtrueになります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、ブラウザがページをキャッシュしない場合、pagehideはfalseのままになります。また、ブラウザが通常の読み込み中にページを表示する場合、またはbfcacheを使用しない場合、pageshowもfalseのままになります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7v/kh/kh/7vkhkhw8tjkz6y10o97urigdhea.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スライドからリンク</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
イベントのサポートは、ほとんどすべてのブラウザーで使用できます。まだbfcacheをサポートしていないブラウザーでも使用できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/om/6w/7h/om6w7hjxxswbq5uvpaiu-afe5to.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スライドからのリンク</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
永続フィールドについても同様です。これはすでにChromeに存在し、Chromeはまだbfcacheをサポートしていません。つまり、このフィールドは常にその中にありますが、今のところはfalseです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この現象bfcacheに出くわしたとき、私はそれを研究し、すべての側面をタップして、それがどのように機能するかを観察する必要がありました。ハンドラーの永続化フィールドの値が何であるかを開くと、すぐにページを確認したいと思いました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dx/k6/qe/dxk6qegw2k1ohv-osipeghzjccw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてが非常に単純なようです。ハンドラーを作成し、何が来るかをconsole.log（）に出力しました。ただし、一部のブラウザーでDevToolsを開くと、bfcacheが突然シャットダウンする場合があります。つまり、DevToolsを開いて、ページ間を行き来しましたが、永続化は常にfalseであり、ページはbfcacheに入りません。さて、私は別の強力なツールを持っています-警告。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、違います。最新のブラウザは、ページ非表示でページをアンロードするときに、beforeunloadハンドラとunloadハンドラがアラートを無視するだけで、そこで機能しません。繰り返しになりますが、私は何が欲しいのかわかりません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/by/1b/ij/by1bijibkuzglk6vvkhbcvrmmgo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さて、私はさらにキラー製品を持っています。私は自分のページのすぐ右のブロックにいます。これは、イベントのコンテンツのテキストを追加するだけで、すべてをログに記録しています。この方法はうまくいきました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jw/xt/o1/jwxto1ndmuldxtn4hpoa_3z6-bk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべて使用できます。私は自分のコードをデバッグしました、それは私のために機能します、私はそれを続けることができます。もちろん、忘れてはならないのは、ページに同じインラインコードを読み込まずにファイルキャッシュを使用するために、外部静的スクリプトの方が適していることです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このデバッグしたコードを外部スクリプトに入れました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/x1/5m/s0/x15ms0a9q4solt69-vucvdyoqgu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、いいえ、pageshow pagehideハンドラーはSafariで落ちました！何らかの理由で、外部スクリプトからは機能しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さて、私はすでに作業バージョンを持っています。そのままにしておかなければならなかった。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/td/kq/aw/tdkqawklgz4m_mdw7d_elw7a27m.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たった1日で何とかやってきたことを簡単にリストします。まず、DevToolsはキャッシュを無効にできます。 Chromeの[ネットワーク]タブのDevToolsに、[キャッシュを無効にする]チェックボックスがあることを覚えているでしょう。ネットワークキャッシュを無効にします。bfcacheに影響を与えない場合や、影響を与える場合があります。類推は明らかです。私たちはDevToolsを開きました。これは、開発中であり、キャッシュを必要としない可能性があることを意味します。多分それは私たちを悩ませます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/4d/up/mb/4dupmbrpcewpmpngg49_fddhuf4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目の機能はアラートです。 FirefoxとSafariは警告を表示せずにそれを無視し、ハンドラをさらに実行し続けます。そして、コンソールの1つの古き良きChromeだけが赤でエラーを書き込みます-警告があります、私はそれをブロックしました、それについて知っています！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでも、Safariの外部スクリプトからのハンドラーが呼び出されない可能性があることを思い出させます。これは非常に奇妙です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そしてもう一つの重要なニュース。</font><font style="vertical-align: inherit;">ページがキャッシュされている場合、つまり、pagehideイベントを受け取り、それが永続化trueと表示され、ブラウザに「はい、キャッシュに入れました」と通知された場合、これはページが後になることを保証するものではありませんこのキャッシュから生成され、ユーザーに表示されます。</font><font style="vertical-align: inherit;">ブラウザがメモリ不足になった場合、このキャッシュをクリアすることを決定する可能性があるためです。</font><font style="vertical-align: inherit;">ユーザーはブラウザを閉じて、どこにも移動できないからです。</font><font style="vertical-align: inherit;">これを覚えて。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実装機能</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はドキュメントをさらに掘り下げ、この知識をいかに活かせるかを研究し始めました。驚いたことに、ドキュメントはそうでした。つまり、ブラウザーでbfcacheがどのように機能するかの説明をインターネットで掘り下げることができます。しかし、私がさらに読むと、異なるブラウザー間でより多くの違いが蓄積されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1つはこのように機能し、もう1つは機能します。一方では、一方が干渉し、もう一方は干渉しません。開発者は、ページをbfcacheに配置するときに、いくつかのAPIを正しく処理する方法を知りません。彼らが言う：わかりました、ページがこのAPIを使用する場合、私はそれを単に無視し、いかなる状況でも決してキャッシュに入れません。そして、このリストはブラウザごとに異なり、それぞれが適切に機能します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、私は学んだことを1つのテーブルにまとめ始めました。私は次のようなものを得ました：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/9v/qm/iy/9vqmiyq_zcjwc5ln8nciv8golra.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ブラウザのドキュメントを読みました-Firefox、Safari、Chromiumファミリ。古くなっていますが、IEには利用可能なドキュメントがありました。私たちプログラマーは、ブラウザーの変更後にドキュメントを更新したくないのですか？情報が古くなっていることに気付いたとき、私はブラウザーで小さなページをテストし、どのAPIが機能し、どれが機能しないかを確認し始めました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これも十分ではありませんでした。原則としてどのAPIを調べるべきかわかりませんが、すべてを並べ替えるのはまったく不可能ですか？また、ブラウザーエンジン自体のソースコードを調べる必要がありました。つまり、コードは最も正確で信頼できる知識のソースであることが判明しました。現時点では、このプレート（目の前にあるのは一部ですが、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に完全版への</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">リンク</font></a><font style="vertical-align: inherit;">があります）は、ブラウザーでbfcacheが機能することを許可または禁止するAPIに関する最も包括的な知識の集まりです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
チェックマークと緑色を妨げないAPI、ページがbfcacheに入るのを確実に妨げるAPIは、赤色でマークされています。</font><font style="vertical-align: inherit;">白いフィールドは、どこにも記載されていないスペースです。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Firefox</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
特定のブラウザからのいくつかの興味深い詳細はここにあります。私はFirefoxから始めます、彼はそれをすべてする最初の人でした。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fh/bt/fh/fhbtfhn8db-lqcxhqe8n8vm8z6u.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スライドからのリンク</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
私がFirefoxのソースから学んだ最も重要なことは、bfcacheを操作すると、ページをキャッシュに入れられない理由をすべてディスク上のテキストログに書き込むことができるということです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dd/xp/jr/ddxpjraedcefaftwi0u9cdys2tg.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スライドからのリンク</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
そして、私はそれをどうやって行うかを見つけることもできました。秘密の環境変数は2つあります。1つはログに記録する内容、もう1つはログに書き込むファイルに指定します。その後、バイナリを起動し、出来上がり！ほぼ前のスライドで、「このようなhtmlは、別の理由などの理由でキャッシュできません」というフォームの行がほぼ表示されます。すぐに読むことができ、とても便利です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ci/_u/3m/ci_u3mrg5k5um_zah0gtm7splmy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一度実験したい場合は、Firefoxでabout：ネットワーキングページを開くことができます。そこで、「ジャーナル」セクションに同じフィールドを入力できます。ログの内容と場所を2つのフィールドで示し、ボタンでログの開始と停止を指定できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/w3/8s/zb/w38szbgmjgikrkqg-2f7tt6px0a.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スライドからのリンク</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Firefoxがページのキャッシュを拒否するのはいつですか？ AJAXリクエストや画像などのリソースのリクエストを含む不完全なリクエストがある場合、彼はページをbfcacheに置くことを拒否します。彼はそれが完了していない、ダウンロードが完了していない、何らかの疑わしい活動があると考えています。しかし、これはすべてファビコンには当てはまりません。ファビコンを忘れた場合、読み込まれなくても大丈夫だと思います。ファビコンはそれを実行します。これはサイトにとっては正常なことです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実行時間の長いスクリプトを使用している場合、ブラウザは次のように質問します。時間がかかるため、UIをブロックします。そして、あなたが同意した場合、そのようなページは少し間違っていると見なされ、キャッシュされません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IndexedDBを使用する場合...これは有益な話です。以前、最初の実装では、それらは見えました：IndexedDBがあり、不完全なトランザクションがある場合、そのようなページはキャッシュされません。しかし、その後、リファクタリング中にこのコードを失っただけです。そして、ご想像のとおり、彼らにはこれに対するテストがありませんでした。彼らはバグトラッカーにバグさえ持っています。彼はすでに何かを持って2歳です。 「IndexedDBを使用したbfcacheが正しく機能しません。どうすればよいですか？」 Firefox開発者は答えました-それは本当に壊れています、リファクタリング中にこのテキストの一部を失っただけです。モラル：Firefoxを書いても、テストを書いてください。そうでなければ、すべてが悲しいことに終わる可能性があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、bfcacheの非可用性のもう1つの興味深い要素-混合コンテンツが明示的に許可されている場合。それは何ですか？</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fm/2s/le/fm2sleys4nir1cuff_lw8q87cqi.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スライドからのリンク</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ページがHTTPS経由で開いているものの、HTTP経由で一部のリソース、特にスクリプトをロードしているとします。つまり、セキュリティ以外のスクリプトがあり、誰でも変更できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ts/k8/kj/tsk8kj6weynueewx9goi38sm81o.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スライドからのリンク</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
デフォルトでは、Firefoxは他のブラウザーと同様に、現在、このような非セキュリティスクリプトを実行していません。しかし、それがあなたにとって非常に重要な場合は、設定にアクセスして実行を許可すると、そのようなページはキャッシュされません。彼は言うでしょう-まあ、あなたは私にコードを実行しないように言いました、しかしいいえ、いいえ！</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pm/fg/_f/pmfg_fqywdhl7tihvcy09agmaxy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もう1つの調整は、bfcache自体のサイズです。ここでは、デフォルトはマイナス1です。これは、Firefoxがどれだけのメモリを持っているか、つまりキャッシュしようとするページが多いことを意味します。ただし、ゼロを設定するか、数値を明示的に設定することで、キャッシュを強制的に無効にすることができます。たとえば、覚えているのは5ページまでです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
警告：次のスライドには恐ろしいC ++言語のサンプルコードが含まれています。これはフロントエンドの会議では危険な場合があります。それをコピーしようとせず、ブラウザコンソールで実行してください。ディスクがフォーマットされたり、画面が爆発したり、ビットコインが採掘されたりする場合があります。警告しました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/31/l-/uo/31l-uokshfiuo6dyxcivmfzsm5o.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スライドからリンク</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、Geckoコードです。</font><font style="vertical-align: inherit;">インターネットで無料で開いたり、読んだり、閲覧したりできます。</font><font style="vertical-align: inherit;">そして、私はうろたえました。</font><font style="vertical-align: inherit;">最も重要な方法があります-CanSavePresentation（）、それは質問に答えます：このドキュメントをキャッシュすることは可能ですか？</font><font style="vertical-align: inherit;">つまり、これは現在Firefoxに実装されているものに関する究極の真実の源です。</font><font style="vertical-align: inherit;">それでも、そこから、ログを読み取れることがわかりました。</font><font style="vertical-align: inherit;">そのような変数があります-gPageCacheLog。</font><font style="vertical-align: inherit;">これは、すべてが書き込まれるログです。</font><font style="vertical-align: inherit;">これは、C ++へのエクスカーションについての興味深い話です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、リンクを開いてコードを確認し、検索して（便利で、しかもクイック検索があり）、ブラウザの最新バージョンで実際の実装の詳細を見つけることができます。ドキュメントに欠けているものだけです。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サファリ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ページがbfcacheに到達したときにSafariが行う最も残酷なこと：保留中のAJAXリクエストがある場合、Safariはそれらを強制終了します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vp/bh/8p/vpbh8ppqy9qpfbpljjsu2huhtda.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エラーハンドラーでそれらをオーバーレイし、すべてをチェックしようとした場合でも、それを修正します。つまり、原理がまったくないかのように要求を修正します。 bfcacheから回復した後は、エラー、「OK」、何も起こりません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ic/jx/yk/icjxykful4yo0d7hbjopj_woljo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私が言ったように、Safariのpageshow pagehideのハンドラーは、ページにインライン化されているスクリプトで記述されている場合にのみ呼び出されます。外部スクリプトから、それらは機能する場合と機能しない場合があります-どれほど幸運か。しかし、私はあなたに警告しました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0i/o7/ns/0io7nsvts4isj0qbirjisggubeg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もう1つの興味深い違い：beforeunloadおよびunloadハンドラーは、ページがbfcacheに入るのを妨げません。この場合、beforeunloadは常に呼び出され、キャッシュに入れられたとき、ヒットされなかったときに呼び出されます。ただし、ページがキャッシュにヒットしたときにアンロードは呼び出されません。そしてここに別のレーキがあります：ページがキャッシュに移動してそこから表示されない可能性があります。また、アンロードで重要なコードを記述した場合、ページで単一のエラーは発生していませんが、呼び出されない場合があります。つまり、キャッシュに正しく移動し、キャッシュからどこにも移動せず、アンロードが呼び出されることはありません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6e/m2/xy/6em2xyin9409en33_y-xk3ewxtg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別の興味深い点。ご存知のとおり、window.open（）を使用して複数のウィンドウを開くことができます。同時に、これらのウィンドウは相互にリンクしています。つまり、お互いのウィンドウに同時に入り、異なるプロパティを読み書きできます。この子ウィンドウのオープンは、bfcacheに干渉しません。そしてここでは、おそらく、SafariはAJAXリクエストと同じくらい残酷です。つまり、すべてがひどく破れ、さようならです。アップルの開発者はそれをもっと強く愛しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もう一度分C ++！ WebKitのソースも秘密ではありません。また、開いたり、読んだり、調査したりすることもできます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/a4/p5/cs/a4p5cs2yfjtvgxb_3iud8b-xog4.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スライドからのリンク</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
これらはGitHubにあります。2つの重要な機能を強調表示しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-canCacheFrame（）-このフレームをキャッシュできるかどうかを確認します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-HTML要素やフォントなど、ページ上の別のオブジェクトには、canSuspendForDocumentSuspension（）メソッドがあります。このオブジェクトは、キャッシュできるか、フリーズできるかどうかを担当します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そしてもう1つの重要な側面：WebKitには非常に便利なテストがあります。そこで、LayoutTests / fast / historyフォルダー内に、小さくてコンパクトな簡潔なhtmlの形式で、bfcacheを使用してSafariに実装されているさまざまなAPIの作業のテストがあります。これは、これらのAPIを使用してSafariでコードを作成する方法と、それらがbfcacheヒットを許可するかどうかに影響するかどうかに影響を与える生きている例です。見ていてとても面白い。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hx/r-/un/hxr-un8ehvr-zc5dqa_kgr4ieki.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そこから、Safariはbfcacheに関するすべての知識、すべての機能もテキストログに書き込むことを学びました。</font><font style="vertical-align: inherit;">しかし、残念ながら、このログを有効にする方法、または有効になっている場合は、ディスク上のこのファイルの場所を知りませんでした。</font><font style="vertical-align: inherit;">誰かが知っているなら、教えてください、私はとても感謝します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クロム。</font></font></h3><br>
<img src="https://habrastorage.org/webt/8z/yv/b5/8zyvb5feibkmt6njztlfuxgipas.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すでに述べたように、作業はまだ進行中であり、すべてが旗の下で閉鎖されています。新しいChrome Canaryをダウンロードして、フラグに移動できます。設定はそこに隠されています-あなたはそれで遊んでみることができます。何か見えるかもしれません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nu/fr/lw/nufrlwudx02dcxcxuwq0n-fk57e.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おもしろいから-window.open（）でページを開くことについてはすでに話しました。 Chromiumでは、そのようなページはこれまでキャッシュされていません。サファリのように、彼らはこれらすべてを正しく解決する方法を理解せず、恥知らずにそれを切り落としました、彼らの良心は彼らを許可しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DOMContentLoadedが発生しない場合、ページもキャッシュされません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「Web」で始まる新しいAPIはたくさんあります。また、それらは難しく、理解しにくいため、これまでのところ、すべてのAPIがデフォルトでbfcacheをオフにしています。つまり、WebGL、WebVR、WebUSB、WebBluetoothなど、流行の新しいものがページで使用されている場合、そのようなページはbfcacheに入れられません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービスワーカー。また、そのようなページはまだキャッシュしていませんが、正しく処理して、サービスワーカーの警戒心から見えないようにする予定です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
位置情報が有効になっている場合は、まだキャッシュしません。今のところとてもシンプルです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ページがキャッシュ内にあったときにCookieが腐っていた場合、何らかの承認が期限切れになったと考えられます。多分それはオンラインバンキングか何かでした。これは、ページが無効であることを意味します-キャッシュから消去します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ae/et/dj/aeetdjeogvqqqmflxx5rtdbtz1o.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スライドからリンク</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グーグルたちはさらに進んだ。</font><font style="vertical-align: inherit;">彼らは、すべてを統一すること、すべてのブラウザーで統一すること、すべての状態のページライフサイクル仕様を提案すること、異なる状態間の遷移に新しいイベントを追加することを提案することを提案しました。</font><font style="vertical-align: inherit;">あなたは彼らがそこで考えたリンクを見ることができます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bl/nn/tw/blnntwl767kxalazcyls6lhx98c.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スライドからリンク</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ソース。</font><font style="vertical-align: inherit;">ご存知のように、Chromiumソースも利用できます。</font><font style="vertical-align: inherit;">これはすべて、BackForwardCacheImplと呼ばれるクラスにあります-非常に優れたネーミングで、ほとんど見る必要はありませんでした。</font><font style="vertical-align: inherit;">ドキュメントを保存できるかどうかを確認するメインメソッドは、CanStoreDocument（）と呼ばれます。</font><font style="vertical-align: inherit;">GetDisallowedFeatures（）メソッドもあり、bfcacheでサポートされていないすべての新機能とAPIを一覧表示します。</font><font style="vertical-align: inherit;">非常に便利：1つの場所に集中し、現在可能なことと使用できないことを読んで理解しました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Internet Explorer 11</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まだIE 11を持っている人のための歴史への遠足。すべてが悪い人のため。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hw/st/sy/hwstsylp95mjeehn-yapop5nwqy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そこにはbfcacheがあり、対処する必要があるため、これが主な問題です。</font><font style="vertical-align: inherit;">ドキュメントによれば、bfcacheはおそらくHTTPでのみ機能するということです。</font><font style="vertical-align: inherit;">実際、本番環境では、何らかの理由でHTTPSでも動作します。</font><font style="vertical-align: inherit;">教訓：開発者の方は、ドキュメントに注意してください。</font><font style="vertical-align: inherit;">その後、あなたは彼女のために苦しむ必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
beforeunloadハンドラーがある場合、それはキャッシュに入るのを防ぎます。</font><font style="vertical-align: inherit;">彼らはドキュメントでアンロードについて何も言わなかった-おそらく彼らはそれについて知らなかったか、忘れていた。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ページの読み込みが完了していない場合も、キャッシュされません。</font><font style="vertical-align: inherit;">ActiveXコンポーネントを使用している場合、キャッシュも行いません。</font><font style="vertical-align: inherit;">また、DevToolsが開いている場合も同様です。</font><font style="vertical-align: inherit;">これは重要なポイントです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8o/lh/n5/8olhn5ii0fctbxehrs7ab4blwro.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どのようにバグなし？持続フィールドを追加しましたが、機能しない場合があります。つまり、ページは実際にキャッシュに入り、キャッシュから返され、永続化はtrueに設定されていません。何をすべきか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
キャッシュから戻ったかサーバーからリロードしたかを判断する美しいコードがありました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/op/h1/xb/oph1xbddsxbkhzjlygiyoavtmam.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今それはIEのために松葉杖で補足されなければなりませんでした。私たちはIEを使用していると判断し、一部の回避策では、ページがキャッシュから抽出されたと同時に履歴ナビゲーション（back_forward）があったことを理解しています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ct/xe/af/ctxeafrbbmwt1h_9j16jw4fviji.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、ページがキャッシュされているかどうかはどのようにしてわかりますか？私たちは彼女のロード時間を取ります。 50ミリ秒以上でサーバーからロードされた場合、これは基本的にIEにはありません-キャッシュからのものであることを意味します！ :)</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j-/ib/ch/j-ibchnxog-rdmeez6gmjnbmwr4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
歴史のナビゲーションについてはすでに述べました。</font><font style="vertical-align: inherit;">back_forwardナビゲーションタイプがある場合は、履歴を調べ、ページがキャッシュからのものである場合はbfcacheを意味します。IEには他のオプションはありません。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次は何ですか？</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この知識で次に何をすべきか？</font><font style="vertical-align: inherit;">私はあなたが外に出て、悪夢のようにこれらすべてを忘れてほしくありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-最初に、ここで私が遭遇した最も価値のあることと私があなたに押し付けたいことです：オープンソースブラウザを使用してください！</font><font style="vertical-align: inherit;">現在、インターネットへのオープンアクセスには、お客様が使用するすべての主要なブラウザーのソースコードがあります。</font><font style="vertical-align: inherit;">そして、これは、それがどのようにどのようにサポートされるか、どこでどのように機能するかに関する最も関連性の高いドキュメントです。</font><font style="vertical-align: inherit;">HTMLやJSで直接書かれたテストがあります。</font><font style="vertical-align: inherit;">使ってみて！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-次に、既存のアプリケーションでbfcacheに実行できることを考慮します。</font><font style="vertical-align: inherit;">テスターに​​このことを伝えて、ナビゲーションを確認するときに、履歴をナビゲートするときに、サーバーとbfcacheの両方からページを開くことができるようにします。</font><font style="vertical-align: inherit;">これは、bfcacheが機能したときに修正した実際のバグのビデオです。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GIFを開く</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/webt/vx/1j/dv/vx1jdv4ubukownlagrvftn30g6k.gif" width="400"></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユーザーが4つのリクエストを入力すると、4つの問題が表示されます。</font><font style="vertical-align: inherit;">その後、戻ると、問題3とクエリ4が表示されます。別の以前の問題は2とクエリ3です。つまり、ページの状態が一致していません。検索の内容と検索文字列は互いに矛盾しています。</font><font style="vertical-align: inherit;">アプリケーションでこれを覚えておいてください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-そして3番目に、新しいコードを作成する場合は、bfcacheが必要かどうかを検討します。</font><font style="vertical-align: inherit;">その場合は、API互換性テーブルを使用してください。</font><font style="vertical-align: inherit;">そうでない場合は使用しないでください。ただし、誤ってbfcacheにアクセスした場合は、Safariやその他のブラウザの機能を検討してください。</font><font style="vertical-align: inherit;">一部の事柄は無礼に引き裂く可能性があり、これが発生する理由を理解することはできません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
約束通り</font><font style="vertical-align: inherit;">、資料への</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リンク</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja496348/index.html">Web Storage APIのケーススタディ</a></li>
<li><a href="../ja496350/index.html">通ることならず！-3Dプリンターがコロナウイルスに対応</a></li>
<li><a href="../ja496354/index.html">三元コンピュータープログラミング：エミュレーターで遊ぶ</a></li>
<li><a href="../ja496356/index.html">拡張現実技術と機械学習手法を使用してナビゲーターを作成する</a></li>
<li><a href="../ja496358/index.html">Cosmonautics Dayをオンラインで祝う準備をする（リストは更新中）</a></li>
<li><a href="../ja496362/index.html">マスクのリセット</a></li>
<li><a href="../ja496366/index.html">Miniseries：日曜大工の三元コンピュータ</a></li>
<li><a href="../ja496368/index.html">オーストラリアのスタートアップが電子および生物学的コンポーネントからハイブリッドPCを開発</a></li>
<li><a href="../ja496370/index.html">Cでの勝利の喜びと悲しみ：HaskellでプロトタイプWCからキャンディーを作る</a></li>
<li><a href="../ja496372/index.html">JavaScriptで使用するアラート（）、確認（）、プロンプト（）のカスタムビューを作成する方法</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>