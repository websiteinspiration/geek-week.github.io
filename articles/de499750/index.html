<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💱 🔛 🕕 So scannen Sie das gesamte Internet 🤸🏿 👰🏾 ➖</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Der gesamte Bereich der IPv4-Adressen umfasst 4 Milliarden IP-Adressen. Dies scheint eine große Zahl zu sein, aber das gesamte IPv4-Internet kann in 4...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>So scannen Sie das gesamte Internet</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vdsina/blog/499750/"><img src="https://habrastorage.org/webt/el/co/px/elcopxpoohabrp6fvgfwqu5rdgu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der gesamte Bereich der IPv4-Adressen umfasst 4 Milliarden IP-Adressen. Dies scheint eine große Zahl zu sein, aber das gesamte IPv4-Internet kann </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in 40 Minuten</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vollständig nach einem TCP-Port durchsucht werden </font><font style="vertical-align: inherit;">, um beispielsweise alle Webserver der Welt oder alle offenen SSH-Ports zu finden. In diesem Fall reichen ein Server und ein Gigabit-Kanal aus. Dies ist beispielsweise für die Forschung nützlich, wenn Sie Statistiken zu den weltweit verwendeten Technologien sammeln oder den Prozentsatz an anfälligen Diensten schätzen, die nach außen offen sind. </font><b><font style="vertical-align: inherit;">Zmap-</font></b></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Programm</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(nicht zu verwechseln mit nmap) ermöglicht es Ihnen, große Netzwerkbereiche aufgrund der speziellen Architektur viel schneller als jeder andere Scanner zu scannen. </font><font style="vertical-align: inherit;">In diesem Artikel sehen wir uns ein Beispiel an, wie Sie mit zmap eine Liste aller Webserver der Welt erstellen. </font><font style="vertical-align: inherit;">Mit einer Liste von Hosts mit offenem HTTP-Port können Sie bereits einen intelligenteren Scanner verwenden und ihm eine genaue Liste von Zielen übergeben.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was ist schlecht nmap</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zum Scannen kleiner Subnetze wird traditionell Nmap verwendet - ein beliebtes Open-Source-Multitool mit vielen Pentester-Brötchen. Es eignet sich gut zum Scannen kleiner Bereiche und selektiver Hosts. Nmap hat eine eigene Engine zum Schreiben von benutzerdefinierten Skripten in Lua (Nmap Script Engine) und viele coole vorgefertigte Skripte. Nmap eignet sich jedoch nicht zum Scannen großer Netzwerke wie Millionen oder sogar Milliarden von Adressen. Solche Aufgaben dauern mehrere Tage oder sogar Wochen. Tatsache ist, dass nmap das Netzwerksubsystem des Betriebssystems verwendet und für jede Anforderung ein vollständiger Socket geöffnet wird. Sie können für eine vollständige TCP-Verbindung nicht darauf verzichten, wenn Sie mit dem Dienst chatten müssen, z. B. eine GET-Anforderung an einen Webserver senden müssen. Dies verringert jedoch die Leistung erheblich, wenn ein schnelles SYN-Scannen erforderlich ist.wo die Aufgabe nur ist herauszufinden, ob der Port offen ist.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zmap und Masscan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Asynchrone Zmap- und Masscan-Scanner eignen sich besser für uns: Beide arbeiten viel schneller, verwenden den </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PF_RING-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Treiber </font><font style="vertical-align: inherit;">(einen Socket, der </font><font style="vertical-align: inherit;">die </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Paketerfassung</font></a><font style="vertical-align: inherit;"> erheblich beschleunigt) und randomisieren Adressen, um ein tödliches DoS zu vermeiden. </font><font style="vertical-align: inherit;">Im Gegensatz zu Nmap verwenden sie kein System-TCP / IP: Das erste generiert nackte Ethernet-Frames, das zweite verwendet einen selbstgeschriebenen TCP-Stack.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Masscan gilt als der schnellste Internet-Scanner, der in sechs Minuten den gesamten IPv4-Bereich durchlaufen kann, aber nur mit wenigen parallel geschalteten physischen Adaptern wird ausgehender Datenverkehr mit SYN-Paketen von einem generiert und Antworten kommen zum anderen. Unter den Bedingungen einer einzelnen Verbindung war die modifizierte Zmap fast eineinhalb Mal schneller. Diese Rekorde wurden natürlich auf 10-Gbit / s-Kanälen auf das oberste Eisen gesetzt, und es wird schwierig und teuer sein, sie selbst zu wiederholen. Bei einer viel günstigeren Gigabit-Verbindung arbeitet Zmap aufgrund der effizienteren Nutzung der Kanal- und CPU-Ressourcen auch schneller als Masscan und kann in etwa 45 bis 50 Minuten abgeschlossen werden. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ge/fz/jb/gefzjbxxkce6p47gclddui5o-1e.png"><br>
<font color="999999"><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vereinfachter Workflow von Zmap und Masscan. Der Generator für ausgehenden Verkehr und der Prozessor für eingehende Antworten arbeiten separat</font></font></sup></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ohne auf technische Details einzugehen, verwenden Zmap und Masscan zwei Entitäten: einen Generator für ausgehenden Datenverkehr mit SYN-Anforderungen und einen separaten Prozessor für eingehende Antworten. </font><font style="vertical-align: inherit;">Die Leistung ist hier nur durch die Kanalbreite und die Leistung der Netzwerkschnittstelle begrenzt, nämlich das PPS-Limit (Pakete pro Sekunde). </font><font style="vertical-align: inherit;">Daher kann der Scanvorgang in mehrere Schnittstellen oder sogar mehrere physische Hosts unterteilt werden, wenn es möglich ist, die Quell-IP durch die Adresse des eingehenden Pakethandlers zu ersetzen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scan Prep</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist zu beachten, dass der Scanner das System und insbesondere die Netzwerkschnittstellen unter Verwendung des gesamten verfügbaren Kanals lädt. Wenn Sie mit dem Scannen beginnen, ohne den Host zu warnen, sieht es wie DDoS aus und Sie werden höchstwahrscheinlich sehr schnell vom Netzwerk getrennt. Sie müssen auch darauf vorbereitet sein, dass das Scannen des gesamten Internets eine Reaktion hervorruft - sie werden sich über Sie beschweren. Das heißt, der Host erhält eine Reihe von automatischen Briefen, in denen er sich beschwert, dass Sie uns scannen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bevor Sie mit Ihrem Projekt beginnen, sollten Sie Folgendes vorbereiten:</font></font><br>
<br>
<ul>
<li><b>    </b> —             ( -     ). ,          .        .</li>
<li><b> PTR-</b> —        ,      .   ,   ,  . ,   PTR   IP-,     , - :<br>
 <code>scanner-for-educational-project.ivan-ivanov.com</code></li>
<li><b>   User-Agent</b> —       - HTTP-,     User-Agent,      .       ,   .</li>
<li><b>  </b> —      ,       .     . </li>
</ul><br>
<h2>NAT,   </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist wichtig zu verstehen, dass zmap gleichzeitig Millionen von TCP-Anforderungen generiert. </font><font style="vertical-align: inherit;">Wenn ein Router mit NAT, eine Firewall mit Verbindungsverfolgung, DDoS-Schutz oder ein anderes System mit einer zustandsbehafteten Firewall, die versucht, Verbindungen zu verfolgen, zwischen dem Internet und dem Scan-Server installiert ist, fällt sie aus, weil sie nicht so viele Verbindungen verarbeiten kann. </font><font style="vertical-align: inherit;">Daher können Sie zmap nicht im NAT ausführen, z. B. hinter einem WLAN-Heimrouter.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich versuche Zmap</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Installieren Sie Zmap ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anleitung</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Test auf etwas Einfachem, siehe benachbarte Webserver von habr.com:</font></font><br>
<br>
<pre><code class="bash hljs">$ zmap -p 80 178.248.237.0/24 -B 100M -o habr.txt</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Optionen:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-p 80</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - TCP-Port 80, </font><b><font style="vertical-align: inherit;">dh</font></b><font style="vertical-align: inherit;"> wir suchen nur nach HTTP-Servern</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">178.248.237.0/24</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist der </font><b><font style="vertical-align: inherit;">Zieladressenbereich</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Wenn Sie dies nicht angeben, wird das gesamte Internet gescannt.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-B 100M</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Die maximale Kanalbreite, die von zmap verwendet wird. </font><font style="vertical-align: inherit;">Wenn diese Option nicht angegeben ist, wird der gesamte verfügbare Kanal entsorgt.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-o habr.txt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - schreibt die Ergebnisse in eine Textdatei. </font><font style="vertical-align: inherit;">Es werden die Adressen abgerufen, die die Anfrage beantwortet haben, dh auf denen sich ein HTTP-Server befindet</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/at/ip/r7/atipr7puts2n4o9n0ravsjti4s0.png"><br>
<font color="999999"><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Scannen von 254 Adressen mit zmap dauerte einige Sekunden</font></font></sup></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zmap-Ausgabeformate</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Standardmäßig fügt zmap die gefundenen Adressen einfach einer Textdatei hinzu und trennt sie durch Zeilenumbrüche. </font><font style="vertical-align: inherit;">Es können aber auch Ergebnisse im JSON- und XML-Format geschrieben werden. </font><font style="vertical-align: inherit;">Mit der Option </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--output-fields</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> können Sie zusätzliche Felder angeben, die der Ausgabe hinzugefügt werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Versuchen wir zum Beispiel ein erweitertes Ausgabeformat in json, das den Port angibt, an dem die Antwortanforderung und die TTL des Pakets eingegangen sind:</font></font><br>
<br>
<pre><code class="bash hljs">$ zmap -p80  --output-module=json --output-fields=ttl,sport,dport,saddr 178.248.237.68 -o habr.com.json<font></font>
<font></font>
<span class="hljs-comment">#  </span><font></font>
$ cat habr.com.json<font></font>
{ <span class="hljs-string">"ttl"</span>: 58, <span class="hljs-string">"sport"</span>: 80, <span class="hljs-string">"dport"</span>: 51309, <span class="hljs-string">"saddr"</span>: <span class="hljs-string">"178.248.237.68"</span> }
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scannen Sie das gesamte Internet!</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe versucht, einen Scan auf VPS durchzuführen, und nach einigen Minuten wurde mir die Anforderung gesperrt, den Server auf Viren zu überprüfen. </font><font style="vertical-align: inherit;">Dies ist ziemlich logisch, da ein solcher Scan wie DDoS vom Host aussieht. </font><font style="vertical-align: inherit;">Nachdem ich meine Aufgabe mit dem Support besprochen hatte, wurde mir angeboten, einen dedizierten Server zu nehmen und darauf zu scannen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So sieht das Scannen auf der 200-Mbit / s-Schnittstelle aus, die vorhergesagte Zeit beträgt ungefähr sechs Stunden: </font></font><br>
<img src="https://habrastorage.org/webt/-d/no/k2/-dnok2gjfb79j9svvcocytliin8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selbst mit einem Kanal von 100 Mbit / s kann das gesamte Internet über Nacht gescannt werden.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was macht man als nächstes</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt können wir feststellen, wie viele Weltadressen Port 80 abhören, und eine Liste davon sammeln. </font><font style="vertical-align: inherit;">Es kann an den L7-Scanner gesendet werden, um die Anwendungsschicht auf Schwachstellen zu analysieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Holen Sie sich beispielsweise mit nmap den HTML-Titel aller Webserver auf der Welt. </font><font style="vertical-align: inherit;">In die nmap-Eingabe übertragen wir die von zmap empfangene Datei im üblichen Format:</font></font><br>
<br>
<pre><code class="bash hljs"><font></font>
$ nmap -sV -p 80 -v -n  --script http-title  -iL habr.txt<font></font>
</code></pre><br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/9fa/cf4/a34/9facf4a348ef01048b4eb5e16ae66daa.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de499728/index.html">Jobs bei Google. Von der Ukraine ins Silicon Valley</a></li>
<li><a href="../de499736/index.html">Was wird beim Master in Software Engineering an der St. Petersburg HSE gelehrt?</a></li>
<li><a href="../de499740/index.html">"Leck" einer Basis von Spezialisten Habr Careers</a></li>
<li><a href="../de499742/index.html">Denial-of-Service-Typ: Wie DDoS voranschreitet</a></li>
<li><a href="../de499744/index.html">Cloud Security Alarm Security Hub</a></li>
<li><a href="../de499752/index.html">Wann fahren alle Elektroautos?</a></li>
<li><a href="../de499754/index.html">Gefrorene Stadtstraßen im Notfallmodus: Es ist Zeit, die Stadt vom Designer wiederzubeleben</a></li>
<li><a href="../de499756/index.html">In wie vielen Sekunden sollte eine Website im Jahr 2020 geladen werden, was ist „schnell“ und wo haben die Spiegel in Aufzügen damit zu tun?</a></li>
<li><a href="../de499758/index.html">Praktische Architekturmuster</a></li>
<li><a href="../de499762/index.html">Verbessern Sie Ihre Fähigkeiten in DevSecOps: 5 Webinare mit Theorie und Praxis</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>