<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⚱️ 👴 🖐🏽 得快点。优化IMAP电子邮件内容请求 🏾 ⏸️ 🚊</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="大家好！在上一篇文章中，我讨论了如何快速同步本地缓存中框的内容。在这里，我想谈谈请求字母内容的功能以及如何最好地请求内容，而不用担心高流量消耗。
 
 
 
 让我们快速记住上一篇文章中学到的内容：
 
 

- IMAP是有状态协议
- 要查看收件箱中的内容，必须首先使用SELECT命令将其选中
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>得快点。优化IMAP电子邮件内容请求</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495956/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大家好！</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在上一篇文章中，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我讨论了如何快速同步本地缓存中框的内容。</font><font style="vertical-align: inherit;">在这里，我想谈谈请求字母内容的功能以及如何最好地请求内容，而不用担心高流量消耗。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kk/4w/8a/kk4w8ac2scl3dawogln5zyvg7fg.jpeg" alt="图片"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们快速记住上一篇文章中学到的内容：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IMAP是有状态协议</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要查看收件箱中的内容，必须首先使用SELECT命令将其选中</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要快速同步我们所在的盒子，可以使用NOOP命令</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了不对本地存储中的邮件进行排序以更新我们已经离开的邮箱，可以使用CONDSTORE和QRESYNC，前提是您的服务器支持协议扩展数据</font></font></li>
</ul><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">足够！</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我提醒您，命令要求输入正文：</font></font><br>
<br>
<pre><code class="bash hljs">1 FETCH number (BODY[])</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这将创建一个请求，以获取信函及其所有附件的全文。</font><font style="vertical-align: inherit;">只需看看在Lorem Ipsum的42段中收到一条消息所需的时间，并带有2兆字节的图片即可。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，询问服务器上消息的大小。</font><font style="vertical-align: inherit;">这是通过以下命令完成的：</font></font><br>
<br>
<pre><code class="bash hljs">1 FETCH 18871 (RFC822.SIZE)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RFC822.SIZE返回消息的大小（以字节为单位）：</font></font><br>
<br>
<pre><code class="bash hljs">* 18871 FETCH (RFC822.SIZE 3937793)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
也就是说，我们的消息占用了将近4兆字节。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，现在，我们将使用该请求作为正文的全部内容，并查看时间：</font></font><br>
<br>
<pre><code class="bash hljs">1 OK Fetch completed (0.007 + 3.265 secs).</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3.3秒！</font><font style="vertical-align: inherit;">这只是带有附件的一封邮件，请想象它们将成为整个邮件箱。</font><font style="vertical-align: inherit;">然后，将需要一分钟以上的时间来下载至少二十个第一个。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您必须承认，到2020年无法同步邮件的客户的业务是糟糕的。</font><font style="vertical-align: inherit;">但是该怎么办？</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">给我一口</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您</font><font style="vertical-align: inherit;">在第</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">6.5.4节</font></a><font style="vertical-align: inherit;">（该节描述了FETCH命令的可能参数）中</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">沙漏RFC3501</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您会注意到一个有趣的请求：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="bash hljs">BODY[&lt;section&gt;]&lt;&lt;partial&gt;&gt;
</code></pre><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分-要获得信件的哪一部分</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分-此部分的大小</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如何部分构建？</font><font style="vertical-align: inherit;">而且非常简单。</font><font style="vertical-align: inherit;">首先，从该点开始写入需要开始读取的字节，然后一般应读取多少个字节：</font></font><br>
<br>
<pre><code class="bash hljs">BODY[&lt;section&gt;]&lt;&lt;0.1024&gt;&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在这里，我们要求字母的一部分从零字节到1024。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
好吧，什么是节？</font><font style="vertical-align: inherit;">首先，我将在FETCH查询中讨论诸如BODYSTRUCTURE这样有用的参数：</font></font><br>
<br>
<pre><code class="bash hljs">1 FETCH 18871 (BODYSTRUCTURE)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
正如您可能从签名中了解的那样，此参数以</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MIME-IMB中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述的形式返回字母的结构</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="bash hljs">* 18871 FETCH (BODYSTRUCTURE (((<span class="hljs-string">"text"</span> <span class="hljs-string">"plain"</span> (<span class="hljs-string">"charset"</span> <span class="hljs-string">"utf-8"</span>) NIL NIL <span class="hljs-string">"quoted-printable"</span> 25604 337 NIL NIL NIL NIL)(<span class="hljs-string">"text"</span> <span class="hljs-string">"html"</span> (<span class="hljs-string">"charset"</span> <span class="hljs-string">"utf-8"</span>) NIL NIL <span class="hljs-string">"quoted-printable"</span> 29593 390 NIL NIL NIL NIL) <span class="hljs-string">"alternative"</span> (<span class="hljs-string">"boundary"</span> <span class="hljs-string">"--=_Part_763_774309787.1586268692"</span>) NIL NIL NIL)(<span class="hljs-string">"image"</span> <span class="hljs-string">"jpeg"</span> (<span class="hljs-string">"name"</span> <span class="hljs-string">"IMG_20200217_000236.jpg"</span>) NIL NIL <span class="hljs-string">"base64"</span> 3880726 NIL (<span class="hljs-string">"attachment"</span> (<span class="hljs-string">"filename"</span> <span class="hljs-string">"IMG_20200217_000236.jpg"</span>)) NIL NIL) <span class="hljs-string">"mixed"</span> (<span class="hljs-string">"boundary"</span> <span class="hljs-string">"--=_Part_210_297656922.1586268692"</span>) NIL NIL NIL))
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
看看这个结构，您的头在旋转吗？</font><font style="vertical-align: inherit;">不要害怕，现在我们将解决这个问题。</font><font style="vertical-align: inherit;">比较打开和关闭支架。</font></font><br>
<br>
<pre><code class="bash hljs">(<font></font>
BODYSTRUCTURE&nbsp;<font></font>
(<font></font>
[1] (<font></font>
[1.1] (<span class="hljs-string">"text"</span> <span class="hljs-string">"plain"</span> (<span class="hljs-string">"charset"</span> <span class="hljs-string">"utf-8"</span>) NIL NIL <span class="hljs-string">"quoted-printable"</span> 25604 337 NIL NIL NIL NIL)<font></font>
[1.2] (<span class="hljs-string">"text"</span> <span class="hljs-string">"html"</span> (<span class="hljs-string">"charset"</span> <span class="hljs-string">"utf-8"</span>) NIL NIL <span class="hljs-string">"quoted-printable"</span> 29593 390 NIL NIL NIL NIL) <span class="hljs-string">"alternative"</span> (<span class="hljs-string">"boundary"</span> <span class="hljs-string">"--=_Part_763_774309787.1586268692"</span>) NIL NIL NIL<font></font>
)<font></font>
[2] (<span class="hljs-string">"image"</span> <span class="hljs-string">"jpeg"</span> (<span class="hljs-string">"name"</span> <span class="hljs-string">"IMG_20200217_000236.jpg"</span>) NIL NIL <span class="hljs-string">"base64"</span> 3880726 NIL (<span class="hljs-string">"attachment"</span> (<span class="hljs-string">"filename"</span> <span class="hljs-string">"IMG_20200217_000236.jpg"</span>)) NIL NIL) <span class="hljs-string">"mixed"</span> (<span class="hljs-string">"boundary"</span> <span class="hljs-string">"--=_Part_210_297656922.1586268692"</span>) NIL NIL NIL<font></font>
)<font></font>
)</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可能会注意到，我将数字放在了一些方括号附近。</font><font style="vertical-align: inherit;">这是一节。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如何计算？</font><font style="vertical-align: inherit;">必须跳过第一个括号，因为它仅包含请求的答案，因此，每个开头的括号必须根据规则编号，因为文档中的标题编号为：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们在考虑到上一节的情况下为每个开括号编号</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果该部分是嵌套的，则当前的一点到该点将被添加到先前的数字中</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果该部分未嵌套，则将其数量增加一</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例如，在这种情况下，在以“替代”结尾的第一部分（即，这是多部分/替代字母的部分，我们可以自由选择要为用户显示的部分）中有两个部分用点编号。</font><font style="vertical-align: inherit;">我遇到了一个可能存在三级嵌套的服务器（即[1.1.1]，[1.1.2]等）。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们分析[1.1]部分，看看</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MIME-IMB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文档中所有这些东西的结构</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以此判断，Content-Type头是第一个。</font><font style="vertical-align: inherit;">这包括：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MIME类型，这里是文本/纯文本</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编码（字符集= utf8）</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下是写为NIL的两个参数。</font><font style="vertical-align: inherit;">坦白说，我不了解它是什么，但是到目前为止我还不需要它，所以我会想念它的。</font><font style="vertical-align: inherit;">对此我很抱歉，</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来是Content-Transfer-Encoding标头，它包含在其中，它描述了编码机制，在这里它被引用为可打印的。&nbsp;</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下两个数字（如果可能）以字节为单位描述部件的大小和行数。</font><font style="vertical-align: inherit;">在他们的帮助下，我们可以计算出显示一定数量行所需的字节数。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下几行不在本部分中：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Content-Id，用于字母内联</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Content-Description，描述这部分内容的一行</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于其他两个参数，我找不到确切的答案，但是其中一个参数可能包含MD5部分，有时可能很有用。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于部分[2]，所有内容都相同，除了它是图像，带有名称的附件和base64编码。如果仍然不能完全清楚这里发生了什么，那么</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此站点上，它可以</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完美地列出确切的部分计算方法。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
它有什么作用？事实是，在显示字母的阶段，我们只可以请求内容的顶部，而在用户自己输入消息并单击“下载”按钮之前，不加载附件。用于显示附件的所有信息都通过BODYSCTRUCTURE提供给我们，因此无需加载附件本身即可显示名称，格式和大小。&nbsp;</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们继续练习。</font><font style="vertical-align: inherit;">我们会要求提供一千字节的不带附件的邮件内容，只是为了知道它们向我们发送了什么。</font></font><br>
<br>
<pre><code class="bash hljs">1 fetch 18871 (body[1.1]&lt;0.1024&gt;)<font></font>
* 18871 FETCH (BODY[1.1]&lt;0&gt; {1024}<font></font>
Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus consecte=<font></font>
tur enim <span class="hljs-keyword">in</span> nisi venenatis, id varius tellus viverra. Praesent et enim te=<font></font>
llus. Nunc vestibulum diam tortor, id posuere turpis tempor luctus. Vivam=<font></font>
us molestie non nunc nec placerat. Cras finibus ut erat et tristique. Cur=<font></font>
abitur vitae commodo risus. Etiam sed scelerisque erat. Quisque cursus bl=<font></font>
andit finibus. Nullam ac lectus accumsan, molestie quam non, mollis urna.=<font></font>
&nbsp;Nulla at arcu <span class="hljs-keyword">in</span> libero condimentum mollis ut non velit. Vestibulum sed =<font></font>
risus et magna congue iaculis. Vestibulum nec interdum elit, ut commodo m=<font></font>
auris. Nulla ipsum leo, vestibulum nec ligula non, elementum ullamcorper =<font></font>
risus. Nunc et malesuada sem, id venenatis massa. Integer dolor ante, max=<font></font>
imus <span class="hljs-keyword">in</span> eleifend nec, ultricies ut risus. Mauris posuere eget tortor at p=<font></font>
orttitor.=0AIn porta elementum ornare. Suspendisse aliquam, tortor sed al=<font></font>
iquam bibendum, nulla ante rhoncus elit, placerat accumsan augue nibh non=<font></font>
&nbsp;est. Duis finibus vel tortor finibu)<font></font>
1 OK Fetch completed (0.073 + 0.000 + 0.072 secs).</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
大约100毫秒，我们已经看到了信件的某些内容！</font><font style="vertical-align: inherit;">鉴于以前下载一个字母的内容花了我们近4秒钟，所以这只是一个很好的结果。</font><font style="vertical-align: inherit;">然后，您可以简单地将字母的整个内容加载到后台流中，从外面看，字母似乎是立即加载的。</font><font style="vertical-align: inherit;">所需要做的只是查看字母的结构并仅下载快速显示所需的内容。&nbsp;</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
只有一刻。</font><font style="vertical-align: inherit;">该请求将使服务器上的消息显示为已读。</font><font style="vertical-align: inherit;">但是您可以通过仅在正文请求中添加PEEK来解决此问题</font></font><br>
<br>
<pre><code class="bash hljs">1 fetch 18871 (BODY.PEEK[1.1]&lt;0.1024&gt;)<font></font>
* 18871 FETCH (BODY[1.1]&lt;0&gt; {1024}<font></font>
Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus consecte=<font></font>
tur enim <span class="hljs-keyword">in</span> nisi venenatis, id varius tellus viverra. Praesent et enim te=<font></font>
llus. Nunc vestibulum diam tortor, id posuere turpis tempor luctus. Vivam=<font></font>
us molestie non nunc nec placerat. Cras finibus ut erat et tristique. Cur=<font></font>
abitur vitae commodo risus. Etiam sed scelerisque erat. Quisque cursus bl=<font></font>
andit finibus. Nullam ac lectus accumsan, molestie quam non, mollis urna.=<font></font>
&nbsp;Nulla at arcu <span class="hljs-keyword">in</span> libero condimentum mollis ut non velit. Vestibulum sed =<font></font>
risus et magna congue iaculis. Vestibulum nec interdum elit, ut commodo m=<font></font>
auris. Nulla ipsum leo, vestibulum nec ligula non, elementum ullamcorper =<font></font>
risus. Nunc et malesuada sem, id venenatis massa. Integer dolor ante, max=<font></font>
imus <span class="hljs-keyword">in</span> eleifend nec, ultricies ut risus. Mauris posuere eget tortor at p=<font></font>
orttitor.=0AIn porta elementum ornare. Suspendisse aliquam, tortor sed al=<font></font>
iquam bibendum, nulla ante rhoncus elit, placerat accumsan augue nibh non=<font></font>
&nbsp;est. Duis finibus vel tortor finibu)<font></font>
1 OK Fetch completed (0.001 + 0.000 secs).</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
瞧！</font><font style="vertical-align: inherit;">该信仍未阅读，我们收到了一些内容。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果在服务器上实现了</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">PREVIEW</font></a><font style="vertical-align: inherit;">请求功能，一切将变得更加容易。&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><br>
<br>
<pre><code class="bash hljs">1 fetch 18871 (PREVIEW)<font></font>
* 18871 FETCH (PREVIEW (FUZZY <span class="hljs-string">"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus consectetur enim in nisi venenatis, id varius tellus viverra. Praesent et enim tellus. Nunc vestibulum diam tortor, id posuere turpis t"</span>))<font></font>
1 OK Fetch completed (0.001 + 0.000 secs).</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在这里，我们根本不需要花费时间来查询结构，因此可以立即获得消息预览。</font><font style="vertical-align: inherit;">但是请不要忘记，结构请求对于标识附件很有用，这样它们就不会加载到空闲状态中。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等待</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果用户现在想接收新的信件，几乎所有的邮件客户端都会实现“刷新”按钮。</font><font style="vertical-align: inherit;">但是，这对于我们这个时代来说并不酷，因为设备和浏览器中都有通知。</font><font style="vertical-align: inherit;">IMAP对此有何评论？</font><font style="vertical-align: inherit;">他说</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">闲话</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此操作将保持与文件夹的连接，并通知您对文件夹的更改。</font><font style="vertical-align: inherit;">请注意，不是邮箱，而是文件夹。</font><font style="vertical-align: inherit;">为此，您需要服务器实现IDLE功能。&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，选择服务器将为其发送警报的文件夹，然后启用IDLE</font></font><br>
<br>
<pre><code class="bash hljs">1 SELECT Inbox<font></font>
* FLAGS (\Answered \Flagged \Deleted \Seen \Draft <span class="hljs-variable">$Forwarded</span> <span class="hljs-variable">$MDNSent</span>)<font></font>
* OK [PERMANENTFLAGS (\Answered \Flagged \Deleted \Seen \Draft <span class="hljs-variable">$Forwarded</span> <span class="hljs-variable">$MDNSent</span> \*)] Flags permitted.<font></font>
* 18872 EXISTS<font></font>
* 0 RECENT<font></font>
* OK [UNSEEN 18685] First unseen.<font></font>
* OK [UIDVALIDITY 1532079879] UIDs valid<font></font>
* OK [UIDNEXT 20155] Predicted next UID<font></font>
* OK [HIGHESTMODSEQ 26338] Highest<font></font>
1 OK [READ-WRITE] Select completed (0.002 + 0.000 + 0.001 secs).<font></font>
1 IDLE<font></font>
+ idling</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
答案“ +空闲”通知有关文件夹中包含空闲的信息。</font><font style="vertical-align: inherit;">如果收到新来信怎么办？</font></font><br>
<br>
<pre><code class="bash hljs">* 18873 EXISTS<font></font>
* 1 RECENT</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我给自己寄了同一封信，艾德勒通知我，我应该要求写18873号信，文件夹中有18873个信，并且一封信刚到。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来，我将在另一个连接中请求此信件，我们对带有答案EXISTS的信件感兴趣。</font></font><br>
<br>
<pre><code class="bash hljs">1 fetch 18873 (BODY.PEEK[1.1]&lt;0.1024&gt;)<font></font>
* 18873 FETCH (BODY[1.1]&lt;0&gt; {1024}<font></font>
---- Original Message ---- Tue, Apr 7, 2020, 17:11=0ASubject=<font></font>
: Lorem Ipsum=0A&nbsp; Lorem ipsum dolor sit amet, consectetur adipiscing elit=<font></font>
. Vivamus consectetur enim <span class="hljs-keyword">in</span> nisi venenatis, id varius tellus viverra. P=<font></font>
raesent et enim tellus. Nunc vestibulum diam tortor, id posuere turpis te=<font></font>
mpor luctus. Vivamus molestie non nunc nec placerat. Cras finibus ut erat=<font></font>
…</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
了解这一点非常重要。</font><font style="vertical-align: inherit;">IDLE需要单独的连接，因此您无法在同一会话中接收更改和请求消息，</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IDLE还能做什么？</font><font style="vertical-align: inherit;">他能够通知已删除的字母和标志已更改的字母。</font><font style="vertical-align: inherit;">为了举例说明，让我们看一下字母，从而在其上放置“ / seen”标志并删除该字母。</font></font><br>
<br>
<pre><code class="bash hljs">* 18873 FETCH (FLAGS (\Seen \Recent))<font></font>
* OK Still here<font></font>
* OK Still here<font></font>
* 18873 EXPUNGE<font></font>
* 18871 EXPUNGE<font></font>
* 0 RECENT</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我删除了对话（18873，18871），然后看了另一封信（FETCH响应）。</font><font style="vertical-align: inherit;">这封信为什么变成18871？</font><font style="vertical-align: inherit;">因为如果某些更改，IMAP会重新计算字母数字。</font><font style="vertical-align: inherit;">自从它成为第一名以来，其数量也发生了变化。&nbsp;</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用IDLE，我们可以快速同步盒子的状态，但是它需要单独的连接是不愉快的。</font><font style="vertical-align: inherit;">会更好吗？</font><font style="vertical-align: inherit;">这就是为什么我在这里。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大吼你好</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果我告诉您，有一项功能可以让您从同一连接中的服务器接收通知，甚至为邮箱（甚至没有一个邮箱）进行了特殊配置。</font><font style="vertical-align: inherit;">这听起来像童话故事，但请不要发疯，这是一种真正的能力</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NOTIFY</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">他知道很多，例如：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置我们希望从中收到通知的特定文件夹</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收听文件夹状态更改（阅读字母，新字母）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置通知格式，即我们想要在更改文件夹时看到的内容</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听文件夹名称更改</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听文件夹元数据更改</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们看一个如何监听文件夹状态变化的例子</font></font><br>
<br>
<pre><code class="bash hljs">1 notify <span class="hljs-built_in">set</span> (inboxes (MessageNew FlagChange MessageExpunge))<font></font>
1 OK NOTIFY completed (0.001 + 0.000 secs).</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在服务器将向我们发送有关文件夹状态的通知，例如，我将几条消息添加到不同的文件夹中</font></font><br>
<br>
<pre><code class="bash hljs">* STATUS INBOX/Ozon (MESSAGES 312 UIDNEXT 321 UNSEEN 48)<font></font>
* STATUS <span class="hljs-string">"INBOX/Company News"</span> (MESSAGES 178 UIDNEXT 179 UNSEEN 1)<font></font>
* STATUS <span class="hljs-string">"INBOX/Company News"</span> (MESSAGES 177 UIDNEXT 179 UNSEEN 0)</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我将分析命令：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先是NOTIFY SET命令。</font><font style="vertical-align: inherit;">接下来，在方括号中，我们选择要收听的文件夹：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收件箱-对于您可以选择的所有文件夹</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">个人-用户命名空间中的文件夹</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已订阅-用户已订阅的文件夹</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子树-要指定的文件夹的子树</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">邮箱-在这里您可以列出要收听的文件夹。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选定-仅对选定的文件夹发出警报</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以及负责警报过滤器的参数：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MessageNew-如果有新消息到达</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FlagChange-如果标志已更改</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MessageExpunge-如果邮件已删除或移动</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是使用这样的命令，我们无法接收新消息，更改消息或删除消息的参数。</font><font style="vertical-align: inherit;">为此，选择Selected参数并指定确切返回的内容。</font><font style="vertical-align: inherit;">我们可以添加另一个警报，而不会删除前一个警报。</font></font><br>
<br>
<pre><code class="bash hljs">1 notify <span class="hljs-built_in">set</span> status (selected (MessageNew (uid preview) MessageExpunge))
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在MessageNew中，我们指定通知应返回的参数。</font><font style="vertical-align: inherit;">我将选择“收件箱”，然后再次将自己扔给我自己。</font></font><br>
<br>
<pre><code class="bash hljs">* 18868 FETCH (UID 20157 PREVIEW (FUZZY <span class="hljs-string">"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus consectetur enim in nisi venenatis, id varius tellus viverra. Praesent et enim tellus. Nunc vestibulum diam tortor, id posuere turpis t"</span>))</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
你喜欢吗？</font><font style="vertical-align: inherit;">对于空闲，我们需要保持两个连接，其中之一还请求空闲返回给我们的消息。</font><font style="vertical-align: inherit;">他们立即将所有东西带到了银色的盘子上。&nbsp;</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这样我们就可以听文件夹名称的更改</font></font><br>
<br>
<pre><code class="bash hljs">1 notify <span class="hljs-built_in">set</span> (inboxes (MailboxName))</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重命名一些文件夹并查看结果。</font></font><br>
<br>
<pre><code class="bash hljs">* LIST () <span class="hljs-string">"/"</span> 1111 (<span class="hljs-string">"OLDNAME"</span> (aaaa))</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在我们知道有一个“ aaaa”文件夹，并变成了“ 1111”，</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在您可以收听标志的更改和消息的删除。</font><font style="vertical-align: inherit;">为此，请使用FlagChange参数</font></font><br>
<br>
<pre><code class="bash hljs">1 notify <span class="hljs-built_in">set</span> (selected (MessageNew (uid) FlagChange MessageExpunge))</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当您更改消息标记并删除时，我们得到</font></font><br>
<br>
<pre><code class="bash hljs">* 18865 EXPUNGE<font></font>
* 18864 FETCH (FLAGS ())<font></font>
* 18864 FETCH (FLAGS (\Answered))</code></pre><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一步是什么</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
所有这些功能都可以帮助邮件客户端为用户尽快方便地工作。</font><font style="vertical-align: inherit;">IDLE和NOTIFY通知用户文件夹中的更改，请求部分信件以加快其加载速度。&nbsp;</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在最后一篇文章中，我想讨论一下IMAP中的搜索机制，以及如何加速搜索机制并减少网络负载。</font><font style="vertical-align: inherit;">感谢您阅读到最后。&nbsp;</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN495942/index.html">节省时间，精力和工时</a></li>
<li><a href="../zh-CN495944/index.html">更新的TOP50（CIS超级计算机的等级）：动态和趋势</a></li>
<li><a href="../zh-CN495946/index.html">诺伯特·维纳（Norbert Wiener）：控制论之父</a></li>
<li><a href="../zh-CN495948/index.html">嵌入式Rust。使用STM32F103C8T6（Black Pill）调试板为Cortex-M3处理器开发</a></li>
<li><a href="../zh-CN495954/index.html">思科如何在远程访问模式和缺席的环境中运行20年？</a></li>
<li><a href="../zh-CN495960/index.html">只是AH-ny Wi-Fi。或我们如何在教育机构中构建Wi-Fi 6（AX）网络</a></li>
<li><a href="../zh-CN495962/index.html">Udalenka：他们打算如何在X5中切换到远程工作格式</a></li>
<li><a href="../zh-CN495966/index.html">荒谬的代码或“如何不写”</a></li>
<li><a href="../zh-CN495970/index.html">远程团队工作的工具：从时间跟踪到财务</a></li>
<li><a href="../zh-CN495974/index.html">2020年英仙座流星的摄影观测</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>