<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üç® üßñüèª ‚ùî Conteneur Linux pour l'application .NET Framework (lorsqu'il est difficile de partir pour .Net Core) üôÅ üéÄ üëÉüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, Habr. 
 
 Je veux partager avec le monde une t√¢che plut√¥t atypique, du moins pour moi, et sa solution, qui me semble tout √† fait acceptable. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Conteneur Linux pour l'application .NET Framework (lorsqu'il est difficile de partir pour .Net Core)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/498396/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bonjour, Habr. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je veux partager avec le monde une t√¢che plut√¥t atypique, du moins pour moi, et sa solution, qui me semble tout √† fait acceptable. </font><font style="vertical-align: inherit;">D√©crit ci-dessous n'est peut-√™tre pas le moyen id√©al de sortir de la situation, mais cela fonctionne et fonctionne comme pr√©vu.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cadre et arri√®re-plan</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y avait une t√¢che √† accomplir: vous devez faire des aper√ßus 3D des mod√®les BIM de divers √©quipements, mat√©riaux, objets sur le site. </font><font style="vertical-align: inherit;">Besoin de quelque chose de l√©ger, simple. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur le site Web, les mod√®les de ces objets sont stock√©s et disponibles pour t√©l√©chargement dans des formats propri√©taires de divers </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">syst√®mes de CAO</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et sous forme de formats ouverts pour les mod√®les 3D. </font><font style="vertical-align: inherit;">Parmi eux, le format </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IFC</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Je vais l'utiliser comme source pour r√©soudre cette t√¢che.</font></font><br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'une des options et ses fonctionnalit√©s</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Formellement, on pourrait se limiter √† √©crire une sorte de convertisseur * .ifc pour quelque chose √† afficher sur une page Web. </font><font style="vertical-align: inherit;">C'est l√† que j'ai commenc√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une merveilleuse bo√Æte √† outils, la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bo√Æte √† outils xBIM, a</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √©t√© choisie pour une telle conversion </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les exemples d'utilisation de cet outil </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©crivent</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> simplement et clairement </font><font style="vertical-align: inherit;">comment travailler avec IFC et le * .wexBIM sp√©cialis√© pour le format Web.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tout d'abord, convertissez * .ifc en * .wexBIM:</font></font></b>
                        <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword">using</span> System.IO;
<span class="hljs-keyword">using</span> Xbim.Ifc;
<span class="hljs-keyword">using</span> Xbim.ModelGeometry.Scene;<font></font>
<font></font>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">CreateWexBIM</span><font></font>
{<font></font>
    <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span><font></font>
    {<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"></span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">const</span> <span class="hljs-keyword">string</span> fileName = <span class="hljs-string">"SampleHouse.ifc"</span>;
            <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> model = IfcStore.Open(fileName))<font></font>
            {<font></font>
                <span class="hljs-keyword">var</span> context = <span class="hljs-keyword">new</span> Xbim3DModelContext(model);<font></font>
                context.CreateContext();<font></font>
<font></font>
                <span class="hljs-keyword">var</span> wexBimFilename = Path.ChangeExtension(fileName, <span class="hljs-string">"wexBIM"</span>);
                <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> wexBiMfile = File.Create(wexBimFilename))<font></font>
                {<font></font>
                    <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> wexBimBinaryWriter = <span class="hljs-keyword">new</span> BinaryWriter(wexBiMfile))<font></font>
                    {<font></font>
                        model.SaveAsWexBim(wexBimBinaryWriter);<font></font>
                        wexBimBinaryWriter.Close();<font></font>
                    }<font></font>
                    wexBiMfile.Close();<font></font>
                }<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, le fichier r√©sultant est utilis√© dans le "player" </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xBIM WeXplorer</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un exemple d'int√©gration de * .wexBIM dans une page:</font></font></b>
                        <div class="spoiler_text"><pre><code class="javascript hljs">&lt;!DOCTYPE html&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.w3.org/1999/xhtml"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Hello building!<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"js/xbim-viewer.debug.bundle.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"content"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"viewer"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"500"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"300"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span>&gt;</span><span class="javascript">
            <span class="hljs-keyword">var</span> viewer = <span class="hljs-keyword">new</span> xViewer(<span class="hljs-string">'viewer'</span>);
            viewer.load(<span class="hljs-string">'data/SampleHouse.wexbim'</span>);
            viewer.start();
        </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>    
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, allons-y. </font><font style="vertical-align: inherit;">Je prends des </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p√©pites</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de xBIM. </font><font style="vertical-align: inherit;">J'√©cris une application console qui re√ßoit un tas de chemins vers des fichiers * .ifc en entr√©e, et √† c√¥t√© d'eux, il ajoute un tas de fichiers * .wexBIM. </font><font style="vertical-align: inherit;">Tout peut √™tre t√©l√©charg√© sur le site. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais en quelque sorte, c'est assez simple ... Je veux que ce programme devienne une sorte de service qui, lors de l'√©v√©nement de t√©l√©chargement * .ifc sur le portail, cr√©e imm√©diatement le * .wexBIM n√©cessaire, et il appara√Æt imm√©diatement dans le conteneur pr√©par√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ok, je forme de nouvelles exigences:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Laissez les t√¢ches de conversion provenir de notre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RabbitMQ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je veux voir les t√¢ches elles-m√™mes sous la forme d'un message binaire, qui en fait sera pr√™t pour la d√©s√©rialisation par la classe d√©crite dans le </font><font style="vertical-align: inherit;">fichier </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">protobuf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la t√¢che contiendra un lien pour t√©l√©charger le fichier source * .ifc de notre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> la t√¢che me dira √©galement quel compartiment dans Minio ajouter le r√©sultat;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">laissez l'application elle-m√™me √™tre construite sous .net core 3.1 et travaillez √† l'int√©rieur du conteneur de docker Linux sur notre "batterie de dockers";</font></font></li>
</ol><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les premi√®res difficult√©s et conventions</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne d√©crirai pas en d√©tail les 4 premiers points de mise en ≈ìuvre. </font><font style="vertical-align: inherit;">Peut-√™tre plus tard. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Caus√© l'application √† √©couter la file d'attente des travaux et envoyer un message avec le r√©sultat √† la file d'attente √† partir du </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CorrelationId du</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> message de travail. </font><font style="vertical-align: inherit;">Viss√© les classes de demande / r√©ponse g√©n√©r√©es √† partir de protobuf. </font><font style="vertical-align: inherit;">A appris √† t√©l√©charger / t√©l√©charger des fichiers en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">minio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout cela, je le fais dans le projet d'application console. </font><font style="vertical-align: inherit;">Dans les param√®tres du projet:</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">TargetFramework</span>&gt;</span>netcoreapp3.1<span class="hljs-tag">&lt;/<span class="hljs-name">TargetFramework</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et sur ma machine avec Windows 10, tout est compl√®tement d√©bogu√© et fonctionne. </font><font style="vertical-align: inherit;">Mais lorsque j'essaie d'ex√©cuter l'application en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WSL, </font></font></a><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">j'attrape</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> une erreur </font><b><font style="vertical-align: inherit;">System.IO.FileLoadException</font></b><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Informations d'erreur compl√®tes:</font></font></b>
                        <div class="spoiler_text"><pre><code class="json hljs">{
  <span class="hljs-attr">"Type"</span>: <span class="hljs-string">"System.IO.FileLoadException"</span>,
  <span class="hljs-attr">"Message"</span>: <span class="hljs-string">"Failed to load Xbim.Geometry.Engine64.dll"</span>,
  <span class="hljs-attr">"TargetSite"</span>: <span class="hljs-string">"Void .ctor(Microsoft.Extensions.Logging.ILogger`1[Xbim.Geometry.Engine.Interop.XbimGeometryEngine])"</span>,
  <span class="hljs-attr">"StackTrace"</span>: <span class="hljs-string">" at Xbim.Geometry.Engine.Interop.XbimGeometryEngine..ctor(ILogger`1 logger)\r\n at Xbim.Geometry.Engine.Interop.XbimGeometryEngine..ctor()\r\n at Xbim.ModelGeometry.Scene.Xbim3DModelContext.get_Engine()\r\n at Xbim.ModelGeometry.Scene.Xbim3DModelContext.CreateContext(ReportProgressDelegate progDelegate, Boolean adjustWcs)\r\n at My.Converter.ConvertIfc.CreateWebIfc(String ifcFileFullPath, String wexBIMFolder)"</span>,
  <span class="hljs-attr">"Data"</span>: {},
  <span class="hljs-attr">"InnerException"</span>: {
    <span class="hljs-attr">"Type"</span>: <span class="hljs-string">"System.IO.FileNotFoundException"</span>,
    <span class="hljs-attr">"Message"</span>: <span class="hljs-string">"Could not load file or assembly 'Xbim.Geometry.Engine.dll, Culture=neutral, PublicKeyToken=null'. The system cannot find the file specified."</span>,
    <span class="hljs-attr">"FileName"</span>: <span class="hljs-string">"Xbim.Geometry.Engine.dll, Culture=neutral, PublicKeyToken=null"</span>,
    <span class="hljs-attr">"FusionLog"</span>: <span class="hljs-string">""</span>,
    <span class="hljs-attr">"TargetSite"</span>: <span class="hljs-string">"System.Reflection.RuntimeAssembly nLoad(System.Reflection.AssemblyName, System.String, System.Reflection.RuntimeAssembly, System.Threading.StackCrawlMark ByRef, Boolean, System.Runtime.Loader.AssemblyLoadContext)"</span>,
    <span class="hljs-attr">"StackTrace"</span>: <span class="hljs-string">" at System.Reflection.RuntimeAssembly.nLoad(AssemblyName fileName, String codeBase, RuntimeAssembly assemblyContext, StackCrawlMark&amp; stackMark, Boolean throwOnFileNotFound, AssemblyLoadContext assemblyLoadContext)\r\n at System.Reflection.RuntimeAssembly.InternalLoadAssemblyName(AssemblyName assemblyRef, StackCrawlMark&amp; stackMark, AssemblyLoadContext assemblyLoadContext)\r\n at System.Reflection.Assembly.Load(String assemblyString)\r\n at Xbim.Geometry.Engine.Interop.XbimGeometryEngine..ctor(ILogger`1 logger)"</span>,
    <span class="hljs-attr">"Data"</span>: {},
    <span class="hljs-attr">"Source"</span>: <span class="hljs-string">"System.Private.CoreLib"</span>,
    <span class="hljs-attr">"HResult"</span>: <span class="hljs-number">-2147024894</span><font></font>
  },<font></font>
  <span class="hljs-attr">"Source"</span>: <span class="hljs-string">"Xbim.Geometry.Engine.Interop"</span>,
  <span class="hljs-attr">"HResult"</span>: <span class="hljs-number">-2146232799</span>
}</code></pre></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une s√©ance de recherche active sur Google et de lecture r√©fl√©chie m'a montr√© que j'√©tais extr√™mement inattentif:</font></font><br>
<blockquote>Recently at work, we were evaluating a few options to render building models in the browser. Building Information Modeling (BIM) in interoperability scenarios is done via Industry Foundation Classes, mostly in the STEP Physical File format. The schema is quite huge and complex with all the things you have to consider, so we were glad to find the xBim open source project on GitHub. They've got both projects to visualize building models in the browser with WebGL as well as conversion tools to create the binary-formatted geometry mesh. To achieve that, native C++ libraries are dynamically loaded (so no .Net Core compatibility) which must be present in the bin folder. The C++ libraries are expected either in the same folder as the application binaries or in a x64 (or x86, respectively) sub folder (See <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">here</a> for more details). In regular projects, the xBim.Geometry NuGet package adds a build task to copy the dlls into the build output folder, but this doesn't work with the new tooling. You can, however, get it to work in Visual Studio 2015 by taking care of supplying the interop dlls yourself.</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et des difficult√©s similaires ne sont pas pour moi seul. </font><font style="vertical-align: inherit;">Beaucoup de gens veulent </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xBIM sous .Net Core</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pas critique, mais √ßa change beaucoup ... Tout </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©pend</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de l'impossibilit√© de charger </font><i><font style="vertical-align: inherit;">Xbim.Geometry.Engine64.dll normalement</font></i><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vous devez avoir </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vc_redist.x64.exe</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur la machine </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Quelles sont mes options? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La premi√®re chose que j'ai pens√©: ¬´Peut-on utiliser un conteneur Windows avec un framework .Net complet? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Livrez Microsoft Visual C ++ Redistributable pour Visual Studio 2015, 2017 et 2019 √† ce conteneur, et tout ira bien? ¬ª </font><font style="vertical-align: inherit;">J'ai essay√© ceci:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tester l'image Windows pour docker:</font></font></b>
                        <div class="spoiler_text"> .Net Core :<br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">TargetFramework</span>&gt;</span>net47<span class="hljs-tag">&lt;/<span class="hljs-name">TargetFramework</span>&gt;</span></code></pre><br>
Dockerfile:<br>
<br>
<pre><code class="powershell hljs">FROM microsoft/dotnet<span class="hljs-literal">-framework</span>:<span class="hljs-number">4.7</span><font></font>
WORKDIR /bimlibconverter<font></font>
<span class="hljs-built_in">COPY</span> lib/VC_redist.x64.exe /VC_redist.x64.exe<font></font>
RUN C:\VC_redist.x64.exe /quiet /install<font></font>
<span class="hljs-built_in">COPY</span> bin/Release .<font></font>
ENTRYPOINT [<span class="hljs-string">"MyConverter.exe"</span>]</code></pre></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et bien, √ßa a march√© ... C'est vivant! </font><font style="vertical-align: inherit;">Mais. </font><font style="vertical-align: inherit;">Mais qu'en est-il de notre machine Linux h√¥te avec docker? </font><font style="vertical-align: inherit;">Cela ne fonctionnera pas pour conduire un conteneur avec une image sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows Server Core</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dessus </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Besoin de sortir ...</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compromis et d√©nouement</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une autre recherche sur le Web m'a amen√© √† </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dans ce document, l'auteur n√©cessite une impl√©mentation similaire:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour aggraver les choses: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
tous les binaires sont en 32 bits (x86). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Certains n√©cessitent des composants d'ex√©cution redistribuables C ++ visuels. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Certains n√©cessitent le runtime .NET. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Certains ont besoin d'un syst√®me de fen√™trage, m√™me si nous n'utilisons que l'interface de ligne de commande (CLI).</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La publication d√©crit le potentiel pour ex√©cuter des applications Windows dans Wine dans un conteneur Linux. </font><font style="vertical-align: inherit;">Curieux, j'ai d√©cid√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s quelques tests, bugs et ajouts, le Dockerfile a √©t√© re√ßu:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Image de docker bas√©e sur Ubuntu avec Wine, .Net Framework et vcredist √† bord:</font></font></b>
                        <div class="spoiler_text"><pre><code class="powershell hljs"><font></font>
FROM ubuntu:latest<font></font>
<span class="hljs-comment">#  x86</span>
RUN dpkg -<span class="hljs-literal">-add</span><span class="hljs-literal">-architecture</span> i386 \<font></font>
    &amp;&amp; apt<span class="hljs-literal">-get</span> update \
    <span class="hljs-comment">#   </span>
    &amp;&amp; apt<span class="hljs-literal">-get</span> install <span class="hljs-literal">-qfy</span> -<span class="hljs-literal">-install</span><span class="hljs-literal">-recommends</span> \<font></font>
        software<span class="hljs-literal">-properties</span><span class="hljs-literal">-common</span> \<font></font>
        gnupg2 \<font></font>
        <span class="hljs-built_in">wget</span> \<font></font>
        xvfb \<font></font>
        cabextract \<font></font>
    <span class="hljs-comment">#  Wine</span>
    &amp;&amp; <span class="hljs-built_in">wget</span> <span class="hljs-literal">-nv</span> https://dl.winehq.org/wine<span class="hljs-literal">-builds</span>/winehq.key \<font></font>
    &amp;&amp; apt<span class="hljs-literal">-key</span> add winehq.key \<font></font>
    &amp;&amp; apt<span class="hljs-literal">-add</span><span class="hljs-literal">-repository</span> <span class="hljs-string">'deb https://dl.winehq.org/wine-builds/ubuntu/ bionic main'</span> \
    <span class="hljs-comment">#     Wine</span>
    &amp;&amp; <span class="hljs-built_in">add-apt</span><span class="hljs-literal">-repository</span> ppa:cybermax<span class="hljs-literal">-dexter</span>/sdl2<span class="hljs-literal">-backport</span> \
    <span class="hljs-comment">#  Wine</span>
    &amp;&amp; apt<span class="hljs-literal">-get</span> install <span class="hljs-literal">-qfy</span> -<span class="hljs-literal">-install</span><span class="hljs-literal">-recommends</span> \<font></font>
        winehq<span class="hljs-literal">-staging</span> \<font></font>
        winbind \<font></font>
    <span class="hljs-comment"># </span>
    &amp;&amp; apt<span class="hljs-literal">-get</span> <span class="hljs-literal">-y</span> clean \<font></font>
    &amp;&amp; <span class="hljs-built_in">rm</span> <span class="hljs-literal">-rf</span> \<font></font>
      /var/lib/apt/lists/* \<font></font>
      /usr/share/doc \<font></font>
      /usr/share/doc<span class="hljs-literal">-base</span> \<font></font>
      /usr/share/<span class="hljs-built_in">man</span> \<font></font>
      /usr/share/locale \<font></font>
      /usr/share/zoneinfo<font></font>
<span class="hljs-comment">#    Wine</span>
ENV WINEDEBUG=fixme<span class="hljs-literal">-all</span><font></font>
ENV WINEPREFIX=/root/.net<font></font>
ENV WINEARCH=win64<font></font>
<span class="hljs-comment">#  Wine</span><font></font>
RUN winecfg \<font></font>
    <span class="hljs-comment"># winetricks,   .Net Framework  </span>
    &amp;&amp; <span class="hljs-built_in">wget</span> https://raw.githubusercontent.com/Winetricks/winetricks/master/src/winetricks \
    <span class="hljs-literal">-O</span> /usr/local/bin/winetricks \<font></font>
    &amp;&amp; chmod +x /usr/local/bin/winetricks \<font></font>
<span class="hljs-comment"># </span>
    &amp;&amp; apt<span class="hljs-literal">-get</span> <span class="hljs-literal">-y</span> clean \<font></font>
    &amp;&amp; <span class="hljs-built_in">rm</span> <span class="hljs-literal">-rf</span> \<font></font>
      /var/lib/apt/lists/* \<font></font>
      /usr/share/doc \<font></font>
      /usr/share/doc<span class="hljs-literal">-base</span> \<font></font>
      /usr/share/<span class="hljs-built_in">man</span> \<font></font>
      /usr/share/locale \<font></font>
      /usr/share/zoneinfo \<font></font>
    <span class="hljs-comment"># Wine   </span>
    &amp;&amp; wineboot <span class="hljs-literal">-u</span> &amp;&amp; winetricks <span class="hljs-literal">-q</span> dotnet472 &amp;&amp; xvfb<span class="hljs-literal">-run</span> winetricks <span class="hljs-literal">-q</span> vcrun2015<font></font>
<font></font>
WORKDIR /root/.net/drive_c/myconverter/<font></font>
<font></font>
<span class="hljs-comment">#  </span>
<span class="hljs-built_in">COPY</span> /bin/Release/ /root/.net/drive_c/myconverter/<font></font>
<font></font>
ENTRYPOINT [<span class="hljs-string">"wine"</span>, <span class="hljs-string">"MyConverter.exe"</span>]
</code></pre><br>
UPD:        .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">rueler</a><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La construction n'est pas rapide, mais se termine avec succ√®s. </font><font style="vertical-align: inherit;">J'essaye, v√©rifie. </font><font style="vertical-align: inherit;">Travaux!</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©sultats, conclusions, r√©flexions</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√áa a march√©. </font><font style="vertical-align: inherit;">La sortie est une image Linux pour le conteneur Docker. </font><font style="vertical-align: inherit;">Il est ¬´gonfl√©¬ª (~ 5,2 Go), mais il d√©marre assez rapidement et √† l'int√©rieur, il ex√©cute une application de console Windows sur .Net Framework 4.7, qui √©coute RabbitMQ, √©crit des journaux dans </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Graylog</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , t√©l√©charge et t√©l√©charge des fichiers vers / dans Minio. </font><font style="vertical-align: inherit;">Je mettrai √† jour l'application par l'API Docker distant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La solution √† la t√¢che utilitaire d√©di√©e est mise en ≈ìuvre. </font><font style="vertical-align: inherit;">Peut-√™tre, et probablement pas universel. </font><font style="vertical-align: inherit;">Mais en principe, j'√©tais satisfait. </font><font style="vertical-align: inherit;">Peut-√™tre que quelqu'un sera utile aussi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Merci d'avoir lu. </font><font style="vertical-align: inherit;">J'√©cris sur Habr pour la premi√®re fois. </font><font style="vertical-align: inherit;">Rendez-vous dans les commentaires.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr498378/index.html">Annonce de l'√©cole du soir de Slurm par Agile</a></li>
<li><a href="../fr498380/index.html">La fen√™tre d'Overton en action: comment une pand√©mie est utilis√©e pour limiter notre libert√©</a></li>
<li><a href="../fr498390/index.html">IAR + Clion = amiti√©</a></li>
<li><a href="../fr498392/index.html">18 Les fonctionnalit√©s de GitLab deviennent open source</a></li>
<li><a href="../fr498394/index.html">7 analogues gratuits de Screaming Frog et Netpeak Spider</a></li>
<li><a href="../fr498398/index.html">D√©veloppeurs KOMPAS - concepteurs ou programmeurs?</a></li>
<li><a href="../fr498402/index.html">Le glucose et avec quoi il est consomm√©</a></li>
<li><a href="../fr498404/index.html">La vid√©oconf√©rence est simple et gratuite</a></li>
<li><a href="../fr498406/index.html">Comment la personnalit√© d'un brillant jeune programmeur a √©t√© d√©truite</a></li>
<li><a href="../fr498410/index.html">Vivaldi pour PC et Vivaldi pour Android - Jeu d'√©quipe avec score 3.0</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>