<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìï ü§∏ üë©üèª‚Äçü§ù‚Äçüë®üèø Ensamblamos la red ZigBee m√°s simple, programamos bajo Mbed, nos comunicamos a trav√©s de MQTT üå∑ üë®üèø‚Äçü§ù‚Äçüë®üèΩ üåÉ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este art√≠culo es un gran taller de capacitaci√≥n para principiantes sobre el uso del m√≥dulo XBee junto con un microcontrolador que tiene Mbed OS a bord...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Ensamblamos la red ZigBee m√°s simple, programamos bajo Mbed, nos comunicamos a trav√©s de MQTT</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/samsung/blog/497200/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este art√≠culo es un gran taller de capacitaci√≥n para principiantes sobre el uso del m√≥dulo XBee junto con un microcontrolador que tiene Mbed OS a bordo. ZigBee es un est√°ndar largo y firmemente arraigado en los sistemas Smart Home (por ejemplo, se usa junto con Z-Wave en el centro Samsung SmartThings, vea nuestro </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">art√≠culo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), se caracteriza por un bajo consumo de energ√≠a, facilidad de uso y, lo m√°s interesante, la capacidad de crear Redes de malla autoconfigurables. Ver√° en el taller que esto es as√≠, veremos la estructura de dicha red a trav√©s de una pr√°ctica herramienta de visualizaci√≥n.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se supone que ya sabe qu√© es ZigBee y para qu√© sirve. </font><font style="vertical-align: inherit;">Ahora desea conectar su primer m√≥dulo XBee y resolver sus problemas con √©l, sin tener que programar el m√≥dulo en s√≠, sino solo us√°ndolo como interfaz de comunicaci√≥n. </font><font style="vertical-align: inherit;">Al final, enviaremos todos los datos a trav√©s de una puerta de enlace MQTT improvisada en cualquier lugar, incluso a un servidor local, incluso a Internet. </font><font style="vertical-align: inherit;">Decidimos mostrar todo en el ejemplo de Mbed como el RTOS m√°s simple y accesible para principiantes. </font><font style="vertical-align: inherit;">Estar√° convencido de que todo funciona "fuera de la caja", y puede comenzar de inmediato a hacer su proyecto, incluso si antes estaba tratando solo con Arduino.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bp/5i/ot/bp5iota_umzhimxdl5yhgnmflzg.png"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El manual constar√° de las siguientes partes:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conexi√≥n y configuraci√≥n del m√≥dulo XBee</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conecte los m√≥dulos a la red.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuramos el m√≥dulo sin quitarlo del escudo</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recuperaci√≥n de datos</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enviando datos</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hacer una puerta de enlace MQTT simple</font></font><br>
</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero primero, una lista de componentes: lo que es deseable tener para hacer todo lo anterior.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Componentes requeridos</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dos placas compatibles con Mbed. </font><font style="vertical-align: inherit;">Recomendamos el tablero de entrenamiento STM32 Nucleo como relativamente econ√≥mico y popular con fines educativos. </font><font style="vertical-align: inherit;">El proceso de programaci√≥n se simplifica tanto como sea posible: recopile el programa en el IDE gratuito en l√≠nea, descargue el firmware ensamblado y "su√©ltelo" en la placa, que aparecer√° como una unidad flash en el sistema. </font><font style="vertical-align: inherit;">Qu√© modelo espec√≠fico tomar no es importante, pero no tome el m√°s antiguo, preste atenci√≥n a la cantidad de memoria. </font><font style="vertical-align: inherit;">Por ejemplo, F401RE: se lo damos solo para definirlo, para que no se confunda en su variedad y al principio c√≥digos alfab√©ticos incomprensibles de procesadores STM.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ec/y3/nx/ecy3nxhuys7vlrzai3mq4yfzhy8.png" width="350"> <img src="https://habrastorage.org/webt/ec/y3/nx/ecy3nxhuys7vlrzai3mq4yfzhy8.png" width="350"><br>
</li>
<li> XBee-.      Digi.  ¬´¬ª ,  ,  , MBee,  ,    ,     ,      . /        :      ,      .   /  Pro:      ,      ,   Pro   .<br>
<img src="https://habrastorage.org/webt/r2/ed/ew/r2edew1y1gkdpcw9soz-vunnu9q.png"><img src="https://habrastorage.org/webt/m6/-n/aq/m6-naqf0x0qqrjpj-soxa6aulj0.png"><img src="https://habrastorage.org/webt/t2/x5/ng/t2x5ng0wfuoehd4oujmvhf1spha.png" width="200"><br>
</li>
<li>  XBee Shield V2 ( SeeedStudio).      -     ,        RX  TX XBee-.<br>
<img src="https://habrastorage.org/webt/jk/sv/75/jksv75ger3mv3zfwzfji4tliub0.png"><img src="https://habrastorage.org/webt/jk/sv/75/jksv75ger3mv3zfwzfji4tliub0.png"><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un convertidor USB-UART con conector para XBee. </font><font style="vertical-align: inherit;">Es necesario para la configuraci√≥n inicial. </font><font style="vertical-align: inherit;">Los m√≥dulos XBee en s√≠ mismos no est√°n equipados con una interfaz USB (no tienen nada que ver con eso). </font><font style="vertical-align: inherit;">Se necesita USB √∫nica y exclusivamente para la comunicaci√≥n entre el m√≥dulo y la computadora, y en el dispositivo puede funcionar en un UART mucho m√°s simple. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El paso de la ranura de los m√≥dulos XBee es de 2.0 mm; para la electr√≥nica no es est√°ndar, en el sistema m√©trico (generalmente estamos acostumbrados a ver el paso 2.54 de acuerdo con los est√°ndares estadounidenses). </font><font style="vertical-align: inherit;">Por lo tanto, desafortunadamente, dichos m√≥dulos no se insertan en la placa de pruebas y siempre necesitan un adaptador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cualquier adaptador es adecuado aqu√≠, tomamos este de Waveshare:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/04/md/y5/04mdy5mhmm6cfwuj-a21a5eqagy.png" width="300"></li>
</ul><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conexi√≥n y configuraci√≥n del m√≥dulo XBee</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo m√°s simple que puede hacer con el m√≥dulo es conectarlo a la computadora directamente a trav√©s de USB. </font><font style="vertical-align: inherit;">Inmediatamente tendremos acceso a sus par√°metros de configuraci√≥n.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instalar XCTU</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para trabajar con XBee, hay un programa oficial de XCTU. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desc√°rgalo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e inst√°lalo. </font><font style="vertical-align: inherit;">La documentaci√≥n dice que en Ubuntu necesita agregar un usuario a un grupo </font></font><code>dialout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para trabajar con puertos que no sean de un superusuario; haga esto si a√∫n no lo ha hecho:</font></font><br>
<br>
<pre><code class="bash hljs">sudo usermod -a -G dialout &lt;username&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Descargue el archivo zip del enlace, contendr√° un archivo </font></font><code>.run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Debe hacerse ejecutable (a trav√©s </font></font><code>chmod +x _</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de la consola o: bot√≥n derecho del mouse - Propiedades - Permisos) y ejecutarse </font></font><code>./40002881_V.run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es importante comenzar la instalaci√≥n no desde la ra√≠z (sin </font></font><code>sudo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), de lo contrario habr√° problemas m√°s adelante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La configuraci√≥n se parece a esto:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/44/kg/iz/44kgizj3bjlvchzakcksvrh1i_u.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Programa XCTU</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de la instalaci√≥n, puede iniciar el programa ejecutando el archivo </font></font><code>app</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en el directorio donde instal√≥ el programa (por defecto - </font></font><code>~/Digi/XCTU-NG</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La apariencia ser√° la siguiente: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qr/wz/y0/qrwzy0nbyhomwp8g-k26jrluio4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
en este programa, puede agregar su m√≥dulo existente conectado al puerto USB a trav√©s de un adaptador. Haga clic en el bot√≥n Descubrir con una lupa. Aparece una ventana pidi√©ndole que seleccione un puerto: como puede ver, el programa detect√≥ correctamente la presencia de un puerto en el sistema </font></font><code>/dev/ttyUSB0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, este es nuestro adaptador USB-UART.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rs/qr/h1/rsqrh1y2if1z6nr_zl844kdba4o.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La ventana sugiere marcar la b√∫squeda. </font><font style="vertical-align: inherit;">Por supuesto, existe la tentaci√≥n de verificar todo de una vez para encontrar su m√≥dulo. </font><font style="vertical-align: inherit;">Pero luego la b√∫squeda continuar√° por mucho tiempo. </font><font style="vertical-align: inherit;">En la pr√°ctica, tiene sentido dejar las casillas marcadas de forma predeterminada y elegir las opciones m√°s comunes para la velocidad de transferencia de datos, como en la imagen a continuaci√≥n. </font><font style="vertical-align: inherit;">Por lo general, los nuevos m√≥dulos tienen un valor predeterminado de 9600, y para fines de capacitaci√≥n esto es m√°s que suficiente, la velocidad aqu√≠ no es cr√≠tica para nosotros. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/l2/dj/ve/l2djvekjunxaxpxesaxo786q3le.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, si todo tiene √©xito, se le pedir√° que seleccione el m√≥dulo encontrado: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4z/dq/le/4zdqledgifvp92zr4lvm6bat2km.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
se not√≥ un peque√±o error: a veces el m√≥dulo no estaba a una velocidad no est√°ndar, el restablecimiento manual del m√≥dulo con el bot√≥n Restablecer durante la b√∫squeda y el restablecimiento de su velocidad en baudios al est√°ndar (9600) ayud√≥.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cambiar los par√°metros del m√≥dulo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s estamos comprometidos en la configuraci√≥n del m√≥dulo. Se eliminar√°n varios par√°metros, la mayor√≠a de los cuales son inicialmente incomprensibles. Afortunadamente, solo algunos de ellos deber√°n cambiarse para comenzar r√°pidamente. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID de red: ID de PAN.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Una clave de red com√∫n, debe ser la misma para todos los dispositivos para que est√©n conectados independientemente a la red. Ponga cualquier n√∫mero, en nuestro caso hicimos 42. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/t7/dg/lk/t7dglkxhvbkban2romlxiu97qpi.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CE - Coordinador habilitado.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Si hay 1, entonces este m√≥dulo act√∫a como coordinador. Si es 0, el m√≥dulo act√∫a como un enrutador (enrutador); de hecho, simplemente garantiza que los paquetes pasen a trav√©s de la red a trav√©s de s√≠ mismo. La mayor√≠a de los hosts suelen ser enrutadores. Necesitamos un coordinador y dos enrutadores en nuestra red, as√≠ que ponga uno aqu√≠.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n existe la funci√≥n "Dispositivo final": este es un m√≥dulo que no realiza trabajos en la transferencia de paquetes, sino que solo se comunica con otros enrutadores y realiza su √∫til funcionalidad. Por lo general, solo est√° en modo de suspensi√≥n y se despierta a intervalos establecidos y descubre si hay alg√∫n mensaje. Dicho m√≥dulo puede ser alimentado por una bater√≠a, mientras que el enrutador y el coordinador siempre deben estar "en l√≠nea" y, como resultado, necesitan energ√≠a constante para mantener toda la red. No consideraremos este ejemplo ahora, ya que es m√°s interesante para todos asignar el rol de enrutadores y observar c√≥mo la red cambiar√° autom√°ticamente su configuraci√≥n. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0m/zp/e3/0mzpe3yptscx6la-wummlbiixks.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AP - Habilitaci√≥n API.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modo de operaci√≥n. Los m√≥dulos XBee pueden funcionar en dos modos: AT o API. El modo AT es m√°s f√°cil para los principiantes, es un reemplazo transparente del puerto serie y funciona con el m√≥dulo a trav√©s de comandos AT. Sin embargo, el modo API es mucho m√°s rico en funcionalidad, le permite configurar m√≥dulos de forma remota, contiene la direcci√≥n del remitente, devuelve el estado de entrega del paquete y mucho m√°s. Adem√°s, las bibliotecas para interactuar con XBee suponen que el dispositivo se utiliza en el modo API. Por lo tanto, reempl√°celo inmediatamente con el modo API, esto se hace configurando la unidad en el campo correspondiente. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ra/wv/ng/rawvngogy6biagddxsxxx08fhao.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El nombre del m√≥dulo es Identificador de nodo.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Una opci√≥n √∫til para darle a su m√≥dulo un nombre legible por humanos. Vamos a darle ese nombre: coordinador. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xi/h2/fy/xih2fygnbxffyqcyhuwbvn8zhqc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de eso, puede actualizar la configuraci√≥n en el m√≥dulo presionando el bot√≥n con un l√°piz:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pi/8g/xm/pi8gxmplnffs0qmxtckhrfmxrqe.png"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Conecte los m√≥dulos a la red.</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora veremos qu√© tipo de red obtenemos si configuramos tres m√≥dulos. </font><font style="vertical-align: inherit;">El programa XCTU tiene un visualizador de red bastante conveniente, veremos claramente la topolog√≠a. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Configuraremos los tres m√≥dulos a su vez con los siguientes par√°metros:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID de PAN: n√∫mero total, por ejemplo 42</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AP (API Enable): establecido en 1 (funciona en modo API)</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NI (Identificador de nodo): d√© a los m√≥dulos nombres comprensibles (Coordinador, L√°mpara y Interruptor, si estamos haciendo, por ejemplo, un modelo del sistema Smart Home).</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CE (Coordinator Enable): configure uno de los m√≥dulos en 1, ser√° el coordinador.</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego aplique energ√≠a a todos los m√≥dulos. Col√≥quelos as√≠: el coordinador estar√° en el convertidor USB-UART, y los otros dos (enrutadores) se ubicar√°n en las placas XBee Shield en la parte superior de Nucleo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si hiciste todo con cuidado, entonces lo bello suceder√°. Los m√≥dulos se conectar√°n autom√°ticamente a la red. Puede comunicarse con enrutadores de forma remota a trav√©s del coordinador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se parece a esto. Haga clic en el bot√≥n "Descubrir nodos de radio en la misma red". </font></font><br>
<br>
<img src="https://habrastorage.org/webt/em/nf/mx/emnfmxivn4xxt3wtx0pe0f54m8q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ver√° que dos m√≥dulos se detectaron y agregaron autom√°ticamente: ¬° </font></font><br>
<br>
<img src="https://habrastorage.org/webt/j3/ev/gf/j3evgfx0nj0xowanzz3ovdctyks.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
y puede cambiar sus par√°metros sobre la marcha!&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo que sigue siendo genial: ahora puede ver el mapa de red si cambia al modo de trabajo de red en la esquina superior derecha.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sf/2v/ma/sf2vmarm8agrkfjtepgib28sxuq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Habiendo extendido los nodos de la red con el mouse, ver√° un tri√°ngulo. </font><font style="vertical-align: inherit;">Tenga en cuenta que el tr√°fico al m√≥dulo de la derecha puede ir de dos maneras. </font><font style="vertical-align: inherit;">Y si mueve los m√≥dulos en el espacio, ver√° que la imagen ha cambiado, y ahora, tal vez, otro m√≥dulo se volver√° "extremo". </font><font style="vertical-align: inherit;">Esta es la esencia de una red autoconfigurable.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Configure el m√≥dulo XBee sin quitarlo del escudo</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por supuesto, ser√° m√°s interesante trabajar con el m√≥dulo XBee no a trav√©s de una computadora, sino al controlarlo usando un programa en el microcontrolador. </font><font style="vertical-align: inherit;">Es decir, conectarlo a la placa STM32Nucleo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Analicemos c√≥mo el m√≥dulo XBee puede comunicarse con el microcontrolador. </font><font style="vertical-align: inherit;">Y comencemos con una peque√±a tarea: ¬øc√≥mo configurar un m√≥dulo sin quitarlo del escudo de expansi√≥n? </font><font style="vertical-align: inherit;">Debe admitir que mover el m√≥dulo de un lado a otro es inconveniente, al mismo tiempo que desea experimentar con los par√°metros y es extra√±o por qu√© necesita un m√≥dulo USB-UART separado, porque en teor√≠a hay uno en la placa STM32Nucleo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La soluci√≥n es simple: necesitamos convertir la placa Nucleo en un puente entre el m√≥dulo XBee y el convertidor USB de la placa.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descripci√≥n general de la idea.</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El microcontrolador STM32 que utilizamos tiene varias interfaces UART a bordo. Cada una de esas interfaces representa un canal de comunicaci√≥n. Uno de ellos est√° conectado al convertidor USB-UART para que podamos comunicarnos con la computadora a trav√©s de USB en el terminal. Otros dos a√∫n no se utilizan. Conectaremos el m√≥dulo XBee a uno de ellos, que tambi√©n tiene dicho canal de comunicaci√≥n. Puede elegir cualquier UART, hemos elegido por definici√≥n UART1.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El pinout se puede ver en MBed en la esquina superior derecha, presionando el bot√≥n de selecci√≥n del tablero y luego en la pesta√±a Pinout. </font><font style="vertical-align: inherit;">Por costumbre, puede ser bastante dif√≠cil percibir esta colorida imagen. </font><font style="vertical-align: inherit;">Hay muchas cosas aqu√≠, ya que la placa tiene muchas interfaces, y hay dos n√∫meros de pin: relativos al microcontrolador (PA_5, PA_6 - numeraci√≥n de pin), y relativos a la placa (D13, D12 - inscripciones en la placa Nucleo, los mismos n√∫meros cerca de los terminales). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/97/dp/mq/97dpmqw9dmy9lcqtb1hf6i_gyz0.png"><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Resulta que en el microcontrolador, la interfaz UART1 se comunicar√° con el m√≥dulo XBee y UART2, como antes, con la computadora. </font><font style="vertical-align: inherit;">El c√≥digo interno redirigir√° UART1 a UART2 y viceversa. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rp/vk/5w/rpvk5wsdsb8qnz5i_m7dk8q-wwc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por conexiones, se ver√° as√≠:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tp/g7/cs/tpg7cslaiomjx-ogqje-su3q-7s.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hacer un "puente" desde un microcontrolador</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En nuestro caso, podemos usar puentes en el escudo para establecer los n√∫meros a los que queremos conectar el m√≥dulo ZigBee. El m√≥dulo de comunicaci√≥n TX se conectar√° al pin 2 de la placa (PA_9 en el microcontrolador) y RX al pin 8 (tambi√©n conocido como PA_10). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se ver√° as√≠: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/oh/ce/3s/ohce3sq3y1_0_jewruer0dmn36a.png"><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el c√≥digo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que tomamos se llama Serial Bridge. Este es el "puente" entre los dos canales de comunicaci√≥n. Cargamos el c√≥digo en el microcontrolador, que reenv√≠a todo lo que llega a la entrada de la computadora a trav√©s de UART2, a UART1 y viceversa. Como si insert√°ramos una tuber√≠a entre dos fuentes de informaci√≥n (Linuxsoids lo entender√°). Conectamos un m√≥dulo XBee a UART1. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El c√≥digo es muy simple, lo √∫nico que necesita cambiar es el n√∫mero de pin al que est√° conectado el dispositivo. Es decir, hacerlos PA_9 y PA_10, como se indic√≥ anteriormente.</font></font><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"mbed.h"</span></span>
<span class="hljs-comment">// Make a serial bridge from a serial I/O device on mbed to the PC</span>
<span class="hljs-function">Serial <span class="hljs-title">pc</span><span class="hljs-params">(USBTX, USBRX)</span></span>; <span class="hljs-comment">// tx, rx</span>
<span class="hljs-function">Serial <span class="hljs-title">device</span><span class="hljs-params">(PA_9, PA_10)</span></span>; <span class="hljs-comment">// tx, rx</span>
<span class="hljs-comment">// Defaults to 9600 baud on each device - use .baud(baudrate) to change</span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{<font></font>
&nbsp;pc.<span class="hljs-built_in">printf</span>(<span class="hljs-string">"Hello!"</span>);
&nbsp;<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>) {
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>(pc.readable()) {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;device.putc(pc.getc());<font></font>
&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>(device.readable()) {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pc.putc(device.getc());<font></font>
&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es importante que si confunde el orden de las conclusiones, por ejemplo, comete un error y escribe PA_10, PA_9 en lugar de PA_9, PA_10, el orden incorrecto, el compilador no le informar√° un error y el programa mostrar√° un error en la consola al reiniciar:</font></font><br>
<pre><code class="plaintext hljs">pinmap not found for peripheral</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
y no avanzar√°, es decir, en principio, nada funcionar√°. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de descargar este c√≥digo y configurar correctamente los puentes en el escudo, puede conectarse de forma segura al m√≥dulo XBee desde la computadora, tal como lo hizo anteriormente con el adaptador USB-UART sin quitarlo del escudo. </font><font style="vertical-align: inherit;">Ser√° detectado regularmente por el programa XCTU. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Incluso si no necesita esta funcionalidad, a√∫n verifique que el programa est√© funcionando, porque en el siguiente ejemplo nos comunicaremos con el m√≥dulo XBee desde el microcontrolador, y la conexi√≥n a trav√©s de UART1 ya deber√≠a estar establecida (es decir, los puentes est√°n configurados correctamente y los n√∫meros de pin est√°n indicados en el programa) .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Adquisici√≥n de datos.</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veamos dos ejemplos simples: c√≥mo recibir y enviar datos a nivel de microcontrolador, utilizando el m√≥dulo XBee como interfaz de comunicaci√≥n externa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay una </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">biblioteca</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oficial </font><font style="vertical-align: inherit;">de fabricantes: compa√±√≠as Digi. </font><font style="vertical-align: inherit;">Se encuentra en el repositorio de Mbed, hay comentarios √∫tiles sobre el uso y la l√≥gica del c√≥digo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primero, aprenderemos c√≥mo obtener datos; hay un ejemplo m√°s f√°cil. </font><font style="vertical-align: inherit;">Tendremos un m√≥dulo XBee conectado al convertidor USB-UART, enviaremos un saludo a la placa Nucleo e imprimir√° este saludo a la consola. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zg/ic/u5/zgicu5mh8dvsy8y8aegzetdoew8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abre el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proyecto</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en esta biblioteca. </font><font style="vertical-align: inherit;">Como siempre, imp√≥rtelo al compilador en l√≠nea como un programa.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arreglar bibliotecas para m√≥dulos S2C</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tenga en cuenta que si tiene m√≥dulos de la serie S2C: en </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hc/vr/kb/hcvrkbswx5s8hspbos6djkmxfko.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
lugar de la biblioteca est√°ndar, debe usar la soluci√≥n: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XBeeLib_Fixed</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">De lo contrario, estos programas no funcionar√°n. </font><font style="vertical-align: inherit;">Se agrega al proyecto simplemente quitando la biblioteca XBeeLib de all√≠ e import√°ndola al proyecto XBeeLibFix. </font><font style="vertical-align: inherit;">Nada m√°s necesita ser cambiado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces: importe esta biblioteca al compilador en l√≠nea: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ko/vq/e9/kovqe9zqdl7553_kivabf8bedv0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
aparecer√° la ventana de importaci√≥n del proyecto. </font><font style="vertical-align: inherit;">All√≠ debe elegir el destino, donde importamos: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bx/pt/vt/bxptvt2ctwcv87vl-b1qi5upi4s.png" width="500"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
como proyecto de destino, seleccione nuestro ejemplo XBeeZB_Receive_Data. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7q/lj/hg/7qljhgp7jx5yt9875cqijnfopcs.png" width="500"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de lo cual la biblioteca se importar√° al proyecto, y luego con un movimiento en negrita eliminaremos la versi√≥n incorrecta de XBeeLib.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/iw/hz/or/iwhzor7bqjopgpigyi4_lfiv43e.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compilaci√≥n de ejemplo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, import√≥ el ejemplo y reemplaz√≥ la biblioteca en √©l si es necesario. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mire el c√≥digo de muestra, es bastante simple. </font><font style="vertical-align: inherit;">Define una funci√≥n de devoluci√≥n de llamada que se llama cuando se recibe un paquete. </font><font style="vertical-align: inherit;">Esta funci√≥n imprime el contenido del paquete recibido en la consola. </font><font style="vertical-align: inherit;">Entonces, si le enviamos un saludo, ella tambi√©n lo imprimir√°. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para que se compile el ejemplo, debe escribir en el ejemplo las conclusiones de las que somos responsables de comunicarnos con el m√≥dulo XBee, porque el programa no sabe a qu√© conclusiones conectamos el hardware. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, vamos al archivo config.h y las l√≠neas que contiene:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//#define RADIO_TX NC /* <span class="hljs-doctag">TODO:</span> specify your setup's Serial TX pin connected to the XBee module DIN pin */</span>
<span class="hljs-comment">//#define RADIO_RX NC /* <span class="hljs-doctag">TODO:</span> specify your setup's Serial RX pin connected to the XBee module DOUT pin */</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Descomente, y en lugar de NC, escribimos, de acuerdo con qu√© conclusiones conectamos los puentes:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RADIO_TX PA_9</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RADIO_RX PA_10</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Del mismo modo, modificamos las l√≠neas:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//#define DEBUG_TX NC /* <span class="hljs-doctag">TODO:</span> specify your setup's Serial TX for debugging */</span>
<span class="hljs-comment">//#define DEBUG_RX NC /* <span class="hljs-doctag">TODO:</span> specify your setup's Serial RX for debugging (optional) */</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nosotros escribimos:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DEBUG_TX USBTX</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DEBUG_RX USBRX</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si encuentra un error durante la compilaci√≥n que no puede encontrar </font></font><code>device.h</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, simplemente actualice la biblioteca Mbed en el √°rbol del proyecto (haga clic con el bot√≥n derecho en √©l -&gt; Actualizar). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de eso, el programa se compilar√° correctamente y podr√° descargarlo en el tablero.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejecutando ejemplo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de mirar en la consola lo que escribe la placa Nucleo, ver√° lo siguiente: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/as/mk/fb/asmkfbne30jznt7bzqvr2vjhl5e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øC√≥mo enviamos datos? </font><font style="vertical-align: inherit;">La opci√≥n m√°s f√°cil: a trav√©s de la consola en el programa XCTU. </font><font style="vertical-align: inherit;">Seleccione en el men√∫ principal del programa: Herramientas - Enviar paquetes. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ko/9b/7q/ko9b7qwhvwszyezghvzpbs1py74.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la parte inferior hay una ventana con las palabras Enviar paquetes. </font><font style="vertical-align: inherit;">Cree un nuevo paquete haciendo clic en el "m√°s" a la derecha. </font><font style="vertical-align: inherit;">Aparecer√° una ventana para crear un nuevo paquete. </font><font style="vertical-align: inherit;">Seleccione la pesta√±a HEX all√≠. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jc/cf/wz/jccfwz6aesmjic-ncukw8ot1ls8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ingrese all√≠ el env√≠o de datos: </font></font><br>
<code>7E 00 19 10 01 00 00 00 00 00 00 FF FF FF FE 00 00 48 65 6C 6C 6F 20 58 42 65 65 21 5A</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(usando el bot√≥n "Enviar paquete seleccionado" a la derecha de la lista de paquetes) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ver√° el resultado en la consola del m√≥dulo de escucha:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/55/tg/mk/55tgmkipu_8dk33yhqdxxqa90du.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tenga en cuenta que solo imprimi√≥ la √∫ltima parte del conjunto de bytes que envi√≥. </font><font style="vertical-align: inherit;">Esta es la carga √∫til real del mensaje. </font><font style="vertical-align: inherit;">Tambi√©n tenga en cuenta que si env√≠a "solo bytes" (cualquier combinaci√≥n aleatoria de bytes), el receptor no los emitir√°. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si coloca un conjunto de bytes:&nbsp; </font></font><br>
<code>48 65 6C 6C 6F 20 58 42 65 65 21</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
en cualquier convertidor HEX-ASCIII (por ejemplo, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uno</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), aseg√∫rese de que significa "¬°Hola XBee!" </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una tarea muy simple para la ejecuci√≥n independiente: modifique el c√≥digo de ejemplo para que muestre el texto del mensaje en ASCII, no HEX, y pueda leer este texto en el terminal.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Env√≠o de datos</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por analog√≠a con el ejemplo anterior, ahora consideramos enviar datos. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bp/5i/ot/bp5iota_umzhimxdl5yhgnmflzg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo est√° aqu√≠, como en el ejemplo anterior. </font><font style="vertical-align: inherit;">Solo con la diferencia de que ahora estamos abriendo el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ejemplo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> XBeeZB_Send_Data.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compilaci√≥n de ejemplo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es importante que si tiene un m√≥dulo S2C (est√° claramente escrito en √©l), </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hc/vr/kb/hcvrkbswx5s8hspbos6djkmxfko.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
volver√° a conectar la biblioteca con una soluci√≥n, de lo contrario, nada funcionar√° para usted. C√≥mo hacer esto se describe en el ejemplo anterior.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, aqu√≠ para una compilaci√≥n exitosa, debe especificar los pines del controlador utilizados, simplemente puede copiarlos del ejemplo anterior. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nos fijamos en el c√≥digo de ejemplo en s√≠. Se </font></font><code>main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utiliza varios m√©todos para enviar datos. Elija el m√°s simple: env√≠e datos al coordinador. Ni siquiera necesitamos registrar la direcci√≥n del coordinador, porque √©l ya est√° registrado en la red. Por lo tanto, sin cambiar la muestra, comentamos mientras todas las l√≠neas al final:</font></font><br>
<pre><code class="cpp hljs">send_data_to_coordinator(xbee);
<span class="hljs-comment">//send_broadcast_data(xbee);</span>
<span class="hljs-comment">//send_data_to_remote_node(xbee, remoteDevice);</span>
<span class="hljs-comment">//send_explicit_data_to_remote_node(xbee, remoteDevice);</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y cuando comience, ver√° esto: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/su/pp/sj/suppsjbb95cdiavs1svsj1ixctm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(si no lo ve, simplemente reinicie el tablero) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øC√≥mo puedo asegurarme de que los datos lleguen al coordinador? Por ejemplo, XCTU tiene modo de consola de red. Encendido por el bot√≥n en la esquina superior derecha. En este modo, ver√° todos los paquetes en la red. Por supuesto, al mismo tiempo, debe tener una conexi√≥n en serie con el coordinador. Y no olvides hacer clic en el bot√≥n Abrir en la esquina superior izquierda para que quede verde. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yz/st/vy/yzstvyfb4ed2rkbgvmgushy1gkg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede ver informaci√≥n detallada sobre cada paquete en la red seleccion√°ndolo en la lista de la izquierda: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fl/2w/_f/fl2w_fotyjqzbmdpt9tp6fvyyba.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
desplaz√°ndose hasta el final del contenido del paquete, ver√° una l√≠nea con el texto "send_data_to_coordinator":</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vm/da/ha/vmdahazkjgs7ttk_d-hg6osq7oi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede probar otros m√©todos de env√≠o de datos, pero all√≠ (por ejemplo, para enviar a un nodo seleccionado por separado) debe registrar la direcci√≥n del nodo. </font><font style="vertical-align: inherit;">Puede ver las direcciones de todos los m√≥dulos en el programa XCTU. </font><font style="vertical-align: inherit;">C√≥mo registrar direcciones espec√≠ficas se describe exhaustivamente en el ejemplo.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. Hacemos la pasarela MQTT</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo es genial, pero ahora me gustar√≠a trabajar de alguna manera con estos datos fuera de la red XBee, por ejemplo, en Internet. </font><font style="vertical-align: inherit;">Una forma de hacerlo es colocar el traductor de XBee en el popular protocolo MQTT. </font><font style="vertical-align: inherit;">Luego, de la manera habitual, podremos suscribirnos a notificaciones de eventos y enviar comandos desde la interfaz de usuario, y este programa puede ubicarse en cualquier lugar (si usa un servidor MQTT externo, en lugar de local), y no solo en nuestra computadora. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n hay una instrucci√≥n. </font><font style="vertical-align: inherit;">En resumen, el programa lanzado en la computadora intercambiar√° datos del coordinador de red a trav√©s de una conexi√≥n USB. </font><font style="vertical-align: inherit;">Ella transmitir√° estos datos al protocolo MQTT.</font></font><br>
<img src="https://habrastorage.org/webt/t0/yo/dx/t0yodx2oqigqjepdzr0w8exjwaq.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instalar y configurar XBMQ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El programa que usaremos como puerta de enlace MQTT se llama XBMQ, es abierto y gratuito. </font><font style="vertical-align: inherit;">Existe en dos versiones:</font></font><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NodeJS</font></font></a><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se considerar√° la versi√≥n de Java, aunque esto no es demasiado fundamental: no lo programaremos de todos modos, solo lo instalaremos y lo utilizaremos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para que el programa funcione, necesitar√° la biblioteca RXTX, se puede instalar simplemente desde el repositorio:</font></font><br>
<pre><code class="bash hljs">sudo apt-get install librxtx-java</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y, por supuesto, necesita el JDK (Kit de desarrollo de Java). </font><font style="vertical-align: inherit;">Existe en dos versiones: de Oracle y OpenJDK, se recomienda la segunda. </font><font style="vertical-align: inherit;">Lo m√°s probable es que OpenJDK ya est√© instalado en su sistema; de lo contrario, vuelva a instalarlo. </font><font style="vertical-align: inherit;">Java necesita un m√°ximo de 8¬∫ puesto que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">javax.xml.bind est√° excluido de Java 11</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y debe elegir una alternativa con JDK-8 como opci√≥n predeterminada, o crear una configuraci√≥n para este caso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Descargue el repositorio del programa XBMQ:</font></font><br>
<pre><code class="bash hljs">git <span class="hljs-built_in">clone</span> https://github.com/angryelectron/xbmq-java</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de descargar los c√≥digos fuente, recopilaremos el archivo binario del programa. </font><font style="vertical-align: inherit;">Equipo</font></font><br>
<pre><code class="bash hljs">ant dist</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ensamblar√° un proyecto para todos los principales sistemas operativos. </font><font style="vertical-align: inherit;">El programa compilado final estar√° en la carpeta </font></font><code>dist</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora configure este programa. </font><font style="vertical-align: inherit;">Abrir documento</font></font><pre><code class="plaintext hljs">dist/xbmq.properties</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 y mira all√≠:</font></font><br>
<pre><code class="bash hljs"><span class="hljs-comment">#</span>
<span class="hljs-comment"># Xbmq Properties.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#port = /dev/ttyUSB0</span>
<span class="hljs-comment">#baud = 9600</span>
<span class="hljs-comment">#rootTopic = ab123</span>
<span class="hljs-comment">#broker = tcp://test.mosquitto.org:1883</span>
<span class="hljs-comment">#username = user</span>
<span class="hljs-comment">#password = password</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Descomente y cambie sus par√°metros. </font><font style="vertical-align: inherit;">Los par√°metros aqu√≠ son: puerto de conexi√≥n del coordinador de ZigBee, velocidad, tema ra√≠z (todos los datos caer√°n en √©l), direcci√≥n del servidor MQTT, nombre de usuario y contrase√±a (si el servidor los requiere). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este ejemplo, solo la direcci√≥n del servidor ha cambiado: al servidor mqtt local (mosquitto est√°ndar de Linux). </font><font style="vertical-align: inherit;">Todo lo dem√°s se dej√≥ por defecto:</font></font><br>
<pre><code class="bash hljs"><font></font>
port = /dev/ttyUSB0<font></font>
baud = 9600<font></font>
rootTopic = ab123<font></font>
broker = tcp://127.0.0.1:1883<font></font>
username = user<font></font>
password = password<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes del siguiente paso, debe instalar y ejecutar el servidor local mosquitto MQTT:&nbsp;</font></font><br>
<pre><code class="bash hljs">sudo apt-get install mosquitto</code></pre><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lanzamiento XBMQ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finalmente, el programa puede ser lanzado. </font><font style="vertical-align: inherit;">Despu√©s de haber conectado el convertidor USB-UART con el m√≥dulo coordinador insertado, ejecute el programa:</font></font><br>
<pre><code class="bash hljs">./dist/xbmq.sh</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando ejecuta el script, vemos la l√≠nea en la consola:</font></font><br>
<pre><code class="bash hljs">INFO - Starting XBMQ gateway ab123/0013A2004154EA46</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por √∫ltimo, esta es exactamente la direcci√≥n de nuestro coordinador. </font><font style="vertical-align: inherit;">Si se suscribe a todos los temas con un cliente MQTT externo, ver√° inmediatamente 2 mensajes:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En el tema </font></font><code>ab123/0013A2004154EA46/online</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: ser√° 1, esta es √öltima Voluntad (un buen ejemplo de c√≥mo se utilizan estos par√°metros "especiales" en la vida real)</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El tema </font></font><code>ab123/0013A2004154EA46/log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contendr√° la misma frase de depuraci√≥n "Iniciando la puerta de enlace XBMQ ..." que ya vio en la consola</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora intente enviar un mensaje desde alg√∫n otro m√≥dulo XBee externo; por ejemplo, tome un ejemplo con el env√≠o de datos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, en el programa MQTT.fx, si se suscribe a todos los temas (#), ver√° esto: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hy/56/5l/hy565luregquqnizlxf7pejdn40.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La ventana del programa MQTT.fx.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Es decir, al ejecutar el ejemplo estudiado anteriormente con el env√≠o de un mensaje al coordinador, veremos este texto ("send_data_to_coordinator") como parte Paquete MQTT. El tema principal com√∫n para nosotros es el especificado en la configuraci√≥n del programa ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ab123</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , puede cambiarlo por su cuenta). Luego viene la direcci√≥n del coordinador, luego la direcci√≥n del m√≥dulo del que proviene el mensaje. Finalmente, este tema se llama DataOut, porque son datos salientes.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por supuesto, ver√° dicha imagen en cualquier otro cliente MQTT, ya sea MQTTLens o incluso</font></font><code>mosquitto_sub</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en la consola </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un par de comentarios finales:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En el buen sentido, este programa deber√≠a funcionar en modo demonio. </font><font style="vertical-align: inherit;">Hay un archivo xbmqd para esto, y README dice c√≥mo usarlo.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tenga en cuenta que, dado que </font></font><code>xbmq</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contiene el puerto, no podemos ejecutar este programa al mismo tiempo que XCTU.</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°Ahora puede trabajar con su sistema utilizando el protocolo MQTT y escribir programas complejos e interesantes! </font></font><br>
<br>
<img src="https://habrastorage.org/webt/g8/kt/h0/g8kth04siprq-9s2uwlli2fp6ae.jpeg" align="left"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tatyana Volkova - La autora del programa de capacitaci√≥n en Internet de las Cosas rastrea "Samsung IT Academy", especialista en programas de responsabilidad social corporativa en el Centro de Investigaci√≥n de Samsung</font></font><br>
</i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es497178/index.html">"1C: ERP" y "1C: CRM": funcionalidad y an√°lisis comparativo de configuraciones</a></li>
<li><a href="../es497184/index.html">Una mirada a las direcciones prometedoras del desarrollo de sistemas de gesti√≥n de datos geol√≥gicos, geof√≠sicos y de campo.</a></li>
<li><a href="../es497186/index.html">¬øC√≥mo es la b√∫squeda de una vacuna contra el coronavirus?</a></li>
<li><a href="../es497192/index.html">C√≥mo funciona la TI desde la distancia: consejos para administrar equipos distribuidos</a></li>
<li><a href="../es497194/index.html">Tinder sabe m√°s sobre tu vida √≠ntima que tus amigos.</a></li>
<li><a href="../es497204/index.html">Digital 2020: fijando tendencias</a></li>
<li><a href="../es497206/index.html">Acerca de la programaci√≥n orientada a objetos</a></li>
<li><a href="../es497212/index.html">[Instrucci√≥n] Uso de Google-disk, Google-Site, Google-Form para crear un banco de datos y sistemas de comentarios</a></li>
<li><a href="../es497214/index.html">Ingeniero de datos y cient√≠fico de datos: lo que pueden y cu√°nto ganan</a></li>
<li><a href="../es497216/index.html">Hicimos una epidemia de coronavirus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>