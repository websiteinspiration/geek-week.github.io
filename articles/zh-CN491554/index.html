<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â­ï¸ ğŸˆ¸ ğŸ‘¨ğŸ½ æˆ‘ä»¬é€šè¿‡Pythonç»•è¿‡äº†æ¶ˆæ¯API Vkontakteçš„ç¦æ­¢ ğŸ¤²ğŸ» ğŸ›ŒğŸ¼ ğŸœ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å“ˆHa åœ¨æˆ‘çš„ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘è°ˆåˆ°äº†å¯ä»¥é€šè¿‡æ–‡æ¡£è®¿é—®messageséƒ¨åˆ†çš„æ–¹æ³•çš„å¯èƒ½æ€§ï¼Œä¸ºæ­¤ï¼Œè¶³ä»¥ç™»å½•åˆ°VKç«™ç‚¹ã€‚è®¸å¤šäººç„¶åè¯´è¿™ä¸æ˜¯å¯¹ç”¨æˆ·ä¸ªäººæ•°æ®çš„å¨èƒï¼Œå¹¶ä¸”ç¼ºä¹å¹³å°æ— æ³•æŠ½å‡ºä»–ä»¬çš„æ¶ˆæ¯ã€‚å¦å¤–ï¼Œåœ¨æ³¨é‡Šä¸­ï¼Œæˆ‘è¿˜ä¿ç•™äº†æŒ‡å‘node.jsåº“çš„é“¾æ¥ï¼Œè¯¥åº“å¯ä»¥ä½¿ç”¨ç™»å½•å/å¯†ç ç™»å½•å¹¶æä¾›å¯¹æ¶ˆæ¯APIçš„è®¿é—®ï¼Œå¹¶å‡è£…...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>æˆ‘ä»¬é€šè¿‡Pythonç»•è¿‡äº†æ¶ˆæ¯API Vkontakteçš„ç¦æ­¢</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/491554/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å“ˆHa </font><font style="vertical-align: inherit;">åœ¨æˆ‘çš„</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘è°ˆåˆ°äº†å¯ä»¥é€šè¿‡æ–‡æ¡£è®¿é—®messageséƒ¨åˆ†çš„æ–¹æ³•çš„å¯èƒ½æ€§ï¼Œä¸ºæ­¤ï¼Œè¶³ä»¥ç™»å½•åˆ°VKç«™ç‚¹ã€‚</font><font style="vertical-align: inherit;">è®¸å¤šäººç„¶åè¯´è¿™ä¸æ˜¯å¯¹ç”¨æˆ·ä¸ªäººæ•°æ®çš„å¨èƒï¼Œå¹¶ä¸”ç¼ºä¹å¹³å°æ— æ³•æŠ½å‡ºä»–ä»¬çš„æ¶ˆæ¯ã€‚</font><font style="vertical-align: inherit;">å¦å¤–ï¼Œåœ¨æ³¨é‡Šä¸­ï¼Œæˆ‘è¿˜ä¿ç•™äº†æŒ‡å‘</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.jsåº“</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„é“¾æ¥ï¼Œè¯¥</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">åº“</font></a><font style="vertical-align: inherit;">å¯ä»¥ä½¿ç”¨ç™»å½•å/å¯†ç ç™»å½•å¹¶æä¾›å¯¹æ¶ˆæ¯APIçš„è®¿é—®ï¼Œå¹¶å‡è£…æ˜¯å®˜æ–¹åº”ç”¨ç¨‹åºã€‚</font></font><br>
<blockquote><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…è´£å£°æ˜ï¼š</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ¬æ–‡å’Œæ‰€æœ‰ä¹¦é¢ä»£ç ä»…å‡ºäºæ•™è‚²å’Œç ”ç©¶ç›®çš„è€Œåˆ›å»ºï¼Œä»æœªç”¨äºéæ³•æ´»åŠ¨ã€‚</font><font style="vertical-align: inherit;">ä½œè€…ä¸æ•¦ä¿ƒæ‚¨é‡å¤æ­¤å¤„æè¿°çš„ä»»ä½•æ“ä½œï¼Œå¯¹æ­¤ä¸æ‰¿æ‹…ä»»ä½•è´£ä»»ã€‚</font></font></blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰äººéƒ½ç†Ÿæ‚‰javascriptå’Œnode.jsï¼Œæ‰€ä»¥æˆ‘å†³å®šç”¨pythonå†™æˆ‘çš„åº“ï¼Œç°åœ¨å¾ˆå¤šäººéƒ½åœ¨ä½¿ç”¨pythonï¼Œè¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡æ–‡æ¡£çš„â€œæµ‹è¯•è¯·æ±‚â€æä¾›message APIçš„å…¨éƒ¨åŠŸèƒ½ã€‚</font><font style="vertical-align: inherit;">æˆ‘ç«‹å³è¦æ±‚æ‚¨ä¸è¦åœ¨æˆ‘ä¼šé‡å¤è¿‡å»â€œè¯­éŸ³â€çš„åœ°æ–¹ç”Ÿæ°”ï¼Œå› ä¸ºæˆ‘æƒ³ä»¥ç‹¬ç«‹æ–‡æ¡£çš„å½¢å¼æ¥å®‰æ’æœ¬æ–‡ã€‚</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚ä½•ä½¿ç”¨å®ƒï¼Ÿ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥åº“æœ¬èº«ä½äº</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github-aå­˜å‚¨åº“ä¸­</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆåœ¨åŒä¸€ä½ç½®ï¼Œåœ¨examplesæ–‡ä»¶å¤¹ä¸­ï¼Œæœ‰ä¸€ä¸ªè„šæœ¬ä»¥åŠæœ¬æ–‡çš„ä½¿ç”¨ç¤ºä¾‹ï¼‰ã€‚</font><font style="vertical-align: inherit;">è¦å°†å…¶å®‰è£…åœ¨è®¡ç®—æœºä¸Šï¼Œå¯ä»¥åœ¨ç»ˆç«¯ä¸­ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pipå®‰è£…vkæ¶ˆæ¯</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä»è¯¥åŒ…ä¸­å¯¼å…¥ä¸»ç±»å¹¶åˆ›å»ºå®ƒçš„å®ä¾‹ï¼ŒæŒ‡å®šç™»å½•åï¼Œå¯†ç ï¼Œè¯¥å¸æˆ·ä½¿ç”¨çš„æˆæƒç±»å‹ä»¥åŠè¦ä¿å­˜ç”¨æˆ·æˆæƒcookieçš„ç›®å½•ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯å¿…è¦çš„ï¼Œè¿™æ ·ï¼Œå…·æœ‰åŒé‡æˆæƒçš„ç”¨æˆ·ä¸å¿…æ¯æ¬¡è¿è¡Œè„šæœ¬æ—¶éƒ½ä»æ¶ˆæ¯ä¸­ä¸æ–­è¾“å…¥ä»£ç ã€‚</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> vk_messages <span class="hljs-keyword">import</span> MessagesAPI<font></font>
<font></font>
login, password = <span class="hljs-string">'login'</span>, <span class="hljs-string">'password'</span>                                <font></font>
messages = MessagesAPI(login=login, password=password,<font></font>
                                two_factor=<span class="hljs-literal">True</span>, cookies_save_path=<span class="hljs-string">'sessions/'</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å®é™…ä¸Šï¼Œä»…æ­¤è€Œå·²ã€‚</font><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬åªéœ€è¦æ‰“å¼€æ–‡æ¡£å¹¶ä½¿ç”¨æˆ‘ä»¬æ„Ÿå…´è¶£çš„æ–¹æ³•å³å¯ã€‚</font><font style="vertical-align: inherit;">æˆ‘æƒ³ç«‹å³æ³¨æ„åˆ°ï¼Œè¿™ç§æ–¹æ³•ä½¿æˆ‘ä»¬å‡ ä¹å¯ä»¥ä½¿ç”¨æ–‡æ¡£ä¸­çš„ä»»ä½•æ–¹æ³•ï¼Œç”šè‡³ä¸æ¶ˆæ¯éƒ¨åˆ†æ— å…³ï¼š</font></font><br>
<br>
<pre><code class="python hljs">history = messages.method(<span class="hljs-string">'messages.getHistory'</span>, user_id=<span class="hljs-string">'1234567'</span>, count=<span class="hljs-number">5</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬è¿˜å¯ä»¥å°†æ­¤åº“ä¸å…¶ä»–åº“ç»“åˆä½¿ç”¨ï¼Œä¾‹å¦‚ï¼Œé€šè¿‡</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vk_apiï¼Œ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥ä»è®¡ç®—æœºä¸Šè½½ç…§ç‰‡ï¼ˆæ­¤æ“ä½œçš„ä»£ç åœ¨å…¶ç¤ºä¾‹éƒ¨åˆ†ä¸­æä¾›ï¼‰ï¼Œå¹¶é€šè¿‡vk_messageså°†è¿™äº›é™„ä»¶é™„åŠ åˆ°æ¶ˆæ¯ä¸Šï¼š</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> vk_messages.utils <span class="hljs-keyword">import</span> get_random<font></font>
<font></font>
messages.method(<span class="hljs-string">'messages.send'</span>, user_id=peer_id, message=<span class="hljs-string">'Hello'</span>,<font></font>
            attachment=<span class="hljs-string">'photo123456_7891011'</span>, random_id=get_random())
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å‡ºäºå¥½å¥‡ï¼Œæˆ‘å®ç°äº†ç»å…¸åŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½åœ¨ç»™å®šçš„æ–‡ä»¶å¤¹ä¸­åˆ›å»ºäº†ä¸€ä¸ªä¸ä¹‹äº¤è°ˆçš„äººçš„å­æ–‡ä»¶å¤¹ï¼Œå¹¶è¯•å›¾æå–å‡ºæœ€æ–°æ¶ˆæ¯å’Œç…§ç‰‡çš„ç»å¯¹URLã€‚</font><font style="vertical-align: inherit;">å¹¸è¿çš„æ˜¯ï¼Œä¸€åˆ‡éƒ½åƒæ—¶é’Ÿä¸€æ ·å·¥ä½œï¼Œå¹¶ä¸”æ²¡æœ‰ä¸å¿…è¦çš„é”™è¯¯ï¼š</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> vk_messages.utils <span class="hljs-keyword">import</span> fast_parser<font></font>
<font></font>
fast_parser(messages, path=<span class="hljs-string">'parsing/'</span>,                    <font></font>
       count_conv=<span class="hljs-number">10</span>, messages_deep=<span class="hljs-number">400</span>, photos_deep=<span class="hljs-number">100</span>) 
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œæˆ‘æƒ³è¿›å…¥è¯¥åº“æœ€æœ‰è¶£çš„éƒ¨åˆ†ä¹‹ä¸€ï¼šæ‹¥æœ‰æˆæƒcookieï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œä»»ä½•æ“ä½œã€‚è®©æˆ‘ç»™ä½ ä¸€ä¸ªä¸ªäººçš„ä¾‹å­ï¼Œå½“æˆ‘è¦æˆä¸ºè¯¥å°ç»„æˆå‘˜çš„å¸–å­æ—¶ï¼Œæˆ‘å¿…é¡»åˆ¶ä½œä¸€ä¸ªåŒ…å«å¸–å­IDåŠå…¶</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½œè€…</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„è¡¨æ ¼</font><font style="vertical-align: inherit;">ã€‚ä½†æ˜¯è¦æ³¨æ„çš„æ˜¯ï¼šå®˜æ–¹apiåªè¿”å›</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‘è¡¨è¯¥</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–‡ç« çš„äººã€‚ä½¿ç”¨å—…æ¢å™¨ï¼Œæˆ‘çœ‹åˆ°å½“æ‚¨å°†é¼ æ ‡æ‚¬åœåœ¨å‘å¸ƒåçš„æ—¥æœŸæ—¶ï¼Œå°†ä»æœåŠ¡å™¨ä¸Šä¸‹è½½æ­¤æ•°æ®ã€‚ä¹‹åï¼Œæˆ‘ç¼–å†™äº†ä¸€ä¸ªåŒ…è£…å™¨ï¼Œä½¿æ‚¨å¯ä»¥å‘é€ä»»æ„æ•°é‡çš„ç±»ä¼¼è¯·æ±‚ï¼Œä»…ä½¿ç”¨å‘å¸ƒé“¾æ¥å’Œæˆæƒcookieæ¥è·å–ä½œè€…ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œå®ƒä»ç„¶åªæ˜¯æ‘†è„±ä¸å¿…è¦çš„æ ‡ç­¾ï¼š</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_creators</span>(<span class="hljs-params">post, cookies</span>):</span>
    group = -int(post.split(<span class="hljs-string">'_'</span>)[<span class="hljs-number">0</span>])<font></font>
    response = requests.post(<span class="hljs-string">'https://vk.com/al_page.php'</span>, cookies=cookies,<font></font>
               data=<span class="hljs-string">f"_ads_group_id=<span class="hljs-subst">{group}</span>&amp;act=post_author_data_tt&amp;al=1&amp;raw=<span class="hljs-subst">{post}</span>"</span>)<font></font>
<font></font>
    response_json = json.loads(response.text[<span class="hljs-number">4</span>:])[<span class="hljs-string">'payload'</span>][<span class="hljs-number">1</span>]
    <span class="hljs-keyword">return</span> response_json[<span class="hljs-number">0</span>]<font></font>
<font></font>
authors = get_creators(post=<span class="hljs-string">'-12345_67890'</span>,<font></font>
                    cookies=messages.get_cookies())<font></font>
print(authors)   <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯æœ€ä¸Šé¢çš„ä»£ç å‘æˆ‘ä»¬è¯æ˜äº†ä»€ä¹ˆï¼Ÿ</font><font style="vertical-align: inherit;">æ²¡é”™ï¼Œå³ä½¿VCåœ¨å…¶æ–‡æ¡£ä¸­å…³é—­äº†æµ‹è¯•è¯·æ±‚ï¼Œæˆ‘ä»¬ä¹Ÿå§‹ç»ˆå¯ä»¥æ¨¡æ‹Ÿç”¨æˆ·æ“ä½œå¹¶è·å–å¿…è¦çš„ä¿¡æ¯ã€‚</font><font style="vertical-align: inherit;">ä½œä¸ºä¸€ä¸ªå®éªŒï¼Œæˆ‘åšäº†ä¸€ä¸ªå°åŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡â€œæ»šåŠ¨â€é¡µé¢çš„è¯·æ±‚æ¥æ¥æ”¶ç…§ç‰‡çš„é“¾æ¥ï¼Œè€Œæ— éœ€ä½¿ç”¨å®˜æ–¹APIã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»£ç å¤ªå¤§ï¼Œæ‰€ä»¥æˆ‘å†³å®šå°†å…¶éšè—</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_attachments</span>(<span class="hljs-params">attachment_type, peer_id, count, offset, cookies_final</span>):</span>
    <span class="hljs-keyword">if</span> attachment_type == <span class="hljs-string">'photo'</span>:<font></font>
        session = requests.Session()<font></font>
        parsed = []<font></font>
        <font></font>
        response = session.post(<span class="hljs-string">f'https://vk.com/wkview.php'</span>,<font></font>
                            data=<span class="hljs-string">f'act=show&amp;al=1&amp;dmcah=&amp;loc=im&amp;ref=&amp;w=history<span class="hljs-subst">{peer_id}</span>_photo'</span>, cookies=cookies_final)<font></font>
        <font></font>
        response_json = json.loads(response.text[<span class="hljs-number">4</span>:])<font></font>
        <font></font>
        <span class="hljs-keyword">try</span>:<font></font>
            last_offset = response_json[<span class="hljs-string">'payload'</span>][<span class="hljs-number">1</span>][<span class="hljs-number">2</span>][<span class="hljs-string">'offset'</span>]<font></font>
            count_all = response_json[<span class="hljs-string">'payload'</span>][<span class="hljs-number">1</span>][<span class="hljs-number">2</span>][<span class="hljs-string">'count'</span>]
        <span class="hljs-keyword">except</span>:<font></font>
            last_offset = response_json[<span class="hljs-string">'payload'</span>][<span class="hljs-number">1</span>][<span class="hljs-number">0</span>][<span class="hljs-string">'offset'</span>]<font></font>
            count_all = response_json[<span class="hljs-string">'payload'</span>][<span class="hljs-number">1</span>][<span class="hljs-number">0</span>][<span class="hljs-string">'count'</span>]<font></font>
<font></font>
        <span class="hljs-keyword">while</span> (len(parsed) &lt; count + offset)  <span class="hljs-keyword">and</span> (last_offset != count_all):<font></font>
            response_json = json.loads(response.text[<span class="hljs-number">4</span>:])<font></font>
        <font></font>
            <span class="hljs-keyword">try</span>:<font></font>
                last_offset = response_json[<span class="hljs-string">'payload'</span>][<span class="hljs-number">1</span>][<span class="hljs-number">2</span>][<span class="hljs-string">'offset'</span>]
            <span class="hljs-keyword">except</span>:<font></font>
                last_offset = response_json[<span class="hljs-string">'payload'</span>][<span class="hljs-number">1</span>][<span class="hljs-number">0</span>][<span class="hljs-string">'offset'</span>]<font></font>
<font></font>
            photos_vk =  re.findall(<span class="hljs-string">r'&lt;a href="/photo(\S*)?all=1"'</span>, response_json[<span class="hljs-string">'payload'</span>][<span class="hljs-number">1</span>][<span class="hljs-number">1</span>])<font></font>
            mails =  re.findall(<span class="hljs-string">r"'(\S*)', {img: this ,"</span>, response_json[<span class="hljs-string">'payload'</span>][<span class="hljs-number">1</span>][<span class="hljs-number">1</span>])<font></font>
<font></font>
            <span class="hljs-keyword">for</span> photo, mail <span class="hljs-keyword">in</span> zip(photos_vk, mails):
                <span class="hljs-keyword">if</span> len(parsed) &lt; offset:<font></font>
                    parsed.append(photo)<font></font>
                    <span class="hljs-keyword">continue</span><font></font>
                <font></font>
                response = session.post(<span class="hljs-string">f'https://vk.com/al_photos.php'</span>, cookies=cookies_final,<font></font>
                            data=<span class="hljs-string">f'act=show&amp;al=1&amp;al_ad=0&amp;dmcah=&amp;gid=0&amp;list=<span class="hljs-subst">{mail}</span>&amp;module=im&amp;photo=<span class="hljs-subst">{photo}</span>'</span>)<font></font>
                <font></font>
                response_json = json.loads(response.text[<span class="hljs-number">4</span>:])<font></font>
                photo_size = list(response_json[<span class="hljs-string">'payload'</span>][<span class="hljs-number">1</span>][<span class="hljs-number">3</span>][<span class="hljs-number">0</span>].items())<font></font>
                photo_size.reverse()<font></font>
                <font></font>
                <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(photo_size)):
                    <span class="hljs-keyword">if</span> <span class="hljs-string">'attached_tags'</span> <span class="hljs-keyword">in</span> photo_size[i][<span class="hljs-number">0</span>]:<font></font>
                        photo_size = photo_size[:i]<font></font>
                        <span class="hljs-keyword">break</span><font></font>
            <font></font>
                parsed.append(photo_size) <font></font>
<font></font>
            response = session.post(<span class="hljs-string">f'https://vk.com/wkview.php'</span>, cookies=cookies_final,<font></font>
                    data=<span class="hljs-string">f'act=show&amp;al=1&amp;offset=<span class="hljs-subst">{last_offset}</span>&amp;part=1&amp;w=history<span class="hljs-subst">{peer_id}</span>_photo'</span>)<font></font>
        <font></font>
        <span class="hljs-keyword">return</span> parsed[offset + <span class="hljs-number">3</span> : offset + <span class="hljs-number">3</span> + count]
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å®ƒçœ‹èµ·æ¥ç¬¨é‡å—ï¼Ÿ</font><font style="vertical-align: inherit;">æ˜¯ã€‚</font><font style="vertical-align: inherit;">å®ƒçš„å·¥ä½œé€Ÿåº¦æ¯”å®˜æ–¹APIæ…¢å—ï¼Ÿ</font><font style="vertical-align: inherit;">æ˜¯ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œå¦‚æœVCå¤ºèµ°äº†è®¿é—®æ¶ˆæ¯çš„æœ€åæœºä¼šï¼Œæˆ‘ä»¬æ€»èƒ½æ‰¾åˆ°ä¸€æ¡å‡ºè·¯ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘è¿˜æ³¨æ„åˆ°ï¼Œæˆ‘å°è¯•å°†æ‰€æœ‰å¯èƒ½å‡ºç°é”™è¯¯çš„åœ°æ–¹æ·»åŠ åˆ°åº“ä¸­ï¼ŒåŒ…æ‹¬è§£é‡Šçš„ä¾‹å¤–ï¼Œä½†æ˜¯å¦‚æœæ‚¨å‘ç°ä»»ä½•æœªæ˜¾ç¤ºè§£é‡Šçš„äº‹ä»¶ï¼Œè¯·å‘ŠçŸ¥æˆ‘ã€‚</font></font><br>
<blockquote>,   ,   -   ,       ,          ,    ,       ,          . ,          ,            .<br>
</blockquote><h2>  ?</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯¹äºé‚£äº›å¯¹è„šæœ¬å¹•åå‘ç”Ÿçš„äº‹æƒ…æ„Ÿå…´è¶£çš„äººï¼Œæˆ‘å°†ç®€è¦ä»‹ç»è¦ç‚¹ã€‚åœ¨æˆæƒè¿‡ç¨‹ä¸­ï¼Œä¼šè¿›è¡Œç®€å•çš„è¯·æ±‚è¯·æ±‚æ¥æ¨¡æ‹Ÿç”¨æˆ·çš„ç™»å½•ï¼Œè¯¥è¯·æ±‚ä»…ä¼šæ ¹æ®æˆæƒç±»å‹è€Œç•¥æœ‰å˜åŒ–ï¼Œå¹¶ä¸”åœ¨æˆåŠŸç™»å½•åï¼ŒCookieå°†ä¿å­˜åœ¨pickleæ–‡ä»¶ä¸­ã€‚é€šè¿‡æ–‡æ¡£è¯·æ±‚apiæ—¶ï¼Œä¼šå°†â€œ param_â€æ·»åŠ åˆ°æ‰€æœ‰è‡ªå®šä¹‰å‚æ•°ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåç§»å€¼å°†å˜ä¸ºparam_offsetã€‚åŒæ ·ï¼Œå“ˆå¸Œç åœ¨è¯·æ±‚ä¸­ä¼ è¾“ï¼Œè¯¥å“ˆå¸Œç åŒ…å«åœ¨â€œè¿è¡Œâ€æŒ‰é’®æ ‡è®°çš„data-hashå±æ€§ä¸­ã€‚æ®æˆ‘æ‰€çŸ¥ï¼Œè¯¥å€¼å¯¹äºæ¯ç§æ–¹æ³•éƒ½æ˜¯æ’å®šçš„ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘è¿˜è¦æŒ‡å‡ºä¸€ä¸ªé‡è¦çš„ç‚¹ï¼šå¯†ç æ˜¯ä»¥ANSIç¼–ç å‘é€çš„ï¼Œå…¶ä¸­ä¿„è¯­å­—æ¯çš„å­—ç¬¦ç”¨ç¬¦å·â€œï¼…â€åˆ†éš”ï¼Œå¹¶ä¸”æ­¤ä»£ç è¶³ä»¥å®ç°è¿™ç§è§£ç ã€‚</font><font style="vertical-align: inherit;">å¯¹äºæŸäº›Linuxç”¨æˆ·æ¥è¯´ï¼Œè¿™å¯èƒ½æ˜¯ä¸ªé—®é¢˜ï¼Œå› ä¸ºæ®æˆ‘æ‰€çŸ¥ï¼Œæ­¤æ“ä½œç³»ç»Ÿä¸Šçš„pythoné»˜è®¤ä¸åŒ…å«æ­¤ç¼–ç ã€‚</font></font><br>
<br>
<pre><code class="python hljs">self.password = str(password.encode(<span class="hljs-string">'ANSI'</span>)).replace(<span class="hljs-string">'\\x'</span>, <span class="hljs-string">'%'</span>)[<span class="hljs-number">2</span>:<span class="hljs-number">-1</span>]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦å¤–ï¼Œå¯¹æˆ‘æ¥è¯´ï¼Œé—®é¢˜ä¹‹ä¸€æ˜¯æŸäº›æ–¹æ³•çš„å¥‡æ€ªè¡Œä¸ºã€‚</font><font style="vertical-align: inherit;">ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘äº¤æ¢å‚æ•°ï¼Œè„šæœ¬å¯èƒ½ä¼šè¿”å›æ¯”è¯·æ±‚çš„å“åº”å°10å€çš„å“åº”ï¼Œæˆ–è€…æ ¹æœ¬ä¸è¿”å›ä»»ä½•ä¸œè¥¿ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†è§£å†³æ­¤é—®é¢˜ï¼Œæˆ‘å†³å®šä¸¥æ ¼æŒ‰ç…§æ–‡æ¡£ä¸­æŒ‡ç¤ºçš„é¡ºåºè§£æå’Œå‘é€å‚æ•°ã€‚</font><font style="vertical-align: inherit;">ä¹Ÿè®¸è¿™åªæ˜¯ä¸€ä¸ªç®€å•çš„å·§åˆï¼Œä½†æ˜¯åœ¨å‡ºç°äº†æ­¤ç±»é—®é¢˜ä¹‹åï¼Œæˆ‘æ²¡æœ‰äº†ï¼š</font></font><br>
<br>
<pre><code class="python hljs">response = session.get(<span class="hljs-string">f'https://vk.com/dev/<span class="hljs-subst">{name}</span>'</span>, cookies=self.cookies_final)<font></font>
hash_data =  re.findall(<span class="hljs-string">r'data-hash="(\S*)"'</span>, response.text)<font></font>
<font></font>
soup = BeautifulSoup(response.text, features=<span class="hljs-string">"html.parser"</span>)<font></font>
params = soup.findAll(<span class="hljs-string">"div"</span>, {<span class="hljs-string">"class"</span>: <span class="hljs-string">"dev_const_param_name"</span>})<font></font>
params = [cleanhtml(str(i)) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> params]<font></font>
<font></font>
payload, checker = <span class="hljs-string">''</span>, <span class="hljs-number">0</span>
<span class="hljs-keyword">for</span> param <span class="hljs-keyword">in</span> params:
   <span class="hljs-keyword">if</span> param <span class="hljs-keyword">in</span> kwargs:<font></font>
       checker += <span class="hljs-number">1</span>
       payload += <span class="hljs-string">'&amp;{}={}'</span>.format(<span class="hljs-string">'param_'</span> + \<font></font>
   param, quote(str(kwargs[param]) <span class="hljs-keyword">if</span> type(kwargs[param]) != bool <span class="hljs-keyword">else</span> str(int(kwargs[param]))))<font></font>
        <font></font>
<span class="hljs-keyword">if</span> checker != len(kwargs):
   <span class="hljs-keyword">raise</span> Exception_MessagesAPI(<span class="hljs-string">'Some of the parametrs invalid'</span>, <span class="hljs-string">'InvalidParameters'</span>)
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ€»</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¥½å§ï¼Œå¯¹æˆ‘æ¥è¯´ï¼Œè¿™ä¸ªåº“æ˜¯ç¼–å†™â€œå¼€æ”¾â€é¡¹ç›®çš„ç¬¬ä¸€æ¬¡ç»éªŒï¼Œæ‰€ä»¥æˆ‘è¯·æ‚¨ä¸è¦è®¤çœŸåœ°åˆ¤æ–­å®ƒã€‚</font><font style="vertical-align: inherit;">æˆ‘åªæ˜¯æƒ³å¸®åŠ©ä¸æˆ‘é¢ä¸´åŒæ ·é—®é¢˜çš„äººï¼šæ¶ˆæ¯APIé™åˆ¶ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä¹Ÿéå¸¸æ„Ÿè°¢é‚£äº›å¸®åŠ©æˆ‘æ’°å†™æœ¬æ–‡å’Œæµ‹è¯•ä»£ç çš„æœ‹å‹ã€‚</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN491544/index.html">åœ¨å‰©ä½™çš„å‘¨æœ«é‡Œè¯»äº›ä»€ä¹ˆ-æœ‰å…³ç—…æ¯’ï¼Œé»‘å®¢å’Œâ€œæ•°å­—â€å¡ç‰¹å°”å†å²çš„ä¹¦ç±</a></li>
<li><a href="../zh-CN491546/index.html">Java 14å³å°†åˆ°æ¥</a></li>
<li><a href="../zh-CN491548/index.html">ReactJSå›¾åƒå¤„ç†-NodeJS</a></li>
<li><a href="../zh-CN491550/index.html">æˆ‘ä»¬ç”¨é©¬å°”å¯å¤«é“¾äº§ç”Ÿæ­Œè¯</a></li>
<li><a href="../zh-CN491552/index.html">ä½¿ç”¨Pythonä¸­çš„è‡ªåŠ¨ç¼–ç å™¨è¿›è¡ŒPythonå¼‚å¸¸æ£€æµ‹</a></li>
<li><a href="../zh-CN491556/index.html">Javaå¾®æœåŠ¡ï¼šå®ç”¨æŒ‡å—</a></li>
<li><a href="../zh-CN491558/index.html">æŸ¥æ‰¾æ›´å¤šçš„å¤æ´»èŠ‚å½©è›‹ï¼šä»ç¥ç§˜çš„è®¯æ¯åˆ°æ‰“ç”µè¯æ´—æ‰‹å’Œåšå®¶åº­ä½œä¸šçš„ä¿¡æ¯</a></li>
<li><a href="../zh-CN491560/index.html">å¦‚ä½•ä½¿èˆªç«™æ¥¼æˆä¸ºæ‚¨çš„åŠ©æ‰‹ï¼Œè€Œä¸æ˜¯æ•Œäººï¼Ÿ</a></li>
<li><a href="../zh-CN491562/index.html">FOSSæ–°é—»6-2020å¹´3æœˆ2æ—¥è‡³8æ—¥å…è´¹å’Œå¼€æºæ–°é—»çš„å›é¡¾</a></li>
<li><a href="../zh-CN491564/index.html">Java 14ï¼šè®°å½•ï¼Œæ›´ç®€æ´çš„instanceofï¼ŒjpackageåŒ…è£…å™¨ï¼Œå¼€å…³lambdaå’Œæ–‡æœ¬å—</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>