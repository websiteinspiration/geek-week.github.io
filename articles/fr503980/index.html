<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕋 🤬 🧒🏽 Surveillance de la température sur un site éloigné par des moyens «improvisés» 👬 🧜 🏯</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En 2019, quand il était possible de sortir sans laissez-passer, on m'a demandé de faire un suivi à distance de la température dans la maison du villag...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Surveillance de la température sur un site éloigné par des moyens «improvisés»</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/503980/"><img src="https://habrastorage.org/webt/sz/sx/wa/szsxwal5ggvev3m8b6_gdflrqic.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En 2019, quand il était possible de sortir sans laissez-passer, on m'a demandé de faire un suivi à distance de la température dans la maison du village. Les conditions étaient les suivantes. Il y a une maison privée avec internet, dans la maison il y a une chaudière à gaz pour le chauffage. La chaudière maintient une certaine température dans le système de chauffage, l'allumant et l'éteignant périodiquement. À l'état désactivé, la mèche de secours est activée. La hotte est installée avec des erreurs, donc un vent fort de l'extérieur souffle périodiquement la mèche et le chauffage cesse de fonctionner. Pour qu'en hiver, l'eau du système de chauffage ne gèle pas, vous devez allumer manuellement la mèche. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cette maison, les gens apparaissent une fois par mois, vous ne pouvez donc pas vous passer d'un système de surveillance. Ensuite, l'énoncé du problème et sa mise en œuvre de la manière la plus «paresseuse» que j'ai trouvée en 2 mois.</font></font><br>
<a name="habracut"></a><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Énoncé du problème</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Si la mèche s'éteint, la température dans la maison commence à baisser progressivement. Lorsqu'il descend en dessous de 15 degrés, envoyez une notification par «e-mail» au «client». Le «client» prend lui-même la décision, soit de partir seul, soit d'appeler les voisins qui allument la mèche. Condition principale: «Pas de configuration. Je l'ai apporté, je l'ai allumé et tout fonctionne. » </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sélection de la base des éléments</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'avais 2 mois pour le développement (la tâche était fixée à l'automne, c'était loin du gel). Dans cette situation, l'ESP8266 supplie pour lui-même. Il y a une connexion Wi-Fi dans la maison, des bibliothèques pour mesurer la température sont écrites pour divers capteurs. J'avais à la fois un ESP et un capteur de température DS18b20, j'ai donc reporté ce projet pendant un certain temps en raison du travail principal. Près de 2 mois se sont écoulés et il était temps de proposer une solution toute faite, mais je n'ai pas commencé. J'ai regardé autour de moi et j'ai décidé d'utiliser une solution prête à l'emploi avec quelques modifications. J'avais un contrôleur de maison intelligente basé sur Z-Wave gratuit. Il se compose de RaspberryPi et d'une carte d'extension, ce qui en fait un contrôleur domestique intelligent. RaspberryPi acheté sur Avito pour 1500r. il y a six mois, et j'avais une carte d'extension utilisée. Le nouveau coûte 6000r.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ak/gn/wx/akgnwxiuscrrzzz9vm1vwiuamle.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous achetez tout dans le magasin, le prix est d'environ 13000r. et est appelé le "contrôleur RaZberry." </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je n'avais pas de capteur de température prêt à l'emploi compatible avec l'onde Z. </font></font><br>
<img src="https://habrastorage.org/webt/4w/bh/yj/4wbhyjjyjfqh1o89gr4ppmbkkt4.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je l'ai fait sur la base de ZUNo (dans le magasin à environ 3000r., J'ai obtenu l'un des prototypes gratuitement) et d'un capteur de température scellé DS18B20. </font></font><br>
<img src="https://habrastorage.org/webt/bg/un/da/bgundabhtaylxrckn99nicuoqt0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ZUNo est une carte compatible Arduino avec un émetteur-récepteur radio intégré. Le croquis pour elle a été extrait sans changement du site Web du fabricant ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://z-uno.z-wave.me/examples/1-wire-ds18b20-temperature-sensor/</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) À partir de ce croquis, ZUNo interroge le capteur de température toutes les 30 secondes et envoie une notification au contrôleur par radio. ZUNo ne dort pas en attendant. C’est moi que l’esquisse est primitive, elle n’économise pas de ressources sur le microcontrôleur lui-même ou sur l’électricité. Mais il fait exactement ce dont j'ai besoin! </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ZUNo «soigneusement» rempli d'adhésif thermofusible dans un boîtier en plastique. </font></font><br>
<img src="https://habrastorage.org/webt/2g/3q/ts/2g3qtsd1dgzhkaxgjikfykhqsfg.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De l'étui apporté 2 fils: alimenté par USB et un capteur de température. Il s'est avéré fiable, donc ce n'est pas effrayant de le laisser tomber et ça a l'air décent. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le contrôleur connecté via un câble Ethernet au routeur. Le câble n'a pas pu être utilisé. RaspberryPi peut utiliser le Wi-fi. Mais comme la principale exigence était «activée et oubliée», je n'ai pas pris de risques avec la pré-configuration du réseau wi-fi sur raspberryPi.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le RaspberryPi était connecté à une «charge» de 2 ampères à partir du téléphone. Le capteur de température consomme jusqu'à 50 mA, il est donc connecté au connecteur USB RaspberryPi. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuration de </font><font style="vertical-align: inherit;">framboise</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
 L'image a été prise d'ici </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">storage.z-wave.me/z-way-server</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> appelé « razberry.img.zip ». </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, j'ai </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">installé l'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> image sur la carte SD pour RaspberryPi. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si RaspberryPi a démarré, le serveur Z-way (logiciel pour maison intelligente) sera également lancé. Mais c'est une ancienne version, elle doit être mise à jour. Dans les paramètres, il y a un bouton pour la mise à jour, mais personne ne l'utilise et cela ne fonctionne pas. </font></font><br>
<img src="https://habrastorage.org/webt/oj/md/ob/ojmdobj0ypyg4f2rt59m0uqtvu0.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Il est beaucoup plus «pratique» d'utiliser les instructions de mise à jour. Elle est à cette </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">adresse</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Pour entrer les commandes décrites dans ce manuel, vous devez ouvrir un terminal sur RaspberryPi. </font><font style="vertical-align: inherit;">Cela peut être fait via ssh ou en connectant un moniteur avec un clavier. </font><font style="vertical-align: inherit;">Le deuxième moniteur et le clavier sont toujours avec moi, contrairement au routeur, j'ai donc choisi la deuxième option. </font><font style="vertical-align: inherit;">Étant donné que je développe un système intégré sans surveillance, vous devez fournir une horloge de surveillance pour augmenter la fiabilité. </font><font style="vertical-align: inherit;">Tout de même, RaspberryPi n'est pas un contrôleur industriel et le système Z-wave, il n'est également pas recommandé de l'utiliser dans des décisions critiques; je compterai sur des blocages périodiques, qui ne peuvent être interrompus qu'en redémarrant le logiciel ou l'ensemble du système d'exploitation sur RaspberryPi. </font><font style="vertical-align: inherit;">Je redémarrerai l'intégralité du système d'exploitation tous les jours à midi. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour ce faire, j'ai ajouté une ligne au fichier exécuté après le démarrage du système d'exploitation.</font></font><br>
<pre><code class="python hljs"><span class="hljs-comment">#sudo vi /etc/rc.local</span>
shutdown -r <span class="hljs-number">12</span>:<span class="hljs-number">00</span></code></pre><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Commandes vi de base</font></font></b>
                        <div class="spoiler_text">    <br>
 «i»-   vi<br>
 «:wq!» –     vi<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le capteur de température basé sur ZUNo assemblé n'est également pas idéal, si vous le connectez au RaspberryPi, il redémarrera tous les jours. Améliore ainsi considérablement la fiabilité du système dans son ensemble. Le système d'exploitation reste le point faible, s'il se fige et ne redémarre pas à 12h00 il n'y a rien à faire. Vous devez appeler un "spécialiste" pour déformer la nourriture. Cependant, ce système d'exploitation a été testé et débogué mieux que les autres composants de ce projet (j'espère). Vous devez prendre ce risque. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuration du logiciel du serveur Z-way</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Pour accéder à la partie graphique du logiciel du serveur Z-way, il a alimenté l'équipement et après quelques minutes a utilisé le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">service</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ce service recherche RaspberryPi avec un serveur Z-way fonctionnant sur le réseau local et affiche leurs adresses IP. Vous pouvez également vous connecter à un RaspberryPi distant ici. Pour configurer cela, j'ai choisi un RaspberryPi local. Définissez un nom d'utilisateur et un mot de passe et mémorisez l'ID à six chiffres. Cela suffit pour une connexion à distance. </font></font><br>
<img src="https://habrastorage.org/webt/rj/ag/bu/rjagbunwspmpbw10-zydr2hhfza.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ID pour la connexion à distance. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Ajout d'un capteur de température. Il s'agit d'une action standard. </font></font><br>
<img src="https://habrastorage.org/webt/cl/fh/s2/clfhs2ni524ui0knrehemt9jbm4.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Ajout d'applications-&gt; Applications locales-&gt; Email ME </font></font><br>
<img src="https://habrastorage.org/webt/8w/bp/sn/8wbpsnhpnnt3wbduvmo-mnothse.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) Spécification du nom de l'élément et de l'adresse e-mail avec le texte de la lettre </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4) Ajout de la condition dans laquelle la lettre sera envoyée. Rien de bien compliqué. </font></font><br>
<img src="https://habrastorage.org/webt/ya/gb/iy/yagbiy4qxnhipjy-ibhbjoxgily.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vérification finale </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Connecté RaspberryPi à un routeur via un câble, alimentation appliquée, connecté un capteur thermique.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai refroidi le capteur de température et reçu une lettre, puis une de plus et une autre. Alors que la température est inférieure à 15 degrés, le "client" recevra des lettres. C'est bien, vous ne pourrez pas le manquer. (Pour l'avenir, je dirai que le client n'avait pas de courrier non plus, alors j'ai reçu plusieurs centaines de lettres de mon "idée originale". Mon client de messagerie les a commodément enchaînées et n'a causé aucun inconfort). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour voir rapidement la température de la maison sur le téléphone, j'ai installé l'application Z-way. </font></font><br>
<img src="https://habrastorage.org/webt/ep/l7/-x/epl7-xz8vc3g2yfhvps2-jmnrda.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne peux pas dire que c'est rapide, pratique, mais cela vous permet de vous connecter à distance au serveur Z-way sur RaspberryPi et de regarder la température. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sommaire</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendant 2 soirées, en regardant autour, j'ai monté un système de surveillance de la température pour un objet distant. Auparavant, ZUNo et le contrôleur Razberry étaient considérés comme des jouets coûteux. Mais après le retrait solennel de mon équipement du poste "combat", où il a plusieurs fois déterminé le dysfonctionnement du système de chauffage pendant la saison hivernale, j'ai été respecté par ces produits. Et il y a quelque chose à respecter. Internet et la lumière ont périodiquement disparu, mais après la reprise du classement, la communication a été rétablie. Maintenant, j'ai démonté ce «complexe» en pièces détachées et compris sa principale force. Avoir une carte contrôleur Razberry qui peut être insérée dans RaspberryPi, ou via un adaptateur UART à n'importe quel ordinateur, un ou deux ZUNo, un ensemble de base de capteurs et d'actionneurs les plus simples, vous pouvez résoudre rapidement le problème.Je n'aime pas le mot «facile» et je n'ai pas l'expérience de l'utilisation d'équipements «intelligents» d'autres fabricants, mais en 2 jours, j'ai reçu un ensemble d'équipements prêt à l'emploi qui suffit pour se connecter à l'alimentation, ainsi qu'une application sur un smartphone, une application Web sur un ordinateur et des notifications par e-mail.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr503964/index.html">DataStore - CRUD (Créer la suppression de la mise à jour en lecture)</a></li>
<li><a href="../fr503966/index.html">L'application Social Monitoring a été créée à partir d'un suivi de camion à ordures</a></li>
<li><a href="../fr503968/index.html">Comment faire bouger le robot avec précision? Présentation et fonctionnalités de Studuino Platform Robotics</a></li>
<li><a href="../fr503970/index.html">PuppetConf 2016. Kubernetes pour les administrateurs système. Partie 1</a></li>
<li><a href="../fr503972/index.html">Test de streaming sur 4 réseaux sociaux et choix de la meilleure option</a></li>
<li><a href="../fr503982/index.html">A propos des orcs et des frameworks</a></li>
<li><a href="../fr503988/index.html">Comment la "lumière tourbillonnante" est entrée dans les réseaux optiques</a></li>
<li><a href="../fr503990/index.html">Je suis fatigué du fait que les programmeurs ordinaires usurpent l'identité de développeurs et déshonorent l'industrie. Ils rendent le monde pire</a></li>
<li><a href="../fr503992/index.html">Comment donner une conférence / webinaire sympa: 16 conseils de trois conférenciers en série. Événements Leader-IT # 2</a></li>
<li><a href="../fr503994/index.html">Annonce du webinaire Quest Software sur les stations de travail distantes et la gestion de la cybersécurité</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>