<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧙 🔘 👩🏼‍✈️ バイヤーのディスプレイ上の情報表示 🍉 🦒 ☠️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="カスタマーディスプレイが登場しました。当日の情報、稼働日・週の終わりまでの時間、気象情報、為替レートなどを表示する情報掲示板として活用するのが面白くなりました。
 

同時に、リソースを大量に消費するアプリケーションやPCを使いたくありませんでした。彼はたくさんのミニPC Raspberry + L...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>バイヤーのディスプレイ上の情報表示</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457352/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カスタマーディスプレイが登場しました。</font><font style="vertical-align: inherit;">当日の情報、稼働日・週の終わりまでの時間、気象情報、為替レートなどを表示する情報掲示板として活用するのが面白くなりました。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同時に、リソースを大量に消費するアプリケーションやPCを使いたくありませんでした。</font><font style="vertical-align: inherit;">彼はたくさんのミニPC Raspberry + Linux + Customer Displayに立ち寄りました。</font></font></p><br>
<p><img src="https://habrastorage.org/webt/3n/qb/mt/3nqbmt8mqlfr1-dx4qt2ryruaga.jpeg" alt="@情報付きカスタマーディスプレイ|  センター|  700x0"></p><a name="habracut"></a><br>
<p><img src="https://habrastorage.org/webt/hh/hf/za/hhhfza4bszzcgeya6vwwxljx1vy.jpeg" alt="@Raspberry Pi 2 |  センター|  300x0"></p><br>
<h2 id="neobhodimye-zamechaniya"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要なコメント</font></font></h2><br>
<blockquote>    Linux   Raspberry     .<br>
<br>
     Linux   nano  mcedit.<br>
   -    Linux   Windows        SSH — KiTTY/PuTTY.<br>
     Windows  Linux   WinSCP.<br>
<br>
Bash —   ( ).<br>
Bash —   "Bourne-Again Shell" ("" ).  ,             sh (  shell).<br>
Bash —      .<br>
<br>
       1             Linux.<br>
       .       .</blockquote><br>
<h2 id="chto-ispolzoval"> ?</h2><br>
<ul>
<li>  Raspberry Pi 2 Model B v1.1    Raspbian GNU/Linux 9.4 (stretch).</li>
<li>  POSUA LPOS-VFD USB.</li>
<li>  bash.</li>
</ul><br>
<h2 id="1-etap-podklyuchenie-i-nastroyka-displeya-pokupatelya">1 .     </h2><br>
<p>     USB-   ()    .    :</p><br>
<pre><code class="bash hljs">usb-devices</code></pre><br>
<p>   USB   Raspberry:</p><br>
<pre><code class="bash hljs">T:  Bus=01 Lev=00 Prnt=00 Port=00 Cnt=00 Dev<span class="hljs-comment">#=  1 Spd=480 MxCh= 1</span>
D:  Ver= 2.00 Cls=09(hub  ) Sub=00 Prot=01 MxPS=64 <span class="hljs-comment">#Cfgs=  1</span><font></font>
P:  Vendor=1d6b ProdID=0002 Rev=04.14<font></font>
S:  Manufacturer=Linux 4.14.69-v7+ dwc_otg_hcd<font></font>
S:  Product=DWC OTG Controller<font></font>
S:  SerialNumber=3f980000.usb<font></font>
C:  <span class="hljs-comment">#Ifs= 1 Cfg#= 1 Atr=e0 MxPwr=0mA</span>
I:  If<span class="hljs-comment">#= 0 Alt= 0 #EPs= 1 Cls=09(hub  ) Sub=00 Prot=00 Driver=hub</span><font></font>
<font></font>
T:  Bus=01 Lev=01 Prnt=01 Port=00 Cnt=01 Dev<span class="hljs-comment">#=  2 Spd=480 MxCh= 5</span>
D:  Ver= 2.00 Cls=09(hub  ) Sub=00 Prot=02 MxPS=64 <span class="hljs-comment">#Cfgs=  1</span><font></font>
P:  Vendor=0424 ProdID=9514 Rev=02.00<font></font>
C:  <span class="hljs-comment">#Ifs= 1 Cfg#= 1 Atr=e0 MxPwr=2mA</span>
I:  If<span class="hljs-comment">#= 0 Alt= 1 #EPs= 1 Cls=09(hub  ) Sub=00 Prot=02 Driver=hub</span><font></font>
<font></font>
T:  Bus=01 Lev=02 Prnt=02 Port=00 Cnt=01 Dev<span class="hljs-comment">#=  3 Spd=480 MxCh= 0</span>
D:  Ver= 2.00 Cls=ff(vend.) Sub=00 Prot=01 MxPS=64 <span class="hljs-comment">#Cfgs=  1</span><font></font>
P:  Vendor=0424 ProdID=ec00 Rev=02.00<font></font>
C:  <span class="hljs-comment">#Ifs= 1 Cfg#= 1 Atr=e0 MxPwr=2mA</span>
I:  If<span class="hljs-comment">#= 0 Alt= 0 #EPs= 3 Cls=ff(vend.) Sub=00 Prot=ff Driver=smsc95xx</span><font></font>
<font></font>
T:  Bus=01 Lev=02 Prnt=02 Port=01 Cnt=02 Dev<span class="hljs-comment">#=  4 Spd=12  MxCh= 0</span>
D:  Ver= 2.00 Cls=00(&gt;ifc ) Sub=00 Prot=00 MxPS= 8 <span class="hljs-comment">#Cfgs=  1</span><font></font>
P:  Vendor=0000 ProdID=0131 Rev=01.00<font></font>
S:  Manufacturer=www.posua.com<font></font>
S:  Product=POSua LPOS-II-VFD USB CDC<font></font>
C:  <span class="hljs-comment">#Ifs= 2 Cfg#= 1 Atr=a0 MxPwr=16mA</span>
I:  If<span class="hljs-comment">#= 0 Alt= 0 #EPs= 3 Cls=02(commc) Sub=02 Prot=01 Driver=usbserial_generic</span>
I:  If<span class="hljs-comment">#= 1 Alt= 0 #EPs= 2 Cls=03(HID  ) Sub=00 Prot=00 Driver=usbhid</span></code></pre><br>
<p>      <strong>Product=POSua LPOS-II-VFD USB CDC</strong>.    .       Vendor=0000 ProdID=0131 Rev=01.00.   <strong>vendor=0000 prodID=0131</strong>.    .</p><br>
<p>          USB   .     :</p><br>
<pre><code class="bash hljs">sudo modprobe usbserial vendor=0x0000 product=0x0131</code></pre><br>
<p><code>modprobe</code> —       Linux. <code>usbserial</code> —      COM-  USB . 0x –   .</p><br>
<p>      USB-,    Linux    <em>ttyUSB0</em>.         Linux –      .      <code>/dev</code>.</p><br>
<p>        :</p><br>
<pre><code class="bash hljs">stty -F /dev/ttyUSB0 9600</code></pre><br>
<p><code>stty</code> —     /  . <code>-F</code> — .      <code>/dev/ttyUSB0</code>.       9600 .</p><br>
<p>      (  ):</p><br>
<pre><code class="bash hljs"><span class="hljs-built_in">echo</span> <span class="hljs-string">"Hello!"</span> &gt; /dev/ttyUSB0</code></pre><br>
<p>   ,      .    .</p><br>
<h2 id="2-etap-programmirovanie">2 . </h2><br>
<p>            .     .</p><br>
<p>     :</p><br>
<pre><code class="bash hljs"><span class="hljs-built_in">echo</span> -e -n <span class="hljs-string">"\x0c\x0b"</span> &gt; /dev/ttyUSB0</code></pre><br>
<p><code>echo</code> —    .  <code>-e</code> —    escape-, <code>-n</code> — ,      .   <code>-en</code>.</p><br>
<blockquote> ,      <code>\</code>,       ,  escape-.</blockquote><p><code>0</code> —       , <code>0b</code> —       .  <code>&gt;</code> —   ( ).      <em>/dev/ttyUSB0</em>  .     <code>echo "Hello!"</code>,      ,   .</p><br>
<p>,             :</p><br>
<pre><code class="bash hljs">stty 9600 &lt; /dev/ttyUSB0</code></pre><br>
<p>        :</p><br>
<pre><code class="bash hljs"><span class="hljs-built_in">echo</span> -n <span class="hljs-string">"!"</span> | iconv -f UTF-8 -t CP866 &gt; /dev/ttyUSB0</code></pre><br>
<p><code>|</code> —        ().      "!"      ,    ""  iconv. <code>iconv</code> —      .<br>
  bash        ,    -.</p><br>
<blockquote> —       .</blockquote><p> ,  bash ,   ""     <strong>#!/bin/bash</strong>.        :</p><br>
<pre><code class="bash hljs">sudo chmod u+x namefile.sh</code></pre><br>
<p> namefile.sh —  .  sh — ,   - bash. <code>chmod</code> –         . <code>u+x</code> —        .</p><br>
<p>    .   —  (<em>dispos.sh</em>).        .  —  (<em>parse.sh</em>)   ,         .        .</p><br>
<p> ,    ,   :</p><br>
<pre><code class="bash hljs">sudo chmod +x dispos.sh<font></font>
sudo chmod +x parse.sh</code></pre><br>
<p> ,    <code>+x</code>.  ""  <code>u+x</code>.</p><br>
<p>     .      crontab.    :</p><br>
<pre><code class="bash hljs">crontab -e</code></pre><br>
<p>    :</p><br>
<pre><code class="bash hljs">*/20 * * * * /home/pi/parse.sh<font></font>
*/1 * * * * /home/pi/dispos.sh</code></pre><br>
<p> <em>parse.sh</em>   20 ,   <em>dispos.sh</em>  .</p><br>
<p>          <em>parse.sh</em>        .</p><br>
<pre><code class="bash hljs">./parse.sh</code></pre><br>
<p>        .</p><br>
<h2 id="opisanie-faylov-skriptov"> -</h2><br>
<h3 id="fayl-dispossh"> dispos.sh</h3><br>
<div class="spoiler"><b class="spoiler_title"> dispos.sh</b><div class="spoiler_text"><pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment">#        POSua LPOS-VFD.</span>
<span class="hljs-comment"># -  ttyUSB0.</span>
<span class="hljs-comment">#     tty  :</span>
<span class="hljs-comment"># modprobe usbserial vendor=0x0000 product=0x0131.</span>
<span class="hljs-comment">#  0x0000  0x0131  ,  </span>
<span class="hljs-comment"># usb-devices, lsusb  dmesg.</span>
<span class="hljs-comment">#    stty 9600 &lt; /dev/ttyUSB0.</span>
<span class="hljs-comment">#          parse.sh</span>
<span class="hljs-comment">#     crontab      .</span>
<span class="hljs-comment"># ****************************************************************</span><font></font>
<font></font>
<span class="hljs-comment">#  </span>
<span class="hljs-comment"># ttyUSB -      (POS-)</span>
DEV_DISPLAY=<span class="hljs-string">"/dev/ttyUSB0"</span><font></font>
<font></font>
<span class="hljs-comment">#       </span>
<span class="hljs-comment">#   ,  ,   18:00:00</span>
<span class="hljs-comment">#    17:00:00</span>
TIME_OF_WORKDAY=<span class="hljs-string">"18:00:00"</span><font></font>
<font></font>
<span class="hljs-keyword">if</span> (( $(date <span class="hljs-string">"+%u"</span>) &gt;= 5 )); <span class="hljs-keyword">then</span>
    TIME_OF_WORKDAY=<span class="hljs-string">"17:00:00"</span>
<span class="hljs-keyword">fi</span><font></font>
<font></font>
<span class="hljs-comment">#      ( 17:00:00)</span>
<span class="hljs-comment">#     </span>
DAY_OF_WEEKEND=`date +<span class="hljs-string">"%s"</span> --date=<span class="hljs-string">"friday 17:00:00"</span>`<font></font>
<font></font>
<span class="hljs-comment"># ****************************************************************</span>
<span class="hljs-comment">#      </span><font></font>
<font></font>
<span class="hljs-comment">#   </span>
<span class="hljs-function"><span class="hljs-title">disp_clear</span></span>(){
    <span class="hljs-built_in">echo</span> -en <span class="hljs-string">"\x0c\x0b"</span> &gt; <span class="hljs-string">"<span class="hljs-variable">${DEV_DISPLAY}</span>"</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">#      </span>
<span class="hljs-function"><span class="hljs-title">disp_cr</span></span>(){
    <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\x0b"</span> &gt; <span class="hljs-string">"<span class="hljs-variable">${DEV_DISPLAY}</span>"</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">#      </span>
<span class="hljs-function"><span class="hljs-title">disp_print</span></span>(){
    <span class="hljs-built_in">echo</span> -n <span class="hljs-variable">$1</span> | iconv -f UTF-8 -t CP866 &gt; <span class="hljs-string">"<span class="hljs-variable">${DEV_DISPLAY}</span>"</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment"># ****************************************************************</span>
<span class="hljs-comment">#   </span><font></font>
<font></font>
<span class="hljs-comment"># 1.   </span>
disp_clear <span class="hljs-comment">#  </span>
disp_print <span class="hljs-string">": `date "</span>+%A<span class="hljs-string">"`"</span>
disp_cr <span class="hljs-comment">#    </span>
disp_print <span class="hljs-string">"  `date "</span>+%d.%m.%Y %H:%M<span class="hljs-string">"`"</span><font></font>
<font></font>
sleep 8<font></font>
<font></font>
<span class="hljs-comment"># ****************************************************************</span>
<span class="hljs-comment"># 2.      </span><font></font>
disp_clear<font></font>
disp_print <span class="hljs-string">"    . :"</span><font></font>
disp_cr<font></font>
<font></font>
HOURS=$(( ( $(date +%s --date=<span class="hljs-variable">$TIME_OF_WORKDAY</span>) - $(date +%s) ) / <span class="hljs-number">3600</span> ))<font></font>
MINUTES=$(( (( $(date +%s --date=<span class="hljs-variable">$TIME_OF_WORKDAY</span>) - $(date +%s) ) - <span class="hljs-variable">$HOURS</span> * <span class="hljs-number">3600</span>) / <span class="hljs-number">60</span> ))<font></font>
<font></font>
<span class="hljs-comment">#      </span>
<span class="hljs-keyword">if</span> (( <span class="hljs-variable">$MINUTES</span> &gt; -1 )); <span class="hljs-keyword">then</span>
    OUTPUT_TIME=<span class="hljs-string">"   <span class="hljs-variable">${HOURS}</span> . <span class="hljs-variable">${MINUTES}</span> ."</span>
<span class="hljs-keyword">else</span>
    OUTPUT_TIME=<span class="hljs-string">"    !"</span>
<span class="hljs-keyword">fi</span><font></font>
<font></font>
<span class="hljs-comment">#      </span>
disp_print <span class="hljs-string">"<span class="hljs-variable">${OUTPUT_TIME}</span>"</span><font></font>
<font></font>
sleep 8<font></font>
<font></font>
<span class="hljs-comment"># ****************************************************************</span>
<span class="hljs-comment"># 3.      </span><font></font>
disp_clear<font></font>
disp_print <span class="hljs-string">"  . :"</span><font></font>
disp_cr<font></font>
<font></font>
DAYS=$(( (<span class="hljs-variable">$DAY_OF_WEEKEND</span>-$(date +%s)) / (24*3600) ))<font></font>
HOURS=$(( ((<span class="hljs-variable">$DAY_OF_WEEKEND</span>-$(date +%s)) - (<span class="hljs-variable">$DAYS</span>*24*3600)) / 3600 ))<font></font>
MINUTES=$(( ((<span class="hljs-variable">$DAY_OF_WEEKEND</span>-$(date +%s)) - (<span class="hljs-variable">$DAYS</span>*24*3600) - (<span class="hljs-variable">$HOURS</span>*60*60)) / 60 ))<font></font>
<font></font>
<span class="hljs-comment">#      </span>
<span class="hljs-keyword">if</span> (( <span class="hljs-variable">$MINUTES</span> &gt; -1 )); <span class="hljs-keyword">then</span>
    OUTPUT_TIME=<span class="hljs-string">"<span class="hljs-variable">${DAYS}</span> . <span class="hljs-variable">${HOURS}</span> . <span class="hljs-variable">${MINUTES}</span> "</span>
<span class="hljs-keyword">else</span>
    OUTPUT_TIME=<span class="hljs-string">"    !"</span>
<span class="hljs-keyword">fi</span><font></font>
<font></font>
<span class="hljs-comment">#      </span>
disp_print <span class="hljs-string">"<span class="hljs-variable">${OUTPUT_TIME}</span>"</span><font></font>
<font></font>
sleep 8<font></font>
<font></font>
<span class="hljs-comment"># ****************************************************************</span>
<span class="hljs-comment"># 4.    </span><font></font>
<font></font>
<span class="hljs-comment"># 4.1.     </span><font></font>
<font></font>
LINE1=$(sed -n <span class="hljs-string">'1{p;q}'</span> /tmp/weather.txt)<font></font>
DISPLAY_LINE1=<span class="hljs-variable">${LINE1:0:19}</span>
DISPLAY_LINE2=<span class="hljs-variable">${LINE1:19:19}</span><font></font>
<font></font>
<span class="hljs-comment">#     (2 )</span><font></font>
disp_clear<font></font>
disp_print <span class="hljs-string">"<span class="hljs-variable">${DISPLAY_LINE1}</span>"</span><font></font>
disp_cr<font></font>
disp_print <span class="hljs-string">"<span class="hljs-variable">${DISPLAY_LINE2}</span>"</span><font></font>
<font></font>
sleep 4<font></font>
<font></font>
<span class="hljs-comment"># 4.2.   </span>
LINE1=$(sed -n <span class="hljs-string">'2{p;q}'</span> /tmp/weather.txt)<font></font>
DISPLAY_LINE1=<span class="hljs-variable">${LINE1:0:14}</span>
DISPLAY_LINE2=<span class="hljs-variable">${LINE1:14:19}</span><font></font>
<font></font>
<span class="hljs-comment">#     (2 )</span><font></font>
disp_clear<font></font>
disp_print <span class="hljs-string">" <span class="hljs-variable">${DISPLAY_LINE1}</span>"</span><font></font>
disp_cr<font></font>
disp_print <span class="hljs-string">"<span class="hljs-variable">${DISPLAY_LINE2}</span>"</span><font></font>
<font></font>
sleep 8<font></font>
<font></font>
<span class="hljs-comment"># ****************************************************************</span>
<span class="hljs-comment"># 5.     </span><font></font>
<font></font>
<span class="hljs-comment">#     </span><font></font>
<font></font>
<span class="hljs-comment"># </span>
DOLLAR=$(sed -n <span class="hljs-string">'1{p;q}'</span> /tmp/ex.txt)<font></font>
DOLLAR=<span class="hljs-variable">${DOLLAR//–/-}</span><font></font>
<font></font>
<span class="hljs-comment"># </span>
EURO=$(sed -n <span class="hljs-string">'2{p;q}'</span> /tmp/ex.txt)<font></font>
EURO=<span class="hljs-variable">${EURO//–/-}</span><font></font>
<font></font>
<span class="hljs-comment">#    </span><font></font>
disp_clear<font></font>
disp_print <span class="hljs-string">": <span class="hljs-variable">${DOLLAR}</span>"</span><font></font>
disp_cr<font></font>
disp_print <span class="hljs-string">": <span class="hljs-variable">${EURO}</span>"</span><font></font>
<font></font>
sleep 8<font></font>
<font></font>
<span class="hljs-comment"># ****************************************************************</span>
<span class="hljs-comment"># 6.     </span><font></font>
<font></font>
<span class="hljs-comment">#     </span><font></font>
<font></font>
<span class="hljs-comment"># BTC</span>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> line
<span class="hljs-keyword">do</span>
    BTC=<span class="hljs-variable">${line:0:13}</span>
<span class="hljs-keyword">done</span> &lt;/tmp/bitcoin.txt<font></font>
<font></font>
<span class="hljs-comment"># ETH</span>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> line
<span class="hljs-keyword">do</span>
    ETH=<span class="hljs-variable">${line:0:13}</span>
<span class="hljs-keyword">done</span> &lt;/tmp/ethereum.txt<font></font>
<font></font>
<span class="hljs-comment">#    </span>
<span class="hljs-comment">#     </span><font></font>
disp_clear<font></font>
disp_print <span class="hljs-string">"BTC: <span class="hljs-variable">${BTC//./,}</span>"</span><font></font>
disp_cr<font></font>
disp_print <span class="hljs-string">"ETH: <span class="hljs-variable">${ETH//./,}</span>"</span><font></font>
<font></font>
<span class="hljs-comment">#sleep 8</span><font></font>
<font></font>
<span class="hljs-comment"># ****************************************************************</span>
<span class="hljs-comment"># 7.     </span><font></font>
<font></font>
<span class="hljs-comment">#      (.  20 )</span><font></font>
<font></font>
<span class="hljs-comment">#DISPLAY_LINE1="  !"</span>
<span class="hljs-comment">#DISPLAY_LINE2="  !"</span><font></font>
<font></font>
<span class="hljs-comment">#     </span>
<span class="hljs-comment">#disp_clear</span>
<span class="hljs-comment">#disp_print "${DISPLAY_LINE1:0:19}"</span>
<span class="hljs-comment">#disp_cr</span>
<span class="hljs-comment">#disp_print "${DISPLAY_LINE2:0:19}"</span></code></pre></div></div><br>
<p><strong></strong></p><br>
<p>      <code>date</code>. ,</p><br>
<pre><code class="bash hljs"><span class="hljs-built_in">echo</span> `date <span class="hljs-string">"+%d.%m.%Y %H:%M"</span>`</code></pre><br>
<p>    : 20.05.2019 12:11.</p><br>
<p>         <code>TIME_OF_WORKDAY</code>    <code>TIME_OF_WORKDAY="18:00:00"</code>.           :</p><br>
<pre><code class="bash hljs">HOURS=$(( ( $(date +%s --date=<span class="hljs-variable">$TIME_OF_WORKDAY</span>) - $(date +%s) ) / <span class="hljs-number">3600</span> ))<font></font>
MINUTES=$(( (( $(date +%s --date=<span class="hljs-variable">$TIME_OF_WORKDAY</span>) - $(date +%s) ) - <span class="hljs-variable">$HOURS</span> * <span class="hljs-number">3600</span>) / <span class="hljs-number">60</span> ))</code></pre><br>
<p> <code>$</code> —   ,   .<br>
 <code>#</code> — .</p><br>
<p><code>date +%s</code> —       .<br>
<code>date +%s --date=$TIME_OF_WORKDAY</code> —      <code>TIME_OF_WORKDAY ("18:00:00")</code>.</p><br>
<p>     :</p><br>
<pre><code class="bash hljs">DAYS=$(( (<span class="hljs-variable">$DAY_OF_WEEKEND</span>-$(date +%s)) / (24*3600) ))<font></font>
HOURS=$(( ((<span class="hljs-variable">$DAY_OF_WEEKEND</span>-$(date +%s)) - (<span class="hljs-variable">$DAYS</span>*24*3600)) / 3600 ))<font></font>
MINUTES=$(( ((<span class="hljs-variable">$DAY_OF_WEEKEND</span>-$(date +%s)) - (<span class="hljs-variable">$DAYS</span>*24*3600) - (<span class="hljs-variable">$HOURS</span>*60*60)) / 60 ))</code></pre><br>
<p> <code>DAY_OF_WEEKEND=`date +"%s" --date="friday 17:00:00"`</code> —          17:00:00.</p><br>
<p>     . ,</p><br>
<pre><code class="bash hljs"><span class="hljs-comment">#   </span>
<span class="hljs-function"><span class="hljs-title">disp_clear</span></span>(){
    <span class="hljs-built_in">echo</span> -en <span class="hljs-string">"\x0c\x0b"</span> &gt; <span class="hljs-string">"<span class="hljs-variable">${DEV_DISPLAY}</span>"</span>
}</code></pre><br>
<p><code>disp_clear()</code> —  .  <code>{}</code>   .</p><br>
<p> <code>DEV_DISPLAY</code>  ""       <code>DEV_DISPLAY="/dev/ttyUSB0"</code>.</p><br>
<p>   ,    (1):</p><br>
<pre><code class="bash hljs">LINE1=$(sed -n <span class="hljs-string">'1{p;q}'</span> /tmp/weather.txt)</code></pre><br>
<p><code>sed</code> —   ,           .  <code>-n</code> –    . <code>‘1{p;q}’</code> —  1       (<code>p</code> — , <code>q</code> — ).</p><br>
<p>     ():</p><br>
<pre><code class="bash hljs"><span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> line
<span class="hljs-keyword">do</span>
    BTC=<span class="hljs-variable">${line:0:13}</span>
<span class="hljs-keyword">done</span> &lt;/tmp/bitcoin.txt</code></pre><br>
<p>   <code>DISPLAY_LINE1=${LINE1:0:14}</code>   <code>LINE1</code>    14    0.</p><br>
<p>    <code>//</code>, ,  <code>DOLLAR//–/-</code>.   "–"  "-".</p><br>
<h3 id="fayl-parsesh"> parse.sh</h3><br>
<div class="spoiler"><b class="spoiler_title"> parse.sh</b><div class="spoiler_text"><pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment">#      RSS   http://rp5.ru/rss/1859/ru</span>
<span class="hljs-comment"># 1859 -   </span><font></font>
<font></font>
<span class="hljs-comment">#      </span>
<span class="hljs-function"><span class="hljs-title">conv</span></span>(){
<span class="hljs-comment">#       </span>
CURRENCY=$(sed -n <span class="hljs-string">'1!G;h;$p'</span> /tmp/ex.xml | sed -n <span class="hljs-string">"<span class="hljs-variable">${1}</span>{p;q}"</span>)<font></font>
CURRENCY=<span class="hljs-variable">${CURRENCY//[^,^(^)^0-9^–^+]/}</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$CURRENCY</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">#   c    </span>
<span class="hljs-comment"># 1. </span><font></font>
wget -q -O /tmp/rp5weather.xml http://rp5.ru/rss/1859/ru<font></font>
<font></font>
<span class="hljs-comment"># 2.     </span><font></font>
wget -q -O /tmp/ex.xml http://currr.ru/rss/<font></font>
<font></font>
<span class="hljs-comment"># 3.   bitcoin/ethereum</span><font></font>
wget -q -O /tmp/bitcoin.json https://api.coinmarketcap.com/v1/ticker/bitcoin/<font></font>
wget -q -O /tmp/ethereum.json https://api.coinmarketcap.com/v1/ticker/ethereum/<font></font>
<font></font>
<span class="hljs-comment">#  </span>
<span class="hljs-comment">#   ,  ,   </span>
<span class="hljs-comment">#    </span>
LINE31=$(sed -n <span class="hljs-string">'31{p;q}'</span> /tmp/rp5weather.xml)<font></font>
LINE33=$(sed -n <span class="hljs-string">'33{p;q}'</span> /tmp/rp5weather.xml)<font></font>
WEATHER1=<span class="hljs-variable">${LINE31//"&lt;/title&gt;"}</span>
WEATHER1=<span class="hljs-variable">${WEATHER1//" °C"}</span>
WEATHER1=<span class="hljs-variable">${WEATHER1//"  "}</span>
WEATHER1=<span class="hljs-variable">${WEATHER1:29}</span>
WEATHER2=<span class="hljs-variable">${LINE33##*}</span>
WEATHER2=<span class="hljs-variable">${WEATHER2//"°"}</span><font></font>
<font></font>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${WEATHER1}</span>"</span> &gt; /tmp/weather.txt
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${WEATHER2%.*}</span> &gt;&gt; /tmp/weather.txt<font></font>
<font></font>
<span class="hljs-comment">#   Bitcoin</span>
LINEBTC=$(sed -n <span class="hljs-string">'7{p;q}'</span> /tmp/bitcoin.json)
<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${LINEBTC//[^.^0-9]/}</span>"</span> &gt; /tmp/bitcoin.txt<font></font>
<font></font>
<span class="hljs-comment">#   Ethereum</span>
LINEETH=$(sed -n <span class="hljs-string">'7{p;q}'</span> /tmp/ethereum.json)
<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${LINEETH//[^.^0-9]/}</span>"</span> &gt; /tmp/ethereum.txt<font></font>
<font></font>
<span class="hljs-comment">#  </span><font></font>
DOLLAR=$(conv 8)<font></font>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$DOLLAR</span> &gt; /tmp/ex.txt<font></font>
EURO=$(conv 6)<font></font>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$EURO</span> &gt;&gt; /tmp/ex.txt</code></pre></div></div><br>
<p><strong></strong></p><br>
<p> <code>wget</code>     ,   ..  <code>-q</code> —   , <code>-O</code> —    .</p><br>
<p>      :</p><br>
<pre><code class="bash hljs"><span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${WEATHER1}</span>"</span> &gt; /tmp/weather.txt
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${WEATHER2%.*}</span> &gt;&gt; /tmp/weather.txt</code></pre><br>
<p>,        <code>&gt;</code>,    ,   <code>&gt;&gt;</code>    .</p><br>
<p>    :</p><br>
<pre><code class="bash hljs">conv 6</code></pre><br>
<p>  :</p><br>
<pre><code class="bash hljs">CURRENCY=$(sed -n <span class="hljs-string">'1!G;h;$p'</span> /tmp/ex.xml | sed -n <span class="hljs-string">"<span class="hljs-variable">${1}</span>{p;q}"</span>)</code></pre><br>
<p> <code>{1}</code> — .   6.</p><br>
<p>      , :</p><br>
<pre><code class="bash hljs">LINEBTC//[^.^0-9]/</code></pre><br>
<p>     "."     0  9.</p><br>
<p><strong></strong></p><br>
<p>  bash     ""  .   ,      1,     .</p><br>
<p>            .</p><br>
<h2 id="spisok-resursov"> </h2><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">   LPOS-VFD</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">     </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BASHの基礎（パート1）</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BASHの基礎（パート2）</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PuTTYの使い方</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初心者のためのLinux nanoテキストエディター</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WinSCPユーザー向けマニュアル</font></font></a></li>
</ol></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja457338/index.html">Ilya Krasinskyとの電撃戦：悪い仮説を立てる方法、製品を却下する理由、最小限のアクションで成長する方法</a></li>
<li><a href="../ja457340/index.html">レイアウト時間を節約する10個のPostCSSプラグイン</a></li>
<li><a href="../ja457342/index.html">上からの兆候：不要な作業や赤目から地図製作者を救った方法</a></li>
<li><a href="../ja457348/index.html">GitHubからPythonAnywhereへのデプロイ</a></li>
<li><a href="../ja457350/index.html">オシロスコープに暗号化サポートが必要なのはなぜですか？</a></li>
<li><a href="../ja457354/index.html">パフォーマンステストのデータ難読化</a></li>
<li><a href="../ja457362/index.html">RUVDSからのプロモーション：夏にサーバーを準備する</a></li>
<li><a href="../ja457366/index.html">狂信者、鉄片、または観客-あなたはどのようなゲーマーですか？</a></li>
<li><a href="../ja457374/index.html">Androidプロジェクトのビルド時間を短縮する</a></li>
<li><a href="../ja457378/index.html">id Softwareがコマンダーキーンのテクノロジーに基づいてWolfenstein 3Dを作成した方法</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>