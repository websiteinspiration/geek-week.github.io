<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëí ‚õπÔ∏è üßó 3D h√°galo usted mismo. Parte 1: p√≠xeles y l√≠neas üëè üßúüèø üëàüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quiero dedicar esta serie de art√≠culos a lectores que quieran explorar el mundo de la programaci√≥n 3D desde cero, a personas que quieran aprender los ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>3D h√°galo usted mismo. Parte 1: p√≠xeles y l√≠neas</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/494094/"><img src="https://habrastorage.org/webt/-u/-n/6a/-u-n6axbw6fowganklzotzai0sk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quiero dedicar esta serie de art√≠culos a lectores que quieran explorar el mundo de la programaci√≥n 3D desde cero, a personas que quieran aprender los conceptos b√°sicos de la creaci√≥n del componente 3D de juegos y aplicaciones. </font><font style="vertical-align: inherit;">Implementaremos cada operaci√≥n desde cero para comprender cada aspecto, incluso si ya hay una funci√≥n preparada que lo hace m√°s r√°pido. </font><font style="vertical-align: inherit;">Una vez aprendido, cambiaremos a las herramientas integradas para trabajar con 3D. </font><font style="vertical-align: inherit;">Despu√©s de leer la serie de art√≠culos, comprender√° c√≥mo crear escenas tridimensionales complejas con luces, sombras, texturas y efectos, c√≥mo hacer todo esto sin un conocimiento profundo de las matem√°ticas y mucho m√°s. </font><font style="vertical-align: inherit;">Puede hacer todo esto de forma independiente y con la ayuda de herramientas listas para usar.</font></font><br>
<a name="habracut"></a><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En la primera parte consideraremos:</font></font><br>
</b><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conceptos de renderizado (software, hardware)</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øQu√© es un p√≠xel / superficie?</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An√°lisis detallado de salida de l√≠nea.</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para no perder su valioso tiempo leyendo art√≠culos, que pueden ser incomprensibles para una persona no preparada, me referir√© de inmediato a los requisitos. Puede comenzar a leer art√≠culos en 3D de manera segura, si conoce los conceptos b√°sicos de programaci√≥n en cualquier lenguaje, porque Me enfocar√© solo en el estudio de la programaci√≥n 3D, y no en el estudio de las caracter√≠sticas del lenguaje y los fundamentos de la programaci√≥n. En cuanto a la preparaci√≥n matem√°tica, no debe preocuparse aqu√≠, aunque muchos no desean estudiar 3D, porque est√°n asustados por c√°lculos complejos y f√≥rmulas furiosas por las cuales las pesadillas sue√±an m√°s tarde, pero en realidad no hay nada de qu√© preocuparse. Tratar√© de explicar lo m√°s claramente posible todo lo necesario para 3D, solo tienes que poder multiplicar, dividir, sumar y restar. Entonces, si ha pasado los criterios de selecci√≥n, puede comenzar a leer.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de comenzar a explorar el interesante mundo del 3D, elija un lenguaje de programaci√≥n para ejemplos, as√≠ como un entorno de desarrollo. ¬øQu√© idioma debo elegir para programar gr√°ficos 3D? Cualquiera, puede trabajar donde se sienta m√°s c√≥modo, las matem√°ticas ser√°n las mismas en todas partes. En este art√≠culo, todos los ejemplos se mostrar√°n en el contexto de JS (aqu√≠ los tomates vuelan hacia m√≠). ¬øPor qu√© js? Es simple: √∫ltimamente he estado trabajando principalmente con √©l y, por lo tanto, puedo transmitirle la esencia de manera m√°s efectiva. Omitir√© todas las caracter√≠sticas de JS en los ejemplos, porque solo necesitamos las funciones m√°s b√°sicas que tiene cualquier idioma, por lo que prestaremos atenci√≥n espec√≠ficamente al 3D. Pero eliges lo que amas, porque en los art√≠culos, todas las f√≥rmulas no estar√°n vinculadas a las caracter√≠sticas de ning√∫n lenguaje de programaci√≥n. ¬øQu√© ambiente elegir? No importa,en el caso de JS, cualquier editor de texto es adecuado, puede usar el que est√© m√°s cerca de usted.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos los ejemplos usar√°n lienzo para pintar, como con √©l, puede comenzar a dibujar muy r√°pidamente, sin un an√°lisis detallado. Canvas es una herramienta poderosa, con muchos m√©todos listos para dibujar, pero de todas sus caracter√≠sticas, ¬°por primera vez, solo usaremos la salida de p√≠xeles!&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todas las pantallas tridimensionales en la pantalla con p√≠xeles, m√°s adelante en los art√≠culos ver√° c√≥mo sucede esto. ¬øSe ralentizar√°? Sin aceleraci√≥n de hardware (por ejemplo, aceleraci√≥n por una tarjeta de video) - ser√°. En el primer art√≠culo, no usaremos aceleraciones, escribiremos todo desde cero para comprender los aspectos b√°sicos de 3D. Veamos algunos t√©rminos que se mencionar√°n en futuros art√≠culos:</font></font><br>
<br>
<ul>
<li><i> (Rendering)</i> ‚Äî    3D-    . ,     3D-     ,        ,        .</li>
<li><i>  (Software Rendering) </i> ‚Äî     .  ,  , ,    -  .       ,     .       3D-   ,    ‚Äî  .</li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Representaci√≥n de hardware</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : un proceso de representaci√≥n asistido por hardware. </font><font style="vertical-align: inherit;">Lo uso juegos y aplicaciones. </font><font style="vertical-align: inherit;">Todo funciona muy r√°pido, porque </font><font style="vertical-align: inherit;">una gran cantidad de inform√°tica de rutina se hace cargo de la tarjeta de video, que est√° dise√±ada para esto.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No aspiro al t√≠tulo "definici√≥n del a√±o" e intento exponer todas las descripciones de los t√©rminos con la mayor claridad posible. </font><font style="vertical-align: inherit;">Lo principal es entender la idea, que luego se puede desarrollar de forma independiente. </font><font style="vertical-align: inherit;">Tambi√©n quiero llamar la atenci√≥n sobre el hecho de que todos los ejemplos de c√≥digo que se mostrar√°n en los art√≠culos a menudo no est√°n optimizados para la velocidad, a fin de mantener la facilidad de comprensi√≥n. </font><font style="vertical-align: inherit;">Cuando comprenda lo principal: c√≥mo funcionan los gr√°ficos 3D, puede optimizar todo usted mismo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primero, cree un proyecto, para m√≠ es solo un </font><font style="vertical-align: inherit;">archivo de </font><font style="vertical-align: inherit;">texto </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">index.html</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , con el siguiente contenido:</font></font><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>3D it‚Äôs easy. Part 1<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">&lt;!--         --&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"surface"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"800"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"600"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span><font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//    </span>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No me centrar√© demasiado en JS y el lienzo ahora; estos no son los personajes principales de este art√≠culo. </font><font style="vertical-align: inherit;">Pero para una comprensi√≥n general, aclarar√© que &lt;lienzo ...&gt; es un rect√°ngulo (en mi caso, de 800 por 600 p√≠xeles de tama√±o) en el que mostrar√© todos los gr√°ficos. </font><font style="vertical-align: inherit;">Registr√© el lienzo una vez y ya no lo cambiar√©.</font></font><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span> ‚Ä¶ <span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>&nbsp;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Script: un elemento dentro del cual escribiremos toda la l√≥gica para renderizar gr√°ficos 3D con nuestras propias manos (en JavaScript).&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando acabamos de revisar la estructura del archivo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">index.html</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> del </font><font style="vertical-align: inherit;">proyecto reci√©n creado, comenzaremos a tratar con gr√°ficos 3D.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando dibujamos algo en la ventana, esto en el conteo final se convierte en p√≠xeles, porque son ellos los que muestra el monitor. Cuantos m√°s p√≠xeles, m√°s n√≠tida es la imagen, pero la computadora tambi√©n carga m√°s. ¬øC√≥mo se almacena lo que dibujamos en la ventana? Los gr√°ficos en cualquier ventana se pueden representar como una matriz de p√≠xeles, y el p√≠xel en s√≠ mismo es solo un color. Es decir, una resoluci√≥n de pantalla de 800x600 significa que nuestra ventana contiene 600 l√≠neas de 800 p√≠xeles cada una, es decir, 800 * 600 = 480000 p√≠xeles, mucho, ¬øno? Los p√≠xeles se almacenan en una matriz. Pensemos en qu√© matriz almacenar√≠amos los p√≠xeles. Si deber√≠amos tener 800 por 600 p√≠xeles, entonces la opci√≥n m√°s obvia es en una matriz bidimensional de 800 por 600. Y esta es casi la opci√≥n correcta, o m√°s bien, la opci√≥n completamente correcta. Pero los p√≠xeles de la ventana se almacenan mejor en una matriz unidimensional de 480,000 elementos (si la resoluci√≥n es de 800 por 600),solo porque es m√°s r√°pido trabajar con una matriz unidimensional, porque se almacena en la memoria en una secuencia continua de bytes (todo se encuentra cerca y, por lo tanto, es f√°cil de obtener). En una matriz bidimensional (por ejemplo, en el caso de JS), cada l√≠nea se puede dispersar en diferentes lugares de la memoria, por lo que acceder a los elementos de dicha matriz llevar√° m√°s tiempo. Adem√°s, para iterar sobre una matriz unidimensional, solo se necesita 1 ciclo, y para los enteros bidimensionales 2, dada la necesidad de hacer decenas de miles de iteraciones del ciclo, la velocidad es importante aqu√≠. ¬øQu√© es un p√≠xel en tal matriz? Como se mencion√≥ anteriormente, este es solo un color, o m√°s bien 3 de sus componentes (rojo, verde, azul). Cualquiera, incluso la imagen m√°s colorida es solo una matriz de p√≠xeles de diferentes colores. Un p√≠xel en la memoria se puede almacenar a su gusto, ya sea una matriz de 3 elementos, o en una estructura donde rojo, verde,azul; o algo mas. Una imagen que consiste en una matriz de p√≠xeles que acabamos de analizar, continuar√© llamando a la superficie. Resulta que, dado que todo lo que se muestra en la pantalla se almacena en una matriz de p√≠xeles, luego de cambiar los elementos (p√≠xeles) en esta matriz, cambiaremos la imagen en la pantalla p√≠xel por p√≠xel. Esto es exactamente lo que haremos en este art√≠culo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No hay una funci√≥n de dibujo de p√≠xeles en el lienzo, pero es posible acceder a una matriz unidimensional de p√≠xeles, que discutimos anteriormente. </font><font style="vertical-align: inherit;">El siguiente ejemplo muestra c√≥mo hacerlo (este y todos los ejemplos en el futuro solo estar√°n dentro del elemento del script):</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">//     ()    </span>
<span class="hljs-keyword">const</span> ctx = <span class="hljs-built_in">document</span>
.getElementById(<span class="hljs-string">'surface'</span>)<font></font>
.getContext(<span class="hljs-string">'2d'</span>)<font></font>
<font></font>
<span class="hljs-comment">//     ,   &nbsp;</span>
<span class="hljs-comment">// +       </span>
<span class="hljs-keyword">const</span> imageData = ctx.createImageData(<span class="hljs-number">800</span>, <span class="hljs-number">600</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el ejemplo, imageData es un objeto en el que hay 3 propiedades:</font></font><br>
<br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alto y ancho</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : enteros que almacenan el alto y el ancho de la ventana para dibujar</font></font><br>
</li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">datos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : matriz de enteros sin signo de 8 bits (puede almacenar n√∫meros en el rango de 0 a 255)</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La matriz de datos tiene una estructura simple pero explicativa. </font><font style="vertical-align: inherit;">Esta matriz unidimensional almacena datos de cada p√≠xel, que mostraremos en la pantalla en el siguiente formato:</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los primeros 4 elementos de la matriz (√≠ndices 0,1,2,3) son los datos del primer p√≠xel en la primera fila. Los segundos 4 elementos (√≠ndices 4, 5, 6, 7) son los datos del segundo p√≠xel de la primera fila. Cuando lleguemos al 800¬∫ p√≠xel de la primera l√≠nea, siempre que la ventana tenga 800 p√≠xeles de ancho, el 801¬∫ p√≠xel ya pertenecer√° a la segunda l√≠nea. Si lo cambiamos, en la pantalla veremos que el primer p√≠xel de la segunda fila ha cambiado (aunque seg√∫n el recuento en la matriz ser√° el 801¬∫ p√≠xel). ¬øPor qu√© hay 4 elementos para cada p√≠xel en la matriz? Esto se debe a que en el lienzo, adem√°s de asignar 1 elemento para cada color: rojo, verde, azul (estos son 3 elementos), 1 elemento m√°s para la transparencia (tambi√©n dicen el canal alfa u opacidad). El canal alfa, como el color, se establece en el rango de 0 (transparente) a 255 (opaco). Con esta estructura, obtenemos una imagen de 32 bits,porque cada p√≠xel consta de 4 elementos de 8 bits. Para resumir: cada p√≠xel contiene: colores rojo, verde, azul y canal alfa (transparencia). Este esquema de color se llama ARGB (Alpha Red Green Blue). Y el hecho de que cada p√≠xel ocupe 32 bits dice que tenemos una imagen de 32 bits (tambi√©n dicen una imagen con una profundidad de color de 32 bits).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De forma predeterminada, toda la matriz de p√≠xeles imageData.data (los datos son una propiedad en la que la matriz de p√≠xeles, y imageData es solo un objeto) se llena con los valores 0, y si intentamos generar dicha matriz, no ver√≠amos nada interesante en la pantalla, porque 0 , 0, 0 es negro, pero como la transparencia aqu√≠ tambi√©n ser√° 0, y este es un color completamente transparente, ¬°ni siquiera veremos negro en la pantalla!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No es conveniente trabajar directamente con una matriz unidimensional, por lo que escribiremos una clase para ella en la que crearemos m√©todos para dibujar. Voy a nombrar la clase - Caj√≥n. Esta clase almacenar√° solo los datos necesarios y realizar√° los c√°lculos necesarios, abstrayendo tanto como sea posible de la herramienta utilizada para la representaci√≥n. Es por eso que colocaremos todos los c√°lculos y trabajaremos con la matriz. Y la misma llamada al m√©todo de visualizaci√≥n en lienzo, lo colocaremos fuera de la clase, porque Puede haber algo m√°s en lugar de lienzo. En este caso, nuestra clase no tendr√° que ser cambiada. Para trabajar con una matriz de p√≠xeles (superficie), es m√°s conveniente para nosotros guardarlo en la clase Drawer, as√≠ como el ancho y la altura de la imagen, para que podamos acceder correctamente al p√≠xel deseado. Entonces, la clase Drawer, mientras conserva los datos m√≠nimos necesarios para dibujar, se ve as√≠ para m√≠:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Drawer</span> </span>{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;surface = <span class="hljs-literal">null</span>
&nbsp;&nbsp;&nbsp;&nbsp;width = <span class="hljs-number">0</span>
&nbsp;&nbsp;&nbsp;&nbsp;height = <span class="hljs-number">0</span><font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">constructor</span>(surface, width, height) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.surface = surface
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.width = width
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.height = height<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como puede ver en el constructor, la clase Drawer toma todos los datos necesarios y los guarda. </font><font style="vertical-align: inherit;">Ahora puede crear una instancia de esta clase y pasarle una matriz de p√≠xeles, ancho y alto (ya tenemos todos estos datos, porque los creamos arriba y los almacenamos en imageData):</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> drawer = <span class="hljs-keyword">new</span> Drawer(<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;imageData.data,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;imageData.width,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;imageData.height<font></font>
)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la clase Drawer, escribiremos varias funciones de dibujo, para facilitar el trabajo en el futuro. </font><font style="vertical-align: inherit;">Tendremos una funci√≥n para dibujar un p√≠xel, una funci√≥n para dibujar una l√≠nea, y en otros art√≠culos aparecer√°n funciones para dibujar un tri√°ngulo y otras formas. </font><font style="vertical-align: inherit;">Pero comencemos con el m√©todo de dibujo de p√≠xeles. </font><font style="vertical-align: inherit;">Lo llamar√© drawPixel. </font><font style="vertical-align: inherit;">Si dibujamos un p√≠xel, entonces debe tener coordenadas, as√≠ como color:</font></font><br>
<br>
<pre><code class="javascript hljs">drawPixel(x, y, r, g, b)&nbsp; { }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tenga en cuenta que la funci√≥n drawPixel no acepta el par√°metro alfa (transparencia), y arriba descubrimos que la matriz de p√≠xeles consta de 3 par√°metros de color y 1 par√°metro de transparencia. No indiqu√© espec√≠ficamente la transparencia, ya que no la necesitamos para ejemplos. Por defecto, estableceremos 255 (es decir, todo ser√° opaco). Ahora pensemos en c√≥mo escribir el color deseado en una matriz de p√≠xeles en coordenadas x, y. Dado que tenemos toda la informaci√≥n sobre la imagen, se almacena en una matriz unidimensional, en la que se asigna 1 p√≠xel (8 bits) para cada p√≠xel. Para acceder al p√≠xel deseado en la matriz, primero debemos determinar el √≠ndice de ubicaci√≥n roja, porque cualquier p√≠xel comienza con √©l (por ejemplo, [r, g, b, a]). Una peque√±a explicaci√≥n de la estructura de la matriz:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/uz/4j/8o/uz4j8olujyuhzo3z1anuexucnoc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La tabla en verde indica c√≥mo se almacenan los componentes de color en una matriz de superficie unidimensional. Sus √≠ndices en la misma matriz se indican en azul, y las coordenadas del p√≠xel que acepta las funciones drawPixel, que necesitamos convertir en √≠ndices en la matriz unidimensional, indican r, g, b, a para el p√≠xel en azul. Entonces, de la tabla se puede ver que para cada p√≠xel el componente rojo del color es lo primero, comencemos con √©l. Supongamos que queremos cambiar el componente rojo del color del p√≠xel en las coordenadas X1Y1 con un tama√±o de imagen de 2 por 2 p√≠xeles. En la tabla vemos que este es el √≠ndice 12, pero ¬øc√≥mo calcularlo? Primero encontramos el √≠ndice de la fila que necesitamos, para esto multiplicamos el ancho de la imagen por Y y por 4 (el n√∫mero de valores por p√≠xel); esto ser√°:</font></font><br>
<br>
<pre><code class="plaintext hljs">width * y * 4 <font></font>
//  :<font></font>
2 * 1 * 4 = 8</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vemos que la segunda l√≠nea comienza con el √≠ndice 8. Si comparamos con la placa, el resultado converge. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora necesita agregar un desplazamiento de columna al √≠ndice de fila encontrado para obtener el √≠ndice rojo deseado. </font><font style="vertical-align: inherit;">Para hacer esto, agregue X veces 4 al √≠ndice de la fila. La f√≥rmula completa ser√°:</font></font><br>
<br>
<pre><code class="plaintext hljs">width * y * 4 + x * 4 <font></font>
//     :<font></font>
(width * y + x) * 4<font></font>
//  :<font></font>
(2 * 1 + 1) * 4 = 12</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora comparamos 12 con la tabla y vemos que el p√≠xel X1Y1 realmente comienza con el √≠ndice 12. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para encontrar los √≠ndices de otros componentes de color, debe agregar el desplazamiento de color al √≠ndice rojo: +1 (verde), +2 (azul), +3 (alfa) . </font><font style="vertical-align: inherit;">Ahora podemos implementar el m√©todo drawPixel dentro de la clase Drawer usando la f√≥rmula anterior:</font></font><br>
<br>
<pre><code class="javascript hljs">drawPixel(x, y, r, g, b) {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span> offset = (<span class="hljs-keyword">this</span>.width * y + x) * <span class="hljs-number">4</span><font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.surface[offset] = r
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.surface[offset + <span class="hljs-number">1</span>] = g
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.surface[offset + <span class="hljs-number">2</span>] = b
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.surface[offset + <span class="hljs-number">3</span>] = <span class="hljs-number">255</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este m√©todo drawPixel, renderic√© la parte repetitiva de la f√≥rmula en el desplazamiento constante. Tambi√©n se ve que en alfa solo escribo 255, porque est√° en la estructura, pero ahora no necesitamos generar p√≠xeles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es hora de probar el c√≥digo y finalmente ver el primer p√≠xel en la pantalla. Aqu√≠ hay un ejemplo usando el m√©todo de renderizado de p√≠xeles:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">//     Drawer</span>
drawer.drawPixel(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<font></font>
drawer.drawPixel(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>)<font></font>
<font></font>
<span class="hljs-comment">//         canvas</span>
ctx.putImageData(imageData, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el ejemplo anterior, dibujo 2 p√≠xeles, uno rojo 255, 0, 0, el otro azul 0, 0, 255. Pero los cambios en la matriz imageData.data (tambi√©n es la superficie dentro de la clase Drawer) no aparecer√°n en la pantalla. Para dibujar, debe llamar a ctx.putImageData (imageData, 0, 0), donde imageData es el objeto en el que la matriz de p√≠xeles y el ancho / alto del √°rea de dibujo, y 0, 0 es el punto en relaci√≥n con el cual se mostrar√° la matriz de p√≠xeles (siempre deje 0, 0 ) Si hizo todo correctamente, tendr√° la siguiente imagen en la esquina superior izquierda del elemento de lienzo en la ventana del navegador: ¬øVio los </font></font><br>
<br>
<img src="https://habrastorage.org/webt/d8/xn/cz/d8xnczchpgfg-9amhgdlyrpvzma.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
p√≠xeles? Son tan peque√±os y cu√°nto trabajo se ha hecho.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora intentemos agregar un poco de din√°mica al ejemplo, por ejemplo, de modo que cada 10 milisegundos nuestro p√≠xel se desplace a la derecha (cambiaremos X p√≠xeles en +1 cada 10 milisegundos), corregiremos el c√≥digo de dibujo de p√≠xeles en uno a intervalos:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> x = <span class="hljs-number">10</span>
setInterval(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;drawer.drawPixel(x++, <span class="hljs-number">20</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;ctx.putImageData(imageData, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<font></font>
<font></font>
}, <span class="hljs-number">10</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este ejemplo, dej√© solo la salida del p√≠xel azul y envolv√≠ la funci√≥n setInterval con el par√°metro 10 en JavaScript. Esto significa que el c√≥digo se llamar√° aproximadamente cada 10 milisegundos. Si ejecuta este ejemplo, ver√° que en lugar de que un p√≠xel se desplace a la derecha, tendr√° algo como esto: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8o/0v/uu/8o0vuuurtmmqgu8uy7sufdka16o.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
una tira (o rastro) tan larga permanece porque no borramos el color del p√≠xel anterior en la matriz de superficie, por lo que con cada llamada al intervalo agregamos un p√≠xel Escribamos un m√©todo que limpie la superficie a su estado original. En otras palabras, llene la matriz con ceros. Agregue el m√©todo clearSurface a la clase Drawer:</font></font><br>
<br>
<pre><code class="javascript hljs">clearSurface() {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span> surfaceSize = <span class="hljs-keyword">this</span>.width * <span class="hljs-keyword">this</span>.height * <span class="hljs-number">4</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; surfaceSize; i++) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.surface[i] = <span class="hljs-number">0</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No hay l√≥gica en esta matriz, solo rellena con ceros. </font><font style="vertical-align: inherit;">Se recomienda que llame a este m√©todo cada vez antes de dibujar una nueva imagen. </font><font style="vertical-align: inherit;">En el caso de la animaci√≥n de p√≠xeles, antes de dibujar este p√≠xel:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> x = <span class="hljs-number">10</span>
setInterval(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;drawer.clearSurface()<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;drawer.drawPixel(x++, <span class="hljs-number">20</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;ctx.putImageData(imageData, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<font></font>
}, <span class="hljs-number">10</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora, si ejecuta este ejemplo, el p√≠xel se desplazar√° a la derecha, uno por uno, sin una traza innecesaria de las coordenadas anteriores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo √∫ltimo que implementamos en el primer art√≠culo es el m√©todo de dibujo lineal. </font><font style="vertical-align: inherit;">Agr√©guelo, por supuesto, a la clase Drawer. </font><font style="vertical-align: inherit;">El m√©todo que llamar√© drawLine. </font><font style="vertical-align: inherit;">¬øQu√© tomar√° √©l? </font><font style="vertical-align: inherit;">A diferencia de un punto, la l√≠nea todav√≠a tiene las coordenadas en las que termina. </font><font style="vertical-align: inherit;">En otras palabras, la l√≠nea tiene un comienzo, un final y un color, que pasaremos al m√©todo:</font></font><br>
<br>
<pre><code class="javascript hljs">drawLine(x1, y1, x2, y2, r, g, b) { }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cualquier l√≠nea consta de p√≠xeles, solo queda rellenarla correctamente con p√≠xeles de x1, y1 a x2, y2. Para empezar, dado que la l√≠nea consiste en p√≠xeles, la sacaremos p√≠xel por p√≠xel en el bucle, pero ¬øc√≥mo calcular cu√°ntos p√≠xeles emitir? Por ejemplo, para dibujar una l√≠nea desde [0, 0] a [3, 0] es intuitivamente claro que necesita 4 p√≠xeles ([0, 0], [1, 0], [2, 0], [3, 0],) . Pero de [12, 6] a [43, 14], ya no est√° claro cu√°nto durar√° la l√≠nea (cu√°ntos p√≠xeles se mostrar√°n) y qu√© coordenadas tendr√°n. Para hacer esto, recuerda un poco de geometr√≠a. Entonces, tenemos una l√≠nea que comienza en x1, y1 y termina en x2, y2.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ou/z7/ip/ouz7ipd2uiokmmijlro7wldayzw.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dibujemos una l√≠nea punteada desde el principio y el final para obtener un tri√°ngulo (imagen de arriba). </font><font style="vertical-align: inherit;">Veremos que en la uni√≥n de las l√≠neas dibujadas se ha formado un √°ngulo de 90 grados. </font><font style="vertical-align: inherit;">Si el tri√°ngulo tiene tal √°ngulo, entonces el tri√°ngulo se llama rectangular, y sus lados, entre los cuales el √°ngulo es de 90 grados, se llaman patas. </font><font style="vertical-align: inherit;">La tercera l√≠nea continua (que estamos tratando de dibujar) se llama hipotenusa en un tri√°ngulo. </font><font style="vertical-align: inherit;">Usando estas dos patas introducidas (c1 y c2 en la figura), podemos calcular la longitud de la hipotenusa usando el teorema de Pit√°goras. </font><font style="vertical-align: inherit;">Veamos como hacerlo. </font><font style="vertical-align: inherit;">La f√≥rmula para la longitud de la hipotenusa (o longitud de la l√≠nea) ser√° la siguiente:&nbsp;</font></font><br>
<p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x433;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x438;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x43F;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x43E;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x442;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x435;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x43D;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x443;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x437;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x430;</mo></mrow><mo>=</mo><msqrt><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x43A;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x430;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x442;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x435;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x442;</mo></mrow><msup><mn>1</mn><mn>2</mn></msup><mo>+</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x43A;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x430;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x442;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x435;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x442;</mo></mrow><msup><mn>2</mn><mn>2</mn></msup></msqrt></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="31.778ex" height="4.759ex" viewBox="0 -1401.3 13682.2 2049.1" role="img" focusable="false" style="vertical-align: -1.505ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text><g transform="translate(376,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(861,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(1345,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(1776,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(2152,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(2535,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(3019,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(3450,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(3790,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494094/&amp;usg=ALkJrhgule5Q07CdrNtwhoL6SDwRo-XMqQ#MJMAIN-3D" x="4499" y="0"></use><g transform="translate(5555,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494094/&amp;usg=ALkJrhgule5Q07CdrNtwhoL6SDwRo-XMqQ#MJSZ2-221A" x="0" y="87"></use><rect stroke="none" width="7126" height="60" x="1000" y="1178"></rect><g transform="translate(1000,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text><g transform="translate(430,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(861,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(1237,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(1620,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(1997,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494094/&amp;usg=ALkJrhgule5Q07CdrNtwhoL6SDwRo-XMqQ#MJMAIN-31" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494094/&amp;usg=ALkJrhgule5Q07CdrNtwhoL6SDwRo-XMqQ#MJMAIN-32" x="707" y="583"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494094/&amp;usg=ALkJrhgule5Q07CdrNtwhoL6SDwRo-XMqQ#MJMAIN-2B" x="3173" y="0"></use><g transform="translate(4174,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(4605,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(5035,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(5412,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(5795,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(6171,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494094/&amp;usg=ALkJrhgule5Q07CdrNtwhoL6SDwRo-XMqQ#MJMAIN-32" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494094/&amp;usg=ALkJrhgule5Q07CdrNtwhoL6SDwRo-XMqQ#MJMAIN-32" x="707" y="583"></use></g></g></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mo>=</mo><msqrt><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><msup><mn>1</mn><mn>2</mn></msup><mo>+</mo><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><msup><mn>2</mn><mn>2</mn></msup></msqrt></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> = \sqrt{1^2 + 2^2}</script></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C√≥mo obtener ambas piernas tambi√©n se ve desde el tri√°ngulo. </font><font style="vertical-align: inherit;">Ahora, usando la f√≥rmula anterior, encontramos la hipotenusa, que ser√° la l√≠nea larga (el n√∫mero de p√≠xeles):</font></font><br>
<br>
<pre><code class="javascript hljs">&nbsp;drawLine(x1, y1, x2, y2, r, g, b) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span> c1 = y2 - y1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span> c2 = x2 - x1<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span> length = <span class="hljs-built_in">Math</span>.sqrt(c1 * c1 + c2 * c2)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ya sabemos cu√°ntos p√≠xeles dibujar para dibujar una l√≠nea. Pero a√∫n no sabemos c√≥mo se desplazan los p√≠xeles. Es decir, necesitamos dibujar una l√≠nea desde x1, y1 hasta x2, y2, sabemos que la longitud de la l√≠nea ser√°, por ejemplo, de 20 p√≠xeles. Podemos dibujar el primer p√≠xel en x1, y1 y el √∫ltimo en x2, y2, pero ¬øc√≥mo encontrar las coordenadas de los p√≠xeles intermedios? Para hacer esto, necesitamos saber c√≥mo cambiar cada p√≠xel siguiente con respecto a x1, y1 para obtener la l√≠nea deseada. Dar√© un ejemplo m√°s para comprender mejor de qu√© tipo de desplazamiento estamos hablando. Tenemos puntos [0, 0] y [0, 3], necesitamos dibujar una l√≠nea sobre ellos. Del ejemplo se ve claramente que el siguiente punto despu√©s de [0, 0] ser√° [0, 1], y luego [0, 2] y finalmente [0, 3]. Es decir, X de cada punto no se desplaz√≥, bueno, o podemos decir que se desplaz√≥ en 0 p√≠xeles e Y se desplaz√≥ en 1 p√≠xel, este es el desplazamiento,se puede escribir como [0, 1]. Otro ejemplo: tenemos un punto [0, 0] y un punto [3, 6], intentemos calcular en nuestra mente c√≥mo cambian, el primero ser√° [0, 0], luego [0.5, 1], luego [1, 2] luego [1.5, 3] y as√≠ sucesivamente a [3, 6], en este ejemplo el desplazamiento ser√° [0.5, 1]. ¬øC√≥mo calcularlo?&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puedes usar la siguiente f√≥rmula:</font></font><br>
<br>
<pre><code class="javascript hljs">   = <span class="hljs-number">2</span> /  <font></font>
  Y = <span class="hljs-number">1</span> /  &nbsp;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el c√≥digo del programa, tendremos esto:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> xStep = c2 / length
<span class="hljs-keyword">const</span> yStep = c1 / length</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos los datos ya est√°n all√≠: la longitud de la l√≠nea, el desplazamiento de los p√≠xeles a lo largo de X e Y. Comenzamos en el ciclo para dibujar:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; length; i++) {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.drawPixel(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">Math</span>.trunc(x1 + xStep * i),
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">Math</span>.trunc(y1 + yStep * i),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r, g, b,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;)<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como la coordenada X de la funci√≥n P√≠xel, transferimos el comienzo de la l√≠nea X + desplazamiento X * i, por lo tanto, al obtener la coordenada del i-√©simo p√≠xel, tambi√©n calculamos la coordenada Y. Math.trunc es un m√©todo en JS que le permite descartar la parte fraccionaria de un n√∫mero. </font><font style="vertical-align: inherit;">Todo el c√≥digo del m√©todo se ve as√≠:</font></font><br>
<br>
<pre><code class="javascript hljs">drawLine(x1, y1, x2, y2, r, g, b) {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span> c1 = y2 - y1
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span> c2 = x2 - x1<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span> length = <span class="hljs-built_in">Math</span>.sqrt(c1 * c1 + c2 * c2)<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span> xStep = c2 / length
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span> yStep = c1 / length<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; length; i++) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.drawPixel(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">Math</span>.trunc(x1 + xStep * i),
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">Math</span>.trunc(y1 + yStep * i),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r, g, b,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La primera parte ha llegado a su fin, un camino largo pero emocionante para comprender el mundo 3D. </font><font style="vertical-align: inherit;">Todav√≠a no hab√≠a nada tridimensional, pero realizamos operaciones preparatorias para dibujar: implementamos las funciones de dibujar un p√≠xel, una l√≠nea, limpiar una ventana y aprendimos algunos t√©rminos. </font><font style="vertical-align: inherit;">Todo el c√≥digo de la clase Drawer se puede ver debajo del spoiler:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo de clase del caj√≥n</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Drawer</span> </span>{<font></font>
  surface = <span class="hljs-literal">null</span>
  width = <span class="hljs-number">0</span>
  height = <span class="hljs-number">0</span><font></font>
<font></font>
  <span class="hljs-keyword">constructor</span>(surface, width, height) {
    <span class="hljs-keyword">this</span>.surface = surface
    <span class="hljs-keyword">this</span>.width = width
    <span class="hljs-keyword">this</span>.height = height<font></font>
  }<font></font>
<font></font>
  drawPixel(x, y, r, g, b)  {<font></font>
    <span class="hljs-keyword">const</span> offset = (<span class="hljs-keyword">this</span>.width * y + x) * <span class="hljs-number">4</span><font></font>
<font></font>
    <span class="hljs-keyword">this</span>.surface[offset] = r
    <span class="hljs-keyword">this</span>.surface[offset + <span class="hljs-number">1</span>] = g
    <span class="hljs-keyword">this</span>.surface[offset + <span class="hljs-number">2</span>] = b
    <span class="hljs-keyword">this</span>.surface[offset + <span class="hljs-number">3</span>] = <span class="hljs-number">255</span><font></font>
  }<font></font>
<font></font>
  drawLine(x1, y1, x2, y2, r, g, b) {<font></font>
    <span class="hljs-keyword">const</span> c1 = y2 - y1
    <span class="hljs-keyword">const</span> c2 = x2 - x1<font></font>
<font></font>
    <span class="hljs-keyword">const</span> length = <span class="hljs-built_in">Math</span>.sqrt(c1 * c1 + c2 * c2)<font></font>
<font></font>
    <span class="hljs-keyword">const</span> xStep = c2 / length
    <span class="hljs-keyword">const</span> yStep = c1 / length<font></font>
<font></font>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span> ; i &lt; length ; i++) {
        <span class="hljs-keyword">this</span>.drawPixel(
          <span class="hljs-built_in">Math</span>.trunc(x1 + xStep * i),
          <span class="hljs-built_in">Math</span>.trunc(y1 + yStep * i),<font></font>
          r, g, b,<font></font>
        )<font></font>
    }<font></font>
  }<font></font>
<font></font>
  clearSurface() {<font></font>
    <span class="hljs-keyword">const</span> surfaceSize = <span class="hljs-keyword">this</span>.width * <span class="hljs-keyword">this</span>.height * <span class="hljs-number">4</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; surfaceSize; i++) {
      <span class="hljs-keyword">this</span>.surface[i] = <span class="hljs-number">0</span><font></font>
    }<font></font>
  }<font></font>
}<font></font>
</code></pre></div></div><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øQue sigue?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el pr√≥ximo art√≠culo, examinaremos c√≥mo una operaci√≥n tan simple como la salida de un p√≠xel y una l√≠nea puede convertirse en interesantes objetos 3D. </font><font style="vertical-align: inherit;">Nos familiarizaremos con las matrices y las operaciones en ellas, mostraremos un objeto tridimensional en una ventana e incluso agregaremos animaci√≥n.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es494076/index.html">An√°lisis: estrategias de comportamiento de los inversores durante las ca√≠das del mercado de valores</a></li>
<li><a href="../es494082/index.html">Dalenka: los art√≠culos m√°s √∫tiles sobre el trabajo efectivo desde casa</a></li>
<li><a href="../es494084/index.html">Coronavirus: servicios de informaci√≥n en l√≠nea</a></li>
<li><a href="../es494090/index.html">Aceleraci√≥n del apio: establecimiento del l√≠mite de velocidad para colas</a></li>
<li><a href="../es494092/index.html">Degradaci√≥n de la estructura conectada.</a></li>
<li><a href="../es494096/index.html">Despliegue intranet. Experiencia, errores, recomendaciones.</a></li>
<li><a href="../es494098/index.html">Enfoque imperativo para datos reactivos en el ejemplo de Jetbrains KTor y R2DBC</a></li>
<li><a href="../es494100/index.html">Lo que necesita para crear el modelo ideal de un centro educativo para capacitar especialistas en TI</a></li>
<li><a href="../es494114/index.html">C√≥mo reducir el n√∫mero y aumentar la legibilidad del c√≥digo en react-redux, redux-saga</a></li>
<li><a href="../es494118/index.html">COVID-19 Telegram-bot // Respondemos preguntas frecuentes autom√°ticamente</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>