<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßòüèø üõµ üì± How to open comments and not drown in spam üßò ü¶ó ü§µ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When your job is to create something beautiful, you can not especially talk about it, because the result is before everyone's eyes. But if you erase t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>How to open comments and not drown in spam</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/490836/"><img src="https://habrastorage.org/webt/hj/yv/k9/hjyvk9j-z7efccbnuddl6ferhhy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When your job is to create something beautiful, you can not especially talk about it, because the result is before everyone's eyes. But if you erase the inscriptions from fences, no one notices your work until the fences look decent or until you erase something wrong. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Any service where you can leave a comment, review, send a message or upload pictures, sooner or later faces the problem of spam, fraud and obscene language. This cannot be avoided, but this must be fought.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
My name is Mikhail, I work in the Anti-Spam team, which protects users of Yandex services from such problems. Our work is rarely noticeable (and good!), So today I will talk about it in more detail. You will find out in which cases moderation is useless and why accuracy is not the only indicator of its effectiveness. We‚Äôll also talk about mate using the example of cats and dogs and why it‚Äôs sometimes useful to ‚Äúthink like a swindler‚Äù.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In Yandex, there are more and more services where users publish their content. You can ask a question or write an answer in Yandex.Kew, discuss the news of the yard in Yandex.Rayon, share the traffic situation in conversations on Yandex.Maps. But when the service audience grows, it becomes attractive to scammers and spammers. They come and fill in the comments: they offer easy money, advertise miraculous funds and promise social benefits. Because of spammers, some users lose money, while others lose the desire to spend time on a scruffy, spam-overgrown service.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And this is not the only problem. </font><font style="vertical-align: inherit;">We strive not only to protect users from scammers, but also to create a comfortable atmosphere for communication. </font><font style="vertical-align: inherit;">If people in the comments encounter obscene language and insults, they are very likely to leave and never return. </font><font style="vertical-align: inherit;">So, this also needs to be able to fight.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clean web</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As it often happens with us, the first developments were born in the Search, in the part that fights spam in the search results. Ten years ago, there appeared the task of filtering adult content for family searches and for queries that do not imply answers from the 18+ category. So the first manually typed dictionaries of porn and mat appeared, they were replenished by analysts. The main task was to classify requests into those where adult content is acceptable and where not. For this task, markup was collected, heuristics were built, models were trained. So the first developments appeared for filtering inappropriate content.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Over time, Yandex began to appear UGC (user generated content) - messages that are written by the users themselves, and Yandex only publishes. </font><font style="vertical-align: inherit;">For the reasons described above, many messages could not be published without looking - moderation was required. </font><font style="vertical-align: inherit;">Then we decided to create a service that would provide protection against spam and cybercriminals for all Yandex UGC products and use the best practices for filtering inappropriate content in the Search. </font><font style="vertical-align: inherit;">The service was called Clean Web.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">New tasks and help tolokers</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At first, only simple automation worked for us: the services sent us texts, and we ran mat dictionaries, porn and regular dictionaries on them - analysts made everything manually. But over time, the service was used in an increasing number of Yandex products, and we had to learn to work with new problems. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Often, instead of recalling, users publish a meaningless set of letters, trying to wind up their achievements, sometimes advertise their company in reviews of a competitor's company, and sometimes they simply confuse organizations and write in a review about a pet store: ‚ÄúPerfectly cooked fish!‚Äù. Perhaps someday artificial intelligence will learn to perfectly capture the meaning of any text, but now automation sometimes copes worse than humans.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It became clear that one could not do without manual marking, and we added the second step to our circuit - sending it for manual inspection by a person. </font><font style="vertical-align: inherit;">There were those published texts for which the classifier did not see problems. </font><font style="vertical-align: inherit;">You can easily imagine the scale of such a task, therefore we not only relied on assessors, but also used the ‚Äúwisdom of the crowd‚Äù, that is, we asked for help from tolokers. </font><font style="vertical-align: inherit;">It is they who help us identify what the machine missed, and thereby teach it.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Smart caching and LSH hashing</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another problem that we encountered when working with comments is spam, or rather, its volume and speed of distribution. When the audience of Yandex.Ryon began to grow rapidly, spammers came there. They learned to get around regulars by slightly changing the text. Spam, of course, was still found and deleted, but hundreds of people could see an unacceptable message even for 5 minutes on a Yandex scale. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cp/kk/us/cpkkusozgcahcmmttege412h16s.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Of course, this did not suit us, and we made smart caching of texts based on LSH ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">locality-sensitive hashing</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">It works like this: we normalized the text, threw out links from it and cut it into n-grams (sequences of n letters). </font><font style="vertical-align: inherit;">Further, the hashes from n-grams were considered, and the LSH-vector of the document was already built on them. </font><font style="vertical-align: inherit;">The point is that similar texts, even if they changed a little, turned into similar vectors. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This decision allowed reusing verdicts of classifiers and tokers for similar texts. </font><font style="vertical-align: inherit;">In a spam attack, as soon as the first message passed the check and got into the cache with the spam verdict, all new similar messages, even modified ones, received the same verdict and were deleted automatically. </font><font style="vertical-align: inherit;">Later, we learned to train and automatically retrain spam classifiers, but this ‚Äúsmart cache‚Äù has remained with us and still helps us a lot.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Classifier of good texts</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Not having time to take a break from fighting spam, we realized that 95% of our content is moderated manually: classifiers respond only to violations, and most texts are good. We load the tolokers, who in 95 cases out of 100 put a rating of "Everything is OK." I had to do an unusual job - to make classifiers of good content, the benefit of markup for this time has accumulated enough.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first classifier looked like this: we lemmatize the text (we reduce the words to the initial form), throw out all the service parts of speech and use the pre-prepared ‚Äúdictionary of good lemmas‚Äù. If all the words are ‚Äúgood‚Äù in the text, then the whole text does not contain violations. On different services, this approach immediately gave from 25 to 35% of manual markup automation. Of course, this approach is not ideal: it is easy to combine several innocent words and get a very offensive statement, but it allowed us to quickly reach a good level of automation and gave time to train more complex models.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The following versions of the classifiers of good texts already included linear models, and decision trees, and their combinations. </font><font style="vertical-align: inherit;">For marking rudeness and insults, for example, we try the BERT neural network. </font><font style="vertical-align: inherit;">Here it is important to grasp the meaning of the word in context and the connection of words from different sentences, and BERT does a good job of this. </font><font style="vertical-align: inherit;">(By the way, recently, colleagues from the News </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">told</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> how they use the technology for a non-standard task - to search for errors in the headers.) As a result, we managed to automate up to 90% of the flow depending on the service.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Accuracy, completeness and speed</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order to develop, you need to understand what kind of automatic classifiers bring benefits, changes in them, and also whether the quality of manual checks does not degrade. For this, we use indicators of accuracy and completeness. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Accuracy is the proportion of correct verdicts among all verdicts of bad content. The higher the accuracy, the less false positives. If you do not follow the accuracy, then in theory you can delete all the spam and obscenities, and with them half of the good messages. On the other hand, if you rely only on accuracy, then the best technology will be that does not catch anyone. Therefore, there is also an indicator of completeness: the proportion of detected bad content among the total volume of bad content. These two metrics balance each other out.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For measurement, we sample the entire incoming stream for each service and give samples of content to assessors for expert evaluation and comparison with machine solutions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But there is another important indicator. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I wrote above that hundreds of people can see an unacceptable message even in 5 minutes. </font><font style="vertical-align: inherit;">Therefore, we consider how many times we managed to show people bad content before hiding it. </font><font style="vertical-align: inherit;">This is important, because it‚Äôs not enough to work efficiently - you need to work fast. </font><font style="vertical-align: inherit;">And when we built the defense against the mat, we felt it to the full.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antimat on the example of kitties and dogs</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A slight lyrical digression. Someone may say that swearing and insults are not as dangerous as malicious links, and not as annoying as spam. But we strive to maintain a comfortable environment for communication between millions of users, and people do not like to return to where they are offended. No wonder the ban on obscene language and insults is spelled out in the rules of many communities, including on Habr√©. But we were distracted.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mata dictionaries do not cope with all the wealth of the Russian language. Despite the fact that there are only four main obscene roots, from them you can make a myriad of words that you can‚Äôt catch by any regulars. In addition, you can write in transliteration part of a word, replace letters with similar combinations, rearrange letters, add stars, etc. Sometimes, without context, it is basically impossible to determine what the user meant an obscene word. We respect the rules of Habr, therefore, we will demonstrate this not on live examples, but on seals and dogs. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/am/2r/7e/am2r7eyo-zcy5ybpozqi-fqpeqe.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚ÄúLyau,‚Äù said the cat. But we understand that the cat said another word ...</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We began to think about the algorithms of ‚Äúfuzzy matching‚Äù of our vocabulary and about more intelligent preprocessing: transliterated, glued spaces and punctuation, looked for patterns and wrote separate regulars on them. This approach yielded results, but often reduced accuracy, without giving the desired completeness. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then we decided to "think like swear words." We ourselves began to introduce noise into the data: rearranged the letters, generated typos, replaced the letters with similar spelling, and so on. The initial markup for this was taken by applying mat dictionaries to large corps of texts. If you take one sentence and distort it in several ways, you will already have many sentences. So you can increase the training sample tens of times. All that remained was to train on a received pool some more or less smart model that took into account the context.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gl/xi/zf/glxizf1l6hii-b8rxzxzictbkgu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It‚Äôs too early to talk about the final decision. </font><font style="vertical-align: inherit;">We are still experimenting with approaches to this problem, but we already see that a simple symbolic convolution network of several layers significantly exceeds dictionaries and regulars: it turns out to increase both accuracy and completeness. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Of course, we understand that there are always ways to get around even the most advanced automation, especially when it‚Äôs so reckless: to write so that a stupid machine does not understand. </font><font style="vertical-align: inherit;">Here, as in the fight against spam, we have no goal to eradicate the very possibility of writing something obscene, our task is to make the game not worth the candle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It‚Äôs easy to open the opportunity to share your opinion, communicate and comment. </font><font style="vertical-align: inherit;">It is much more difficult to achieve a safe, comfortable environment and respect for people. </font><font style="vertical-align: inherit;">And without this, there will be no development of any community.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en490824/index.html">PostgreSQL index health through the eyes of a Java developer</a></li>
<li><a href="../en490826/index.html">The source of production efficiency</a></li>
<li><a href="../en490828/index.html">Creating roguelike in Unity from scratch</a></li>
<li><a href="../en490830/index.html">Password Management in Zimbra Collaboration Suite Open-Source Edition</a></li>
<li><a href="../en490832/index.html">Shoe marking: as we put into circulation 2 million marking codes ‚Äú1C‚Äù + ‚ÄúHonest Sign‚Äù</a></li>
<li><a href="../en490838/index.html">WiFi 6 is here: what the market offers and why do we need this technology</a></li>
<li><a href="../en490840/index.html">Resource Planning. Part 4.1. Before you make a resource plan</a></li>
<li><a href="../en490842/index.html">GPT-2 in pictures (visualization of Transformer language models)</a></li>
<li><a href="../en490844/index.html">Book ‚ÄúKubernetes Patterns: Native Cloud Application Development Patterns‚Äù</a></li>
<li><a href="../en490846/index.html">How we developed a website for the Kalashnikov Academy and became laureates of two competitions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>