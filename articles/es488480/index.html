<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüåæ üßïüèº üë©üèæ‚Äçüé§ Una l√°mpara inteligente para los "ricos" con sus manos "flojas", es "simple" y conveniente üóÇÔ∏è üöÑ üßó</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introducci√≥n
 Hizo una iluminaci√≥n "moderna" en la cocina para un fregadero, una estufa y una mesa de corte sobre la base de una tira de LED controlad...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Una l√°mpara inteligente para los "ricos" con sus manos "flojas", es "simple" y conveniente</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488480/"><img src="https://habrastorage.org/webt/os/hi/gl/oshiglmjknpmabuu6ivivauqzdw.jpeg"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introducci√≥n</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hizo una iluminaci√≥n "moderna" en la cocina para un fregadero, una estufa y una mesa de corte sobre la base de una tira de LED controlada por arduino (que se llame la l√°mpara 1). </font><font style="vertical-align: inherit;">Este dise√±o funcion√≥ durante 2 a√±os, hasta que la parte de potencia de los "cerebros" se ha deteriorado. </font><font style="vertical-align: inherit;">Esta es una excelente ocasi√≥n para reinventar la rueda de la "basura improvisada" nuevamente (l√°mpara 2). </font><font style="vertical-align: inherit;">Es cierto que esta vez la "basura" ser√° costosa y compatible con el hogar inteligente Z-wave. </font><font style="vertical-align: inherit;">La siguiente es una historia sobre el reemplazo de arduino con ZUNo (un m√≥dulo compatible con arduino para crear un dispositivo de onda Z) con el m√°ximo ahorro de c√≥digo y una explicaci√≥n de los cambios necesarios.</font></font><br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øQu√© pas√≥ antes de que apareciera all√≠?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√ârase una vez, para lavar los platos o cocinar, era necesario encender la l√°mpara sobre el fregadero. </font><font style="vertical-align: inherit;">Era una l√°mpara de mesa renovada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No me gustaba presionar el peque√±o interruptor con las manos mojadas porque cambiaba 220 voltios a la l√°mpara incandescente. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tl/yz/dq/tlyzdqgfcsedxxsswsqlekygins.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, la luz de la l√°mpara cay√≥ principalmente en el fregadero, pero quer√≠a iluminar mejor la mesa de cocina y la estufa. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objetivos:</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Haga que la luz de encendido / apagado en la cocina no tenga contacto;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ilumina uniformemente el fregadero, la mesa de cocina y la estufa;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ahorre energ√≠a reemplazando las bombillas incandescentes con LED.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensambl√≥ la l√°mpara 1. Consist√≠a en una caja de aluminio de 2 metros con un difusor para cinta RGB y una unidad de control. Se compraron una caja y un difusor listos para usar en la tienda, hab√≠a una cinta y la unidad de control llevaba mucho tiempo en la esquina y esperaba en las alas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El estuche era industrial (a prueba de polvo, impermeable). Dado que la cinta es de 12 voltios, la unidad de fuente de alimentaci√≥n de 220 V a 12 V se encuentra en la unidad, la placa de aislamiento galv√°nico para controlar la cinta basada en TLP250 (optoacoplador) tambi√©n controla todo este arduino en un dise√±o compacto.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Obtuve el aislamiento galv√°nico del antiguo proyecto. Una vez hice una luz de fondo para un minibar en mi mesita de noche. Cuando se abri√≥ la puerta, el panel t√°ctil registr√≥ un cambio de capacidad y encendi√≥ una luz suave y brillante. Es decir, la junta era adecuada para el proyecto actual, todo lo que quedaba era cortar todo lo innecesario. Hab√≠a un convertidor lineal de 5 voltios en el tablero, funcionaba con ZUNo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se plane√≥ encender la l√°mpara con una bandeja manual para el medidor de distancia ultras√≥nico. Lo mont√≥ en la tapa, y todas las otras partes se metieron en la caja. Todo "confiablemente" fijado con adhesivo termofusible. En el momento de la prueba, hice un bot√≥n al lado de la fuente de alimentaci√≥n a la unidad de control desde el interruptor de luz para la instalaci√≥n externa.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/r2/dn/tj/r2dntjzjoijyn-g7vk4vdkg-d5y.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Encender las luces se ha vuelto m√°s conveniente y seguro. </font><font style="vertical-align: inherit;">Estaba conectado boca abajo al fondo del armario de la cocina y era m√°s dif√≠cil sacar agua de las manos mojadas desde el interior.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusiones de la unidad de control anterior.</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La iluminaci√≥n del √°rea de trabajo de la cocina se volvi√≥ m√°s uniforme y placentera, debido a la reproducci√≥n de color no natural de mi tira de LED, el color de algunos productos cambi√≥. </font><font style="vertical-align: inherit;">Por ejemplo: las zanahorias parec√≠an mucho m√°s apetitosas debido al color m√°s brillante. </font><font style="vertical-align: inherit;">Pero no interfiri√≥ mucho, y espero que no haya hecho mucho da√±o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con el encendido / apagado sin contacto, todo result√≥ ser peor. </font><font style="vertical-align: inherit;">Funcion√≥. </font><font style="vertical-align: inherit;">Pero despu√©s de 5 minutos en estado apagado, comenzaron los destellos en la tira de LED. </font><font style="vertical-align: inherit;">No comenc√© a rehacer el circuito con optoacopladores y dej√© todo como est√°. </font><font style="vertical-align: inherit;">Solo para encender y apagar comenz√≥ a usar el nuevo interruptor. </font><font style="vertical-align: inherit;">A todos les gust√≥ su ubicaci√≥n y forma.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante dos a√±os de uso, la grasa y otros compuestos secretados durante la cocci√≥n se acumulan en el cuerpo y en su interior. </font><font style="vertical-align: inherit;">Esta placa penetr√≥ parcialmente en la carcasa a trav√©s de los agujeros para la entrada de cables. </font><font style="vertical-align: inherit;">Pero debido a la superficie brillante del cuerpo, esta sustancia se condensa en una masa gelatinosa. </font><font style="vertical-align: inherit;">Es agradable al tacto, inodoro y ... (no lo prob√©). </font><font style="vertical-align: inherit;">Tom√© algunas fotos del lugar en forma de germen de drag√≥n. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jz/fr/ys/jzfrystsmthfk7fy5j_o70kkcfm.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/ot/br/mg/otbrmglxan7uooc1a1e4n88z9iq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En las paredes, esta sustancia se convierte en una incursi√≥n terrible, que no solo se lava.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lo que se ha convertido</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Habiendo hurgado en contenedores encontr√© un m√≥dulo de expansi√≥n inacabado para ZUNo. </font><font style="vertical-align: inherit;">ZUNo es una placa tipo arduino para dise√±ar su propio dispositivo compatible con el hogar inteligente Z-Wave. </font><font style="vertical-align: inherit;">Se programa desde el entorno de arduino.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Especificaciones del fabricante:</font></font></b><div class="spoiler_text"><ul>
<li>28 kB Flash memory for your sketches</li>
<li>2 kB RAM available</li>
<li>Z-Wave RF transmitter at 9.6/40/100 kbps</li>
<li>26 GPIO (overlaps with special hardware controllers)</li>
<li>4 ADC</li>
<li>5 PWM</li>
<li>2 UART</li>
<li>1 USB (serial port)</li>
<li>16 kB EEPROM</li>
<li>1 SPI (master or slave)</li>
<li>4 IR controllers, 1 IR learn capability</li>
<li>1 TRIAC/ZEROX to control dimmer</li>
<li>3 Interrupts</li>
<li>1 Timer 4 MHz</li>
<li>I2C (software)</li>
<li>1-Wire (software)</li>
<li>8x6 Keypad Scanner (software)</li>
<li>2 service LED, 1 service button</li>
<li>1 user test LED</li>
</ul><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El m√≥dulo de expansi√≥n convierte a ZUNo en una placa de depuraci√≥n completa que, despu√©s de depurar el prototipo, puede usarse como un dispositivo completo. </font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alguna informaci√≥n del fabricante:</font></font></b><div class="spoiler_text"><ul>
<li>One 0-10 V analog output ‚Äî control industrial dimmers</li>
<li>Up to four PWM or switch outputs (up to 5 A per channel) ‚Äî control contactors, switches, halogen bulbs or LED strips</li>
<li>Up to eight digital 0/3 V inputs or outputs ‚Äî connect various low voltage digital senors and actors</li>
<li>Up to four digital 0/3, 0/5 or 0/12 V digital or analog inputs ‚Äî connect industrial 10 V sensors or any Arduino-compatible sensor</li>
<li>RS485 or UART ‚Äî for industial meters</li>
<li>OneWire ‚Äî for DS18B20 or other sensors</li>
</ul><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para mi proyecto, necesito 3 transistores potentes para cambiar 12 voltios a una tira de LED y un convertidor de 12 voltios a 5 voltios para alimentar ZUNo. </font><font style="vertical-align: inherit;">El resto de la periferia del m√≥dulo de expansi√≥n no est√° soldado ni probado. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4j/kr/tt/4jkrtt63ocqqrkugav0nrtfvtn8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En esta parte del circuito, no hay suficiente diodo para la fuente de alimentaci√≥n, para la protecci√≥n contra la "inversi√≥n de polaridad", y las resistencias en las puertas de los transistores de efecto de campo de potencia deb√≠an conectarse a la puerta, y no frente a la resistencia limitadora. </font><font style="vertical-align: inherit;">Escribir√© m√°s sobre esto en las conclusiones. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este m√≥dulo de expansi√≥n se suministra en una carcasa de Gainta. </font><font style="vertical-align: inherit;">Mi unidad de control anterior tambi√©n era en el caso de esta compa√±√≠a, pero de un tama√±o diferente. </font><font style="vertical-align: inherit;">Desafortunadamente, las fijaciones en el m√≥dulo no se ajustaban al caso anterior, y no quer√≠a perforar uno nuevo, dej√© el caso anterior. </font><font style="vertical-align: inherit;">El tablero se "plant√≥" sobre adhesivo termofusible.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wm/ls/ah/wmlsahydh07_hxmpqaryl1atchs.jpeg"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un poco sobre la programaci√≥n de Arduino y ZUNo</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los dispositivos de onda Z deben tener un cierto n√∫mero de clases. Las clases describen las funciones del dispositivo y las interfaces de interacci√≥n. Por ejemplo, mi l√°mpara controla una tira de LED que consta de tres colores (rojo, verde, azul). Estas funciones son realizadas por la clase Switch multinivel. Si lo agregamos al boceto, podemos cambiar de forma remota el brillo de uno de los colores. Para controlar tres colores, debe hacer tres instancias de esta clase. No hablar√© sobre esto con m√°s detalle y detalle. Debido a que la manipulaci√≥n de clase de rutina est√° oculta para los usuarios de ZUNo por la noci√≥n de "canal". Por ejemplo, necesito tres clases de Switch multinivel, por lo que en el c√≥digo deben aparecer 3 canales de Switch multinivel y varias funciones de devoluci√≥n de llamada para el control de radio. ¬øComo hacer esto? Tambi√©n necesita agregar la clase b√°sica Switch,para encender y apagar la l√°mpara con solo tocar un bot√≥n (desde la interfaz del controlador de red), y no configurar 3 canales cada vez.</font></font><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debe</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ir al sitio web de desarrolladores, donde se presentan ejemplos de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">z-uno.z-wave.me/Reference/ZUNO_SWITCH_MULTILEVEL</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Cada clase admitida por ZUNo tiene una descripci√≥n y un ejemplo. </font><font style="vertical-align: inherit;">Luego, copie y pegue las funciones propuestas en su boceto. </font><font style="vertical-align: inherit;">Ahora en el boceto hay tres canales multinivel de conmutaci√≥n y 6 funciones de devoluci√≥n de llamada para responder a comandos en la radio. </font><font style="vertical-align: inherit;">No soy muy sofisticado en las clases de Z-Wave, por lo que mi dispositivo de tira de LED anterior funcionaba con este conjunto de clases. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los canales fueron declarados as√≠:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encabezado de spoiler</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs">ZUNO_SETUP_CHANNELS(<font></font>
      ZUNO_SWITCH_MULTILEVEL(getRed, setRed),<font></font>
      ZUNO_SWITCH_MULTILEVEL(getGreen, setGreen),<font></font>
      ZUNO_SWITCH_MULTILEVEL(getBlue, setBlue),<font></font>
      ZUNO_SWITCH_BINARY(switch_getter, switch_setter)<font></font>
);</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto llev√≥ a la generaci√≥n de los siguientes widgets en el controlador despu√©s de agregarlos a la red: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/to/-y/if/to-yif5eaf9xkuxdk4t2oxp6ph4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para ajustar el color, era necesario abrir y configurar cada color en el men√∫ del controlador por separado. </font><font style="vertical-align: inherit;">No es conveniente y lento. </font><font style="vertical-align: inherit;">Sin embargo, tuve suerte. </font><font style="vertical-align: inherit;">Result√≥ que no estoy solo. </font><font style="vertical-align: inherit;">Pensaron en nosotros e hicieron el canal </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">z-uno.z-wave.me/Reference/ZUNO_SWITCH_COLOR</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ahora solo hay un canal y dos funciones de devoluci√≥n de llamada en el boceto. </font><font style="vertical-align: inherit;">En el men√∫ del controlador, la configuraci√≥n de color se realiza por separado para cada color, as√≠ como para todos a la vez, seleccionando desde la paleta.</font></font><br>
<br>
<pre><code class="cpp hljs">ZUNO_SETUP_CHANNELS(ZUNO_SWITCH_COLOR(SWITCH_COLOR_FLAGS_RED|SWITCH_COLOR_FLAGS_GREEN|SWITCH_COLOR_FLAGS_BLUE, getterFunction, setterFunction));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y en el men√∫ del controlador se ve as√≠: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/m3/zn/qk/m3znqkbwue228cttqmqmhggvwxu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
la siguiente funci√≥n responde a las solicitudes por radio. </font><font style="vertical-align: inherit;">Puede llegar una solicitud para leer el estado de uno de los canales de color.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">BYTE <span class="hljs-title">getterFunction</span><span class="hljs-params">(BYTE component)</span> </span>{
  <span class="hljs-keyword">switch</span>(component)<font></font>
  {<font></font>
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_RED:
      <span class="hljs-keyword">return</span> pwmR;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_GREEN:
      <span class="hljs-keyword">return</span> pwmG;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_BLUE:
      <span class="hljs-keyword">return</span> pwmB;
      <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">3</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y esta es una funci√≥n para configurar colores desde la interfaz del controlador.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setterFunction</span><span class="hljs-params">(BYTE component, BYTE newValue)</span> 
</span>{
  <span class="hljs-keyword">switch</span>(component)<font></font>
  {<font></font>
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_RED:<font></font>
      pwmR = newValue;<font></font>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_GREEN:<font></font>
      pwmG = newValue;<font></font>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_BLUE:<font></font>
      pwmB = newValue;<font></font>
      <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
  radio_action = <span class="hljs-number">1</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ese es todo el c√≥digo que necesita agregar para convertir un boceto arduino en un boceto para ZUNo.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusi√≥n</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s del montaje y la instalaci√≥n, se completaron todas las tareas declaradas. </font><font style="vertical-align: inherit;">Sin embargo, el h√°bito de encender la luz con el interruptor se mantuvo (result√≥ ser muy conveniente). </font><font style="vertical-align: inherit;">La opci√≥n de inclusi√≥n sin contacto tambi√©n funciona. </font><font style="vertical-align: inherit;">Entre las deficiencias, quiero notar el parpadeo de la l√°mpara LED por un segundo despu√©s de aplicar energ√≠a a la unidad de control. </font><font style="vertical-align: inherit;">Esto se debe a la larga inicializaci√≥n de los perif√©ricos ZUNo. </font><font style="vertical-align: inherit;">En este punto, las piernas son impredecibles. </font><font style="vertical-align: inherit;">Creo que la resistencia pull-up en la puerta del transistor corregir√° la situaci√≥n si la pones despu√©s de la resistencia limitadora. </font><font style="vertical-align: inherit;">Si el c√≥digo de inicializaci√≥n ajusta los tramos a la salida y cambia los niveles l√≥gicos a prop√≥sito, puede experimentar con el filtro RC, que no pasar√° pulsos cortos. </font><font style="vertical-align: inherit;">¬°Todav√≠a no lo he hecho, y tal vez nunca lo haga!</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recomendaciones</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ZUNo y su m√≥dulo de expansi√≥n simplifican enormemente la "creatividad t√©cnica dom√©stica". Sin embargo, considero que estos productos son muy caros y si trabajara en otro lugar y el equipo Z-Wave no estuviera por ah√≠, har√≠a todo en ESP8266. Durante el desarrollo aprend√≠ un nuevo "est√°ndar" para marcar cables desde la fuente de alimentaci√≥n.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sx/c4/4h/sxc44hipyu2ml_agdxtaqthtvrs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora no solo la tierra est√° marcada con una franja negra, sino como en mi caso el cable "positivo". Para el m√≥dulo de expansi√≥n, esto result√≥ ser importante. El convertidor LM2594 de 5 voltios ha fallado (el precio en Chip y Dip es de aproximadamente 200 rublos). Espero que en la pr√≥xima versi√≥n del m√≥dulo de expansi√≥n haya un diodo protector contra la "inversi√≥n de polaridad". Y comprobar√© la polaridad de los cables de alimentaci√≥n. Otro inconveniente est√° asociado con el cuerpo. El caso se ve bien, pero no pude conectar los cables sin pinzas a los bloques de terminales. Espero que haya una versi√≥n con otros bloques de terminales (para conectar cables desde arriba o en √°ngulo). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No me gusta almacenar fotos en servicios en la nube y, a menudo, hacer copias de seguridad. Por lo tanto, la mayor√≠a de las fotograf√≠as asociadas con el proceso de dise√±o y la l√°mpara 1 est√°n irremediablemente corrompidas.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zz/wz/ov/zzwzovgton7f2yxvy-2bd4zhucu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto es todo lo que queda del proceso de montaje y depuraci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y parece que la luz de fondo se pone en funcionamiento, si se dobla un poco. </font><font style="vertical-align: inherit;">Si se endereza, la caja y el interruptor no son visibles.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ya/qj/hn/yaqjhnpkhd7ge2ohejbp9ywkqpq.jpeg"> <br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Boceto para ZUNo. </font><font style="vertical-align: inherit;">Adjunto, solo para confirmar que todo es elemental</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"EEPROM.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"EEPR.h"</span></span><font></font>
<font></font>
<span class="hljs-keyword">int</span> readPin = <span class="hljs-number">9</span>;
<span class="hljs-keyword">int</span> triggerPin = <span class="hljs-number">10</span>;<font></font>
byte controlState = <span class="hljs-number">0</span>;<font></font>
word lastValue;<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> REDPIN   PWM1     <span class="hljs-comment">// pin connection R </span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> GREENPIN PWM2     <span class="hljs-comment">// pin connection G</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> BLUEPIN  PWM3     <span class="hljs-comment">// pin connection B</span></span><font></font>
<font></font>
ZUNO_SETUP_CHANNELS(ZUNO_SWITCH_COLOR(SWITCH_COLOR_FLAGS_RED|SWITCH_COLOR_FLAGS_GREEN|SWITCH_COLOR_FLAGS_BLUE, getterFunction, setterFunction));<font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ON 1</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> OFF 0</span>
<span class="hljs-keyword">uint8_t</span> switch_=OFF;<font></font>
<font></font>
<span class="hljs-keyword">uint8_t</span> pwmR=<span class="hljs-number">0</span>;
<span class="hljs-keyword">uint8_t</span> pwmG=<span class="hljs-number">0</span>;
<span class="hljs-keyword">uint8_t</span> pwmB=<span class="hljs-number">0</span>;
<span class="hljs-keyword">uint8_t</span> b_pwmR=<span class="hljs-number">0</span>;
<span class="hljs-keyword">uint8_t</span> b_pwmG=<span class="hljs-number">0</span>;
<span class="hljs-keyword">uint8_t</span> b_pwmB=<span class="hljs-number">0</span>;<font></font>
<font></font>
<span class="hljs-keyword">enum</span><font></font>
{<font></font>
  DEF_R = <span class="hljs-number">255</span>,<font></font>
  DEF_G = <span class="hljs-number">255</span>,<font></font>
  DEF_B = <span class="hljs-number">255</span><font></font>
};<font></font>
<span class="hljs-keyword">uint8_t</span> radio_action = <span class="hljs-number">0</span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> 
</span>{ <font></font>
  init_EEPROM();<font></font>
  Serial.begin();<font></font>
  pinMode(readPin, INPUT);<font></font>
  pinMode(triggerPin, OUTPUT);<font></font>
  digitalWrite(triggerPin, LOW);<font></font>
  pinMode(REDPIN, OUTPUT);<font></font>
  pinMode(GREENPIN, OUTPUT);<font></font>
  pinMode(BLUEPIN, OUTPUT);<font></font>
  analogWrite(REDPIN, pwmR &amp; <span class="hljs-number">0xff</span>);<font></font>
  analogWrite(GREENPIN, pwmG &amp; <span class="hljs-number">0xff</span>);<font></font>
  analogWrite(BLUEPIN, pwmB &amp; <span class="hljs-number">0xff</span>);<font></font>
  <font></font>
} <font></font>
<span class="hljs-keyword">int</span> act=<span class="hljs-number">1</span>;
<span class="hljs-keyword">int</span> actf = <span class="hljs-number">0</span>;
<span class="hljs-keyword">int</span> cnt=<span class="hljs-number">57</span>; <font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">int</span> tmp;
  <span class="hljs-comment">// trigger measurement</span><font></font>
  digitalWrite(triggerPin, LOW);<font></font>
  delayMicroseconds(<span class="hljs-number">10</span>);<font></font>
  digitalWrite(triggerPin, HIGH);<font></font>
  delayMicroseconds(<span class="hljs-number">10</span>);<font></font>
  digitalWrite(triggerPin, LOW);<font></font>
  <span class="hljs-comment">// read pulse width</span>
  tmp = pulseIn(readPin, HIGH, <span class="hljs-number">100000</span>);<font></font>
  lastValue = tmp / <span class="hljs-number">58</span>;<font></font>
  Serial.print(<span class="hljs-string">" cm= "</span>);<font></font>
  Serial.println(lastValue);<font></font>
  <span class="hljs-keyword">if</span> (lastValue &lt; <span class="hljs-number">30</span>)<font></font>
  {<font></font>
    cnt++;<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span><font></font>
  {<font></font>
    cnt--;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (cnt &gt; <span class="hljs-number">55</span>)<font></font>
  { <font></font>
    act=<span class="hljs-number">1</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (cnt &gt; <span class="hljs-number">60</span>)<font></font>
    cnt= <span class="hljs-number">60</span>;
  <span class="hljs-keyword">if</span> (cnt &lt; <span class="hljs-number">50</span>)<font></font>
  {<font></font>
    act=<span class="hljs-number">0</span>;<font></font>
    actf=<span class="hljs-number">0</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (cnt &lt; <span class="hljs-number">45</span> )<font></font>
    cnt = <span class="hljs-number">45</span>;<font></font>
  <font></font>
  <span class="hljs-keyword">if</span> ((act == <span class="hljs-number">1</span>) &amp;&amp; (actf == <span class="hljs-number">0</span>))<font></font>
  {  <font></font>
    actf = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">if</span> (switch_ == OFF)<font></font>
    {<font></font>
      switch_=ON;<font></font>
      b_pwmG = pwmG;<font></font>
      b_pwmB = pwmB;<font></font>
      b_pwmR = pwmR;<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
      switch_=OFF;<font></font>
      b_pwmR=<span class="hljs-number">0</span>;<font></font>
      b_pwmG=<span class="hljs-number">0</span>;<font></font>
      b_pwmB=<span class="hljs-number">0</span>;<font></font>
    }<font></font>
    analogWrite(REDPIN, b_pwmR &amp; <span class="hljs-number">0xff</span>);<font></font>
    analogWrite(GREENPIN, b_pwmG &amp; <span class="hljs-number">0xff</span>);<font></font>
    analogWrite(BLUEPIN, b_pwmB &amp; <span class="hljs-number">0xff</span>); <font></font>
  } <font></font>
  <font></font>
  Serial.print(<span class="hljs-string">"cnt = "</span>);    <font></font>
  Serial.print(cnt);  <font></font>
  Serial.print(<span class="hljs-string">" || "</span>);    <font></font>
  Serial.print(pwmR);  <font></font>
  Serial.print(<span class="hljs-string">" "</span>);      <font></font>
  Serial.print(pwmG);  <font></font>
  Serial.print(<span class="hljs-string">" "</span>);<font></font>
  Serial.print(pwmB);  <font></font>
  Serial.print(<span class="hljs-string">" "</span>);<font></font>
  Serial.println(<span class="hljs-string">""</span>);
 <span class="hljs-comment">// delay(10);</span><font></font>
<font></font>
 <span class="hljs-keyword">if</span>(radio_action)<font></font>
 {<font></font>
    radio_action = <span class="hljs-number">0</span>;<font></font>
    eepr_save_col();<font></font>
    analogWrite(REDPIN, pwmR &amp; <span class="hljs-number">0xff</span>);<font></font>
    analogWrite(GREENPIN, pwmG &amp; <span class="hljs-number">0xff</span>);<font></font>
    analogWrite(BLUEPIN, pwmB &amp; <span class="hljs-number">0xff</span>);<font></font>
 }<font></font>
}<font></font>
<font></font>
<span class="hljs-function">BYTE <span class="hljs-title">getterFunction</span><span class="hljs-params">(BYTE component)</span> </span>{
  <span class="hljs-keyword">switch</span>(component)<font></font>
  {<font></font>
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_RED:
      <span class="hljs-keyword">return</span> pwmR;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_GREEN:
      <span class="hljs-keyword">return</span> pwmG;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_BLUE:
      <span class="hljs-keyword">return</span> pwmB;
      <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">3</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setterFunction</span><span class="hljs-params">(BYTE component, BYTE newValue)</span> 
</span>{
  <span class="hljs-keyword">switch</span>(component)<font></font>
  {<font></font>
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_RED:<font></font>
      pwmR = newValue;<font></font>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_GREEN:<font></font>
      pwmG = newValue;<font></font>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_BLUE:<font></font>
      pwmB = newValue;<font></font>
      <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
  radio_action = <span class="hljs-number">1</span>;<font></font>
}<font></font>
</code></pre><br>
</div></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es488470/index.html">Kim Dotcom: Atrapado, la persona m√°s buscada en l√≠nea. Parte 4</a></li>
<li><a href="../es488472/index.html">Lectura de fin de semana: 10 materiales sobre dispositivos de audio, desde radios de autom√≥viles sovi√©ticos hasta enchufes con cancelaci√≥n de ruido</a></li>
<li><a href="../es488474/index.html">Sobre el color, el sonido y la "exploraci√≥n de multitudes" como un tipo separado de belleza</a></li>
<li><a href="../es488476/index.html">Bobina de tubo Tesla</a></li>
<li><a href="../es488478/index.html">Transfiera todas las bases de datos de MS SQL Server a otra m√°quina</a></li>
<li><a href="../es488482/index.html">¬øCu√°nto cuesta Appium para la gente?</a></li>
<li><a href="../es488484/index.html">Lanzamiento de SQL: evento de Microsoft SQL Server 2019</a></li>
<li><a href="../es488488/index.html">Para OpenBSD Un poco de deleite</a></li>
<li><a href="../es488490/index.html">Likbez en respiradores. ¬øEl respirador ayuda con la infecci√≥n por virus? Resumen de 11 respiradores</a></li>
<li><a href="../es488492/index.html">Tesla emitir√° nuevas acciones por $ 2 mil millones</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>