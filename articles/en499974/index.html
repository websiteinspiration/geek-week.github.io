<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë∂üèΩ ü•à üßôüèæ 3D games on Instagram Javascript, or sausage flight path ü§ö üéÖüèº üëÄ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After the first article on programming games in masks on Instagram, a customer asked me to create a game on Instagram for his pizzeria. This game was ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>3D games on Instagram Javascript, or sausage flight path</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/499974/"><img src="https://habrastorage.org/webt/gl/zq/2a/glzq2aogs8xde9o1cauyy8qc838.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After the first article on programming games in masks on Instagram, a customer asked me to create a game on Instagram for his pizzeria. This game was planned to be used for business promotion purposes. Of course, I understand that, judging by the number of views of the first article, the Instagram theme is not particularly interesting to the Habr community. Apparently, this service is still considered some kind of frivolous entertainment for blondes, and an article about it is only suitable as a Friday reading for an evening cocktail. However, today, just Friday. Get a cocktail. And don't forget to invite blondes. However, it is likely that in the future technology will reach such heights that we will begin to play on Instagram in GTA-5. Or 10.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This article will discuss two games at once. </font><font style="vertical-align: inherit;">I made one to order, and then the second for myself. </font><font style="vertical-align: inherit;">With each new game, I was faced with new tasks, the search for solutions to which made me get acquainted with the new nuances of development. </font><font style="vertical-align: inherit;">Perhaps this story will be useful to other developers of elements of augmented reality. </font><font style="vertical-align: inherit;">The games are written in pure Javascript without the use of any additional libraries. </font><font style="vertical-align: inherit;">To display 3D graphics, the built-in Instagram tools are used.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Game 1. Pizza</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, what is the essence of the first game. Spinning pizza. Components fly off from its surface - pieces of sausage, tomatoes and so on. Two players must catch their mouth. The winner is the one who, as you might guess, will catch more. Over time, the rotation speed increases. The funniest thing in this game for me was programming the flight paths of these edible elements. Imagine programming a sausage flight. No, definitely, I've never had so much fun programming. I laugh even now, writing this article. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When the customer saw the working prototype, he sent me this: ‚Äú:))‚Äù. There was a problem while testing the final result. It consisted in the fact that the subjects could not play the game: they were simply bursting with laughter - it was so much fun.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let me remind you, the development of masks and games is made in Spark AR Studio. And then from there you can upload your work on Instagram for everyone to see. It is noteworthy that web technologies blur the boundaries between operating systems for a developer. You write one code, which then works in the Instagram application for both iOS and Android, without any modifications or changes. Of course, the payment for this becomes a fundamentally low script speed.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The schedule for the game was provided by the customer. There were some difficulties with 3D models. In particular, when using the built-in animation engine Spark AR Studio, it turned out that if the moving object is scaled, then its coordinates are incorrectly determined in the game. But this annoying effect is not observed if you do not scale the entire object completely, but each of its mesh separately. I had to leave the scale of pizza 1: 1, and to prescribe a certain coefficient for each element making it. There were also problems with the FBX format into which you need to export models for an Instagram game. The graphic designer sent models with built-in textures, which, moreover, were placed along a relative path. The 3D editor saw them, but Spark AR didn‚Äôt. I had to repack the models so that the texture files lay separately from the models and along one path with them.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And another small problem that I encountered was that the api Saprk AR object responsible for displaying the text on the screen refused to accept the value as a value - a game score, for example. </font><font style="vertical-align: inherit;">For a long time I could not understand why nothing is displayed. </font><font style="vertical-align: inherit;">What am I doing wrong? </font><font style="vertical-align: inherit;">It turned out that you first need to convert the numbers to strings (.toString ()). </font><font style="vertical-align: inherit;">This goes without saying for other languages, but rather atypical for javascript, which has always done this itself.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simple animation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
One of the new things for me in this game was programming the animation of 3D objects. (In my previous Instagram game ‚ÄúTic-Tac-Toe,‚Äù there was no animation at all.) The animation engine in Spark AR Studio is very specific. It takes some input parameters, and then reactively connects the variable with the object in which you want to change something. For example, this will change the y coordinate (startValue, endValue - its initial and final values) of some 3D object over time t:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">var</span> driverParameters = {
    <span class="hljs-attr">durationMilliseconds</span>: t,
    <span class="hljs-attr">loopCount</span>: <span class="hljs-literal">Infinity</span>,
    <span class="hljs-attr">mirror</span>: <span class="hljs-literal">false</span><font></font>
};<font></font>
<span class="hljs-keyword">var</span> driver = Animation.timeDriver(driverParameters);
<span class="hljs-keyword">var</span> sampler = Animation.samplers.linear(startValue, endValue);<font></font>
sceneObject.transform.y = Animation.animate(driver, sampler);<font></font>
driver.start();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To move the pizza ingredients flying off in space, I decided to simply run three such animations in parallel for each coordinate. It was enough to indicate the initial coordinate (startValue) and the final coordinate calculated by the angle of rotation of the pizza (endValue), so that it was somewhere far away in case the player did not catch this ‚Äúshell‚Äù with his mouth. If caught - then the movement stops. The mouth opening event I already described in a previous article. Only here is a game for two and, accordingly, there will already be two faces and two mouths:</font></font><br>
<br>
<pre><code class="javascript hljs">FaceTracking.face(<span class="hljs-number">0</span>).mouth.openness.monitor().subscribe(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
    <span class="hljs-keyword">if</span> (event.newValue &gt; <span class="hljs-number">0.2</span>) {<font></font>
        ...<font></font>
    };<font></font>
});<font></font>
<font></font>
FaceTracking.face(<span class="hljs-number">1</span>).mouth.openness.monitor().subscribe(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
    <span class="hljs-keyword">if</span> (event.newValue &gt; <span class="hljs-number">0.2</span>) {<font></font>
        ...<font></font>
    };<font></font>
});</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The key point in this game is catching flying ingredients with your mouth, in other words, finding a flying object in a given small area around the center of a person‚Äôs mouth. </font><font style="vertical-align: inherit;">At first, this calculation did not want to be done correctly for me, but a solution to the problem was found after the introduction of a hidden object tied to the coordinates of the mouth, and it worked. </font><font style="vertical-align: inherit;">For some reason, the direct coordinates of the mouth did not return. </font><font style="vertical-align: inherit;">Here cameraTransform.applyTo is the reduction of the coordinates of face points to the coordinates in the 3D world (the method is taken from the documentation).</font></font><br>
<br>
<pre><code class="javascript hljs">move: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-comment">//   (   )</span><font></font>
<font></font>
    <span class="hljs-comment">//    </span>
    <span class="hljs-keyword">var</span> object = Scene.root.find(<span class="hljs-string">'pizzafly'</span>);
    <span class="hljs-keyword">var</span> olast = {
        <span class="hljs-attr">x</span>: object.transform.x.pinLastValue(),
        <span class="hljs-attr">y</span>: object.transform.y.pinLastValue(),
        <span class="hljs-attr">z</span>: object.transform.z.pinLastValue()<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">//   ,       </span>
    <span class="hljs-keyword">var</span> objectHidden = Scene.root.find(<span class="hljs-string">'nullObject'</span>);<font></font>
    objectHidden.transform.x = FaceTracking.face(face).cameraTransform.applyTo(FaceTracking.face(face).mouth.center).x;<font></font>
    objectHidden.transform.y = FaceTracking.face(face).cameraTransform.applyTo(FaceTracking.face(face).mouth.center).y;<font></font>
    objectHidden.transform.z = FaceTracking.face(face).cameraTransform.applyTo(FaceTracking.face(face).mouth.center).z;<font></font>
<font></font>
    <span class="hljs-comment">//   </span>
    <span class="hljs-keyword">var</span> mouth = {
        <span class="hljs-attr">x</span>: objectHidden.transform.x.pinLastValue(),
        <span class="hljs-attr">y</span>: objectHidden.transform.y.pinLastValue(),
        <span class="hljs-attr">z</span>: objectHidden.transform.z.pinLastValue()<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">//    </span>
    <span class="hljs-keyword">var</span> d = {
        <span class="hljs-attr">x</span>: <span class="hljs-built_in">Math</span>.abs(olast.x - mouth.x),
        <span class="hljs-attr">y</span>: <span class="hljs-built_in">Math</span>.abs(olast.y - mouth.y),
        <span class="hljs-attr">z</span>: <span class="hljs-built_in">Math</span>.abs(olast.z - mouth.z)<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">if</span> ((d.x &gt; <span class="hljs-number">0.03</span>) || (d.y &gt; <span class="hljs-number">0.03</span>) || (d.z &gt; <span class="hljs-number">0.03</span>)) {
        <span class="hljs-comment">// </span><font></font>
        ...<font></font>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// </span><font></font>
        ...<font></font>
    };<font></font>
<font></font>
},<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Subsequently, I realized that you should remove the depth check (z coordinate), since in this particular game it is visually difficult to estimate the depth. </font><font style="vertical-align: inherit;">That is, now it became possible to catch the ingredient by opening your mouth at any time during the flight. </font><font style="vertical-align: inherit;">The main thing is the combination of x and y.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/nw/v9/dw/nwv9dwt-p5wip4yhnnhtirudgoe.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finally, the last problem I encountered while writing this game was to limit the size of the final build to 4 MB. Moreover, according to the recommendation of Facebook, in order for the game to be displayed on as many mobile devices as possible, it is desirable to fit even 2 MB. And 3D-modelers are creative people and want to make heavy models with a dense grid and huge textures, completely not caring about us, programmers, or rather, about the final performance in games. I also somehow reduced the textures in size and compressed in jpg (instead of png), but the pizza model itself had to be sent for revision (retopology). As a result, nevertheless, it was possible to fit into the 2MB volume with all models, textures and a script. And the game went on moderation.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And after some time she returned with the wording that "the effect contains too much static text." </font><font style="vertical-align: inherit;">I had to remove the countdown numbers and instead of them set the animation to the arrow on the stopwatch, which now began to count the time instead of them. </font><font style="vertical-align: inherit;">After that, the game was approved.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Game 2. About the butterfly (ButterFlap)</font></font></h3><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/wd/dt/63/wddt63fejsxelpizwyffhzw5zig.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now I‚Äôll talk about creating a second game. I can not help making games, this is my hobby. A few days before March 8, I decided to create an Instagram game for this holiday. Something about flowers, butterflies and sweets. But I couldn‚Äôt think of what the essence of the game could be. The thought revolved in my head. Maybe the butterfly will collect candies and put them in a basket? Or maybe butterflies will pick up sweets in the air and throw them, and the player will need to catch them with his mouth? In general, I scammed for a couple of days and, having not found a solution, I realized that by March 8, my game would still not have time to go through moderation, since the latter takes 3-4 days. I already wanted to leave this venture, when suddenly the idea came by itself, all of a sudden. I no longer tied the game to Women's Day, now it was just a game.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Scroller. </font><font style="vertical-align: inherit;">From left to right, landscape and various obstacles move. </font><font style="vertical-align: inherit;">The player must control a butterfly that can move freely within the screen and collect diamonds hanging in the air. </font><font style="vertical-align: inherit;">Also, from right to left a little faster than the rest of the picture, clouds are moving, from which rain is pouring. </font><font style="vertical-align: inherit;">You need to hide from the rain under the flowers. </font><font style="vertical-align: inherit;">If a butterfly falls under water, then its wings get wet and it falls, this is the end of the game. </font><font style="vertical-align: inherit;">I called the game simply: ButterFlap. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yes, all this sounds good. </font><font style="vertical-align: inherit;">I, directly, wanted to play myself. </font><font style="vertical-align: inherit;">But I remembered that I was not an artist at all. </font><font style="vertical-align: inherit;">However, I am able to make 3D models, and this is easier than drawing. </font><font style="vertical-align: inherit;">So, it was decided, let there be a 3D scroller.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Graphic arts</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I found online royalty-free models that I had to refine. He pulled textures onto those that were without textures, having previously placed the latter in a texture atlas: artifacts in the form of ‚Äúladders‚Äù are visible on non-textured models, and smoothing can be set for textures in the game, which makes the appearance of objects more presentable and not so flat. Those models that contained textures also had their flaws that had to be fixed. Firstly, the size of the textures was not a multiple of two in power. That is, for example, it could be equal to 1200x1200. I had to compress to 1024x1024. Video processors can either scale or fill in inappropriate textures with empty space, that is, those that are not 1024x1024, 512x512, 256x256, etc. In any case, such actions are an extra load during the game‚Äôs work and meaningless memory consumption,therefore, it is better to prepare the correct images first manually. The situation was also saved by the fact that I distributed all the textures by texture atlases, so if, for example, the original texture was 400x200 pixels in size, then I could just put it in the atlas 1024x1024, as it is, next to other similar ones. After this, it is naturally necessary to scale the UV scan as well, but this is done in a couple of seconds. Still came across variants of models where for some reason the textures were tied along an absolute path such as ‚ÄúC: \ Work \ Vasya \ Map.jpg‚Äù. Well, there is no such folder on my computer! I had to specify the paths to the textures manually ... But why did you get the idea that I should keep all my projects on the ‚ÄúC:‚Äù drive !? Oh, these modelers, free artists ... By the way, this way, by the names of folders in randomly left paths, you can inadvertently learn more about the identity of the modeler,for example, his name. Nice to meet you!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The most difficult thing was to find a suitable butterfly model with animation. Spark AR uses animation that can be exported from any 3D editor to the FBX format. The wings of a pair of butterfly models I downloaded were somehow strangely mirrored - one wing was modeled, and the second was reflected in some way I did not understand, and, thus, two of them turned out. With this approach to modeling, in the end, in the game, one of the wings (copied) did not want to receive light from the source and always remained dim. I did not risk drastically changing the model, because then the animation would have flown. And in animation I‚Äôm an even bigger noob than in 3D modeling. Perhaps the problem was something else: I tried, for example, to expand the normals, but that did not help. In short, free 3D models are a pain. As a result, having washed all evening,by trial and error, I found a suitable model, which after some fine-tuning with a file began to look satisfactory. Something I didn‚Äôt like about it, but it was little things: I redid the texture, changed the geometry in some places, and adjusted the material parameters. Finally, the butterfly took off. Hooray. But now I am exhausted. So I decided to go to bed and continue the next day. Yes, I spent 7-8 days on creating the game. But it was such a rather leisurely work in the evenings, reading documentation, articles and finding answers to questions.So I decided to go to bed and continue the next day. Yes, I spent 7-8 days on creating the game. But it was such a rather leisurely work in the evenings, reading documentation, articles and finding answers to questions.So I decided to go to bed and continue the next day. Yes, I spent 7-8 days on creating the game. But it was such a rather leisurely work in the evenings, reading documentation, articles and finding answers to questions.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/rr/zb/iy/rrzbiyezloccrjo_egas613ltry.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All evening the next day I worked on graphics. The specificity of game masks for Instagram, as I have already mentioned, is that it is advisable not to go beyond the 2MB volume for the entire game (maximum 4 MB). I was not worried about the script: its size is unlikely to exceed 50 Kb. But over 3D models of plants had to be pretty conjured. For example, that part of the sunflower where the seeds are located was made by geometry. Hundreds of polygons ... Replace it with a fragment of a sphere of a couple of dozen triangles and stretch the downloaded texture, in fact, of this part. The number of leaves can also be reduced. We make grass at the bottom of the scene with a plane of two triangles with an overlaid texture with an alpha channel. We reach the volume with shadows and copying fragments of the picture inside the texture itself.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In general, it is desirable to minimize the number of textures, as well as their size in bytes. </font><font style="vertical-align: inherit;">It is the textures that create the bulk of the game. </font><font style="vertical-align: inherit;">I'm used to textures where transparency is needed, placed in one texture atlas - in png 32 bit, and textures that do not use the alpha channel, pack in another atlas, saving it in jpg. </font><font style="vertical-align: inherit;">Jpg can be shrunk stronger than png. </font><font style="vertical-align: inherit;">Grass and UI elements that need transparency have gone to the png atlas, and everything else to jpg.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The total volume. </font><font style="vertical-align: inherit;">In total, I got 4 types of plants, a rock, a butterfly, which the player will control, and a cloud. </font><font style="vertical-align: inherit;">The textures of all these models in compressed form took 2 atlases 1024x1024 jpg and png with a total volume of 500 Kb. </font><font style="vertical-align: inherit;">The models themselves took about 200 Kb. </font><font style="vertical-align: inherit;">Plus a script. </font><font style="vertical-align: inherit;">Sounds - 31 Kb. </font><font style="vertical-align: inherit;">Total: about 1 Mb. </font><font style="vertical-align: inherit;">In green, the size of the build is just displayed (this is what should fit in 2 MB).</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ak/7r/c1/ak7rc1e09ycyaee13ypwnokgeqm.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suddenly I ran into a completely unexpected problem. </font><font style="vertical-align: inherit;">I deleted several unused models, but not through Spark AR Studio, but from the file system. </font><font style="vertical-align: inherit;">Subsequently, when assembling the build, I found that they disappeared from the Spark AR Studio scene, but still got into the assembly. </font><font style="vertical-align: inherit;">And to clear the project from unused resources is impossible. </font><font style="vertical-align: inherit;">Links to them from the ‚ÄúAsset Summary‚Äù do not lead anywhere. </font><font style="vertical-align: inherit;">Apparently, this is a defect in Spark AR Studio. </font><font style="vertical-align: inherit;">I had to recreate the project again, adding all the necessary resources there from the very beginning.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scene</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I have been thinking for a long time about how to implement scrolling of all objects on the screen. </font><font style="vertical-align: inherit;">Of the tools for this, there is only javascript and the simplest built-in animation engine in Spark AR Studio, which can simply change the coordinates of the object from the initial value to the final in a given time.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yes, the dilemma still arose before this: whether to create the entire level of the game, a scene in a 3D editor, by duplicating the repeating plants the required number of times and placing them in the right positions, in order to scroll the entire scene in the game, or load only one copy of each 3D object and substitute them in the direction of the player just outside the screen. The answer was obvious. Our choice is the second option. Otherwise, it‚Äôs definitely not possible to fit into 2 MB: most likely, the scene according to the first option will be heavy. But then you need a layout of objects. And I, without hesitation, decided to use the 3D editor as a level editor. Yeah, it turns out that I did both. Plants for the game, I saved each in one copy. And from the editor I needed only the coordinates. After completing the work,I wrote out the coordinates of all the objects and made an array with the data for the game.</font></font><br>
<br>
<pre><code class="javascript hljs">lv:[<font></font>
    {<span class="hljs-attr">n</span>:<span class="hljs-string">'flower1'</span>, <span class="hljs-attr">x</span>:<span class="hljs-number">8.0</span>, <span class="hljs-attr">y</span>:<span class="hljs-number">-6.5</span>},<font></font>
    {<span class="hljs-attr">n</span>:<span class="hljs-string">'cloud'</span>, <span class="hljs-attr">x</span>:<span class="hljs-number">10.0</span>, <span class="hljs-attr">y</span>:<span class="hljs-number">0.1</span>},<font></font>
    {<span class="hljs-attr">n</span>:<span class="hljs-string">'rain'</span>, <span class="hljs-attr">x</span>:<span class="hljs-number">10.0</span>, <span class="hljs-attr">y</span>:<span class="hljs-number">6.6</span>},<font></font>
    {<span class="hljs-attr">n</span>:<span class="hljs-string">'flower1'</span>, <span class="hljs-attr">x</span>:<span class="hljs-number">14</span>, <span class="hljs-attr">y</span>:<span class="hljs-number">-2.5</span>},<font></font>
    {<span class="hljs-attr">n</span>:<span class="hljs-string">'diamond_red'</span>, <span class="hljs-attr">x</span>:<span class="hljs-number">20</span>, <span class="hljs-attr">y</span>:<span class="hljs-number">2.0</span>},<font></font>
	...<font></font>
],</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And yet - a separate associative array, according to the types of objects where the sizes of colliders and their displacements relative to the centers of 3D objects are stored, as well as a flag (col) that determines whether the object is an obstacle (otherwise the player passes through it). </font><font style="vertical-align: inherit;">For some types of objects, the (destroy) flag is set, which determines whether the object should be hidden after interaction, as well as the (v) parameter, which determines some degree of interaction, for example, the number of points a player gains or loses.</font></font><br>
<br>
<pre><code class="javascript hljs">colld:{
    <span class="hljs-string">'flower1'</span>: {<span class="hljs-attr">dx</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">dy</span>:<span class="hljs-number">5</span>, <span class="hljs-attr">w</span>:<span class="hljs-number">2.3</span>, <span class="hljs-attr">h</span>:<span class="hljs-number">1.4</span>, <span class="hljs-attr">col</span>:<span class="hljs-literal">true</span>},
    <span class="hljs-string">'diamond_green'</span>: {<span class="hljs-attr">dx</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">dy</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">w</span>:<span class="hljs-number">1</span>, <span class="hljs-attr">h</span>:<span class="hljs-number">1</span>, <span class="hljs-attr">col</span>:<span class="hljs-literal">false</span>, <span class="hljs-attr">v</span>:<span class="hljs-number">1</span>, <span class="hljs-attr">destroy</span>:<span class="hljs-literal">true</span>},
    <span class="hljs-string">'diamond_red'</span>:{<span class="hljs-attr">dx</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">dy</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">w</span>:<span class="hljs-number">1</span>, <span class="hljs-attr">h</span>:<span class="hljs-number">1</span>, <span class="hljs-attr">col</span>:<span class="hljs-literal">false</span>, <span class="hljs-attr">v</span>:<span class="hljs-number">-2</span>},<font></font>
<font></font>
    ...<font></font>
},</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A little nuance. </font><font style="vertical-align: inherit;">The grass at the bottom of the scene should scroll continuously. </font><font style="vertical-align: inherit;">So, you have to use two copies of this object and substitute them one after another as you move. </font><font style="vertical-align: inherit;">Flowers will appear on one screen no more than in one copy each.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bearing in mind the scale problem that I encountered when developing the first game, I reset the scale of all models in the 3D editor. Thus, in Saprk AR models immediately loaded in normal sizes. True, in the script anyway, it could not do without the "magic number", the global coefficient, the universal code, which contains the essence of the universe. A virtual universe, of course. And I am ready to reveal this number to you. Use it, people! I do not mind! This number is 0.023423. In short, despite the reset of all scales, one meter in the 3D editor turned out to be equal to this very number in Spark AR Studio. Most likely, I, nevertheless, do not fully understand all the intricacies of working with 3D graphics, hence the coefficient. The coordinates (but not the size) of all objects that were exported from the editor are multiplied by it, you guessed it.Where to adjust the scale of the scene in Spark AR, I did not find.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The next problem I encountered was the loss of the sort order of objects when exporting from a 3D editor. </font><font style="vertical-align: inherit;">Complex objects consisting of several meshes could unpredictably appear on the scene in the game in such a way that, for example, a mesh that was behind another suddenly jumped forward. </font><font style="vertical-align: inherit;">And, if you look at the order of objects after exporting to Spark AR Studio, then it really shows that this mesh is for some reason higher in the list, although it was lower in the editor. </font><font style="vertical-align: inherit;">I solved this problem by dividing the scene into layers and saving them to different files.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Complex animation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For another three evenings, I fiddled with programming. If I used the standard Spark AR Studio engine to animate the wings of a butterfly, the task of moving the background was not so simple. I still did not understand how to attach not just one variable parameter to iterations of the motion cycle, but a full-fledged callback function. In any case, I could not do it, the current animation parameters did not want to be transferred there. And such a function is simply necessary, because if in the first game (with pizza) I checked the collision by the event of opening the mouth by subscribing to it, then there was no such event here. And it was just necessary to check collisions with environmental objects as the character moves, according to its current coordinates. And for this, the coordinates must be compared at each iteration. And then I thought. After all, I already wrote games in javascript.And why not use your animation engine that I wrote earlier for those games? Its principle of operation is approximately the same: in a given time, the parameter (or parameters) changes between the given initial and final values. And the current value is passed as a parameter - you won‚Äôt believe it - in the given callback function, in which, for example, you can set a 3D object on the scene at coordinates equal to these current values, or check for collisions on them. Thanks, Cap. I had to slightly adapt my engine to the local ‚Äúecosystem‚Äù: remove references to the window object from there, since it is not here, and other little things.And the current value is passed as a parameter - you won‚Äôt believe it - in the given callback function, in which, for example, you can set a 3D object on the scene at coordinates equal to these current values, or check for collisions on them. Thanks, Cap. I had to slightly adapt my engine to the local ‚Äúecosystem‚Äù: remove references to the window object from there, since it is not here, and other little things.And the current value is passed as a parameter - you won‚Äôt believe it - in the given callback function, in which, for example, you can set a 3D object on the scene at coordinates equal to these current values, or check for collisions on them. Thanks, Cap. I had to slightly adapt my engine to the local ‚Äúecosystem‚Äù: remove references to the window object from there, since it is not here, and other little things.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yes, yet - about scrolling the landscape and objects of the environment. I decided to put the whole world in one NullObject, that is, in an empty 3D object, a container, and move it using only one parameter for animation - its x coordinate. Inside the container, all models have the same coordinates as if they were outside, only now for them the reference system is tied to this empty object. Rocks and flowers will be repeated (moreover, at different heights from the ground, in accordance with the level diagram), so you can reuse these objects as you move, setting them the desired horizontal and vertical position inside the ‚Äúcontainer‚Äù. I wrote a search system for objects falling into the frame (at the current container offset), which sets the object that leaves the frame to a new position further if it should appear there. You can see,how it works on the example of three objects. (There will be more of them in the game, so there you will no longer see such an effect of "rearrangement" of environment objects.)</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/f3i72svxLHM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The function for updating the coordinates of objects looks like this:</font></font><br>
<br>
<pre><code class="javascript hljs">oCoordSet: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">v</span>) </span>{
    <span class="hljs-comment">//  :    </span>
    <span class="hljs-comment">//   </span>
    <span class="hljs-keyword">var</span> camx = -ap.oWorld.transform.x.pinLastValue();
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">var</span> x1 = camx - ap.game.scro.w2;
    <span class="hljs-keyword">var</span> x2 = camx + ap.game.scro.w2;
    <span class="hljs-comment">//   </span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; ap.d.lv.length; i++) {
        <span class="hljs-comment">//    </span>
        <span class="hljs-keyword">if</span> ((ap.d.lv[i].x &gt;= x1) &amp; (ap.d.lv[i].x &lt;= x2)) {
            <span class="hljs-comment">//   </span><font></font>
            ap.d.lv[i].o = Scene.root.find(ap.d.lv[i].n);<font></font>
            <span class="hljs-comment">//  -  </span><font></font>
            ap.d.lv[i].o.transform.y = ap.d.lv[i].y;<font></font>
            <span class="hljs-keyword">if</span> ((ap.d.lv[i].n == <span class="hljs-string">'cloud'</span>) || (ap.d.lv[i].n == <span class="hljs-string">'rain'</span>)) {
                <span class="hljs-comment">//    ,</span>
                <span class="hljs-comment">//  </span>
                <span class="hljs-comment">//   2.3,</span>
                <span class="hljs-comment">//     </span>
                ap.d.lv[i].o.transform.x = ap.d.lv[i].x - (x2 - ap.d.lv[i].x) * <span class="hljs-number">2.3</span> + <span class="hljs-number">0.2</span>;<font></font>
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">//    ,</span>
                <span class="hljs-comment">//      </span><font></font>
                ap.d.lv[i].o.transform.x = ap.d.lv[i].x;<font></font>
            };<font></font>
        };<font></font>
    };<font></font>
    <span class="hljs-comment">//        </span>
    <span class="hljs-comment">//     </span>
    <span class="hljs-keyword">if</span> (camx &gt; ap.game.grassPosLast) {<font></font>
        ap.game.grassPosLast += ap.game.grassd;<font></font>
        ap.game.grassi = <span class="hljs-number">1</span> - ap.game.grassi;<font></font>
        ap[ap.game.grassNm[ap.game.grassi]].transform.x = ap.game.grassPosLast;<font></font>
    };<font></font>
},</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The main character</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The main character in the game is an unsinkable butterfly, which boldly flies forward, overcoming obstacles. </font><font style="vertical-align: inherit;">I decided to do the management by setting a marker, or cursor (light point), by turning and tilting my head. </font><font style="vertical-align: inherit;">And in the direction of this point a butterfly will fly slowly (in fact, it is not a fighter, nor can it teleport). </font><font style="vertical-align: inherit;">For example, if you subscribe to the head tilt event, then you can implement vertical control like this:</font></font><br>
<br>
<pre><code class="javascript hljs">FaceTracking.face(<span class="hljs-number">0</span>).cameraTransform.rotationX.monitor().subscribe(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
    <span class="hljs-keyword">var</span> v = event.newValue;
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">var</span> scrH2 = ap.game.scr.h2;
    <span class="hljs-comment">//</span>
    <span class="hljs-keyword">var</span> p = -v * <span class="hljs-number">0.5</span>;
    <span class="hljs-keyword">if</span> (p &lt; -scrH2) {<font></font>
        p = -scrH2;<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (p &gt; scrH2) {<font></font>
        p = scrH2;<font></font>
    };<font></font>
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">var</span> d = <span class="hljs-number">0.006</span>;
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">var</span> cur = ap.oPers.transform.y.pinLastValue();
    <span class="hljs-keyword">if</span> (p &lt; cur) {<font></font>
        cur -= d;<font></font>
        <span class="hljs-keyword">if</span> (cur &lt; p) {cur = p;};<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
        cur += d;<font></font>
        <span class="hljs-keyword">if</span> (cur &gt; p) {cur = p;};<font></font>
    };<font></font>
    <span class="hljs-comment">//    ()</span><font></font>
    ap.oPointer1.transform.y = p;<font></font>
    <span class="hljs-comment">//   ,</span>
    <span class="hljs-comment">// ,    </span><font></font>
    ap.game.pers.dy + = cur - ap.game.pers.y;<font></font>
});</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Similarly for the horizontal. </font><font style="vertical-align: inherit;">Only there it is necessary to subscribe to the event not of a tilt, but of a head rotation (rotationY), and instead of the height of the screen, consider its width.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Colliders</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All this is wonderful, the world is moving, and the game character can freely move around the screen. But now you need a collision handler, otherwise no game will work. There are three events in the game, according to which the character's position can change. This is the rotation and tilt of the head, as well as the movement of the world, in which the horizontal coordinate of the player (x) automatically increases. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since I don‚Äôt know how iterations of the face handler work in Spark AR - whether they are called with a certain frequency or are set to the maximum possible clock frequency, and in my animation engine I can control this parameter, I decided that I would define collisions in my function the movement of the world, which is called at a frequency set by me (60 frames per second). In face processing events, we will only ‚Äúaccumulate‚Äù movement.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The principle will be like that. In head tilt and head turning events, an offset along the x and y axes is accumulated. Further, in the function of scrolling the world, a horizontal displacement is also added to the ‚Äúpiggy bank‚Äù. And then it is checked, if the accumulated displacement is added to the original coordinates, then there will be a collision with any of the objects in the world. If not, then the player‚Äôs original coordinates plus the offset are made by the current coordinates. And then we update the source ones to the current ones (reset) and reset the offsets. If so, then roll back the coordinates to the original. Moreover, we need to determine which axis the collision would be, since both coordinates cannot be rolled back. Otherwise, the player simply ‚Äústicks‚Äù to one point in space and can no longer move anywhere. It is necessary to give him freedom of movement along the axis along which the collision does not occur.So you can give him a chance to fly around an obstacle.</font></font><br>
<br>
<pre><code class="javascript hljs">setPersPos: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">camx, camdx</span>) </span>{
    <span class="hljs-comment">//   </span>
    <span class="hljs-comment">//       (camx,camdx)</span><font></font>
<font></font>
    <span class="hljs-comment">//     </span>
    <span class="hljs-keyword">var</span> persx = ap.game.pers.x;
    <span class="hljs-keyword">var</span> persy = ap.game.pers.y;
    <span class="hljs-keyword">var</span> dx = ap.game.pers.dx;
    <span class="hljs-keyword">var</span> dy = ap.game.pers.dy;<font></font>
<font></font>
    <span class="hljs-comment">// ,     </span>
    <span class="hljs-keyword">var</span> col = ap.collisionDetect(<font></font>
        {<span class="hljs-attr">x</span>: persx, <span class="hljs-attr">y</span>: persy, <span class="hljs-attr">dx</span>: dx, <span class="hljs-attr">dy</span>: dy},<font></font>
        {<span class="hljs-attr">x</span>: camx, <span class="hljs-attr">dx</span>: camdx, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>}<font></font>
    );<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (col.f == <span class="hljs-literal">true</span>) {
        <span class="hljs-comment">// </span><font></font>
<font></font>
        <span class="hljs-keyword">if</span> (col.colx == <span class="hljs-literal">true</span>) {
            <span class="hljs-comment">//   </span>
            <span class="hljs-comment">//    ,</span>
            <span class="hljs-comment">//   </span>
            <span class="hljs-comment">//(    ,    )</span><font></font>
            ap.game.pers.x = col.x;<font></font>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">//    ,</span>
            <span class="hljs-comment">//   </span><font></font>
            ap.game.pers.x = persx + dx;<font></font>
        };<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (col.coly == <span class="hljs-literal">true</span>) {
            <span class="hljs-comment">// -  </span><font></font>
            ap.game.pers.y = col.y;<font></font>
        } <span class="hljs-keyword">else</span> {<font></font>
            ap.game.pers.y = persy + dy;<font></font>
        };<font></font>
<font></font>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">//  ,   </span><font></font>
        ap.game.pers.x = persx + dx;<font></font>
        ap.game.pers.y = persy + dy;<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">// </span>
    ap.game.pers.dx = <span class="hljs-number">0</span>;<font></font>
    ap.game.pers.dy = <span class="hljs-number">0</span>;<font></font>
<font></font>
    <span class="hljs-comment">//     </span><font></font>
    ap.oPers.transform.x = ap.game.pers.x;<font></font>
    ap.oPers.transform.y = ap.game.pers.y;<font></font>
},</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The collision detection function itself:</font></font><br>
<br>
<pre><code class="javascript hljs">collisionDetect: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">opers, ow</span>) </span>{
    <span class="hljs-comment">// , opers -   , ow -  </span><font></font>
<font></font>
    <span class="hljs-keyword">var</span> res = {<span class="hljs-attr">f</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">colx</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">coly</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>};<font></font>
<font></font>
    <span class="hljs-keyword">var</span> ocoll, x, y, w, h, persx, persy, persx0, persy0, od, colx1, coly1, colx2, coly2;
    <span class="hljs-keyword">var</span> collw = <span class="hljs-literal">false</span>, collh = <span class="hljs-literal">false</span>;<font></font>
<font></font>
    <span class="hljs-comment">//  </span>
    <span class="hljs-comment">//(  ,  "" )</span><font></font>
    persx0 = opers.x + ow.x - ow.dx;<font></font>
    persy0 = opers.y + ow.y;<font></font>
<font></font>
    <span class="hljs-comment">//       </span><font></font>
    persx = persx0 + opers.dx;<font></font>
    persy = persy0 + opers.dy;<font></font>
<font></font>
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; ap.d.lv.length; i++) {<font></font>
        od = ap.d.lv[i]; <span class="hljs-comment">//obj data</span><font></font>
<font></font>
        <span class="hljs-comment">//    (   ),</span>
        <span class="hljs-comment">//     </span>
        <span class="hljs-comment">//        </span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> ap.d.colld[od.n] !== <span class="hljs-string">"undefined"</span>) {<font></font>
<font></font>
            <span class="hljs-comment">//       </span><font></font>
            ocoll = ap.d.colld[od.n];<font></font>
            colx1 = od.x + ocoll.x1;<font></font>
            colx2 = od.x + ocoll.x2;<font></font>
            coly1 = od.y + ocoll.y1;<font></font>
            coly2 = od.y + ocoll.y2;<font></font>
<font></font>
            <span class="hljs-keyword">if</span> ((persx &lt; colx1) || (persx &gt; colx2) || (persy &lt; coly1) || (persy &gt; coly2)) {} <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">//   </span>
                res.f = <span class="hljs-literal">true</span>;<font></font>
<font></font>
                <span class="hljs-comment">//        ,</span>
                <span class="hljs-comment">//,    </span>
                <span class="hljs-keyword">if</span> ((persx0 &lt; colx1) || (persx0 &gt; colx2)) {<font></font>
                    collw = <span class="hljs-literal">true</span>;<font></font>
                };<font></font>
                <span class="hljs-comment">//        ,</span>
                <span class="hljs-comment">//,    </span>
                <span class="hljs-keyword">if</span> ((persy0 &lt; coly1) || (persy0 &gt; coly2)) {<font></font>
                    collh = <span class="hljs-literal">true</span>;<font></font>
                };<font></font>
<font></font>
            };<font></font>
        };<font></font>
<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">//   </span><font></font>
<font></font>
    <span class="hljs-comment">//  ,     ,</span>
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">if</span> (collw == <span class="hljs-literal">true</span>) {<font></font>
        res.colx = <span class="hljs-literal">true</span>;<font></font>
        res.x = persx0 - ow.x;<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
        res.x = opers.x;<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">// -  </span>
    <span class="hljs-keyword">if</span> (collh == <span class="hljs-literal">true</span>) {<font></font>
        res.coly = <span class="hljs-literal">true</span>;<font></font>
        res.y = persy0 + ow.y;<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
        res.y = opers.y;<font></font>
    };<font></font>
<font></font>
    <span class="hljs-keyword">return</span> res;<font></font>
},</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rain</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I used the standard particle engine Spark AR Studio to animate rain. </font><font style="vertical-align: inherit;">There is nothing special here. </font><font style="vertical-align: inherit;">We add an Emtter object to the scene, not forgetting to ask it Emitter -&gt; Space -&gt; Local (instead of World). </font><font style="vertical-align: inherit;">This is to ensure that the drops do not dynamically lag behind the clouds during movement, but always fall directly. </font><font style="vertical-align: inherit;">This method is more convenient for easier determination of the moment the butterfly falls in the rain - no need to make a correction for height. </font><font style="vertical-align: inherit;">For the drops themselves, I prepared the appropriate texture. </font><font style="vertical-align: inherit;">Well and, of course, the rain object will move together with the cloud object. </font><font style="vertical-align: inherit;">Then I added a cloud hit condition to the collision handling code. </font><font style="vertical-align: inherit;">And, if there is no obstacle above the player at this moment, then the butterfly falls and the game ends.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Moderation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For successful moderation, the mandatory video from the game should not contain static text that is not tied to objects. </font><font style="vertical-align: inherit;">Otherwise, the robot instantly stops moderation. </font><font style="vertical-align: inherit;">However, after that, a person checks the game for several days. </font><font style="vertical-align: inherit;">And he did not like the abundance of text before the game, as well as at the end. </font><font style="vertical-align: inherit;">I had to reduce the amount of text. </font><font style="vertical-align: inherit;">After that, the game was approved.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Summary</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Not that my game was particularly exciting. </font><font style="vertical-align: inherit;">She probably lacks dynamics and additional mechanics. </font><font style="vertical-align: inherit;">I will release an update. </font><font style="vertical-align: inherit;">But I realized that making games on Instagram is interesting. </font><font style="vertical-align: inherit;">This is a kind of challenge. </font><font style="vertical-align: inherit;">I really enjoyed the process of programming and solving all kinds of tasks under minimalism in terms of tools and the amount of allocated memory. </font><font style="vertical-align: inherit;">I remember someone said that 640 Kb is enough for everyone. </font><font style="vertical-align: inherit;">Now try to fit a 3D game of 2 MB. </font><font style="vertical-align: inherit;">I, perhaps, will not argue that they are enough for everyone ... But try it!</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/7f/g7/kr/7fg7kra8uhidburs19pognju5vc.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In conclusion, I would like to put together in one list all the unobvious moments that I encountered. </font><font style="vertical-align: inherit;">Maybe this is useful to someone as a cheat sheet when creating games for Instagram.</font></font><br>
<br>
<i><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scale. </font><font style="vertical-align: inherit;">Adjust the scale of all 3D models in the 3D editor so that he is immediately 1: 1 on the stage in the game.</font></font></li>
<li>       .              .   ,            .</li>
<li>.          FBX,     .        -.           ,    .</li>
<li>  .  JPG   ,     ,   ,       -,    JPG,    PNG.</li>
<li>   . , ,        .   Spark AR  ,         . , , ,   3D-.</li>
<li>   3D ,    :     ,    .       .             .</li>
<li>,    ,      .   javascript   .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the context of Spark AR, there is no window object and all kinds of browser-specific objects like webkitRequestAnimationFrame, mozRequestAnimationFrame, and so on. </font><font style="vertical-align: inherit;">This is a fate when programming in javascript animation.</font></font></li>
</ul></i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en499964/index.html">NASA has selected three firms that will participate in the program to create a ship for landing on the moon</a></li>
<li><a href="../en499966/index.html">Measuring the UVA UVB</a></li>
<li><a href="../en499968/index.html">List of the most persistent online mitaps that take place even in May</a></li>
<li><a href="../en499970/index.html">We study the Mediastreamer2 VoIP engine. Part 12</a></li>
<li><a href="../en499972/index.html">May online events digest</a></li>
<li><a href="../en499978/index.html">Translation of Andrew Un's book, Passion for Machine Learning, Chapters 36 and 37</a></li>
<li><a href="../en499982/index.html">Beginner Tester Plan: From ‚ÄúEnter IT‚Äù to ‚ÄúI Am an Engineer!‚Äù</a></li>
<li><a href="../en499986/index.html">And again about embedded: looking for bugs in the Embox project</a></li>
<li><a href="../en499988/index.html">Sugar and COVID-19</a></li>
<li><a href="../en499990/index.html">Geocoding How to bind 250 thousand addresses to coordinates in 10 minutes?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>