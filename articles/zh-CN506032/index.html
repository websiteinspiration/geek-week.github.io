<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤟 💴 🛠️ 生成对抗网络（GAN）增强功能 😉 📟 🍂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="对于应用程序，很少需要人工数据生成的情况。但是，竞争生成模型（GAN）算法令人惊讶，并且可以创建绘图服务，甚至可以创建不存在的人的照片。
 从理论角度来看，在Habré上有几篇关于算法的分析文章。在这里，我想集中讨论代码，即专注于改进和技巧，这些技巧和技巧将使学习过程更快，更可控，并提高所生成示例的...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>生成对抗网络（GAN）增强功能</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/506032/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于应用程序，很少需要人工数据生成的情况。但是，竞争生成模型（GAN）算法令人惊讶，并且可以创建</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绘图服务</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，甚至</font><font style="vertical-align: inherit;">可以创建</font><font style="vertical-align: inherit;">不存在的人</font><font style="vertical-align: inherit;">的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">照片</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从理论角度来看，在Habré上有几篇关于算法的分析文章。在这里，我想集中讨论代码，即专注于改进和技巧，这些技巧和技巧将使学习过程更快，更可控，并提高所生成示例的质量。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该示例取自</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tensorflow文档</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">keras代码</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。它们都很好用，但是正如您在下面看到的那样，它们并不完美。改进思路主要取材于本文。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GAN技巧</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GAN改进研究</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">训练</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要工作，您只需要2个库：numpy和tensorflow，以及几个用于直接在jupyter Notebook中渲染GIF图像的库。</font></font><br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">依存关系</font></font></h4><br>
<pre><code class="python hljs"><span class="hljs-comment">#python 3.6</span>
!pip install tensorflow==<span class="hljs-number">2.0</span><span class="hljs-number">.0</span>
!pip install numpy==<span class="hljs-number">1.18</span><span class="hljs-number">.1</span>
!pip install imageio==<span class="hljs-number">2.6</span><span class="hljs-number">.1</span>
!pip install matplotlib==<span class="hljs-number">3.1</span><span class="hljs-number">.2</span>
!pip install tqdm==<span class="hljs-number">4.41</span><span class="hljs-number">.1</span></code></pre><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进口货</font></font></h4><br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">from</span> tensorflow.keras.layers <span class="hljs-keyword">import</span> Input, BatchNormalization, LeakyReLU, Reshape
<span class="hljs-keyword">from</span> tensorflow.keras.layers <span class="hljs-keyword">import</span> Conv2D, Conv2DTranspose, Activation, Concatenate
<span class="hljs-keyword">from</span> tensorflow.keras.layers <span class="hljs-keyword">import</span> Dense, Flatten, Dropout
<span class="hljs-keyword">from</span> tensorflow.keras.models <span class="hljs-keyword">import</span> Model
<span class="hljs-keyword">from</span> tensorflow.keras.utils <span class="hljs-keyword">import</span> to_categorical
<span class="hljs-keyword">from</span> tqdm.notebook <span class="hljs-keyword">import</span> tqdm
<span class="hljs-comment">#    GIF</span>
<span class="hljs-keyword">import</span> imageio
<span class="hljs-keyword">from</span> IPython.display <span class="hljs-keyword">import</span> Image
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">import</span> os
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">资料载入</font></font></h4><br>
<pre><code class="python hljs">DEPTH = <span class="hljs-number">10</span><font></font>
(train_images, train_labels), (_, _) = tf.keras.datasets.mnist.load_data()<font></font>
train_images = train_images.reshape(train_images.shape[<span class="hljs-number">0</span>], <span class="hljs-number">28</span>, <span class="hljs-number">28</span>, <span class="hljs-number">1</span>).astype(<span class="hljs-string">'float32'</span>)<font></font>
train_images = train_images / <span class="hljs-number">255</span> <span class="hljs-comment">#   [0, 1]</span><font></font>
train_labels = np.array(to_categorical(train_labels, DEPTH))<font></font>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通用数据生成器</font></font></h4><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">改进之处：</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">消息人士说，最好从球体表面生成随机向量（即对其进行归一化），但是经验表明这会增加学习时间;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像快捷方式也将是必需的。</font><font style="vertical-align: inherit;">这是有用的信息，切勿丢弃。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使时代的批次大小可调；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用tqdm添加可视化的时代进度；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自阵列的图像将被随机拍摄；</font></font></li>
</ul><br>
<pre><code class="python hljs">RANDOM_DIM = <span class="hljs-number">100</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DataGenerator</span>():</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, train_images, train_labels, batches_per_epoch, batch_size</span>):</span><font></font>
        self.train_images = train_images<font></font>
        self.train_labels = train_labels<font></font>
        self.batches_per_epoch = batches_per_epoch<font></font>
        self.batch_size = batch_size<font></font>
    <font></font>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rand_norm</span>(<span class="hljs-params">npoints=<span class="hljs-number">1</span>, ndim=RANDOM_DIM</span>):</span>
        rand_vec = np.random.normal(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, size=[npoints, ndim])
        <span class="hljs-comment">#    </span>
        <span class="hljs-comment"># rand_vec = rand_vec / np.sqrt(np.sum(np.square(rand_vec), axis=1))[:, np.newaxis]</span>
        <span class="hljs-keyword">return</span> rand_vec<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__len__</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">return</span> self.batches_per_epoch<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">batch</span>(<span class="hljs-params">self</span>):</span>
        rand_images_indexes = np.random.randint(<span class="hljs-number">0</span>, train_images.shape[<span class="hljs-number">0</span>], size=self.batch_size)<font></font>
        image_batch = train_images[rand_images_indexes]<font></font>
        labels_batch = train_labels[rand_images_indexes]<font></font>
        <span class="hljs-keyword">return</span> image_batch, labels_batch<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__iter__</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> tqdm(range(self.batches_per_epoch), leave=<span class="hljs-literal">False</span>):
            <span class="hljs-keyword">yield</span> self.batch()<font></font>
            <font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rand_batch</span>(<span class="hljs-params">self</span>):</span><font></font>
        rand_vec = self.rand_norm(self.batch_size)<font></font>
        rand_labels = np.random.randint(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>, size=[self.batch_size])<font></font>
        rand_labels = np.array(to_categorical(rand_labels, DEPTH))<font></font>
        <span class="hljs-keyword">return</span> [rand_vec, rand_labels]<font></font>
<font></font>
np.random.seed(<span class="hljs-number">42</span>)<font></font>
images_indexes = np.random.randint(<span class="hljs-number">0</span>, len(train_images), size=<span class="hljs-number">16</span>)<font></font>
PICS_FROM_DATASET = [train_images[images_indexes], train_labels[images_indexes]]<font></font>
FIXED_NOISE = [DataGenerator.rand_norm(<span class="hljs-number">16</span>), train_labels[images_indexes]]
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发电机</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">改进之处：</font></font></b><br>
<br>
<ul>
<li>  complexity    ,   ,     ;</li>
<li>         ;</li>
<li>       ;</li>
<li>     Conv2DTranspose;</li>
<li>   ,   ‘sigmoid’    ,   ‘tanh',          ;</li>
<li>   sgd;</li>
</ul><br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">make_generator</span>():</span>
    complexity = <span class="hljs-number">80</span>
    alpha = <span class="hljs-number">0.2</span><font></font>
    <font></font>
    random_vector = Input(shape=[RANDOM_DIM])<font></font>
    labels = Input(shape=[DEPTH])<font></font>
    <font></font>
    X = Concatenate()([random_vector, labels])<font></font>
    <span class="hljs-comment"># 1 </span>
    X = Dense(<span class="hljs-number">7</span> * <span class="hljs-number">7</span> * int(complexity/<span class="hljs-number">2</span>),<font></font>
                          input_dim=RANDOM_DIM,<font></font>
                          kernel_initializer=tf.keras.initializers.RandomNormal(stddev=<span class="hljs-number">0.02</span>))(X)<font></font>
    X = BatchNormalization()(X)<font></font>
    X = LeakyReLU(alpha)(X)<font></font>
    <font></font>
    X = Reshape((<span class="hljs-number">7</span>, <span class="hljs-number">7</span>, int(complexity/<span class="hljs-number">2</span>)))(X)<font></font>
    <font></font>
    <span class="hljs-comment"># 2 </span><font></font>
    X = Conv2DTranspose(int(complexity), <font></font>
                        kernel_size=(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>),<font></font>
                        strides=(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>),<font></font>
                        padding=<span class="hljs-string">'same'</span>)(X)<font></font>
    X = BatchNormalization()(X)<font></font>
    X = LeakyReLU(alpha)(X)<font></font>
<font></font>
    <span class="hljs-comment"># 3 </span><font></font>
    X = Conv2DTranspose(int(complexity),<font></font>
                        kernel_size=(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>),<font></font>
                        strides=(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>),<font></font>
                        padding=<span class="hljs-string">'same'</span>)(X)<font></font>
    X = BatchNormalization()(X)<font></font>
    X = LeakyReLU(alpha)(X)<font></font>
    <font></font>
    <span class="hljs-comment"># 4 </span><font></font>
    X = Conv2DTranspose(int(complexity),<font></font>
                        kernel_size=(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>),<font></font>
                        strides=(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>),<font></font>
                        padding=<span class="hljs-string">'same'</span>)(X)<font></font>
    X = BatchNormalization()(X)<font></font>
    X = LeakyReLU(alpha)(X)<font></font>
    <font></font>
    <span class="hljs-comment"># 5 </span><font></font>
    X = Conv2DTranspose(int(complexity),<font></font>
                        kernel_size=(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>),<font></font>
                        strides=(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>),<font></font>
                        padding=<span class="hljs-string">'same'</span>)(X)<font></font>
    X = BatchNormalization()(X)<font></font>
    X = LeakyReLU(alpha)(X)<font></font>
    <font></font>
    <span class="hljs-comment"># 6 </span>
    X = Conv2DTranspose(<span class="hljs-number">1</span>,<font></font>
                        kernel_size=(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>),<font></font>
                        strides=(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>),<font></font>
                        padding=<span class="hljs-string">'same'</span>)(X)<font></font>
    X = Activation(<span class="hljs-string">'sigmoid'</span>)(X)<font></font>
    <font></font>
    model = Model(inputs=[random_vector, labels], outputs=X, name=<span class="hljs-string">'generator'</span>)<font></font>
    model.compile(loss=<span class="hljs-string">'binary_crossentropy'</span>,<font></font>
                  metrics=[<span class="hljs-string">'acc'</span>],<font></font>
                  optimizer=<span class="hljs-string">'sgd'</span>)<font></font>
    model.summary()<font></font>
    <span class="hljs-keyword">return</span> model<font></font>
generator = make_generator()</code></pre><br>
<h3> </h3><br>
<p>        . ,         16    16    . </p><br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">mkdir_p</span>(<span class="hljs-params">path</span>):</span>
    <span class="hljs-keyword">try</span>:<font></font>
        os.makedirs(path)<font></font>
    <span class="hljs-keyword">except</span> OSError:<font></font>
        print(<span class="hljs-string">'Folder already exists'</span>)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">plot_and_save_images</span>(<span class="hljs-params">generated_images, folder_name, title, cols, rows, figsize, show=False, subtitles=False</span>):</span>
    fig, axs = plt.subplots(rows, cols, constrained_layout=<span class="hljs-literal">True</span>)<font></font>
    fig.set_figheight(figsize[<span class="hljs-number">0</span>])<font></font>
    fig.set_figwidth(figsize[<span class="hljs-number">1</span>])
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(rows):
        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(cols):<font></font>
            axs[i][j].imshow(generated_images[i][j], interpolation=<span class="hljs-string">'nearest'</span>, cmap=<span class="hljs-string">'gray_r'</span>)<font></font>
            axs[i][j].axis(<span class="hljs-string">'off'</span>)
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> subtitles <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
                <span class="hljs-keyword">if</span> i == <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> j == <span class="hljs-number">0</span>:<font></font>
                    axs[i][j].set_title(subtitles[<span class="hljs-number">0</span>], fontsize=<span class="hljs-number">10</span>)
                <span class="hljs-keyword">if</span> i == int(rows/<span class="hljs-number">2</span>) <span class="hljs-keyword">and</span> j == <span class="hljs-number">0</span>:<font></font>
                    axs[i][j].set_title(subtitles[<span class="hljs-number">1</span>], fontsize=<span class="hljs-number">10</span>)<font></font>
    <font></font>
    fig.suptitle(title, fontsize=<span class="hljs-number">12</span>)<font></font>
    plt.savefig(os.path.join(folder_name, title + <span class="hljs-string">'.png'</span>))
    <span class="hljs-keyword">if</span> show:<font></font>
        plt.show()<font></font>
    plt.close()<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">plot_generated_images</span>(<span class="hljs-params">noise, folder_name, title, cols=<span class="hljs-number">8</span>, rows=<span class="hljs-number">4</span>, figsize=(<span class="hljs-params"><span class="hljs-number">4</span>, <span class="hljs-number">8</span></span>), show=False, subtitles=(<span class="hljs-params"><span class="hljs-string">'generated'</span>, <span class="hljs-string">'dataset'</span></span>)</span>):</span><font></font>
    generated_images = generator.predict(noise)<font></font>
    images = np.concatenate([generated_images, PICS_FROM_DATASET[<span class="hljs-number">0</span>]])<font></font>
    images = images.reshape(rows, cols, <span class="hljs-number">28</span>, <span class="hljs-number">28</span>)<font></font>
    plot_and_save_images(images, folder_name, title, cols, rows, figsize, show, subtitles)<font></font>
    <font></font>
<font></font>
folder_name = <span class="hljs-string">'GAN_pics_for_gif'</span><font></font>
mkdir_p(os.path.join(folder_name))<font></font>
<font></font>
title = <span class="hljs-string">f"DCGAN training process <span class="hljs-subst">{<span class="hljs-number">0</span>}</span> epochs"</span>
plot_generated_images(FIXED_NOISE, folder_name, title, show=<span class="hljs-literal">True</span>)</code></pre><br>
<h2></h2><br>
<p>    adam      learning_rate  beta_1. </p><br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">optimizer</span>():</span>
    <span class="hljs-keyword">return</span> tf.keras.optimizers.Adam(lr=<span class="hljs-number">0.0002</span>, beta_1=<span class="hljs-number">0.5</span>)</code></pre><br>
<b>:</b><br>
<ul>
<li>  complexity     =&gt;     ;</li>
<li>       ,    ;</li>
<li>     ;</li>
<li>     LeakyReLU c alpha=0.2 (LeakyReLU     'ReLU'  'elu';</li>
</ul><br>
<p>   ( )    . </p><br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">make_discriminator</span>():</span>
    complexity = <span class="hljs-number">70</span>
    drop_rate = <span class="hljs-number">0.2</span>
    alpha = <span class="hljs-number">0.2</span><font></font>
    <font></font>
    inp = Input(shape=(<span class="hljs-number">28</span>, <span class="hljs-number">28</span>, <span class="hljs-number">1</span>))<font></font>
    X = inp<font></font>
    <span class="hljs-comment"># 1 </span>
    X = Conv2D(int(complexity/<span class="hljs-number">4</span>),<font></font>
               kernel_size=(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>),<font></font>
               strides=(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>),<font></font>
               kernel_initializer=tf.keras.initializers.RandomNormal(stddev=<span class="hljs-number">0.02</span>),<font></font>
               padding=<span class="hljs-string">'same'</span>)(X)<font></font>
    X = LeakyReLU(alpha)(X)<font></font>
    X = Dropout(drop_rate)(X)<font></font>
    <font></font>
    <span class="hljs-comment"># 2 </span>
    X = Conv2D(int(complexity/<span class="hljs-number">2</span>),<font></font>
               kernel_size=(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>),<font></font>
               strides=(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>),
               <span class="hljs-comment">#kernel_initializer=tf.keras.initializers.RandomNormal(stddev=0.02),</span>
               padding=<span class="hljs-string">'same'</span>)(X)<font></font>
    X = LeakyReLU(alpha)(X)<font></font>
    X = Dropout(drop_rate)(X)<font></font>
    <font></font>
    <span class="hljs-comment"># 3 </span><font></font>
    X = Conv2D(int(complexity),<font></font>
               kernel_size=(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>),<font></font>
               strides=(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>),
               <span class="hljs-comment">#kernel_initializer=tf.keras.initializers.RandomNormal(stddev=0.02),</span>
               padding=<span class="hljs-string">'same'</span>)(X)<font></font>
    X = LeakyReLU(alpha)(X)<font></font>
    X = Dropout(drop_rate)(X)<font></font>
    <font></font>
    <span class="hljs-comment"># 4 </span>
    X = Conv2D(int(<span class="hljs-number">2</span>*complexity),<font></font>
               kernel_size=(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>),<font></font>
               strides=(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>),
               <span class="hljs-comment">#kernel_initializer=tf.keras.initializers.RandomNormal(stddev=0.02),</span>
            padding=<span class="hljs-string">'same'</span>)(X)<font></font>
    X = LeakyReLU(alpha)(X)<font></font>
    X = Dropout(drop_rate)(X)<font></font>
    <font></font>
    <span class="hljs-comment"># 5 </span><font></font>
    X = Conv2D(int(complexity),<font></font>
               kernel_size=(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>),<font></font>
               strides=(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>),
               <span class="hljs-comment">#kernel_initializer=tf.keras.initializers.RandomNormal(stddev=0.02),</span>
               padding=<span class="hljs-string">'same'</span>)(X)<font></font>
    X = LeakyReLU(alpha)(X)<font></font>
    X = Dropout(drop_rate)(X)<font></font>
<font></font>
    <span class="hljs-comment"># 6 </span><font></font>
    X = Flatten()(X)<font></font>
    X_real_fake = Dense(<span class="hljs-number">1</span>, activation=<span class="hljs-string">'sigmoid'</span>, name=<span class="hljs-string">'real_fake'</span>)(X)
    <span class="hljs-comment"># 6 </span>
    X_labels = Dense(DEPTH, activation=<span class="hljs-string">'softmax'</span>, name=<span class="hljs-string">'labels'</span>)(X)<font></font>
    <font></font>
    model = Model(inputs=inp, outputs=[X_real_fake, X_labels], name=<span class="hljs-string">'discriminator'</span>)<font></font>
    model.compile(loss={<span class="hljs-string">'real_fake'</span>: <span class="hljs-string">'binary_crossentropy'</span>,
                        <span class="hljs-string">'labels'</span>: <span class="hljs-string">'categorical_crossentropy'</span>},<font></font>
                  loss_weights={<span class="hljs-string">'real_fake'</span>:<span class="hljs-number">1</span>,
                                <span class="hljs-string">'labels'</span>: <span class="hljs-number">1</span>},<font></font>
                  optimizer=optimizer(),<font></font>
                  metrics={<span class="hljs-string">'real_fake'</span>:<span class="hljs-string">'acc'</span>})<font></font>
    <font></font>
    model.summary()<font></font>
    <span class="hljs-keyword">return</span> model<font></font>
discriminator = make_discriminator()</code></pre><br>
<h3> </h3><br>
<pre><code class="python hljs">discriminator.predict(generator.predict(FIXED_NOISE))</code></pre><br>
<br>
<h2> GAN</h2><br>
<p> ,         GAN.</p><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">make_gan</span>(<span class="hljs-params">discriminator, generator</span>):</span>   <font></font>
    noise = generator.inputs<font></font>
    image = generator(noise)<font></font>
    real_vs_fake_and_label = discriminator(image)<font></font>
    gan = Model(inputs=noise, outputs=real_vs_fake_and_label)<font></font>
    <span class="hljs-comment">#      </span>
    <span class="hljs-comment"># ..  GAN   </span>
    discriminator.trainable = <span class="hljs-literal">False</span>  
    gan.compile(loss={<span class="hljs-string">'discriminator'</span>:<span class="hljs-string">'binary_crossentropy'</span>,
                      <span class="hljs-string">'discriminator_1'</span>:<span class="hljs-string">'categorical_crossentropy'</span>},<font></font>
                <font></font>
                optimizer=optimizer(),<font></font>
                metrics={<span class="hljs-string">'discriminator'</span>:<span class="hljs-string">'acc'</span>})<font></font>
    discriminator.trainable = <span class="hljs-literal">True</span><font></font>
    gan.summary()<font></font>
    <span class="hljs-keyword">return</span> gan<font></font>
gan = make_gan(discriminator, generator)</code></pre><br>
<br>
<h2></h2><br>
<b> :</b><br>
<br>
<ol>
<li>       </li>
<li>        </li>
<li>   </li>
<li> </li>
</ol><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发电机培训：</font></font></b><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置GAN的目标单位值</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们在生成的随机向量上训练GAN（发电机）</font></font></li>
</ol><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">改进之处：</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">平滑来自数据集的图像和生成的图像的目标值;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为 </font><font style="vertical-align: inherit;">训练数据是随机生成的，可以自由调节一个时代的批次数量；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以跟踪生成器“欺骗”鉴别器的程度。</font><font style="vertical-align: inherit;">发生器的精度最好为50％；</font></font></li>
</ul><br>
<pre><code class="python hljs">EPOCHS = <span class="hljs-number">500</span>
BATCH_SIZE = <span class="hljs-number">128</span>
data = DataGenerator(train_images, train_labels, batches_per_epoch=<span class="hljs-number">40</span>, batch_size=BATCH_SIZE)
<span class="hljs-comment">#     </span><font></font>
generator_acc_follow = []<font></font>
<span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> tqdm(range(<span class="hljs-number">1</span>, EPOCHS+<span class="hljs-number">1</span>)):
    <span class="hljs-keyword">for</span> images_batch, labels_batch <span class="hljs-keyword">in</span> data:
        <span class="hljs-comment">#  </span><font></font>
        noise = data.rand_batch()<font></font>
        generated_images = generator.predict(noise)<font></font>
        X = np.concatenate([images_batch, generated_images])<font></font>
        <span class="hljs-comment">#   </span>
        y_real = np.random.uniform(<span class="hljs-number">0.8</span>, <span class="hljs-number">1</span>, size=[BATCH_SIZE])<font></font>
        y_fake = np.random.uniform(<span class="hljs-number">0</span>, <span class="hljs-number">0.2</span>, size=[BATCH_SIZE])<font></font>
        y_real_fake = np.concatenate([y_real, y_fake])<font></font>
        <span class="hljs-comment">#   </span><font></font>
        y_labels = np.concatenate([labels_batch, np.zeros((BATCH_SIZE, DEPTH))])<font></font>
        <span class="hljs-comment">#  </span><font></font>
        discriminator.train_on_batch(X, [y_real_fake, y_labels])<font></font>
        <font></font>
        <span class="hljs-comment">#  </span><font></font>
        noise = data.rand_batch()<font></font>
        <span class="hljs-comment">#   </span><font></font>
        y_real_fake = np.ones(BATCH_SIZE)<font></font>
        y_labels = np.zeros((BATCH_SIZE, DEPTH))<font></font>
        <span class="hljs-comment">#  GAN     </span>
        generator_acc_follow.append(gan.train_on_batch(noise, [y_real_fake, noise[<span class="hljs-number">1</span>]])[<span class="hljs-number">-1</span>])<font></font>
<font></font>
    <span class="hljs-comment">#        .gif</span>
    title = <span class="hljs-string">f"DCGAN training process <span class="hljs-subst">{epoch}</span> over <span class="hljs-subst">{EPOCHS}</span> epochs"</span>
    <span class="hljs-keyword">if</span> epoch%int(EPOCHS/<span class="hljs-number">40</span>)==<span class="hljs-number">0</span>:<font></font>
        plot_generated_images(FIXED_NOISE, folder_name, title, show=<span class="hljs-literal">True</span>)<font></font>
        print(<span class="hljs-string">'    ,        0  1:'</span>)<font></font>
        print(np.mean(generator_acc_follow))<font></font>
        generator_acc_follow = []<font></font>
    <span class="hljs-keyword">else</span>:<font></font>
        plot_generated_images(FIXED_NOISE, folder_name, title)<font></font>
        <font></font>
generator.save(<span class="hljs-string">'generator_trained.h5'</span>)</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建.gif以可视化学习过程</font></font></h3><br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> folder_data <span class="hljs-keyword">in</span> os.walk(os.path.join(folder_name)):<font></font>
    all_pics_filenames = sorted(folder_data[<span class="hljs-number">2</span>], key=<span class="hljs-keyword">lambda</span> x: int(x.split()[<span class="hljs-number">3</span>]))<font></font>
<font></font>
<span class="hljs-keyword">with</span> imageio.get_writer(<span class="hljs-string">'DCGAN training.gif'</span>, mode=<span class="hljs-string">'I'</span>, fps=<span class="hljs-number">60</span>) <span class="hljs-keyword">as</span> writer:
    <span class="hljs-keyword">for</span> filename <span class="hljs-keyword">in</span> tqdm(all_pics_filenames):<font></font>
        image = imageio.imread(os.path.join(folder_name, filename))<font></font>
        writer.append_data(image)<font></font>
        <font></font>
<span class="hljs-keyword">with</span> open(<span class="hljs-string">'DCGAN training.gif'</span>,<span class="hljs-string">'rb'</span>) <span class="hljs-keyword">as</span> f:<font></font>
    display(Image(data=f.read(), format=<span class="hljs-string">'png'</span>))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可视化的学习过程：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/9r/aa/u2/9raau2sng7te4sxqbbc82qasyks.gif" alt="图片"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">摘要</font></font></h2><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅使用1.3M参数，在5000批处理之后GAN就开始生成可接受的图像，而在20,000则与手写图像没有区别的图像之后。</font><font style="vertical-align: inherit;">另外一个好处是，我们可以生成所需的数字。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这很可能不是可应用于GAN的改进的完整列表。</font><font style="vertical-align: inherit;">如果您有任何建议，请随时在评论中写这些建议。</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN506014/index.html">计算机语言学家和数据分析专家的“对话”将首次免费在线进行</a></li>
<li><a href="../zh-CN506018/index.html">电子市场如何应对冠状病毒危机</a></li>
<li><a href="../zh-CN506022/index.html">托管和专用服务器：回答问题。与真实客户的故事。冲突情况。第5部分</a></li>
<li><a href="../zh-CN506024/index.html">《纯粹的敏捷》一书。灵活性的基础</a></li>
<li><a href="../zh-CN506026/index.html">根证书过时的问题。下一步让我们加密和智能电视</a></li>
<li><a href="../zh-CN506034/index.html">甲骨文词汇表：历史</a></li>
<li><a href="../zh-CN506042/index.html">神经网络语言模型作为多功能医疗AI</a></li>
<li><a href="../zh-CN506044/index.html">评估债券组合的市场风险（风险价值）（理论）</a></li>
<li><a href="../zh-CN506050/index.html">uVision Keil中的单元测试（不仅限于此）</a></li>
<li><a href="../zh-CN506054/index.html">Raiffeisenbank的MskDotNet聚会11/06</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>