<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍵 👴🏼 ⛓️ カオスエンジニアリング、パート3：方法とツール 🔆 👨🏿‍💻 ☯️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="私たちは見るものになります。まずツールを形作り、次にツールが形を作ります。
 
 —マクルーハン元帥

   , , . , !
 

 , - — . - — ,  .
 "- , , . , ; , ; , "
 
 —Wikipedia

- , , , , , , .
 


  -
 

...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>カオスエンジニアリング、パート3：方法とツール</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/480802/"><p><img src="https://habrastorage.org/webt/bj/bo/hr/bjbohri48f3n_qtsbswegzbyw5y.jpeg"></p><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちは見るものになります。</font><font style="vertical-align: inherit;">まずツールを形作り、次にツールが形を作ります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
—マクルーハン元帥</font></font></blockquote><p><em>          <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>   ,    ,        . ,   !</em></p><br>
<p> ,  - —            . - —   , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  </a>.</p><a name="habracut"></a><br>
<blockquote>"-   ,       ,      .       ,    ;       ,    ;     ,    "<br>
<br>
—Wikipedia</blockquote><p>-      ,     ,    , , ,   ,     .</p><br>
<p><img src="https://habrastorage.org/webt/gq/yq/jc/gqyqjcysfguozpispkjletc21ik.png"><br>
<em> -</em></p><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">   </a>   -       .</p><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a> —  ,    ,     -,     .</p><br>
<p> ,             ,      .</p><br>
<p> —  ,   ,      ,   .</p><br>
<h2 id="vvedenie-otkaza---chto-eto-i-dlya-chego-nuzhno">  —      ?</h2><br>
<p>    ,         .    ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">    ""</a> —   ,      .</p><br>
<p>                   .    .        — ..  , —   ,      .    .</p><br>
<p>     , :</p><br>
<ul>
<li>       .</li>
<li>   .</li>
<li>     .</li>
<li>       .</li>
<li>    .</li>
<li>      .</li>
<li>     .</li>
</ul><br>
<h3 id="kategorii-vvedeniya-otkazov">  </h3><br>
<p> 5   :   (1) ; (2)   ; (3) ,   ; (4) ;  (5)  **.</p><br>
<p>              .           "  ".</p><br>
<blockquote>**!           ,     .</blockquote><br>
<h2 id="1---vvedenie-otkaza-na-urovne-resursa-aka-nehvatka-resursov">1 —     , aka  .</h2><br>
<p>,      ,    ,    :     . , ,   . —    ,     .    ,     .</p><br>
<p><img src="https://habrastorage.org/webt/ri/54/nn/ri54nnmprlvjvug3f395w6ohofk.png"></p><br>
<p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">"  "</a>,   ,     .   ,  , , ,     .</p><br>
<h3 id="istoschaya-resursy-cpu-pamyati-i-vvodavyvoda">  ,   /</h3><br>
<p>     — <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">stress-ng,</a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  ,    </a>.</p><br>
<p> stress-ng   ,     ,        ,  -.   -: ,  , , /, ,  , , , , ,   . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Man-</a>      -,    220!</p><br>
<p> —   ,   stress-ng:</p><br>
<p>   <code>matrixprod</code>      ,    . , .     .</p><br>
<pre><code class="plaintext hljs">❯ stress-ng —-cpu 0 --cpu-method matrixprod -t 60s</code></pre><br>
<p> <code>iomix-bytes</code>  N-   - <code>iomix</code>;    1 ,      - /.      80%    .</p><br>
<pre><code class="plaintext hljs">❯ stress-ng --iomix 1 --iomix-bytes 80% -t 60s</code></pre><br>
<p><code>vm-bytes</code>    - .    stress-ng  9 -  ,      90%  . ..,  -  10%  .</p><br>
<pre><code class="plaintext hljs">❯ stress-ng --vm 9 --vm-bytes 90% -t 60s</code></pre><br>
<h3 id="nehvatka-diskovogo-prostranstva-na-zhestkih-diskah">     </h3><br>
<p><code>dd</code> —    ,   ,     .  <code>dd</code>   /       <code>/dev/zero</code>  <code>/dev/random</code>   ,             . ..,            .         ?  , <code>dd</code>  —   !</p><br>
<p><strong> <code>dd</code>  .     —     ,   !</strong></p><br>
<pre><code class="plaintext hljs">❯ dd if=/dev/urandom of=/burn bs=1M count=65536 iflag=fullblock &amp;</code></pre><br>
<h3 id="podtormazhivanie-api-prilozheniy"> API </h3><br>
<p>,    API   . API         .</p><br>
<p>  —    ,       .      ,      ,            .</p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>wrk</code></a> —       HTTP,     .      API,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>,             :   ?    ?         ?</p><br>
<p>    :</p><br>
<pre><code class="plaintext hljs">❯ wrk -t12 -c400 -d20s http://127.0.0.1/api/health</code></pre><br>
<p>   12     400   HTTP   20 .</p><br>
<h2 id="2---vvedenie-otkazov-na-urovne-seti-i-zavisimostey">2 —       </h2><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a> "8   " (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">The Eight Fallacies of Distributed Computing</a>) —   ,   ,   .       ,    .     :</p><br>
<ul>
<li> .</li>
<li>  0.</li>
<li>  .</li>
<li> .</li>
<li>  .</li>
<li>  .</li>
<li>  0.</li>
<li> .</li>
</ul><br>
<p>  —       ,  ,       .<br>
 ,    </p><br>
<h3 id="vvedenie-zaderzhki-poteri-ili-obryva-seti"> ,    </h3><br>
<p><code>tc</code> (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>) —    Linux,       Linux.  ,            .     ,  , , ,   .</p><br>
<p><code>tc</code>           UDP  TCP        —    -. </p><br>
<p><strong> —    100 </strong></p><br>
<pre><code class="plaintext hljs">#Start<font></font>
❯ tc qdisc add dev etho root netem delay 100ms<font></font>
#Stop<font></font>
❯ tc qdisc del dev etho root netem delay 100ms</code></pre><br>
<p><strong> —    100     50 </strong></p><br>
<pre><code class="plaintext hljs">#Start<font></font>
❯ tc qdisc add dev eth0 root netem delay 100ms 50ms<font></font>
#Stop<font></font>
❯ tc qdisc del dev eth0 root netem delay 100ms 50ms</code></pre><br>
<p><strong> —  5%  </strong></p><br>
<pre><code class="plaintext hljs">#Start<font></font>
❯ tc qdisc add dev eth0 root netem corrupt 5%<font></font>
#Stop<font></font>
❯ tc qdisc del dev eth0 root netem corrupt 5%</code></pre><br>
<p><strong> —  7%   25- </strong></p><br>
<pre><code class="plaintext hljs">#Start<font></font>
❯ tc qdisc add dev eth0 root netem loss 7% 25%<font></font>
#Stop<font></font>
❯ tc qdisc del dev eth0 root netem loss 7% 25%</code></pre><br>
<blockquote><strong>!</strong> 7% ,     TCP.</blockquote><br>
<h3 id="igraya-s-etchosts---staticheskoy-tablicey-poiska-dlya-imen-uzlov">  "/etc/hosts" —      </h3><br>
<p><code>/etc/hosts</code> —   ,   IP-   ,    .     ,   :</p><br>
<pre><code class="plaintext hljs">IP_address canonical_hostname [aliases...]</code></pre><br>
<p><img src="https://habrastorage.org/webt/mx/po/lo/mxpoloqghh2ou_bphgifo69ydba.png"></p><br>
<p> hosts —    ,                IP-.  ,  :     .   :</p><br>
<p><strong> —    API DynamoDB   2</strong></p><br>
<pre><code class="plaintext hljs">#Start<font></font>
# make copy of /etc/hosts to /etc/host.back<font></font>
❯ cp /etc/hosts /etc/hosts.back<font></font>
❯ echo "127.0.0.1 dynamodb.us-east-1.amazonaws.com" &gt;&gt; /etc/hosts<font></font>
❯ echo "127.0.0.1 dynamodb.us-east-2.amazonaws.com" &gt;&gt; /etc/hosts<font></font>
❯ echo "127.0.0.1 dynamodb.us-west-1.amazonaws.com" &gt;&gt; /etc/hosts<font></font>
❯ echo "127.0.0.1 dynamodb.us-west-2.amazonaws.com" &gt;&gt; /etc/hosts<font></font>
❯ echo "127.0.0.1 dynamodb.eu-west-1.amazonaws.com" &gt;&gt; /etc/hosts<font></font>
❯ echo "127.0.0.1 dynamodb.eu-north-1.amazonaws.com" &gt;&gt; /etc/hosts<font></font>
#Stop<font></font>
# copy back the old version  /etc/hosts<font></font>
❯ cp /etc/hosts.back /etc/hosts</code></pre><br>
<p><strong> —    API EC2   2</strong></p><br>
<pre><code class="plaintext hljs">#Start<font></font>
# make copy of /etc/hosts to /etc/host.back<font></font>
❯ cp /etc/hosts /etc/hosts.back<font></font>
❯ echo "127.0.0.1 ec2.us-east-1.amazonaws.com" &gt;&gt; /etc/hosts<font></font>
❯ echo "127.0.0.1 ec2.us-east-2.amazonaws.com" &gt;&gt; /etc/hosts<font></font>
❯ echo "127.0.0.1 ec2.us-west-1.amazonaws.com" &gt;&gt; /etc/hosts<font></font>
❯ echo "127.0.0.1 ec2.us-west-2.amazonaws.com" &gt;&gt; /etc/hosts<font></font>
❯ echo "127.0.0.1 ec2.eu-west-1.amazonaws.com" &gt;&gt; /etc/hosts<font></font>
❯ echo "127.0.0.1 ec2.eu-north-1.amazonaws.com" &gt;&gt; /etc/hosts<font></font>
#Stop<font></font>
# copy back the old version  /etc/hosts<font></font>
❯ cp /etc/hosts.back /etc/hosts</code></pre><br>
<p> :  API 2   <code>ec2 describe-instances</code>  .</p><br>
<p><img src="https://habrastorage.org/webt/f9/oy/bc/f9oybcnf8l9s8ov4m7bzulyx6as.png"></p><br>
<p>    <code>127.0.01 ec2.eu-west-1.amazonaws.com</code>  <code>/etc/hosts</code>,   API 2 .</p><br>
<p><img src="https://habrastorage.org/webt/lj/6v/_y/lj6v_y8w7yfhnk9h8izd2gtj2aw.png"></p><br>
<p>,     API AWS.</p><br>
<h2 id="rasskazal-by-ya-vam-anekdot-pro-dns">      DNS...</h2><br>
<p><img src="https://habrastorage.org/webt/dq/mo/ps/dqmopsts1wl0pfntxgvwoqgcwby.gif"></p><br>
<h3 id="no-boyus-do-vas-doydet-tolko-na-vtorye-sutki-v-smysle-cherez-24-chasa">… , ,       .  ,  24 .</h3><br>
<p>21  2016  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">DDoS  Dyn</a>            .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> ThousandEyes   DNS     2018 </a>, 60%   SaaS-       DNS- , ..,     DNS.    DNS   ,     DNS,        DNS.</p><br>
<p><strong>Blackholing</strong> —  ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">DDoS </a>.      " "    void.  <code>/dev/null</code>     :-)          ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">DNS</a>, .</p><br>
<p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>iptables</code></a>,    ,    IP-   Linux.</p><br>
<p>  DNS-  blackhole,   :</p><br>
<pre><code class="plaintext hljs">#Start<font></font>
❯ iptables -A INPUT -p tcp -m tcp --dport 53 -j DROP<font></font>
❯ iptables -A INPUT -p udp -m udp --dport 53 -j DROP<font></font>
#Stop<font></font>
❯ iptables -D INPUT -p tcp -m tcp --dport 53 -j DROP<font></font>
❯ iptables -D INPUT -p udp -m udp --dport 53 -j DROP</code></pre><br>
<h3 id="vvedenie-otkazov-s-ispolzovaniem-toxiproxy">    Toxiproxy.</h3><br>
<p>   Linux  <code>tc</code>  <code>iptables</code>  —    —  .    root  ,         .     — <strong>Toxiproxy</strong>!</p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Toxiproxy</a> —  -    ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  Shopify</a>.           .      ,   .</p><br>
<p><img src="https://habrastorage.org/webt/9u/k6/w-/9uk6w-tyk0jk6n1jgdg8awf0oyo.png"></p><br>
<p>    , CI   ,      ,    . Toxiproxy  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><strong>toxics</strong></a>        ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://github.com/shopify/toxiproxy&amp;usg=ALkJrhgbQjwpWp4lTsS4lJPSg6MjJZOWaA#">API HTTP</a>.             toxics.</p><br>
<p>  ,  Toxiproxy     toxics,    1000       Redis, redis-cli   Redis.</p><br>
<p><img src="https://habrastorage.org/webt/vg/zg/gf/vgzggft6l5n0eywx2gn__njbc08.png"></p><br>
<p>Toxiproxy   Shopify          2014 .   —   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>.</p><br>
<h2 id="3---vvedenie-otkazov-na-urovne-prilozheniya-processa-i-servisa">3 —     ,   </h2><br>
<p> .  .    ?     SSH       ?             start, stop, restart.      ,     . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>systemd</code></a> —    ,       Linux. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>Supervisord</code></a>         UNIX.</p><br>
<p>  ,    . , ,   —       . ,         .</p><br>
<p><strong> —   Java</strong></p><br>
<pre><code class="plaintext hljs">❯ pkill -KILL -f java<font></font>
#Alternative<font></font>
❯ pkill -f 'java -jar'</code></pre><br>
<p><strong> —   Python</strong></p><br>
<pre><code class="plaintext hljs">❯ pkill -KILL -f python</code></pre><br>
<p> ,    <code>pkill</code>,      ,   .</p><br>
<h2 id="vvedenie-otkazov-bazy-dannyh">   </h2><br>
<p>    ,     ,   ,      .  —   ,    ,   ,     .</p><br>
<p><img src="https://habrastorage.org/webt/3c/lz/ye/3clzye5agj95ocxbo0vyorq2opc.png"><br>
<em>   . ---…  </em></p><br>
<p>               .  ,           —         .</p><br>
<p>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Amazon Aurora</a>,        Amazon Aurora,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  </a>.</p><br>
<h3 id="vvedenie-otkaza-amazon-aurora">  Amazon Aurora</h3><br>
<p>       SQL   Amazon Aurora        :</p><br>
<ul>
<li>     .</li>
<li> Aurora Replica.</li>
<li> .</li>
<li> .</li>
</ul><br>
<p>    ,     ,       .</p><br>
<p><strong> —    Amazon Aurora:</strong></p><br>
<pre><code class="plaintext hljs">ALTER SYSTEM CRASH [ INSTANCE | DISPATCHER | NODE ];</code></pre><br>
<p><strong> —   Aurora Replica:</strong></p><br>
<pre><code class="plaintext hljs">ALTER SYSTEM SIMULATE percentage PERCENT READ REPLICA FAILURE<font></font>
    [ TO ALL | TO "replica name" ]<font></font>
    FOR INTERVAL quantity { YEAR | QUARTER | MONTH | WEEK | DAY | HOUR | MINUTE | SECOND };</code></pre><br>
<p><strong> —       Aurora:</strong></p><br>
<pre><code class="plaintext hljs">ALTER SYSTEM SIMULATE percentage PERCENT DISK FAILURE<font></font>
    [ IN DISK index | NODE index ]<font></font>
    FOR INTERVAL quantity { YEAR | QUARTER | MONTH | WEEK | DAY | HOUR | MINUTE | SECOND };</code></pre><br>
<p><strong> —       Aurora:</strong></p><br>
<pre><code class="plaintext hljs">ALTER SYSTEM SIMULATE percentage PERCENT DISK CONGESTION<font></font>
    BETWEEN minimum AND maximum MILLISECONDS<font></font>
    [ IN DISK index | NODE index ]<font></font>
    FOR INTERVAL quantity { YEAR | QUARTER | MONTH | WEEK | DAY | HOUR | MINUTE | SECOND };</code></pre><br>
<h2 id="otkazy-v-mire-besservernyh-prilozheniy">    </h2><br>
<p>     ,     ,      AWS Lambda     .</p><br>
<h3 id="vvedenie-otkazov-v-funkcii-lambda">    Lambda</h3><br>
<p>    ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  python</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> lambda</a> —     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">AWS Lambda</a>.     ,    , ,      .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">AWS SSM Parameter Store</a>  :</p><br>
<pre><code class="plaintext hljs">{<font></font>
   "isEnabled": true,<font></font>
   "delay": 400,<font></font>
   "error_code": 404,<font></font>
   "exception_msg": "I really failed seriously",<font></font>
   "rate": 1<font></font>
}</code></pre><br>
<p>   python   handler,   .</p><br>
<p><strong> —  :</strong></p><br>
<pre><code class="plaintext hljs">@inject_exception<font></font>
def handler_with_exception(event, context):<font></font>
    return {<font></font>
        'statusCode': 200,<font></font>
        'body': 'Hello from Lambda!'<font></font>
    }<font></font>
&gt;&gt;&gt; handler_with_exception('foo', 'bar')<font></font>
Injecting exception_type &lt;class "Exception"&gt; with message I really failed seriously a rate of 1<font></font>
corrupting now<font></font>
Traceback (most recent call last):<font></font>
   File "&lt;stdin&gt;", line 1, in &lt;module&gt;<font></font>
   File "/.../chaos_lambda.py", line 316, in wrapper<font></font>
       raise _exception_type(_exception_msg)<font></font>
Exception: I really failed seriously</code></pre><br>
<p><strong> —    " ":</strong></p><br>
<pre><code class="plaintext hljs">@inject_statuscode<font></font>
def handler_with_statuscode(event, context):<font></font>
    return {<font></font>
        'statusCode': 200,<font></font>
        'body': 'Hello from Lambda!'<font></font>
    }<font></font>
&gt;&gt;&gt; handler_with_statuscode('foo', 'bar')<font></font>
Injecting Error 404 at a rate of 1<font></font>
corrupting now<font></font>
{'statusCode': 404, 'body': 'Hello from Lambda!'}</code></pre><br>
<p><strong> —  :</strong></p><br>
<pre><code class="plaintext hljs">@inject_delay<font></font>
def handler_with_delay(event, context):<font></font>
    return {<font></font>
        'statusCode': 200,<font></font>
        'body': 'Hello from Lambda!'<font></font>
    }<font></font>
&gt;&gt;&gt; handler_with_delay('foo', 'bar')<font></font>
Injecting 400 of delay with a rate of 1<font></font>
Added 402.20ms to handler_with_delay<font></font>
{'statusCode': 200, 'body': 'Hello from Lambda!'}</code></pre><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>,       .</p><br>
<h3 id="vvedenie-otkaza-v-ispolnenie-lambda-cherez-ogranichenie-parallelizma">    Lambda   </h3><br>
<p>Lambda              ,  .        ,       .         .        :   Lambda.</p><br>
<pre><code class="plaintext hljs">❯ aws lambda put-function-concurrency --function-name &lt;value&gt; --reserved-concurrent-executions 0</code></pre><br>
<p>     ,       "" —   <code>429</code>.</p><br>
<h3 id="thundra---trassirovka-besservernyh-peredach">Thundra —   </h3><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><strong>Thundra</strong></a> —      ,        .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">-</a>     «  » —    DynamoDB, "  " —   ,  " -   -".     ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>   .  .</p><br>
<p>       ,    -         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>.    .</p><br>
<h2 id="4---vvedenie-otkazov-na-urovne-infrastruktury">4 —     </h2><br>
<p>         —   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Amazon,    Netflix.</a>      —    -       — , ,  .</p><br>
<p>, ,       "<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>".</p><br>
<h3 id="ostanovka-instansov-ec2-vybrannyh-sluchayno-v-nekotoroy-zone-dostupnosti">  EC2,      .</h3><br>
<p>   Netflix     .    " "       AWS,    stateless- —   ,        ,     . " " ,      .</p><br>
<p>  —  " " —       ,        .</p><br>
<pre><code class="plaintext hljs">❯ stop_random_instance(az="eu-west-1a", tag_name="chaos", tag_value="chaos-ready", region="eu-west-1")</code></pre><br>
<pre><code class="plaintext hljs">import boto3<font></font>
import random<font></font>
<font></font>
REGION = 'eu-west-1'<font></font>
<font></font>
def stop_random_instance(az, tag_name, tag_value, region=REGION):<font></font>
    '''<font></font>
    &gt;&gt;&gt; stop_random_instance(az="eu-west-1a", tag_name='chaos', tag_value="chaos-ready", region='eu-west-1')<font></font>
    ['i-0ddce3c81bc836560']<font></font>
    '''<font></font>
    ec2 = boto3.client("ec2", region_name=region)<font></font>
    paginator = ec2.get_paginator('describe_instances')<font></font>
    pages = paginator.paginate(<font></font>
        Filters=[<font></font>
            {<font></font>
                "Name": "availability-zone",<font></font>
                "Values": [<font></font>
                    az<font></font>
                ]<font></font>
            },<font></font>
            {<font></font>
                "Name": "tag:" + tag_name,<font></font>
                "Values": [<font></font>
                    tag_value<font></font>
                ]<font></font>
            }<font></font>
        ]<font></font>
    )<font></font>
    instance_list = []<font></font>
    for page in pages:<font></font>
        for reservation in page['Reservations']:<font></font>
            for instance in reservation['Instances']:<font></font>
                instance_list.append(instance['InstanceId'])<font></font>
    print("Going to stop any of these instances", instance_list)<font></font>
    selected_instance = random.choice(instance_list)<font></font>
    print("Randomly selected", selected_instance)<font></font>
    response = ec2.stop_instances(InstanceIds=[selected_instance])<font></font>
    return response</code></pre><br>
<p>  <code>tag_name</code>  <code>tag_value</code>?        . #lessonlearned</p><br>
<p><img src="https://habrastorage.org/webt/fj/a3/uq/fja3uq8zoomlzrr4zomp1ycnh3k.jpeg"><br>
<em> …    —  [,   ]</em></p><br>
<h2 id="5---vvedenie-otkazov-i-instrumenty-orkestracii-tipa-vse-v-odnom">5 —       "  "</h2><br>
<p> ,       .  ,       ,           .</p><br>
<h3 id="chaos-toolkit">Chaos Toolkit</h3><br>
<p>     — <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Chaos Toolkit</a>,       -,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">ChaosIQ</a>.     : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>.</p><br>
<p>Chaos Toolkit     API      -.     AWS, Google Cloud Engine, Microsoft Azure, Cloud Foundry, Humino, Prometheus  Gremlin.</p><br>
<p> —     ,    :        ,  <code>tag-key</code>   <code>chaos-ready</code>.</p><br>
<pre><code class="plaintext hljs">{<font></font>
    "version": "1.0.0",<font></font>
    "title": "What is the impact of randomly terminating an instance in an AZ",<font></font>
    "description": "terminating EC2 instance at random should not impact my app from running",<font></font>
    "tags": ["ec2"],<font></font>
    "configuration": {<font></font>
        "aws_region": "eu-west-1"<font></font>
    },<font></font>
    "steady-state-hypothesis": {<font></font>
        "title": "more than 0 instance in region",<font></font>
        "probes": [<font></font>
            {<font></font>
              "provider": {<font></font>
                "module": "chaosaws.ec2.probes",<font></font>
                "type": "python",<font></font>
                "func": "count_instances",<font></font>
                "arguments": {<font></font>
                  "filters": [<font></font>
                    {<font></font>
                        "Name": "availability-zone",<font></font>
                        "Values": ["eu-west-1c"]<font></font>
                    }<font></font>
                  ]<font></font>
                }<font></font>
              },<font></font>
              "type": "probe",<font></font>
              "name": "count-instances",<font></font>
              "tolerance": [0, 1]<font></font>
            }<font></font>
        ]<font></font>
    },<font></font>
    "method": [<font></font>
        {<font></font>
            "type": "action",<font></font>
            "name": "stop-random-instance",<font></font>
            "provider": {<font></font>
                "type": "python",<font></font>
                "module": "chaosaws.ec2.actions",<font></font>
                "func": "stop_instance",<font></font>
                "arguments": {<font></font>
                    "az": "eu-west-1c"<font></font>
                },<font></font>
               "filters": [<font></font>
                    {<font></font>
                        "Name": "tag-key",<font></font>
                        "Values": ["chaos-ready"]<font></font>
                    }<font></font>
                ]<font></font>
            },<font></font>
            "pauses": {<font></font>
               "after": 60<font></font>
             }<font></font>
        }<font></font>
    ],<font></font>
    "rollbacks": [<font></font>
        {<font></font>
            "type": "action",<font></font>
            "name": "start-all-instances",<font></font>
            "provider": {<font></font>
                "type": "python",<font></font>
                "module": "chaosaws.ec2.actions",<font></font>
                "func": "start_instances",<font></font>
                "arguments": {<font></font>
                "az": "eu-west-1c"<font></font>
                 },<font></font>
               "filters": [<font></font>
                    {<font></font>
                        "Name": "tag-key",<font></font>
                        "Values": ["chaos-ready"]<font></font>
                    }<font></font>
                ]<font></font>
            }<font></font>
        }<font></font>
    ]<font></font>
}</code></pre><br>
<p>   :</p><br>
<pre><code class="plaintext hljs">❯ chaos run experiment_aws_random_instance.json</code></pre><br>
<p><img src="https://habrastorage.org/webt/0l/tb/qz/0ltbqz2b-ppule8qm6xxn0jb6p4.png"></p><br>
<p> Chaos Toolkit  , , -,            . -,      CI/CD    -.</p><br>
<p> Chaos Toolkit  ,      .  ,     ,      . ,      ChaosIQ,     ,    .</p><br>
<h3 id="gremlin">Gremlin</h3><br>
<p>    — Gremlin.               .   "--".</p><br>
<p>Gremlin      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">,   </a>,      ,  ..  "",   ,  ,  Kubernetes,   —    —  .</p><br>
<p>  —   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Gremlin</a>  ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>    !    : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">HML</a>.</p><br>
<p>  Gremlin  :</p><br>
<p>    Gremlin   "Create Attack".</p><br>
<p><img src="https://habrastorage.org/webt/xw/cv/m9/xwcvm9psqdr8uottkvc2nt4kexi.png"></p><br>
<p>  — .</p><br>
<p><img src="https://habrastorage.org/webt/v_/2v/u7/v_2vu75wvlrzgdem88t2ml0rggu.png"></p><br>
<p>  ,   ,    !</p><br>
<p><img src="https://habrastorage.org/webt/bx/oq/ox/bxoqoxv4vvxlayqtbtwpgkxd_yw.png"></p><br>
<p> ,  Gremlin   :     -  .</p><br>
<p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a> —    ,          .      .  , Gremlin-  daemon    ,   ,      .</p><br>
<h3 id="run-command-ot-aws-system-manager">Run Command  AWS System Manager</h3><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Run command    EC2</a>,   2015 ,       .           —   2,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>.       ,       ,   Systems Manager.</p><br>
<p>Run Command    DevOps   ad-hoc  ,      .</p><br>
<p>  ,  Run Command            ,        Windows,       -.</p><br>
<p>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">    AWS System Manager</a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  </a>    .  — !</p><br>
<h2 id="zakruglyaemsya">!</h2><br>
<p>    ,          .</p><br>
<p>1 — - —    ,     -   .  .          —    , —     , ,    .   ,     !    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>:</p><br>
<blockquote>"  .      ".<br>
— ,    - Amazon Prime Video</blockquote><p>2 —    , ,        .                ,        -.</p><br>
<p>3 —        ,        ,    .</p><br>
<p>4 — , , ,     . ,  - —        ,     .</p><br>
<p>   , , ,    . ,    . ,     ,       :-)</p><br>
<p>— </p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja480792/index.html">ギフトエンジニアリング</a></li>
<li><a href="../ja480794/index.html">オープンドア検索アルゴリズムの実装の特殊なケースについて少し</a></li>
<li><a href="../ja480796/index.html">シュレディンガーのプログラマー、開発者、猫</a></li>
<li><a href="../ja480798/index.html">C ++ロシアPiter 2019レポートレビュー</a></li>
<li><a href="../ja480800/index.html">ジョブテスターをお探しですか？開発者のスキルを示す準備をする</a></li>
<li><a href="../ja480804/index.html">完璧な3D設計システムの選択</a></li>
<li><a href="../ja480806/index.html">カスタムCSSプロパティが好きな5つの理由</a></li>
<li><a href="../ja480808/index.html">新しいOdnoklassnikiフロントエンド：ReactをJavaで起動します。パートI</a></li>
<li><a href="../ja480810/index.html">デジタルトランスフォーメーションの準備方法 事前にあなたのビジネスを破壊する</a></li>
<li><a href="../ja480812/index.html">Nvidia RTX-リアルタイムレイトレーシングテクノロジーがついにSOLIDWORKS Visualizeに登場</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>