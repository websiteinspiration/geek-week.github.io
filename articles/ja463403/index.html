<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>❌ 👨🏿‍✈️ 🧙🏽 RTOSに関する真実。記事＃31。RTOSの診断とエラーチェック ⛄️ 🖇️ 👩‍🚀</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="組み込みシステムアプリケーション用に設計されたオペレーティングシステムでは、エラー処理は最も一般的ではありません。すべての組み込みシステムには一定の制限があるため、リソースが限られているため、これは避けられない結果です。そして、そのようなシステムのごく一部だけが、デスクトップシステムのように動作する...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>RTOSに関する真実。記事＃31。RTOSの診断とエラーチェック</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/463403/"><img src="https://habrastorage.org/webt/ot/7b/f6/ot7bf602l2thhfxphukcduobth8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
組み込みシステムアプリケーション用に設計されたオペレーティングシステムでは、エラー処理は最も一般的ではありません。</font><font style="vertical-align: inherit;">すべての組み込みシステムには一定の制限があるため、リソースが限られているため、これは避けられない結果です。</font><font style="vertical-align: inherit;">そして、そのようなシステムのごく一部だけが、デスクトップシステムのように動作する能力を持っています。つまり、例外的なイベントの発生時にアクションを選択する能力をユーザーに提供します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nucleus SEでは、一般に3種類のエラーチェックがあります。</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">選択した構成の正常性を検証して、選択したパラメーターがエラーにならないことを確認する手段。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オプションで、ランタイム動作をチェックするためのコードが含まれています。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">より堅牢なコードの開発に貢献する特定のAPI関数。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このすべてについて、ユーザーによる診断に関するいくつかのアイデアと共に、この記事で説明します。</font></font><br>
<a name="habracut"></a><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シリーズの以前の記事：</font></font></b><div class="spoiler_text"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> #30.     Nucleus SE</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> #29.   Nucleus SE</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> #28.  </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> #27.  </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> #26. :     </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> #25.   :    </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> #24. :     </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> #23. :    </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> #22.  :     </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> #21.  :    </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> #20. :     </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> #19. :    </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> #18.   :     </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> #17.   :    </a> <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> #16. </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> #15.  :    </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> #14.  :    </a> <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> #13.       API</a> <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> #12.     </a> <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> #11. :     API</a> <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> #10. :     </a> <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> #9. : </a> <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> #8. Nucleus SE:    </a> <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> #7. Nucleus SE: </a> <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> #6.   </a> <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> #5.     </a> <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> #4. ,    </a> <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> #3.   </a> <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> #2. :     <br>
 #1. : . </a> <br>
</div></div> <br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">設定を確認する</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nucleus SEは、ユーザーの構成可能性に重点を置いて設計されており、利用可能なリソースを最大限に活用することができます。</font><font style="vertical-align: inherit;">可能なパラメーターの数とそれらの間の相互依存性が非常に大きいため、このような構成可能性は複雑なタスクです。</font><font style="vertical-align: inherit;">以前の多くの記事で述べたように、Nucleus SEを構成するためのユーザー手順のほとんどは</font><font style="vertical-align: inherit;">、</font><b><font style="vertical-align: inherit;">nuse_config.h</font></b><font style="vertical-align: inherit;">ファイルの</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#define</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ディレクティブを使用</font><font style="vertical-align: inherit;">して</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実行され</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
構成エラーの特定に役立つように、ファイル</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nuse_config.c</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">から</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#includeに</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font><font style="vertical-align: inherit;">、</font><b><font style="vertical-align: inherit;">#define</font></b><font style="vertical-align: inherit;">ディレクティブの整合性チェックを実行</font><font style="vertical-align: inherit;">するファイル</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nuse_config_check.hが</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">含まれています</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以下は、このファイルのスニペットです。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<pre><code class="plaintext hljs">/*** Tasks and task control ***/<font></font>
#if NUSE_TASK_NUMBER &lt; 1 || NUSE_TASK_NUMBER &gt; 16<font></font>
    #error NUSE: invalid number of tasks - must be 1-16<font></font>
#endif<font></font>
#if NUSE_TASK_RELINQUISH &amp;&amp; (NUSE_SCHEDULER_TYPE == NUSE_PRIORITY_SCHEDULER)<font></font>
    #error NUSE: NUSE_Task_Relinquish() selected - not valid with<font></font>
                                           priority scheduler<font></font>
#endif<font></font>
#if NUSE_TASK_RESUME &amp;&amp; !NUSE_SUSPEND_ENABLE<font></font>
    #error NUSE: NUSE_Task_Resume() selected  - task suspend not<font></font>
                                           enabled<font></font>
#endif<font></font>
#if NUSE_TASK_SUSPEND &amp;&amp; !NUSE_SUSPEND_ENABLE<font></font>
    #error NUSE: NUSE_Task_Suspend() selected  - task suspend not<font></font>
                                           enabled<font></font>
#endif<font></font>
#if NUSE_INITIAL_TASK_STATE_SUPPORT &amp;&amp; !NUSE_SUSPEND_ENABLE<font></font>
    #error NUSE: Initial task state enabled - task suspend not<font></font>
                                           enabled<font></font>
#endif<font></font>
/*** Partition pools ***/<font></font>
#if NUSE_PARTITION_POOL_NUMBER &gt; 16<font></font>
    #error NUSE: invalid number of partition pools - must be 0-16<font></font>
#endif<font></font>
#if NUSE_PARTITION_POOL_NUMBER == 0<font></font>
    #if NUSE_PARTITION_ALLOCATE<font></font>
        #error NUSE: NUSE_Partition_Allocate() enabled – no<font></font>
                                partition pools configured<font></font>
    #endif<font></font>
    #if NUSE_PARTITION_DEALLOCATE<font></font>
        #error NUSE: NUSE_Partition_Deallocate() enabled – no<font></font>
                                partition pools configured<font></font>
    #endif<font></font>
    #if NUSE_PARTITION_POOL_INFORMATION<font></font>
        #error NUSE: NUSE_Partition_Pool_Information() enabled –<font></font>
                                no partition pools configured<font></font>
    #endif<font></font>
#endif<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記のコードは、次のチェックを実行します。</font></font><br>
<ul>
<li> ,     ,     ;</li>
<li> ,    API        ;</li>
<li> ,          ;</li>
<li>,      API,    ;</li>
<li> ,   API            ;</li>
<li>        .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべての場合において、エラーが検出されると、</font><font style="vertical-align: inherit;">コンパイル時に</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#error</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ディレクティブが実行さ</font><font style="vertical-align: inherit;">れます。</font><font style="vertical-align: inherit;">これにより、通常、コンパイルが停止し、対応するメッセージが表示されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このファイルは、誤った構成/構成を作成できないことを保証するものではありませんが、非常に可能性が低くなります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API設定の確認</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nucleus RTOSと同様に、Nucleus SEには、実行時にAPI関数を呼び出すパラメーターをテストするコードを含めることができます。通常、これは初期のデバッグとテスト中にのみ使用されます。最終的なプログラムコードでは、過度のメモリ消費は望ましくないためです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パラメータチェックは、パラメータ割り当て</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NUSE_API_PARAMETER_CHECKING</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルの</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nuse_config.h</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TRUE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用してアクティブ化されます</font><font style="vertical-align: inherit;">。これにより、必要な追加コードがコンパイルされます。以下は、API関数のパラメーターをチェックする例です。</font></font><br>
<pre><code class="plaintext hljs">STATUS NUSE_Mailbox_Send(NUSE_MAILBOX mailbox, ADDR *message,<font></font>
                           U8 suspend)<font></font>
{<font></font>
      STATUS return_value;<font></font>
      #if NUSE_API_PARAMETER_CHECKING<font></font>
         if (mailbox &gt;= NUSE_MAILBOX_NUMBER)<font></font>
         {<font></font>
               return NUSE_INVALID_MAILBOX;<font></font>
         }<font></font>
         if (message == NULL)<font></font>
         {<font></font>
               return NUSE_INVALID_POINTER;<font></font>
         }<font></font>
         #if NUSE_BLOCKING_ENABLE<font></font>
            if ((suspend != NUSE_NO_SUSPEND) &amp;&amp;<font></font>
                  (suspend != NUSE_SUSPEND))<font></font>
            {<font></font>
                  return NUSE_INVALID_SUSPEND;<font></font>
            }<font></font>
            #else<font></font>
               if (suspend != NUSE_NO_SUSPEND)<font></font>
               {<font></font>
                     return NUSE_INVALID_SUSPEND;<font></font>
               }<font></font>
            #endif<font></font>
      #endif<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このようなパラメーターのチェックは、API呼び出しがエラーコードを出力するという事実につながる可能性があります。これは、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NUSE_INVALID_xxx</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">形式の負の値</font><font style="vertical-align: inherit;">（たとえば、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NUSE_INVALID_POINTER</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）です</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">定義の完全なセットは、ファイル</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nuse_codes.hに</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">含まれています</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エラー値を処理するには、追加のアプリケーションコード（条件付きコンパイルを使用して作成される可能性があります）を追加できますが、エラー値を検出するには、最新のファームウェアデバッガーのデータ監視ツールを使用することをお勧めします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パラメータをチェックすると、追加のメモリ消費（追加のコード）が発生し、コードのパフォーマンスに影響するため、その使用はシステム全体に影響します。</font><font style="vertical-align: inherit;">Nucleus SEのソースコード全体を開発者が利用できるため、絶対的な精度が必要な場合は、最終的なアプリケーションコードに対して手動で検証とデバッグを実行できます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タスクスタックの確認</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Run to Completion Schedulerが使用されるまで、Nucleus SEはタスクスタックをチェックする機能を提供します。これは、Nucleus RTOSの同様の機能に似ており、スタック上の残りのスペースを示します。</font><font style="vertical-align: inherit;">このAPIユーティリティ呼び出し（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NUSE_Task_Check_Stack（）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以前の記事</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（＃12）</font><font style="vertical-align: inherit;">で詳しく説明されて</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">います</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">スタックエラーをチェックするためのいくつかのアイデアは、この記事の後半の「カスタム診断」セクションで提供されます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バージョン情報</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nucleus RTOSおよびNucleus SEには、カーネルバージョン/ビルド情報を返すAPI関数があります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nucleus RTOS APIユーティリティ呼び出し</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービス呼び出しプロトタイプ：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CHAR * NU_Release_Information（VOID）; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パラメータ：なし。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
戻り値：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バージョン情報を含み、0バイトで終わる文字列へのポインター。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nucleus SE API呼び出し</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このAPI呼び出しは、Nucleus RTOS APIのコア機能をサポートしています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービス呼び出しプロトタイプ：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
char * NUSE_Release_Information（void）; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パラメータ：なし。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
戻り値：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バージョン情報を含み、0バイトで終わる文字列へのポインター。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nucleus SEアセンブリ情報を取得するための呼び出し</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このAPI呼び出しの実装は非常に簡単です。</font><font style="vertical-align: inherit;">ポインターは、定数行</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NUSE_Release_Infoに</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返され</font><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは、ファイル</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nuse_globals.c</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で宣言および初期化されます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この行の形式はNucleus SE- </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Xyymmmddです</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。ここで、</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">X-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビルドステータス：</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = alpha; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> =ベータ; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> =リリース</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">YY</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -リリースの年</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -リリースの月</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DD</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -リリース日</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nucleus RTOS互換</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nucleus RTOSには、オプションの履歴マガジンサポートが含まれています。</font><font style="vertical-align: inherit;">カーネルは、さまざまなシステムアクションの詳細を記録します。</font><font style="vertical-align: inherit;">プログラムで次のことを可能にするAPI関数があります。</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ロギングをアクティブ化/非アクティブ化します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ジャーナルエントリを作成します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ジャーナルエントリを受信します。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この機能はNucleus SEではサポートされていません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nucleus RTOSには、エラー確認なし（ASSERT）を実行し、ユーザー定義のクリティカルエラー関数を呼び出す機能を提供するいくつかのエラー管理マクロもあります。</font><font style="vertical-align: inherit;">オプションで、OSアセンブリに含まれています。</font><font style="vertical-align: inherit;">Nucleus SEはこの機能をサポートしていません。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーザー診断</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これまでのところ、この記事では、Nucleus SE自体が提供する診断ツールとエラーチェックツールについて説明しました。</font><font style="vertical-align: inherit;">ここで、カーネルが提供するツールを使用してユーザー定義またはアプリケーション固有の診断ツールを実装する方法、および/またはその内部構造と実装に関する私たちの知識を説明する価値があります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アプリケーション固有の診断</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ほとんどすべてのアプリケーションで、実行時に整合性を検証するためのコードを追加できます。</font><font style="vertical-align: inherit;">マルチタスクコアにより、このジョブ用の特別なタスクを簡単かつ簡単に作成できます。</font><font style="vertical-align: inherit;">明らかに、この記事では、あまりにも珍しい診断のケースは考慮しませんが、いくつかの一般的な考えを考慮します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メモリチェック</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
明らかに、適切なメモリ操作は、プロセッサシステムの整合性にとって重要です。</font><font style="vertical-align: inherit;">重大なエラーによって診断だけでなくソフトウェア製品全体を実行できないことも明らかです（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">翻訳者注：ちなみに、これはまさに</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「偽の青い錠剤」の記事で</font></font></a></i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">調べたケース</font></i><font style="vertical-align: inherit;">です）。</font><font style="vertical-align: inherit;">ただし、特定のエラーが表示される場合があります。これは懸念の深刻な原因ですが、コードの実行には影響しません。</font><font style="vertical-align: inherit;">メモリテストはかなり複雑なトピックであり、この記事の範囲を超えているため、いくつかの一般的なアイデアのみを説明します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RAMで発生する最も一般的な2つのエラーは次のとおりです。</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「スティッキービット」は、ビットの値が0または1で、変更できない場合。 </font></font></li>
<li>« »,        . </li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
両方のエラーは、特定のテストパターンをRAMの各領域に順に読み書きすることで確認できます。一部のチェックは、スタックが形成される前でも、起動時にのみ実行できます（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">翻訳者注：上記の記事では、すべてを一度に破壊したのはスタックの最初の使用であることが判明しました</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。たとえば、「実行ユニット」チェックでは、メモリの各ビットに1の値が割り当てられ、他のすべてのビットがチェックされて、それらがゼロであることを確認します。動作中に他のビット単位のテストパターンを実行できます。ただし、RAM領域が破損している間は、コンテキストの切り替えは発生しません。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nucleus SE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クリティカルセクション制限マクロ</font><b><font style="vertical-align: inherit;">NUSE_CS_Enter（）</font></b><font style="vertical-align: inherit;">および</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NUSE_CS_Exit（）の使用</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非常にシンプルでスケーラブルです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さまざまなタイプのROMにも定期的なエラーが発生しやすいですが、それらをチェックするためのツールは多くありません。</font><font style="vertical-align: inherit;">コードがアセンブルされた後に計算されたチェックサムは、ここで役立ちます。</font><font style="vertical-align: inherit;">このチェックは、ブート時、および場合によっては実行時に実行できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メモリアドレス指定ロジックのエラーは、ROMとRAMの両方に影響を与える可能性があります。</font><font style="vertical-align: inherit;">このエラーの特別なチェックを作成できますが、上記のチェックの一部として検出される可能性が高くなります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">周辺機器のテスト</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CPUに加えて、周辺回路にもエラーが発生しやすくなります。</font><font style="vertical-align: inherit;">もちろん、これはシステムによって大きく異なりますが、ほとんどのデバイスには、診断ソフトウェアを使用して整合性をチェックする方法がいくつかあります。</font><font style="vertical-align: inherit;">たとえば、通信チャネルにはループバック検証モードがあり、そのチャネルに着信するデータはすぐに返されます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウォッチドッグサービス</font></font></h3> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
組み込み開発者はウォッチドッグをよく使用します。</font><font style="vertical-align: inherit;">これは、CPUに割り込み、応答を待つか、（より好ましくは）定期的なソフトウェアアクセスを必要とする周辺機器です。</font><font style="vertical-align: inherit;">どちらの場合も、ウォッチドッグタイマーの一般的な結果はシステムリセットです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マルチタスク環境でウォッチドッグを効果的に使用することは複雑な問題です。</font><font style="vertical-align: inherit;">定期的にアクセスするタスク（ウォッチドッグタイマー）を作成すると、この特定のタスクが機能していることが確認されます。</font><font style="vertical-align: inherit;">考えられる解決策は、「ディスパッチャータスク」の実装です。</font><font style="vertical-align: inherit;">このようなタスクの例を以下に示します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スタックオーバーフローチェック</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Run to Completion Schedulerを使用しない場合、Nucleus SEアプリケーションのタスクごとにスタックが作成されます。これらのスタックの整合性は非常に重要ですが、RAMの容量は制限される可能性が高いため、アプリケーションのサイズを最適化することが重要です。各タスクのスタック要件を静的に予測することは可能ですが、非常に困難です。スタックは、最も要求の厳しい割り込みハンドラーとともに、最もネストされた関数でも十分に大きくなければなりません。この問題を解決するより簡単な方法は、徹底的なランタイムテストを使用することです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般的に、スタック検証には2つの方法があります。高度な組み込みソフトウェアデバッガーを使用する場合、スタックの境界を監視でき、すべての違反が検出されます。 Nucleus SEスタックの</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場所</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">とサイズは、グローバルなROMデータ構造である</font><b><font style="vertical-align: inherit;">NUSE_Task_Stack_Base []</font></b><font style="vertical-align: inherit;">および</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NUSE_Task_Stack_Size []で</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用できます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別の方法はランタイムテストです。</font><font style="vertical-align: inherit;">一般的なアプローチは、各スタックの最後に「ガードワード」を使用することです。通常、スタックデータの各領域の最初の要素です。</font><font style="vertical-align: inherit;">これらの単語は、認識されたゼロ以外の値で初期化されます。</font><font style="vertical-align: inherit;">サービス/診断タスクは、これらの単語が変更されているかどうかを確認し、適切なアクションを実行します。</font><font style="vertical-align: inherit;">セキュリティワードをマッシュアップしても、スタックがいっぱいであるとは限りませんが、これが発生しようとしていることを示しています。</font><font style="vertical-align: inherit;">したがって、ソフトウェアは引き続き機能し、修正措置を講じるか、ユーザーにエラーを報告する必要がある場合があります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スーパーバイザータスク</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nucleus SEは16の可能なタスクのいずれも自身のニーズのために予約していないという事実にもかかわらず、ユーザーは診断のために1つのタスクを選択できます。これは、任意の「空き」プロセッサ時間を単に使用する優先度の低いタスク、または定期的に実行されて短時間で実行される優先度の高いタスクであり、診断が定期的に実行されることを保証します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下は、同様のタスクがどのように機能するかの例です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ディスパッチャタスクのシグナルフラグは、6つの重要なシステムタスクの動作を追跡するために使用されます。これらの各タスクは特定のフラグ（ビット0からビット5まで）を使用し、定期的に設定する必要があります。ディスパッチタスクはすべてのフラグをリセットしてから、一定の期間、作業を一時停止します。彼女は仕事を再開するとき、適切なフラグを設定することによって6つすべてのタスクが「チェック」されることを期待し、次に</font><font style="vertical-align: inherit;">（ファイル</font><b><font style="vertical-align: inherit;">nuse_binary.h</font></b><font style="vertical-align: inherit;">から</font><font style="vertical-align: inherit;">）</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b00111111</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の値と完全に一致するものを</font><b><font style="vertical-align: inherit;">探し</font></b><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。すべてが要件を満たしている場合は、フラグをリセットして再び一時停止します。そうでない場合は、クリティカルエラー処理ルーチンを呼び出します。これにより、たとえば、システムを再起動できます。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別の実装では、イベントフラグのグループを使用できます。</font><font style="vertical-align: inherit;">これは、信号がアプリケーションの他の場所で使用されていない場合（そうでない場合、すべてのタスクによるRAMの過度の使用につながる）、特にイベントフラグが他の目的で使用されている場合に意味があります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トレースとプロファイリング</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最新の組み込みデバッガーの多くは高度にカスタマイズされており、RTOSでの作業に使用できるという事実にもかかわらず、マルチスレッドアプリケーションのデバッグは依然として困難な場合があります。</font><font style="vertical-align: inherit;">広く使用されているアプローチは実行後プロファイリングです。このプロファイリングでは、コード（RTOS）が実装され、その作業の詳細な監査を遡及的に分析できます。</font><font style="vertical-align: inherit;">通常、このようなサービスの実装には2つのコンポーネントが含まれます。</font></font><br>
<ol>
<li>       .           .      ,     (,   API   ).     :<br>
<ul>
<li>  (PC);</li>
<li>ID   ();</li>
<li>   ;</li>
<li>,   .</li>
</ul><br>
</li>
<li>,         , ,  -.</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このようにして得られたデータの分析にもいくつかの作業が必要になりますが、通常のExcelスプレッドシートを使用するよりも複雑ではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の記事では、Nucleus SEとNucleus RTOSの互換性について詳しく説明します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">著者について：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Colin Wallsはエレクトロニクス業界で30年以上働いており、彼のほとんどの時間をファームウェアに費やしています。</font><font style="vertical-align: inherit;">現在は、Mentor Embedded（Mentor Graphicsの一部門）のファームウェアエンジニアです。</font><font style="vertical-align: inherit;">Colin Wallsは、会議やセミナー、数多くの技術記事の著者、ファームウェアに関する2冊の本で講演することがよくあります。</font><font style="vertical-align: inherit;">イギリス在住。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Colinの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロフェッショナル</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ブログ</font></a><font style="vertical-align: inherit;">、電子メール：colin_walls@mentor.com。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja463391/index.html">数学の観点から全員と結婚する方法（1人、2人、3人の男性の結婚）と男性が常に勝つ理由</a></li>
<li><a href="../ja463393/index.html">あなたの会社は家族ですか、それともスポーツチームですか？</a></li>
<li><a href="../ja463397/index.html">中世の外国為替市場と金融工学</a></li>
<li><a href="../ja463399/index.html">3CX 16 Update 3 Alphaの紹介-高度なDNSおよびモバイルクライアントの再接続</a></li>
<li><a href="../ja463401/index.html">ナポリからローマへ：新しいAMD EPYC CPU</a></li>
<li><a href="../ja463405/index.html">開発の第2層（モバイルゲーム）、何を、いつ、なぜ</a></li>
<li><a href="../ja463411/index.html">悪いプロジェクトでは働かない</a></li>
<li><a href="../ja463415/index.html">セキュリティウィーク33：Black Hatで興味深い/ DEF CON 2019</a></li>
<li><a href="../ja463417/index.html">OSをAarch64に移植する</a></li>
<li><a href="../ja463419/index.html">8月12日から18日までのモスクワでのデジタルイベント</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>