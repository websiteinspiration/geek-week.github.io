<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⛹🏽 💇 👙 Alibaba Cloudが数万ものKubernetesクラスターを管理する方法... Kubernetes 👌🏻 🕡 ✋🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="キューブオンキューブ、メタクラスター、セル、リソース割り当て
 
 図。1. Alibaba CloudのKubernetesエコシステム
 
 2015年以降、Alibaba Cloud Container Service for Kubernetes（ACK）は、Alibaba Cloudで最も...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Alibaba Cloudが数万ものKubernetesクラスターを管理する方法... Kubernetes</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/483198/"><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キューブオンキューブ、メタクラスター、セル、リソース割り当て</font></font></h1><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/o_/pa/jx/o_pajxe0ox4zg4ev0uxomh2uka4.png"></div><br>
<i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。</font><font style="vertical-align: inherit;">1. Alibaba CloudのKubernetesエコシステム</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
2015年以降、Alibaba Cloud Container Service for Kubernetes（ACK）は、Alibaba Cloudで最も急速に成長しているクラウドサービスの1つです。</font><font style="vertical-align: inherit;">多数の顧客にサービスを提供し、Alibabaの内部インフラストラクチャや会社の他のクラウドサービスもサポートしています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
世界クラスのクラウドプロバイダーが提供する同様のコンテナーサービスと同様に、私たちの主な優先事項は信頼性と可用性です。</font><font style="vertical-align: inherit;">したがって、スケーラブルでグローバルにアクセス可能なプラットフォームが、数万のKubernetesクラスター用に作成されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では、クラウドインフラストラクチャ上で多数のKubernetesクラスターを管理した経験と、基盤となるプラットフォームのアーキテクチャについて説明します。</font></font><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前書き</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetesは、さまざまなクラウドワークロードのデファクトスタンダードとなっています。図に示すように。上部に1つ、Kubernetesクラスターで動作するAlibaba Cloudアプリケーションが増えています。これらは、ステートフル/ステートレスアプリケーションとアプリケーションマネージャーです。 Kubernetesの管理は、インフラストラクチャの構築と保守を行うエンジニアにとって、常に興味深く真剣なディスカッショントピックです。 Alibaba Cloudなどのクラウドプロバイダーに関しては、スケーラビリティが最優先されます。この規模でKubernetesクラスターを管理するにはどうすればよいですか？すでに10,000ノードの巨大なKubernetesクラスタを管理するためのベストプラクティスについて話しました。もちろん、これは興味深いスケーリングの問題です。しかし、別のスケールスケールがあります：</font><i><font style="vertical-align: inherit;">クラスター自体の</font></i><font style="vertical-align: inherit;">数</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多くのACKユーザーとこのトピックについて話し合いました。</font><font style="vertical-align: inherit;">それらのほとんどは、数百ではないにしても、数十の中小規模のKubernetesクラスターを実行することを好みます。</font><font style="vertical-align: inherit;">これには合理的な理由があります。潜在的な損傷の制限、さまざまなチームのクラスターの分割、テスト用の仮想クラスターの作成。</font><font style="vertical-align: inherit;">ACKがこの使用モデルで世界中のユーザーにサービスを提供しようとする場合、20を超えるリージョンで多数のクラスターを確実かつ効率的に管理する必要があります。</font><i><font color="gray"><font style="vertical-align: inherit;">図。</font></font></i><i><font color="gray"><font style="vertical-align: inherit;">2.膨大な数のKubernetesクラスタ</font></font></i><font style="vertical-align: inherit;"> 
を管理するための課題この規模でクラスタを管理するための主な課題は何ですか？</font><font style="vertical-align: inherit;">図に示すように、対処する必要のある4つの問題があります。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/nh/mz/ou/nhmzoutsfnr2pvic6bgmaqrpajk.png"></a><br>
<i><font color="gray"><font style="vertical-align: inherit;"></font></font></i><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">異質性</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ACKは、標準、サーバーレス、Edge、Windowsなど、さまざまなタイプのクラスターをサポートする必要があります。</font><font style="vertical-align: inherit;">異なるクラスターには、異なるパラメーター、コンポーネント、およびホスティングモデルが必要です。</font><font style="vertical-align: inherit;">一部のお客様は、特定のケースのカスタマイズについてサポートが必要です。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">異なるクラスターサイズ</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスターのサイズはさまざまです。いくつかのポッドを持つノードのペアから、数千のポッドを持つ数万のノードまで。</font><font style="vertical-align: inherit;">リソース要件も大きく異なります。</font><font style="vertical-align: inherit;">リソースの不適切な割り当ては、パフォーマンスに影響を与えたり、障害を引き起こす可能性さえあります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">異なるバージョン</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetesは急速に発展しています。</font><font style="vertical-align: inherit;">数か月ごとに新しいバージョンがリリースされます。</font><font style="vertical-align: inherit;">お客様は常に新しい機能を試す準備ができています。</font><font style="vertical-align: inherit;">したがって、Kubernetesの新しいバージョンにテスト負荷をかけ、安定したバージョンにワークロードをかけたいと考えています。</font><font style="vertical-align: inherit;">この要件を満たすために、ACKは安定したバージョンを維持しながら、常に新しいバージョンのKubernetesを顧客に提供する必要があります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全コンプライアンス</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスタはさまざまな地域に分散しています。</font><font style="vertical-align: inherit;">したがって、それらはさまざまな安全要件および公式の規制に準拠する必要があります。</font><font style="vertical-align: inherit;">たとえば、ヨーロッパのクラスターはGDPRに準拠する必要があり、中国の金融クラウドには追加レベルの保護が必要です。</font><font style="vertical-align: inherit;">これらの要件は必須であり、無視することはできません。これは、クラウドプラットフォームの顧客に大きなリスクをもたらすためです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ACKプラットフォームは、上記の問題のほとんどを解決するように設計されています。</font><font style="vertical-align: inherit;">現在、世界中で1万を超えるKubernetesクラスターを確実かつ安定的に管理しています。</font><font style="vertical-align: inherit;">設計/アーキテクチャのいくつかの重要な原則によるものを含め、これをどのようにして達成したかを見てみましょう。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">設計</font></font></h1><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キューブオンキューブとハニカム</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一元化された階層とは異なり、セルベースのアーキテクチャは通常、単一のデータセンターを超えてプラットフォームを拡張するため、または災害復旧の範囲を拡張するために使用されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alibaba Cloudの各リージョンは複数のゾーン（AZ）で構成され、通常は特定のデータセンターに対応しています。大規模な地域（広州など）では、ACKを実行している何千ものKubernetesクライアントクラスターが頻繁に見つかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ACKは、Kubernetes自体を使用してこれらのKubernetesクラスターを管理します。つまり、Kubernetesクライアントクラスターを管理するためのKubernetesメタクラスターがあります。このアーキテクチャは「キューブオンキューブ」とも呼ばれます（kube-on-kube、KoK）。 KoKアーキテクチャーは、クラスターのデプロイメントがシンプルで確定的なものになるため、クライアントクラスターの管理を簡素化します。さらに重要なことに、ネイティブのKubernetesの機能を再利用できます。たとえば、デプロイを通じてAPIサーバーを管理し、etcdオペレーターを使用して複数のetcdを管理します。このような再帰は常に特別な喜びをもたらします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同じリージョン内で、クライアントの数に応じて、いくつかのKubernetesメタクラスターがデプロイされます。</font><font style="vertical-align: inherit;">これらのメタクラスターをセルと呼びます。</font><font style="vertical-align: inherit;">ゾーン全体の障害から保護するために、ACKは1つのリージョンでのマルチアクティブデプロイメントをサポートしています。メタクラスターは、Kubernetesクライアントクラスターウィザードのコンポーネントを複数のゾーンに分散し、それらを同時に、つまりマルチアクティブモードで起動します。</font><font style="vertical-align: inherit;">ウィザードの信頼性と効率を確保するために、ACKはコンポーネントの配置を最適化し、APIサーバーとetcdが互いに接近していることを保証します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このモデルにより、Kubernetesを効果的、柔軟、確実に管理できます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メタクラスターリソースプランニング</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すでに述べたように、各リージョンのメタクラスターの数は顧客の数によって異なります。しかし、どの時点で新しいメタクラスターを追加しますか？これは典型的なリソース計画の問題です。原則として、既存のメタクラスターがすべてのリソースを使い果たしたときに、新しいメタクラスターを作成するのが通例です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、ネットワークリソースを見てみましょう。 KoKアーキテクチャでは、クライアントクラスターのKubernetesコンポーネントがポッドとしてメタクラスターにデプロイされます。私たちは</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Terway</font></a><font style="vertical-align: inherit;">を使用してい</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（図3）は、コンテナーネットワーク管理のためにAlibaba Cloudによって開発された高性能プラグインです。豊富なセキュリティポリシーのセットを提供し、Alibaba Cloud Elastic Networking Interface（ENI）を介して仮想プライベートクラウド（VPC）クライアントに接続できます。メタクラスター内のノード、ポッド、およびサービス間でネットワークリソースを効率的に分散するには、仮想プライベートクラウドからメタクラスター内のそれらの使用を注意深く監視する必要があります。ネットワークリソースが終了すると、新しいセルが作成されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各メタクラスター内のクライアントクラスターの最適な数を決定するために、コスト、密度の要件、リソースクォータ、信頼性の要件、および統計も考慮します。</font><font style="vertical-align: inherit;">新しいメタクラスターを作成するかどうかの決定は、このすべての情報に基づいて行われます。</font><font style="vertical-align: inherit;">小さなクラスターは将来大きく拡大する可能性があるため、同じ数のクラスターでもリソースの消費量が増えることに注意してください。</font><font style="vertical-align: inherit;">通常、各クラスターの成長に十分な空き領域を残します。</font><i><font color="gray"><font style="vertical-align: inherit;">図。</font></font></i><i><font color="gray"><font style="vertical-align: inherit;">3. Terwayネットワークアーキテクチャ</font></font></i></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/ya/i2/ub/yai2ub7fikdjzelyao2gmdtnrgw.png"></a><br>
<i><font color="gray"><font style="vertical-align: inherit;"></font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クライアントクラスターのウィザードコンポーネントのスケーリング</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ウィザードコンポーネントには、さまざまなリソース要件があります。それらは、クラスター内のノードとポッドの数、APIServerと対話する非標準のコントローラー/オペレーターの数に依存します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ACKでは、各Kubernetesクライアントクラスターのサイズとランタイム要件が異なります。ウィザードコンポーネントをホストするための汎用的な構成はありません。大きなクライアントに誤って低いリソース制限を設定すると、そのクラスターは負荷に対応できなくなります。すべてのクラスターに控えめな上限を設定すると、リソースが無駄になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
信頼性とコストの間の微妙な妥協点を見つけるために、ACKは型システムを使用しています。</font><font style="vertical-align: inherit;">つまり、3つのタイプのクラスター（小、中、大）を定義します。</font><font style="vertical-align: inherit;">各タイプには、個別のリソース割り当てプロファイルがあります。</font><font style="vertical-align: inherit;">タイプは、ウィザードコンポーネントのロード、ノードの数、およびその他の要因に基づいて決定されます。</font><font style="vertical-align: inherit;">クラスターのタイプは、時間の経過とともに変化する可能性があります。</font><font style="vertical-align: inherit;">ACKはこれらの要素を常に監視しており、それに応じてタイプを増減できます。</font><font style="vertical-align: inherit;">クラスターの種類を変更すると、ユーザーの介入を最小限に抑えてリソースの分布が自動的に更新されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは、このシステムをよりきめ細かいスケーリングとより正確な型更新の観点から改善し、これらの変更がよりスムーズに行われ、より経済的な意味を持つように取り組んでいます。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/x0/tl/bz/x0tlbzxilentubvzmfpxxyj4yey.png"></a><br>
<i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。</font><font style="vertical-align: inherit;">4.インテリジェントな多段式切替</font></font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クライアント全体のクラスターの進化</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前のセクションでは、多数のKubernetesクラスタを管理するいくつかの側面について説明しました。</font><font style="vertical-align: inherit;">ただし、対処する必要がある別の問題があります。それは、クラスターの進化です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetesは、クラウドの世界ではLinuxです。</font><font style="vertical-align: inherit;">継続的に更新され、よりモジュール化されます。</font><font style="vertical-align: inherit;">私たちは常にお客様に新しいバージョンを提供し、脆弱性を修正し、既存のクラスターを更新するとともに、多数の関連コンポーネント（CSI、CNI、デバイスプラグイン、スケジューラプラグインなど）を管理する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例としてKubernetesコンポーネント管理を取り上げます。</font><font style="vertical-align: inherit;">まず、これらすべてのプラグインコンポーネントの集中登録および管理システムを開発しました。</font><i><font color="gray"><font style="vertical-align: inherit;">図。</font></font></i><i><font color="gray"><font style="vertical-align: inherit;">5.柔軟なプラグインコンポーネント</font></font></i></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/qy/wi/ul/qywiulbbpugh8qnzwqicc9crwao.png"></a><br>
<i><font color="gray"><font style="vertical-align: inherit;"></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に進む前に、更新が成功したことを確認する必要があります。このために、コンポーネントの正常性を検証するためのシステムを開発しました。検証は、アップグレードの前後に実行されます。</font><i><font color="gray"><font style="vertical-align: inherit;">図。 6.クラスターコンポーネントの予備検証</font></font></i><font style="vertical-align: inherit;"> 
これらのコンポーネントを迅速かつ信頼性の高い方法で更新するために、継続的な展開システムは、部分的な昇格（グレースケール）、一時停止、およびその他の機能のサポートと連動します。標準のKubernetesコントローラは、この用途にはあまり適していません。そのため、クラスターのコンポーネントを管理するために、プラグインと補助制御モジュール（サイドカー管理）を含む一連の専用コントローラーを開発しました。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/ru/fv/af/rufvafitw7c2jz1tbcagoydnynq.png"></a><br>
<i><font color="gray"><font style="vertical-align: inherit;"></font></font></i><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、BroadcastJobコントローラーは、稼働中の各マシンのコンポーネントを更新したり、各マシンのノードをチェックしたりするように設計されています。ブロードキャストジョブは、DaemonSetのように、クラスター内のすべてのノードでポッドを実行します。ただし、DaemonSetは常にポッドの連続操作をサポートし、BroadcastJobはそれを最小化します。 Broadcastコントローラーは、新しく接続されたノードでポッドを開始し、必要なコンポーネントでノードを初期化します。 2019年6月、OpenKruiseオートメーションエンジンのソースコードを公開しました。これは、社内で使用しています。</font><i><font color="gray"><font style="vertical-align: inherit;">図。 7. OpenKuriseは、すべてのサイトでブロードキャストの割り当てを整理します。</font></font></i></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/z-/qr/j2/z-qrj2lfrhvlnpu-bu0wjmjjrlm.png"></a><br>
<i><font color="gray"><font style="vertical-align: inherit;"></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
お客様が適切なクラスター構成を選択できるように、サーバーレス、エッジ、Windows、ベアメタルプロファイルなど、事前定義されたプロファイルのセットも提供しています。</font><font style="vertical-align: inherit;">状況が拡大し、お客様のニーズが高まるにつれ、プロファイルを追加して面倒なセットアッププロセスを簡略化します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/1j/gq/gp/1jgqgpy35oc8ofocbuarul9hme8.png"><br>
<i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。</font><font style="vertical-align: inherit;">8.さまざまなシナリオに対応する高度で柔軟なクラスタープロファイル</font></font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">グローバルデータセンターの可観測性</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下の図に示すように。 9、アリババクラウドコンテナーは世界の20の地域で展開されます。このスケールでは、ACKの主要なタスクの1つは、実行中のクラスターのステータスを簡単に監視することです。クライアントクラスターで問題が発生した場合、状況に迅速に対応できます。つまり、すべてのリージョンのクライアントクラスタからリアルタイムの統計を効率的かつ安全に収集し、結果を視覚的に提示できるソリューションを考え出す必要があります。</font><i><font color="gray"><font style="vertical-align: inherit;">図。 9. 20地域でのAlibaba Cloud Containerサービスのグローバル展開</font></font></i><font style="vertical-align: inherit;"> 
多くのKubernetesモニタリングシステムと同様に、Prometheusをメインツールとして使用しています。各メタクラスターについて、Prometheusエージェントは次のメトリックを収集します。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/vu/98/ul/vu98ulw4i2aqeverburvnhxffne.png"></a><br>
<i><font color="gray"><font style="vertical-align: inherit;"></font></font></i><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li> ,     (, ,   . .)    .<br>
</li>
<li>       ,   kube-apiserver, kube-controller-manager  kube-scheduler.<br>
</li>
<li>  kubernetes-state-metrics  cadvisor.<br>
</li>
<li> etcd,      ,  ,       .&nbsp;.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グローバル統計は、典型的な多層集約モデルを使用して収集されます。</font><font style="vertical-align: inherit;">各メタクラスターからの監視データは、最初に各リージョンに集約され、次に中央サーバーに送信されます。これにより、全体像が示されます。</font><font style="vertical-align: inherit;">すべてがフェデレーションメカニズムを通じて機能します。</font><font style="vertical-align: inherit;">各データセンターのPrometheusサーバーはこのデータセンターのメトリックを収集し、中央のPrometheusサーバーは監視データの集計を担当します。</font><font style="vertical-align: inherit;">AlertManagerは中央のPrometheusに接続し、必要に応じて、DingTalk、電子メール、SMSなどを介してアラートを送信します。視覚化-Grafanaを使用します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
図10では、監視システムを3つのレベルに分類できます。</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">境界レベル</font></font></b></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
中心から最も遠いレイヤー。</font><font style="vertical-align: inherit;">Prometheus Edge Serverは各メタクラスターで実行され、同じネットワークドメイン内のメタクラスターとクライアントクラスターからメトリックを収集します。</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カスケードレベル</font></font></b></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prometheusカスケードレイヤー機能は、いくつかの地域からモニタリングデータを収集することです。</font><font style="vertical-align: inherit;">これらのサーバーは、中国、アジア、ヨーロッパ、アメリカなどのより大きな地理的単位のレベルで動作します。</font><font style="vertical-align: inherit;">クラスターが大きくなると、リージョンを分割でき、新しい大規模なリージョンごとにカスケードレベルのPrometheusサーバーが表示されます。</font><font style="vertical-align: inherit;">この戦略により、必要に応じてシームレスにスケーリングできます。</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中央レベル</font></font></b></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
中央のPrometheusサーバーは、すべてのカスケードサーバーに接続し、最終的なデータ集約を実行します。</font><font style="vertical-align: inherit;">異なるゾーンでの信頼性のために、同じカスケードサーバーに接続された2つの中央Prometheusインスタンスが生成されました。</font><i><font color="gray"><font style="vertical-align: inherit;">図。</font></font></i><i><font color="gray"><font style="vertical-align: inherit;">10. Prometheusフェデレーションメカニズムに基づくグローバルな多層監視アーキテクチャ</font></font></i></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/1e/sp/ck/1espck7kphl-6z7gqmtlvypr9f8.png"></a><br>
<i><font color="gray"><font style="vertical-align: inherit;"></font></font></i><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概要</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetesベースのクラウドソリューションは、業界を変革し続けています。</font><font style="vertical-align: inherit;">Alibaba Cloud Container Serviceは、安全で信頼性が高く高性能なホスティングを提供します。これは、Kubernetesの最高のクラウドホスティングサービスの1つです。</font><font style="vertical-align: inherit;">Alibaba Cloudチームは、オープンソースとオープンソースコミュニティの原則を強く信じています。</font><font style="vertical-align: inherit;">今後もクラウド技術の運用・管理に関する知識を共有していきます。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja483176/index.html">Messengerデータベース（パート1）：ベースフレームを設計します</a></li>
<li><a href="../ja483182/index.html">Array.reduce（）を使用する5つの興味深い方法（および1つの退屈な方法）</a></li>
<li><a href="../ja483184/index.html">TensorFlow 2への自動コードアップグレード</a></li>
<li><a href="../ja483190/index.html">3CXテクニカルサポートの回答：以前のバージョンから3CX v16にアップグレード</a></li>
<li><a href="../ja483194/index.html">手数料のためのボット。新しいテクノロジーでサッカーに行く</a></li>
<li><a href="../ja483202/index.html">REST APIの概要-RESTful Webサービス</a></li>
<li><a href="../ja483204/index.html">RESTとSOAPの違い</a></li>
<li><a href="../ja483206/index.html">REST API開発-最初に契約とは何ですか？</a></li>
<li><a href="../ja483208/index.html">Kaggle ML＆DSサーベイ2019のレビュー。またはMLスペシャリストの獲得額</a></li>
<li><a href="../ja483210/index.html">在宅勤務の主な欠点</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>