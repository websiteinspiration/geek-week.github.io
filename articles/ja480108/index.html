<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍰 😻 🙌🏾 例としてモバイル戦闘を使用したUnityプロジェクトの物理 👨🏽‍🤝‍👨🏼 🌒 😚</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="物理学はあらゆる現代のゲームの不可欠な部分となっています。単純な組織シミュレーションでも、本格的な交通物理学でも。モバイルゲームも例外ではありません。ただし、それらの物理を調整する場合は、旧世代のサポートされているデバイスのパフォーマンスが比較的低いことに関連する制限を振り返る必要があります。主要な...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>例としてモバイル戦闘を使用したUnityプロジェクトの物理</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/banzai/blog/480108/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/b_/ey/um/b_eyummqzvcslojzhc6pvvkgqn4.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
物理学はあらゆる現代のゲームの不可欠な部分となっています。</font><font style="vertical-align: inherit;">単純な組織シミュレーションでも、本格的な交通物理学でも。</font><font style="vertical-align: inherit;">モバイルゲームも例外ではありません。</font><font style="vertical-align: inherit;">ただし、それらの物理を調整する場合は、旧世代のサポートされているデバイスのパフォーマンスが比較的低いことに関連する制限を振り返る必要があります。</font><font style="vertical-align: inherit;">主要な3Dテクニカルアーティストの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Banzai.Games</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Roman Terskyは、チームがどのように物理をモバイル格闘ゲームShadow Fight 3のゲームプレイに統合したか、最適化に使用された手法、および物理の物理をゼロから書き直して同期PVPで完全な決定論を実現した方法について語りました。</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">固体物理学</font></font></h3><br>
<img src="https://habrastorage.org/webt/8c/ja/r7/8cjar7zihv322c1ld3p_t6q214w.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
シャドウファイト3のキャラクターの装備には、物理​​シミュレーションの対象となる多くの要素があり、画面上で起こっていることにダイナミクスが追加されます。</font><font style="vertical-align: inherit;">これらの要素の物理を設定するときに遭遇した主な問題の1つは、それらがスキンされるボーンがキャラクター自身のスケルトンの階層の中にあるという事実です。</font><font style="vertical-align: inherit;">移動すると、親のボーンの変形を繰り返し、物理的に現実的な衝撃を受けません。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">骨検出器 </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最も簡単な解決策は、骨の切り離しでした。</font><font style="vertical-align: inherit;">スクリプトを使用してすべての機器要素を初期化した後、物理的にアクティブな要素のボーンをキャラクターのスケルトンの階層から削除し、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キャラクタージョイント</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンポーネント</font><font style="vertical-align: inherit;">を使用して、親ボーンとの接続を作成します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/n7/up/n-/n7upn-3csflipqe49vakr_dbty4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、fpsドローダウンから発生する小さなエラーに直面しました。この場合、物理シミュレーションの対象となるボーンは、少し遅れて、Jointが接続されているボーンに「追いつきます」。</font><font style="vertical-align: inherit;">原則として、このエラーは無視できるほど重要ではありません。</font><font style="vertical-align: inherit;">他のケースでは、代替ソリューションが適用されました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">偽の衝動</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
攻撃者のヘルメットの例を使用してこの解決策を検討してください。そのスパルタンの紋章は物理シミュレーションの対象です。櫛を5つの部分に分割し、それぞれを異なる骨にスキンしました。これらのボーンのジョイント設定では、目的の軸に沿った回転に制限を設定</font><font style="vertical-align: inherit;">し、スプリング効果の原因となる</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ツイストリミットスプリング</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメータを設定します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-9/ha/b4/-9hab404oqtlgoi4bgaynjfdf_g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
物理的に現実的なシミュレーションでは、クレストボーンはキャラクター階層から除外されましたが、たとえば弱いデバイスでのfpsドローダウンの場合、ボーンが「追いつく」ためにメッシュが醜く引き伸ばされました。</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/lk/xz/qs/lkxzqsmhn7v03d2ylne5m5hg1xs.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、クレストボーンをキャラクター階層内に残し、それらのダイナミズムを高めて偽の衝動を与えることにしました。これを行うには、各アニメーション（戦闘スタンスを除く）で、インパルスを適用する瞬間とその方向を決定する必要がありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在のアニメーションのフレーム数を読み取り、この値から15〜20フレームを差し引き、受信した差の後にインパルスを適用できます。ただし、パルスの瞬間を</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">途切れない</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アニメーション</font><i><font style="vertical-align: inherit;">間隔の</font></i><font style="vertical-align: inherit;">終わりにリンクすることにより、不必要な計算を回避することができました</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各アニメーション（戦闘スタンスを除く）には、プレーヤーが中断できない期間が事前構成されています。この期間の後、またはストライキの受領時に、間隔は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中断されません</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そのアクションを終了し、その瞬間に私たちの勢いがトリガーされます。</font><font style="vertical-align: inherit;">必要なのは、いくつかのアニメーションの例外を構成することだけでした。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/al/dp/_y/aldp_yji9besba4c8o41afwrzka.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、必要に応じて、各アニメーションの終了の数フレーム前にインパルスがトリガーされます。</font><font style="vertical-align: inherit;">パルスの初期化の瞬間に、前のフレームと現在のフレームにあるボーンの座標を読み取り、そのモーションベクトルを受け取ります。</font><font style="vertical-align: inherit;">この軸では、インパルスが適用されます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">装備品</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最適化するために、キャラクターの装備のさまざまな要素の物理をシミュレートするときは、コライダーをできるだけ使用しないようにします。</font><font style="vertical-align: inherit;">ほとんどの場合、シミュレーションを実行するボーンのジョイント設定の軸に沿った制限のみを操作することでこれを実現しています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xn/bw/ub/xnbwubqnvvxtzrlebwb_huqnxy8.gif"> <img src="https://habrastorage.org/webt/yn/a-/ja/yna-javmxmnzvnuh-aswpfl-w3o.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
場合によっては（たとえば、金属板の場合）、コライダーの使用が避けられないことがあります。</font><font style="vertical-align: inherit;">ただし、主な負担はコライダーの存在ではなく、衝突の計算です。</font><b><font style="vertical-align: inherit;">プロジェクト設定</font></b><font style="vertical-align: inherit;">で</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レイヤーコリジョンマトリックスを</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">微調整すると、この負荷を最小限に抑えることができます。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">そのような要素については、それらの間でのみ衝突する2つの別々のレイヤーを使用し、他のレイヤー（武器、床、壁など）のコライダーとの衝突の誤計算を回避します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lu/az/og/luazogouubyghoajmiapbikohc0.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物理クローン</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Shadow Fight 3には、攻撃アニメーション以外で物理シミュレーションが使用される武器のタイプがいくつかあります。現時点では、これは、鎖、くりがま、ヌンチャク、フレールのナイフです。上記の理由により、物理的なシミュレーションが必要ない場合は、攻撃のアニメーションの外のキャラクター階層から武器のボーンを削除し、それらを戻すことにしました。</font><font style="vertical-align: inherit;">ボーンの</font><b><font style="vertical-align: inherit;">Rigidbody</font></b><font style="vertical-align: inherit;">コンポーネント</font><font style="vertical-align: inherit;">の</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Is Kinematic</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメータを操作することにより</font><font style="vertical-align: inherit;">、状況に応じて、物理のオンとオフを</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">切り替え</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、鎖に刀とナイフを使用すると、弱いデバイスで負荷が増加し、fpsドローダウンが発生しました。この問題は、ボーンがキャラクターの階層に戻り、物理シミュレーションがオフになったときに正確に発生しました。これは</font><font style="vertical-align: inherit;">、</font><b><font style="vertical-align: inherit;">Is Kinematic</font></b><font style="vertical-align: inherit;">パラメータがアクティブであっても</font><font style="vertical-align: inherit;">、スケルトン階層の親ボーン変換を変更すると、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rigidbody</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンポーネントがある各娘ボーンの物理エンジンに負担がかかるため</font><font style="vertical-align: inherit;">です。また、階層が長いほど、負荷が大きくなります。</font><font style="vertical-align: inherit;">
解決策は、物理的なクローンを作成することでした。チェーンのナイフの例でこれを考えてください。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/webt/te/tj/39/tetj39yfqebmxb4pkgv8-fztc14.gif"><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バトルロード中に、2つのスケルトンが初期化されます。キャラクターの階層内にあるメインのスケルトンと彼の物理的なクローンです。メインスケルトンのボーンには</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rigidbody</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンポーネントはなく、</font><font style="vertical-align: inherit;">アニメーショントラックのみが変形に影響します。 2番目のボーンには調整された接続（ジョイント）があり</font><font style="vertical-align: inherit;">、アクティブパラメーターがKinematicの</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rigidbody</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンポーネント</font><font style="vertical-align: inherit;">があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メインスケルトンのボーンの変換は、たとえばストライク中などのアニメーショントラックの影響を受けます</font><font style="vertical-align: inherit;">が、</font><b><font style="vertical-align: inherit;">リジッドボディ</font></b><font style="vertical-align: inherit;">コンポーネントの</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Is Kinematic</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメータ</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物理的なクローンのボーンはアクティブなままです。</font><font style="vertical-align: inherit;">骨は変形せず、物理シミュレーションの対象にもなりません。</font><font style="vertical-align: inherit;">アニメーションの最後のフレームで、2つのスケルトンのボーン変換が同期されます。</font><font style="vertical-align: inherit;">物理的なクローンは、メインスケルトンのボーンの位置と回転を読み取り、まったく同じパラメータを設定します。</font><font style="vertical-align: inherit;">Is Kinematicが無効になり、物理クローンのボーンがシミュレートされます。</font><font style="vertical-align: inherit;">さらに、次の攻撃アニメーションの開始時まで、すでにメインスケルトンで、各フレームは物理クローンのボーンの変換を読み取ります。このクローンは、その時点で物理的に移動し、これらのパラメーターをボーンに設定します。</font><font style="vertical-align: inherit;">このアプローチにより、物理エンジンの負荷が大幅に削減され、弱いデバイスでのパフォーマンスが向上しました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/c-/zz/2w/c-zz2w_tz4ivlrqcwihofotgiqu.gif"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">組織シミュレーション</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
モバイルデバイスのパフォーマンスの一部として組織シミュレーションを設定する場合、主な制限は、コライダーとの組織衝突の使用です。安価な代替策は</font><font style="vertical-align: inherit;">、生地の制約に</font><font style="vertical-align: inherit;">合わせて</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表面浸透</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を微調整</font><font style="vertical-align: inherit;">することです。私たちのゲームには多くのアニメーションとキャラクターのさまざまなポーズがあるので、最も「危険な」もののリストが編集され、すべての組織が体の他の部分への浸透をチェックされました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lg/jo/fe/lgjofebnfacq_llzmywkkmuw5f0.png" width="228"> <img src="https://habrastorage.org/webt/jc/su/mv/jcsumv5vumpaagaappctp5-4hcs.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、ティッシュシミュレーションを使用して、武器とボスのシャドウマインドの頭にFXフレーム効果を作成しました。</font><font style="vertical-align: inherit;">これらの要素の</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布の</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">設定</font><font style="vertical-align: inherit;">では、重力の影響をオフにし、加速度値を設定しました（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acceleration</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）Y軸に沿って：一定、つまり炎が上向きにランダムに上昇する-羽ばたき効果のため。</font><font style="vertical-align: inherit;">そのため、移動時にジオメトリの急激な歪みが発生しないように、増加する抵抗値（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ダンピング</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">を設定します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">したがって、火炎効果のパフォーマンスに関してはかなり現実的で安価です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tn/cn/zj/tncnzjmwecvndqkorcschfs_ufo.png"><br>
<br>
<img src="https://habrastorage.org/webt/ui/it/rp/uiitrpffrvxnjpa9tsvpdez9ano.gif"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同期PvPの確定的物理</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
死亡時および特定の状況で、Shadow Fight 3でキャラクターにヒットすると、物理シミュレーションがアクティブになります。長い間、Unityのストック固体物理学がこれに使用されていました。ただし、同期PVPをプロジェクトに導入する場合は、独自の開発を優先して中止する必要がありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同期PVPは、2つのクライアントでのゲームの同じシミュレーションを意味します。すべてが事前に計算されるため、アニメーションには問題がありませんが、物理学には特定の問題が発生します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際のところ、Unityの物理演算で使用される浮動小数点計算は、メーカーが異なるプロセッサーでは動作が異なります。この点で、ゲーム中、キャラクターの位置のエラーが蓄積します-1つのクライアントでは、キャラクターの位置は他のクライアントとは異なります。そして、物理の外では、クライアントの1つからのインジケーターに基づいて定期的に位置を同期させることでこの不一致を簡単に修正できます。物理の初期化時に、位置の開始エラーが原因で、物理シミュレーションは2つのクライアントで異なって発生します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、キャラクターの位置や位置が大幅に異なります。このような不一致の後、遅かれ早かれ、攻撃が1つのクライアントに記録され、他のクライアントには記録されない状況が発生します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一見すると、最も簡単な解決策は、あるクライアントでのキャラクターの位置を取得し、物理シミュレーション中に同期しながら、別のクライアントに転送することです。しかし、キャラクターのregdollは、大量のデータを短時間で転送する必要がある位置を正しく同期させるために、多数の個別の独立したソリッド（手足、頭）を伴うボーンの長い階層です。このオプションは「高額」であることが判明したため、決定論的である独自の物理学を記述することにしました。これにより、どのクライアントで計算が行われたかに関係なく、キャラクターの物理的な状態が確実に一致します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/id/kp/uv/idkpuvdwccnghub-gt_i9zg7esq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
では、私たちのレグドールは何ですか？ボディは重要なポイントであるノードで構成されます。それらには方向はありませんが、位置と質量があり、それらの間に調整可能な剛性の接続が実現されます。このようなノードのグループは、キャラクターのスケルトン内の各ボーンに接続されています。このアーキテクチャは、ジョイントに内部衝突と制限がないことを意味し、外部衝突と摩擦はノードレベルで実装されます。ノードが空間を移動するとき、重力、外力、および慣性が考慮されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ノード間には、2種類の接続があります：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">硬い肋骨</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（青）と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">弾性筋肉</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（赤）。肋骨は骨の役割を果たし、節点を特定の距離に配置し、それらが異なる方向に散乱するのを防ぎます。開始位置からの筋肉はノードから特定のポーズを形成し、それらの間の距離がターゲット値よりも大きい場合はそれらを引き寄せ、それよりも小さい場合はそれらを押し離します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/i6/zp/yu/i6zpyumeub7danaylwnop54av2o.gif" width="200"> <img src="https://habrastorage.org/webt/lt/ee/7j/ltee7j3ejnice_ww_9zmz1wgqy4.gif" width="256"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「内部」を見て、それがどのように機能するかを確認してください。最初に、ノードが自由に移動できるようにしてから、リンクを繰り返し調整して、ターゲットの特性に回復するようにします。筋肉調整の反復ごとに、肋骨調整の2つの反復があります。肋骨をより硬くすることで、筋肉が節にさらされた後に肋骨の接続が壊れないようにすることができます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8w/gp/oj/8wgpojyvyq-8xri-klubhqefizm.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、自由な動きの段階でノードがうまく移動できるほど、肋骨と筋肉を復元するために多くの計算コストを費やす必要があります。これらのコストと構造破壊のリスクを最小限に抑えるために、反復プロセスをいくつかのステップに分割することにしました。つまり、1つのフレームで数回ノードの自由な動きとその修正が行われます。 1つのステップで、ノードの移動がはるかに少なくなり、ノードの調整がはるかに簡単になります。したがって、肋骨と筋肉を調整するために必要な反復回数を大幅に節約できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3b/gi/fb/3bgifbrbqqsanddmmjjujyt5t9m.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
筋肉の長さのセットによって、ターゲットポーズが決まります。ターゲットポーズは、物理シミュレーションへの移行後に、キャラクターが任意の位置からシークします。過度に鋭い遷移と構造の混乱を避けるために、補間位置を追加しました。物理演算に入る瞬間に、キャラクターの現在のポーズを取り、それをターゲットにします。次に、50フレームの間、それを事前設定されたターゲット位置に補間して、スムーズな遷移を取得します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/r_/qm/z1/r_qmz1ghpgoe13z7mbwtfumnn_w.gif" width="480"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちの物理学を使用しているときに遭遇した主な問題は、主に腕である四肢の周期的なねじれです。これは、物理学への移行時に、キャラクターがターゲットから遠い位置にある可能性があるためです。このような状況を最小限に抑え、将来的に完全に回避するために、いくつかの対策が適用されました。まず、筋肉が節を引き締めることができるいくつかのターゲットポーズを設定します。物理学に入る瞬間、現在のポーズを取り、最も近い事前設定されたターゲットポーズを確認し、それにノードを引き締めます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jq/az/-f/jqaz-fbsyq1n1rb8b0ddo6v944a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初は、物理学に移行すると、筋肉がノードをしっかりと押して、ノードを目的の位置に持ってきました。多くの場合、この反発の鋭さは、四肢が強くねじれたという事実にもつながりました。筋力をスムーズに増加させ、状況を大幅に改善しました。物理シミュレーションの開始後の最初の2フレームの間、筋肉の強さは最大に留まり、ノードにインパルスを適用した後、ノードを安定させます。その後、筋肉はリラックスし、強度は55％になり、120フレームを超えると強度は徐々に100％まで増加します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/o2/t0/bx/o2t0bxsfhq1eg3kj1uj6mft5lw0.png" width="450"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後のステップは、2つの安定化ノードを追加することでした。胸の高さの前部と脚の高さの後ろです。</font><font style="vertical-align: inherit;">これらのノードには、胸部と骨盤の固定ノードとそれぞれリブ接続があり、不安定なノードは筋肉で締め付けられます。</font><font style="vertical-align: inherit;">他のノードとは異なり、安定化ノードは質量値が低く、床と競合しません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/t6/u6/g7/t6u6g7zz-u85gjundzcmxdn5eta.png" width="360"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
下のgifに結果が表示されます。整数計算に基づいて構築された完全に確定的な物理演算が得られ、サポートしている最も弱いデバイスでも60 fpsで安定して動作しています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/9v/da/_f/9vda_fr5h5evquyazx43opukdei.gif"><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソーシャルネットワークでBanzai Gamesをフォローしてください：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Facebook</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vkontakte</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instagram</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LinkedIn</font></font></a></blockquote><br>
<i>  Banzai Games   VFX-.      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>. </i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja480098/index.html">JH Rainwater「猫の放牧方法」：開発の反対側</a></li>
<li><a href="../ja480100/index.html">SEOについての初心者</a></li>
<li><a href="../ja480102/index.html">11月の製品管理ダイジェスト</a></li>
<li><a href="../ja480104/index.html">9つの便利なHTMLトリック</a></li>
<li><a href="../ja480106/index.html">Testcontainers用のOracle DBイメージを構築する方法</a></li>
<li><a href="../ja480110/index.html">uMCPIno：Arduino用のシンプルな配信保証プロトコルの作成</a></li>
<li><a href="../ja480112/index.html">一般レベルでのC ++ / Visual BasicとJavaの違い（初心者と学生向け）</a></li>
<li><a href="../ja480114/index.html">ITフリーランサーの税金に関するすべて。IEと自営業。パート1</a></li>
<li><a href="../ja480116/index.html">ロシアでのオープンソースの開発に関するMail.ruグループの立場</a></li>
<li><a href="../ja480118/index.html">純粋なJavaScriptを使用したタッチタイピングシミュレータを作成しています。パート1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>