<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëä üë®üèΩ‚Äçüîß üçÖ Pourquoi je n'utilise pas SharedViewModel pour les fragments? ü§≥üèª üëåüèª üîê</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Habr, bonjour! 
 
 La t√¢che d'organiser l'interaction entre les fragments est tr√®s courante. √Ä premi√®re vue, ShareViewModel est id√©al pour cela. Nous ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Pourquoi je n'utilise pas SharedViewModel pour les fragments?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/504712/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Habr, bonjour! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La t√¢che d'organiser l'interaction entre les fragments est tr√®s courante. √Ä premi√®re vue, ShareViewModel est id√©al pour cela. Nous cr√©ons un ViewModel avec owner = notre activit√©, dans lequel nos fragments sont affich√©s, et obtenons ce ViewModel √† l'int√©rieur de chaque fragment. Parce que le propri√©taire du ViewModel est actif, les fragments obtiennent la m√™me instance du ViewModel, ce qui leur permet d'√©changer des donn√©es, des m√©thodes d'appel, etc. Voici le lien de la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La figure ci-dessous montre le sch√©ma d'interaction de 3 fragments. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/367/ad4/04f/367ad404f3bf81ec55692ad5c7fc7ac7.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ceux. ce que nous faisons: dans chaque fragment, nous obtenons le SharedViewModel de ces fragments avec lesquels nous devons interagir ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et ce n'est pas la meilleure solution, √† mon avis. Parce que:</font></font><br>
<a name="habracut"></a><br>
<ol>
<li>    *VM.   ViewModel   View. ViewModel   LiveData,   View,    .. ViewModel    - ,   View.</li>
<li>  SharedViewModel ‚Äî     .   ,    SharedViewModel ,    ,     .     - . </li>
<li>       SharedViewModel,         .       ,     ,        . </li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SharedViewModel ne peut √™tre utilis√© que lorsqu'il existe plusieurs fragments compl√®tement identiques avec les m√™mes donn√©es. Dans ma pratique, il n'y avait pas un tel sc√©nario. Il peut y avoir deux fragments identiques, mais l'√©tat du ViewModel de chacun est diff√©rent, le SharedViewModel n'est pas valide pour eux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SharedViewModel apporte une tonne de probl√®mes. Vous commencez √† √™tre confus, tout est envahi de d√©pendances, le code est compliqu√©. Il est beaucoup plus facile de travailler lorsque Fragment + ViewModel est une bo√Æte noire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quelle solution peut-on proposer? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un service simple avec lequel chaque fragment interagit √† sa mani√®re.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/de9/a92/247/de9a92247d6d9f0cd0c1d9bbdf7bbe6c.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce service doit √™tre transmis √† l'int√©rieur de chaque ViewModel. Gr√¢ce √† la DI et √† la port√©e (Dagger, Koin, tout autre), cela peut √™tre fait facilement et simplement. Si le service doit vivre dans le contexte d'une activit√©, cr√©ez-le dans la port√©e de cette activit√© et transmettez-le √† chaque ViewModel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyez ce qui s'est pass√©: nous avons supprim√© tous les SharedViewModel des fragments. Chaque fragment ne sait d√©sormais rien des autres fragments. Si nous voulons ajouter un nouveau fragment √† ce sch√©ma, il nous suffit de connecter viewModel D √† notre service et c'est tout. Si le fragment doit r√©pondre √† un changement dans une propri√©t√© du service - abonnez-vous simplement. Nous n'avons plus besoin de comprendre les ViewModels des autres. Et ce service sera beaucoup plus simple que n'importe quel ViewModel, il sera plus facile de comprendre le service.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il peut sembler qu'il n'y a pas autant de fragments en interaction sur un m√™me √©cran. </font><font style="vertical-align: inherit;">Au t√©l√©phone - peut-√™tre. </font><font style="vertical-align: inherit;">Sur la tablette - vous ne pouvez plus dire cela. </font><font style="vertical-align: inherit;">Et FragmentContainerView permet d'utiliser des fragments dans toutes les pr√©sentations, ce qui est tr√®s pratique si l'application a de nombreux composants communs avec un cycle de vie.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bonus: comment cr√©er des fragments?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme ceci: SomeFragment () </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et qu'en est-il des param√®tres? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec l'av√®nement de ViewModel, je n'utilise pas de param√®tres. </font><font style="vertical-align: inherit;">Je ne transmets rien au fragment via le bundle (Android Studio propose toujours de cr√©er un fragment avec des arguments et de cr√©er un fragment via la m√©thode statique), je n'utilise pas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Safety NavArgs pour le composant de navigation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toutes ces choses conditionnent le fragment. Nous ne pouvons pas simplement prendre un tel fragment et l'ajouter au ViewPager, par exemple. Il faut penser comment passer les param√®tres. Ou un autre exemple: vous avez cr√©√© un fragment avec des param√®tres, vous y travaillez, les donn√©es ont chang√©, le fragment montre d√©j√† autre chose. Nous avons chang√© la configuration de l'appareil (retourn√©), le fragment a √©t√© recr√©√© avec des param√®tres obsol√®tes, tandis que le ViewModel contient d√©j√† d'autres donn√©es. Et l'actualisation des param√®tres, etc. commence. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai supprim√© tout cela dans le ViewModel. J'utilise le m√™me service par lequel je passe les param√®tres. Cela fonctionne comme Safety NavArgs. ViewModel demande des param√®tres au service par le type de la classe de param√®tres. Apr√®s avoir r√©cup√©r√© le param√®tre avec succ√®s, le service les supprime (fonctionne comme Push / Pop).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela r√©sout imm√©diatement le probl√®me de modification de la configuration: le fragment a √©t√© recr√©√© et le ViewModel est d√©j√† avec les donn√©es actuelles, il suffit de les connecter √† la View. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a aussi un probl√®me lors du passage des param√®tres via le bundle - c'est un exc√®s de la quantit√© autoris√©e. </font><font style="vertical-align: inherit;">Si la quantit√© de donn√©es transf√©r√©es d√©passe 500 ko., Alors l'application peut se bloquer en raison d'une exception dans Binder.java. </font><font style="vertical-align: inherit;">Cela a conduit √† la cr√©ation de diff√©rentes biblioth√®ques qui transmettent des param√®tres via SD, ce qui n'est pas tr√®s rapide par rapport √† l'utilisation de RAM. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En g√©n√©ral, les outils sont sympas, tout est flexible, mais il faut faire attention. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est tout, merci d'avoir regard√©!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr504700/index.html">Tablette graphique sovi√©tique "sketch"</a></li>
<li><a href="../fr504702/index.html">Les gens ne veulent pas conna√Ætre l'anglais</a></li>
<li><a href="../fr504706/index.html">Gestion automatique de l'alimentation Wi-Fi</a></li>
<li><a href="../fr504708/index.html">Probl√®me de certificat Sectigo apr√®s le 30 mai 2020 et m√©thode de solution</a></li>
<li><a href="../fr504710/index.html">FOSS News n ¬∞ 18 - une revue des nouvelles gratuites et open source du 25 au 31 mai 2020</a></li>
<li><a href="../fr504714/index.html">Go outils de mesure logiciels</a></li>
<li><a href="../fr504716/index.html">Acc√®s s√©curis√© √† une maison intelligente en l'absence d'une adresse IP publique (partie 1)</a></li>
<li><a href="../fr504718/index.html">Le condens√© de mati√®res fra√Æches du monde du front-end de la derni√®re semaine n ¬∞ 417 (25 - 31 mai 2020)</a></li>
<li><a href="../fr504720/index.html">Le moteur de template le plus rapide pour PHP</a></li>
<li><a href="../fr504722/index.html">HLS en MP4 en utilisant ffmpeg dans un navigateur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>