<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⏺️ 🏙️ 💼 FreePBX + GoIPの構成 🙎 👩🏿‍🔬 ♈️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="インターネット上にはかなりの数のカスタマイズ例があります。しかし、彼らのうちの一人が私のためにそうするように働かなかった。私が遭遇した問題の1つは、着信コールのある回線の誤った定義でした。かつて、この問題を解決するためのマニュアルを見つけられませんでした。そのため、ここに私のバージョンの手順を掲載す...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>FreePBX + GoIPの構成</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464765/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インターネット上にはかなりの数のカスタマイズ例があります。</font><font style="vertical-align: inherit;">しかし、彼らのうちの一人が私のためにそうするように働かなかった。</font><font style="vertical-align: inherit;">私が遭遇した問題の1つは、着信コールのある回線の誤った定義でした。</font><font style="vertical-align: inherit;">かつて、この問題を解決するためのマニュアルを見つけられませんでした。</font><font style="vertical-align: inherit;">そのため、ここに私のバージョンの手順を掲載することにしました。</font><font style="vertical-align: inherit;">同時に、将来のための自分用のベビーベッド。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GoIPのセットアップ</font></font></h1><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「構成」-「設定」</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GSMゲートウェイは、インターネットにアクセスできないローカルエリアネットワークにあります。</font><font style="vertical-align: inherit;">ローカルネットワークにNTPサーバーをセットアップして、時間を分散します。</font><font style="vertical-align: inherit;">再起動すると、GSMゲートウェイは同期し、現在の時刻を正しく表示します。</font><font style="vertical-align: inherit;">この手順をスキップできます。ゲートウェイの時刻を手動で設定する必要があります。</font><font style="vertical-align: inherit;">インターネットにアクセスできる場合は、パブリックNTPサーバーの1つを指定します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Time Serverで、NTPサーバーのIPアドレスを書き込みます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タイムゾーンを示します。タイムゾーンはGMT + 6です。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自動再起動を無効にします。</font><font style="vertical-align: inherit;">最新のファームウェアバージョンでは、GSMゲートウェイのフリーズに関する問題は見られません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IVRを無効にします。</font></font></li>
</ul><a name="habracut"></a><br>
<img src="https://habrastorage.org/webt/6a/kc/6x/6akc6xubnik10uyesyyeuetrcuw.jpeg" alt="画像"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「構成」-「ネットワーク」</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LANポート-静的IP</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPアドレス-ゲートウェイの静的IPアドレスを指定します</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「構成」-「基本的なVoIP」</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
構成モード-行ごとの構成。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「Line 1 Routing Prefix」が1と指定されている最初のチャネルでは1を指定し、2番目のチャネルでは2番目、3番目のチャネルでは3番目というように指定します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
認証ID：SIMカード番号を登録します（8 / + 7なしで登録しました）。例</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
：</font><font style="vertical-align: inherit;">9651234567 </font><font style="vertical-align: inherit;">SIPレジスト</font><font style="vertical-align: inherit;">ラー</font><font style="vertical-align: inherit;">サーバー：SIPサーバーのIPアドレス（192.168.0.10）</font></font><br>
<br>
<pre><code class="xml hljs">    Line 1<font></font>
    Authentication ID: 9651234567<font></font>
    Password: <font></font>
    Routing Prefix: 1<font></font>
    Sip Proxy: <font></font>
    SIP Registrar Server: 192.168.0.10:5160<font></font>
    Phone Nymber: 9651234567<font></font>
    Display Name: 9651234567</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残りの行についても同じです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8s/8y/p3/8s8yp3ly8kpzcuffvvhgqucc6aa.jpeg" alt="画像"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「構成」-「高度なVoIP」</font></font></h3><br>
<img src="https://habrastorage.org/webt/uw/b8/2n/uwb82nunhvrxbbgxifnaa1l3dyu.jpeg" alt="画像"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「構成」-「コールアウト」</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各行で、アスタリスクに付属し、発信コールを行う前にゲートウェイチャネルで削除されるプレフィックスを指定します。たとえば、CH1ダイヤルプランの場合は1：-1、CH2ダイヤルプランの場合は2：2：-2などです。</font></font><br>
<br>
<pre><code class="xml hljs">   Dial Plan: 1:-1</code></pre><br>
<img src="https://habrastorage.org/webt/cj/rg/yn/cjrgynmpqsmux0-esqf-rfw2wxq.jpeg" alt="画像"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「構成」-「コールイン」</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CID転送モードの推奨設定手順：着信番号を正しく決定するには、[CIDをSIP発信者IDとして使用]を選択します。</font><font style="vertical-align: inherit;">[リモートパーティーIDを使用]を選択しました。</font><font style="vertical-align: inherit;">これは、電話がかかってきた回線を正しく判別するために行われました。</font><font style="vertical-align: inherit;">着信番号が正しく決定されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zy/a2/os/zya2oswrpqr_jbrbwpssb14-vcs.jpeg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これでGoIPのセットアップが完了しました。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FreePBX 14の構成</font></font></h1><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接続-トランク</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「SIP（chan_sip）トランクの追加」を選択します。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一般タブ</font></font></h4><br>
<img src="https://habrastorage.org/webt/rb/if/yp/rbifypqzucee2g2cflhi0ha3_oe.jpeg" alt="画像"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「ダイヤル操作規則」タブに移動します</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テンプレートを処方する。</font><font style="vertical-align: inherit;">各トランクのプレフィックスを順番に指定します。</font><font style="vertical-align: inherit;">1行目1、2行目2など</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ud/eq/x1/udeqx164u6kx3a3rk5jx5yidw8c.jpeg" alt="画像"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タブSIPの一般設定</font></font></h4><br>
<h6><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">発信</font></font></h6><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アスタリスクは、複数のアカウントに同じポートを使用します。</font><font style="vertical-align: inherit;">これにより、呼び出しが行われた回線を判別する際に問題が発生します。</font><font style="vertical-align: inherit;">着信コールでは、最後に登録されたごちそうが常に使用され、その結果、コールの発信元のGoIP回線が誤って決定されます。</font><font style="vertical-align: inherit;">回線を正しく判別するために、</font><font style="vertical-align: inherit;">GoIPでは</font><font style="vertical-align: inherit;">Go </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remote</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モードが選択され</font><font style="vertical-align: inherit;">、Astriskでは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trustrpid = yes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が選択さ</font><font style="vertical-align: inherit;">れました</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="xml hljs">host=dynamic<font></font>
username=7712020077<font></font>
secret=Djfgkjgfd!!!!234%$^%#<font></font>
type=friend<font></font>
context=from-trunk-sip-9651234567-custom<font></font>
trustrpid=yes</code></pre><br>
<img src="https://habrastorage.org/webt/o2/0m/9j/o20m9jyzsotrxn8osqkmarw8pzc.jpeg" alt="画像"><br>
<br>
<h6><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">着信</font></font></h6><br>
<pre><code class="xml hljs">in-9651234567<font></font>
<font></font>
secret=Djfgkjgfd!!!!234%$^%#<font></font>
type=user<font></font>
context=from-trunk-sip-9651234567-custom</code></pre><br>
<img src="https://habrastorage.org/webt/2b/-l/us/2b-lusewyxlogecbsayvgynlch0.jpeg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、内線番号と通話グループを作成します。</font><font style="vertical-align: inherit;">これがどのように行われるかについては説明しません。</font><font style="vertical-align: inherit;">FreePBXでは、これは[アプリケーション]メニューの[拡張機能]と[アプリケーション]-[コールグループ]から実行できます。</font><font style="vertical-align: inherit;">すべてが非常にシンプルで直感的です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接続-送信ルーティング</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[送信ルートを追加]を選択します。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ルート設定タブ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ルートの名前を指定します（例：all_line）。</font><font style="vertical-align: inherit;">次に、発信コールが行われるトランクを順番に示します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ut/o3/sa/uto3sahdz0fsnutbjp6ddjzsroc.jpeg" alt="画像"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「ダイヤルルール」タブに移動します</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ここでは、発信番号のパターンを規定します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bi/gl/os/biglos628mkrb_b1vh1ge4vfmww.jpeg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残りのタブはデフォルトで残されています。</font><font style="vertical-align: inherit;">これで、送信ルートの構成が完了しました。</font><font style="vertical-align: inherit;">電話をかけることができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、コールがルートに示されている順序でトランクを通過するという問題が発生する可能性があります。</font><font style="vertical-align: inherit;">これにより、最初の行のユニットが後続のユニットよりも多くなるという事実につながります。</font><font style="vertical-align: inherit;">この問題を解決するには、extensions_override_freepbx.confを使用して、アウトバウンドルートのルールを書き換えます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
行数に応じて、ランダムに使用できます。</font><font style="vertical-align: inherit;">たとえば、2行の場合は1.2です。</font><font style="vertical-align: inherit;">このコードを使用します</font></font><br>
 <br>
<pre><code class="xml hljs">    [outrt-sets](!)<font></font>
    exten =&gt; _.,50,Set(a_rand_num=${RAND(1,2)});<font></font>
        same =&gt; n,GotoIf($["${a_rand_num}"<span class="hljs-tag">&lt;<span class="hljs-name">"2"]?${n}+1:${n}+2)</span>
        <span class="hljs-attr">same</span> =&gt;</span> n,GotoIf($["${GROUP_COUNT(OUT_1)}"&gt;="${OUTMAXCHANS_1}"]?${n}+1:out-1-cust)<font></font>
        ...<font></font>
<font></font>
    [outrt](outrt-sets) ; all_line<font></font>
        exten =&gt; _+7XXXXXXXXXX,3,Goto(50)<font></font>
        exten =&gt; _8XXXXXXXXXX,3,Goto(50)</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接続-受信ルーティング</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
着信ルートを追加します。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一般タブ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、「インバウンド」などの説明を指定します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、ルートの終点を選択する最後の項目「方向を設定」を選択します。</font><font style="vertical-align: inherit;">私の場合は、無料のオペレーターに電話がつながるように、通話グループを指定しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、私はもっと複雑なロジックを持っています。</font><font style="vertical-align: inherit;">AGIスクリプトを使用して、データベースで着信番号を探し、見つかった場合は、割り当てられているオペレーターに送信します。</font><font style="vertical-align: inherit;">jabberを介してSIPクライアントへの呼び出しを受信する前に、クライアントに関する情報を含むメッセージをオペレーターに送信します。</font><font style="vertical-align: inherit;">番号がデータベースで見つからない場合、コールはグループに送られます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/um/ni/h7/umnih7qnfkwjgqwvxj7tcurrzga.jpeg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これでセットアップは完了です。</font><font style="vertical-align: inherit;">電話をかけたり受けたりすることができます。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多くの人はFreePBXの設定を好まないが、アスタリスクをそのままにしています。私はIPテレフォニーの経験がまったくなかったため、FreePBXを選択する機会が一度にありました。設定の編集に問題はありませんでした。変更は、extensions_custom.confおよびextensions_override_freepbx.conf構成ファイルを使用して行うことができます。理解するのはそれほど難しいことではありません。小さなコールセンターがあります。 GoIPが最高であることが判明しました。唯一のものは、ネイティブSMSサーバーによって調整されませんでした。そのため、SMSメッセージの送受信をサポートし、SMS配信のステータスも表示する、私自身のものを作成しました。本格的な電話交換ができました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちはJsSipライブラリに基づいて記述されたWeb電話を使用するsipクライアントとして、Firefox 68およびChrome 76で正常に動作します。時間があれば、JsSipライブラリの使用に関する詳細な手順を記述します。</font><font style="vertical-align: inherit;">独自のSMSサーバーの作成に関する個別の記事と同様に。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja464753/index.html">ITへの参入：ナイジェリアの開発者エクスペリエンス</a></li>
<li><a href="../ja464757/index.html">就職前のLinkedInプロファイルの改善</a></li>
<li><a href="../ja464759/index.html">プロジェクトマネージャーが2020年に必要とする数十のアジャイルブック</a></li>
<li><a href="../ja464761/index.html">小さな改造はテスラをビデオ監視ステーションに変えます</a></li>
<li><a href="../ja464763/index.html">Linux上のサーバーのベンチマーク：オープンツールの選択</a></li>
<li><a href="../ja464769/index.html">Badooが毎秒20万枚の写真を提供することを可能にした方法</a></li>
<li><a href="../ja464773/index.html">リッチインターネットアプリケーションの非同期Typescriptとそれと戦うデコレータ</a></li>
<li><a href="../ja464775/index.html">9月21日Badoo PHPミートアップ＃3：パフォーマンス</a></li>
<li><a href="../ja464777/index.html">constがC / C ++コードを高速化しないのはなぜですか？</a></li>
<li><a href="../ja464779/index.html">快楽主義のミツバチについて、人々が彼らを働かせる方法とドローン</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>