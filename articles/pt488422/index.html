<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèº‚Äç‚öñÔ∏è üíÇüèº ü•ß 10 linhas de c√≥digo para reduzir a dor do seu projeto Vue üîö üë©üèæ‚Äçüî¨ üï∂Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="... ou familiaridade com os plugins Vue JS como um exemplo de um barramento de eventos integrado
 Algumas palavras sobre ...
 Ol√° a todos! Farei uma r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>10 linhas de c√≥digo para reduzir a dor do seu projeto Vue</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/odin_ingram_micro/blog/488422/"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... ou familiaridade com os plugins Vue JS como um exemplo de um barramento de eventos integrado</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algumas palavras sobre ...</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ol√° a todos! </font><font style="vertical-align: inherit;">Farei uma reserva imediatamente. </font><font style="vertical-align: inherit;">Eu realmente amo o VueJS, escrevo ativamente h√° mais de 2 anos e n√£o acho que o desenvolvimento possa prejudicar pelo menos em um grau significativo :)</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por outro lado, estamos sempre tentando encontrar solu√ß√µes universais que ajudem a gastar menos tempo em trabalhos mec√¢nicos e mais no que √© realmente interessante. √Äs vezes, a solu√ß√£o √© particularmente bem-sucedida. Um deles eu quero compartilhar com voc√™. As 10 linhas que ser√£o discutidas (spoiler: no final, haver√° um pouco mais) nasceram no processo de trabalho no projeto Cloud Blue - Connect, que √© um aplicativo bastante grande com mais de 400 componentes. A solu√ß√£o que encontramos j√° est√° integrada em v√°rios pontos do sistema e, por mais de meio ano, nunca exige corre√ß√µes, portanto pode ser considerada com seguran√ßa testada com sucesso quanto √† estabilidade.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E o √∫ltimo. </font><font style="vertical-align: inherit;">Antes de prosseguir diretamente para a solu√ß√£o, gostaria de me aprofundar um pouco mais na descri√ß√£o dos tr√™s tipos de intera√ß√£o entre os componentes do Vue: os princ√≠pios do fluxo unidirecional, o padr√£o da loja e o barramento de eventos. </font><font style="vertical-align: inherit;">Se essa explica√ß√£o for desnecess√°ria (ou chata) para voc√™, v√° diretamente para a se√ß√£o com a solu√ß√£o - tudo √© o mais breve e t√©cnico poss√≠vel.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um pouco sobre como os componentes do Vue se comunicam</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Talvez a primeira pergunta que surja para a pessoa que escreveu seu primeiro componente seja como ele receber√° dados para o trabalho e como, por sua vez, ele transferir√° os dados recebidos por ele "fora". </font><font style="vertical-align: inherit;">O princ√≠pio de intera√ß√£o adotado no framework Vue JS √© chamado ...</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fluxo de dados unidirecional</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em resumo, esse princ√≠pio soa como "propriedades - desativadas, eventos - ativadas". Ou seja, para receber dados de fora (‚Äúde cima‚Äù), registramos uma propriedade especial dentro do componente no qual a estrutura, se necess√°rio, grava nossos dados recebidos ‚Äúde fora‚Äù. Para transferir dados "para cima", dentro do componente no lugar certo, chamamos o m√©todo especial de estrutura $ emit, que passa nossos dados para o manipulador do componente pai. Ao mesmo tempo, no Vue JS, n√£o podemos apenas "transmitir" o evento at√© uma profundidade ilimitada (como por exemplo no Angular 1.x). Ele "aparece" apenas um n√≠vel, para o pai imediato. O mesmo vale para eventos. Para transferi-los para o pr√≥ximo n√≠vel, para cada um deles, voc√™ tamb√©m precisa registrar uma interface especial - propriedades e eventos que transmitir√£o nossa "mensagem" ainda mais.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso pode ser descrito como um pr√©dio de escrit√≥rios no qual os trabalhadores s√≥ podem passar dos andares para os vizinhos - um para cima e outro para baixo. Portanto, para transferir o ‚Äúdocumento para assinatura‚Äù do quinto andar para o segundo, ser√° necess√°ria uma cadeia de tr√™s trabalhadores que o entregar√£o do quinto andar para o segundo e mais tr√™s que o devolver√£o ao quinto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Mas isso √© inconveniente!" Obviamente, isso nem sempre √© conveniente do ponto de vista do desenvolvimento, mas, olhando o c√≥digo de cada componente, podemos ver o que e para quem ele passa. N√£o precisamos ter em mente toda a estrutura do aplicativo para entender se nosso componente est√° "a caminho" do evento ou n√£o. Podemos ver isso no componente pai.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Embora as vantagens dessa abordagem sejam compreens√≠veis, ela tamb√©m apresenta desvantagens √≥bvias, a saber, a alta coes√£o dos componentes. </font><font style="vertical-align: inherit;">Simplificando, para colocarmos algum componente na estrutura, precisamos cobri-lo com as interfaces necess√°rias para gerenciar seu estado. </font><font style="vertical-align: inherit;">Para reduzir essa conectividade, eles costumam usar "ferramentas de gerenciamento de estado". </font><font style="vertical-align: inherit;">Talvez a ferramenta mais popular para o Vue seja ...</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vuex (lateral)</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Continuando nossa analogia com um pr√©dio de escrit√≥rios, o Vuex Stor √© um servi√ßo postal interno. Imagine que em cada andar do escrit√≥rio haja uma janela para emiss√£o e recebimento de encomendas. No quinto andar, transmitem o documento n¬∫ 11 para assinatura e, no segundo, perguntam periodicamente: ‚ÄúExistem documentos para assinatura?‚Äù, Assinam os documentos existentes e os devolvem. No quinto, eles tamb√©m perguntam: "Existem signat√°rios?" Ao mesmo tempo, os funcion√°rios podem mudar para outros andares ou para outras salas - o princ√≠pio do trabalho n√£o ser√° alterado enquanto o correio estiver funcionando. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aproximadamente por esse princ√≠pio, o padr√£o chamado Store tamb√©m funciona. Usando a interface Vuex, um armaz√©m de dados global √© registrado e configurado, e os componentes se inscrevem nele. E n√£o importa em que n√≠vel de estrutura a apela√ß√£o ocorreu, a loja sempre fornecer√° as informa√ß√µes corretas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parece que com isso todos os problemas j√° foram resolvidos. Mas em algum momento do nosso edif√≠cio metaf√≥rico, um funcion√°rio quer ligar para outro para almo√ßar ... ou relatar algum tipo de erro. E aqui come√ßa o estranho. A mensagem em si n√£o requer transmiss√£o como tal. Mas, para usar o e-mail, voc√™ precisa transferir alguma coisa. Em seguida, nossos funcion√°rios criam um c√≥digo. Uma bola verde - v√° almo√ßar, dois cubos vermelhos - ocorreu um erro de aplica√ß√£o E-981273, tr√™s moedas amarelas - verifique seu e-mail e assim por diante.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â f√°cil adivinhar que, com a ajuda dessa met√°fora inc√¥moda, descrevo situa√ß√µes em que precisamos garantir a resposta do nosso componente a um evento que ocorreu em outro componente, que por si s√≥ n√£o est√° conectado de nenhuma maneira ao fluxo de dados. </font><font style="vertical-align: inherit;">A grava√ß√£o de um novo item est√° conclu√≠da - voc√™ precisa refazer a cole√ß√£o. </font><font style="vertical-align: inherit;">Ocorreu um erro 403 n√£o autorizado - voc√™ precisa iniciar um logout do usu√°rio e assim por diante. </font><font style="vertical-align: inherit;">A pr√°tica usual (e longe da melhor) nesse caso √© criar sinalizadores dentro da loja ou interpretar indiretamente os dados armazenados e suas altera√ß√µes. </font><font style="vertical-align: inherit;">Isso leva rapidamente √† polui√ß√£o da pr√≥pria loja e √† l√≥gica dos componentes ao seu redor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse est√°gio, come√ßamos a pensar em como transmitir eventos diretamente, ignorando toda a cadeia de componentes. </font><font style="vertical-align: inherit;">E, um pouco do google ou vasculhando a documenta√ß√£o, encontramos um padr√£o ...</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Barramento de evento</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Do ponto de vista t√©cnico, o barramento de eventos √© um objeto que permite o uso de um m√©todo especial para iniciar um "evento" e se inscrever usando outro. Em outras palavras, ao se inscrever no evento eventA, esse objeto armazena a fun√ß√£o de manipulador de passagem dentro de sua estrutura, que ser√° chamada quando o m√©todo de inicializa√ß√£o com a chave eventA for chamado em algum lugar do aplicativo. Para assinar ou executar, basta acess√°-lo por importa√ß√£o ou por refer√™ncia, e pronto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metaforicamente, em nosso ‚Äúpr√©dio‚Äù, um √¥nibus √© um bate-papo comum no messenger. Componentes assinam um "bate-papo geral" para o qual outros componentes enviam mensagens. Assim que uma "mensagem" aparecer no "bate-papo", ao qual o componente se inscreveu, o manipulador ser√° iniciado.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem muitas maneiras diferentes de criar um barramento de eventos. </font><font style="vertical-align: inherit;">Voc√™ pode escrever por conta pr√≥pria ou pode usar solu√ß√µes prontas - o mesmo RxJS, que fornece enorme funcionalidade para trabalhar com fluxos inteiros de eventos. </font><font style="vertical-align: inherit;">Mas, na maioria das vezes, ao trabalhar com o VueJS, eles usam, curiosamente, o pr√≥prio VueJS. </font><font style="vertical-align: inherit;">A inst√¢ncia do Vue criada por meio do construtor (new Vue ()) fornece uma interface de evento bonita e concisa, descrita na documenta√ß√£o oficial. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui chegamos perto da pr√≥xima pergunta ...</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que n√≥s queremos?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E queremos construir um barramento de eventos em nosso aplicativo. </font><font style="vertical-align: inherit;">Mas temos dois requisitos adicionais:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deve ser facilmente acess√≠vel em todos os componentes. </font><font style="vertical-align: inherit;">As importa√ß√µes separadas para cada uma das dezenas de componentes nos parecem redundantes.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deve ser modular. </font><font style="vertical-align: inherit;">N√£o queremos manter todos os nomes de eventos em mente para evitar a situa√ß√£o em que o evento "criado por item" aciona manipuladores de todo o aplicativo. </font><font style="vertical-align: inherit;">Portanto, queremos poder separar facilmente um pequeno fragmento da √°rvore de componentes em um m√≥dulo separado e transmitir seus eventos dentro e n√£o fora.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para implementar essa funcionalidade impressionante, usamos a poderosa interface de plug-in fornecida pelo VueJS. </font><font style="vertical-align: inherit;">Voc√™ pode se familiarizar com isso com mais detalhes </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na p√°gina com documenta√ß√£o oficial. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos registrar nosso plugin primeiro. </font><font style="vertical-align: inherit;">Para fazer isso, logo antes do ponto de inicializa√ß√£o do aplicativo Vue (antes de chamar Vue. $ Mount ()), colocamos o seguinte bloco:</font></font><br>
<br>
<pre><code class="javascript hljs">Vue.use({   <font></font>
  install(vue) { }, <font></font>
});<font></font>
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De fato, os plugins do Vue s√£o uma maneira de estender a funcionalidade da estrutura em todo o n√≠vel do aplicativo. A interface do plug-in fornece v√°rias maneiras de se integrar ao componente, mas hoje apresentaremos a interface mixin. Este m√©todo aceita um objeto que estende o descritor de cada componente antes de iniciar o ciclo de vida no aplicativo.</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(O c√≥digo do componente que escrevemos provavelmente n√£o √© o componente em si, mas uma descri√ß√£o de seu comportamento e encapsulamento de uma certa parte da l√≥gica que a estrutura usa em v√°rios est√°gios do seu ciclo de vida. A inicializa√ß√£o do plug-in est√° fora do ciclo de vida do componente, precedendo-o, portanto, n√≥s dizemos "descritor", n√£o um componente, para enfatizar que exatamente o c√≥digo que est√° escrito em nosso arquivo, e n√£o alguma entidade que √© um produto do trabalho da estrutura, ser√° transferido para a se√ß√£o mixin do plug-in)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="javascript hljs">Vue.use({<font></font>
  install(vue) {     <font></font>
    vue.mixin({}); <span class="hljs-comment">// &lt;--</span><font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â esse objeto vazio que conter√° as extens√µes para nossos componentes. Mas, para come√ßar, outra parada. No nosso caso, queremos criar uma interface para acessar o barramento no n√≠vel de cada componente. Vamos adicionar o campo '$ broadcast' ao nosso descritor, ele armazenar√° um link para o nosso barramento. Para fazer isso, use Vue.prototype:</font></font><br>
<br>
<pre><code class="javascript hljs">Vue.use({   <font></font>
  install(vue) { <font></font>
    vue.prototype.$broadcast = <span class="hljs-literal">null</span>; <span class="hljs-comment">// &lt;--</span><font></font>
    vue.mixin({}); <font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora precisamos criar o pr√≥prio barramento, mas primeiro, vamos relembrar o requisito da modularidade e assumir que no descritor de componentes declararemos um novo m√≥dulo com o campo "$ module" com algum valor de texto (precisaremos um pouco mais tarde). </font><font style="vertical-align: inherit;">Se o campo $ module for especificado no pr√≥prio componente, criaremos um novo barramento para ele; caso contr√°rio, passaremos o link para o pai atrav√©s do campo $ parent. </font><font style="vertical-align: inherit;">Observe que os campos do descritor estar√£o dispon√≠veis para n√≥s atrav√©s do campo $ options. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Colocaremos a cria√ß√£o de nosso √¥nibus o mais cedo poss√≠vel - no gancho beforeCreate.</font></font><br>
<br>
<pre><code class="javascript hljs">Vue.use({<font></font>
  install(vue) { <font></font>
    vue.prototype.$broadcast = <span class="hljs-literal">null</span>; <font></font>
    vue.mixin({<font></font>
      beforeCreate() {  <span class="hljs-comment">// &lt;--</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>) {  <span class="hljs-comment">// &lt;--</span><font></font>
         <font></font>
 	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$parent &amp;&amp; <span class="hljs-keyword">this</span>.$parent.$broadcast) {  <span class="hljs-comment">// &lt;--</span><font></font>
         <font></font>
        } <font></font>
      }, <font></font>
    }); <font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por fim, vamos preencher os ramos l√≥gicos. </font><font style="vertical-align: inherit;">Se o descritor contiver uma nova declara√ß√£o de m√≥dulo, crie uma nova inst√¢ncia de barramento, caso contr√°rio, pegue o link em $ parent.</font></font><br>
<br>
<pre><code class="javascript hljs">Vue.use({   <font></font>
  install(vue) { <font></font>
    vue.prototype.$broadcast = <span class="hljs-literal">null</span>; <font></font>
    vue.mixin({<font></font>
      beforeCreate() { <font></font>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>) {
          <span class="hljs-keyword">this</span>.$broadcast = <span class="hljs-keyword">new</span> Vue();  <span class="hljs-comment">// &lt;--</span>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$parent &amp;&amp; <span class="hljs-keyword">this</span>.$parent.$broadcast) { 
          <span class="hljs-keyword">this</span>.$broadcast = <span class="hljs-keyword">this</span>.$parent.$broadcast;  <span class="hljs-comment">// &lt;--</span><font></font>
        } <font></font>
      }, <font></font>
    }); <font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Descartamos o an√∫ncio do plugin, consideramos ... 1, 2, 3, 4 ... 10 linhas, como prometi! </font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Podemos fazer melhor?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Claro que podemos. </font><font style="vertical-align: inherit;">Este c√≥digo √© facilmente extens√≠vel. </font><font style="vertical-align: inherit;">Por exemplo, no nosso caso, al√©m de $ broadcast, decidimos adicionar a interface $ rootBroadcast, que d√° acesso a um √∫nico barramento para todo o aplicativo. </font><font style="vertical-align: inherit;">Os eventos que o usu√°rio executa no barramento $ broadcast s√£o duplicados no barramento $ rootBroadcast, para que voc√™ possa se inscrever em todos os eventos de um m√≥dulo espec√≠fico (nesse caso, o nome do evento ser√° passado para o manipulador como o primeiro argumento) ou para todos os eventos de aplicativos em geral (depois o nome do m√≥dulo ser√° passado para o manipulador com o primeiro argumento, o nome do evento com o segundo e os dados transmitidos com o evento ser√£o transmitidos com os seguintes argumentos). </font><font style="vertical-align: inherit;">Esse design nos permitir√° estabelecer intera√ß√£o entre os m√≥dulos, al√©m de travar um √∫nico manipulador nos eventos de diferentes m√≥dulos.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// This one emits event  </span>
<span class="hljs-keyword">this</span>.$broadcast.$emit(‚Äòmy-event‚Äô, ‚ÄòPARAM_A‚Äô); 
<span class="hljs-comment">// This is standard subscription inside module </span>
<span class="hljs-keyword">this</span>.$broadcast.$on(‚Äòmy-event‚Äô, (paramA) =&gt; {‚Ä¶}); 
<span class="hljs-comment">// This subscription will work for the same event </span>
<span class="hljs-keyword">this</span>.$rootBroadcast.$on(‚Äòmy-event‚Äô, (<span class="hljs-built_in">module</span>, paramA) =&gt; {‚Ä¶}); 
<span class="hljs-comment">// This subscription will also work for the same event </span>
<span class="hljs-keyword">this</span>.$rootBroadcast.$on(‚Äò*‚Äô, (event, <span class="hljs-built_in">module</span>, paramA) =&gt; {‚Ä¶});
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos ver como podemos conseguir isso: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro, crie um √∫nico barramento, que ser√° organizado atrav√©s de $ rootBroadcast, e o pr√≥prio campo com um link:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> $rootBus = <span class="hljs-keyword">new</span> Vue(); <span class="hljs-comment">// &lt;--</span><font></font>
<font></font>
Vue.use({   <font></font>
  install(vue) { <font></font>
    vue.prototype.$broadcast = <span class="hljs-literal">null</span>;<font></font>
    vue.mixin({<font></font>
      beforeCreate() { <font></font>
        vue.prototype.$rootBroadcast = $rootBus; <span class="hljs-comment">// &lt;--</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>) {
          <span class="hljs-keyword">this</span>.$broadcast = <span class="hljs-keyword">new</span> Vue(); <font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$parent &amp;&amp; <span class="hljs-keyword">this</span>.$parent.$broadcast) { 
          <span class="hljs-keyword">this</span>.$broadcast = <span class="hljs-keyword">this</span>.$parent.$broadcast; <font></font>
        } <font></font>
      }, <font></font>
    }); <font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora precisamos da associa√ß√£o do m√≥dulo em cada componente, ent√£o vamos expandir a defini√ß√£o de modularidade como esta:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> $rootBus = <span class="hljs-keyword">new</span> Vue();<font></font>
<font></font>
Vue.use({   <font></font>
  install(vue) { <font></font>
    vue.prototype.$broadcast = <span class="hljs-literal">null</span>;<font></font>
    vue.mixin({<font></font>
      beforeCreate() { <font></font>
        vue.prototype.$rootBroadcast = $rootBus;<font></font>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>) {
          <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span> = <span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>;  <span class="hljs-comment">// &lt;--</span>
          <span class="hljs-keyword">this</span>.$broadcast = <span class="hljs-keyword">new</span> Vue(); <font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$parent &amp;&amp; <span class="hljs-keyword">this</span>.$parent.$broadcast) { 
          <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span> = <span class="hljs-keyword">this</span>.$parent.$<span class="hljs-built_in">module</span>;  <span class="hljs-comment">// &lt;--</span>
          <span class="hljs-keyword">this</span>.$broadcast = <span class="hljs-keyword">this</span>.$parent.$broadcast; <font></font>
        } <font></font>
      }, <font></font>
    }); <font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, precisamos fazer com que o evento no barramento local modular reflita da maneira que precisamos para a raiz. </font><font style="vertical-align: inherit;">Para fazer isso, primeiro precisamos criar uma interface proxy simples e colocar o pr√≥prio barramento na propriedade condicionalmente privada de $ bus:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> $rootBus = <span class="hljs-keyword">new</span> Vue();<font></font>
<font></font>
Vue.use({   <font></font>
  install(vue) { <font></font>
    vue.prototype.$broadcast = <span class="hljs-literal">null</span>;<font></font>
    vue.mixin({<font></font>
      beforeCreate() { <font></font>
        vue.prototype.$rootBroadcast = $rootBus;<font></font>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>) {
          <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span> = <span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>;
          <span class="hljs-keyword">this</span>.$broadcast = { <span class="hljs-attr">$bus</span>: <span class="hljs-keyword">new</span> Vue() };  <span class="hljs-comment">// &lt;--</span>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$parent &amp;&amp; <span class="hljs-keyword">this</span>.$parent.$broadcast) { 
          <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span> = <span class="hljs-keyword">this</span>.$parent.$<span class="hljs-built_in">module</span>;
          <span class="hljs-keyword">this</span>.$broadcast = { <span class="hljs-attr">$bus</span>: <span class="hljs-keyword">this</span>.$parent.$broadcast.$bus };  <span class="hljs-comment">// &lt;--</span><font></font>
        } <font></font>
      }, <font></font>
    }); <font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E, finalmente, adicione m√©todos de proxy ao objeto - porque agora o campo $ broadcast n√£o fornece acesso direto ao barramento:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> $rootBus = <span class="hljs-keyword">new</span> Vue();<font></font>
<font></font>
Vue.use({   <font></font>
  install(vue) { <font></font>
    vue.prototype.$broadcast = <span class="hljs-literal">null</span>;<font></font>
    vue.mixin({<font></font>
      beforeCreate() { <font></font>
        vue.prototype.$rootBroadcast = $rootBus;<font></font>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>) {
          <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span> = <span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>;
          <span class="hljs-keyword">this</span>.$broadcast = { <span class="hljs-attr">$bus</span>: <span class="hljs-keyword">new</span> Vue() };  <font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$parent &amp;&amp; <span class="hljs-keyword">this</span>.$parent.$broadcast) { 
          <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span> = <span class="hljs-keyword">this</span>.$parent.$<span class="hljs-built_in">module</span>;
          <span class="hljs-keyword">this</span>.$broadcast = { <span class="hljs-attr">$bus</span>: <span class="hljs-keyword">this</span>.$parent.$broadcast.$bus };<font></font>
        } <font></font>
        <span class="hljs-comment">// &gt;&gt;&gt;</span>
        <span class="hljs-keyword">this</span>.$broadcast.$emit = <span class="hljs-function">(<span class="hljs-params">‚Ä¶attrs</span>) =&gt;</span> {
          <span class="hljs-keyword">this</span>.$broadcast.$bus.$emit(‚Ä¶attrs);           
          <span class="hljs-keyword">const</span> [event, ‚Ä¶attributes] = attrs; 
          <span class="hljs-keyword">this</span>.$rootBroadcast.$emit(event, <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span>, ‚Ä¶attributes)); 
          <span class="hljs-keyword">this</span>.$rootBroadcast.$emit(‚Äò*‚Äô, event, <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span>, ‚Ä¶attributes)<font></font>
        };<font></font>
        <font></font>
        <span class="hljs-keyword">this</span>.$broadcast.$on = <span class="hljs-function">(<span class="hljs-params">‚Ä¶attrs</span>) =&gt;</span> {           
          <span class="hljs-keyword">this</span>.$broadcast.$bus.$on(‚Ä¶attrs);<font></font>
        };<font></font>
        <span class="hljs-comment">// &lt;&lt;&lt;</span><font></font>
      }, <font></font>
    }); <font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bem, como toque final, lembremos que obtemos acesso ao barramento fechando, o que significa que os manipuladores adicionados uma vez n√£o ser√£o limpos com o componente, mas permanecer√£o durante todo o tempo trabalhando com o aplicativo. Isso pode causar efeitos colaterais desagrad√°veis, ent√£o vamos adicionar uma fun√ß√£o de limpeza de ouvinte ao nosso barramento no final do ciclo de vida do componente:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> $rootBus = <span class="hljs-keyword">new</span> Vue();<font></font>
<font></font>
Vue.use({   <font></font>
  install(vue) { <font></font>
    vue.prototype.$broadcast = <span class="hljs-literal">null</span>;<font></font>
    vue.mixin({<font></font>
      beforeDestroy() {                               <span class="hljs-comment">// &lt;--</span>
        <span class="hljs-keyword">this</span>.$broadcast.$off(<span class="hljs-keyword">this</span>.$broadcastEvents);  <span class="hljs-comment">// &lt;--</span><font></font>
      },<font></font>
<font></font>
      beforeCreate() { <font></font>
        vue.prototype.$rootBroadcast = $rootBus;<font></font>
        <span class="hljs-keyword">this</span>.$broadcastEvents = [];  <span class="hljs-comment">// &lt;--</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>) {
          <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span> = <span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>;
          <span class="hljs-keyword">this</span>.$broadcast = { <span class="hljs-attr">$bus</span>: <span class="hljs-keyword">new</span> Vue() };  <font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$parent &amp;&amp; <span class="hljs-keyword">this</span>.$parent.$broadcast) { 
          <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span> = <span class="hljs-keyword">this</span>.$parent.$<span class="hljs-built_in">module</span>;
          <span class="hljs-keyword">this</span>.$broadcast = { <span class="hljs-attr">$bus</span>: <span class="hljs-keyword">this</span>.$parent.$broadcast.$bus };<font></font>
        } <font></font>
<font></font>
        <span class="hljs-keyword">this</span>.$broadcast.$emit = <span class="hljs-function">(<span class="hljs-params">‚Ä¶attrs</span>) =&gt;</span> {
          <span class="hljs-keyword">this</span>.$broadcastEvents.push(attrs[<span class="hljs-number">0</span>]);   <span class="hljs-comment">// &lt;--</span>
          <span class="hljs-keyword">this</span>.$broadcast.$bus.$emit(‚Ä¶attrs);           
          <span class="hljs-keyword">const</span> [event, ‚Ä¶attributes] = attrs; 
          <span class="hljs-keyword">this</span>.$rootBroadcast.$emit(event, <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span>, ‚Ä¶attributes)); 
          <span class="hljs-keyword">this</span>.$rootBroadcast.$emit(‚Äò*‚Äô, event, <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span>, ‚Ä¶attributes)<font></font>
        };<font></font>
        <font></font>
        <span class="hljs-keyword">this</span>.$broadcast.$on = <span class="hljs-function">(<span class="hljs-params">‚Ä¶attrs</span>) =&gt;</span> {           
          <span class="hljs-keyword">this</span>.$broadcast.$bus.$on(‚Ä¶attrs);<font></font>
        };<font></font>
<font></font>
        <span class="hljs-keyword">this</span>.$broadcast.$off =: <span class="hljs-function">(<span class="hljs-params">...attrs</span>) =&gt;</span> {  <span class="hljs-comment">// &lt;--</span>
          <span class="hljs-keyword">this</span>.$broadcast.$bus.$off(...attrs);   <span class="hljs-comment">// &lt;--</span><font></font>
        };<font></font>
      }, <font></font>
    }); <font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, essa op√ß√£o fornece uma funcionalidade mais interessante, embora menos concisa. </font><font style="vertical-align: inherit;">Com ele, voc√™ pode implementar um sistema completo de comunica√ß√£o alternativa entre componentes. </font><font style="vertical-align: inherit;">Al√©m disso, ele est√° completamente sob nosso controle e n√£o traz depend√™ncias externas ao nosso projeto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Espero que, depois de ler, voc√™ tenha adquirido ou atualizado seus conhecimentos sobre os plug-ins do Vue e, talvez, da pr√≥xima vez que precisar adicionar alguma funcionalidade gen√©rica ao seu aplicativo, possa implement√°-lo com mais efici√™ncia - sem adicionar depend√™ncias externas.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt488408/index.html">Gateway IoT Ethernet-RS485 STM32</a></li>
<li><a href="../pt488410/index.html">7 li√ß√µes que aprendi em dez anos em desenvolvimento</a></li>
<li><a href="../pt488412/index.html">Criando um bot do Discord com base no discord.js</a></li>
<li><a href="../pt488416/index.html">SLAE - Exame de especialista em montagem do Security Linux</a></li>
<li><a href="../pt488418/index.html">Autentica√ß√£o da API REST com Spring Security e MongoDB</a></li>
<li><a href="../pt488424/index.html">O que acontecer√° com o ITSM em 2020?</a></li>
<li><a href="../pt488426/index.html">Como fazer uma revis√£o de c√≥digo? Parte 2: revis√£o da navega√ß√£o, velocidade, coment√°rios, conflitos</a></li>
<li><a href="../pt488428/index.html">Como prever o futuro na pesquisa Yandex: de corre√ß√µes de erros a consultas de descoberta</a></li>
<li><a href="../pt488432/index.html">Snoop Project, uma ferramenta incr√≠vel para intelig√™ncia na Internet, que os usu√°rios do RuNet est√£o esperando h√° tanto tempo - est√° dispon√≠vel</a></li>
<li><a href="../pt488436/index.html">Crie rapidamente m√∫sicas de chiptune de c√≥digo aberto</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>