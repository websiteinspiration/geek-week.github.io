<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏩 👗 👩🏼‍🏫 Sematkan catatan singkat programmer: duplikasi bagian dalam memori mikrokontroler 🧙🏻 🤘🏾 🏴󠁧󠁢󠁥󠁮󠁧󠁿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kondisi awal
 Ada perangkat berbasis mikrokontroler (misalnya, stm32f405rgt6 akan diambil). Ketika dihidupkan, ia menyesuaikan periferalnya berdasarka...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Sematkan catatan singkat programmer: duplikasi bagian dalam memori mikrokontroler</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487604/"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kondisi awal</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada perangkat berbasis mikrokontroler (misalnya, stm32f405rgt6 akan diambil). </font><font style="vertical-align: inherit;">Ketika dihidupkan, ia menyesuaikan periferalnya berdasarkan preferensi pengguna atau pengaturan default. </font><font style="vertical-align: inherit;">Pengguna dapat mengubah pengaturan selama operasi perangkat (sebagai aturan, hanya selama integrasi ke dalam kompleks) melalui salah satu antarmuka yang mungkin (menu CLI atau utilitas untuk pengaturan parameter operasi yang bekerja melalui protokol biner). </font><font style="vertical-align: inherit;">Setelah mengatur parameter, pengguna menyimpan pengaturan dengan perintah khusus (juga melalui salah satu antarmuka yang mungkin).</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tugas</font></font></h2><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Untuk mengurangi waktu yang diperlukan untuk mengakses variabel pengaturan perangkat selama operasi, Anda perlu menjaga nilai saat ini dalam RAM (biasanya jumlah data tersebut bervariasi dari selusin variabel hingga 3 kilobyte tergantung pada perangkat).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hal ini diperlukan untuk menyimpan pengaturan pengguna dalam rangkap dalam flash mikrokontroler.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setiap instance pengaturan pengguna harus diakhiri dengan CRC32 segera setelah payload.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Untuk setiap instance pengaturan pengguna, halaman terpisah digunakan dalam memori flash (bahkan jika data berguna adalah 2 kb, dan halaman dibagi dengan 128 kb, maka seluruh halaman diberikan di bawah satu blok)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kode perangkat lunak mikrokontroler harus menyimpan pengaturan default, yang seharusnya menjadi blok pengaturan pengguna jika keduanya memiliki data yang rusak</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Upaya untuk dipecahkan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GCC (pada saat penulisan) tidak memiliki bendera untuk mendapatkan salinan bagian tersebut. </font><font style="vertical-align: inherit;">Menambahkan skrip LD dengan &lt;&lt; garis ajaib &gt;&gt; juga gagal. </font><font style="vertical-align: inherit;">Seseorang dapat bekerja dengan keberatan, tetapi pendekatan ini sangat implisit dan mengarah pada kesalahan halus.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Keputusan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solusinya adalah membuat salinan implisit dari entitas yang diinginkan (variabel, struktur, array, dll.) Dalam kode pengguna, diikuti dengan lokasinya di memori.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Membuat makro untuk penyalinan tersembunyi struktur</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita buat makro dengan mana kita akan memesan tempat untuk struktur dalam RAM, 2 contoh flash-memory pada halaman terpisah dan dalam kode pengguna (untuk nilai awal).</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> USER_CFG_DATA_STRUCT(TYPE,NAME,...) \
    __attribute__((aligned(4), section (<span class="hljs-meta-string">".user_cfg_data_ram_page"</span>))) \
    TYPE NAME = __VA_ARGS__; \
    __attribute__((aligned(4), section (<span class="hljs-meta-string">".user_cfg_data_flash_default_page"</span>))) \
    TYPE flash_default_page_##NAME = __VA_ARGS__; \
    __attribute__((aligned(4), section (<span class="hljs-meta-string">".user_cfg_data_flash_page_1"</span>))) \
    TYPE flash_page_1_##NAME = __VA_ARGS__; \
    __attribute__((aligned(4), section (<span class="hljs-meta-string">".user_cfg_data_flash_page_2"</span>))) \
    TYPE flash_page_2_##NAME = __VA_ARGS__;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menggunakan makro, 4 instance dari struktur dengan nama yang berbeda akan dibuat. </font><font style="vertical-align: inherit;">Dalam kode proyek (dengan pengecualian sistem untuk bekerja dengan halaman memori pengaturan pengguna), semua modul harus menggunakan struktur tanpa awalan (nama yang ditentukan dalam makro) yang akan di RAM (akan mungkin untuk mengubah modul yang bertanggung jawab untuk interaksi pengguna. Sisanya hanya boleh baca dari itu). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Contoh menggunakan makro dalam kode pengguna:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">test_st</span> {</span>
    <span class="hljs-keyword">uint32_t</span> a1;
    <span class="hljs-keyword">uint32_t</span> a2;<font></font>
} <span class="hljs-keyword">test_st_t</span>;<font></font>
<font></font>
USER_CFG_DATA_STRUCT(<span class="hljs-keyword">test_st_t</span>, name_st, {<font></font>
    .a1 = <span class="hljs-number">1</span>,<font></font>
    .a2 = <span class="hljs-number">2</span>
})</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah contoh struktur name_st tersedia dari kode proyek.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Membuat makro untuk penyalinan tersembunyi dari entitas lain</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk membuat variabel, Anda hanya perlu melakukan substitusi makro untuk membuat struktur. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk array, tambahkan jumlah elemen.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> USER_CFG_DATA_VAR USER_CFG_DATA_STRCUT</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> USER_CFG_DATA_ARRAY(TYPE,NAME,SIZE,...) \
    __attribute__((aligned(4), section (<span class="hljs-meta-string">".user_cfg_data_ram_page"</span>))) \
    TYPE NAME[SIZE] = __VA_ARGS__; \
    __attribute__((aligned(4), section (<span class="hljs-meta-string">".user_cfg_data_flash_default_page"</span>))) \
    TYPE flash_default_page_##NAME[SIZE] = __VA_ARGS__; \
    __attribute__((aligned(4), section (<span class="hljs-meta-string">".user_cfg_data_flash_page_1"</span>))) \
    TYPE flash_page_1_##NAME[SIZE] = __VA_ARGS__; \
    __attribute__((aligned(4), section (<span class="hljs-meta-string">".user_cfg_data_flash_page_2"</span>))) \
    TYPE flash_page_2_##NAME[SIZE] = __VA_ARGS__;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prinsip penggunaannya mirip dengan penggunaan struktur.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finalisasi skrip LD</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat membuat salinan entitas, ditunjukkan di bagian mana mereka berada. </font><font style="vertical-align: inherit;">Sekarang Anda harus membuat bagian ini dalam skrip LD. </font><font style="vertical-align: inherit;">Untuk F4, skrip LD yang diperbesar dari ST akan terlihat seperti ini:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Skrip LD</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs">MEMORY<font></font>
{<font></font>
    FLASH (rx) : ORIGIN = <span class="hljs-number">0x08000000</span>, LENGTH = <span class="hljs-number">1024</span>K - <span class="hljs-number">256</span>K <span class="hljs-comment">/* 256   user_cfg */</span>
   USER_CFG_PAGE_1 (rx) : ORIGIN = <span class="hljs-number">0x080C0000</span>, LENGTH = <span class="hljs-number">128</span>K - <span class="hljs-number">4</span>     <span class="hljs-comment">/* 4  CRC32 */</span>
    USER_CFG_PAGE_2 (rx) : ORIGIN = <span class="hljs-number">0x080E0000</span>, LENGTH = <span class="hljs-number">128</span>K - <span class="hljs-number">4</span>     <span class="hljs-comment">/* 4  CRC32 */</span>
    CCM (xrw) : ORIGIN = <span class="hljs-number">0x10000000</span>, LENGTH = <span class="hljs-number">64</span>K<font></font>
    RAM (xrw) : ORIGIN = <span class="hljs-number">0x20000000</span>, LENGTH = <span class="hljs-number">128</span>K<font></font>
}<font></font>
</code></pre><br>
<pre><code class="cpp hljs"><span class="hljs-comment">/*       CRC32.
       .      - . */</span>
user_cfg_data_flash_page_1_size = LENGTH(user_cfg_PAGE_1) + <span class="hljs-number">4</span>;<font></font>
user_cfg_data_flash_page_2_size = LENGTH(user_cfg_PAGE_2) + <span class="hljs-number">4</span>;<font></font>
user_cfg_data_flash_page_size = user_cfg_data_flash_page_1_size;<font></font>
<font></font>
<span class="hljs-comment">/*
 * The '__stack' definition is required by crt0, do not remove it.
 */</span><font></font>
__stack = ORIGIN(RAM) + LENGTH(RAM);<font></font>
<font></font>
_estack = __stack;     <span class="hljs-comment">/* STM specific definition */</span><font></font>
<font></font>
<span class="hljs-comment">/*
 * Default stack sizes.
 * These are used by the startup in order to allocate stacks
 * for the different modes.
 */</span><font></font>
<font></font>
__Main_Stack_Size = <span class="hljs-number">1024</span> ;<font></font>
<font></font>
PROVIDE ( _Main_Stack_Size = __Main_Stack_Size ) ;<font></font>
<font></font>
__Main_Stack_Limit = __stack  - __Main_Stack_Size ;<font></font>
<font></font>
<span class="hljs-comment">/*"PROVIDE" allows to easily override these values from an object file or the command line. */</span><font></font>
PROVIDE ( _Main_Stack_Limit = __Main_Stack_Limit ) ;<font></font>
<font></font>
<span class="hljs-comment">/*
 * There will be a link error if there is not this amount of
 * RAM free at the end.
 */</span>
_Minimum_Stack_Size = <span class="hljs-number">512</span> ;<font></font>
<font></font>
<span class="hljs-comment">/*
 * Default heap definitions.
 * The heap start immediately after the last statically allocated
 * .sbss/.noinit section, and extends up to the main stack limit.
 */</span><font></font>
PROVIDE ( _Heap_Begin = _end_noinit ) ;<font></font>
PROVIDE ( _Heap_Limit = __stack - __Main_Stack_Size ) ;<font></font>
<font></font>
SECTIONS<font></font>
{<font></font>
    .isr_vector :<font></font>
    {<font></font>
        KEEP(*(.isr_vector))         <span class="hljs-comment">/* Interrupt vectors */</span>
        KEEP(*(.cfmconfig))            <span class="hljs-comment">/* Freescale configuration words */</span>
        *(.after_vectors .after_vectors.*)    <span class="hljs-comment">/* Startup code and ISR */</span>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
    } &gt;FLASH<font></font>
<font></font>
    .inits :<font></font>
    {<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
<font></font>
        <span class="hljs-comment">/*
         * These are the old initialisation sections, intended to contain
         * naked code, with the prologue/epilogue added by crti.o/crtn.o
         * when linking with startup files. The standalone startup code
         * currently does not run these, better use the init arrays below.
         */</span><font></font>
        KEEP(*(.init))<font></font>
        KEEP(*(.fini))<font></font>
<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
<font></font>
        <span class="hljs-comment">/*
         * The preinit code, i.e. an array of pointers to initialisation
         * functions to be performed before constructors.
         */</span><font></font>
        PROVIDE_HIDDEN (__preinit_array_start = .);<font></font>
<font></font>
        <span class="hljs-comment">/*
         * Used to run the SystemInit() before anything else.
         */</span><font></font>
        KEEP(*(.preinit_array_sysinit .preinit_array_sysinit.*))<font></font>
<font></font>
        <span class="hljs-comment">/*
         * Used for other platform inits.
         */</span><font></font>
        KEEP(*(.preinit_array_platform .preinit_array_platform.*))<font></font>
<font></font>
        <span class="hljs-comment">/*
         * The application inits. If you need to enforce some order in
         * execution, create new sections, as before.
         */</span><font></font>
        KEEP(*(.preinit_array .preinit_array.*))<font></font>
<font></font>
        PROVIDE_HIDDEN (__preinit_array_end = .);<font></font>
<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
<font></font>
        <span class="hljs-comment">/*
         * The init code, i.e. an array of pointers to static constructors.
         */</span><font></font>
        PROVIDE_HIDDEN (__init_array_start = .);<font></font>
        KEEP(*(SORT(.init_array.*)))<font></font>
        KEEP(*(.init_array))<font></font>
        PROVIDE_HIDDEN (__init_array_end = .);<font></font>
<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
<font></font>
        <span class="hljs-comment">/*
         * The fini code, i.e. an array of pointers to static destructors.
         */</span><font></font>
        PROVIDE_HIDDEN (__fini_array_start = .);<font></font>
        KEEP(*(SORT(.fini_array.*)))<font></font>
        KEEP(*(.fini_array))<font></font>
        PROVIDE_HIDDEN (__fini_array_end = .);<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
<font></font>
    } &gt;FLASH<font></font>
<font></font>
    <span class="hljs-comment">/*
     * For some STRx devices, the beginning of the startup code
     * is stored in the .flashtext section, which goes to FLASH.
     */</span><font></font>
    .flashtext :<font></font>
    {<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
        *(.flashtext .flashtext.*)    <span class="hljs-comment">/* Startup code */</span>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
    } &gt;FLASH<font></font>
<font></font>
<font></font>
    <span class="hljs-comment">/*
     * The program code is stored in the .text section,
     * which goes to FLASH.
     */</span><font></font>
    .text :<font></font>
    {<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
<font></font>
        *(.text .text.*)            <span class="hljs-comment">/* all remaining code */</span><font></font>
<font></font>
        *(.rodata .rodata.*)         <span class="hljs-comment">/* read-only data (constants) */</span><font></font>
<font></font>
        *(vtable)                    <span class="hljs-comment">/* C++ virtual tables */</span><font></font>
<font></font>
        KEEP(*(.eh_frame*))<font></font>
<font></font>
        <span class="hljs-comment">/*
         * Stub sections generated by the linker, to glue together
         * ARM and Thumb code. .glue_7 is used for ARM code calling
         * Thumb code, and .glue_7t is used for Thumb code calling
         * ARM code. Apparently always generated by the linker, for some
         * architectures, so better leave them here.
         */</span><font></font>
        *(.glue_7)<font></font>
        *(.glue_7t)<font></font>
    } &gt;FLASH<font></font>
<font></font>
    .user_cfg_data_flash_default_page :<font></font>
    {<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
        user_cfg_data_flash_default_page_start = .;<font></font>
        KEEP(*(.user_cfg_data_flash_default_page .user_cfg_data_flash_default_page.*))<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
        user_cfg_data_flash_default_page_stop = .;<font></font>
    } &gt;FLASH<font></font>
<font></font>
    <span class="hljs-comment">/* ARM magic sections */</span><font></font>
    .ARM.extab :<font></font>
       {<font></font>
       *(.ARM.extab* .gnu.linkonce.armextab.*)<font></font>
       } &gt; FLASH<font></font>
<font></font>
       __exidx_start = .;<font></font>
       .ARM.exidx :<font></font>
       {<font></font>
       *(.ARM.exidx* .gnu.linkonce.armexidx.*)<font></font>
       } &gt; FLASH<font></font>
       __exidx_end = .;<font></font>
<font></font>
    . = ALIGN(<span class="hljs-number">4</span>);<font></font>
    _etext = .;<font></font>
    __etext = .;<font></font>
<font></font>
    <span class="hljs-comment">/*
     * This address is used by the startup code to
     * initialise the .data section.
     */</span><font></font>
    _sidata = _etext;<font></font>
<font></font>
    <span class="hljs-comment">/* MEMORY_ARRAY */</span>
    <span class="hljs-comment">/*
    .ROarraySection :
    {
         *(.ROarraySection .ROarraySection.*)
    } &gt;MEMORY_ARRAY
    */</span><font></font>
<font></font>
    <span class="hljs-comment">/*
     * The initialised data section.
     * The program executes knowing that the data is in the RAM
     * but the loader puts the initial values in the FLASH (inidata).
     * It is one task of the startup to copy the initial values from
     * FLASH to RAM.
     */</span><font></font>
    .data  : AT ( _sidata )<font></font>
    {<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
<font></font>
        <span class="hljs-comment">/* This is used by the startup code to initialise the .data section */</span>
        _sdata = . ;            <span class="hljs-comment">/* STM specific definition */</span><font></font>
        __data_start__ = . ;<font></font>
        *(.data_begin .data_begin.*)<font></font>
<font></font>
        *(.data .data.*)<font></font>
<font></font>
        *(.data_end .data_end.*)<font></font>
<font></font>
        *(.ramfunc*)<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
<font></font>
        <span class="hljs-comment">/* This is used by the startup code to initialise the .data section */</span>
        _edata = . ;            <span class="hljs-comment">/* STM specific definition */</span><font></font>
        __data_end__ = . ;<font></font>
<font></font>
    } &gt;RAM<font></font>
<font></font>
<font></font>
    <span class="hljs-comment">/*
     * The uninitialised data section. NOLOAD is used to avoid
     * the "section `.bss' type changed to PROGBITS" warning
     */</span><font></font>
    .bss (NOLOAD) :<font></font>
    {<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
        __bss_start__ = .;         <span class="hljs-comment">/* standard newlib definition */</span>
        _sbss = .;              <span class="hljs-comment">/* STM specific definition */</span><font></font>
        *(.bss_begin .bss_begin.*)<font></font>
<font></font>
        *(.bss .bss.*)<font></font>
        *(COMMON)<font></font>
<font></font>
        *(.bss_end .bss_end.*)<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
        __bss_end__ = .;        <span class="hljs-comment">/* standard newlib definition */</span>
        _ebss = . ;             <span class="hljs-comment">/* STM specific definition */</span><font></font>
    } &gt;RAM<font></font>
<font></font>
    .user_cfg_data_ram_page :<font></font>
    {<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
        user_cfg_data_ram_page_start = .;<font></font>
        KEEP(*(.user_cfg_data_ram_page .user_cfg_data_ram_page.*))<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
        user_cfg_data_ram_page_stop = .;<font></font>
    } &gt; CCM<font></font>
<font></font>
    user_cfg_data_ram_page_size = user_cfg_data_ram_page_stop - user_cfg_data_ram_page_start;<font></font>
<font></font>
    .user_cfg_data_page_1 :<font></font>
    {<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
        user_cfg_data_flash_page_1_start = .;<font></font>
         KEEP(*(.user_cfg_data_flash_page_1 .user_cfg_data_flash_page_1.*))<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
        user_cfg_data_flash_page_1_stop = .;<font></font>
    } &gt; user_cfg_PAGE_1<font></font>
<font></font>
    .user_cfg_data_page_2 :<font></font>
    {<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
        user_cfg_data_flash_page_2_start = .;<font></font>
         KEEP(*(.user_cfg_data_flash_page_2 .user_cfg_data_flash_page_2.*))<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
        user_cfg_data_flash_page_2_stop = .;<font></font>
    } &gt; user_cfg_PAGE_2<font></font>
<font></font>
    .noinit (NOLOAD) :<font></font>
    {<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
        _noinit = .;<font></font>
<font></font>
        *(.noinit .noinit.*)<font></font>
<font></font>
         . = ALIGN(<span class="hljs-number">4</span>) ;<font></font>
        _end_noinit = .;<font></font>
    } &gt; RAM<font></font>
<font></font>
    <span class="hljs-comment">/* Mandatory to be word aligned, _sbrk assumes this */</span>
    PROVIDE ( end = _end_noinit ); <span class="hljs-comment">/* was _ebss */</span><font></font>
    PROVIDE ( _end = _end_noinit );<font></font>
    PROVIDE ( __end = _end_noinit );<font></font>
    PROVIDE ( __end__ = _end_noinit );<font></font>
<font></font>
    <span class="hljs-comment">/*
     * Used for validation only, do not allocate anything here!
     *
     * This is just to check that there is enough RAM left for the Main
     * stack. It should generate an error if it's full.
     */</span><font></font>
    ._check_stack :<font></font>
    {<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
        . = . + _Minimum_Stack_Size ;<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
    } &gt;RAM<font></font>
<font></font>
<font></font>
    <span class="hljs-comment">/* After that there are only debugging sections. */</span><font></font>
<font></font>
    <span class="hljs-comment">/* This can remove the debugging information from the standard libraries */</span>
    <span class="hljs-comment">/*
    DISCARD :
    {
     libc.a ( * )
     libm.a ( * )
     libgcc.a ( * )
     }
     */</span><font></font>
<font></font>
    <span class="hljs-comment">/* Stabs debugging sections.  */</span>
    .stab          <span class="hljs-number">0</span> : { *(.stab) }<font></font>
    .stabstr       <span class="hljs-number">0</span> : { *(.stabstr) }<font></font>
    .stab.excl     <span class="hljs-number">0</span> : { *(.stab.excl) }<font></font>
    .stab.exclstr  <span class="hljs-number">0</span> : { *(.stab.exclstr) }<font></font>
    .stab.index    <span class="hljs-number">0</span> : { *(.stab.index) }<font></font>
    .stab.indexstr <span class="hljs-number">0</span> : { *(.stab.indexstr) }<font></font>
    .comment       <span class="hljs-number">0</span> : { *(.comment) }
    <span class="hljs-comment">/*
     * DWARF debug sections.
     * Symbols in the DWARF debugging sections are relative to the beginning
     * of the section so we begin them at 0.
     */</span>
    <span class="hljs-comment">/* DWARF 1 */</span>
    .debug          <span class="hljs-number">0</span> : { *(.debug) }<font></font>
    .line           <span class="hljs-number">0</span> : { *(.line) }
    <span class="hljs-comment">/* GNU DWARF 1 extensions */</span>
    .debug_srcinfo  <span class="hljs-number">0</span> : { *(.debug_srcinfo) }<font></font>
    .debug_sfnames  <span class="hljs-number">0</span> : { *(.debug_sfnames) }
    <span class="hljs-comment">/* DWARF 1.1 and DWARF 2 */</span>
    .debug_aranges  <span class="hljs-number">0</span> : { *(.debug_aranges) }<font></font>
    .debug_pubnames <span class="hljs-number">0</span> : { *(.debug_pubnames) }
    <span class="hljs-comment">/* DWARF 2 */</span>
    .debug_info     <span class="hljs-number">0</span> : { *(.debug_info .gnu.linkonce.wi.*) }<font></font>
    .debug_abbrev   <span class="hljs-number">0</span> : { *(.debug_abbrev) }<font></font>
    .debug_line     <span class="hljs-number">0</span> : { *(.debug_line) }<font></font>
    .debug_frame    <span class="hljs-number">0</span> : { *(.debug_frame) }<font></font>
    .debug_str      <span class="hljs-number">0</span> : { *(.debug_str) }<font></font>
    .debug_loc      <span class="hljs-number">0</span> : { *(.debug_loc) }<font></font>
    .debug_macinfo  <span class="hljs-number">0</span> : { *(.debug_macinfo) }
    <span class="hljs-comment">/* SGI/MIPS DWARF 2 extensions */</span>
    .debug_weaknames <span class="hljs-number">0</span> : { *(.debug_weaknames) }<font></font>
    .debug_funcnames <span class="hljs-number">0</span> : { *(.debug_funcnames) }<font></font>
    .debug_typenames <span class="hljs-number">0</span> : { *(.debug_typenames) }<font></font>
    .debug_varnames  <span class="hljs-number">0</span> : { *(.debug_varnames) }<font></font>
}<font></font>
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam contoh ini, struktur konfigurasi tidak terletak di area RAM, tetapi di CCMRAM, untuk meningkatkan kinerja. </font><font style="vertical-align: inherit;">Saya juga mencatat bahwa blok data pengaturan pengguna adalah 2 halaman flash terakhir, yang masing-masing adalah 128 kb.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inisialisasi dan kontrol salinan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perawatan apa yang akan terletak pada RAM terletak pada programmer. Sebelum menggunakan data dari area ini untuk pertama kalinya, Anda perlu menginisialisasi area. Dalam sekejap, saat memuat program ke dalam mikrokontroler, data akan direkam sebelumnya dengan nilai awal yang ditentukan dalam kode program. Ini akan membuat salinan yang tidak valid dari blok pengaturan pengguna di halaman terpisah jika mereka berakhir dengan CRC32 (karena tidak ada perhitungan CRC32 dilakukan. Kode Anda dapat melakukan ini. Juga sampai penggunaan pertama parameter konfigurasi). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menulis modul agar dapat bekerja dengan blok konfigurasi, Anda harus menggunakan variabel dari skrip LD. Berikut ini akan diperlukan:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">extern</span> <span class="hljs-keyword">uint32_t</span> user_cfg_data_flash_default_page_start;
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">uint32_t</span> user_cfg_data_flash_page_1_start;
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">uint32_t</span> user_cfg_data_flash_page_2_start;
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">uint32_t</span> user_cfg_data_ram_page_start;<font></font>
<font></font>
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">uint32_t</span> user_cfg_data_flash_page_size;
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">uint32_t</span> user_cfg_data_ram_page_size;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Juga, jangan lupa bahwa </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">user_cfg_data_flash_page_size</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">user_cfg_data_ram_page_size</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dapat ditetapkan sebagai nilai normal. </font><font style="vertical-align: inherit;">Tetapi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">user_cfg_data_flash_page_1_start</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan variabel lain yang menyimpan alamat harus ditentukan melalui &amp;.</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id487584/index.html">Githabification Keamanan Informasi</a></li>
<li><a href="../id487588/index.html">Quarkus: Dokter hewan subatomik supersonik</a></li>
<li><a href="../id487592/index.html">VMware vSAN 6.7 - Dan guntur melanda</a></li>
<li><a href="../id487594/index.html">Menghibur mnemonik: kami mengumpulkan memori pendengaran dari visual</a></li>
<li><a href="../id487596/index.html">Eugene Varavva, seorang pengembang di Google. Cara menjelaskan Google dalam 5 kata</a></li>
<li><a href="../id487606/index.html">Visualisasi garis-garis ketegangan dan gerakan muatan elektrostatik, simulasi gerakan planet tata surya</a></li>
<li><a href="../id487610/index.html">RealWorld: aiohttp, Tortoise ORM</a></li>
<li><a href="../id487612/index.html">Menambahkan, menghapus, dan mengganti nama file serta tujuan dengan mudah dalam proyek-proyek CMake</a></li>
<li><a href="../id487616/index.html">Membuat item khusus menggunakan tabel contoh di C # untuk Windows Form</a></li>
<li><a href="../id487620/index.html">Pemecahan masalah dengan pwnable.kr 27 - tiny_easy. Memahami Stack Spraying</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>