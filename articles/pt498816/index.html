<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§±üèª üõ¥ ‚è¨ A verdade, antes de tudo, ou por que o sistema precisa ser projetado com base no dispositivo de banco de dados üßëüèø‚Äçü§ù‚Äçüßëüèæ üêù ü§∞üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° Habr! 
 
 Continuamos a explorar o t√≥pico Java e Spring , inclusive no n√≠vel do banco de dados. Hoje, sugerimos a leitura sobre por que, ao projet...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>A verdade, antes de tudo, ou por que o sistema precisa ser projetado com base no dispositivo de banco de dados</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/498816/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ol√° Habr! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Continuamos a explorar o t√≥pico </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , inclusive no n√≠vel do banco de dados. Hoje, sugerimos a leitura sobre por que, ao projetar aplicativos grandes, √© a estrutura do banco de dados, e n√£o o c√≥digo Java, que deve ter um significado decisivo sobre como isso √© feito e quais s√£o as exce√ß√µes a essa regra.</font></font><br>
<a name="habracut"></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neste artigo bastante tardio, explicarei por que acredito que em quase todos os casos o modelo de dados no aplicativo deve ser projetado "com base no banco de dados" e n√£o "com base nos recursos do Java" (ou em outra linguagem cliente com a qual voc√™ trabalha). </font><font style="vertical-align: inherit;">Escolhendo a segunda abordagem, voc√™ embarca em uma longa jornada de dor e sofrimento assim que seu projeto come√ßa a crescer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este artigo √© baseado em </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uma pergunta</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> feita no Stack Overflow. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Discuss√µes interessantes sobre o reddit nas se√ß√µes </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ r / java</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ r / programa√ß√£o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gera√ß√£o de c√≥digo</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estou surpreso por haver uma camada t√£o pequena de usu√°rios que, depois de se familiarizar com o jOOQ, ficam indignados com o fato de que, ao trabalhar com o jOOQ, depende seriamente da gera√ß√£o do c√≥digo-fonte. Ningu√©m te incomoda em usar o jOOQ como achar melhor e n√£o o for√ßa a usar a gera√ß√£o de c√≥digo. Por√©m, por padr√£o (como descrito no manual), trabalhar com o jOOQ acontece da seguinte maneira: voc√™ come√ßa com o esquema do banco de dados (herdado), realiza a engenharia reversa com o gerador de c√≥digo do jOOQ, para obter um conjunto de classes representando suas tabelas e, em seguida, escreva consultas de tipo seguro para estas tabelas:</font></font><br>
<br>
<pre><code class="java hljs">	<span class="hljs-keyword">for</span> (Record2&lt;String, String&gt; record : DSL.using(configuration)
<span class="hljs-comment">//   ^^^^^^^^^^^^^^^^^^^^^^^      </span>
<span class="hljs-comment">//     ,    </span>
<span class="hljs-comment">//   SELECT </span><font></font>
 <font></font>
       .select(ACTOR.FIRST_NAME, ACTOR.LAST_NAME)<font></font>
<span class="hljs-comment">//           vvvvv ^^^^^^^^^^^^  ^^^^^^^^^^^^^^^  </span><font></font>
       .from(ACTOR)<font></font>
       .orderBy(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)) {
    <span class="hljs-comment">// ...</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O c√≥digo √© gerado manualmente fora da montagem ou manualmente com cada montagem. </font><font style="vertical-align: inherit;">Por exemplo, essa regenera√ß√£o pode ocorrer imediatamente ap√≥s a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">migra√ß√£o do banco de dados Flyway, o que tamb√©m pode ser feito manual ou automaticamente</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gera√ß√£o de c√≥digo fonte</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V√°rias filosofias, vantagens e desvantagens est√£o associadas a essas abordagens √† gera√ß√£o de c√≥digo - manual e autom√°tica - que n√£o vou discutir em detalhes neste artigo. Mas, em geral, o ponto principal do c√≥digo gerado √© que ele nos permite reproduzir em Java a "verdade" que damos como certa, tanto dentro do nosso sistema quanto fora dele. Em certo sentido, os compiladores que geram c√≥digo de c√≥digo, m√°quina ou algum outro tipo de c√≥digo baseado na fonte fazem a mesma coisa - obtemos uma representa√ß√£o da nossa "verdade" em outro idioma, independentemente de raz√µes espec√≠ficas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem muitos desses geradores de c√≥digo. Por exemplo, o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XJC pode gerar c√≥digo Java com base em arquivos XSD ou WSDL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . O princ√≠pio √© sempre o mesmo:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Existe alguma verdade (interna ou externa) - por exemplo, especifica√ß√£o, modelo de dados, etc.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Precisamos de uma representa√ß√£o local dessa verdade em nossa linguagem de programa√ß√£o.</font></font></li>
</ul> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, a gera√ß√£o dessa representa√ß√£o √© quase sempre aconselh√°vel - para evitar redund√¢ncia.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Provedores de Tipo e Processamento de Anota√ß√µes</font></font></h4> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota: outra abordagem mais moderna e espec√≠fica √† gera√ß√£o de c√≥digo para o jOOQ est√° associada ao uso de provedores de tipo, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na forma em que eles s√£o implementados em F #</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Nesse caso, o c√≥digo √© gerado pelo compilador, na verdade no est√°gio de compila√ß√£o. </font><font style="vertical-align: inherit;">Na forma de fontes, esse c√≥digo, em princ√≠pio, n√£o existe. </font><font style="vertical-align: inherit;">Existem ferramentas semelhantes, embora menos elegantes, em Java - s√£o processadores de anota√ß√£o como o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lombok</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em certo sentido, as mesmas coisas acontecem aqui como no primeiro caso, com exce√ß√£o de:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ n√£o v√™ o c√≥digo gerado (talvez essa situa√ß√£o pare√ßa a algu√©m n√£o t√£o repulsivo?)</font></font></li>
<li>  ,    ,  , ¬´¬ª    .     Lombok,   ‚Äú‚Äù.      ,        .</li>
</ul><br>
<h4>     ?</h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m da quest√£o complicada de como √© melhor iniciar a gera√ß√£o de c√≥digo - manual ou automaticamente, √© necess√°rio mencionar que existem pessoas que acreditam que a gera√ß√£o de c√≥digo n√£o √© necess√°ria. A justificativa para esse ponto de vista, com o qual me deparei com mais frequ√™ncia, √© que fica dif√≠cil configurar o pipeline de montagem. Sim, muito dif√≠cil. Existem custos de infraestrutura adicionais. Se voc√™ est√° apenas come√ßando a trabalhar com um determinado produto (seja jOOQ, JAXB, Hibernate etc.), leva tempo para configurar o ambiente de trabalho que voc√™ gostaria de gastar aprendendo a API e, em seguida, extrair valor dela.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se a sobrecarga associada √† compreens√£o do dispositivo do gerador for muito grande, a API realmente trabalhou um pouco na usabilidade do gerador de c√≥digo (e, no futuro, a configura√ß√£o do usu√°rio √© complicada). A facilidade de uso deve ser a maior prioridade para qualquer API. Mas este √© apenas um argumento contra a gera√ß√£o de c√≥digo. De resto, √© completamente manual escrever uma representa√ß√£o local da verdade interna ou externa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muitos dir√£o que n√£o t√™m tempo para fazer tudo isso. Eles t√™m prazos para seu super produto. Algum tempo depois, pentearemos os transportadores de montagem, chegar√° a tempo. Eu vou respond√™-las: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sd/ah/5v/sdah5v4nuslp0dylmjlrvcu0qfu.png"><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Original</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alan O'Rourke, Audience Stack </font></font></a> <br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas no Hibernate / JPA, √© t√£o simples escrever c√≥digo "para Java".</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Realmente. </font><font style="vertical-align: inherit;">Para o Hibernate e seus usu√°rios, isso √© uma b√™n√ß√£o e uma maldi√ß√£o. </font><font style="vertical-align: inherit;">No Hibernate, voc√™ pode simplesmente escrever algumas entidades, assim:</font></font><br>
<br>
<pre><code class="java hljs">	<span class="hljs-meta">@Entity</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> </span>{
  <span class="hljs-meta">@Id</span>
  <span class="hljs-keyword">int</span> id;<font></font>
  String title;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E quase tudo est√° pronto. </font><font style="vertical-align: inherit;">Agora, o destino do Hibernate √© gerar "detalhes" complexos de exatamente como essa entidade ser√° definida no DDL do seu "dialeto" SQL:</font></font><br>
<br>
<pre><code class="sql hljs">	<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> book (
  <span class="hljs-keyword">id</span> <span class="hljs-built_in">INTEGER</span> PRIMARY <span class="hljs-keyword">KEY</span> <span class="hljs-keyword">GENERATED</span> <span class="hljs-keyword">ALWAYS</span> <span class="hljs-keyword">AS</span> <span class="hljs-keyword">IDENTITY</span>,<font></font>
  title <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">50</span>),<font></font>
 <font></font>
  <span class="hljs-keyword">CONSTRAINT</span> pk_book PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-keyword">id</span>)<font></font>
);<font></font>
 <font></font>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> i_book_title <span class="hljs-keyword">ON</span> book (title);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... e come√ßamos a direcionar o aplicativo. </font><font style="vertical-align: inherit;">Uma oportunidade muito legal de come√ßar rapidamente e experimentar coisas diferentes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, permita. </font><font style="vertical-align: inherit;">Eu estava enganando.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O Hibernate realmente aplica a defini√ß√£o dessa chave prim√°ria nomeada?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O Hibernate criar√° um √≠ndice em TITLE? </font><font style="vertical-align: inherit;">"Tenho certeza de que precisaremos dele."</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O Hibernate exatamente identifica essa chave na Especifica√ß√£o de identidade?</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Provavelmente n√£o. </font><font style="vertical-align: inherit;">Se voc√™ estiver desenvolvendo seu projeto do zero, √© sempre conveniente simplesmente excluir o banco de dados antigo e gerar um novo assim que voc√™ adicionar as anota√ß√µes necess√°rias. </font><font style="vertical-align: inherit;">Portanto, a entidade Livro eventualmente assumir√° a forma:</font></font><br>
<br>
<pre><code class="java hljs">	<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "book", indexes = {
  @Index(name = "i_book_title", columnList = "title")
})</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> </span>{
  <span class="hljs-meta">@Id</span>
  <span class="hljs-meta">@GeneratedValue(strategy = IDENTITY)</span>
  <span class="hljs-keyword">int</span> id;<font></font>
  String title;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Legal. </font><font style="vertical-align: inherit;">Regenerado. </font><font style="vertical-align: inherit;">Novamente, neste caso, no in√≠cio, ser√° muito f√°cil.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas ent√£o voc√™ tem que pagar por isso</font></font></h4> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cedo ou tarde, voc√™ precisa entrar em produ√ß√£o. Nesse momento, esse modelo deixar√° de funcionar. Porque: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
na produ√ß√£o, n√£o ser√° mais poss√≠vel, se necess√°rio, descartar o banco de dados antigo e come√ßar tudo do zero. Seu banco de dados se tornar√° um legado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A partir de agora, voc√™ precisar√° escrever </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">scripts de migra√ß√£o DDL, por exemplo, usando o Flyway</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . E o que acontece ent√£o com suas entidades? Voc√™ pode adapt√°-los manualmente (e, assim, dobrar sua carga de trabalho) ou pode pedir ao Hibernate para regener√°-los para voc√™ (qu√£o grandes s√£o as chances de que o gerado dessa maneira atenda √†s suas expectativas?) Voc√™ perde assim mesmo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim, assim que voc√™ entrar em produ√ß√£o, precisar√° de patches quentes. </font><font style="vertical-align: inherit;">E eles precisam ser colocados em produ√ß√£o muito rapidamente. </font><font style="vertical-align: inherit;">Como voc√™ n√£o preparou e organizou uma transmiss√£o suave de suas migra√ß√µes para produ√ß√£o, voc√™ est√° corrigindo tudo de maneira descontrolada. </font><font style="vertical-align: inherit;">E ent√£o voc√™ n√£o tem tempo para fazer tudo certo. </font><font style="vertical-align: inherit;">E repreenda o Hibernate, porque qualquer um √© sempre o culpado, mas n√£o voc√™ ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em vez disso, desde o in√≠cio, tudo poderia ser feito de uma maneira completamente diferente. </font><font style="vertical-align: inherit;">Por exemplo, coloque rodas redondas em uma bicicleta.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primeiro banco de dados</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A verdadeira "verdade" no esquema do seu banco de dados e a "soberania" sobre ele est√£o dentro do banco de dados. </font><font style="vertical-align: inherit;">Um esquema √© definido apenas no pr√≥prio banco de dados e em nenhum outro lugar, e cada cliente possui uma c√≥pia desse esquema; portanto, √© totalmente aconselh√°vel impor a conformidade com o esquema e sua integridade, para faz√™-lo diretamente no banco de dados - onde as informa√ß√µes s√£o armazenadas. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta √© uma velha sabedoria desgastada mesmo. </font><font style="vertical-align: inherit;">Chaves prim√°rias e exclusivas s√£o boas. </font><font style="vertical-align: inherit;">Chaves estrangeiras s√£o boas. </font><font style="vertical-align: inherit;">Verificar restri√ß√µes √© bom. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Declara√ß√µes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> s√£o boas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, isso n√£o √© tudo. </font><font style="vertical-align: inherit;">Por exemplo, usando o Oracle, voc√™ provavelmente deseja especificar:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em que espa√ßo de tabela est√° sua tabela? </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qual √© o seu valor PCTFREE? </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qual √© o tamanho do cache na sua sequ√™ncia (atr√°s do identificador)</font></font></li>
</ul> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Talvez tudo isso n√£o seja importante em pequenos sistemas, mas n√£o √© necess√°rio aguardar a transi√ß√£o para a √°rea de "big data" - √© poss√≠vel e muito mais cedo come√ßar a se beneficiar da otimiza√ß√£o do armazenamento de dados fornecido pelo fornecedor, como os mencionados acima. </font><font style="vertical-align: inherit;">Nenhum dos ORMs que eu vi (incluindo o jOOQ) fornece acesso ao conjunto completo de op√ß√µes de DDL que voc√™ pode querer usar no seu banco de dados. </font><font style="vertical-align: inherit;">Os ORMs oferecem algumas ferramentas que ajudam a escrever DDL. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas, no final, um circuito bem projetado √© escrito manualmente em DDL. </font><font style="vertical-align: inherit;">Qualquer DDL gerada √© apenas uma aproxima√ß√£o dela.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E o modelo do cliente?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como mencionado acima, no cliente voc√™ precisar√° de uma c√≥pia do esquema do banco de dados, a visualiza√ß√£o do cliente. Escusado ser√° dizer que essa vis√£o do cliente deve ser sincronizada com o modelo real. Qual √© a melhor maneira de conseguir isso? Usando um gerador de c√≥digo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos os bancos de dados fornecem suas meta informa√ß√µes atrav√©s do SQL. Veja como obter todas as tabelas em diferentes dialetos do SQL do seu banco de dados:</font></font><br>
<br>
<pre><code class="sql hljs">	<span class="hljs-comment">-- H2, HSQLDB, MySQL, PostgreSQL, SQL Server</span>
<span class="hljs-keyword">SELECT</span> table_schema, table_name
<span class="hljs-keyword">FROM</span> information_schema.tables<font></font>
 <font></font>
<span class="hljs-comment">-- DB2</span>
<span class="hljs-keyword">SELECT</span> tabschema, tabname
<span class="hljs-keyword">FROM</span> syscat.tables<font></font>
 <font></font>
<span class="hljs-comment">-- Oracle</span>
<span class="hljs-keyword">SELECT</span> owner, table_name
<span class="hljs-keyword">FROM</span> all_tables<font></font>
 <font></font>
<span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">name</span>
<span class="hljs-keyword">FROM</span> sqlite_master<font></font>
 <font></font>
<span class="hljs-comment">-- Teradata</span>
<span class="hljs-keyword">SELECT</span> databasename, tablename
<span class="hljs-keyword">FROM</span> dbc.tables
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essas consultas (ou similares, dependendo se voc√™ tamb√©m precisa considerar representa√ß√µes, representa√ß√µes materializadas, fun√ß√µes com um valor de tabela) tamb√©m s√£o executadas usando uma chamada </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>DatabaseMetaData.getTables()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">do JDBC ou usando o met√≥dulo jOOQ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A partir dos resultados dessas consultas, √© relativamente f√°cil gerar qualquer visualiza√ß√£o de cliente do seu modelo de banco de dados, independentemente da tecnologia usada no seu cliente.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ usar JDBC ou Spring, poder√° criar um conjunto de constantes de sequ√™ncia </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se estiver usando o JPA, voc√™ poder√° gerar as pr√≥prias entidades </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ estiver usando o jOOQ, poder√° gerar o metamodelo jOOQ</font></font></li>
</ul> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dependendo de quantos recursos s√£o oferecidos pela API do cliente (por exemplo, jOOQ ou JPA), o metamodelo gerado pode ser verdadeiramente rico e completo. </font><font style="vertical-align: inherit;">Tomemos, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">por exemplo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , a possibilidade de jun√ß√µes impl√≠citas que </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">apareceram no jOOQ 3.11</font></a><font style="vertical-align: inherit;"> , que se baseia nas meta-informa√ß√µes geradas sobre os relacionamentos de chaves estrangeiras entre suas tabelas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, qualquer incremento do banco de dados levar√° automaticamente √† atualiza√ß√£o do c√≥digo do cliente. </font><font style="vertical-align: inherit;">Imagine, por exemplo:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> book <span class="hljs-keyword">RENAME</span> <span class="hljs-keyword">COLUMN</span> title <span class="hljs-keyword">TO</span> book_title;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ realmente gostaria de fazer este trabalho duas vezes? </font><font style="vertical-align: inherit;">Em nenhum caso. </font><font style="vertical-align: inherit;">Apenas conserte o DDL, execute-o no seu pipeline de montagem e obtenha a entidade atualizada:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "book", indexes = {
 
  //    ?
  @Index(name = "i_book_title", columnList = "book_title")
})</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> </span>{
  <span class="hljs-meta">@Id</span>
  <span class="hljs-meta">@GeneratedValue(strategy = IDENTITY)</span>
  <span class="hljs-keyword">int</span> id;<font></font>
 <font></font>
  <span class="hljs-meta">@Column("book_title")</span><font></font>
  String bookTitle;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou uma classe jOOQ atualizada. </font><font style="vertical-align: inherit;">A maioria das altera√ß√µes de DDL tamb√©m afeta a sem√¢ntica, n√£o apenas a sintaxe. </font><font style="vertical-align: inherit;">Portanto, pode ser conveniente ver no c√≥digo compilado qual c√≥digo ser√° (ou pode ser) afetado pelo incremento do seu banco de dados.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A √∫nica verdade</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Independentemente da tecnologia usada, sempre existe um modelo que √© a √∫nica fonte de verdade para algum subsistema - ou, pelo menos, devemos nos esfor√ßar para evitar essa confus√£o empresarial, onde a ‚Äúverdade‚Äù est√° em todo lugar e em lugar nenhum. </font><font style="vertical-align: inherit;">Tudo pode ser muito mais simples. </font><font style="vertical-align: inherit;">Se voc√™ estiver apenas trocando arquivos XML com outro sistema, use o XSD. </font><font style="vertical-align: inherit;">Veja o metamodelo INFORMATION_SCHEMA do jOOQ no formato XML: </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.jooq.org/xsd/jooq-meta-3.10.0.xsd</font></font></a><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XSD √© bem entendido</font></font></li>
<li>XSD     XML         </li>
<li>XSD        </li>
<li>XSD     Java   XJC</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O √∫ltimo ponto √© importante. </font><font style="vertical-align: inherit;">Ao se comunicar com um sistema externo usando mensagens XML, queremos ter certeza da validade de nossas mensagens. </font><font style="vertical-align: inherit;">Isso √© muito f√°cil de conseguir com JAXB, XJC e XSD. </font><font style="vertical-align: inherit;">Seria completamente insano esperar que, ao abordar o design do ‚ÄúJava primeiro‚Äù, onde fazemos nossas mensagens na forma de objetos Java, elas possam, de alguma forma, ser claramente exibidas em XML e enviadas para outro sistema para consumo. </font><font style="vertical-align: inherit;">O XML gerado dessa maneira seria de muito baixa qualidade, n√£o documentado e seria dif√≠cil de desenvolver. </font><font style="vertical-align: inherit;">Se houvesse um acordo sobre o n√≠vel de qualidade de servi√ßo (SLA) em tal interface, n√≥s o arruinar√≠amos imediatamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Honestamente, √© exatamente isso que acontece o tempo todo, da API ao JSON, mas essa √© outra hist√≥ria, eu juro na pr√≥xima vez ...</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bancos de dados: √© a mesma coisa</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao trabalhar com bancos de dados, voc√™ entende que eles s√£o, em princ√≠pio, semelhantes. A base possui seus dados e deve gerenciar o esquema. Quaisquer modifica√ß√µes feitas no circuito devem ser implementadas diretamente no DDL para atualizar uma √∫nica fonte de verdade. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando uma atualiza√ß√£o de origem ocorre, todos os clientes tamb√©m devem atualizar suas c√≥pias do modelo. Alguns clientes podem ser gravados em Java usando jOOQ e Hibernate ou JDBC (ou todos de uma vez). Outros clientes podem ser escritos em Perl (resta desejar-lhes boa sorte) e outros em C #. Isso n√£o importa. O modelo principal est√° no banco de dados. Os modelos gerados usando ORMs, geralmente de baixa qualidade, s√£o pouco documentados e dif√≠ceis de desenvolver.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, n√£o cometa erros. </font><font style="vertical-align: inherit;">N√£o cometa erros desde o in√≠cio. </font><font style="vertical-align: inherit;">Trabalhar a partir de um banco de dados. </font><font style="vertical-align: inherit;">Crie um pipeline de implanta√ß√£o que possa ser automatizado. </font><font style="vertical-align: inherit;">Ligue os geradores de c√≥digo para facilitar a c√≥pia do modelo de banco de dados e despej√°-lo nos clientes. </font><font style="vertical-align: inherit;">E pare de se preocupar com geradores de c√≥digo. </font><font style="vertical-align: inherit;">Eles s√£o bons. </font><font style="vertical-align: inherit;">Com eles voc√™ se tornar√° mais produtivo. </font><font style="vertical-align: inherit;">Voc√™ s√≥ precisa gastar um pouco de tempo desde o in√≠cio para configur√°-los - e ent√£o ter√° anos de produtividade aumentada que formar√£o a hist√≥ria do seu projeto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At√© l√°, obrigado.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Explica√ß√£o</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para maior clareza: este artigo n√£o recomenda que, de acordo com o modelo do seu banco de dados, voc√™ precise dobrar todo o sistema (por exemplo, √°rea de assunto, l√≥gica de neg√≥cios etc.). </font><font style="vertical-align: inherit;">Neste artigo, digo que o c√≥digo do cliente que interage com o banco de dados deve atuar com base no modelo de banco de dados, para que n√£o reproduza o modelo de banco de dados no status "primeira classe". </font><font style="vertical-align: inherit;">Essa l√≥gica geralmente est√° localizada no n√≠vel de acesso a dados no seu cliente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em arquiteturas de duas camadas, que ainda s√£o preservadas em alguns lugares, esse modelo de sistema pode ser o √∫nico poss√≠vel. </font><font style="vertical-align: inherit;">No entanto, na maioria dos sistemas, o n√≠vel de acesso a dados parece-me um "subsistema" que encapsula um modelo de banco de dados.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exce√ß√µes</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° exce√ß√µes a qualquer regra, e eu j√° disse que uma abordagem com primazia de banco de dados e gera√ß√£o de c√≥digo-fonte pode √†s vezes ser inadequada. </font><font style="vertical-align: inherit;">Aqui est√£o algumas exce√ß√µes (provavelmente existem outras):</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quando o circuito √© desconhecido e deve ser aberto. </font><font style="vertical-align: inherit;">Por exemplo, voc√™ √© um provedor de uma ferramenta para ajudar os usu√°rios a navegar em qualquer esquema. </font><font style="vertical-align: inherit;">Ufa </font><font style="vertical-align: inherit;">N√£o h√° gera√ß√£o de c√≥digo. </font><font style="vertical-align: inherit;">Mas ainda assim - o banco de dados est√° acima de tudo.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quando um circuito deve ser gerado em tempo real para resolver um determinado problema. </font><font style="vertical-align: inherit;">Este exemplo parece uma vers√£o um pouco fantasiosa do padr√£o de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valor do atributo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> da </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">entidade</font></a><font style="vertical-align: inherit;"> , ou seja, voc√™ realmente n√£o possui um esquema bem definido. </font><font style="vertical-align: inherit;">Nesse caso, muitas vezes √© imposs√≠vel ter certeza de que um RDBMS √© ideal para voc√™.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exce√ß√µes s√£o inerentemente excepcionais. </font><font style="vertical-align: inherit;">Na maioria dos casos que envolvem o uso de um RDBMS, o esquema √© conhecido antecipadamente, est√° localizado dentro do RDBMS e √© a √∫nica fonte de "verdade", e todos os clientes precisam adquirir c√≥pias dele derivadas. </font><font style="vertical-align: inherit;">Idealmente, voc√™ precisa usar um gerador de c√≥digo.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt498796/index.html">Pol√≠tica de seguran√ßa de conte√∫do no Magento 2</a></li>
<li><a href="../pt498798/index.html">Continue aprendendo e aprendendo com o JetBrains</a></li>
<li><a href="../pt498800/index.html">Como eu ensinei meu computador a jogar Dobble com OpenCV e Deep Learning</a></li>
<li><a href="../pt498808/index.html">Vim com suporte YAML para Kubernetes</a></li>
<li><a href="../pt498814/index.html">Voc√™ falhou em uma pergunta te√≥rica sobre a Seguridade Social e ela acabou com voc√™. Isto √© normal? // Estamos condenados # 3</a></li>
<li><a href="../pt498820/index.html">Algumas perguntas mais complicadas sobre .NET e C #</a></li>
<li><a href="../pt498822/index.html">Desenvolvimento e cria√ß√£o do zero de uma m√°quina de arcade para quatro jogadores</a></li>
<li><a href="../pt498826/index.html">SIL e Salesforce</a></li>
<li><a href="../pt498828/index.html">Como o sal de mesa e as prote√≠nas aumentam a sobreviv√™ncia do implante</a></li>
<li><a href="../pt498830/index.html">Hash + cache: otimiza√ß√£o do processamento de fluxo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>