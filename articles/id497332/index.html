<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐋 ⛱️ ✔️ Houston kita punya masalah. Kegagalan Desain Sistem 🎖️ 🔶 👩🏼‍🌾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pada tahun 1970, insinyur Amerika meluncurkan pesawat ruang angkasa Apollo 13 ke bulan. Di papan ada tiga baterai sel bahan bakar, tidak ada yang perl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Houston kita punya masalah. Kegagalan Desain Sistem</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/497332/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pada tahun 1970, insinyur Amerika meluncurkan pesawat ruang angkasa Apollo 13 ke bulan. Di papan ada tiga baterai sel bahan bakar, tidak ada yang perlu dikhawatirkan, semuanya dapat diandalkan dan berulang kali digandakan. Tapi tidak ada yang bisa membayangkan bahwa ledakan tabung oksigen akan menonaktifkan dua dari tiga baterai. Tragedi! Para astronot kembali ke rumah, sebuah film dibuat tentang acara dengan Tom Hanks, dan ungkapan astronot Jack Swigert: "Houston, kami memiliki masalah!", Turun dalam sejarah. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/iu/oj/oi/iuojoilj6ikne43fxjqm5q6bjm4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kisah Apollo 13 adalah bukti lain dari fakta terkenal bahwa Anda tidak dapat mempersiapkan diri untuk semua masalah yang mungkin terjadi. Ini adalah properti alami dunia: pemecah besi secara berkala, kode mengalami crash, dan orang-orang membuat kesalahan. Tidak mungkin untuk sepenuhnya menghilangkan ini.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk sistem terdistribusi besar, perilaku ini normal, itu adalah konsekuensi dari skala ekonomi dan statistik. </font><font style="vertical-align: inherit;">Itulah sebabnya Design for Failure (AWS) adalah prinsip desain dasar untuk layanan cloud AWS. </font><font style="vertical-align: inherit;">Sistem pada awalnya dibangun sedemikian rupa untuk memulihkan operasi penuh waktu secepat mungkin dan meminimalkan kerusakan dari kegagalan yang diketahui dan belum diketahui. </font><font style="vertical-align: inherit;">Di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HighLoad ++,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vasily Pantyukhin, menggunakan masalah kehidupan nyata dengan layanan tempur sebagai contoh, menunjukkan pola desain untuk sistem terdistribusi yang digunakan pengembang AWS.</font></font><br>
<a name="habracut"></a><br>
 <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vasily Pantyukhin</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Induk ayam</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) Adalah arsitek Amazon Web Services di Eropa, Timur Tengah dan Afrika. Dia mulai sebagai administrator Unix, bekerja di Sun Microsystem selama 6 tahun, mengajar kursus teknis, dan selama 11 tahun dia mengajar sentrisitas data dunia di EMC. Dalam tim internasional, ia merancang dan mengimplementasikan proyek-proyek dari Cape Town ke Oslo. Sekarang ini membantu perusahaan besar dan kecil untuk bekerja di cloud publik.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/RxWVxr4uUpI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada tahun 1949, sebuah kecelakaan pesawat terbang diselidiki di pangkalan angkatan udara California. </font><font style="vertical-align: inherit;">Salah satu insinyur yang melakukan ini adalah Edward Murphy. </font><font style="vertical-align: inherit;">Dia menggambarkan pekerjaan teknisi lokal sebagai berikut: "Jika ada dua cara untuk melakukan sesuatu dan salah satunya menyebabkan bencana, maka seseorang akan memilih metode ini." </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Belakangan, berkat Arthur Bloch, pernyataan itu tercatat dalam sejarah sebagai salah satu hukum Murphy. </font><font style="vertical-align: inherit;">Di Rusia - hukum kekejaman. </font><font style="vertical-align: inherit;">Esensinya adalah bahwa tidak mungkin untuk menghindari kerusakan dan kesalahan manusia, dan harus hidup dengannya. </font><font style="vertical-align: inherit;">Itulah sebabnya, ketika merancang, kami segera memasukkan kegagalan dan kegagalan komponen individu ke dalam sistem kami.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desain Kegagalan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam desain untuk kegagalan, kami mencoba meningkatkan tiga karakteristik:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aksesibilitas ("sembilan" yang sama);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">keandalan - properti sistem untuk memberikan tingkat layanan yang diperlukan;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toleransi kesalahan - properti sistem untuk mencegah terjadinya masalah dan pulih dengan cepat setelah mereka.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Keandalan memiliki properti " </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diketahui</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tidak </font><em><font style="vertical-align: inherit;">dikenal</font></em><font style="vertical-align: inherit;"> ". </font><font style="vertical-align: inherit;">Kami melindungi diri dari masalah yang diketahui, tetapi tidak tahu kapan itu akan terjadi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
" </font></font><em><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unknown</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> unknowns"</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ditambahkan ke toleransi kesalahan </font><font style="vertical-align: inherit;">- ini adalah masalah kejutan yang tidak kita ketahui. </font><font style="vertical-align: inherit;">Banyak masalah di cloud ini terkait dengan skala ekonomis: sistem tumbuh dengan ukuran ketika efek baru, luar biasa, dan tak terduga muncul. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kegagalan biasanya bukan fenomena biner. </font><font style="vertical-align: inherit;">Properti utamanya adalah </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"radius ledakan"</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> atau tingkat degradasi layanan, radius kehancuran. </font><font style="vertical-align: inherit;">Tugas kita adalah mengurangi "radius ledakan" sistem.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika kita menyadari bahwa masalah tidak dapat dihindari, maka kita harus secara proaktif mempersiapkan mereka. </font><font style="vertical-align: inherit;">Ini berarti bahwa kami merancang layanan sedemikian rupa sehingga jika terjadi masalah (mereka pasti akan), kami mengendalikan masalah, dan bukan sebaliknya.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ketika kita menanggapi suatu masalah, itu mengendalikan kita.</font></font></blockquote><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bidang data dan bidang Kontrol</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentunya, Anda memiliki elektronik di rumah yang dikendalikan oleh remote control, seperti TV. </font><font style="vertical-align: inherit;">Layar TV adalah bagian dari bidang Data - yang secara langsung menjalankan fungsi. </font><font style="vertical-align: inherit;">Remote control adalah antarmuka pengguna - Control plane. </font><font style="vertical-align: inherit;">Ini digunakan untuk mengelola dan mengkonfigurasi layanan. </font><font style="vertical-align: inherit;">Di cloud, kami mencoba memisahkan bidang Data dan bidang Kontrol untuk pengujian dan pengembangan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pengguna, paling sering, tidak melihat kerumitan bidang Kontrol. </font><font style="vertical-align: inherit;">Tetapi kesalahan dalam desain dan implementasinya adalah penyebab paling umum dari kegagalan massal. </font><font style="vertical-align: inherit;">Itu sebabnya saran saya terfokus pada bidang Kontrol - kadang-kadang secara eksplisit, kadang tidak.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kisah satu masalah</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada Juli 2012, badai hebat melanda Virginia Utara. Pusat data memiliki perlindungan, generator diesel dan banyak lagi, tetapi kebetulan bahwa di salah satu pusat data dari salah satu zona ketersediaan (Zona Ketersediaan, AZ) wilayah Virginia Utara, listrik terputus. Listrik dengan cepat dipulihkan, tetapi pemulihan layanan berlangsung selama berjam-jam. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ig/ev/yd/igevydk5zuise0toukfgy9gdxsw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya akan memberi tahu Anda tentang alasan pada contoh salah satu layanan dasar - CLB (Classic Load Balancer). Ini berfungsi sederhana: ketika Anda memulai penyeimbang baru di setiap zona ketersediaan, mesin virtual terpisah dibuat, IP-nya akan menyelesaikan DNS. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gw/al/l0/gwall0xgawp614yocrkqtoz87dk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika salah satu contoh gagal, pesan tentang ini dikirim ke database khusus. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sk/ts/bj/sktsbjffpcebdnovro-u6dyr0pu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai tanggapan, prosedur mulai: menghapus catatan dari DNS, memulai instance baru dan menambahkan IP baru ke DNS.</font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Catatan: Ini adalah bagaimana sistem bekerja di masa lalu, sekarang semuanya berbeda secara mendasar.</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Semuanya sederhana - tidak ada yang bisa dipatahkan. Tetapi selama kegagalan massal, ketika ribuan instance runtuh pada saat yang sama, </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Backlog besar</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> muncul </font><strong><font style="vertical-align: inherit;">di database</font></strong><font style="vertical-align: inherit;"> dari pesan untuk diproses. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/r2/--/nw/r2--nw4kqcrocoysqgptvysranu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tapi itu semakin buruk. Pesawat kontrol adalah sistem terdistribusi. Karena bug, kami menerima duplikat dan ribuan catatan dalam basis data membengkak hingga ratusan ribu. Menjadi sangat sulit untuk bekerja dengan ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika kegagalan terjadi di salah satu contoh, semua lalu lintas hampir secara instan beralih ke mesin yang masih hidup dan </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">beban berlipat ganda</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (dalam contoh, untuk kesederhanaan, hanya ada dua zona akses). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uz/jl/ox/uzjloxrf6wvv5hrju2-votyb-o4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tidak ada sumber daya yang cukup, contoh langsung secara otomatis mulai </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">skala</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Prosesnya memakan waktu yang relatif lama. Semuanya terjadi puncak dan pada saat yang sama dengan sejumlah besar contoh - sumber daya gratis zona ketersediaan habis. "Perjuangan" untuk sumber daya dimulai. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di Virginia Utara, otomatisasi gagal mengatasi kegagalan besar-besaran, dan para insinyur secara manual (menggunakan skrip) mengembalikan layanan agar berfungsi. Masalah seperti itu jarang terjadi. Selama tanya jawab, muncul pertanyaan tentang penyebab kegagalan, mereka memutuskan bahwa situasinya tidak boleh diulangi lagi dan seluruh layanan harus diubah. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Delapan pola yang akan saya bahas adalah jawaban atas beberapa pertanyaan. </font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Catatan. Ini adalah pengalaman kami dalam desain layanan, bukan kebijakan universal untuk penggunaan luas. Pola digunakan dalam situasi tertentu.</font></font></em><br>
<br>
<em>      —  .   AWS           .    — ,  .    .     —     .     !</em><br>
<br>
<h2>  </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk meminimalisir dampak kegagalan, banyak pendekatan. Salah satunya adalah menjawab pertanyaan: "Bagaimana saya bisa memastikan bahwa pengguna yang tidak tahu tentang masalah tidak tahu apa-apa tentang hal itu selama kegagalan dan selama pemulihan?" </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Backlog kami yang besar tidak hanya menerima pesan macet, tetapi juga pesan lainnya, misalnya, tentang penskalaan atau bahwa seseorang meluncurkan penyeimbang baru. Pesan-pesan seperti itu perlu diisolasi dari satu sama lain, pengelompokan secara fungsional: sekelompok pesan pemulihan yang terpisah setelah kegagalan, secara terpisah meluncurkan penyeimbang baru. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Misalkan sepuluh pengguna melihat masalah - salah satu simpul penyeimbang mereka jatuh. Layanan entah bagaimana bekerja pada sumber daya yang tersisa, tetapi masalahnya terasa.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3c/wu/3a/3cwu3agcfwjtemyacuneqwtmrfm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami memiliki sepuluh pengguna yang frustrasi. </font><font style="vertical-align: inherit;">Kesebelas muncul - dia tidak tahu apa-apa tentang masalahnya, tetapi hanya menginginkan penyeimbang baru. </font><font style="vertical-align: inherit;">Jika permintaannya untuk meletakkan antrian untuk diproses, maka kemungkinan besar dia tidak akan menunggu. </font><font style="vertical-align: inherit;">Sementara prosedur pemrosesan lainnya selesai, waktu permintaan akan berakhir. </font><font style="vertical-align: inherit;">Alih-alih sepuluh pengguna yang frustrasi, kami akan memiliki sebelas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mencegah hal ini terjadi, kami </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memprioritaskan beberapa permintaan</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - kami menempatkan antrian di bagian atas, misalnya, permintaan untuk sumber daya baru. </font><font style="vertical-align: inherit;">Dengan kegagalan massal, sejumlah kecil permintaan semacam itu tidak akan memengaruhi waktu pemulihan sumber daya pelanggan lain. </font><font style="vertical-align: inherit;">Namun dalam proses pemulihan, kami akan menahan jumlah pengguna yang terlibat dalam masalah tersebut.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pekerjaan penuh waktu</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Respons terhadap laporan masalah adalah peluncuran prosedur pemulihan, khususnya, bekerja dengan DNS. Kegagalan massal adalah beban puncak yang sangat besar pada bidang Kontrol. Pola kedua membantu pesawat Kontrol menjadi lebih </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stabil dan dapat diprediksi</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dalam situasi seperti itu. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fg/dv/zm/fgdvzmrez2rrlgfsc4ztmxmkaxu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menggunakan pendekatan yang disebut </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pekerjaan Konstan - pekerjaan permanen</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ri/pa/ee/ripaeenvgoadihywoj90c7vvopa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai contoh, DNS dapat dibuat sedikit lebih pintar: ia akan terus memeriksa contoh penyeimbang, apakah mereka hidup atau tidak. Hasilnya akan berupa bitmap setiap kali: instance merespons - 1, mati - 0. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DNS memeriksa instance setiap beberapa detik, terlepas dari apakah sistem dipulihkan setelah kegagalan massal atau beroperasi secara normal. Dia melakukan pekerjaan yang sama - tidak ada puncak, semuanya dapat diprediksi dan stabil.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Contoh lain yang disederhanakan: kami ingin mengubah konfigurasi pada armada besar. </font><font style="vertical-align: inherit;">Dalam terminologi kami, </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">armada adalah sekelompok mesin virtual</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> yang bersama-sama melakukan beberapa pekerjaan. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nb/wq/go/nbwqgolicpqizt1bkehgk4ney9c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menempatkan perubahan konfigurasi di bucket S3, dan setiap 10 detik (misalnya) mendorong semua konfigurasi ini ke armada mesin virtual kami. </font><font style="vertical-align: inherit;">Dua poin penting.</font></font><br>
<br>
<ul>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami melakukan ini secara teratur</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan tidak pernah melanggar aturan. </font><font style="vertical-align: inherit;">Jika Anda memilih segmen 10 detik, maka tekan hanya dengan cara ini, apa pun situasinya.</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami selalu memberikan seluruh konfigurasi</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , terlepas dari apakah sudah berubah atau belum. </font><font style="vertical-align: inherit;">Pesawat data (mesin virtual) sendiri memutuskan apa yang harus dilakukan dengannya. </font><font style="vertical-align: inherit;">Kami tidak mendorong delta. </font><font style="vertical-align: inherit;">Itu bisa menjadi sangat besar dengan gangguan atau perubahan besar. </font><font style="vertical-align: inherit;">Secara potensial, ini dapat berkontribusi pada ketidakstabilan dan ketidakpastian.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika kami melakukan semacam pekerjaan permanen, kami membayar lebih untuk itu. Misalnya, 100 mesin virtual meminta konfigurasi setiap detik. Harganya sekitar $ 1.200 per tahun. Jumlah ini pada dasarnya kurang dari gaji seorang programmer, kepada siapa kita bisa mempercayakan pengembangan pesawat Control dengan pendekatan klasik - reaksi terhadap kegagalan dan distribusi perubahan konfigurasi saja. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda mengubah konfigurasi setiap beberapa detik, seperti dalam contoh, maka ini lambat. Tetapi dalam banyak kasus, perubahan konfigurasi atau peluncuran layanan membutuhkan waktu beberapa menit - beberapa detik tidak menyelesaikan apa pun. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Detik penting untuk layanan di mana konfigurasi harus berubah secara instan, misalnya, ketika mengubah pengaturan VPC. Di sini "pekerjaan tetap" tidak berlaku. Ini hanya sebuah pola, bukan aturan. Jika ini tidak berhasil dalam kasus Anda, jangan gunakan.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penskalaan awal</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam contoh kita, ketika instance penyeimbang crash, instance penyintas kedua menerima beban yang berlipat hampir dengan segera dan mulai menskala. </font><font style="vertical-align: inherit;">Dalam kegagalan besar, ia memakan banyak sumber daya. </font><font style="vertical-align: inherit;">Pola ketiga membantu untuk mengendalikan proses ini - untuk </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">skala di muka</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam kasus dua zona ketersediaan, kami mengukur saat membuang kurang dari 50%. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ch/wy/n4/chwyn4ffipap4mcwshur7bikoj4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika semuanya dilakukan di muka, maka jika terjadi kegagalan, instance penyeimbang yang bertahan siap untuk menerima lalu lintas berlipat ganda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebelumnya, kami diskalakan hanya dengan pemanfaatan tinggi, misalnya, 80%, dan sekarang 45%. </font><font style="vertical-align: inherit;">Sistem idle sebagian besar waktu dan menjadi lebih mahal. </font><font style="vertical-align: inherit;">Tetapi kami siap untuk bertahan dengan ini dan secara aktif menggunakan polanya, karena ini </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">adalah asuransi</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Anda harus membayar asuransi, tetapi jika terjadi masalah serius, kemenangan tersebut mencakup semua biaya. </font><font style="vertical-align: inherit;">Jika Anda memutuskan untuk menggunakan polanya, hitung semua risiko dan harga di muka.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arsitektur seluler</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada dua cara untuk membangun dan meningkatkan layanan: </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">monolit</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">struktur sarang lebah</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (berbasis sel). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nc/y7/ab/ncy7abk8fzjvr8lsez7wwcjuc70.png"><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Monolith</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> berkembang dan tumbuh sebagai wadah besar tunggal. </font><font style="vertical-align: inherit;">Kami menambahkan sumber daya, sistem membengkak, kami berlari ke batas yang berbeda, karakteristik linier menjadi non-linear dan menjadi jenuh, dan "radius ledakan" dari sistem - seluruh sistem.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika monolit diuji dengan buruk, itu meningkatkan kemungkinan kejutan - "tidak diketahui tidak diketahui". Tetapi monolit besar tidak dapat sepenuhnya diuji. Terkadang untuk ini Anda harus membangun zona akses terpisah, misalnya, untuk layanan populer yang dibangun sebagai monolit di dalam zona akses (ini banyak pusat data). Selain entah bagaimana membuat beban uji besar yang mirip dengan saat ini, ini tidak mungkin dari sudut pandang keuangan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oleh karena itu, dalam kebanyakan kasus, kami menggunakan </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arsitektur seluler</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - konfigurasi di mana sistem dibangun dari sel dengan ukuran tetap. Dengan menambahkan sel, kami skala itu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Arsitektur seluler populer di awan AWS. Ini membantu mengisolasi gangguan dan </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mengurangi radius ledakan.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ke satu atau lebih sel. Kami dapat sepenuhnya menguji sel berukuran sedang, ini serius mengurangi risiko. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendekatan serupa digunakan dalam pembuatan kapal: lambung kapal atau kapal dibagi dengan partisi menjadi kompartemen. Jika ada lubang, satu atau beberapa kompartemen terendam, tetapi kapal tidak tenggelam. Ya, itu tidak membantu Titanic, tetapi kami jarang menemui masalah gunung es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya akan menggambarkan penerapan pendekatan mesh menggunakan Layanan Simple Shapes sebagai contoh. Ini bukan layanan AWS, saya datang sendiri. Ini adalah satu set API sederhana untuk bekerja dengan bentuk geometris sederhana. Anda bisa membuat turunan bentuk geometris, meminta jenis bentuk berdasarkan idnya, atau menghitung semua contoh jenis yang diberikan. Misalnya, objek </font></font><code>put(triangle)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"segitiga" dengan beberapa id dibuat </font><font style="vertical-align: inherit;">berdasarkan permintaan </font><font style="vertical-align: inherit;">.</font></font><code>getShape(id)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mengembalikan tipe "segitiga", "lingkaran" atau "belah ketupat". </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7t/z6/dv/7tz6dv0w3f9laswjhuwtbpedggs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk membuat layanan mendung, itu harus digunakan oleh pengguna yang berbeda secara bersamaan. </font><font style="vertical-align: inherit;">Mari membuatnya multi-tenant. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/64/hk/pq/64hkpq9niokkw8w-w9rsu7m-w04.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selanjutnya, Anda perlu membuat cara untuk partisi - untuk memisahkan angka menjadi sel. </font><font style="vertical-align: inherit;">Ada beberapa opsi untuk memilih kunci partisi. </font><font style="vertical-align: inherit;">Yang paling sederhana adalah </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dalam bentuk geometris</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : semua rhombus di sel pertama, lingkaran di kedua, segitiga di ketiga. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode ini memiliki pro dan kontra.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika terdapat lebih sedikit lingkaran daripada gambar lain, maka sel yang sesuai akan tetap kurang dimanfaatkan (distribusi tidak merata).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beberapa permintaan API mudah diimplementasikan. </font><font style="vertical-align: inherit;">Misalnya, dengan menghitung semua objek di sel kedua, kami menemukan jumlah lingkaran dalam sistem.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pertanyaan lain lebih rumit. </font><font style="vertical-align: inherit;">Misalnya, untuk menemukan bentuk geometris dengan id, Anda harus melalui semua sel.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cara kedua adalah dengan menggunakan </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">id objek dengan rentang</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : seribu objek pertama di sel pertama, yang kedua di kedua. </font><font style="vertical-align: inherit;">Jadi distribusinya lebih seragam, tetapi ada kesulitan lain. </font><font style="vertical-align: inherit;">Misalnya, untuk menghitung semua segitiga, Anda perlu menggunakan metode ini </font></font><code>scatter/gather</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: kami mendistribusikan permintaan ke setiap sel, itu menghitung segitiga di dalam dirinya sendiri, kemudian mengumpulkan jawaban, merangkum dan menghasilkan hasilnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cara ketiga - </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">divisi penyewa</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(kepada pengguna). Di sini kita dihadapkan dengan masalah klasik. Biasanya ada banyak pengguna "kecil" di cloud yang mencoba sesuatu dan praktis tidak memuat layanan. Ada pengguna mastodon. Mereka sedikit, tetapi mereka mengkonsumsi sejumlah besar sumber daya. Pengguna tersebut tidak akan pernah masuk ke dalam sel apa pun. Anda harus menemukan cara rumit untuk mendistribusikannya di antara banyak sel. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wp/1i/3c/wp1i3c0ac5bjnvnxividrzrq6fk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tidak ada cara yang ideal, setiap layanan bersifat individual. Kabar baiknya adalah bahwa kebijaksanaan duniawi bekerja di sini - memotong kayu bakar lebih mudah dilakukan di sepanjang serat, daripada memotongnya. Dalam banyak layanan, "serat" ini kurang lebih jelas. Kemudian Anda dapat melakukan percobaan dan menemukan kunci partisi yang optimal.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sel saling berhubungan (walaupun lemah). Karena itu, harus ada level penghubung. Seringkali disebut layer routing atau pemetaan. Diperlukan untuk memahami sel mana untuk mengirim permintaan khusus. Level ini harus sesederhana mungkin. Cobalah untuk tidak meletakkan logika bisnis di dalamnya. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mg/os/ox/mgosox1qloxyngz5k1fd4wwy_ws.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muncul pertanyaan tentang ukuran sel: kecil - buruk, besar - juga buruk. Tidak ada saran universal - putuskan sesuai situasi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di cloud AWS, kami menggunakan sel logis dan fisik dengan ukuran berbeda. Ada layanan regional dengan ukuran sel besar, ada layanan zona, di mana sel lebih kecil. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/z9/s8/k-/z9s8k-8v60dwwojzqv86ozp7s7k.png"><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Catatan. Saya berbicara tentang sel mikro di Saint Highload ++ Online pada awal April tahun ini. Di sana saya membahas secara rinci contoh penggunaan khusus pola ini dalam layanan inti EBS Amazon kami.</font></font></em><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Multi-tenant</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika pengguna meluncurkan penyeimbang baru, ia menerima contoh di setiap zona ketersediaan. </font><font style="vertical-align: inherit;">Terlepas dari apakah sumber daya digunakan atau tidak, sumber daya tersebut dialokasikan dan secara eksklusif dimiliki oleh penyewa cloud ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk AWS, pendekatan ini tidak efisien, karena pemanfaatan sumber daya layanan rata-rata sangat rendah. </font><font style="vertical-align: inherit;">Ini mempengaruhi biaya. </font><font style="vertical-align: inherit;">Untuk pengguna cloud, ini bukan solusi yang fleksibel. </font><font style="vertical-align: inherit;">Ini tidak dapat beradaptasi dengan kondisi yang berubah dengan cepat, misalnya, untuk menyediakan sumber daya dengan peningkatan beban yang tidak terduga dalam waktu singkat. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fk/52/xg/fk52xgzaaqhgq09uw_zlhbhxpfc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CLB adalah penyeimbang pertama di cloud Amazon. </font><font style="vertical-align: inherit;">Layanan saat ini menggunakan pendekatan multi-tenant, seperti NLB (Network Load Balancer). </font><font style="vertical-align: inherit;">Dasarnya, "mesin" dari layanan jaringan tersebut adalah </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HyperPlane</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ini adalah internal, tidak terlihat oleh pengguna akhir, armada besar mesin virtual (node). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-b/65/3a/-b653as3g91ombi9itfq5wwqjxg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Keuntungan dari pendekatan </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">multi-tenant</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> atau pola kelima.</font></font><br>
<br>
<ul>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toleransi kesalahan secara fundamental lebih tinggi</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Di HyperPlane, sejumlah besar node sudah berjalan dan sedang menunggu beban. </font><font style="vertical-align: inherit;">Node mengetahui keadaan satu sama lain - ketika beberapa sumber daya gagal, beban didistribusikan secara instan di antara yang lainnya. </font><font style="vertical-align: inherit;">Pengguna bahkan tidak melihat crash massal.</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perlindungan beban puncak</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Penyewa menjalani hidup mereka sendiri dan beban mereka biasanya tidak berkorelasi satu sama lain. </font><font style="vertical-align: inherit;">Total beban rata-rata di HyperPlane cukup mulus.</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pemanfaatan layanan tersebut secara fundamental lebih baik</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Karena itu, memberikan kinerja yang lebih baik, mereka lebih murah.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Itu terdengar keren! Tetapi pendekatan multitenant memiliki kelemahan. Dalam gambar, armada HyperPlane dengan tiga penyewa (belah ketupat, lingkaran dan segitiga), yang </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">didistribusikan di semua node</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kv/by/dg/kvbydgnlm6a8plns-cewltag1e8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini menimbulkan masalah klasik Tetangga tetangga: tindakan destruktif penyewa, yang menghasilkan lalu lintas sangat tinggi atau buruk, berpotensi akan mempengaruhi semua pengguna. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3f/b9/v4/3fb9v4-hnl27k0sgihgjybo_x70.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Blast radius" dalam sistem seperti itu adalah semua penyewa. Kemungkinan “tetangga berisik” destruktif di zona ketersediaan AWS sebenarnya tidak tinggi. Tetapi kita harus selalu siap untuk yang terburuk. Kami membela diri menggunakan pendekatan mesh - kami memilih kelompok node sebagai sel. Dalam konteks ini, kami menyebutnya pecahan. Sel, pecahan, partisi - ini dia satu dan sama.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/d1/7z/yy/d17zyyesjijnpsqpllrwhlthqn4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam contoh ini, belah ketupat, sebagai "tetangga yang bising", hanya akan memengaruhi satu penyewa - sebuah segitiga. </font><font style="vertical-align: inherit;">Tapi segitiga itu akan sangat menyakitkan. </font><font style="vertical-align: inherit;">Untuk memperlancar efek, terapkan pola keenam - pencampuran sharding.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengocok sharding</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami mendistribusikan penyewa secara acak ke node. </font><font style="vertical-align: inherit;">Sebagai contoh, sebuah belah ketupat mendarat pada 1, 3, dan 6 node, dan segitiga pada 2, 6, dan 8. Kami memiliki 8 node dan beling ukuran 3. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ft/6n/-w/ft6n-wgdpnlw1g5_t6thpanrtdm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini, kombinatorik sederhana bekerja. </font><font style="vertical-align: inherit;">Dengan probabilitas 54%, hanya akan ada satu persimpangan antara penyewa. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cg/uu/jq/cguujqg-8xjmp-cktarugsfdd6c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Tetangga yang bising" hanya akan memengaruhi satu penyewa, dan bukan seluruh beban, tetapi hanya 30 persen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertimbangkan konfigurasi yang mendekati real - 100 node, ukuran beling 5. Dengan probabilitas 77%, tidak akan ada persimpangan sama sekali. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/14/tj/dr/14tjdrziuvtturqjld0comvzycy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Shuffle sharding dapat secara signifikan mengurangi "radius ledakan". </font><font style="vertical-align: inherit;">Pendekatan ini digunakan di banyak layanan AWS.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Armada kecil menyebabkan armada besar, dan bukan sebaliknya"</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika memulihkan dari kegagalan massal, kami memperbarui konfigurasi banyak komponen. Pertanyaan umum dalam hal ini adalah mendorong atau mengubah konfigurasi yang diubah? Siapa pemrakarsa perubahan: sumber yang berisi perubahan konfigurasi, atau konsumennya? Tetapi pertanyaan-pertanyaan ini salah. Pertanyaan yang tepat adalah armada mana yang lebih besar? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertimbangkan situasi sederhana: armada besar mesin virtual front-end dan sejumlah backend. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vg/av/er/vgaverdwdhgvag5w_pbichyvro0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menggunakan pendekatan jala - kelompok instance front-end akan bekerja dengan backend tertentu. Untuk melakukan ini, tentukan rute - pemetaan backend dan frontends yang bekerja dengannya. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bx/_a/_a/bx_a_ayxwrvjrvh9uwmaj5ifsru.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Routing statis tidak cocok. Algoritme hash tidak berfungsi dengan baik pada kegagalan massal, saat Anda perlu mengubah sebagian besar rute dengan cepat. Karena itu lebih baik digunakan</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">routing dinamis</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Di samping armada besar unit front-end dan back-end, kami menempatkan layanan kecil yang hanya akan menangani perutean. Dia akan tahu dan menetapkan pemetaan backend dan frontend pada waktu tertentu. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ji/o3/kl/jio3kl9vxu3hx5p9b1uvfgxsih8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Misalkan kita mengalami crash besar, banyak contoh front-end jatuh. Mereka mulai pulih secara besar-besaran dan hampir secara bersamaan meminta konfigurasi pemetaan dari layanan routing. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nd/qv/fz/ndqvfzx9d_2qn6nfnu8bpmmjrqc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Layanan perutean kecil dibombardir dengan sejumlah besar permintaan. Dia tidak akan mengatasi beban, dalam kasus terbaik, itu akan menurun, dan yang terburuk dia akan mati. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena itu, memang benar untuk tidak meminta perubahan konfigurasi dari layanan kecil, melainkan membangun sistem Anda sehingga "bayi" itu sendiri</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">perubahan konfigurasi yang diprakarsai terhadap sejumlah besar instance</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ua/hf/gq/uahfgqlyxt-yn190bzu-q8on_rw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menggunakan pola kerja konstan. </font><font style="vertical-align: inherit;">Layanan perutean kecil akan mengirimkan konfigurasi ke semua instance armada front-end sekali setiap beberapa detik. </font><font style="vertical-align: inherit;">Dia tidak akan pernah bisa membebani layanan hebat. </font><font style="vertical-align: inherit;">Pola ketujuh membantu meningkatkan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stabilitas dan ketahanan</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tujuh pola pertama meningkatkan sistem. </font><font style="vertical-align: inherit;">Pola yang terakhir bekerja secara berbeda.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menjatuhkan beban</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di bawah ini adalah grafik klasik dari penundaan versus beban. </font><font style="vertical-align: inherit;">Di sisi kanan grafik adalah "lutut", ketika pada beban yang sangat tinggi bahkan peningkatan kecil menyebabkan peningkatan signifikan dalam latensi.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/sb/fw/vq/sbfwvqhbni-3lzbd0gjlnorzzqi.png" width="450"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam mode normal, kami tidak pernah membawa layanan kami ke sisi kanan jadwal. Cara mudah untuk mengontrol ini adalah menambahkan sumber daya tepat waktu. Tapi kami sedang bersiap-siap untuk masalah. Sebagai contoh, kita dapat bergerak ke sisi kanan grafik pulih dari kegagalan massa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menempatkan batas waktu klien pada tabel. Siapa pun dapat menjadi klien, misalnya, komponen lain di dalam layanan kami. Untuk kesederhanaan, kami menggambar grafik keterlambatan 50 persen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/g5/sj/vw/g5sjvwfpnmekcg2mu-kiynw1p6k.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini kita dihadapkan dengan situasi yang disebut </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">brownout</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Anda mungkin akrab dengan istilah </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pemadaman</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> listrik ketika listrik terputus di kota. Brownout adalah ketika sesuatu bekerja, tetapi sangat buruk dan lambat sehingga, dihitung, itu tidak bekerja sama sekali</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita lihat zona brown brownout. Layanan menerima permintaan dari klien, memprosesnya dan mengembalikan hasilnya. Namun, dalam setengah kasus, klien sudah kehabisan waktu dan tidak ada yang menunggu hasilnya. Di separuh lainnya, hasilnya kembali lebih cepat dari batas waktu, tetapi dalam sistem yang lambat itu membutuhkan terlalu banyak waktu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menghadapi masalah ganda: kami sudah kelebihan beban dan berada di sisi kanan jadwal, tetapi pada saat yang sama kami masih "menghangatkan udara", melakukan banyak pekerjaan yang tidak berguna. Bagaimana cara menghindarinya? </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Temukan "lutut"</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - titik belok pada bagan </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kami mengukur atau memperkirakan secara teoritis. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jatuhkan traffic</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> yang memaksa kita untuk pergi ke kanan titik belok </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></strong><br>
<br>
<img src="https://habrastorage.org/webt/nz/2e/t7/nz2et7zg-cebdkle6rzusm0f0ts.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami hanya harus mengabaikan sebagian dari permintaan. </font><font style="vertical-align: inherit;">Kami bahkan tidak mencoba memprosesnya, tetapi segera mengembalikan kesalahan kepada klien. </font><font style="vertical-align: inherit;">Bahkan dengan kelebihan beban, kami mampu melakukan operasi ini - ini “murah”. </font><font style="vertical-align: inherit;">Permintaan tidak terpenuhi, ketersediaan keseluruhan layanan berkurang. </font><font style="vertical-align: inherit;">Meskipun permintaan yang ditolak akan diproses cepat atau lambat setelah satu atau beberapa percobaan dari klien. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bz/4n/xk/bz4nxkpmofmaqg-deszxrwhra5m.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada saat yang sama, bagian lain dari permintaan diproses dengan latensi rendah yang dijamin. </font><font style="vertical-align: inherit;">Akibatnya, kita tidak melakukan pekerjaan yang tidak berguna, dan apa yang kita lakukan, kita lakukan dengan baik.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perasan singkat pola desain sistem untuk kegagalan</font></font></h2><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isolasi dan regulasi</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Terkadang masuk akal untuk memprioritaskan jenis kueri tertentu. Misalnya, dengan volume permintaan yang relatif kecil untuk membuat sumber daya baru, mereka dapat ditempatkan di bagian atas antrian. Penting bahwa ini tidak melanggar pengguna lain. Dalam pemadaman masif, pengguna yang menunggu sumber daya mereka pulih tidak akan merasakan perbedaan yang signifikan. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pekerjaan penuh waktu</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Mengurangi atau sepenuhnya menghilangkan pergantian mode layanan. Satu mode, yang bekerja secara stabil dan terus-menerus, terlepas dari situasi darurat atau kerja, secara fundamental meningkatkan stabilitas dan prediktabilitas bidang Kontrol. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penskalaan awal</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Skala di muka dengan nilai pembuangan yang lebih rendah. Anda harus membayar sedikit lebih untuk ini, tetapi ini adalah asuransi yang terbayar selama kegagalan sistem yang serius. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arsitektur seluler</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Banyak sel yang digabungkan secara longgar lebih disukai daripada monolit. Pendekatan mesh mengurangi "radius ledakan" dan kemungkinan kesalahan kejutan. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pendekatan multitenant</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> secara signifikan meningkatkan pemanfaatan layanan, mengurangi biaya dan mengurangi "radius ledakan". </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengocok sharding</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ini adalah pendekatan yang berlaku untuk layanan multi-tenant. Selain itu memungkinkan Anda untuk mengontrol "radius ledakan". </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Armada kecil menyebabkan armada besar, dan bukan sebaliknya"</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Kami mencoba membangun layanan sehingga layanan kecil melakukan perubahan pada konfigurasi besar. Kami sering menggunakannya bersamaan dengan pola beban konstan. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menjatuhkan beban</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dalam situasi darurat, kami hanya mencoba melakukan pekerjaan yang bermanfaat, dan melakukannya dengan baik. Untuk melakukan ini, kami membuang sebagian muatan, yang masih belum dapat kami tangani.</font></font><br>
<br>
<blockquote>  —    ,    Saint HighLoad++ Online.  --  , Q&amp;A-,  ,    .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> -</a>         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> </a>. ,   -   . <br>
<br>
  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a>  telegram- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">@HighLoadChannel</a> —         ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a>.</blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id497322/index.html">Pengujian Skor Kualitas Objektif dengan Peta Perjalanan Pelanggan</a></li>
<li><a href="../id497324/index.html">"Seperti apel mata ..." atau buat sistem keamanan sederhana berdasarkan mikrokontroler (Canny atau Arduino) dan Raspberry PI</a></li>
<li><a href="../id497326/index.html">Konektivitas SSH yang lebih aman dengan DNSSEC</a></li>
<li><a href="../id497328/index.html">Cara mudah belajar bahasa (apa saja)</a></li>
<li><a href="../id497330/index.html">Chrome Desktop Jarak Jauh. Dukungan jarak jauh</a></li>
<li><a href="../id497334/index.html">Bug terkenal dan bagaimana menghindarinya pada contoh ClickHouse</a></li>
<li><a href="../id497336/index.html">Merek komputer tahun 90-an, bagian 3, final</a></li>
<li><a href="../id497338/index.html">Apa yang terjadi dengan transportasi minggu lalu - krisis sedang berkembang</a></li>
<li><a href="../id497340/index.html">COVID-19: cara berhenti membaca berita dan mulai menganalisis data</a></li>
<li><a href="../id497342/index.html">Browser waspada terhadap permintaan API: membangun komunikasi aman antara front-end dan back-end</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>