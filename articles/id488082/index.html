<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏿‍⚖️ ☎️ 👩🏿‍💻 Singkatnya: Async / Menunggu Praktik Terbaik di .NET 🍖 🔧 🏓</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Untuk mengantisipasi dimulainya kursus, "Pengembang C #" menyiapkan terjemahan materi yang menarik.
 
 
 
 Async / Menunggu - Pendahuluan
 Konstruk ba...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Singkatnya: Async / Menunggu Praktik Terbaik di .NET</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/488082/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Untuk mengantisipasi dimulainya kursus, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Pengembang C #"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> menyiapkan terjemahan materi yang menarik.</font></font></i></b><br>
<br>
<img src="https://habrastorage.org/webt/6f/io/l8/6fiol8vwkg-r8ja-3zurutnz-ci.png"><br>
<hr><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Async / Menunggu - Pendahuluan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Konstruk bahasa Async / Await telah ada sejak C # versi 5.0 (2012) dan dengan cepat menjadi salah satu pilar pemrograman .NET modern - pengembang C # yang menghargai diri sendiri harus menggunakannya untuk meningkatkan kinerja aplikasi, responsif secara keseluruhan, dan keterbacaan kode. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Async / Await membuat memperkenalkan kode asinkron secara sederhana dan menghilangkan kebutuhan bagi programmer untuk memahami detail dari pemrosesan, tetapi berapa banyak dari kita yang benar-benar tahu cara kerjanya dan apa kelebihan dan kekurangan dari metode ini? </font><font style="vertical-align: inherit;">Ada banyak informasi yang berguna, tetapi itu terfragmentasi, jadi saya memutuskan untuk menulis artikel ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kalau begitu, mari kita mempelajari topik.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mesin Negara (IAsyncStateMachine)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hal pertama yang perlu diketahui adalah bahwa di bawah tenda, setiap kali Anda memiliki metode atau fungsi dengan Async / Menunggu, kompiler sebenarnya mengubah metode Anda menjadi kelas yang dihasilkan yang mengimplementasikan antarmuka IAsyncStateMachine. Kelas ini bertanggung jawab untuk mempertahankan keadaan metode Anda selama siklus hidup operasi asinkron - kelas ini merangkum semua variabel metode Anda dalam bentuk bidang dan memecah kode Anda menjadi bagian-bagian yang dieksekusi selama mesin negara transisi antar negara, sehingga utas dapat meninggalkan metode dan saat itu akan kembali, negara tidak akan berubah. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai contoh, berikut adalah definisi kelas yang sangat sederhana dengan dua metode asinkron: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
using System.Threading.Tasks;</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> System.Diagnostics;<font></font>
<font></font>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">AsyncAwait</span><font></font>
{<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AsyncAwait</span><font></font>
    {<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">AsyncAwaitExample</span>(<span class="hljs-params"></span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">int</span> myVariable = <span class="hljs-number">0</span>;<font></font>
<font></font>
            <span class="hljs-keyword">await</span> DummyAsyncMethod();<font></font>
            Debug.WriteLine(<span class="hljs-string">"Continuation - After First Await"</span>);<font></font>
            myVariable = <span class="hljs-number">1</span>;<font></font>
<font></font>
            <span class="hljs-keyword">await</span> DummyAsyncMethod();<font></font>
            Debug.WriteLine(<span class="hljs-string">"Continuation - After Second Await"</span>);<font></font>
            myVariable = <span class="hljs-number">2</span>;<font></font>
<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">DummyAsyncMethod</span>(<span class="hljs-params"></span>)</span><font></font>
        {<font></font>
            <span class="hljs-comment">// </span><font></font>
        }<font></font>
<font></font>
    }<font></font>
}</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kelas dengan dua metode asinkron</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Jika kita melihat kode yang dihasilkan selama perakitan, kita akan melihat sesuatu seperti ini: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qo/xe/63/qoxe63foidhmllsdwfi78tdhrsm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perhatikan bahwa kita memiliki 2 kelas dalam yang dihasilkan untuk kita, satu untuk setiap metode asinkron. Kelas-kelas ini berisi mesin negara untuk masing-masing metode asinkron kami. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lebih lanjut, setelah mempelajari kode yang di-decompile </font></font><code><code>&lt;AsyncAwaitExample&gt;</code></code><code> d__0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, kita akan melihat bahwa variabel internal kita </font></font><code>«myVariable»</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sekarang menjadi bidang kelas: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gd/_m/qj/gd_mqjxvsjfw9-_zfd7740n42ua.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kita juga dapat melihat bidang kelas lain yang digunakan secara internal untuk mempertahankan status </font></font><code>IAsyncStateMachine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Mesin keadaan melewati status menggunakan metode</font></font><code>MoveNext()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, pada kenyataannya, sebuah saklar besar. </font><font style="vertical-align: inherit;">Perhatikan bagaimana metode ini berlanjut di bagian yang berbeda setelah masing-masing panggilan tidak sinkron (dengan label lanjutan sebelumnya). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/km/li/ea/kmlieahswg0ebqn3db5nctfzsti.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Itu berarti async / menunggu keanggunan datang dengan harga. </font><font style="vertical-align: inherit;">Menggunakan async / menunggu sebenarnya menambah kompleksitas (yang mungkin tidak Anda sadari). </font><font style="vertical-align: inherit;">Dalam logika sisi server, ini mungkin tidak kritis, tetapi khususnya ketika memprogram aplikasi seluler yang mempertimbangkan setiap siklus memori CPU dan KB, Anda harus mengingatnya, karena jumlah overhead dapat dengan cepat meningkat. </font><font style="vertical-align: inherit;">Nanti dalam artikel ini, kita akan membahas praktik terbaik untuk menggunakan Async / Tunggu hanya jika perlu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk penjelasan yang cukup instruktif tentang mesin negara, tonton </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;">video</font></a><font style="vertical-align: inherit;"> ini </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">di YouTube</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kapan Menggunakan Async / Menunggu</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Biasanya ada dua skenario di mana Async / Menunggu adalah solusi yang tepat.</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pekerjaan terkait I / O</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Kode Anda akan mengharapkan sesuatu, seperti data dari database, membaca file, memanggil layanan web. </font><font style="vertical-align: inherit;">Dalam hal ini, Anda harus menggunakan Async / Menunggu, bukan Perpustakaan Paralel Tugas.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pekerjaan terkait CPU</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : kode Anda akan melakukan perhitungan yang rumit. </font><font style="vertical-align: inherit;">Dalam hal ini, Anda harus menggunakan Async / Menunggu, tetapi Anda harus mulai bekerja di utas lain menggunakan Task.Run. </font><font style="vertical-align: inherit;">Anda juga dapat mempertimbangkan menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perpustakaan Tugas Paralel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ul><br>
<hr><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Async sepanjang jalan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika Anda mulai bekerja dengan metode asinkron, Anda akan segera menyadari bahwa sifat asinkron dari kode mulai menyebar naik turun hierarki panggilan Anda - ini berarti Anda juga harus membuat kode panggilan Anda tidak sinkron, dan sebagainya. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda mungkin tergoda untuk "menghentikan" ini dengan memblokir kode menggunakan Task.Result atau Task.Wait, mengonversi sebagian kecil aplikasi dan membungkusnya dalam API sinkron sehingga sisa aplikasi terisolasi dari perubahan. Sayangnya, ini adalah resep untuk membuat sulit untuk melacak kebuntuan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solusi terbaik untuk masalah ini adalah memungkinkan kode asinkron untuk tumbuh dalam basis kode secara alami. </font><font style="vertical-align: inherit;">Jika Anda mengikuti keputusan ini, Anda akan melihat ekstensi kode asinkron ke titik masuknya, biasanya event handler atau action controller. </font><font style="vertical-align: inherit;">Menyerah ke asinkron tanpa jejak! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Informasi lebih lanjut dalam </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">artikel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MSDN </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;">ini</font></a><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika metode ini dinyatakan sebagai async, pastikan ada yang menunggu!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang kita bahas, ketika kompiler menemukan metode async, itu mengubah metode ini menjadi mesin negara. </font><font style="vertical-align: inherit;">Jika kode Anda tidak memiliki menunggu di tubuhnya, kompiler akan menghasilkan peringatan, tetapi mesin negara akan tetap dibuat, menambahkan overhead yang tidak perlu untuk operasi yang tidak akan pernah benar-benar selesai.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hindari async void</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Void Async adalah sesuatu yang harus benar-benar dihindari. </font><font style="vertical-align: inherit;">Buat aturan untuk menggunakan Tugas async dan bukannya async batal.</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">void</span> <span class="hljs-title">AsyncVoidMethod</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-comment">//!</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">AsyncTaskMethod</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-comment">//!</span>
}</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metode tugas async void dan async</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ada beberapa alasan untuk ini, termasuk:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pengecualian yang dilemparkan dalam metode void async tidak dapat ditangkap di luar metode ini</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font></li>
</ul><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ketika pengecualian dilemparkan dari metode Tugas async atau tugas </font></font><code>&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T </font><font style="vertical-align: inherit;">async </font></font><code>&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, pengecualian ini ditangkap dan ditempatkan di objek Tugas. </font><font style="vertical-align: inherit;">Saat menggunakan metode async void, objek Task tidak ada, oleh karena itu, pengecualian apa pun yang dilemparkan dari metode async void akan dipanggil langsung di SynchronizationContext, yang aktif ketika metode void async diluncurkan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perhatikan contoh di bawah ini. </font><font style="vertical-align: inherit;">Blok tangkap tidak akan pernah tercapai.</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">void</span> <span class="hljs-title">AsyncVoidMethodThrowsException</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">"Hmmm, something went wrong!"</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ThisWillNotCatchTheException</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">try</span><font></font>
    {<font></font>
        AsyncVoidMethodThrowsException();<font></font>
    }<font></font>
    <span class="hljs-keyword">catch</span>(Exception ex)<font></font>
    {<font></font>
        <span class="hljs-comment">//     </span><font></font>
        Debug.WriteLine(ex.Message);<font></font>
    }<font></font>
}</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pengecualian yang dilemparkan dalam metode async void tidak dapat ditangkap di luar metode ini.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Bandingkan dengan kode ini, di mana alih-alih async void kita memiliki Tugas async. </font><font style="vertical-align: inherit;">Dalam hal ini, tangkapan akan dapat dijangkau.</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">AsyncTaskMethodThrowsException</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">"Hmmm, something went wrong!"</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">ThisWillCatchTheException</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">try</span><font></font>
    {<font></font>
        <span class="hljs-keyword">await</span> AsyncTaskMethodThrowsException();<font></font>
    }<font></font>
    <span class="hljs-keyword">catch</span> (Exception ex)<font></font>
    {<font></font>
        <span class="hljs-comment">//    </span><font></font>
        Debug.WriteLine(ex.Message);<font></font>
    }<font></font>
}</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pengecualian ditangkap dan ditempatkan di objek Tugas.</font></font></i><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metode async void dapat menyebabkan efek samping yang tidak diinginkan jika penelepon tidak mengharapkannya asinkron</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : jika metode asinkron Anda tidak menghasilkan apa-apa, gunakan Tugas async (tanpa " </font></font><code>&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T </font></font><code>&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" untuk Tugas) sebagai jenis pengembalian.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metode batal async sangat sulit untuk diuji</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : karena perbedaan dalam penanganan kesalahan dan tata letak, sulit untuk menulis unit test yang memanggil metode batal async. </font><font style="vertical-align: inherit;">Tes Asynchronous MSTest hanya bekerja untuk metode asynchronous yang mengembalikan Task atau Task </font></font><code>&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T </font></font><code>&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pengecualian untuk praktik ini adalah pengendali event asinkron. </font><font style="vertical-align: inherit;">Tetapi bahkan dalam kasus ini, disarankan untuk meminimalkan kode yang ditulis dalam handler itu sendiri - mengharapkan metode Tugas async yang berisi logika. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Informasi lebih lanjut dalam </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">artikel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MSDN </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;">ini</font></a><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lebih suka mengembalikan tugas daripada menunggu kembali</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang sudah dibahas, setiap kali Anda mendeklarasikan metode asynchronous, kompiler membuat kelas mesin negara yang benar-benar membungkus logika metode Anda. Ini menambahkan overhead tertentu yang dapat terakumulasi, terutama untuk perangkat seluler, di mana kami memiliki batasan sumber daya yang lebih ketat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kadang-kadang suatu metode tidak harus asinkron, tetapi mengembalikan Tugas </font></font><code>&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T </font></font><code>&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan memungkinkan pihak lain untuk menanganinya. Jika kalimat terakhir dari kode Anda adalah menunggu pengembalian, Anda harus mempertimbangkan refactoring sehingga jenis pengembalian metode ini adalah Tugas </font></font><code>&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T</font></font><code>&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(bukan T async). </font><font style="vertical-align: inherit;">Karena itu, Anda menghindari membuat mesin negara, yang membuat kode Anda lebih fleksibel. </font><font style="vertical-align: inherit;">Satu-satunya kasus yang benar-benar ingin kita tunggu adalah ketika kita melakukan sesuatu dengan async Task yang menghasilkan kelanjutan dari metode ini.</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;<span class="hljs-keyword">string</span>&gt; <span class="hljs-title">AsyncTask</span>(<span class="hljs-params"></span>)</span><font></font>
<font></font>
{<font></font>
   <span class="hljs-comment">//  !</span>
   <span class="hljs-comment">//...  -  </span>
   <span class="hljs-comment">//await -   ,  await  </span><font></font>
<font></font>
   <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> GetData();<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> Task&lt;<span class="hljs-keyword">string</span>&gt; <span class="hljs-title">JustTask</span>(<span class="hljs-params"></span>)</span><font></font>
<font></font>
{<font></font>
   <span class="hljs-comment">//!</span>
   <span class="hljs-comment">//...  -  </span>
   <span class="hljs-comment">// Task</span><font></font>
<font></font>
   <span class="hljs-keyword">return</span> GetData();<font></font>
<font></font>
}</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lebih suka mengembalikan Tugas daripada kembali menunggu.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Perhatikan bahwa jika kita tidak memiliki menunggu dan bukannya mengembalikan Tugas </font></font><code>&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T </font></font><code>&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, pengembalian terjadi segera, jadi jika kode berada di dalam blok coba / tangkap, pengecualian tidak akan ditangkap. </font><font style="vertical-align: inherit;">Demikian pula, jika kode berada di dalam blok menggunakan, ia akan segera menghapus objek. </font><font style="vertical-align: inherit;">Lihat tip selanjutnya.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jangan bungkus kembali tugas di dalam try..catch {} atau menggunakan {} blok</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tugas Kembali dapat menyebabkan perilaku tidak terdefinisi ketika digunakan di dalam blok try..catch (pengecualian yang dilemparkan oleh metode asinkron tidak akan pernah ditangkap) atau di dalam blok menggunakan, karena tugas akan segera dikembalikan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda perlu membungkus kode asinkron Anda dalam try..catch atau menggunakan blok, gunakan return await.</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> Task&lt;<span class="hljs-keyword">string</span>&gt; <span class="hljs-title">ReturnTaskExceptionNotCaught</span>(<span class="hljs-params"></span>)</span><font></font>
<font></font>
{<font></font>
   <span class="hljs-keyword">try</span><font></font>
   {<font></font>
       <span class="hljs-comment">// ...</span><font></font>
<font></font>
       <span class="hljs-keyword">return</span> GetData();<font></font>
<font></font>
   }<font></font>
   <span class="hljs-keyword">catch</span> (Exception ex)<font></font>
<font></font>
   {<font></font>
       <span class="hljs-comment">//     </span><font></font>
<font></font>
       Debug.WriteLine(ex.Message);<font></font>
       <span class="hljs-keyword">throw</span>;<font></font>
   }<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> Task&lt;<span class="hljs-keyword">string</span>&gt; <span class="hljs-title">ReturnTaskUsingProblem</span>(<span class="hljs-params"></span>)</span><font></font>
<font></font>
{<font></font>
   <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> resource = GetResource())<font></font>
   {<font></font>
<font></font>
       <span class="hljs-comment">// ...  ,     , ,    </span><font></font>
<font></font>
       <span class="hljs-keyword">return</span> GetData(resource);<font></font>
   }<font></font>
}</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jangan membungkus tugas kembali di dalam blok </font></font><code>try..catch{}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atau</font></font><code>using{}</code></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Informasi lebih lanjut di </font><font style="vertical-align: inherit;">utas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tentang stack overflow.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hindari menggunakan </font></font><code>.Wait()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atau </font></font><code>.Result</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- gunakan saja</font></font><code>GetAwaiter().GetResult()</code></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">perlu memblokir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> menunggu Tugas Async untuk menyelesaikan, gunakan </font></font><code>GetAwaiter().GetResult().</code> <code>Wait</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan </font></font><code>Result</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">masukkan pengecualian </font></font><code>AggregateException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, yang mempersulit penanganan kesalahan. </font><font style="vertical-align: inherit;">Keuntungannya </font></font><code>GetAwaiter().GetResult()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">adalah ia mengembalikan pengecualian biasa </font></font><code>AggregateException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">GetAwaiterGetResultExample</span>(<span class="hljs-params"></span>)</span><font></font>
<font></font>
{<font></font>
   <span class="hljs-comment">// ,    ,     AggregateException  </span><font></font>
<font></font>
   <span class="hljs-keyword">string</span> data = GetData().Result;<font></font>
<font></font>
   <span class="hljs-comment">// ,   ,      </span><font></font>
<font></font>
   data = GetData().GetAwaiter().GetResult();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda perlu memblokir menunggu Tugas Async untuk diselesaikan, gunakan </font></font><code>GetAwaiter().GetResult().</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
informasi selengkapnya di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tautan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ini </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika metode ini tidak sinkron, tambahkan akhiran Async ke namanya</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini adalah konvensi yang digunakan dalam .NET untuk lebih mudah membedakan antara metode sinkron dan asinkron (dengan pengecualian event handler atau metode pengontrol web, tetapi mereka masih tidak boleh secara eksplisit dipanggil oleh kode Anda).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metode pustaka asinkron harus menggunakan Task.ConfigureAwait (false) untuk meningkatkan kinerja</font></font></h3><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NET Framework. Memiliki konsep "konteks sinkronisasi," yang merupakan cara untuk "kembali ke tempat Anda sebelumnya." Setiap kali Tugas sedang menunggu, itu menangkap konteks sinkronisasi saat ini sebelum menunggu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah Tugas selesai </font></font><code>.Post()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font><font style="vertical-align: inherit;">metode </font><font style="vertical-align: inherit;">konteks sinkronisasi </font><font style="vertical-align: inherit;">dipanggil </font><font style="vertical-align: inherit;">, yang melanjutkan pekerjaan dari sebelumnya. Ini berguna untuk kembali ke utas antarmuka pengguna atau untuk kembali ke konteks ASP.NET yang sama, dll.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat menulis kode pustaka, Anda jarang perlu kembali ke konteks sebelumnya. Ketika Task.ConfigureAwait (false) digunakan, kode tidak lagi mencoba untuk melanjutkan dari tempat sebelumnya, sebaliknya, jika mungkin, kode keluar di utas yang menyelesaikan tugas, yang menghindari pengalihan konteks. Ini sedikit meningkatkan kinerja dan dapat membantu menghindari kebuntuan.</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">ConfigureAwaitExample</span>(<span class="hljs-params"></span>)</span><font></font>
<font></font>
{<font></font>
   <span class="hljs-comment">//   ConfigureAwait(false)   .</span><font></font>
<font></font>
   <span class="hljs-keyword">var</span> data = <span class="hljs-keyword">await</span> GetData().ConfigureAwait(<span class="hljs-literal">false</span>);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Biasanya, gunakan ConfigureAwait (false) untuk proses server dan kode pustaka. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini sangat penting ketika metode perpustakaan disebut sejumlah besar kali, untuk respon yang lebih baik. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Biasanya, gunakan ConfigureAwait (false) untuk proses server secara umum. Kami tidak peduli utas mana yang digunakan untuk melanjutkan, tidak seperti aplikasi yang kami perlukan untuk kembali ke utas antarmuka pengguna. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang ... Di ASP.NET Core, Microsoft telah menghapus SynchronizationContext, jadi secara teoritis Anda tidak memerlukan itu. Tetapi jika Anda menulis kode perpustakaan yang berpotensi digunakan kembali di aplikasi lain (mis. Aplikasi UI, Legacy ASP.NET, Formulir Xamarin), ini </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tetap merupakan praktik terbaik</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk penjelasan yang baik tentang konsep ini, tonton </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">video ini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Laporan kemajuan tugas tidak sinkron</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kasus penggunaan yang cukup umum untuk metode asinkron adalah bekerja di latar belakang, membebaskan utas antarmuka pengguna untuk tugas-tugas lain, dan memelihara daya tanggap. Dalam skenario ini, Anda mungkin ingin melaporkan kemajuan kembali ke antarmuka pengguna sehingga pengguna dapat memantau kemajuan proses dan berinteraksi dengan operasi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mengatasi masalah umum ini, .NET menyediakan antarmuka IProgress </font></font><code>&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T </font></font><code>&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, yang menyediakan metode Laporan </font></font><code>&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T </font></font><code>&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, yang dipanggil oleh tugas asinkron untuk melaporkan progres ke pemanggil. Antarmuka ini diterima sebagai parameter dari metode asinkron - penelepon harus menyediakan objek yang mengimplementasikan antarmuka ini.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
.NET menyediakan Progress </font></font><code>&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T </font></font><code>&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, implementasi standar IProgress </font></font><code>&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T </font></font><code>&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, yang sebenarnya direkomendasikan, karena menangani semua logika tingkat rendah yang terkait dengan menyimpan dan memulihkan konteks sinkronisasi. Progress </font></font><code>&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T </font></font><code>&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">juga menyediakan acara Tindakan </font></font><code>&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T </font><font style="vertical-align: inherit;">dan panggilan balik </font></font><code>&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- keduanya dipanggil saat tugas melaporkan kemajuan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bersama-sama, IProgress </font></font><code>&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T </font></font><code>&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan Progress </font></font><code>&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T </font></font><code>&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menyediakan cara mudah untuk mentransfer informasi kemajuan dari tugas latar belakang ke utas antarmuka pengguna. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Harap dicatat bahwa </font></font><code>&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T</font></font><code>&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itu bisa berupa nilai sederhana, seperti int, atau objek yang menyediakan informasi kemajuan kontekstual, seperti persentase penyelesaian, deskripsi string operasi saat ini, ETA, dan sebagainya. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertimbangkan seberapa sering Anda melaporkan kemajuan. </font><font style="vertical-align: inherit;">Bergantung pada operasi yang Anda lakukan, Anda mungkin menemukan bahwa kode Anda melaporkan kemajuan beberapa kali per detik, yang dapat mengakibatkan antarmuka pengguna menjadi kurang responsif. </font><font style="vertical-align: inherit;">Dalam skenario seperti itu, disarankan agar kemajuan dilaporkan pada interval yang lebih besar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Informasi lebih lanjut dalam </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">artikel ini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> di blog Microsoft .NET resmi.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Batalkan Tugas Asinkron</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kasus penggunaan umum lainnya untuk tugas latar belakang adalah kemampuan untuk membatalkan eksekusi. </font><font style="vertical-align: inherit;">.NET menyediakan kelas CancelledToken. </font><font style="vertical-align: inherit;">Metode asinkron menerima objek Pembatalan, yang kemudian dibagikan oleh kode pesta panggilan dan metode asinkron, sehingga menyediakan mekanisme untuk pensinyalan pembatalan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam kasus yang paling umum, pembatalan terjadi sebagai berikut:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penelepon membuat objek PembatalanTokenSource.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penelepon memanggil API asinkron yang dibatalkan dan melewati CancurToken dari CancurTokenSource (CancurTokenSource.Token).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penelepon meminta pembatalan menggunakan objek PembatalanTokenSource (PembatalanTokenSource.Cancel ()).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tugas mengkonfirmasi pembatalan dan membatalkan itu sendiri, biasanya menggunakan metode PembatalanToken.ThrowIfCancellationRequested.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Harap perhatikan bahwa agar mekanisme ini berfungsi, Anda harus menulis kode untuk memeriksa pembatalan yang diminta secara berkala (mis. Pada setiap iterasi kode Anda atau pada breakpoint alami dalam logika). </font><font style="vertical-align: inherit;">Idealnya, setelah permintaan dibatalkan, tugas asinkron harus dibatalkan secepat mungkin. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda harus mempertimbangkan untuk menggunakan undo untuk semua metode yang bisa memakan waktu lama untuk diselesaikan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Informasi lebih lanjut dalam </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">artikel ini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> di blog Microsoft .NET resmi.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Laporan Kemajuan dan Pembatalan - Contoh</font></font></h4><br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Threading.Tasks;
<span class="hljs-keyword">using</span> System.Windows.Forms;
<span class="hljs-keyword">using</span> System.Threading;
<span class="hljs-keyword">namespace</span> <span class="hljs-title">TestAsyncAwait</span><font></font>
{<font></font>
   <span class="hljs-keyword">public</span> <span class="hljs-keyword">partial</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AsyncProgressCancelExampleForm</span> : <span class="hljs-title">Form</span><font></font>
   {<font></font>
       <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AsyncProgressCancelExampleForm</span>(<span class="hljs-params"></span>)</span><font></font>
       {<font></font>
           InitializeComponent();<font></font>
       }<font></font>
<font></font>
       CancellationTokenSource _cts = <span class="hljs-keyword">new</span> CancellationTokenSource();<font></font>
<font></font>
       <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">void</span> <span class="hljs-title">btnRunAsync_Click</span>(<span class="hljs-params"><span class="hljs-keyword">object</span> sender, EventArgs e</span>)</span><font></font>
<font></font>
       {<font></font>
<font></font>
           <span class="hljs-comment">//   .</span><font></font>
<font></font>
            &lt;<span class="hljs-keyword">int</span>&gt;   ,          ,   ,    , ETA  . .<font></font>
<font></font>
           <span class="hljs-keyword">var</span> progressIndicator = <span class="hljs-keyword">new</span> Progress&lt;<span class="hljs-keyword">int</span>&gt;(ReportProgress);<font></font>
<font></font>
           <span class="hljs-keyword">try</span><font></font>
<font></font>
           {<font></font>
               <span class="hljs-comment">//   ,         </span><font></font>
<font></font>
               <span class="hljs-keyword">await</span> AsyncMethod(progressIndicator, _cts.Token);<font></font>
<font></font>
           }<font></font>
<font></font>
           <span class="hljs-keyword">catch</span> (OperationCanceledException ex)<font></font>
<font></font>
           {<font></font>
               <span class="hljs-comment">// </span><font></font>
<font></font>
               lblProgress.Text = <span class="hljs-string">"Cancelled"</span>;<font></font>
           }<font></font>
       }<font></font>
<font></font>
       <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">btnCancel_Click</span>(<span class="hljs-params"><span class="hljs-keyword">object</span> sender, EventArgs e</span>)</span><font></font>
<font></font>
       {<font></font>
          <span class="hljs-comment">// </span><font></font>
           _cts.Cancel();<font></font>
<font></font>
       }<font></font>
<font></font>
       <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ReportProgress</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> <span class="hljs-keyword">value</span></span>)</span><font></font>
<font></font>
       {<font></font>
           <span class="hljs-comment">//    </span><font></font>
<font></font>
           lblProgress.Text = <span class="hljs-keyword">value</span>.ToString();<font></font>
<font></font>
       }<font></font>
<font></font>
       <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">AsyncMethod</span>(<span class="hljs-params">IProgress&lt;<span class="hljs-keyword">int</span>&gt; progress, CancellationToken ct</span>)</span><font></font>
<font></font>
       {<font></font>
<font></font>
           <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++)<font></font>
<font></font>
           {<font></font>
              <span class="hljs-comment">//   ,     </span><font></font>
<font></font>
               <span class="hljs-keyword">await</span> Task.Delay(<span class="hljs-number">1000</span>);<font></font>
<font></font>
               <span class="hljs-comment">//   </span><font></font>
<font></font>
               <span class="hljs-keyword">if</span> (ct != <span class="hljs-literal">null</span>)<font></font>
<font></font>
               {<font></font>
<font></font>
                   ct.ThrowIfCancellationRequested();<font></font>
<font></font>
               }<font></font>
<font></font>
               <span class="hljs-comment">//   </span><font></font>
<font></font>
               <span class="hljs-keyword">if</span> (progress != <span class="hljs-literal">null</span>)<font></font>
<font></font>
               {<font></font>
<font></font>
                   progress.Report(i);<font></font>
               }<font></font>
           }<font></font>
       }<font></font>
   }<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menunggu beberapa saat</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda perlu menunggu beberapa saat (misalnya, coba lagi untuk memeriksa ketersediaan sumber daya), pastikan untuk menggunakan Task.Delay - jangan pernah menggunakan Thread. Tidur dalam skenario ini.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menunggu beberapa tugas tidak sinkron diselesaikan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gunakan Task.WaitAny untuk menunggu penyelesaian tugas apa pun. </font><font style="vertical-align: inherit;">Gunakan Task.WaitAll untuk menunggu semua tugas selesai. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apakah saya harus buru-buru beralih ke C # 7 atau 8? </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mendaftar untuk webinar gratis</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk membahas topik ini.</font></font></b></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id488058/index.html">Graphing Dummies: Panduan Selangkah demi Selangkah</a></li>
<li><a href="../id488060/index.html">Backblaze - statistik hard drive 2019</a></li>
<li><a href="../id488062/index.html">Dynamics 365 & Rapat Platform Daya di Lamoda - Laporkan</a></li>
<li><a href="../id488072/index.html">Apakah Koin Dependency Injection atau Service Locator?</a></li>
<li><a href="../id488078/index.html">Bot saya untuk Piala AI Rusia 2019</a></li>
<li><a href="../id488088/index.html">Bagaimana Habr berinteraksi dengan badan-badan negara dan pelamar lainnya. Laporan transparansi untuk semua tahun</a></li>
<li><a href="../id488092/index.html">Hackathons. Cara memaksimalkan dan bertahan</a></li>
<li><a href="../id488096/index.html">400g. Lihat dari sisi Transmisi. ZR / ZR +</a></li>
<li><a href="../id488098/index.html">Cara membuat proyek Django dari templat</a></li>
<li><a href="../id488102/index.html">Hubungan antara C # dan C #: REST, gRPC dan semua yang ada di antaranya</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>