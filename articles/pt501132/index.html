<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§ôüèΩ üßôüèΩ ü§≤üèø Como melhorar o trabalho com o Microsoft Remote Desktop üëéüèø ü§§ üåº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quero compartilhar algumas dicas sobre a configura√ß√£o da conex√£o remota com as esta√ß√µes de trabalho via RDP. Vou lhe dizer como atualizar o antigo RPC...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Como melhorar o trabalho com o Microsoft Remote Desktop</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/501132/"><img src="https://habrastorage.org/webt/dx/s8/wi/dxs8wiugrbhaov1gzied15gldk8.png" align="left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quero compartilhar algumas dicas sobre a configura√ß√£o da conex√£o remota com as esta√ß√µes de trabalho via RDP. Vou lhe dizer como atualizar o antigo RPC-HTTP para UDP, elogiar e repreender o Windows 10 e o AVC; vou descobrir uma solu√ß√£o para v√°rios problemas t√≠picos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acreditamos que o Gateway de √Årea de Trabalho Remota (RDGW) √© usado para conex√£o e as esta√ß√µes de trabalho atuam como servidores. O uso do RDGW √© muito conveniente, pois o gateway se torna um ponto de entrada comum para todos os clientes. Isso torna poss√≠vel controlar melhor o acesso, manter registros de conex√µes e sua dura√ß√£o. Mesmo se a VPN permitir que voc√™ se conecte diretamente √†s m√°quinas em funcionamento, essa n√£o √© a melhor op√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O RDGW √© r√°pido, f√°cil de configurar e o Let's Encrypt and win-acme resolve facilmente o problema com um certificado confi√°vel.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem tr√™s protocolos de transporte nos quais o cliente pode se conectar ao servidor: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RPC-HTTP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><font color="red"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">incorreto</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><font color="orange"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">melhor</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP + UDP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><font color="green"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">excelente</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por servidor, entendemos uma m√°quina em funcionamento, por um cliente - em casa. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A primeira coisa a come√ßar √© transformar "ruim" em "excelente".</font></font><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Atualizar RPC-HTTP para HTTP</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A conex√£o com uma sess√£o usando RPC-HTTP √© f√°cil de determinar pela apar√™ncia da faixa de conex√£o. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7w/-0/aa/7w-0aativt247pvbumddqkf4epg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o h√° √≠cone de qualidade de conex√£o (sobre isso abaixo), o que significa que estamos usando o RPC antigo incorporado no TLS - isso √© muito lento. </font><font style="vertical-align: inherit;">O ponto, √© claro, n√£o est√° apenas no inv√≥lucro - o pr√≥prio protocolo muda a cada vers√£o do SO, codecs, algoritmos de empacotamento de imagens. </font><font style="vertical-align: inherit;">Quanto mais atualizado o protocolo, melhor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que fazer?</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows XP ou Vista</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No XP, voc√™ pode aumentar o protocolo de 5.1 para 7. O </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hotfix do windowsxp-kb969084-x86.exe</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
No Vista, de 6 para 7. O hotfix tem o mesmo n√∫mero, os </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arquivos windows6.0-kb969084-x64.msu ou Windows6.0-KB969084-x86 .msu</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Mas o RDP 7 n√£o funciona com HTTP e UDP. Atualize apenas o cliente e o servidor para o Windows 7 e posterior. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 7</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Primeiro, voc√™ precisa atualizar o protocolo para o RDP 8.1 e depois ativ√°-lo. O suporte √© adicionado por atualiza√ß√µes agrupadas em um √∫nico pacote de download: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.microsoft.com/en-US/download/details.aspx?id=40986</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Windows6.1-KB2574819-v2-x64.msu </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
windows6.1-kb2592687-x64.msu </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Windows6.1-KB2830477-x64.msu </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Windows6.1-KB2857650-x64.msu </font></font><br>
<s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows6.1-KB2913751-x64.msu</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (substitu√≠do por kb2923545)</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">windows6.1-kb2923545-x64.msu</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Portanto, voc√™ obt√©m o novo cliente mstsc.exe e o suporte ao RDP 8.1 para o lado do servidor do sistema operacional. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Foi: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yx/37/pl/yx37plxdymw73eubymzh1v0zgzm.png"><br>
<br>
<img src="https://habrastorage.org/webt/r1/kh/ip/r1khiphuyrmxmmodab_ecjiktiq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tornou-se: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rt/9v/dj/rt9vdjdnfmus27h9nyn7ctpyp7g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois disso, o protocolo deve ser ativado com a chave do registro (para isso, voc√™ pode usar o modelo adm inclu√≠do no Windows 7).</font></font><br>
<br>
<pre><code class="powershell hljs">[<span class="hljs-type">HKEY_LOCAL_MACHINE</span>\<span class="hljs-type">SOFTWARE</span>\<span class="hljs-type">Policies</span>\<span class="hljs-type">Microsoft</span>\<span class="hljs-type">Windows</span> <span class="hljs-type">NT</span>\<span class="hljs-type">Terminal</span> <span class="hljs-type">Services</span>]
<span class="hljs-string">"fServerEnableRDP8"</span>=dword:<span class="hljs-number">00000001</span><font></font>
 <font></font>
[<span class="hljs-type">HKEY_LOCAL_MACHINE</span>\<span class="hljs-type">SOFTWARE</span>\<span class="hljs-type">Wow6432Node</span>\<span class="hljs-type">Policies</span>\<span class="hljs-type">Microsoft</span>\<span class="hljs-type">Windows</span> <span class="hljs-type">NT</span>\<span class="hljs-type">Terminal</span> <span class="hljs-type">Services</span>]
<span class="hljs-string">"fServerEnableRDP8"</span>=dword:<span class="hljs-number">00000001</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Habilite o suporte ao transporte UDP na Diretiva de Grupo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bg/_t/ds/bg_tdse5uudrekmylffvhh_gqzq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Reinicializamos o servidor com o Windows 7. O mesmo caso, quando voc√™ precisar reiniciar duas vezes - o valor no registro deve ser definido antes que o RDP seja ativado e a Diretiva de Grupo aplicada posteriormente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se tudo </font><font style="vertical-align: inherit;">
der </font><font style="vertical-align: inherit;">certo, quando voc√™ se conectar ao servidor, um √≠cone de qualidade de conex√£o (como em um telefone para uma rede m√≥vel) aparecer√° na barra de sess√µes: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8b/_0/ok/8b_0okltugyxpizhhcydchtsve8.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 8 e mais recente O</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> protocolo funciona imediatamente.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Atualizar HTTP para HTTP + UDP</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se a sua rede n√£o estiver propensa a perda de pacotes, o UDP melhorar√° drasticamente (para CAD - drasticamente) a capacidade de resposta do servidor usando o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FEC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para reduzir a retransmiss√£o, al√©m de alternar a confirma√ß√£o da entrega de pacotes da pilha do sistema TCP / IP para o n√≠vel do protocolo RDP-UDP. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma sess√£o de controle principal via HTTP √© conectada a partir de cada cliente (um teclado / mouse tamb√©m √© transmitido neste canal), al√©m de uma ou mais sess√µes UDP para transmitir uma imagem ou outros canais virtuais.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos tocar apenas a ponta do iceberg. Existem 3 vers√µes diferentes do protocolo RDP-UDP. Al√©m disso, o pr√≥prio UDP pode operar em dois modos: UDP-R (confi√°vel) e UDP-L (com perdas). Nada acontece com a Microsoft. Mas como nada depende de n√≥s aqui, lembre-se: quanto mais novo o sistema operacional, o t√≥pico usa um protocolo mais moderno. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√° fora, o RDP-UDP est√° envolvido no DFCL34 (DTagram Transport Layer Security) RFC4347, como voc√™ pode ver ao abrir o Wireshark. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais detalhes nos documentos: </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[MS-RDPEMT]: Protocolo de √°rea de trabalho remota: Extens√£o </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de transporte m√∫ltiplo [MS-RDPEUDP]: Protocolo de √°rea de trabalho remota: Extens√£o de transporte UDP </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[MS-RDPEUDP2]: Protocolo de √°rea de trabalho remota: Vers√£o 2 de extens√£o de transporte UDP</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Onde incorreto, correto de nada.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que voc√™ precisa para ativar o UDP? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O RDP-UDP √© suportado a partir do RDP 8. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A porta udp / 3389 deve estar aberta no cliente. Se voc√™ o fechou com um firewall local, ACL no switch ou um firewall externo - a porta deve ser aberta. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para o servidor Gateway de √Årea de Trabalho Remota na porta TCP / 443, abra o udp / 3391. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A porta pode ser alterada, eis como est√° configurada: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/o6/n0/w3/o6n0w3fmookrhmxaqomyx8wretk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No Windows 7, o NLA (autentica√ß√£o no n√≠vel da rede) deve estar ativado. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nt/kz/ny/ntkznyeqsvsh3msad2u59_rxcck.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pode ser ativado na Diretiva de Grupo </font></font><br>
<br>
<img src="https://habrastorage.org/webt/my/hj/sw/myhjswie2h7znzjoamnhf6clzq4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ou atrav√©s do registro</font></font><br>
<br>
<pre><code class="powershell hljs">[<span class="hljs-type">HKEY_LOCAL_MACHINE</span>\<span class="hljs-type">SYSTEM</span>\<span class="hljs-type">CurrentControlSet</span>\<span class="hljs-type">Control</span>\<span class="hljs-type">Terminal</span> <span class="hljs-type">Server</span>\<span class="hljs-type">WinStations</span>\<span class="hljs-type">RDP</span>-<span class="hljs-type">Tcp</span>]
<span class="hljs-string">"SecurityLayer"</span>=dword:<span class="hljs-number">00000001</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Qual √© a conex√£o n√£o est√° clara. Mas sem o NLA no 7-ke n√£o funciona, em vers√µes mais recentes do NLA para o trabalho, o UDP n√£o √© necess√°rio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de estabelecer uma sess√£o por HTTP, o cliente e o servidor </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tentam</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> negociar uma conex√£o UDP. Se houver perda ou atraso de pacotes, a sess√£o UDP n√£o ser√° iniciada. O algoritmo exato de falha de negocia√ß√£o UDP n√£o √© totalmente compreendido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se tudo estiver configurado, ap√≥s a conex√£o, clique no bot√£o Qualidade do link. A janela indicar√° que o UDP est√° negociado. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/d7/y4/jx/d7y4jx5ubs4i9zop5myyzg21oyo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No gateway, fica assim: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/oc/ld/7n/ocld7nbslu8dt_fjahnvd-zqvso.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 10</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ possui o Windows 10 no servidor e no cliente, essa √© a op√ß√£o mais r√°pida e sem problemas. A Microsoft est√° finalizando ativamente o RDP e, nas vers√µes mais recentes 10, voc√™ pode contar com uma boa velocidade. Os colegas n√£o conseguiram detectar a diferen√ßa entre o Citrix e o Windows 10 RDP na velocidade do AutoCAD. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° um bom artigo sobre a evolu√ß√£o dos codecs RDP baseados em AVC no Windows 10 </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remote Desktop Protocol (RDP) 10 Melhorias no AVC / H.264 no Windows 10 e na Visualiza√ß√£o T√©cnica do Windows Server 2016 A</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
correspond√™ncia entre AVC e codifica√ß√£o de hardware pode ser vista no log de eventos (consulte o artigo acima para obter mais detalhes) ):</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kf/4_/_n/kf4__nmejj4amr9nctpufhwfb6a.png"><br>
<br>
<img src="https://habrastorage.org/webt/ld/rn/ld/ldrnldvgbclldmcr2f8pxoztfxo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Observo apenas que ainda h√° um problema de distor√ß√£o, mesmo com h.264 4: 4: 4. </font><font style="vertical-align: inherit;">Ele imediatamente chama sua aten√ß√£o se voc√™ trabalha no PowerShell ISE - o texto do erro √© exibido com distor√ß√£o desagrad√°vel. </font><font style="vertical-align: inherit;">Al√©m disso, est√° tudo bem na captura de tela e na foto. </font><font style="vertical-align: inherit;">Magia. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tamb√©m um sinal indireto do trabalho da AVC aparece, de tempos em tempos, quadrados verdes nos cantos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A codifica√ß√£o do AVC e do hardware em novas vers√µes deve funcionar imediatamente, mas a pol√≠tica de grupo nunca √© sup√©rflua: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pn/hc/uo/pnhcuobl3frw-p4pfodd9xr_tsa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como o AVC √© codificado por hardware com uma placa de v√≠deo, √© recomend√°vel atualizar os drivers de v√≠deo.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sobre problemas</font></font></h1><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XP e Vista</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Se o problema ocorrer no Windows XP ou Vista, tente atualizar o protocolo para a vers√£o 7 primeiro (escrito no in√≠cio do artigo). Certifique-se de ativar o suporte CredSSP. A Microsoft j√° excluiu artigos no site, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mas a Internet se lembra</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se n√£o ajudar, "o m√©dico fala com o necrot√©rio, depois com o necrot√©rio". O que o sistema operacional experimentou nos √∫ltimos 15 anos √© melhor nem pensar nisso. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NLA</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
√Äs vezes, ajuda a desativar o NLA no servidor. N√£o deu certo a causa, os carros da casa s√£o todos diferentes. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NTLM</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Alguns clientes tentam fazer login usando NTLMv1. Os motivos s√£o diferentes, mas voc√™ pode corrigi-lo no cliente assim:</font></font><br>
<br>
<pre><code class="powershell hljs">[<span class="hljs-type">HKEY_LOCAL_MACHINE</span>\<span class="hljs-type">SYSTEM</span>\<span class="hljs-type">CurrentControlSet</span>\<span class="hljs-type">Control</span>\<span class="hljs-type">Lsa</span>]
<span class="hljs-string">"LmCompatibilityLevel"</span>=dword:<span class="hljs-number">00000003</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â necess√°rio reiniciar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© jovem e</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tem medo de nada, existe uma solu√ß√£o mais radical - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desabilitar a vincula√ß√£o de canal</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no Gateway de √Årea de Trabalho Remota</font></font><br>
<br>
<pre><code class="powershell hljs">HKLM\Software\Microsoft\Windows NT\CurrentVersion\TerminalServerGateway\Config\Core
<span class="hljs-built_in">Type</span>: REG_DWORD<font></font>
Name: EnforceChannelBinding<font></font>
Value: <span class="hljs-number">0</span> (Decimal)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ n√£o precisa fazer isso. </font><font style="vertical-align: inherit;">Mas n√≥s fizemos. </font><font style="vertical-align: inherit;">:-) Para um cliente que insistiu (n√£o est√° errado, insistiu) que NTLMv1 nas esta√ß√µes de trabalho que ele precisava. </font><font style="vertical-align: inherit;">N√£o sei, talvez ainda existam servidores no NT4 sem SP ainda em opera√ß√£o. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desativando o RDP 8+ no Windows 10</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Se tudo mais falhar e as ideias acabarem, voc√™ poder√° usar a chave n√£o documentada para fazer o downgrade do protocolo RDP para a vers√£o 7.</font></font><br>
<br>
<pre><code class="powershell hljs">[<span class="hljs-type">HKEY_CURRENT_USER</span>\<span class="hljs-type">Software</span>\<span class="hljs-type">Microsoft</span>\<span class="hljs-type">Terminal</span> <span class="hljs-type">Server</span> <span class="hljs-type">Client</span>]
<span class="hljs-string">"RDGClientTransport"</span>=dword:<span class="hljs-number">00000001</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu n√£o fiz isso sozinho e n√£o o aconselho. Mas para algu√©m, eles escrevem que isso ajuda. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
componente </font><b><font style="vertical-align: inherit;">DrWeb</font></b><font style="vertical-align: inherit;"> Dr.Web SpIDerGate pode proibir a conex√£o. Nesse caso, um erro √© retornado: </font></font><br>
<img src="https://habrastorage.org/webt/fs/76/zj/fs76zj-otc0v-v_qxkkwa0gviwo.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Haver√° um registro nas estat√≠sticas do Dr.Web </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">Um </font></font><br>
<img src="https://habrastorage.org/webt/ik/fe/qy/ikfeqyljaepzhnieksw4qsomh6y.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
funcion√°rio do </font><font style="vertical-align: inherit;">Dr.Web </font><font style="vertical-align: inherit;">me contatou nos coment√°rios deste artigo e nosso problema foi resolvido na pr√≥xima atualiza√ß√£o dos bancos de dados de antiv√≠rus. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ tiver o mesmo erro, √© melhor entrar em contato com o suporte. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como solu√ß√£o tempor√°ria, voc√™ pode adicionar o URL do seu RDGW √†s exce√ß√µes: </font></font><br>
<img src="https://habrastorage.org/webt/7c/do/k-/7cdok-2f6-4f2jj-bhlmjwqd2tq.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E somente se isso n√£o ajudar a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desativar completamente o componente SpIDer Gate</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Proxy do sistema Encontrei</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
um computador desativado de alguma empresa em que um TMG local foi registrado como proxy do sistema e a conex√£o com o RDGW n√£o funcionou. Isso pode ser corrigido assim:</font></font><br>
<br>
<pre><code class="powershell hljs">netsh winhttp show proxy &amp;&amp; netsh winhttp reset proxy</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alternando layouts de teclado</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
√Äs vezes, layouts extras s√£o fornecidos. </font><font style="vertical-align: inherit;">Voc√™ pode desativar o encaminhamento de layout do cliente</font></font><br>
<pre><code class="powershell hljs">[<span class="hljs-type">HKLM</span>\<span class="hljs-type">System</span>\<span class="hljs-type">CurrentControlSet</span>\<span class="hljs-type">Control</span>\<span class="hljs-type">Keyboard</span> <span class="hljs-type">Layout</span>]
<span class="hljs-string">"IgnoreRemoteKeyboardLayout"</span>=dword:<span class="hljs-number">00000001</span></code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Problemas de DPI O</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
dimensionamento vem da m√°quina cliente e, se custar 125% em um laptop dom√©stico, ser√° o mesmo em uma m√°quina em funcionamento. </font><font style="vertical-align: inherit;">Nos servidores, isso pode ser desativado, mas nas esta√ß√µes de trabalho n√£o consegui encontrar como. </font><font style="vertical-align: inherit;">Mas a loja de aplicativos do Windows 10 tem um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cliente "moderno"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode configurar o DPI nele:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ig/dz/sm/igdzsmxjjsxc7bsmrixgkbachpm.png"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como monitorar um gateway com RDGW</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existe um contador de desempenho "TS Gateway \ Current Connections", que √© um pouco problem√°tico se n√£o houver conex√µes ou se o servidor n√£o tiver sido reinicializado por um longo tempo. Mostra exatamente o n√∫mero de conex√µes, mas, como lembramos, para HTTP + UDP h√° pelo menos duas e talvez mais. Portanto, esse n√£o √© um indicador completamente objetivo do n√∫mero de conex√µes de funcion√°rios. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° uma classe WMI Win32_TSGatewayConnection. Seu conte√∫do corresponde ao que voc√™ v√™ na se√ß√£o Monitoramento do Gateway de √Årea de Trabalho Remota. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com ele, o n√∫mero de conex√µes pode ser calculado com mais precis√£o:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-WmiObject</span> <span class="hljs-literal">-class</span> <span class="hljs-string">"Win32_TSGatewayConnection"</span> <span class="hljs-literal">-namespace</span> <span class="hljs-string">"root\cimv2\TerminalServices"</span> 
|?{<span class="hljs-variable">$_</span>.transportprotocol <span class="hljs-operator">-ne</span> <span class="hljs-number">2</span>}|<span class="hljs-built_in">select</span> username,connectedresource|<span class="hljs-built_in">sort</span> username|<span class="hljs-built_in">Get-Unique</span> <span class="hljs-literal">-AsString</span>| <span class="hljs-built_in">measure</span>|<span class="hljs-built_in">select</span> <span class="hljs-literal">-ExpandProperty</span> count
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apenas por divers√£o, h√° um utilit√°rio </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remote Display Analyzer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">A vers√£o gratuita n√£o me mostrou nada de √∫til, mas de repente ser√° √∫til para algu√©m. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas e o ajuste fino, ajustando algumas dezenas de par√¢metros de sess√£o? </font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O princ√≠pio de Pareto √© apropriado aqui: 20% dos esfor√ßos produzem 80% do resultado. </font><font style="vertical-align: inherit;">Se voc√™ estiver pronto para investir seu tempo nos 20% restantes do resultado - excelente. </font><font style="vertical-align: inherit;">Lembre-se de que, quando voc√™ l√™ um artigo sobre como configurar um protocolo no Windows 7, n√£o sabe sobre o protocolo sobre o qual o autor escreveu - 7, 8 ou 8.1. </font><font style="vertical-align: inherit;">Quando voc√™ l√™ sobre o Windows 10 sem especificar uma vers√£o, os problemas s√£o os mesmos. </font><font style="vertical-align: inherit;">Por exemplo, eles escrevem que, nas novas vers√µes do Windows 10, o codec AVC / h.264 mudou para RDPGFX_CODECID_AVC444 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e, no Windows Server 2016, RDPGFX_CODECID_AVC444 permanece.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De todas essas dicas, usamos apenas duas configura√ß√µes:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cores de 16 bits, voc√™ pode ler sobre isso no artigo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desempenho do MS RDP / Uso de Largura de Banda</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desabilitando a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">suaviza√ß√£o de fonte suaviza√ß√£o de fonte: i: 0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no artigo acima ou </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hosts de Sess√£o da √Årea de Trabalho Remota de Ajuste de Desempenho</font></font></a></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Duvido que eles d√™em algum resultado tang√≠vel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o, chegamos ao final do artigo. </font><font style="vertical-align: inherit;">Eu queria ser mais baixo, mas acabou como sempre. </font><font style="vertical-align: inherit;">Fico feliz que essas dicas ajudem algu√©m a economizar tempo ou melhorar a configura√ß√£o de sua infraestrutura.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt501118/index.html">Viva (Oh n√£o)</a></li>
<li><a href="../pt501120/index.html">O que √© um hub de dados do Google Ads</a></li>
<li><a href="../pt501126/index.html">Edi√ß√£o n¬∫ 38: Treinamento em TI - problemas e desafios atuais das principais empresas</a></li>
<li><a href="../pt501128/index.html">Por que o desenvolvimento de VR n√£o combina com voc√™</a></li>
<li><a href="../pt501130/index.html">Halt and Catch Fire - uma equipe que merece uma adapta√ß√£o</a></li>
<li><a href="../pt501134/index.html">Como a equipe de controle de qualidade do GitLab usa a ferramenta de desempenho do GitLab</a></li>
<li><a href="../pt501138/index.html">10 eventos online que voc√™ pode assistir no dia 2 de maio</a></li>
<li><a href="../pt501140/index.html">Aumentando a lealdade do analisador de dados do servidor no iOS</a></li>
<li><a href="../pt501142/index.html">Voc√™ est√° usando um teclado num√©rico?</a></li>
<li><a href="../pt501144/index.html">√â poss√≠vel cortar o c√©rebro com som</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>