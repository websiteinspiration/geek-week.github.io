<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛁 💜 🌯 Unityでリズムゲームを作成する ☝🏻 👨🏻‍🏭 🔢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="前書き
 つまり、リズムゲームを作成したい、または作成しようとしたが、ゲームの要素と音楽がすぐに同期しなくなり、何をすべきかわからなくなったとします。この記事は、これに役立ちます。私は高校のリズムゲームをプレイし、地元のアーケードホールのDDRにたむろしていました。今日、私は常にこのジャンルの新しい...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Unityでリズムゲームを作成する</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452168/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/98c/c5f/e21/98cc5fe21847a5826eb9fb9e396e3379.jpg" alt="画像"></div><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前書き</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、リズムゲームを作成したい、または作成しようとしたが、ゲームの要素と音楽がすぐに同期しなくなり、何をすべきかわからなくなったとします。この記事は、これに役立ちます。私は高校のリズムゲームをプレイし、地元のアーケードホールのDDRにたむろしていました。今日、私は常にこのジャンルの新しいゲームを探しています。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネクロダンサーのクリプト</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">や</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bit.Trip.Runner</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">などのプロジェクトは、このジャンルで</font><font style="vertical-align: inherit;">もっと多くのことができることを示しています。 Unityでリズムゲームのプロトタイプに少し取り組んだ結果、1か月かけて短いリズムゲーム/パズル</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Atomic Beatsを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作成しました</font><font style="vertical-align: inherit;">。この記事では、これらのゲームの作成で学んだ最も有用なコード構築手法について説明します。他の場所でそれらに関する情報を見つけることができなかったか、それがあまり詳細に提示されていませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リズムゲームでの音楽同期</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ハブレへの翻訳</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ] </font><font style="vertical-align: inherit;">の投稿について、Yu Chaoに</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">深く</font></a><font style="vertical-align: inherit;">感謝し</font><font style="vertical-align: inherit;">ます。 Yuは、オーディオタイミングをUnityのゲームエンジンと同期する基本を検討し、Boots-Cutゲームのソースコードをアップロードしました。これは、プロジェクトの作成に大いに役立ちました。 Unityの音楽同期の簡単な紹介を学びたい場合は、彼の投稿を学習できますが、このトピックをより詳細かつ広範囲にカバーします。私のコードは、記事とBoots-Cutコードからの情報を積極的に使用しています。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リズムゲームの中心はタイミングです。人々はリズムのタイミングのゆがみに非常に敏感なので、リズムゲームのすべてのアクション、動き、入力が音楽と直接同期することが非常に重要です。残念ながら、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Time.timeSinceLevelLoad</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">や</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Time.time</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">などの従来のUnity時間追跡メソッド</font><font style="vertical-align: inherit;">は、再生中のサウンドとの同期</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">が</font></a><font style="vertical-align: inherit;">すぐに失われます。したがって、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">AudioSettings.dspTime</font></a><font style="vertical-align: inherit;">を使用してオーディオシステムに直接アクセスします。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、オーディオシステムで処理された実際のオーディオサンプル数を使用します。</font><font style="vertical-align: inherit;">これにより、常に再生中の音楽との同期が維持されます（おそらく、非常に長いオーディオファイルの場合はそうではありません。サンプリングエフェクトが再生される場合ですが、通常の長さの楽曲の場合、システムは完全に機能するはずです）。</font><font style="vertical-align: inherit;">この関数は、コンポジション時間の追跡の中核となり、それに基づいてメインクラスを作成します。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスの指揮者</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
指揮者クラスは、リズムゲームの残りの部分が構築される基礎となる主要な作曲管理クラスです。</font><font style="vertical-align: inherit;">これにより、コンポジションの位置を追跡し、他のすべての同期アクションを管理します。</font><font style="vertical-align: inherit;">構成を追跡するには、いくつかの変数が必要です</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-comment">//Song beats per minute</span>
<span class="hljs-comment">//This is determined by the song you're trying to sync up to</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">float</span> songBpm;<font></font>
<font></font>
<span class="hljs-comment">//The number of seconds for each song beat</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">float</span> secPerBeat;<font></font>
<font></font>
<span class="hljs-comment">//Current song position, in seconds</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">float</span> songPosition;<font></font>
<font></font>
<span class="hljs-comment">//Current song position, in beats</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">float</span> songPositionInBeats;<font></font>
<font></font>
<span class="hljs-comment">//How many seconds have passed since the song started</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">float</span> dspSongTime;<font></font>
<font></font>
<span class="hljs-comment">//an AudioSource attached to this GameObject that will play the music.</span>
<span class="hljs-keyword">public</span> AudioSource musicSource;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
シーンを開始するとき、変数を決定するための計算を実行し、コンポジションの開始時間を参照するために記録する必要もあります。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-comment">//Load the AudioSource attached to the Conductor GameObject</span><font></font>
    musicSource = GetComponent&lt;AudioSource&gt;();<font></font>
<font></font>
    <span class="hljs-comment">//Calculate the number of seconds in each beat</span>
    secPerBeat = <span class="hljs-number">60f</span> / songBpm;<font></font>
<font></font>
    <span class="hljs-comment">//Record the time when the music starts</span>
    dspSongTime = (<span class="hljs-keyword">float</span>)AudioSettings.dspTime;<font></font>
<font></font>
    <span class="hljs-comment">//Start the music</span><font></font>
    musicSource.Play();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのようなスクリプトが添付された空のGameObjectを作成し、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オーディオソース</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をコンポジションとともに</font><font style="vertical-align: inherit;">追加し</font><font style="vertical-align: inherit;">てプログラムを実行すると、スクリプトがコンポジションの開始時間を記録しますが、それ以外は何も起こりません。</font><font style="vertical-align: inherit;">また、オーディオソースに追加する音楽のBPMを手動で入力する必要があります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7fc/3ac/550/7fc3ac5504438ff8bd050c50283250c6.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらすべての値のおかげで、ゲームが更新されたときに、コンポジション内の位置をリアルタイムで追跡できます。</font><font style="vertical-align: inherit;">最初に秒単位で、次に分数で、コンポジションのタイミングを決定します。</font><font style="vertical-align: inherit;">フラクションは、コンポジションを追跡するためのはるかに便利な方法です。これにより、フラクション間の秒数を計算する必要なしに、たとえばフラクション1、3、5.5のように、コンポジションと並行してアクションとタイミングを追加できます。</font><font style="vertical-align: inherit;">ConductorクラスのUpdate（）関数に次の計算を追加します。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-comment">//determine how many seconds since the song started</span>
    songPosition = (<span class="hljs-keyword">float</span>)(AudioSettings.dspTime - dspSongTime);<font></font>
<font></font>
    <span class="hljs-comment">//determine how many beats since the song started</span><font></font>
    songPositionInBeats = songPosition / secPerBeat;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、オーディオシステムに応じた現在の時間とコンポジションの開始時間の差が得られます。これにより、コンポジションが再生された合計秒数がわかります。</font><font style="vertical-align: inherit;">これをsongPosition変数に保存します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/84e/f20/a32/84ef20a3208c566d97332c89549c5a7a.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
音楽のスコアは通常、分数が1-2-3-4の単位で始まり、以下同様です。songPositionInBeatsは0から始まり、この値から増加します。そのため、コンポジションの3番目の部分は、3.0ではなく2.0であるsongPositionInBeatsに対応します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この時点で、従来のDance Dance Revolutionスタイルのゲームを作成する場合は、押し込む必要のある割合に従ってノートを作成し、クリックラインに対する位置を補間して、キーが押されたときにsongPositionInBeatsを記録する必要があります。値を目的のノートの比率と比較します。 Yu Chaoは彼の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記事</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">でそのようなスキームの例を説明してい</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。繰り返しにならないように、Conductorクラスの上に構築できる他の潜在的に有用なテクニックを検討します。作成時に使用しました</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アトミックビート</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初のシェアに適応します</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リズムゲーム用に独自の音楽を作成する場合、最初のビートを音楽の始まりと正確に一致させるのは簡単です。BPMで正しく指定されている場合、ConductorクラスsongPositionInBeatsを確実にコンポジションにバインドします。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/56a/acd/dfd/56aacddfd077d0d5890fdea4acb9d667.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、既製の音楽を使用する場合は、作曲を開始する前に少し休止する可能性が高くなります。</font><font style="vertical-align: inherit;">これが考慮されていない場合、ConductorクラスのsongPositionInBeatsは、曲の再生が始まったときに最初のビートが始まり、現時点のビートではないと考えます。</font><font style="vertical-align: inherit;">シェアの価値にさらに結び付けられるすべてのものは、音楽と同期されていません。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/981/9cc/e24/9819cce244fe54f954e0205345ec86fb.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを修正するには、このオフセットを考慮に入れる変数を追加できます。</font><font style="vertical-align: inherit;">以下をConductorクラスに追加します。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-comment">//The offset to the first beat of the song in seconds</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">float</span> firstBeatOffset;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Update（）では、songPosition変数：</font></font><br>
<br>
<pre><code class="cs hljs">songPosition = (<span class="hljs-keyword">float</span>)(AudioSettings.dspTime - dspSongTime);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
と取り換える：</font></font><br>
<br>
<pre><code class="cs hljs">songPosition = (<span class="hljs-keyword">float</span>)(AudioSettings.dspTime - dspSongTime - firstBeatOffset);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、songPositionは、真の最初のビートを考慮して、曲内の位置を正しく計算します。</font><font style="vertical-align: inherit;">ただし、最初のビートまでのオフセットを手動で入力する必要があるため、ファイルごとに一意になります。</font><font style="vertical-align: inherit;">さらに、このシフト中に、songPositionが負になることが判明する短いウィンドウがあります。</font><font style="vertical-align: inherit;">これはゲームには影響しませんが、songPositionまたはsongPositionInBeatsの値に依存する一部のコードは、現時点では負の数を処理できない場合があります。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/125/bfd/ab7/125bfdab794789a5920f1ef07bea8a26.png"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">繰り返し</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初から最後まで再生するコンポジションで作業する場合は、上記のConductorクラスで位置を追跡できます。しかし、ループされた短いトラックがあり、このループで作業したい場合は、ConductorでRepeaterサポートを組み込む必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
完全にループしたフラグメントがある場合（たとえば、曲のテンポが120bpmであり、ループしたフラグメントの長さが4ビートである場合、1共有あたり2.0秒で正確に8.0秒である必要があります）、Conductorクラスのオーディオソースにロードし、ループボックスをオンにします。指揮者は以前と同じように動作し、</font><em><font style="vertical-align: inherit;">最初</font></em><font style="vertical-align: inherit;">にsongPositionを実行してからの合計時間を経過します</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クリップを起動します。</font><font style="vertical-align: inherit;">ループの位置を決定するには、1つのループにいくつのシェアがあり、すでに再生されたループの数を、なんとかしてConductorに通知する必要があります。</font><font style="vertical-align: inherit;">以下の変数をConductorクラスに追加します。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-comment">//the number of beats in each loop</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">float</span> beatsPerLoop;<font></font>
<font></font>
<span class="hljs-comment">//the total number of loops completed since the looping clip first started</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> completedLoops = <span class="hljs-number">0</span>;<font></font>
<font></font>
<span class="hljs-comment">//The current position of the song within the loop in beats.</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">float</span> loopPositionInBeats;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、SongPositionInBeatsを更新するたびに、ループのUpdate（）位置を更新することもできます。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-comment">//calculate the loop position</span>
    <span class="hljs-keyword">if</span> (songPositionInBeats &gt;= (completedLoops + <span class="hljs-number">1</span>) * beatsPerLoop)<font></font>
        completedLoops++;<font></font>
    loopPositionInBeats = songPositionInBeats - completedLoops * beatsPerLoop;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これにより、ループを通過した共有の数をloopPositionInBeatsに通知するマーカーが得られます。これは、他の多くの同期アイテムに役立ちます。 GameObject Conductorにループの数を入力してください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
株式の計算も慎重に検討する必要があります。音楽は常に1から始まるため、4つの部分の測定値は1-2-3-4-の形式を取り、クラスではloopPositionInBeatsが0.0から始まり、4.0を超えてループします。したがって、ループの正確な中央は、音楽の比率を計算するときに3になります。loopPositionInBeatsでは、値は2.0になります。 loopPositionInBeatsを変更してこれを考慮に入れることができますが、これは他のすべての計算に影響するため、ノートを挿入するときは注意してください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、残りのツールについては、Conductorクラスに2つのアスペクトを追加すると便利です。</font><font style="vertical-align: inherit;">まず、LoopPositionInAnalogと呼ばれるLoopPositionInBeatsのアナログバージョンは、ループの位置を0〜1.0の範囲で測定します。</font><font style="vertical-align: inherit;">2つ目は、他のクラスからの呼び出しに便利なConductorクラスのインスタンスです。</font><font style="vertical-align: inherit;">以下の変数をConductorクラスに追加します。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-comment">//The current relative position of the song within the loop measured between 0 and 1.</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">float</span> loopPositionInAnalog;<font></font>
<font></font>
<span class="hljs-comment">//Conductor instance</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Conductor instance;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Awake（）関数に、以下を追加します。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Awake</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    instance = <span class="hljs-keyword">this</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Update（）関数に追加します。</font></font><br>
<br>
<pre><code class="cs hljs">loopPositionInAnalog = loopPositionInBeats / beatsPerLoop;</code></pre><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ターン同期</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要素を適切な場所に配置するために、動きや回転をローブと同期させると非常に便利です。私のAtomic Beatsゲームでは、これを使用して中心軸を中心にノートを動的に回転させました。最初は、ループ内のシェアに従って円周上に配置され、その後、ノートがシェアの窪みのラインと一致するように、演奏領域全体が回転されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを実現するには、SyncedRotationという新しいスクリプトを作成し、回転したいGameObjectにアタッチします。 SyncedRotationスクリプトのUpdate（）関数に追加します。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">this</span>.gameObject.transform.rotation = Quaternion.Euler(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, Mathf.Lerp(<span class="hljs-number">0</span>, <span class="hljs-number">360</span>, Conductor.instance.loopPositionInAnalog));<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコードは、このゲームが関連付けられているGameObjectの回転を0〜360度の範囲で補間し、各ループの終わりに1回転するように回転させます。</font><font style="vertical-align: inherit;">これは例としては便利ですが、ループアニメーションやフレームごとのアニメーションの場合、ループアニメーションを同期してテンポに完全に合わせるとさらに便利です。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アニメーション同期</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unity </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Animatorは</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非常に強力ですが、常に正確であるとは限りません。アニメーションと音楽を確実に整列させるために、私はAnimatorクラスと競争し、そのペースと徐々に非同期になりがちでした。さらに、同じアニメーションを異なるテンポに調整することは困難でした。そのため、コンポジションを切り替えるときに、アニメーションキーフレームを現在のテンポに再定義する必要がありませんでした。代わりに、アニメーションループに直接移動して、Conductorクラスのループのどこにいるかに従って、このループの位置を設定できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、SyncedAnimationという新しいクラスを作成し、それに次の変数を追加します。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-comment">//The animator controller attached to this GameObject</span>
<span class="hljs-keyword">public</span> Animator animator;<font></font>
<font></font>
<span class="hljs-comment">//Records the animation state or animation that the Animator is currently in</span>
<span class="hljs-keyword">public</span> AnimatorStateInfo animatorStateInfo;<font></font>
<font></font>
<span class="hljs-comment">//Used to address the current state within the Animator using the Play() function</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> currentState;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アニメートしたい新規または既存のゲームオブジェクトにアタッチします。</font><font style="vertical-align: inherit;">この例では、オブジェクトを画面上で前後に移動するだけですが、プロパティを設定する前でも、フレームごとのアニメーションでも、同じ原理を任意のアニメーションに適用できます。</font><font style="vertical-align: inherit;">Animator要素を</font><font style="vertical-align: inherit;">GameObjectに追加し、SyncedAnimControllerと呼ばれる</font><font style="vertical-align: inherit;">新しい</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Animatorコントローラー</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と、BackAndForth </font><font style="vertical-align: inherit;">と呼ばれる</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アニメーションクリップ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を作成します。</font><font style="vertical-align: inherit;">コントローラをGameObjectにアタッチされたAnimatorクラスにロードし、デフォルトのアニメーションとしてアニメーションツリーにアニメーションを追加します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d5f/582/0e3/d5f5820e383580dbc69b18dd037a67a1.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、最初にオブジェクトを右に6単位移動し、次に左に-6単位移動し、次に0に戻すようにアニメーションを設定しました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dbc/d3a/0b9/dbcd3a0b909bb95cc0a91aaf2eaf65e0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、アニメーションを同期するために、次のコードをSyncedAnimationクラスのStart（）関数に追加します。これにより、Animatorに関する情報が初期化されます。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-comment">//Load the animator attached to this object</span><font></font>
    animator = GetComponent&lt;Animator&gt;();<font></font>
<font></font>
    <span class="hljs-comment">//Get the info about the current animator state</span>
    animatorStateInfo = animator.GetCurrentAnimatorStateInfo(<span class="hljs-number">0</span>);<font></font>
<font></font>
    <span class="hljs-comment">//Convert the current state name to an integer hash for identification</span><font></font>
    currentState = animatorStateInfo.fullPathHash;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、次のコードをUpdate（）に追加してアニメーションを定義します。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-comment">//Start playing the current animation from wherever the current conductor loop is</span>
    animator.Play(currentState, <span class="hljs-number">-1</span>, (Conductor.instance.loopPositionInAnalog));
    <span class="hljs-comment">//Set the speed to 0 so it will only change frames when you next update it</span>
    animator.speed = <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、1つの完全なループを基準にして、アニメーションの正確なフレームにアニメーションを配置します。たとえば、上記のアニメーションを使用する場合、ループの途中で、GameObjectの位置は0と交差します。これは、指揮者のテンポと同期させたい作成したアニメーションに適用できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アニメーションのシームレスなループを作成する</font><font style="vertical-align: inherit;">には、アニメーションカーブ上のアニメーション</font><font style="vertical-align: inherit;">の個々の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キーフレームの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接線を構成する必要があることにも注意してください</font><font style="vertical-align: inherit;">。 Linear設定は、あるキーフレームから次のキーフレームに向かう直線を作成し、Constantは次のキーフレームまでアニメーションを1つの値に保ち、ぎくしゃくと鋭い動きを与えます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f4c/68e/db4/f4c68edb4ab3e874379d8f6874b74fea.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この方法は有用であるが、それが原因となるので、それは、アニメーションのすべての遷移に影響を与え</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">animationStateは</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプトが最初に実行されたとき、それがあった状態で維持します。</font><font style="vertical-align: inherit;">このメソッドは、1つの同期アニメーションを無限に使用する必要があるオブジェクトに役立ちますが、異なる同期アニメーションでより複雑なオブジェクトを作成するには、これらの遷移を処理し、目的のアニメーション状態に従ってcurrentState変数を設定するコードを追加する必要があります。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらは、Atomic Beatsを作成する上で私に役立つ面のほんの一部です。それらのいくつかは他のソースから収集されたもの、または必要に応じて作成されたものですが、それらのほとんどは完成したフォームでは見つけることができませんでした。おそらく、私のシステムの一部は、CPUまたはオーディオシステムの制限により、大規模なプロジェクトでは役に立たなくなるでしょうが、ゲームジャムや趣味のプロジェクトをプレイするための優れた基盤になるでしょう。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ae/2a4/f7b/9ae2a4f7be098cc23e5b7283d5b1b9ba.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リズムゲーム、または音楽と同期したゲーム要素を作成するのは難しい場合があります。</font><font style="vertical-align: inherit;">すべてを一定のペースで維持するには、トリッキーなコードが必要になる場合があります。一定のペースでプレイできる結果は、プレーヤーにとって非常に魅力的です。</font><font style="vertical-align: inherit;">このジャンルでは、従来のDance Dance Revolutionスタイルのゲームよりも多くのことができるので、この記事がそのようなプロジェクトの実現に役立つことを願っています。</font><font style="vertical-align: inherit;">また、可能であれば、私の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Atomic Beats</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゲームを評価することをお勧めし</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">今年の春に1ヶ月で作った、8曲のショートトラックと無料！</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja452152/index.html">RostelecomがIIoTに対してどのようなソリューションを持っているか</a></li>
<li><a href="../ja452154/index.html">仮想キューブ-OLAPの代わり</a></li>
<li><a href="../ja452158/index.html">TOPchik-Yandex.XML APIを介して、検索クエリのサイト位置を無料で検証するためのオープンなWordPressプラグイン</a></li>
<li><a href="../ja452162/index.html">1時間でMySQLを使用するPython上のVK用ボット、パート1</a></li>
<li><a href="../ja452164/index.html">ModLook-ModBusレジスタスキャナー。プログラム20周年を祝う</a></li>
<li><a href="../ja452172/index.html">複雑なシステム。クリティカルレベルに到達する</a></li>
<li><a href="../ja452174/index.html">彼はあなたを必要としません</a></li>
<li><a href="../ja452178/index.html">解析：英語で書かれた23のよくある間違いとその回避方法</a></li>
<li><a href="../ja452180/index.html">SSDのパフォーマンスをひざまずいて、どこをクリックするか、そしてその理由</a></li>
<li><a href="../ja452182/index.html">従業員の調査。主な間違い</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>