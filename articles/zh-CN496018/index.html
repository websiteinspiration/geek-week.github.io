<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌇 📒 🛤️ 邮件服务器的DNS记录 🏏 👩🏻 📱</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="想象一下，在现实生活中，您收到了一个信封，在信封中您的老朋友的名字写在“发件人”字段中。您能否在不打开并阅读信件的情况下确定地说-这是您老朋友或某些入侵者的信封？
 
 这是邮件服务器面临的任务-仅查看信封即可确定发件人是否在撒谎。为此，邮件服务器是指Internet用于确认域所有权的机制-DNS服...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>邮件服务器的DNS记录</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/496018/"><img src="https://habrastorage.org/webt/v6/wj/gf/v6wjgfpwlhnr8zbi2la8rwpysqg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
想象一下，在现实生活中，您收到了一个信封，在信封中您的老朋友的名字写在“发件人”字段中。</font><font style="vertical-align: inherit;">您能否在不打开并阅读信件的情况下确定地说-这是您老朋友或某些入侵者的信封？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这是邮件服务器面临的任务-仅查看信封即可确定发件人是否在撒谎。</font><font style="vertical-align: inherit;">为此，邮件服务器是指Internet用于确认域所有权的机制-DNS服务器。</font></font><br>
<a name="habracut"></a><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">视频</font></font></b><div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/PhNrgjSIThg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上一页&lt; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于邮件服务器中的端口和加密</font></font></a><br>
<br>
<img src="https://habrastorage.org/webt/ce/h4/my/ceh4myowiqubtsfxgd0si889zpo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
立即进行预订，即保留“发件人”字段不是邮件本身的“发件人”字段，而是发件人服务器的地址。</font></font><br>
<img src="https://habrastorage.org/webt/ij/dr/s-/ijdrs-ma55pt0wavpzrap4tgq9i.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
邮件服务器非常依赖DNS。邮件服务器不需要DNS服务器的唯一情况是它是不发送或接收其他服务器的来信的本地邮件服务器。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/b9/q1/1v/b9q11v0y2tha8xkrc_koptaeeds.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，让我们决定邮件服务器的所有必要DNS记录。让我们从</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ A”记录开始</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它将名称转换为IP地址。顺便说一句，A-来自单词地址。邮件服务器名称的常见示例是mx.example.org，mail.example.org，smtp.example.org。如果配置了循环DNS，则多个具有相同名称和IP地址的A记录将允许平衡到不同邮件服务器的流量。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lr/jn/lg/lrjnlgvyy2xjbxdzwxzx1mwflwg.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MX记录</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-从“邮件使者”一词开始-有必要使其他邮件服务器找出将邮件发送到指定收件人域的地址。如果您打算使用子域，例如user@support.example.org，则对于子域，您将需要单独的MX记录。另外，您可以为一个域指定多个MX记录，指向不同的地址并选择优先级。假设您希望默认情况下将所有邮件发送到mx1.example.org服务器，然后将其优先级设置为接近零。服务器的优先级越低，分配给它的编号就越高。最大值为65535，但通常将优先级设置为10、20、30等。优先级可以匹配，然后DNS平衡这些记录（如果在DNS服务器上配置），或者发送者将使用第一个可用的服务器。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tn/j-/av/tnj-avwsfxi9kannqpiccugpi2u.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PTR记录</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是反向DNS记录，可将IP地址转换为名称。邮件服务器条目的主要目的是过滤掉大部分垃圾邮件。该记录使您可以确定邮件从中寄出的主机名。接收邮件时，邮件服务器发出两个请求-通过IP地址获取名称和通过发送方名称获取IP地址。如果结果匹配，则发送方服务器就是它声称的身份。与其他记录不同，仅当您拥有或租用IP地址时才能创建此类记录。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qj/8q/4p/qj8q4prb5da6zd7jfngukag2qde.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通常，购买域名的服务不允许您创建PTR记录。如果您从云提供商那里租用VPS，则其中一些会为您创建PTR记录。如果您拥有自己的本地邮件服务器，但DNS提供程序充当DNS提供程序，则可以与Internet提供程序联系，后者将为您提供IP地址，以便提供程序为您注册PTR记录。没有此条目，您的传出邮件更有可能在其他邮件服务器上收到垃圾邮件。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/uc/un/mg/ucunmg8a0_tp--rklyoxa352m7g.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SPF</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-一条记录，允许某些地址从指定的域发送邮件，并说明如果邮件来自其他地址该怎么办。假设您作为发件人声明您仅允许mail.example.org从example.org域发送邮件。并且，如果邮件不是来自该地址，而是在发件人字段中指定了example.org域，则可以安全地拒绝此邮件。原则上，服务器收件人应检查您的SPF记录并根据您设置的内容执行操作，但是收件人可以随意忽略您的“指令”。当攻击者伪装成发送者的用户之一时，需要SPF记录来防止欺骗攻击。</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment">###   SPF </span><font></font>
<font></font>
<span class="hljs-comment"># C     </span><font></font>
v=spf1 -all<font></font>
<font></font>
<span class="hljs-comment">#        ,   MX </span><font></font>
v=spf1 mx -all<font></font>
<font></font>
<span class="hljs-comment">#        mail.example.org,      </span><font></font>
v=spf1 a:mail.example.org ~all<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置SPF记录时，您指定SPF的版本，到目前为止，它是一个-第一个。接下来，指定允许从该域发送邮件的地址。地址可以只是一个“ mx”记录-即，您在MX记录中列出的那些服务器。您还可以使用选项-通过A记录，通过ipv4和ipv6地址等来注册其他地址。在允许的地址之后，将为所有不符合您的规则的内容指示all选项。您可以建议收件人允许来自您域中任何地址的所有邮件，拒绝，标记为不适当，但可以跳过，或由收件人自行决定。完整的语法和所有SPF选项将在最后以链接形式给出。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
尽管SPF指向允许其发送邮件的地址，但中间的某个人仍有可能替换邮件。为防止此类攻击，还有另一个DNS条目。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/c2/zg/ew/c2zgewwl77ybzt6gmljzns8lv84.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DKIM</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一条记录，用于使用添加到每条消息的签名来确认发件人。简而言之，您的服务器向传出的邮件中添加了唯一的哈希，可以使用相应DNS记录中的公钥对其进行解密。即使有人替换邮件，他也将无法伪造您的数字签名。因此，还需要DKIM来防止欺骗。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是对于DKIM，添加DNS记录是不够的；您还需要生成密钥并配置邮件服务器以与DKIM一起使用。为此，DKIM服务在邮件服务器上启动，并且邮件服务本身在发送消息之前通过此服务发送消息，该服务会添加数字签名。如何安装和配置它，我将考虑另外一次，但这是Internet上的全部内容。</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/nf/hu/l_/nfhul_7mbr9njf3w0y8lo5uq56a.png"><br>
<img src="https://habrastorage.org/webt/cs/9r/66/cs9r66clngtsuoiks-chldqq3eq.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DMARC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是允许您基于SPF和DKIM检查设置策略的记录。同样，收件人需要这些策略才能知道如何处理您的信件。</font></font><br>
<pre><code class="bash hljs"><span class="hljs-comment">###   DMARC </span><font></font>
<font></font>
<span class="hljs-comment">#          </span><font></font>
v=DMARC1; p=reject; pct=100; rua=mailto:admin@example.org<font></font>
<font></font>
<span class="hljs-comment">#    50% ,    ,  ,    </span><font></font>
v=DMARC1; p=quarantine; pct=50; rua=mailto:admin@example.org<font></font>
<font></font>
<span class="hljs-comment">#       </span><font></font>
v=DMARC1; p=none; rua=mailto:admin@example.org<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可以配置记录，以便收件人忽略错误，隔离失败的消息或完全拒绝这些消息。同样，在DMARC记录中，您指定收件人服务器将在其中发送来自邮件服务器的邮件统计信息的邮寄地址，这将使您了解外发邮件的状况，并慢慢拧紧螺母以防止欺骗。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ld/r8/3z/ldr83zahmj8jw3vhpq9wc1oliu0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gmail等某些服务还提供添加某些DNS记录的功能，以确认您是域管理员，从而​​使您可以更好地了解来自Gmail用户的域中邮件的状态。但是这些是特殊情况，并且会因服务而异。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/w5/uz/ud/w5uzudtzliofwde7al06ff55uyg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
忘了提。在线有几个重要的工具可以检查您的设置。</font></font><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">邮件测试器</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
是最方便的工具之一</font><font style="vertical-align: inherit;">。很简单：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1.转到站点，复制服务提供给您的邮寄地址。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2.通过任何邮箱从您的域中向该地址发送消息。希望消息不为空，但包含某种文本。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3.返回该站点，单击“然后检查评分”。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.检查结果。门户将检查所有可能的设置，例如DNS-相同的SPF，DKIM和DMARC记录，并显示您的服务器是否在黑名单中，等等。如果您在设置中有错误，他也会提供建议。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5.如果有错误-纠正，然后再次发送消息并再次检查结果。如果问题与DNS记录有关，请确保在再次尝试之前应用了对DNS的更改（例如，使用相同的dig命令）。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但！该服务每天只能为您提供3次免费尝试，因此，建议修复所有错误，然后重新检查。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ch/ws/5h/chws5hf_3nwdt8kjns4eqeerhvy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
另一个工具</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-mxtoolbox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。基本上，这里是检查DNS记录的存在并进入垃圾邮件列表。另外，在此门户网站上，您可以找到许多不同的检查工具，并且没有邮件测试程序中的限制。尽管在这些工具中会检查DKIM密钥的存在，但是如果没有域中的消息，mxtoolbox将无法确认用于DKIM的邮件服务器的正确配置。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dd/qz/yd/ddqzydln8mbff8plzyom5zm71vm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您已配置DKIM，并希望确保您输入的信息正确无误，则可以将消息发送到同一gmail帐户，然后以其原始格式打开该消息并尝试查找DKIM = pass行。或使用现成的服务</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dkimvalidator</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。操作原理与邮件测试仪相同-将消息发送到生成的地址并查看结果。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，通过设置这些DNS记录，来自您的邮件服务器的邮件将不会陷入垃圾邮件（前提是您自己没有垃圾邮件），并且您将帮助收件人避免垃圾邮件和欺骗攻击。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有用的链接：</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">什么是SPF </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">谜语和神话SPF </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">什么是DKIM？</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如何：DMARC</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN496004/index.html">数据搜索和分析的新模型。在Yandex.Tolki团队眼中的WSDM 2020</a></li>
<li><a href="../zh-CN496006/index.html">反向代理的增长-无需更改DNS A记录即可进行远程保护和站点优化的技术</a></li>
<li><a href="../zh-CN496010/index.html">危机期间（四月的第一周）运输发生了什么</a></li>
<li><a href="../zh-CN496014/index.html">IBM每周研讨会-2020年4月</a></li>
<li><a href="../zh-CN496016/index.html">搜索错误作为一种生活方式：第3条评论</a></li>
<li><a href="../zh-CN496020/index.html">夏季MVP。Kotlin有多灵活？</a></li>
<li><a href="../zh-CN496022/index.html">极端细菌：如何在海底下生存</a></li>
<li><a href="../zh-CN496024/index.html">标题“为您阅读文章”。2020年3月。第1部分</a></li>
<li><a href="../zh-CN496026/index.html">它不仅与您有关。由于流量增加，全球互联网正在放缓</a></li>
<li><a href="../zh-CN496028/index.html">冠状病毒，危机和IT的影响</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>