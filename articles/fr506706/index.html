<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèº‚Äçüè´ üõ∏ ü§∞üèΩ Les performances de Java moderne lorsque vous travaillez avec de grandes quantit√©s de donn√©es, partie 1 ‚ÜóÔ∏è ü§Ø üçä</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le runtime Java a √©volu√© plus rapidement ces derni√®res ann√©es qu'auparavant. Apr√®s 15 ans, nous avons enfin obtenu le collecteur d'ordures par d√©faut ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Les performances de Java moderne lorsque vous travaillez avec de grandes quantit√©s de donn√©es, partie 1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/506706/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/gy/8p/zf/gy8pzf7gjtwr9pvv1zb7rgmmjiy.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le runtime Java a √©volu√© plus rapidement ces derni√®res ann√©es qu'auparavant. </font><font style="vertical-align: inherit;">Apr√®s 15 ans, nous avons enfin obtenu le collecteur d'ordures par d√©faut - G1. </font><font style="vertical-align: inherit;">Deux autres sont en cours de d√©veloppement et sont disponibles en tant que fonctions exp√©rimentales - Oracle ZGC et OpenJDK Shenandoah. </font><font style="vertical-align: inherit;">Nous avons d√©cid√© de tester tous ces nouveaux outils et de d√©couvrir ce qui fonctionne le mieux avec les charges de travail typiques du moteur de streaming open source distribu√© Hazelcast Jet.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jet est utilis√© pour r√©soudre toutes sortes de t√¢ches, avec des exigences de latence et de bande passante diff√©rentes. </font><font style="vertical-align: inherit;">Les t√¢ches se r√©partissent en trois cat√©gories importantes:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Streaming illimit√© √† faible latence. </font><font style="vertical-align: inherit;">Exemple: identifier les tendances des donn√©es des capteurs de 10 000 appareils qui prennent des informations √† une fr√©quence de 100 Hz et envoyer des corrections en 10-20 ms.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Traitement de streaming illimit√© avec une bande passante √©lev√©e. </font><font style="vertical-align: inherit;">Exemple: suivi des coordonn√©es GPS de millions d'utilisateurs avec calcul de leurs vecteurs de vitesse.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Traitement par lots classique des m√©gadonn√©es. </font><font style="vertical-align: inherit;">Le crit√®re est le temps consacr√© au traitement, ce qui signifie qu'un d√©bit √©lev√© est requis. </font><font style="vertical-align: inherit;">Exemple: analyse des donn√©es boursi√®res collect√©es par jour pour mettre √† jour le niveau de risque pour un portefeuille d'actifs donn√©.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, nous pouvons observer ce qui suit:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans le premier sc√©nario, les exigences de retard tombent dans la zone dangereuse des pauses de la poubelle: 100 ms. </font><font style="vertical-align: inherit;">Ceci est consid√©r√© comme un excellent r√©sultat pour la collecte des ordures dans les cas les plus difficiles, et dans de nombreuses situations, il peut devenir une pierre d'achoppement.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les deuxi√®me et troisi√®me sc√©narios sont identiques dans les exigences de r√©cup√©ration de place. </font><font style="vertical-align: inherit;">Les exigences de d√©lai sont moins strictes, mais repr√©sentent une lourde charge pour les g√©n√©rations titulaires.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le deuxi√®me sc√©nario est plus difficile en raison des exigences de retard, m√™me s'il n'est pas aussi strict que dans le premier sc√©nario.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons essay√© les combinaisons suivantes:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JDK 8 avec assembleur parall√®le par d√©faut et ConcurrentMarkSweep et G1 en option.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JDK 11 avec collecteur par d√©faut G1 et parall√®le en option.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JDK 14 avec collecteur par d√©faut G1 et ZGC exp√©rimental et Shenandoah.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous sommes arriv√©s aux conclusions suivantes:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avec les versions modernes de JDK, le constructeur G1 fonctionne tr√®s bien. </font><font style="vertical-align: inherit;">Il g√®re facilement des dizaines de gigaoctets de tas (nous avons essay√© 60 Go), avec une pause maximale de 200 ms. </font><font style="vertical-align: inherit;">Sous une charge extr√™me, G1 ne passe pas en mode critique cauchemardesque. </font><font style="vertical-align: inherit;">Au lieu de cela, la dur√©e des pauses pour la r√©cup√©ration de place compl√®te augmente en secondes. </font><font style="vertical-align: inherit;">Le point faible du collecteur est la limite sup√©rieure des pauses dans des conditions favorables de faible charge. </font><font style="vertical-align: inherit;">Nous avons r√©ussi √† l'abaisser √† 20-25 ms.</font></font></li>
<li>JDK 8 ‚Äî   .    Parallel       .  G1    ,    ,       ,     .       12    20   Parallel     G1. ConcurrentMarkSweep       G1,           .</li>
<li>  ZGC    ,   G1,        ,  G1       10 . </li>
<li>Shenandoah        220    .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ni ZGC ni Shenandoah ne se sont comport√©s dans des modes critiques aussi r√©guli√®rement que G1. </font><font style="vertical-align: inherit;">Leur travail n'√©tait pas fiable, en mode de faible latence, de tr√®s longues pauses se sont produites de mani√®re inattendue, et m√™me OOME.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cet article d√©crit les r√©sultats de nos tests dans deux sc√©narios de traitement en continu. </font><font style="vertical-align: inherit;">Dans la deuxi√®me partie, nous parlerons des r√©sultats du traitement par lots.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Benchmark de traitement de flux</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour le benchmark de streaming, nous avons pris </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ce</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> code et l' </font><font style="vertical-align: inherit;">avons </font><font style="vertical-align: inherit;">l√©g√®rement chang√© entre les tests. </font><font style="vertical-align: inherit;">Voici la partie principale, le pipeline Jet:</font></font><br>
<br>
<pre><code class="java hljs">StreamStage&lt;Long&gt; source = p.readFrom(longSource(ITEMS_PER_SECOND))<font></font>
                            .withNativeTimestamps(<span class="hljs-number">0</span>)<font></font>
                            .rebalance(); <span class="hljs-comment">// Introduced in Jet 4.2</span><font></font>
source.groupingKey(n -&gt; n % NUM_KEYS)<font></font>
      .window(sliding(SECONDS.toMillis(WIN_SIZE_SECONDS), SLIDING_STEP_MILLIS))<font></font>
      .aggregate(counting())<font></font>
      .filter(kwr -&gt; kwr.getKey() % DIAGNOSTIC_KEYSET_DOWNSAMPLING_FACTOR == <span class="hljs-number">0</span>)<font></font>
      .window(tumbling(SLIDING_STEP_MILLIS))<font></font>
      .aggregate(counting())<font></font>
      .writeTo(Sinks.logger(wr -&gt; String.format(<span class="hljs-string">"time %,d: latency %,d ms, cca. %,d keys"</span>,<font></font>
              simpleTime(wr.end()),<font></font>
              NANOSECONDS.toMillis(System.nanoTime()) - wr.end(),<font></font>
              wr.result() * DIAGNOSTIC_KEYSET_DOWNSAMPLING_FACTOR)));<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce pipeline refl√®te les sc√©narios d'utilisation avec un flux d'√©v√©nements illimit√©. Le moteur doit agr√©ger les donn√©es en utilisant la m√©thode de la "fen√™tre coulissante". Une telle agr√©gation est n√©cessaire, par exemple, pour obtenir la d√©riv√©e temporelle d'une valeur changeante, pour effacer les donn√©es du bruit haute fr√©quence (lissage) ou pour mesurer la fr√©quence d'occurrence d'un √©v√©nement (√©v√©nements par seconde). Le moteur peut d'abord diviser le flux en cat√©gories (par exemple, tous les appareils IoT ou smartphones individuels) en sous-flux. Et puis suivre ind√©pendamment la valeur agr√©g√©e pour chaque sous-flux. Dans Hazelcast Jet, une fen√™tre coulissante se d√©place par √©tapes discr√®tes, dont vous sp√©cifiez la taille. Par exemple, avec une √©tape de 1 seconde, vous obtenez un ensemble complet de r√©sultats chaque seconde. Et avec un pas de 1 minute, les r√©sultats incluront tout ce qui s'est pass√© √† la derni√®re minute.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quelques notes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code est compl√®tement autonome. Les sources de donn√©es externes ne sont pas utilis√©es. Nous utilisons une source de stub pour √©muler un flux d'√©v√©nements √† la bonne fr√©quence. Les √©v√©nements se produisent √† intervalles r√©guliers. La source ne g√©n√®re pas d'√©v√©nements dont les horodatages sont li√©s au futur, mais elle les g√©n√®re le plus rapidement possible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si le pipeline est en retard, les √©v√©nements sont ¬´mis en m√©moire tampon¬ª sans enregistrement. Dans ce cas, le pipeline devrait rattraper son retard, d√®s que possible recevoir des donn√©es. Comme notre source n'est pas parall√©lis√©e, sa limite de bande passante a atteint environ 2,2 millions d'√©v√©nements par seconde. Nous avons √©mul√© 1 million d'√©v√©nements / s, laissant une marge pour rattraper jusqu'√† 1,2 million d'√©v√©nements / s.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le convoyeur mesure son retard en comparant l'horodatage du r√©sultat de la fen√™tre coulissante avec l'heure actuelle. Deux √©tapes d'agr√©gation avec filtration interm√©diaire ont √©t√© utilis√©es. Le r√©sultat d'une fen√™tre glissante contient de nombreux √©l√©ments, un pour chaque sous-flux, et nous nous int√©ressons au d√©lai pour le dernier des √©l√©ments. Par cons√©quent, nous filtrons d'abord la plupart du r√©sultat, en laissant chaque dix milli√®me √©l√©ment. Et puis nous dirigeons le d√©bit r√©duit vers le deuxi√®me √©tage, avec une fen√™tre ¬´flipping¬ª sans cl√©. A ce stade, nous notons la taille du r√©sultat et mesurons le retard. L'agr√©gation sans utiliser de cl√© n'est pas parall√©lis√©e, nous avons donc un point de mesure. L'√©tape de filtration est parall√©lis√©e et est locale aux donn√©es, de sorte que l'influence de l'√©tape d'agr√©gation suppl√©mentaire est tr√®s faible (bien inf√©rieure √† 1 ms).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons utilis√© une fonction d'agr√©gation simple: le comptage. En fait, une mesure de la fr√©quence des √©v√©nements dans le flux a √©t√© obtenue. Il a une structure minimale (un num√©ro de type </font></font><code>long</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), les ordures ne sont pas g√©n√©r√©es. Pour n'importe quelle quantit√© d'utilisation de tas (en gigaoctets), une telle petite structure de cl√© implique le pire sc√©nario pour le garbage collector: un tr√®s grand nombre d'objets. La charge sur le collecteur ne cro√Æt pas avec la taille du tas, mais avec le nombre d'objets. Nous avons √©galement test√© l'option de calculer la m√™me fonction d'agr√©gation, mais avec une impl√©mentation diff√©rente qui g√©n√®re des ordures.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons pilot√© la plupart des benchmarks de flux sur un n≈ìud, car nous √©tions int√©ress√©s par l'impact de la gestion de la m√©moire sur les performances du pipeline. </font><font style="vertical-align: inherit;">Et la latence du r√©seau n'ajoute que du bruit aux donn√©es. </font><font style="vertical-align: inherit;">Pour tester l'hypoth√®se selon laquelle les performances du cluster n'affecteront pas nos r√©sultats, nous avons r√©p√©t√© certains tests cl√©s sur un cluster Amazon EC2 √† trois n≈ìuds. </font><font style="vertical-align: inherit;">Plus d'informations √† ce sujet seront d√©crites vers la fin du deuxi√®me article. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons supprim√© le collecteur parall√®le des r√©sultats de la charge de streaming car les pics de retard qu'il cr√©e sont inacceptables dans la plupart des sc√©narios du monde r√©el.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sc√©nario 1: faible latence, structure moyenne</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Param√®tres de script:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenJDK 14</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La taille de segment de m√©moire JVM est de 4 Go.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour G1, √©tant donn√© </font></font><code>-XX:MaxGCPauseMillis=5</code></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 million d'√©v√©nements / s.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50 000 cl√©s individuelles.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fen√™tre coulissante de 30 secondes apr√®s 0,1 seconde.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce sc√©nario, moins de 1 Go de segment de m√©moire est utilis√©. </font><font style="vertical-align: inherit;">La charge sur le collecteur est petite, elle a suffisamment de temps pour la collecte de d√©chets comp√©titive en arri√®re-plan. </font><font style="vertical-align: inherit;">Voici les retards maximaux dans le fonctionnement du pipeline avec trois assembleurs test√©s:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/053/d40/26c/053d4026c6d3eb747e3e78bbdcd46ecd.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces valeurs incluent des intervalles fixes d'environ 3 ms pour la transmission des r√©sultats de la fen√™tre. </font><font style="vertical-align: inherit;">Le graphique parle de lui-m√™me: le collecteur par d√©faut G1 fait un excellent travail, mais si vous avez besoin d'un d√©lai encore plus faible, vous pouvez utiliser le ZGC exp√©rimental. </font><font style="vertical-align: inherit;">Nous n'avons pas pu abaisser les pics de retard en dessous de 10 ms. </font><font style="vertical-align: inherit;">Mais dans le cas de ZGC et de Shenandoah, ils ne surviennent pas en raison de pauses dans la collecte des ordures, mais en raison de courtes p√©riodes de volume accru de travail de fond des collectionneurs. </font><font style="vertical-align: inherit;">Parfois, les processus de service de Shenandoah ont augment√© le retard au-dessus de 200 ms.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sc√©nario deux: structure plus grande, exigences de latence moins strictes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous supposons que pour des raisons ind√©pendantes de notre volont√© (par exemple, en raison du r√©seau cellulaire), le d√©lai peut augmenter √† quelques secondes. </font><font style="vertical-align: inherit;">Cela att√©nue les exigences pour le pipeline de traitement de flux. </font><font style="vertical-align: inherit;">D'un autre c√¥t√©, nous pouvons rencontrer des donn√©es beaucoup plus volumineuses, de la taille de millions ou de dizaines de millions de cl√©s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce sc√©nario, nous pouvons pr√©parer l'√©quipement pour une utilisation intensive, en tenant compte du fait que le garbage collector fonctionnera dans un grand tas, plut√¥t que de distribuer des donn√©es sur plusieurs n≈ìuds du cluster. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons effectu√© de nombreux tests dans diff√©rentes combinaisons pour savoir comment les combinaisons de facteurs affectent les performances du runtime. </font><font style="vertical-align: inherit;">Il s'est av√©r√© que cela d√©pend de deux param√®tres:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le nombre d'enregistrements stock√©s dans des agr√©gats.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Besoin de bande passante pour le maquillage.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le premier param√®tre d√©crit le nombre d'objets dans la g√©n√©ration s√©curis√©e. Lors de l'agr√©gation √† l'aide de la m√©thode de la fen√™tre coulissante, nous conservons les objets pendant une longue p√©riode (dans toute la fen√™tre), puis les lib√©rons. Cela contredit directement l'hypoth√®se g√©n√©rationnelle des d√©chets (Generational Garbage Hypothesis), selon laquelle les objets meurent jeunes ou vivent √©ternellement. Dans ce mode, la charge maximale sur le garbage collector est cr√©√©e. Et comme l'intensit√© de son travail cro√Æt avec le nombre d'objets vivants, la productivit√© d√©pend fortement de ce param√®tre. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le deuxi√®me param√®tre concerne la quantit√© de ressources que l'application peut allouer au garbage collector. Pour le rendre plus clair, construisons quelques diagrammes. Lors de l'agr√©gation √† l'aide de la m√©thode des fen√™tres coulissantes, le convoyeur passe par trois √©tapes:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Traitement des √©v√©nements en temps r√©el au fur et √† mesure qu'ils se produisent.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Passer les r√©sultats d'une fen√™tre coulissante.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rattraper les √©v√©nements re√ßus lors de la deuxi√®me √©tape.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les trois √©tapes peuvent √™tre visualis√©es comme suit:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/99c/d77/894/99cd778940f1596c2dd5e1dbf0933fd4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si le transfert des r√©sultats de la fen√™tre prend plus de temps, on se retrouve dans cette situation:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b22/694/760/b226947608cfb3373742d02e6dc7774f.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, le convoyeur a √† peine le temps, et tous les retards, comme les pauses pour la collecte des ordures, augmenteront le d√©lai et se r√©tabliront tr√®s lentement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Modifions le graphique et affichons uniquement le taux moyen d'absorption des √©v√©nements apr√®s avoir pass√© les r√©sultats de la fen√™tre:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d78/cd9/ccb/d78cd9ccbf09b96c23705ae8bb0d6e38.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Appelons la hauteur du rectangle jaune ¬´exigence d'imposition¬ª: c'est l'exigence de capacit√© source. S'il d√©passe le d√©bit r√©el du convoyeur, il ne peut pas supporter la charge. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici √† quoi cela ressemblera si le transfert des r√©sultats de la fen√™tre prend trop de temps:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5b9/0ea/594/5b90ea59490f05c628401475c9849e21.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La zone des rectangles rouges et jaunes est fixe et correspond √† la quantit√© de donn√©es qui doit traverser le pipeline. En fait, le rouge ¬´serre¬ª le jaune. Mais la hauteur du rectangle jaune est limit√©e, dans notre cas le plafond est de 2,2 millions d'√©v√©nements / s. Et lorsque la hauteur d√©passe la limite, nous obtenons un convoyeur qui ne peut pas supporter la charge et un retard sans cesse croissant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons d√©riv√© des formules pour pr√©dire la taille des rectangles pour une combinaison donn√©e de fr√©quence d'√©v√©nements, de taille de fen√™tre, de pas de glissement et de taille de jeu de cl√©s. Nous pouvons donc dans tous les cas d√©terminer l'exigence d'imposition.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons maintenant deux param√®tres plus ou moins ind√©pendants d√©riv√©s de nombreux autres param√®tres qui d√©crivent chaque combinaison individuelle. </font><font style="vertical-align: inherit;">Vous pouvez cr√©er un graphique √† deux dimensions, des cercles sur lesquels indiquent les rep√®res bannis. </font><font style="vertical-align: inherit;">Colorez les cercles en fonction du succ√®s ou de l'√©chec de la combinaison. </font><font style="vertical-align: inherit;">Par exemple, pour un groupe de JDK 14 avec G1 fonctionnant sur un ordinateur portable, nous obtenons le graphique suivant:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ab2/9e6/416/ab29e641669a2666c59d506e59fce458.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons identifi√© trois cat√©gories:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Oui" - le convoyeur fait face,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Non" - le pipeline ne peut pas faire face en raison du manque de bande passante,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬´Collecteur de d√©chets¬ª - le convoyeur ne r√©siste pas en raison de longues pauses fr√©quentes lors du montage.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veuillez noter que le manque de bande passante peut √©galement se produire en raison de la collecte de d√©chets comp√©titive et de fr√©quentes pauses de montage courtes. En g√©n√©ral, la diff√©rence entre les deux derni√®res cat√©gories est faible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez voir la bordure s√©parant le coin inf√©rieur gauche du graphique. Il contient des points de rep√®res pass√©s avec succ√®s. Nous avons trac√© le m√™me graphique pour d'autres combinaisons du JDK et du ramasse-miettes, identifi√© les limites des zones et obtenu le r√©sultat suivant:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/251/d12/394/251d123945208cbed4806928946c4241.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avions un MacBook Pro 2018 avec un processeur Intel Core i7 √† 6 c≈ìurs et 16 Go de RAM DDR4. Pour la JVM a √©t√© configur√© </font></font><code>-Xmx10g</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Cependant, nous pensons qu'une image similaire sera observ√©e sur de nombreuses autres configurations. Le graphique montre la sup√©riorit√© de G1 sur les autres capteurs, la faiblesse de G1 lorsqu'il est utilis√© avec JDK 8 et la faiblesse des capteurs exp√©rimentaux √† faible latence sous ce type de charge.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le retard de base - la dur√©e de transmission des r√©sultats de la fen√™tre - a oscill√© autour de 500 ms. </font><font style="vertical-align: inherit;">Cependant, des √©clats se sont souvent produits en raison des principales pauses pour la collecte des ordures (qui √©taient d√©raisonnablement longues dans le cas de G1), jusqu'√† 10 s dans les situations limites (lorsque le convoyeur fait √† peine face au travail) et diminuent √† 1-2 s. </font><font style="vertical-align: inherit;">Nous avons √©galement remarqu√© l'effet de la compilation JIT dans des situations limites: le pipeline commence √† fonctionner avec un retard toujours croissant, et apr√®s environ deux minutes, les performances s'am√©liorent et le retard revient √† des valeurs normales.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr506696/index.html">Gestion de PostgreSQL sur Gitlab.com. Jose Cores Finotto</a></li>
<li><a href="../fr506698/index.html">Requiem pour "Sea Launch"</a></li>
<li><a href="../fr506700/index.html">Nous configurons les actions GitHub pour Android avec le d√©ploiement ult√©rieur dans PlayMarket</a></li>
<li><a href="../fr506702/index.html">Les disques durs les plus fiables selon Backblaze Q1 2020</a></li>
<li><a href="../fr506704/index.html">Pourquoi √©crire en PHP en 2020? Holivarim est un podcast interactif sur Youtube ce jeudi</a></li>
<li><a href="../fr506708/index.html">Authentification √† deux facteurs VPN / Mikrotik - simple et √©volutive</a></li>
<li><a href="../fr506710/index.html">G√©rez plusieurs carnets d'adresses dans Zimbra Collaboration Suite Open-Source Edition</a></li>
<li><a href="../fr506716/index.html">Liste lin√©aire multithread: probl√®me d'existence d'√©l√©ment, am√©lioration de la productivit√© et relation STL</a></li>
<li><a href="../fr506726/index.html">Exp√©rience dans l'utilisation de la technologie Rutoken pour l'enregistrement et l'autorisation des utilisateurs dans le syst√®me (partie 2)</a></li>
<li><a href="../fr506730/index.html">Snort ou Suricata. Partie 1: choisissez un IDS / IPS gratuit pour prot√©ger le r√©seau d'entreprise</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>