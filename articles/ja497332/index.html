<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⭐️ 🎼 🧒🏽 ヒューストン、問題があります。システム設計の失敗 🕠 🤳🏼 💅🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1970年、アメリカのエンジニアがアポロ13号宇宙船を月に打ち上げました。搭載されているのは燃料電池の3つのバッテリーです。心配する必要はありません。すべてが確実に繰り返し複製されます。しかし、酸素ボンベの爆発で3つのバッテリーのうち2つが無効になるとは誰も想像できませんでした。悲劇！宇宙飛行士は家...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ヒューストン、問題があります。システム設計の失敗</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/497332/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1970年、アメリカのエンジニアがアポロ13号宇宙船を月に打ち上げました。搭載されているのは燃料電池の3つのバッテリーです。心配する必要はありません。すべてが確実に繰り返し複製されます。しかし、酸素ボンベの爆発で3つのバッテリーのうち2つが無効になるとは誰も想像できませんでした。悲劇！宇宙飛行士は家に帰り、トムハンクスとのイベントについての長編映画が作成され、宇宙飛行士のジャックスウィガートのフレーズ「ヒューストン、私たちは問題があります！」、歴史に没頭しました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/iu/oj/oi/iuojoilj6ikne43fxjqm5q6bjm4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アポロ13号の物語は、起こり得るあらゆるトラブルに備えることができないというよく知られた事実のもう一つの証拠です。これは世界の自然な特性です：鉄は定期的に壊れ、コードはクラッシュし、人々は間違いを犯します。これを完全になくすことは不可能です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
大規模な分散システムの場合、この動作は正常であり、規模の経済と統計の結果です。</font><font style="vertical-align: inherit;">そのため、Design for Failure（AWS）はAWSクラウドサービスの基本的な設計原則です。</font><font style="vertical-align: inherit;">システムは最初は、フルタイムの操作を可能な限り迅速に復元し、既知および未知の障害による損傷を最小限に抑えるように構築されています。</font><font style="vertical-align: inherit;">で</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HighLoad ++、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ワシーリーPantyukhin、一例として、戦闘のサービスと実生活の問題を使用して、AWSの開発者が使用する分散システムのためのデザインパターンを示しました。</font></font><br>
<a name="habracut"></a><br>
 <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヴァシリーパンチュキン</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">編</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）ヨーロッパ、中東、アフリカのアマゾンウェブサービスのアーキテクトです。彼はUnix管理者として始まり、Sun Microsystemで6年間働いて、技術コースを教え、11年間、EMCで世界のデータ中心性を教えました。国際的なチームで、彼はケープタウンからオスロまでのプロジェクトを設計および実装しました。大企業や中小企業がパブリッククラウドで作業するのに役立ちます。</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/RxWVxr4uUpI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1949年、カリフォルニア空軍基地で飛行機事故が調査された。</font><font style="vertical-align: inherit;">これを行ったエンジニアの1人がエドワードマーフィーでした。</font><font style="vertical-align: inherit;">彼は地元の技術者の仕事を次のように説明しました：「何かを行うには2つの方法があり、そのうちの1つが災害につながる場合、誰かがこの方法を選択します。」</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
後に、アーサー・ブロックのおかげで、この発言はマーフィーの法則の1つとして歴史に残った。</font><font style="vertical-align: inherit;">ロシア語-卑劣の法則。</font><font style="vertical-align: inherit;">その本質は、故障や人為的エラーを回避することは不可能であり、どういうわけかそれとともに生きなければならないということです。</font><font style="vertical-align: inherit;">そのため、設計時には、個々のコンポーネントの障害や障害を直ちにシステムに組み込んでいます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">故障設計</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
失敗の設計では、3つの特性を改善しようとしています。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アクセシビリティ（同じ「9」）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信頼性-必要なレベルのサービスを提供するシステムの特性。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フォールトトレランス-問題の発生を防止し、問題の発生後すぐに回復するシステムの特性。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
信頼性には、「</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">既知の</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未知数」</font><font style="vertical-align: inherit;">という特性があります</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">既知の問題から身を守りますが、いつ発生するかはわかりません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「</font></font><em><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アン</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">知ら未知数」</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">される</font><font style="vertical-align: inherit;">フォールトトレランスに追加</font><font style="vertical-align: inherit;">-これらは、我々はについて何も知らないことに驚き問題です。</font><font style="vertical-align: inherit;">クラウドにおけるこれらの問題の多くは、規模の経済に関連しています。システムは、新しく、驚くべき、予想外の影響が現れると、サイズが大きくなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
障害は通常、バイナリ現象ではありません。</font><font style="vertical-align: inherit;">その主な特性は</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「爆風半径」</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">またはサービスの低下のレベル、破壊半径です。</font><font style="vertical-align: inherit;">私たちの仕事は、システムの「爆風半径」を減らすことです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題を回避できないと認識した場合は、事前に準備しておく必要があります。</font><font style="vertical-align: inherit;">これは、トラブルが発生した場合（確かに発生します）、問題を制御し、その逆ではないようにサービスを設計することを意味します。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題に対応するとき、それは私たちを制御します。</font></font></blockquote><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データプレーンとコントロールプレーン</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
確かに、テレビなどのリモコンで制御される電子機器は自宅にあります。</font><font style="vertical-align: inherit;">TV画面はデータプレーンの一部であり、機能を直接実行します。</font><font style="vertical-align: inherit;">リモートコントロールは、ユーザーインターフェイス-コントロールプレーンです。</font><font style="vertical-align: inherit;">サービスの管理と構成に使用されます。</font><font style="vertical-align: inherit;">クラウドでは、テストと開発のためにデータプレーンとコントロールプレーンを分離しようとします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユーザーは、ほとんどの場合、コントロールプレーンの複雑さを認識しません。</font><font style="vertical-align: inherit;">しかし、その設計と実装のミスは、大量の障害の最も一般的な原因です。</font><font style="vertical-align: inherit;">それが私のアドバイスがコントロールプレーンに焦点を合わせている理由です。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ひとつのトラブルの話</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2012年7月、北バージニア州で激しい嵐が発生しました。データセンターには保護、ディーゼル発電機などがありますが、北バージニア地域のアベイラビリティゾーンの1つ（アベイラビリティーゾーン、AZ）のデータセンターの1つで電力が失われたことがありました。電気はすぐに復旧しましたが、サービスの復旧は何時間も続きました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ig/ev/yd/igevydk5zuise0toukfgy9gdxsw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
基本的なサービスの1つであるCLB（クラシックロードバランサー）の例について、その理由を説明します。それは単純に機能します。各アベイラビリティーゾーンで新しいバランサーを開始すると、個別のインスタンスが作成され、そのIPがDNSを解決します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gw/al/l0/gwall0xgawp614yocrkqtoz87dk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インスタンスの1つが失敗すると、これに関するメッセージが特別なデータベースに送信されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sk/ts/bj/sktsbjffpcebdnovro-u6dyr0pu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それに応じて、手順が始まります。DNSからのレコードの削除、新しいインスタンスの開始、DNSへの新しいIPの追加です。</font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：これは、システムが過去に機能した方法ですが、今ではすべてが根本的に異なります。</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
すべてがシンプルです-壊すものは何もありません。しかし、大量の障害が発生しているときに、数千のインスタンスが同時に崩壊する</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と、</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">処理のためのメッセージから</font><strong><font style="vertical-align: inherit;">データベースに巨大なバックログ</font></strong><font style="vertical-align: inherit;">が表示</font><strong><font style="vertical-align: inherit;">さ</font></strong><font style="vertical-align: inherit;">れます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/r2/--/nw/r2--nw4kqcrocoysqgptvysranu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、さらに悪化しました。コントロールプレーンは分散システムです。バグのため、データベースに重複があり、数千のレコードが最大で数十万に膨らみました。これで作業することは非常に困難になりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いずれかのインスタンスで障害が発生すると、すべてのトラフィックがほぼ即座に稼働中のマシンに切り替えられ、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">負荷が2倍に</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なり</font><strong><font style="vertical-align: inherit;">ます</font></strong><font style="vertical-align: inherit;">（この例では、簡単にするために、アクセスゾーンは2つしかありません）。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/uz/jl/ox/uzjloxrf6wvv5hrju2-votyb-o4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
十分なリソースがないため、ライブインスタンスは自動的に</font><strong><font style="vertical-align: inherit;">スケーリングを</font></strong><font style="vertical-align: inherit;">開始します</font></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。このプロセスには比較的長い時間がかかります。すべてがピークに達すると同時に、膨大な数のインスタンスが発生します-アベイラビリティーゾーンの無料リソースが不足しています。リソースの「戦い」が始まります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バージニア北部では、大規模な障害に自動化で対応できず、エンジニアが（スクリプトを使用して）手動でサービスを復旧しました。このようなトラブルはまれです。デブリーフィング中に、失敗の原因について質問が出され、状況を繰り返さないようにし、サービス全体を変更する必要があると決定しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで取り上げる8つのパターンは、いくつかの質問に対する回答です。</font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意。これはサービス設計における私たちの経験であり、広範囲に使用するための普遍的な知識ではありません。パターンは特定の状況で使用されます。</font></font></em><br>
<br>
<em>      —  .   AWS           .    — ,  .    .     —     .     !</em><br>
<br>
<h2>  </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
障害の影響を最小限に抑えるために、多くのアプローチがあります。それらの1つは、質問に答えることです。「問題について知らないユーザーが、障害時および回復時に問題について何も知らないようにするにはどうすればよいですか？」</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちの巨大なバックログは、クラッシュメッセージだけでなく、たとえばスケーリングや他の人が新しいバランサーを起動しているというメッセージも受け取ります。このようなメッセージは、機能的にグループ化して互いに分離する必要があります。障害発生後の別の回復メッセージグループで、新しいバランサーを個別に起動します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
10人のユーザーが問題に気付いたとします-バランサーのノードの1つが落ちました。サービスは何とか残りのリソースを処理しますが、問題が感じられます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3c/wu/3a/3cwu3agcfwjtemyacuneqwtmrfm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
イライラしたユーザーが10人います。</font><font style="vertical-align: inherit;">11番目が表示されます-彼は問題について何も知りませんが、単に新しいバランサーを望んでいます。</font><font style="vertical-align: inherit;">処理のためにキューを置くという彼のリクエストがあった場合、おそらく彼は待たないでしょう。</font><font style="vertical-align: inherit;">他の処理手順が完了している間、リクエスト時間は終了します。</font><font style="vertical-align: inherit;">10のイライラしたユーザーの代わりに、11のユーザーがいます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これが起こらないようにするために、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いくつかのリクエスト</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><strong><font style="vertical-align: inherit;">優先順位</font></strong><font style="vertical-align: inherit;">を</font><strong><font style="vertical-align: inherit;">付け</font></strong><font style="vertical-align: inherit;">ます。たとえば、新しいリソースのリクエストなど、キューを一番上に置きます。</font><font style="vertical-align: inherit;">大量の障害が発生した場合、このような要求の数が比較的少なくても、他の顧客のリソースの復旧時間には影響しません。</font><font style="vertical-align: inherit;">ただし、復旧プロセスでは、問題に関与するユーザーの数を制限します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常勤職</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題レポートへの対応は、回復手順の開始、特にDNSとの連携です。大量の障害は、コントロールプレーンの巨大なピーク負荷です。 2番目のパターンは、</font><font style="vertical-align: inherit;">このような状況で</font><font style="vertical-align: inherit;">コントロールプレーンがより</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安定して予測可能</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">なるのに役立ちます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fg/dv/zm/fgdvzmrez2rrlgfsc4ztmxmkaxu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンスタントワーク-パーマネントワーク</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と呼ばれるアプローチを使用してい</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ri/pa/ee/ripaeenvgoadihywoj90c7vvopa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、DNSは少し賢くすることができます。それは、バランサーのインスタンスが生きているかどうかにかかわらず、それらを常にチェックします。結果は毎回ビットマップになります。インスタンスは-1、デッド-0と応答します。DNS </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
は、システムが大規模な障害の後に復元されたか、正常に動作しているかに関係なく、数秒ごとにインスタンスをチェックします。彼は同じ仕事をしています-ピークではなく、すべてが予測可能で安定しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別の単純化された例：大きなフリートの構成を変更したい。</font><font style="vertical-align: inherit;">私たちの用語では、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フリートは、</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いくつかの作業を行う</font><strong><font style="vertical-align: inherit;">仮想マシンのグループです</font></strong><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nb/wq/go/nbwqgolicpqizt1bkehgk4ney9c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
構成の変更をS3バケットに配置し、10秒ごとに（たとえば）この構成すべてを仮想マシン群にプッシュします。</font><font style="vertical-align: inherit;">2つの重要なポイント。</font></font><br>
<br>
<ul>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちはこれを定期的に行って</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">おり、規則を破ることはありません。</font><font style="vertical-align: inherit;">10秒のセグメントを選択した場合は、状況に関係なく、この方法のみを押してください。</font></font></li>
<li><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変更されたかどうかに関係なく</font><strong><font style="vertical-align: inherit;">、常に全体の設定を提供します</font></strong><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">データプレーン（仮想マシン）自体がそれをどうするかを決定します。</font><font style="vertical-align: inherit;">デルタはプッシュしません。</font><font style="vertical-align: inherit;">大規模な中断または変更により、非常に大きくなる可能性があります。</font><font style="vertical-align: inherit;">潜在的に、これは不安定性と予測不能性の原因となる可能性があります。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ある種の常設の仕事をするとき、私たちはそれに対してもっとお金を払います。たとえば、100台の仮想マシンが毎秒構成を要求します。年間約1200ドルです。この金額は基本的にプログラマーの給与よりも少なく、プログラマーは従来のアプローチでコントロールプレーンの開発を任せることができます-失敗に対する反応と構成変更のみの配布です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例のように、構成を数秒ごとに変更すると、時間がかかります。しかし、多くの場合、構成の変更やサービスの起動には数分かかります-数秒では何も解決されません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
秒は、VPC設定を変更するときなど、構成を即座に変更する必要があるサービスにとって重要です。ここでは「常設」は対象外です。これは単なるパターンであり、規則ではありません。これがあなたのケースで機能しない場合は、使用しないでください。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">予備スケーリング</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この例では、バランサーインスタンスがクラッシュすると、残りの2番目のインスタンスがほぼ同時に2倍の負荷を受け取り、スケーリングを開始します。</font><font style="vertical-align: inherit;">大規模な障害では、大量のリソースを消費します。</font><font style="vertical-align: inherit;">3番目のパターンは、このプロセスを制御するのに役立ちます- </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事前</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><strong><font style="vertical-align: inherit;">スケーリングし</font></strong><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2つのアベイラビリティーゾーンの場合、50％未満を破棄するときにスケーリングします。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ch/wy/n4/chwyn4ffipap4mcwshur7bikoj4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてが事前に行われている場合、障害が発生した場合、残っているバランサーのインスタンスは2倍のトラフィックを受け入れる準備ができています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以前は、たとえば80％のように使用率が高い場合にのみスケーリングし、現在は45％にスケーリングしています。</font><font style="vertical-align: inherit;">システムはほとんどの時間アイドルであり、より高価になります。</font><font style="vertical-align: inherit;">しかし、これ</font><strong><font style="vertical-align: inherit;">は保険な</font></strong><font style="vertical-align: inherit;">ので、これに我慢して積極的にパターンを使用する準備ができています。</font></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">あなたは保険の支払いをしなければなりません、しかし深刻な問題の場合には勝利がすべての費用をカバーします。</font><font style="vertical-align: inherit;">パターンを使用する場合は、事前にすべてのリスクと価格を計算してください。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セルラーアーキテクチャ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービスを構築およびスケーリングするに</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、モノリス</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ハニカム構造</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（セルベース）の</font><font style="vertical-align: inherit;">2つの方法があります</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nc/y7/ab/ncy7abk8fzjvr8lsez7wwcjuc70.png"><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モノリス</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は単一の大きな容器として成長します。</font><font style="vertical-align: inherit;">リソースを追加すると、システムが膨張し、さまざまな限界に達し、線形特性が非線形になり、飽和状態になり、システムの「爆風半径」-システム全体。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
モノリスのテストが不十分である場合、驚き-「未知の未知数」-の可能性が高くなります。しかし、大きなモノリスを完全にテストすることはできません。たとえば、アクセスゾーン内にモノリスとして構築されている人気のあるサービス（これは多くのデータセンターです）の場合など、別のアクセスゾーンを構築する必要がある場合があります。現在と同様の巨大なテスト負荷を何らかの方法で作成することに加えて、これは財務上の観点からは不可能です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、ほとんどの場合、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セルラーアーキテクチャ（</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">システムが固定サイズのセルから構築される構成</font><font style="vertical-align: inherit;">）を使用し</font><font style="vertical-align: inherit;">ます。セルを追加することにより、それをスケーリングします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
セルラーアーキテクチャはAWSクラウドで人気があります。それはグリッチを分離し</font><strong><font style="vertical-align: inherit;">、爆風半径</font></strong><font style="vertical-align: inherit;">を</font><strong><font style="vertical-align: inherit;">減らすの</font></strong><font style="vertical-align: inherit;">に役立ちます</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1つ以上のセルに。中型のセルを完全にテストできます。これにより、リスクが大幅に軽減されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
造船でも同様のアプローチが使用されます。船または船舶の船体は、仕切りによって区画に分割されます。穴が開いた場合、1つ以上の区画が浸水しますが、船は沈みません。はい、それはタイタニック号を助けませんでしたが、氷山の問題に遭遇することはめったにありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Simple Shapes Serviceを例に、メッシュアプ​​ローチのアプリケーションを説明します。これはAWSサービスではないので、自分で考えました。これは、単純な幾何学的形状を操作するための単純なAPIのセットです。幾何学的形状のインスタンスを作成したり、IDで形状のタイプを要求したり、特定のタイプのすべてのインスタンスをカウントしたりできます。たとえば、</font></font><code>put(triangle)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いくつかのIDを持つ「三角形」オブジェクトが</font><font style="vertical-align: inherit;">リクエストで</font><font style="vertical-align: inherit;">作成さ</font><font style="vertical-align: inherit;">れ</font><font style="vertical-align: inherit;">ます。</font></font><code>getShape(id)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タイプ「triangle」、「circle」、または「rhombus」を返します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7t/z6/dv/7tz6dv0w3f9laswjhuwtbpedggs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービスを曇らせるには、異なるユーザーが同時に使用する必要があります。</font><font style="vertical-align: inherit;">マルチテナント化しましょう。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/64/hk/pq/64hkpq9niokkw8w-w9rsu7m-w04.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、図をセルに分割するために、パーティションを作成する方法を考え出す必要があります。</font><font style="vertical-align: inherit;">パーティションキーを選択するためのいくつかのオプションがあります。</font><font style="vertical-align: inherit;">最も単純なの</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は幾何学的な形</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。最初のセルのすべての菱形、2番目のセルの円、3番目のセルの三角形です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この方法には長所と短所があります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">他の数字よりも著しく少ない円がある場合、対応するセルは十分に活用されないままになります（不均一な分布）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一部のAPIリクエストは実装が簡単です。</font><font style="vertical-align: inherit;">たとえば、2番目のセルのすべてのオブジェクトを数えると、システム内の円の数がわかります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">他のクエリはより複雑です。</font><font style="vertical-align: inherit;">たとえば、IDで幾何学的形状を見つけるには、すべてのセルを通過する必要があります。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目の方法は</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、範囲によってオブジェクト</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の</font><strong><font style="vertical-align: inherit;">ID</font></strong><font style="vertical-align: inherit;">を使用すること</font><strong><font style="vertical-align: inherit;">です</font></strong><font style="vertical-align: inherit;">：最初のセルの最初の1000個のオブジェクト、2番目のセルの2番目。</font><font style="vertical-align: inherit;">したがって、分布はより均一になりますが、他にも困難があります。</font><font style="vertical-align: inherit;">たとえば、すべての三角形を数えるには、メソッドを使用する必要があり</font></font><code>scatter/gather</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。要求を各セルに分配し、それ自体の内部で三角形を数え、回答を収集し、要約して結果を生成します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3番目の方法- </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テナント分割</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（ユーザー向け）。ここで私たちは古典的な問題に直面しています。通常、クラウドには、何かを試して実際にはサービスをロードしない「小さな」ユーザーがたくさんいます。マストドンのユーザーがいます。数は少ないですが、大量のリソースを消費します。このようなユーザーは、どのセルにも適合しません。あなたはそれらを多くの細胞に分配するトリッキーな方法を考え出す必要があります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wp/1i/3c/wp1i3c0ac5bjnvnxividrzrq6fk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
理想的な方法はありません。各サービスは個別です。良い知らせは、ここでは世俗的な知恵が働くということです。薪を切るのではなく、繊維に沿って薪を切るほうが便利です。多くのサービスでは、これらの「ファイバー」は多かれ少なかれ明白です。次に、実験して最適なパーティションキーを見つけることができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
セルは相互に接続されています（弱いですが）。したがって、接続レベルが必要です。多くの場合、これはルーティング層またはマッピング層と呼ばれます。特定のリクエストを送信するセルを理解する必要があります。このレベルは可能な限りシンプルでなければなりません。その中にビジネスロジックを置かないようにしてください。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mg/os/ox/mgosox1qloxyngz5k1fd4wwy_ws.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
セルのサイズの問題が発生します：小さい-悪い、大きい-悪い。普遍的なアドバイスはありません-状況に応じて決定してください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AWSクラウドでは、サイズの異なる論理セルと物理セルを使用しています。セルサイズが大きいリージョナルサービスがあり、セルが小さいゾーンサービスがあります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/z9/s8/k-/z9s8k-8v60dwwojzqv86ozp7s7k.png"><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意。今年の4月上旬に、Saint Highload ++ Onlineでマイクロセルについて話しました。そこで、Amazon EBSコアサービスでのこのパターンの具体的な使用例について詳しく説明しました。</font></font></em><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マルチテナント</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユーザーが新しいバランサーを起動すると、各アベイラビリティーゾーンでインスタンスを受け取ります。</font><font style="vertical-align: inherit;">リソースが使用されているかどうかに関係なく、リソースは割り当てられ、このクラウドのテナントに排他的に属します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AWSの場合、サービスリソースの使用率は平均して非常に低いため、このアプローチは非効率的です。</font><font style="vertical-align: inherit;">これはコストに影響します。</font><font style="vertical-align: inherit;">クラウドユーザーにとって、これは柔軟なソリューションではありません。</font><font style="vertical-align: inherit;">たとえば、急激に変化する状況に適応することはできません。たとえば、リソースに予想外に増加した負荷を最短時間で提供することができません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fk/52/xg/fk52xgzaaqhgq09uw_zlhbhxpfc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CLBは、Amazonクラウドにおける最初のバランサーでした。</font><font style="vertical-align: inherit;">現在のサービスは、NLB（Network Load Balancer）などのマルチテナントアプローチを使用しています。</font><font style="vertical-align: inherit;">そのようなネットワークサービスの基本、「エンジン」は</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HyperPlaneです。</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは内部にあり、エンドユーザーには見えない、膨大な数の仮想マシン（ノード）です。</font><strong><font style="vertical-align: inherit;">マルチテナントアプローチ</font></strong><font style="vertical-align: inherit;">または5番目のパターンの</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-b/65/3a/-b653as3g91ombi9itfq5wwqjxg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
利点</font><font style="vertical-align: inherit;">。</font></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">耐障害性は根本的に高いです</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">HyperPlaneでは、膨大な数のノードが既に実行されており、負荷を待機しています。</font><font style="vertical-align: inherit;">ノードは相互の状態を認識しています。一部のリソースに障害が発生すると、負荷は残りのリソースに瞬時に分散されます。</font><font style="vertical-align: inherit;">ユーザーは大量のクラッシュに気づくことすらありません。</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ピーク負荷保護</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">テナントは自分の生活を送っており、通常、その負荷は互いに相関していません。</font><font style="vertical-align: inherit;">HyperPlaneの総平均負荷は非常にスムーズです。</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そのようなサービスの利用は根本的に優れてい</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">したがって、より良いパフォーマンスを提供し、それらは安価です。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いいですね！しかし、マルチテナントアプローチには欠点があります。この図では、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてのノードに分散さ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">れた3つのテナント（ひし形、円、三角形）を持つHyperPlaneフリート</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kv/by/dg/kvbydgnlm6a8plns-cewltag1e8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これにより、古典的なノイズの多いネイバー問題が発生します。非常に高いトラフィックまたは悪いトラフィックを生成するテナントの破壊的なアクションは、すべてのユーザーに影響を与える可能性があります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3f/b9/v4/3fb9v4-hnl27k0sgihgjybo_x70.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このようなシステムの「爆風半径」はすべてテナントです。実際のAWSアベイラビリティーゾーンで破壊的な「騒々しい隣人」の可能性は高くありません。しかし、私たちは常に最悪の事態に備える必要があります。メッシュアプ​​ローチを使用して防御します。ノードのグループをセルとして選択します。このコンテキストでは、それらをシャードと呼びます。セル、シャード、パーティション-ここでは1つと同じです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/d1/7z/yy/d17zyyesjijnpsqpllrwhlthqn4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この例では、「騒々しい隣人」としての菱形は、1つのテナント、つまり三角形にのみ影響します。</font><font style="vertical-align: inherit;">しかし、三角形は非常に苦痛になります。</font><font style="vertical-align: inherit;">効果を滑らかにするために、6番目のパターンを適用します-混合シャーディング。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シャーディングのシャッフル</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テナントをノードにランダムに分散します。</font><font style="vertical-align: inherit;">たとえば、菱形は1、3、および6ノードに着陸し、三角形は2、6、および8に着陸します。8つのノードとサイズ3の破片があります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ft/6n/-w/ft6n-wgdpnlw1g5_t6thpanrtdm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは単純な組み合わせ論が機能します。</font><font style="vertical-align: inherit;">54％の確率で、テナント間の交差は1つだけになります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cg/uu/jq/cguujqg-8xjmp-cktarugsfdd6c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「騒々しい隣人」は、1つのテナントのみに影響し、負荷全体ではなく、30％のみに影響します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際に近い構成を検討してください-100ノード、シャードサイズ5。77％の確率で、交差はまったくありません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/14/tj/dr/14tjdrziuvtturqjld0comvzycy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
シャーディングをシャッフルすると、「爆発範囲」を大幅に縮小できます。</font><font style="vertical-align: inherit;">このアプローチは多くのAWSサービスで使用されています。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「小さな艦隊は大きな艦隊を引き起こし、その逆は起こらない」</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
大量の障害から回復する場合、多くのコンポーネントの構成を更新します。この場合の典型的な質問は、変更された構成をプッシュまたは箇条書きにすることですか？変更の開始者は誰ですか：構成変更を含むソース、またはそのコンシューマーですか？しかし、これらの質問は間違っています。正しい質問は、どの艦隊が大きいかです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
単純な状況を考えます。フロントエンド仮想マシンの大規模なフリートと特定の数のバックエンド。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vg/av/er/vgaverdwdhgvag5w_pbichyvro0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メッシュアプ​​ローチを使用します。フロントエンドインスタンスのグループは特定のバックエンドで機能します。これを行うには、ルーティング、つまりバックエンドとフロントエンドのマッピングを決定します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bx/_a/_a/bx_a_ayxwrvjrvh9uwmaj5ifsru.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
静的ルーティングは適切ではありません。ほとんどのルートをすばやく変更する必要がある場合、ハッシュアルゴリズムは大規模な障害ではうまく機能しません。したがって、使用することをお勧めします</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ダイナミックルーティング</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。フロントエンドインスタンスとバックエンドインスタンスの大きな艦隊の隣に、ルーティングのみを処理する小さなサービスを配置します。彼はいつでもバックエンドとフロントエンドのマッピングを知って割り当てます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ji/o3/kl/jio3kl9vxu3hx5p9b1uvfgxsih8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
大きなクラッシュが発生した場合、多くのフロントエンドインスタンスが落ちました。それらは大規模に回復し始め、ほぼ同時にルーティングサービスからマッピング構成を要求します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nd/qv/fz/ndqvfzx9d_2qn6nfnu8bpmmjrqc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
小規模なルーティングサービスは、膨大な数のリクエストにさらされています。彼はその負荷に対処せず、最良の場合、それは低下し、最悪の場合彼は死ぬでしょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、小規模なサービスから構成変更を要求するのではなく、システムを構築して「赤ちゃん」自体を</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多数のインスタンスに向けて構成の変更を開始しました</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ua/hf/gq/uahfgqlyxt-yn190bzu-q8on_rw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一定の仕事のパターンを使用します。</font><font style="vertical-align: inherit;">小さなルーティングサービスは、数秒に1回、すべてのフロントエンドフリートインスタンスに構成を送信します。</font><font style="vertical-align: inherit;">彼は素晴らしいサービスを過負荷にすることはできません。</font><font style="vertical-align: inherit;">7番目のパターンは、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安定性と回復力の</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">向上に役立ちます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の7つのパターンはシステムを強化します。</font><font style="vertical-align: inherit;">後者のパターンは動作が異なります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">負荷を落とす</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下は、遅延と負荷の典型的なグラフです。</font><font style="vertical-align: inherit;">グラフの右側は「ニー」であり、非常に高い負荷では、わずかな増加でも待ち時間が大幅に増加します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/sb/fw/vq/sbfwvqhbni-3lzbd0gjlnorzzqi.png" width="450"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通常モードでは、サービスをスケジュールの右側に移動することはありません。これを制御する簡単な方法は、時間どおりにリソースを追加することです。ただし、トラブルに備えております。たとえば、大規模な障害から回復して、チャートの右側に移動できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
チャートにクライアントのタイムアウトを表示します。たとえば、サービス内の別のコンポーネントなど、誰でもクライアントになることができます。簡単にするために、50パーセンタイルの遅延グラフを描画します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/g5/sj/vw/g5sjvwfpnmekcg2mu-kiynw1p6k.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">電圧低下</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と呼ばれる状況に直面してい</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">街で</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">停電した</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ときの</font><strong><font style="vertical-align: inherit;">停電</font></strong><font style="vertical-align: inherit;">という言葉を知っているかもしれません</font><font style="vertical-align: inherit;">。ブラウンアウトとは何かが機能するときですが、非常に悪くて遅いので、数えれば、まったく機能しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ブラウンゾーンの電圧低下を見てみましょう。サービスはクライアントからリクエストを受け取り、それを処理して結果を返しました。ただし、ケースの半分では、クライアントはすでにタイムアウトしており、誰も結果を待っていません。残りの半分では、結果はタイムアウトよりも速く返されますが、遅いシステムでは時間がかかりすぎます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは二重の問題に直面しました：すでに過負荷になっていて、スケジュールの右側にいますが、それでも私たちはまだ「空気を暖めている」ため、多くの無駄な作業をしています。これを回避するには？</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「膝」</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -チャートの変曲点</font><strong><font style="vertical-align: inherit;">を見つけます</font></strong></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">測定または理論的に推定します。</font><font style="vertical-align: inherit;">変曲点の右側に行くように強制する</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トラフィック</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><strong><font style="vertical-align: inherit;">ドロップします</font></strong></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></strong><br>
<br>
<img src="https://habrastorage.org/webt/nz/2e/t7/nz2et7zg-cebdkle6rzusm0f0ts.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リクエストの一部は無視してください。</font><font style="vertical-align: inherit;">それらを処理しようとはしませんが、すぐにクライアントにエラーを返します。</font><font style="vertical-align: inherit;">オーバーロードがあっても、この操作は余裕があります。これは「安価」です。</font><font style="vertical-align: inherit;">要求が満たされず、サービスの全体的な可用性が低下します。</font><font style="vertical-align: inherit;">拒否された要求は、クライアントからの1回または数回の再試行後、遅かれ早かれ処理されますが。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bz/4n/xk/bz4nxkpmofmaqg-deszxrwhra5m.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同時に、リクエストの別の部分は低レイテンシが保証されて処理されます。</font><font style="vertical-align: inherit;">その結果、私たちは無駄な仕事をせず、私たちがしていることはうまくやっています。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">障害に対するシステム設計のパターンの簡単な絞り込み</font></font></h2><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">隔離と規制</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。特定の種類のクエリを優先することが理にかなっている場合があります。たとえば、新しいリソースを作成するリクエストが比較的少量の場合、それらをキューの一番上に置くことができます。これが他のユーザーを侵害しないことが重要です。大規模な障害では、リソースの回復を待っているユーザーは大きな違いを感じません。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フルタイムの仕事</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。サービスモードの切り替えを削減または完全に排除します。 1つのモードは、緊急事態や作業状況に関係なく、常に安定して機能し、コントロールプレーンの安定性と予測可能性を根本的に向上させます。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">予備スケーリング</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。より低い廃棄値で事前にスケーリングします。あなたはこれのためにもう少し支払う必要がありますが、これは深刻なシステム障害の間に完済する保険です。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セルラーアーキテクチャ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。多くの疎結合セルがモノリスよりも好まれます。メッシュアプ​​ローチにより、「爆風半径」と予期しないエラーの可能性が減少します。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マルチテナントアプローチ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">により、サービスの利用率</font><strong><font style="vertical-align: inherit;">が</font></strong><font style="vertical-align: inherit;">大幅に向上し、コストが削減され、「爆風半径」が減少します。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シャーディングのシャッフル</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。これは、マルチテナントサービスに適用されるアプローチです。さらに、「爆風半径」を制御できます。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「小さな艦隊は大きな艦隊を引き起こし、その逆は起こらない」</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。小さなサービスが大きな構成への変更を開始できるように、サービスを構築しようとしています。一定の負荷パターンと組み合わせて使用​​することがよくあります。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">負荷を落とす</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。緊急事態では、有用な仕事のみを行うように努め、それをうまく行います。これを行うには、まだ処理できない負荷の一部を破棄します。</font></font><br>
<br>
<blockquote>  —    ,    Saint HighLoad++ Online.  --  , Q&amp;A-,  ,    .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> -</a>         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>. ,   -   . <br>
<br>
  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>  telegram- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">@HighLoadChannel</a> —         ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>.</blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja497322/index.html">カスタマージャーニーマップによる客観的な品質スコアテスト</a></li>
<li><a href="../ja497324/index.html">「目の前のりんごのように...」またはマイクロコントローラー（CannyまたはArduino）とRaspberry PIに基づいてシンプルなセキュリティシステムを作成します</a></li>
<li><a href="../ja497326/index.html">DNSSECによるより安全なSSH接続</a></li>
<li><a href="../ja497328/index.html">言語を学習する簡単な方法（すべて）</a></li>
<li><a href="../ja497330/index.html">Chromeリモートデスクトップ。リモートサポート</a></li>
<li><a href="../ja497334/index.html">悪名高いバグとClickHouseの例でそれらを回避する方法</a></li>
<li><a href="../ja497336/index.html">90年代のコンピュータブランド、パート3、最終</a></li>
<li><a href="../ja497338/index.html">先週交通機関に何が起こったのか-危機が進展している</a></li>
<li><a href="../ja497340/index.html">COVID-19：ニュースの読み取りを停止してデータの分析を開始する方法</a></li>
<li><a href="../ja497342/index.html">APIリクエストを監視するブラウザー：フロントエンドとバックエンド間の安全な通信の構築</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>