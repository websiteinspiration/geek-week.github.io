<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌌 🌉 👨🏾‍🎤 Métodos para otimizar consultas LINQ em C # .NET 🐉 🍦 💎</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introdução
 No presente artigo , discutimos algumas técnicas de otimização LINQ consultas . 
 Aqui estão mais algumas abordagens de otimização de códi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Métodos para otimizar consultas LINQ em C # .NET</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/489226/"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introdução</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">presente artigo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , discutimos algumas técnicas de otimização </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQ consultas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui estão mais algumas abordagens de otimização de código relacionadas a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consultas LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sabe-se que o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Consulta Integrada à Linguagem) é uma linguagem simples e conveniente para consultar uma fonte de dados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQ to SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é uma tecnologia de acesso a dados em um DBMS. Essa é uma ferramenta poderosa para trabalhar com dados, onde as consultas são construídas por meio de uma linguagem declarativa, que serão convertidas em </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consultas SQL pela</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> plataforma e enviadas ao servidor de banco de dados para execução. No nosso caso, por DBMS queremos dizer o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS SQL Server</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, as </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consultas LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> não </font><b><font style="vertical-align: inherit;">são</font></b><font style="vertical-align: inherit;"> convertidas em </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consultas SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gravadas de maneira ideal </font><font style="vertical-align: inherit;">que um DBA experiente poderia escrever com todas as nuances da otimização de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consultas SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conexões ideais ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JOIN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) e filtragem de resultados ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ONDE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">muitas nuances no uso de compostos e condições de grupo</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">muitas variações na substituição das condições </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> por </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NOT IN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , &lt;&gt; por </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS</font></font></b></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cache intermediário de resultados por meio de tabelas temporárias, CTE, variáveis ​​de tabela</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usando uma cláusula ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OPTION</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) com instruções e dicas de tabela </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WITH</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (...)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o uso de visualizações indexadas, como um dos meios para se livrar de leituras redundantes de dados em amostras</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os principais gargalos de desempenho das </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consultas SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> resultantes </font><font style="vertical-align: inherit;">ao compilar </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consultas LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> são:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consolidação de todo o mecanismo de seleção de dados em uma solicitação</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">duplicação de blocos de código idênticos, o que leva a várias leituras extras de dados</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">grupos de condições multicomponentes (lógicas "e" e "ou") - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AND</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OR</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , combinando-se em condições difíceis, levam ao fato de que o otimizador, com índices não clusterizados adequados, pelos campos necessários, eventualmente começa a varrer pelo índice de cluster ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INDEX SCAN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) por grupo de condições</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o aninhamento profundo de subconsultas torna muito problemático analisar </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instruções SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e analisar planos de consulta de desenvolvedores e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DBAs</font></font></b></li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Métodos de otimização</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora passamos diretamente para os métodos de otimização.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1) Indexação adicional</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
É melhor considerar filtros nas principais tabelas de amostragem, pois muitas vezes toda a consulta é criada em torno de uma ou duas tabelas principais (aplicativos-pessoas-operações) e com um conjunto de condições padrão (IsClosed, Canceled, Enabled, Status). É importante que as amostras identificadas criem os índices correspondentes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa solução faz sentido ao escolher um desses campos que limita significativamente o conjunto retornado à consulta. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, temos 500.000 aplicativos. No entanto, existem apenas 2.000 entradas ativas. Em seguida, um índice selecionado corretamente nos salvará do </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INDEX SCAN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> em uma tabela grande e permitirá selecionar rapidamente os dados por meio de um índice não clusterizado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A falta de índices também pode ser detectada através de prompts para analisar planos de consulta ou coletar estatísticas para visualizações do sistema</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS SQL Server</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sys.dm_db_missing_index_groups</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sys.dm_db_missing_index_group_stats</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sys.dm_db_missing_index_details</font></font></a></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos os dados de exibição contêm informações sobre índices ausentes, com exceção dos índices espaciais. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, índices e cache geralmente são métodos para lidar com os efeitos de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consultas LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mal gravadas </font><font style="vertical-align: inherit;">e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consultas SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como a dura prática da vida mostra para os negócios, muitas vezes é importante implementar os recursos de negócios até uma certa data. E, portanto, muitas vezes consultas pesadas são colocadas em segundo plano com o cache. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso é parcialmente justificado, pois o usuário nem sempre precisa dos dados mais recentes e ocorre um nível aceitável de resposta da interface do usuário. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa abordagem permite solucionar as necessidades dos negócios, mas reduz a eficiência do sistema de informações, simplesmente atrasando a solução dos problemas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Também é importante lembrar que, no processo de pesquisa necessário para adicionar novos índices, as propostas de </font><font style="vertical-align: inherit;">otimização </font><font style="vertical-align: inherit;">do </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> podem estar incorretas, inclusive nas seguintes condições:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se já existirem índices com um conjunto semelhante de campos</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se os campos na tabela não puderem ser indexados devido a restrições de indexação (mais sobre isso é descrito </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2) Mesclando atributos em um novo atributo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Às vezes, alguns campos da mesma tabela pelos quais ocorre um grupo de condições podem ser substituídos pela introdução de um novo campo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso é especialmente verdadeiro para os campos de estado, que por tipo são geralmente bit a bit ou número inteiro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exemplo: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IsClosed = 0 AND Canceled = 0 AND Enabled = 0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é substituído por </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Status = 1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui, você insere o atributo inteiro Status, que é fornecido preenchendo esses status na tabela. </font><font style="vertical-align: inherit;">O próximo passo é indexar esse novo atributo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa é uma solução fundamental para o problema de desempenho, porque estamos solicitando dados sem cálculos desnecessários.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3) Materialização da submissão</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infelizmente, as </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consultas LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> não podem usar diretamente tabelas temporárias, CTEs e variáveis ​​de tabela. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, há outra maneira de otimizar para este caso - são as visualizações indexadas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um grupo de condições (do exemplo acima) </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IsClosed = 0 AND Canceled = 0 AND Enabled = 0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (ou um conjunto de outras condições semelhantes) se torna uma boa opção para usá-las em uma exibição indexada, armazenando em cache uma pequena fatia de dados de um conjunto grande. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas há várias limitações ao materializar uma exibição:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usando subconsultas, as cláusulas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devem ser substituídas usando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JOIN</font></font></b></li>
<li><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">Não</font></b><font style="vertical-align: inherit;"> é </font><b><font style="vertical-align: inherit;">possível</font></b><font style="vertical-align: inherit;"> usar as </font><b><font style="vertical-align: inherit;">cláusulas </font></b></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNION</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNION ALL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXCEPTION</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INTERSECT</font></font></b></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">você não pode usar dicas de tabela e cláusulas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OPTION</font></font></b></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sem capacidade de trabalhar com ciclos</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é impossível exibir dados em uma visualização de tabelas diferentes</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
É importante lembrar que os benefícios reais do uso de uma exibição indexada podem ser obtidos apenas pela indexação. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas, ao invocar uma visualização, esses índices não podem ser usados ​​e, para usá-los explicitamente, você deve especificar </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WITH (NOEXPAND)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como </font><font style="vertical-align: inherit;">é impossível definir dicas de tabela </font><font style="vertical-align: inherit;">em </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consultas LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , você deve fazer outra representação - um "invólucro" do seguinte formato:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> _ <span class="hljs-keyword">AS</span> <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> MAT_VIEW <span class="hljs-keyword">WITH</span> (NOEXPAND);
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4) Usando funções de tabela</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Geralmente, em </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consultas LINQ,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> grandes blocos de subconsulta ou blocos que usam representações com uma estrutura complexa formam a consulta final com uma estrutura de execução muito complexa e não ideal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Principais benefícios do uso de funções de tabela em </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consultas LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A capacidade, como no caso de visualizações, de usar e especificar como um objeto, mas você pode passar um conjunto de parâmetros de entrada: </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FROM FUNCTION (@ param1, @ param2 ...)</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
no final, pode obter uma amostragem de dados flexível</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ao usar uma função de tabela, não existem restrições tão fortes como no caso das visualizações indexadas descritas acima:</font></font><br>
<br>
<ol>
<li> :<br>
 <b>LINQ</b>             .<br>
     .<br>
        ,          </li>
<li>  ,     , :<br>
<br>
<ul>
<li>    (   )</li>
<li>     </li>
<li> <b>UNION</b>  <b>EXISTS</b></li>
</ul></li>
</ol><br>
</li>
<li> <b>OPTION</b>  ,       <b>OPTION(MAXDOP N)</b>,    . :<br>
<br>
<ul>
<li>      <b>OPTION (RECOMPILE)</b></li>
<li>         ,    <b>OPTION (FORCE ORDER)</b></li>
</ul><br>
   <b>OPTION</b>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a>.<br>
</li>
<li>      :<br>
        (     ),         .<br>
,  ,     <b>WHERE</b>    <b>(a, b, c)</b>.<br>
<br>
       <b>a = 0 and b = 0</b>.<br>
<br>
,    <b>c</b>  .<br>
<br>
  <b>a = 0 and b = 0</b>          ,    <b></b>      .<br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui, a função de tabela pode ser uma opção melhor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Além disso, a função de tabela é mais previsível e constante no tempo de execução.</font></font><br>
</li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos considerar um exemplo de implementação usando o exemplo do banco de dados de perguntas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Há uma consulta </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que combina várias tabelas e usa uma visualização (OperativeQuestions), que verifica por email a afiliação (via </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) de "Consultas ativas" ([OperativeQuestions]):</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solicitação nº 1</font></font></b><div class="spoiler_text"><pre><code class="sql hljs">(@p__linq__0 nvarchar(4000))<span class="hljs-keyword">SELECT</span>
<span class="hljs-number">1</span> <span class="hljs-keyword">AS</span> [C1],<font></font>
[Extent1].[<span class="hljs-keyword">Id</span>] <span class="hljs-keyword">AS</span> [<span class="hljs-keyword">Id</span>],<font></font>
[Join2].[Object_Id] <span class="hljs-keyword">AS</span> [Object_Id],<font></font>
[Join2].[ObjectType_Id] <span class="hljs-keyword">AS</span> [ObjectType_Id],<font></font>
[Join2].[<span class="hljs-keyword">Name</span>] <span class="hljs-keyword">AS</span> [<span class="hljs-keyword">Name</span>],<font></font>
[Join2].[ExternalId] <span class="hljs-keyword">AS</span> [ExternalId]
<span class="hljs-keyword">FROM</span> [dbo].[Questions] <span class="hljs-keyword">AS</span> [Extent1]
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> (<span class="hljs-keyword">SELECT</span> [Extent2].[Object_Id] <span class="hljs-keyword">AS</span> [Object_Id],<font></font>
[Extent2].[Question_Id] <span class="hljs-keyword">AS</span> [Question_Id], [Extent3].[ExternalId] <span class="hljs-keyword">AS</span> [ExternalId],<font></font>
[Extent3].[ObjectType_Id] <span class="hljs-keyword">AS</span> [ObjectType_Id], [Extent4].[<span class="hljs-keyword">Name</span>] <span class="hljs-keyword">AS</span> [<span class="hljs-keyword">Name</span>]
<span class="hljs-keyword">FROM</span> [dbo].[ObjectQuestions] <span class="hljs-keyword">AS</span> [Extent2]
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> [dbo].[Objects] <span class="hljs-keyword">AS</span> [Extent3] <span class="hljs-keyword">ON</span> [Extent2].[Object_Id] = [Extent3].[<span class="hljs-keyword">Id</span>]
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> [dbo].[ObjectTypes] <span class="hljs-keyword">AS</span> [Extent4] 
<span class="hljs-keyword">ON</span> [Extent3].[ObjectType_Id] = [Extent4].[<span class="hljs-keyword">Id</span>] ) <span class="hljs-keyword">AS</span> [Join2] 
<span class="hljs-keyword">ON</span> [Extent1].[<span class="hljs-keyword">Id</span>] = [Join2].[Question_Id]
<span class="hljs-keyword">WHERE</span> ([Extent1].[AnswerId] <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">AND</span> (<span class="hljs-number">0</span> = [Extent1].[<span class="hljs-keyword">Exp</span>]) <span class="hljs-keyword">AND</span> ( <span class="hljs-keyword">EXISTS</span> (<span class="hljs-keyword">SELECT</span>
<span class="hljs-number">1</span> <span class="hljs-keyword">AS</span> [C1]
<span class="hljs-keyword">FROM</span> [dbo].[OperativeQuestions] <span class="hljs-keyword">AS</span> [Extent5]
<span class="hljs-keyword">WHERE</span> (([Extent5].[Email] = @p__linq__0) <span class="hljs-keyword">OR</span> (([Extent5].[Email] <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>) 
<span class="hljs-keyword">AND</span> (@p__linq__0 <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>))) <span class="hljs-keyword">AND</span> ([Extent5].[<span class="hljs-keyword">Id</span>] = [Extent1].[<span class="hljs-keyword">Id</span>])<font></font>
));<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A visualização possui uma estrutura bastante complicada: possui junções de subconsulta e o uso da classificação </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DISTINCT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que geralmente é uma operação que consome muitos recursos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma seleção de cerca de dez mil registros de OperativeQuestions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O principal problema dessa consulta é que, para registros de uma consulta externa, é realizada uma subconsulta interna na visualização [OperativeQuestions], que deve limitar a amostra de saída (via </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) a centenas de registros </font><font style="vertical-align: inherit;">para [Email] = @ p__linq__0 </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E pode parecer que a subconsulta calcule os registros uma vez por [Email] = @ p__linq__0 e, em seguida, essas duas centenas de registros deverão ser conectadas pelas Id Id Questions, e a consulta será rápida.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De fato, todas as tabelas são conectadas em série: as perguntas de identificação e a identificação de OperativeQuestions são verificadas quanto à conformidade e o email é filtrado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De fato, a solicitação funciona com todas as dezenas de milhares de registros OperativeQuestions e você só precisa de dados de interesse no Email. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OperativeQuestions exibir texto:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solicitação nº 2</font></font></b><div class="spoiler_text"><pre><code class="sql hljs"> 
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> [dbo].[OperativeQuestions]
<span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> Q.Id, USR.email <span class="hljs-keyword">AS</span> Email
<span class="hljs-keyword">FROM</span>            [dbo].Questions <span class="hljs-keyword">AS</span> Q <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span>
                         [dbo].ProcessUserAccesses <span class="hljs-keyword">AS</span> BPU <span class="hljs-keyword">ON</span> BPU.ProcessId = CQ.Process_Id 
<span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">APPLY</span>
                     (<span class="hljs-keyword">SELECT</span>   <span class="hljs-number">1</span> <span class="hljs-keyword">AS</span> HasNoObjects
                      <span class="hljs-keyword">WHERE</span>   <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span>
                                    (<span class="hljs-keyword">SELECT</span>   <span class="hljs-number">1</span>
                                     <span class="hljs-keyword">FROM</span>     [dbo].ObjectUserAccesses <span class="hljs-keyword">AS</span> BOU
                                     <span class="hljs-keyword">WHERE</span>   BOU.ProcessUserAccessId = BPU.[<span class="hljs-keyword">Id</span>] <span class="hljs-keyword">AND</span> BOU.[<span class="hljs-keyword">To</span>] <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>)<font></font>
) <span class="hljs-keyword">AS</span> BO <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span>
                         [dbo].Users <span class="hljs-keyword">AS</span> USR <span class="hljs-keyword">ON</span> USR.Id = BPU.UserId
<span class="hljs-keyword">WHERE</span>        CQ.[<span class="hljs-keyword">Exp</span>] = <span class="hljs-number">0</span> <span class="hljs-keyword">AND</span> CQ.AnswerId <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">AND</span> BPU.[<span class="hljs-keyword">To</span>] <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span> 
<span class="hljs-keyword">AND</span> (BO.HasNoObjects = <span class="hljs-number">1</span> <span class="hljs-keyword">OR</span>
              <span class="hljs-keyword">EXISTS</span> (<span class="hljs-keyword">SELECT</span>   <span class="hljs-number">1</span>
                           <span class="hljs-keyword">FROM</span>   [dbo].ObjectUserAccesses <span class="hljs-keyword">AS</span> BOU <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span>
                                      [dbo].ObjectQuestions <span class="hljs-keyword">AS</span> QBO 
                                                  <span class="hljs-keyword">ON</span> QBO.[Object_Id] =BOU.ObjectId
                               <span class="hljs-keyword">WHERE</span>  BOU.ProcessUserAccessId = BPU.Id 
                               <span class="hljs-keyword">AND</span> BOU.[<span class="hljs-keyword">To</span>] <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">AND</span> QBO.Question_Id = CQ.Id));
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Representação de mapeamento original no DbContext (EF Core 2)</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">public class QuestionsDbContext : DbContext<font></font>
{<font></font>
    //...<font></font>
    public DbQuery&lt;OperativeQuestion&gt; OperativeQuestions { get; set; }<font></font>
    //...<font></font>
    protected override void OnModelCreating(ModelBuilder modelBuilder)<font></font>
    {<font></font>
        modelBuilder.Query&lt;OperativeQuestion&gt;().ToView("OperativeQuestions");<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Consulta LINQ original</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">var businessObjectsData = await context<font></font>
    .OperativeQuestions<font></font>
    .Where(x =&gt; x.Email == Email)<font></font>
    .Include(x =&gt; x.Question)<font></font>
    .Select(x =&gt; x.Question)<font></font>
    .SelectMany(x =&gt; x.ObjectQuestions,<font></font>
                (x, bo) =&gt; new<font></font>
                {<font></font>
                    Id = x.Id,<font></font>
                    ObjectId = bo.Object.Id,<font></font>
                    ObjectTypeId = bo.Object.ObjectType.Id,<font></font>
                    ObjectTypeName = bo.Object.ObjectType.Name,<font></font>
                    ObjectExternalId = bo.Object.ExternalId<font></font>
                })<font></font>
    .ToListAsync();<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse caso em particular, uma solução para esse problema é considerada sem alterações na infraestrutura, sem a introdução de uma tabela separada com resultados prontos ("Consultas ativas"), para a qual seria necessário um mecanismo para preencher seus dados e mantê-los atualizados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Embora essa seja uma boa solução, há outra opção para otimizar essa tarefa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O objetivo principal é armazenar em cache as entradas por [Email] = @ p__linq__0 na visualização OperativeQuestions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entramos na função de tabela [dbo]. [OperativeQuestionsUserMail] no banco de dados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enviando email como parâmetro de entrada, retornamos a tabela de valores:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solicitação nº 3</font></font></b><div class="spoiler_text"><pre><code class="sql hljs">
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> [dbo].[OperativeQuestionsUserMail]<font></font>
(<font></font>
    @Email  <span class="hljs-keyword">nvarchar</span>(<span class="hljs-number">4000</span>)<font></font>
)<font></font>
<span class="hljs-keyword">RETURNS</span>
@tbl <span class="hljs-keyword">TABLE</span><font></font>
(<font></font>
    [<span class="hljs-keyword">Id</span>]           uniqueidentifier,<font></font>
    [Email]      <span class="hljs-keyword">nvarchar</span>(<span class="hljs-number">4000</span>)<font></font>
)<font></font>
<span class="hljs-keyword">AS</span>
<span class="hljs-keyword">BEGIN</span>
        <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> @tbl ([<span class="hljs-keyword">Id</span>], [Email])
        <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">Id</span>, @Email
        <span class="hljs-keyword">FROM</span> [OperativeQuestions]  <span class="hljs-keyword">AS</span> [x] <span class="hljs-keyword">WHERE</span> [x].[Email] = @Email;<font></font>
     <font></font>
    RETURN;<font></font>
<span class="hljs-keyword">END</span>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso retorna uma tabela de valores com uma estrutura de dados predefinida. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para que as consultas para OperativeQuestionsUserMail sejam ideais, tenham planos de consulta ideais, é necessária uma estrutura rigorosa, e não </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RETURNS TABLE AS RETURN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse caso, a Solicitação 1 desejada é convertida na Solicitação 4:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solicitação nº 4</font></font></b><div class="spoiler_text"><pre><code class="sql hljs">(@p__linq__0 nvarchar(4000))<span class="hljs-keyword">SELECT</span>
<span class="hljs-number">1</span> <span class="hljs-keyword">AS</span> [C1],<font></font>
[Extent1].[<span class="hljs-keyword">Id</span>] <span class="hljs-keyword">AS</span> [<span class="hljs-keyword">Id</span>],<font></font>
[Join2].[Object_Id] <span class="hljs-keyword">AS</span> [Object_Id],<font></font>
[Join2].[ObjectType_Id] <span class="hljs-keyword">AS</span> [ObjectType_Id],<font></font>
[Join2].[<span class="hljs-keyword">Name</span>] <span class="hljs-keyword">AS</span> [<span class="hljs-keyword">Name</span>],<font></font>
[Join2].[ExternalId] <span class="hljs-keyword">AS</span> [ExternalId]
<span class="hljs-keyword">FROM</span> (
    <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">Id</span>, Email <span class="hljs-keyword">FROM</span> [dbo].[OperativeQuestionsUserMail] (@p__linq__0)<font></font>
) <span class="hljs-keyword">AS</span> [Extent0]
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> [dbo].[Questions] <span class="hljs-keyword">AS</span> [Extent1] <span class="hljs-keyword">ON</span>([Extent0].Id=[Extent1].Id)
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> (<span class="hljs-keyword">SELECT</span> [Extent2].[Object_Id] <span class="hljs-keyword">AS</span> [Object_Id], [Extent2].[Question_Id] <span class="hljs-keyword">AS</span> [Question_Id], [Extent3].[ExternalId] <span class="hljs-keyword">AS</span> [ExternalId], [Extent3].[ObjectType_Id] <span class="hljs-keyword">AS</span> [ObjectType_Id], [Extent4].[<span class="hljs-keyword">Name</span>] <span class="hljs-keyword">AS</span> [<span class="hljs-keyword">Name</span>]
<span class="hljs-keyword">FROM</span> [dbo].[ObjectQuestions] <span class="hljs-keyword">AS</span> [Extent2]
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> [dbo].[Objects] <span class="hljs-keyword">AS</span> [Extent3] <span class="hljs-keyword">ON</span> [Extent2].[Object_Id] = [Extent3].[<span class="hljs-keyword">Id</span>]
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> [dbo].[ObjectTypes] <span class="hljs-keyword">AS</span> [Extent4] 
<span class="hljs-keyword">ON</span> [Extent3].[ObjectType_Id] = [Extent4].[<span class="hljs-keyword">Id</span>] ) <span class="hljs-keyword">AS</span> [Join2] 
<span class="hljs-keyword">ON</span> [Extent1].[<span class="hljs-keyword">Id</span>] = [Join2].[Question_Id]
<span class="hljs-keyword">WHERE</span> ([Extent1].[AnswerId] <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">AND</span> (<span class="hljs-number">0</span> = [Extent1].[<span class="hljs-keyword">Exp</span>]);
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mapeando visões e funções no DbContext (EF Core 2)</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">public class QuestionsDbContext : DbContext<font></font>
{<font></font>
    //...<font></font>
    public DbQuery&lt;OperativeQuestion&gt; OperativeQuestions { get; set; }<font></font>
    //...<font></font>
    protected override void OnModelCreating(ModelBuilder modelBuilder)<font></font>
    {<font></font>
        modelBuilder.Query&lt;OperativeQuestion&gt;().ToView("OperativeQuestions");<font></font>
    }<font></font>
}<font></font>
 <font></font>
public static class FromSqlQueries<font></font>
{<font></font>
    public static IQueryable&lt;OperativeQuestion&gt; GetByUserEmail(this DbQuery&lt;OperativeQuestion&gt; source, string Email)<font></font>
        =&gt; source.FromSql($"SELECT Id, Email FROM [dbo].[OperativeQuestionsUserMail] ({Email})");<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Consulta LINQ final</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">var businessObjectsData = await context<font></font>
    .OperativeQuestions<font></font>
    .GetByUserEmail(Email)<font></font>
    .Include(x =&gt; x.Question)<font></font>
    .Select(x =&gt; x.Question)<font></font>
    .SelectMany(x =&gt; x.ObjectQuestions,<font></font>
                (x, bo) =&gt; new<font></font>
                {<font></font>
                    Id = x.Id,<font></font>
                    ObjectId = bo.Object.Id,<font></font>
                    ObjectTypeId = bo.Object.ObjectType.Id,<font></font>
                    ObjectTypeName = bo.Object.ObjectType.Name,<font></font>
                    ObjectExternalId = bo.Object.ExternalId<font></font>
                })<font></font>
    .ToListAsync();<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A ordem do tempo de execução diminuiu de 200-800 ms, para 2-20 ms. Etc., ou seja, dez vezes mais rápido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se levarmos mais em média, em vez de 350 ms, temos 8 ms. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das vantagens óbvias, também obtemos:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">redução geral na carga de leitura,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Probabilidade de bloqueio significativamente reduzida</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">redução do tempo médio de bloqueio para valores aceitáveis</font></font></li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusão</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A otimização e o ajuste fino de chamadas para o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">banco de dados MS SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> por meio do </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é um problema que pode ser resolvido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neste trabalho, cuidado e consistência são muito importantes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No início do processo:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é necessário verificar os dados com os quais a consulta funciona (valores, tipos de dados selecionados)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexar corretamente esses dados</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">verifique a correção das condições de conexão entre as tabelas</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na próxima iteração, a otimização revela:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a base da solicitação e o filtro principal da solicitação são definidos</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repetindo blocos de consulta semelhantes e condições de interseção</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no SSMS ou outra GUI do </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL Server</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , a própria </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consulta SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é otimizada </font><font style="vertical-align: inherit;">(alocação de um repositório de dados intermediário, criando a consulta resultante usando esse repositório (pode haver vários))</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No último estágio, tendo como base a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consulta SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> resultante </font><font style="vertical-align: inherit;">, a estrutura da </font><b><font style="vertical-align: inherit;">consulta LINQ</font></b><font style="vertical-align: inherit;"> é reconstruída</font></font><b><font style="vertical-align: inherit;"></font></b></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consulta LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> resultante </font><font style="vertical-align: inherit;">deve se tornar idêntica em estrutura à </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consulta SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ideal identificada </font><font style="vertical-align: inherit;">do parágrafo 3.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agradecimentos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muito obrigado aos colegas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jobgemws</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alex_ozr</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">da </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fortis</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> por ajudar com este artigo.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt489206/index.html">Histórias de travamento com Patroni ou Como eliminar um cluster do PostgreSQL</a></li>
<li><a href="../pt489210/index.html">Teste de desempenho de código do Linux com exemplos</a></li>
<li><a href="../pt489212/index.html">1C-Bitrix impede o cancelamento da inscrição no boletim informativo pelo requisito de enviar seus dados pessoais</a></li>
<li><a href="../pt489214/index.html">Abordagem moderna para testar a localização no iOS</a></li>
<li><a href="../pt489218/index.html">É ingênuo. Super: código e arquitetura de um jogo simples</a></li>
<li><a href="../pt489228/index.html">Bot de fala no banco - o pior UX de todos os tempos</a></li>
<li><a href="../pt489230/index.html">O que é desempenho de aplicativos da web?</a></li>
<li><a href="../pt489232/index.html">De volta ao futuro dos telefones móveis II</a></li>
<li><a href="../pt489234/index.html">Como passar com êxito em qualquer teste (mau conselho)</a></li>
<li><a href="../pt489236/index.html">Primavera: procurando contexto</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>