<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>☪️ 💅🏼 👩🏿‍🎤 STM32 Bagian 1: Dasar-Dasar 🛅 👩🏿‍🎓 🙎</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Anda tidak dapat mempercayai kode yang tidak Anda tulis sendiri sepenuhnya. - Ken ThompsonMungkin kutipan favorit saya. Dialah yang menjadi alasan men...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>STM32 Bagian 1: Dasar-Dasar</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/490474/"><blockquote><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anda tidak dapat mempercayai kode yang tidak Anda tulis sendiri sepenuhnya. </font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Ken Thompson</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mungkin kutipan favorit saya. Dialah yang menjadi alasan mengapa saya memutuskan untuk menyelam ke dasar lubang kelinci. Saya memulai perjalanan saya ke dunia pemrograman baru-baru ini, hanya sekitar satu bulan berlalu dan saya memutuskan untuk menulis artikel untuk mengkonsolidasikan materi. Semuanya dimulai dengan tugas sederhana, untuk menyinkronkan lampu di studio foto Anda menggunakan Arduina. Masalahnya sudah dipecahkan, tetapi saya tidak pergi ke studio foto lagi, tidak ada waktu. Sejak saat itu, saya memutuskan untuk benar-benar terlibat dalam pemrograman mikrokontroler. Arduin, meskipun menarik dalam kesederhanaannya, saya tidak suka platformnya. Pilihan jatuh pada perusahaan ST dan produk populer mereka. Pada saat itu, saya masih tidak tahu apa bedanya, tetapi sebagai konsumen biasa saya membandingkan kecepatan "prosesor" dan jumlah memori, saya membeli sendiri papan yang mengesankan dengan tampilan STM32F746NG - Discovery.Saya akan merindukan saat-saat keputusasaan dan langsung ke titik.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tenggelam dalam citra seorang programmer, saya banyak membaca, belajar, bereksperimen. </font><font style="vertical-align: inherit;">Dan seperti yang sudah saya jelaskan di atas, saya ingin belajar dengan baik, itu saja. </font><font style="vertical-align: inherit;">Dan untuk ini saya menetapkan tujuan, bukan solusi yang sudah jadi, hanya milik saya. </font><font style="vertical-align: inherit;">Dan jika semuanya berhasil untuk saya maka Anda akan berhasil. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daftar semua yang Anda butuhkan:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ubuntu</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 16+ </font><font style="vertical-align: inherit;">mesin virtual </font><font style="vertical-align: inherit;">atau apa pun</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arm</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> compiler - unduh di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">developer.arm.com/tools-and-software/open-source-software/developer-tools/gnu-toolchain/gnu-rm/downloads</font></font></a> </li>
<li><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debugger dan programmer </font><b><font style="vertical-align: inherit;">openocd</font></b><font style="vertical-align: inherit;"> - Anda tidak akan bisa mengunduh dari tautan, kami kumpulkan dari sumbernya, instruksi terlampir</font></font><br>
<br>
<pre><code class="bash hljs">git <span class="hljs-built_in">clone</span> https://git.code.sf.net/p/openocd/code openocd</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Editor teks sesuai dengan keinginan Anda</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah semuanya diinstal dan dirakit, kita dapat melanjutkan ke proyek pertama! </font><font style="vertical-align: inherit;">Dan tidak, itu bahkan bukan bola lampu yang berkedip. </font><font style="vertical-align: inherit;">Untuk memulainya, kita harus mempelajari proses inisialisasi microwell itu sendiri. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa yang kita butuhkan:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Makefile </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Linker.ld</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Init.c</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita mulai dengan paragraf terakhir, Init.c. </font><font style="vertical-align: inherit;">Pertama-tama, mk kami harus memuat alamat "stack pointer" adalah pointer ke alamat memori yang digunakan untuk instruksi PUSH dan POP. </font><font style="vertical-align: inherit;">Saya sangat menyarankan Anda mempelajari kedua instruksi ini dengan seksama, karena saya tidak akan menjelaskan secara rinci semua instruksi. </font><font style="vertical-align: inherit;">Bagaimana cara mengimplementasikannya, lihat di bawah.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">extern</span> <span class="hljs-keyword">void</span> *_estack;
<span class="hljs-keyword">void</span> *vectors[] __attribute__((section(<span class="hljs-string">".isr_vector"</span>), used)) = {<font></font>
    &amp;_estack<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang mari kita lihat contoh ini. </font><font style="vertical-align: inherit;">Extern berarti simbol tersebut eksternal, dan kami menyatakan simbol ini dalam file Linker.ld, kami akan kembali sedikit nanti.</font></font><br>
<br>
<pre><code class="cpp hljs"> __attribute__((section(<span class="hljs-string">".isr_vector"</span>), used))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Di sini kita menggunakan atribut yang memberitahu kompiler untuk menempatkan array di bagian isr_vector dan bahkan jika kita tidak menggunakannya dalam kode, itu masih harus dimasukkan dalam program. Dan elemen pertamanya adalah pointer yang sama. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang mari kita cari tahu mengapa array ini dan apa yang akan dimakan. Tidak seperti prosesor konvensional, mik pada arsitektur arm memulai eksekusi ketika bukan dari alamat nol, tetapi dari alamat yang ditunjuk oleh pointer dalam array ini, semuanya rumit. Juga, pointer pertama dalam array ini selalu menunjuk ke awal stack, tetapi yang kedua sudah menunjuk ke awal kode kita. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya akan memberi contoh. diberikan bahwa tumpukan dimulai dengan 0x20010000 dan kode programnya adalah 0x0800008. maka array dapat ditulis sebagai</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">void</span> *vectors[] __attribute__((section(<span class="hljs-string">".isr_vector"</span>), used)) = {
    <span class="hljs-number">0x20010000</span>,
    <span class="hljs-number">0x08000008</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Artinya, controller pertama menginisialisasi stack, dan kemudian mempertimbangkan alamat instruksi pertama dan memuatnya ke register program register. Sekarang yang paling penting, tergantung pada modelnya, angka-angka ini mungkin berbeda, tetapi dengan contoh stm32f7 saya dapat dengan yakin mengatakan bahwa array ini harus ada dalam memori di alamat 0x08000000. Dari alamat ini mk akan mulai bekerja setelah dihidupkan atau diatur ulang. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang kita akan berhenti dan memperhatikan cara menempatkan array ini di bagian yang kita butuhkan. Ini dilakukan oleh "ld" atau tautan. Program ini mengumpulkan seluruh program kami bersama-sama dan skrip Linker.ld digunakan untuk ini. Saya memberi contoh dan menganalisisnya lebih lanjut.</font></font><br>
<br>
<pre><code class="plaintext hljs">MEMORY{<font></font>
	ROM_AXIM (rx) : ORIGIN = 0x08000000, LENGTH = 1M<font></font>
	RAM_DTCM (rwx): ORIGIN = 0x20000000, LENGTH = 64K<font></font>
}<font></font>
<font></font>
_estack = LENGTH(RAM_DTCM) + ORIGIN(RAM_DTCM);<font></font>
<font></font>
SECTIONS{<font></font>
	.isr_vector : {<font></font>
	KEEP(*(.isr_vector))<font></font>
	} &gt;ROM_AXIM&lt;/code&gt;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita lihat apa yang terjadi di sini. MEMORY mendefinisikan bagian memori dan BAGIAN mendefinisikan bagian. di sini kita melihat _estack kita dan fakta bahwa itu sama dengan jumlah dari awal ingatan dan panjangnya, yaitu, akhir ingatan kita. Bagian .isr_vector di mana kita meletakkan array kita juga ditentukan. </font></font><code>&gt;ROM_AXIM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pada akhir bagian kami berarti bahwa bagian ini harus ditempatkan di bagian memori yang dimulai dengan 0x08000000 seperti yang dipersyaratkan oleh mikron kami. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami meletakkan array di tempat yang diperlukan sekarang kami membutuhkan beberapa jenis instruksi agar mikron kami berfungsi. Inilah init.c yang ditambahkan:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">extern</span> <span class="hljs-keyword">void</span> *_estack;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Reset_Handler</span><span class="hljs-params">()</span></span>;<font></font>
<font></font>
<span class="hljs-keyword">void</span> *vectors[] __attribute__((section(<span class="hljs-string">".isr_vector"</span>), used)) = {<font></font>
    &amp;_estack,<font></font>
    &amp;Reset_Handler<font></font>
};<font></font>
<font></font>
<span class="hljs-keyword">void</span> __attribute__((naked, noreturn)) Reset_Handler()<font></font>
{<font></font>
    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang saya sebutkan sebelumnya, alamat kedua harus menjadi penunjuk ke fungsi atau instruksi pertama. </font><font style="vertical-align: inherit;">Dan sekali lagi, atributnya, tetapi semuanya sederhana, fungsinya tidak mengembalikan nilai apa pun dan mengikuti ABI di pintu masuk, yaitu telanjang "telanjang". </font><font style="vertical-align: inherit;">Dalam fungsi seperti itu, assembler yang biasa didorong. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang saatnya mengkompilasi kode kita, dan melihat apa yang ada di balik tudung. </font><font style="vertical-align: inherit;">Kami tidak akan menyentuh Makefile untuk saat ini.</font></font><br>
<br>
<pre><code class="bash hljs">arm-none-eabi-gcc -c init.c -o init.o -mthumb</code></pre><br>
<pre><code class="bash hljs">arm-none-eabi-gcc -TLinker.ld -o prog.elf init.o -Wl,--gc-sections -nostartfiles -nodefaultlibs -nostdlib</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan di sini kita melihat banyak hal yang tidak dapat dipahami. </font><font style="vertical-align: inherit;">dalam urutan:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kompilasi -mthumb untuk armv7, yang hanya menggunakan instruksi ibu jari </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-TLinker.ld tentukan skrip tautan. </font><font style="vertical-align: inherit;">secara default, ini dikompilasi untuk dieksekusi di lingkungan Linux</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-Wl, - gc-section -nostartfiles -nodefaultlibs -nostdlib menghapus semua pustaka standar, file inisialisasi C lingkungan, dan semua pustaka tambahan lainnya seperti matematika.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentu saja, tidak ada gunanya memuat ini ke dalam mikron. </font><font style="vertical-align: inherit;">Tetapi ada perasaan dalam melihat dan mempelajari biner.</font></font><br>
<br>
<pre><code class="bash hljs">objcopy -O ihex prog.elf prog.bin</code></pre><br>
<pre><code class="bash hljs">hexdump prog.bin</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan kemudian kita akan melihat kesimpulannya. </font><font style="vertical-align: inherit;">"00000000: 00 01 00 02 09 00 00 08" yang akan melambangkan kesuksesan kami. </font><font style="vertical-align: inherit;">Ini adalah artikel pertama saya dan saya tidak dapat sepenuhnya mengungkapkan semua bahan dan esensi, jadi di berikutnya saya akan menjelaskan mekanisme lebih detail dan kami teman-teman akan dapat pergi ke program yang tidak akan berkedip cahaya, tetapi mengkonfigurasi jam prosesor dan bus.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id490462/index.html">Monopoli layanan dan Netralitas Bersih - beri akan ada di depan</a></li>
<li><a href="../id490464/index.html">Tentang upaya yang gagal untuk memaksakan hak cipta atau 68 miliar lagu yang tidak akan mengubah apa pun</a></li>
<li><a href="../id490466/index.html">Roadmap Disiplin Matematika untuk Pembelajaran Mesin, Bagian 2 (Kemungkinan)</a></li>
<li><a href="../id490470/index.html">OWASP Moskow 2020/1</a></li>
<li><a href="../id490472/index.html">Ketika saya menulis cryptocurrency semi-desentralisasi dalam PHP. (Bagian 1 - Mengoleksi Perpustakaan)</a></li>
<li><a href="../id490476/index.html">Sensor nirkabel untuk membuka dan menutup dengan fungsionalitas canggih</a></li>
<li><a href="../id490478/index.html">DIY Stasiun Solder DIY v2</a></li>
<li><a href="../id490480/index.html">O Tiling-wm dalam 2 kata</a></li>
<li><a href="../id490484/index.html">Mengelola sensor rumah pintar dengan Google Assistant</a></li>
<li><a href="../id490490/index.html">Weekend Reading: 10 materi tentang efek suara pada kesehatan - dari "kebersihan kebisingan" hingga tidur nyenyak dan GTD</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>