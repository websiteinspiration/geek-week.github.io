<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📌 🔀 👨🏼‍✈️ 使用公钥通过SSH在网络设备上进行身份验证 👐 🤜 🤛🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="默认情况下，工程师使用用户名和密码连接到网络设备。使用Telnet，用户凭据以明文形式传输，并通过SSH加密传输。为了不通过网络传输秘密部分，使用了公共密钥身份验证。通过此身份验证，用户的公钥将在设备上预先分配给用户。私钥不通过网络传输。
 
 本指南将帮助您在使用SSH协议连接到网络设备时快速开始...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>使用公钥通过SSH在网络设备上进行身份验证</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jetinfosystems/blog/490726/"><img src="https://habrastorage.org/webt/ss/yc/-o/ssyc-oz7kbnxgw-o4rmrcit6gsg.jpeg" alt="钥匙串"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
默认情况下，工程师使用用户名和密码连接到网络设备。</font><font style="vertical-align: inherit;">使用Telnet，用户凭据以明文形式传输，并通过SSH加密传输。</font><font style="vertical-align: inherit;">为了不通过网络传输秘密部分，使用了公共密钥身份验证。</font><font style="vertical-align: inherit;">通过此身份验证，用户的公钥将在设备上预先分配给用户。</font><font style="vertical-align: inherit;">私钥不通过网络传输。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
本指南将帮助您在使用SSH协议连接到网络设备时快速开始使用公共密钥进行身份验证。</font><font style="vertical-align: inherit;">该指南适用于Windows和Mac OSX。我试图使它尽可能简单和有用。</font><font style="vertical-align: inherit;">它没有过载，但是可以回答以下基本问题：</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从哪里获取公共密钥以及如何使用它？</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">         ?</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">           ?</a></li>
</ul><br>
<a name="habracut"></a><br>
<h2></h2><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  RSA-</a><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> RSA-  SecureCRT</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> RSA-  PuTTYgen</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> RSA-   Putty Private Key (PuTTY)   OpenSSH (SecureCRT)</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> RSA-   VanDyke Private Key (SecureCRT)   Putty Private Key (PuTTY)</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">    MAC OS X   </a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">    </a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Cisco IOS XE, Catalyst (  15.1  ), IOS</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Cisco ASA</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">   Huawei</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Huawei USG (6000)</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Cisco Nexus 9.3</a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">      SSH</a><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SecureCRT</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PuTTY</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MAC OS X</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">    SSH  MAC OS X:</a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我还研究了“疼痛”主题：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenSSH &lt;==&gt; SecureCRT &lt;==&gt; PuTTY之间的密钥转换。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对不同的设备使用不同的公钥对。</font><font style="vertical-align: inherit;">一键是好的，但实际上并不适用。</font><font style="vertical-align: inherit;">不同的客户或设备需要不同的公钥对（有些需要密码，有些则不需要）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用本机（本机）MAC OS X处理公钥。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该指南还应帮助在网络设备上使用Ansible，因为Ansible默认使用带有公共密钥身份验证的OpenSSH。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
所提供的90％的材料均在真实设备上进行了测试。</font></font><br>
<br>
<a name="Introduction"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
除了SSH协议中的标准密码身份验证（密码/键盘）外，还存在公钥身份验证（RSA）。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以供参考</font></font></b><div class="spoiler_text">RSA (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://ru.wikipedia.org/wiki/RSA</a>) —     .     (public key)     (private key).        :            .         .         ,       ,        .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用RSA密钥的身份验证包括以下几个步骤： </font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建一对RSA密钥。</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在设备上安装公钥。</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用RSA密钥连接到设备并进行身份验证。</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为什么只有RSA？</font><font style="vertical-align: inherit;">为什么不提供DSA？</font><font style="vertical-align: inherit;">不幸的是，我没有找到这个问题的答案（也没有真正寻找它）。</font><font style="vertical-align: inherit;">但是正式地，思科设备仅支持RSA。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
安全外壳配置指南，Cisco IOS版本15E：</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全外壳配置指南，</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
针对安全外壳版本2支持的</font><font style="vertical-align: inherit;">Cisco IOS版本15E </font><font style="vertical-align: inherit;">限制</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rivest，Shamir和Adleman（RSA）密钥生成是SSH服务器端要求。</font><font style="vertical-align: inherit;">充当SSH客户端的设备无需生成RSA密钥。</font></font><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
尝试输入DSA密钥数据：</font></font><br>
<br>
<pre><code class="plaintext hljs">CSR-1(conf-ssh-pubkey-data)#exit<font></font>
%SSH: Only ssh-rsa type is supported<font></font>
CSR-1(conf-ssh-pubkey-user)#<font></font>
</code></pre><br>
<a name="CreatePublicKey"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建一个公共RSA密钥</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可以使用各种实用程序创建一对RSA密钥：SecureCRT，PuTTYgen或任何其他软件。</font><font style="vertical-align: inherit;">创建密钥时，可以设置密码短语（使用密钥进行密码保护）。</font></font><br>
<br>
<a name="CreatePublicKeySecureCRT"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SecureCRT中的RSA对生成</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SecureCRT-&gt;工具-&gt;创建公钥...：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/2m/xb/eb/2mxbeb3d8sc8thocdojacrzizn4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有点理论→“下一步”按钮：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/wv/ii/ze/wviize2n_5dkko4v4kpyxkkwzty.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RSA / DSA证书的类型→选择RSA→“下一步”按钮：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/rs/le/ni/rslenitclgxtobzvsz_ulj39q_c.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
密钥的加密密码（可选，您可以将其保留为空白而不加密）+注释→“下一步&gt;”按钮：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/q7/_q/5v/q7_q5vwtmmpbeszmxkizeuznul4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
选择密钥长度（在SecureCRT版本6.1.0中，最大密钥长度为2048位，在版本8.5.4-16384位中）：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/q5/qm/zg/q5qmzgg_hzzlyg_q0qvobcddkd4.png"></div><br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
生成</font><font style="vertical-align: inherit;">
密钥→“下一步”按钮：</font><font style="vertical-align: inherit;">要生成随机数，需要在窗口内移动鼠标。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/wf/w8/dh/wfw8dhn0tsfuj8nkdfprxdsjpxk.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/aw/yj/cs/awyjcsqvlbd_6tapahm4twq8kj4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
保存密钥对→选择存储位置→选择已保存密钥的格式（VanDuke专用格式，OpenSSH旧版，OpenSSH新版）→“完成”按钮： </font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/9n/ts/3s/9nts3s5p5bnfiz14nwmlo59eva4.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/kq/pw/dv/kqpwdvana4ytrh1wjrzbdtjegzu.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SecureCRT询问是否将此密钥设置为SecureCRT的默认密钥：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/zl/pa/iv/zlpaiv_a3gr6noc5hppfx-1vpoq.png"></div><br>
<a name="CreatePublicKeyPuttygen"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PuTTYgen中的RSA对生成</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可以在此处下载PuTTYgen：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：//www.chiark.greenend.org.uk/~sgtatham/putty/latest.html </font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启动PuTTYgen：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/_l/wi/fo/_lwifoh8tblsbyjqqft_7ooyofu.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
选择参数（对类型：RSA；密钥位大小：2048；可以选择设置密码（使用密码进行密码保护））→生成：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/b3/dw/d0/b3dwd0xoppidkvcjqwzont-kxj0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了保证随机数，他要求在窗口内移动鼠标。</font><font style="vertical-align: inherit;">这是针对伪随机数的保护。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ee/0a/vq/ee0avqbadgo1s4r8ir21kchtuoa.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
保存RSA密钥→“保存私钥”按钮：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/fp/l-/qa/fpl-qavfk_rncnkpey7leotfaqe.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
请注意：在一种软件中以私有格式存储的RSA密钥不能在另一家制造商的软件中使用。</font><font style="vertical-align: inherit;">也就是说，在PuTTYgen中创建并以Putty私钥格式保存的一对RSA密钥不适合在SecureCRT中使用，反之亦然。</font><font style="vertical-align: inherit;">PuTTY仅支持Putty私钥格式。</font><font style="vertical-align: inherit;">分发密钥的通用解决方案是将密钥转换为OpenSSH格式（请参阅链接2：“使用身份验证密钥从Putty转换为SecureCRT”）。</font><font style="vertical-align: inherit;">由于SecureCRT可自由使用OpenSSH格式。</font><font style="vertical-align: inherit;">PuTTYgen软件将OpenSSH格式转换为Putty Private Key格式。</font></font><br>
<br>
<a name="ConvertPPKtoOpenSSH"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将RSA密钥从Putty私钥（PuTTY）格式转换为OpenSSH（SecureCRT）格式</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要使用以PuTTYgen生成并以Putty私钥格式（* .ppk）保存的SecureCRT中的RSA密钥，我们使用PuTTYgen以OpenSSH格式导出它们：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动PuTTYgen。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们以Putty私钥格式（* .ppk）→“加载”按钮加载现有的RSA密钥。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保存公共密钥文件→“保存公共密钥”。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将密钥导出为OpenSSH格式：菜单PuTTYgen→“转换”→“导出OpenSSH密钥”。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们在SecureCRT中使用OpenSSH文件。</font><font style="vertical-align: inherit;">具有公钥的文件扩展名为.pub，具有私钥的文件没有扩展名。</font></font></li>
</ol><br>
<a name="ConvertVanDykePrivateKeyToPPK"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将RSA密钥从VanDyke私钥（SecureCRT）格式转换为Putty私钥（PuTTY）格式</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要使用由SecureCRT生成并以VanDyke私钥格式（公用密钥文件* .pub，私钥文件*。（无扩展名））保存的PuTTY中的RSA密钥，请使用OpenSSH格式的SecureCRT导出它们，然后使用PuTTYgen，我们导出为Putty私钥（* .ppk）格式：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动SecureCRT。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">菜单“工具”→“将私钥转换为OpenSSH格式...”</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用VanDyke专用密钥键选择源文件。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们用新名称保存OpenSSH密钥。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动PuTTYgen。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们以OpenSSH格式（*。）加载现有的RSA密钥：PuTTYgen菜单→“转换”→“导入密钥”。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以Putty格式保存文件：“保存私钥”。</font></font></li>
</ol><br>
<a name="CreatePublicKeyMacOSX"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用操作系统在MAC OS X上生成公钥</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们将使用内置的ssh-keygen实用程序（man ssh-keygen）。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们使用密钥名称（包含密钥存储位置的文件夹路径）生成长度为2048位的RSA密钥：</font></font><br>
<br>
<pre><code class="plaintext hljs">ssh-keygen -b 2048 -t rsa -c "Lab router R4" -f /Users/ArtemiySP/Documents/python/r4</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在运行时，程序将要求输入密码以保护RSA密钥：</font></font><br>
<br>
<pre><code class="plaintext hljs">artemiy-2:Downloads ArtemiySP$ ssh-keygen -b 2048 -t rsa -C "Lab router R4" -f /Users/ArtemiySP/Documents/python/r4<font></font>
Generating public/private rsa key pair.<font></font>
Enter passphrase (empty for no passphrase): <font></font>
Enter same passphrase again: <font></font>
Your identification has been saved in /Users/ArtemiySP/Documents/python/r4.<font></font>
Your public key has been saved in /Users/ArtemiySP/Documents/python/r4.pub.<font></font>
The key fingerprint is:<font></font>
SHA256:WdT47SFvgGI7danxX94p8/cO3uyU12SB3ipkc7nHxzA Lab router R4<font></font>
The key's randomart image is:<font></font>
+---[RSA 2048]----+<font></font>
|          .o     |<font></font>
|         .. . .  |<font></font>
|          .o + . |<font></font>
|        oo+ B = .|<font></font>
|       .S+ O OEoo|<font></font>
|        o + + B*+|<font></font>
|         . . =.*O|<font></font>
|            .+o**|<font></font>
|              =+O|<font></font>
+----[SHA256]-----+<font></font>
artemiy-2:Downloads ArtemiySP$<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们生成一个长度为4096位的RSA密钥，用于指示密钥名称，具有密钥存储位置的文件夹的路径，并在密钥生成参数（-N“ cisco”）中显式设置密码：</font></font><br>
<br>
<pre><code class="plaintext hljs">artemiy-2:Downloads ArtemiySP$ ssh-keygen -b 4096 -t rsa -C "Lab router R5" -N "cisco" -f /Users/ArtemiySP/Documents/python/r5<font></font>
Generating public/private rsa key pair.<font></font>
Your identification has been saved in /Users/ArtemiySP/Documents/python/r5.<font></font>
Your public key has been saved in /Users/ArtemiySP/Documents/python/r5.pub.<font></font>
The key fingerprint is:<font></font>
SHA256:NraLRMqB4qmA8qNjKdpBBt1JBw8Osf/3GfuB2k1R+zY Lab router R5<font></font>
The key's randomart image is:<font></font>
+---[RSA 4096]----+<font></font>
|  o.+..          |<font></font>
| . * =           |<font></font>
|. o + .       .  |<font></font>
| . o         . . |<font></font>
|. + o . S   . .  |<font></font>
|o+.. = o o . . . |<font></font>
|+oo o o o o o  Eo|<font></font>
|*=.. . o = * . ..|<font></font>
|Boo.  . o =.o    |<font></font>
+----[SHA256]-----+<font></font>
artemiy-2:Downloads ArtemiySP$<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
不建议使用的密钥生成参数：长度为1024位的不可靠密钥，指定密钥名称，具有密钥存储位置的文件夹的路径，我们在密钥生成参数中显式设置了密码（-N“”-无密码）：</font></font><br>
<br>
<pre><code class="plaintext hljs">artemiy-2:Downloads ArtemiySP$ ssh-keygen -b 1024 -t rsa -C "Lab router R6" -N "" -f /Users/ArtemiySP/Documents/python/r6<font></font>
Generating public/private rsa key pair.<font></font>
Your identification has been saved in /Users/ArtemiySP/Documents/python/r6.<font></font>
Your public key has been saved in /Users/ArtemiySP/Documents/python/r6.pub.<font></font>
The key fingerprint is:<font></font>
SHA256:LEcfgN+58TYMDv4MpBA2FGCWc2aFiY+SxWBf7pRViWs Lab router R6<font></font>
The key's randomart image is:<font></font>
+---[RSA 1024]----+<font></font>
|.++=o*.o+..      |<font></font>
|.oB % +. o       |<font></font>
| o X * .o...     |<font></font>
|o . =  E+.=.     |<font></font>
| .   oo+So.*     |<font></font>
|      .oo o =    |<font></font>
|         + . .   |<font></font>
|          o      |<font></font>
|                 |<font></font>
+----[SHA256]-----+<font></font>
artemiy-2:Downloads ArtemiySP$<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，我们创建了三个键，其中包含键的名称和键的位置（默认情况下，所有键都存储在/ Users / [Username 022 / .ssh）中。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
默认情况下，通过SSH连接并通过公用密钥进行身份验证时，所有公用密钥均按顺序存储，这些存储在/Users/[Username†/.ssh文件夹中。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
R6密钥：将密钥重命名为“ id_rsa”（默认情况下，生成的密钥文件的名称为“ id_rsa”），然后使用SSH密钥（〜/ .ssh /）将其传输到文件夹中（即，我们将执行所有步骤，以便将R6密钥用作主密钥默认SSH连接密钥）：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将公用OpenSSH密钥转换为RFC4716格式（导出到Cisco IOS）：</font></font><br>
<br>
<pre><code class="plaintext hljs">https://serverfault.com/questions/706336/how-to-get-a-pem-file-from-ssh-key-pair<font></font>
ssh-keygen -f ~/Documents/python/r4.pub -e -m RFC4716<font></font>
ssh-keygen -f ~/Documents/python/r5.pub -e -m RFC4716<font></font>
ssh-keygen -f ~/.ssh/id_rsa.pub -e -m RFC4716<font></font>
</code></pre><br>
<a name="ConfigureKeyAtHardware"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在设备上使用公钥</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如何在各种设备上将公钥绑定到用户？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将公钥绑定到用户的过程不是标准的，并且因设备而异，因此，给出了网络上最常用的每种类型的设备的示例。</font></font><br>
<br>
<a name="ConfigureKeyAtHardwareCiscoIOS"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cisco IOS XE，Catalyst（从版本15.1和更高版本开始），IOS </font></font></h3><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设备上已经有一个用户。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在用户（用户名cisco）的SSH设置（ip ssh pubkey-chain）中，指定公用密钥（key-string）：</font></font><br>
<pre><code class="plaintext hljs">CSR-1#conf t<font></font>
Enter configuration commands, one per line.  End with CNTL/Z.<font></font>
CSR-1(config)#ip ssh pubkey-chain <font></font>
CSR-1(conf-ssh-pubkey)#username ssh-putty<font></font>
CSR-1(conf-ssh-pubkey-user)#key-string <font></font>
CSR-1(conf-ssh-pubkey-data)#$QAAAQEAnPbynT1+2rjlyqP4viSPdTVDFLSHzWjJnAwy     <font></font>
CSR-1(conf-ssh-pubkey-data)#$NCfaqvMTPruCgG5096q8lO0ntURmNgmfMEQPOgb8weF     <font></font>
CSR-1(conf-ssh-pubkey-data)#$AtMQYk7WFM+5iBnOQ32UAHNavCUA7YFEpAdOQO4W/qB     <font></font>
CSR-1(conf-ssh-pubkey-data)#$SlOLy+PQ47jDUINBnuUeHd8ZXyzXxWglzSvqtwMEXBW     <font></font>
CSR-1(conf-ssh-pubkey-data)#$VoUTBYbJ45DmFa93P50qf494ujaAsTbYyJ/GBzJUTK/     <font></font>
CSR-1(conf-ssh-pubkey-data)#$UADAkNGxQARfOfHZWiIYb3rif6h6hfwwVUZS/Tw==       <font></font>
CSR-1(conf-ssh-pubkey-data)#exit<font></font>
CSR-1(conf-ssh-pubkey-user)#exit<font></font>
CSR-1(conf-ssh-pubkey)#exit<font></font>
CSR-1(config)#exit<font></font>
CSR-1#exit<font></font>
<font></font>
CSR-1#show running-config | inc ssh<font></font>
username ssh-public-key secret 5 $1$ebjc$EYgwMFQXPPiywFVn6rl7t.<font></font>
username ssh-putty privilege 15 secret 5 $1$vIhh$nM8iCeBKmLyVK4hA6./h4.<font></font>
ip ssh pubkey-chain<font></font>
   key-hash ssh-rsa D4E9AD62F7F6265EAAB3FB8778477612<font></font>
  username ssh-public-key<font></font>
   key-hash ssh-rsa C331DEE821A84681A4A7B1862C100D16<font></font>
  username ssh-putty<font></font>
   key-hash ssh-rsa F32BEB60290EA75D151447C0D42D2A99<font></font>
   key-hash ssh-rsa 5432C275B363B646E02D3BA7E8D865B7<font></font>
CSR-1#<font></font>
</code></pre></li>
</ol><br>
<a name="ConfigureKeyAtHardwareCiscoASA"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">思科ASA</font></font></h3><br>
<pre><code class="plaintext hljs">LAB-ASA5516-X-01/pri/act# conf t<font></font>
LAB-ASA5516-X-01/pri/act(config)# username artemiy password artemiy privilege $<font></font>
LAB-ASA5516-X-01/pri/act(config)# username artemiy attributes <font></font>
LAB-ASA5516-X-01/pri/act(config-username)# ssh authentication publickey ?<font></font>
<font></font>
username mode commands/options:<font></font>
  WORD  Raw SSH-RSA public key<font></font>
LAB-ASA5516-X-01/pri/act(config-username)# ssh authentication publickey AAAAB3$<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们将整个密钥插入一行（OpenSSH格式）。</font></font><br>
<br>
<a name="ConfigureKeyAtHardwareHuaweiRouter"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">华为路由器和交换机</font></font></h3><br>
<pre><code class="plaintext hljs">[R1]rsa peer-public-key test-key1 encoding-type pem <font></font>
Enter "RSA public key" view, return system view with "peer-public-key end".<font></font>
NOTE: The number of the bits of public key must be between 769 and 2048.<font></font>
[R1-rsa-public-key]public-key-code begin <font></font>
Enter "RSA key code" view, return last view with "public-key-code end".<font></font>
[R1-rsa-key-code]---- BEGIN SSH2 PUBLIC KEY ----<font></font>
[R1-rsa-key-code]Subject: Subject<font></font>
[R1-rsa-key-code]Comment: " Subject@Subject.local"<font></font>
[R1-rsa-key-code]ModBitSize: 2048<font></font>
[R1-rsa-key-code]AAAAB3NzaC1yc2EAAAADAQABAAABAQC4YLFhPqfsz4a6PUpZOtvm6zGn5TWOVMnx<font></font>
[R1-rsa-key-code]lTH5hr/u+aYnoM2XnDTu4Ul1iB8MMPLVKXzV4LgYhaFcU1rz2/yYhTKIwbiQTHof<font></font>
[R1-rsa-key-code]63fJjyWwkvyBuVZTSKh4b2pfoF2mXgdJzzRmUaiRrZZUVJWsX+CbgtKQuktG7sTK<font></font>
[R1-rsa-key-code]2eguHwdfhilbOAsUaL0/q39Y0aTAMnLMtn0m5r6MD/UopQPI3Fxm1L9azJ7zYIZa<font></font>
[R1-rsa-key-code]yI43Solg0AOupPl8FHFI9Cxq81/uZRACx5lAyuObaQ4/t1Rdh3CAJj1qwfZjZFTP<font></font>
[R1-rsa-key-code]VdJxwTDxwfkpOzMD193M0ThOSrgfWe336Q9F3jbSWrEYUQDX8ew7<font></font>
[R1-rsa-key-code]---- END SSH2 PUBLIC KEY ----<font></font>
[R1-rsa-key-code]public-key-code end<font></font>
[R1-rsa-public-key]peer-public-key end <font></font>
[R1]display rsa peer-public-key <font></font>
<font></font>
=====================================<font></font>
    Key name: test-key1<font></font>
=====================================<font></font>
Key Code:<font></font>
---- BEGIN SSH2 PUBLIC KEY ----<font></font>
AAAAB3NzaC1yc2EAAAADAQABAAABAQC4YLFhPqfsz4a6PUpZOtvm6zGn5TWOVMnx<font></font>
lTH5hr/u+aYnoM2XnDTu4Ul1iB8MMPLVKXzV4LgYhaFcU1rz2/yYhTKIwbiQTHof<font></font>
63fJjyWwkvyBuVZTSKh4b2pfoF2mXgdJzzRmUaiRrZZUVJWsX+CbgtKQuktG7sTK<font></font>
2eguHwdfhilbOAsUaL0/q39Y0aTAMnLMtn0m5r6MD/UopQPI3Fxm1L9azJ7zYIZa<font></font>
yI43Solg0AOupPl8FHFI9Cxq81/uZRACx5lAyuObaQ4/t1Rdh3CAJj1qwfZjZFTP<font></font>
VdJxwTDxwfkpOzMD193M0ThOSrgfWe336Q9F3jbSWrEYUQDX8ew7<font></font>
---- END SSH2 PUBLIC KEY ----<font></font>
aaa<font></font>
local-user jet privilege level 15<font></font>
 local-user jet service-type telnet terminal ssh http<font></font>
ssh user jet assign rsa-key test-key1<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
导入华为的密钥格式类型：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
“ SecureCRT和PuTTY生成PEM格式的RSA密钥。”</font></font><br>
<br>
<pre><code class="plaintext hljs">rsa peer-public-key test-key1 encoding-type pem</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
“ OpenSSH会以OpenSSH格式生成RSA密钥。”</font></font><br>
<br>
<pre><code class="plaintext hljs">rsa peer-public-key test-key1 encoding-type openssh</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
“ OpenSSL生成DER格式的RSA密钥。”</font></font><br>
<br>
<pre><code class="plaintext hljs">rsa peer-public-key test-key1 encoding-type der</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
默认值为十六进制：</font></font><br>
<br>
<pre><code class="plaintext hljs">rsa peer-public-key test-key1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意：华为设备不仅支持RSA格式的密钥，还支持其他格式：</font></font><br>
<br>
<pre><code class="plaintext hljs">ssh user user-name assign { rsa-key | dsa-key | ecc-key } key-name</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可以通过SSH严格设置用户的身份验证类型：</font></font><br>
<br>
<pre><code class="plaintext hljs">[R1]ssh user jet authentication-type ?<font></font>
  all           All authentication, password,RSA or ECC<font></font>
  ecc           ECC authentication<font></font>
  password      Password authentication<font></font>
  password-ecc  Both password and ECC<font></font>
  password-rsa  Both password and RSA<font></font>
  rsa           RSA authentication<font></font>
[R1]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
也就是说，我们允许使用密码或公用密钥和专用密钥（或两者）进行访问。</font></font><br>
<br>
<a name="ConfigureKeyAtHardwareHuaweiUSG"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">华为USG（6000）</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该配置与路由器上的设置完全相似，但是具有一些功能。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
缺省情况下，使用证书登录后的特权级别为0，无法提升。</font><font style="vertical-align: inherit;">因此，使用</font></font><br>
<br>
<pre><code class="plaintext hljs">user-interface vty 0 4 <font></font>
user privilege level 15<font></font>
user-interface vty 16 20:<font></font>
user privilege level 15<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例：</font></font><br>
<br>
<pre><code class="plaintext hljs">[USG-a]rsa peer-public-key test-key1 encoding-type pem <font></font>
Enter "RSA public key" view, return system view with "peer-public-key end".<font></font>
[USG-a-rsa-public-key]public-key-code begin<font></font>
Enter "RSA key code" view, return last view with "public-key-code end".<font></font>
[USG-a-rsa-key-code]---- BEGIN SSH2 PUBLIC KEY ----<font></font>
[USG-a-rsa-key-code]Subject: subject<font></font>
[USG-a-rsa-key-code]Comment: " subject@subject.local"<font></font>
[USG-a-rsa-key-code]ModBitSize: 2048<font></font>
[USG-a-rsa-key-code]AAAAB3NzaC1yc2EAAAADAQABAAABAQC4YLFhPqfsz4a6PUpZOtvm6zGn5TWOVMnx<font></font>
[USG-a-rsa-key-code]lTH5hr/u+aYnoM2XnDTu4Ul1iB8MMPLVKXzV4LgYhaFcU1rz2/yYhTKIwbiQTHof<font></font>
[USG-a-rsa-key-code]63fJjyWwkvyBuVZTSKh4b2pfoF2mXgdJzzRmUaiRrZZUVJWsX+CbgtKQuktG7sTK<font></font>
[USG-a-rsa-key-code]2eguHwdfhilbOAsUaL0/q39Y0aTAMnLMtn0m5r6MD/UopQPI3Fxm1L9azJ7zYIZa<font></font>
[USG-a-rsa-key-code]yI43Solg0AOupPl8FHFI9Cxq81/uZRACx5lAyuObaQ4/t1Rdh3CAJj1qwfZjZFTP<font></font>
[USG-a-rsa-key-code]VdJxwTDxwfkpOzMD193M0ThOSrgfWe336Q9F3jbSWrEYUQDX8ew7<font></font>
[USG-a-rsa-key-code]---- END SSH2 PUBLIC KEY ----<font></font>
[USG-a-rsa-key-code]public-key-code end<font></font>
[USG-a-rsa-public-key]peer-public-key end<font></font>
[USG-a]<font></font>
[USG-a]ssh user admin assign rsa-key test-key1<font></font>
! Out-of-band management interface:<font></font>
[USG-a-GigabitEthernet0/0/0]service-manage ssh permit<font></font>
! Grant user level 15 privillege:<font></font>
[USG-a]user-interface vty 0 4<font></font>
[USG-a-ui-vty0-4]user privilege level 15<font></font>
</code></pre><br>
<a name="ConfigureKeyAtHardwareCiscoNexus"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">思科Nexus 9.3</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
选项1：在设备上预安装公用密钥文件，并将公用密钥文件附加到用户。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将公钥文件复制到设备。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们指导用户使用公共密钥文件。</font></font></li>
</ul><br>
<pre><code class="plaintext hljs">switch# copy tftp://10.10.1.1/secsh_file.pub bootflash:secsh_file.pub<font></font>
username User1 sshkey file bootflash:secsh_file.pub<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
选项2：将公钥复制到用户：</font></font><br>
<br>
<pre><code class="plaintext hljs">username User1 sshkey<font></font>
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC4YLFhPqfsz4a6PUpZOtvm6zGn5TWOVMnxlTH5hr/u+aYnoM2XnDTu4Ul1iB8MMPLVKXzV4LgYhaFcU1rz2/yYhTKIwbiQTHof63fJjyWwkvyBuVZTSKh4b2pfoF2mXgdJzzRmUaiRrZZUVJWsX+CbgtKQuktG7sTK2eguHwdfhilbOAsUaL0/q39Y0aTAMnLMtn0m5r6MD/UopQPI3Fxm1L9azJ7zYIZayI43Solg0AOupPl8FHFI9Cxq81/uZRACx5lAyuObaQ4/t1Rdh3CAJj1qwfZjZFTPVdJxwTDxwfkpOzMD193M0ThOSrgfWe336Q9F3jbSWrEYUQDX8ew7<font></font>
</code></pre><br>
<a name="ConfigureSoftwareToUsePublicKey"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用密钥进行SSH连接</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
本节专门介绍配置SSH客户端以使用网络设备（或其他设备，只要硬件和软件支持公用密钥身份验证）上的RSA密钥进行身份验证。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们将考虑在最受欢迎的程序（SecureCRT和PuTTY）中设置公共密钥的使用。</font></font><br>
<br>
<a name="ConfigureSoftwareToUsePublicKeySecureCRT"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全CRT</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SSH设置窗口中有一个身份验证列表。</font><font style="vertical-align: inherit;">在其中，您需要将PublicKey的优先级提高到最高-将其置于列表顶部。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/l-/ke/z4/l-kez4rg6qpuyslsuv3nmt_dti4.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/xi/jh/ah/xijhahjlx-hq9m52ugqyih0qrwi.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后转到PublicKey选项并选择私钥文件。</font><font style="vertical-align: inherit;">最上面的开关允许您仅对此连接使用秘密密钥或会话设置的全局设置（另一个秘密密钥（非默认密钥））。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ub/js/xd/ubjsxdlmflzod5cfguosfwuqiqi.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/og/pv/ys/ogpvysr3cvrk7aliad5qxeg3jp0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
配置全局公钥：在菜单选项→全局选项→类别SSH2中。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/0m/yd/dg/0myddgh9flvk10qrh8pixuphke8.png"></div><br>
<a name="ConfigureSoftwareToUsePublicKeyPutty"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">油灰</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在SSH设置（连接→SSH→身份验证）的“用于身份验证的私钥文件”字段中，指定文件Putty私钥（* .ppk）：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/xm/wu/tp/xmwutpoyrfibggfiqssajegtyq0.png"></div><br>
<a name="ConfigureSoftwareToUsePublicKeyMacOSX"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MAC OS X</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置使用公共密钥的标准客户端：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用手动指定的非默认密钥进行连接：</font></font><br>
<br>
<pre><code class="plaintext hljs">artemiy-2:~ ArtemiySP$ ssh r4@10.31.73.29 -i ~/Documents/python/r4<font></font>
The authenticity of host '10.31.73.29 (10.31.73.29)' can't be established.<font></font>
RSA key fingerprint is SHA256:fxOLFKU6YGyIqisrIh2P0O52Rr6Wx/wsSAcHsTz8fo0.<font></font>
Are you sure you want to continue connecting (yes/no)? yes<font></font>
Warning: Permanently added '10.31.73.29' (RSA) to the list of known hosts.<font></font>
CSR-4#<font></font>
</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用手动指定的非默认密钥进行连接：</font></font><br>
<br>
<pre><code class="plaintext hljs">artemiy-2:~ ArtemiySP$ ssh r5@10.31.73.30 -i ~/Documents/python/r5<font></font>
The authenticity of host '10.31.73.30 (10.31.73.30)' can't be established.<font></font>
RSA key fingerprint is SHA256:4l67C4Il4pTaqYT4vrtWr0aY7rPmNWKsjRv2zlYtQIU.<font></font>
Are you sure you want to continue connecting (yes/no)? yes<font></font>
Warning: Permanently added '10.31.73.30' (RSA) to the list of known hosts.<font></font>
MGTU#exit<font></font>
Connection to 10.31.73.30 closed.<font></font>
</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误示例</font></font></b><div class="spoiler_text">        —      .     MAC OS X —     .<br>
</div></div></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用默认密钥（默认密钥-系统本身将找到并使用默认公共密钥）进行连接：</font></font><br>
<br>
<pre><code class="plaintext hljs">artemiy-2:~ ArtemiySP$ ssh r6@10.31.73.31<font></font>
The authenticity of host '10.31.73.31 (10.31.73.31)' can't be established.<font></font>
RSA key fingerprint is SHA256:2/ysACJQw48Q8S45ody4wna+6nJspcsEU558HiUN43Q.<font></font>
Are you sure you want to continue connecting (yes/no)? yes<font></font>
Warning: Permanently added '10.31.73.31' (RSA) to the list of known hosts.<font></font>
PR#exit<font></font>
Connection to 10.31.73.31 closed.<font></font>
artemiy-2:~ ArtemiySP$ <font></font>
</code></pre></li>
</ul><br>
<a name="MacOSXUseSSH"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如何简化在MAC OS X上使用SSH的工作：</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建SSH别名。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在“ SSH别名”中，我们立即设置用户。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">立即注册按键的位置。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
别名的位置和预先配置的SSH配置在〜/ .ssh / config文件（/Users/[Username†/.ssh/config）中指定。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
用这种方式填写：</font></font><br>
<br>
<pre><code class="plaintext hljs">host r4<font></font>
   Hostname 10.31.73.29<font></font>
   Port 22<font></font>
   User r4<font></font>
   IdentityFile ~/Documents/python/r4<font></font>
<font></font>
host r5<font></font>
   Hostname 10.31.73.30<font></font>
   Port 22<font></font>
   User r5<font></font>
   IdentityFile ~/Documents/python/r5<font></font>
<font></font>
host r6<font></font>
   Hostname 10.31.73.31<font></font>
   Port 22<font></font>
   User r6<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意：我的默认连接配置不正确（我不知道如何正确设置），因为与R6主机（10.31.73.31）的连接需要很长时间。</font><font style="vertical-align: inherit;">建议您指定立即指定默认密钥的路径。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用公钥和配置文件进行ssh连接的示例：</font></font><br>
<br>
<pre><code class="plaintext hljs">artemiy-2:Documents ArtemiySP$ ssh r5<font></font>
MGTU#exit<font></font>
Connection to 10.31.73.30 closed by remote host.<font></font>
Connection to 10.31.73.30 closed.<font></font>
artemiy-2:Documents ArtemiySP$ ssh r4<font></font>
CSR-4#exit<font></font>
Connection to 10.31.73.29 closed by remote host.<font></font>
Connection to 10.31.73.29 closed.<font></font>
artemiy-2:Documents ArtemiySP$ ssh r6<font></font>
PR#exit<font></font>
Connection to 10.31.73.31 closed.<font></font>
artemiy-2:Documents ArtemiySP$ ssh r6<font></font>
PR#<font></font>
</code></pre><br>
<a name="finale"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结论</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RSA密钥可用于代替密码身份验证，但并非在所有情况下都可以：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果配置了域身份验证，则不可能进行公钥身份验证（因为对服务器的LDAP请求（kerberos）已通过身份验证进行代理）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无法在旧网络设备上进行公钥身份验证（例如：在固件版本为12.2的Cisco Catalyst 2960上配置失败）。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
受密码保护的公共密钥可方便地用于台式设备。缺点：有必要向同事和合作伙伴发送一堆私钥和公钥。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在某些设备上，几对公共密钥可以对应一个用户，在其他设备上，只有一个公共密钥与一个用户对应。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
还有一对公钥和私钥存储的不同格式。但是本指南将帮助您导出不同格式的密钥。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今天，使用长度为2048位的密钥是最佳选择，但是对于某些设备，这是最大可能的密钥长度（也许这将在新固件中固定）。例如：</font></font><br>
<br>
<pre><code class="plaintext hljs">[R1]rsa peer-public-key test-key2 encoding-type pem<font></font>
Enter "RSA public key" view, return system view with "peer-public-key end".<font></font>
NOTE: The number of the bits of public key must be between 769 and 2048.<font></font>
[R1-rsa-public-key]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果使用脚本输入密码，则建议使用公共密钥替换密码（例如：SecureCRT中的自动登录）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
建议您使用公共密钥来防止通过网络传输密码。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
某些软件默认情况下使用公共密钥而不是密码进行SSH身份验证（例如：Ansible）。</font></font><br>
<br>
<a name="ListOfSources"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来源清单：</font></font></h2><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">维基百科RSA</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过auth从Putty转换为SecureCRT。</font><font style="vertical-align: inherit;">密钥，SecureCRT论坛</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全外壳配置指南，Cisco IOS版本15E</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下载PuTTYgen</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">华为</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">官方文档</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -介绍导入华为路由器的各种密钥格式</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">华为USG 6000，</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置公钥认证</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（CLI：使用STelnet登录CLI的示例（RSA认证））</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Nexus 9000 Configuration guide SSH public key</a></li>
<li>man ssh-keygen —      mac os x.</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SSH config file  MAC OS X</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">       SSH</a> </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">       SSH config</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  openssh public key   RFC4716</a></li>
</ol></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN490714/index.html">如何获得每个代码10万个。完整的初学者指南</a></li>
<li><a href="../zh-CN490716/index.html">如何确保小型企业局域网的高质量运行？</a></li>
<li><a href="../zh-CN490718/index.html">2020年的“清洁法规”是什么？</a></li>
<li><a href="../zh-CN490720/index.html">发动机！或什么是游戏物理学</a></li>
<li><a href="../zh-CN490722/index.html">IT中的性别假期。如何注意</a></li>
<li><a href="../zh-CN490728/index.html">安全周10：RSA会议和网络安全意识</a></li>
<li><a href="../zh-CN490730/index.html">英特尔x86信任根：失去信任</a></li>
<li><a href="../zh-CN490732/index.html">语音识别：非常简短的入门课程</a></li>
<li><a href="../zh-CN490734/index.html">瑞士地形图上的复活节彩蛋</a></li>
<li><a href="../zh-CN490736/index.html">9种清晰的学习和提升英语词汇的工具</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>