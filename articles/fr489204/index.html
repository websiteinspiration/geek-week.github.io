<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧚 ◻️ 👨🏾‍💻 Un aperçu de la fiabilité des services Facebook 🙆🏽 👨🏾‍🔬 👩🏿‍🍳</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lorsque Facebook «ment», les gens pensent que c'est à cause des pirates ou des attaques DDoS, mais ce n'est pas le cas. Toutes les «chutes» au cours d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Un aperçu de la fiabilité des services Facebook</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/489204/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lorsque Facebook «ment», les gens pensent que c'est à cause des pirates ou des attaques DDoS, mais ce n'est pas le cas. Toutes les «chutes» au cours des dernières années ont été causées par des changements ou des pannes internes. Afin d'enseigner aux nouveaux employés à ne pas casser Facebook avec des exemples, tous les incidents majeurs reçoivent des noms, par exemple, «Appelez les flics» ou «CAPSLOCK». Le premier a été nommé parce qu'un jour où le réseau social est tombé, les utilisateurs ont appelé la police de Los Angeles et ont demandé à le réparer, et le shérif désespéré sur Twitter a demandé de ne pas les déranger à ce sujet. Lors du deuxième incident sur les machines de cache, l'interface réseau est tombée en panne et n'a pas augmenté, et toutes les machines ont redémarré à la main. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elina Lobanova</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">travaille sur Facebook depuis 4 ans au sein de l'équipe Web Foundation. Les membres de l'équipe sont appelés ingénieurs de production et surveillent la fiabilité et les performances de l'ensemble du backend, éteignent Facebook lorsqu'il est allumé, écrivent la surveillance et l'automatisation pour leur faciliter la vie et celle des autres. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jf/9x/nj/jf9xnjbzmqg3ufk-km_bqmgkrya.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans un article basé sur le rapport d'Elina sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HighLoad ++ 2019</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , nous </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">montrerons</font></a><font style="vertical-align: inherit;"> comment les ingénieurs de production surveillent le backend Facebook, quels outils ils utilisent, qui provoquent des plantages majeurs et comment y faire face.</font></font><br>
<a name="habracut"></a><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/wuV5DLiUuaI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je m'appelle Elina, il y a presque 5 ans, j'ai été appelée sur Facebook en tant que développeur ordinaire, où j'ai rencontré pour la première fois des systèmes très chargés - ce n'est pas enseigné dans les instituts. </font><font style="vertical-align: inherit;">L'entreprise n'engage pas une équipe, mais un bureau, donc je suis arrivé à Londres, j'ai choisi une équipe qui surveille le travail de facebook.com et faisait partie des ingénieurs de production.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ingénieurs de production</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour commencer, je vais vous dire ce que nous faisons et pourquoi nous sommes appelés ingénieurs de production, et non SRE comme Google, par exemple.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2009. SRE</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le modèle standard qui est encore utilisé dans de nombreuses entreprises est "développeurs - testeurs - exploitation". </font><font style="vertical-align: inherit;">Ils sont souvent divisés: ils sont assis à différents étages, parfois même dans différents pays, et ne communiquent pas entre eux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En 2009, Facebook avait déjà SRE. </font><font style="vertical-align: inherit;">Chez Google, SRE a commencé plus tôt, ils savent comment réaliser DevOps et l'ont écrit dans leur livre « </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Site Reliability Engineering</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ». </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6h/o6/1l/6ho61luejwigg_bb6v_7441tlty.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur Facebook en 2009, il n'y avait rien de tel. </font><font style="vertical-align: inherit;">Nous nous appelions SRE, mais nous avons fait le même travail que les Ops dans le reste du monde: travail manuel, pas d'automatisation, déploiement de tous les services avec vos mains, surveillance en quelque sorte, oncall pour tout, un ensemble de scripts shell.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2010. SRO et AppOps</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout cela n'a pas évolué, car le nombre d'utilisateurs à cette époque augmentait 3 fois par an, et le nombre de services a augmenté en conséquence. </font><font style="vertical-align: inherit;">En 2010, la décision volontariste d'Ops a été divisée en deux groupes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le premier groupe est </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SRO</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , où «O» est «opérations», engagé dans le développement, l'automatisation et la surveillance du site. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le deuxième groupe est </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AppOps</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ils ont été intégrés en équipes, chacune pour de grands services. </font><font style="vertical-align: inherit;">AppOps est déjà proche de l'idée de DevOps. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La séparation pendant un certain temps a sauvé tout le monde.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2012. Ingénieurs de production</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En 2012, AppOps a simplement renommé </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les ingénieurs de production</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">En plus du nom, rien n'a changé, mais il est devenu plus confortable. </font><font style="vertical-align: inherit;">Comme vous appelez un yacht, il naviguera et nous ne voulions pas naviguer comme Ops. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les OAR existaient toujours, Facebook se développait et surveiller tous les services à la fois était difficile. </font><font style="vertical-align: inherit;">Une personne qui était sur appel n'a même pas été autorisée à aller aux toilettes: il a demandé à quelqu'un de le remplacer, car il brûlait constamment.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2014. Clôture des OAR</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À un moment donné, les autorités ont transféré tout le monde en appel. </font><font style="vertical-align: inherit;">«Tout le monde» signifie aussi les développeurs: écrivez votre code, vous y êtes et répondez pour ce code! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les ingénieurs de production ont déjà été intégrés dans les équipes les plus importantes pour obtenir de l'aide, et les autres n'ont pas de chance. </font><font style="vertical-align: inherit;">Nous avons commencé avec de grandes équipes et en quelques années, nous avons transféré tout le monde sur Facebook vers oncall. </font><font style="vertical-align: inherit;">Parmi les développeurs, il y avait une grande excitation: quelqu'un a démissionné, quelqu'un a écrit de mauvais articles. </font><font style="vertical-align: inherit;">Mais tout s'est calmé et en 2014, le SRO a été fermé car il n'était plus nécessaire. </font><font style="vertical-align: inherit;">Nous vivons donc à ce jour. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le mot «SRE» dans l'entreprise est notoire, mais nous ressemblons à SRE sur Google. </font><font style="vertical-align: inherit;">Il y a des différences.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous sommes </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toujours intégrés dans des équipes. </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous n'avons pas de recherche SRE en général, comme dans Google, c'est pour chaque service de recherche séparément.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne sommes pas dans les produits</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , seulement dans l'infrastructure que le produit gère lui-même.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous sommes en </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contact</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec les développeurs.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons un peu plus d'expérience dans les systèmes et les réseaux, nous nous </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">concentrons donc sur la surveillance</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et l'extinction des services lorsqu'ils brûlent fortement. </font><font style="vertical-align: inherit;">Nous corrigeons à l'avance les erreurs qui pourraient entraîner des plantages et influencer l'architecture des nouveaux services dès le début, afin qu'ils fonctionnent plus tard en douceur.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">surveillance</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est le plus important. </font><font style="vertical-align: inherit;">Comment faisons-nous cela? </font><font style="vertical-align: inherit;">Comme tout le monde: sans magie noire, dans leur propre maison. </font><font style="vertical-align: inherit;">Mais le diable, comme d'habitude, vous en parlera en détail.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UN HAUT</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Commençons par le bas. Tout le monde connaît TOP sous Linux, et nous utilisons ATOP, où «A» est «avancé» - un moniteur de performances système. Le principal avantage d'ATOP est qu'il stocke l'historique: vous pouvez le configurer pour enregistrer des instantanés sur le disque. Notre ATOP fonctionne sur toutes les machines toutes les 5 secondes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici un exemple de serveur exécutant le backend PHP pour facebook.com. Nous avons écrit notre machine virtuelle pour exécuter du code PHP, elle s'appelle </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HHVM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (HipHop Virtual Machine). Selon les métriques exportées, nous avons constaté que plusieurs machines ne traitaient pas presque une seule demande en une minute. Voyons pourquoi, ouvrez ATOP 30 secondes avant qu'il ne se bloque.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/p2/vt/wf/p2vtwfqsucdo-shyennmf64opy8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On peut voir qu'avec les problèmes de processeur, on le charge trop. </font><font style="vertical-align: inherit;">Il y a aussi des problèmes de mémoire, il ne reste que 1,5 Go dans le cache et après 5 secondes, seulement 800 Mo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dz/q-/_x/dzq-_x7xjizrcgynj3gdayuh8u0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après encore 5 secondes, le CPU est libéré, rien n'est exécuté. </font><font style="vertical-align: inherit;">ATOP dit regardez la ligne du bas, nous écrivons sur le disque, mais quoi? </font><font style="vertical-align: inherit;">Il s'avère que nous écrivons swap. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4z/-j/v1/4z-jv12mgthgjnezqlvbznu6ync.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Qui fait ça? </font><font style="vertical-align: inherit;">Processus extraits de la mémoire 0,5 Go et mis en swap. </font><font style="vertical-align: inherit;">À leur place, deux processus Python suspects sont apparus, qui peuvent ensuite être considérés comme une ligne de commande.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8y/ej/uk/8yejuk2y3eeswlw7astqbiaaste.jpeg"><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ATOP est magnifique, nous l'utilisons constamment.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous ne l'avez pas, je vous recommande fortement de l'utiliser. </font><font style="vertical-align: inherit;">N'ayez pas peur pour le lecteur, ATOP ne mange que 200-300 Mo par jour toutes les 5 secondes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Malloc HTTP</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aux Bahamas et aux grands incidents, nous donnons des noms. Il y a un bug amusant lié à ATOP appelé Malloc HTTP. Nous l'avons fait ses débuts avec ATOP et strace. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous utilisons Thrift partout comme RPC. Dans les premières versions de son analyseur, il y avait un bug incroyable qui fonctionnait comme ceci: un message est arrivé dans lequel les 4 premiers octets sont la taille des données, puis les données elles-mêmes et les premiers octets sont ajoutés au message suivant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais une fois que l' </font><font style="vertical-align: inherit;">un des programmes plutôt que d'aller au service de Thrift, je suis allé à HTTP, et a </font><font style="vertical-align: inherit;">reçu une réponse «HTTP Bad la demande»: </font></font><code>HTTP/1.1 400</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir pris HTTP et alloué en utilisant malloc HTTP le nombre d'octets.</font></font><br>
<br>
<pre><code class="bash hljs">Thrift message<font></font>
HTTP/1.1 400<font></font>
<span class="hljs-string">"HTTP"</span> == 0x48545450</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est bon, nous avons un sur-engagement, allouons plus de mémoire! </font><font style="vertical-align: inherit;">Nous avons alloué avec malloc, et jusqu'à ce que nous écrivions et lisions là-bas, ils ne nous donneraient pas de mémoire réelle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais ce n'était pas là! </font><font style="vertical-align: inherit;">Si nous voulons bifurquer, le fork renverra une erreur - il n'y a pas assez de mémoire.</font></font><br>
<br>
<pre><code class="bash hljs">malloc(<span class="hljs-string">"HTTP"</span>)<font></font>
pid = fork(); // errno = ENOMEM</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais pourquoi, y a-t-il un souvenir? </font><font style="vertical-align: inherit;">En comprenant les manuels, nous avons constaté que tout est très simple: la configuration actuelle de sur-engagement est telle que c'est une heuristique magique, et le noyau lui-même décide quand beaucoup et quand non:</font></font><br>
<br>
<pre><code class="bash hljs">malloc(<span class="hljs-string">"HTTP"</span>)<font></font>
pid = fork(); // errno = ENOMEM<font></font>
<font></font>
// 0: heuristic overcommit<font></font>
vm.overcommit_memory = 0</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour un processus de travail, c'est normal, vous pouvez sélectionner malloc jusqu'à TB, mais pour un nouveau processus - non. </font><font style="vertical-align: inherit;">Et une partie de la surveillance chez nous était liée au fait que le processus principal a engendré de petits scripts pour la collecte de données. </font><font style="vertical-align: inherit;">En conséquence, notre partie de surveillance est tombée en panne, car nous ne pouvions plus bifurquer.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FB303</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le FB303 est notre système de surveillance de base. </font><font style="vertical-align: inherit;">Il a été nommé d'après le synthétiseur de basse standard de 1982. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/t2/x3/f4/t2x3f4of3j794hnfskzti5lk3va.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le principe est simple, il fonctionne donc toujours: chaque service implémente l'interface Thrift getCounters.</font></font><br>
<br>
<pre><code class="php hljs">Service FacebookService {<font></font>
    map&lt;<span class="hljs-keyword">string</span>, i64&gt; getCounters()<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, il ne l'implémente pas, car les bibliothèques sont déjà écrites, tout se fait dans le code </font></font><code>increment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>set</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="php hljs">incrementCounter(<span class="hljs-keyword">string</span>&amp; key);<font></font>
<font></font>
setCounter(<span class="hljs-keyword">string</span>&amp; key, int64_t value);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par conséquent, chaque service exporte des compteurs sur le port qu'il enregistre auprès de Service Discovery. Voici un exemple d'une machine qui génère un fil d'actualités et exporte environ 5,5 mille paires (chaîne, nombre): mémoire, production, n'importe quoi. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sl/sb/fj/slsbfj9kapkaqsi3quo_do4q64a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chaque machine exécute un processus binaire qui passe par tous les services autour, recueille ces compteurs et les met en stockage. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici à quoi ressemble l' </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interface graphique de stockage</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sh/lt/li/shltlimradfvsovwo1vp1xzudmu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Très similaire à Prométhée et Grafana, mais ce n'est pas le cas. La première entrée du FB303 sur GitHub a eu lieu en 2009, et Prometheus en 2012. C'est une explication de tous les «bricoleurs» de Facebook: nous les avons fait quand il n'y avait rien de normal en Open Source. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, il y a une recherche des noms des compteurs. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vb/b3/ya/vbb3yabg-lhlypl1y7_zwf9dolw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les graphiques eux-mêmes ressemblent à ceci.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/b7/td/lj/b7tdljhxpmw6d5rt1fpguoon3ru.jpeg"><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une photo du groupe intérieur dans laquelle nous affichons de beaux graphismes. </font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une différence importante entre notre pile de surveillance et Prometheus et Grafana est que </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous stockons les données pour toujours</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Notre surveillance va rééchantillonner les données, et après 2 semaines, nous aurons un point pour toutes les 5 minutes, et après un an pour chaque heure. </font><font style="vertical-align: inherit;">Par conséquent, ils peuvent être stockés tellement. </font><font style="vertical-align: inherit;">Automatiquement, cela n'est configuré nulle part. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais si nous parlons des caractéristiques de la surveillance de Facebook, je le décrirais avec un mot anglais « </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">observabilité»</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Observabilité</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a une "boîte noire", il y a une "boîte blanche", et nous avons une "boîte" en verre transparent. </font><font style="vertical-align: inherit;">Cela signifie que lorsque nous écrivons du code, nous écrivons tout ce qui est possible dans les journaux, et non de manière sélective. </font><font style="vertical-align: inherit;">L'échantillonnage est bien réglé partout, donc le backend pour le stockage, les compteurs et tout le reste fonctionne bien. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le même temps, nous pouvons déjà construire nos tableaux de bord sur des compteurs existants. </font><font style="vertical-align: inherit;">Dans le cas de l'étude de ces tableaux de bord, ce n'est pas le point final avec 10 graphiques, mais le premier, à partir duquel nous allons à notre interface utilisateur et y trouvons tout ce qui est possible.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scaphandre autonome</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est le point culminant de l'idée d'observabilité. Ceci est notre pile ELK. Le principe est le même: nous écrivons en JSON sans schéma spécifique, puis nous demandons sous la forme d'un </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tableau</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , d'une série chronologique de données ou de 10 options de visualisation supplémentaires. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Scuba se connecte de l'ordre de centaines de gigaoctets par seconde. Tout est demandé très rapidement, car ce n'est pas Elasticsearch, et tout est en mémoire sur des machines puissantes. Oui, de l'argent y est dépensé, mais comme c'est merveilleux! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, sous Scuba UI, une des tables les plus populaires y est ouverte, dans laquelle tous les clients de tous les services Thrift écrivent des journaux. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dj/ah/ad/djahadigvrtru4luney67766slw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le graphique montre qu'en fin de compte, quelque chose s'est mal passé dans le service. Pour connaître le délai, accédez à la liste des compteurs, sélectionnez le délai, l'agrégation, cliquez sur "Plongée". </font></font><br>
<br>
<img src="https://habrastorage.org/webt/m2/c-/y8/m2c-y8pfnqyrz4hivxhxyszwvnw.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La réponse vient en 2 secondes.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j6/ac/kg/j6ackggq0o7xk93vejg0yfbyrhi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On peut voir qu'à ce moment quelque chose s'est produit et que le retard a augmenté de manière significative. </font><font style="vertical-align: inherit;">Pour en savoir plus, vous pouvez regrouper selon différents paramètres. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe des centaines de ces tableaux.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un tableau qui montre les versions des fichiers binaires, des packages, la quantité de mémoire consommée sur des millions de machines. </font><font style="vertical-align: inherit;">Sur chaque hôte, un PS est effectué une fois par heure et envoyé à Scuba.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tous les dmesg, tous les vidages de mémoire, sont envoyés à d'autres tables. </font><font style="vertical-align: inherit;">Nous exécutons Perf toutes les 10 minutes sur chaque machine, nous savons donc quelles traces de pile nous avons sur le noyau et ce que le processeur global peut charger.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Débogage PHP</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Scuba fournit également un backend pour notre outil de débogage PHP de base. Des milliers d'ingénieurs écrivent du code PHP et, d'une manière ou d'une autre, vous devez enregistrer le référentiel global des mauvaises choses. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment ça marche? PHP écrit également une trace de pile dans chaque journal. Scuba (notre Elasticsearch) ne peut tout simplement pas prendre en charge la trace de pile de tous les journaux de toutes les machines. Avant de mettre le journal dans Scuba, nous convertissons la trace de la pile en hachage, échantillonnons par hachage et n'enregistrons que ceux-ci. Les traces de pile elles-mêmes sont envoyées à Memcached. Ensuite, dans l'outil interne, vous pouvez extraire une trace de pile spécifique de Memcached assez rapidement. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ch/w_/im/chw_im8wjuue2nolmyzgcfappnq.jpeg"><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Visualisation avec regroupement de hachage à partir des journaux et des traces de pile.</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nous déboguons le code en utilisant la méthode de </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">filtrage</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : ouvrez Scuba, voyez à quoi ressemble le graphique d'erreur.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nd/op/nx/ndopnxibxeidsb8cmyy0rokasjm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On passe à LogView, là les erreurs sont déjà regroupées par traces de pile. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yx/0f/t3/yx0ft3lf_mnoskzxba7oqw3wtai.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une trace de pile est chargée à partir de Memcached, et déjà sur celle-ci, vous pouvez trouver diff (commit dans le référentiel PHP), qui a été publié à peu près au même moment, et la restaurer. </font><font style="vertical-align: inherit;">Tout le monde peut revenir en arrière et s'engager avec nous, aucune autorisation n'est nécessaire pour cela.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kh/eu/ck/kheuck1w2losbdhiyasysemlvnk.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tableaux de bord</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je terminerai le sujet de surveillance avec des tableaux de bord. Nous en avons peu - seulement deux pour trois indicateurs. Le tableau de bord lui-même est plutôt inhabituel. J'aimerais parler davantage de lui. Voici un tableau de bord standard avec un ensemble de graphiques. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kh/eu/ck/kheuck1w2losbdhiyasysemlvnk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malheureusement, ce n'est pas si simple avec lui. Le fait est que la ligne violette sur un graphique est le même service auquel la ligne bleue correspond sur l'autre graphique, et un autre graphique peut être en un jour et un autre en un mois. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous utilisons notre tableau de bord basé sur </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cubism</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - la bibliothèque Open Source JS. Il a été écrit sur Square et publié sous la licence Apache. Ils ont un support intégré pour Graphite et Cube. Mais il est facile à étendre, ce que nous avons fait.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le tableau de bord ci-dessous montre un jour à un pixel par minute. </font><font style="vertical-align: inherit;">Chaque ligne est une région: des centres de données à proximité. </font><font style="vertical-align: inherit;">Ils affichent le nombre de journaux que le backend Facebook écrit en octets par seconde. </font><font style="vertical-align: inherit;">Ci-dessous sont des annotations pour les équipes en Amérique pour voir ce que nous avons déjà corrigé de ce qui s'est passé pendant la journée. </font><font style="vertical-align: inherit;">Il est facile de rechercher une corrélation sur cette image. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fx/3u/8f/fx3u8f42urcs2ernp8cu_gvxj6q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ci-dessous, le nombre d'erreurs 500. Ce qui à gauche n'a pas d'importance pour les utilisateurs, et évidemment ils n'aimaient pas la bande vert foncé au centre. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jy/dp/g1/jydpg1dmhrcxiirkeba3dhmtxcs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vient ensuite la latence du 99e centile. </font><font style="vertical-align: inherit;">En même temps, comme dans le graphique ci-dessus, on peut voir que la latence a baissé. </font><font style="vertical-align: inherit;">Pour retourner une erreur, il n'est pas nécessaire de passer beaucoup de temps.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/og/4w/it/og4witypnhr2n091yaiwzjqctsg.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment ça fonctionne</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur un graphique de 120 pixels de haut, tout est visible. Mais beaucoup d'entre eux ne peuvent pas être placés sur un seul tableau de bord, nous allons </font></font><br>
<br>
<img src="https://habrastorage.org/webt/48/-t/-2/48-t-2gfcbcmotwnkifz2tln_9u.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
donc passer </font><font style="vertical-align: inherit;">à 30. </font><font style="vertical-align: inherit;">Malheureusement, nous obtenons alors une sorte de boa constrictor. Revenons en arrière et voyons ce que le cubisme en fait. Il casse le graphique en 4 parties: le plus haut, le plus sombre, puis s'effondre. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zg/s-/48/zgs-48iqemvyyyyxuh1g949aoji.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons maintenant le même calendrier qu'auparavant, mais tout est clairement visible: plus le vert est sombre, pire c'est. Maintenant, ce qui se passe est beaucoup plus clair. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur la gauche, vous pouvez voir la vague au fur et à mesure qu'elle montait, et au centre, où elle est vert foncé, tout est très mauvais. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ql/0f/xu/ql0fxubdkifq0ax-mwhbn00ndxi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le cubisme n'est qu'un début. Il est nécessaire pour la visualisation, afin de comprendre si tout va bien maintenant ou non. Pour chaque tableau, il existe déjà des tableaux de bord avec des graphiques détaillés.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_p/zx/u-/_pzxu-sbu9xc5p2gpoyrekvbybc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La surveillance en elle-même aide à comprendre l'état du système et à réagir en cas de panne. </font><font style="vertical-align: inherit;">Sur Facebook, chaque employé oncall doit pouvoir tout réparer. </font><font style="vertical-align: inherit;">S'il brûle, alors tout s'allume, mais surtout les ingénieurs de production avec l'expérience d'un administrateur système, car ils savent comment résoudre le problème rapidement.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quand Facebook était couché</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parfois, des incidents se produisent et Facebook ment. Habituellement, les gens pensent que Facebook ment en raison des attaques DDoS ou des pirates informatiques, mais en 5 ans, cela ne s'est jamais produit. La raison a toujours été nos ingénieurs. Ils ne sont pas intentionnels: les systèmes sont très complexes et peuvent tomber en panne là où vous n'attendez pas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous donnons des noms à tous les incidents majeurs afin qu'il soit commode de les mentionner et d'en parler aux nouveaux venus afin de ne pas répéter les erreurs à l'avenir. Le champion du nom le plus drôle est l'incident </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Call the Cops</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Les gens ont appelé la police de Los Angeles et ont demandé de réparer Facebook parce qu'il mentait. Le shérif de Los Angeles en avait tellement marre qu'il a tweeté: "S'il vous plaît, ne nous appelez pas!" Nous n'en sommes pas responsables! » </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4p/tl/nv/4ptlnvj0sppjmmmdt3zjowumd-u.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mon incident préféré auquel j'ai participé s'appelait </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CAPSLOCK.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Il est intéressant en ce qu'il montre que tout peut arriver. Et c'est ce qui est arrivé. Elle adresse obychnyyIP: </font></font><code>fd3b:5679:92eb:9ce4::1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Facebook utilise Chef pour personnaliser le système d'exploitation. L'inventaire des services stocke la configuration de l'hôte dans sa base de données et Chef reçoit un fichier de configuration du service. Une fois que le service a changé de version, il a commencé à lire les adresses IP de la base de données immédiatement au format MySQL et à les mettre dans un fichier. La nouvelle adresse est maintenant écrit dans le </font><font style="vertical-align: inherit;">capital: </font></font><code>FD3B:5679:92EB:9CE4::1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Shef regarde le nouveau fichier et constate que l'adresse IP a «changé» car elle compare, non pas sous forme binaire, mais avec une chaîne. L'adresse IP est «nouvelle», ce qui signifie que vous devez abaisser l'interface et la relever. Sur tous les millions de voitures en 15 minutes, l'interface est montée et descendue.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il semblerait que ce soit correct - la capacité a diminué alors que le réseau reposait sur certaines machines. </font><font style="vertical-align: inherit;">Mais un bug s'est soudainement ouvert dans le pilote réseau de nos cartes réseau personnalisées: au démarrage, elles nécessitaient 0,5 Go de mémoire physique séquentielle. </font><font style="vertical-align: inherit;">Sur les machines de cache, ces 0,5 Go ont disparu pendant que nous baissions et augmentions l'interface. </font><font style="vertical-align: inherit;">Par conséquent, sur les machines de cache, l'interface réseau est tombée en panne et n'a pas augmenté, et rien ne fonctionne sans caches. </font><font style="vertical-align: inherit;">Nous nous sommes assis et avons redémarré ces machines avec nos mains. </font><font style="vertical-align: inherit;">C'était amusant.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portail du gestionnaire d'incidents</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque Facebook «brûle», il est nécessaire d'organiser le travail des «pompiers» et, surtout, de comprendre où il brûle, car dans une grande entreprise, il peut «sentir l'odeur de brûlé» à un endroit, mais le problème sera à un autre. </font><font style="vertical-align: inherit;">L'outil d'interface utilisateur appelé </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Incident Manager Portal</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous y aide </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Il a été écrit par des ingénieurs de production et est ouvert à tous. </font><font style="vertical-align: inherit;">Dès qu'il se passe quelque chose, on y déclenche un incident: nom, début, description.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hj/px/sm/hjpxsmys_lbno7lkm9r9osacq7o.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons une personne spécialement formée - Incident Manager On-Call (IMOC). </font><font style="vertical-align: inherit;">Ce n'est pas un poste permanent, les managers changent régulièrement. </font><font style="vertical-align: inherit;">En cas de grands incendies, IMOC organise et coordonne les personnes à réparer, mais n'a pas à les réparer elles-mêmes. </font><font style="vertical-align: inherit;">Dès qu'un incident avec un haut niveau de danger est créé, IMOC reçoit un SMS et commence à aider à tout organiser. </font><font style="vertical-align: inherit;">Dans un grand système, ces personnes ne peuvent être dispensées.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La prévention</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Facebook n'est pas si courant. </font><font style="vertical-align: inherit;">La plupart du temps, nous n'éteignons pas et ne redémarrons pas les machines de cache, mais nous corrigeons les bogues à l'avance et, si possible, pour tout le monde à la fois. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une fois que nous avons trouvé et corrigé le «problème de file d'attente». </font><font style="vertical-align: inherit;">Le nombre de demandes augmente de 50%, et les erreurs de 100%, car personne ne limite la mise en œuvre à l'avance, surtout dans les petits services. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons trouvé un exemple de plusieurs services et défini grossièrement un modèle de comportement.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sous charge normale, la demande arrive, est traitée et renvoyée au client.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avec une charge élevée, les demandes sont en attente dans une file d'attente car tous les threads de traitement des demandes sont occupés. </font><font style="vertical-align: inherit;">Le retard augmente, mais jusqu'à présent tout va bien.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La ligne grandit, la charge augmente. </font><font style="vertical-align: inherit;">À un certain point, tout ce que le serveur exécute sur le client se termine par un délai de réponse et le client tombe avec une erreur. </font><font style="vertical-align: inherit;">À ce stade, le résultat du serveur peut simplement être jeté.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/0b/c1/b1/0bc1b11xgg49wz266m-tvoximls.jpeg"><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le délai d'expiration du client est surligné en rouge. </font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et le client répète encore! </font><font style="vertical-align: inherit;">Il s'avère que toutes les demandes que nous exécutons sont jetées à la poubelle et que personne n'en a plus besoin. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment résoudre ce problème pour tout le monde à la fois? </font><font style="vertical-align: inherit;">Introduisez une limite de délai d'attente de file d'attente. </font><font style="vertical-align: inherit;">Si la demande est dans la file d'attente plus que prévu, nous la jetons et ne la traitons pas sur le serveur, nous ne gaspillons pas le processeur dessus. </font><font style="vertical-align: inherit;">Nous obtenons un jeu honnête: nous jetons tout ce que nous ne pouvons pas traiter et tout ce que nous pouvons traiter.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La restriction a permis, tout en augmentant la charge de 50% au-dessus du maximum, de traiter encore 66% des demandes et de ne recevoir que 33% des erreurs. </font><font style="vertical-align: inherit;">Les développeurs du framework pour Dispatch l'ont implémenté côté serveur, et nous, les ingénieurs de production, avons doucement réglé le délai d'expiration de 100 ms dans la file d'attente pour tout le monde. </font><font style="vertical-align: inherit;">Ainsi, tous les services ont immédiatement obtenu une limitation de base bon marché.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outils</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'idéologie de SRE dit que si vous avez une grande flotte de voitures, un tas de services et rien à voir avec vos mains, alors vous devez automatiser. </font><font style="vertical-align: inherit;">Par conséquent, la moitié du temps, nous écrivons du code et créons des outils.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cubisme</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> intégré </font><font style="vertical-align: inherit;">dans le système.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le FBAR est un «bourreau de travail» qui vient réparer, donc personne ne s'inquiète d'une voiture cassée. </font><font style="vertical-align: inherit;">C'est la tâche principale du FBAR, mais maintenant il a encore plus de tâches.</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Coredumper</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que nous avons écrit avec deux collègues </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il surveille les coredumps sur toutes les machines et les dépose au même endroit avec les traces de pile avec toutes les informations sur l'hôte: où il se trouve, comment trouver quelle taille. </font><font style="vertical-align: inherit;">Mais surtout, les traces de pile sont gratuites, sans démarrer GDB à l'aide des programmes BPF.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les sondages</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La dernière chose que nous faisons est de parler aux gens, de les interviewer. </font><font style="vertical-align: inherit;">Il nous semble que c'est très important. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un sondage utile concerne la fiabilité. </font><font style="vertical-align: inherit;">Nous posons des questions sur les services déjà en cours d'exécution dans les citations clés de notre questionnaire:</font></font><br>
<blockquote><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"La principale responsabilité du logiciel système doit être de continuer à fonctionner. </font><font style="vertical-align: inherit;">La prestation de services doit être considérée comme un effet secondaire bénéfique d'une exploitation continue »</font></font></em></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cela signifie que le principal devoir du système est de continuer à fonctionner, et le fait qu'il fournit une sorte de service est un bonus supplémentaire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les enquêtes ne concernent que les services moyens, les grands eux-mêmes le comprennent. </font><font style="vertical-align: inherit;">Nous donnons un questionnaire dans lequel nous posons des questions de base sur l'architecture, SLO, les tests, par exemple.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Que se passe-t-il si votre système reçoit 10% de la charge?" </font><font style="vertical-align: inherit;">Quand les gens pensent: "Mais vraiment, quoi?" </font><font style="vertical-align: inherit;">- des idées apparaissent et beaucoup gouvernent même leurs systèmes. </font><font style="vertical-align: inherit;">Auparavant, ils n'y pensaient pas, mais après la question, il y a une raison.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Qui est le premier à remarquer généralement des problèmes avec votre service - vous ou vos utilisateurs?" </font><font style="vertical-align: inherit;">Les développeurs commencent à se rappeler quand cela s'est produit et: "... Vous devez peut-être ajouter des alertes."</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Quelle est votre plus grande douleur d'appel?" </font><font style="vertical-align: inherit;">Ceci est inhabituel pour les développeurs, en particulier pour les nouveaux. </font><font style="vertical-align: inherit;">Ils disent immédiatement: «Nous avons de nombreuses alertes! </font><font style="vertical-align: inherit;">Nettoyons-les et enlevons ceux qui ne sont pas le cas. »</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Quelle est la fréquence de vos sorties?" </font><font style="vertical-align: inherit;">D'abord, ils se souviennent qu'ils le libèrent avec leurs mains, puis ils ont leur propre déploiement personnalisé.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il n'y a pas de codage dans le questionnaire, il est standardisé et change tous les six mois. </font><font style="vertical-align: inherit;">Il s'agit d'un document de deux pages que nous aidons à remplir en 2-3 semaines. </font><font style="vertical-align: inherit;">Et puis nous organisons un rallye de deux heures et trouvons des solutions à de nombreuses douleurs. </font><font style="vertical-align: inherit;">Cet outil simple fonctionne bien avec nous et peut vous aider.</font></font><br>
<br>
<blockquote>6-7         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Saint HighLoad++</a>,          .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a>   (,   ,  ). <br>
   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">telegram-</a>  .   !</blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr489192/index.html">Smart Engines est entré dans le top 3 du classement FWCI parmi les organisations de base de FizTech</a></li>
<li><a href="../fr489194/index.html">Comment OpenShift modifie la structure organisationnelle d'une organisation informatique. L'évolution des modèles organisationnels lors du passage au PaaS</a></li>
<li><a href="../fr489196/index.html">Magic Smoke: microcontrôleurs vs régulateurs linéaires</a></li>
<li><a href="../fr489198/index.html">Comment ne pas se tirer une balle dans le pied avec Liquibase</a></li>
<li><a href="../fr489200/index.html">Ce que les startups recherchent Y Combinator en 2020</a></li>
<li><a href="../fr489210/index.html">Test de performance du code Linux avec des exemples</a></li>
<li><a href="../fr489212/index.html">1C-Bitrix empêche la désinscription à la newsletter par l'obligation de soumettre leurs données personnelles</a></li>
<li><a href="../fr489214/index.html">Approche moderne pour tester la localisation sur iOS</a></li>
<li><a href="../fr489218/index.html">C'est naïf. Super: code et architecture d'un jeu simple</a></li>
<li><a href="../fr489226/index.html">Méthodes d'optimisation des requêtes LINQ en C # .NET</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>