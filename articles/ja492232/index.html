<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧝🏽 ✊🏻 🖋️ SmartcallがVoximplantキットになった経緯-ブランド変更とキラー機能 🤵🏿 ⛔️ 🚌</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="長い間、私たちは発信通話のビジュアルエディターであるSmartcallsのアップデートを準備していましたが、今ではそれが起こりました。今日はカットの下で、UI / UXの変更について説明し、デモモードの内部に登って、JointJSをどのように調整したかを示します。
 
 実際に何が変わったのですか？...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>SmartcallがVoximplantキットになった経緯-ブランド変更とキラー機能</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/Voximplant/blog/492232/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/by/c2/ih/byc2ihl70ggcz-ftm-a4ziskyvo.png"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
長い間、私たちは発信通話のビジュアルエディターであるSmartcallsのアップデートを準備していましたが、今ではそれが起こりました。</font><font style="vertical-align: inherit;">今日はカットの下で、UI / UXの変更について説明し、デモモードの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内部に登って、JointJSを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">どのように</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">調整した</font></a><font style="vertical-align: inherit;">かを示します</font><font style="vertical-align: inherit;">。</font></font><a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実際に何が変わったのですか？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最も明白なものから-新しい名前とURL。これは、Voximplantキットが適切なリンク</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voximplant.com/kit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で入手できることを意味します</font><font style="vertical-align: inherit;">。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登録ページ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">も変更しました</font><font style="vertical-align: inherit;">が、次のようになりました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/cl/jh/vc/cljhvcpw84_miyo3xcr8tsamgwo.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンセプトは変わっていませんが、製品のインターフェースが大幅に変更され、よりユーザーフレンドリーになっています。</font><font style="vertical-align: inherit;">トップメニューは左側に移行され、ブロックのナビゲートがより論理的で便利になりました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/zr/9y/hf/zr9yhfrpoz4qjawojzkqgdl5kpa.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、スクリプトとオーディオ録音のグループ化と並べ替え、番号による検索、および新しいインジケーター（成功した通話の平均継続時間と合計金額）など、それらに関する簡単な情報が記載されたキャンペーンカードが利用できるようになりました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/kg/yf/12/kgyf12bkj5jjx_cffukvfnqnk7g.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
統合に関しては、ユーザーフレンドリーなインターフェースがメール設定に到達し、Dialogflow、SIP、グローバル変数タブに、IDとホストによるファイルの検索とソートが表示されました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/sr/wm/dj/srwmdjgvejupi9urypqn1iyglzk.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 一般的に、たくさんの新しくてかっこいい！</font><font style="vertical-align: inherit;">変更点について詳しく</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、ブログ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をご覧</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ください</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">しかし、最も重要なことは編集者です</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デモモード（ネタバレ：これが主なキラー機能です）。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/7m/po/du/7mpoduas-ap0m6lbi-o12g9eyd0.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
関連するブロックを強調表示したスクリプトのリアルタイム実行、および実行後-呼び出しの結果（フローとログ）。これにより、スクリプトのデバッグがさらに簡単かつ高速になります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/_i/vl/0a/_ivl0ayzlmrojpumqdf_knc99ie.png" alt="画像"></div><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
デモモードのビデオを見る</font><font style="vertical-align: inherit;">か、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voximplantキットに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登録した後で自分でテストできます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これがすべて実装される方法については、次のセクションで説明します。</font><font style="vertical-align: inherit;">エディターの新機能：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元に戻す/やり直し（下の画像の1）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ホットキー（2）;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブロックとそれらの間のリンクをワンクリックで位置合わせしたり、縮尺を変更したり、ミニマップを操作したり、スクリプトを全画面に展開したり、共有したり（pngとしてコピーまたは保存）できるポップアップメニュー（3）;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">右クリックのコンテキストメニュー;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブロックのコピー-同じスクリプト内だけでなく、異なるスクリプト間や（！）異なるアカウント間でもコピーできます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブロックのロック/ロック解除-ロックされたブロックは移動できますが、不要な変更を避けるために編集することはできません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">色の変化-視覚的に、いくつかの「関連する」ブロックを選択できます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用済みブロックの名前と内容で検索します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「インタラクティブメニュー」ブロック-ドラッグアンドドロップするだけでポート（回答オプション）を入れ替えることができます。</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/wp/fw/u4/wpfwu4ddvz--h5gd0yqm9ipcfzs.png" alt="画像"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カードを公開します</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードでブロックアニメーションがどのように実装されているかを理解する時が来ました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/zo/qo/cz/zoqoczrubc5rvxijm-cshjukoq0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エディターはHTTP APIメソッド-StartScenarios-を呼び出して、クラウドスクリプトを実行します。</font><font style="vertical-align: inherit;">Voximplantクラウドがスクリプトを開始し、media_access_urlエディターに渡します。</font><font style="vertical-align: inherit;">この瞬間から、エディターはmedia_access_urlを毎秒プルし、スクリプトが応答としてブロックを「移動」する方法に関する情報を受け取ります。このデータに基づいて、エディターは必要なブロックを強調表示し、それらの間の接続をアニメーション化します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
履歴は、次のフィールドを持つJSONオブジェクトです。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タイムスタンプ;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">idSource-初期ブロック。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">idTarget-最終ブロック。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポート-ポート（1つのブロックから複数の出力がある場合があります）。</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/wl/qt/ht/wlqthtjgn0l2bnwfoqophwregpy.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのカスタム変数とサービス変数を利用して、フロントエンドは、どのテスト中にどのブロックに渡されるかを理解します。</font><font style="vertical-align: inherit;">彼はこれをどのように理解していますか？</font><font style="vertical-align: inherit;">ビジュアルコンストラクションが発生すると（新しいブロックが追加されます）、すぐにIDが割り当てられ、履歴でidSource / idTargetとして使用されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この機能を実装するために、JointJSライブラリを使用しましたが、いくつかの自己記述コードがありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メインのselectBlock（）メソッドから始めましょう。次のように機能します。移動履歴の配列（idSource、idTarget）を調べ、開始点と終了点を見つけたらすぐに、それらの間の接続を探します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> link = <span class="hljs-keyword">this</span>.editor.getTestLink(sourceCell, portId);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それらの間に接続がある場合、通信ラインに沿って走るボールをアニメーション化します。</font></font><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">if</span> (link) <span class="hljs-keyword">this</span>.setLinkAnimation(link);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
selectBlock（）メソッドは、this.testHistoryが更新されるたびに呼び出されます。</font><font style="vertical-align: inherit;">渡されたいくつかのブロックがthis.testHistoryに一度に到着する可能性があるため、selectBlockを700ミリ秒ごとに再帰的に呼び出します（これは、ブロックからブロックへの動きをアニメーション化するのにかかるおおよその時間です）。</font></font><br>
<br>
<pre><code class="javascript hljs">setTimeout(<span class="hljs-keyword">this</span>.selectBlock, <span class="hljs-number">700</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このメソッドのすべてのコードは次のとおりです。</font><font style="vertical-align: inherit;">selectTestBlockメソッドとgetTestLinkメソッドの7行目と10行目に注目してください。次に、これらについて個別に説明します。</font></font><br>
<br>
<div class="oembed"><script type="text/javascript" src="https://gist.github.com/5ffed5b2bbb82d4a3eff6df3f153a1ed.js"></script><link rel="stylesheet" href="https://github.githubassets.com/assets/gist-embed-31007ea0d3bd9f80540adfbc55afc7bd.css"><div id="gist101791201" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-selectblock-js" class="file">
    

  <div itemprop="text" class="Box-body p-0 blob-wrapper data type-javascript ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8" data-paste-markdown-skip="">
      <tbody><tr>
        <td id="file-selectblock-js-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-selectblock-js-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-en"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">selectBlock </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><span class="pl-k"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void </font></font></span> <span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-selectblock-js-LC2" class="blob-code blob-code-inner js-file-line">     <span class="pl-k"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">もし</font></font></span> <span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font></span><span class="pl-smi"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本</font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></span><span class="pl-c1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">historyIndex </font></font></span> <span class="pl-c1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt; </font></font></span> <span class="pl-smi"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本</font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></span><span class="pl-c1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">testHistory </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></span><span class="pl-c1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">長さ</font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></span> <span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-selectblock-js-LC3" class="blob-code blob-code-inner js-file-line">       <span class="pl-k"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const </font></font></span> <span class="pl-s1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i </font></font></span> <span class="pl-c1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span> <span class="pl-smi"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></span><span class="pl-c1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">historyIndex </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-selectblock-js-LC4" class="blob-code blob-code-inner js-file-line">       <span class="pl-k">const</span> <span class="pl-s1">targetCellId</span> <span class="pl-c1">=</span> <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-c1">testHistory</span><span class="pl-kos">[</span><span class="pl-s1">i</span><span class="pl-kos">]</span><span class="pl-kos">.</span><span class="pl-c1">idTarget</span><span class="pl-kos">;</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-selectblock-js-LC5" class="blob-code blob-code-inner js-file-line">       <span class="pl-k">const</span> <span class="pl-s1">sourceCellId</span> <span class="pl-c1">=</span> <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-c1">testHistory</span><span class="pl-kos">[</span><span class="pl-s1">i</span><span class="pl-kos">]</span><span class="pl-kos">.</span><span class="pl-c1">idSource</span><span class="pl-kos">;</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-selectblock-js-LC6" class="blob-code blob-code-inner js-file-line">       <span class="pl-k">const</span> <span class="pl-s1">portId</span> <span class="pl-c1">=</span> <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-c1">testHistory</span><span class="pl-kos">[</span><span class="pl-s1">i</span><span class="pl-kos">]</span><span class="pl-kos">.</span><span class="pl-c1">port</span><span class="pl-kos">;</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-selectblock-js-LC7" class="blob-code blob-code-inner js-file-line">       <span class="pl-k">const</span> <span class="pl-s1">targetCell</span> <span class="pl-c1">=</span> <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-c1">editor</span><span class="pl-kos">.</span><span class="pl-en">selectTestBlock</span><span class="pl-kos">(</span><span class="pl-s1">targetCellId</span><span class="pl-kos">)</span><span class="pl-kos">;</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-selectblock-js-LC8" class="blob-code blob-code-inner js-file-line">       <span class="pl-k">const</span> <span class="pl-s1">sourceCell</span> <span class="pl-c1">=</span> <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-c1">editor</span><span class="pl-kos">.</span><span class="pl-en">getCell</span><span class="pl-kos">(</span><span class="pl-s1">sourceCellId</span><span class="pl-kos">)</span><span class="pl-kos">;</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-selectblock-js-LC9" class="blob-code blob-code-inner js-file-line">       <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">sourceCell</span> <span class="pl-c1">&amp;&amp;</span> <span class="pl-s1">targetCell</span><span class="pl-kos">)</span> <span class="pl-kos">{</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-selectblock-js-LC10" class="blob-code blob-code-inner js-file-line">         <span class="pl-k">const</span> <span class="pl-s1">link</span> <span class="pl-c1">=</span> <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-c1">editor</span><span class="pl-kos">.</span><span class="pl-en">getTestLink</span><span class="pl-kos">(</span><span class="pl-s1">sourceCell</span><span class="pl-kos">,</span> <span class="pl-s1">portId</span><span class="pl-kos">)</span><span class="pl-kos">;</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-selectblock-js-LC11" class="blob-code blob-code-inner js-file-line">         <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">link</span><span class="pl-kos">)</span> <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-en">setLinkAnimation</span><span class="pl-kos">(</span><span class="pl-s1">link</span><span class="pl-kos">)</span><span class="pl-kos">;</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L12" class="blob-num js-line-number" data-line-number="12"></td>
        <td id="file-selectblock-js-LC12" class="blob-code blob-code-inner js-file-line">       <span class="pl-kos">}</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L13" class="blob-num js-line-number" data-line-number="13"></td>
        <td id="file-selectblock-js-LC13" class="blob-code blob-code-inner js-file-line">       <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-c1">historyIndex</span> <span class="pl-c1">+=</span> <span class="pl-c1">1</span><span class="pl-kos">;</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L14" class="blob-num js-line-number" data-line-number="14"></td>
        <td id="file-selectblock-js-LC14" class="blob-code blob-code-inner js-file-line">       <span class="pl-en"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">setTimeout </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font></span><span class="pl-smi"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これ</font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></span><span class="pl-c1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">selectBlock </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font></span> <span class="pl-c1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">700 </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L15" class="blob-num js-line-number" data-line-number="15"></td>
        <td id="file-selectblock-js-LC15" class="blob-code blob-code-inner js-file-line">     <span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L16" class="blob-num js-line-number" data-line-number="16"></td>
        <td id="file-selectblock-js-LC16" class="blob-code blob-code-inner js-file-line">   <span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></span></td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="" style="float:right"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生で見る</font></font></a>
        <a href=""><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><a href=""><font style="vertical-align: inherit;">GitHub</font></a><font style="vertical-align: inherit;"> 
        によって</font><a href=""><font style="vertical-align: inherit;">withで</font></a><font style="vertical-align: inherit;">ホストされ</font><a href=""><font style="vertical-align: inherit;">ている</font></a><a href=""><font style="vertical-align: inherit;">selectBlock.js</font></a></font><a href=""><font style="vertical-align: inherit;"></font></a>
      </div>
    </div>
</div>
</div><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接続を描く</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
getTestLink（）メソッドは、ブロック間の接続を取得するのに役立ちます。これは、ブロック入力を取得してリンクの配列を返す組み込みのJointJSメソッドであるgetConnectedLinks（）に基づいています。</font><font style="vertical-align: inherit;">私たちの実装では、結果の配列でポートとのリンクを探しています。ここで、sourceプロパティの値はportIdです。</font></font><br>
<br>
<pre><code class="javascript hljs">link = <span class="hljs-keyword">this</span>.graph.getConnectedLinks(cell, {<span class="hljs-attr">outbound</span> : <span class="hljs-literal">true</span>}).find(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
     <span class="hljs-keyword">return</span> item.get(<span class="hljs-string">'source'</span>).port === portId;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、リンクがある場合は、それを強調表示します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">return</span> link ? (link.toFront() &amp;&amp; link) : <span class="hljs-literal">null</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メソッドコード：</font></font><br>
<br>
<pre><code class="javascript hljs">getTestLink(sourceCell: Cell, <span class="hljs-attr">portId</span>: string): Link {
  <span class="hljs-keyword">let</span> link = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">if</span> (sourceCell &amp;&amp; sourceCell.id) {
    <span class="hljs-keyword">let</span> cell = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">if</span> (sourceCell.type === <span class="hljs-string">'ScenarioStart'</span> || sourceCell.type === <span class="hljs-string">'IncomingStart'</span>) {<font></font>
      cell = <span class="hljs-keyword">this</span>.getStartCell()<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      cell = <span class="hljs-keyword">this</span>.graph.getCell(sourceCell.id);<font></font>
    }<font></font>
    link = <span class="hljs-keyword">this</span>.graph.getConnectedLinks(cell, {<span class="hljs-attr">outbound</span> : <span class="hljs-literal">true</span>}).find(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
      <span class="hljs-keyword">return</span> item.get(<span class="hljs-string">'source'</span>).port === portId;<font></font>
    });<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> link ? (link.toFront() &amp;&amp; link) : <span class="hljs-literal">null</span>;<font></font>
}<font></font>
 </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
走っているボールのアニメーションは、JointJS（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デモを参照</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">によって完全に実装されてい</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">現在のブロックに移動します</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後のブロックを選択してキャンバスをそのブロックに移動する必要がある場合は、selectTestBlock（）メソッドを呼び出します。</font><font style="vertical-align: inherit;">ここでは、ブロックの中心の座標を取得します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> center = cell.getBBox().center();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次にsetTestCell（）を呼び出してブロックに色を付けます。</font></font><br>
<br>
<pre><code class="javascript hljs">editor.tester.setTestCell(cell);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、自己記述のzoomToCell（）関数を使用してその中心にズームしました（これは最も興味深いですが、最後にそれについてです）。</font></font><br>
<br>
<pre><code class="javascript hljs">editor.paperController.zoomToCell(center, <span class="hljs-number">1</span>, <span class="hljs-literal">false</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メソッドコード：</font></font><br>
<br>
<pre><code class="javascript hljs">selectTestBlock(id: string): Cell {
 <span class="hljs-keyword">const</span> cell = (id === <span class="hljs-string">'ScenarioStart'</span>) ? editor.tester.getStartCell() : editor.graph.getCell(id);
 <span class="hljs-keyword">if</span> (cell) {
   <span class="hljs-keyword">const</span> center = cell.getBBox().center();<font></font>
   editor.tester.setTestCell(cell);<font></font>
   editor.paperController.zoomToCell(center, <span class="hljs-number">1</span>, <span class="hljs-literal">false</span>);<font></font>
 }<font></font>
 <span class="hljs-keyword">return</span> cell;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
色付けの方法：ブロックのSVG要素を見つけ、CSSクラス.is-testedを追加してブロックを色にします。</font></font><br>
<br>
<pre><code class="javascript hljs">setTestCell(cell: Cell): <span class="hljs-keyword">void</span> {
 <span class="hljs-keyword">const</span> view = cell.findView(<span class="hljs-keyword">this</span>.paper);
 <span class="hljs-keyword">if</span> (view) view.el.classList.add(<span class="hljs-string">'is-tested'</span>);<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スムーズなズーム</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、zoomToCell（）！ JointJSには、キャンバスをX軸とY軸に沿って移動するための組み込みメソッドがあります。ただし、このメソッドはSVGタグの属性として変換を使用します。Firefox+ブラウザーでのスムーズなアニメーションをサポートせず、CPUのみを使用します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
小さなハックを作成しました-関数zoomToCell（）を作成しました。これは基本的に同じことを行いますが、変換をインラインCSSとしてキャストします。これにより、GPUを使用したレンダリングが可能になります（WebGLがプロセスに接続されているため）。したがって、ブラウザ間の互換性の問題が解決されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちの関数は、XYでキャンバスを移動するだけでなく、変換行列を使用して同時にスケーリング（ズーム）することもできます。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
.animate-viewportクラスのwill-changeプロパティは、要素が変更され、GPUの使用を含む最適化を適用する必要があることをブラウザーに通知し、transitionプロパティは、キャンバスをブロックに移動する際の滑らかさを設定します。</font></font><br>
<br>
<pre><code class="css hljs"><span class="hljs-selector-class">.animate-viewport</span> {
 <span class="hljs-attribute">will-change</span>: transform;
 <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.5s</span> ease-in-out;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのメソッドコードは次のとおりです。</font></font><br>
<br>
<pre><code class="javascript hljs">public zoomToCell(center: g.Point, <span class="hljs-attr">zoom</span>: number, <span class="hljs-attr">offset</span>: boolean = <span class="hljs-literal">true</span>): <span class="hljs-keyword">void</span> {
   <span class="hljs-keyword">this</span>.updateGridSize();
   <span class="hljs-keyword">const</span> currentMatrix = <span class="hljs-keyword">this</span>.paper.layers.getAttribute(<span class="hljs-string">'transform'</span>);
   <span class="hljs-comment">//   svg-,        center</span>
   <span class="hljs-comment">//   ,     style</span>
   <span class="hljs-keyword">const</span> { a, b, c, d, e, f } = <span class="hljs-keyword">this</span>.zoomMatrix(zoom, center, offset);
   <span class="hljs-comment">//  FireFox    ,       </span>
   <span class="hljs-keyword">this</span>.paper.layers.style.transform = currentMatrix;
   <span class="hljs-comment">//    FF  ,     ,    </span>
   setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
     <span class="hljs-comment">//  CSS- .animate-viewport,    - transition;</span>
     <span class="hljs-comment">//    style      - transition</span>
     <span class="hljs-keyword">this</span>.paper.layers.classList.add(<span class="hljs-string">'animate-viewport'</span>);
     <span class="hljs-keyword">this</span>.paper.layers.style.transform = <span class="hljs-string">`matrix(<span class="hljs-subst">${ a }</span>, <span class="hljs-subst">${ b }</span>, <span class="hljs-subst">${ c }</span>, <span class="hljs-subst">${ d }</span>, <span class="hljs-subst">${ e }</span>, <span class="hljs-subst">${ f }</span>)`</span>;
     <span class="hljs-keyword">const</span> duration = <span class="hljs-built_in">parseFloat</span>(getComputedStyle(<span class="hljs-keyword">this</span>.paper.layers)[<span class="hljs-string">'transitionDuration'</span>]) * <span class="hljs-number">1000</span>;
     <span class="hljs-comment">//        style;</span>
     <span class="hljs-comment">//      joint</span>
     setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
       <span class="hljs-keyword">this</span>.paper.layers.classList.remove(<span class="hljs-string">'animate-viewport'</span>);
       <span class="hljs-keyword">this</span>.paper.layers.style.transform = <span class="hljs-literal">null</span>;
       <span class="hljs-keyword">this</span>.paper.matrix(newMatrix);
       <span class="hljs-keyword">this</span>.paper.trigger(<span class="hljs-string">'paper:zoom'</span>);
       <span class="hljs-keyword">this</span>.updateGridSize();
       <span class="hljs-keyword">this</span>.paper.trigger(<span class="hljs-string">'paper:update'</span>);<font></font>
     }, duration);<font></font>
   }, <span class="hljs-number">100</span>);<font></font>
 }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結局のところ、最も高度なものでもファイルで仕上げる必要がある場合があります:)クジラの内部を掘り下げて楽しんだことを願っています（どんなに不気味に聞こえても）。</font><font style="vertical-align: inherit;">Voximplantキットなどで開発が成功することを願っています！</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja492218/index.html">覚えておくべきアイコンのデザインルール</a></li>
<li><a href="../ja492220/index.html">5あまり知られていないパンダの秘密</a></li>
<li><a href="../ja492222/index.html">2019年のCTFZone Qualsのまとめ：鶏肉</a></li>
<li><a href="../ja492226/index.html">マネージドKubernetesの価格比較（2020）</a></li>
<li><a href="../ja492228/index.html">Sports.ruがWYSIWYGエディターを書いたとき</a></li>
<li><a href="../ja492234/index.html">研究：人々が社会的プロジェクトで受け取る収入を減らす準備ができている理由</a></li>
<li><a href="../ja492242/index.html">M5Stackとその連絡先</a></li>
<li><a href="../ja492244/index.html">コロナウイルスの期間の除去：家庭の「逮捕」または機会の時間？</a></li>
<li><a href="../ja492246/index.html">コロナウイルス：社会、経済、医学への影響の可能性</a></li>
<li><a href="../ja492248/index.html">React Hooksによるデバウンス</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>