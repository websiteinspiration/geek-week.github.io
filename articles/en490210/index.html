<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶ä üé™ üßü Speeding up the frontend. When a lot of server requests are good üö¨ üï¥üèΩ üëßüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article describes some methods to speed up loading front-end applications to implement a responsive, fast user interface. 
 
 We will discuss the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Speeding up the frontend. When a lot of server requests are good</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/490210/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This article describes some methods to speed up loading front-end applications to implement a responsive, fast user interface. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will discuss the general architecture of the frontend, how to preload the necessary resources and increase the likelihood that they are in the cache. </font><font style="vertical-align: inherit;">We will discuss a little how to give resources from the backend and when it is possible to limit ourselves to static pages instead of an interactive client application. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The download process is divided into three stages. </font><font style="vertical-align: inherit;">For each stage, we formulate general strategies for increasing productivity:</font></font><br>
<br>
<ol>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Initial rendering</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : how long does it take for the user to see at least something</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reduce rendering blocking requests</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avoid sequential chains</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reuse server connections</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Service Workers for Instant Rendering</font></font></li>
</ul></li>
<li><b> </b>:   ,     <br>
<ul>
<li>    .    .    <br>
</li>
<li>,        <br>
</li>
<li>       <br>
</li>
<li>     <br>
</li>
<li>    </li>
</ul></li>
<li><b> </b>:        <br>
<ul>
<li>    ,   <br>
</li>
<li>      </li>
</ul></li>
</ol><a name="habracut"></a><br>
<h1> </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Until the initial rendering, the user does not see anything on the screen. What do we need for this rendering? At a minimum, upload an HTML document, and in most cases additional resources, such as CSS and JavaScript files. Once they are available, the browser can begin some kind of rendering. </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">WebPageTest</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
charts are provided throughout this article </font><font style="vertical-align: inherit;">. The query sequence for your site will probably look something like this. </font><font style="vertical-align: inherit;">
The HTML document loads a bunch of additional files, and the page is rendered after they are downloaded. Please note that CSS files are loaded in parallel to each other, so each additional request does not add significant delay. </font><font style="vertical-align: inherit;">
(Note: in the screenshot, gov.uk is an example where </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">HTTP / 2 is</font></a><font style="vertical-align: inherit;"> now </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">enabled</font></a></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/36a/970/f6e/36a970f6e3069679776958e6e0ef10d8.png"><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">so that the resource domain can reuse an existing connection. </font><font style="vertical-align: inherit;">See below for server connections.)</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reduce rendering blocking requests</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Style sheets and (by default) scripts block the rendering of any content below them. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are several options to fix this:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Move script tags to the bottom of the body </font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Download scripts in asynchronous mode using </font></font><code>async</code><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If JS or CSS should be loaded sequentially, it is better to embed them with small snippets</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avoid conversations with sequential requests that block rendering</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The delay in rendering the site is not necessarily associated with a large number of requests that block rendering. </font><font style="vertical-align: inherit;">More important is the size of each resource, as well as the start time of its download. </font><font style="vertical-align: inherit;">That is, the moment when the browser suddenly realizes that this resource needs to be downloaded. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the browser detects the need to download the file only after completing another request, then there is a chain of requests. </font><font style="vertical-align: inherit;">It can form for various reasons:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"></font><code>@import</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSS </font><font style="vertical-align: inherit;">Rules</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Web fonts referenced by the CSS file</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Downloadable JavaScript or script tags</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Take a look at this example: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/ebe/a1b/e44/ebea1be44487e800d63034b7fb2e9b79.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
One of the CSS files on this site loads the Google font through the rule </font></font><code>@import</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">This means that the browser has to take turns executing the following requests:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTML document</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSS applications</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSS for Google Fonts</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google Font Woff File (not shown in diagram)</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To fix this, first move the Google Fonts CSS request from the tag </font></font><code>@import</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to the link in the HTML document. </font><font style="vertical-align: inherit;">So we shorten the chain by one link. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To speed things up even further, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">embed Google Fonts CSS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> directly into your HTML or CSS file. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(Keep in mind that the CSS response from the Google Fonts server depends on the user agent line. If you make a request using IE8, the CSS will refer to the EOT file, IE11 will receive the woff file, and modern browsers will receive the woff2 file. If you agree that old browsers will be limited to system fonts, you can simply copy and paste the contents of the CSS file to yourself).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Even after the start of rendering, the user is unlikely to be able to interact with the page, because the font needs to be loaded to display the text. </font><font style="vertical-align: inherit;">This is an additional network delay that I would like to avoid. </font><font style="vertical-align: inherit;">The </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">swap parameter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is useful here </font><font style="vertical-align: inherit;">, it allows you to use it </font></font><code>font-display</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with Google Fonts, and store fonts locally. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sometimes the query chain cannot be resolved. </font><font style="vertical-align: inherit;">In such cases, you might </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">want to</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> consider </font><b><font style="vertical-align: inherit;">the preload or preconnect tag</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">For example, the website in the example above may connect to </font></font><code>fonts.googleapis.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">before the actual CSS request arrives.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reusing server connections to speed up requests</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To establish a new connection to the server, usually requires three packet exchanges between the browser and the server:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNS lookup</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Establish a TCP Connection</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Establish an SSL Connection</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After the connection is established, at least one more packet exchange is required to send a request and receive a response. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The chart below shows that we initiate a connection with four different servers: </font></font><code>hostgator.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>optimizely.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>googletagmanager.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and </font></font><code>googelapis.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">subsequent server requests may reuse an existing connection</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">The download </font></font><code>base.css</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">either </font></font><code>index1.css</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">happens faster because they are located on the same server </font></font><code>hostgator.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with which a connection has already been established.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/78d/f76/03c/78df7603c84c54788fbec82a7d0622c7.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reduce file size and use CDN</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You control two factors that affect the query execution time: the size of the resource files and the location of the servers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Send as little data to the user as possible and make sure they are compressed (for example, using brotli or gzip). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Content Delivery Networks (CDNs) have servers all over the world. </font><font style="vertical-align: inherit;">Instead of connecting to a central server, a user can connect to a CDN server that is closer. </font><font style="vertical-align: inherit;">Thus, packet exchange will be much faster. </font><font style="vertical-align: inherit;">This is especially suitable for static resources such as CSS, JavaScript, and images, as they are easy to distribute via CDN.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eliminate network latency with service workers</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Service Workers allow you to intercept requests before sending them to the network. </font><font style="vertical-align: inherit;">This means that the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">answer comes almost instantly</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/c0c/5b2/7bd/c0c5b27bd4df5e42b3b8e57b2dfb02f2.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Of course, this only works if you really do not need to receive data from the network. </font><font style="vertical-align: inherit;">The answer should already be cached, so the benefit will appear only from the second application download. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The service worker below caches the HTML and CSS needed to render the page. </font><font style="vertical-align: inherit;">When the application loads again, it tries to issue cached resources itself - and accesses the network only if they are unavailable.</font></font><br>
<br>
<pre><code class="javascript hljs">self.addEventListener(<span class="hljs-string">"install"</span>, <span class="hljs-keyword">async</span> e =&gt; {<font></font>
 caches.open(<span class="hljs-string">"v1"</span>).then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">cache</span>) </span>{
   <span class="hljs-keyword">return</span> cache.addAll([<span class="hljs-string">"/app"</span>, <span class="hljs-string">"/app.css"</span>]);<font></font>
 });<font></font>
});<font></font>
<font></font>
self.addEventListener(<span class="hljs-string">"fetch"</span>, event =&gt; {<font></font>
 event.respondWith(<font></font>
   caches.match(event.request).then(<span class="hljs-function"><span class="hljs-params">cachedResponse</span> =&gt;</span> {
     <span class="hljs-keyword">return</span> cachedResponse || fetch(event.request);<font></font>
   })<font></font>
 );<font></font>
});</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this guide,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> explained in detail on the use of service workers` to preload and cache resources.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Download application</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, the user sees something on the screen. </font><font style="vertical-align: inherit;">What further steps are necessary for him to use the application?</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Download application code (JS and CSS)</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Download the required data for the page</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Download additional data and images</font></font></li>
</ol><br>
<img src="https://habrastorage.org/getpro/habr/post_images/175/e7f/810/175e7f810d7e33f9647203ad609b402f.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Please note that not only downloading data from the network may delay rendering. </font><font style="vertical-align: inherit;">Once your code is loaded, the browser should analyze, compile and execute it.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Download only the necessary code and maximize the number of hits in the cache</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚ÄúBreak a package‚Äù means downloading only the code needed for the current page, not the entire application. </font><font style="vertical-align: inherit;">It also means that parts of the package can be cached, even if other parts have changed and need to be reloaded. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a rule, the code is divided into the following parts:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code for a specific page (page-specific)</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Common application code</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Third-party modules that rarely change (great for caching!)</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Webpack can automatically do this optimization, break the code, and reduce the overall load weight. </font><font style="vertical-align: inherit;">The code is broken into pieces using the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">optimization.splitChunks</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> object </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Separate the runtime (runtime) into a separate file: this way you can benefit from long-term caching. </font><font style="vertical-align: inherit;">Ivan Akulov wrote a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">detailed guide on breaking a package into separate files and caching in Webpack</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is not possible to automatically allocate code for a specific page. </font><font style="vertical-align: inherit;">You must manually identify those parts that can be downloaded separately. </font><font style="vertical-align: inherit;">Often this is a specific path or set of pages. </font><font style="vertical-align: inherit;">Use </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dynamic imports</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to lazily load this code.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dividing the overall package into parts will increase the number of requests to download your application. But this is not a big problem if requests are executed in parallel, especially if the site is loaded using the HTTP / 2 protocol. You can see this for the first three queries in the following diagram: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/995/816/714/9958167144c54dc634d1b7daa03077e3.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, two consecutive queries are also visible in the diagram. These fragments are needed only for this particular page and they are loaded dynamically through </font></font><code>import()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can try to fix the problem by inserting a tag preload </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preload</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/955/2cf/efc/9552cfefcbb751b50e378a0834320b73.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But we see that the total page load time has increased. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Resource preloading is sometimes counterproductive as it delays the loading of more important files. Read</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Andy Davis's article on preloading fonts</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and how this procedure blocks the start of page rendering.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Loading data for a page</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Your application should probably show some data. </font><font style="vertical-align: inherit;">Here are some tips you can use to download this data early without unnecessary rendering delays.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Do not wait for the full download of the package before you start downloading the data</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here is a special case of a chain of sequential requests: you download the entire application package, and then this code requests the necessary data for the page. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are two ways to avoid this:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Embed data in an HTML document</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Run a data request using the built-in script inside the document</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Embedding the data in HTML ensures that the application does not wait for it to load. It also reduces the complexity of the system, since you do not need to handle the boot status. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, this is not a good idea if such a technique delays the initial rendering. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this case, as well as if you are submitting a cached HTML document through a service worker, you can use the built-in script to download this data as an alternative. You can make it available as a global object, here's a promise:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-built_in">window</span>.userDataPromise = fetch(<span class="hljs-string">"/me"</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the data is ready, and in such a situation, the application can immediately start rendering or wait until it is ready. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When using both methods, you need to know in advance what data the page will load before the application starts rendering. </font><font style="vertical-align: inherit;">This is usually obvious for user-related data (username, notifications, etc.), but more difficult with content that is specific to a particular page. </font><font style="vertical-align: inherit;">Perhaps it makes sense to highlight the most important pages and write your own logic for them.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Do not block rendering while waiting for irrelevant data</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sometimes, to generate data, you need to run slow complex logic on the backend. </font><font style="vertical-align: inherit;">In such cases, you can try to download a simpler version of the data first, if this is enough to make the application functional and interactive. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For example, an analytics tool may first download a list of all charts before loading data. </font><font style="vertical-align: inherit;">This allows the user to immediately search for the diagram of interest to him, and also helps to distribute backend requests to different servers.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/996/ab6/613/996ab66136976b0b22d95e7778fb4664.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avoid Consecutive Data Queries</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This may contradict the previous paragraph that it is better to put out non-essential data in a separate request. </font><font style="vertical-align: inherit;">Therefore, it should be clarified: avoid chains with sequential data requests, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if each completed request does not lead to the fact that the user is shown more information</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instead of first querying which user is logged in and then requesting a list of his groups, immediately return the list of groups along with the user information in the first query. </font><font style="vertical-align: inherit;">You can use </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GraphQL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for this </font><font style="vertical-align: inherit;">, but the endpoint </font></font><code>user?includeTeams=true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">also works fine.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Server side rendering</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Server-side rendering means pre-rendering the application, so a full-page HTML is returned on client request. The client sees the page completely rendered, without waiting for additional code or data to load! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since the server sends the client just static HTML, the application is not interactive at this point. You need to download the application itself, start the rendering logic, then connect the necessary event listeners to the DOM. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Use server-side rendering if viewing non-interactive content is valuable in and of itself. It‚Äôs also nice to cache rendered HTML on the server and immediately return it to all users without delay. For example, server-side rendering is great when using React to display blog posts. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AT</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This article by Mikhail Yanashek</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> describes how to combine service workers and server-side rendering.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Next page</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At some point, the user is about to press a button and go to the next page. </font><font style="vertical-align: inherit;">From the moment you open the start page, you control what happens in the browser, so you can prepare for the next interaction.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resource preloading</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you preload the code needed for the next page, the delay disappears when the user starts navigation. </font><font style="vertical-align: inherit;">Use </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prefetch tags</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or </font></font><code>webpackPrefetch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for dynamic import:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span>(
    <span class="hljs-comment">/* webpackPrefetch: true, webpackChunkName: "todo-list" */</span> <span class="hljs-string">"./TodoList"</span>
)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consider what kind of load you place on the user in terms of traffic and bandwidth, especially if he is connected via a mobile connection. </font><font style="vertical-align: inherit;">If a person downloaded the mobile version of the site and the data storage mode is active, then it is reasonable to preload less aggressively. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Strategically consider which parts of the application the user will need before.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reuse of already downloaded data</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cache data locally in your application and use it to avoid future requests. </font><font style="vertical-align: inherit;">If the user goes from the list of his groups to the ‚ÄúEdit group‚Äù page, you can make the transition instantly, reusing previously downloaded data about the group. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Please note that this will not work if the object is often edited by other users and the downloaded data may become outdated. </font><font style="vertical-align: inherit;">In these cases, there is an option to first show existing read-only data while simultaneously executing a request for updated data.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This article lists a number of factors that can slow down your page at different stages of the loading process. Tools like </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chrome DevTools</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebPageTest</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lighthouse</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> will help you figure out which of these factors affect your application. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In practice, rarely is optimization immediately going in all directions. We need to find out what has the greatest impact on users, and focus on it.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
While I was writing the article, I realized one important thing: I had an entrenched belief that many individual server requests were bad for performance. </font><font style="vertical-align: inherit;">This was the case in the past, when each request required a separate connection, and browsers allowed only a few connections per domain. </font><font style="vertical-align: inherit;">But with HTTP / 2 and modern browsers this is no longer the case. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are good arguments in favor of splitting the application into parts (with multiplying queries). </font><font style="vertical-align: inherit;">This allows you to download only the necessary resources and it is better to use the cache, since only the changed files will have to be reloaded.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en490196/index.html">[Flipper Zero] refuse Raspberry Pi, make our own board from scratch. Finding the right WiFi chip</a></li>
<li><a href="../en490198/index.html">Trust but verify! Demo zone with Epson projectors for home theater in the demo hall Pult.ru</a></li>
<li><a href="../en490202/index.html">Query Counting: Basic Django Performance Testing</a></li>
<li><a href="../en490204/index.html">The digest of events for HR and IT recruiters in March 2020</a></li>
<li><a href="../en490208/index.html">Backend section on DUMP2020: banter, fan, fail</a></li>
<li><a href="../en490222/index.html">Death Day Standard Library</a></li>
<li><a href="../en490224/index.html">Fashionable stealth</a></li>
<li><a href="../en490226/index.html">Blending and Unity Terrain: how to get rid of intersections and stop making your eyes hurt</a></li>
<li><a href="../en490232/index.html">Load Balancing with AWS ELB</a></li>
<li><a href="../en490242/index.html">GSM Location service of SIM800x modules and its work with Yandex.Locator API</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>