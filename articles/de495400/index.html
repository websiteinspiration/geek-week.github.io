<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∫ ‚¨ÜÔ∏è üë¨ Arbeiten Sie mit der SD-Karte √ºber die SPI-Schnittstelle. VHDL-Implementierung üçü üë®‚Äçüî¨ üí±</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr! Bei der Arbeit hatte ich die Aufgabe, die M√∂glichkeit der Implementierung der Datenspeicherung auf einer SD-Karte beim Anschluss an ein FP...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Arbeiten Sie mit der SD-Karte √ºber die SPI-Schnittstelle. VHDL-Implementierung</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495400/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hallo Habr! </font><font style="vertical-align: inherit;">Bei der Arbeit hatte ich die Aufgabe, die M√∂glichkeit der Implementierung der Datenspeicherung auf einer SD-Karte beim Anschluss an ein FPGA zu pr√ºfen. </font><font style="vertical-align: inherit;">Die Verwendung von SPI wurde als Interaktionsschnittstelle angenommen, da es einfacher zu implementieren ist. </font><font style="vertical-align: inherit;">Ich m√∂chte die gesammelten Erfahrungen teilen.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ga/qw/p6/gaqwp6tekmw-myhnjrsmwo5cam8.png"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da der Platz auf der Leiterplatte immer begrenzt ist, werden SD-Karten am Beispiel von Karten im microSD-Formfaktor ber√ºcksichtigt.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inhalt</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Lesen der Spezifikation </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1 Allgemeine Informationen </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.2 Initialisierung </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.3 L√∂schen von Informationen </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.4 Lesen von Informationen </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.4.1 Lesen eines Datenblocks </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.4.2 Lesen vieler Datenbl√∂cke </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.5 Schreiben von Informationen </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.5.1 Schreiben eines Datenblocks </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.5.2 Schreiben vieler Datenbl√∂cke </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Implementieren des Algorithmus in Hardware </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1 Komponente der physischen Schicht </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2 Komponente der Befehlsebene </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.3 Komponente der Kommunikation mit der Au√üenwelt </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. √úberpr√ºfung in Hardware </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Ergebnisse</font></font></a><br>
<br>
<a name="SpecRead"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Lesen der Spezifikationen</font></font></h2><br>
<a name="GeneralInformation"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1 Allgemeines</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein kurzes Lesen der Spezifikation zeigt uns die folgenden SD-Kartenoptionen:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Daten√ºbertragung auf die SD-Karte erfolgt in einer Zeile. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Lesen von Daten von einer SD-Karte erfolgt in einer Zeile. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">im SPI-Modus kann die Leistung nur +3,3 V betragen; </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Taktfrequenz im Initialisierungsmodus im Bereich von 100-400 kHz;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Taktfrequenz nach der Initialisierung - 25 MHz.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies impliziert sofort den Punkt auf der theoretischen Spitzenbandbreite: 25 MHz * 1 Bit = 25 Mb / s, was </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">etwas</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> klein ist. </font><font style="vertical-align: inherit;">Die zweite abz√ºglich der Verwendung von SD-Karten, Strom + 3,3V. </font><font style="vertical-align: inherit;">Auf der Leiterplatte, auf der die SD-Karte installiert werden sollte, liegt keine solche Spannung an. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MicroSD-Formfaktorkarten k√∂nnen nach Kapazit√§t in drei Kategorien unterteilt werden:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDSC </font><font style="vertical-align: inherit;">Kartenkapazit√§t bis zu 2 GB inklusive. </font><font style="vertical-align: inherit;">Die Adresse auf der Karte ist Byte.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDHC. </font><font style="vertical-align: inherit;">Die Kartenkapazit√§t betr√§gt mehr als 2 GB und bis zu 32 GB inklusive. </font><font style="vertical-align: inherit;">Die Adresse auf der Karte gibt einen 512-Byte-Block an.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDXC. </font><font style="vertical-align: inherit;">Die Kartenkapazit√§t betr√§gt mehr als 32 GB und bis zu 128 TB inklusive. </font><font style="vertical-align: inherit;">Die Adresse auf der Karte gibt einen 512-Byte-Block an.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die allgemeine Ansicht der Karte ist in der folgenden Abbildung dargestellt. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wp/qo/4d/wpqo4dulzwlonas-3evcspttvra.png"><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kontakt Nummer</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Name</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eine Art</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beschreibung</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RSV</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- -</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wird nicht benutzt</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CS</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eingang</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chipauswahl</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DI</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eingang</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datenleitung vom Master-Ger√§t (MOSI)</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vdd</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ern√§hrung</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Versorgungsspannung</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SCLK</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eingang</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Taktsignal</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vss</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ern√§hrung</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Land</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TUN</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ausgabe</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datenleitung zum Master-Ger√§t (MISO)</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RSV</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- -</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wird nicht benutzt</font></font></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Anschluss erfolgt gem√§√ü folgendem Diagramm: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ey/jl/xj/eyjlxjhgg_iucbvd0ms-gzmjinu.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Widerstand muss 50 kOhm betragen.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nach dem Einschalten befindet sich die SD-Karte im SDIO-Modus. </font><font style="vertical-align: inherit;">Um in den SPI-Modus zu wechseln, m√ºssen Sie die Initialisierung durchf√ºhren. </font><font style="vertical-align: inherit;">Das Protokoll f√ºr die Arbeit mit der Karte beinhaltet die Verwendung eines Steuerschemas f√ºr die korrekte √úbertragung von Daten und Befehlen in Form eines CRC-Algorithmus. </font><font style="vertical-align: inherit;">Im SPI-Modus ist die CRC-√úberpr√ºfung standardm√§√üig deaktiviert. </font><font style="vertical-align: inherit;">Daher muss der erste an die Karte gesendete Befehl zum Umschalten der Karte in den SPI-Modus den richtigen CRC-Wert enthalten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√úber die SPI-Schnittstelle √ºbertragene Befehle sind 48 Bit gro√ü. </font><font style="vertical-align: inherit;">Befehlsformat:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bit 47 (ganz links) enth√§lt immer den Wert 0. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bit 46 enth√§lt immer den Wert 1.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Die Bits 45..40 enthalten den Befehlsindex.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Bits 39..8 enthalten die Argumente des Befehls. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Bits 7..1 enthalten CRC aus vorherigen Bits. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bit 0 enth√§lt immer den Wert 1.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Bits 47 und 46 geben der Karte die M√∂glichkeit, den Beginn einer Transaktion eindeutig zu verfolgen, da der MOSI-Bus in Ruhe einer ist. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dd/ap/8n/ddap8nsdyqcbqezjudom42bzfx8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Befehle, die beim Arbeiten mit der SD-Karte verwendet werden, erhalten Antworten wie R1, R3, R7. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bt/xq/ce/btxqcevcwggh9qgt6pxznanb0pc.png"><br>
<sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eine Antwort vom Typ R1, Gr√∂√üe 8 Bit. </font></font></sub><font style="vertical-align: inherit;"><sub><font style="vertical-align: inherit;">Antworttyp R3, Gr√∂√üe 40 Bit. </font></sub><sub><font style="vertical-align: inherit;">Antworttyp R7, Gr√∂√üe 40 Bit. </font></sub><font style="vertical-align: inherit;">
Alle Befehle und ihre Antworten sind in der </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">vereinfachten Spezifikation</font></a><font style="vertical-align: inherit;"> der </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">physischen Schicht aufgef√ºhrt.</font></a></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><img src="https://habrastorage.org/webt/mu/dg/yb/mudgybpndrbrqpsz5icwgkb1prk.png"></a><br>
<sub><font style="vertical-align: inherit;"></font></sub><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><img src="https://habrastorage.org/webt/s-/vq/a8/s-vqa83la-g6k3bwgvvmmfoawms.png"></a><br>
<sub><font style="vertical-align: inherit;"></font></sub><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><br>
<br>
<a name="Init"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.2 Initialisierung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Initialisierungsalgorithmus:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warten Sie nach dem Einschalten mindestens 1 ms.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Generieren Sie mindestens 74 Taktschaltungen f√ºr die Karte. </font><font style="vertical-align: inherit;">CS- und MOSI-Leitungen m√ºssen sich im Status der logischen Einheit befinden.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Generieren Sie den Befehl CMD0. </font><font style="vertical-align: inherit;">Der Befehl CMD0 setzt die SD-Karte zur√ºck.</font></font></li>
<li>    CMD0.     R1.  ,   R1    16   ,    3.   R1   ,     0x01 (     ),    3,     5. </li>
<li>  CMD8.            . </li>
<li>    CMD8.     R7.  ,     ,    ,    7, ,           ,    17,    13. </li>
<li>  CMD55.  CMD55  ,     . </li>
<li>    CMD55.     R1.     0x01 (    ),    7,    9. </li>
<li>  ACMD41.  ACMD41  ,    SDSC ( 0x00000000)    . </li>
<li>    ACMD41.     R1.      ,    ,    11. ,    0x00 ( )    14,       7.</li>
<li>  CMD1.  CMD1   ACMD41.</li>
<li>    CMD1.     R1.       ,    ,    13, ,    0x00 ( ),    14,       11.</li>
<li> .   ,   .      . </li>
<li>  CMD16.          ,  512 . </li>
<li>    CMD16.     R1.  ,    0x00 (  )    16,    13. </li>
<li>   .       .   . </li>
<li>  CMD55.  CMD55  ,     . </li>
<li>    CMD55.     R1.     0x01 (    ),    17,    19. </li>
<li>  ACMD41.   ACMD41.  ACMD41  ,    SDHC ( 0x40000000)    .</li>
<li>    ACMD41.     R1.      ,    ,    13. ,    0x00 ( )    21,       17. </li>
<li>  CMD58.    . </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warten auf eine Antwort auf den Befehl CMD58. </font><font style="vertical-align: inherit;">Die Antwort ist eine Antwort vom Typ R3. </font><font style="vertical-align: inherit;">Wenn in der Antwort, dass die Karte mit Blockadressen von 512 Bytes arbeitet, ein Bit gesetzt ist, fahren Sie mit Schritt 16 fort, andernfalls mit Schritt 14.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach Abschluss der Initialisierung kann die Karte in Bl√∂cken von 512 Bytes mit einer Taktfrequenz von 25 MHz betrieben werden. </font><font style="vertical-align: inherit;">Dies ist die Vollversion des Initialisierungsalgorithmus, der alle Arten von Karten abdeckt. </font><font style="vertical-align: inherit;">In meinem Fall bestand der Initialisierungsalgorithmus bei Verwendung einer 16-GB-Karte aus den Schritten 1-6, 17-22, 16.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafischer Algorithmus</font></font></b>
                        <div class="spoiler_text"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><img src="https://habrastorage.org/webt/vp/di/pw/vpdipwdy4umv4iahsea1g2snruu.png"></a></div>
                    </div><br>
<a name="Erase"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.3 Informationen l√∂schen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Micro SD-Formfaktorkarten unterst√ºtzen L√∂schbefehle. </font><font style="vertical-align: inherit;">Nach dem L√∂schbefehl wird der Wert der angegebenen L√∂schadressen je nach Karte mit dem Wert 0xFF oder 0x00 gef√ºllt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algorithmus zum L√∂schen von Informationen</font></font><br>
<br>
<ol>
<li>  CMD32.        .</li>
<li>    CMD32.     R1.       0x00 ( -    ),    3,    4.</li>
<li> .   ,     . </li>
<li>  CMD33.        .        ,        CMD32. </li>
<li>    CMD33.     R1.       0x00 ( -    ),    3,    6 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMD38-Befehl senden. </font><font style="vertical-align: inherit;">Der Befehl zum L√∂schen von Informationen aus den ausgew√§hlten Bl√∂cken. </font><font style="vertical-align: inherit;">Alle 4 Bytes sollten als Argument gesendet werden, mit Ausnahme der Werte 0x00000001, 0x00000002.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warten auf eine Antwort auf den CMD38-Befehl. </font><font style="vertical-align: inherit;">Die Antwort ist eine Antwort vom Typ R1b. </font><font style="vertical-align: inherit;">Dies ist eine erweiterte Version der Antwort, wenn die Karte eine R1-Antwort generiert und dann die MISO-Linie auf Null zieht, was anzeigt, dass der Chip besch√§ftigt ist. </font><font style="vertical-align: inherit;">Es muss gewartet werden, bis der Einheitswert in der MISO-Zeile angezeigt wird. </font><font style="vertical-align: inherit;">Wenn die Antwort nicht 0x00 lautet (beim Ausf√ºhren des Befehls ist ein Fehler aufgetreten), fahren Sie mit Schritt 3 fort, andernfalls mit Schritt 8</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vervollst√§ndigung des L√∂schalgorithmus. </font></font></li>
</ol><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafischer Algorithmus</font></font></b>
                        <div class="spoiler_text"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><img src="https://habrastorage.org/webt/hm/qs/cq/hmqscqj62emd9yp30prqqasyjjm.png"></a></div>
                    </div><br>
<a name="Read"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.4 Informationen lesen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Lesen von Informationen von einer SD-Karte √ºber SPI ist auf zwei Arten m√∂glich.</font></font><br>
<br>
<a name="ReadOne"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.4.1 Einen einzelnen Datenblock lesen</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beim Lesen eines Datenblocks generiert das Master-Ger√§t einen Befehl f√ºr die SD-Karte zum Lesen eines Datenblocks, wartet auf eine Antwort, dass der Befehl verarbeitet wurde, und wartet auf ein Paket mit Daten von der Karte. </font><font style="vertical-align: inherit;">Nach dem Empfang eines Pakets mit Daten von der Karte endet die Lesetransaktion. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/g_/oe/q_/g_oeq_mpttrajxmeltmmb5hpl28.png"><br>
<sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gesamtansicht einer Transaktion, die einen Datenblock liest. </font></font></sub><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Urspr√ºnglich wurde eine solche Option implementiert, aber die resultierende Geschwindigkeit war sehr ver√§rgert (Geschwindigkeitsvergleiche werden niedriger sein).</font></font><br>
<br>
<a name="ReadMore"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.4.2 Mehrere Datenbl√∂cke lesen</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beim Lesen mehrerer Datenbl√∂cke generiert das Master-Ger√§t einen Befehl f√ºr die SD-Karte zum Lesen mehrerer Datenbl√∂cke, wartet auf eine Antwort, dass der Befehl verarbeitet wurde, und erwartet ein Datenpaket von der Karte. </font><font style="vertical-align: inherit;">Nach dem Senden eines Datenpakets sendet die Karte das n√§chste Datenpaket. </font><font style="vertical-align: inherit;">Dies wird fortgesetzt, bis ein Befehl vom Master-Ger√§t empfangen wird, um das Lesen abzuschlie√üen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ai/ed/tz/aiedtzc1nfh__byzfhuozjnstjc.png"><br>
<sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gesamtansicht einer Transaktion, die viele Datenbl√∂cke liest. </font></font></sub><br>
<br>
<img src="https://habrastorage.org/webt/i8/ko/9l/i8ko9lasfzqwjehte6q6yg8bs1w.png"><br>
<sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datenpaketstruktur</font></font></sub><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Wo:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daten-Token </font><font style="vertical-align: inherit;">Der Lesebefehl verwendet den Wert 0xFE.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datenblock. </font><font style="vertical-align: inherit;">Enth√§lt von der Karte gelesene Daten.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CRC </font><font style="vertical-align: inherit;">Enth√§lt die Pr√ºfsumme aus den vorherigen Feldern.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn beim Lesen ein Fehler aufgetreten ist, gibt die Karte anstelle des Daten-Tokens ein Fehler-Token zur√ºck. </font><font style="vertical-align: inherit;">Die Fehler-Token-Gr√∂√üe betr√§gt 1 Byte. </font><font style="vertical-align: inherit;">Die Bits 7..5 enthalten den Wert Null, die Bits 4..0 codieren den Fehlertyp. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algorithmus zum Lesen mehrerer Datenbl√∂cke:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMD18-Befehl senden. </font><font style="vertical-align: inherit;">Der Befehl teilt der Karte mit, dass mehrere Bl√∂cke gelesen werden.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warten auf eine Antwort auf den CMD18-Befehl. </font><font style="vertical-align: inherit;">Die Antwort ist eine Antwort vom Typ R1. </font><font style="vertical-align: inherit;">Wenn die Antwort nicht 0x00 lautet (beim Ausf√ºhren des Befehls ist ein Fehler aufgetreten), fahren Sie mit Schritt 3 fort, andernfalls mit Schritt 4.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fehlerstatus. </font><font style="vertical-align: inherit;">Lesen fehlgeschlagen, Beenden des Lesealgorithmus.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warten auf einen Token von der Karte. </font><font style="vertical-align: inherit;">Wenn ein Fehler-Token von der Karte empfangen wird, fahren Sie mit Schritt 3 fort, andernfalls fahren Sie mit Schritt 5 fort.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Empfangen von einer Datenblockkarte mit einer Gr√∂√üe von 512 Bytes. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Empfangen Sie von der Karte eine CRC-Feldgr√∂√üe von 2 Bytes. </font></font></li>
<li>    .     ,    8,    4. </li>
<li>  CMD12.       .  ,       Data Packet,   . </li>
<li>     CMD12.     R1b.     R1,         MISO  ,   .      MISO  ,      .       0x00 ( -    ),    3,    10.</li>
<li>  . </li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Lesealgorithmus weist eine leichte Nuance auf. </font><font style="vertical-align: inherit;">Das Chipauswahlsignal (CS) muss vor dem Erzeugen des CMD18-Befehls auf logisch Null und nach dem Empfang einer Antwort auf den CMD12-Befehl auf logisch Eins gesetzt werden.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafischer Algorithmus</font></font></b>
                        <div class="spoiler_text"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><img src="https://habrastorage.org/webt/ht/8f/uf/ht8fufwcf9qq-bdrif-4chjd5cg.png"></a></div>
                    </div><br>
<a name="Write"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.5 Informationen aufzeichnen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Schreiben von Informationen auf die SD-Karte √ºber die SPI-Schnittstelle ist in zwei Versionen m√∂glich.</font></font><br>
<br>
<a name="WriteOne"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.5.1 Einen einzelnen Datenblock schreiben</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beim Aufzeichnen eines Datenblocks generiert das Master-Ger√§t einen Befehl f√ºr die SD-Karte zum Schreiben eines Datenblocks, wartet auf eine Antwort von der Karte, dass der Befehl verarbeitet wurde, sendet ein Paket mit Daten zum Aufzeichnen auf die Karte, erwartet eine Antwort von der Karte, dass die Daten geschrieben werden, schlie√üt die Transaktion ab. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/u1/j5/7f/u1j57f-xmwqesdk1yzw_fenwvmi.png"><br>
<sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gesamtansicht einer Schreibtransaktion eines Datenblocks. </font></font></sub><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie beim Lesen wurde urspr√ºnglich ein Datensatz eines Datenblocks implementiert. </font><font style="vertical-align: inherit;">Die Geschwindigkeitsergebnisse waren unbefriedigend.</font></font><br>
<br>
<a name="WriteMore"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.5.2 Mehrere Datenbl√∂cke schreiben</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beim Aufzeichnen mehrerer Datenbl√∂cke generiert das Master-Ger√§t einen Befehl zum Aufzeichnen mehrerer Datenbl√∂cke, wartet auf eine Antwort von der Karte, dass der Befehl verarbeitet wurde, sendet ein Paket mit Daten zur Aufzeichnung auf die Karte und erwartet eine Antwort von der Karte, dass die Daten aufgezeichnet werden. </font><font style="vertical-align: inherit;">Nach dem Empfang einer Master-Antwort sendet das Ger√§t ein Paket mit den folgenden Daten zur Aufzeichnung auf die Karte. </font><font style="vertical-align: inherit;">Dies wird fortgesetzt, bis das Master-Ger√§t ein Stop Data Token sendet. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-p/l7/fz/-pl7fz2rfyuv5akb7ksrcwdipsy.png"><br>
<sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Allgemeine Ansicht einer Schreibtransaktion f√ºr mehrere Datenbl√∂cke. </font></font></sub><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Struktur des Datenpakets √§hnelt der Struktur des Datenpakets beim Lesen von Daten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Format:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daten-Token </font><font style="vertical-align: inherit;">F√ºr den Schreibbefehl wird der Wert 0xFC verwendet.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datenblock. </font><font style="vertical-align: inherit;">Enth√§lt auf die Karte geschriebene Daten.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CRC </font><font style="vertical-align: inherit;">Enth√§lt die Pr√ºfsumme aus den vorherigen Feldern.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das zum Ausf√ºhren des Schreibbefehls verwendete Stop-Tran-Token ist 1 Byte gro√ü und entspricht 0xFD. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem das letzte Bit des Datenpakets in die Karte verschoben wurde, antwortet die Karte auf die n√§chste Uhr mit dem Status des Datensatzes - Datenantwort. </font><font style="vertical-align: inherit;">Die Datenantwort hat eine Gr√∂√üe von 1 Byte, die Bits 7..5 k√∂nnen beliebig sein, Bit 4 ist immer Null, Bit 0 ist immer gleich Eins, Bits 3..1 codieren den Status des Datensatzes. </font><font style="vertical-align: inherit;">Nachdem die Karte das Datenpaket zur√ºckgegeben hat, zieht die Karte die MISO-Linie auf Null, um anzuzeigen, dass die Karte belegt ist. </font><font style="vertical-align: inherit;">Nachdem sich die Ebene der logischen Einheit auf der MISO-Leitung befindet, k√∂nnen Sie das n√§chste Datenpaket auf die Karte √ºbertragen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Algorithmus zum Aufzeichnen mehrerer Datenbl√∂cke:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMD25-Befehl senden. </font><font style="vertical-align: inherit;">Der Befehl teilt der Karte mit, dass mehrere Bl√∂cke geschrieben werden.</font></font></li>
<li>    CMD25.     R1.       0x00 ( -    ),    3,    4.</li>
<li> .   ,   . </li>
<li>   . </li>
<li>   512   . </li>
<li>    CRC  2 . </li>
<li> Data Response  .       ,    3,    8. </li>
<li>   .     ,    9,    4. </li>
<li> Stop Tran Token.   ,     . </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warten auf eine Antwort von der Karte. </font><font style="vertical-align: inherit;">Die Karte auf Stop Tran Token zieht die MISO-Linie auf Null, was anzeigt, dass die Karte besetzt ist. </font><font style="vertical-align: inherit;">Es ist notwendig, in der MISO-Zeile auf den Einheitswert zu warten, der das Ende des Befehls anzeigt</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Abschluss des Aufzeichnungsalgorithmus. </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt auch eine kleine Nuance im Aufzeichnungsalgorithmus. </font><font style="vertical-align: inherit;">Das Chipauswahlsignal (CS) muss vor dem Generieren des CMD25-Befehls auf logisch Null und nach dem Empfang einer Antwort auf Stop Tran Token auf logisch Eins gesetzt werden</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafischer Algorithmus</font></font></b>
                        <div class="spoiler_text"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><img src="https://habrastorage.org/webt/_9/kt/ts/_9kttsrffln_gmvgw-l4ch0ekva.png"></a></div>
                    </div><br>
<a name="Hardware"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Implementierung des Algorithmus in Hardware</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durch das Lesen der Spezifikation erhalten wir einige Eigenschaften des Algorithmus, die in der Hardware implementiert werden m√ºssen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
M√∂gliche Betriebsarten:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anf√§ngliche Frequenzbildung. </font><font style="vertical-align: inherit;">CS- und MOSI-Leitungen m√ºssen sich im Status der logischen Einheit befinden.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daten auf eine SD-Karte √ºbertragen. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Empfangen Sie Daten von einer SD-Karte. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warten auf die Fertigstellung des Teams. </font><font style="vertical-align: inherit;">Es wird verwendet, wenn die SD-Karte nach dem Generieren einer Antwort die MISO-Linie auf Null zieht, um auf das Erscheinen einer Einheit zu warten.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antwort beim Schreiben von Daten lesen. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warten auf ein Token beim Lesen von Daten. </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
M√∂gliche Uhrmodi:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Taktsignal zum Initialisieren. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Taktsignal f√ºr die Arbeit. </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aus meiner Sicht wird der Algorithmus mit drei Komponenten optimal implementiert:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Komponente der physikalischen Schicht, die direkt mit der SD-Karte verbunden ist, erzeugt SCLK-, CS-, DI-Signale und liest mit DO. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eine Komponente auf Befehlsebene, die alle Daten f√ºr eine Komponente in der physischen Schicht vorbereitet. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eine Komponente der Kommunikation mit der Au√üenwelt, die das gesamte interne Ger√§t verbirgt und eine Schnittstelle f√ºr Befehle (Lesen, Schreiben, L√∂schen) und Daten bietet.</font></font></li>
</ul><br>
<a name="HwPhy"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1 Komponente der physikalischen Schicht</font></font></h3><br>
<pre><code class="vhdl hljs"><span class="hljs-keyword">entity</span> SDPhy <span class="hljs-keyword">is</span>
	<span class="hljs-keyword">generic</span>	(	gTCQ		: <span class="hljs-built_in">time</span> := <span class="hljs-number">2</span> ns );
	<span class="hljs-keyword">port</span>	(	<span class="hljs-comment">-- Control bus</span>
			iPhyTxData	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic_vector</span>( <span class="hljs-number">9</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>);<font></font>
			iPhyMode	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic_vector</span>( <span class="hljs-number">4</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>);<font></font>
			iPhyTxWrite	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oPhyTxReady	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>; 
			<span class="hljs-comment">-- Out Data</span>
			oPhyRxData	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic_vector</span>( <span class="hljs-number">7</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>); <font></font>
			oPhyRxWrite	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oPhyCmdEnd	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;
			<span class="hljs-comment">-- Spi</span>
			oSdCS		: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdClk		: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdMosi		: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdMosiT	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			iSdMiso		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;
			<span class="hljs-comment">-- system</span>
			sclk		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			pclk		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			rst		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span> ); 
<span class="hljs-keyword">end</span> SDPhy;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wo:</font></font><br>
<br>
<ul>
<li> iPhyTxData    ,  iPhyMode  ,    . </li>
<li>iPhyTxWrite ,    iPhyTxData  iPhyMode . </li>
<li>oPhyTxReady ,      .     FULL FIFO,    .</li>
<li>oPhyRxData   ,   SD-.</li>
<li>oPhyRxWrite ,     oPhyRxData . </li>
<li>oPhyCmdEnd ,     .</li>
<li>oSdCS    (CS)  SD-. </li>
<li>oSdClk    SD-.</li>
<li>oSdMosi     SD-.</li>
<li>oSdMosiT        SD-.</li>
<li>iSdMiso     SD-. </li>
<li>sclk      SD- (50 ).</li>
<li>pclk  ,     .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstes R√ºcksetzsignal, aktive Stufe eins.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In FPGAs gibt es spezielle Einheiten f√ºr die Arbeit mit einem Taktsignal (PLL, MMCM). Das Empfangen eines Taktsignals von weniger als 5 MHz von ihrem Ausgang ist jedoch problematisch. </font><font style="vertical-align: inherit;">Infolgedessen arbeitet die physikalische Schicht mit einer Frequenz von 50 MHz. </font><font style="vertical-align: inherit;">Zusammen mit allen Daten im iPhyMode-Signal wird ein Bit empfangen, das angibt, mit welcher Frequenz diese Daten auf die SD-Karte √ºbertragen (oder von dieser empfangen) werden sollen. </font><font style="vertical-align: inherit;">Abh√§ngig vom Geschwindigkeitsbit werden Taktfreigabesignale erzeugt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der Komponente der physischen Schicht sind zwei Automaten implementiert, um Daten auf eine SD-Karte zu √ºbertragen und Daten von dieser zu empfangen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maschinencode f√ºr die Daten√ºbertragung: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der SDummy-Zustand bietet eine anf√§ngliche Frequenzformung und 128 Umschaltung. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der STxBits-Status erm√∂glicht die Daten√ºbertragung auf die SD-Karte. </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Code der Maschine zum Empfangen von Daten: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Status sRxBits erm√∂glicht den Datenempfang von der SD-Karte. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Status sBusy stellt sicher, dass die SD-Karte bereit ist (die Karte gibt die MISO-Leitung auf Einheitenebene frei). </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der sResp-Status implementiert das Lesen der Antwort beim Schreiben von Daten. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der sToken-Status implementiert eine Token-Wartezeit beim Lesen von Daten. </font></font></li>
</ul><br>
<a name="HwCmd"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2 Komponente auf Befehlsebene</font></font></h3><br>
<pre><code class="vhdl hljs"><span class="hljs-keyword">entity</span> SdCommand <span class="hljs-keyword">is</span>
	<span class="hljs-keyword">generic</span>	(	gTCQ		: <span class="hljs-built_in">time</span> := <span class="hljs-number">2</span> ns );
	<span class="hljs-keyword">port</span>	(	<span class="hljs-comment">-- Command from host</span>
			oSdInitComp	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdInitFail	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			iSdAddress	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic_vector</span>(<span class="hljs-number">31</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>);<font></font>
			iSdStartErase	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			iSdStartRead	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			iSdStartWrite	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdCmdFinish	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic_vector</span>( <span class="hljs-number">1</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>);<font></font>
			oSdhcPresent	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;
			<span class="hljs-comment">-- Data</span>
			oSdReadData	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			iSdDataR	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic_vector</span>(<span class="hljs-number">31</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>);<font></font>
			oSdWriteData	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdDataW	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic_vector</span>(<span class="hljs-number">32</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>);
			<span class="hljs-comment">-- Spi</span>
			oSdCS		: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdClk		: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdMosi		: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdMosiT	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			iSdMiso		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;
			<span class="hljs-comment">-- system</span>
			pclk		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			sclk		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			rst		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span> );
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wo:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oSdInitComp signiert Abschluss der Initialisierung der SD-Karte. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oSdInitFail Zeichen eines Initialisierungsfehlers. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iSdAddress-Adresse auf der SD-Karte, um den Befehl auszuf√ºhren. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iSdStartErase Start L√∂schbefehlsausf√ºhrung. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iSdStartRead beginnt mit dem Lesen der Befehlsausf√ºhrung. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iSdStartWrite startet die Ausf√ºhrung des Schreibbefehls. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abschlussstatus des oSdCmdFinish-Teams. </font><font style="vertical-align: inherit;">Das Nullbit ist gleich Eins, der Befehl wurde erfolgreich ausgef√ºhrt. </font><font style="vertical-align: inherit;">Das erste Bit ist eins, der Befehl wurde mit einem Fehler abgeschlossen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oSdhcPresent SDHC / SDXC-Kartenerkennungsflag. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oSdReadData Liest Daten, um auf die SD-Karte zu schreiben. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iSdDataR-Daten zum Schreiben auf die SD-Karte. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oSdWriteData-Flag zum Schreiben von Daten, die von der SD-Karte gelesen wurden. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oSdDataW-Daten, die von einer SD-Karte gelesen wurden.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die verbleibenden Signale stimmen mit den Signalen der physikalischen Schicht √ºberein. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Komponente verf√ºgt √ºber 5 Automaten.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">smSdInit ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) - Initialisierung der SD-Karte.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">smSdErase ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) - l√∂scht Daten von einer SD-Karte.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">smSdRead ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) - liest Daten von einer SD-Karte.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">smSdWrite ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) - Daten auf eine SD-Karte schreiben.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">smSdCommand ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) - bereitet auf der Grundlage der generierten Features Daten f√ºr die physische Schicht aller vorherigen Maschinen auf.</font></font></li>
</ul><br>
<a name="HwHost"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.3 Bestandteil der Kommunikation mit der Au√üenwelt</font></font></h3><br>
<pre><code class="vhdl hljs"><span class="hljs-keyword">entity</span> SdHost <span class="hljs-keyword">is</span>
	<span class="hljs-keyword">generic</span>	(	gTCQ		: <span class="hljs-built_in">time</span> := <span class="hljs-number">2</span> ns );
	<span class="hljs-keyword">port</span>	(	<span class="hljs-comment">-- Sd Host command</span>
			iSdCommand	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic_vector</span>( <span class="hljs-number">2</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>);<font></font>
			iSdAddress	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic_vector</span>(<span class="hljs-number">31</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>);<font></font>
			iSdStart	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdStatus	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic_vector</span>( <span class="hljs-number">1</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>);<font></font>
			oSdInitFail	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;
			<span class="hljs-comment">-- Write data to card</span>
			iSdTxData	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic_vector</span>(<span class="hljs-number">31</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>);<font></font>
			iSdTxValid	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			iSdTxLast	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdTxReady	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;
			<span class="hljs-comment">-- Read data from card</span>
			oSdRxData	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic_vector</span>(<span class="hljs-number">31</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>);<font></font>
			oSdRxValid	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdRxLast	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			iSdRxReady	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;
			<span class="hljs-comment">-- Spi</span>
			oSdCS		: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdClk		: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdMosi		: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdMosiT	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			iSdMiso		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;
			<span class="hljs-comment">-- system</span>
			pclk		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			sclk		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			rst		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span> );
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wo:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auszuf√ºhrender iSdCommand-Befehlscode. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iSdAddress ist die Adresse, an der der Befehl ausgef√ºhrt werden soll. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iSdStart Startbefehlsausf√ºhrung. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abschlussstatus des oSdStatus-Teams. </font><font style="vertical-align: inherit;">Das Nullbit ist gleich Eins - der Befehl ist abgeschlossen. </font><font style="vertical-align: inherit;">Das erste Bit ist eins - der Befehl wurde mit einem Fehler abgeschlossen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oSdInitFail Zeichen eines Initialisierungsfehlers. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iSdTxData. </font><font style="vertical-align: inherit;">Axi-Stream-Schnittstelle zum Schreiben von Daten auf eine SD-Karte. </font><font style="vertical-align: inherit;">Port mit Daten.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iSdTxValid. </font><font style="vertical-align: inherit;">Axi-Stream-Schnittstelle zum Schreiben von Daten auf eine SD-Karte. </font><font style="vertical-align: inherit;">Port mit einem Schreibsignal.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iSdTxLast. </font><font style="vertical-align: inherit;">Axi-Stream-Schnittstelle zum Schreiben von Daten auf eine SD-Karte. </font><font style="vertical-align: inherit;">Port mit einem Zeichen des letzten Dw in den Daten.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oSdTxReady. </font><font style="vertical-align: inherit;">Axi-Stream-Schnittstelle zum Schreiben von Daten auf eine SD-Karte. </font><font style="vertical-align: inherit;">Port mit einem Zeichen der Bereitschaft zum Empfang von Daten.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oSdRxData. </font><font style="vertical-align: inherit;">Axi-Stream-Schnittstelle zum Lesen von Daten von einer SD-Karte. </font><font style="vertical-align: inherit;">Port mit Daten.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oSdRxValid. </font><font style="vertical-align: inherit;">Axi-Stream-Schnittstelle zum Lesen von Daten von einer SD-Karte. </font><font style="vertical-align: inherit;">Port mit einem Schreibsignal.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oSdRxLast. </font><font style="vertical-align: inherit;">Axi-Stream-Schnittstelle zum Lesen von Daten von einer SD-Karte. </font><font style="vertical-align: inherit;">Port mit einem Zeichen des letzten Dw in den Daten.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iSdRxReady. </font><font style="vertical-align: inherit;">Axi-Stream-Schnittstelle zum Lesen von Daten von einer SD-Karte. </font><font style="vertical-align: inherit;">Port mit einem Zeichen der Bereitschaft zum Empfang von Daten.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die verbleibenden Signale stimmen mit den Signalen der physikalischen Schicht √ºberein. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Komponente implementiert eine smSdControl-Maschine ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einzelzustand. </font><font style="vertical-align: inherit;">Warten auf die Initialisierung und den Abschluss des Befehls.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Status von sWaitCmd. </font><font style="vertical-align: inherit;">√úberpr√ºfen des Befehlstyps.</font></font></li>
<li>sReadCmd.    FIFO,   ,     SD-      . </li>
<li>sWriteCmd. ,   FIFO      SD-,      . </li>
<li>sEraseCmd.     . </li>
<li>sWaitEnd.       . </li>
<li>sFinish.   ,  . </li>
</ul><br>
<a name="RealTest"></a><h2>3.   </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Algorithmus wird im Simulator geschrieben und verifiziert. </font><font style="vertical-align: inherit;">Es ist notwendig, jetzt in Eisen einzuchecken. </font><font style="vertical-align: inherit;">Von dem, was verf√ºgbar war, kam das </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zybo-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Board </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">von Digilent auf</font></a><font style="vertical-align: inherit;"> den </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Markt</font></a><font style="vertical-align: inherit;"> 
. Es verf√ºgt √ºber freie FPGA-Anschl√ºsse in einer Bank mit einer Spannung </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">von +3,3</font></a><font style="vertical-align: inherit;"> V, an die Sie problemlos ein externes Ger√§t anschlie√üen k√∂nnen. </font><font style="vertical-align: inherit;">Ja, und der verwendete FPGA-Typ ist Zynq-7000, was bedeutet, dass ein Prozessorkern vorhanden ist. </font><font style="vertical-align: inherit;">Sie k√∂nnen einen Test in C schreiben, wodurch die Testaufgabe vereinfacht wird. </font><font style="vertical-align: inherit;">
Daher verbinden wir den implementierten Algorithmus √ºber den GP-Port mit dem Prozessorkern (4-Byte-Betrieb ist √§hnlich wie bei </font><abbr title="Programmed input/output"><font style="vertical-align: inherit;">PIO m√∂glich</font></abbr><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Wir werden uns nicht um Unterbrechungen k√ºmmern, sondern eine Timer-Umfrage durchf√ºhren. </font><font style="vertical-align: inherit;">
Bei der Arbeit am Prozessormodul lautet der Datenaufzeichnungsalgorithmus wie folgt:</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><img src="https://habrastorage.org/webt/oe/oy/nj/oeoynjbbxwco9wrihj-f3unb3cs.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><abbr title="Programmierte Ein- / Ausgabe"><font style="vertical-align: inherit;"></font></abbr><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adresse auf SD-Karte einstellen. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Befehlscode 2 einstellen. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schreiben Sie Daten in einen Puffer in der programmierbaren Logik. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºhren Sie den Befehl aus. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warten Sie, bis der Befehl abgeschlossen ist. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teamabschlussstatus zur√ºcksetzen.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Implementierter Test:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">for</span> (SectorAddress = <span class="hljs-number">0</span>; SectorAddress &lt; <span class="hljs-number">1048576</span>; SectorAddress ++)<font></font>
{<font></font>
	<span class="hljs-keyword">if</span> ((SectorAddress % <span class="hljs-number">1024</span>) == <span class="hljs-number">0</span>)<font></font>
	{<font></font>
		xil_printf(<span class="hljs-string">"Data write to %d sector \n\r"</span>, SectorAddress);<font></font>
	}<font></font>
<font></font>
	<span class="hljs-comment">/** Set address */</span>
	Xil_Out32(<span class="hljs-number">0x43c00008</span>, SectorAddress);<font></font>
<font></font>
	<span class="hljs-comment">/** Set command */</span>
	Xil_Out32(<span class="hljs-number">0x43c00004</span>, <span class="hljs-number">2</span>);<font></font>
<font></font>
	<span class="hljs-comment">/** Write data to PL */</span>
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int32_t</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1024</span>; i++)<font></font>
	{<font></font>
		Xil_Out32(<span class="hljs-number">0x43c00014</span>, cntrData);<font></font>
		cntrData++;<font></font>
	}<font></font>
<font></font>
	<span class="hljs-comment">/** Start */</span>
	Xil_Out32(<span class="hljs-number">0x43c00000</span>, <span class="hljs-number">1</span>);<font></font>
<font></font>
	<span class="hljs-comment">/** Wait end of operation */</span>
	<span class="hljs-keyword">for</span> (;;)<font></font>
	{<font></font>
		status = Xil_In32(<span class="hljs-number">0x43c0000c</span>);
		<span class="hljs-keyword">if</span> (status == <span class="hljs-number">0x01</span> || status == <span class="hljs-number">0x03</span>)<font></font>
		{<font></font>
			<span class="hljs-keyword">if</span> (status == <span class="hljs-number">0x03</span>)<font></font>
			{<font></font>
				xil_printf(<span class="hljs-string">"Error in write \n\r"</span>);<font></font>
			}<font></font>
			<span class="hljs-keyword">break</span>;<font></font>
		}<font></font>
		<span class="hljs-keyword">else</span><font></font>
		{<font></font>
			cntrDuration++;<font></font>
			usleep(<span class="hljs-number">100</span>);<font></font>
		}<font></font>
	}<font></font>
<font></font>
	<span class="hljs-comment">/** Duration operation */</span><font></font>
	durationWrite += cntrDuration;<font></font>
<font></font>
	<span class="hljs-keyword">if</span> (cntrDuration &gt; MaxWrite )<font></font>
	{<font></font>
		MaxWrite = cntrDuration;<font></font>
	}<font></font>
<font></font>
	cntrDuration = <span class="hljs-number">0x00</span>;<font></font>
<font></font>
	<span class="hljs-comment">/** Clear start */</span>
	Xil_Out32(<span class="hljs-number">0x43c00000</span>, <span class="hljs-number">0</span>);<font></font>
<font></font>
	SectorAddress += <span class="hljs-number">7</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf die Frage, warum die √§u√üere Grenze von 1024 in der Schleife </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">verwendet wird, setzt der Algorithmus die Anzahl der Bl√∂cke auf 8. Die</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Gr√∂√üe eines Blocks betr√§gt 512 Bytes. </font><font style="vertical-align: inherit;">Die Gesamtgr√∂√üe von 8 Datenbl√∂cken betr√§gt 8 * 512 Bytes = 4096 Bytes. </font><font style="vertical-align: inherit;">Der Bus zwischen dem Prozessormodul und der programmierbaren Logik ist 4 Byte gro√ü. </font><font style="vertical-align: inherit;">Es stellt sich heraus, dass zum Senden von 4096 Bytes von 4 Bytes vom Prozessormodul an die programmierbare Logik 4096/4 = 1024 Schreiboperationen ausgef√ºhrt werden m√ºssen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei der Arbeit am Prozessormodul lautet der Datenlesealgorithmus wie folgt:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adresse auf SD-Karte einstellen. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Befehlscode 1 einstellen. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºhren Sie den Befehl aus. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warten Sie, bis der Befehl abgeschlossen ist. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teamabschlussstatus zur√ºcksetzen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lesen Sie Daten aus dem Puffer in programmierbarer Logik. </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Implementierter Test:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">for</span> (SectorAddress = <span class="hljs-number">0</span>; SectorAddress &lt; <span class="hljs-number">1048576</span>; SectorAddress++)<font></font>
{<font></font>
	<span class="hljs-keyword">if</span> ((SectorAddress % <span class="hljs-number">1024</span>) == <span class="hljs-number">0</span>)<font></font>
	{<font></font>
		xil_printf(<span class="hljs-string">"Data read from %d sector \n\r"</span>, SectorAddress);<font></font>
	}<font></font>
<font></font>
	<span class="hljs-comment">/** Set address */</span>
	Xil_Out32(<span class="hljs-number">0x43c00008</span>, SectorAddress);<font></font>
<font></font>
	<span class="hljs-comment">/** Set command */</span>
	Xil_Out32(<span class="hljs-number">0x43c00004</span>, <span class="hljs-number">1</span>);<font></font>
<font></font>
	<span class="hljs-comment">/** Start */</span>
	Xil_Out32(<span class="hljs-number">0x43c00000</span>, <span class="hljs-number">1</span>);<font></font>
<font></font>
	<span class="hljs-comment">/** Wait end of operation */</span>
	<span class="hljs-keyword">for</span> (;;)<font></font>
	{<font></font>
		status = Xil_In32(<span class="hljs-number">0x43c0000c</span>);
		<span class="hljs-keyword">if</span> (status == <span class="hljs-number">0x01</span> || status == <span class="hljs-number">0x03</span>)<font></font>
		{<font></font>
			 <span class="hljs-keyword">if</span> (status == <span class="hljs-number">0x03</span>)<font></font>
			{<font></font>
				xil_printf(<span class="hljs-string">"Error in read \n\r"</span>);<font></font>
			}<font></font>
			<span class="hljs-keyword">break</span>;<font></font>
		}<font></font>
		<span class="hljs-keyword">else</span><font></font>
		{<font></font>
			cntrDuration++;<font></font>
			usleep(<span class="hljs-number">100</span>);<font></font>
		}<font></font>
	}<font></font>
<font></font>
	 <span class="hljs-comment">/** Duration operation */</span><font></font>
	 durationRead += cntrDuration;<font></font>
<font></font>
	 <span class="hljs-keyword">if</span> (cntrDuration &gt; MaxRead )<font></font>
	 {<font></font>
		 MaxRead = cntrDuration;<font></font>
	 }<font></font>
<font></font>
	cntrDuration = <span class="hljs-number">0x00</span>;<font></font>
<font></font>
	<span class="hljs-comment">/** Clear start */</span>
	Xil_Out32(<span class="hljs-number">0x43c00000</span>, <span class="hljs-number">0</span>);<font></font>
<font></font>
	<span class="hljs-comment">/** Read data from PL */</span>
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int32_t</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1024</span>; i++)<font></font>
	{<font></font>
		DataR = Xil_In32(<span class="hljs-number">0x43c0001c</span>);
		<span class="hljs-keyword">if</span> (DataR != cntrData)<font></font>
		{<font></font>
			xil_printf(<span class="hljs-string">"Data corrupt! \n\r"</span>);<font></font>
		}<font></font>
		DataR = Xil_In32(<span class="hljs-number">0x43c00020</span>);<font></font>
		cntrData++;<font></font>
	}<font></font>
<font></font>
	SectorAddress += <span class="hljs-number">7</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei der Arbeit am Prozessormodul lautet der Datenl√∂schalgorithmus wie folgt:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adresse auf SD-Karte einstellen. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Befehlscode einstellen 4. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºhren Sie den Befehl aus. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warten Sie, bis der Befehl abgeschlossen ist. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teamabschlussstatus zur√ºcksetzen.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Implementierter Test:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">for</span> (SectorAddress = <span class="hljs-number">0</span>; SectorAddress &lt; <span class="hljs-number">1048576</span>; SectorAddress++)<font></font>
{<font></font>
	<span class="hljs-keyword">if</span> ((SectorAddress % <span class="hljs-number">1024</span>) == <span class="hljs-number">0</span>)<font></font>
	{<font></font>
		xil_printf(<span class="hljs-string">"Data erase from %d sector \n\r"</span>, SectorAddress);<font></font>
	}<font></font>
<font></font>
	<span class="hljs-comment">/** Set address */</span>
	Xil_Out32(<span class="hljs-number">0x43c00008</span>, SectorAddress);<font></font>
<font></font>
	<span class="hljs-comment">/** Set command */</span>
	Xil_Out32(<span class="hljs-number">0x43c00004</span>, <span class="hljs-number">4</span>);<font></font>
<font></font>
	<span class="hljs-comment">/** Start */</span>
	Xil_Out32(<span class="hljs-number">0x43c00000</span>, <span class="hljs-number">1</span>);<font></font>
<font></font>
	<span class="hljs-comment">/** Wait end of operation */</span>
	<span class="hljs-keyword">for</span> (;;)<font></font>
	{<font></font>
		status = Xil_In32(<span class="hljs-number">0x43c0000c</span>);
		<span class="hljs-keyword">if</span> (status == <span class="hljs-number">0x01</span> || status == <span class="hljs-number">0x03</span>)<font></font>
		{<font></font>
			<span class="hljs-keyword">if</span> (status == <span class="hljs-number">0x03</span>)<font></font>
			{<font></font>
				xil_printf(<span class="hljs-string">"Error in write! \n\r"</span>);<font></font>
			}<font></font>
			<span class="hljs-keyword">break</span>;<font></font>
		}<font></font>
		<span class="hljs-keyword">else</span><font></font>
		{<font></font>
			cntrDuration++;<font></font>
			usleep(<span class="hljs-number">100</span>);<font></font>
		}<font></font>
	}<font></font>
<font></font>
	<span class="hljs-comment">/** Duration operation */</span><font></font>
	durationErase += cntrDuration;<font></font>
<font></font>
	<span class="hljs-keyword">if</span> (cntrDuration &gt; MaxErase )<font></font>
	{<font></font>
		MaxErase = cntrDuration;<font></font>
	}<font></font>
<font></font>
	cntrDuration = <span class="hljs-number">0x00</span>;<font></font>
<font></font>
	<span class="hljs-comment">/** Clear start */</span>
	Xil_Out32(<span class="hljs-number">0x43c00000</span>, <span class="hljs-number">0</span>);<font></font>
<font></font>
	SectorAddress += <span class="hljs-number">7</span>;<font></font>
}<font></font>
</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vollst√§ndig auf Github testen.</font></font></a><br>
<br>
<a name="Results"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Ergebnisse</font></font></h2><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datenmenge</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lesen </font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aufzeichnung</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L√∂schen </font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 Block (512 Bytes)</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4,7 Mbit / s</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,36 Mbit / s</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,58 Mbit / s</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8 Bl√∂cke (4096 Bytes)</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15,4 Mbit / s</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6,38 Mbit / s</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4,66 Mbit / s</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16 Bl√∂cke (8192 Bytes)</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18,82 Mbit / s</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11,26 Mbit / s</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9,79 Mbit / s</font></font></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine 16 GB Karte wurde verwendet. </font><font style="vertical-align: inherit;">W√§hrend des Tests wurden 2 GB Daten aufgezeichnet, 2 GB Daten wurden gelesen, 2 GB Daten wurden gel√∂scht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Schlussfolgerungen sind entt√§uschend. </font><font style="vertical-align: inherit;">Bei Verwendung von FPGA ist es nicht sinnvoll, die SD-Karte im SPI-Modus zu verwenden, es sei denn, es ist sehr wichtig, gro√üe Datenmengen ohne Geschwindigkeitsanforderungen zu speichern.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de495388/index.html">1970er Fernsehsendung, die ein Vorfahr des eSports wurde</a></li>
<li><a href="../de495390/index.html">STM32CubeMonitor ist einen Versuch wert</a></li>
<li><a href="../de495392/index.html">So suchen Sie im Frontend nach Fehlern: 4 Hauptphasen</a></li>
<li><a href="../de495396/index.html">Erster Eindruck von Konzepten</a></li>
<li><a href="../de495398/index.html">Ro.Ri.Re</a></li>
<li><a href="../de495402/index.html">Letztes Jahr haben wir endlich ein Schwarzes Loch fotografiert. Was jetzt?</a></li>
<li><a href="../de495404/index.html">Sind sinkende Aktien vielversprechend? Lassen Sie uns mit Python analysieren</a></li>
<li><a href="../de495408/index.html"># 02 - Und ein ganzes Byte reicht nicht ... | Das Kreuz der Ver√§nderungen</a></li>
<li><a href="../de495412/index.html">Norbert Wiener. Eine interessante Person. Kollegen, Feinde, k√§mpfen um Unabh√§ngigkeit</a></li>
<li><a href="../de495414/index.html">Folgen der Angst</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>