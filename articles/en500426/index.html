<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🖊️ 👦🏻 👧🏽 Python, pandas and solving three problems from the world of Excel 👩🏿‍🎨 👩🏾‍🔧 🤘🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Excel is an extremely common data analysis tool. It’s easy to learn how to work with it, it is on almost every computer, and the one who has mastered ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Python, pandas and solving three problems from the world of Excel</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/500426/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Excel is an extremely common data analysis tool. </font><font style="vertical-align: inherit;">It’s easy to learn how to work with it, it is on almost every computer, and the one who has mastered it can solve quite complex problems with it. </font><font style="vertical-align: inherit;">Python is often considered a tool whose capabilities are almost limitless, but which is harder to master than Excel. </font><font style="vertical-align: inherit;">The author of the material, the translation of which we publish today, wants to talk about the solution using Python of the three tasks that are usually solved in Excel. </font><font style="vertical-align: inherit;">This article is a bit of an introduction to Python for those who know Excel well.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/r1/vp/tn/r1vptnsbmezvichpfh0l7iitqj0.jpeg"></a><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Data loading</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's start by importing the Python library </font></font><code>pandas</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and loading data into data frames that are stored on </font><font style="vertical-align: inherit;">Excel </font><font style="vertical-align: inherit;">sheets </font></font><code>sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>states</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">workbooks. </font><font style="vertical-align: inherit;">We will give the same names to the corresponding data frames.</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<font></font>
sales = pd.read_excel(<span class="hljs-string">'https://github.com/datagy/mediumdata/raw/master/pythonexcel.xlsx'</span>, sheet_name = <span class="hljs-string">'sales'</span>)<font></font>
states = pd.read_excel(<span class="hljs-string">'https://github.com/datagy/mediumdata/raw/master/pythonexcel.xlsx'</span>, sheet_name = <span class="hljs-string">'states'</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now we will use the </font></font><code>.head()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data frame </font><font style="vertical-align: inherit;">method </font></font><code>sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to display the elements at the beginning of the data frame:</font></font><br>
<br>
<pre><code class="python hljs">print(sales.head())
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Compare what will be displayed with what you can see in Excel.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d48/0d7/a39/d480d7a3949975d461c1335c4f890b6f.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comparison of the appearance of data output in Excel with the appearance of data output from the pandas data frame</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Here you can see that the results of visualizing data from the data frame are very similar to what you can see in Excel. </font><font style="vertical-align: inherit;">But there are some very important differences:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The row numbering in Excel starts at 1, and in pandas the number (index) of the first row is 0.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In Excel, columns have letters starting with a letter </font></font><code>A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and in pandas, the names of the columns correspond to the names of the corresponding variables.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will continue to study the possibilities of pandas that allow us to solve problems that are usually solved in Excel.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementing the Excel Excel IF Functionality in Python</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Excel has a very convenient function </font></font><code>IF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that allows, for example, writing something to a cell, based on checking what is in another cell. </font><font style="vertical-align: inherit;">Suppose you want to create a new column in Excel, the cells of which will tell us if the values ​​in the corresponding cells in the column exceed 500 </font></font><code>B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In Excel, </font></font><code>E</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">you can assign a heading to </font><font style="vertical-align: inherit;">such a column (in our case, a column </font><font style="vertical-align: inherit;">) by </font></font><code>MoreThan500</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">writing the corresponding text to the cell </font></font><code>E1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">After that, in the cell </font></font><code>E2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, you can enter the following:</font></font><br>
<br>
<pre><code class="python hljs">=IF([@Sales]&gt;<span class="hljs-number">500</span>, <span class="hljs-string">"Yes"</span>, <span class="hljs-string">"No"</span>)
</code></pre><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/521/fe1/dda/521fe1dda8c5ab4558958141388a8ad3.gif"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Using the IF function in Excel</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
In order to do the same with pandas, you can use list comprehension:</font></font><br>
<br>
<pre><code class="python hljs">sales[<span class="hljs-string">'MoreThan500'</span>] = [<span class="hljs-string">'Yes'</span> <span class="hljs-keyword">if</span> x &gt; <span class="hljs-number">500</span> <span class="hljs-keyword">else</span> <span class="hljs-string">'No'</span> <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> sales[<span class="hljs-string">'Sales'</span>]]
</code></pre><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0b6/d51/a34/0b6d51a34ca43fb2a65a5a8aa0c58986.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">List inclusions in Python: if the current value is greater than 500, Yes is included in the list; otherwise, No</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
List inclusions are an excellent tool for solving such problems, which simplifies the code by reducing the need for complex constructions like if / else. </font><font style="vertical-align: inherit;">The same problem can be solved with if / else, but the proposed approach saves time and makes the code a little cleaner. </font><font style="vertical-align: inherit;">Details on list inclusion can be found</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementing the VLOOKUP Excel Functionality in Python</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In our dataset, on one of the Excel sheets, there are city names, and on the other, the names of states and provinces. How to find out exactly where each city is located? An Excel function is suitable for this </font></font><code>VLOOKUP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, with which you can link the data of two tables. This function works on the principle of the left join, when each record from the data set located on the left side of the expression is saved. Using the function </font></font><code>VLOOKUP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, we suggest that the system search for a specific value in a given column of a specified sheet, and then return a value that is a specified number of columns to the right of the found value. Here's what it looks like:</font></font><br>
<br>
<pre><code class="python hljs">=VLOOKUP([@City],states,<span class="hljs-number">2</span>,false)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We set the </font></font><code>sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">column heading </font><font style="vertical-align: inherit;">on the sheet </font></font><code>F</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as we </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">use the function </font></font><code>VLOOKUP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to fill in the cells of this column with the names of the states and provinces in which the cities are located.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d99/f90/e87/d99f90e878120180649f2fbc98669798.gif"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Using the VLOOKUP function in Excel</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
In Python, you can do the same using the method</font></font><code>merge</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from pandas. </font><font style="vertical-align: inherit;">It takes two data frames and combines them. </font><font style="vertical-align: inherit;">To solve this problem, we need the following code:</font></font><br>
<br>
<pre><code class="python hljs">sales = pd.merge(sales, states, how=<span class="hljs-string">'left'</span>, on=<span class="hljs-string">'City'</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's analyze it:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The first argument to the method </font></font><code>merge</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is the original data frame.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The second argument is the data frame in which we are looking for values.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The argument </font></font><code>how</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indicates exactly how we want to join the data.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The argument </font></font><code>on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">points to the variable by which the connection should be performed (here you can still use the arguments </font></font><code>left_on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>right_on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, necessary if the data of interest to us in different data frames is named differently).</font></font></li>
</ol><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Summary tables</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pivot Tables is one of Excel's most powerful features. </font><font style="vertical-align: inherit;">These tables allow you to quickly extract valuable information from large data sets. </font><font style="vertical-align: inherit;">Create an Excel PivotTable that displays information about total sales for each city.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/85d/1d3/37a/85d1d337ac6b5671d819764785decde9.gif"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Creating a PivotTable in Excel</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
As you can see, to create such a table, just drag the field</font></font><code>City</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">into the section</font></font><code>Rows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and the field</font></font><code>Sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">into the section</font></font><code>Values</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">After that, Excel will automatically display the total sales for each city. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order to create the same pivot table in pandas, you will need to write the following code:</font></font><br>
<br>
<pre><code class="python hljs">sales.pivot_table(index = <span class="hljs-string">'City'</span>, values = <span class="hljs-string">'Sales'</span>, aggfunc = <span class="hljs-string">'sum'</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's analyze it:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here we use a method </font></font><code>sales.pivot_table</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, telling pandas that we want to create a pivot table based on a data frame </font></font><code>sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The argument </font></font><code>index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">points to the column by which we want to aggregate the data.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The argument </font></font><code>values</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indicates which values ​​we are going to aggregate.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The argument </font></font><code>aggfunc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">specifies the function that we want to use in the processing of values (here you can still use the functions </font></font><code>mean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>max</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and so on).</font></font></li>
</ol><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Summary</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
From this material you learned about how to import Excel data into pandas, how to implement the capabilities of Excel functions </font></font><code>IF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font><font style="vertical-align: inherit;">Python tools pandas</font></font><code>VLOOKUP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, as well as how to reproduce the functionality of Excel pivot tables using pandas. Perhaps now you are wondering why you should use pandas if you can do the same in Excel. There is no single answer to this question. Python allows you to create code that can be fine-tuned and deeply researched. Such code can be reused. Python can describe very complex data analysis schemes. And the Excel features are probably only enough for smaller-scale data research. If you have only used Excel until now, I recommend that you try Python and pandas and find out what you can do. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What tools do you use to analyze data?</font></font><br>
<br>
<blockquote>,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><b> </b></a>,      iPhone.      ,        .</blockquote><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/a_/bs/aa/a_bsaactpbr8fltzymtkhqbw1d4.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en500416/index.html">Why (not) need getters?</a></li>
<li><a href="../en500418/index.html">New earthquake calculations predict their probable destructiveness</a></li>
<li><a href="../en500420/index.html">sMock - Swift mocking framework for Unit-tests (thanks gMock for ideas)</a></li>
<li><a href="../en500422/index.html">Visual Debugger for Jupyter</a></li>
<li><a href="../en500424/index.html">Deferred use of directive functionality in Angular</a></li>
<li><a href="../en500428/index.html">How to help pandas in processing large amounts of data?</a></li>
<li><a href="../en500430/index.html">How I looked for quarantined work</a></li>
<li><a href="../en500436/index.html">Coming of binary neural networks based on random neurons and logical functions</a></li>
<li><a href="../en500438/index.html">SFTP and FTPS</a></li>
<li><a href="../en500444/index.html">9 Python programming skills that distinguish a beginner from an experienced</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>