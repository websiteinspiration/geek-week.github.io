<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèª‚Äçüî¨ üëéüèª üîò DIY Exergaming in isolation üç¥ üõÅ üïû</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Everyone has their own isolation. In my case, the main problem quickly became maintaining the body in good physical condition. Work in the office and ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>DIY Exergaming in isolation</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/505178/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Everyone has their own isolation. </font><font style="vertical-align: inherit;">In my case, the main problem quickly became maintaining the body in good physical condition. </font><font style="vertical-align: inherit;">Work in the office and shopping alive, it turns out, well kept the body in good shape. </font><font style="vertical-align: inherit;">I was lucky to get the cheapest exercise bike before the crisis, before they were sold out everywhere, so I thought the problem was solved ‚Äî but it wasn‚Äôt there. </font><font style="vertical-align: inherit;">When pedaling becomes a monotonous daily necessity, the next problem is boredom. </font><font style="vertical-align: inherit;">And from everything that is boring, it‚Äôs human nature to swing away. </font><font style="vertical-align: inherit;">How to make it more interesting?</font></font><a name="habracut"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maybe combine with the game? Why not? I have long thought how great it would be if in a flying toy the speed of your plane depended on the speed of pedaling, and now it is time to put the idea into practice. For this, it turns out, they have already come up with the word‚Äî ‚Äúexergaming‚Äù. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jn/rl/ao/jnrlaoqnfhomjkha2pzr6q8sde8.png" align="right"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The first thought was to find a ready-made joystick with a wheel for speed control, and somehow hack it. Fortunately, the joystick, which would not be a pity to break, was not at hand, and I decided to make it myself. In the drawer of the table was Arduino Micro, bought a couple of years ago for another project, and was never used. Micro has a USB port, and the computer recognizes it as a keyboard. And where the keyboard is, there are not far from other HID (Human Interface Device) devices. The library for the joystick was found quickly and was quite convenient (</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/MHeironimus/ArduinoJoystickLibrary</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Add a few buttons and a joystick from the SparkFun picture ‚Äî done! The circuit is completely trivial ‚Äî Arduino, buttons, two resistance variables in the joystick. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The next question is how to get the speed of pedaling from the simulator. Almost any modern simulator has a display and a sensor, but I did not want to pick the simulator (and at the same time lose its warranty). In addition, I wanted everyone to be able to repeat the whole process without any problems. To get started, I used a simple button on the breadboard to verify that the Arduino is working. I checked it, but got carried away so that by the end of the test the button literally fell apart. Time to think about a serious sensor. The magnetic and optical sensors reached the final, and I settled on the magnetic one, assuming (correctly) that there would be less problems with it.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j5/lx/fs/j5lxfsoncatk5gav4s33itlt7ug.png" align="right"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There were many different models of magnetic sensors based on the Hall effect, I settled on Diodes AH3572 because it doesn‚Äôt care about polarity, it only needs 3.3 volts with Arduino, it is relatively cheap and comes in two types of cases, which is convenient for a breadboard, and then for PCB mounting. The most interesting question was ‚Äî how far the sensor will fire. Here I was lucky, in the bins of the Motherland there was a fairly strong Chinese magnet in the form of a cube with a side about a centimeter. With this magnet, the sensor worked reliably at a distance of up to 3 centimeters. The magnet on the pedal, the sensor with tape on the case ‚Äî works.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/or/gy/bm/orgybmlx4o_msw9ioue5pckzzm0.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/e2/wn/yx/e2wnyxsvauvtkeuwi6dqussb0ey.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/uj/uq/gx/ujuqgx0pxbxnq0jhmtyx70himi4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The only difficulty is that the sensor, which is triggered once per revolution, does not provide ready-made data suitable for use as a speed value. From one click on the revolution, you need to somehow get a relatively smooth value, but at the same time, so that it responds quickly enough to changes in speed, and especially to a stop. The problem was solved in about 20 lines of code.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//    </span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">interruptHandler</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> now = millis();
  <span class="hljs-keyword">if</span> (lastInterrupted + DEBOUNCE_MS &lt; now) {<font></font>
    lastInterrupted = now;<font></font>
    throttleBuffer += THROTTLE_BOOST;<font></font>
    <span class="hljs-keyword">if</span> (throttleBuffer &gt; MAX_AXIS) {<font></font>
      throttleBuffer = MAX_AXIS;<font></font>
    }<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//       </span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">calculateThrottle</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">if</span> (throttleBuffer &lt; RELEASE_PER_TICK) {<font></font>
    throttle += throttleBuffer;<font></font>
    throttleBuffer = <span class="hljs-number">0</span>;<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    throttle += RELEASE_PER_TICK;<font></font>
    throttleBuffer -= RELEASE_PER_TICK;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (throttle &gt; MAX_AXIS) {<font></font>
    throttle = MAX_AXIS;<font></font>
  }<font></font>
  <font></font>
  <span class="hljs-keyword">if</span> (throttle &gt; DECAY_PER_TICK) {<font></font>
    throttle -= DECAY_PER_TICK;<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    throttle = <span class="hljs-number">0</span>;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Up to this point, everything was easy, further difficulties began. It was surprisingly difficult to find the right toy. In a couple of days I tried many options. First of all, I needed it to work normally on a relatively weak office laptop. At this point, all modern beautiful flying fighters dropped out. Old flyers either did not start, or were very dull. The first suitable game was the IL-2 Sturmovik, but then I realized that serious simulators were not suitable here. Firstly, there are too few controls, and the joystick is not accurate enough. Secondly, there you need too much attention and think with your head in the process ‚Äî don‚Äôt forget, we are not playing toys here, but pedaling intensely, first of all. Well and most importantly, it‚Äôs all the same very depressing whoever saw his color scheme will understand. It was necessary something arcade type, simple,bright and light.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the end, I settled on Sky Rogue ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">store.steampowered.com/app/381020/Sky_Rogue</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Interestingly, the famous space promoter Scott Manley has her review ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">youtu.be/bRCsB5QoxEM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Simple but vibrant, stylized to 8-bit graphics, minimal requirements, algorithmically generated (non-repeating) terrain, invigorating action, endless weapons ‚Äî what else is needed for half an hour of non-stop movement? Sky Rogue is better suited for a gamepad, but, fortunately, Steam in full-screen mode allows you to reassign joystick controls to emulate a gamepad.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pl/b0/1h/plb01h1a4zpznslhcsobbpmolo8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now the last touch remains ‚Äî the corps. Playing with the breadboard in hand, as it turned out, is possible ‚Äî but rather inconvenient. Autodesk Fusion 360 in one hand, 3D printer in the other, go! But first you need to think a little. The controller must be controlled with one hand, the other need to hold on to the simulator. It would be a shame in self-isolation to get carried away with a toy and screw up with the simulator. The shape must be symmetrical so that you can use it with any hand. Well, it is desirable that it is easy to print and assemble ‚Äî in self-isolation, not everyone will find three identical M2 screws of the desired length.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_t/gg/gt/_tgggt4chp7vbxyycddimf58rle.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The design of a picture of two halves glued together. There is definitely instant glue everywhere. For quick alignment of the halves, until the glue has dried, guide pins are used, which are 5mm pieces of material for the printer. The button is printed separately and inserted into the housing during assembly. It has no axis, it rolls around the surface of the printed circuit board, and is pressed against it by the lower half of the case. Of course, I got a little carried away with the selection of the most convenient form. The very first version, made exactly to the size of the components, was too small to be conveniently held in the hand. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pq/jy/_w/pqjy_wu5yys2pcfjqguym2gtyw4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The manufacture of several controllers cost (in Singapore) about 3,000 rubles apiece, including the manufacture of a printed circuit board in Shenzhen ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.pcbsino.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) ‚ÄîFortunately, the Chinese electronics industry continued to operate despite the epidemic. </font><font style="vertical-align: inherit;">About half the cost ‚Äî Arduino Micro, the second expensive component ‚Äî the joystick. </font><font style="vertical-align: inherit;">With mass production it would be possible to make three times cheaper, but I didn‚Äôt have such global plans (if you are interested, write). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But the most important thing is that since I made my controller, for half an hour on the simulator they fly completely unnoticed. </font><font style="vertical-align: inherit;">Keep yourself in good shape and be healthy!</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bw/tr/id/bwtridjfyoshd1ttywvt0hk9bzw.jpeg"></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en505136/index.html">Nibiru</a></li>
<li><a href="../en505138/index.html">What to do so that your online broadcast does not fall apart (well, or at least work for a while)</a></li>
<li><a href="../en505142/index.html">How Amazon wants innovation out of the pandemic</a></li>
<li><a href="../en505156/index.html">Django: one user for everything</a></li>
<li><a href="../en505176/index.html">What assets allowed investors to protect resources during a pandemic?</a></li>
<li><a href="../en505186/index.html">Three ways to combine ground on a printed circuit board</a></li>
<li><a href="../en505190/index.html">How to recreate the moire pattern effect in the p5.js library for a beginner (quick guide)</a></li>
<li><a href="../en505194/index.html">Windows Defender SmartScreen harms independent developers</a></li>
<li><a href="../en505196/index.html">Bad leader - instruction manual</a></li>
<li><a href="../en505208/index.html">How and why should a product hold CustDev?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>