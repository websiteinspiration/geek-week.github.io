<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ™†ğŸ¼ ğŸ”½ ğŸ™†ğŸ¼ ï¼ˆã»ã¼ï¼‰çµ¶å¯¾åˆå¿ƒè€…ã®ãŸã‚ã®GitLab CI / CDã‚¬ã‚¤ãƒ‰ ğŸ‘µ ğŸ‘µğŸ¾ ğŸª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ã¾ãŸã¯ã€ãƒªãƒ©ãƒƒã‚¯ã‚¹ã—ãŸã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®ã‚ã‚‹å¤œã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç¾ã—ã„ãƒãƒƒã‚¸ã‚’å–å¾—ã™ã‚‹æ–¹æ³•
 

ãŠãã‚‰ãã€å°‘ãªãã¨ã‚‚1ã¤ã®ãƒšãƒƒãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æŒã£ã¦ã„ã‚‹ã™ã¹ã¦ã®é–‹ç™ºè€…ã¯ã€ã‚ã‚‹æ™‚ç‚¹ã§ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸ã€nugetã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å‚™ãˆãŸç¾ã—ã„ãƒãƒƒã‚¸ã‚’ãƒ†ãƒ¼ãƒã«ã‹ã‚†ã¿ãŒã‚ã‚Šã¾ã™ã€‚ãã‚Œã‚’æ›¸ãæº–...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ï¼ˆã»ã¼ï¼‰çµ¶å¯¾åˆå¿ƒè€…ã®ãŸã‚ã®GitLab CI / CDã‚¬ã‚¤ãƒ‰</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/498436/"><p><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ãŸã¯ã€ãƒªãƒ©ãƒƒã‚¯ã‚¹ã—ãŸã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®ã‚ã‚‹å¤œã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç¾ã—ã„ãƒãƒƒã‚¸ã‚’å–å¾—ã™ã‚‹æ–¹æ³•</font></font></em></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãŠãã‚‰ãã€å°‘ãªãã¨ã‚‚1ã¤ã®ãƒšãƒƒãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æŒã£ã¦ã„ã‚‹ã™ã¹ã¦ã®é–‹ç™ºè€…ã¯ã€ã‚ã‚‹æ™‚ç‚¹ã§ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸ã€nugetã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å‚™ãˆãŸç¾ã—ã„ãƒãƒƒã‚¸ã‚’ãƒ†ãƒ¼ãƒã«ã‹ã‚†ã¿ãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãã‚Œã‚’æ›¸ãæº–å‚™ã¨ã—ã¦ã€ç§ã¯ç§ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®1ã¤ã§ãã®ã‚ˆã†ãªç¾ã—ã•ã‚’å¾—ã¾ã—ãŸï¼š</font></font></p><br>
<p><img src="https://habrastorage.org/webt/kx/ak/yi/kxakyimb1it83wyhml_lbxmqbvm.png" alt="çµæœ"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã®è¨˜äº‹ã§ã¯ã€GitLab Pagesã§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å…¬é–‹ã—ã€åé›†ã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’Azure DevOpsã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ•ã‚£ãƒ¼ãƒ‰ã«é€ä¿¡ã—ã¦ã€GitLabã§ã®.Net Coreã‚¯ãƒ©ã‚¹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç¶™ç¶šçš„ãªçµ±åˆã¨é…ä¿¡ã®åŸºæœ¬çš„ãªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚ </font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VS Codeã¯ã€</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitLabãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‹¡å¼µæ©Ÿèƒ½ã‚’å‚™ãˆãŸé–‹ç™ºç’°å¢ƒã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã¾ã—ãŸï¼ˆé–‹ç™ºç’°å¢ƒ</font><font style="vertical-align: inherit;">ã‹ã‚‰ç›´æ¥è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œè¨¼ã™ã‚‹ãŸã‚ï¼‰ã€‚</font></font></p><a name="habracut"></a><br>
<h2 id="kratkoe-vvedenie"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°¡å˜ãªç´¹ä»‹</font></font></h2><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CD-ã“ã‚Œã¯ã‚ãªãŸãŒãƒ—ãƒƒã‚·ãƒ¥ã—ãŸã¨ãã§ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ã™ã¹ã¦è½ã¡ã¾ã—ãŸã‹ï¼Ÿ</font></font></blockquote><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CI / CDã¨ã¯ä½•ã§ã™ã‹ã€ãªãœç°¡å˜ã«ã‚°ãƒ¼ã‚°ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã™ã‹ï¼Ÿ</font><font style="vertical-align: inherit;">GitLabã§ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’æ§‹æˆã™ã‚‹æ–¹æ³•ã«é–¢ã™ã‚‹å®Œå…¨ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚‚ç°¡å˜ã«</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦‹ã¤ã‘ã‚‹</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ã“ã¨ãŒ</font></a><font style="vertical-align: inherit;">ã§ãã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ã“ã“ã§ã¯ã€ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’é³¥ç°å›³ã§èª¬æ˜ã—ã€æ¬ é™¥ã®ãªã„é™ã‚Šç°¡å˜ã«èª¬æ˜ã—ã¾ã™ã€‚</font></font></p><br>
<ul>
<li>    ,  merge request  , <em>  -      </em>,</li>
<li>    ,        ,</li>
<li>      ,</li>
<li>    â€” .. <em></em>     ,</li>
<li>    (..        ) â€”   (<em> </em>),</li>
<li>    ,    .</li>
</ul><br>
<p> , :</p><br>
<ul>
<li> â€”  ,   ,    , ,  ,      ,  .,</li>
<li> (<strong>stage</strong>) â€”   ,  1+ ,</li>
<li> (<strong>job</strong>) â€”    .    (),  ,  /    .</li>
</ul><br>
<p>,    CI/CD   ,    ,      ,      .</p><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"> : ?</b>
                        <div class="spoiler_text"><ul>
<li> GitLab?</li>
</ul><br>
<p>,         -,  GitHub'e   ,   â€” .   ,            GitHub.</p><br>
<ul>
<li>  Azure DevOps Pipelines?</li>
</ul><br>
<p>     â€”      .     git â€”   ,  SSH-      â€” ,       .</p></div>
                    </div><br>
<h2 id="ishodnaya-poziciya-chto-imeetsya-i-chego-hochetsya"> :     </h2><br>
<p>:</p><br>
<ul>
<li>  GitLab.</li>
</ul><br>
<p>:</p><br>
<ul>
<li>      merge request,</li>
<li>    merge request            ,</li>
<li>       Azure DevOps,</li>
<li>     GitLab Pages,</li>
<li><em>!11</em></li>
</ul><br>
<p>       :</p><br>
<ul>
<li> 1 â€” <br>
<ul>
<li> ,     </li>
</ul></li>
<li> 2 â€” <br>
<ul>
<li>    ,  ,    </li>
</ul></li>
<li> 3 â€” <br>
<ul>
<li> 1 â€”  nuget-    Azure DevOps</li>
<li> 2 â€”    xmldoc       GitLab Pages</li>
</ul></li>
</ul><br>
<p>!</p><br>
<h2 id="sobiraem-konfiguraciyu"> </h2><br>
<h3 id="gotovim-akkaunty"> </h3><br>
<ol>
<li><p>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Microsoft Azure</a></p><br>
</li>
<li><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Azure DevOps</a></p><br>
</li>
<li><p>  </p><br>
<ol>
<li> â€” </li>
<li> â€” <br>
<img src="https://habrastorage.org/webt/to/_f/mp/to_fmps8ypj2ekynmz2gih2y_bw.png" alt="Azure DevOps-æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ"></li>
</ol><br>
</li>
<li><p>    Create   ,       .       ,     (     -&gt; Overview -&gt;  Azure DevOps Services)<br>
<img src="https://habrastorage.org/webt/mw/qe/az/mwqeaz0lnj5bk9hmq348azezwyu.png" alt="ã‚µãƒ¼ãƒ“ã‚¹è¨­å®š"></p><br>
</li>
<li><p>  Atrifacts,  Create feed</p><br>
<ol>
<li>  </li>
<li> </li>
<li>  <strong>Include packages from common public sources</strong>,      <s></s>  nuget<br>
<img src="https://habrastorage.org/webt/n8/vt/x9/n8vtx9qslsiysnu-9htq49pet6a.png" alt="ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚½ãƒ¼ã‚¹ã®æ§‹æˆ"></li>
</ol><br>
</li>
<li><p> Connect to feed,  Visual Studio,   Machine Setup  Source<br>
<img src="https://habrastorage.org/webt/wf/ib/ik/wfibikh0dqsuhylr4jdmhgzaboe.png" alt="ã‚½ãƒ¼ã‚¹URL"></p><br>
</li>
<li><p>   ,  Personal Access Token<br>
<img src="https://habrastorage.org/webt/i2/ll/oa/i2lloaky-xdfiunjqh9b53diqsu.png" alt="å€‹äººç”¨ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³"></p><br>
</li>
<li><p>   </p><br>
<ol>
<li> â€” </li>
<li> â€” </li>
<li>  â€”  1 </li>
<li>  (scope) â€” Packaging/Read &amp; Write<br>
<img src="https://habrastorage.org/webt/mf/dn/zo/mfdnzobz6pbitmtjee9hijxahrm.png" alt="PATã‚’ä½œæˆã™ã‚‹"></li>
</ol><br>
</li>
<li><p>   â€” <strong>      </strong></p><br>
</li>
<li><p>     GitLab,   CI/CD<br>
<img src="https://habrastorage.org/webt/2i/vx/lq/2ivxlqmonl_6u8ihoqzhaelmnau.png" alt="GitLab CI / CDè¨­å®š"></p><br>
</li>
<li><p>  Variables,  </p><br>
<ol>
<li> â€”    (    )</li>
<li> â€”    . 9</li>
<li> Mask variable<br>
<img src="https://habrastorage.org/webt/z9/wk/hd/z9wkhdwqbxoy1ehiv6xle6ybcl0.png" alt="GitLab-æ–°ã—ã„å¤‰æ•°"></li>
</ol><br>
</li>
</ol><br>
<p>    .</p><br>
<h3 id="gotovim-karkas-konfiguracii">  </h3><br>
<p> ,   CI/CD  GitLab   <code>.gitlab-ci.yml</code>   .          ,       .</p><br>
<p>   ,      <code>YAML</code>.    ,        ,      .</p><br>
<p>       docker-,      .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  .Net Core  Docker Hub</a>.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">GitHub</a>   ,      .       .Net Core 3.1,       </p><br>
<pre><code class="plaintext hljs">image: mcr.microsoft.com/dotnet/core/sdk:3.1</code></pre><br>
<p>       Microsoft    ,         .</p><br>
<p>  â€”  <strong>stage</strong>'.   GitLab  5 :</p><br>
<ul>
<li><code>.pre</code> â€”    ,</li>
<li><code>.post</code> â€”    ,</li>
<li><code>build</code> â€”   <code>.pre</code> ,</li>
<li><code>test</code> â€”  ,</li>
<li><code>deploy</code> â€”  .</li>
</ul><br>
<p>     , . ,    ,   ,    .   ,   :</p><br>
<pre><code class="plaintext hljs">stages:<font></font>
  - build<font></font>
  - test<font></font>
  - deploy</code></pre><br>
<p>       ,    .    ,      ,   <code>before_script</code>:</p><br>
<pre><code class="plaintext hljs">before_script:<font></font>
  - $PSVersionTable.PSVersion<font></font>
  - dotnet --version<font></font>
  - nuget help | select-string Version</code></pre><br>
<p>     ,      .       :</p><br>
<pre><code class="plaintext hljs">dummy job:<font></font>
  script:<font></font>
    - echo ok</code></pre><br>
<p> ,  ,   , , ,     â€¦     â€” <code>bash: .PSVersion: command not found</code>. WTF?</p><br>
<p>  â€”   runner' (    ,   GitLab')  <code>bash</code>   .    ,     ,        :</p><br>
<pre><code class="plaintext hljs">dummy job on windows:<font></font>
  script:<font></font>
    - echo ok<font></font>
  tags:<font></font>
    - windows</code></pre><br>
<p>!   .</p><br>
<p> ,   , ,      <code>test</code>,     .   , <code>test</code>    .</p><br>
<p>   ,   ,  :</p><br>
<pre><code class="plaintext hljs">build job:<font></font>
  script:<font></font>
    - echo "building..."<font></font>
  tags:<font></font>
    - windows<font></font>
  stage: build<font></font>
<font></font>
test and cover job:<font></font>
  script:<font></font>
    - echo "running tests and coverage analysis..."<font></font>
  tags:<font></font>
    - windows<font></font>
  stage: test<font></font>
<font></font>
pack and deploy job:<font></font>
  script:<font></font>
    - echo "packing and pushing to nuget..."<font></font>
  tags:<font></font>
    - windows<font></font>
  stage: deploy<font></font>
<font></font>
pages:<font></font>
  script:<font></font>
    - echo "creating docs..."<font></font>
  tags:<font></font>
    - windows<font></font>
  stage: deploy</code></pre><br>
<p>   ,      .</p><br>
<h3 id="nastroyka-triggerov"> </h3><br>
<p>- ,          ,   <strong></strong>       .          ,      .</p><br>
<p>     : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">only/except</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">rules</a>. , <code>only/except</code>      (<code>merge_request</code>,  â€”                 ,      )    ( ..    ); <code>rules</code>     , ,           (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>when</code>  GitLab CI/CD</a>).</p><br>
<p>   â€”      merge request,     Azure DevOps â€”  merge request    ,   â€”    .</p><br>
<p>     ,      merge request:</p><br>
<pre><code class="plaintext hljs">build job:<font></font>
  # snip<font></font>
  only:<font></font>
    - merge_request</code></pre><br>
<p>       merge request     :</p><br>
<pre><code class="plaintext hljs">pack and deploy job:<font></font>
  # snip<font></font>
  only:<font></font>
    - merge_request<font></font>
    - master</code></pre><br>
<p> ,    .</p><br>
<p>         merge request      :</p><br>
<pre><code class="plaintext hljs">  rules:<font></font>
    - if: $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == "master"</code></pre><br>
<p>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  </a>;  <code>rules</code>     <code>only/except</code>.</p><br>
<h3 id="nastroyka-sohraneniya-artefaktov">  </h3><br>
<p>    <code>build job</code>      ,      .        ,           ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>artifacts</code></a>:</p><br>
<pre><code class="plaintext hljs">build job:<font></font>
  # snip<font></font>
  artifacts:<font></font>
    paths:<font></font>
      - path/to/build/artifacts<font></font>
      - another/path<font></font>
      - MyCoolLib.*/bin/Release/*</code></pre><br>
<p>  wildcards,     .</p><br>
<p>   ,           â€”          ,       .        .</p><br>
<p>,     ( )  ,        .</p><br>
<h3 id="pishem-skripty"> </h3><br>
<p>, - ,  - ,   (     .net)     .   ,       3 :</p><br>
<pre><code class="plaintext hljs">dotnet build<font></font>
dotnet test<font></font>
dotnet pack</code></pre><br>
<p>,   , -     .</p><br>
<ol>
<li>  ,    ,      <code>-c Release</code></li>
<li>        ,        :<br>
<ol>
<li>       <code>coverlet.msbuild</code>: <code>dotnet add package coverlet.msbuild</code>   </li>
<li>     <code>/p:CollectCoverage=true</code></li>
<li>          (. )</li>
</ol></li>
<li>    nuget-     : <code>-o .</code></li>
</ol><br>
<h4 id="sobiraem-dannye-pokrytiya-koda">   </h4><br>
<p>Coverlet         :</p><br>
<pre><code class="plaintext hljs">Calculating coverage result...<font></font>
  Generating report 'C:\Users\xxx\source\repos\my-project\myProject.tests\coverage.json'<font></font>
<font></font>
+-------------+--------+--------+--------+<font></font>
| Module      | Line   | Branch | Method |<font></font>
+-------------+--------+--------+--------+<font></font>
| project 1   | 83,24% | 66,66% | 92,1%  |<font></font>
+-------------+--------+--------+--------+<font></font>
| project 2   | 87,5%  | 50%    | 100%   |<font></font>
+-------------+--------+--------+--------+<font></font>
| project 3   | 100%   | 83,33% | 100%   |<font></font>
+-------------+--------+--------+--------+<font></font>
<font></font>
+---------+--------+--------+--------+<font></font>
|         | Line   | Branch | Method |<font></font>
+---------+--------+--------+--------+<font></font>
| Total   | 84,27% | 65,76% | 92,94% |<font></font>
+---------+--------+--------+--------+<font></font>
| Average | 90,24% | 66,66% | 97,36% |<font></font>
+---------+--------+--------+--------+</code></pre><br>
<p>GitLab       ,       .         <code>coverage</code>;     capture-,       :</p><br>
<pre><code class="plaintext hljs">test and cover job:<font></font>
  # snip<font></font>
  coverage: /\|\s*Total\s*\|\s*(\d+[,.]\d+%)/</code></pre><br>
<p>          .</p><br>
<h3 id="publikuem-pakety-i-dokumentaciyu">   </h3><br>
<p>         â€”      ,      .</p><br>
<p>      :</p><br>
<ol>
<li><p>       nuget (<code>nuget.config</code>),  : <code>dotnet new nugetconfig</code></p><br>
<p><em>:</em>           (  ) .    ,          .</p><br>
</li>
<li>      : <code>nuget sources add -name &lt;name&gt; -source &lt;url&gt; -username &lt;organization&gt; -password &lt;gitlab variable&gt; -configfile nuget.config -StorePasswordInClearText</code><br>
<ol>
<li><code>name</code> â€”   ,  </li>
<li><code>url</code> â€” URL    " ", . 6</li>
<li><code>organization</code> â€”    Azure DevOps</li>
<li><code>gitlab variable</code> â€”     ,   GitLab (" ", . 11). ,   <code>$variableName</code></li>
<li><code>-StorePasswordInClearText</code> â€”        (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">      </a>)</li>
<li>       <code>-verbosity detailed</code></li>
</ol></li>
<li>   : <code>nuget push -source &lt;name&gt; -skipduplicate -apikey &lt;key&gt; *.nupkg</code><br>
<ol>
<li>     ,  <code>*.nupkg</code>.</li>
<li><code>name</code> â€”   .</li>
<li><code>key</code> â€”  .  Azure DevOps   Connect to feed       <code>az</code>.</li>
<li><code>-skipduplicate</code> â€”             <code>409 Conflict</code>;     .</li>
</ol></li>
</ol><br>
<p>   :</p><br>
<ol>
<li> ,  ,   master,   docfx.        <code>docfx init</code>          .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>.<br>
<ol>
<li>      <code>..\public</code> â€” GitLab      public       Pages. ..         â€”       .</li>
</ol></li>
<li>   GitLab.</li>
<li>     <code>pages</code> (       GitLab Pages):<br>
<ol>
<li>:<br>
<ol>
<li><code>nuget install docfx.console -version 2.51.0</code> â€”  docfx;        .</li>
<li><code>.\docfx.console.2.51.0\tools\docfx.exe .\docfx_project\docfx.json</code> â€”  </li>
</ol></li>
<li> artifacts:</li>
</ol></li>
</ol><br>
<pre><code class="plaintext hljs">pages:<font></font>
  # snip<font></font>
  artifacts:<font></font>
    paths:<font></font>
      - public</code></pre><br>
<h4 id="liricheskoe-otstuplenie-pro-docfx">   docfx</h4><br>
<p>            .   â€”      .  ,    ,      <code>metadata.src</code>:</p><br>
<pre><code class="json hljs">{
  <span class="hljs-attr">"metadata"</span>: [<font></font>
    {<font></font>
      <span class="hljs-attr">"src"</span>: [<font></font>
        {<font></font>
          <span class="hljs-attr">"src"</span>: <span class="hljs-string">"../"</span>,
          <span class="hljs-attr">"files"</span>: [
            <span class="hljs-string">"**/*.csproj"</span><font></font>
          ],<font></font>
          <span class="hljs-attr">"exclude"</span>:[
            <span class="hljs-string">"*.tests*/**"</span><font></font>
          ]<font></font>
        }<font></font>
      ],<font></font>
      <span class="hljs-comment">// --- snip ---</span><font></font>
    },<font></font>
    <span class="hljs-comment">// --- snip ---</span><font></font>
  ],<font></font>
  <span class="hljs-comment">// --- snip ---</span>
}</code></pre><br>
<ol>
<li><code>metadata.src.src: "../"</code> â€”       <code>docfx.json</code>, ..         .</li>
<li><code>metadata.src.files: ["**/*.csproj"]</code> â€”  ,    C#   .</li>
<li><code>metadata.src.exclude: ["*.tests*/**"]</code> â€”  ,      <code>.tests</code>  </li>
</ol><br>
<h3 id="promezhutochnyy-itog"> </h3><br>
<p>            ,           ,      ,   ,         README .</p><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"> .gitlab-ci.yml</b>
                        <div class="spoiler_text"><pre><code class="plaintext hljs">image: mcr.microsoft.com/dotnet/core/sdk:3.1<font></font>
<font></font>
before_script:<font></font>
  - $PSVersionTable.PSVersion<font></font>
  - dotnet --version<font></font>
  - nuget help | select-string Version<font></font>
<font></font>
stages:<font></font>
  - build<font></font>
  - test<font></font>
  - deploy<font></font>
<font></font>
build job:<font></font>
  stage: build<font></font>
  script:<font></font>
    - dotnet build -c Release<font></font>
  tags:<font></font>
    - windows<font></font>
  only:<font></font>
    - merge_requests<font></font>
    - master<font></font>
  artifacts:<font></font>
    paths:<font></font>
      - your/path/to/binaries<font></font>
<font></font>
test and cover job:<font></font>
  stage: test<font></font>
  tags:<font></font>
    - windows<font></font>
  script:<font></font>
    - dotnet test -c Release /p:CollectCoverage=true<font></font>
  coverage: /\|\s*Total\s*\|\s*(\d+[,.]\d+%)/<font></font>
  only:<font></font>
    - merge_requests<font></font>
    - master<font></font>
<font></font>
pack and deploy job:<font></font>
  stage: deploy<font></font>
  tags:<font></font>
    - windows<font></font>
  script:<font></font>
    - dotnet pack -c Release -o .<font></font>
    - dotnet new nugetconfig<font></font>
    - nuget sources add -name feedName -source https://pkgs.dev.azure.com/your-organization/_packaging/your-feed/nuget/v3/index.json -username your-organization -password $nugetFeedToken -configfile nuget.config -StorePasswordInClearText<font></font>
    - nuget push -source feedName -skipduplicate -apikey az *.nupkg<font></font>
  only:<font></font>
    - master<font></font>
<font></font>
pages:<font></font>
  tags:<font></font>
    - windows<font></font>
  stage: deploy<font></font>
  script:<font></font>
    - nuget install docfx.console -version 2.51.0<font></font>
    - $env:path = "$env:path;$($(get-location).Path)"<font></font>
    - .\docfx.console.2.51.0\tools\docfx.exe .\docfx\docfx.json<font></font>
  artifacts:<font></font>
    paths:<font></font>
      - public<font></font>
  only:<font></font>
    - master</code></pre></div>
                    </div><br>
<h4 id="kstati-o-beydzhikah">  </h4><br>
<p>     !</p><br>
<p>         GitLab   CI/CD   Gtntral pipelines:</p><br>
<p><img src="https://habrastorage.org/webt/zt/rp/ih/ztrpihz2fangy7ec_kk2if4ut-y.png" alt="GitLabã®ãƒãƒƒã‚¸"></p><br>
<p>         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Shields.io</a> â€”    ,          .</p><br>
<pre><code class="plaintext hljs">![  Shields.io](https://img.shields.io/badge/custom-badge-blue)</code></pre><br>
<p><img src="https://img.shields.io/badge/custom-badge-blue" alt="Shields.ioã®ä¾‹"></p><br>
<p>Azure DevOps Artifacts          .       Azure DevOps    Create badge      markdown-:</p><br>
<p><img src="https://habrastorage.org/webt/hf/f_/2f/hff_2f_lxmq7lsu5v_85qigk6ra.png" alt="Azure DevOpsã§ãƒãƒƒã‚¸ã‚’ä½œæˆã™ã‚‹"></p><br>
<p><img src="https://habrastorage.org/webt/rp/sq/g2/rpsqg29eimjws5m3prikgvkdw2k.png" alt="Azure DevOpsãƒãƒƒã‚¸æƒ…å ±"></p><br>
<h3 id="dobavlyaem-krasoty"> </h3><br>
<h4 id="vydelyaem-obschie-fragmenty-konfiguracii">   </h4><br>
<p>       ,      YAML â€”  .</p><br>
<p>    ,      <code>windows</code>  ,      /    ( ).    ,   :</p><br>
<pre><code class="plaintext hljs">.common_tags: &amp;common_tags<font></font>
  tags:<font></font>
    - windows<font></font>
.common_only: &amp;common_only<font></font>
  only:<font></font>
    - merge_requests<font></font>
    - master</code></pre><br>
<p>         :</p><br>
<pre><code class="plaintext hljs">build job:<font></font>
  &lt;&lt;: *common_tags<font></font>
  &lt;&lt;: *common_only</code></pre><br>
<p>     ,      .</p><br>
<h4 id="versionirovanie-paketov"> </h4><br>
<p>       ,     â€”  ;   Version,        . ,      ,       ,      .</p><br>
<p>    â€”            ,    .            ,  â€”        ,           .</p><br>
<p>,         <code>release (v./ver./version) &lt;version number&gt; (rev./revision &lt;revision&gt;)?</code>,         ,          <code>dotnet pack</code>.    â€”     .</p><br>
<p>    : </p><br>
<pre><code class="powershell hljs"><span class="hljs-comment">#       </span>
<span class="hljs-variable">$rx</span> = <span class="hljs-string">"release\s+(v\.?|ver\.?|version)\s*(?&lt;maj&gt;\d+)(?&lt;min&gt;\.\d+)?(?&lt;rel&gt;\.\d+)?\s*((rev\.?|revision)?\s+(?&lt;rev&gt;[a-zA-Z0-9-_]+))?"</span>
<span class="hljs-comment">#     ,      GitLab' </span>
<span class="hljs-variable">$found</span> = <span class="hljs-variable">$env:CI_COMMIT_MESSAGE</span> <span class="hljs-operator">-match</span> <span class="hljs-variable">$rx</span>
<span class="hljs-comment">#   - </span>
<span class="hljs-keyword">if</span> (!<span class="hljs-variable">$found</span>) { <span class="hljs-built_in">Write-Output</span> <span class="hljs-string">"no release info found, aborting"</span>; <span class="hljs-keyword">exit</span> }
<span class="hljs-comment">#     </span>
<span class="hljs-variable">$maj</span> = <span class="hljs-variable">$matches</span>[<span class="hljs-string">'maj'</span>]
<span class="hljs-variable">$min</span> = <span class="hljs-variable">$matches</span>[<span class="hljs-string">'min'</span>]
<span class="hljs-comment">#      -  ,  -  </span>
<span class="hljs-keyword">if</span> (<span class="hljs-variable">$matches</span>.ContainsKey(<span class="hljs-string">'rel'</span>)) { <span class="hljs-variable">$rel</span> = <span class="hljs-variable">$matches</span>[<span class="hljs-string">'rel'</span>] } <span class="hljs-keyword">else</span> { <span class="hljs-variable">$rel</span> = <span class="hljs-string">".<span class="hljs-variable">$</span>(get-date -format "</span>yyyy<span class="hljs-string">")"</span> }
<span class="hljs-comment">#     -    </span>
<span class="hljs-variable">$bld</span> = <span class="hljs-variable">$</span>(<span class="hljs-built_in">get-date</span> <span class="hljs-literal">-format</span> <span class="hljs-string">"MMdd"</span>)
<span class="hljs-comment">#       -    </span>
<span class="hljs-keyword">if</span> (<span class="hljs-variable">$matches</span>.ContainsKey(<span class="hljs-string">'rev'</span>)) { <span class="hljs-variable">$rev</span> = <span class="hljs-string">"-<span class="hljs-variable">$</span>(<span class="hljs-variable">$matches</span>['rev'])"</span> } <span class="hljs-keyword">else</span> { <span class="hljs-variable">$rev</span> = <span class="hljs-string">''</span> }
<span class="hljs-comment">#    </span>
<span class="hljs-variable">$version</span> = <span class="hljs-string">"<span class="hljs-variable">$maj</span><span class="hljs-variable">$min</span><span class="hljs-variable">$rel</span>.<span class="hljs-variable">$bld</span><span class="hljs-variable">$rev</span>"</span>
<span class="hljs-comment">#  </span>
dotnet pack <span class="hljs-literal">-c</span> Release <span class="hljs-literal">-o</span> . /p:Version=<span class="hljs-variable">$version</span></code></pre><br>
<p>    <code>pack and deploy job</code>            .</p><br>
<h2 id="itogo"></h2><br>
<p>  -    ,    powershell , ,   ,        . </p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚‚ã¡ã‚ã‚“ã€GitLab CI / CDã¯ã€ã“ã®ã‚¬ã‚¤ãƒ‰ã‚’èª­ã‚“ã å¾Œã«æ€ã‚ã‚Œã‚‹ã‚ˆã‚Šã‚‚ã¯ã‚‹ã‹ã«åºƒç¯„å›²ã§å¤šé¢çš„ã§ã™- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã‚Œã¯çµ¶å¯¾ã«ãã†ã§ã¯ã‚ã‚Šã¾ã›ã‚“</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ã§ã‚‚ã‚ã‚Šã¾ã™</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãŒã€è‡ªå‹•DevOpsãƒãƒ¼ãƒ ã‚’</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯èƒ½ã«ã—ã€</font></font></p><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è‡ªå‹•çš„ã«æ¤œå‡ºã€æ§‹ç¯‰ã€ãƒ†ã‚¹ãƒˆã€å±•é–‹ã€ç›£è¦–ã™ã‚‹</font></font></blockquote><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¬¡ã¯ã€Pulumiã‚’ä½¿ç”¨ã—ã¦Azureã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆç’°å¢ƒã‚’è‡ªå‹•çš„ã«æ¤œå‡ºã™ã‚‹ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’æ§‹æˆã™ã‚‹äºˆå®šã§ã™ã€‚ã“ã‚Œã«ã¤ã„ã¦ã¯ã€æ¬¡ã®è¨˜äº‹ã§èª¬æ˜ã—ã¾ã™ã€‚</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja498416/index.html">Yandexã¯è‡ªå‹•çš„ã«ã‚«ãƒ¼ãƒ‰ã‚’åˆ¥ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ãƒªãƒ³ã‚¯ã—ã¾ã™</a></li>
<li><a href="../ja498418/index.html">ãƒ¡ãƒ‡ã‚£ã‚¢ã‚µãƒ¼ãƒãƒ¼ã§ã®WebRTCã®å®Ÿè£…-å®Ÿè·µã¨ãƒãƒªã‚·ãƒ¼</a></li>
<li><a href="../ja498426/index.html">Yandexã®ãƒ‡ãƒ¥ãƒ¼ãƒ†ã‚£ã‚·ãƒ•ãƒˆã‚’å›é¿ã™ã‚‹æ–¹æ³•</a></li>
<li><a href="../ja498428/index.html">WAL-Gï¼šæ–°æ©Ÿèƒ½ã¨ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®æ‹¡å¼µã€‚ã‚¸ãƒ§ãƒ¼ã‚¸ãƒ¼ãƒ»ãƒªãƒ­ãƒ•</a></li>
<li><a href="../ja498430/index.html">4æœˆ22æ—¥ã«è¼¸é€ã¯ã©ã†ãªã‚Šã¾ã™ã‹</a></li>
<li><a href="../ja498438/index.html">ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ã‚·ãƒƒãƒ—ãƒ¡ãƒ³ã‚¿ãƒ¼ã®ãŸã‚ã®8ã¤ã®ç°¡å˜ãªè³ªå•</a></li>
<li><a href="../ja498440/index.html">è„…å¨ã‚¹ãƒãƒƒãƒˆãƒ©ã‚¤ãƒˆï¼šNeshta File Virus</a></li>
<li><a href="../ja498442/index.html">Polyspaceè£½å“ã‚’ä½¿ç”¨ã—ãŸåŒ…æ‹¬çš„ãªé™çš„è§£æ</a></li>
<li><a href="../ja498444/index.html">ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼ã§ã®ç›£è¦–ï¼šå¤ã„BMSã‚’æ–°ã—ã„BMSã«ã©ã®ã‚ˆã†ã«å¤‰æ›´ã—ãŸã‹ã€‚ãƒ‘ãƒ¼ãƒˆ2</a></li>
<li><a href="../ja498446/index.html">ä»•äº‹ã®è³ªå•ï¼šæ¶ç©ºã®å®‰å®šæ€§ã€è™šå½ã®çŒ®èº«ã¨ãƒã‚¸ã‚·ãƒ§ãƒ‹ãƒ³ã‚°</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>