<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😃 🚾 🐎 Ubuntu 18.04と透過Squidに基づく学校でのコンテンツフィルタリング。MikroTikのネットワークへの統合だけでなく、 🛀🏽 💆🏼 👨🏼‍🎤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1.はじめに
 学校でのコンテンツフィルタリングのトピックはかなりハッキングされており、その情報でいっぱいですが、多くのサイトが安全なHTTPSプロトコルに移行したため、提案されたソリューションのほとんどが機能しないため、すでにかなり古くなっています。したがって、私はAからZまでの最も完全な記事を書...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Ubuntu 18.04と透過Squidに基づく学校でのコンテンツフィルタリング。MikroTikのネットワークへの統合だけでなく、</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473584/"><img src="https://habrastorage.org/webt/sl/bc/ta/slbctarcmoniq1q3aotimy8oiv8.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.はじめに</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
学校でのコンテンツフィルタリングのトピックはかなりハッキングされており、その情報でいっぱいですが、多くのサイトが安全なHTTPSプロトコルに移行したため、提案されたソリューションのほとんどが機能しないため、すでにかなり古くなっています。</font><font style="vertical-align: inherit;">したがって、私はAからZまでの最も完全な記事を書いて、Googleの拡張で見つけたすべての情報をまとめることに決めました。</font><font style="vertical-align: inherit;">記事は、管理の分野での基本的な知識のために設計されており、コンピュータサイエンスの教師に適しています。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.参照条件</font></font></h3><br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前提</font><b><font style="vertical-align: inherit;">：</font></b><font style="vertical-align: inherit;"> 436-FZ、および多くのコンピューターがネットワーク化され、MikroTikルーターまたはその他のルーターを介してインターネットに接続されている学校。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目的：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">愛する人や学校の管理者を除くすべての人を対象に、ホワイトリストでHTTPおよびHTTPSのコンテンツフィルタリングを行う。</font></font><br>
<a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.問題の解決策</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デュアルコアIntel ohm、1 GBのRAM、ハード80 GBの未使用のデスクトップコンピューターが見つかりました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを解決するには、次のようにします。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux Ubuntu Server 18.04 LTSがインストールされている</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">透過プロキシSquidはサーバーにインストールおよび設定され、HTTPSをサポートするソースコードからアセンブルされます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リクエストをプロキシまたは代替オプションにリダイレクトすることによる、サーバーのサブネットへの統合（最後に）</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
始めましょう。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1。</font><font style="vertical-align: inherit;">Ubuntu 18.04をインストールして構成する</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インストールプロセスは簡単です。</font><font style="vertical-align: inherit;">Ubuntu Server 18.04のディストリビューションを公式サイトからダウンロードしてください。</font><font style="vertical-align: inherit;">新しいインストーラーは個人的にはインストール中に無限にダウンロードされるため、古いインストーラーでダウンロードすることをお勧めします。</font><font style="vertical-align: inherit;">USBフラッシュドライブ/ディスクに任意の便利な方法でイメージを書き込みます。</font><font style="vertical-align: inherit;">USBフラッシュドライブでの記録には、Rufusを使用することをお勧めします。記録の最初に、[DD画像の記録]を選択します。</font><font style="vertical-align: inherit;">次に、画面の情報に従ってシステムをインストールします。</font><font style="vertical-align: inherit;">OpenSSHをすぐに選択できるコンポーネントの選択についてのみ説明します。</font><font style="vertical-align: inherit;">多くは必要ありませんが、必要なものをインストールする必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、Ubuntuがインストールされます。</font><font style="vertical-align: inherit;">DHCPがある場合、ネットワークはすでに構成されています。</font><font style="vertical-align: inherit;">コマンドにsudoを追加しないように、スーパーユーザーモードに入ります。</font></font><br>
<br>
<pre><code class="javascript hljs">sudo -s</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パスワードを入力してシス​​テムを更新します。</font></font><br>
<br>
<pre><code class="javascript hljs">apt-get update<font></font>
apt-get upgrade</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テキストエディタとファイルマネージャをインストールします。</font></font><br>
<br>
<pre><code class="javascript hljs">apt-get install nano mc</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
でファイルを保存するには</font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ナノを</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、あなたは押す必要があります</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ctrlキー+ O</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、次に続く</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ctrl + Xを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">押してエディターから出力し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">あなたは押すことで出力に直接ファイルを保存することができます</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はCtrl + Xを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、次に続く</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイルマネージャを開くには、</font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mc</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と入力します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">典型的なNortonCommander DOSまたはWindows TotalCommander / FARが2つのパネルで開きます。</font><font style="vertical-align: inherit;">私はコンソールの操作に慣れていますが、ファイルマネージャーは、たとえば、目的のファイルをより速く見つけるのにも役立ちます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DHCPがない場合、またはサーバーに別のIPアドレスが必要な場合は、必要に応じて構成に進みます。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">静的IPアドレスの構成</font></font></b><div class="spoiler_text">     Ubuntu,   18.04         <i>/etc/network/interfaces</i>,   netplan   <i><b>/etc/netplan/*.yaml</b></i>.     ,    .   /etc/network/interfaces   : <br>
<br>
<img src="https://habrastorage.org/webt/ye/m5/xr/yem5xrromrmumjbg5gcjyb_qkte.jpeg"><br>
<br>
,         18.04,    ,   . Netplan      18.04.<br>
<br>
, -,   .<br>
<br>
     ,  ,   .<br>
<br>
<pre><code class="javascript hljs">ifconfig</code></pre><br>
    .<br>
<br>
<pre><code class="javascript hljs">nano /etc/netplan<span class="hljs-comment">/*.yaml</span></code></pre><br>
      DHCP.     .<br>
<br>
<pre><code class="javascript hljs"># This file describes the network interfaces available on your system<font></font>
# For more information, see netplan(<span class="hljs-number">5</span>).<font></font>
network:<font></font>
  version: <span class="hljs-number">2</span>
  <span class="hljs-attr">renderer</span>: networkd
  <span class="hljs-attr">ethernets</span>:<font></font>
      :<font></font>
      dhcp4: no<font></font>
      <span class="hljs-attr">dhcp6</span>: no
      <span class="hljs-attr">addresses</span>: [/<span class="hljs-number">24</span>]
      <span class="hljs-attr">gateway4</span>: 
      <span class="hljs-attr">nameservers</span>:<font></font>
        addresses: [<span class="hljs-number">77.88</span><span class="hljs-number">.8</span><span class="hljs-number">.7</span>, <span class="hljs-number">77.88</span><span class="hljs-number">.8</span><span class="hljs-number">.3</span>]
</code></pre><br>
  ,   . DNS    — .DNS     .   DNS     .   ,    DNS,   .<br>
<br>
      ( ,   ). ,  ,     .  ,   nameservers  addresses   ,     , ,    , netplan  .<br>
<br>
 .<br>
<br>
<pre><code class="javascript hljs">netplan apply</code></pre><br>
 ,   . <br>
<br>
<pre><code class="javascript hljs">reboot</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、ネットプランが適さない場合は、DHCPと静的IPの両方に代替のネットワーク構成オプションを追加しました。</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">別のネットワーク設定</font></font></b><div class="spoiler_text"> Ubuntu 18.04         <i>/etc/network/interfaces</i>.      ,     <i>ifupdown</i>.  :<br>
<pre><code class="javascript hljs">apt-get install ifupdown</code></pre><br>
      netplan<br>
<pre><code class="javascript hljs">nano /etc/netplan<span class="hljs-comment">/*.yaml</span></code></pre><br>
    ,    .<br>
    <br>
<pre><code class="javascript hljs">nano /etc/network/interfaces</code></pre><br>
   : <br>
  IP-<br>
<pre><code class="javascript hljs">auto ___<font></font>
        iface ___ inet <span class="hljs-keyword">static</span><font></font>
        address IP-<font></font>
        netmask <font></font>
        gateway <font></font>
        dns-nameservers <span class="hljs-number">77.88</span><span class="hljs-number">.8</span><span class="hljs-number">.7</span> <span class="hljs-number">77.88</span><span class="hljs-number">.8</span><span class="hljs-number">.3</span></code></pre><br>
  (DHCP)<br>
<pre><code class="javascript hljs">auto ___<font></font>
    iface ___ inet dhcp</code></pre><br>
 <br>
<pre><code class="javascript hljs">reboot</code></pre><br>
     ,  ,   Firewall,     Webmin       (   Webmin   ) <br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、パケットがサーバーを通過できるようにする必要があります。</font><i><font style="vertical-align: inherit;">/etc/sysctl.conf</font></i><font style="vertical-align: inherit;">ファイルを開きます</font></font><i><font style="vertical-align: inherit;"></font></i><br>
<pre><code class="javascript hljs">nano /etc/sysctl.conf</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
文字列</font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">net.ipv4.ip_forward = 1</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><i><b><font style="vertical-align: inherit;">探し</font></b></i><font style="vertical-align: inherit;">、コメントを外します。</font><font style="vertical-align: inherit;">値が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1に</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変更し</font><font style="vertical-align: inherit;">ます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コマンドを入力して設定を適用します</font></font><br>
<pre><code class="javascript hljs">sysctl -p /etc/sysctl.conf</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ネットワークをセットアップした後、直接ターミナルに行き、そこで作業を続けることをお勧めします。</font><font style="vertical-align: inherit;">これを行うには、インストール段階でOpenSSHを選択しなかった場合、それをインストールします。</font></font><br>
<br>
<pre><code class="javascript hljs">apt-get install ssh</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デフォルトでは、SSHはポート22でのユーザー/パスワードのログイン用にすでに構成されていますが、外部の攻撃からサーバーを保護するために、たとえば認証キーや別のポートを使用して自分用に構成できます。</font><font style="vertical-align: inherit;">これを行う方法は、インターネット上の情報でいっぱいです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
端末として、XShellを使用します。</font><font style="vertical-align: inherit;">一番好きなものを使えます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ルーター自体を使用してユーザーのリクエストをプロキシにリダイレクトするため、DHCPサーバーと2番目のネットワークカードは必要ありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
基礎が築かれました。</font><font style="vertical-align: inherit;">それでは、Squidのインストールと構成に移りましょう。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2。</font><font style="vertical-align: inherit;">HTTPSサポートとリストフィルタリングを使用したSquidのインストールと構成</font></font></h4><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2.1。</font><font style="vertical-align: inherit;">Squidのビルドとインストール</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
リポジトリにはSSLをサポートする既製のSquidパッケージがないため、ソースから手動でアセンブルする必要があります。</font><font style="vertical-align: inherit;">まず、リポジトリでファイルを開きます。</font></font><br>
<br>
<pre><code class="javascript hljs">nano /etc/apt/sources.list</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その中で、</font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deb-srcで</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">始まる行のコメントを外します（最初の＃を削除します）</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、パッケージを更新します。</font></font><br>
<br>
<pre><code class="javascript hljs">apt-get update</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、アセンブリツールをインストールします。</font></font><br>
<br>
<pre><code class="javascript hljs">apt-get install fakeroot build-essential devscripts</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、アセンブリに必要なすべてのパッケージを追加します。</font></font><br>
<br>
<pre><code class="javascript hljs">apt-get build-dep squid3</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SSLサポート用のライブラリをインストールします。</font></font><br>
<br>
<pre><code class="javascript hljs">apt-get install libssl1<span class="hljs-number">.0</span>-dev</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ホームフォルダーに移動して、アセンブリ用のフォルダーを作成し、すぐにそれに必要な権限を設定します。</font></font><br>
<br>
<pre><code class="javascript hljs">cd ~<font></font>
mkdir build<font></font>
chown _apt:root build</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
作成したフォルダーに移動し、Squidソースをダウンロードします。</font></font><br>
<br>
<pre><code class="javascript hljs">cd build<font></font>
apt-get source squid3</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビルドフォルダーに、squid3という名前とリリース番号が付いたフォルダーが表示されます。</font><font style="vertical-align: inherit;">Ubuntu 18.04.3では3.5.27です。</font><font style="vertical-align: inherit;">中に入りましょう。</font></font><br>
<br>
<pre><code class="javascript hljs">cd squid3<span class="hljs-number">-3.5</span><span class="hljs-number">.27</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
組み立てる前に、オプションを指定する必要があります。</font><font style="vertical-align: inherit;">それらのファイルを開きます。</font></font><br>
<br>
<pre><code class="javascript hljs">nano debian/rules</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
写真のように、オプションのリストを探してい</font></font><br>
<br>
<img src="https://habrastorage.org/webt/w3/1a/xn/w31axng0b2nuqhjipuqc84sey78.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ます。次のオプション</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">追加します。</font></font><br>
<br>
<pre><code class="javascript hljs">--enable-ssl \<font></font>
--enable-ssl-crtd \<font></font>
--<span class="hljs-keyword">with</span>-openssl</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
オプションはすでに画像に追加されており</font><b><font style="vertical-align: inherit;">、最後の</font></b><font style="vertical-align: inherit;">オプション</font><b><font style="vertical-align: inherit;">を除く</font></b><font style="vertical-align: inherit;">オプションの各行の後に</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「\」</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文字</font><font style="vertical-align: inherit;">が表示</font><font style="vertical-align: inherit;">されることに注意してください</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">
これで、すべてを組み立てることができます。</font><font style="vertical-align: inherit;">次に、Squidソースフォルダーに移りましょう。既に入っているはずです。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="javascript hljs">cd ~<span class="hljs-regexp">/build/</span>squid3<span class="hljs-number">-3.5</span><span class="hljs-number">.27</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、ビルドするコマンドを入力します。</font></font><br>
<br>
<pre><code class="javascript hljs">debuild -d</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
組み立てには非常に長い時間がかかります。平均2〜4時間かかりました。</font><font style="vertical-align: inherit;">コンピュータの速度に依存します。</font><font style="vertical-align: inherit;">アセンブリの最後に、パッケージ署名エラーが表示されます。</font><font style="vertical-align: inherit;">これは正常です-エラーを無視してください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、Buildフォルダーに移動します。</font></font><br>
<br>
<pre><code class="javascript hljs">cd ~/build</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Squidをインストールします。</font></font><br>
<br>
<pre><code class="javascript hljs">dpkg -i squid*.deb</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
満たされていない依存関係に関するエラーにすぐに遭遇し、コマンドを入力します</font></font><br>
<br>
<pre><code class="javascript hljs">apt-get install -f</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インストール後、システムの更新後にパッケージが上書きされないように、パッケージにマークを付けます。</font></font><br>
<br>
<pre><code class="javascript hljs">apt-mark hold squid<font></font>
apt-mark hold squid-common<font></font>
apt-mark hold squidclient</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2.2。</font><font style="vertical-align: inherit;">Squidの構成とフィルタリング</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
これで、Squidがインストールされ、必要に応じて構成することができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべての設定は</font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/squid/squid.conf</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルにあります</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">多くのコメントが含まれており、一見すると非常に複雑に見えますが、実際にはそれほど複雑なものはありません。</font><font style="vertical-align: inherit;">まず、突然詳細を調べたい場合は、最初にオリジナルをコピーしてコメントから削除します。</font><font style="vertical-align: inherit;">便宜上、Squidのあるフォルダーに直接移動します。</font></font><br>
<br>
<pre><code class="javascript hljs">cd /etc/squid<font></font>
cp squid.conf squid.conf.backup<font></font>
cat squid.conf.backup | egrep <span class="hljs-string">"^[^#]"</span> &gt; squid.conf</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
squid.confを開きます</font></font><br>
<br>
<pre><code class="javascript hljs">nano squid.conf</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のように、彼はコメントを削除し、見た目ほどかさばることはなくなりました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スポイラーの下で、問題なく機能する設定でファイルを投稿します。以下では、ブロックの内容と方法について説明します。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Squid.conf構成</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs">acl localnet src <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>/<span class="hljs-number">24</span>
acl worktime time <span class="hljs-number">08</span>:<span class="hljs-number">00</span><span class="hljs-number">-15</span>:<span class="hljs-number">00</span>
acl SSL_ports port <span class="hljs-number">443</span>
acl Safe_ports port <span class="hljs-number">80</span>          # http<font></font>
acl Safe_ports port <span class="hljs-number">21</span>          # ftp<font></font>
acl Safe_ports port <span class="hljs-number">443</span>         # https<font></font>
acl Safe_ports port <span class="hljs-number">70</span>          # gopher<font></font>
acl Safe_ports port <span class="hljs-number">210</span>         # wais<font></font>
acl Safe_ports port <span class="hljs-number">1025</span><span class="hljs-number">-65535</span>  # unregistered ports<font></font>
acl Safe_ports port <span class="hljs-number">280</span>         # http-mgmt<font></font>
acl Safe_ports port <span class="hljs-number">488</span>         # gss-http<font></font>
acl Safe_ports port <span class="hljs-number">591</span>         # filemaker<font></font>
acl Safe_ports port <span class="hljs-number">777</span>         # multiling http<font></font>
acl CONNECT method CONNECT<font></font>
<font></font>
acl blacklist url_regex -i <span class="hljs-string">"/etc/squid/blacklist"</span>
acl whitelist url_regex -i <span class="hljs-string">"/etc/squid/whitelist"</span><font></font>
<font></font>
http_access allow localhost<font></font>
http_access deny manager<font></font>
http_access deny !Safe_ports<font></font>
http_access deny CONNECT !SSL_ports<font></font>
http_access allow CONNECT<font></font>
http_access deny blacklist<font></font>
http_access allow whitelist<font></font>
http_access deny all worktime<font></font>
http_access allow all<font></font>
<font></font>
http_port <span class="hljs-number">3128</span>
http_port <span class="hljs-number">3129</span> intercept<font></font>
https_port <span class="hljs-number">3130</span> intercept ssl-bump options=ALL:NO_SSLv3:NO_SSLv2 connection-auth=off cert=<span class="hljs-regexp">/etc/</span>squid/squid.pem<font></font>
always_direct allow all<font></font>
sslproxy_cert_error allow all<font></font>
sslproxy_flags DONT_VERIFY_PEER<font></font>
<font></font>
acl blacklist_ssl ssl::server_name_regex -i <span class="hljs-string">"/etc/squid/blacklist_ssl"</span>
acl whitelist_ssl ssl::server_name_regex -i <span class="hljs-string">"/etc/squid/whitelist_ssl"</span><font></font>
acl step1 at_step SslBump1<font></font>
<font></font>
ssl_bump peek step1<font></font>
ssl_bump terminate blacklist_ssl<font></font>
ssl_bump splice whitelist_ssl<font></font>
ssl_bump terminate all worktime<font></font>
ssl_bump splice all<font></font>
<font></font>
sslcrtd_program /usr/lib/squid/ssl_crtd -s /<span class="hljs-keyword">var</span>/lib/ssl_db -M <span class="hljs-number">4</span>MB<font></font>
<font></font>
#<font></font>
cache_mem <span class="hljs-number">512</span> MB<font></font>
 maximum_object_size_in_memory <span class="hljs-number">512</span> KB<font></font>
 memory_replacement_policy lru<font></font>
cache_dir aufs /<span class="hljs-keyword">var</span>/spool/squid <span class="hljs-number">2048</span> <span class="hljs-number">16</span> <span class="hljs-number">256</span><font></font>
<font></font>
#<font></font>
access_log daemon:<span class="hljs-regexp">/var/</span>log/squid/access.log squid<font></font>
logfile_rotate <span class="hljs-number">1</span><font></font>
<font></font>
coredump_dir /<span class="hljs-keyword">var</span>/spool/squid<font></font>
refresh_pattern ^ftp:           <span class="hljs-number">1440</span>    <span class="hljs-number">20</span>%     <span class="hljs-number">10080</span>
refresh_pattern ^gopher:        <span class="hljs-number">1440</span>    <span class="hljs-number">0</span>%      <span class="hljs-number">1440</span>
refresh_pattern -i (<span class="hljs-regexp">/cgi-bin/</span>|\?) <span class="hljs-number">0</span>     <span class="hljs-number">0</span>%      <span class="hljs-number">0</span>
refresh_pattern (Release|Packages(.gz)*)$      <span class="hljs-number">0</span>       <span class="hljs-number">20</span>%     <span class="hljs-number">2880</span>
refresh_pattern .               <span class="hljs-number">0</span>       <span class="hljs-number">20</span>%     <span class="hljs-number">4320</span></code></pre><br>
</div></div><br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初のブロックは</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次のとおりです。</font></font><br>
<br>
<pre><code class="javascript hljs">acl localnet src <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>/<span class="hljs-number">24</span>
acl worktime time <span class="hljs-number">08</span>:<span class="hljs-number">00</span><span class="hljs-number">-15</span>:<span class="hljs-number">00</span>
acl SSL_ports port <span class="hljs-number">443</span>
acl Safe_ports port <span class="hljs-number">80</span>          # http<font></font>
acl Safe_ports port <span class="hljs-number">21</span>          # ftp<font></font>
acl Safe_ports port <span class="hljs-number">443</span>         # https<font></font>
acl Safe_ports port <span class="hljs-number">70</span>          # gopher<font></font>
acl Safe_ports port <span class="hljs-number">210</span>         # wais<font></font>
acl Safe_ports port <span class="hljs-number">1025</span><span class="hljs-number">-65535</span>  # unregistered ports<font></font>
acl Safe_ports port <span class="hljs-number">280</span>         # http-mgmt<font></font>
acl Safe_ports port <span class="hljs-number">488</span>         # gss-http<font></font>
acl Safe_ports port <span class="hljs-number">591</span>         # filemaker<font></font>
acl Safe_ports port <span class="hljs-number">777</span>         # multiling http<font></font>
acl CONNECT method CONNECT</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼は標準ACLパラメータを担当しています。</font><font style="vertical-align: inherit;">その中で、localnetでローカルネットワークを自分のネットワークに変更し、稼働時間のaclを追加します（オプション）。</font><font style="vertical-align: inherit;">何も見つからない、すべてにアクセスできないという不平を言う教師がよく来るので、私は労働時間を追加しました。</font><font style="vertical-align: inherit;">もちろん、すべてが正常に機能してうれしいですが、率直に言って、これを聞くのはうんざりです。</font><font style="vertical-align: inherit;">今、私は彼らが15時以降にフィルタリングがオフになり、彼らが必要とする情報を（ほぼ）自由に見つけることができるという彼らの主張を報告しています。</font><font style="vertical-align: inherit;">時間を追加することも、このACLを追加せずに24時間フィルターを残すこともできます。</font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2番目のブロック</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、HTTPの許可サイトと禁止サイトのリストを定義し、次のようになります。</font></font><br>
<br>
<pre><code class="javascript hljs">acl blacklist url_regex -i <span class="hljs-string">"/etc/squid/blacklist"</span>
acl whitelist url_regex -i <span class="hljs-string">"/etc/squid/whitelist"</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
許可サイトと禁止サイトのリストを後で追加し、それらはaclで指定されたファイルに配置されます。</font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3番目のブロック</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、HTTP経由のアクセスパラメータを決定し、次のようになります。</font></font><br>
<br>
<pre><code class="javascript hljs">http_access allow localhost<font></font>
http_access deny manager<font></font>
http_access deny !Safe_ports<font></font>
http_access deny CONNECT !SSL_ports<font></font>
http_access allow CONNECT<font></font>
http_access deny blacklist<font></font>
http_access allow whitelist<font></font>
http_access deny all worktime<font></font>
http_access allow all</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http_access allow CONNECTが</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要です。これがないと、Squidはインターネット上の誰にも許可を与えません。次は、ブラックリストとホワイトリストのルールです。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deny</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメータ</font><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">allow</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメータ</font><i><font style="vertical-align: inherit;">は</font></i><font style="vertical-align: inherit;">、それぞれアクセスの</font><i><font style="vertical-align: inherit;">拒否</font></i><font style="vertical-align: inherit;">と</font><i><font style="vertical-align: inherit;">許可を行い</font></i><font style="vertical-align: inherit;">ます。その後、営業時間中にすべてのHTTPトラフィックを完全に禁止するというルールが適用されます。あなたは労働時間、その後、削除設定されていない場合は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">worktimeを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、そして禁止は恒久的になります。 Squidがルールを上から下に読み取るため、重要な点はルールの順序です</font></font><br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4番目のブロック</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はSquidのポートパラメーターを定義します。</font></font><br>
<br>
<pre><code class="javascript hljs">
http_port <span class="hljs-number">3128</span>
http_port <span class="hljs-number">3129</span> intercept<font></font>
https_port <span class="hljs-number">3130</span> intercept ssl-bump options=ALL:NO_SSLv3:NO_SSLv2 connection-auth=off cert=<span class="hljs-regexp">/etc/</span>squid/squid.pem</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初のパラメータは、「ERROR：No forward-proxy ports configured」エラーがログに無限に表示されないようにするために必要です。ログ、つまりメモリがいっぱいになります。よくある間違いですが、何らかの理由で、私たちのru-segmentでそれを修正する方法が見つかりませんでした。外国のフォーラムが役に立ちました。 2番目のパラメーターは、HTTPプロトコルポートを定義します。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インターセプトと</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、プロキシの透過性を意味します。つまり、各コンピューターで設定を規定する必要はありません。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3番目のパラメーターは、HTTPSポートとそのオプションを定義します。これは1つの長い行です。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">squid.pem</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイル</font><font style="vertical-align: inherit;">は、後で作成する証明書です。</font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5番目のブロック</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SquidとのSSL接続のパラメータを定義します。</font><font style="vertical-align: inherit;">特に、より高いキャッシュを使用せずにすべてのトラフィックをすぐにインターネットに転送する必要があり、最後の2つは証明書の検証エラーがあっても接続を許可することを示しています。</font><font style="vertical-align: inherit;">そのように見えます。</font></font><br>
<br>
<pre><code class="javascript hljs">always_direct allow all<font></font>
sslproxy_cert_error allow all<font></font>
sslproxy_flags DONT_VERIFY_PEER</code></pre><br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6番目のブロック</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、「ブラック」リストと「ホワイト」リストのACLパラメータを設定します。これらは、HTTPSトラフィックのインターセプトの深さだけでなく、後で作成されます。</font></font><br>
<br>
<pre><code class="javascript hljs">acl blacklist_ssl ssl::server_name_regex -i <span class="hljs-string">"/etc/squid/blacklist_ssl"</span>
acl whitelist_ssl ssl::server_name_regex -i <span class="hljs-string">"/etc/squid/whitelist_ssl"</span>
acl step1 at_step SslBump1</code></pre><br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7番目のブロック</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、HTTPSプロトコルを使用してアクセスパラメータを決定します。</font><font style="vertical-align: inherit;">ここで、禁止と許可はすでに</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">終了</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スプライスの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それぞれの</font><font style="vertical-align: inherit;">責任があり</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ここでも、削除することを忘れないでください</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> worktimeを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用すると、指定された作業時間を持っていない場合。</font></font><br>
<br>
<pre><code class="javascript hljs">ssl_bump peek step1<font></font>
ssl_bump terminate blacklist_ssl<font></font>
ssl_bump splice whitelist_ssl<font></font>
ssl_bump terminate all worktime<font></font>
ssl_bump splice all<font></font>
<font></font>
sslcrtd_program /usr/lib/squid/ssl_crtd -s /<span class="hljs-keyword">var</span>/lib/ssl_db -M <span class="hljs-number">4</span>MB
</code></pre><br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8番目のブロック</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、Squidのキャッシュとログを設定します。</font><font style="vertical-align: inherit;">ここでは</font><font style="vertical-align: inherit;">、ログが保存される日数を示す</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> logfile_rotate</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメータのみに注目する価値</font><font style="vertical-align: inherit;">があります。</font></font><br>
<br>
<pre><code class="javascript hljs">#<font></font>
cache_mem <span class="hljs-number">512</span> MB<font></font>
 maximum_object_size_in_memory <span class="hljs-number">512</span> KB<font></font>
 memory_replacement_policy lru<font></font>
cache_dir aufs /<span class="hljs-keyword">var</span>/spool/squid <span class="hljs-number">2048</span> <span class="hljs-number">16</span> <span class="hljs-number">256</span><font></font>
<font></font>
#<font></font>
access_log daemon:<span class="hljs-regexp">/var/</span>log/squid/access.log squid<font></font>
logfile_rotate <span class="hljs-number">1</span><font></font>
<font></font>
coredump_dir /<span class="hljs-keyword">var</span>/spool/squid<font></font>
refresh_pattern ^ftp:           <span class="hljs-number">1440</span>    <span class="hljs-number">20</span>%     <span class="hljs-number">10080</span>
refresh_pattern ^gopher:        <span class="hljs-number">1440</span>    <span class="hljs-number">0</span>%      <span class="hljs-number">1440</span>
refresh_pattern -i (<span class="hljs-regexp">/cgi-bin/</span>|\?) <span class="hljs-number">0</span>     <span class="hljs-number">0</span>%      <span class="hljs-number">0</span>
refresh_pattern (Release|Packages(.gz)*)$      <span class="hljs-number">0</span>       <span class="hljs-number">20</span>%     <span class="hljs-number">2880</span>
refresh_pattern .               <span class="hljs-number">0</span>       <span class="hljs-number">20</span>%     <span class="hljs-number">4320</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これでsquid.confの設定が完了しました。</font><font style="vertical-align: inherit;">ファイルを保存し、証明書とリストの作成に進みます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Squidのあるフォルダーに移動しましょう</font></font><br>
<br>
<pre><code class="javascript hljs">cd /etc/squid/</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のコマンドを入力して証明書を作成します</font></font><br>
<br>
<pre><code class="javascript hljs">openssl req -<span class="hljs-keyword">new</span> -newkey rsa:<span class="hljs-number">1024</span> -days <span class="hljs-number">36500</span> -nodes -x509 -keyout squid.pem -out squid.pem</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、証明書データを入力する必要があります。</font><font style="vertical-align: inherit;">証明書は100年間有効で、長い間忘れられます。</font><font style="vertical-align: inherit;">プロキシにのみ必要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、リストファイルを作成します。</font></font><br>
<br>
<pre><code class="javascript hljs">touch blacklist<font></font>
touch whitelist<font></font>
cp whitelist whitelist_ssl<font></font>
cp blacklist blacklist_ssl</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サイトは正規表現の形式でリストされます。</font><font style="vertical-align: inherit;">たとえば、mail.ruのロックを解除するには、</font><i><font style="vertical-align: inherit;">ホワイトリストを</font></i><font style="vertical-align: inherit;">開き</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></i> <br>
<br>
<pre><code class="javascript hljs">nano whitelist</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の式をそれに追加します。</font></font><br>
<br>
<pre><code class="javascript hljs">mail\.ru </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、Games.Mail.ruをブロックします。</font><i><font style="vertical-align: inherit;">ブラックリストを</font></i><font style="vertical-align: inherit;">開きましょう</font></font><i><font style="vertical-align: inherit;"></font></i><br>
<br>
<pre><code class="javascript hljs">nano blacklist</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それに次の式を書きます</font></font><br>
<br>
<pre><code class="javascript hljs">games\.mail\.ru</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
原則として、ブラックリストブロッカーはホワイトリストの上にあるため、mail.ruに切り替えると、サイトは期待どおりに開きます（写真は除きますが、後で詳しく説明します）。ゲームに切り替えようとすると、Squidにアクセスできます手放しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一部のサイトには、多くのサブドメイン、サブドメインなどがあります。</font><font style="vertical-align: inherit;">たとえば、mail.ruの画像はimgsmail.ruに保存されます。</font><font style="vertical-align: inherit;">他の同様のサイトについては、任意のブラウザー（私はChromeを使用しています）で目的のサイトを開き、続いて開発者ツール（ChromeではF12を押すと呼び出されます）を開く必要があります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ie/43/a7/ie43a7r-zkjhouxldavryxg0kjg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[ソース]タブに移動して、サイトが情報を読み込む他のリソースを確認します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サイトを追加したら、それらをHTTPSのリストにコピーします。</font></font><br>
<br>
<pre><code class="javascript hljs">cp whitelist whitelist_ssl<font></font>
cp blacklist blacklist_ssl</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リストの塗りつぶしのヒント</font></font></b><div class="spoiler_text">      ,        ,   . ,     -   - (\.)    -   (www, http,  "/"  ).    ,  ,      .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、構成を確認します。</font></font><br>
<br>
<pre><code class="javascript hljs">squid -k check</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてうまくいったら、Squidを停止します。</font></font><br>
<br>
<pre><code class="javascript hljs">/etc/init.d/squid stop</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
キャッシュを再構築する</font></font><br>
<br>
<pre><code class="javascript hljs">squid -z</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もう一度Squidを実行します</font></font><br>
<br>
<pre><code class="javascript hljs">/etc/init.d/squid start</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リストまたはSquid構成を変更した後、次のコマンドで再ロードする必要があります</font></font><br>
<br>
<pre><code class="javascript hljs">/etc/init.d/squid restart</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パス</font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ usr / share / squid / errors /〜Russian-1251の</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下のアクセス制限ページ（HTTPでのみ機能）を変更することもできます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">フォルダーで</font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ERR_ACCESS_DENIED</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルを</font><i><b><font style="vertical-align: inherit;">探し</font></b></i><font style="vertical-align: inherit;">、編集します。</font><font style="vertical-align: inherit;">ファイルの構文はHTMLです。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.3。</font><font style="vertical-align: inherit;">サーバーの状態の監視とファイアウォールの構成</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サーバーのステータスを監視するには</font><font style="vertical-align: inherit;">、ファイアウォールを構成</font><font style="vertical-align: inherit;">する</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Webmin</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーティリティをインストールし</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">また、CPU、RAMなどのステータスの監視、パッケージの更新、コンポーネントの追加と設定などを行うことができます。</font><font style="vertical-align: inherit;">それはそれ自身のターミナルを持っていますが、不器用です。</font><font style="vertical-align: inherit;">このユーティリティはどのブラウザからでも機能するため、ネットワーク上のどのコンピュータからでもサーバーに接続できます。安全ではありませんが、十分便利です。</font><font style="vertical-align: inherit;">必要に応じて、接続をWebmin自体の「IPアクセス制御」で個々のIPアドレスのみに制限できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インストールを開始する前に、Webminリポジトリを追加します。</font><font style="vertical-align: inherit;">sources.listを開きます。</font></font><br>
<br>
<pre><code class="javascript hljs">nano /etc/apt/sources.list</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下の行を追加します。</font></font><br>
<br>
<pre><code class="javascript hljs">deb http:<span class="hljs-comment">//download.webmin.com/download/repository sarge contrib</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、パッケージの署名に使用するGPGキーをWebminリポジトリにインストールします。</font></font><br>
<br>
<pre><code class="javascript hljs">cd /root<font></font>
wget http:<span class="hljs-comment">//www.webmin.com/jcameron-key.asc</span>
apt-key add jcameron-key.asc</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、パッケージのリストを更新し、ユーティリティをインストールします</font></font><br>
<br>
<pre><code class="javascript hljs">apt-get update<font></font>
apt-get install webmin</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アドレスバーを入力すると、任意のブラウザでサーバーに接続できます</font></font><br>
<br>
<pre><code class="javascript hljs">IP__:<span class="hljs-number">10000</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デフォルトでは、WebminはSSL経由で接続し、ほとんどのブラウザーは信頼できない証明書エラーを出します。</font><font style="vertical-align: inherit;">毎回信頼を選択しないようにするには、SSLを無効にします。</font><font style="vertical-align: inherit;">これを行うには、ファイル</font><i><font style="vertical-align: inherit;">/etc/webmin/miniserv.confを</font></i><font style="vertical-align: inherit;">開きます</font></font><i><font style="vertical-align: inherit;"></font></i><br>
<br>
<pre><code class="javascript hljs">nano /etc/webmin/miniserv.conf</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その中で文字列</font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssl = 1</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を見つけ、</font><font style="vertical-align: inherit;">それを</font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssl = 0に</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">置き換え</font><i><b><font style="vertical-align: inherit;">ます</font></b></i><font style="vertical-align: inherit;">。同じファイルで、接続ポートを変更できます。デフォルトでは10000です。空いているものはどれでもかまいません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Webminに接続し</font><font style="vertical-align: inherit;">たら、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Webmin-&gt; Webmin Configuration</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に移動し</font><font style="vertical-align: inherit;">、言語をロシア語に切り替えます。次に、[ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネットワーク]-&gt; [ファイアウォール]に移動し</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。デフォルトでは、ファイアウォールはクリーンです。一番下に移動し、反対側の</font><font style="vertical-align: inherit;">[ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">起動時に有効にする]を</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">選択して[ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はい]を</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">選択</font><i><font style="vertical-align: inherit;">します</font></i><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「構成の適用」を</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クリックし</font><font style="vertical-align: inherit;">ます。これで、ファイアウォールの設定が</font><i><b><font style="vertical-align: inherit;">/etc/webmin/firewall/iptables.save</font></b></i><font style="vertical-align: inherit;">ファイルで指定されました</font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">システムで実行します。</font><font style="vertical-align: inherit;">そのようなファイルがない場合は、Webminの[ファイアウォール]タブの[ルール付きのファイル]行に何が書き込まれているかを確認してください。</font><font style="vertical-align: inherit;">ターミナルで開きましょう。</font></font><br>
<br>
<pre><code class="javascript hljs">nano /etc/webmin/firewall/iptables.save</code></pre><br><font style="vertical-align: inherit;"></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* nat</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ブロック</font><font style="vertical-align: inherit;">に移動し、最後に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COMMITの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前</font><font style="vertical-align: inherit;">に次のルールを追加します。</font></font><br>
<br>
<pre><code class="javascript hljs">-A PREROUTING -p tcp -m tcp -i _ --dport <span class="hljs-number">80</span> -j DNAT --to-destination ip_:<span class="hljs-number">3129</span>
-A PREROUTING -p tcp -m tcp -i _ --dport <span class="hljs-number">443</span> -j REDIRECT --to-ports <span class="hljs-number">3130</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのルールは、サーバーのポート80（HTTP）および443（HTTPS）に向かうトラフィックをSquidポートに転送します。</font><font style="vertical-align: inherit;">ここでは、DNATとREDIRECTを使用した2つのルールのバリエーションを紹介しました。</font><font style="vertical-align: inherit;">両方を使用するか、適切なポートを配置して1つのオプションを選択できます。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイアウォールの代替ネットワーク設定を構成する</font></font></b><div class="spoiler_text">  ,       .<br>
        Firewall      .<br>
<pre><code class="javascript hljs">touch /etc/nat<font></font>
chmod +x /etc/nat</code></pre><br>
 <br>
<pre><code class="javascript hljs">nano /etc/nat</code></pre><br>
   <br>
<pre><code class="javascript hljs"><span class="hljs-meta">#!/bin/sh</span><font></font>
#Firewall<font></font>
iptables -t nat -A PREROUTING -p tcp -m tcp -i _ --dport <span class="hljs-number">80</span> -j DNAT --to-destination ip_:<span class="hljs-number">3129</span>
iptables -t nat -A PREROUTING -p tcp -m tcp -i _ --dport <span class="hljs-number">443</span> -j REDIRECT --to-ports <span class="hljs-number">3130</span></code></pre><br>
     Webmin,       DNAT  REDIRECT.    ,    ,   .<br>
         .    <br>
<pre><code class="javascript hljs">nano /etc/network/interfaces</code></pre><br>
     <br>
<pre><code class="javascript hljs">post-up /etc/nat</code></pre><br>
PS:     ,        ,    /etc/nat.  Webmin  .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これでサーバーのセットアップは完了です。</font><font style="vertical-align: inherit;">再起動します。</font></font><br>
<br>
<pre><code class="javascript hljs">reboot</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、MikroTikルーターのセットアップに移りましょう。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4。</font><font style="vertical-align: inherit;">トラフィックをプロキシにリダイレクトするようにMikroTikルーターを構成する</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リモートコントロール用</font><font style="vertical-align: inherit;">
の</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WinBox</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーティリティ</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">既にダウンロードし</font><font style="vertical-align: inherit;">、インターネットとローカルネットワークが構成され、ルーターのファイアウォールがクリーンである</font><font style="vertical-align: inherit;">と想定しています</font><font style="vertical-align: inherit;">。あなたはLANインターフェースの名前を知っています（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IP-DHCPサーバー-DHCPで</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それを見ることができ</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">）。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> WinBoxに移動し、</font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IP-DHCP Server-Leases</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に移動し</font><i><b><font style="vertical-align: inherit;">ます</font></b></i><font style="vertical-align: inherit;">。リストで、フィルタリングが機能しないIPコンピューター（ディレクター、管理）を探し、それらを右クリックして、メニューから[ </font><i><b><font style="vertical-align: inherit;">静的</font></b></i><font style="vertical-align: inherit;">にする]を選択します。</font></font><i><b><font style="vertical-align: inherit;"></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。 「D」の文字がそれらの横に表示されなくなります。これはダイナミックを意味します。これで、これらのアドレスは、リース時間に関係なく、MACアドレスによってこれらのコンピューターにすぐに静的に割り当てられます。ラップトップをWi-Fiとケーブル経由で使用する場合は、両方のMACアドレスに対して[静的にする]を選択する必要があります。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次に、</font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IP-ファイアウォール-アドレスリスト</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に移動し、青色の</font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プラス</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記号</font><i><b><font style="vertical-align: inherit;">「+」</font></b></i><font style="vertical-align: inherit;">をクリックします</font><font style="vertical-align: inherit;">。 [ </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名前]</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールドで、</font><font style="vertical-align: inherit;">フィルタリングされていない</font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">明るい</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アドレスの</font><font style="vertical-align: inherit;">グループの名前を指定します</font><font style="vertical-align: inherit;">（「Admins」など）。 [ </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アドレス]</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールドで</font><font style="vertical-align: inherit;">、静的アドレスが割り当てられているIPアドレスから1つを指定します。これをアドレスごとに繰り返し、矢印の付いた[名前]フィールドでグループを選択します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タブに移動します</font></font><i><b><font style="vertical-align: inherit;"></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同じ</font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> IPファイアウォールで</font></font></b></i><font style="vertical-align: inherit;"><i><b><font style="vertical-align: inherit;">マングル</font></b></i><font style="vertical-align: inherit;">し、</font><font style="vertical-align: inherit;">[</font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> +</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]をクリックします</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">タブ付きウィンドウが開きます。</font><font style="vertical-align: inherit;">[</font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全般</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]タブ</font><font style="vertical-align: inherit;">で、次のフィールドに入力します。</font></font><br>
<br>
<pre><code class="javascript hljs">Chain - Prerouting<font></font>
Src. Address - __proxy<font></font>
Protocol - <span class="hljs-number">6</span> (tcp)<font></font>
Dst. Port - <span class="hljs-number">80</span><font></font>
In. Interface - __<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「</font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アクション」</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タブで</font><font style="vertical-align: inherit;">、値</font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「承認」</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">確認し、</font><i><b><font style="vertical-align: inherit;">「</font></b></i><font style="vertical-align: inherit;"> OK」をクリックします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このプロセスを繰り返しますが、[ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dst]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールドで行います</font><i><font style="vertical-align: inherit;">。</font></i><i><font style="vertical-align: inherit;">ポート</font></i><font style="vertical-align: inherit;">は値を</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">443に</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">設定します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">もう一度</font><font style="vertical-align: inherit;">[+]をクリックし、[ </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全般</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]タブで</font><font style="vertical-align: inherit;">次のフィールドにもう一度入力します。</font></font><br>
<br>
<pre><code class="javascript hljs">Chain - Prerouting<font></font>
Protocol - <span class="hljs-number">6</span> (tcp)<font></font>
Dst. Port - <span class="hljs-number">80</span>
In. Interface - __</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[ </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">詳細設定</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]タブに移動し、[ </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">送信元</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ] </font><font style="vertical-align: inherit;">フィールドに移動します</font><i><b><font style="vertical-align: inherit;">。</font></b></i><i><b><font style="vertical-align: inherit;">アドレス一覧</font></b></i><font style="vertical-align: inherit;">から「</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理者</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」の</font><font style="vertical-align: inherit;">管理アドレス</font><i><b><font style="vertical-align: inherit;">一覧を</font></b></i><font style="vertical-align: inherit;">選択します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">リストの横に表示されるボックスをクリックしてください。</font><font style="vertical-align: inherit;">感嘆符</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「！」</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、論理NOTまたはNEGATIVEを意味します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「</font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アクション」</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タブに移動して</font><font style="vertical-align: inherit;">、フィールドに入力します。</font></font><br>
<br>
<pre><code class="javascript hljs">Action - mark routing<font></font>
New Routing Mark - to_proxy<font></font>
Passthrough -  </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[OK]をクリックして同じ操作を行いますが、[ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dst]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールドで行います</font><i><font style="vertical-align: inherit;">。</font></i><i><font style="vertical-align: inherit;">ポート</font></i><font style="vertical-align: inherit;">は値</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">443を</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最後に、最後のルールを追加します。</font><font style="vertical-align: inherit;">プラス記号をクリックし、[ </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全般</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]タブの次のフィールドに入力します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="javascript hljs">Chain - Prerouting<font></font>
In. Interface - __<font></font>
Routing Mark - to_proxy</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、パラメーターで次のことが起こります。</font><font style="vertical-align: inherit;">順序は重要です！</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tp/vw/zi/tpvwzizj0x_x4hg5quooe1t8bpo.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に移動</font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IP -ルート</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と「+」をクリックしてください。</font><font style="vertical-align: inherit;">次のフィールドに入力します。</font></font><br>
<br>
<pre><code class="javascript hljs">Dst. Address - <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>/<span class="hljs-number">0</span><font></font>
Gateway - __proxy<font></font>
Routing Mark - to_proxy</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[OK]をクリックすると、それだけです。</font><font style="vertical-align: inherit;">サーバーをオンにすると、すべてのHTTPおよびHTTPSトラフィックがSquidを通過します。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.5。</font><font style="vertical-align: inherit;">MikroTikおよびその他のルーターの代替セットアップ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このオプションは、MikroTikルーターと他のルーターの両方に適していますが、最も単純なもの（自分が何を知っているレンタルプロバイダーの部分を除く）でも適しています。この場合、ルーターではなくSquid自体にインターネットアクセスの共有を実装します。それでは始めましょう。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MikroTikでのプロキシへのリダイレクトの設定を含む、上記のすべての手順を完了することにより、この時点に到達したと想定します。説明されているオプションを円滑に操作するには、</font><font style="vertical-align: inherit;">この記事の</font><font style="vertical-align: inherit;">パラグラフ</font><i><b><font style="vertical-align: inherit;">3.4の</font></b></i><font style="vertical-align: inherit;">サブパラグラフ</font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e）</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をキャンセルする必要があります</font><font style="vertical-align: inherit;">。パラグラフ3.4全体（おそらく、サブパラグラフ</font><i><font style="vertical-align: inherit;">aを</font></i><font style="vertical-align: inherit;">残し</font><font style="vertical-align: inherit;">て、IPが変更されないようにする）をキャンセルできますが、これはオプションです。ルーティング自体をキャンセルすることが重要です。これを行うには、</font><i><b><font style="vertical-align: inherit;">IP-ルートに</font></b></i><font style="vertical-align: inherit;">移動し</font><i><b><font style="vertical-align: inherit;">ます</font></b></i></font><i><b><font style="vertical-align: inherit;"></font></b></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><b><font style="vertical-align: inherit;"></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ルートを探して選択し、</font></font><b><i><font color="#cc0000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">赤い十字</font></font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（プラス記号ではなくチェックマークの横の十字）</font><font style="vertical-align: inherit;">をクリックします</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ルートが灰色に変わります=&gt;無効になります。</font><font style="vertical-align: inherit;">フィルタリングもオフになり、すべてのクライアントがルーターを介して直接インターネットにアクセスするようになりました。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーバーに移動し、Squidのあるフォルダーに移動します</font></font><br>
<pre><code class="javascript hljs">cd /etc/squid/</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
構成ファイルを開く</font></font><br>
<pre><code class="javascript hljs">nano squid.conf</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そしてブロックに追加します：</font><font style="vertical-align: inherit;">acl localnetの行の直後</font></font><br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の最初のブロックで</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ...</font></font><br>
<pre><code class="javascript hljs">acl admins src <span class="hljs-string">"/etc/squid/admins-ip"</span>  # IP  <font></font>
acl students src <span class="hljs-string">"/etc/squid/students-ip"</span>  # IP  </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
他の誰もが教師であると理解されているので、教師のコンピュータのリストは必要ありません。</font><font style="vertical-align: inherit;">ただし、他のブロックの対応するルールを使用して、自分で追加できます。</font></font><br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2番目のブロック</font></font></b></i><br>
<pre><code class="javascript hljs">acl whitelist-stud url_regex -i <span class="hljs-string">"/etc/squid/whitelist-stud"</span>   #     </code></pre><br>
<i><b><font style="vertical-align: inherit;"></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http_access</font><i><b><font style="vertical-align: inherit;">の3番目のブロックで</font></b></i><font style="vertical-align: inherit;">ブラックリストを拒否</font></font><br>
<pre><code class="javascript hljs">http_access allow admins   #     <font></font>
http_access allow students whitelist-stud  #      <font></font>
http_access deny students  #       </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、教師（他のすべてのIP）がフォローし、ホワイトリストと勤務時間中（示された場合）にフィルタリングするため、ブロックは変更されません。</font><font style="vertical-align: inherit;">禁止ルールより上に許可ルールを設定することにより、管理者グループにブラックリストをバイパスさせることも、別のACLに個別のIP（たとえば、独自のIP）を追加して、ブラックリストの上のルールに配置することもできます。</font></font><br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4番目と5番目のブロックは</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変更されていません。</font></font><br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第六のブロックに、</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">追加</font></font><br>
<pre><code class="javascript hljs">acl whitelist-stud_ssl ssl::server_name_regex -i <span class="hljs-string">"/etc/squid/whitelist-stud_ssl"</span></code></pre><br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7番目のブロックで、</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ssl_bumpがblacklist_sslを終了した後</font><i><b><font style="vertical-align: inherit;">に</font></b></i><font style="vertical-align: inherit;">追加します。</font></font><br>
<pre><code class="javascript hljs">ssl_bump splice admins<font></font>
ssl_bump splice students whitelist-stud_ssl<font></font>
ssl_bump terminate students</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
原理は3番目のブロックと同じです。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残りは変わりません。</font><font style="vertical-align: inherit;">保存して終了</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次に、IPアドレスのリストを作成します。</font></font><br>
<pre><code class="javascript hljs">touch admins-ip<font></font>
touch students-ip</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
学生向けのホワイトリスト。 </font></font><br>
<pre><code class="javascript hljs">touch whitelist-stud<font></font>
cp whitelist-stud whitelist-stud_ssl</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
必要なIPアドレスとサイトを適切なリストに追加します。</font><font style="vertical-align: inherit;">生徒のサイトリストでは、生徒が必要としないサイトを削除して、教師用のリストをコピーできます。</font><font style="vertical-align: inherit;">Linuxでのファイルのコピーは、コマンドによって行われます</font></font><br>
<pre><code class="javascript hljs">cp &lt;    &gt; &lt;    &gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Squidを再起動します</font></font><br>
<pre><code class="javascript hljs">/etc/init.d/squid restart</code></pre><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最も重要なこと、つまり、プロキシを介して顧客をオンラインに導く方法に到達しました。 DHCPサーバーのゲートウェイをルーターのアドレスからサーバーのアドレスに変更する必要があります。もちろん、このためには、サーバーアドレスは静的であるか、MACにバインドされている必要があります。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：MikroTikで</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
の移動</font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- DHCPサーバ-ネットワークIP</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および当社のネットワークをダブルクリックします。 [ゲートウェイ]フィールドで、ルーターのアドレスをプロキシサーバーのアドレスに変更します。 [OK]をクリックすると、それだけです。ルーターを再起動すると、すべてのアクティブなクライアントの設定が正しく更新されます。その後、クライアントはネットワークのタイプをパブリックに変更する可能性があります（プライベートの場合）。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常のルーターの場合：</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
DHCPサーバーのゲートウェイを変更するルーターのマニュアルを参照してください。ただし、設定には何があるのか​​を説明します。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論：</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この代替ソリューションの結果として、IPとリストによるアクセスを詳細に構成し、Squidログで通常のクライアントIPアドレスを取得することができました。</font><font style="vertical-align: inherit;">一部の顧客にルーター経由でプロキシをバイパスしてオンラインにしたい場合は、スポイラーを読んでください。</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロキシをバイパスするインターネット</font></font></b><div class="spoiler_text">  ,  -      Squid ,        ,   ,<br>
</div></div><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.まとめ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記のすべてを要約すると、</font><font style="vertical-align: inherit;">Linux Ubuntu 18.04 LTSを最初からインストールして構成し、HTTPSをサポートするSquidをビルドしてインストールし、ホワイトリストフィルタリングを構成し、追加のDHCPサーバーをインストールせずにプロキシサーバーをネットワークに統合しました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.ソースのリスト</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
記事を作成するとき</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、Interface LLCのTechnical Blogの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サイト</font><font style="vertical-align: inherit;">や</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Web Safetyの</font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">スペシャリスト</font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">-Your Network for Web Filter</font></a><font style="vertical-align: inherit;">のサイトからのさまざまな資料</font><font style="vertical-align: inherit;">、および個人的な知識と経験が使用されました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
記事を編集して補足するとき、次のユーザーは多くのことを助けました：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カンラス</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、 </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ペトリオット</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、 </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バースク</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">彼らの支援と助けに感謝します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.著者による注意</font></font></h3><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーバーのすべての作業は、</font><font style="vertical-align: inherit;">コマンドの前に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を追加する</font><font style="vertical-align: inherit;">か、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo -s</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コマンドを1回入力</font><font style="vertical-align: inherit;">することにより、スーパーユーザーモードで行う必要があります</font><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Squidはリソース全体へのアクセスを開き、閉じます。たとえば、Wikipediaの1つの記事をブロックすることはできません。</font><font style="vertical-align: inherit;">しかし、正規表現やテストの学習を妨げるものはありません。</font></font></li>
<li>   , .    ,        1000 .</li>
<li><s> ,           IP-  Squid.   Squid   IP- —  Mikrotik.    ,      DHCP    ,      . ,    ,    ,     IP .</s> —     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link">Barsook</a> </li>
<li>  Squid     ( 50)   1  .  ,   Squid  .     ,   <i>top</i>.</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ルーターの構成には両方のオプションを使用することをお勧めします。ネットワーク設定（ルーター自体）で異なるゲートウェイを明示的に指定すると、ロックをバイパスできるためです。</font></font></li>
</ol><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD1：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代替ネットワーク構成とファイアウォール</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD2：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代替ルーター構成オプションが追加されました</font><b><font style="vertical-align: inherit;">。Squid</font></b><font style="vertical-align: inherit;">ログにアドレスを表示する際の問題が修正されました。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD3：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3.1で修正が追加されました-パケットがサーバーを通過できるようになり、最初に追加するのを忘れていました。</font><font style="vertical-align: inherit;">そうしないと、インターネットが機能しません。</font><font style="vertical-align: inherit;">感謝</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドミトリー1986</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 記事をテストするため。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja473570/index.html">10時間で314km²を検索-森林に対する検索エンジニアの最後の戦い</a></li>
<li><a href="../ja473572/index.html">「祖国の大箱」が再計算されます：ドイツの戦略的準備は新しい方法によって決定されます</a></li>
<li><a href="../ja473574/index.html">TSD上のアプリケーションと1Cとの通信：HTTPサービスによるエンタープライズ8.3。パート3（BroadcastReceiverによるバーコードの取得）</a></li>
<li><a href="../ja473576/index.html">開発者実験インフラストラクチャ</a></li>
<li><a href="../ja473578/index.html">Nginx用の動的モジュールの構築</a></li>
<li><a href="../ja473586/index.html">FortiConverterまたは手間のかからない移動</a></li>
<li><a href="../ja473588/index.html">侵入型エース：青いハエの「反転」着陸の運動学</a></li>
<li><a href="../ja473590/index.html">Computing Olympiadで3 of 4の金メダルを獲得した方法</a></li>
<li><a href="../ja473592/index.html">Raiffeisenbankでのスクラムコミュニティのミートアップ+放送</a></li>
<li><a href="../ja473596/index.html">Python v3.x：コルーチンおよび同期関数の例外ハンドラー。一般的に、すべての</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>