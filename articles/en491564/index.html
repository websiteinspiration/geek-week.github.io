<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§π üéÖüèª üêô Java 14: Record, a more concise instanceof, jpackage wrapper, switch lambdas and text blocks ‚ò¢Ô∏è ‚òùüèΩ üßíüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="UPD. Today will be the long-awaited release of Java 14 - and even if it is not LTS - there are enough new features in it. Java 14 will be available in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Java 14: Record, a more concise instanceof, jpackage wrapper, switch lambdas and text blocks</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/491564/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD. </font><font style="vertical-align: inherit;">Today will be the long-awaited release of Java 14 - and even if it is not LTS - there are enough new features in it. </font><font style="vertical-align: inherit;">Java 14 will be available in a few hours - but you can get to know it now. </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/us/u0/ae/usu0aephljxik4pjtyk6baaapyc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In Java 14, there are enough changes, both at the level of writing code, and at the level of API, GC and many other engine hoods. </font><font style="vertical-align: inherit;">We can say with some certainty that if you know about some Kotlin or Python super-chips - do not worry, with a high degree of probability they will soon appear in Java. </font><font style="vertical-align: inherit;">In any case, today's release contains some of them. </font><font style="vertical-align: inherit;">But first things first.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In Java 14, the following innovations await us:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JEP 305. Assigning a reference to an object being checked through instanceof.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JEP 343. The packer jpackage (Incubator).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JEP 345. NUMA-based memory allocation for G1.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JEP 349. Streaming events through the JFR.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JEP 352. Immutable Mapped Byte Buffers.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JEP 358. Tips on NullPointerException.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jep 359. Record.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JEP 361. Switch lambdas.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JEP 362. The Solaris and SPARC ports are now Deprecated.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JEP 363. Removing the Concurent Mark Sweep garbage collector that was previously marked as Deprecated.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JEP 364. Porting ZGC on macOS.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JEP 365. Porting ZGC to Windows.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JEP 366. The combination of ParallelScavenge + SerialOld GC is now Deprecated.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JEP 367. Removing tools and APIs from Pack200 (which were marked as Deprecated back in Java 11).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JEP 368. Text Blocks.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JEP 370. External Memory Access API (Incubator).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's talk about each improvement, some of which will be discussed in more detail.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JEP 305. Assigning a reference to an object checked through instanceof</font></font></h2><br>
<img src="https://habrastorage.org/webt/7a/pm/o-/7apmo-a8gbn7oj4tqu-9-iv6vcq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consider the situation of checking the type of an object through instanceof. </font><font style="vertical-align: inherit;">If we want to explicitly customize an object to the required type without risking a ClassCastException, we first need to make sure that the object is the type we need.</font></font><br>
<br>
<pre><code class="java hljs">    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">showNameIfToy</span><span class="hljs-params">(Object o)</span> </span>{
        <span class="hljs-keyword">if</span> (o <span class="hljs-keyword">instanceof</span> Toy) {  <span class="hljs-comment">//,    -  Toy</span>
            Toy t = (Toy) o;  <span class="hljs-comment">//  </span>
            System.out.println(<span class="hljs-string">"Toy's name: "</span> + t.getName());  <span class="hljs-comment">//-   </span><font></font>
        }<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this example, which occurs, by the way, all the time, we a) make sure that we have an object of the desired type, b) assign a link to it, c) do something with it, based on our logic. </font><font style="vertical-align: inherit;">At Oracle, it seems, they saw a certain splendor of code in this particular construction, and decided to reduce it by exactly one step. </font><font style="vertical-align: inherit;">Now you can write like this:</font></font><br>
<br>
<pre><code class="java hljs">    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">showNameIfToy</span><span class="hljs-params">(Object o)</span> </span>{
        <span class="hljs-keyword">if</span> (o <span class="hljs-keyword">instanceof</span> Toy t) {  <span class="hljs-comment">//      </span>
            System.out.println(<span class="hljs-string">"Toy's name: "</span> + t.getName());  <span class="hljs-comment">//     </span><font></font>
        }<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
How all this is really convenient and useful, I leave to judge you, reader. </font><font style="vertical-align: inherit;">Yes, indeed, this construction in this form occurs, probably, in 99% of cases associated with instanceof, and, perhaps, simplification will take root (or maybe not). </font><font style="vertical-align: inherit;">Time will tell.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JEP 343. The jpackage Packer (Incubator)</font></font></h2><br>
<img src="https://habrastorage.org/webt/qy/hk/2d/qyhk2diseyyhq_rysnopvdiq1gk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We, the developers, are guys who are shot, you won‚Äôt scare us with installing a dzharnik, but what about a simple user who does not want to know when installing the JVM that it is installed on another 3 billion machines, does not want to know about Java cross-platform, but just wants to poke 2 times the .exe file if it has Windows, or just drag the .app application to the Applications folder, if it has a poppy, and don‚Äôt steam it? </font><font style="vertical-align: inherit;">How to create all conditions for programmers so that they pack their applications in ‚Äúexecutables‚Äù familiar to the end user? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It seems that Oracle realized the problem and decided to write a packer that will immediately package applications in a format suitable for the platform:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux: deb and rpm </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">macOS: pkg and dmg </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows: msi and exe </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It looks something like this:</font></font><br>
<br>
<pre><code class="bash hljs">$ jpackage --name myapp --input lib --main-jar main.jar --<span class="hljs-built_in">type</span> exe</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
--name myapp - future name of the application </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
--input lib - source of the jar archive </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
--main-jar main.jar - name of the archive containing the main class </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
--type exe - type into which the application will be packaged. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After packaging, you can double-click on myapp.exe (if you have Windows) and install it as a regular windows application. The graphical interface is provided by JavaFX. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's try to build such an application using the Windows platform. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, let's take the project from here: </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/promoscow/bouncer</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
When sending a GET request, we get the message: ‚ÄúBounce successfull‚Äù and timestamp. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Putting a dzharnik. Since we have gradle, it is in the build / libs folder. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bf/bz/eg/bfbzeg3ansxdehnqoudd76-fcbw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Go to the build folder, enter the required minimum of commands:</font></font><br>
<br>
<pre><code class="bash hljs">jpackage --name bouncer --input libs --main-jar bouncer.jar --<span class="hljs-built_in">type</span> exe</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We get, really, an exe-shnik. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/56/-k/nm/56-knmpxzinlb7nwtm3owmkn2pa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We poke twice in the executable, the usual installation of the application occurs. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wow! </font></font><br>
<br>
<img src="https://habrastorage.org/webt/a3/ck/jk/a3ckjkvq0hs7flr4towxmah19h4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The application has been installed and is waiting in the wings. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In Program Files, in the bouncer folder, you can run bouncer.exe.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/2k/y_/vc/2ky_vc98fu1a7msjhss9v_m59dk.jpeg"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JEP 345. NUMA-allocated memory allocation for G1</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is such a problem - NUMA, Non-Uniform Memory Access, Unequal memory access. In other words, access to remote sockets in multi-section machines can take considerable time, especially for the G1 garbage collector. In Java 14, they tried to solve this problem as follows: The </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
G1 heap is organized as a set of fixed-size areas. A region is usually a collection of physical pages, although when using large pages (via -XX: + UseLargePages), several regions can make up one physical page. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you add the + XX: + UseNUMA parameter during JVM initialization, the regions will be evenly distributed over the total number of available NUMA nodes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oracle promises that although this approach is not entirely flexible, they will improve it in the future.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JEP 349. Streaming Events Through the JFR</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is such a thing in Java as JFR - Java Flight Recording - recording events on the fly, which allows you to monitor about 500 varieties of events while the application is running. </font><font style="vertical-align: inherit;">The problem is that most of them can only be viewed in the logs. </font><font style="vertical-align: inherit;">The improvement offered by Oracle is to implement a handler, for example, a lambda function that will be called in response to an event. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here's what it looks like:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">try</span> (<span class="hljs-keyword">var</span> rs = <span class="hljs-keyword">new</span> RecordingStream()) {<font></font>
  rs.enable(<span class="hljs-string">"jdk.CPULoad"</span>).withPeriod(Duration.ofSeconds(<span class="hljs-number">1</span>));<font></font>
  rs.onEvent(<span class="hljs-string">"jdk.CPULoad"</span>, event -&gt; System.out.println(event.getFloat(<span class="hljs-string">"machineTotal"</span>)));<font></font>
  rs.start();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This event every second displays the processor load to the console.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8b/m_/bp/8bm_bpzyy8qacbkj7grka4oyr3c.jpeg"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JEP 358. Tips on NullPointerException</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another obvious convenience, designed to simplify the search for errors in the code. </font><font style="vertical-align: inherit;">Imagine a construction - a planet, there are many countries on the planet, in every country there are many cities.</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Planet</span> </span>{<font></font>
<font></font>
    <span class="hljs-keyword">private</span> List&lt;Country&gt; countries;
    <span class="hljs-comment">//...</span><font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Country</span> </span>{<font></font>
<font></font>
    <span class="hljs-keyword">private</span> List&lt;City&gt; cities;
    <span class="hljs-comment">//...</span><font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">City</span> </span>{<font></font>
<font></font>
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-comment">//...</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We decided to display the hash codes of all the cities on the planet:</font></font><br>
<br>
<pre><code class="java hljs">planet.getCountries().forEach(c -&gt; c.getCities().forEach(city -&gt; city.hashCode()));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But they did not think about the mandatory initialization of the fields. </font><font style="vertical-align: inherit;">And at some point they got a NullPointerException:</font></font><br>
<br>
<pre><code class="java hljs">Exception in thread <span class="hljs-string">"main"</span> java.lang.NullPointerException<font></font>
	at ru.xpendence.jep_358_nullpointerexception.Main.main(Main.java:<span class="hljs-number">19</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Which field do we have null? </font><font style="vertical-align: inherit;">planet? </font><font style="vertical-align: inherit;">country? </font><font style="vertical-align: inherit;">city ‚Äã‚Äã??? </font><font style="vertical-align: inherit;">We do not know. </font><font style="vertical-align: inherit;">We put the breakpoint on the right line and, with a sigh, go debase. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In Java 14, a NullPointerException is more informative:</font></font><br>
<br>
<pre><code class="java hljs">Exception in thread <span class="hljs-string">"main"</span> java.lang.NullPointerException: Cannot assign field <span class="hljs-string">"cities"</span> because <span class="hljs-string">"countries"</span> is <span class="hljs-keyword">null</span>
     at Main.main(Main.java:<span class="hljs-number">21</span>)<font></font>
     ...</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And immediately everything is clear. </font><font style="vertical-align: inherit;">countries is null.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JEP 359. Record</font></font></h2><br>
<img src="https://habrastorage.org/webt/us/7z/al/us7zaleyxjn5obz6_8gaufbpdgu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No wonder Oracle changed the release cycle to a six-month one. Tectonic shifts in the IT industry make even such leaders move faster. And if, for example, Kotlin and Python at the time of their appearance were influenced by Java (this is what Wikipedia says about Python, anyway), now Java is looking at its followers, so to speak. About Python it will be lower, but the following feature of Oracle was precisely looked in Kotlin. It's about data classes, which in Java are now called record. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What is a data class? Let's write a regular POJO:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Station</span> </span>{<font></font>
<font></font>
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> Coordinates coordinates;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> name;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(String name)</span> </span>{
        <span class="hljs-keyword">this</span>.name = name;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Coordinates <span class="hljs-title">getCoordinates</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> coordinates;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setCoordinates</span><span class="hljs-params">(Coordinates coordinates)</span> </span>{
        <span class="hljs-keyword">this</span>.coordinates = coordinates;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">equals</span><span class="hljs-params">(Object o)</span> </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> == o) <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
        <span class="hljs-keyword">if</span> (o == <span class="hljs-keyword">null</span> || getClass() != o.getClass()) <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<font></font>
        PlainStation that = (PlainStation) o;<font></font>
        <span class="hljs-keyword">return</span> Objects.equals(name, that.name) &amp;&amp;<font></font>
                Objects.equals(coordinates, that.coordinates);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">hashCode</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> Objects.hash(name, coordinates);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"PlainStation{"</span> +
                <span class="hljs-string">"name='"</span> + name + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">", coordinates="</span> + coordinates +
                <span class="hljs-string">'}'</span>;<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here we have everything - getters, setters, equals, hashcode, toString ... In order to somehow get rid of this disgrace, good people came up with Lombok. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At Jetbrains, the problem was solved at one time in a more radical way - by inventing data classes for Kotlin. </font><font style="vertical-align: inherit;">Such a class with all standard methods looks like this:</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">data</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Station</span></span>(<span class="hljs-keyword">val</span> name: String, <span class="hljs-keyword">val</span> coordinates: Coordinates)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And that‚Äôs it. </font><font style="vertical-align: inherit;">In Oracle, it seems, looked at this design and did exactly the same, only record:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> record <span class="hljs-title">RecordStation</span><span class="hljs-params">(String name, List&lt;Coordinates&gt; coordinates)</span> </span>{}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It contains standard getters, setters, equals, hashcode and toString. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A class of this type can already be created in IDEA 2020.1.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What are the differences from POJO?</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Record cannot be inherited from any class. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Record cannot have any other fields of the object, except for those declared in the constructor when describing the class (yes, this is the default constructor, by the way). </font><font style="vertical-align: inherit;">Static - you can.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fields are implicitly final. </font><font style="vertical-align: inherit;">Objects are implicitly final. </font><font style="vertical-align: inherit;">With all the consequences, like the impossibility of being abstract.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It turns out that this is such an immutable data-class, not intended for some complex logical actions with it, but intended for data transfer, and that‚Äôs all.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JEP 361. Switch Lambdas</font></font></h2><br>
<img src="https://habrastorage.org/webt/td/bv/sa/tdbvsa6l6cmnjqbaxukwjggnrtg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It seems that Oracle has taken up the switch tightly. </font><font style="vertical-align: inherit;">Prior to the current release, it was a rather bulky design, and it looked like this:</font></font><br>
<br>
<pre><code class="java hljs">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">translateDayOfWeekOld</span><span class="hljs-params">(String dayOfWeek)</span> </span>{
        <span class="hljs-keyword">switch</span> (dayOfWeek) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">"MONDAY"</span>:<font></font>
                System.out.println(<span class="hljs-string">""</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"TUESDAY"</span>:<font></font>
                System.out.println(<span class="hljs-string">""</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"WEDNESDAY"</span>:<font></font>
                System.out.println(<span class="hljs-string">""</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"THURSDAY"</span>:<font></font>
                System.out.println(<span class="hljs-string">""</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"FRIDAY"</span>:<font></font>
                System.out.println(<span class="hljs-string">""</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"SATURDAY"</span>:<font></font>
                System.out.println(<span class="hljs-string">""</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"SUNDAY"</span>:<font></font>
                System.out.println(<span class="hljs-string">""</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">default</span>:<font></font>
                System.out.println(<span class="hljs-string">"Day of week not found, try again with today day of week"</span>);<font></font>
                String displayName = LocalDate.now().getDayOfWeek().name();<font></font>
                translateDayOfWeek(displayName);<font></font>
        }<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Processing one condition takes at least three lines - case, action, break. </font><font style="vertical-align: inherit;">Now, with the enhanced functionality of the switch, we can shorten the above construction to this:</font></font><br>
<br>
<pre><code class="java hljs">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">translateDayOfWeek</span><span class="hljs-params">(String dayOfWeek)</span> </span>{
        <span class="hljs-keyword">switch</span> (dayOfWeek) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">"MONDAY"</span> -&gt; System.out.println(<span class="hljs-string">""</span>);
            <span class="hljs-keyword">case</span> <span class="hljs-string">"TUESDAY"</span> -&gt; System.out.println(<span class="hljs-string">""</span>);
            <span class="hljs-keyword">case</span> <span class="hljs-string">"WEDNESDAY"</span> -&gt; System.out.println(<span class="hljs-string">""</span>);
            <span class="hljs-keyword">case</span> <span class="hljs-string">"THURSDAY"</span> -&gt; System.out.println(<span class="hljs-string">""</span>);
            <span class="hljs-keyword">case</span> <span class="hljs-string">"FRIDAY"</span> -&gt; System.out.println(<span class="hljs-string">""</span>);
            <span class="hljs-keyword">case</span> <span class="hljs-string">"SATURDAY"</span> -&gt; System.out.println(<span class="hljs-string">""</span>);
            <span class="hljs-keyword">case</span> <span class="hljs-string">"SUNDAY"</span> -&gt; System.out.println(<span class="hljs-string">""</span>);
            <span class="hljs-keyword">default</span> -&gt; {<font></font>
                System.out.println(<span class="hljs-string">"Day of week not found, try again with today day of week"</span>);<font></font>
                String displayName = LocalDate.now().getDayOfWeek().name();<font></font>
                translateDayOfWeek(displayName);<font></font>
            }<font></font>
        }<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agree, quite compact, fashionable and with lambdas. </font><font style="vertical-align: inherit;">Is it worth it, you decide. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By the way, switch IDEA 2020.1, written according to the old rules, carefully suggests rewriting in a new way.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6g/vc/-k/6gvc-klmcnwryt4hnukssulzaqe.jpeg"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JEP 362. Solaris and SPARC Ports Now Deprecated</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Everything is simple here. </font><font style="vertical-align: inherit;">Oracle decided that it was not worth spending resources on supporting Solaris and SPARC ports, and freed employees should switch to the development of new features.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JEP 363. Removing the Concurent Mark Sweep garbage collector that was previously marked as Deprecated</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The removal of the CMS garbage collector was discussed two years ago, in the 9th release. </font><font style="vertical-align: inherit;">During this time, two garbage collectors came out - ZGC and Shenandoah. </font><font style="vertical-align: inherit;">At the same time, not one of the trustworthy Oracle contributors paid attention to CMS support. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In general, the doctor said to the morgue - then to the morgue.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JEP 364, 365. Porting ZGC on macOS and Windows</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We typically deploy applications on Linux platforms, but for local development we often use Windows and Mac. </font><font style="vertical-align: inherit;">For these needs, Java 14 ported the ZGC garbage collector to these two platforms.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JEP 366. ParallelScavenge + SerialOld GC Combination Now Deprecated</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is an extremely rarely used garbage collector configuration - when the young ParallelScavenge is combined with SerialOld. </font><font style="vertical-align: inherit;">Why this is done is not clear, since ParallelScavenge is parallel, and SerialOld, on the contrary, is not. </font><font style="vertical-align: inherit;">The inclusion of this combination requires special dances with a tambourine and requires a lot of blood developers. </font><font style="vertical-align: inherit;">‚ÄúOracle cares about you,‚Äù so it marks this configuration as obsolete and hopes to send it soon to the CMS garbage collector. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let us rejoice, brothers.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JEP 367. Removing Pack200 tools and APIs (which were marked as Deprecated back in Java 11)</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The turn of pack200, unpack200 and API pack200 came for a well-deserved rest. </font><font style="vertical-align: inherit;">And the reason is the obsolescence of this packer. </font><font style="vertical-align: inherit;">Once upon a time, when the Internet was modem and its speed was 56k (boomers remember), JDK had to be pumped out for hours. </font><font style="vertical-align: inherit;">A packer was invented that would compress JDK better and reduce download time. </font><font style="vertical-align: inherit;">Also, they could compress applets and client applications. </font><font style="vertical-align: inherit;">But time passed, and at current speeds, the packer is not relevant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The following packages will be removed: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
java.util.jar.Pack200 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
java.util.jar.Pack200.Packer </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
java.util.jar.Pack200.Unpacker </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
as well as the jdk.pack module.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JEP 368. Text Blocks</font></font></h2><br>
<img src="https://habrastorage.org/webt/mr/g9/_v/mrg9_vzcquzspnav3ld9yl0ofcm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At one time, Java had (among one and a half dozen other languages) an impact on Python. </font><font style="vertical-align: inherit;">As Python is rapidly gaining popularity and is pushing confidently with other leaders of the Java and C IT charts, there‚Äôs nothing wrong with peeping at it. </font><font style="vertical-align: inherit;">At one time, Java 9 introduced JShell, very similar to pythonium Jupiter. </font><font style="vertical-align: inherit;">And now, the time has come for text blocks. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When we need to write a line, we write a line:</font></font><br>
<br>
<pre><code class="java hljs">String s = <span class="hljs-string">""</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When we need to write a formatted string, we write something like this:</font></font><br>
<pre><code class="java hljs">String oldHtml = <span class="hljs-string">"&lt;html&gt;\n\t&lt;body&gt;\n\t\t&lt;p&gt;Hi all!&lt;/p&gt;\n\t&lt;/body&gt;\n&lt;/html&gt;"</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The text is completely unreadable. </font><font style="vertical-align: inherit;">And so, in Java 14 the problem is solved. </font><font style="vertical-align: inherit;">Now, using triple quotation marks, you can write any text:</font></font><br>
<br>
<pre><code class="java hljs">        String html = <span class="hljs-string">""</span><span class="hljs-string">"
                      &lt;html&gt;
                          &lt;body&gt;
                              &lt;p&gt;Hi all!&lt;/p&gt;
                          &lt;/body&gt;
                      &lt;/html&gt;
                      "</span><span class="hljs-string">""</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is much more convenient and readable. </font><font style="vertical-align: inherit;">We can simply copy any text into the code and not bother with tabs and hyphens. </font><font style="vertical-align: inherit;">The beauty! </font><font style="vertical-align: inherit;">If we just need to transfer the text to another line in such a text without making a hyphen, we can use a new literal - the backslash. </font><font style="vertical-align: inherit;">This symbol generalizes that the transference following it is not a transference. </font><font style="vertical-align: inherit;">Example:</font></font><br>
<br>
<pre><code class="java hljs">        String text = <span class="hljs-string">""</span><span class="hljs-string">"
                    \
                 ,  , \
                     \
                   . \
                , ,  ! \
                  ; \
                    \
                   .
                "</span><span class="hljs-string">""</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Conclusion:</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The gods have still given you Golden days, golden nights, And languid virgins fixed on you attentive eyes. </font><font style="vertical-align: inherit;">Play, sing, O friends! </font><font style="vertical-align: inherit;">Lose a fleeting evening; </font><font style="vertical-align: inherit;">And your joy of carelessness Through tears I smile.</font></font></blockquote><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JEP 370. External Memory Access API (Incubator)</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It happens that an application accesses external memory like Ignite, mapDB, memcached, etc. The existing APIs for accessing it are quite working, but Oracle wanted something global. </font><font style="vertical-align: inherit;">So the abstractions of MemorySegment, MemoryAddress and MemoryLayout appeared. </font><font style="vertical-align: inherit;">While the feature is in the incubator, and everyone can still be content with ByteBuffer, Unsafe and JNI.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I don‚Äôt know about you, reader, but I like the six-month release cycle that Oracle has switched to since Java 9. Now Oracle does not set the task of releasing absolutely stable releases, but an experienced javist will have no difficulty in being aware of the stability of one feature or another, observing for their development and testing something from the incubator. </font><font style="vertical-align: inherit;">The language has become more vibrant, changeable, very bold innovations and borrowings from other languages ‚Äã‚Äãbegan to appear in it. </font><font style="vertical-align: inherit;">Yes, someone doesn‚Äôt keep up with the flickering of releases, but our profession is such that we need to keep up, so whether we want it or not we meet Java 14. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As usual, I am attaching a project on a github with code examples: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[click here]</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en491554/index.html">We bypass the prohibition of messages API Vkontakte through Python</a></li>
<li><a href="../en491556/index.html">Java Microservices: A Practical Guide</a></li>
<li><a href="../en491558/index.html">Find more rock Easter eggs: from mysterious messages to calls to wash your hands and do your homework</a></li>
<li><a href="../en491560/index.html">How to make the terminal your assistant, not an enemy?</a></li>
<li><a href="../en491562/index.html">FOSS News No. 6 - review of free and open source news for March 2-8, 2020</a></li>
<li><a href="../en491566/index.html">Machine learning in R language using mlr3 package</a></li>
<li><a href="../en491568/index.html">Building a router in SOCKS on a laptop with Debian 10</a></li>
<li><a href="../en491570/index.html">Why ICQ lost an ancient user after buying Mail.Ru</a></li>
<li><a href="../en491572/index.html">The digest of fresh materials from the world of the front-end for the last week No. 405 (March 2 - 8, 2020)</a></li>
<li><a href="../en491574/index.html">A simple trick for managing procrastination</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>