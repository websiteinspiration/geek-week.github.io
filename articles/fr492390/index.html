<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîó üë§ üö∑ Guerre aux freins. Optimisation du nombre de rendus de composants dans React Native üëáüèº ü•É üï¥üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, Habr! Je m'appelle Kamo Spertsyan, je suis engag√© dans le d√©veloppement React Native chez Profi.ru. Si vous d√©cidez d' utiliser la technologi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Guerre aux freins. Optimisation du nombre de rendus de composants dans React Native</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492390/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bonjour, Habr! Je m'appelle Kamo Spertsyan, je suis engag√© dans le d√©veloppement React Native chez Profi.ru. Si vous d√©cidez d' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utiliser la technologie React Native</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour fournir rapidement les fonctionnalit√©s du produit et vous concentrer sur la vitesse de d√©veloppement, vous risquez de rencontrer des probl√®mes de performances. C'est du moins ce qui nous est arriv√©. Apr√®s six mois de d√©veloppement actif, les performances de notre application sont tomb√©es en dessous d'un niveau critique - tout √©tait extr√™mement lent. Par cons√©quent, nous avons repris l'optimisation - supprim√© tous les ¬´freins¬ª lors du d√©marrage, les transitions entre les √©crans, le rendu des √©crans, les r√©actions aux actions de l'utilisateur. En cons√©quence, en trois mois, ils ont amen√© l'exp√©rience utilisateur au niveau natif. Dans cet article, je veux parler de la fa√ßon dont nous avons optimis√© l'application sur React Native et r√©solu le probl√®me des rendus de plusieurs composants.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tv/qy/9b/tvqy9bo_jyqc4cz044_gneepvmw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai rassembl√© des recommandations qui aideront √† minimiser le nombre de redessins inutiles de composants. </font><font style="vertical-align: inherit;">Pour plus de clart√©, dans les exemples, je compare les impl√©mentations ¬´mauvaises¬ª et ¬´bonnes¬ª. </font><font style="vertical-align: inherit;">L'article sera utile √† ceux qui sont d√©j√† confront√©s √† de mauvaises performances des applications et √† ceux qui ne veulent pas autoriser cela √† l'avenir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous utilisons React Native associ√© √† Redux. </font><font style="vertical-align: inherit;">Certains conseils sont li√©s √† cette biblioth√®que. </font><font style="vertical-align: inherit;">Toujours dans l'exemple, j'utilise la biblioth√®que Redux-thunk - pour simuler le travail avec le r√©seau.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quand penser √† la performance?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, il convient de se rappeler d√®s le d√©but des travaux sur l'application. Mais si votre application ralentit d√©j√† - ne d√©sesp√©rez pas, tout peut √™tre corrig√©. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout le monde le sait, mais juste au cas o√π, je mentionnerai: il vaut mieux v√©rifier les performances sur les appareils faibles. Si vous d√©veloppez sur des appareils puissants, vous ne connaissez peut-√™tre pas les ¬´freins¬ª des utilisateurs finaux. D√©cidez par vous-m√™me des appareils qui vous guideront. Mesurer le temps ou </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FPS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans les parcelles de contr√¥le pour comparer avec les r√©sultats apr√®s optimisation.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
React Native pr√™t √† l'emploi offre la possibilit√© de mesurer les applications FPS via Developer Tools ‚Üí Show perf monitor. </font><font style="vertical-align: inherit;">La valeur de r√©f√©rence est de 60 images par seconde. </font><font style="vertical-align: inherit;">Plus cet indicateur est bas, plus l'application "ralentit" - ne r√©pond pas ou r√©agit avec retard aux actions de l'utilisateur. </font><font style="vertical-align: inherit;">L'un des principaux effets sur le FPS est le nombre de rendus, dont la ¬´s√©v√©rit√©¬ª d√©pend de la complexit√© des composants.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemple de description</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je montre toutes les recommandations sur l'exemple d'une application simple avec une liste de nouveaut√©s. </font><font style="vertical-align: inherit;">L'application dispose d'un √©cran, qui est situ√© </font></font><code>FlatList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec les nouvelles. </font><font style="vertical-align: inherit;">Une news est un composant </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui se compose de deux composants plus petits - le titre ( </font></font><code>NewsItemTitle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) et le corps ( </font></font><code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">L'exemple complet peut √™tre vu </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Plus loin dans le texte se trouvent des liens vers diverses branches du r√©f√©rentiel pour des exemples sp√©cifiques. </font><font style="vertical-align: inherit;">Le r√©f√©rentiel est utilis√© pour la commodit√© des lecteurs qui souhaitent explorer des exemples plus en profondeur. </font><font style="vertical-align: inherit;">Le code dans le r√©f√©rentiel et les exemples ci-dessous ne pr√©tendent pas √™tre parfaits - il est uniquement n√©cessaire √† des fins de d√©monstration. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ci-dessous, tous les composants sont sch√©matis√©s avec des liens et des accessoires.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/d9/ng/z6/d9ngz6hldmphbkjky1a-7-38nlq.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la m√©thode de rendu de chaque composant, j'ai ajout√© √† la console des informations uniques √† ce sujet: </font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_{no}<font></font>
ITEM_TITLE_{no}<font></font>
ITEM_BODY_{no}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
o√π </font></font><code>{no}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est le num√©ro de s√©rie des nouvelles afin de faire la distinction entre diff√©rents rendus de nouvelles de plusieurs rendus du m√™me. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour tester sur chaque </font></font><code>refresh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">liste de nouvelles, des nouvelles suppl√©mentaires sont ajout√©es √† son d√©but. </font><font style="vertical-align: inherit;">Dans le m√™me temps, le message suivant s'affiche dans la console:</font></font><br>
<br>
<pre><code class="plaintext hljs">--------------[ REFRESHING ]--------------</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces enregistrements aideront √† comprendre s'il y a un probl√®me dans un composant particulier et √† d√©terminer ult√©rieurement s'il √©tait possible de l'optimiser. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
S'il est correctement impl√©ment√©, notre journal apr√®s le lancement et plusieurs mises √† jour devraient ressembler √† ceci:</font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_3<font></font>
ITEM_TITLE_3<font></font>
ITEM_BODY_3<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_4<font></font>
ITEM_TITLE_4<font></font>
ITEM_BODY_4</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au premier d√©marrage, l'√©cran lui-m√™me et deux premi√®res informations sont dessin√©s. </font><font style="vertical-align: inherit;">Lors de la mise √† jour de la carte, l'√©cran est √† nouveau rendu, car ses donn√©es ont vraiment chang√©. </font><font style="vertical-align: inherit;">Plus de nouvelles arrivent. </font><font style="vertical-align: inherit;">Toutes les nouvelles pr√©c√©dentes ne sont pas redessin√©es, car leurs donn√©es n'ont pas chang√©.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quand un composant est-il rendu?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans React et React Native, il existe deux conditions pour rendre un composant:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">changer ses accessoires / √©tat,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rendu du composant parent.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une fonction peut √™tre red√©finie dans un composant </font></font><code>shouldComponentUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- elle re√ßoit de nouveaux accessoires et √©tats en entr√©e et indique si le composant doit √™tre rendu. Souvent, pour √©viter des rendus inutiles, une </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comparaison superficielle</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> des accessoires et des objets d'√©tat suffit. Par exemple, cela √©limine les rendus inutiles lorsque le composant parent change, s'ils n'affectent pas le composant enfant. Afin de ne pas √©crire une comparaison de surface manuellement √† chaque fois, vous pouvez h√©riter d'un composant </font></font><code>React.PureComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui encapsule cette v√©rification. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque nous utilisons la fonction de lien de connexion, la biblioth√®que Redux cr√©e un nouveau composant qui est ¬´connect√©¬ª √† l'√©tat global. Les modifications de cet √©tat d√©clenchent une m√©thode</font></font><code>mapStateToProps</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui renvoie de nouveaux accessoires. </font><font style="vertical-align: inherit;">Ensuite, une comparaison des anciens et des nouveaux accessoires commence, que le composant ait √©t√© d√©clar√© </font></font><code>PureComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou non. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consid√©rez ces nuances dans notre exemple. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous allons </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">laisser passer le </font><font style="vertical-align: inherit;">composant </font></font><code>connect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>NewsItemTitle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h√©riter de </font></font><code>React.Component</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et </font></font><code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- de </font></font><code>React.PureComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemple de code complet</font></font></a><br>
<br>
<pre><code class="plaintext hljs">export class NewsItemTitle extends React.Component<font></font>
export class NewsItemBody extends React.PureComponent</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici √† quoi ressemblera le journal apr√®s une mise √† jour d'une carte:</font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_3<font></font>
ITEM_TITLE_3<font></font>
ITEM_BODY_3<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez voir que les composants d'actualit√©s et de titres sont redessin√©s. </font><font style="vertical-align: inherit;">Nous les examinerons tour √† tour. </font></font><br>
<br>
<code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©clar√© en utilisant </font></font><code>connect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">En tant qu'accessoire, ce composant re√ßoit un identifiant, par lequel il re√ßoit ensuite des nouvelles dans </font></font><code>mapStateToProps</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">const mapStateToProps = (state, ownProps) =&gt; ({<font></font>
  item: state.newsMap[ownProps.itemKey],<font></font>
});</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√âtant donn√© que lors de la mise √† jour de la carte, toutes les nouvelles sont t√©l√©charg√©es √† nouveau, l'objet sera mis √† </font></font><code>item</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jour et se r√©f√©rera ensuite √† diverses cellules de m√©moire. En d'autres termes, ce seront des objets diff√©rents, m√™me si tous les champs contenus sont les m√™mes. Par cons√©quent, une comparaison entre la composante pr√©c√©dente et la nouvelle composante State'ov renvoie </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Le composant sera restitu√©, malgr√© le fait que les donn√©es n'ont pas chang√©. </font></font><br>
<br>
<code>NewsItemTitle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est h√©rit√© de </font></font><code>React.Component</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, il est donc rendu √† chaque fois que le composant parent est rendu. Cela se produit ind√©pendamment des valeurs des anciens et des nouveaux accessoires. </font></font><br>
<br>
<code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h√©rit√© de </font></font><code>React.PureComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, il compare donc les anciens et les nouveaux accessoires. Dans les news 1 et 2, leurs valeurs sont √©quivalentes, donc le composant est rendu uniquement pour les news 3. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour optimiser les rendus</font></font><code>NewsItemTitle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©clarez-le simplement comme </font></font><code>React.PureComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dans le cas de, vous devez </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">red√©finir la fonction </font></font><code>shouldComponentUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">shouldComponentUpdate(nextProps) {<font></font>
  return !shallowEqual(this.props.item, nextProps.item);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemple de code complet</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Voici </font></font><code>shallowEqual</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">une fonctionnalit√© de comparaison de surface d'objets fournie par Redux. </font><font style="vertical-align: inherit;">Vous pouvez √©crire comme ceci:</font></font><br>
<br>
<pre><code class="plaintext hljs">shouldComponentUpdate(nextProps) {<font></font>
  return (<font></font>
    this.props.item.title !== nextProps.item.title ||<font></font>
    this.props.item.body !== nextProps.item.body<font></font>
  );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici √† quoi ressemblera notre journal apr√®s ceci: </font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_3<font></font>
ITEM_TITLE_3<font></font>
ITEM_BODY_3</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remarque</font></font></b><div class="spoiler_text"> <code>shouldComponentUpdate</code>  <code>NewsItem</code> ,  <code>NewsItemTitle</code>   .        . <code>NewsItemTitle</code>    -         <code>NewsItem</code>,     .<br>
</div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">React.memo et composants fonctionnels</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il n'est </font></font><code>shouldComponentUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pas possible de </font><font style="vertical-align: inherit;">remplacer </font><font style="vertical-align: inherit;">un composant fonctionnel. </font><font style="vertical-align: inherit;">Mais cela ne signifie pas que pour optimiser un composant fonctionnel, vous devez le r√©√©crire dans un composant de classe. </font><font style="vertical-align: inherit;">Dans de tels cas, la fonction de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√©morisation React.memo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">fournie</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il accepte une entr√©e de composant et une fonction de comparaison facultative </font></font><code>areEqual</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Lorsqu'il est appel√©, il </font></font><code>areEqual</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">obtient des accessoires anciens et nouveaux et devrait renvoyer le r√©sultat de la comparaison. </font><font style="vertical-align: inherit;">La diff√©rence avec </font></font><code>shouldComponentUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ce qui </font></font><code>areEqual</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devrait revenir </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si les accessoires sont √©gaux, et non l'inverse. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, la </font></font><code>NewsItemTitle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√©morisation peut ressembler √† ceci:</font></font><br>
<br>
<pre><code class="plaintext hljs">areEqual(prevProps, nextProps) {<font></font>
  return shallowEqual(prevProps, nextProps);<font></font>
}<font></font>
export OptimizedNewsItemTitle = React.memo(NewsItemTitle, areEqual)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous ne r√©ussissez pas </font></font><code>areEqual</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√† </font></font><code>React.memo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, puis une comparaison superficielle des accessoires sera faite, de </font><font style="vertical-align: inherit;">sorte que </font><font style="vertical-align: inherit;">notre exemple peut √™tre simplifi√©e:</font></font><br>
<br>
<pre><code class="plaintext hljs">export OptimizedNewsItemTitle = React.memo(NewsItemTitle)</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fonctions lambda dans les accessoires</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour traiter les √©v√©nements des composants, les fonctions peuvent √™tre pass√©es √† ses accessoires. </font><font style="vertical-align: inherit;">L'exemple le plus frappant est la mise en ≈ìuvre </font></font><code>onPress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Souvent, des fonctions lambda anonymes sont utilis√©es pour cela. </font><font style="vertical-align: inherit;">Disons que </font></font><code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous voulons afficher uniquement l'aper√ßu, et si vous cliquez dessus - tout le texte. </font><font style="vertical-align: inherit;">Pour ce faire, lors du rendu </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous passerons l'h√©lice suivante:</font></font><br>
<br>
<pre><code class="plaintext hljs">&lt;NewsItemBody<font></font>
  ...<font></font>
  onPress={() =&gt; this.props.expandBody()}<font></font>
  ...<font></font>
/&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici √† quoi ressemble le journal avec cette impl√©mentation lorsque la m√©thode </font></font><code>shouldComponentUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">supprim√©e:</font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_3<font></font>
ITEM_TITLE_3<font></font>
ITEM_BODY_3<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les organes de presse 1 et 2 sont rendus, bien que leurs donn√©es n'aient pas chang√©, mais le </font></font><code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sont </font></font><code>PureComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Cela est d√ª au fait que pour chaque rendu, la </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valeur des accessoires </font></font><code>onPress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est recr√©√©e. </font><font style="vertical-align: inherit;">Techniquement, </font></font><code>onPress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√† chaque rendu, il pointe vers une nouvelle zone en m√©moire, donc une comparaison superficielle des accessoires en </font></font><code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retourne faux. </font><font style="vertical-align: inherit;">Le probl√®me est r√©solu par l'entr√©e suivante:</font></font><br>
<br>
<pre><code class="plaintext hljs">&lt;NewsItemBody<font></font>
  ...<font></font>
  onPress={this.props.expandBody}<font></font>
  ...<font></font>
/&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Journal: </font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_3<font></font>
ITEM_TITLE_3<font></font>
ITEM_BODY_3<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemple de code complet</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Malheureusement, une fonction anonyme ne peut en aucun cas toujours √™tre r√©√©crite en tant que m√©thode ou champ de classe pour un tel enregistrement. Le cas le plus courant est lorsque, √† l'int√©rieur de la fonction lambda, les variables de port√©e de la fonction dans laquelle elle est d√©clar√©e sont utilis√©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consid√©rez ce cas dans notre exemple. Pour passer de la liste g√©n√©rale √† l'√©cran d'une actualit√©, nous ajoutons le traitement du clic sur le corps de l'actualit√©. La m√©thode des </font></font><code>renderItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">composants </font></font><code>FlatList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ressemblera √† ceci:</font></font><br>
<br>
<pre><code class="plaintext hljs">const renderItem = ({item}) =&gt; (<font></font>
  &lt;NewsItem<font></font>
    itemKey={item}<font></font>
    onBodyPress={() =&gt; this.onItemBodyPress(item)}<font></font>
  /&gt;<font></font>
);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une fonction anonyme ne </font></font><code>onBodyPress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peut pas √™tre d√©clar√©e dans une classe, car alors la variable </font></font><code>item</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√©cessaire pour acc√©der √† une actualit√© sp√©cifique </font><font style="vertical-align: inherit;">dispara√Ætra de la port√©e </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La solution la plus simple au probl√®me consiste √† modifier la signature des accessoires du </font></font><code>onBodyPress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">composant </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">afin que le param√®tre requis soit transmis √† la fonction lors de son appel. </font><font style="vertical-align: inherit;">Dans ce cas, il s'agit de l'identifiant de news.</font></font><br>
<br>
<pre><code class="plaintext hljs">const renderItem = ({item}) =&gt; (<font></font>
  &lt;NewsItem<font></font>
    itemKey={item}<font></font>
    onBodyPress={item =&gt; this.onItemBodyPress(item)}<font></font>
  /&gt;<font></font>
);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce cas, nous pouvons d√©j√† supprimer la fonction anonyme dans la m√©thode de classe de composant.</font></font><br>
<br>
<pre><code class="plaintext hljs">const renderItem = ({item}) =&gt; (<font></font>
  &lt;NewsItem<font></font>
    itemKey={item}<font></font>
    onBodyPress={this.onItemBodyPress}<font></font>
  /&gt;<font></font>
);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, une telle solution nous obligera √† changer le composant </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="plaintext hljs">class NewsItemComponent extends React.Component {<font></font>
render() {<font></font>
  ...<font></font>
  return (<font></font>
      ...<font></font>
      &lt;NewsItemBody<font></font>
        ...<font></font>
        onPress={() =&gt; this.props.onBodyPress(this.props.item)}<font></font>
        ...<font></font>
      /&gt;<font></font>
      ...<font></font>
  );<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et encore une fois, nous revenons au probl√®me indiqu√© - nous passons une nouvelle fonction lambda au composant enfant pour chaque rendu du parent. </font><font style="vertical-align: inherit;">Ce n'est que maintenant que nous avons baiss√© d'un niveau. </font><font style="vertical-align: inherit;">Journal:</font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_3<font></font>
ITEM_TITLE_3<font></font>
ITEM_BODY_3<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour vous d√©barrasser de ce probl√®me √† la racine, vous pouvez utiliser le hook </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">useCallback</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il permet de m√©moriser un appel de fonction en passant un argument. </font><font style="vertical-align: inherit;">Si l'argument de la fonction ne change pas, le r√©sultat de l'appel </font></font><code>useCallback</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pointera vers la m√™me zone de m√©moire. </font><font style="vertical-align: inherit;">Dans notre exemple, cela signifie que lorsque vous redessinez les m√™mes nouvelles, le </font></font><code>onPress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">composant </font><font style="vertical-align: inherit;">prop </font></font><code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne change pas. </font><font style="vertical-align: inherit;">Les crochets ne peuvent √™tre utilis√©s que dans les composants fonctionnels, donc l'aspect final du composant </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sera le suivant:</font></font><br>
<br>
<pre><code class="plaintext hljs">function NewsItemComponent(props) {<font></font>
  ...<font></font>
  const {itemKey, onBodyPress} = props.item;<font></font>
  const onPressBody = useCallback(() =&gt; onBodyPress(itemKey), [itemKey, onBodyPress]);<font></font>
  return (<font></font>
    &lt;View&gt;<font></font>
      ...<font></font>
      &lt;NewsItemBody<font></font>
        ...<font></font>
        onPress={onPressBody}<font></font>
        ...<font></font>
      /&gt;<font></font>
    &lt;/View&gt;<font></font>
  );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et le journal: </font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_3<font></font>
ITEM_TITLE_3<font></font>
ITEM_BODY_3<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemple de code complet</font></font></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tableaux et objets</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En JavaScript, les fonctions sont repr√©sent√©es comme des objets, avec des tableaux. </font><font style="vertical-align: inherit;">Par cons√©quent, l'exemple du bloc pr√©c√©dent est un cas particulier de cr√©ation d'un nouvel objet dans les accessoires. </font><font style="vertical-align: inherit;">C'est assez courant, alors je l'ai mis dans un paragraphe s√©par√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toute cr√©ation de nouvelles fonctions, tableaux ou objets dans les accessoires conduit √† un nouveau rendu des composants. </font><font style="vertical-align: inherit;">Consid√©rez cette r√®gle dans l'exemple suivant. </font><font style="vertical-align: inherit;">Passons dans un </font></font><code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">style combin√© de deux valeurs:</font></font><br>
<br>
<pre><code class="plaintext hljs">&lt;NewsItemBody<font></font>
  ...<font></font>
  style={[styles.body, styles.item]}<font></font>
  ...<font></font>
/&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et encore une fois, le journal montre les rendus de composants suppl√©mentaires:</font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_3<font></font>
ITEM_TITLE_3<font></font>
ITEM_BODY_3<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour r√©soudre ce probl√®me, vous pouvez s√©lectionner un style distinct qui se combinera </font></font><code>body</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>item</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ou, par exemple, d√©placera la d√©claration du tableau </font></font><code>[styles.body, styles.item]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans une variable globale. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemple de code complet</font></font></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©ducteurs de r√©seau</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prenons une autre source populaire de ¬´freins¬ª associ√©e √† l'utilisation </font></font><code>FlatList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Une application classique qui contient une longue liste d'√©l√©ments du serveur impl√©mente la pagination. </font><font style="vertical-align: inherit;">Autrement dit, il charge un ensemble limit√© d'√©l√©ments sous la forme de la premi√®re page, lorsque la liste des √©l√©ments actuels se termine, il charge la page suivante, etc. </font><font style="vertical-align: inherit;">Un r√©ducteur de liste d'articles pourrait ressembler √† ceci:</font></font><br>
<br>
<pre><code class="plaintext hljs">const newsIdList = (state = [], action) =&gt; {<font></font>
  if (action.type === 'GOT_NEWS') {<font></font>
    return action.news.map(item =&gt; item.key);<font></font>
  } else if (action.type === 'GOT_OLDER_NEWS') {<font></font>
    return [...state, ...action.news.map(item =&gt; item.key)];<font></font>
  }<font></font>
  return state;<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque chaque page suivante se charge dans le style de l'application, un nouveau tableau d'identificateurs est cr√©√©. </font><font style="vertical-align: inherit;">Si nous transmettons ce tableau aux accessoires plus tard </font></font><code>FlatList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, voici √† quoi ressembleront les journaux de rendu des composants:</font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_&lt;1..10&gt;<font></font>
--------------[ LOADING NEXT PAGE ]--------------<font></font>
SCREEN<font></font>
ITEM_&lt;1..10&gt;<font></font>
ITEM_&lt;1..20&gt;<font></font>
--------------[ LOADING NEXT PAGE ]--------------<font></font>
SCREEN<font></font>
ITEM_&lt;1..20&gt;<font></font>
ITEM_&lt;1..30&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour cet exemple, j'ai apport√© quelques modifications dans l'application de test.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©finissez la taille de la page sur 10 actualit√©s.</font></font></li>
<li>   <code>item</code>   <code>NewsItem</code>  <code>FlatList</code>-,        connect. <code>NewsItem</code>    <code>React.Component</code>    .</li>
<li>     .</li>
<li>       .       ‚Ññ1     .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'exemple montre que lors du chargement de chaque page suivante, tous les anciens √©l√©ments sont √† nouveau rendus, puis les anciens √©l√©ments et les √©l√©ments de la nouvelle page sont √† nouveau rendus. Pour les amateurs de math√©matiques: si la taille de la page est √©gale </font></font><code>X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, alors lorsque la </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i√®me page est </font><font style="vertical-align: inherit;">charg√©e, </font><font style="vertical-align: inherit;">au lieu de ne rendre que les </font></font><code>X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nouveaux √©l√©ments, les √©l√©ments sont rendus </font></font><code>(i - 1) * X + i * X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬´D'accord¬ª, dites-vous, ¬´je comprends pourquoi tous les √©l√©ments sont dessin√©s apr√®s avoir ajout√© une nouvelle page: le r√©ducteur a renvoy√© un nouveau tableau, une nouvelle zone de m√©moire, tout √ßa. Mais pourquoi devons-nous rendre l'ancienne liste avant d'ajouter de nouveaux √©l√©ments? ¬ª ¬´Bonne question¬ª, je vais vous r√©pondre. Ceci est une cons√©quence du travail avec l'√©tat du composant </font></font><code>VirtualizedList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur la base duquel</font></font><code>FlatList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Je n'entrerai pas dans les d√©tails, car ils tirent sur un article s√©par√©. </font><font style="vertical-align: inherit;">Peu importe, je vous conseille de vous plonger dans la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et la source. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment se d√©barrasser d'une telle non-optimalit√©? </font><font style="vertical-align: inherit;">Nous r√©√©crivons le r√©ducteur pour qu'il ne retourne pas un nouveau tableau pour chaque page, mais ajoute des √©l√©ments √† celui existant:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Attention! </font><font style="vertical-align: inherit;">Antipattern!</font></font></b><div class="spoiler_text">          .     ,    , ,  <code>PureComponent</code>,          .      ,             .      .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"> Redux</a>.<br>
</div></div><br>
<pre><code class="plaintext hljs">const newsIdList = (state = [], action) =&gt; {<font></font>
  if (action.type === 'GOT_NEWS') {<font></font>
    return action.news.map(item =&gt; item.key);<font></font>
  } else if (action.type === 'GOT_OLDER_NEWS') {<font></font>
    action.news.forEach(item =&gt; state.push(item.key));<font></font>
    return state;<font></font>
    // return [...state, ...action.news.map(item =&gt; item.key)];<font></font>
  }<font></font>
  return state;<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s cela, notre journal ressemblera √† ceci:</font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_&lt;1..10&gt;<font></font>
--------------[ LOADING NEXT PAGE ]--------------<font></font>
SCREEN<font></font>
ITEM_&lt;1..20&gt;<font></font>
--------------[ LOADING NEXT PAGE ]--------------<font></font>
SCREEN<font></font>
ITEM_&lt;1..30&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous nous sommes d√©barrass√©s du rendu des anciens √©l√©ments </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avant d'</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ajouter des √©l√©ments √† une nouvelle page, mais les anciens √©l√©ments sont toujours dessin√©s </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apr√®s la</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mise </font><b><font style="vertical-align: inherit;">√†</font></b><font style="vertical-align: inherit;"> jour de la liste. Le nombre de rendus pour la page suivante est d√©sormais √©gal </font></font><code>i * X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. La formule est devenue plus simple, mais nous ne nous arr√™terons pas l√†. Nous n'avons que de </font></font><code>X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nouveaux √©l√©ments et nous voulons seulement de </font></font><code>X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nouveaux rendus. Nous utiliserons les astuces d√©j√† connues pour supprimer les rendus d'actualit√©s qui n'ont pas chang√© d'accessoires. Connectez-vous √† </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_&lt;1..10&gt;<font></font>
--------------[ LOADING NEXT PAGE ]--------------<font></font>
SCREEN<font></font>
ITEM_&lt;11..20&gt;<font></font>
--------------[ LOADING NEXT PAGE ]--------------<font></font>
SCREEN<font></font>
ITEM_&lt;21..30&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien! Maintenant, nous pouvons √™tre satisfaits de nous-m√™mes. Il n'y a nulle part o√π optimiser. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemple de code complet</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Un lecteur attentif indiquera qu'apr√®s avoir appliqu√© la connexion au </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">journal, il ressemblera au dernier exemple, quelle que soit la mani√®re dont vous impl√©mentez le r√©ducteur. Et il aura raison - si le composant news v√©rifie ses accessoires avant le rendu, peu importe si l'ancien tableau est utilis√© par le r√©ducteur ou s'il en cr√©e un nouveau. Seuls de nouveaux √©l√©ments sont dessin√©s et une seule fois. Cependant, changer l'ancien tableau au lieu d'en cr√©er un nouveau nous √©vite des rendus inutiles du composant </font></font><code>FlatList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilis√© </font></font><code>VirtualizedList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et des it√©rations inutiles des v√©rifications d'√©quivalence des accessoires </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Avec un grand nombre d'√©l√©ments, cela donne √©galement une augmentation des performances.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Utiliser des tableaux mutables et des objets dans les r√©ducteurs doit √™tre extr√™mement prudent. </font><font style="vertical-align: inherit;">Dans cet exemple, cela est justifi√©, mais si vous avez, disons, normal </font></font><code>PureComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, alors lorsque vous ajoutez des √©l√©ments au tableau mutable, les composants ne seront pas rendus. </font><font style="vertical-align: inherit;">Ses accessoires restent en fait inchang√©s, car avant et apr√®s la mise √† jour du tableau pointe vers la m√™me zone m√©moire. </font><font style="vertical-align: inherit;">Cela peut entra√Æner des cons√©quences inattendues. </font><font style="vertical-align: inherit;">Pas √©tonnant que l'exemple d√©crit viole les </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">principes de Redux</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et quelque chose d'autre...</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous utilisez des biblioth√®ques de niveau pr√©sentation, je vous conseille de vous assurer de bien comprendre comment elles sont impl√©ment√©es. </font><font style="vertical-align: inherit;">Dans notre application, nous utilisons un composant </font></font><code>Swipeable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de la biblioth√®que </font></font><code>react-native-gesture-handler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Il vous permet d'impl√©menter un bloc d'actions suppl√©mentaires lors du glissement d'une carte de la liste. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En code, cela ressemble √† ceci:</font></font><br>
<br>
<pre><code class="plaintext hljs">&lt;Swipeable<font></font>
  ...<font></font>
  renderRightActions={this.renderRightActions}<font></font>
  ...<font></font>
&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
M√©thode </font></font><code>renderRightActions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>renderLeftActions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retourne le composant qui s'affiche apr√®s le balayage. Nous avons d√©termin√© et modifi√© la hauteur du panneau lors du changement de composants afin de l'adapter au contenu n√©cessaire. Il s'agit d'un processus gourmand en ressources, mais s'il se produit pendant l'animation de balayage, l'utilisateur ne voit aucune interf√©rence.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/wz/n1/vg/wzn1vghiy6-wjclqcy8itdy1fns.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le probl√®me est que le composant </font></font><code>Swipeable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">appelle la m√©thode </font></font><code>renderRightActions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">au moment du rendu du composant principal. Tous les calculs et m√™me le rendu de la barre d'action, qui n'est pas visible avant le balayage, se produisent √† l'avance. Ainsi, toutes ces actions sont effectu√©es pour toutes les cartes de la liste en m√™me temps. Cela a provoqu√© des ¬´freins¬ª importants lors du d√©filement de la planche. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le probl√®me a √©t√© r√©solu de la mani√®re suivante. Si le panneau d'actions est dessin√© avec le composant principal, et non √† la suite du balayage, la m√©thode </font></font><code>renderRightActions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">renvoie un vide de la </font></font><code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">taille du composant principal. Sinon, nous dessinons le panel d'actions suppl√©mentaires comme pr√©c√©demment.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je donne cet exemple parce que les biblioth√®ques de support ne fonctionnent pas toujours comme pr√©vu. </font><font style="vertical-align: inherit;">Et s'il s'agit de biblioth√®ques au niveau de la pr√©sentation, il est pr√©f√©rable de s'assurer qu'elles ne gaspillent pas de ressources inutiles.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r√©sultats</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir √©limin√© les probl√®mes d√©crits dans l'article, nous avons consid√©rablement acc√©l√©r√© l'application sur React Native. </font><font style="vertical-align: inherit;">Il est maintenant difficile de le distinguer en termes de performances d'un mod√®le similaire, impl√©ment√© nativement. </font><font style="vertical-align: inherit;">Les rendus excessifs ont ralenti √† la fois le chargement des √©crans individuels et la r√©action aux actions des utilisateurs. </font><font style="vertical-align: inherit;">Surtout, il √©tait visible sur les listes, o√π des dizaines de composants sont dessin√©s √† la fois. </font><font style="vertical-align: inherit;">Nous n'avons pas tout optimis√©, mais les √©crans principaux de l'application ne ralentissent plus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les principaux points de l'article sont bri√®vement √©num√©r√©s ci-dessous.</font></font><br>
<br>
<ol>
<li> React Native      :  Props/State-     .</li>
<li>,   <code>React.PureComponent</code>,     ,       .</li>
<li>    ,    <code>shouldComponentUpdate</code>      <code>React.Memo</code>   .</li>
<li>-        .      ,         (shallow compare).               ,     .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La prise en charge des biblioth√®ques de niveau pr√©sentation peut entra√Æner un gaspillage inattendu de ressources. </font><font style="vertical-align: inherit;">Il convient d'√™tre prudent dans leur application.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est tout. </font><font style="vertical-align: inherit;">J'esp√®re que vous trouverez ces informations utiles. </font><font style="vertical-align: inherit;">Je serai heureux de toute r√©troaction!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sources utiles</font></font></h2><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comprendre le rendu dans React + Redux</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comparaison d'objets en JavaScript</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Am√©lioration des performances des composants fonctionnels React √† l'aide de React.memo ()</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment Discord atteint les performances iOS natives avec React Native</font></font></a></li>
</ol></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr492374/index.html">Exp√©rience: Redux du monde OOP</a></li>
<li><a href="../fr492376/index.html">Comment faire comprendre votre article ou votre documentation rapidement et avec pr√©cision</a></li>
<li><a href="../fr492378/index.html">Reactjs, Material-UI avec JSS. Petit guide</a></li>
<li><a href="../fr492384/index.html">Hack The Box - Postman Proc√©dure pas √† pas Redis et WebMin</a></li>
<li><a href="../fr492386/index.html">Comment le secteur informatique aide le monde √† jeter moins de nourriture</a></li>
<li><a href="../fr492398/index.html">Nous configurons nos appareils pour le travail √† distance, le podcasting, la vid√©o et le streaming</a></li>
<li><a href="../fr492404/index.html">Flutter + arduino nano 33 BLE sense = capteur BLE tr√®s simple</a></li>
<li><a href="../fr492406/index.html">Podcasts pour le geek: quelques programmes √©prouv√©s sur la gestion de projet, l'analyse technologique et le GTD</a></li>
<li><a href="../fr492408/index.html">La fr√©quentation des ordinateurs de bureau Yandex a diminu√©: ce qui s'est pass√© en 2019 et comment cela affectera en 2020</a></li>
<li><a href="../fr492410/index.html">C ++ est plus rapide et plus s√ªr que Rust, Yandex a pris des mesures</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>