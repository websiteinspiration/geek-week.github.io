<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚷 🏳️‍🌈 🖐🏼 Eine einfache Möglichkeit, Ihre Mikrotik vor Angriffen zu schützen 🍞 🥩 🔇</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ich möchte der Community auf einfache und funktionierende Weise mitteilen, wie Mikrotik verwendet wird, um mein Netzwerk und die Dienste, die aufgrund...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Eine einfache Möglichkeit, Ihre Mikrotik vor Angriffen zu schützen</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/499146/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich möchte der Community auf einfache und funktionierende Weise mitteilen, wie Mikrotik verwendet wird, um mein Netzwerk und die Dienste, die aufgrund dessen vor externen Angriffen „Ausschau halten“, zu schützen. Organisieren Sie mit nur drei Regeln einen Honigtopf auf Mikrotik. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Stellen wir uns also vor, wir haben ein kleines Büro, eine externe IP, hinter der sich ein RDP-Server befindet, damit die Mitarbeiter remote arbeiten können. Die erste Regel ist natürlich, Port 3389 auf der externen Schnittstelle auf einen anderen zu ändern. Dies dauert jedoch nicht lange. Nach einigen Tagen werden im Überwachungsprotokoll des Terminalservers mehrere erfolglose Berechtigungen pro Sekunde von unbekannten Clients angezeigt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine andere Situation, Sie haben ein Sternchen hinter Mikrotik versteckt, natürlich nicht auf dem 5060 udp-Port, und nach ein paar Tagen beginnt auch das Erraten von Passwörtern ... ja ja, ich weiß, fail2ban ist unsere ganze Sache, aber ich muss immer noch darüber pusten ... zum Beispiel habe ich es kürzlich auf Ubuntu gehoben Am 18. April stellte ich überrascht fest, dass fail2ban standardmäßig nicht die tatsächlichen Einstellungen für Sternchen aus derselben Box derselben Ubuntu-Distribution enthält. Google kann jedoch keine schnellen Einstellungen für vorgefertigte "Rezepte" googeln, die Anzahl der Veröffentlichungen wächst im Laufe der Jahre und Artikel mit " Rezepte “für die alten Versionen funktionieren nicht mehr, aber fast keine neuen ... Aber etwas, das ich abschweife ...</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also, was ist Honeypot auf den Punkt gebracht - ist ein Köder, in unserem Fall ein beliebter Port auf einer externen IP, jede Anfrage an diesen Port von einem externen Client sendet die src-Adresse an die schwarze Liste. </font><font style="vertical-align: inherit;">Alle.</font></font><br>
 <br>
<pre><code class="plaintext hljs">/ip firewall filter<font></font>
add action=add-src-to-address-list address-list="Honeypot Hacker" \<font></font>
    address-list-timeout=30d0h0m chain=input comment="block honeypot ssh rdp winbox" \<font></font>
    connection-state=new dst-port=22,3389,8291 in-interface=\<font></font>
    ether4-wan protocol=tcp<font></font>
add action=add-src-to-address-list address-list="Honeypot Hacker" \<font></font>
    address-list-timeout=30d0h0m chain=input comment=\<font></font>
    "block honeypot asterisk" connection-state=new dst-port=5060 \<font></font>
    in-interface=ether4-wan protocol=udp <font></font>
/ip firewall raw<font></font>
add action=drop chain=prerouting in-interface=ether4-wan src-address-list=\<font></font>
    "Honeypot Hacker"<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die erste Regel für die beliebten TCP-Ports 22, 3389, 8291 der externen ether4-wan-Schnittstelle sendet die Gast-IP an die Honeypot-Hacker-Liste (Ports für ssh, rdp und winbox werden im Voraus deaktiviert oder in andere geändert). Der zweite macht dasselbe mit dem beliebten UDP 5060. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die dritte Regel in der Phase vor dem Routing verwirft Pakete der "Gäste", deren srs-Adresse in den "Honeypot Hacker" gelangt ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach zweiwöchiger Arbeit bei mir zu Hause in Mikrotik enthielt die Honeypot-Hacker-Liste ungefähr eineinhalbtausend IP-Adressen von euterfreundlichen Fans meiner Netzwerkressourcen (Heimtelefonie, Mail, nextcloud, rdp). Brute-Force-Angriffe wurden gestoppt, Glückseligkeit folgte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei der Arbeit stellte sich nicht alles als so einfach heraus, dass der RDP-Server weiterhin mit Brute-Force-Passwörtern beschädigt wird.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anscheinend wurde die Portnummer lange vor dem Einschalten des Honeypots vom Scanner ermittelt, und während der Quarantäne ist es nicht so einfach, mehr als 100 Benutzer neu zu konfigurieren, von denen 20% über 65 Jahre alt sind. </font><font style="vertical-align: inherit;">Für den Fall, dass der Port nicht geändert werden kann, gibt es ein kleines Arbeitsrezept. </font><font style="vertical-align: inherit;">Ich habe mich im Internet ähnlich getroffen, aber es gibt eine fertige und Feinabstimmung:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Regeln zum Konfigurieren von Port Knocking</font></font></b>
                        <div class="spoiler_text"> <pre><code class="plaintext hljs"> /ip firewall filter<font></font>
add action=add-src-to-address-list address-list=rdp_blacklist \<font></font>
    address-list-timeout=15m chain=forward comment=rdp_to_blacklist \<font></font>
    connection-state=new dst-port=3389 protocol=tcp src-address-list=\<font></font>
    rdp_stage12<font></font>
add action=add-src-to-address-list address-list=rdp_stage12 \<font></font>
    address-list-timeout=4m chain=forward connection-state=new dst-port=3389 \<font></font>
    protocol=tcp src-address-list=rdp_stage11<font></font>
add action=add-src-to-address-list address-list=rdp_stage11 \<font></font>
    address-list-timeout=4m chain=forward connection-state=new dst-port=3389 \<font></font>
    protocol=tcp src-address-list=rdp_stage10<font></font>
add action=add-src-to-address-list address-list=rdp_stage10 \<font></font>
    address-list-timeout=4m chain=forward connection-state=new dst-port=3389 \<font></font>
    protocol=tcp src-address-list=rdp_stage9<font></font>
add action=add-src-to-address-list address-list=rdp_stage9 \<font></font>
    address-list-timeout=4m chain=forward connection-state=new dst-port=3389 \<font></font>
    protocol=tcp src-address-list=rdp_stage8<font></font>
add action=add-src-to-address-list address-list=rdp_stage8 \<font></font>
    address-list-timeout=4m chain=forward connection-state=new dst-port=3389 \<font></font>
    protocol=tcp src-address-list=rdp_stage4<font></font>
add action=add-src-to-address-list address-list=rdp_stage7 \<font></font>
    address-list-timeout=4m chain=forward connection-state=new dst-port=3389 \<font></font>
    protocol=tcp src-address-list=rdp_stage6<font></font>
add action=add-src-to-address-list address-list=rdp_stage6 \<font></font>
    address-list-timeout=4m chain=forward connection-state=new dst-port=3389 \<font></font>
    protocol=tcp src-address-list=rdp_stage5<font></font>
add action=add-src-to-address-list address-list=rdp_stage5 \<font></font>
    address-list-timeout=2m chain=forward connection-state=new dst-port=\<font></font>
    3389 protocol=tcp src-address-list=rdp_stage4<font></font>
add action=add-src-to-address-list address-list=rdp_stage4 \<font></font>
    address-list-timeout=2m chain=forward connection-state=new dst-port=\<font></font>
    3389 protocol=tcp src-address-list=rdp_stage3<font></font>
add action=add-src-to-address-list address-list=rdp_stage3 \<font></font>
    address-list-timeout=2m chain=forward connection-state=new dst-port=3389 \<font></font>
    protocol=tcp src-address-list=rdp_stage2<font></font>
add action=add-src-to-address-list address-list=rdp_stage2 \<font></font>
    address-list-timeout=2m chain=forward connection-state=new dst-port=3389 \<font></font>
    protocol=tcp src-address-list=rdp_stage1<font></font>
add action=add-src-to-address-list address-list=rdp_stage1 \<font></font>
    address-list-timeout=2m chain=forward connection-state=new dst-port=3389 \<font></font>
    protocol=tcp <font></font>
/ip firewall raw<font></font>
add action=drop chain=prerouting in-interface=ether4-wan src-address-list=\<font></font>
rdp_blacklist<font></font>
</code></pre> </div>
                    </div> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Innerhalb von 4 Minuten darf der Remote-Client nur 12 neue "Anforderungen" an den RDP-Server senden. </font><font style="vertical-align: inherit;">Ein Anmeldeversuch besteht aus 1 bis 4 "Anfragen". </font><font style="vertical-align: inherit;">Bei der 12. "Anfrage" - eine Sperre für 15 Minuten. </font><font style="vertical-align: inherit;">In meinem Fall haben die Angreifer nicht aufgehört, den Server zu hacken, sie haben sich an die Timer angepasst und jetzt tun sie dies sehr langsam. Eine solche Auswahlgeschwindigkeit reduziert die Angriffseffizienz auf Null. </font><font style="vertical-align: inherit;">Die Mitarbeiter des Unternehmens haben praktisch keine Unannehmlichkeiten bei der geleisteten Arbeit.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Noch ein kleiner Trick</font></font></b>
                        <div class="spoiler_text">            5,     ,     .<br>
<br>
<pre><code class="plaintext hljs">/ip firewall filter <font></font>
add action=add-src-to-address-list address-list=rdp_blacklist \<font></font>
    address-list-timeout=1w0d0h0m chain=forward comment=\<font></font>
    "night_rdp_blacklist" connection-state=new disabled=\<font></font>
    yes dst-port=3389 protocol=tcp src-address-list=rdp_stage8</code></pre><br>
  8    IP       . !<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zusätzlich zu den oben genannten Informationen werde ich einen Link zum Wiki-Artikel hinzufügen, der die Arbeitseinstellung zum Schutz von Mikrotik vor Netzwerkscannern enthält. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wiki.mikrotik.com/wiki/Drop_port_scanners</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Auf meinen Geräten funktioniert diese Einstellung mit den oben beschriebenen Honeypot-Regeln und ergänzt sie gut. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPD: Wie in den Kommentaren vorgeschlagen, wurde die Paketverwertungsregel in RAW verschoben, um die Belastung des Routers zu verringern.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de499130/index.html">BlockAdBlock Werbung Anti-Blocking Reverse Engineering</a></li>
<li><a href="../de499134/index.html">4 Schritte zur Steigerung des LTV-Produkts durch Benutzerkommunikation</a></li>
<li><a href="../de499136/index.html">#BeeFree oder ... Beeline - du konntest nicht widerstehen?</a></li>
<li><a href="../de499138/index.html">Topologische Sortierung</a></li>
<li><a href="../de499140/index.html">Generation unter Kontrolle: Wie man leistungsfähige Sprachmodelle bremst</a></li>
<li><a href="../de499148/index.html">Aerosol und Chlordioxid (ClO2): Wie hängt das zusammen?</a></li>
<li><a href="../de499150/index.html">Und ein Krieger auf dem Gebiet: Ist es möglich, qualitativ hochwertige Hosting-Services ohne Team bereitzustellen?</a></li>
<li><a href="../de499152/index.html">DLL & Python</a></li>
<li><a href="../de499154/index.html">Die Zusammenfassung interessanter Materialien für den mobilen Entwickler # 342 (vom 20. bis 26. April)</a></li>
<li><a href="../de499160/index.html">Russisches SCRUM. Sinnlos und gnadenlos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>