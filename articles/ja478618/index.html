<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>♋️ 😵 👨🏿‍🤝‍👨🏻 魔法のPHPの学校 👶 🧗🏻 📚</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="PHPの魔法とは何ですか？これは通常、_construct()またはのようなメソッドを意味します__get()。PHPの魔法のメソッドは、開発者が驚くべきことを行うのを助ける抜け穴です。ネットワークには、それらを使用するための指示がたくさんあります。しかし、もしあなたが本当の魔法を見たことがないと言...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>魔法のPHPの学校</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/478618/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PHPの魔法とは何ですか？</font><font style="vertical-align: inherit;">これは通常、</font></font><code>_construct()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">またはの</font><font style="vertical-align: inherit;">ようなメソッドを意味します</font></font><code>__get()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">PHPの魔法のメソッドは、開発者が驚くべきことを行うのを助ける抜け穴です。</font><font style="vertical-align: inherit;">ネットワークには、それらを使用するための指示がたくさんあります。</font><font style="vertical-align: inherit;">しかし、もしあなたが本当の魔法を見たことがないと言ったらどうでしょう？</font><font style="vertical-align: inherit;">結局のところ、あなたがすべてを知っているように思われるほど、より多くの魔法があなたを回避します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kd/xp/vm/kdxpvmeklgs6av1hp8ldzbnq4vc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OOPルールの確立されたフレームワークを削除して、PHPマジックスクールで不可能を可能にしましょう。</font><font style="vertical-align: inherit;">学校の主で最初の魔法の先生は</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アレクサンドル・リサチェンコ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ナイトタイガー</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">彼は魔法の考え方を教え、おそらく魔法の方法、プロパティにアクセスする非標準的な方法、コンテキストの変更、アスペクト指向プログラミング、およびストリームフィルターを気に入るはずです。</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/1W3UR7v3sAo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alexander Lisachenko</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &nbsp;は、</font><b><font style="vertical-align: inherit;">Alpari</font></b><font style="vertical-align: inherit;">のWeb開発およびアーキテクチャ部門の責任者です。</font><font style="vertical-align: inherit;">アスペクト指向フレームワーク</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Go！</font><font style="vertical-align: inherit;">Aop</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">PHPに関する国際会議での講演者。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
良い映画「欺瞞の幻想」には、次のフレーズがあります。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「あなたが近ければ近いほど、あなたは見えなくなります。」</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同じことは、PHPについても言えます。これは、珍しいことを行うための手品です。</font><font style="vertical-align: inherit;">しかし、まず第一に、それはあなたを欺くために作成されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちが一緒にPHPを使用して、魔法のような何かを書こうとすると、おそらく私はあなたをだますでしょう。</font><font style="vertical-align: inherit;">私はいくつかのトリックを行い、なぜこれが起こるのか長い間疑問に思うでしょう。</font><font style="vertical-align: inherit;">これは、PHPがその異常な機能で知られているプログラミング言語であるためです。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">魔法の装備</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
魔法の装備には何が必要ですか？</font><font style="vertical-align: inherit;">痛々しい方法。</font><font style="vertical-align: inherit;">
最後の方法については個別に説明します。これを使用すると、異常な動作を引き起こす可能性があります。</font><font style="vertical-align: inherit;">しかし、それだけではありません。</font></font><br>
<br>
<code>__construct(), __destruct(), __clone(),<br>
__call(), __callStatic(),&nbsp;<br>
__get(), __set(), __isset(), __unset(),<br>
__sleep(), __wakeup(),&nbsp;<br>
__toString(), __invoke(), __set_state(),<br>
__debugInfo()</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li><code>declare(ticks=1)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
</li>
<li><code>debug_backtrace()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは、現在のコードのどこにいるのかを理解し、だれが私たちを呼び出したのか、なぜ、どのような引数で呼び出したのかを理解するための仲間です。</font><font style="vertical-align: inherit;">すべてのロジックに従わないことを決定するのに役立ちます。</font></font><br>
</li>
<li><code>unset(), isset()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">特別なことではないようですが、これらのデザインには多くのトリックが隠されています。</font></font><br>
</li>
<li><code>by-reference passing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">参照によってオブジェクトまたは変数を渡す場合、何らかの魔法が必ず発生することを期待する必要があります。</font></font><br>
</li>
<li><code>bound closures</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">クロージャーとそれらがバインドできるという事実に関して、あなたは多くのトリックを構築することができます。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リフレクションAPIは、リフレクションを新しいレベルに引き上げるのに役立ちます。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StreamWrapper API。</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
装備は準備ができています-私は魔法の最初のルールを思い出します。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常に部屋で一番頭のいい人になる。</font></font></blockquote><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トリック＃1。</font><font style="vertical-align: inherit;">不可能な比較</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、私が不可能な比較と呼ぶ最初のトリックから始めましょう。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードをよく見て、これがPHPで発生するかどうかを確認してください。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ji/sd/8i/jisd8ip2pzz7kx9otvdxq8_c-k4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変数があり、その値を宣言すると、突然、それ自体に等しくなくなります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非数</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NaN-Not-a-numberのような魔法のアーティファクトがあります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gf/fw/3b/gffw3bl5rfz8xz1br3ut9ocmhnw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その驚くべき特徴は、それ自体とは異なるということです。</font><font style="vertical-align: inherit;">そしてこれが最初のトリックです。NaNを使用して友達を困惑させます。</font><font style="vertical-align: inherit;">しかし、NaNはこのタスクの唯一のソリューションではありません。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定数を使用します</font></font></h3><br>
<img src="https://habrastorage.org/webt/7c/hd/l1/7chdl1uranfz-cg9lbhc078ipnq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コツは、</font></font><code>namespace</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">宣言</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">し</font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">て比較</font><font style="vertical-align: inherit;">できる</font><font style="vertical-align: inherit;">こと</font><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">不幸な開発者は、なぜそこにいるのか</font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、そうでないの</font><font style="vertical-align: inherit;">かを長い間疑問に思い</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ハンドラ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のトリックは、前の2つのオプションよりも強力な砲です。</font><font style="vertical-align: inherit;">それがどのように機能するか見てみましょう。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xj/3g/5j/xj3g5jvenlytadytgnqth9yb47c.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
トリックはに基づいて</font></font><code>tick_function</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">おり、すでに述べたように</font></font><code>declare(ticks=1)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それはすべて箱から出してどのように機能しますか？</font><font style="vertical-align: inherit;">最初に、いくつかの関数を宣言し、参照によってパラメーターを受け取り、</font></font><code>isMagic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次にこの値をに変更しようとします</font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">私たちが発表した後</font></font><code>declare(ticks=1)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、PHPインタープリターは各基本操作の後にコール</font></font><code>register_tick_function</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バック</font><font style="vertical-align: inherit;">を呼び出し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">このコールバックでは、以前の値をに</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変更</font><font style="vertical-align: inherit;">できます</font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">マジック！</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トリック＃2。</font><font style="vertical-align: inherit;">魔法の表現</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2つの変数が宣言されている例を見てみましょう。</font><font style="vertical-align: inherit;">そのうちの一つ</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、他</font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">私たちは、やる</font></font><code>isBlack</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>isWhite</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、結果をのvar_dump。</font><font style="vertical-align: inherit;">結果はどうなると思いますか？</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yy/5r/kx/yy5rkxfp5zdicpodqjrutq1diri.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">優先演算子</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">正解</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。PHPには「演算子の優先順位」などがあります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tm/8e/uf/tm8eufef1fi8j46c3fc3xbgl1z8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
驚くべきことに、論理演算子は</font></font><code>or</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">割り当て操作よりも優先順位</font><font style="vertical-align: inherit;">が</font><font style="vertical-align: inherit;">低くなります。</font><font style="vertical-align: inherit;">したがって、割り当てだけが発生し</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><code>isWhite</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初の部分が失敗した場合に実行される他の式</font><font style="vertical-align: inherit;">があり</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">魔法の表現</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下のコードを見てください。</font><font style="vertical-align: inherit;">コンストラクターを含むクラスと、ファクトリーがあり、そのコードはさらに進んでいきます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bk/md/w5/bkmdw5zdb6bxcpml7jzygu9vjhs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後の行に注意してください。</font></font><br>
<br>
<pre><code class="php hljs">$value = <span class="hljs-keyword">new</span> $factory-&gt;build(Foo::class);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
発生する可能性のあるいくつかのオプションがあります。</font></font><br>
<br>
<ul>
<li><code>$factory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラス名として使用され</font></font><code>new</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解析エラーが発生します。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼び出しが使用され</font></font><code>$factory-&gt;build()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。この関数の値は結果として返され</font></font><code>new</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロパティ値は</font></font><code>$factory-&gt;build</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスの構築</font><font style="vertical-align: inherit;">に使用さ</font><font style="vertical-align: inherit;">れます。</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後のアイデアを見てみましょう。</font><font style="vertical-align: inherit;">クラスで</font></font><code>$factory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、一連の魔法の関数を宣言します。</font><font style="vertical-align: inherit;">彼らは私たちがすることを書きます：プロパティを呼び出す、メソッドを呼び出す、あるいは</font></font><code>invoke</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オブジェクト</font><font style="vertical-align: inherit;">を呼び出そうと</font><font style="vertical-align: inherit;">します。</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Factory</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_get</span>(<span class="hljs-params">$name</span>) </span>{<span class="hljs-keyword">echo</span> <span class="hljs-string">"Getting property {$name}"</span>; <span class="hljs-keyword">return</span> Foo::class;}
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_call</span>(<span class="hljs-params">$name, $arg</span>) </span>{<span class="hljs-keyword">echo</span> <span class="hljs-string">"Calling method {$name}"</span>; <span class="hljs-keyword">return</span> Foo::class;}
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_invoke</span>(<span class="hljs-params">$name</span>) </span>{<span class="hljs-keyword">echo</span> <span class="hljs-string">"Invoking {$name}"</span>; <span class="hljs-keyword">return</span> Foo::class;}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
正解：メソッドではなくプロパティを呼び出します。</font><font style="vertical-align: inherit;">その後</font></font><code>$factory-&gt;build</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、コンストラクターのパラメーターがあり、このクラスに渡します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ちなみに、このフレームワークでは、「新しいオブジェクトの作成のインターセプト」と呼ばれる機能を実装しています。このデザインを「ロック」できます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パーサー抜け穴</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の例は、PHPパーサー自体の例です。</font><font style="vertical-align: inherit;">中括弧内で関数を呼び出したり、変数を割り当てたりしたことはありますか？</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wi/b5/kb/wib5kbzb1j_0gzdurptouztvb7u.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はTwitterでこのトリックを得ました、それは非常に非標準で動作します。</font></font><br>
<br>
<pre><code class="php hljs">$result = ${<span class="hljs-string">'_'</span> . !$_=getCallback()}();<font></font>
<font></font>
$_=getCallback();                <span class="hljs-comment">// string(5) "hello"</span>
!$_=getCallback()}();           <span class="hljs-comment">// bool(false)</span>
<span class="hljs-string">'_'</span>.!$_=getCallback()}();      <span class="hljs-comment">// string(1) "_"</span>
${<span class="hljs-string">'_'</span>.!$_=getCallback()}();  <span class="hljs-comment">// string(5) "hello"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初に、</font></font><code>_</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">式の値を（アンダースコア）</font><font style="vertical-align: inherit;">という名前</font><font style="vertical-align: inherit;">の</font><font style="vertical-align: inherit;">変数</font><font style="vertical-align: inherit;">に割り当てます。</font><font style="vertical-align: inherit;">すでに変数があり、その値を論理的に反転させようとしているのですが、その</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行はのようにキャストされ</font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">次に、それを変数名にまとめて接着し、中括弧を内側に向けます。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">魔法とは？</font><font style="vertical-align: inherit;">この娯楽は、私たちにインスピレーションを与えられた、変わったものに感じることを可能にします。</font><font style="vertical-align: inherit;">それでそれは可能でしたか？！」</font></font></blockquote><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トリック＃3。</font><font style="vertical-align: inherit;">ルールを破る</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PHPについて私が気に入っているのは、非常に安全にしようとするときに誰もが作成するルールを破ることができることです。</font><font style="vertical-align: inherit;">プライベートコンストラクターを持つ「封印されたクラス」と呼ばれるデザインがあります。</font><font style="vertical-align: inherit;">マジシャンの学生としてのあなたの仕事は、このクラスのインスタンスを作成することです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rt/uw/h4/rtuwh49inyhecfbsbea1hvb6kq4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを行うには、3つのオプションを検討してください。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回避策</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の方法が最も明白です。</font><font style="vertical-align: inherit;">これは、すべての開発者に馴染みのあるものでなければなりません。これは、この言語が提供する標準APIです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/w2/or/df/w2ordfmqdhs3qg-nnzbff9yiilc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この設計で</font></font><code>newInstanceWithoutConstructor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、コンストラクターがプライベートであるという言語制限をバイパスし、すべてのプライベートコンストラクター宣言をバイパスしてクラスのインスタンスを作成できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
オプションは機能し、シンプルで、説明は必要ありません。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">短絡</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目のオプションには、より多くの注意とスキルが必要です。</font><font style="vertical-align: inherit;">無名関数が作成され、そのクラスのミサゴにバインドされます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/2z/6k/lz/2z6klzhpzlkbcglexaslmiu9ezo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここではクラスの内部にいて、プライベートメソッドを安全に呼び出すことができます。</font><font style="vertical-align: inherit;">これは</font></font><code>new static</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、クラスのコンテキストから</font><font style="vertical-align: inherit;">呼び出して使用するもの</font><font style="vertical-align: inherit;">です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fn/v5/ul/fnv5ulkueuayx56vd07u7tfk128.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">逆シリアル化</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3番目のオプションは、私の意見では、最も高度なオプションです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ky/qi/xb/kyqixbfapmoxxaisd6g3mlypuny.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
特定の行を特定の形式で書く場合は、特定の値に置き換えてください-クラスが判明します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/d2/0k/fi/d20kfibw1fnqmmovhc90_mqb1sy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
逆シリアル化の後、私たちはそれを取得します</font></font><code>instance</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">教義/インスタンス化パッケージ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マジックは、ドキュメント化されたフレームワークまたはライブラリになることがよく</font><font style="vertical-align: inherit;">あります。</font><font style="vertical-align: inherit;">たとえば、&nbsp; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Doctrine / Instantiatorでは</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、これがすべて実装されています。</font><font style="vertical-align: inherit;">任意のコードで任意のオブジェクトを作成できます。</font></font><br>
<br>
<pre><code class="plaintext hljs">composer show doctrine/instantiator --all<font></font>
name     : doctrine/instantiator<font></font>
descrip. : A small, lightweight utility to instantiate objects in PHP without invoking their constructors<font></font>
keywords : constructor, instantiate<font></font>
type     : library<font></font>
license  : MIT License (MIT)</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トリック＃4。</font><font style="vertical-align: inherit;">プロパティアクセスの傍受</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラウドが集まっています。クラスは秘密で、プロパティとコンストラクタはプライベートで、コールバックも行われます。</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Secret</span>
</span>{
    <span class="hljs-keyword">private</span> $secret = <span class="hljs-number">42</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_construct</span>(<span class="hljs-params"></span>)
    </span>{
        <span class="hljs-keyword">echo</span> <span class="hljs-string">'Secret is: '</span>, <span class="hljs-keyword">$this</span>-&gt;secret;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onPropAccess</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> $name</span>)
    </span>{
        <span class="hljs-keyword">echo</span> <span class="hljs-string">"Accessing property {$name}"</span>;<font></font>
<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-number">100500</span>;<font></font>
    }<font></font>
}<font></font>
<span class="hljs-comment">// How to create a secret instance and intercept the secret value?</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ウィザードとしての私たちの仕事は、どういうわけかコールバックを呼び出すことです。 </font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">魔法を追加...ゲッター</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
魔法のピンチを追加して機能させます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/p7/ut/2w/p7ut2w699vysx99jnvmxvr0akfy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この魔法のピンチは魔法です</font></font><code>getter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">それは関数を呼び出し、今のところひどいことは何も起こっていません。</font><font style="vertical-align: inherit;">ただし、前のトリックを使用して、プライベートコンストラクトをバイパスしてこのオブジェクトのインスタンスを作成します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/b0/oy/gu/b0oyguiksznuw3rzfn19rsz1s4y.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、どういうわけかコールバックを呼び出す必要があります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回路内の「未設定」</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを行うには、クロージャーを作成します。</font><font style="vertical-align: inherit;">クラスospreyにあるクロージャ内で、関数を使用し</font></font><code>unset()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">て変数</font><font style="vertical-align: inherit;">を削除</font><font style="vertical-align: inherit;">します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-n/2l/md/-n2lmdkswrc0cgk6tcobilajlgk.jpeg"><br>
<br>
<code>unset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数を一時的に除外できます。これにより、マジックメソッドを呼び出すことができます</font></font><code>get</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちはプライベートコンストラクタを呼び出します</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
を表示するプライベートコンストラクターがある</font></font><code>echo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ため、このコンストラクターを取得し、呼び出してアクセスできるようにすることができます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/1z/-g/vo/1z-gvohztwjnrbeujkiwecxdowi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
だから私たちの秘密のクラスは粉々に砕けました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/om/cv/ef/omcvefwmkjdrmnvuepdf3mmvf5k.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のメッセージを受け取りました。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">傍受;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">まったく違うものを返しました。</font></font><br>
</li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">leedavis / altr-egoパッケージ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多くの魔法がすでに文書化されています。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">altr-ego</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パッケージ</font><font style="vertical-align: inherit;">は、コンポーネントのふりをしています。</font></font><br>
<br>
<pre><code class="plaintext hljs">composer show leedavis81/altr-ego --all<font></font>
name     : leedavis81/altr-ego<font></font>
descrip. : Access an objects protected / private properties and methods<font></font>
keywords : php, break scope<font></font>
versions : dev-master, v1.0.2, v1.0.1, v1.0.0<font></font>
type     : library<font></font>
license  : MIT License (MIT)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
オブジェクトの1つを作成し、それに2番目をアタッチできます。</font><font style="vertical-align: inherit;">これにより、施設を変更できます。</font><font style="vertical-align: inherit;">彼は素直に変化し、あなたのすべての願いを叶えます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トリック＃5。</font><font style="vertical-align: inherit;">PHPの不変オブジェクト</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PHPに不変オブジェクトはありますか？</font><font style="vertical-align: inherit;">はい、そして非常に長い時間です。</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">namespace</span> <span class="hljs-title">Magic</span><font></font>
{<font></font>
    $<span class="hljs-title">object</span> = (<span class="hljs-title">object</span>) [<font></font>
        "\0<span class="hljs-title">Secret</span>\0<span class="hljs-title">property</span>" =&gt; '<span class="hljs-title">test</span>'<font></font>
    ];<font></font>
    var_dump($object);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
面白い方法で入手してください。興味深いのは、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特別なキー</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を持つ配列を作成することです</font><font style="vertical-align: inherit;">。それは構造から始まります</font></font><code>\0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-これはnullバイト文字であり、その後</font></font><code>Secret</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">にも見られ</font></font><code>\0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この構造は、クラス内でプライベートプロパティを宣言するためにPHPで使用されます。オブジェクトを配列にキャストしようとすると、同じキーが表示されます。それ以上のものはありません</font></font><code>stdClass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。これは、クラスから私有財産が含まれている</font></font><code>Secret</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同じです、</font></font><code>test</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">object</span>(<span class="hljs-built_in">stdClass</span>) [<span class="hljs-number">1</span>]
    <span class="hljs-keyword">private</span> <span class="hljs-string">'property'</span> (Secret) =&gt; <span class="hljs-keyword">string</span> <span class="hljs-string">'test'</span> (length=<span class="hljs-number">4</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
唯一の問題は、そこからこのプロパティを取得できないことです。作成されますが、利用できません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
不便だと思いました-不変オブジェクトがありますが、使用できません。したがって、私は自分の決定を提出する時であると決定しました。 PHPで利用できるすべての知識と魔法を使用して、すべての手品に基づいた構造を作成しました。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">簡単なものから始めましょう-DTO</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><b><font style="vertical-align: inherit;">作成し、</font></b><font style="vertical-align: inherit;">その中のすべてのプロパティをインターセプトしてみます（前のトリックを参照）。</font><font style="vertical-align: inherit;">そこから取得し</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">た値</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><b><font style="vertical-align: inherit;">安全な場所に保存します</font></b><font style="vertical-align: inherit;">。どの方法でもアクセスできません。どちらでもありません。</font></font><code>reflection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、クロージャー、その他の魔法はありません。</font><font style="vertical-align: inherit;">しかし、不確実性が生じます-ずる賢い若いプログラマーがまったくそこに到達しないように、いくつかの変数を保存することを保証するような場所がPHPにありますか？</font><font style="vertical-align: inherit;">この値を読み取れるように</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、魔法のメソッドを提供してい</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">これを行う</font><font style="vertical-align: inherit;">ために、APIを提供できるようにする</font><font style="vertical-align: inherit;">magical </font></font><code>getters</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、magicalメソッド</font></font><code>isset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
信頼できる場所に戻って検索してみましょう。</font></font><br>
<br>
<ul>
<li><code>Global variables</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> チェックされています-誰でも変更できます。</font></font><br>
</li>
<li><code>Public properties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> また適合しません。</font></font><br>
</li>
<li><code>Protected properties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> まあまあ、それは子クラスが通過するからです。</font></font><br>
</li>
<li><code>Private properties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">閉鎖またはそれを通して</font></font><code>reflection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あなたは変えることができる</font><font style="vertical-align: inherit;">ので、信頼はありません</font><font style="vertical-align: inherit;">。</font></font><br>
</li>
<li><code>Private static properties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あなたは試すことができますが、壊れ</font></font><code>reflection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変数の値を隠す場所はどこにもないようです。</font><font style="vertical-align: inherit;">しかし、魔法のようなものがありました- </font></font><code>Static variables in functions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これらは関数内にある変数です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値の安全な保管</font></font></h3><br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nikita Popov</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と&nbsp; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jay Watkins</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
に、特別なStack Overflowチャンネルで</font><font style="vertical-align: inherit;">それについて</font><font style="vertical-align: inherit;">聞いた&nbsp; </font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dz/lg/ev/dzlgevsl3qi9lwbi91sjwladbpu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、静的変数が宣言されている関数です。</font><font style="vertical-align: inherit;">それを取り除く方法はありますか？</font><font style="vertical-align: inherit;">答えはノーだ。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
保護された変数の別の世界で小さな抜け穴を発見し、それを使用したいと考えています。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リンクによる値の受け渡し</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
オブジェクトのプロパティとして、非標準で使用します。</font><font style="vertical-align: inherit;">ただし、プロパティを渡すことはできないため、参照による従来の値の転送を使用します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xr/qe/vn/xrqevnya2a0a8mizylf8gbimfb8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
魔法のメソッドがあるクラスがあり</font></font><code>callStatic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、その中で変数が宣言されていることがわかり</font></font><code>Static</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">関数の呼び出しでは、ネストされたすべてのメソッドを参照して、Immutableオブジェクトから変数の値を渡します。</font><font style="vertical-align: inherit;">そのため、コンテキストを提供します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状態を保存</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
状態がどのように保存されるか見てみましょう。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ef/5j/tm/ef5jtmjn0yuws-_nkbegq0neqag.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
とても簡単です。</font><font style="vertical-align: inherit;">転送されたオブジェクトには、</font></font><code>spl_object_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インスタンスごとに個別の識別子を返す</font><font style="vertical-align: inherit;">関数を使用し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">1 </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我々はすでにオブジェクトから得たが、保存しようとしています。</font><font style="vertical-align: inherit;">特にない。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オブジェクトの状態を適用する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでも、参照と</font></font><code>unset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロパティ</font><font style="vertical-align: inherit;">によって値を渡す構成があり</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">それらを変数に保存した後、現在のプロパティをすべて設定解除し、</font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このコンテキストをオブジェクトに設定します。</font><font style="vertical-align: inherit;">オブジェクトにはプロパティは含まれず、識別子のみが含まれます。この識別子は、</font></font><code>spl_object_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">まだ生きている間、このオブジェクトを</font><font style="vertical-align: inherit;">使用して宣言</font><font style="vertical-align: inherit;">され、このオブジェクトにバインドされます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tl/gp/b9/tlgpb9z5yi8ibnwqmod_kifacrq.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状態を取得</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、すべてが簡単です。</font><font style="vertical-align: inherit;">このコンテキスト</font></font><br>
<br>
<img src="https://habrastorage.org/webt/2n/om/aq/2nomaqdui4jxeusbrlzucow9dck.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
を魔法</font></font><code>getter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">にかけ、そこからプロパティを呼び出します。</font><font style="vertical-align: inherit;">これで、誰も何も接続しないと値を変更できなくなります</font></font><code>Trait</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/m7/iu/_y/m7iu_yazwpqoc4hxhlg6rv4srbo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべての魔法のメソッドはオーバーライドされ、オブジェクトの不変性を実装します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jy/he/ht/jyheht4ncrsuwsh7ngerdnd5x4m.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リサチェンコ/不変オブジェクト </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
予想通り、すべてがすぐにライブラリで正式化され、使用できるようになります。</font></font><br>
<br>
<pre><code class="plaintext hljs">composer show /immutable-object --all<font></font>
name     : /immutable-object<font></font>
descrip. : Immutable object library<font></font>
keywords : <font></font>
versions : * dev-master<font></font>
type     : library<font></font>
license  : MIT License (MIT)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ライブラリはかなりシンプルに見えます。</font><font style="vertical-align: inherit;">接続してクラスを作成します。</font><font style="vertical-align: inherit;">プライベート、保護、パブリックというさまざまなプロパティがあります。</font><font style="vertical-align: inherit;">接続し</font></font><code>ImmutableTrait</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xj/gt/pe/xjgtpettshurwn257f51iaj5u78.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、オブジェクトを1回開始できます-その値を確認してください。</font><font style="vertical-align: inherit;">それは本当にそこに保存され、実際のDTOのよ​​うに見えます。</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">object</span> (MagicObject) [<span class="hljs-number">3</span>]
    <span class="hljs-keyword">public</span> <span class="hljs-string">'value'</span> =&gt; <span class="hljs-keyword">int</span> <span class="hljs-number">200</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、たとえばそのように変更しようとすると、</font></font><br>
<br>
<img src="https://habrastorage.org/webt/su/s2/dh/sus2dhhps9ts4gwpx5nxk9301m4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...すぐにそれを受け取ります</font></font><code>fatal exception</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">プロパティは不変なので変更できません。</font><font style="vertical-align: inherit;">どうして？</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sh/iy/1c/shiy1cl8vmbfmwzbmah8whsbnyu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エキサイティングなチャレンジに参加して、それをデベースしようとすると、次のようになります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ga/ym/l6/gayml6qurl3mr1o6qpvhzk1_rgi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これが私のプレゼントです。</font><font style="vertical-align: inherit;">このクラス内のPHPStorm内で失敗しようとするとすぐに、コマンドの実行が即座に停止します。</font><font style="vertical-align: inherit;">私はあなたにこのコードを掘り下げてほしくない-それはあまりにも危険です。</font><font style="vertical-align: inherit;">彼は何もする必要がないことを警告します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トリック＃6。</font><font style="vertical-align: inherit;">スレッド処理</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
設計を検討してください。</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">include</span> <span class="hljs-string">'php://filter/read=string.toupper/resource=magic.php'</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは魔法のようなものです：PHPフィルター</font></font><code>read</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、最後にある種のmagic.php </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルが接続され</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">このファイルは非常にシンプルに見えます。</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-keyword">echo</span> <span class="hljs-string">'Hello, world!'</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
大文字と小文字が異なることに注意してください。</font><font style="vertical-align: inherit;">ただし、デザインを通じてファイルに「入力」すると、次のようになります。</font></font><br>
<br>
<pre><code class="php hljs">HELLO, WORLD!</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その瞬間に何が起こりましたか？</font><font style="vertical-align: inherit;">PHPフィルターの構造を使用すると、</font></font><code>include</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自分のフィルターを含む任意のフィルターを接続して、ソースコードを分析できます。</font><font style="vertical-align: inherit;">あなたはこのソースコードのすべてを管理しています。</font></font><code>final</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスやメソッドから</font><font style="vertical-align: inherit;">削除</font><font style="vertical-align: inherit;">したり、プロパティを公開したりできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私のアスペクトフレームワークの一部はこれに基づいています。</font><font style="vertical-align: inherit;">クラスが接続されると、クラスが分析され、実行されるクラスに変換されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PHPの箱から出してすぐに、既製のフィルターの束がすでにたくさんあります。</font></font><br>
<br>
<pre><code class="php hljs">var_dump(stream_get_filters()); 
<span class="hljs-keyword">array</span> (size=<span class="hljs-number">10</span>)
<span class="hljs-number">0</span> =&gt; <span class="hljs-keyword">string</span> <span class="hljs-string">'zlib.*'</span> (length=<span class="hljs-number">6</span>)
<span class="hljs-number">1</span> =&gt; <span class="hljs-keyword">string</span> <span class="hljs-string">'bzip2.*'</span> (length=<span class="hljs-number">7</span>)
<span class="hljs-number">2</span> =&gt; <span class="hljs-keyword">string</span> <span class="hljs-string">'convert.iconv.*'</span> (length=<span class="hljs-number">15</span>)
<span class="hljs-number">3</span> =&gt; <span class="hljs-keyword">string</span> <span class="hljs-string">' string.rotl3'</span> (length=<span class="hljs-number">12</span>)
<span class="hljs-number">4</span> =&gt; <span class="hljs-keyword">string</span> <span class="hljs-string">'string.toupper'</span> (length=<span class="hljs-number">14</span>)
<span class="hljs-number">5</span> =&gt; <span class="hljs-keyword">string</span> <span class="hljs-string">'string.tolower'</span> (length=<span class="hljs-number">14</span>)
<span class="hljs-number">6</span> =&gt; <span class="hljs-keyword">string</span> <span class="hljs-string">'string.strip_tags'</span> (length=<span class="hljs-number">17</span>)
<span class="hljs-number">7</span> =&gt; <span class="hljs-keyword">string</span> <span class="hljs-string">'convert.*'</span> (length=<span class="hljs-number">9</span>)
<span class="hljs-number">8</span> =&gt; <span class="hljs-keyword">string</span> <span class="hljs-string">'consumed'</span> (length=<span class="hljs-number">8</span>)
<span class="hljs-number">9</span> =&gt; <span class="hljs-keyword">string</span> <span class="hljs-string">'dechunk'</span> (length=<span class="hljs-number">7</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンテンツを「圧縮」して、大文字または小文字に変換できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私が見せたかった主なトリックは終わりました。</font><font style="vertical-align: inherit;">次に、アスペクト指向プログラミングという、私ができるすべての真髄に移りましょう。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トリック＃7。</font><font style="vertical-align: inherit;">アスペクト指向プログラミング</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコードを見て、あなたの観点からそれが良いか悪いかを考えてください。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xx/za/wa/xxzawap4whyavczg4g5ptvsx6q0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードは非常に適切であるようです。</font><font style="vertical-align: inherit;">彼はアクセス権をチェックし、ロギングを実行し、ユーザーを作成し、持続し、キャッチしようとし</font></font><code>exception</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この麺をすべて見ると、それぞれの方法で繰り返されています。ここで価値があるのは、緑色でマークされているものだけです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/uk/za/mo/ukzamorqli1-u6wijf7d7knpwu4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その他すべて：「二次的な懸念」または「横断的な懸念」は、横断的な機能です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
従来のOOPでは、これらの構造のすべてをコピーして貼り付けたり、削除したり、どこかで削除したりすることはできません。</font><font style="vertical-align: inherit;">あなたがそれを繰り返さなければならないので、これは悪いです。</font><font style="vertical-align: inherit;">私はコードが常にきれいに整頓されているように見えることを望みます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hg/vw/pm/hgvwpmdhsbhaeeh0uj5tdngunqo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのため、ログが含まれず（なんらかの方法で適用されます）、含まれていません</font></font><code>security</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yz/-4/i2/yz-4i2yxrju_ti0839xg7idj5ua.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、ロギング... </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sb/g1/8u/sbg18ud79gi4fg2dhc4h__ojxie.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...とセキュリティチェック</font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">を含め、これだけで</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3p/-s/07/3p-s07k5zl65ze55vxs4iddkia8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実行できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そしてそれは可能です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用語集「アスペクト」</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アスペクトというものがあります。</font><font style="vertical-align: inherit;">これは、権限を確認する簡単な例です。</font><font style="vertical-align: inherit;">彼のおかげで、PhpStormのプラグインによって強調表示されている注釈が表示されます。</font><font style="vertical-align: inherit;">「アスペクト」は、この条件を適用するコード内のどのポイントを指すSQL式を宣言します。</font><font style="vertical-align: inherit;">以下では、たとえば、クラスのすべてのパブリックメソッドに</font></font><code>UserService</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クロージャ</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jx/y_/g4/jxy_g4pvoli4gjezfp3w1vqpkpi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クロージングは​​メソッドによって取得され</font></font><code>$invocation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ym/ju/mp/ymjump3eozldipcvntd-lpo9zbi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、</font></font><code>reflection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">より多くの引数を含む</font><font style="vertical-align: inherit;">メソッドの上にある種のラッパー</font><font style="vertical-align: inherit;">です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、各メソッドのこのコールバックでは、必要なアクセス権を確認できます。これは「アドバイス」と呼ばれます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/i8/zz/pq/i8zzpqsvck05an3amyc8hihxj00.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「PHP様、クラスからpublicメソッドを呼び出す前にこのメソッドを適用してください</font></font><code>UserService</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。」</font><font style="vertical-align: inherit;">たった1行ですが、非常に便利です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アスペクトvsイベントリスナー</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
わかりやすくするために、アスペクトとイベントリスナーを比較しました。多くの人々がsymfonyで働いており、Event Dispatcherが何であるかを知っています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5v/8o/ge/5v8oge0pczc4pteufmb0bvxf-da.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば</font></font><code>AutorizationChecker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font><font style="vertical-align: inherit;">ある種の依存関係を転送し</font><font style="vertical-align: inherit;">、この場合に適用する場所を宣言する</font><font style="vertical-align: inherit;">という点で、これらは似てい</font><font style="vertical-align: inherit;">ます。リスナーの場合、これは</font></font><code>SubscrabingEvent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と呼ばれ</font><font style="vertical-align: inherit;">、この</font></font><code>UserCreate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合、</font></font><code>Aspect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">からのパブリックメソッドのすべての呼び出しにサブスクライブします</font></font><code>UserService</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。同時に、コールバックハンドラー自体の内容はほぼ同じです。単にチェックして、それに応じて対応するだけです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
内部でどのように機能するかを見てみましょう。</font><font style="vertical-align: inherit;">アスペクトフレームワークが必要とする</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初のステップ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登録</font></font></b> <code>Aspects</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-i/ae/iy/-iaeiyqqw4oar3tyxzbe4au38n8.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2段階</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。これを処理するために、以前のものを再び使用します。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PHPフィルターのトリック</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6z/sq/da/6zsqda5rxa9alxpilq57s0wyspc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これはソースコードを変換する特別なコンポーネントです。彼はこっそりこれを行いますが、OPcacheと統合されているため、本番環境でうまく機能します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3段階</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。すべてがレベルに統合されています</font></font><code>Composer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。 Goがインストールされたら！ AOP、彼は密接に協力し始め</font></font><code>Composer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、どのファイルからダウンロードするかについて同意します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/or/v8/l9/orv8l9yh9swl-mxtzowmrzoomm4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのため、あなたはせずに、同時にコードのバージョンをロードすることができ</font></font><code>Aspects</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、そして持ちます</font></font><code>Aspects</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。これは、環境で設定することによって文字通り行うことができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、かなり複雑な資材を開始します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PHPパーサー</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。この難しい作業を行うには、手品を起動します。最初にソースコード全体を</font><b><font style="vertical-align: inherit;">分析する</font></b><font style="vertical-align: inherit;">必要があります</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。それは、このような素晴らしいがあることが良いことだ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ニキータポポフの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライブラリ</font><font style="vertical-align: inherit;">として</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PHPパーサー</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。トークン化と、すべてのコードの抽象構文ツリーの構築を可能にします。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/eg/ys/dm/egysdmlqf0bbvkmnacewmrrx-bw.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4段階</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">goaop / parser-reflection</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">という別のライブラリを作成しました</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/b_/oc/6d/b_oc6dfphlk-dtq3jxoijxzmn3i.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これはASTツリーの上で動作し、メモリに読み込まずにソースコードを反映できます。これは私にとって重要です。クラスがメモリに読み込まれるとすぐに、そこからアンロードすることはできません。しかし、その構造を事前に知りたいのです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、現在のファイルの分析を取り上げます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/9p/lu/an/9pluanmjyprlie0muf8sndyudba.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その中にあるクラスのおかげで、その中にどのクラスがあり、どのように変更するかがわかります</font></font><code>Aspect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3u/36/3z/3u363ztvggoi6ugvvsunvuilvuy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
出力は、元のクラスを装飾する単純なクラスの形で、非常にきちんとしていて便利です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7z/tv/8p/7ztv8pyc8zti-wlpidlp3fm2zqk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フレームワークの特殊性は、クラスを同じ名前のまったく同じクラスに置き換え、キャッシュ内の元のクラスの名前を変更することです。変更されるのは元のコードではありません。別のバージョンがキャッシュに作成され、クラス名がわずかに変更されてから、このクラスから継承されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ea/o9/zn/eao9znftd3ywdjzd14acr-9w-fe.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスがfinalであっても継承があります。したがって、最終的なメソッドと最終的なクラスの両方をキャッチできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aspect MOCKライブラリは私のフレームワークの上で実行されます。最終的なメソッドや静的メソッドを含め、「ロック」することができます。それはすべて内部で機能します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
オーバーライドされたメソッドはかなりシンプルに見えます-呼び出します</font></font><code>joinPoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">アスペクト指向プログラミングに関しては、すべてが呼び出され</font></font><code>joinPoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます：各メソッド、プロパティへのアクセス、関数のインターセプト、または作成。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次は何ですか？</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに信じられないほどの機会が開かれます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AOP CoreのOPcacheプリロード</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">AOPエンジン全体は、アプリケーションのロード段階でプリコンパイルされます。</font><font style="vertical-align: inherit;">これにより、実行のオーバーヘッドが10ミリ秒からゼロに減少します。</font><font style="vertical-align: inherit;">フレームワークのブートストラップはほとんど何も占有せず、フレームワーク全体がPHPのメモリに配置されます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バイナリオペコードを変更するためのFFI統合</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">次に、バイナリオペコードを変更します。</font><font style="vertical-align: inherit;">PHPオペコードを使用するとすぐに、ファイルシステムに名前の付いたファイルが生成されます</font></font><code>.bin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">FFIを使用すると、すべてがうまくいきます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PHPエンジンの内部コールバックの変更</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">またはユーザーランドによるPHPエンジンの変更。</font><font style="vertical-align: inherit;">PHP内にはグローバル変数があります。</font><font style="vertical-align: inherit;">FFIを介してユーザーランドでPHPを接続すると、その内部プロパティ、クラス、構造にアクセスできます。</font><font style="vertical-align: inherit;">これを活用してみませんか。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これに気づくまで魔法を止めます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トリック＃8。</font><font style="vertical-align: inherit;">goaop /フレームワーク</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは私のフレームワークで、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHubに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あり、そこには1,000を超えるスターがあります。</font></font><br>
<br>
<pre><code class="plaintext hljs">composer show goaop/framework --all<font></font>
name   : goaop/framework<font></font>
descrip. : Framework for aspect-oriented programming in PHP.<font></font>
keywords : php, aop, library, aspect<font></font>
versions : dev-master, 3.0.x-dev, 2.x-dev, 2.3.1, …<font></font>
type   : library<font></font>
license : MIT License</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
魔法が怖い方のために、PhpStorm用のプラグインの形でアシスタントを作成しました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ut/ah/rp/utahrp4yrgxj7ch2d0brjr_p7fk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このプラグインは、ポイントカットの構文を強調表示できるという点で便利です。</font><font style="vertical-align: inherit;">処理したい方法と方法を知っています。</font><font style="vertical-align: inherit;">彼はナビゲーションも提供します-移動したいメソッドへのメソッドのツールチップを強調表示します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トリック＃9。</font><font style="vertical-align: inherit;">遅延メソッド</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、アスペクトフレームワークをすでに使用している別のトリックを実行します。遅延メソッドの実行方法を見てみましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アイデアは非常に単純です。メソッドの1つがゆっくりと機能するコードがあります。そのような場合は、このコードを今まで実行することをお勧めします</font></font><code>fastcgi_finish_request</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。これは私には不快に思えます。どこに置くか覚えておく必要があるので、コールバックをねじ込んでください-それはネイティブに見えません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は何を提案し、どのように機能しますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
と呼ばれるdoctrineアノテーションを作成し、</font></font><code>Deffered</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それが任意のメソッドで使用されることをマークします。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yy/zh/7d/yyzh7dcpvv14sd3r75kroe07xky.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、を作成します</font></font><code>Aspect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。これは、アノテーションを含むメソッドの呼び出しの前後で</font></font><code>Deffered</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、次のコードを実行する必要があることを示しています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cc/y5/zj/ccy5zjad0olfwzemsxmnmo8mi_c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロパティ内</font></font><code>Aspect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">遅延メソッドの蓄積を開始します。呼び出されたメソッド、このコールバックが呼び出されたオブジェクト、およびコールバックが呼び出された引数を保存します。このコードの実行は許可されていません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Reactのファンはここに何があるべきかを見るでしょう</font></font><code>promise</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。この時点で、私たちはいつかこのメソッドが実行されることを約束し、いつかはその実行を終了してソリューションを取得することを約束しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これがすべて内部でどのように機能するかを見てみましょう。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yp/zl/zp/ypzlzpf5k7tmuiculbcntozf0ga.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
で</font></font><code>shutdown_function</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接</font><font style="vertical-align: inherit;">登録</font><font style="vertical-align: inherit;">してください</font></font><code>Aspect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。アプリケーションが起動するとすぐに、アプリケーションが終了した後、callbackを呼び出す必要があることを伝えるコールバックがあります</font></font><code>onPhpTerminate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。この方法では、</font></font><code>fastcgi_finish_request</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして、「すべて、作成されたすべてのコンテンツをクライアントに送信してください。」そして今だけ、遅延メソッドを一度に1つずつ実行し始めます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、いくつかのコードと同期呼び出しがあるとします</font></font><code>sendPushNotification</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/z4/4g/g0/z44gg0rpyaguh-rs8xge_tf6ync.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
悪い人が彼を遅らせたとしましょう-彼は2秒間寝ています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/v9/oa/rr/v9oarrwwsrifqgxpfpldsbezd4s.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アプリケーションにリクエストを出すクライアントが応答をさらに2秒間待つことは望ましくありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このメソッドにのタグを付けるだけ</font></font><code>Deferred</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/62/um/gw/62umgw3pjrqokgzk462oyhtlcpu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードは即座に飛んでいき、クライアントは即座に応答を受け取ります。リクエストが完了した後、バックグラウンドでどこかに、クライアントに干渉しない通知が送信されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それで全部です。あなたが魔法のレッスンを楽しんで、あなたにいくつかの考えを促したことを願っています。コメントをいただければ幸いです。</font></font><br>
<br>
<blockquote>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">PHP Russia 2020</a>   . &nbsp;   &nbsp; &nbsp;— <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>.  &nbsp;<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a> &nbsp;<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">telegram-</a>,      &nbsp;PHP Russia 2020.</blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja478596/index.html">PHP匿名関数：ブラックマジックセッションの公開</a></li>
<li><a href="../ja478602/index.html">UnityのMVCとスクリプト可能なオブジェクト。パート2</a></li>
<li><a href="../ja478604/index.html">労働者からPHPプログラマーまで。異常な開発経歴</a></li>
<li><a href="../ja478606/index.html">「おやすみ」-スマートガジェットが人々の睡眠を奪う方法</a></li>
<li><a href="../ja478616/index.html">Windows UACは驚かずにはいられません、またはインサイダーを検出する方法</a></li>
<li><a href="../ja478620/index.html">FastAPIを試す必要があるのはなぜですか？</a></li>
<li><a href="../ja478622/index.html">A / Bテスト、パイプライン、小売：GeekBrainsとX5 Retail Groupのビッグデータに関するブランド四半期</a></li>
<li><a href="../ja478626/index.html">straceを使用したソフトウェア展開のデバッグ</a></li>
<li><a href="../ja478628/index.html">中国語の高いCRI</a></li>
<li><a href="../ja478630/index.html">パスカルは囲碁を演じます。アマチュアコンパイラでのメソッドとインターフェイスの実装</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>