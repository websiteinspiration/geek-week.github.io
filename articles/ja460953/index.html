<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👖 🙋 🤕 ポインタは複雑ですか、またはバイトに何が格納されていますか？ 👟 🗑️ 🖕🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="こんにちは、ハブル！「ポインタが複雑である、またはバイトに何があるのか​​」という記事の翻訳を提示します。ラルフ・ジョンの著作。
 

この夏、私は再びRustにフルタイムで取り組んでいます。また、Rust / MIRの「メモリモデル」についても（とりわけ）作業します。しかし、自分の考えについて話す...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ポインタは複雑ですか、またはバイトに何が格納されていますか？</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460953/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こんにちは、ハブル！</font><font style="vertical-align: inherit;">「ポインタが複雑である、またはバイトに何があるのか​​」という記事の翻訳を提示します。</font><font style="vertical-align: inherit;">ラルフ・ジョンの著作。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この夏、私は再びRustにフルタイムで取り組んでいます。また、Rust / MIRの「メモリモデル」についても（とりわけ）作業します。しかし、自分の考えについて話す前に、「ポインタは単純です。それらは単なる数字である」という神話を払拭する必要があります。このステートメントの両方の部分は、少なくともRustやCなどの安全でない機能を備えた言語では誤りです：ポインターを素数または（通常の）数値と呼ぶことはできません。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さらに複雑な部分について説明する前に、メモリモデルの</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">どの</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分に対処する必要があるかについても説明したいと思い</font><font style="vertical-align: inherit;">ます。メモリに格納されて</font><em><font style="vertical-align: inherit;">いる</font></em><font style="vertical-align: inherit;">データ</font><em><font style="vertical-align: inherit;">はどのような形式</font></em><font style="vertical-align: inherit;">ですか？</font><font style="vertical-align: inherit;">メモリは、バイト、アドレス指定可能な最小単位、およびアクセス可能な最小要素（少なくともほとんどのプラットフォーム）で構成されていますが、可能なバイト値は何ですか？</font><font style="vertical-align: inherit;">繰り返しになりますが、「これは単なる8ビットの数値です」という答えは適切ではありません。</font></font><a name="habracut"></a></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この投稿を読んだ後、両方の発言について私に同意していただければ幸いです。</font></font></p><br>
<h1 id="ukazateli-slozhny"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポインターは複雑です</font></font></h1><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「ポインタは通常の数です」の何が問題になっていますか？</font><font style="vertical-align: inherit;">次の例を見てみましょう：（ここではC ++を使用しています。C++で安全でないコードを書くのはRustで書くよりも簡単であり、安全でないコードは問題が発生する場所にすぎません。安全でないRustとCはすべて同じ問題を抱えています。およびC ++）。</font></font></p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">auto</span> x = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[<span class="hljs-number">8</span>];
    <span class="hljs-keyword">auto</span> y = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[<span class="hljs-number">8</span>];<font></font>
    y[<span class="hljs-number">0</span>] = <span class="hljs-number">42</span>;
    <span class="hljs-keyword">int</span> i = <span class="hljs-comment">/* -     */</span>;
    <span class="hljs-keyword">auto</span> x_ptr = &amp;x[i];<font></font>
    *x_ptr = <span class="hljs-number">23</span>;
    <span class="hljs-keyword">return</span> y[<span class="hljs-number">0</span>];<font></font>
}</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y [0]の最後の読み取りを42の戻り値で最適化することは、常に非常に有益です。</font><font style="vertical-align: inherit;">この最適化の根拠は、xを指すx_ptrを変更してもyを変更できないことです。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ただし、C ++などの低レベル言語を扱う場合、iに値yxを割り当てることにより、この仮定に違反する可能性があります。</font><font style="vertical-align: inherit;">＆x [i]はx + iと同じなので、23を＆y [0]に書き込みます。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">もちろん、これはC ++コンパイラがそのような最適化を行うことを妨げるものではありません。</font><font style="vertical-align: inherit;">これを解決するために、標準ではコードに</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">があるとしています</font><font style="vertical-align: inherit;">。</font></font></p><br>
<p>-,        (    &amp;x[i]),      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">     </a>.     : x[i]    x,    UB.  ,  <em></em>  x_ptr  UB,         ,    <em></em>  .</p><br>
<p>(, i = y-x   UB,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">   ,      </a>.      i = ((size_t)y — (size_t)x)/sizeof(int),    .)</p><br>
<p>    :     ,       .         <em> </em>  ,    . (     vec.end()      C++98.)</p><br>
<p>   :</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">auto</span> x = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[<span class="hljs-number">8</span>];
    <span class="hljs-keyword">auto</span> y = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[<span class="hljs-number">8</span>];<font></font>
    y[<span class="hljs-number">0</span>] = <span class="hljs-number">42</span>;
    <span class="hljs-keyword">auto</span> x_ptr = x+<span class="hljs-number">8</span>; <span class="hljs-comment">//   </span>
    <span class="hljs-keyword">if</span> (x_ptr == &amp;y[<span class="hljs-number">0</span>])<font></font>
      *x_ptr = <span class="hljs-number">23</span>;
    <span class="hljs-keyword">return</span> y[<span class="hljs-number">0</span>];<font></font>
}</code></pre><br>
<p>  ,  x  y   <em>  </em>,  y   .  x_ptr  <em> </em> y!      .     UB -    .</p><br>
<p>,      .   C++     ,    :         x_ptr.  ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">   </a>, x_ptr       .  <em></em>      , <em>     </em>. (      ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">LLVM   </a>.)</p><br>
<p>    ,  x_ptr  &amp;y[0]    <em></em>,     <em> </em>,        : &amp;y[0]     y; x_ptr     x.    *x_ptr = 23  *&amp;y[0] = 0,    ,    ,      .</p><br>
<p>  :</p><br>
<blockquote>,       ,   ,        .</blockquote><p>,   .   ,        ,   LLVM  GCC.</p><br>
<p> ,    " " —     C/C++,      .   —   restrict  C,       ,     ( ):</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">foo</span><span class="hljs-params">(<span class="hljs-keyword">int</span> *<span class="hljs-keyword">restrict</span> x, <span class="hljs-keyword">int</span> *<span class="hljs-keyword">restrict</span> y)</span> </span>{<font></font>
    *x = <span class="hljs-number">42</span>;
    <span class="hljs-keyword">if</span> (x == y) {<font></font>
        *y = <span class="hljs-number">23</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> *x;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">int</span> x;
    <span class="hljs-keyword">return</span> foo(&amp;x, &amp;x);<font></font>
}</code></pre><br>
<p> test()  UB,        foo      .  *y  *x  foo,    ,       UB.  :   ,  x  y   ,    .</p><br>
<p> —     .</p><br>
<h1 id="prostaya-model-ukazateley">  </h1><br>
<p>   ?     .   ,     .</p><br>
<p>  :    <em> </em> . ,      .       ,     C++.        ,       UB,  . C++  Rust   ""     ,     .    ,          ,      ,      - .     " ",        — ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  </a>.</p><br>
<p>   (        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">CompCert</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  RustBelt</a>,   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> miri</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>):  —   - ID,     (allocation),     .     Rust:</p><br>
<pre><code class="rust hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Pointer</span></span> {<font></font>
    alloc_id: <span class="hljs-built_in">usize</span>,<font></font>
    offset: <span class="hljs-built_in">isize</span>,<font></font>
}</code></pre><br>
<p>  ()    ( )    ,         .       ,        (   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">C++</a>).</p><br>
<p>(   ,  C++     ,    . , LLVM    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>.)</p><br>
<p> ( miri    ),       .   ,      ,      " "         .   miri  ,     ( &amp;x[8])  UB.</p><br>
<h1 id="nasha-model-razvalivaetsya-na-kuski">    </h1><br>
<p>        ,     .       ,        .  miri          ,      (. .  <em></em> ,   ),  <em></em>   (. .     ). ,     2   ,    ,   "     2".</p><br>
<p>  :  <em></em>  ,       . ,     .    ,    ,   ,      (       —     miri    ):       " ",        ,         .     () ID.                 ,  -         …         , ,   ,        .   —    .   ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>,        .</p><br>
<p> ,        ,     ,    .     ,   ,   ,         .          miri        ,   ,    .    ,  C++  Rust, ,       ,   ,    .   ,    ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  </a>.</p><br>
<p>       .</p><br>
<h1 id="ot-ukazateley-k-baytam">   </h1><br>
<p> ,     ,   —    ,   ,         C++  ( ) Rust.   ,             u8.  ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> memcpy</a>,        -   v,        .  ,      ?   —   ID    ,      ?   ,    v,    -    . (    ,    ,     .   ,      Ponter.)</p><br>
<p>         0..256 (.:    0 , 256 — ).  ,       ,  ""   (,       )  ,           .    ,        ""     .  ,   <em></em>   0..256 (" "), <em></em> n-  -  .          Rust,     :</p><br>
<pre><code class="rust hljs"><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">ByteV1</span></span> {<font></font>
  Bits(<span class="hljs-built_in">u8</span>),<font></font>
  PtrFragment(Pointer, <span class="hljs-built_in">u8</span>),<font></font>
}</code></pre><br>
<p>, PtrFragment(ptr, 0)      ptr.  , memcpy  ""    ,     ,     .  32-    ptr   4 :</p><br>
<pre><code class="rust hljs">[PtrFragment(ptr, <span class="hljs-number">0</span>), PtrFragment(ptr, <span class="hljs-number">1</span>), PtrFragment(ptr, <span class="hljs-number">2</span>), PtrFragment(ptr, <span class="hljs-number">3</span>)]</code></pre><br>
<p>            ,     memcry.       ;    ,       .</p><br>
<h1 id="neinicializirovannaya-pamyat"> </h1><br>
<p>       "".     ,      :      <em></em>.       (,     Pointer  ):</p><br>
<pre><code class="rust hljs"><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">Byte</span></span> {<font></font>
  Bits(<span class="hljs-built_in">u8</span>),<font></font>
  PtrFragment(Pointer, <span class="hljs-built_in">u8</span>),<font></font>
  Uninit,<font></font>
}</code></pre><br>
<p>   Uninit      ,       - .      ,    <em></em>    (,  )   UB.</p><br>
<p>     LLVM      poison. ,  LLVM <em></em>   undef,         . ,   Uninit  undef  (undef  -  ""),    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> undef  LLVM     poison</a>.</p><br>
<p>  ,        Uninit.     -  b: u8    ,    Bits(b)    ?      . ,  ,            .             LLVM,       ,        .   :     Uninit   :  ,   ,      UB.</p><br>
<p>,    C    Uninit:</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">int</span> x;
    <span class="hljs-keyword">if</span> (condA()) x = <span class="hljs-number">1</span>;
    <span class="hljs-comment">//     ,       ,  condA()</span>
    <span class="hljs-comment">//  ,      x.</span>
    use(x); <span class="hljs-comment">//  x = 1.</span>
}</code></pre><br>
<p> Uninit     ,  x    Uninit,   1,    Uninit  1 ,   .  Uninit x   "-   ",  1,        .</p><br>
<p>(  ,      ,    ,      ,          x. Uninit       .)</p><br>
<p>, Uninit       miri.        "     " (. .  ),          ,   ,       .  Uninit     ,  miri       ,       .</p><br>
<h1 id="zaklyuchenie"></h1><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C ++やRust（実際のコンピューターとは異なります）などの言語では、同じアドレスを指している場合でもポインターが異なる可能性があり、1バイトは0..256の範囲の単なる数値ではないことがわかりました。</font><font style="vertical-align: inherit;">したがって、1978年にC言語が「ポータブルアセンブラ」になる可能性がある場合、今ではそれは信じられないほど誤ったステートメントです。</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja460943/index.html">Googleデータスタジオ（+テンプレート）でのシナリオ予測に基づいてSEOの有望なキーを選択する方法</a></li>
<li><a href="../ja460945/index.html">電報チャネルを使用してゲームスタジオの認知度を高め、収益を拡大した経験</a></li>
<li><a href="../ja460947/index.html">WASMミートアップ1/08</a></li>
<li><a href="../ja460949/index.html">「そして不可能は可能です」：バイナリ分析を使用してブラックボックスを白に変えます</a></li>
<li><a href="../ja460951/index.html">Androidライブ壁紙を作成する</a></li>
<li><a href="../ja460955/index.html">コンストラクターとセッターにパラメーターを値渡しするための教育プログラム（最新のC ++、例）</a></li>
<li><a href="../ja460959/index.html">マイクロソフトの新しいテクノロジーにより、実在する人物の3Dコピーで任意の言語を話すことができます</a></li>
<li><a href="../ja460961/index.html">混合Swift + Objective-Cプロジェクトでの単体テストのセットアップ</a></li>
<li><a href="../ja460965/index.html">これらのストーリーボードなしでコントローラーを分割</a></li>
<li><a href="../ja460967/index.html">トロイハント：情報技術の専門家のための10の個人的な金融レッスン</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>