<!doctype html>
<html class="no-js" lang="ar">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ฆ ๐ง๐ผ ๐ฎ ูุฑุฑ ุชุญููู ูุฌููุนุฉ Power BI ุจุงุณุชุฎุฏุงู Python ๐ฃ ๐คฑ ๐ช</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุณุงุก ุงูุฎูุฑ ุฃููุง ุงููุฑุงุก! ูุงู ุณุจุจ ูุชุงุจุฉ ูุฐุง ุงูููุดูุฑ ูุฏูุฉ ุนุจุฑ ุงูุฅูุชุฑูุช ุ ูุธุฑุช ูููุง ุนูู ููุชููุจ. ูุงู ูุฎุตุตูุง ูุฅุฌุฑุงุก ุชุญููู ุฌูุงุนู ูููุจูุนุงุช. ุงุณุชุฎุฏู ุงููุคูู ูุธุงู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ูุฑุฑ ุชุญููู ูุฌููุนุฉ Power BI ุจุงุณุชุฎุฏุงู Python</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/501492/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุณุงุก ุงูุฎูุฑ ุฃููุง ุงููุฑุงุก! </font><font style="vertical-align: inherit;">ูุงู ุณุจุจ ูุชุงุจุฉ ูุฐุง ุงูููุดูุฑ ูุฏูุฉ ุนุจุฑ ุงูุฅูุชุฑูุช ุ ูุธุฑุช ูููุง ุนูู ููุชููุจ. </font><font style="vertical-align: inherit;">ูุงู ูุฎุตุตูุง ูุฅุฌุฑุงุก ุชุญููู ุฌูุงุนู ูููุจูุนุงุช. </font><font style="vertical-align: inherit;">ุงุณุชุฎุฏู ุงููุคูู ูุธุงู Power BI Desktop ููุนูู ูุน ุงูุจูุงูุงุช. </font><font style="vertical-align: inherit;">ูู ุฃูุฏู ุฑุงุจุทูุง ููููุฏูู ุงููุญุฏุฏ ุญุชู ูุง ูุชู ุงุนุชุจุงุฑ ูุฐู ุงูููุงูุฉ ูุฅุนูุงู ุ ูููู ูู ุณูุงู ุงูุณุฑุฏ ุณุฃุญุงูู ุฃู ุฃูุณุฏ ุงููุตุฏุฑ ุงูุฃุตูู ูู ุฃุฌู ุดุฑุญ ููุทู ูุฑุงุฑู ุจุดูู ุฃูุถู. </font><font style="vertical-align: inherit;">ุฃุนุทุงูู ูุฐุง ุงูุจุฑูุงูุฌ ุงูุชุนูููู ุนูู ุงูููุจ ููุฑุฉ ุฃูู ุณูููู ูู ุงููุซูุฑ ููุงูุชูุงู ุชูุฑุงุฑ ุฅููุงููุงุช ุตูุบ DAX ูุน ูุธุงุฆู ููุชุจุฉ Pandas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุทุชุงู ุฃุฑูุฏ ุงูุชุฑููุฒ ุนููููุง. ุฃููุงู ุ ูุฐู ุงููุงุฏุฉ ูุฎุตุตุฉ ูููุญูููู ุงููุจุชุฏุฆูู ุงูุฐูู ูุชุฎุฐูู ุฎุทูุงุชูู ุงูุฃููู ูู ุงุณุชุฎุฏุงู ูุบุฉ ุจุฑูุฌุฉ Python. ูุซุงููุฉ ุฅุฐุง ูุงู ุงููุฑุงุก ุนูู ุฏุฑุงูุฉ ุจููุตุฉ ุงูุชุญูููุงุช Power BI BI. ุซุงูููุง ุ ูุธุฑูุง ูุฃู ุญุณุงุจุงุช DAX ูุงูุช ุจูุซุงุจุฉ ูุตุฏุฑ ููุฅููุงู ุ ูุณุฃููู "ุจูุณุฎ" ุฎูุงุฑุฒููุงุช ุงููุคูู ุฅูู ุฃูุตู ุญุฏ ูููู ุ ููุง ุจุฏ ุฃู ูููู ููุงู ุฎุฑูุฌ ุนู ููุงุฐุฌ ุงูุจุฑูุฌุฉ ุงูุฑุฆูุณูุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุน ุงูููุฏูุฉ ุ ูุฐุง ูู ุดูุก. ููุตู ุงูู ุงูุทุฑูู!</font></font><br>
<br>
<a name="habracut"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูููู ุจุฌููุน ุงูุญุณุงุจุงุช ูู ุจูุฆุฉ JupyterLab. ูููู ุงูุนุซูุฑ ุนูู ุญููู ุงูููุจููุชุฑ ุงููุญููู ุนูู ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุชู ุชุญููู ุงูุจูุงูุงุช ูู Power BI ุจุงุณุชุฎุฏุงู ุฃุฏุงุฉ Power Query (ูู ุงููุงูุน ุ ูู ูุญุฑุฑ ูุฑุฆู ูููู ุจุฅูุดุงุก ุงุณุชุนูุงูุงุช ุจุงููุบุฉ M). ูุฌุจ ุงุชุจุงุน ุงููุงุนุฏุฉ ุงูุชุงููุฉ ุฃุซูุงุก ุงูุชุทููุฑ: ูุฌุจ ุฃู ุชุชู ุฌููุน ุนูููุงุช ุงููุนุงูุฌุฉ ุงููุณุจูุฉ ููุจูุงูุงุช ุจุงุณุชุฎุฏุงู Power Query ุ ููุฌุจ ุญุณุงุจ ุงูููุงููุณ ุจุงุณุชุฎุฏุงู Power Pivot. ูุธุฑูุง ูุฃู ููุชุจุชูุง ุงูุฑุฆูุณูุฉ ูู Pandas ุ ูุฅููุง ูุณุชุฎุฏู ูุฏุฑุงุชูุง ุนูู ุงูููุฑ.</font></font><br>
<br>
<pre><code class="python hljs">%%time
<span class="hljs-comment">#   </span>
path_to_data = <span class="hljs-string">"C:/Users/Pavel/Documents/Demo/"</span>
<span class="hljs-comment"># </span>
df = pd.read_csv(os.path.join(path_to_data, <span class="hljs-string">"ohortAnalysis_2016_2018.csv"</span>), sep=<span class="hljs-string">";"</span>, parse_dates=[<span class="hljs-string">"date"</span>], dayfirst=<span class="hljs-literal">True</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุณูููู ุจุงุฎุชุจุงุฑ ุณุทูุฑ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูู ููุช ุงูุชุดุบูู ูู ุฃุฌู ุฅูุดุงุก ุงูุฃูุณุงู ุงูุฃูุซุฑ ุงุณุชููุงููุง ููููุช ูู ุงููุณุชูุจู. ูุชุนููู ุงููุณุงุฑ ุงููุงูู ููููู ุงูููุฑูุก ุ ุงุณุชุฎุฏู ููุชุจุฉ os. ูุชุจุณูุท ุนูููุฉ ุชุทููุฑ ุฌูุงุฒ ููุจููุชุฑ ูุญููู ุ ููููู ุงูุงุณุชุบูุงุก ุนูู. ุชุชููู ูุฌููุนุฉ ุงูุจูุงูุงุช ููุณูุง ุจุดูู ุนุดูุงุฆู. ููุฌุฏ 1ุ048ุ575 ุณุทุฑ ูู ููู CSV. ุนุงุฏุฉ ูุง ุชููู ูุฑุงุกุฉ ุงูุจูุงูุงุช ุจุงุณุชุฎุฏุงู ูุธููุฉ read_csv () ูุจุงุดุฑุฉ. ูููู ุชุญุฏูุฏ ูุงุตู ุงูุนููุฏ ูุงูุนููุฏ ุจุชูุงุฑูุฎ ุ ุฅู ูุฌุฏุช ุ ูู ุงูุตููู. ุฅุฐุง ุชู ุชุญููู ุงููุนูููุงุช ูุน ุจุนุถ "ุงูููุฒุงุช" ุ ููุฏ ุชุญุชุงุฌ ุฅูู ุชูููู ูุนููุงุช ุฅุถุงููุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุชุญุฏูุฏ ุงูุชุฑููุฒ ููู ุนููุฏ.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุบุงูุจูุง ูุง ูุชู ุงุณุชุฎุฏุงู ูุธููุฉ head () ูู ุงูุญุงูุฉ ูุฑุตุฏ ุชูุฏู ุชุญููู ุงูุจูุงูุงุช ุจุดูู ูุฑุฆู. ูุง ูููู ูุทุน ุฌููุน ุงูุฃุฎุทุงุก ุ ูููู ูููู ุฅุตูุงุญ ุงูุนููุจ ุงููุงุถุญุฉ ุนูู ุงูููุฑ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุนุฏ ุชุญููู ุงูุจูุงูุงุช ูู ุงููููุฐุฌ ุ ูููู ูุคูู ุงูุญููุฉ ุงูุฏุฑุงุณูุฉ ุจุชุฑุชูุจ ูุฌููุนุฉ ุงูุจูุงูุงุช. ูุชู ุฐูู ูู ุฃุฌู ุฅุถุงูุฉ ุนููุฏ ูุณุงุนุฏ ูุน ุงูููุงุฑุณ. ูู ุญุงูุชูุง ุ ูู ูุชู ุงุณุชุฎุฏุงู ูุฐุง ุงูุนููุฏ ุ ูููู ุณูุชู ุฃูุถูุง ูุฑุฒ ุงูุจูุงูุงุช ูู ุฃุฌู ุงูุชุญูู ุจุดูู ุฃูุซุฑ ููุงุกูุฉ ูู ุงูุญุณุงุจ ุงูุตุญูุญ ููุญููู ูู ุงูุฌุฏุงูู.</font></font><br>
<br>
<pre><code class="python hljs">%%time
<span class="hljs-comment">#  ,      </span>
df.sort_values([<span class="hljs-string">"user_id"</span>,<span class="hljs-string">"date"</span>], inplace = <span class="hljs-literal">True</span>)</code></pre><br>
<img src="https://habrastorage.org/webt/t7/ek/x9/t7ekx9mfwh5z7cahruxyrvlvetq.png" alt="ุตูุฑุฉ"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุงูุฎุทูุฉ ุงูุชุงููุฉ ุ ููุชุฑุญ ุงูุญู ุนูู ููุตุฉ Power BI ุฅูุดุงุก ุฌุฏูู ุฅุถุงูู ุ ุณูุชู ุณุญุจ ุงูุจูุงูุงุช ููู ุฅูู ุงูุตููู ุงูุฑุฆูุณู. ูุชู ุฅูุดุงุก ุฌุฏูู ุจุงุณุชุฎุฏุงู ุฏุงูุฉ SUMMARIZE (). ูููู ุจุฅูุดุงุก ุฌุฏูู ูุญูุฑู ุจุฅุฌูุงููุงุช ูุฌูุนุฉ ูููุฌููุนุงุช ุงููุญุฏุฏุฉ: </font></font><code> df_groupby_user = SUMMARIZE(df;df[user_id];"first_date_transaction";MIN(df[date]);"total_amount_user";SUM(df[amount]);"count_transaction_user";COUNT(df[amount]))</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชุญุชูู ููุชุจุฉ Pandas ุนูู ูุธูุฑุชูุง - ูุธููุฉ groupby (). ูุชุทุจูู groupby () ูููู ุชุญุฏูุฏ ุฅุทุงุฑ ุงูุจูุงูุงุช ุงููุงุฒู ุ ุงูุฃุนูุฏุฉ ุงููุงุจูุฉ ููุชุฌููุน ุ ูู ููุงูุฉ ุงููุงุฆูุฉ ุงูุฃุนูุฏุฉ ุงูุชู ุณูุชู ุชุทุจูู ูุธุงุฆู ุงูุชุฌููุน ููุง. ูุชู ุชูููู ุงููุชูุฌุฉ ุงูุชู ุชู ุงูุญุตูู ุนูููุง ุฅูู ุชูุณูู ุฅุทุงุฑ ุงูุจูุงูุงุช ุงููุนุชุงุฏ ุจูุงุณุทุฉ ูุธููุฉ reset_index (). ูู ุงูุฎุชุงู ุ ุฃุนุฏ ุชุณููุฉ ุงูุญููู.</font></font><br>
<br>
<pre><code class="python hljs">%%time
<span class="hljs-comment">#       user_id. </span>
df_groupby_user = df.groupby(by = [<span class="hljs-string">"user_id"</span>]).agg({<span class="hljs-string">"date"</span>: <span class="hljs-string">"min"</span>, <span class="hljs-string">"amount"</span>: [<span class="hljs-string">"sum"</span>,<span class="hljs-string">"count"</span>]})<font></font>
df_groupby_user.reset_index(inplace = <span class="hljs-literal">True</span>)
<span class="hljs-comment"># </span>
new_columns = [<span class="hljs-string">"user_id"</span>,<span class="hljs-string">"first_date_transaction"</span>, <span class="hljs-string">"total_amount_user"</span>,<span class="hljs-string">"count_transaction_user"</span>]<font></font>
df_groupby_user.columns = new_columns</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุงูุฅุถุงูุฉ ุฅูู ูููุงุณ "ุชุงุฑูุฎ ุงูุดุฑุงุก ุงูุฃูู" ุ ูุชู ุงุญุชุณุงุจ ุนุฏุฏ ุงููุนุงููุงุช ููู ุนููู ูุฅุฌูุงูู ูุจูุบ ูุดุชุฑูุงุช ุงูุนููุงุก ููุงูู ุงููุชุฑุฉ. ูู ุชุฌุฏ ุงูููุงุณุงุช ุชุทุจูููุง ูู ุงูููุจููุชุฑ ุงููุญููู ุ ููููุง ูู ูุฒูููุง. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุนูุฏ ุฅูู ุงูููุจููุงุฑ. ูุชู ุญุณุงุจ ุงููููุงุณ ุงูุฌุฏูุฏ "ุณูุฉ ุงูุดุฑุงุก ุงูุฃููู". ุตูุบุฉ DAX: </font></font><code> first_transaction = FORMAT(df_groupby_user[first_date_transaction];"YYYY-MM")</code><br>
<br>
<img src="https://habrastorage.org/webt/4l/3n/xo/4l3nxosdn2pddiqx3pffvtrniec.png" alt="ุตูุฑุฉ"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชุณุชุฎุฏู Python ุจูุงุก ุงูุฌููุฉ dt.strftime ('ูช Y-ูช m'). ุณุชุฌุฏ ุดุฑุญูุง ุชูุตููููุง ูููููุฉ ุนูููุง ูู ุงูููุดูุฑุงุช ุนุจุฑ ุงูุฅูุชุฑูุช ูููุง ูุชุนูู ุจุงูุนูู ูุน ุงูุชุงุฑูุฎ ูุงูููุช ูู Python. ูู ูุฐู ุงูุฎุทูุฉ ุ ููุงู ุดูุก ุขุฎุฑ ููู. ุงูุชุจู ุฅูู ููุช ุงูุนูููุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุณ ุนูู ุงูุฅุทูุงู ุฃุฏุงุก ูุดุจู ุงูุจุงูุฏุง (24.8 ุซุงููุฉ). ุณุทุฑ ุงูููุฏ ุฃุจุทุฃ ูู ูู ุงูููุฏ ุงูุณุงุจู. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชุตุจุญ ูุฐู ุงููุทุนุฉ ูู ุงููุฑุดุญ ุงูุฃูู ูุฅุนุงุฏุฉ ููููุฉ ูุญุชููุฉ.</font></font><br>
<br>
<pre><code class="python hljs">%%time
<span class="hljs-comment">#  -</span>
df_groupby_user[<span class="hljs-string">"first_transaction"</span>] = df_groupby_user[<span class="hljs-string">"first_date_transaction"</span>].dt.strftime(<span class="hljs-string">'%Y-%m'</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุญุงู ุงูููุช ููุนูุฏุฉ ุฅูู ุงููุฏูุฉ ูุฑุฉ ุฃุฎุฑู. </font><font style="vertical-align: inherit;">ููุฌุฏ ุงุชุญุงุฏ ุงูุฌุฏุงูู ุญุณุจ ูุฌุงู ุฑุฆูุณู. </font><font style="vertical-align: inherit;">ุซู ูุชู ุณุญุจ ุงูุญููู ุงูุถุฑูุฑูุฉ ุฅูู ุงูุฌุฏูู ุงูุฑุฆูุณู ุจุงุณุชุฎุฏุงู ุฏุงูุฉ RELATED (). </font><font style="vertical-align: inherit;">ูุง ุชูุชูู Pandas ูุฐู ุงูููุฒุฉ. </font><font style="vertical-align: inherit;">ูููู ููุงู ุฏูุฌ () ุ ุงูุถูุงู () ุ concat (). </font><font style="vertical-align: inherit;">ูู ูุฐู ุงูุญุงูุฉ ุ ูู ุงูุฃูุถู ุชุทุจูู ุงูุฎูุงุฑ ุงูุฃูู.</font></font><br>
<br>
<pre><code class="python hljs">%%time
<span class="hljs-comment"># </span>
df_final = pd.merge(df, df_groupby_user, how = <span class="hljs-string">"left"</span>, on = <span class="hljs-string">"user_id"</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุนุฏ ุฃู ุชูุน ุงูุจูุงูุงุช ุจุชุงุฑูุฎ ุงููุนุงููุฉ ุงูุฃููู ูู ุงูุฌุฏูู ุงูุฑุฆูุณู ุ ููููู ุญุณุงุจ ุงูุฏูุชุง. </font><font style="vertical-align: inherit;">ูุณุชุฎุฏู ุจููุฉ ุงูุชุทุจูู (lambda x: ...) ูุชูุถูุญ ูุฏู ูุซุงูุฉ ูุฐู ุงูุนูููุฉ (39.7 ุซุงููุฉ). </font><font style="vertical-align: inherit;">ููุง ูุฑุดุญ ุขุฎุฑ ูุฅุนุงุฏุฉ ูุชุงุจุฉ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ.</font></font><br>
<br>
<pre><code class="python hljs">%%time
<span class="hljs-comment">#   "    "</span>
df_final[<span class="hljs-string">"delta_days"</span>] = df_final[<span class="hljs-string">"date"</span>] - df_final[<span class="hljs-string">"first_date_transaction"</span>]<font></font>
df_final[<span class="hljs-string">"delta_days"</span>] = df_final[<span class="hljs-string">"delta_days"</span>].apply(<span class="hljs-keyword">lambda</span> x: x.days)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุญุชูู ุงูุฌุฏูู ุงูุฑุฆูุณู ุจุงููุนู ุนูู ุฏูุชุง ุญุณุจ ุงูููู ุ ูุฐูู ููููู ุชูุณูู ุจูุงูุงุช ุงูุนููุฏ ุฅูู ูุฌููุนุงุช ูููุฐุฌูุฉ. ุงููุจุฏุฃ: 0 (ุฃู ุงูุจูุน ุงูุฃูู ููุนููู) - ุงููุฌููุนุฉ 0 ุ ุงูููู ุฃูุจุฑ ูู 0 ุ ูููู ุฃูู ูู ุฃู ูุณุงูู 30 ูู 30 ุ ุงูููู ุงูุฃูุจุฑ ูู 30 ุ ูููู ุฃูู ูู ุฃู ูุณุงูู 90 ูู 90 ุ ุฅูุฎ. ููุฐู ุงูุฃุบุฑุงุถ ุ ูู DAX ุ ููููู ุงุณุชุฎุฏุงู ุงูุฏุงูุฉ CEILING (). ูุชูุฑูุจ ุงูุฑูู ุฅูู ุฃูุฑุจ ุนุฏุฏ ุตุญูุญ ุ ูุถุงุนู ุงููููุฉ ูู ุงููุนููุฉ ุงูุซุงููุฉ.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sd/mu/rh/sdmurhtsdqarznw92jwbklpvjvs.png" alt="ุตูุฑุฉ"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุจุงูุซูู ุ ูู ุฃุฌุฏ ูุธููุฉ ุฑูุงุถูุฉ ููุงุซูุฉ ุ ุนูู ุงูุฑุบู ูู ุฃููู ุฎุทุทุช ููุนุซูุฑ ุนูููุง ูู ูุญุฏุฉ ุงูุฑูุงุถูุงุช (ุฑุจูุง ุจุญุซุช ุจุดูู ุณูุก). ูุฐูู ุ ูุงู ุนูู ุฃู ุฃุฐูุจ ูุชุทุจูู ุงูุฏุงูุฉ cut (). ุจุนุฏ ูุดุฑ ุงูุจูุงูุงุช ูู ูุฌููุนุงุช ูููุฐุฌูุฉ ุ ุชู ุชุนููู NaN ุฅูู ููู ุนุฏุฏูุฉ 0. ูุง ูููููุง ุญู ูุฐู ุงููุดููุฉ ุจุงุณุชุฎุฏุงู ุฏุงูุฉ fillna () ุ ุญูุซ ุฃููุง ูุชุนุงูู ูุน ุงูุจูุงูุงุช ุงููุฆููุฉ. ุชุญุชุงุฌ ุฃููุงู ุฅูู ุฅุถุงูุฉ ูููุฉ ุฌุฏูุฏุฉ ุฅูู ุงููุฆุฉ. ูู ููุงูุฉ ูุงุฆูุฉ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูุฐู ุ ูู ุจุชุบููุฑ ููุน ุงูุจูุงูุงุช ุฅูู int. ูุชู ุฐูู ุจุญูุซ ุฃูู ูู ุงููุณุชูุจู ุ ุนูุฏ ุฅูุดุงุก ุฌุฏูู ูุญูุฑู ุจุงุณุชุฎุฏุงู ุฅุทุงุฑ ุจูุงูุงุช ุ ูุง ุชุธูุฑ ุงููุฌููุนุฉ ุงููููุฐุฌูุฉ ุงูุฌุฏูุฏุฉ ูู ููุงูุฉ ุณูุณูุฉ ูู ุงูููู.</font></font><br>
<br>
<pre><code class="python hljs">%%time
<span class="hljs-comment">#  . </span>
cut_labels_days = [x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range (<span class="hljs-number">30</span>, <span class="hljs-number">1230</span>, <span class="hljs-number">30</span>)]<font></font>
cut_bins_days = [x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range (<span class="hljs-number">0</span>, <span class="hljs-number">1230</span>, <span class="hljs-number">30</span>)]<font></font>
df_final[<span class="hljs-string">"cohort_days"</span>] = pd.cut(df_final[<span class="hljs-string">"delta_days"</span>], bins = cut_bins_days, labels=cut_labels_days, right = <span class="hljs-literal">True</span>)<font></font>
%%time<font></font>
<span class="hljs-comment">#     .   fillna   !</span>
df_final[<span class="hljs-string">"cohort_days"</span>] = df_final[<span class="hljs-string">"cohort_days"</span>].cat.add_categories([<span class="hljs-number">0</span>])<font></font>
df_final[<span class="hljs-string">"cohort_days"</span>].fillna(<span class="hljs-number">0</span>, inplace = <span class="hljs-literal">True</span>)<font></font>
%%time<font></font>
<span class="hljs-comment">#     .   fillna   !</span>
df_final[<span class="hljs-string">"cohort_days"</span>] = df_final[<span class="hljs-string">"cohort_days"</span>].cat.add_categories([<span class="hljs-number">0</span>])<font></font>
df_final[<span class="hljs-string">"cohort_days"</span>].fillna(<span class="hljs-number">0</span>, inplace = <span class="hljs-literal">True</span>)
<span class="hljs-comment">#    .    ,  "0"        ,     </span>
<span class="hljs-comment">#    .</span>
df_final[<span class="hljs-string">"cohort_days"</span>] = df_final[<span class="hljs-string">"cohort_days"</span>].astype(int)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุงุณุชุฎุฏุงู ุฏุงูุฉ pivot_table () ูุญุตู ุนูู ุงูุฌุฏูู ุงููุญูุฑู ุงููุทููุจ. ูุญุตู ุนูู ุงููุซูุฑ ูู ุงูุฃููุงุฌ ุ ูุฐูู ูุง ูููู ุนุฑุถ ุงููุชูุฌุฉ ุจุงููุงูู ุนูู ุงูุดุงุดุฉ. ูุชุฌูุจ ุฐูู ุ ุนูุฏ ุญู ุญุงูุฉ ุญููููุฉ ุ ููููู ุฃู ุชุฃุฎุฐ ูุชุฑุฉ ุฒูููุฉ ุฃูุตุฑ ููุชุญููู ุฃู ูุชูุณูุน ูุทุงูุงุช ููู ุงููุฌููุนุงุช ุงููููุฐุฌูุฉ ููุณูุง.</font></font><br>
<br>
<pre><code class="python hljs">%%time
<span class="hljs-comment">#  </span>
df_pivot_table = pd.pivot_table(df_final, values=[<span class="hljs-string">"amount"</span>], index=[<span class="hljs-string">"first_transaction"</span>], columns=[<span class="hljs-string">"cohort_days"</span>], aggfunc=np.sum, fill_value = <span class="hljs-number">0</span>)</code></pre><br>
<img src="https://habrastorage.org/webt/e2/dn/u-/e2dnu-fry4n2hd4fl7_coqm_5mo.png" alt="ุตูุฑุฉ"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู Power BI ุ ุชุญุชุงุฌ ุฅูู ุงุณุชุฎุฏุงู ุฃุฏุงุฉ Matrix ูุฅูุดุงุก ูุซู ูุฐุง ุงูุชุตูุฑ. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sx/qh/gh/sxqhghd3km7lwdo-aycsry8xnn4.png" alt="ุตูุฑุฉ"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงููุฑุญูุฉ ุงูุชุงููุฉ ูู ุงูุชุขูุฑ. ุงููุฑูู ุงูุฏูููุฉ ูู ุงููุถุน ูู ุฃููุง ูุญุชุงุฌ ุฅูู ุงููุจูุบ ุนูู ุฃุณุงุณ ุงูุงุณุชุญูุงู. ูู Power BI ุ ูุง ุนููู ุณูู ุชุญุฏูุฏ ุนูุตุฑ ุงููุงุฆูุฉ "ุฅุฌุฑุงุก ุณุฑูุน" ุงููุทููุจ ูุณูุชู ุฅูุดุงุก ุตูุบุฉ DAX ุงููุงุฒูุฉ ุชููุงุฆููุง. ูุน ููุชุจุฉ Pandas ุ ูุฅู ุงููุถุน ุฃูุซุฑ ุชุนููุฏูุง ููููุงู. ูููู ุจุชุฌููุน ุฅุทุงุฑ ุงูุจูุงูุงุช ุงูููุฌูุฏ ุจุดูู ุชุณูุณูู ูุฒุฏูุฌ ูุชุทุจูู ุฏุงูุฉ cumsum (). ูุธุฑูุง ูุฃู ุงููุชูุฌุฉ ุณุชุณุชูุฑ ูู ุงุณุชุฎุฏุงููุง ุ ูุณูุนูู ุนูู ุฅูุดุงุก ูุณุฎุฉ ูู ุฅุทุงุฑ ุงูุจูุงูุงุช ูุฅูุดุงุก ุงูุฑุณู ุงูุจูุงูู. ูุงูุช ููู ุงููุจูุนุงุช ุงููุชุฑุงููุฉ ูุจูุฑุฉ ุฌุฏูุง ุ ูุฐูู ููุณู ุงูููู ุนูู 1ุ000ุ000 ูุชูุฑูุจ ุงููุชูุฌุฉ ุฅูู ุฑูููู ุจุนุฏ ุงููุงุตูุฉ ุงูุนุดุฑูุฉ.</font></font><br>
<br>
<pre><code class="python hljs">%%time
<span class="hljs-comment">#     amount</span>
df_pivot_table_cumsum = df_final.groupby(by = [<span class="hljs-string">"first_transaction"</span>,<span class="hljs-string">"cohort_days"</span>]).agg({<span class="hljs-string">"amount"</span>: [<span class="hljs-string">"sum"</span>]}).groupby(level=<span class="hljs-number">0</span>).cumsum().reset_index()<font></font>
df_pivot_table_cumsum.columns = [<span class="hljs-string">"first_transaction"</span>,<span class="hljs-string">"cohort_days"</span>,<span class="hljs-string">"cumsum_amount"</span>]<font></font>
%%time<font></font>
<span class="hljs-comment">#     </span><font></font>
df_pivot_table_cumsum_chart = copy.deepcopy(df_pivot_table_cumsum)<font></font>
<span class="hljs-comment">#     ,       Y.</span>
df_pivot_table_cumsum_chart[<span class="hljs-string">"cumsum_amount"</span>]=round(df_pivot_table_cumsum_chart[<span class="hljs-string">"cumsum_amount"</span>]/<span class="hljs-number">1000000</span>, <span class="hljs-number">2</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุณุชุฎุฏู ูุฏุฑุงุช ุงูููุชุจุฉ ูุจูุงุก ุงูุฑุณู ุงูุจูุงูู. ูุชู ุฅูุดุงุก ุฑุณู ุชุฎุทูุทู ูู ุณุทุฑ ูุงุญุฏ ููุท ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุ ูููู ุงููุชูุฌุฉ ููุณุช ูุซูุฑุฉ ููุฅุนุฌุงุจ. ูููุฏ ูุฐุง ุงูุฑุณู ุงูุจูุงูู ุจูุถูุญ ุนูู ุงููุฑุฆูุงุช ุนูู ุฃู ููุตุฉ BI. ููููู ุชูุตูู ููุชุจุฉ Plotly ูุงูุงุณุชุญุถุงุฑ ุจุงููุธุงุฆู ุงูุฅุถุงููุฉ ุ ูููู ูุฐู ุชูุงููู ุนูุงูุฉ ูุฎุชููุฉ ุชูุงููุง ููุงุฑูุฉ ุจุงูููุฌ ุงูููุถุญ ูู ุงูููุฏูู.</font></font><br>
<br>
<pre><code class="python hljs">%%time<font></font>
df_pivot_table_cumsum_chart.pivot(index=<span class="hljs-string">"cohort_days"</span>, columns=<span class="hljs-string">"first_transaction"</span>, values=<span class="hljs-string">"cumsum_amount"</span>).plot(figsize = (<span class="hljs-number">15</span>,<span class="hljs-number">11</span>))</code></pre><br>
<img src="https://habrastorage.org/webt/ya/2f/sj/ya2fsjju2epd-vvcn96gms0i5rm.png" alt="ุตูุฑุฉ"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฏุนููุง ูุตู ุฅูู ุงุณุชูุชุงุฌุงุช ููุฌุฒุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุญูุซ ุงูุญุณุงุจุงุช ุ ูุฏ ุชุญู ููุชุจุฉ Pandas ูุญู Power Pivot (DAX). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุง ุชุฒุงู ุฌุฏูู ูุซู ูุฐุง ุงูุงุณุชุจุฏุงู ุฎุงุฑุฌ ุงููุญุงุฏุซุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชููู DAX ุ ูุซู ูุธุงุฆู ููุชุจุฉ Python ุ ุจุนูู ุฌูุฏ ูู ุชูููุฐ ุงูุนูููุงุช ุนูู ุญููู ุงูุฌุฏูู ุจุงููุงูู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุญูุซ ุงูุณุฑุนุฉ ูุงูุจุณุงุทุฉ ูุณูููุฉ ุชุตููู ุงูุชุตูุฑ ุ ูุฅู Power BI ูุชูููุฉ ุนูู Pandas. </font><font style="vertical-align: inherit;">ูู ุฑุฃูู ุ ูุฅู ุงูุฑุณูู ุงูุจูุงููุฉ ุงููุฏูุฌุฉ (ููุฐูู ุชูู ุงูุชู ุชู ุฅูุดุงุคูุง ุจุงุณุชุฎุฏุงู matplotlib ุ ุงูููุชุจุงุช ุงูุจุญุฑูุฉ) ููุงุณุจุฉ ููุงุณุชุฎุฏุงู ูู ุญุงูุชูู: ุชุญููู ุตุฑูุญ ูุนุฏุฏ ูู ุงูุจูุงูุงุช ููููู ุงููุชุทุฑูุฉ ุ ุฃู ุงูุญุฏูุฏ ุงูุฏููุง / ุงูุญุฏูุฏ ุงููุตูู ุงููุญููุฉ ุ ุฃู ุฅุนุฏุงุฏ ุงูุดุฑุงุฆุญ ููุนุฑุถ ุงูุชูุฏููู. </font><font style="vertical-align: inherit;">ูู ุงูุฃูุถู ุชุฑู ุชุทููุฑ ููุญุงุช ุงูุชุญูู ุงูุฑุณูููุฉ ูุญููู BI. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฐุง ูู ุดุฆ. </font><font style="vertical-align: inherit;">ูู ุงูุตุญุฉ ูุงูุญุธ ุงูุฌูุฏ ูุงููุฌุงุญ ุงููููู!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar501480/index.html">ุฏููู v1.0: ููุช ุงูุชุดุบูู ุงูุขูู ูุฌุงูุง ุณูุฑูุจุช ู TypeScript. ูุธุฑุฉ ุนุงูุฉ ุนูู ุงูููุฒุฉ</a></li>
<li><a href="../ar501482/index.html">ุงูููุทูุฑ ุงูุบุฑูุจุฉ</a></li>
<li><a href="../ar501484/index.html">ูุฌุจ ุฃู ููุฑุฑ ุงููุจุฑูุฌ</a></li>
<li><a href="../ar501488/index.html">ุงูุทุฑูู ูู ุงููุณุท ุฅูู ุงููุจูุฑ</a></li>
<li><a href="../ar501490/index.html">ูุง ูู ุงูุฌุฏูุฏ ุงููุชููุน ูู ุจุงูุซูู 3.9</a></li>
<li><a href="../ar501494/index.html">ููุณ ุบุฑุงููุง ููุฑูุญ: ูุตุฉ ุงูุนููุฉ ุงููุดูุฑุฉ ุงููุงุดูุฉ Durov</a></li>
<li><a href="../ar501496/index.html">ุงููุฐูุจ ุจุญูุฑุฉ ุ ุงูุงูุชูุงุก ูู ุงูุชูุฑุงุฑ</a></li>
<li><a href="../ar501498/index.html">ูุง ููุฏุงุฑ ููุฏ C ++ ุงูุฐู ูุฌุจ ูุชุงุจุชู ูุชุญููู ุฑุฃุณ HTTP ูููุตุงุฏูุฉ ุจุงุณุชุฎุฏุงู easy_parser ูู RESTinioุ</a></li>
<li><a href="../ar501500/index.html">ุงูุฅุฎุชุฑุงู ุงูุจุตุฑู: ูุง ููุฏุฏ ูููู ุชุญูู ููุณู ูู ุงูุชุฌุณุณ</a></li>
<li><a href="../ar501502/index.html">ูุฎุชุจุฑ ุฑููู ุฌุฏูุฏ ููุชูููู ููุงุตู ูุชุงุจ ูุงุฑูุณ ููุณุงุนุฏ ูู ุตูุน ูุนุจุฉ ููุฏูู FPGA</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>