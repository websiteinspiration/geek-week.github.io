<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üó£Ô∏è üçç üëº Le livre "Bash et cybers√©curit√©: attaque, d√©fense et analyse depuis la ligne de commande Linux" üé© üë∏üèæ üöê</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, habrozhiteli! La ligne de commande peut √™tre un outil id√©al pour la cybers√©curit√©. Une flexibilit√© incroyable et une disponibilit√© absolue fo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Le livre "Bash et cybers√©curit√©: attaque, d√©fense et analyse depuis la ligne de commande Linux"</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/501528/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/xx/ml/ir/xxmlirxciwbxahmteiy-9cslfxg.jpeg" align="left" alt="image"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bonjour, habrozhiteli! </font><font style="vertical-align: inherit;">La ligne de commande peut √™tre un outil id√©al pour la cybers√©curit√©. </font><font style="vertical-align: inherit;">Une flexibilit√© incroyable et une disponibilit√© absolue font de l'interface de ligne de commande standard (CLI) une solution fondamentale si vous avez l'exp√©rience appropri√©e. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les auteurs Paul Tronkon et Karl Albing parlent des outils et des astuces de la ligne de commande qui aident √† collecter des donn√©es avec une protection proactive, √† analyser les journaux et √† surveiller l'√©tat du r√©seau. </font><font style="vertical-align: inherit;">Les pentesters apprendront √† mener des attaques en utilisant une fonctionnalit√© colossale int√©gr√©e √† presque toutes les versions de Linux.</font></font><br>
<a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour qui est ce livre?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le livre "Bash et cybers√©curit√©" est destin√© √† ceux qui veulent apprendre √† travailler avec la ligne de commande dans le cadre de la s√©curit√© informatique. </font><font style="vertical-align: inherit;">Notre objectif n'est pas de remplacer les outils existants par des scripts de ligne de commande, mais plut√¥t de vous apprendre √† utiliser efficacement la ligne de commande pour am√©liorer les fonctionnalit√©s existantes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout au long du livre, nous fournissons des exemples de m√©thodes de s√©curit√© telles que la collecte de donn√©es, l'analyse et les tests de p√©n√©tration. </font><font style="vertical-align: inherit;">Le but de ces exemples est de d√©montrer les capacit√©s de la ligne de commande et de vous pr√©senter certaines des m√©thodes fondamentales utilis√©es dans les outils de niveau sup√©rieur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce livre n'est pas une introduction √† la programmation, bien que certains concepts g√©n√©raux soient trait√©s dans la partie I.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Surveillance des journaux en temps r√©el</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La capacit√© d'analyser un magazine apr√®s qu'un √©v√©nement s'est produit est une comp√©tence importante. </font><font style="vertical-align: inherit;">Mais il est tout aussi important de pouvoir extraire des informations du fichier journal en temps r√©el afin de d√©tecter les actions malveillantes ou suspectes au moment o√π elles se produisent. </font><font style="vertical-align: inherit;">Dans ce chapitre, nous examinerons les m√©thodes de lecture des √©critures au fur et √† mesure qu'elles sont cr√©√©es et format√©es pour afficher des analyses et g√©n√©rer des alertes bas√©es sur des indicateurs de menace connus pour le fonctionnement d'un syst√®me ou d'un r√©seau (indicateurs de compromis).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Surveillance du journal de texte</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fa√ßon la plus simple de surveiller le journal en temps r√©el est d'utiliser la commande tail avec le param√®tre ‚Äìf - elle lit en continu le fichier et les affiche dans stdout √† mesure que de nouvelles lignes sont ajout√©es. Comme dans les chapitres pr√©c√©dents, pour des exemples, nous utiliserons le journal d'acc√®s au serveur Web Apache, mais les m√©thodes d√©crites sont pertinentes pour tout journal de texte. Pour suivre le journal d'acc√®s Apache √† l'aide de la commande tail, entrez ce qui suit: </font></font><br>
<br>
<code>tail -f /var/logs/apache2/access.log</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La sortie de la commande tail peut √™tre transmise √† la commande grep, donc seuls les enregistrements correspondant √† certains crit√®res seront affich√©s. L'exemple suivant suit le journal d'acc√®s Apache et affiche les entr√©es correspondant √† une adresse IP sp√©cifique:</font></font><br>
<br>
<code>tail -f /var/logs/apache2/access.log | grep '10.0.0.152'<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez √©galement utiliser des expressions r√©guli√®res. Dans cet exemple, seuls les enregistrements renvoyant le code d'√©tat HTTP 404 ¬´Page non trouv√©e¬ª seront affich√©s; l'option -i est ajout√©e pour ignorer la casse des caract√®res: </font></font><br>
<br>
<code>tail -f /var/logs/apache2/access.log | egrep -i 'HTTP/.*" 404'</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour effacer les informations superflues, la sortie doit √™tre pass√©e √† la commande cut. Cet exemple surveille le journal d'acc√®s pour les requ√™tes menant au code d'√©tat 404, puis utilise la m√©thode cut pour afficher uniquement la date / heure et la page demand√©e: </font><font style="vertical-align: inherit;">
Ensuite, pour supprimer les crochets et les guillemets doubles, vous pouvez diriger la sortie vers tr -d ' [] "'.</font></font><br>
<br>
<code>$ tail -f access.log | egrep --line-buffered 'HTTP/.*" 404' | cut -d' ' -f4-7<br>
[29/Jul/2018:13:10:05 -0400] "GET /test<br>
[29/Jul/2018:13:16:17 -0400] "GET /test.txt<br>
[29/Jul/2018:13:17:37 -0400] "GET /favicon.ico</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Remarque: l'option --line-buffering de la commande egrep est utilis√©e ici. </font><font style="vertical-align: inherit;">Cela force egrep √† imprimer sur stdout chaque fois qu'un saut de ligne se produit. </font><font style="vertical-align: inherit;">Sans ce param√®tre, la mise en m√©moire tampon se produira et la sortie ne sera pas envoy√©e √† la commande cut tant que la m√©moire tampon n'est pas pleine. </font><font style="vertical-align: inherit;">Nous ne voulons pas attendre aussi longtemps. </font><font style="vertical-align: inherit;">Cette option permet √† la commande egrep d'√©crire chaque ligne telle qu'elle est trouv√©e.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TAMPONS DE LIGNE DE COMMANDE </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Que se passe-t-il pendant la mise en m√©moire tampon? </font><font style="vertical-align: inherit;">Imaginez que egrep trouve un grand nombre de cha√Ænes correspondant au mod√®le sp√©cifi√©. </font><font style="vertical-align: inherit;">Dans ce cas, egrep aura beaucoup de sortie. </font><font style="vertical-align: inherit;">Mais la sortie (en fait, toute entr√©e ou sortie) co√ªte beaucoup plus cher (prend plus de temps) que le traitement des donn√©es (recherche de texte). </font><font style="vertical-align: inherit;">Ainsi, moins il y aura d'appels d'E / S, plus le programme sera efficace.</font></font><br>
<br>
     grep       ,  ,          .         .  grep       .   ,  grep   50    .   ,     50  ,     ,     .   50  !<br>
<br>
       egrep, ,             .  egrep       ,     ,     .    ,    ,   ,      ,      .      ,     .<br>
<br>
    ,    ,  tail -f        (    ),       . ,       ¬´ ¬ª,      .     .          .<br>
<br>
   ,        egrep     ,     .        ,   .</blockquote><br>
<h3>    </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez utiliser les commandes tail et egrep pour surveiller le journal et afficher toutes les entr√©es qui correspondent √† des sch√©mas connus d'activit√© suspecte ou malveillante, souvent appel√©s IOC. Vous pouvez cr√©er un syst√®me de d√©tection d'intrusion (IDS) simple. Cr√©ez d'abord un fichier contenant les mod√®les d'expression r√©guli√®re pour l'IOC, comme illustr√© dans l'exemple 8.1. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exemple 8.1. ioc.txt </font><b><font style="vertical-align: inherit;">(1)</font></b><font style="vertical-align: inherit;"> Ce mod√®le (../) est un indicateur d'une attaque de r√©pertoire d√©tourn√©: un attaquant tente de quitter le r√©pertoire de travail en cours et d'acc√©der √† des fichiers qui ne lui sont pas accessibles. </font><b><font style="vertical-align: inherit;">(2)</font></b><font style="vertical-align: inherit;"> Les fichiers Linux etc / passwd et etc / shadow sont utilis√©s pour l'authentification du syst√®me et ne doivent jamais √™tre accessibles via un serveur Web. </font><b><font style="vertical-align: inherit;">(3)</font></b></font><br>
<br>
<code>\.\./ <b>(1)</b><br>
etc/passwd <b>(2)</b><br>
etc/shadow<br>
cmd\.exe <b>(3)</b><br>
/bin/sh<br>
/bin/bash<br>
</code><br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le traitement des fichiers cmd.exe, / bin / sh ou / bin / bash est une indication de la connexion inverse renvoy√©e par le serveur Web. Une connexion inverse indique souvent une tentative d'op√©ration r√©ussie. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notez que les IOC doivent √™tre au format regex, car ils seront utilis√©s plus tard par la commande egrep. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le fichier ioc.txt peut √™tre utilis√© avec l'option egrep -f. Ce param√®tre indique √† egrep de rechercher les mod√®les d'expression r√©guli√®re dans le fichier sp√©cifi√©. Cela vous permet d'utiliser la commande tail pour surveiller le fichier journal et, √† mesure que chaque enregistrement est ajout√©, la ligne de lecture est compar√©e √† tous les mod√®les du fichier IOC, affichant tout enregistrement correspondant. Voici un exemple:</font></font><br>
<br>
<code>tail -f /var/logs/apache2/access.log | egrep -i -f ioc.txt</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, la commande tee peut √™tre utilis√©e pour afficher simultan√©ment des avertissements √† l'√©cran et les enregistrer pour un traitement ult√©rieur dans son propre fichier: </font><font style="vertical-align: inherit;">
Encore une fois, l'option --line-buffered est n√©cessaire pour garantir qu'aucun probl√®me ne soit caus√© par la mise en m√©moire tampon de la sortie de la commande.</font></font><br>
<br>
<code>tail -f /var/logs/apache2/access.log | egrep --line-buffered -i -f ioc.txt |<br>
tee -a interesting.txt</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Surveillance des journaux Windows</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme d√©j√† mentionn√©, vous devez utiliser la commande wevtutil pour acc√©der aux √©v√©nements Windows. </font><font style="vertical-align: inherit;">Bien que cette commande soit universelle, elle n'a pas de fonctionnalit√© telle que tail, qui peut √™tre utilis√©e pour r√©cup√©rer de nouveaux enregistrements entrants. </font><font style="vertical-align: inherit;">Mais il existe un moyen de sortir - utilisez un simple script bash qui peut fournir les m√™mes fonctionnalit√©s (exemple 8.2). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exemple 8.2. </font><font style="vertical-align: inherit;">wintail.sh</font></font><br>
<br>
<pre><code class="java hljs">#!/bin/bash -<font></font>
#<font></font>
# Bash  <font></font>
# wintail.sh<font></font>
#<font></font>
# :<font></font>
#    tail   Windows<font></font>
#<font></font>
# : ./wintail.sh<font></font>
#<font></font>
<font></font>
WINLOG=<span class="hljs-string">"Application"</span> (<span class="hljs-number">1</span>)<font></font>
<font></font>
LASTLOG=$(wevtutil qe <span class="hljs-string">"$WINLOG"</span> <span class="hljs-comment">//c:1 //rd:true //f:text) (2)</span><font></font>
<font></font>
<span class="hljs-keyword">while</span> <span class="hljs-keyword">true</span>
<span class="hljs-keyword">do</span>
      CURRENTLOG=$(wevtutil qe <span class="hljs-string">"$WINLOG"</span> <span class="hljs-comment">//c:1 //rd:true //f:text) (3)</span>
      <span class="hljs-keyword">if</span> [[ <span class="hljs-string">"$CURRENTLOG"</span> != <span class="hljs-string">"$LASTLOG"</span> ]]<font></font>
      then<font></font>
            echo <span class="hljs-string">"$CURRENTLOG"</span>
            echo <span class="hljs-string">"----------------------------------"</span>
            LASTLOG=<span class="hljs-string">"$CURRENTLOG"</span><font></font>
      fi<font></font>
done</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(1)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cette variable d√©finit le journal Windows que vous souhaitez suivre. Pour obtenir la liste des journaux actuellement disponibles sur le syst√®me, vous pouvez utiliser la commande wevtutil el. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(2)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ici, wevtutil est ex√©cut√© pour demander le fichier journal sp√©cifi√©. Le param√®tre c: 1 renvoie une seule entr√©e de journal. Le param√®tre rd: true permet √† la commande de lire l'entr√©e de journal la plus r√©cente. Enfin, f: text renvoie le r√©sultat en texte brut, pas au format XML, ce qui facilite la lecture du r√©sultat √† l'√©cran. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(3)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les quelques lignes suivantes ex√©cutent √† nouveau la commande wevtutil et l'entr√©e de journal nouvellement re√ßue est compar√©e √† la derni√®re imprim√©e √† l'√©cran. </font><font style="vertical-align: inherit;">S'ils diff√®rent les uns des autres, cela signifie qu'il y a eu des modifications dans le journal. </font><font style="vertical-align: inherit;">Dans ce cas, une nouvelle entr√©e s'affiche. </font><font style="vertical-align: inherit;">Si les enregistrements compar√©s sont identiques, rien ne se produit et la commande wevtutil revient en arri√®re et recommence la recherche et la comparaison.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cr√©ation d'histogramme en temps r√©el</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La commande tail -f fournit le flux de donn√©es actuel. </font><font style="vertical-align: inherit;">Mais que se passe-t-il si vous souhaitez compter le nombre de lignes qui ont √©t√© ajout√©es au fichier pendant un certain temps? </font><font style="vertical-align: inherit;">Vous pouvez observer ce flux de donn√©es, d√©marrer une minuterie et effectuer un comptage sur une p√©riode de temps sp√©cifi√©e; </font><font style="vertical-align: inherit;">alors le comptage doit √™tre arr√™t√© et les r√©sultats rapport√©s.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce travail peut √™tre divis√© en deux processus de script: un script lira les lignes et l'autre surveillera l'heure. Le temporisateur notifie le compteur de lignes √† l'aide d'un m√©canisme de communication interprocessus POSIX standard appel√© signal. Un signal est une interruption logicielle et il existe diff√©rents types de signaux. Certains d'entre eux sont fatals - ils conduisent √† la fin du processus (par exemple, une exception dans une op√©ration √† virgule flottante). La plupart de ces signaux peuvent √™tre ignor√©s ou captur√©s. Une action est entreprise lorsqu'un signal est capt√©. Beaucoup de ces signaux ont une fonction pr√©d√©finie dans le syst√®me d'exploitation. Nous utiliserons l'un des deux signaux disponibles pour les utilisateurs. Il s'agit du signal SIGUSR1 (l'autre est SIGUSR2).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les scripts shell peuvent intercepter des interruptions √† l'aide de la commande trap int√©gr√©e. Avec son aide, vous pouvez s√©lectionner une commande qui d√©termine l'action que vous souhaitez effectuer lorsqu'un signal est re√ßu, et une liste de signaux qui d√©clenchent un appel √† cette commande. Par exemple: </font></font><br>
<br>
<code>trap warnmsg SIGINT</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cela provoque l'appel de la commande warnmsg (notre propre script ou fonction) chaque fois que le script shell re√ßoit un signal SIGINT, par exemple, lorsque vous appuyez sur Ctrl + C pour interrompre un processus en cours d'ex√©cution. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'exemple 8.3 montre un script qui effectue un comptage. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exemple 8.3 looper.sh</font></font><br>
<br>
<pre><code class="java hljs">#!/bin/bash -<font></font>
#<font></font>
# Bash  <font></font>
# looper.sh<font></font>
#<font></font>
# :<font></font>
#    <font></font>
#<font></font>
# : ./looper.sh [filename]<font></font>
# filename ‚Äî  ,   ,<font></font>
#  : log.file<font></font>
#<font></font>
<font></font>
<span class="hljs-function">function <span class="hljs-title">interval</span> <span class="hljs-params">()</span>                                           <span class="hljs-params">(<span class="hljs-number">1</span>)</span>
</span>{<font></font>
      echo $(date <span class="hljs-string">'+%y%m%d %H%M%S'</span>) $cnt                       (<span class="hljs-number">2</span>)<font></font>
      cnt=<span class="hljs-number">0</span><font></font>
}<font></font>
<font></font>
declare -i cnt=<span class="hljs-number">0</span>
<span class="hljs-function">trap interval <span class="hljs-title">SIGUSR1</span>                                          <span class="hljs-params">(<span class="hljs-number">3</span>)</span>

shopt -s <span class="hljs-title">lastpipe</span>                                              <span class="hljs-params">(<span class="hljs-number">4</span>)</span>

tail -f --pid</span>=$$ ${<span class="hljs-number">1</span>:-log.file} | <span class="hljs-function"><span class="hljs-keyword">while</span> read <span class="hljs-title">aline</span>             <span class="hljs-params">(<span class="hljs-number">5</span>)</span>
<span class="hljs-keyword">do</span>
     let cnt++
done</span></code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(1)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La fonction d'intervalle sera appel√©e √† la r√©ception de chaque signal. Bien s√ªr, l'intervalle doit √™tre d√©fini avant de pouvoir le nommer et utiliser trap dans notre expression. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(2)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La commande date est invoqu√©e pour fournir un horodatage pour la valeur de la variable cnt que nous imprimons. Une fois le compteur affich√©, nous remettons cette valeur √† 0 pour commencer le compte √† rebours de l'intervalle suivant. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(3)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Maintenant que l'intervalle est d√©fini, nous pouvons indiquer que la fonction est appel√©e chaque fois que notre processus re√ßoit le signal SIGUSR1. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(4)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ceci est une √©tape tr√®s importante. Habituellement, lorsqu'il existe un pipeline de commandes (par exemple, ls-l | grep rwx | wc), des parties du pipeline (chaque commande) sont ex√©cut√©es sur des sous-r√©seaux et chaque processus se termine par son propre identificateur de processus. Cela pourrait √™tre un probl√®me pour ce sc√©nario, car la boucle while sera dans un sous-shell avec un identificateur de processus diff√©rent. Quel que soit le processus d√©marr√©, le script looper.sh ne conna√Ætra pas l'identifiant du processus de boucle while pour lui envoyer un signal. En outre, la modification de la valeur de la variable cnt dans le sous-shell ne modifie pas la valeur cnt dans le processus principal, de sorte que le signal du processus principal d√©finira √† chaque fois la valeur sur 0. Vous pouvez r√©soudre ce probl√®me avec la commande shopt, qui d√©finit le param√®tre (-s) sur lastpipe. Il indique au shell de ne pas cr√©er de sous-shell pour la derni√®re commande du pipeline,et ex√©cutez cette commande dans le m√™me processus que le script lui-m√™me. Dans notre cas, cela signifie que la commande tail sera ex√©cut√©e dans un sous-shell (c'est-√†-dire dans un autre processus), et la boucle while fera partie du processus de script principal. Remarque: cette option de shell est disponible uniquement dans la version bash 4.x et sup√©rieure et uniquement pour les shells non interactifs (c'est-√†-dire les scripts).</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(5)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Il s'agit de la commande tail -f avec un autre param√®tre --pid. Nous indiquons l'identifiant du processus qui, √† la fin de ce processus, mettra fin √† la commande tail. Nous sp√©cifions l'ID de processus du script shell courant $$ √† afficher. Cette action vous permet de nettoyer les processus et de ne pas laisser la commande tail ex√©cut√©e en arri√®re-plan (si, par exemple, ce script s'ex√©cute en arri√®re-plan; exemple 8.4). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le script tailcount.sh d√©marre et arr√™te le script avec un chronom√®tre (timer) et compte les intervalles de temps. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exemple 8.4. tailcount.sh</font></font><br>
<br>
<pre><code class="java hljs">#!/bin/bash -<font></font>
#<font></font>
# Bash  <font></font>
# tailcount.sh<font></font>
#<font></font>
# :<font></font>
#    n <font></font>
#<font></font>
# : ./tailcount.sh [filename]<font></font>
#     filename:  looper.sh<font></font>
#<font></font>
<font></font>
#  ‚Äî    <font></font>
<span class="hljs-function">function <span class="hljs-title">cleanup</span> <span class="hljs-params">()</span>
</span>{<font></font>
      [[ -n $LOPID ]] &amp;&amp; kill $LOPID          (<span class="hljs-number">1</span>)<font></font>
}<font></font>
<font></font>
<span class="hljs-function">trap cleanup <span class="hljs-title">EXIT</span>                             <span class="hljs-params">(<span class="hljs-number">2</span>)</span>
bash looper.sh $1 &amp;                           <span class="hljs-params">(<span class="hljs-number">3</span>)</span>
LOPID</span>=$!                                      (<span class="hljs-number">4</span>)<font></font>
#   <font></font>
sleep <span class="hljs-number">3</span><font></font>
<font></font>
<span class="hljs-keyword">while</span> <span class="hljs-keyword">true</span>
<span class="hljs-keyword">do</span><font></font>
      kill -SIGUSR1 $LOPID<font></font>
      sleep <span class="hljs-number">5</span>
done &gt;&amp;<span class="hljs-number">2</span>                                      (<span class="hljs-number">5</span>)</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(1)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √âtant donn√© que ce script ex√©cutera d'autres scripts, il devrait √™tre nettoy√© apr√®s le travail. Si l'identifiant du processus a √©t√© stock√© dans LOPID, la variable stockera la valeur, donc la fonction enverra un signal √† ce processus en utilisant la commande kill. Si vous ne sp√©cifiez pas de signal sp√©cifique dans la commande kill, le signal SIGTERM sera envoy√© par d√©faut. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(2)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La commande EXIT n'est pas un signal. Il s'agit d'un cas particulier lorsque l'instruction trap indique au shell d'appeler cette fonction (dans ce cas le nettoyage) si le shell ex√©cutant ce script est sur le point de s'arr√™ter. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(3)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, le vrai travail commence. Le script looper.sh est lanc√©, qui s'ex√©cutera en arri√®re-plan: pour que ce script fonctionne tout au long du cycle (sans attendre que la commande termine le travail), il est d√©connect√© du clavier. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(4)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ici, l'identifiant du processus de script que nous venons de d√©marrer en arri√®re-plan est stock√©. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(5)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cette redirection est simplement une pr√©caution. Toutes les sorties provenant d'une boucle while ou des instructions kill / sleep (bien que nous ne nous y attendions pas) ne doivent pas √™tre m√©lang√©es avec des sorties de la fonction looper.sh, qui, bien que fonctionnant en arri√®re-plan, les envoie quand m√™me √† stdout. Par cons√©quent, nous redirigeons les donn√©es de stdout vers stderr.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour r√©sumer, nous voyons que bien que la fonction looper.sh ait √©t√© plac√©e en arri√®re-plan, son identifiant de processus est stock√© dans une variable shell. Toutes les cinq secondes, le script tailcount.sh envoie un signal SIGUSR1 √† ce processus (qui est ex√©cut√© dans la fonction looper.sh), qui, √† son tour, appelle le script looper.sh pour imprimer le nombre actuel de lignes qui y sont fix√©es et red√©marrer le d√©compte. Apr√®s avoir quitt√©, le script tailcount.sh sera effac√© en envoyant un signal SIGTERM √† la fonction looper.sh pour l'interrompre. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä l'aide de deux scripts - un script qui effectue le comptage de lignes et un script avec un chronom√®tre (minuterie) qui contr√¥le le premier script - vous pouvez obtenir une sortie (le nombre de lignes pour une certaine p√©riode), sur la base de laquelle le script suivant construira un histogramme. Cela s'appelle comme ceci:</font></font><br>
<br>
<code>bash tailcount.sh | bash livebar.sh</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le script livebar.sh lit les donn√©es de stdin et imprime la sortie sur stdout, une ligne pour chaque ligne d'entr√©e (exemple 8.5). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exemple 8.5 </font><font style="vertical-align: inherit;">livebar.sh</font></font><br>
<br>
<pre><code class="java hljs">#!/bin/bash -<font></font>
#<font></font>
# Bash  <font></font>
# livebar.sh<font></font>
#<font></font>
# :<font></font>
#    ¬´¬ª <font></font>
#<font></font>
# :<font></font>
# &lt;output from other script or program&gt; | bash livebar.sh<font></font>
#<font></font>
<font></font>
<span class="hljs-function">function <span class="hljs-title">pr_bar</span> <span class="hljs-params">()</span>                                         <span class="hljs-params">(<span class="hljs-number">1</span>)</span>
</span>{<font></font>
      local raw maxraw scaled<font></font>
      raw=$<span class="hljs-number">1</span>
      maxraw=$<span class="hljs-number">2</span><font></font>
      ((scaled=(maxbar*raw)/maxraw))<font></font>
      ((scaled == <span class="hljs-number">0</span>)) &amp;&amp; scaled=<span class="hljs-number">1</span> #   
      <span class="hljs-keyword">for</span>((i=<span class="hljs-number">0</span>; i&lt;scaled; i++)) ; <span class="hljs-keyword">do</span> printf <span class="hljs-string">'#'</span> ; done<font></font>
      printf <span class="hljs-string">'\n'</span><font></font>
<font></font>
} # pr_bar<font></font>
<font></font>
maxbar=<span class="hljs-number">60</span>     #         (<span class="hljs-number">2</span>)<font></font>
MAX=<span class="hljs-number">60</span>
<span class="hljs-function"><span class="hljs-keyword">while</span> read dayst timst qty
<span class="hljs-keyword">do</span>
      <span class="hljs-title">if</span> <span class="hljs-params">(( qty &gt; MAX )</span>)                                   <span class="hljs-params">(<span class="hljs-number">3</span>)</span>
      then
           let MAX</span>=$qty+$qty/<span class="hljs-number">4</span>    #   <font></font>
           echo <span class="hljs-string">"                      **** rescaling: MAX=$MAX"</span><font></font>
      fi<font></font>
      printf <span class="hljs-string">'%6.6s %6.6s %4d:'</span> $dayst $timst $qty         (<span class="hljs-number">4</span>)<font></font>
      pr_bar $qty $MAX<font></font>
done<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(1)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La fonction pr_bar affiche une cha√Æne de hashtags qui sont mis √† l'√©chelle en fonction des param√®tres fournis √† la taille maximale. </font><font style="vertical-align: inherit;">Cette fonctionnalit√© peut sembler famili√®re, comme nous l'avons pr√©c√©demment utilis√©e dans le script histogram.sh. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(2)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Il s'agit de la taille de ligne de hashtag la plus longue que nous pouvons autoriser (√† faire sans retour √† la ligne). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(3)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelle sera la taille des valeurs √† afficher? Sans le savoir √† l'avance (bien que ces donn√©es puissent √™tre fournies au script comme argument), le script suivra le maximum. Si ce maximum est d√©pass√©, la valeur commencera √† ¬´mettre √† l'√©chelle¬ª et les lignes qui sont maintenant affich√©es, et les lignes futures seront √©galement mises √† l'√©chelle √† un nouveau maximum. Le script ajoute 25% √† la valeur maximale, il n'a donc pas √† mettre √† l'√©chelle la valeur si la nouvelle valeur suivante augmente √† chaque fois de 1 √† 2% seulement. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(4)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printf d√©finit la largeur minimale et maximale des deux premiers champs √† imprimer. </font><font style="vertical-align: inherit;">Ce sont des horodatages qui seront tronqu√©s si les valeurs de largeur sont d√©pass√©es. </font><font style="vertical-align: inherit;">Pour afficher la valeur enti√®re, sp√©cifiez sa largeur de quatre caract√®res. </font><font style="vertical-align: inherit;">Dans ce cas, malgr√© les restrictions, toutes les valeurs seront imprim√©es. </font><font style="vertical-align: inherit;">Si le nombre de caract√®res dans les valeurs est inf√©rieur √† quatre, les caract√®res manquants seront compl√©t√©s par des espaces. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme ce script est lu depuis stdin, vous pouvez l'ex√©cuter vous-m√™me pour voir comment il se comporte. </font><font style="vertical-align: inherit;">Voici un exemple:</font></font><br>
<br>
<pre><code class="java hljs">$ bash  livebar.sh
<span class="hljs-number">201010</span> <span class="hljs-number">1020</span> <span class="hljs-number">20</span>
<span class="hljs-number">201010</span>     <span class="hljs-number">1020</span> <span class="hljs-number">20</span>:####################
<span class="hljs-number">201010</span> <span class="hljs-number">1020</span> <span class="hljs-number">70</span>
                       **** rescaling: MAX=<span class="hljs-number">87</span>
<span class="hljs-number">201010</span>     <span class="hljs-number">1020</span> <span class="hljs-number">70</span>:################################################
<span class="hljs-number">201010</span> <span class="hljs-number">1020</span> <span class="hljs-number">75</span>
<span class="hljs-number">201010</span> <span class="hljs-number">1020</span> <span class="hljs-number">75</span>:###################################################<font></font>
^C</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet exemple, l'entr√©e est m√©lang√©e √† la sortie. </font><font style="vertical-align: inherit;">Vous pouvez √©galement mettre une entr√©e dans un fichier et la rediriger vers un script pour ne voir que la sortie:</font></font><br>
<br>
<pre><code class="java hljs">$ bash livebar.sh &lt; testdata.txt<font></font>
bash livebar.sh &lt; x.data<font></font>
<span class="hljs-number">201010</span> <span class="hljs-number">1020</span> <span class="hljs-number">20</span>:####################<font></font>
                 **** rescaling: MAX=<span class="hljs-number">87</span>
<span class="hljs-number">201010</span> <span class="hljs-number">1020</span> <span class="hljs-number">70</span>:################################################
<span class="hljs-number">201010</span> <span class="hljs-number">1020</span> <span class="hljs-number">75</span>:###################################################<font></font>
$</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬ªPlus d'informations sur le livre peuvent √™tre trouv√©es sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le site Web de l'√©diteur</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
¬ª </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenu</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
¬ª </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Extrait</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
pour Khabrozhiteley 25% de r√©duction sur le coupon - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bash</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Lors du paiement de la version papier du livre, un livre √©lectronique est envoy√© par e-mail.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr501510/index.html">Un nouveau regard sur le d√©veloppement Fullstack avec le framework Ruby on Rails</a></li>
<li><a href="../fr501516/index.html">Coupons le vide?! Alexey Lesovsky</a></li>
<li><a href="../fr501520/index.html">C # 8 et validit√© nulle. Comment vivons-nous avec cela</a></li>
<li><a href="../fr501522/index.html">Webinaires Skillbox gratuits: jeux d'√©criture en PHP, Unity et Unreal Engine</a></li>
<li><a href="../fr501526/index.html">Pourquoi l'anglais canadien est consid√©r√© comme "sale" et qu'est-ce que Keanu Reeves a √† voir avec cela?</a></li>
<li><a href="../fr501534/index.html">Maintenant, avec COVID-19, il y a aussi une √©ruption cutan√©e</a></li>
<li><a href="../fr501536/index.html">Sur mesure: une histoire sur la fa√ßon dont une ligne de code s'est transform√©e en kilotonnes de charbon</a></li>
<li><a href="../fr501538/index.html">Indentation en Python - Option Solution</a></li>
<li><a href="../fr501544/index.html">Smartphone parfait</a></li>
<li><a href="../fr501546/index.html">"Pourquoi est-ce que je traverse √ßa?" - les psychologues expliquent comment trouver un sens de mani√®re isol√©e</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>