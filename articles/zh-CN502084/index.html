<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌮 🤱 👩‍🎤 通过伪装者检查负载下的区域公共服务门户 👨🏿‍💼 🔃 🤚</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="哈Ha！您也正在好奇地观看“美国荒野地带分布史诗般的故事-先行举旗示意”或什至参与其中。更确切地说，是现代版本-率先申请公共服务，以便为儿童赚钱或获得通行证以离开房屋。综观所有这些，我想分享我们团队在测试和参与准备提供“一流记录”服务的区域服务门户方面的经验。这也与哈布拉效应非常相似，我认为这与几天...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>通过伪装者检查负载下的区域公共服务门户</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/502084/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈Ha！您也正在好奇地观看“美国荒野地带分布史诗般的故事-先行举旗示意”或什至参与其中。更确切地说，是现代版本-率先申请公共服务，以便为儿童赚钱或获得通行证以离开房屋。综观所有这些，我想分享</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们团队</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在测试和参与准备提供“一流记录”服务的区域服务门户方面</font><font style="vertical-align: inherit;">的经验</font><font style="vertical-align: inherit;">。这也与哈布拉效应非常相似，我认为这与几天前联邦门户网站gosuslugi.ru发生的情况非常接近，但在区域范围内。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们于今年1月在哈巴罗夫斯克（Khabarovsk）克服了这一挑战，最近我们参与了为在另一个地区发放狩猎许可证的类似服务的准备工作。以下是一些小经验，您将有机会从另一个角度研究为高峰期准备地区公共服务门户网站的问题。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于初学者来说，这是一辆黑色的公共汽车的照片，他在学校全天候值班三天，其中这些台词的作者证实了三年前他在父母中的位置。至少我们的父母聚在一起。冬季在哈巴罗夫斯克观看-30度仍然是一种享受。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/o8/vh/rb/o8vhrboqvtrufnftfwxsxb1rgm4.png" alt="图片"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在准备一年级最高录音的过程中，几个团队合作了，因为 </font><font style="vertical-align: inherit;">其中涉及一种或另一种方式：数据中心运营商，区域门户网站信息系统的运营商和开发商，集成教育信息系统的运营商和开发商，为区域门户网站的用户提供技术支持。</font><font style="vertical-align: inherit;">我们在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iondv</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行最后一项任务，独立监视门户的运行状况并为用户提供支持。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们在准备工作中的角色是组织有关nginx中缓存配置的测试和建议，当然，我们还为具有建议“行为”的用户准备了说明。</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于那些不知道一年级写作问题的人</font></font></b>
                        <div class="spoiler_text">         ,    .  .          ,     ,   -     (      ,   —      ),    ,  -     ,   ,            .  ,       ,      ,     –    ,        .           .<br>
<br>
     1-          ,    .           0:00 ,        10:00 26 . ,    –       .        10:00 ,       —    ,      - .<br>
<br>
            .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"></a>    .   2017 .     .         ,    ,    .          .<br>
</div>
                    </div><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为技术任务的对所需资源的服务</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
负载（或查询概率）的积分指标中倾向于“增量函数”（δ函数，狄拉克函数）的服务中的问题（如“写入一年级”）在图表上以峰的形式清晰可见。此刻，在短时间内通话量呈倍数增长。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0l/uc/c6/0lucc67w9pr4uh2ig1swg5tgtq0.png" alt="δ函数和峰值查询统计"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们的经验表明，培训的主要任务不是增加资源。任务是最大程度地减少每秒的潜在请求数，将其延长一段时间，并为系统准备剩余的负载。在这种情况下，有必要发现并加速瓶颈-根据有界系统理论的原理（戈德拉特原理），这将产生最大的效果。否则，瓶颈将失败。整个系统应该从他那里工作：“鼓缓冲绳”的原理。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从物理上讲不可能在1分钟内将整个体积洒在10分钟的沙漏中-显然它们会崩溃。</font><font style="vertical-align: inherit;">同样提供服务。</font><font style="vertical-align: inherit;">它并不使任何人感到惊讶-当轮到MFC和丑闻来接收服务时，却让所有人感到惊讶-为什么门户网站关闭。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
根据</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">排队理论</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，负载处理行为有不同的模式</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以暂停用户，即 </font><font style="vertical-align: inherit;">增加队列；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 您可以简单地拒绝为后来的那些人提供服务，例如，直到处理之前的那些人为止；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 您可以尝试不断提高生产力。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
权宜之计介于两者之间。实际上，对于区域或州提供的资源有限的服务，不仅速度很重要，而且首先要维护社会正义，即所有人享有平等的条件。同时-如果用户没有收到他需要的东西，他将发起一个新的请求。在这种情况下，请求会雪崩地增长，形成</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">攻击“</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">狗堆效应</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">”</font></a><font style="vertical-align: inherit;">（狗堆效应，缓存踩踏，命中未命中风暴）的模型-用户已经取消了请求并发起了一个新请求，而前一个请求仍在队列中进行处理。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这个过程强化了整个家庭都参与提交的事实-爸爸和妈妈同时填写申请，并且出于可靠性的考虑，经常提交几次申请。</font><font style="vertical-align: inherit;">此外，通常还可以在多个选项卡和多个浏览器中使用。</font><font style="vertical-align: inherit;">因此，通常预期的高峰负载是实际申请此类服务的人数的2-3倍。</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">司法撤退</font></font></b>
                        <div class="spoiler_text">,   «»,            .   ?  «»    ,    .   .     —        ,     .        « ».        .          .<br>
</div>
                    </div><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供服务的组织</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们根据去年提交的申请总数数据和其他地区的每分钟数据综合计算出了预期的申请人数。</font><font style="vertical-align: inherit;">通常，应用程序的高峰时间为5-10分钟，这包括因为门户网站在最初的3至5分钟内几乎没有响应，而后来的用户则在1至5分钟内填写了表格（不要感到惊讶，即使在这种“紧张”的情况下，很多人仍从电话中填写表格） 。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
每小时有条件的1000个应用程序的近似计算模型如下：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 从一开始的5到10分钟达到峰值，并且80％的申请将根据Paretto规则提交</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 按照惯例，我们计划每分钟160个应用程序或每秒3个应用程序。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
实际上，第一次提交是在1分45秒之后发生的，申请的高峰期是4分钟。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了减少ESIA和系统上产生授权会话的负担，这些说明建议用户提前登录并延长会话寿命。</font><font style="vertical-align: inherit;">实际上，一小时内授权了50％，半小时内授权了约90％。</font><font style="vertical-align: inherit;">我们之前遇到过，用户在服务启动前10分钟开始登录门户-授权开始不稳定。</font><font style="vertical-align: inherit;">很难说为什么。</font><font style="vertical-align: inherit;">也许原因是当晚上在莫斯科，哈巴罗夫斯克进行技术工作时，我们才刚刚开始工作。</font></font><br>
 <br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">退修指导和组织安排</font></font></b>
                        <div class="spoiler_text">            <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"></a>.<br>
<br>
         ,    « »     . ..      .       ,   -   .. <br>
<br>
    ,        ,         ,    .        -        .      ,       ,      .<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在00:00重新加载表单时，无法删除“增量功能”。该过程的重点是该服务在给定时间出现。但是，您可以尝试减少所有预期用户路由上的浏览器请求的数量，从而仅将必需的请求（表单，动态目录和发送应用程序）留在系统上。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nginx设置本身是相当标准的。在这里，选择系统可以承受的限制更为重要。接他们-即当服务器预计将达到其功能极限时，开始排队请求。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
好了，最重要的是，我们对所有静态路径以及（如果可能的话，其中没有会话的）动态页面强制进行了缓存（proxy_cache），并增加了nginx中“过期”数据的生存期。顺便说一句，这是缓存时的常见错误-写入保存了他人会话的缓存数据（有时甚至是静态数据），如果服务器无法分离数据类型，则输出通常是从标头中删除这些cookie。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在用户浏览器中，看起来就像从磁盘或内存下载的文件中更新页面。但是，即使用户从服务器获取它们，它们也会从nginx缓存中获取。目录本身当然会缓存在系统本身中。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qi/oq/nv/qioqnv0ofdjd5e0ygculnetdta4.png" alt="图片"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这将潜在请求的数量从89个减少到14个，并将容量从2.1 MB（对于1000个更新页面的用户来说，这是一个潜在的峰值4-8 Gbit / s）减少到38 Kb（我们都记得webpack，但是对于企业平台，这不是总是很容易做到）。根据段落的结果，仍然有必要不仅在系统中缓存，而且还要在nginx中缓存一些表格和动态分类器中的某些目录，这些目录和动态分类器在高峰时刻没有使用，并强制它们的生命周期。随着负载的增加，通常有必要放在主页面上，将用户路由到所需的服务，或者为该服务创建单独的资源。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了减轻发送负担，已禁用了该儿童的草稿和自动填充数据的功能。所有用户的数据输入速度不同，这消除了完全可以提交的表单的外观，并且避免了发送应用程序的增量功能-一分钟内可以发送1000个数据。同时，维护了社会正义，尽管当然会出现抱怨。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我不会描述系统本身的优化-在负载测试期间，发现瓶颈-主要在DBMS查询中，并且对索引和查询本身进行了优化。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可能最重要的优化是简化表格。以表单实施时，对速度影响最大的是什么？</font></font><br>
<br>
<ul>
<li>   —   ,        ,      .    —       5-10 (   iPhone         )   5-       375 /  (1       10 ,     <code>application/x-www-form-urlencoded </code>–  20 ),  100      625 /.           100/      —        .   ,      «  ».    —     ?     ,     .    ,      ?</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">精致的指南。</font><font style="vertical-align: inherit;">通常通过使用FIAS或CLADR地址目录来增加负载。</font><font style="vertical-align: inherit;">这里的问题是由于大小引起的-FIAS在数据库中占用40GB的空间，并且需要花费一些时间进行搜索。</font><font style="vertical-align: inherit;">十分之一秒（但乘以1000个并发请求）将加载任何系统。</font><font style="vertical-align: inherit;">如果没有特殊的准备（可能以单独的Web服务的形式和在单独的资源上），则很难承受负载-因此，他们通常使用纯文本字段作为地址。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
好吧，让我们继续进行测试。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">准备进行负载测试</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
测试是通过伪造者完成的-通过在Crominium浏览器中模拟用户操作。</font><font style="vertical-align: inherit;">Yanedeks.tank和JMeter阻止了针对攻击的防护，因为它们生成许多相同类型的请求。</font><font style="vertical-align: inherit;">另外，这些测试在更改系统在负载下的行为时，与实际查询的特性几乎不符。</font><font style="vertical-align: inherit;">另外，服务器缓存请求，并且很难在其中重现部分过程（例如，授权）。</font><font style="vertical-align: inherit;">顺便说一句，在其中一个</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devDV</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">研讨会中，</font><font style="vertical-align: inherit;">我们做了一个演讲，里面有关于使用</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">伪造者</font></a><font style="vertical-align: inherit;">进行测试的演讲，包括 </font><font style="vertical-align: inherit;">加载，</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链接到视频</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，我们编译了一个用户行为配置文件，并将该过程分为几个关键阶段：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ESIA中的批量授权</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 一次性更新服务表格，</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 大量进料 </font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于每个阶段，我们都进行了单独的测试。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
去年，在ESIA的授权阶段遇到了困难，但是要对其进行全面测试是困难的。该系统是外部的，可以防范攻击和禁止授权。尽管如此，仍然可以制定测试配置文件来精确测试被测系统的瓶颈-通常这是同时授权的会话数和每分钟计划的授权值，可以通过建议进行调节。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在测试中，包装对于组织多个线程很重要，我们使用“ puppeteer-cluster”。但通常处理异常和更改门户网站在负载下的行为会更加复杂-布局元素通常会弹出两次。或者，如果某些数据未按预期加载，则元素不会出现。这些都是用户将看到并重新加载页面的所有错误-这意味着他们将创建其他加载。有两种方法：在测试中实施异常处理。或修改门户。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
测试本身很简单。以下是从单击服务门户上的“登录”按钮到将数据输入ESIA的片段。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">await</span> page.waitForSelector(AUTH_AVAIL,{<span class="hljs-attr">timeout</span>:OPT_ELEM_WAIT_TIME});
<span class="hljs-keyword">const</span> needAuth = <span class="hljs-keyword">await</span> page.$(ELEM_AUTH_IN);
<span class="hljs-keyword">if</span> (!needAuth) <span class="hljs-keyword">throw</span> (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`  `</span>));<font></font>
        <font></font>
<span class="hljs-keyword">await</span> page.waitForSelector(AUTH_BUT, OPT_ELEMENT_VISIBLE);
<span class="hljs-keyword">await</span> page.click(AUTH_BUT);
<span class="hljs-keyword">await</span> waitNewUrl(page, <span class="hljs-string">'https://esia.gosuslugi.ru/idp/rlogin?cc=bp'</span>, OPT_PAGE_WAIT_TIME);
<span class="hljs-keyword">await</span> page.waitForSelector(<span class="hljs-string">'#mobileOrEmail'</span>, OPT_ELEMENT_VISIBLE);
<span class="hljs-keyword">let</span> text = <span class="hljs-keyword">await</span> elemGetText(page, <span class="hljs-string">'#authnFrm &gt; div.login-slils-box &gt; div &gt; div.detected &gt; div.left &gt; div.this-user'</span>);
<span class="hljs-keyword">if</span> (text) <font></font>
   text = text.replace(<span class="hljs-regexp">/ -\(\)/g</span>, <span class="hljs-string">''</span>);        
<span class="hljs-keyword">if</span> (text &amp;&amp; text.indexOf(user) === <span class="hljs-number">-1</span>) {
  <span class="hljs-keyword">await</span> page.click(<span class="hljs-string">'div.click-to-another &gt; a'</span>);
  <span class="hljs-keyword">await</span> page.waitForSelector(<span class="hljs-string">'#authnFrm &gt; div.login-slils-box &gt; div &gt;'</span> +
                <span class="hljs-string">' div.detected &gt; div.left &gt; div.this-user'</span>, OPT_ELEMENT_INVISIBLE);<font></font>
}<font></font>
<span class="hljs-keyword">await</span> page.waitForSelector(<span class="hljs-string">'#password'</span>, OPT_ELEMENT_VISIBLE);
<span class="hljs-keyword">await</span> page.type(<span class="hljs-string">'#mobileOrEmail'</span>, user);
<span class="hljs-keyword">await</span> page.type(<span class="hljs-string">'#password'</span>, pwd);
<span class="hljs-keyword">await</span> page.click(<span class="hljs-string">'#loginByPwdButton'</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
验证更新申请表的未决用户“正在打开记录”。重新启动测试本质上是一个步骤，但是检查返回的错误类型非常重要-网络存在问题，nginx错误，服务器错误以及表单是否符合条件。困难在于在最短的时间内生成最大数量的请求并且不属于保护限制（但是，在测试期间可以更改它，另一方面，这也是对网络和服务器基础结构设置以及WAF的检查）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对p的这种测试需要大量资源才能工作。实际上，事实证明，相对于前端子系统的第1个核心和一个非常宽的通道，您至少需要2个核心。但是，在云中租用它们时-这是相当实惠的。我们使用了Yandex.cloud。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在测试中，首先在ESIA中为每个流分别实现授权。</font><font style="vertical-align: inherit;">之后，为每个线程启动一个单独的浏览器，并在一个实例的框架内执行给定数量的更新。</font><font style="vertical-align: inherit;">之后，实例将重新启动。</font><font style="vertical-align: inherit;">支票本身可以包括典型路径，例如主页，服务形式。</font><font style="vertical-align: inherit;">但是更多的情况是，仅完全更新服务并检查可以提交服务的必要目录就足够了，所有操作均在用户说明中进行。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/oe/8w/vk/oe8wvknrrkkw1hn3vb4ke0oh8sw.png" alt="图片"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
测试的一个片段打开主页面并刷新页面。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">await</span> page.setViewport(PUP_OPT);
  <span class="hljs-keyword">await</span> page.goto(BASE_URL);
  <span class="hljs-keyword">await</span> page.setCookie(...cookies[worker.id]);
  <span class="hljs-keyword">await</span> page.goto(<span class="hljs-string">`<span class="hljs-subst">${BASE_URL}</span>/nd/lk/form/dnv.htm`</span>);<font></font>
  rdyRefresh++;<font></font>
} <span class="hljs-keyword">catch</span> (err) {
  <span class="hljs-built_in">console</span>.error(<span class="hljs-string">`#       <span class="hljs-subst">${data}</span>: <span class="hljs-subst">${err.message}</span>`</span>);<font></font>
  getErr++;<font></font>
  <span class="hljs-keyword">await</span> page.screenshot({<span class="hljs-attr">path</span>: filename});<font></font>
}<font></font>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; AMOUNT_REFRESH - <span class="hljs-number">1</span>; i++) {
  <span class="hljs-keyword">const</span> filenameIter = path.join(BASE_DIR, PIC_DIR, <span class="hljs-string">`<span class="hljs-subst">${data}</span>-<span class="hljs-subst">${i}</span>.png`</span>);
   <span class="hljs-keyword">try</span> {
       <span class="hljs-keyword">await</span> page.reload({<span class="hljs-attr">waitUntil</span>: [<span class="hljs-string">"networkidle0"</span>, <span class="hljs-string">"domcontentloaded"</span>]});<font></font>
        rdyRefresh++;<font></font>
    } <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-keyword">if</span> (!err.message.includes(<span class="hljs-string">'Navigation failed because browser'</span>)) {
           <span class="hljs-built_in">console</span>.error(<span class="hljs-string">`#     <span class="hljs-subst">${data}</span>-<span class="hljs-subst">${i}</span>: <span class="hljs-subst">${err.message}</span>`</span>);<font></font>
           getErr++;<font></font>
           <span class="hljs-keyword">await</span> page.screenshot({<span class="hljs-attr">path</span>: filenameIter});<font></font>
        }<font></font>
   }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于通过发送应用程序进行加载的过程，整个验证周期得以实现-重新加载表格并验证所有数据的输入。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分段。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; AMOUNT_RESEND; i++) {
   <span class="hljs-keyword">const</span> filename = path.join(BASE_DIR, PIC_DIR, <span class="hljs-string">`<span class="hljs-subst">${data}</span>-<span class="hljs-subst">${i}</span>.png`</span>);
  <span class="hljs-keyword">try</span> {
     <span class="hljs-keyword">await</span> page.goto(<span class="hljs-string">'https://uslugi27.ru/nd/lk/form/dnv.htm'</span>);<font></font>
  } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-built_in">console</span>.error(<span class="hljs-string">`#      1  <span class="hljs-subst">${data}</span>-<span class="hljs-subst">${i}</span>: <span class="hljs-subst">${err.message}</span>`</span>);
      <span class="hljs-keyword">await</span> page.screenshot({<span class="hljs-attr">path</span>: filename});<font></font>
      getErr++;<font></font>
      <span class="hljs-keyword">continue</span>;<font></font>
 }<font></font>
 <span class="hljs-keyword">try</span> {
     <span class="hljs-keyword">const</span> FORM_PREF = <span class="hljs-string">'#createForm &gt; div:nth-child(4) &gt; '</span>;
     <span class="hljs-keyword">await</span> clickDelayed(page,<span class="hljs-string">`<span class="hljs-subst">${FORM_PREF}</span>fieldset.petgroup.ungroupped-attrs &gt; div &gt; div:nth-child(4) &gt; div.col-md-9.attr-data`</span>);
<span class="hljs-comment">// &lt;…&gt;</span>
     <span class="hljs-keyword">await</span> page.type(<span class="hljs-string">`<span class="hljs-subst">${FORM_PREF}</span>fieldset:nth-child(2) &gt; div &gt; div:nth-child(1) &gt; div.col-md-9.attr-data &gt; input`</span>, <span class="hljs-string">''</span>);
<span class="hljs-comment">// &lt;…&gt;</span>
  } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-built_in">console</span>.error(<span class="hljs-string">`#      <span class="hljs-subst">${data}</span>-<span class="hljs-subst">${i}</span>: <span class="hljs-subst">${err.message}</span>`</span>);
      <span class="hljs-keyword">await</span> page.screenshot({<span class="hljs-attr">path</span>: filename});
     <span class="hljs-keyword">continue</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> page.click(<span class="hljs-string">'#createForm &gt; div.col_100.controls &gt; button.btn.btn-primary.pull-right.next'</span>);
      <span class="hljs-keyword">await</span> clickDelayed(page,<span class="hljs-string">`#createForm &gt; div:nth-child(5) &gt; fieldset &gt; div &gt; div:nth-child(1) &gt; div &gt; div`</span>);
       <span class="hljs-keyword">await</span> page.click(<span class="hljs-string">'#createForm &gt; div:nth-child(5) &gt; fieldset &gt; div &gt; div:nth-child(2) &gt; div &gt; div'</span>);
       <span class="hljs-keyword">await</span> page.click(<span class="hljs-string">'#createForm &gt; div.col_100.controls &gt; button.btn.btn-success.pull-right.submit'</span>);<font></font>
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-built_in">console</span>.error(<span class="hljs-string">`#     <span class="hljs-subst">${data}</span>-<span class="hljs-subst">${i}</span>: <span class="hljs-subst">${err.message}</span>`</span>);
    <span class="hljs-keyword">await</span> page.screenshot({<span class="hljs-attr">path</span>: filename});<font></font>
    sendErr++;<font></font>
    <span class="hljs-keyword">continue</span>;<font></font>
  }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
顺便说一下，如果您不是通过await page.type构造输入来自puppeteer的所有数据，而是将这种逻辑传递给浏览器本身，则可以加快测试速度。但是，捕获错误的复杂性增加了。像这样</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'#createForm &gt; div:nth-child(4) &gt; fieldset.petgroup.ungroupped-attrs &gt; div &gt; div:nth-child(4) &gt; div.col-md-9.attr-data'</span>).click();
 <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'#createForm &gt; div:nth-child(4) &gt; fieldset:nth-child(2) &gt; div &gt; div:nth-child(1) &gt; div.col-md-9.attr-data &gt; input'</span>).value = <span class="hljs-string">''</span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在测试期间，我们提供了数千个ESIA授权，并发送了约1.6万份申请。经过如此多的陈述后，如何恢复生产性教育信息系统-甚至不问。这是一个完全不同的故事。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这个过程的主要可见结果是，当地的媒体在一年级入学的那一天就很无聊。该服务已离开媒体区域。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同时，我们制作了一个仪表板，用于监视基于Grafana的表单的功能：应用程序数量，调用数量，Yandex指标等。但是，下一次我们将离开这个话题。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
好吧，我要祝贺与提高电子形式的州和市政服务质量有关的每个人。</font><font style="vertical-align: inherit;">这项无休止的准备工作没有白费-毕竟，在4月和5月，提交的申请数量大大增加了。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN502068/index.html">电脑上的110伏</a></li>
<li><a href="../zh-CN502070/index.html">宾得的历史（文章和视频）</a></li>
<li><a href="../zh-CN502072/index.html">使用JavaScript和指南针对接ISS</a></li>
<li><a href="../zh-CN502076/index.html">台车机器人2.0。第1部分。基于ROS的家用机器人的自主导航</a></li>
<li><a href="../zh-CN502080/index.html">看板方法：示例PNZ No.1，启动中的测量研究过程</a></li>
<li><a href="../zh-CN502086/index.html">设置Minio，以便用户只能使用自己的存储桶</a></li>
<li><a href="../zh-CN502088/index.html">浪费时间和浪费的故事。根据py3</a></li>
<li><a href="../zh-CN502092/index.html">俄罗斯联邦对数字信任服务的技术和法规支持</a></li>
<li><a href="../zh-CN502098/index.html">我们如何建立B2B</a></li>
<li><a href="../zh-CN502102/index.html">AutoML既强大又强大</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>