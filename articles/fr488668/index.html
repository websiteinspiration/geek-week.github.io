<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👂 🛌🏼 👨🏽‍🎤 Chaînage CI / CD et automatisation Docker 🍸 💠 ⚜️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="J'ai écrit mes premiers sites à la fin des années 90. Ensuite, les mettre en condition de travail était très simple. Il y avait un serveur Apache sur ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Chaînage CI / CD et automatisation Docker</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/488668/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'ai écrit mes premiers sites à la fin des années 90. Ensuite, les mettre en condition de travail était très simple. Il y avait un serveur Apache sur certains hébergements partagés, vous pouvez vous connecter à ce serveur via FTP, en écrivant quelque chose comme ça dans la ligne du navigateur </font></font><code>ftp://ftp.example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Il a ensuite fallu saisir un nom et un mot de passe et télécharger des fichiers sur le serveur. Il y a eu d'autres moments, tout était plus facile à l'époque que maintenant. </font><font style="vertical-align: inherit;">
Au cours des deux dernières décennies, tout a beaucoup changé. Les sites sont devenus plus complexes, ils doivent être assemblés avant d'être mis en production. Un seul serveur est devenu une pluralité de serveurs travaillant derrière des équilibreurs de charge; l'utilisation de systèmes de contrôle de version est devenue courante.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/cg/bv/ch/cgbvchdac53hqrfbqadsqimp0oa.jpeg"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour mon projet personnel, j'avais une configuration spéciale. Et je savais que j'avais besoin de pouvoir déployer un site en production, en n'effectuant qu'une seule action: écrire du code dans une branche </font></font><code>master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur GitHub. De plus, je savais que pour assurer le fonctionnement de ma petite application Web, je ne voulais pas gérer un énorme cluster Kubernetes, ni utiliser la technologie Docker Swarm, ni maintenir un parc de serveurs avec des pods, des agents et toutes sortes d'autres difficultés. Afin d'atteindre l'objectif de simplifier le travail autant que possible, je devais me familiariser avec CI / CD.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous avez un petit projet (dans notre cas, nous parlons d'un projet Node.js) et que vous souhaitez savoir comment automatiser le déploiement de ce projet, tout en vous assurant que ce qui est stocké dans le référentiel correspond exactement ce qui fonctionne en production, je pense que cet article pourrait vous intéresser.</font></font><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conditions préalables</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le lecteur de cet article devrait avoir une connaissance de base de la zone de ligne de commande et écrire des scripts Bash. </font><font style="vertical-align: inherit;">De plus, il aura besoin de comptes </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Travis CI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker Hub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Buts</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne dirai pas que cet article peut être appelé sans condition un "manuel de formation". </font><font style="vertical-align: inherit;">C'est plutôt un document dans lequel je parle de ce que j'ai appris et décris le processus de test et de déploiement de code en production qui me convient, réalisé en un seul passage automatisé. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est ainsi que mon workflow s'est terminé. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À l'exception du code envoyé à n'importe quelle branche du référentiel, les </font></font><code>master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">actions suivantes sont effectuées:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Générez le projet sur Travis CI.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tous les tests unitaires, d'intégration et de bout en bout sont effectués.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uniquement pour le code qui entre dans </font></font><code>master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les cales suivantes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tout ce qui est dit plus haut, plus ...</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Créez l'image Docker en fonction du code, des paramètres et de l'environnement actuels.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Placement d'une image sur le Docker Hub.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connexion au serveur de production.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Téléchargement de l'image du Docker Hub vers le serveur.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arrêtez le conteneur actuel et démarrez-en un nouveau en fonction de la nouvelle image.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous ne savez absolument rien de Docker, des images et des conteneurs - ne vous inquiétez pas. </font><font style="vertical-align: inherit;">Je vais tout vous dire à ce sujet.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qu'est-ce qu'un CI / CD?</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'abréviation CI / CD signifie "intégration continue / déploiement continu" - "intégration continue / déploiement continu".</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Intégration continue</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'intégration continue est un processus au cours duquel les développeurs effectuent des validations dans le référentiel principal du code source du projet (généralement dans une branche </font></font><code>master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Dans le même temps, la qualité du code est assurée par la réalisation de tests automatisés.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Déploiement continu</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le déploiement continu est le déploiement automatisé fréquent de code en production. </font><font style="vertical-align: inherit;">La deuxième partie de l'abréviation CI / CD est parfois décrite comme "livraison continue" ("livraison continue"). </font><font style="vertical-align: inherit;">Ceci, en général, est identique au «déploiement continu», mais la «livraison continue» implique la nécessité d'une confirmation manuelle des modifications avant de démarrer le processus de déploiement du projet.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Début des travaux</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'application sur laquelle je maîtrise tout s'appelle </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TakeNote</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Il s'agit du projet Web sur lequel je travaille, conçu pour prendre des notes. Au début, j'ai essayé de créer un </font><font style="vertical-align: inherit;">projet </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JAMStack</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ou simplement une application frontale sans serveur, afin de profiter des </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">capacités d'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hébergement et de déploiement standard offertes par </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">Netlify</font></a><font style="vertical-align: inherit;"> . Au fur et à mesure que la complexité de l'application augmentait, je devais créer sa partie serveur, ce qui signifiait que je devrais élaborer ma propre stratégie d'intégration automatisée et de déploiement automatisé du projet.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans mon cas, l'application est un serveur Express fonctionnant dans l'environnement Node.js, servant une application React d'une seule page et prenant en charge une API de serveur sécurisée. </font><font style="vertical-align: inherit;">Cette architecture suit la stratégie trouvée dans </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ce</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> guide d'authentification de pile complète. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai consulté un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ami</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qui est un expert en automatisation et lui ai demandé ce que je devais faire pour que cela fonctionne comme je le souhaitais. </font><font style="vertical-align: inherit;">Il m'a donné une idée de ce à quoi devrait ressembler un flux de travail automatisé, décrit dans la section Objectifs de cet article. </font><font style="vertical-align: inherit;">Le fait que je me sois fixé de tels objectifs signifiait que je devais comprendre comment utiliser Docker.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Docker est un outil qui, grâce à la technologie de conteneurisation, facilite la distribution des applications, ainsi que leur déploiement et leur lancement dans le même environnement, même si la plateforme Docker elle-même fonctionne dans des environnements différents. Pour commencer, j'avais besoin d'avoir des outils de ligne de commande (CLI) Docker à ma disposition. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les instructions</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> d'installation de Docker ne peuvent pas être qualifiées de très claires et compréhensibles, mais vous pouvez en apprendre que pour effectuer la première étape de l'installation, vous devez télécharger Docker Desktop (pour Mac ou Windows). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Docker Hub est à peu près le même que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour les référentiels git ou le registre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">npm</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour les packages JavaScript. </font><font style="vertical-align: inherit;">Il s'agit d'un référentiel en ligne pour les images Docker. </font><font style="vertical-align: inherit;">Il s'y connecte Docker Desktop. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, pour commencer avec Docker, vous devez faire deux choses:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installez </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker Desktop</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inscrivez-vous au </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker Hub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après cela, vous pouvez vérifier que la CLI Docker fonctionne en exécutant la commande suivante pour vérifier la version de Docker:</font></font><br>
<br>
<pre><code class="plaintext hljs">docker -v</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, connectez-vous au Docker Hub en entrant, à la demande, votre nom d'utilisateur et votre mot de passe:</font></font><br>
<br>
<pre><code class="plaintext hljs">docker login</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour utiliser Docker, vous devez comprendre les concepts d'images et de conteneurs.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Images</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une image est quelque chose comme un plan contenant des instructions pour la construction d'un conteneur. </font><font style="vertical-align: inherit;">Il s'agit d'un instantané immuable du système de fichiers et des paramètres d'application. </font><font style="vertical-align: inherit;">Les développeurs peuvent facilement partager des images.</font></font><br>
<br>
<pre><code class="plaintext hljs">#     <font></font>
docker images</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette commande affichera un tableau avec l'en-tête suivant:</font></font><br>
<br>
<pre><code class="plaintext hljs">REPOSITORY &nbsp; &nbsp; TAG     IMAGE ID &nbsp; &nbsp; CREATED     SIZE<font></font>
---</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous allons considérer quelques exemples de commandes dans le même format - vient d'abord une commande avec un commentaire, puis un exemple de ce qu'elle peut produire.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍Conteneurs</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un conteneur est un package exécutable qui contient tout ce dont vous avez besoin pour exécuter une application. </font><font style="vertical-align: inherit;">Une application avec cette approche fonctionnera toujours de la même manière, quelle que soit l'infrastructure: dans un environnement isolé et dans le même environnement. </font><font style="vertical-align: inherit;">Le fait est que dans des environnements différents, des instances de la même image sont lancées.</font></font><br>
<br>
<pre><code class="plaintext hljs">#   <font></font>
docker ps -a<font></font>
CONTAINER ID &nbsp; &nbsp; IMAGE     COMMAND &nbsp; &nbsp; CREATED     STATUS     PORTS &nbsp; &nbsp; NAMES<font></font>
---</code></pre><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍Étiquettes</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une balise est une indication d'une version spécifique d'une image.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Résumé de la commande Docker</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici un aperçu de certaines commandes Docker couramment utilisées.</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Équipe</font></font><br>
</th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le contexte</font></font><br>
</th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acte</font></font><br>
</th>
</tr>
<tr>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">construction de docker</font></font></a><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Forme</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assemblage d'une image à partir de Dockerfile</font></font><br>
</td>
</tr>
<tr>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tag docker</font></font></a><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Forme</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Marquage d'image</font></font><br>
</td>
</tr>
<tr>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">images de docker</font></font></a><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Forme</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liste des images</font></font><br>
</td>
</tr>
<tr>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docker run</font></font></a><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Récipient</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lancement de conteneur basé sur l'image</font></font><br>
</td>
</tr>
<tr>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docker push</font></font></a><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Forme</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soumettre une image au registre</font></font><br>
</td>
</tr>
<tr>
<td><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">traction de docker</font></font></a><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Forme</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Télécharger l'image du registre</font></font><br>
</td>
</tr>
<tr>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docker ps</font></font></a><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Récipient</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conteneur de liste</font></font><br>
</td>
</tr>
<tr>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">système de docker prune</font></font></a><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Image / conteneur</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suppression des conteneurs et des images inutilisés</font></font><br>
</td>
</tr>
</tbody></table></div><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Dockerfile</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je sais comment exécuter une application de production localement. </font><font style="vertical-align: inherit;">J'ai une configuration Webpack conçue pour créer une application React prête à l'emploi. </font><font style="vertical-align: inherit;">Ensuite, j'ai une commande qui démarre un serveur basé sur Node.js sur le port </font></font><code>5000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Cela ressemble à ceci:</font></font><br>
<br>
<pre><code class="plaintext hljs">npm i &nbsp; &nbsp; &nbsp; &nbsp; #  <font></font>
npm run build #  React-<font></font>
npm run start #  Node-</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il convient de noter que je n'ai pas d'exemple d'application pour ce matériel. </font><font style="vertical-align: inherit;">Mais ici, pour les expériences, toute application Node simple convient. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour utiliser le conteneur, vous devez donner des instructions à Docker. </font><font style="vertical-align: inherit;">Cela se fait via un fichier appelé </font></font><code>Dockerfile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">situé dans le répertoire racine du projet. </font><font style="vertical-align: inherit;">Ce fichier, au premier abord, semble assez obscur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais ce qu'il contient décrit uniquement, avec des commandes spéciales, quelque chose de similaire à la configuration d'un environnement de travail. </font><font style="vertical-align: inherit;">Voici certaines de ces commandes:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FROM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Cette commande démarre le fichier. </font><font style="vertical-align: inherit;">Il indique l'image de base sur la base de laquelle le conteneur est construit.</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COPY</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Copiez des fichiers d'une source locale vers un conteneur.</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WORKDIR</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Définition du répertoire de travail pour les commandes suivantes.</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RUN</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Exécute les commandes.</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXPOSE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Paramètres du port.</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ENTRYPOINT</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Spécifie la commande à exécuter.</font></font></li>
</ul><br>
<code>Dockerfile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pourrait ressembler à ceci:</font></font><br>
<br>
<pre><code class="plaintext hljs">#   <font></font>
FROM node:12-alpine<font></font>
<font></font>
#        app/<font></font>
COPY . app/<font></font>
<font></font>
#  app/    <font></font>
WORKDIR app/<font></font>
<font></font>
#   ( npm ci  npm i,     )<font></font>
RUN npm ci --only-production<font></font>
<font></font>
#   React-  <font></font>
RUN npm run build<font></font>
<font></font>
#   <font></font>
EXPOSE 5000<font></font>
<font></font>
#  Node-<font></font>
ENTRYPOINT npm run start</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selon l'image de base sélectionnée, vous devrez peut-être installer des dépendances supplémentaires. </font><font style="vertical-align: inherit;">Le fait est que certaines images de base (comme Node Alpine Linux) sont conçues pour les rendre aussi compactes que possible. </font><font style="vertical-align: inherit;">Par conséquent, ils peuvent ne pas avoir certains des programmes sur lesquels vous comptez.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Construire, étiqueter et lancer un conteneur</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'assemblage local et le lancement du conteneur sont, après nous </font></font><code>Dockerfile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, les tâches sont assez simples. </font><font style="vertical-align: inherit;">Avant d'envoyer une image au Docker Hub, vous devez la tester localement.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Assemblage</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous devez d'abord collecter l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">image</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en spécifiant un nom et, éventuellement, une balise (si la balise n'est pas spécifiée, le système attribuera automatiquement une balise à l'image </font></font><code>latest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).</font></font><br>
<br>
<pre><code class="plaintext hljs">#  <font></font>
docker build -t &lt;image&gt;:&lt;tag&gt; .</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir exécuté cette commande, vous pouvez observer comment Docker crée l'image.</font></font><br>
<br>
<pre><code class="plaintext hljs">Sending build context to Docker daemon &nbsp; 2.88MB<font></font>
Step 1/9 : FROM node:12-alpine<font></font>
&nbsp;---&gt; ...  ...<font></font>
Successfully built 123456789123<font></font>
Successfully tagged &lt;image&gt;:&lt;tag&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'assemblage peut prendre quelques minutes - tout dépend du nombre de dépendances dont vous disposez. </font><font style="vertical-align: inherit;">Une fois l'assemblage terminé, vous pouvez exécuter la commande </font></font><code>docker images</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et consulter la description de votre nouvelle image.</font></font><br>
<br>
<pre><code class="plaintext hljs">REPOSITORY&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TAG               IMAGE ID&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CREATED              SIZE<font></font>
&lt;image&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; latest            123456789123&nbsp; &nbsp; &nbsp; &nbsp; About a minute ago   x.xxGB</code></pre><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍Démarrer</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'image est créée. </font><font style="vertical-align: inherit;">Et cela signifie que sur sa base, il est possible de lancer un conteneur. </font><font style="vertical-align: inherit;">Étant donné que je veux pouvoir accéder à l'application en cours d'exécution dans le conteneur à l'adresse que </font></font><code>localhost:5000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">j'ai </font></font><code>5000:5000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">installée </font><font style="vertical-align: inherit;">sur le côté gauche de la paire </font><font style="vertical-align: inherit;">dans la commande suivante </font></font><code>5000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Sur le côté droit se trouve le port à conteneurs.</font></font><br>
<br>
<pre><code class="plaintext hljs">#      5000    5000<font></font>
docker run -p 5000:5000 &lt;image&gt;:&lt;tag&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant que le conteneur est créé et lancé, vous pouvez utiliser la commande </font></font><code>docker ps</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour consulter les informations sur ce conteneur (ou vous pouvez utiliser la commande </font></font><code>docker ps -a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui affiche des informations sur tous les conteneurs, pas seulement ceux qui fonctionnent).</font></font><br>
<br>
<pre><code class="plaintext hljs">CONTAINER ID&nbsp; &nbsp; &nbsp; &nbsp; IMAGE               COMMAND&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CREATED              STATUS                  &nbsp; &nbsp; PORTS                    NAMES<font></font>
987654321234&nbsp; &nbsp; &nbsp; &nbsp; &lt;image&gt;             "/bin/sh -c 'npm run…" &nbsp; 6 seconds ago        Up 6 seconds            &nbsp; &nbsp; 0.0.0.0:5000-&gt;5000/tcp   stoic_darwin</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous allez à l'adresse maintenant </font></font><code>localhost:5000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, vous pouvez voir la page de l'application de travail, qui ressemble exactement à la page de l'application fonctionnant dans l'environnement de production.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Affectation et publication des balises</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afin d'utiliser l'une des images créées sur le serveur de production, nous devons être en mesure de télécharger cette image à partir du Docker Hub. </font><font style="vertical-align: inherit;">Cela signifie que vous devez d'abord créer un référentiel pour le projet sur le Docker Hub. </font><font style="vertical-align: inherit;">Après cela, nous aurons à notre disposition un endroit où vous pourrez fixer l'image. </font><font style="vertical-align: inherit;">L'image doit être renommée pour que son nom commence par notre nom d'utilisateur sur le Docker Hub. </font><font style="vertical-align: inherit;">Après cela devrait être le nom du référentiel. </font><font style="vertical-align: inherit;">À la fin du nom peut être n'importe quelle balise. </font><font style="vertical-align: inherit;">Voici un exemple de dénomination d'images à l'aide de ce schéma. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez maintenant collecter l'image avec un nouveau nom et exécuter la commande </font></font><code>docker push</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour l'envoyer au référentiel Docker Hub.</font></font><br>
<br>
<pre><code class="plaintext hljs">docker build -t &lt;username&gt;/&lt;repository&gt;:&lt;tag&gt; .<font></font>
docker tag &lt;username&gt;/&lt;repository&gt;:&lt;tag&gt; &lt;username&gt;/&lt;repository&gt;:latest<font></font>
docker push &lt;username&gt;/&lt;repository&gt;:&lt;tag&gt;<font></font>
<font></font>
#     , , :<font></font>
docker build -t user/app:v1.0.0 .<font></font>
docker tag user/app:v1.0.0 user/app:latest<font></font>
docker push user/app:v1.0.0</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si tout se passe bien, l'image sera disponible sur le Docker Hub et pourra être facilement téléchargée sur le serveur ou transférée à d'autres développeurs.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prochaines étapes</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À ce jour, nous nous sommes assurés que l'application, sous la forme d'un conteneur Docker, fonctionne localement. </font><font style="vertical-align: inherit;">Nous avons téléchargé le conteneur sur le Docker Hub. </font><font style="vertical-align: inherit;">Tout cela signifie que nous avons déjà fait de très bons progrès vers l'objectif. </font><font style="vertical-align: inherit;">Maintenant, nous devons résoudre deux autres questions:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuration d'un outil CI pour tester et déployer du code.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuration du serveur de production pour qu'il puisse charger et exécuter notre code.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans notre cas, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Travis CI est</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilisé comme solution CI / CD </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">En tant que serveur - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DitigalOcean</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il convient de noter qu'ici, vous pouvez utiliser une autre combinaison de services. </font><font style="vertical-align: inherit;">Par exemple, au lieu de Travis CI, vous pouvez utiliser des actions CircleCI ou Github. </font><font style="vertical-align: inherit;">Et au lieu de DigitalOcean - AWS ou Linode. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons décidé de travailler avec Travis CI, et dans ce service, j'ai déjà quelque chose de configuré. </font><font style="vertical-align: inherit;">Par conséquent, je vais maintenant parler brièvement de la façon de le préparer au travail.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Travis ci</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Travis CI est un outil de test et de déploiement de code. Je ne voudrais pas entrer dans les subtilités de la mise en place de Travis CI, car chaque projet est unique, et cela n'apportera pas beaucoup d'avantages. Mais je vais vous parler des bases qui vous permettront de commencer si vous décidez d'utiliser Travis CI. Quoi que vous choisissiez - Travis CI, CircleCI, Jenkins ou autre chose, des méthodes de configuration similaires seront utilisées partout. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour commencer à travailler avec Travis CI, rendez-vous sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le site du projet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et créez un compte. </font><font style="vertical-align: inherit;">Intégrez ensuite Travis CI à votre compte GitHub. </font><font style="vertical-align: inherit;">Pendant la configuration du système, vous devrez spécifier le référentiel avec lequel vous souhaitez automatiser et autoriser l'accès à celui-ci. </font><font style="vertical-align: inherit;">(J'utilise GitHub, mais je suis sûr que Travis CI peut s'intégrer avec BitBucket, GitLab et d'autres services similaires). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chaque fois que Travis CI est mis au travail, un serveur est lancé qui exécute les commandes spécifiées dans le fichier de configuration, y compris le déploiement des branches de référentiel correspondantes.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Cycle de vie des tâches</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le fichier de configuration Travis CI, appelé </font></font><code>.travis.yml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et stocké dans le répertoire racine du projet, prend en charge le concept </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> événements de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">cycle de vie de</font></a><font style="vertical-align: inherit;"> travail. </font><font style="vertical-align: inherit;">Ces événements sont répertoriés dans l'ordre dans lequel ils se produisent:</font></font><br>
<br>
<ul>
<li><code>apt addons</code></li>
<li><code>cache components</code></li>
<li><code>before_install</code></li>
<li><code>install</code></li>
<li><code>before_script</code></li>
<li><code>script</code></li>
<li><code>before_cache</code></li>
<li><code>after_success  after_failure</code></li>
<li><code>before_deploy</code></li>
<li><code>deploy</code></li>
<li><code>after_deploy</code></li>
<li><code>after_script</code></li>
</ul><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍Testing</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le fichier de configuration, je vais configurer le serveur local Travis CI. Comme langue, j'ai choisi Node 12 et j'ai dit au système d'installer les dépendances nécessaires pour utiliser Docker. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout ce qui est répertorié dans </font></font><code>.travis.yml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sera exécuté lorsque toutes les demandes d'extraction vers toutes les branches du référentiel seront exécutées, sauf indication contraire. Il s'agit d'une fonctionnalité utile, car elle signifie que nous pouvons tester tout le code entrant dans le référentiel. Cela vous permet de savoir si le code est prêt à être écrit dans la branche </font></font><code>master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et s'il va perturber le processus de construction du projet. Dans cette configuration globale, j'installe tout localement, démarre le serveur de développement Webpack en arrière-plan (c'est une caractéristique de mon flux de travail) et exécute les tests.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous souhaitez afficher les </font><font style="vertical-align: inherit;">icônes sur votre référentiel avec des </font><font style="vertical-align: inherit;">informations sur la </font><font style="vertical-align: inherit;">couverture du code par les </font><font style="vertical-align: inherit;">tests, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vous trouverez de </font><font style="vertical-align: inherit;">brèves instructions sur l' </font><font style="vertical-align: inherit;">utilisation Jest, Travis CI et salopettes pour recueillir et afficher ces informations. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici donc le contenu du fichier </font></font><code>.travis.yml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">#  <font></font>
language: node_js<font></font>
<font></font>
#   Node.js<font></font>
node_js:<font></font>
&nbsp;&nbsp;- '12'<font></font>
<font></font>
services:<font></font>
&nbsp;&nbsp;#    Docker<font></font>
&nbsp;&nbsp;- docker<font></font>
<font></font>
install:<font></font>
&nbsp;&nbsp;#    <font></font>
&nbsp;&nbsp;- npm ci<font></font>
<font></font>
before_script:<font></font>
&nbsp;&nbsp;#      <font></font>
&nbsp;&nbsp;- npm run dev &amp;<font></font>
<font></font>
script:<font></font>
&nbsp;&nbsp;#  <font></font>
&nbsp;&nbsp;- npm run test</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici se terminent les actions effectuées pour toutes les branches du référentiel et pour les demandes d'extraction.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Déploiement</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En supposant que tous les tests automatisés se sont déroulés avec succès, nous pouvons éventuellement déployer le code sur le serveur de production. </font><font style="vertical-align: inherit;">Puisque nous voulons le faire uniquement pour le code d'une branche </font></font><code>master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, nous donnons au système des instructions appropriées dans les paramètres de déploiement. </font><font style="vertical-align: inherit;">Avant d'essayer d'utiliser le code dans votre projet, que nous examinerons plus tard, je voudrais vous avertir que vous devez avoir un vrai script appelé pour le déploiement.</font></font><br>
<br>
<pre><code class="plaintext hljs">deploy:<font></font>
&nbsp;&nbsp;#  Docker-     Docker Hub<font></font>
&nbsp;&nbsp;provider: script<font></font>
&nbsp;&nbsp;script: bash deploy.sh<font></font>
&nbsp;&nbsp;on:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;branch: master</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le script de déploiement résout deux problèmes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Créez, étiquetez et envoyez l'image au Docker Hub à l'aide de l'outil CI (dans notre cas, c'est Travis CI).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chargement de l'image sur le serveur, arrêt de l'ancien conteneur et démarrage du nouveau (dans notre cas, le serveur s'exécute sur la plateforme DigitalOcean).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous devez d'abord configurer le processus automatique d'assemblage, de marquage et d'envoi de l'image au Docker Hub. Tout cela est très similaire à ce que nous avons déjà fait manuellement, sauf qu'ici nous avons besoin d'une stratégie pour attribuer des balises uniques aux images et automatiser la connexion. J'ai eu des difficultés avec certains détails du script de déploiement, tels qu'une stratégie de balisage, la connexion, le codage des clés SSH, l'établissement d'une connexion SSH. Mais, heureusement, mon petit ami gère très bien bash, ainsi que bien d'autres choses. Il m'a aidé à écrire ce script.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, la première partie du script envoie l'image au Docker Hub. C'est assez simple. Le schéma de marquage que j'ai utilisé implique la combinaison d'un hachage git et d'un tag git, s'il en existe un. Cela permet la création d'une balise unique et simplifie l'identification de l'assemblage sur lequel elle est basée. </font></font><code>DOCKER_USERNAME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>DOCKER_PASSWORD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sont des variables d'environnement utilisateur qui peuvent être définies à l'aide de l'interface Travis CI. Travis CI traite automatiquement les données sensibles afin qu'elles ne tombent pas entre de mauvaises mains. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici la première partie du script </font></font><code>deploy.sh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="plaintext hljs">#!/bin/sh<font></font>
set -e #     <font></font>
<font></font>
IMAGE="&lt;username&gt;/&lt;repository&gt;" &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #  Docker<font></font>
GIT_VERSION=$(git describe --always --abbrev --tags --long) # Git-  <font></font>
<font></font>
#    <font></font>
docker build -t ${IMAGE}:${GIT_VERSION} .<font></font>
docker tag ${IMAGE}:${GIT_VERSION} ${IMAGE}:latest<font></font>
<font></font>
#   Docker Hub   <font></font>
echo "${DOCKER_PASSWORD}" | docker login -u "${DOCKER_USERNAME}" --password-stdin<font></font>
docker push ${IMAGE}:${GIT_VERSION}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La nature de la deuxième partie du script dépend de l'hôte que vous utilisez et de l'organisation de la connexion. Dans mon cas, depuis que j'utilise Digital Ocean, les commandes </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doctl</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sont utilisées pour se connecter au serveur </font><font style="vertical-align: inherit;">. Lorsque vous travaillez avec Aws, un utilitaire sera utilisé </font></font><code>aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La configuration du serveur n'a pas été particulièrement difficile. J'ai donc mis en place une gouttelette basée sur l'image de base. Il convient de noter que le système que j'ai sélectionné nécessite une installation manuelle unique de Docker et un lancement manuel unique de Docker. J'ai utilisé Ubuntu 18.04 pour installer Docker, donc si vous utilisez Ubuntu pour faire de même, vous pouvez simplement suivre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ce</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> guide simple.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne parle pas ici de commandes spécifiques pour le service, car cet aspect peut varier considérablement dans différents cas. </font><font style="vertical-align: inherit;">Je ne donnerai qu'un plan d'action général qui sera réalisé après connexion via SSH au serveur sur lequel le projet sera déployé:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous devez trouver le conteneur en cours d'exécution et l'arrêter.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ensuite, en arrière-plan, vous devez lancer un nouveau conteneur.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous devrez définir le port du serveur local sur une valeur </font></font><code>80</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- cela vous permettra d'entrer le site à l'adresse du formulaire </font></font><code>example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, sans spécifier le port, et de ne pas utiliser l'adresse comme </font></font><code>example.com:5000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et enfin, vous devez supprimer tous les anciens conteneurs et images.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici la suite du script.</font></font><br>
<br>
<pre><code class="plaintext hljs">#  ID  <font></font>
CONTAINER_ID=$(docker ps | grep takenote | cut -d" " -f1)<font></font>
<font></font>
#   ,  ,  <font></font>
docker stop ${CONTAINER_ID}<font></font>
docker run --restart unless-stopped -d -p 80:5000 ${IMAGE}:${GIT_VERSION}<font></font>
docker system prune -a -f</code></pre><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelques points à considérer</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peut-être que lorsque vous vous connectez au serveur via SSH à partir de Travis CI, vous verrez un avertissement qui ne permettra pas à l'installation de continuer, car le système attendra que l'utilisateur réponde.</font></font><br>
<br>
<pre><code class="plaintext hljs">The authenticity of host '&lt;hostname&gt; (&lt;IP address&gt;)' can't be established.<font></font>
RSA key fingerprint is &lt;key fingerprint&gt;.<font></font>
Are you sure you want to continue connecting (yes/no)?</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai appris que la clé de chaîne peut être encodée en base64 afin de l'enregistrer sous une forme dans laquelle il sera pratique et fiable de travailler avec elle. </font><font style="vertical-align: inherit;">Au stade de l'installation, vous pouvez décoder la clé publique et l'écrire dans un fichier </font></font><code>known_hosts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">afin de supprimer l'erreur ci-dessus.</font></font><br>
<br>
<pre><code class="plaintext hljs">echo &lt;public key&gt; | base64 #  &lt; ,   base64&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En pratique, cette commande peut ressembler à ceci:</font></font><br>
<br>
<pre><code class="plaintext hljs">echo "123.45.67.89 ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAklOUpkDHrfHY17SbrmTIpNLTGK9Tjom/BWDSU<font></font>
GPl+nafzlHDTYW7hdI4yZ5ew18JH4JW9jbhUFrviQzM7xlELEVf4h9lFX5QVkbPppSwg0cda3<font></font>
Pbv7kOdJ/MTyBlWXFCR+HAo3FXRitBqxiX1nKhXpHAZsMciLq8V6RjsNAQwdsdMFvSlVK/7XA<font></font>
t3FaoJoAsncM1Q9x5+3V0Ww68/eIFmb1zuUFljQJKprrX88XypNDvjYNby6vw/Pb0rwert/En<font></font>
mZ+AW4OZPnTPI89ZPmVMLuayrD2cE86Z/il8b+gw3r3+1nKatmIkjn2so1d01QraTlMqVSsbx<font></font>
NrRFi9wrf+M7Q== you@example.com" | base64</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et voici ce qu'elle donne - une chaîne encodée en base64:</font></font><br>
<br>
<pre><code class="plaintext hljs">MTIzLjQ1LjY3Ljg5IHNzaC1yc2EgQUFBQUIzTnphQzF5YzJFQUFBQUJJd0FBQVFFQWtsT1Vwa0RIcmZIWTE3U2JybVRJcE5MVEdLOVRqb20vQldEU1UKR1BsK25hZnpsSERUWVc3aGRJNHlaNWV3MThKSDRKVzlqYmhVRnJ2aVF6TTd4bEVMRVZmNGg5bEZYNVFWa2JQcHBTd2cwY2RhMwpQYnY3a09kSi9NVHlCbFdYRkNSK0hBbzNGWFJpdEJxeGlYMW5LaFhwSEFac01jaUxxOFY2UmpzTkFRd2RzZE1GdlNsVksvN1hBCnQzRmFvSm9Bc25jTTFROXg1KzNWMFd3NjgvZUlGbWIxenVVRmxqUUpLcHJyWDg4WHlwTkR2allOYnk2dncvUGIwcndlcnQvRW4KbVorQVc0T1pQblRQSTg5WlBtVk1MdWF5ckQyY0U4NlovaWw4YitndzNyMysxbkthdG1Ja2puMnNvMWQwMVFyYVRsTXFWU3NieApOclJGaTl3cmYrTTdRPT0geW91QGV4YW1wbGUuY29tCg==</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici l'équipe mentionnée ci-dessus</font></font><br>
<br>
<pre><code class="plaintext hljs">install:<font></font>
&nbsp;&nbsp;- echo &lt;  ,   base64&gt; | base64 -d &gt;&gt; $HOME/.ssh/known_hosts</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La même approche peut être utilisée avec une clé privée lors de l'établissement d'une connexion, car vous pouvez avoir besoin d'une clé privée pour accéder au serveur. </font><font style="vertical-align: inherit;">Lorsque vous travaillez avec une clé, il vous suffit de garantir son stockage sécurisé dans la variable d'environnement Travis CI, et de sorte qu'elle ne soit affichée nulle part. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une autre chose à laquelle vous devez faire attention est que vous devrez peut-être exécuter l'intégralité du script de déploiement, présenté sur une seule ligne, par exemple, à l'aide de </font></font><code>doctl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Cela peut nécessiter un effort supplémentaire.</font></font><br>
<br>
<pre><code class="plaintext hljs">doctl compute ssh &lt;droplet&gt; --ssh-command "    &amp;&amp; "</code></pre><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TLS / SSL et équilibrage de charge</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir fait tout ce qui a été discuté ci-dessus, le dernier problème qui s'est posé devant moi était que le serveur n'avait pas SSL. Depuis que </font><font style="vertical-align: inherit;">j'utilise le serveur Node.js, afin de rendre l' </font><font style="vertical-align: inherit;">Nginx et Chiffrer proxys inverses Let </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">travail</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , je dois bricoler beaucoup.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je n'avais vraiment pas envie de faire tous ces paramètres SSL manuellement, alors je viens de créer un équilibreur de charge et d'enregistrer des informations à ce sujet dans DNS. Dans le cas de DigitalOcean, par exemple, la création d'un certificat auto-renouvelé auto-renouvelé sur un équilibreur de charge est une procédure simple, gratuite et rapide. Cette approche présente un avantage supplémentaire qui, si nécessaire, facilite la configuration de SSL sur une variété de serveurs exécutant un équilibreur de charge. Cela permet aux serveurs eux-mêmes de ne pas «penser» du tout à SSL, mais d'utiliser le port comme d'habitude </font></font><code>80</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. La configuration de SSL sur un équilibreur de charge est donc beaucoup plus simple et plus pratique que les autres méthodes de configuration SSL.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez maintenant fermer sur le serveur tous les ports qui acceptent les connexions entrantes - à l'exception du port </font></font><code>80</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilisé pour la communication avec l'équilibreur de charge et du port </font></font><code>22</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour SSH. </font><font style="vertical-align: inherit;">Par conséquent, une tentative d'accès direct au serveur sur n'importe quel port, à l'exception de ces deux, échouera.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sommaire</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir fait tout ce qui était décrit dans ce document, je n'avais plus peur ni de la plateforme Docker ni du concept de chaînes CI / CD automatisées. J'ai pu mettre en place une chaîne d'intégration continue au cours de laquelle le code est testé avant sa mise en production et le code est automatiquement déployé sur le serveur. Tout cela pour moi est encore relativement nouveau, et je suis sûr qu'il existe des moyens d'améliorer mon flux de travail automatisé et de le rendre plus efficace. Par conséquent, si vous avez des idées à ce sujet, faites-le </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">moi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> savoir. J'espère que cet article vous a aidé dans vos affaires. Je veux croire qu'après l'avoir lu, vous avez appris autant que moi, alors que j'ai compris tout ce que j'en ai dit. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Il </font><font style="vertical-align: inherit;">y a une image </font><font style="vertical-align: inherit;">sur notre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">marché</font></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui s'installe en un clic. </font><font style="vertical-align: inherit;">Vous pouvez vérifier le fonctionnement des conteneurs sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Tous les nouveaux clients bénéficient de 3 jours gratuits pour les tests. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chers lecteurs! </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilisez-vous les technologies CI / CD dans vos projets?</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr488658/index.html">Utiliser faiss pour rechercher des espaces multidimensionnels</a></li>
<li><a href="../fr488660/index.html">Est-il temps d'oublier React et de passer à Svelte?</a></li>
<li><a href="../fr488662/index.html">Extensions de navigateur requises par chaque développeur Web</a></li>
<li><a href="../fr488664/index.html">Trouver la boîte à outils parfaite: analyse des modèles de projet Python populaires</a></li>
<li><a href="../fr488666/index.html">10 composants React pour toutes les occasions</a></li>
<li><a href="../fr488674/index.html">Infographie avec Excel et PowerPoint</a></li>
<li><a href="../fr488678/index.html">Big Appetites for Little Buffers sur Node.js</a></li>
<li><a href="../fr488682/index.html">Comment tester les compétences de programmation Python? Tâches de Yandex</a></li>
<li><a href="../fr488686/index.html">Utilisation des réseaux Flowmon pour surveiller les performances des applications et des bases de données distribuées</a></li>
<li><a href="../fr488690/index.html">Levenshtein reconnaissance de caractères à distance</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>