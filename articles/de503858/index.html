<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌶️ 🗜️ 😪 Das Buch "Terraform: Infrastruktur auf Codeebene" 🔫 💇🏼 📦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo habrozhiteli! Das Buch richtet sich an alle, die für den bereits geschriebenen Code verantwortlich sind. Dies gilt für Systemadministratoren, Be...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Das Buch "Terraform: Infrastruktur auf Codeebene"</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/503858/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/el/eg/lp/eleglpt_bkgjd7cftgp1yrmg_gk.jpeg" align="left" alt="Bild"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hallo habrozhiteli! Das Buch richtet sich an alle, die für den bereits geschriebenen Code verantwortlich sind. Dies gilt für Systemadministratoren, Betriebsspezialisten, Release-, SR-, DevOps-Ingenieure, Infrastrukturentwickler, Vollzyklusentwickler, Leiter von Entwicklungsteams und technische Direktoren. Unabhängig von Ihrer Position ist dieses Buch genau das Richtige für Sie, wenn Sie an der Infrastruktur beteiligt sind, Code bereitstellen, Server konfigurieren, Cluster skalieren, Daten sichern, Anwendungen überwachen und Anrufe um drei Uhr morgens beantworten.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zusammen werden diese Verantwortlichkeiten üblicherweise als operative Aktivitäten (oder Systemadministration) bezeichnet. </font><font style="vertical-align: inherit;">Zuvor wurden Entwickler, die wissen, wie man Code schreibt, aber die Systemadministration nicht verstanden, häufig getroffen. </font><font style="vertical-align: inherit;">Systemadministratoren stießen häufig auf die Fähigkeit, Code zu schreiben. </font><font style="vertical-align: inherit;">Sobald diese Trennung akzeptabel war, aber in der modernen Welt, die ohne Cloud Computing und die DevOps-Bewegung nicht mehr vorstellbar ist, benötigt fast jeder Entwickler administrative Fähigkeiten, und jeder Systemadministrator muss programmieren können.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie lernen nicht nur, wie Sie die Infrastruktur in Form von Code mit Terraform verwalten, sondern auch, wie sie in das Gesamtkonzept von DevOps passt. </font><font style="vertical-align: inherit;">Hier sind einige Fragen, die Sie durch Lesen dieses Buches beantworten können.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warum überhaupt IaC verwenden?</font></font></li>
<li>    , ,     ?</li>
<li>   Terraform, Chef, Ansible, Puppet, Salt, CloudFormation, Docker, Packer  Kubernetes?</li>
<li>   Terraform       ?</li>
<li>   Terraform,    ?</li>
<li>    Terraform,       ?</li>
<li>     Terraform?</li>
<li>  Terraform     ?</li>
<li>    Terraform   ?</li>
</ul><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">    </b>
                        <div class="spoiler_text">    2017 .   2019-         ,      !                 .  ,        .<br>
<br>
        ,  ,     ,    Terraform,    .<br>
<br>
<ul>
<li>   Terraform.    ,   Terraform  0.8.     Terraform   0.12.       ,     .  ,   !</li>
<li>   .           Terraform.    , ,    ,  ,    ,  ,  ,    .</li>
<li>  .      Terraform   .  , ,               — ,      .</li>
<li>   .  8      ,      Terraform    . ,  ,      ,          : ,      .</li>
<li>HCL2.  Terraform 0.12   HCL   HCL2.        (       ${…}!),   ,     ,   null, for_each  for,    .          HCL2,         5  6.</li>
<li>   .  Terraform 0.9    .        Terraform    .  Terraform 0.9     ,       ;     0.10      .       3.</li>
<li>    Terraform.  Terraform 0.10         (    AWS, GCP, Azure  . .).         ,         .          terraform init  ,       .       2  7.</li>
<li>   .  2016   Terraform        (AWS, GCP  Azure).      100,  ,  ,   1.               (,     Alicloud, Oracle Cloud Infrastructure, VMware vSphere  .),       ,     (GitHub, GitLab  BitBucket),   (MySQL, PostreSQL  InfluxDB),     ( DataDog, New Relic  Grafana),   Kubernetes, Helm, Heroku, Rundeck  Rightscale   .  ,       : ,   AWS     ,        ,   CloudFormation!</li>
<li>  Terraform.  2017   HashiCorp    Terraform (registry.terraform.io) —  ,         Terraform,  .  2018          .  Terraform 0.11        .       « »  . 153.</li>
<li>  .  Terraform 0.9    :         ,    ,   errored.tfstate.  Terraform 0.12    .    ,            ,     .</li>
<li>   .      ,     (.  «  »  . 144),  « »         (,  «  Terraform»  . 242),  plan    apply (.  «  »  . 64),     create_before_destroy,    count,           (.  «»  . 160),    ,   provider   .</li>
</ul></div>
                    </div><br>
<h3>.    Terraform</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(Die Probleme des automatischen Testens werden später in diesem Buch viel mehr beachtet.) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die DevOps-Welt ist voller unterschiedlicher Ängste: Jeder hat Angst, Dinge funktionieren zu lassen, Daten zu verlieren oder gehackt zu werden. Wenn Sie Änderungen vornehmen, fragen Sie sich immer, welche Konsequenzen dies haben wird. Wird es sich in allen Umgebungen gleich verhalten? Wird es einen weiteren Ausfall verursachen? Und wenn dies passiert, wie viel müssen Sie diesmal bei der Arbeit bleiben, um das Problem zu beheben? Mit dem Wachstum des Unternehmens steht mehr auf dem Spiel, was den Bereitstellungsprozess noch verschlimmert und das Fehlerrisiko erhöht. Viele Unternehmen versuchen, dieses Risiko durch weniger häufige Bereitstellungen zu minimieren. Infolgedessen wird jede einzelne Bereitstellung größer und fehleranfälliger.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie Ihre Infrastruktur in Form von Code verwalten, können Sie Risiken besser minimieren: Tests. </font><font style="vertical-align: inherit;">Ihr Ziel ist es, Ihnen genügend Vertrauen zu geben, um Änderungen vorzunehmen. </font><font style="vertical-align: inherit;">Das Schlüsselwort hier ist Vertrauen: Keine Tests können keine Fehler garantieren, sodass Sie eher mit der Wahrscheinlichkeit umgehen. </font><font style="vertical-align: inherit;">Wenn Sie alle Ihre Infrastruktur- und Bereitstellungsprozesse als Code erfassen können, können Sie diesen Code in einer Testumgebung testen. </font><font style="vertical-align: inherit;">Bei Erfolg besteht eine große Chance, dass derselbe Code in einer industriellen Umgebung funktioniert. </font><font style="vertical-align: inherit;">In einer Welt der Angst und Unsicherheit sind hohe Wahrscheinlichkeit und Vertrauen teuer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Kapitel werden wir den Prozess des Testens von Infrastrukturcode sowohl manuell als auch automatisch durchlaufen, wobei letzterer im Vordergrund steht. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Manuelle Tests:</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grundlagen des manuellen Testens;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reinigungsressourcen nach Tests.</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Automatisierte Tests:</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unit-Tests;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Integrationstests;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">End-to-End-Tests;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">andere Testansätze.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Manuelle Tests</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie darüber nachdenken, wie Sie Terraform-Code testen, ist es hilfreich, einige Parallelen zum Testen von Code zu ziehen, der in universellen Programmiersprachen wie Ruby geschrieben wurde. </font><font style="vertical-align: inherit;">Stellen Sie sich vor, Sie schreiben einen einfachen Ruby-Webserver in die Datei web-server.rb:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebServer</span> &lt; <span class="hljs-title">WEBrick</span>::<span class="hljs-title">HTTPServlet</span>::<span class="hljs-title">AbstractServlet</span>
  <span class="hljs-title">def</span> <span class="hljs-title">do_GET</span>(<span class="hljs-title">request</span>, <span class="hljs-title">response</span>)
     <span class="hljs-title">case</span> <span class="hljs-title">request</span>.<span class="hljs-title">path</span>
     <span class="hljs-title">when</span> "/"
         <span class="hljs-title">response</span>.<span class="hljs-title">status</span> </span>= <span class="hljs-number">200</span>
         response[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-string">'text/plain'</span>
         response.body = <span class="hljs-string">'Hello, World'</span>
     <span class="hljs-keyword">else</span>
         response.status = <span class="hljs-number">404</span>
         response[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-string">'text/plain'</span>
         response.body = <span class="hljs-string">'Not Found'</span><font></font>
     end<font></font>
  end<font></font>
end</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Code gibt eine 200-OK-Antwort mit dem Text Hello, World für die URL / zurück. </font><font style="vertical-align: inherit;">Für jede andere Adresse lautet die Antwort 404. Wie würden Sie diesen Code manuell testen? </font><font style="vertical-align: inherit;">In der Regel wird etwas mehr Code hinzugefügt, um den Webserver lokal auszuführen:</font></font><br>
<br>
<pre><code class="java hljs">#   ,      <font></font>
#  ,       <font></font>
<span class="hljs-keyword">if</span> __FILE__ == $<span class="hljs-number">0</span>
  #      <span class="hljs-number">8000</span>
  server = WEBrick::HTTPServer.new :Port =&gt; <span class="hljs-number">8000</span>
  server.mount <span class="hljs-string">'/'</span>, WebServer<font></font>
<font></font>
  #    Ctrl+C<font></font>
  trap <span class="hljs-string">'INT'</span> <span class="hljs-keyword">do</span> server.shutdown end<font></font>
<font></font>
  #  <font></font>
  server.start<font></font>
end</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie diese Datei im Terminal ausführen, wird der Webserver auf Port 8000 geladen:</font></font><br>
<br>
<pre><code class="java hljs">$ ruby web-server.rb<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick <span class="hljs-number">1.3</span><span class="hljs-number">.1</span>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO ruby <span class="hljs-number">2.3</span><span class="hljs-number">.7</span> (<span class="hljs-number">2018</span>-<span class="hljs-number">03</span>-<span class="hljs-number">28</span>) [universal.x86_64-darwin17]<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick::HTTPServer#start: pid=<span class="hljs-number">19767</span> port=<span class="hljs-number">8000</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um den Betrieb dieses Servers zu überprüfen, können Sie den Browser oder Curl verwenden:</font></font><br>
<br>
<pre><code class="java hljs">$ curl localhost:<span class="hljs-number">8000</span>/<font></font>
Hello, World<font></font>
<font></font>
$ curl localhost:<span class="hljs-number">8000</span>/invalid-path<font></font>
Not Found</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Stellen Sie sich nun vor, wir hätten diesen Code geändert, indem wir einen / api-Einstiegspunkt hinzugefügt haben, der 201 Created und einen Body im JSON-Format zurückgibt:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebServer</span> &lt; <span class="hljs-title">WEBrick</span>::<span class="hljs-title">HTTPServlet</span>::<span class="hljs-title">AbstractServlet</span>
  <span class="hljs-title">def</span> <span class="hljs-title">do_GET</span>(<span class="hljs-title">request</span>, <span class="hljs-title">response</span>)
     <span class="hljs-title">case</span> <span class="hljs-title">request</span>.<span class="hljs-title">path</span>
     <span class="hljs-title">when</span> "/"
         <span class="hljs-title">response</span>.<span class="hljs-title">status</span> </span>= <span class="hljs-number">200</span>
         response[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-string">'text/plain'</span>
         response.body = <span class="hljs-string">'Hello, World'</span>
     when <span class="hljs-string">"/api"</span>
         response.status = <span class="hljs-number">201</span>
         response[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-string">'application/json'</span>
         response.body = <span class="hljs-string">'{"foo":"bar"}'</span>
     <span class="hljs-keyword">else</span>
         response.status = <span class="hljs-number">404</span>
         response[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-string">'text/plain'</span>
         response.body = <span class="hljs-string">'Not Found'</span><font></font>
     end<font></font>
  end<font></font>
end</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um diesen aktualisierten Code manuell zu testen, drücken Sie Strg + C und starten Sie den Webserver neu, indem Sie das Skript erneut ausführen:</font></font><br>
<br>
<pre><code class="java hljs">$ ruby web-server.rb<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick <span class="hljs-number">1.3</span><span class="hljs-number">.1</span>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO ruby <span class="hljs-number">2.3</span><span class="hljs-number">.7</span> (<span class="hljs-number">2018</span>-<span class="hljs-number">03</span>-<span class="hljs-number">28</span>) [universal.x86_64-darwin17]<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick::HTTPServer#start: pid=<span class="hljs-number">19767</span> port=<span class="hljs-number">8000</span><font></font>
^C<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">15</span>:<span class="hljs-number">54</span>] INFO going to shutdown ...<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">15</span>:<span class="hljs-number">54</span>] INFO WEBrick::HTTPServer#start done.<font></font>
<font></font>
$ ruby web-server.rb<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick <span class="hljs-number">1.3</span><span class="hljs-number">.1</span>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO ruby <span class="hljs-number">2.3</span><span class="hljs-number">.7</span> (<span class="hljs-number">2018</span>-<span class="hljs-number">03</span>-<span class="hljs-number">28</span>) [universal.x86_64-darwin17]<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick::HTTPServer#start: pid=<span class="hljs-number">19767</span> port=<span class="hljs-number">8000</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die neue Version zu überprüfen, können Sie erneut den Befehl curl verwenden:</font></font><br>
<br>
<pre><code class="java hljs">$ curl localhost:<span class="hljs-number">8000</span>/api<font></font>
{<span class="hljs-string">"foo"</span>:<span class="hljs-string">"bar"</span>}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grundlagen des manuellen Testens</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie sieht diese Art des manuellen Testens in Terraform aus? </font><font style="vertical-align: inherit;">In den vorherigen Kapiteln steht beispielsweise noch der Code für die Bereitstellung von ALB zur Verfügung. </font><font style="vertical-align: inherit;">Hier ist ein Ausschnitt aus der Datei modules / network / alb / main.tf:</font></font><br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_lb"</span> <span class="hljs-string">"example"</span> {<font></font>
   name                     = <span class="hljs-keyword">var</span>.alb_name<font></font>
   load_balancer_type = <span class="hljs-string">"application"</span>
   subnets                  = <span class="hljs-keyword">var</span>.subnet_ids<font></font>
   security_groups      = [aws_security_group.alb.id]<font></font>
}<font></font>
<font></font>
resource <span class="hljs-string">"aws_lb_listener"</span> <span class="hljs-string">"http"</span> {<font></font>
   load_balancer_arn = aws_lb.example.arn<font></font>
   port                      = local.http_port<font></font>
   protocol                = <span class="hljs-string">"HTTP"</span><font></font>
<font></font>
   #      <span class="hljs-number">404</span><font></font>
   default_action {<font></font>
      type = <span class="hljs-string">"fixed-response"</span><font></font>
<font></font>
      fixed_response {<font></font>
        content_type = <span class="hljs-string">"text/plain"</span>
        message_body = <span class="hljs-string">"404: page not found"</span>
        status_code = <span class="hljs-number">404</span><font></font>
      }<font></font>
    }<font></font>
}<font></font>
<font></font>
resource <span class="hljs-string">"aws_security_group"</span> <span class="hljs-string">"alb"</span> {<font></font>
   name = <span class="hljs-keyword">var</span>.alb_name<font></font>
}<font></font>
<font></font>
# (...)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie diese Liste mit Ruby-Code vergleichen, sehen Sie einen ziemlich offensichtlichen Unterschied: AWS ALB, Zielgruppen, Listener, Sicherheitsgruppen und andere Ressourcen können nicht auf Ihrem eigenen Computer bereitgestellt werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die wichtigste Schlussfolgerung zum Testen Nr. 1 folgt daraus: Terraform-Code-Tests können nicht lokal durchgeführt werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies gilt nicht nur für Terraform, sondern auch für die meisten IaC-Tools. Die einzige praktische Möglichkeit, manuelle Tests in Terraform durchzuführen, besteht darin, den Code in einer realen Umgebung (d. H. In AWS) bereitzustellen. Mit anderen Worten, das unabhängige Starten der Terraform Apply- und Terraform Destroy-Befehle, an denen Sie beim Lesen des Buches gearbeitet haben, ist ein manuelles Testen in Terraform.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist einer der Gründe, warum es so wichtig ist, einfach zu implementierende Beispiele im Beispielordner jedes Moduls zu haben (siehe Kapitel 6). </font><font style="vertical-align: inherit;">Um das Alb-Modul zu testen, verwenden Sie am einfachsten den Demo-Code, den Sie in examples / alb erstellt haben:</font></font><br>
<br>
<pre><code class="java hljs">provider <span class="hljs-string">"aws"</span> {<font></font>
   region = <span class="hljs-string">"us-east-2"</span><font></font>
<font></font>
   #     AWS  <span class="hljs-number">2</span>.x<font></font>
   version = <span class="hljs-string">"~&gt; 2.0"</span><font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">module</span> <span class="hljs-string">"alb"</span> {<font></font>
    source = <span class="hljs-string">"../../modules/networking/alb"</span><font></font>
<font></font>
    alb_name = <span class="hljs-string">"terraform-up-and-running"</span>
    subnet_ids = data.aws_subnet_ids.<span class="hljs-keyword">default</span>.ids<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um dieses Beispiel bereitzustellen, müssen Sie den Befehl terraform apply ausführen, wie Sie es wiederholt getan haben:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function">$ terraform <span class="hljs-title">apply</span>

<span class="hljs-params">(...)</span>

Apply complete! Resources: 5 added, 0 changed, 0 destroyed.

Outputs:

alb_dns_name </span>= hello-world-stage-<span class="hljs-number">477699288</span>.us-east-<span class="hljs-number">2</span>.elb.amazonaws.com</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Am Ende der Bereitstellung können Sie ein Tool wie Curl verwenden, um beispielsweise sicherzustellen, dass ALB standardmäßig 404 zurückgibt:</font></font><br>
<br>
<pre><code class="java hljs">$ curl \<font></font>
   -s \<font></font>
   -o /dev/<span class="hljs-keyword">null</span> \<font></font>
   -w <span class="hljs-string">"%{http_code}"</span> \<font></font>
hello-world-stage-<span class="hljs-number">477699288</span>.us-east-<span class="hljs-number">2</span>.elb.amazonaws.com<font></font>
<font></font>
<span class="hljs-number">404</span></code></pre><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Infrastrukturprüfung</font></font><br>
<br>
      ,   HTTP, ,     ,   curl  HTTP-.        . ,        MySQL,       MySQL.      VPN-,      VPN.      ,      ,       SSH    - .    .   ,    ,      .       ,    .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich möchte Sie daran erinnern: ALB gibt 404 zurück, da in der Konfiguration keine anderen Listener-Regeln vorhanden sind, und die Standardaktion im alb-Modul hat die Antwort 404:</font></font><br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_lb_listener"</span> <span class="hljs-string">"http"</span> {<font></font>
   load_balancer_arn = aws_lb.example.arn<font></font>
   port                      = local.http_port<font></font>
   protocol                = <span class="hljs-string">"HTTP"</span><font></font>
<font></font>
   #      <span class="hljs-number">404</span><font></font>
   default_action {<font></font>
      type = <span class="hljs-string">"fixed-response"</span><font></font>
<font></font>
      fixed_response {<font></font>
       content_type = <span class="hljs-string">"text/plain"</span>
       message_body = <span class="hljs-string">"404: page not found"</span>
       status_code = <span class="hljs-number">404</span><font></font>
      }<font></font>
   }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie wissen also bereits, wie Sie Ihren Code ausführen und testen. </font><font style="vertical-align: inherit;">Jetzt können Sie Änderungen vornehmen. </font><font style="vertical-align: inherit;">Jedes Mal, wenn Sie etwas ändern (so dass beispielsweise die Standardaktion 401 zurückgibt), müssen Sie den Befehl terraform apply verwenden, um den neuen Code bereitzustellen:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function">$ terraform <span class="hljs-title">apply</span>

<span class="hljs-params">(...)</span>

Apply complete! Resources: 0 added, 1 changed, 0 destroyed.

Outputs:

alb_dns_name </span>= hello-world-stage-<span class="hljs-number">477699288</span>.us-east-<span class="hljs-number">2</span>.elb.amazonaws.com</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die neue Version zu überprüfen, können Sie curl neu starten:</font></font><br>
<br>
<pre><code class="java hljs">$ curl \<font></font>
   -s \<font></font>
   -o /dev/<span class="hljs-keyword">null</span> \<font></font>
   -w <span class="hljs-string">"%{http_code}"</span> \<font></font>
   hello-world-stage-<span class="hljs-number">477699288</span>.us-east-<span class="hljs-number">2</span>.elb.amazonaws.com
<span class="hljs-number">401</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie fertig sind, führen Sie den Befehl terraform destroy aus, um die Ressourcen zu entfernen:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function">$ terraform <span class="hljs-title">destroy</span>

<span class="hljs-params">(...)</span>

Apply complete! Resources: 0 added, 0 changed, 5 destroyed.</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit anderen Worten, wenn Sie mit Terraform arbeiten, benötigt jeder Entwickler gute Codebeispiele zum Testen und eine reale Entwicklungsumgebung (wie ein AWS-Konto), die als Äquivalent zu einem lokalen Computer dient und zum Ausführen von Tests verwendet wird. Beim manuellen Test müssen Sie höchstwahrscheinlich eine große Anzahl von Infrastrukturkomponenten erstellen und entfernen. Dies kann zu vielen Fehlern führen. In dieser Hinsicht sollte die Umgebung vollständig von stabileren Umgebungen isoliert sein, die für Endtests und insbesondere für industrielle Anwendungen vorgesehen sind.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vor diesem Hintergrund empfehle ich jedem Entwicklungsteam dringend, eine isolierte Umgebung vorzubereiten, in der Sie jede Infrastruktur ohne Konsequenzen erstellen und entfernen können. </font><font style="vertical-align: inherit;">Um die Wahrscheinlichkeit von Konflikten zwischen verschiedenen Entwicklern zu minimieren (stellen Sie sich vor, zwei Entwickler versuchen, einen Load Balancer mit demselben Namen zu erstellen), wäre die ideale Lösung, jedem Teammitglied eine separate, vollständig isolierte Umgebung zu geben. </font><font style="vertical-align: inherit;">Wenn Sie beispielsweise Terraform in Verbindung mit AWS verwenden, sollte jeder Entwickler idealerweise über ein eigenes Konto verfügen, in dem er alles testen kann, was er möchte.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ressourcenbereinigung nach Tests</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Vorhandensein vieler isolierter Umgebungen ist für die hohe Produktivität von Entwicklern erforderlich. Wenn Sie jedoch keine Vorsicht walten lassen, können Sie viele zusätzliche Ressourcen ansammeln, die alle Ihre Umgebungen überladen und Sie eine runde Summe kosten. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Reinigen Sie Ihre isolierten Umgebungen regelmäßig, um die Kosten unter Kontrolle zu halten. Dies ist die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wichtigste Schlussfolgerung zum Testen von Nummer 2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie sollten mindestens eine solche Kultur im Team erstellen, wenn die Entwickler nach dem Testen alles löschen, was sie mit dem Befehl terraform destroy bereitgestellt haben. Es kann möglich sein, Werkzeuge zum Aufräumen überschüssiger oder alter Ressourcen zu finden, die regelmäßig ausgeführt werden können (z. B. mit cron). Hier einige Beispiele für verschiedene Bereitstellungsumgebungen.</font></font><br>
<br>
<ul>
<li>cloud-nuke (http://bit.ly/2OIgM9r).      ,         .        AWS ( Amazon EC2 Instances, ASG, ELB  . .).      (Google Cloud, Azure)   .    —    ,    . , cloud-nuke      cron,           .   ,   ,      ,      :<br>
<br>
<pre><code class="java hljs">$ cloud-nuke aws --older-than <span class="hljs-number">48</span>h</code></pre></li>
<li>Janitor Monkey (http://bit.ly/2M4GoLB).      ,   AWS  ,    (  —   ).    ,  ,    ,            .    Netflix Simian Army,      Chaos Monkey    .   ,    Simian Army    ,       : ,   Janitor Monkey   Swabbie (http://bit.ly/2OLrOLb).</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aws-nuke (http://bit.ly/2ZB8lOe). </font><font style="vertical-align: inherit;">Dies ist ein Open Source-Tool zum Löschen aller Inhalte eines AWS-Kontos. </font><font style="vertical-align: inherit;">Die zu löschenden Konten und Ressourcen werden in der Konfigurationsdatei im YAML-Format angegeben:</font></font><br>
<br>
<pre><code class="java hljs">#   <font></font>
regions:<font></font>
- us-east-<span class="hljs-number">2</span><font></font>
<font></font>
#    <font></font>
accounts:<font></font>
   <span class="hljs-string">"111111111111"</span>: {}<font></font>
<font></font>
#    <font></font>
resource-types:<font></font>
   targets:<font></font>
   - S3Object<font></font>
   - S3Bucket<font></font>
   - IAMRole</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aws-Nuke beginnt wie folgt:</font></font><br>
<br>
<pre><code class="java hljs">$ aws-nuke -<span class="hljs-number">5</span>c config.yml</code></pre></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Automatisierte Tests</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Konzept des automatischen Testens besteht darin, dass Tests geschrieben werden, um das Verhalten von echtem Code zu testen. </font><font style="vertical-align: inherit;">In Kapitel 8 erfahren Sie, dass diese Tests mithilfe des CI-Servers nach jedem einzelnen Commit ausgeführt werden können. </font><font style="vertical-align: inherit;">Wenn sie nicht abgeschlossen sind, kann die Fixierung sofort rückgängig gemacht oder korrigiert werden. </font><font style="vertical-align: inherit;">Somit ist Ihr Code immer betriebsbereit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt drei Arten von automatisierten Tests.</font></font><br>
<br>
<ul>
<li> .       — .    ,             .   (,  , -    )   mock-.       (, mock-     ,  )    ,        .</li>
<li> .      .          ,          .      mock-: ,     ,     ,      ,   , ,  ,  mock-.</li>
<li> .      (, ,  ,  )       .          : , Selenium        .         - mock-,          (        ,  ).</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jede Art von Test hat ihren eigenen Zweck. Mit ihrer Hilfe können Sie alle Arten von Fehlern identifizieren. Daher sollten sie zusammen verwendet werden. Unit-Tests sind schnell und ermöglichen es Ihnen, sich sofort ein Bild von den vorgenommenen Änderungen zu machen und eine Vielzahl von Kombinationen zu überprüfen. Dies gibt Ihnen die Gewissheit, dass sich die elementaren Komponenten Ihres Codes (einzelne Module) wie erwartet verhalten. Die Tatsache, dass die Module separat korrekt funktionieren, bedeutet jedoch keineswegs, dass sie zusammenarbeiten können. Um sicherzustellen, dass Ihre Elementarkomponenten kompatibel sind, sind Integrationstests erforderlich. Auf der anderen Seite garantiert das korrekte Verhalten verschiedener Teile des Systems nicht, dass dieses System nach der Bereitstellung in einer industriellen Umgebung ordnungsgemäß funktioniert. Daher sind Tests erforderlich, um Ihren Code unter Bedingungen zu testen, die den tatsächlichen Bedingungen nahe kommen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
»Weitere Informationen zum Buch finden Sie auf </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">der Website des Herausgebers.</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
» </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inhalt</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
» </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Auszug</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
für Khabrozhiteley 25% Gutscheinrabatt - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terraform</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nach Zahlung der Papierversion des Buches wird ein elektronisches Buch per E-Mail verschickt.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de503842/index.html">Gehirnprothese: Synchronisation künstlicher und biologischer neuronaler Netze</a></li>
<li><a href="../de503844/index.html">Beschleunigen Sie das Rendern von MatTables in wenigen Schritten</a></li>
<li><a href="../de503846/index.html">Flash: "Ob er wieder stirbt, ist unbekannt, aber die Blumen verschwinden ..."</a></li>
<li><a href="../de503848/index.html">Wir laden Sie zu kostenlosen Webinaren zum SLS-Druck auf Sinterit 26.05 und 3D-Scannern Shining 28.05 ein</a></li>
<li><a href="../de503854/index.html">Verwenden Sie SIL maximal</a></li>
<li><a href="../de503860/index.html">Einrichten der neuronalen Netzwerkumgebung Maske R-CNN</a></li>
<li><a href="../en486014/index.html">SLAC Tour: US Department of Energy National Accelerator Laboratory at Stanford</a></li>
<li><a href="../en486018/index.html">Session Survey Results</a></li>
<li><a href="../en486024/index.html">Really simple graphics in R for science and journalism</a></li>
<li><a href="../en486028/index.html">Neural networks in the production of dentures</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>