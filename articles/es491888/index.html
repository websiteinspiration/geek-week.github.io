<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎗️ 👩‍💼 👩🏽‍🤝‍👨🏼 GitLab CI: 6 características de los últimos lanzamientos que hemos estado esperando 👩‍🎨 👨🏿‍🤝‍👨🏽 🤜🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En la era del CI / CD omnipresente, nos enfrentamos a una amplia gama de herramientas relacionadas, incluidos los sistemas de CI. Sin embargo, fue Git...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>GitLab CI: 6 características de los últimos lanzamientos que hemos estado esperando</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/491888/"><img src="https://habrastorage.org/webt/gw/s2/_l/gws2_lpk_xse3zwysoxi7yhgedi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la era del CI / CD omnipresente, nos enfrentamos a una amplia gama de herramientas relacionadas, incluidos los sistemas de CI. Sin embargo, fue GitLab el que se convirtió en el más cercano para nosotros, verdaderamente "nativo". Ganó notable popularidad en la industria en general *. Los desarrolladores del producto no se quedaron atrás del creciente interés en su uso, deleitando regularmente a la comunidad de desarrolladores e ingenieros de DevOps con nuevas versiones. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/le/lp/fl/lelpfl_26qkmpjz5qf5cjq4bbd0.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mes del repositorio de GitLab y agregación de etiquetas</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GitLab es el caso cuando el desarrollo activo trae muchas características nuevas e interesantes. Si para los usuarios potenciales este es solo uno de los factores para elegir una herramienta, para los existentes, la situación es la siguiente: si no ha actualizado su instalación de GitLab en el último mes, entonces con una alta probabilidad de que haya perdido algo interesante. Incluyendo regularmente actualizaciones de seguridad emergentes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sobre lo más significativo, es decir exigido por nuestros ingenieros y clientes de DevOps: innovaciones en los últimos lanzamientos de la edición comunitaria de GitLab, y se discutirá este artículo.</font></font><a name="habracut"></a><br>
<br>
<i>*   5  ,  «GitLab»,   : «,   GitHub?».     — ,  Google Trends <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>  5-    «gitlab»   .     «»  ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>.     ,   ,     «»   .</i><br>
<br>
<h2>№1: needs</h2><br>
<ul>
<li>     job'.</li>
<li>    GitLab: 12.2.</li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pensamiento </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>dependencies</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: ¿esto es lo que necesitas? Probablemente, no fuimos los únicos que cometimos el error de asignar esta directiva ... Es necesario enumerar los trabajos anteriores, </font><font style="vertical-align: inherit;">cuyos </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">artefactos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> serán necesarios. Son artefactos, y no dependencia del desempeño de la tarea anterior. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suponga que sucedió que en una etapa hay trabajos que no es necesario realizar, pero por alguna razón no existe la posibilidad o solo el deseo de llevarlos a una etapa separada (la pereza es el motor del progreso, pero no se deje llevar). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Situación: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/_u/sa/k1/_usak1lrpdqpjtxln69r3ktc5ag.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
como puede ver, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stage Deploy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contiene botones para desplegar tanto la producción como la etapa, y las </font><i><font style="vertical-align: inherit;">pruebas de</font></i><font style="vertical-align: inherit;"> trabajo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selenium</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">por alguna razón no se ejecuta. </font><font style="vertical-align: inherit;">Es simple: espera hasta que todos los trabajos de la etapa anterior se completen con éxito. </font><font style="vertical-align: inherit;">Sin embargo, en el marco de la misma tubería, no necesitamos desplegar la etapa ahora para ejecutar las pruebas (se bombeó antes, no dentro de la etiqueta). </font><font style="vertical-align: inherit;">¿Qué hacer? </font><font style="vertical-align: inherit;">Entonces ven a las </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">necesidades de</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> rescate </font><font style="vertical-align: inherit;">! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enumeramos solo los trabajos previos necesarios para ejecutar nuestras pruebas:</font></font><br>
<br>
<pre><code class="plaintext hljs">  needs:<font></font>
    - To production (Cluster 1)<font></font>
    - To production (Cluster 2)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... y obtenemos un trabajo, que se llama automáticamente después de que solo se ejecuten los trabajos enumerados: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jm/9y/8z/jm9y8zesapj3neflq_xmn7er70i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Convenientemente, ¿verdad? </font><font style="vertical-align: inherit;">Pero una vez que esperaba que la directiva funcionara algo así </font></font><code>dependencies</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No. 2: se extiende</font></font></h2><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Anclajes y alias YAML mejorados.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Introducido desde GitLab 11.3.</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docs.gitlab.com/ce/ci/yaml/#extends</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¿Cansado de leer rollos </font></font><code>.gitlab-ci.yaml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? ¿Falta el principio de reutilización del código? Entonces ya lo has intentado y probablemente has llevado el tuyo </font></font><code>.gitlab-ci.yaml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a un estado como este:</font></font><br>
<br>
<pre><code class="plaintext hljs">.base_deploy: &amp;base_deploy<font></font>
  stage: deploy<font></font>
  script:<font></font>
    - my_deploy_command.sh<font></font>
  variables:<font></font>
    CLUSTER: "default-cluster"<font></font>
    MY_VAR: "10"<font></font>
<font></font>
Deploy Test:<font></font>
  &lt;&lt;: *base_deploy<font></font>
  environment:<font></font>
    url: test.example.com<font></font>
    name: test<font></font>
<font></font>
Deploy Production:<font></font>
  &lt;&lt;: *base_deploy<font></font>
  environment:<font></font>
    url: production.example.com<font></font>
    name: production<font></font>
  variables:<font></font>
    CLUSTER: "prod-cluster"<font></font>
    MY_VAR: "10"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¿Suena genial? Sin embargo, si miras de cerca, algo te llama la atención ... ¿Por qué cambiamos en la producción no solo </font></font><code>variables.CLUSTER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, sino también prescrita por segunda vez </font></font><code>variables.MY_VAR=10</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? ¿Debería tomarse esta variable </font></font><code>base_deploy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? Resulta que no debería: YAML funciona de modo que, al redefinir lo que se recibe del ancla, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no expande el</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contenido de los campos coincidentes, sino que lo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reemplaza</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Por lo tanto, nos vemos obligados a enumerar las variables que ya conocemos en el párrafo correspondiente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sí, "expande" es la palabra correcta: esto es exactamente como se llama la característica en cuestión. </font></font><code>Extends</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nos permiten no solo reescribir el campo, como sucede con el ancla, sino llevar a cabo una fusión inteligente:</font></font><br>
<br>
<pre><code class="plaintext hljs">.base_deploy: <font></font>
  stage: deploy<font></font>
  script:<font></font>
    - my_deploy_command.sh<font></font>
  variables:<font></font>
    CLUSTER: "default-cluster"<font></font>
    MY_VAR: "10"<font></font>
<font></font>
Deploy Production:<font></font>
  extends: .base_deploy<font></font>
  environment:<font></font>
    url: production.example.com<font></font>
    name: production<font></font>
  variables:<font></font>
    CLUSTER: "prod-cluster"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aquí, en el trabajo final </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementar producción</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , habrá una variable </font></font><code>MY_VAR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">con un valor predeterminado y una anulada </font></font><code>CLUSTER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parece que esto es un poco insignificante, pero imagina: tienes uno </font></font><code>base_deploy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y 20 circuitos desplegados de manera similar. </font><font style="vertical-align: inherit;">Deben transmitirse a otros </font></font><code>cluster</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, al </font></font><code>environment.name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tiempo que conservan un cierto conjunto de variables u otros campos coincidentes ... Este pequeño placer nos permitió reducir la descripción del despliegue de muchos circuitos de desarrollo en 2-3 veces.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No. 3: incluir</font></font></h2><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dividimos YAML enorme en varios y reutilizamos en otros proyectos.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Introducido en Core desde la versión 11.4.</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docs.gitlab.com/ce/ci/yaml/#include</font></font></a></li>
</ul><br>
<code>.gitlab-ci.yaml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">todavía parece </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">una instrucción de plegado para una aspiradora en 20 idiomas (de los cuales solo entiende el nativo), ¿es</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> difícil cuando necesita lidiar con una de sus secciones sin cambiar frente a los trabajos desconocidos que se encuentran en el camino? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un amigo de programación desde hace mucho tiempo ayudará a </font></font><code>include</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">stages:<font></font>
  - test<font></font>
  - build<font></font>
  - deploy<font></font>
<font></font>
variables:<font></font>
  VAR_FOR_ALL: 42<font></font>
<font></font>
include:<font></font>
  - local: .gitlab/ci/test.yml<font></font>
  - local: .gitlab/ci/build.yml<font></font>
  - local: .gitlab/ci/deploy-base.yml<font></font>
  - local: .gitlab/ci/deploy-production.yml</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aquellos. </font><font style="vertical-align: inherit;">Ahora estamos editando audazmente la implementación en producción, mientras que los probadores están ocupados modificando su archivo, lo que ni siquiera podemos mirar. </font><font style="vertical-align: inherit;">Además, esto ayuda a evitar conflictos de fusión: no siempre es divertido entender el código de otra persona. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero, ¿qué sucede si conocemos el flujo de nuestros 20 proyectos a lo largo y ancho, podemos explicar la lógica de cada trabajo a partir de él? </font><font style="vertical-align: inherit;">¿Cómo nos ayudará esto? </font><font style="vertical-align: inherit;">Para aquellos que han logrado la iluminación en la reutilización de código y para todos los que tienen muchos proyectos similares, puede:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usando </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">include: file: incluye archivos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GitLab CI de otro repositorio de la misma instancia de GitLab,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">con </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">include: template</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : colecciones de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plantillas de GitLab listas para usar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">con </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">include: remote</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : un archivo externo (accesible a través de HTTPS).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una docena del mismo tipo de proyectos con código diferente, pero implementados de la misma manera, ¡fácilmente y sin mantener un CI actualizado en todos los repositorios! </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">También se dio un ejemplo de uso práctico </font></font><code>include</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">este artículo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No. 4: solo / excepto referencias</font></font></h2><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Condiciones integrales, incluidas variables y cambios de archivos.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dado que esta es una familia completa de funciones, algunas partes comenzaron a aparecer en GitLab 10.0, mientras que otras (por ejemplo </font></font><code>changes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">comenzaron a aparecer en </font><font style="vertical-align: inherit;">11.4.</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docs.gitlab.com/ce/ci/yaml/#onlyexcept-advanced</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A veces me parece que esto no es una tubería que nos escucha, sino nosotros. </font><font style="vertical-align: inherit;">Una excelente herramienta de gestión está </font></font><code>only</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ </font></font><code>except</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- ahora integrada. </font><font style="vertical-align: inherit;">¿Qué significa esto? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el caso más simple (y quizás el más agradable), saltear etapas:</font></font><br>
<br>
<pre><code class="plaintext hljs">Tests:<font></font>
  only:<font></font>
    - master<font></font>
  except:<font></font>
    refs:<font></font>
    - schedules<font></font>
    - triggers<font></font>
    variables:<font></font>
    - $CI_COMMIT_MESSAGE =~ /skip tests/</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el trabajo de ejemplo, solo se ejecuta en la rama maestra, pero no puede activarse mediante una programación o un activador (GitLab comparte llamadas y activadores de API, aunque esta es esencialmente la misma API). </font><font style="vertical-align: inherit;">El trabajo no se ejecutará si hay una frase de contraseña de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prueba de omisión</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en el mensaje de confirmación </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Por ejemplo, </font></font><code>README.md</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se </font><font style="vertical-align: inherit;">ha corregido un error tipográfico en el </font><font style="vertical-align: inherit;">proyecto o la documentación: ¿por qué esperar los resultados de la prueba? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"¡Oye, 2020 está afuera!" </font><font style="vertical-align: inherit;">¿Por qué debería cada vez explicarle a la caja de hierro que no es necesario ejecutar pruebas al cambiar la documentación? </font><font style="vertical-align: inherit;">Y realmente: </font></font><code>only:changes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le permite ejecutar pruebas al cambiar archivos solo en ciertos directorios. </font><font style="vertical-align: inherit;">Por ejemplo:</font></font><br>
<br>
<pre><code class="plaintext hljs">  only:<font></font>
    refs:<font></font>
      - master<font></font>
      - merge_requests<font></font>
    changes:<font></font>
      - "front/**/*"<font></font>
      - "jest.config.js"<font></font>
      - "package.json"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y para la acción inversa, es decir </font><font style="vertical-align: inherit;">No corras, sí </font></font><code>except:changes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No. 5: reglas</font></font></h2><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Reglas de trabajo individuales.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Introducido en GitLab 12.3.</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docs.gitlab.com/ce/ci/yaml/#rules</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta directiva es muy similar a las anteriores </font></font><code>only:*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, pero con una diferencia importante: le permite controlar el parámetro </font></font><code>when</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Por ejemplo, si no desea eliminar por completo la posibilidad de comenzar un trabajo. </font><font style="vertical-align: inherit;">Simplemente puede dejar el botón, que, si lo desea, se llamará de forma independiente, sin iniciar una nueva tubería o sin realizar una confirmación.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 6: entorno: auto_stop_in</font></font></h2><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Detener ambientes en ausencia de actividad.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Introducido en GitLab 12.8.</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docs.gitlab.com/ce/ci/yaml/#environmentauto_stop_in</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aprendimos sobre esta oportunidad justo antes de la publicación del artículo y aún no hemos tenido tiempo suficiente para probarla en la práctica, pero esto es definitivamente "lo mismo" que se esperaba en varios proyectos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede especificar un parámetro en entornos GitLab </font></font><code>on_stop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; es muy útil cuando desea crear y eliminar entornos dinámicamente, por ejemplo, para cada rama. El trabajo marcado con k </font></font><code>on_stop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se ejecuta, por ejemplo, cuando la fusión de MR está en la rama maestra o cuando se cierra MR (o incluso haciendo clic en el botón), por lo que el entorno innecesario se elimina automáticamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo es conveniente, lógico, funciona ... si no fuera por el factor humano. Muchos desarrolladores fusionan MR no haciendo clic en un botón en GitLab, sino localmente a través de </font></font><code>git merge</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Puedes entenderlos: ¡es conveniente! Pero en este caso, la lógica</font></font><code>on_stop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no funciona, hemos acumulado un entorno olvidado ... Aquí es donde los tan esperados son útiles </font></font><code>auto_stop_in</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bonificación: cabañas temporales cuando no hay suficientes oportunidades</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A pesar de todas estas (y muchas otras) funciones nuevas y demandadas de GitLab, desafortunadamente, a veces las condiciones para realizar un trabajo son simplemente imposibles de describir en el marco de las capacidades disponibles actualmente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GitLab no es perfecto, pero proporciona las herramientas básicas para construir una tubería de ensueño ... si está listo para ir más allá del modesto DSL al sumergirse en el mundo de las secuencias de comandos. </font><font style="vertical-align: inherit;">Aquí hay algunas soluciones de nuestra experiencia, que de ninguna manera pretenden ser ideológicamente correctas o recomendadas, sino que se presentan más para demostrar diferentes posibilidades con una falta de funcionalidad API incorporada.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solución n. ° 1: inicie dos trabajos con un botón</font></font></h3><br>
<pre><code class="plaintext hljs">script:<font></font>
  - &gt; <font></font>
    export CI_PROD_CL1_JOB_ID=`curl -s -H "PRIVATE-TOKEN: ${GITLAB_API_TOKEN}" \ <font></font>
      "https://gitlab.domain/api/v4/projects/${CI_PROJECT_ID}/pipelines/${CI_PIPELINE_ID}/jobs" | \<font></font>
      jq '[.[] | select(.name == "Deploy (Cluster 1)")][0] | .id'`<font></font>
  - &gt; <font></font>
    export CI_PROD_CL2_JOB_ID=`curl -s -H "PRIVATE-TOKEN: ${GITLAB_API_TOKEN}" \ <font></font>
      "https://gitlab.domain/api/v4/projects/${CI_PROJECT_ID}/pipelines/${CI_PIPELINE_ID}/jobs" | \<font></font>
      jq '[.[] | select(.name == "Deploy (Cluster 2)")][0] | .id'`<font></font>
  - &gt; <font></font>
    curl -s --request POST -H "PRIVATE-TOKEN: ${GITLAB_API_TOKEN}" \ <font></font>
      "https://gitlab.domain/api/v4/projects/${CI_PROJECT_ID}/jobs/$CI_PROD_CL1_JOB_ID/play"<font></font>
  - &gt; <font></font>
    curl -s --request POST -H "PRIVATE-TOKEN: ${GITLAB_API_TOKEN}" \ <font></font>
      "https://gitlab.domain/api/v4/projects/${CI_PROJECT_ID}/jobs/$CI_PROD_CL2_JOB_ID/play"<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¿Y por qué no, si realmente quieres?</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solución n. ° 2: transferencia modificada en archivos MR rb para rubocop dentro de la imagen</font></font></h3><br>
<pre><code class="plaintext hljs">Rubocop:<font></font>
  stage: test<font></font>
  allow_failure: false<font></font>
  script:<font></font>
    ...<font></font>
    - export VARFILE=$(mktemp)<font></font>
    - export MASTERCOMMIT=$(git merge-base origin/master HEAD)<font></font>
    - echo -ne 'CHANGED_FILES=' &gt; ${VARFILE}<font></font>
    - if [ $(git --no-pager diff --name-only ${MASTERCOMMIT} | grep '.rb$' | wc -w |awk '{print $1}') -gt 0 ]; then<font></font>
        git --no-pager diff --name-only ${MASTERCOMMIT} | grep '.rb$' |tr '\n' ' ' &gt;&gt; ${VARFILE} ;<font></font>
      fi<font></font>
    - if [ $(wc -w ${VARFILE} | awk '{print $1}') -gt 1 ]; then<font></font>
        werf --stages-storage :local run rails-dev --docker-options="--rm --user app --env-file=${VARFILE}" -- bash -c /scripts/rubocop.sh ;<font></font>
      fi<font></font>
    - rm ${VARFILE}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No hay imagen adentro </font></font><code>.git</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, así que tuve que salir para verificar solo los archivos modificados. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota: Esta no es una situación muy estándar y un intento desesperado de cumplir con muchas condiciones del problema, cuya descripción no está incluida en el alcance de este artículo.</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solución # 3: activador para iniciar trabajos desde otros repositorios cuando se implementa</font></font></h3><br>
<pre><code class="plaintext hljs">  before_script:<font></font>
    - |<font></font>
      echo '### Trigger review: infra'<font></font>
      curl -s -X POST \<font></font>
        -F "token=$REVIEW_TOKEN_INFRA" \<font></font>
        -F "ref=master" \<font></font>
        -F "variables[REVIEW_NS]=$CI_ENVIRONMENT_SLUG" \<font></font>
        -F "variables[ACTION]=auto_review_start" \<font></font>
        https://gitlab.example.com/api/v4/projects/${INFRA_PROJECT_ID}/trigger/pipeline</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parece que una cosa tan simple y necesaria (en el mundo de los microservicios) está implementando otro microservicio en un circuito recién creado como una dependencia. </font><font style="vertical-align: inherit;">Pero no es, por lo tanto, una llamada API y una característica ya familiar (descrita anteriormente) son necesarias:</font></font><br>
<br>
<pre><code class="plaintext hljs">  only:<font></font>
    refs:<font></font>
    - triggers<font></font>
    variables:<font></font>
    - $ACTION == "auto_review_start"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notas:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Job on trigger está diseñado para estar vinculado a pasar una variable a la API, de manera similar al ejemplo No. 1. </font><font style="vertical-align: inherit;">Es más lógico implementar esto en la API con el nombre del trabajo pasado.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sí, la función está en la versión comercial (EE) de GitLab, pero no la consideramos.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusión</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GitLab intenta mantenerse al día con las tendencias, implementando gradualmente características que son agradables y demandadas por la comunidad DevOps. </font><font style="vertical-align: inherit;">Son bastante fáciles de usar, y cuando las capacidades básicas no son suficientes, siempre se pueden ampliar con scripts. </font><font style="vertical-align: inherit;">Y si vemos que resulta no tan elegante y convenientemente como soporte ... queda esperar los nuevos lanzamientos de GitLab, o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ayudar al proyecto con nuestra contribución</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PD</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lea también en nuestro blog:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Montaje y despliegue del mismo tipo de microservicios con werf y GitLab CI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ";</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JUnit en GitLab CI con Kubernetes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ";</font></font></li>
<li> «<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">werf —    CI/CD  Kubernetes (   )</a>» <i>( ; 27  2019  DevOpsConf)</i>;</li>
<li> «<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">       GitLab CI</a>»;</li>
<li> «<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GitLab CI       production</a>».</li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es491876/index.html">MosQA # 2 - materiales de mitap y busca todas las banderas de la misión</a></li>
<li><a href="../es491880/index.html">5 etapas de inevitabilidad de la adopción de la certificación ISO / IEC 27001. Enfado</a></li>
<li><a href="../es491882/index.html">Automatice la entrada a SecureCRT usando scripts</a></li>
<li><a href="../es491884/index.html">Gestión integral del conocimiento en una empresa de TI.</a></li>
<li><a href="../es491886/index.html">KnowledgeConf 2020 Online: implementando la gestión del conocimiento paso a paso</a></li>
<li><a href="../es491890/index.html">Conducir anatomía: SSD</a></li>
<li><a href="../es491896/index.html">Cómo en Cyan mejoramos un producto a través de la investigación de la experiencia del usuario</a></li>
<li><a href="../es491900/index.html">Flexibilidad y automatización en el aprendizaje automático.</a></li>
<li><a href="../es491902/index.html">Escribir un editor WYSIWYG simple con ProseMirror</a></li>
<li><a href="../es491904/index.html">Cómo escribir código seguro de Python. Comidas Kushal Das</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>