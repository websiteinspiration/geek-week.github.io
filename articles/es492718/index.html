<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõÑ üë©üèø‚Äçüî¨ üõ¨ Seguridad a trav√©s de la restricci√≥n del usuario o c√≥mo crear una vulnerabilidad üë®‚Äçüë©‚Äçüëß‚Äçüëß üß† üñºÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En 2019, se descubri√≥ la vulnerabilidad de denegaci√≥n de servicio envenenada de cach√© CPDoS en la red CDN, lo que permite envenenar el cach√© HTTP del ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Seguridad a trav√©s de la restricci√≥n del usuario o c√≥mo crear una vulnerabilidad</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492718/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En 2019, se </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">descubri√≥ la</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vulnerabilidad </font><font style="vertical-align: inherit;">de denegaci√≥n de servicio envenenada de cach√© </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">CPDoS</font></a><font style="vertical-align: inherit;"> en la red CDN, lo que permite envenenar el cach√© HTTP del proveedor de CDN y causar una denegaci√≥n de servicio. </font><font style="vertical-align: inherit;">La vulnerabilidad a√∫n no ha generado mucha expectaci√≥n, ya que no se ha visto en ataques reales. </font><font style="vertical-align: inherit;">Pero quiero hablar sobre uno de los m√©todos de envenenamiento de cach√© por separado. </font><font style="vertical-align: inherit;">M√©todo HTTP Override.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/rb/7j/wy/rb7jwy3an79ykaffwer39l297eu.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si otras variantes de explotar la vulnerabilidad de una forma u otra se basan en errores o caracter√≠sticas de modificaci√≥n de solicitud por parte de un intermediario, entonces la variante de Anulaci√≥n de m√©todo se basa en la t√°ctica del mismo nombre, que no forma parte del est√°ndar HTTP, conlleva problemas adicionales, que surgieron y se propagaron por descuido relaci√≥n con la seguridad. </font><font style="vertical-align: inherit;">Aqu√≠ lo consideraremos.</font></font><br>
<a name="habracut"></a><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Corto sobre CPDoS si te lo perdiste</font></font></b><div class="spoiler_text"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"> </a> ,         URI  method   .<br>
<br>
      ,       ,       ,         ,      -   .       ‚Äî            -  -   -,      ,    -     ,      .           ,         .<br>
<br>
            ,    . ,  , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">   -</a>.      -   ,       ,      .<br>
<br>
</div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Limite al cliente, menos puede - menos se romper√°</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La necesidad de anular el m√©todo en la solicitud surgi√≥ debido al hecho de que algunos firewalls de aplicaciones web e implementaciones de clientes HTTP eran muy limitados y no permit√≠an la ejecuci√≥n de m√©todos distintos a GET y POST. El problema no es que se tratara de una restricci√≥n de implementaci√≥n, sino que era una restricci√≥n intencional de clientes HTTP por una pol√≠tica de seguridad. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Est√° claro que todo se llev√≥ a cabo con buenas intenciones para cortar el tr√°fico reducido, no est√°ndar para clientes HTTP comunes. Pero en pos de la seguridad, se cortaron todos los m√©todos, excepto GET y POST. Quiz√°s porque estos son los √∫nicos m√©todos que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> son </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">opcionales y necesarios</font></a><font style="vertical-align: inherit;"> para servidores de uso general.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No est√° claro por qu√© se requer√≠a introducir una restricci√≥n tan estricta. S√≠, los ataques con la introducci√≥n de varios caracteres para confundir al analizador son solo el pasatiempo de los protocolos de texto. Pero podr√≠a permitir un poco m√°s de m√©todos, por ejemplo, tome al menos los que se </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">describen en el est√°ndar en s√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o que est√°n </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://www.iana.org/assignments/http-methods/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">registrados en IANA</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . No val√≠a la pena eliminar por completo la verificaci√≥n del m√©todo, pero podr√≠a marcar varios de los m√©todos m√°s populares y excluir de ellos aquellos que cambian el protocolo de interacci√≥n y rompen el trabajo con las conexiones en el servidor proxy (CONNECT). Pero no, result√≥ una pol√≠tica de seguridad que introdujo </font><font style="vertical-align: inherit;">restricciones y prohibiciones </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">innecesarias</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para los clientes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y los clientes se limitaron a los equivocados. </font><font style="vertical-align: inherit;">Quer√≠an limitar la variabilidad de los mensajes de los clientes HTTP y limitar los clientes que proteg√≠an estos WAF, los servidores de aplicaciones finales y sus desarrolladores. </font><font style="vertical-align: inherit;">Ahora, los desarrolladores solo ten√≠an dos m√©todos que no siempre eran suficientes para describir la l√≥gica del cliente HTTP.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se crean restricciones para superarlos.</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Era de esperar que esta restricci√≥n excesiva tarde o temprano comenzar√≠a a interferir con los desarrolladores web. La iron√≠a es que es muy f√°cil no deshacerse de tales WAF. Especialmente cuando est√°n con clientes o proveedores. Desafiar las pol√≠ticas de seguridad de otras personas es un asunto desastroso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Debido a la flexibilidad de HTTP, no es dif√≠cil eludir esta limitaci√≥n; solo agregue algo a la solicitud donde pueda anular el m√©todo. El WAF estricto solo verificar√° el m√©todo en la l√≠nea de solicitud (la primera l√≠nea de la solicitud) y estar√° encantado de ver un GET o POST aprobado all√≠. Y el backend podr√° analizar el elemento agregado y extraer el m√©todo real de √©l. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puedes </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://fandry.blogspot.com/2012/03/x-" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buscar en Google un </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mont√≥n de </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://docs.inpaas.com/docs/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">art√≠culos, </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">realmente un </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://www.infoworld.com/article/3249687/how-to-implement-a-delegatinghandler-for-x-" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mont√≥n</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sobre c√≥mo los proxies malos rompieron las aplicaciones REST y c√≥mo los autores tuvieron que pasar el m√©todo real en un encabezado separado. </font><font style="vertical-align: inherit;">En todos ellos, sugieren que ingrese aproximadamente el mismo encabezado (X-HTTP-Method, X-HTTP-Method-Override o X-Method-Override - la ortograf√≠a var√≠a un poco) para indicar un m√©todo anulado. </font><font style="vertical-align: inherit;">Muy, muy raramente se pueden encontrar referencias que se puedan usar para el mismo prop√≥sito de URI de componente de consulta. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo que falta en estos art√≠culos es la secci√≥n Consideraciones de seguridad. </font><font style="vertical-align: inherit;">Y ellos simplemente son.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øLa anulaci√≥n de m√©todos es segura?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A veces los desarrolladores de aplicaciones web olvidan que entre el cliente y el servidor puede haber participantes intermedios que interact√∫an a trav√©s del protocolo HTTP: servidores proxy, cach√©s web de proveedores, CDN y WAF. La proliferaci√≥n de TLS reduce en gran medida la posibilidad de un participante intermedio entre el cliente y el servidor. Lo m√°s probable es que el √∫nico proxy entre el cliente y el backend sea su propio servidor con Nginx. Y dicha configuraci√≥n es bastante f√°cil de probar en escenarios t√≠picos antes del lanzamiento.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero estamos avanzando hacia la era de CDN, y cada vez m√°s aplicaciones se esconder√°n detr√°s de CDN que leen y manipulan el tr√°fico de usuarios. </font><font style="vertical-align: inherit;">Los backends directamente casi nunca sirven a los usuarios y se esconden detr√°s de servidores proxy inversos para aumentar la capacidad de respuesta y el rendimiento. </font><font style="vertical-align: inherit;">Por lo tanto, deber√° recordar c√≥mo anular un m√©todo puede afectar el procesamiento de una solicitud en un servidor de mediaci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los ataques de los que quiero hablar son principalmente aplicables a HTTP / 1.1. </font><font style="vertical-align: inherit;">HTTP / 2 de alguna manera hereda el comportamiento del antiguo est√°ndar, de alguna manera sigue su propio camino, por lo que la aplicabilidad de cada ataque al nuevo est√°ndar se considerar√° por separado.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ataques de cach√©</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La mayor√≠a de las veces, los servidores intermedios no tienen en cuenta las anulaciones de m√©todos, no verifican los encabezados de la familia X-HTTP-Method-Override y trabajan con la solicitud utilizando su m√©todo principal desde la L√≠nea de solicitud. Y dado que el m√©todo anulado no se incluye en la clave para buscar una solicitud en la memoria cach√© (m√©todo + URI), dichos servidores no pueden distinguir POST de POST + X-HTTP-Method-Override: DELETE. Esto significa que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no puede permitir el almacenamiento en cach√© de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ninguna solicitud a un determinado URI si el back-end puede monitorear y ejecutar m√©todos anulados.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El documento CPDoS tiene un buen ejemplo de lo que sucede si almacena en cach√© dicha solicitud. Cuando un atacante disfraza una solicitud POST como una solicitud GET, el proxy no reconoce las sustituciones y trata la solicitud como una solicitud GET leg√≠tima. Sin embargo, el backend reconoce el m√©todo reemplazado y ejecuta el verbo descrito en el encabezado POST de X-HTTP-Method-Override. Como el m√©todo POST no est√° definido para el URI de destino, el servidor genera un error. Adem√°s, la respuesta del backend se almacena en la memoria cach√© como respuesta al m√©todo original: GET. Ahora cualquier pr√≥xima solicitud GET para el mismo URI devolver√° un error en cach√©.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/0r/bv/_q/0rbv_qeocdxi9b4ctw2rschthgw.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De hecho, el ataque es ligeramente m√°s amplio que el presentado en el documento. Los autores se centraron en almacenar el error en la memoria cach√©, que no est√° en todas partes (ya) puede reproducirse. Pero si el m√©todo solicitado para el URI seleccionado est√° definido y se ejecutar√° con √©xito, el proxy recibir√° una respuesta con un estado de 200 y lo almacenar√° en cach√©. Luego, las solicitudes posteriores del mismo URI para recibir respuestas al m√©todo completamente incorrecto. En este escenario, ya no hay un requisito con un error de cach√© de respuestas 4XX, como en la descripci√≥n original de CPDoS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El problema inverso puede ocurrir. Si un cliente HTTP respetable env√≠a una solicitud GET + X-HTTP-Method-Override: PATCH (esto es malo, pero m√°s sobre eso m√°s adelante), y el cach√© ya tiene una respuesta GET, entonces el cliente recibir√° esta respuesta en cach√©. En este caso, el backend nunca recibir√° una solicitud PATCH, que puede violar la l√≥gica de la aplicaci√≥n tanto en el cliente como en el servidor.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede reducir el efecto en la memoria cach√© creando las pol√≠ticas de almacenamiento en cach√© correctas y dividiendo los recursos en dos grupos: aquellos para los cuales la operaci√≥n de anulaci√≥n del m√©todo es inaceptable o no se requiere, las respuestas a ellos pueden almacenarse en cach√© y aquellos para los que la operaci√≥n de anulaci√≥n del m√©todo es necesaria, cualquier almacenamiento en cach√© de tales respuestas es inaceptable . Pero cuanto menos recursos se almacenan en cach√©, menos √∫til es el CDN y cuanto m√°s tr√°fico llega al backend, m√°s se expone la aplicaci√≥n a la inundaci√≥n HTTP. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, es mejor usar el cach√© HTTP tanto como sea posible, para esto es necesario que el servidor de cach√© pueda distinguir entre solicitudes con diferentes m√©todos anulados. La primera forma es transferir la anulaci√≥n del m√©todo del componente de consulta al URI:</font></font><br>
<br>
<pre><code class="plaintext hljs">POST /some-uri HTTP/1.1<font></font>
X-HTTP-Method-Override: DELETE<font></font>
   ‚Üì  ‚Üì   ‚Üì<font></font>
POST /some-uri?method=DELETE HTTP/1.1<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora las solicitudes con diferentes m√©todos se ven diferentes para el cach√©, ya que obtienen diferentes claves. Algunos servidores proxy prefieren no almacenar en cach√© las respuestas a las solicitudes que contienen el componente de consulta en el URI. Pero esto solo afectar√° la eficiencia del almacenamiento en cach√©. Este m√©todo siempre resuelve problemas con el almacenamiento en cach√© incorrecto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otra forma es dejar la anulaci√≥n del m√©todo en un encabezado separado, pero ingrese una clave secundaria para encontrar la respuesta en el cach√©. Esto es posible con el encabezado Vary. Al atender la solicitud, el servidor repetir√° el encabezado con la anulaci√≥n del m√©todo y reflejar√° el nombre de este encabezado en el encabezado Vary. Luego, en las siguientes solicitudes, el servidor de cach√© utilizar√° el valor del m√©todo anulado como clave secundaria cuando busque una solicitud en la cach√©.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/oh/1n/rd/oh1nrdf3x18yktd6moekwlr01-w.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este m√©todo funciona si el servidor intermedio puede trabajar con claves secundarias. </font><font style="vertical-align: inherit;">Este suele ser el caso, pero el nivel de confianza del proxy, que corta todos los m√©todos excepto GET y POST, generalmente es m√°s bajo y es mejor verificar esto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anular un m√©todo a trav√©s de cualquier entidad dentro del cuerpo de la solicitud tiene exactamente los mismos inconvenientes que anular a trav√©s de un encabezado adicional: est√° fuera de la visibilidad del cach√©.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ataques de mensajes en cola</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Incluso si los ataques de cach√© est√°n cerrados, eso no es todo. </font><font style="vertical-align: inherit;">Un atacante anulando un m√©todo puede intentar cambiar el marco de la respuesta y, por lo tanto, violar la correspondencia de los pares de solicitud-respuesta para otros clientes. </font><font style="vertical-align: inherit;">O forzar el lado del servidor de la aplicaci√≥n para procesar la misma solicitud varias veces.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo m√°s importante que se requiere para esto es un servidor intermedio que funcione en modo proxy inverso. Es decir, cualquier cach√© o servidor CDN. Dicho proxy admite un n√∫mero relativamente peque√±o de conexiones al backend y multiplica las solicitudes de muchos clientes en cada una de ellas. Esto es necesario tanto para asumir la carga de soportar una gran cantidad de conexiones de clientes desde los servidores al servidor proxy como para equilibrar la carga entre los servidores. La terminaci√≥n de las conexiones TLS tambi√©n ocurre en el proxy, las conexiones del cliente nunca se conectan directamente al backend. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dado que ahora las solicitudes de diferentes clientes estar√°n en la misma conexi√≥n entre el servidor y el proxy, es necesario mantener una correspondencia clara entre los pares de solicitud-respuesta. La mayor√≠a de los servidores proxy </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no se canalizan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(canalizaciones) solicita al back-end y trabaja con √©l en el modo de solicitud-respuesta. El modo de solicitud-respuesta es m√°s simple y est√° sujeto a pr√°cticamente una amenaza: el bloqueo de la conexi√≥n. Si hace que la conexi√≥n se cuelgue en un solo par de solicitud-respuesta, puede causar un retraso o incluso una negativa a procesar las siguientes solicitudes (por ejemplo, si logra desbordar las colas de solicitudes de proxies).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solicitudes de canalizaci√≥n de servidores proxy m√°s productivos al backend: esto le permite enviar un paquete de solicitudes al servidor de inmediato y esperar su ejecuci√≥n. El rendimiento es mayor, pero hay m√°s amenazas. En primer lugar, el problema del bloqueo de cabecera de l√≠nea no desaparece en ning√∫n lado, incluso si el backend puede rastrear la canalizaci√≥n de consultas y ejecutarlas en paralelo, no se pueden enviar si el primero se cuelga. En segundo lugar, si interrumpe el encuadre de la respuesta, puede confundir el proxy y romper la correspondencia de los pares de solicitud-respuesta, entonces algunos clientes pueden obtener las respuestas de otras personas, o al menos lograr un cierre de conexi√≥n instant√°nea con el back-end.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/td/wn/rj/tdwnrjiw4ekrsl7l1aqda-hhyzi.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La redefinici√≥n m√°s simple y divertida de un m√©todo es reemplazar GET con el verbo HEAD. Si la respuesta a la primera tiene un cuerpo, entonces la segunda no. Adem√°s, todos los dem√°s encabezados son iguales, incluidos los que proporcionan el marco de la solicitud. Cuando el proxy redirige un HEAD anulado al servidor, esperar√° del servidor no solo los encabezados de respuesta, sino tambi√©n el cuerpo de respuesta, que el backend no enviar√°. Si el proxy y el servidor interact√∫an en el modo de solicitud-respuesta, la conexi√≥n se "colgar√°" hasta que se rompa por tiempo de espera.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si el servidor env√≠a las siguientes respuestas (modo canalizado), entonces se pueden analizar no como respuestas independientes, sino como parte de la respuesta incompleta anterior al GET. El proxy los colocar√° (o parte de ellos) en el cuerpo de la respuesta "OBTENER" y lo enviar√° al atacante para leerlos. Puede crear un pseudo-GET para recibir un archivo grande y volcar algo de tr√°fico entre el proxy y el back-end. El √©xito depende de c√≥mo el backend coloca Content-Length y Transfer-Encoding: encabezados fragmentados para enmarcar mensajes. El primero casi siempre le permitir√° obtener un volcado, el segundo a menudo generar√° errores de an√°lisis y provocar√° una desconexi√≥n del back-end. Si no tienes suerte, entonces el pseudo-GET puede cubrir varias respuestas en su totalidad y finalizar justo antes de la siguiente respuesta.El proxy no podr√° reconocer este problema en absoluto y para obtener m√°s respuestas a este respecto, se violar√° la correspondencia de solicitud-respuesta.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ee/ds/h9/eedsh90uounshmxglkz5aconiim.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Incluso si todo lo que se logr√≥ al anular el m√©todo fue cerrar la conexi√≥n entre el proxy y el backend, entonces esto puede ser suficiente para un ataque. </font><font style="vertical-align: inherit;">Puede lanzar solicitudes de servicio con tales solicitudes: las conexiones con backends se interrumpir√°n constantemente. </font><font style="vertical-align: inherit;">No hay tantos, y la reapertura lleva tiempo, como resultado, puede lograr una disminuci√≥n significativa en el rendimiento de la conexi√≥n de back-end del proxy y, por lo tanto, reducir el ancho de banda del servicio.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reproducci√≥n autom√°tica de spam</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dije anteriormente que las solicitudes de la forma GET + X-HTTP-Method-Override: PATCH de clientes respetables son malas. Y esto es malo porque los m√©todos tienen dos propiedades: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seguridad</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">idempotencia</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Seguridad significa que el m√©todo no cambia el estado del servidor (solo lectura) y no nos interesa en el contexto de este art√≠culo. La idempotencia del m√©todo asegura que la solicitud repetida tenga el mismo efecto que una solicitud √∫nica. Puede dibujar una analog√≠a: </font></font><code>(a = 5)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- solicitud idempotente, y </font></font><code>(a += 2) </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- no idempotente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta propiedad es lo que nos interesa. Si la conexi√≥n entre el cliente y el servidor se rompe repentinamente, el cliente, sabiendo que el m√©todo es idempotente, puede reenviar autom√°ticamente la solicitud. Los proxies se comportan de la misma manera. Las solicitudes no idempotentes no se repiten autom√°ticamente porque no se sabe c√≥mo afectan al servidor y qu√© recibir√° el cliente al final. Creo que todos conocen las ventanas emergentes en el navegador: "¬øEst√° seguro de que desea repetir la solicitud?" </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si enmascara un m√©todo no idempotente como idempotente, en caso de errores, no se descartar√°, sino que se redirigir√° al servidor nuevamente. Incluso si el cliente considerar√° el m√©todo de solicitud real antes de volver a enviar la solicitud, esto no ayudar√° mucho, porque el servidor proxy no sabe sobre la anulaci√≥n del m√©todo y repetir√° dichas solicitudes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si un atacante puede forzar las desconexiones entre el servidor y los clientes, podr√° hacer que el servidor ejecute repetidamente solicitudes no idempotentes y reduzca la confiabilidad y la previsibilidad de la aplicaci√≥n. </font><font style="vertical-align: inherit;">En la secci√≥n anterior, acabamos de encontrar una forma de causar interrupciones de conexi√≥n con el mismo m√©todo de anulaci√≥n. </font><font style="vertical-align: inherit;">Aunque debe recordarse que Internet es una red poco confiable, por definici√≥n, y la aplicaci√≥n en s√≠ misma est√° en peligro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para protegerse contra este ataque, debe usar solo m√©todos que no agreguen nuevas propiedades a la solicitud como transporte. </font><font style="vertical-align: inherit;">POST es un buen candidato, porque por defecto no es seguro ni idempotente.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øEse antiguo HTTP / 1.1, como con HTTP / 2?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HTTP / 2 ha cambiado la forma en que las solicitudes se transportan entre nodos, pero no ha cambiado su significado l√©xico. Por lo tanto, en los ataques relacionados con el valor de la solicitud, HTTP / 2 se comporta igual. Pero los ataques de "transporte" no se reproducen, ya que ya se tienen en cuenta en la norma. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los ataques en la memoria cach√© se</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> reproducen de manera similar a HTTP / 1, y la protecci√≥n es similar. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los ataques de Message Queue Server</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no </font><strong><font style="vertical-align: inherit;">son</font></strong><font style="vertical-align: inherit;"> aplicables a HTTP / 2. Los mensajes HTTP en √©l se dividen en marcos separados, con encabezados de marco separados que determinan expl√≠citamente la longitud y el final del mensaje. Como si el atacante no cambiara el m√©todo y modificara los encabezados HTTP, esto no afectar√° el marco del mensaje. Robar la respuesta fallar√°. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los ataques a la repetici√≥n de mensajes no idempotentes son</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aplicables incluso teniendo en cuenta el hecho de que en HTTP / 2 hay</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mecanismo de notificaci√≥n de la √∫ltima solicitud procesada</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">En HTTP / 2, las solicitudes m√∫ltiples se multiplican en el mismo TCP y, por lo tanto, crean </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">flujos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Cada hilo tiene su propio n√∫mero. </font><font style="vertical-align: inherit;">Si el servidor HTTP / 2 se desconecta, puede indicar el n√∫mero de la √∫ltima solicitud procesada en GOAWAY. </font><font style="vertical-align: inherit;">Las solicitudes con un n√∫mero m√°s alto siempre son seguras para redirigir; las solicitudes con un n√∫mero m√°s bajo solo se redirigen si son idempotentes. </font><font style="vertical-align: inherit;">Si una solicitud con un m√©todo anulado parece idempotente para un servidor proxy, entonces el proxy lo reenviar√° al servidor.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥mo anular un m√©todo de forma segura</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La respuesta corta es de ninguna manera. Es mejor no utilizar anulaciones de m√©todos. Y deshabilite completamente el soporte en el backend, si lo hay. Bloquee los m√©todos de anulaci√≥n de clientes HTTP. Rechazar proxy / WAF, que corta los m√©todos "extra". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si tiene que vivir de alguna manera con la redefinici√≥n del m√©todo, entonces para evitar suficientes ediciones en el back-end. Primero, es recomendable anular el m√©todo solo a trav√©s del componente de consulta del URI.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En segundo lugar, deber√≠a haber una lista blanca de la transformaci√≥n de los m√©todos: cu√°les son aceptables como "transporte" y cu√°les son los resultantes. </font><font style="vertical-align: inherit;">No debe haber funciones de transformaci√≥n generalizadas cuando cualquier m√©todo puede ser anulado por cualquiera. </font><font style="vertical-align: inherit;">El m√©todo de "transporte" no debe tener las propiedades de seguridad e idempotencia si el resultante no lo tiene. </font><font style="vertical-align: inherit;">Deben prohibirse las transformaciones peligrosas, el mismo reemplazo GET -&gt; HEAD.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øNecesito parchear un proxy / WAF problem√°tico?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si el proxy implementa solo los m√©todos GET y POST, y bloquea los dem√°s por una raz√≥n u otra, definitivamente s√≠. </font><font style="vertical-align: inherit;">Puede optimizarlo principalmente para GET y POST, pero bloquear otros m√©todos es una mala idea. </font><font style="vertical-align: inherit;">Lo que todav√≠a crea un abismo de desconfianza en el producto: si las cosas b√°sicas est√°n bloqueadas, ¬øqu√© esperar de la implementaci√≥n de problemas m√°s complejos?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si le preocupa la seguridad de las aplicaciones web protegidas, puede valer la pena proteger las aplicaciones de las pol√≠ticas de anulaci√≥n de m√©todos inseguros. </font><font style="vertical-align: inherit;">Por supuesto, en el caso general, sin conocer los detalles de la implementaci√≥n de la aplicaci√≥n web, es imposible proteger completamente la aplicaci√≥n de las anulaciones incorrectas, pero puede cubrir parcialmente a los usuarios que simplemente no conocen el problema. </font><font style="vertical-align: inherit;">Es necesario no solo para proteger contra el envenenamiento de su propio cach√©, sino tambi√©n para habilitar o deshabilitar la anulaci√≥n de cada aplicaci√≥n protegida. </font><font style="vertical-align: inherit;">Para hacer esto, realice </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un seguimiento de los </font></font></a> <font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">encabezados </font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">de </font></a></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uso com√∫n.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">X-HTTP-Method, X-HTTP-Method-Override y X-Method-Override. </font><font style="vertical-align: inherit;">El seguimiento de la redefinici√≥n en el componente de consulta del URI no tiene mucho sentido: el cach√© no envenena dicha solicitud, y la consulta puede ser muy larga y tener un formato completamente arbitrario.</font></font><br>
<br>
<h2>      ?</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desarrolladores de seguridad, no limiten a los desarrolladores de aplicaciones a pol√≠ticas de seguridad. </font><font style="vertical-align: inherit;">Todav√≠a encontrar√°n la forma de sortearlos, y cuanto m√°s flexible sea el protocolo, m√°s f√°cil ser√° hacerlo. </font><font style="vertical-align: inherit;">Es muy probable que no lo pateen y esperen hasta que haga que las restricciones sean m√°s razonables, sino que simplemente las eludir√°n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si descubri√≥ c√≥mo implementar algo en el protocolo, pero esto anula o va en contra de uno de los </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conceptos clave del</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est√°ndar, seguramente surgir√°n problemas de compatibilidad y seguridad. </font><font style="vertical-align: inherit;">Y deben estar cubiertos al mismo tiempo que la decisi√≥n. </font><font style="vertical-align: inherit;">Cada vez. </font><font style="vertical-align: inherit;">Si cumpli√≥ con estos consejos y no vio advertencias de seguridad, no los duplique en Internet. </font><font style="vertical-align: inherit;">Siempre sea cr√≠tico con la decisi√≥n y descubra qu√© podr√≠a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">salir mal</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En lugar de un ep√≠logo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øQu√© problemas del servidor proxy encontraste? </font><font style="vertical-align: inherit;">¬øQu√© ten√≠a que ser evitado y c√≥mo?</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es492706/index.html">Archivos de memoria: c√≥mo el cerebro codifica y reproduce recuerdos</a></li>
<li><a href="../es492708/index.html">Internet satelital global: ¬øhay noticias de los campos?</a></li>
<li><a href="../es492710/index.html">Camino espinoso del candidato a trav√©s de varios sistemas de gesti√≥n de recursos humanos</a></li>
<li><a href="../es492712/index.html">Dominar el desarrollo a trav√©s de pruebas en Android usando pruebas de IU</a></li>
<li><a href="../es492714/index.html">Trabajo efectivo desde casa: general y personal</a></li>
<li><a href="../es492720/index.html">diskussion: servicio de archivos de proyecto</a></li>
<li><a href="../es492724/index.html">Bj√∂rn Straustrup responde las 5 preguntas principales de C ++ con desbordamiento de pila</a></li>
<li><a href="../es492726/index.html">OS Sivelkiriya: proceso de desarrollo de software</a></li>
<li><a href="../es492728/index.html">Asterisco y env√≠o perdido en Telegram / Slack / E-mail</a></li>
<li><a href="../es492730/index.html">Departamento de Defensa de EE. UU .: √âtica para IA y veh√≠culos no tripulados</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>