<!doctype html>
<html class="no-js" lang="hi">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯЫВ ЁЯЪА ЁЯСйЁЯП┐тАНтЬИя╕П рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдореЗрдВ 3 рдбреА рдЖрд░реНрдХреЗрдб: рд╣рдордиреЗ рд░рд┐рдПрдХреНрдЯ + рд░реЗрдбрдХреНрд╕ рдкрд░ рдЧреЗрдо рдХреИрд╕реЗ рдмрдирд╛рдпрд╛ ЁЯЩД ЁЯзе ЁЯЩЗЁЯП╗</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдирдорд╕реНрдХрд╛рд░, рд╣реЗрдмреНрд░! рдЙрди рджреВрд░ рдХреЗ рд╡рд░реНрд╖реЛрдВ рдореЗрдВ рдирд╣реАрдВ, "рдкреНрд░реЛрдЧреНрд░рд╛рдорд░" рд╕рдВрдХрд╛рдп рдХреЗ рдкрд╣рд▓реЗ рд╡рд░реНрд╖ рдореЗрдВ, рдореИрдВрдиреЗ рд╕рд╛рдереА рдЫрд╛рддреНрд░реЛрдВ рд╕реЗ рд╕рд╡рд╛рд▓ рдкреВрдЫрдирд╛ рдкрд╕рдВрдж рдХрд┐рдпрд╛: "рдЖрдк рдпрд╣рд╛рдВ рдЕрдзреНрдпрдпрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдореЗрдВ 3 рдбреА рдЖрд░реНрдХреЗрдб: рд╣рдордиреЗ рд░рд┐рдПрдХреНрдЯ + рд░реЗрдбрдХреНрд╕ рдкрд░ рдЧреЗрдо рдХреИрд╕реЗ рдмрдирд╛рдпрд╛</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/2gis/blog/498638/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирдорд╕реНрдХрд╛рд░, рд╣реЗрдмреНрд░! </font><font style="vertical-align: inherit;">рдЙрди рджреВрд░ рдХреЗ рд╡рд░реНрд╖реЛрдВ рдореЗрдВ рдирд╣реАрдВ, "рдкреНрд░реЛрдЧреНрд░рд╛рдорд░" рд╕рдВрдХрд╛рдп рдХреЗ рдкрд╣рд▓реЗ рд╡рд░реНрд╖ рдореЗрдВ, рдореИрдВрдиреЗ рд╕рд╛рдереА рдЫрд╛рддреНрд░реЛрдВ рд╕реЗ рд╕рд╡рд╛рд▓ рдкреВрдЫрдирд╛ рдкрд╕рдВрдж рдХрд┐рдпрд╛: "рдЖрдк рдпрд╣рд╛рдВ рдЕрдзреНрдпрдпрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдХреНрдпреЛрдВ рдЧрдП?" </font><font style="vertical-align: inherit;">рдмреЗрд╢рдХ, рдореИрдВрдиреЗ рдЙрддреНрддрд░реЛрдВ рдХреЗ рд╕рдЯреАрдХ рдЖрдВрдХрдбрд╝реЗ рдирд╣реАрдВ рд░рдЦреЗ рдереЗ, рд▓реЗрдХрд┐рди рдореБрдЭреЗ рдХреБрдЫ рдпрд╛рдж рд╣реИ: рдЖрдзреЗ рд╕реЗ рдЬреНрдпрд╛рджрд╛ рдЧреЗрдо рдмрдирд╛рдирд╛ рдЪрд╛рд╣рддреЗ рдереЗред </font><font style="vertical-align: inherit;">рдЗрд╕ рддрд░рд╣ рд╕реЗ рдЙрддреНрддрд░ рджреЗрдиреЗ рд╡рд╛рд▓реЛрдВ рдореЗрдВ рд╕реЗ рдЕрдзрд┐рдХрд╛рдВрд╢ рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░ рдХреЗ "рдЧрдгрд┐рддрдЬреНрдЮреЛрдВ" рдФрд░ "рднреМрддрд┐рдХрд╢рд╛рд╕реНрддреНрд░реА" рдХреА рдкреНрд░рдЪреБрд░рддрд╛ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рдирд╣реАрдВ рдереЗ, рдЬрд┐рдирдХреЗ рд╕рд╛рде рд╣рдо рдЕрдзреНрдпрдпрди рдХреЗ рдкрд╣рд▓реЗ рджреЛ рд╡рд░реНрд╖реЛрдВ рдореЗрдВ рдЕрднрд┐рднреВрдд рдереЗред </font><font style="vertical-align: inherit;">рд╕рднреА рдмрдЪреЗ рдирд╣реАрдВ - рдкрд╛рдВрдЪ рднреАрдбрд╝рднрд╛рдбрд╝ рд╡рд╛рд▓реЗ рд╕рдореВрд╣реЛрдВ рдХреЗ рджреВрд╕рд░реЗ рд╡рд░реНрд╖ рдХреЗ рдЕрдВрдд рддрдХ рддреАрди рдЕрдзреВрд░реЗ рдереЗред</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрд╣реБрдд рд╕рдордп рдкрд╣рд▓реЗ рдирд╣реАрдВ, рд╣рдорд╛рд░реА рдлреНрд░рдВрдЯ-рдПрдВрдб рдЯреАрдо рдХреЛ gamedev рдХреА рднреВрдорд┐рдХрд╛ рдореЗрдВ рдЦреБрдж рдХреЛ рдЖрдЬрдорд╛рдиреЗ рдХрд╛ рдЕрд╡рд╕рд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред </font><font style="vertical-align: inherit;">рдмрд╣реБрдд рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ, рдХрд╛рд░реНрдп рдпрд╣ рд╣реИ: рдПрдХ рдЕрд╕рд▓реА 3 рдбреА рдЧреЗрдо рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рддрд╛рдХрд┐ рдЖрдк рдХреЗрд╡рд▓ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдЦреЛрд▓рдХрд░ рдЦреЗрд▓ рд╕рдХреЗрдВред </font><font style="vertical-align: inherit;">рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдореЛрдмрд╛рдЗрд▓ рднреАред </font><font style="vertical-align: inherit;">рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рд╡реЗрдмрд╡реНрдпреВ рдореЗрдВ рднреАред</font></font></p><br>
<p><img src="https://habrastorage.org/webt/fu/8-/se/fu8-seuqkglfv7tecp4q5u3hf_4.png"></p><br>
<p>       ,     ,    ,          тАФ React + Redux,   ┬л ┬╗,  ,  ,         .</p><a name="habracut"></a><br>
<h2 id="kak-vsyo-nachinalos">  </h2><br>
<p>        RnD   ,    : ┬л   CodeFest тАФ   .    тАФ     ┬╗.     ,  ,  ,  .             Gods in the sky. </p><br>
<p><img src="https://habrastorage.org/webt/l6/zv/br/l6zvbrmricb2lnvqrogi_d0hfme.png" alt="рд╡реАрдХреЗ / https://vk.com/codefest рдкрд░ рдХреЛрдбрдлреЗрд╕реНрдЯ рдЧреНрд░реБрдк рд╕реЗ рдлреЛрдЯреЛред  рдлреЛрдЯреЛ рдХрд╛ рд╕реНрд░реЛрдд рдпрд╣рд╛рдВ рд╣реИред"><br>
<em>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">CodeFest  </a>.</em></p><br>
<p>   <del>M</del>MO TPS   ,      ,          .  ,  ,   ,       .     CodeFest.   ,    .</p><br>
<h2 id="kak-vsyo-prodolzhalos">  </h2><br>
<p>   2     ,       ,     2      .        ,    ,            .</p><br>
<p> :    -,  тАФ  ,   .  ,      N   ,   тАФ 1 . ,  тАФ 15 . ,  ,   16-.     ,     ,      :</p><br>
<ol>
<li>            30  .    CodeFest,       тАФ     ,     ┬л┬╗. ,  . </li>
<li>┬л┬╗ .   ,      :<br>
<ul>
<li>90  CPU;</li>
<li>120 ;</li>
<li>270 /c тАФ    , 675 /c тАФ     . </li>
</ul></li>
<li>             4,2 /c.    ,      .    тАФ  UDP   WebRTC,       .       .</li>
<li>     . 2        ,         ,   ,   .  ,   -  Node.js    ,   . </li>
</ol><br>
<p>    , ,  (       ?),    ,  , ,       .        .</p><br>
<p>     ,        .          ,     ┬л┬╗.        тАФ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a>.</p><br>
<h2 id="stek-tehnologiy-chto-i-pochemu"> :   </h2><br>
<p>    ,    ,     ,   .  ,  ,         5 ,    ,      40  .</p><br>
<p>    -.     ,           ,        тАФ  .             React  Redux.   c 3D-,   ,    Gods in the sky,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">three.js</a>.</p><br>
<p> ,         .</p><br>
<h2 id="kak-organizovali-infrastrukturu">  </h2><br>
<p>      :</p><br>
<p><img src="https://habrastorage.org/webt/aj/qs/is/ajqsispjfubcnek60ow3-xnutvq.png"></p><br>
<p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a>,        Node.js.    :</p><br>
<ul>
<li>    ,           -    (  ,      IE11);</li>
<li>      access-;</li>
<li>   html-    .</li>
</ul><br>
<p> SSR .     kubernetes       ,       .        ,    .    ,  , , ,       ( ).         .          Nginx.</p><br>
<h2 id="pro-organizaciyu-steyta">  </h2><br>
<p>      .    TS,    AppState,   :</p><br>
<pre><code class="javascript hljs">interface AppState {
    <span class="hljs-attr">gameState</span>: GameState;<font></font>
    gameObjects: GameObjects;<font></font>
    data: Data;<font></font>
    requests: RequestsState;<font></font>
}</code></pre><br>
<p> <code>requests</code> тАФ    ,    тАФ .    ,  тАФ  . . </p><br>
<p> <code>data</code> тАФ  ,         , ,  ,    ┬л┬╗.  .</p><br>
<p> <code>GameState</code>     :</p><br>
<ol>
<li><p><code>stage: 'factoids' | 'citySelect' | 'flyShow' | 'game' | 'results';</code> тАФ  .     : </p><br>
<ul>
<li>  ;</li>
<li> ;</li>
<li> ;</li>
<li> ;</li>
<li> .</li>
</ul><br>
</li>
<li><p><code>elapsedTime: number;</code> тАФ   ,    ,      .</p><br>
</li>
</ol><br>
<p> ,  <code>factoids</code>  <code>flyShow</code>,      ,    тАФ     <code>elapsedTime</code>.      0,     .       ,    .   ,     ,    ,      .      ,       .     тАж  -      ,       .</p><br>
<p>, ,   :</p><br>
<pre><code class="javascript hljs">interface GameObjects {
    <span class="hljs-attr">user</span>: UserInGame;<font></font>
    gifts: { [id: string]: GiftInGame; };<font></font>
    boosts: { [id: string]: Boost; };<font></font>
    bombs: { [id: string]: Bomb; };<font></font>
}</code></pre><br>
<p>       ,    :  , ,   .       тАФ       . </p><br>
<p>GameObjects тАФ     .    ,  FPS  .           GPU   100   .  Redmi Note 7    40 FPS  (      ).       MI 5S  30 FPS,     20  ,      .</p><br>
<p> ,     .     .</p><br>
<h2 id="kak-my-zagnali-sebya-v-ugol">     </h2><br>
<p>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">-</a> Redux,     тАФ       .      Redux      ,      .     ?           Redux,    .</p><br>
<p>   ,        .       ,          .       ┬л┬╗ ( . behavior тАФ ).   ,       . </p><br>
<p>       .     тАФ   tick,            .      ,        .     tick   .      :</p><br>
<ul>
<li>  ,   ,   ,  . ,   ,    ,      .</li>
<li>  ( Redux-),    .<br>
,        ┬л┬╗  .</li>
<li> ,     gameObjects,      . ,    ┬л┬╗,         .</li>
</ul><br>
<p>   25      (  ).</p><br>
<p>      .      (  ),     React,         .  -           ,       ┬л-  ┬╗ ( ,  ,    ).</p><br>
<p><img src="https://habrastorage.org/webt/x8/oj/7v/x8oj7vakygewfuql_szihp3rp40.jpeg" alt="рдЙрд╕ рджрд┐рди рдЯреАрдо рдХрд╛ рдПрдХ рдФрд░ рд╕рджрд╕реНрдпред  рдкрд┐рдХреНрд╕рд╛рдмрд╛рдп.рдХреЙрдо рд╕реЗ рд▓реА рдЧрдИ рддрд╕реНрд╡реАрд░"><br>
<em>      .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">pixabay.com</a></em></p><br>
<p>  ,  FPS-          13.   ,   ,   -   MI 5S,    FPS- тАФ    5-6,       .        .</p><br>
<p>  :  performance   тАФ   ,  .     ,  ,      .</p><br>
<p>     FPS=30 , : </p><br>
<ul>
<li>Redux   <code>FPS * ~[ ] ~= 750</code>     ,   , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">    </a>.</li>
<li>ReactтАЩ   <code>FPS * ~2 * ~[     ]</code>   .</li>
<li>three.js  ,     ,   WebGL   .    ,     .</li>
<li>    (..  150 )   4-6 , ..       . </li>
<li>CSS-     .</li>
<li>         ,       FPS  2-4  (     , ┬л┬╗     ). </li>
<li>          React.memo, -     ,      . </li>
</ul><br>
<p> React  :</p><br>
<ul>
<li><code>* ~2</code> ,            <code>connect</code>.  <code>connect</code> тАФ  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">HOC</a>,  ,  .</li>
<li>       ,  React  тАУ   (render pass),      CPU,  GPU. </li>
</ul><br>
<h2 id="sadim-pesca-na-dietu">   </h2><br>
<p> :    React.memo ,  ,    ┬л┬╗,     ,     DOM-,    . </p><br>
<p>  ,     React + Redux,         . </p><br>
<p><strong> Redux</strong></p><br>
<p>     Redux   тАФ       .     ~1      ,       . ~1,      -    тАФ   .     -,     ,   GameObjects   ,    :</p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setNextGameObjects</span>(<span class="hljs-params">payload: GameObjects</span>) </span>{
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">type</span>: <span class="hljs-string">'SET_NEXT_GAME_OBJECTS'</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>,<font></font>
        payload,<font></font>
    };<font></font>
}</code></pre><br>
<p>     GameObjects   :</p><br>
<ol>
<li>    ,      .    <code>SET_NEXT_GAME_OBJECTS</code>. </li>
<li>  ,    ,         GameObjects.     Redux  ,      - .         <code>SET_NEXT_GAME_OBJECTS</code>. </li>
</ol><br>
<p>      :</p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> state = store.getState().gameObjects;
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> action <span class="hljs-keyword">of</span> <span class="hljs-keyword">this</span>.collectedActions) {<font></font>
    state = gameObjectsFakeStateReducer(state, action);<font></font>
}<font></font>
store.dispatch(setNextGameObjects(state));</code></pre><br>
<p>collectedActions тАФ ,   .       тАФ  ,  .</p><br>
<p>   тАФ  ~25        10 :    ~2   .      ,   gameObjectsFakeStateReducer     .     25      .          ,      . </p><br>
<p>  ?     ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">perf-</a>.   3 :</p><br>
<ol>
<li>      ES2018,          ~50      &lt; ES2018 (,   Firefox тАФ    ).    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">,    spread</a>.</li>
<li>      Object.assign         300 .</li>
<li>            500 ,   ┬л ┬╗    .</li>
</ol><br>
<p> , , ,        тАФ       ES2018,   .       Firefox.</p><br>
<p> тДЦ3  ,   тАж .         .</p><br>
<p>     Object.assign. <code>gameObjectsFakeStateReducer</code>  <code>gameObjectsFastStateReducer</code>,     - :</p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">switch</span> (action.type) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'PARTIAL_GIFT_STATE_PATCH'</span>:
        <span class="hljs-keyword">if</span> (!state.gifts[action.payload.id]) {
            <span class="hljs-keyword">return</span> state;<font></font>
        }<font></font>
        <span class="hljs-built_in">Object</span>.assign(state.gifts[action.payload.id], action.payload);
        <span class="hljs-keyword">break</span>;
    <span class="hljs-comment">// case, default ...</span>
}</code></pre><br>
<p>? ,   .  ,     .           25   1   2-4 (    CPU).   :</p><br>
<p><img src="https://habrastorage.org/webt/ap/nk/wb/apnkwbrgdv7vqqisksup1hklpzg.png" alt="рдЫрд╡рд┐"></p><br>
<p>   ┬л┬╗   ,   ,    Redux         10        .  , -   ,    ,   connect          gameObjects.   ,     .</p><br>
<p><strong> React</strong></p><br>
<p>   React     .    тАФ     DOM.    ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a>,       тАФ reselect, React.memo/React.PureComponent,   shouldComponentUpdate  .      .</p><br>
<p>     ,      ,       ~2,   тАФ  5.     ,  React         , ..       DOM  .</p><br>
<p>          <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">batch</a>   React + Redux. ,    тАФ          .  ,  ?</p><br>
<p>  ,       ,   connect     .      ,     .</p><br>
<p>  . ,   <code>&lt;ScoreBoard /&gt;</code>, </p><br>
<ol>
<li>  ;</li>
<li> ,  .<br>
<img src="https://habrastorage.org/webt/8p/zk/vw/8pzkvwx3nshmo2ys9ekmzcs7ekq.png"></li>
</ol><br>
<p>   React.PureComponent,    connect   mapStateToProps.      <code>elapsedTime</code>  <code>score</code>. <code>Score</code>  ,  <code>elapsedTime</code> тАФ   .  <code>elapsedTime</code>  -    render.  ,       FPS,          shouldComponentUpdate.  HOCтАЩa connect   тАФ shouldComponentUpdate   . </p><br>
<p> ,   ┬л┬╗      ,    : </p><br>
<ol>
<li>   shouldComponentUpdate,   <code>elapsedTime</code>     (      ).  ,        HOCтАЩa connect. </li>
<li> mapStateToProps   .   ,     ,        .          connectтАЩa.</li>
<li>     useSelector.   , ..    . , <em></em>,  ,   .</li>
<li>    тАФ     connect,   тАФ    .       ,   .       ScoreBoard    .</li>
</ol><br>
<p> тАФ !  ScoreBoardтАЩa   connect,    ,     .        mapStateToProps  ,          .</p><br>
<p>       ,  connect.       ,          тАФ -     -  canvas-,   three.js     (, ,  .).      render   ,   :</p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"map"</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{s.map}</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{mapRef}</span> /&gt;</span></span>;</code></pre><br>
<p></p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"scene"</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{s.scene}</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{sceneRef}</span> /&gt;</span></span>;</code></pre><br>
<p>      ,  DOM           тАФ   .   ,     React <strong>  </strong>.     ,    componentDidUpdate,      .  ,  componentDidUpdate     :</p><br>
<pre><code class="javascript hljs">public componentDidUpdate() {
    <span class="hljs-keyword">const</span> { geoPos, orientedRotationQuanternion } = <span class="hljs-keyword">this</span>.props;
    <span class="hljs-keyword">const</span> { map } = <span class="hljs-keyword">this</span>.state;<font></font>
    map.setQuat(orientedRotationQuanternion);<font></font>
    map.setCenter([geoPos[<span class="hljs-number">0</span>], geoPos[<span class="hljs-number">1</span>]], { <span class="hljs-attr">animate</span>: <span class="hljs-literal">false</span> });<font></font>
    map.setZoom(getMapZoomFromHeight(geoPos[<span class="hljs-number">2</span>]), { <span class="hljs-attr">animate</span>: <span class="hljs-literal">false</span> });<font></font>
}</code></pre><br>
<p>    ,  componentDidUpdate       .    :</p><br>
<ol>
<li>  connect.   ,   mapStateToProps;</li>
<li>   <code>public shouldComponentUpdate() { return false; }</code> тАФ   ┬л┬╗   ┬л┬╗;</li>
<li>  Redux   (  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> </a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a>)   useStore   ;</li>
<li>     (<code>store.subscribe(() =&gt; { /* тАж */})</code>);</li>
<li>        ; </li>
<li>!</li>
</ol><br>
<p>  :</p><br>
<pre><code class="javascript hljs">store.subscribe(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> state = store.getState();
    <span class="hljs-keyword">const</span> { map } = <span class="hljs-keyword">this</span>.state;
    <span class="hljs-keyword">const</span> { geoPos, orientedRotationQuanternion } = state.gameObjects.user;<font></font>
<font></font>
    map.setQuat(orientedRotationQuanternion);<font></font>
    map.setCenter([geoPos[<span class="hljs-number">0</span>], geoPos[<span class="hljs-number">1</span>]], { <span class="hljs-attr">animate</span>: <span class="hljs-literal">false</span> });<font></font>
    map.setZoom(getMapZoomFromHeight(geoPos[<span class="hljs-number">2</span>]), { <span class="hljs-attr">animate</span>: <span class="hljs-literal">false</span> });<font></font>
}); </code></pre><br>
<p>    ,        ,    .</p><br>
<p>  ,     -  ,          .</p><br>
<p><img src="https://habrastorage.org/webt/py/df/-7/pydf-7ke4d8chrx8tx2ltywyfiq.png"><br>
<em>   .    тАФ React Tree Reconcilation + Commit</em></p><br>
<p><img src="https://habrastorage.org/webt/ws/ki/et/wskiet93rpomj5e4yh67deqg_t4.png"><br>
<em>React Tree Reconcilation + Commit  </em></p><br>
<h2 id="zaklyuchenie"></h2><br>
<p> React + Redux    ,  :</p><br>
<ul>
<li>        ,    ,      ,   ┬л┬╗   React       ,   ;</li>
<li>        ;</li>
<li>     ┬л ┬╗,      <strong> ,    </strong>;</li>
<li>    ,      .</li>
</ul><br>
<p>  ,       .  ,    .       ,        .    ?    . </p><br>
<p>   :</p><br>
<ol>
<li>  ,     ,      ,      ,    .            ,    . </li>
<li>,  ReactтАЩ    30        .      :        .</li>
<li>    ,     .</li>
<li>    .         .             ,    . </li>
<li>        .</li>
<li>   Performance    тАФ     .     CPU тАФ      ,     Intel i9.</li>
<li>     -  :    12тАУ20    тАУ .  ,   . </li>
<li>     ,   .        , ,         .      ,      .</li>
<li>   ,          ,     .   IE11    ,    .        70-  Edge  18- (  ).</li>
<li> WebGL           . -  ,   ,  -,   Firefox  linux,    .    .    тАФ  .     -, .    ,     ,  ┬л       ┬╗,     .</li>
</ol><br>
<p>,    :</p><br>
<ol>
<li>Firefox.  <em> </em> .  ,     WebGL,    тАФ     spread. FPS  Firefox     ,   Chrome. ,     ,    .</li>
<li>IPhone.  Safari     IE6  220         .         ,    ,    .    ,    ,   .     .           тАФ       - .</li>
<li>.   .        .    ,        ,       (, ,    ).  .</li>
<li> .       ,   ,      .   ,    ,      ,    ┬л┬╗       .</li>
<li>         (   ),     тАУ     ,        .       .</li>
</ol><br>
<p>   ,      ,     .      iOS, Android  Web       .</p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi498628/index.html">рдХреИрд╕реЗ PowerCLI рд▓рд┐рдкрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рд░реЙрдХреЗрдЯ рддреНрд╡рд░рдХ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП┬а</a></li>
<li><a href="../hi498630/index.html">рдПрдХрддрд╛ + рдбреЙрдЯреНрд╕ рдкрд░ рд╕реИрдХрдбрд╝реЛрдВ рд╣рдЬрд╛рд░реЛрдВ рдХрдгреЛрдВ рдХрд╛ рднреМрддрд┐рдХ рдЕрдиреБрдХрд░рдг</a></li>
<li><a href="../hi498632/index.html">рдПрдХ рдЦреВрдмрд╕реВрд░рдд рдореБрд▓реНрдЯреЛ рдХреЗ рд▓рд┐рдП рдкреЗрдкреНрдЯрд╛рдЗрдб</a></li>
<li><a href="../hi498634/index.html">рдПрдХ рдСрд░реНрдереЛрдкреЗрдбрд┐рд╕реНрдЯ рдХреЛ 11 рдмреЗрд╡рдХреВрдл рд╕рд╡рд╛рд▓ рдФрд░ рдПрдХ рдХрдВрдкреНрдпреВрдЯрд░ рдкрд░ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдФрд░ рди рдХреЗрд╡рд▓</a></li>
<li><a href="../hi498636/index.html">рдХреЛрд╣рд░реЗ рдореЗрдВ рдмрд┐рдВрджреБ рд░реЛрд╢рдиреА рдХреЗ рд▓рд┐рдП рд╕рд░рд▓ рдЫрд╛рдпрд╛рджрд╛рд░</a></li>
<li><a href="../hi498642/index.html">рдЧреАрдХ рдХреНрд▓рдм: рд╣рдордиреЗ DIY рдкреАрд╕реАрдмреА рдбрд┐рдЬрд╛рдЗрдирд░ рдХреЗ рд▓рд┐рдП рдХрд┐рдХрд╕реНрдЯрд╛рд░реНрдЯрд░ рдкрд░ $ 137,000 рдХреИрд╕реЗ рдЬреБрдЯрд╛рдП</a></li>
<li><a href="../hi498646/index.html">рдХреИрд╕реЗ рдлреНрд░реАрд▓рд╛рдВрд╕ рдиреЗ рдореБрдЭреЗ рдЕрдкрдиреА рдПрдЬреЗрдВрд╕реА рдЦреЛрд▓рдиреЗ рдореЗрдВ рдорджрдж рдХреА</a></li>
<li><a href="../hi498650/index.html">Svelte, рдПрдХ рд▓реБрдкреНрдд рд╣реЛрддреА рд░реВрдкрд░реЗрдЦрд╛ рдЬреЛ рдЕрднреА рднреА рдЧрд╛рдпрдм рдирд╣реАрдВ рд╣реБрдИ рдереА</a></li>
<li><a href="../hi498652/index.html">рдСрдмреНрдЬреЗрдХреНрдЯ рдбрд┐рдЯреЗрдХреНрд╢рди рдкрд╣рдЪрд╛рдиреЛ рдФрд░ рд░рд╛рдЬ рдХрд░реЛред рднрд╛рдЧ 2</a></li>
<li><a href="../hi498654/index.html">VPS / VDS рдХреНрдпрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдХреИрд╕реЗ рдЦрд░реАрджреЗрдВред рд╕рдмрд╕реЗ рд╕рдордЭрджрд╛рд░ рдирд┐рд░реНрджреЗрд╢</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>