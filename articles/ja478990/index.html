<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧑🏿‍🤝‍🧑🏼 🤸🏻 ☮️ S3、NFSを使用するクライアントと互換性のあるLeoFS分散フェイルセーフストレージ機能のインストール 🧀 ⚰️ 🏤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="私はルクソフト出身です。
 よるOpennet：LeoFSための分散フォールトトレラント貯蔵設備であるLeoFSのオブジェクトクライアントは、アマゾンS3のAPIおよびREST-APIを使用して、ならびにNFSサーバーとして動作モードをサポートするとの互換性は、。小さなオブジェクトと非常に大きなオブ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>S3、NFSを使用するクライアントと互換性のあるLeoFS分散フェイルセーフストレージ機能のインストール</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/478990/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私はルクソフト出身です。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
よる</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opennet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LeoFS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ための分散フォールトトレラント貯蔵設備である</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LeoFSの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オブジェクト</font><font style="vertical-align: inherit;">クライアントは、アマゾンS3のAPIおよびREST-APIを使用して、ならびにNFSサーバーとして動作モードをサポートするとの互換性は、。</font><font style="vertical-align: inherit;">小さなオブジェクトと非常に大きなオブジェクトの両方を保存するための最適化があり、組み込みのキャッシュメカニズムがあり、データセンター間でストレージのレプリケーションが可能です。</font><font style="vertical-align: inherit;">プロジェクトの目標の中には、重複の過剰な複製と単一障害点の排除による99.9999999％の信頼性の達成があります。</font><font style="vertical-align: inherit;">プロジェクトコードはErlangで記述されています。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LeoFSは3つのコンポーネントで構成されています。</font></font></p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LeoFSストレージ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -オブジェクトとメタデータの追加、取得、削除の操作を提供し、クライアント要求の複製、復元、およびキューイングを担当します。</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LeoFSゲートウェイ-HTTP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リクエストを処理し、REST-APIまたはS3-APIを使用してレスポンスをクライアントにリダイレクトし、最もリクエストされたデータをメモリとディスクにキャッシュします。</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LeoFSマネージャー</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -LeoFSゲートウェイとLeoFSストレージノードの動作を監視し、ノードの状態を監視し、チェックサムをチェックします。</font><font style="vertical-align: inherit;">データの整合性と高いストレージ可用性を保証します。</font></font></li>
</ul><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この投稿では、ansible-playbook、test S3、NFSを使用してLeofsをインストールします。</font></font></p><a name="habracut"></a><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あなたが公式のプレイブックを使用してLeoFSをインストールしようとすると、別のエラーがあなたを待っています：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2を</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">この投稿では、これらのエラーを回避するために必要なことを記述します。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ansible-playbookを実行する場所では、netcatをインストールする必要があります。</font></font></p><br>
<h4 id="primer-inventory"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在庫例</font></font></h4><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インベントリの例（hosts.sampleリポジトリ内）：</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs"># Please check roles/common/vars/leofs_releases for available versions<font></font>
[all:vars]<font></font>
leofs_version=1.4.3<font></font>
build_temp_path="/tmp/leofs_builder"<font></font>
build_install_path="/tmp/"<font></font>
build_branch="master"<font></font>
source="package"<font></font>
<font></font>
#[builder]<font></font>
#172.26.9.177<font></font>
<font></font>
# nodename of leo_manager_0 and leo_manager_1 are set at group_vars/all<font></font>
[leo_manager_0]<font></font>
172.26.9.176<font></font>
<font></font>
# nodename of leo_manager_0 and leo_manager_1 are set at group_vars/all<font></font>
[leo_manager_1]<font></font>
172.26.9.178<font></font>
<font></font>
[leo_storage]<font></font>
172.26.9.179 leofs_module_nodename=S0@172.26.9.179<font></font>
172.26.9.181 leofs_module_nodename=S0@172.26.9.181<font></font>
172.26.9.182 leofs_module_nodename=S0@172.26.9.182<font></font>
172.26.9.183 leofs_module_nodename=S0@172.26.9.183<font></font>
<font></font>
[leo_gateway]<font></font>
172.26.9.180 leofs_module_nodename=G0@172.26.9.180<font></font>
172.26.9.184 leofs_module_nodename=G0@172.26.9.184<font></font>
<font></font>
[leofs_nodes:children]<font></font>
leo_manager_0<font></font>
leo_manager_1<font></font>
leo_gateway<font></font>
leo_storage</code></pre></div></div><br>
<h4 id="podgotovka-serverov"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーバーの準備</font></font></h4><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selinuxを無効にします。</font><font style="vertical-align: inherit;">コミュニティがLeoFSのSelinuxポリシーを作成することを願っています。</font></font></p><br>
<pre><code class="plaintext hljs">    - name: Install libselinux as prerequisite for SELinux Ansible module<font></font>
      yum:<font></font>
        name: "{{item}}"<font></font>
        state: latest<font></font>
      with_items:<font></font>
        - libselinux-python<font></font>
        - libsemanage-python<font></font>
<font></font>
    - name: Disable SELinux at next reboot<font></font>
      selinux:<font></font>
        state: disabled<font></font>
<font></font>
    - name: Set SELinux in permissive mode until the machine is rebooted<font></font>
      command: setenforce 0<font></font>
      ignore_errors: true<font></font>
      changed_when: false<font></font>
</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インストール</font></font><code>netcat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>redhat-lsb-core</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ここで</font></a><font style="vertical-align: inherit;"> OSバージョンを判別する</font></font><code>netcat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ため</font></font><code>leofs-adm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font></font><code>redhat-lsb-core</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p><br>
<pre><code class="plaintext hljs">    - name: Install Packages<font></font>
      yum: name={{ item }} state=present<font></font>
      with_items:<font></font>
        - nmap-ncat<font></font>
        - redhat-lsb-core</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーザーのleofsを作成してwheelグループに追加する</font></font></p><br>
<pre><code class="plaintext hljs">    - name: Create user leofs<font></font>
      group:<font></font>
        name: leofs<font></font>
        state: present<font></font>
<font></font>
    - name: Allow 'wheel' group to have passwordless sudo<font></font>
      lineinfile:<font></font>
        dest: /etc/sudoers<font></font>
        state: present<font></font>
        regexp: '^%wheel'<font></font>
        line: '%wheel ALL=(ALL) NOPASSWD: ALL'<font></font>
        validate: 'visudo -cf %s'<font></font>
<font></font>
    - name: Add the user 'leofs' to group 'wheel'<font></font>
      user:<font></font>
        name: leofs<font></font>
        groups: wheel<font></font>
        append: yes</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erlangをインストールする</font></font></p><br>
<pre><code class="plaintext hljs">    - name: Remote erlang-20.3.8.23-1.el7.x86_64.rpm install with yum<font></font>
      yum: name=https://github.com/rabbitmq/erlang-rpm/releases/download/v20.3.8.23/erlang-20.3.8.23-1.el7.x86_64.rpm<font></font>
</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修正されたansibleプレイブックの完全版は、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">https</font></a><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//github.com/patsevanton/leofs_ansibleにあります。</font></font></a></p><br>
<h4 id="ustanovka-konfigurirovanie-zapusk"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インストール、構成、開始</font></font></h4><br>
<p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">https://github.com/leo-project/leofs_ansible</a>  build_leofs.yml</p><br>
<pre><code class="bash hljs"><span class="hljs-comment">## Install LeoFS</span><font></font>
$ ansible-playbook -i hosts install_leofs.yml<font></font>
<font></font>
<span class="hljs-comment">## Config LeoFS</span><font></font>
$ ansible-playbook -i hosts config_leofs.yml<font></font>
<font></font>
<span class="hljs-comment">## Start LeoFS</span>
$ ansible-playbook -i hosts start_leofs.yml</code></pre><br>
<h4 id="proveryaem-status-klastera-na-primary-leomanager">    Primary LeoManager</h4><br>
<pre><code class="bash hljs">leofs-adm status</code></pre><br>
<p>Primary  Secondary     ansible-playbook</p><br>
<p><img src="https://habrastorage.org/webt/do/kp/oj/dokpoj8lmzwh3bmakpxx9anc-4i.png"></p><br>
<p><img src="https://habrastorage.org/webt/ku/0o/bt/ku0obtn6ezvfghyfai01zldeaws.png"></p><br>
<div class="spoiler"><b class="spoiler_title">   </b><div class="spoiler_text"><pre><code class="bash hljs"> [System Confiuration]<font></font>
-----------------------------------+----------<font></font>
 Item                              | Value    <font></font>
-----------------------------------+----------<font></font>
 Basic/Consistency level<font></font>
-----------------------------------+----------<font></font>
                    system version | 1.4.3<font></font>
                        cluster Id | leofs_1<font></font>
                             DC Id | dc_1<font></font>
                    Total replicas | 2<font></font>
          number of successes of R | 1<font></font>
          number of successes of W | 1<font></font>
          number of successes of D | 1<font></font>
 number of rack-awareness replicas | 0<font></font>
                         ring size | 2^128<font></font>
-----------------------------------+----------<font></font>
 Multi DC replication settings<font></font>
-----------------------------------+----------<font></font>
 [mdcr] max number of joinable DCs | 2<font></font>
 [mdcr] total replicas per a DC    | 1<font></font>
 [mdcr] number of successes of R   | 1<font></font>
 [mdcr] number of successes of W   | 1<font></font>
 [mdcr] number of successes of D   | 1<font></font>
-----------------------------------+----------<font></font>
 Manager RING <span class="hljs-built_in">hash</span><font></font>
-----------------------------------+----------<font></font>
                 current ring-hash | a0314afb<font></font>
                previous ring-hash | a0314afb<font></font>
-----------------------------------+----------<font></font>
<font></font>
 [State of Node(s)]<font></font>
-------+----------------------+--------------+---------+----------------+----------------+----------------------------<font></font>
 <span class="hljs-built_in">type</span>  |         node         |    state     | rack id |  current ring  |   prev ring    |          updated at         <font></font>
-------+----------------------+--------------+---------+----------------+----------------+----------------------------<font></font>
  S    | S0@172.26.9.179      | running      |         | a0314afb       | a0314afb       | 2019-12-05 10:33:47 +0000<font></font>
  S    | S0@172.26.9.181      | running      |         | a0314afb       | a0314afb       | 2019-12-05 10:33:47 +0000<font></font>
  S    | S0@172.26.9.182      | running      |         | a0314afb       | a0314afb       | 2019-12-05 10:33:47 +0000<font></font>
  S    | S0@172.26.9.183      | attached     |         |                |                | 2019-12-05 10:33:58 +0000<font></font>
  G    | G0@172.26.9.180      | running      |         | a0314afb       | a0314afb       | 2019-12-05 10:33:49 +0000<font></font>
  G    | G0@172.26.9.184      | running      |         | a0314afb       | a0314afb       | 2019-12-05 10:33:49 +0000<font></font>
-------+----------------------+--------------+---------+----------------+----------------+----------------------------</code></pre></div></div><br>
<h4 id="sozdaem-yuzera"> </h4><br>
<p>  leofs:</p><br>
<pre><code class="bash hljs">leofs-adm create-user leofs leofs<font></font>
<font></font>
  access-key-id: 9c2615f32e81e6a1caf5<font></font>
  secret-access-key: 8aaaa35c1ad78a2cbfa1a6cd49ba8aaeb3ba39eb</code></pre><br>
<p> :</p><br>
<pre><code class="bash hljs">leofs-adm get-users<font></font>
user_id     | role_id | access_key_id          | created_at                <font></font>
------------+---------+------------------------+---------------------------<font></font>
_test_leofs | 9       | 05236                  | 2019-12-02 06:56:49 +0000<font></font>
leofs       | 1       | 9c2615f32e81e6a1caf5   | 2019-12-02 10:43:29 +0000</code></pre><br>
<h4 id="sozdaem-bucket"> Bucket</h4><br>
<p> bucket</p><br>
<pre><code class="bash hljs">leofs-adm add-bucket leofs 9c2615f32e81e6a1caf5<font></font>
OK</code></pre><br>
<p> bucket:</p><br>
<pre><code class="bash hljs"> leofs-adm get-buckets<font></font>
cluster id   | bucket   | owner  | permissions      | created at                <font></font>
-------------+----------+--------+------------------+---------------------------<font></font>
leofs_1      | leofs    | leofs  | Me(full_control) | 2019-12-02 10:44:02 +0000</code></pre><br>
<h4 id="konfigurirovanie-s3cmd"> s3cmd</h4><br>
<p>  <code>HTTP Proxy server name</code>  IP  Gateway</p><br>
<pre><code class="bash hljs">s3cmd --configure <font></font>
<font></font>
Enter new values or accept defaults <span class="hljs-keyword">in</span> brackets with Enter.<font></font>
Refer to user manual <span class="hljs-keyword">for</span> detailed description of all options.<font></font>
<font></font>
Access key and Secret key are your identifiers <span class="hljs-keyword">for</span> Amazon S3. Leave them empty <span class="hljs-keyword">for</span> using the env variables.<font></font>
Access Key [9c2615f32e81e6a1caf5]: <font></font>
Secret Key [8aaaa35c1ad78a2cbfa1a6cd49ba8aaeb3ba39eb]: <font></font>
Default Region [US]: <font></font>
<font></font>
Use <span class="hljs-string">"s3.amazonaws.com"</span> <span class="hljs-keyword">for</span> S3 Endpoint and not modify it to the target Amazon S3.<font></font>
S3 Endpoint [s3.amazonaws.com]: <font></font>
<font></font>
Use <span class="hljs-string">"%(bucket)s.s3.amazonaws.com"</span> to the target Amazon S3. <span class="hljs-string">"%(bucket)s"</span> and <span class="hljs-string">"%(location)s"</span> vars can be used
<span class="hljs-keyword">if</span> the target S3 system supports dns based buckets.<font></font>
DNS-style bucket+hostname:port template <span class="hljs-keyword">for</span> accessing a bucket [%(bucket)s.s3.amazonaws.com]: leofs<font></font>
<font></font>
Encryption password is used to protect your files from reading<font></font>
by unauthorized persons <span class="hljs-keyword">while</span> <span class="hljs-keyword">in</span> transfer to S3<font></font>
Encryption password: <font></font>
Path to GPG program [/usr/bin/gpg]: <font></font>
<font></font>
When using secure HTTPS protocol all communication with Amazon S3<font></font>
servers is protected from 3rd party eavesdropping. This method is<font></font>
slower than plain HTTP, and can only be proxied with Python 2.7 or newer<font></font>
Use HTTPS protocol [No]: <font></font>
<font></font>
On some networks all internet access must go through a HTTP proxy.<font></font>
Try setting it here <span class="hljs-keyword">if</span> you can<span class="hljs-string">'t connect to S3 directly
HTTP Proxy server name [172.26.9.180]: 
HTTP Proxy server port [8080]: 

New settings:
  Access Key: 9c2615f32e81e6a1caf5
  Secret Key: 8aaaa35c1ad78a2cbfa1a6cd49ba8aaeb3ba39eb
  Default Region: US
  S3 Endpoint: s3.amazonaws.com
  DNS-style bucket+hostname:port template for accessing a bucket: leofs
  Encryption password: 
  Path to GPG program: /usr/bin/gpg
  Use HTTPS protocol: False
  HTTP Proxy server name: 172.26.9.180
  HTTP Proxy server port: 8080

Test access with supplied credentials? [Y/n] Y
Please wait, attempting to list all buckets...
Success. Your access key and secret key worked fine :-)

Now verifying that encryption works...
Not configured. Never mind.

Save settings? [y/N] y
Configuration saved to '</span>/home/user/.s3cfg<span class="hljs-string">'</span></code></pre><br>
<p>     ERROR: S3 error: 403 (AccessDenied): Access Denied:</p><br>
<pre><code class="bash hljs">s3cmd put test.py s3://leofs/<font></font>
upload: <span class="hljs-string">'test.py'</span> -&gt; <span class="hljs-string">'s3://leofs/test.py'</span>  [1 of 1]<font></font>
 382 of 382   100% <span class="hljs-keyword">in</span>    0s     3.40 kB/s  <span class="hljs-keyword">done</span>
ERROR: S3 error: 403 (AccessDenied): Access Denied</code></pre><br>
<p>    s3cmd  signature_v2  True.    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">issue</a>.</p><br>
<p> signature_v2  False,     :</p><br>
<pre><code class="bash hljs">WARNING: Retrying failed request: /?delimiter=%2F (getaddrinfo() argument 2 must be <span class="hljs-built_in">integer</span> or string)<font></font>
WARNING: Waiting 3 sec...<font></font>
WARNING: Retrying failed request: /?delimiter=%2F (getaddrinfo() argument 2 must be <span class="hljs-built_in">integer</span> or string)<font></font>
WARNING: Waiting 6 sec...<font></font>
ERROR: Test failed: Request failed <span class="hljs-keyword">for</span>: /?delimiter=%2F</code></pre><br>
<h4 id="testirovanie-zagruzki"> </h4><br>
<p>  1</p><br>
<pre><code class="bash hljs">fallocate -l 1GB 1gb</code></pre><br>
<p>   Leofs</p><br>
<pre><code class="bash hljs">time s3cmd put 1gb s3://leofs/<font></font>
real    0m19.099s<font></font>
user    0m7.855s<font></font>
sys 0m1.620s</code></pre><br>
<h4 id="statistika"></h4><br>
<p>leofs-adm du  1 :</p><br>
<pre><code class="bash hljs">leofs-adm du S0@172.26.9.179<font></font>
 active number of objects: 156<font></font>
  total number of objects: 156<font></font>
   active size of objects: 602954495<font></font>
    total size of objects: 602954495<font></font>
     ratio of active size: 100.0%<font></font>
    last compaction start: ____-__-__ __:__:__<font></font>
      last compaction end: ____-__-__ __:__:__</code></pre><br>
<p>     .</p><br>
<p>    .<br>
leofs-adm whereis leofs/1gb</p><br>
<pre><code class="bash hljs">leofs-adm whereis leofs/1gb<font></font>
-------+----------------------+--------------------------------------+------------+--------------+----------------+----------------+----------------+----------------------------<font></font>
 del?  |         node         |             ring address             |    size    |   checksum   |  has children  |  total chunks  |     clock      |             when            <font></font>
-------+----------------------+--------------------------------------+------------+--------------+----------------+----------------+----------------+----------------------------<font></font>
       | S0@172.26.9.181      | 657a9f3a3db822a7f1f5050925b26270     |    976563K |   a4634eea55 | <span class="hljs-literal">true</span>           |             64 | 598f2aa976a4f  | 2019-12-05 10:48:15 +0000<font></font>
       | S0@172.26.9.182      | 657a9f3a3db822a7f1f5050925b26270     |    976563K |   a4634eea55 | <span class="hljs-literal">true</span>           |             64 | 598f2aa976a4f  | 2019-12-05 10:48:15 +0000</code></pre><br>
<h4 id="aktiviruem-nfs"> NFS</h4><br>
<p> NFS   Leo Gateway 172.26.9.184. </p><br>
<p>     nfs-utils</p><br>
<pre><code class="bash hljs">sudo yum install nfs-utils</code></pre><br>
<p>     <code>/usr/local/leofs/current/leo_gateway/etc/leo_gateway.conf</code></p><br>
<pre><code class="bash hljs">protocol = nfs</code></pre><br>
<p>  172.26.9.184  rpcbind  leofs-gateway</p><br>
<pre><code class="bash hljs">sudo service rpcbind start<font></font>
sudo service leofs-gateway restart</code></pre><br>
<p>    leo_manager  bucket  NFS       NFS</p><br>
<pre><code class="bash hljs">leofs-adm add-bucket <span class="hljs-built_in">test</span> 05236<font></font>
leofs-adm gen-nfs-mnt-key <span class="hljs-built_in">test</span> 05236 ip--nfs-</code></pre><br>
<h4 id="podklyuchenie-k-nfs">  NFS</h4><br>
<pre><code class="bash hljs">sudo mkdir /mnt/leofs
<span class="hljs-comment">## for Linux - "sudo mount -t nfs -o nolock &lt;host&gt;:/&lt;bucket&gt;/&lt;token&gt; &lt;dir&gt;"</span><font></font>
sudo mount -t nfs -o nolock ip--nfs-------gateway:/bucket/access_key_id/---gen-nfs-mnt-key /mnt/leofs<font></font>
sudo mount -t nfs -o nolock 172.26.9.184:/<span class="hljs-built_in">test</span>/05236/bb5034f0c740148a346ed663ca0cf5157efb439f /mnt/leofs</code></pre><br>
<h4 id="prosmotr-diskovogo-prostanstva-cherez-nfs-klient">    NFS </h4><br>
<p>  c     storage   40 (3  running, 1  attached):</p><br>
<pre><code class="bash hljs">df -hP<font></font>
Filesystem                                                         Size  Used Avail Use% Mounted on<font></font>
172.26.9.184:/<span class="hljs-built_in">test</span>/05236/e7298032e78749149dd83a1e366afb328811c95b   60G  3.6G   57G   6% /mnt/leofs</code></pre><br>
<h4 id="ustanovka-leofs-s-6-storage-nodami"> LeoFS  6 storage .</h4><br>
<div class="spoiler"><b class="spoiler_title">Inventory ( builder):</b><div class="spoiler_text"><pre><code class="bash hljs"><span class="hljs-comment"># Please check roles/common/vars/leofs_releases for available versions</span><font></font>
[all:vars]<font></font>
leofs_version=1.4.3<font></font>
build_temp_path=<span class="hljs-string">"/tmp/leofs_builder"</span>
build_install_path=<span class="hljs-string">"/tmp/"</span>
build_branch=<span class="hljs-string">"master"</span>
<span class="hljs-built_in">source</span>=<span class="hljs-string">"package"</span><font></font>
<font></font>
<span class="hljs-comment"># nodename of leo_manager_0 and leo_manager_1 are set at group_vars/all</span><font></font>
[leo_manager_0]<font></font>
172.26.9.177<font></font>
<font></font>
<span class="hljs-comment"># nodename of leo_manager_0 and leo_manager_1 are set at group_vars/all</span><font></font>
[leo_manager_1]<font></font>
172.26.9.176<font></font>
<font></font>
[leo_storage]<font></font>
172.26.9.178 leofs_module_nodename=S0@172.26.9.178<font></font>
172.26.9.179 leofs_module_nodename=S0@172.26.9.179<font></font>
172.26.9.181 leofs_module_nodename=S0@172.26.9.181<font></font>
172.26.9.182 leofs_module_nodename=S0@172.26.9.182<font></font>
172.26.9.183 leofs_module_nodename=S0@172.26.9.183<font></font>
172.26.9.185 leofs_module_nodename=S0@172.26.9.185<font></font>
<font></font>
[leo_gateway]<font></font>
172.26.9.180 leofs_module_nodename=G0@172.26.9.180<font></font>
172.26.9.184 leofs_module_nodename=G0@172.26.9.184<font></font>
<font></font>
[leofs_nodes:children]<font></font>
leo_manager_0<font></font>
leo_manager_1<font></font>
leo_gateway<font></font>
leo_storage</code></pre></div></div><br>
<h4 id="vyvod-leofs-adm-status"> leofs-adm status</h4><br>
<div class="spoiler"><b class="spoiler_title"> leofs-adm status</b><div class="spoiler_text"><pre><code class="bash hljs"> [System Confiuration]<font></font>
-----------------------------------+----------<font></font>
 Item                              | Value    <font></font>
-----------------------------------+----------<font></font>
 Basic/Consistency level<font></font>
-----------------------------------+----------<font></font>
                    system version | 1.4.3<font></font>
                        cluster Id | leofs_1<font></font>
                             DC Id | dc_1<font></font>
                    Total replicas | 2<font></font>
          number of successes of R | 1<font></font>
          number of successes of W | 1<font></font>
          number of successes of D | 1<font></font>
 number of rack-awareness replicas | 0<font></font>
                         ring size | 2^128<font></font>
-----------------------------------+----------<font></font>
 Multi DC replication settings<font></font>
-----------------------------------+----------<font></font>
 [mdcr] max number of joinable DCs | 2<font></font>
 [mdcr] total replicas per a DC    | 1<font></font>
 [mdcr] number of successes of R   | 1<font></font>
 [mdcr] number of successes of W   | 1<font></font>
 [mdcr] number of successes of D   | 1<font></font>
-----------------------------------+----------<font></font>
 Manager RING <span class="hljs-built_in">hash</span><font></font>
-----------------------------------+----------<font></font>
                 current ring-hash | d8ff465e<font></font>
                previous ring-hash | d8ff465e<font></font>
-----------------------------------+----------<font></font>
<font></font>
 [State of Node(s)]<font></font>
-------+----------------------+--------------+---------+----------------+----------------+----------------------------<font></font>
 <span class="hljs-built_in">type</span>  |         node         |    state     | rack id |  current ring  |   prev ring    |          updated at         <font></font>
-------+----------------------+--------------+---------+----------------+----------------+----------------------------<font></font>
  S    | S0@172.26.9.178      | running      |         | d8ff465e       | d8ff465e       | 2019-12-06 05:18:29 +0000<font></font>
  S    | S0@172.26.9.179      | running      |         | d8ff465e       | d8ff465e       | 2019-12-06 05:18:29 +0000<font></font>
  S    | S0@172.26.9.181      | running      |         | d8ff465e       | d8ff465e       | 2019-12-06 05:18:30 +0000<font></font>
  S    | S0@172.26.9.182      | running      |         | d8ff465e       | d8ff465e       | 2019-12-06 05:18:29 +0000<font></font>
  S    | S0@172.26.9.183      | running      |         | d8ff465e       | d8ff465e       | 2019-12-06 05:18:29 +0000<font></font>
  S    | S0@172.26.9.185      | running      |         | d8ff465e       | d8ff465e       | 2019-12-06 05:18:29 +0000<font></font>
  G    | G0@172.26.9.180      | running      |         | d8ff465e       | d8ff465e       | 2019-12-06 05:18:31 +0000<font></font>
  G    | G0@172.26.9.184      | running      |         | d8ff465e       | d8ff465e       | 2019-12-06 05:18:31 +0000<font></font>
-------+----------------------+--------------+---------+----------------+----------------+----------------------------</code></pre></div></div><br>
<p>  c     storage   40 (6  running):</p><br>
<pre><code class="bash hljs">df -hP<font></font>
Filesystem                                                         Size  Used Avail Use% Mounted on<font></font>
172.26.9.184:/<span class="hljs-built_in">test</span>/05236/e7298032e78749149dd83a1e366afb328811c95b  120G  3.6G  117G   3% /mnt/leofs</code></pre><br>
<h4 id="esli-ispolzuetsya-5-nod-storage">  5  storage</h4><br>
<pre><code class="bash hljs">[leo_storage]<font></font>
172.26.9.178 leofs_module_nodename=S0@172.26.9.178<font></font>
172.26.9.179 leofs_module_nodename=S1@172.26.9.179<font></font>
172.26.9.181 leofs_module_nodename=S2@172.26.9.181<font></font>
172.26.9.182 leofs_module_nodename=S3@172.26.9.182<font></font>
172.26.9.183 leofs_module_nodename=S4@172.26.9.183</code></pre><br>
<pre><code class="bash hljs">df -hP<font></font>
172.26.9.184:/<span class="hljs-built_in">test</span>/05236/e7298032e78749149dd83a1e366afb328811c95b  100G  3.0G   97G   3% /mnt/leofs</code></pre><br>
<h4 id="logi"></h4><br>
<p>    <code>/usr/local/leofs/current/*/log</code></p><br>
<h4 id="esli-vy-budete-ustanavlivatnastraivat-leofs-vruchnuyu-to-vozmozhno-stolknetes-so-sleduyuschimi-oshibkami">   / Leofs ,      .</h4><br>
<h5 id="error-mnesia-is-not-available">[ERROR] Mnesia is not available</h5><br>
<p>  systemctl start leofs-manager-master</p><br>
<pre><code class="bash hljs">leofs-adm status<font></font>
[ERROR] Mnesia is not available</code></pre><br>
<p>  systemctl start leofs-manager-slave  leo_manager_1</p><br>
<h5 id="ne-startuet-leofs-storage">  leofs-storage.</h5><br>
<p>    leofs-manager-master  leofs-manager-slave  leofs-adm status  .</p><br>
<h5 id="attached-nodes-less-than--of-replicas">Attached nodes less than # of replicas</h5><br>
<p>  leofs-adm start     :</p><br>
<pre><code class="bash hljs">leofs-adm start<font></font>
[ERROR] Attached nodes less than <span class="hljs-comment"># of replicas</span></code></pre><br>
<p>  Storage . leofs-adm status    2 Storage .    Storage  2.</p><br>
<h5 id="leofs-adm-status-pokazyvaet-attached-ostalnye-running">leofs-adm status  attached,  running.</h5><br>
<p>  </p><br>
<pre><code class="bash hljs">leofs-adm rebalance</code></pre><br>
<h5 id="posle-starta-leofs-gateway-vy-ne-vidite-nodu-gateway-v-leofs-adm-status">  leofs-gateway,     Gateway  leofs-adm status</h5><br>
<p>  leofs-adm</p><br>
<pre><code class="bash hljs">leofs-adm start</code></pre><br>
<h5 id="couldnt-connect-to-leofs-manager-na-slave-uzle">couldn't connect to LeoFS Manager  Slave </h5><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（デフォルトでは、leofs-ADMは、スレーブノード上で動作していない！]（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Https://leo-project.net/leofs/docs/issues/documentation-issues/</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></p><br>
<h3 id="nagruzochnoe-testirovanie"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ストレステスト</font></font></h3><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テストは、次の構成の2つのノードで行われます。</font></font></p><br>
<pre><code class="bash hljs">CPU: Single Core Intel Core (Broadwell) (-MCP-) speed: 2295 MHz Kernel: 3.10.0-862.3.2.el7.x86_64 x86_64 Up: 1h 08m <font></font>
Mem: 1023.8/1999.6 MiB (51.2%) Storage: 10.00 GiB (43.5% used) Procs: 98 Shell: bash 4.2.46 inxi: 3.0.37</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テストのために、小さなディスク</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
を見て</font><font style="vertical-align: inherit;">みましょう。</font><font style="vertical-align: inherit;">両方のノードで、9.4Gおよび5.9Gの空き容量のディスクが表示されます。</font></font></p><br>
<pre><code class="bash hljs">df -hP<font></font>
Filesystem      Size  Used Avail Use% Mounted on<font></font>
/dev/vda1       9.4G  5.9G  3.1G  66% /</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テレグラムチャネル：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDSおよびクラスターFS</font></font></a></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja478980/index.html">Azure SDK for .NET：難しいバグ検索のストーリー</a></li>
<li><a href="../ja478982/index.html">私がイロナマスクを信じたように。そして再び月に着くとき</a></li>
<li><a href="../ja478984/index.html">TimTam-ユニークなチップ加熱機能を備えた新世代のパーカッションマッサージャー</a></li>
<li><a href="../ja478986/index.html">Yandexはレトロゲームへの人気投票を開始しました。Retro Games Battle 2019のファイナリスト</a></li>
<li><a href="../ja478988/index.html">ヴェネツィア：裸の岩のペアで野生の利益</a></li>
<li><a href="../ja478992/index.html">ITにおける生活の恐怖と喜びの欠如</a></li>
<li><a href="../ja478994/index.html">ジャーマンポストは月曜に仕事を遅くして休む予定</a></li>
<li><a href="../ja478996/index.html">仕事はオオカミではない、パート4。経験豊富な従業員：燃え尽きて、あきらめない方法</a></li>
<li><a href="../ja478998/index.html">なぜ常に黄金比を見たいのですか？C ++ニューラルネットワークを使用した（失敗した）進化的分析の試み</a></li>
<li><a href="../ja479000/index.html">14歳のParallelsインターンシップ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>