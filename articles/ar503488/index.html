<!doctype html>
<html class="no-js" lang="ar">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚃 👩🏿‍🚀 🀄️ أفضل ممارسات Kubernetes. تعطيل الإنهاء الصحيح 👧🏻 👩🏽‍⚕️ 🛠️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="أفضل ممارسات Kubernetes. إنشاء 
 أفضل الممارسات Kubernetes حاويات صغيرة . منظمة Kubernetes مع 
 مساحة اسم أفضل ممارسات Kubernetes . اختبار الجدوى Kube...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>أفضل ممارسات Kubernetes. تعطيل الإنهاء الصحيح</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/503488/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">أفضل ممارسات Kubernetes. إنشاء </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">أفضل الممارسات Kubernetes </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">حاويات صغيرة </font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">. منظمة Kubernetes مع </font></a></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">مساحة اسم أفضل ممارسات </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">Kubernetes </font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">. اختبار الجدوى Kubernetes مع اختبارات الاستعداد والحيوية </font></a></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">أفضل الممارسات </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">Kubernetes </font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">. تكوين الطلبات وحدود الموارد من</font></a></font><br>
<br>
<img src="https://habrastorage.org/webt/tm/pw/un/tmpwunqsjdjy_abzbl8c0t-exzo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
النقاط المهمة في تشغيل الأنظمة الموزعة معالجة حالات الفشل. يساعد Kubernetes في ذلك باستخدام وحدات التحكم التي تراقب حالة النظام الخاص بك وإعادة تشغيل الخدمات التي توقفت عن العمل. ومع ذلك ، يمكن لـ Kubernetes إغلاق تطبيقاتك بالقوة لضمان استمرارية النظام بشكل عام. في هذه السلسلة ، سنلقي نظرة على كيفية مساعدة Kubernetes في القيام بعملها بكفاءة أكبر وتقليل وقت تعطل التطبيق.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
قبل استخدام الحاويات ، تم تشغيل معظم التطبيقات على أجهزة افتراضية أو مادية. إذا تعطل التطبيق أو تعطل ، فقد استغرق الأمر وقتًا طويلاً لإزالة المهمة الجارية وإعادة تنزيل البرنامج. في أسوأ الحالات ، كان على شخص ما حل هذه المشكلة يدويًا في الليل ، في أكثر الأوقات غير المناسبة. إذا قامت 1-2 آلة عمل فقط بأداء مهمة مهمة ، فهذا العطل غير مقبول تمامًا. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لذلك ، بدلاً من إعادة التشغيل يدويًا ، بدأوا في استخدام المراقبة على مستوى العملية لإعادة تشغيل التطبيق تلقائيًا في حالة إنهاء الطوارئ. إذا تعطل البرنامج ، تلتقط عملية المراقبة رمز الإنهاء وتعيد تشغيل الخادم. مع ظهور أنظمة مثل Kubernetes ، تم دمج هذا النوع من الاستجابة لأعطال النظام ببساطة في البنية التحتية.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
تستخدم Kubernetes حلقة الأحداث "ملاحظة - الالتزام بالاختلافات - تنفيذ الإجراءات" لضمان استمرار تشغيل الموارد على طول الطريق من الحاويات إلى العقد نفسها. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6n/rw/f9/6nrwf9r4k54zb99ghrykicqtc78.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
هذا يعني أنك لم تعد بحاجة إلى بدء مراقبة العملية يدويًا. إذا فشل أحد الموارد في فحص الصحة ، فستوفر Kubernetes ببساطة بديلًا تلقائيًا. لا تقوم Kubernetes بأكثر من مجرد مراقبة أعطال التطبيق الخاص بك. يمكنه إنشاء المزيد من نسخ التطبيق للعمل على أجهزة متعددة ، أو تحديث التطبيق ، أو تشغيل إصدارات متعددة من تطبيقك في نفس الوقت.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لذلك ، هناك العديد من الأسباب التي تجعل Kubernetes تقاطع حاوية صحية تمامًا. على سبيل المثال ، إذا قمت بترقية عملية النشر الخاصة بك ، فسيقوم Kubernetes بإيقاف القرون القديمة ببطء أثناء إطلاق أجهزة جديدة. إذا قمت بفصل عقدة ، ستنهي Kubernetes جميع المداخن في تلك العقدة. أخيرًا ، إذا نفدت الموارد من العقدة ، فسوف تقوم Kubernetes بتعطيل جميع القرون لتحرير هذه الموارد. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لذلك ، من المهم جدًا أن يتوقف تطبيقك عن العمل بأقل تأثير على المستخدم النهائي والحد الأدنى من وقت الاسترداد. هذا يعني أنه قبل قطع الاتصال ، يجب عليه حفظ جميع البيانات التي يجب حفظها ، وإغلاق جميع اتصالات الشبكة ، وإكمال العمل المتبقي ، ولدي الوقت لإكمال المهام العاجلة الأخرى.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
من الناحية العملية ، هذا يعني أن تطبيقك يجب أن يكون قادرًا على معالجة رسالة SIGTERM - إشارة إنهاء العملية ، وهي الإشارة الافتراضية لأداة القتل في نظام تشغيل عائلة Unix. بعد تلقي هذه الرسالة ، يجب أن يفصل التطبيق. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
بعد أن قررت Kubernetes إكمال اللوحة ، وقعت سلسلة كاملة من الأحداث. دعونا نلقي نظرة على كل خطوة تتخذها Kubernetes عند اكتمال الحاوية أو الموقد. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لنفترض أننا نريد إكمال أحد المواقد. عند هذه النقطة ، ستتوقف عن استقبال حركة مرور جديدة - لن تتأثر الحاويات التي تعمل في الموقد ، ولكن سيتم حظر جميع حركة المرور الجديدة.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sw/go/iq/swgoiqnkzgrbf1g9ikbyc7kq6ym.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
دعونا نلقي نظرة على ربط preStop - هذا أمر خاص أو طلب HTTP يتم إرساله إلى حاويات في الموقد. إذا لم يتم إيقاف تشغيل التطبيق الخاص بك بشكل صحيح عند تلقي SIGTERM ، فيمكنك استخدام preStop للخروج بشكل صحيح. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rc/rk/a-/rcrka-cajxoq76gtcdaopdabeak.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
معظم البرامج عندما تتلقى إشارة SIGTERM تنتهي بشكل صحيح ، ولكن إذا كنت تستخدم رمز جهة خارجية أو نظام ما لا يمكنك التحكم فيه بالكامل ، فإن خطاف preStop هو طريقة رائعة للتسبب في إيقاف تشغيل آمن دون تغيير التطبيق.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
بعد تنفيذ هذا الخطاف ، سترسل Kubernetes إشارة SIGTERM إلى الحاويات الموجودة في الموقد ، والتي ستعلمهم بأنه سيتم قطع اتصالهم قريبًا. بعد تلقي هذه الإشارة ، ستنتقل الشفرة إلى عملية الإغلاق. قد تتضمن هذه العملية إيقاف أي اتصالات طويلة الأمد ، مثل الاتصال بقاعدة بيانات أو دفق WebSocket ، وحفظ الحالة الحالية ، وما شابه. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
حتى إذا كنت تستخدم خطاف preStop ، فمن المهم جدًا التحقق مما يحدث بالضبط مع تطبيقك عندما ترسله إشارة SIGTERM ، وكيف تتصرف بطريقة تجعل الأحداث أو التغييرات في تشغيل النظام بسبب إيقاف الموقد ليست مفاجأة لك.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في هذه المرحلة ، قبل اتخاذ المزيد من الإجراءات ، ستنتظر Kubernetes وقتًا محددًا ، يسمى إنهاء gracePeriodSecond ، أو الفترة التي يتم فيها إيقاف تشغيلها بشكل صحيح عندما تتلقى إشارة SIGTERM. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/_9/uq/gj/_9uqgjt61tblfxn6kgbrjnh3zs8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
بشكل افتراضي ، هذه الفترة 30 ثانية. من المهم ملاحظة أنه يدوم بالتوازي مع خطاف preStop وإشارة SIGTERM. لن تنتظر Kubernetes انتهاء خطاف preStop و SIGTERM - إذا خرج تطبيقك قبل انتهاء صلاحية TerminationGracePeriod ، ستنتقل Kubernetes على الفور إلى الخطوة التالية. لذلك ، تحقق من أن قيمة هذه الفترة بالثواني ليست أقل من الوقت المطلوب لإيقاف الموقد بشكل صحيح ، وإذا تجاوزت 30 ثانية ، فقم بزيادة الفترة إلى القيمة المطلوبة في YAML. في المثال أعلاه ، 60s.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
وأخيرًا ، الخطوة الأخيرة - إذا استمرت الحاويات في العمل بعد انتهاء صلاحية GracePeriod ، فسوف ترسل إشارة SIGKILL وسيتم حذفها بالقوة. </font><font style="vertical-align: inherit;">عند هذه النقطة ، ستقوم Kubernetes أيضًا بتنظيف جميع الكائنات الأخرى. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pt/zp/t9/ptzpt92xzjuszc3tw0mwhgbp80m.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
تقوم Kubernetes بإغلاق المداخن لأسباب عديدة ، لذا تأكد من أنه في أي حال سيتم استكمال طلبك بشكل صحيح لضمان التشغيل المستقر للخدمة. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">أفضل ممارسات Kubernetes. </font><font style="vertical-align: inherit;">رسم خرائط الخدمات الخارجية</font></font></a><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/Z_l_kE1MDTc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">القليل من الدعاية :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
أشكركم على البقاء معنا. هل تحب مقالاتنا؟ هل تريد رؤية مواد أكثر إثارة للاهتمام؟ ادعمنا عن طريق تقديم طلب أو التوصية لأصدقائك </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS القائم على السحابة للمطورين من $ 4.99</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ، وهو </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">نظير </font></a></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">فريد من نوعه لخوادم مستوى الدخول التي اخترعناها لك: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الحقيقة الكاملة عن VPS (KVM) E5-2697 v3 (6 نوى) 10GB DDR4 480GB SSD 1Gbps من $ 19 أو كيفية تقسيم الخادم؟</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (تتوفر الخيارات مع RAID1 و RAID10 ، حتى 24 مركزًا و 40 جيجابايت DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd أرخص مرتين في مركز بيانات Equinix Tier IV في أمستردام؟</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> فقط لدينا </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV من 199 دولارًا</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> في هولندا!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2 جيجا هرتز 6C 128 جيجا بايت DDR3 2x960GB SSD 1Gbps 100TB - من 99 دولار! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">اقرأ عن</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> كيفية بناء مبنى البنية التحتية </font><font style="vertical-align: inherit;">الفئة c باستخدام خوادم Dell R730xd E5-2650 v4 بتكلفة 9000 يورو مقابل سنت واحد؟</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar503472/index.html">مدفوعات غير نقدية ، وملفات بودكاست ، ولحوم اصطناعية: ما هي الشركات الأخرى التي تتعامل بشكل جيد مع أزمة الفيروسات التاجية</a></li>
<li><a href="../ar503474/index.html">تجربتي في تطوير التطبيقات كمسؤول</a></li>
<li><a href="../ar503476/index.html">سجل الاختبارات التلقائية لواجهة مستخدم الفيديو التي تعمل في Chrome بدون رأس</a></li>
<li><a href="../ar503480/index.html">ما يصل إلى 40 ألفًا: أكثر من 10 مراجعات لمشغل الفينيل</a></li>
<li><a href="../ar503486/index.html">كم عدد التعليمات في x86؟</a></li>
<li><a href="../ar503490/index.html">مقارنة بين مشاهد الراب الروسية باستخدام تقنيات التعدين R والنص. Noize Mc، Oxxxymiron، Uncle Zhenya. الحلقة 2</a></li>
<li><a href="../ar503494/index.html">تجميع بوابة DIY لأجهزة Zigbee</a></li>
<li><a href="../ar503504/index.html">مشروع علم البيانات الأكثر نجاحًا والأكثر فاضحة: Cambridge Analytica</a></li>
<li><a href="../ar503508/index.html">المدارس والمعلمين والطلاب ودرجاتهم وتصنيفاتهم</a></li>
<li><a href="../ar503518/index.html">Neomorphism باستخدام SwiftUI. الجزء 2: ما الذي يمكن عمله بإمكانية الوصول؟</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>