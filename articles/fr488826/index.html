<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ℹ️ 🖌️ 🤴🏻 Reconnaître l'escalade de privilèges dans ABBYY FineReader ♉️ 👎🏽 🧚🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le cycle de recherche des vulnérabilités d'élévation de privilèges dans les applications Windows se poursuit. Dans la série précédente: Steam ( CVE-20...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Reconnaître l'escalade de privilèges dans ABBYY FineReader</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pm/blog/488826/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le cycle de recherche des vulnérabilités d'élévation de privilèges dans les applications Windows se poursuit. </font><font style="vertical-align: inherit;">Dans la série précédente: Steam ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CVE-2019-14743</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CVE-2019-15316</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CVE-2019-17180</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) et Origin ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CVE-2019-19247, CVE-2019-19248</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Mais aujourd'hui, nous ne parlons pas d'un lanceur de jeu, mais du progiciel d'application ABBYY FinerReader. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/n6/4z/ac/n64zach5hyh0x3hdcoskm6ojz7m.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Résumé - Je vais vous dire comment, grâce au composant qui vérifie la licence, en 10 minutes vous pouvez augmenter vos droits du niveau utilisateur à NT AUTHORITY \ SYSTEM. </font><font style="vertical-align: inherit;">La vulnérabilité a reçu l'identifiant CVE-2019-20383, un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lien vers le site Web d'ABBYY</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<a name="habracut"></a><br>
<h2><font color="orange"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Service de renseignements</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai téléchargé la version d'essai de FineReader sur le site Web d'ABBYY et je l'ai rapidement vérifiée pour voir s'il était judicieux de choisir le produit pour augmenter les privilèges. Oui, le produit inclut un service qui, à en juger par le nom "serveur de licences réseau ABBYY", est associé à des licences et est lancé par défaut à partir de l'utilisateur NT AUTHORITY \ SYSTEM. J'ai commencé ProcMon a commencé à surveiller le comportement du service.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mon attention a été attirée sur le fichier situé sur le chemin "C: \ ProgramData \ ABBYY \ FineReader \ 15 \ Licenses \ Licensing.cnt". Le service en lit quelque chose, y écrit quelque chose, en général, le fichier ressemble à un candidat intéressant pour les expériences. Considérez le dossier "C: \ ProgramData \ ABBYY \ FineReader \ 15 \ Licenses". La liste de contrôle d'accès héritée All-Full Access du dossier parent («C: \ ProgramData \ ABBYY \ FineReader \ 15») est valide pour ce dossier, ce qui signifie que vous pouvez supprimer tout son contenu, y compris le fichier «Licensing.cnt». </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le service, ayant découvert l'absence du fichier, a tenté de le créer, et de manière un peu étrange. Il a créé un fichier de la forme «tmpXXXX-YYYYYYYYY.tmp», y a écrit des données, puis l'a renommé «Licensing.cnt». </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici le journal ProcMon dans lequel cette opération est effectuée deux fois.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8h/hk/ro/8hhkroiszje9qtzyovchs1zldjk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, cela se produit à 20h36, puis à 20h46. Entre ces horodatages, le fichier a été supprimé à nouveau pour être à nouveau créé. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le rectangle 1 indique la situation où le service a détecté l'absence de fichier. Rectangle 2 - créez un fichier temporaire. Rectangle 3 - renommez le fichier temporaire. Rectangle 4 - répétez les opérations après 10 minutes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considérez le format du nom "tmpXXXX_YYYYYYYYY.tmp". Dans le cadre d'un processus en cours, XXXX sera toujours constant, d'ailleurs, en fait, c'est l'identifiant du thread qui effectue ce travail. YYYYYYYYY ne reste pas constant, mais si nous regardons deux départs voisins (valeurs: 430210515 et 430810515), il semble que ce ne soit qu'une marque de temps - la différence entre les nombres 600000 - coïncide étonnamment avec 10 minutes de différence. Quelques tests supplémentaires confirment notre hypothèse.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour résumer cette partie. </font><font style="vertical-align: inherit;">Tout utilisateur peut supprimer le fichier "C: \ ProgramData \ ABBYY \ FineReader \ 15 \ Licenses \ Licensing.cnt", puis il peut très souvent demander le contenu du dossier "C: \ ProgramData \ ABBYY \ FineReader \ 15 \ Licenses" dans à un moment donné, trouvez-y un fichier appelé "tmpXXXX_YYYYYYYYY.tmp". </font><font style="vertical-align: inherit;">Maintenant, l'utilisateur sera prêt, après avoir supprimé le fichier, il saura exactement à quel moment et avec quel nom le fichier sera créé la prochaine fois.</font></font><br>
<br>
<h2><font color="orange"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous allons maintenant jouer avec des liens symboliques</font></font></font></h2><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment créer des liens symboliques sans droits d'administrateur</font></font></b><div class="spoiler_text">  ,           .     . , ,     «C:\abc\1»   «C:\def\2».<br>
<br>
  NTFS reparse point (  NTFS mount point)   «C:\abc»  «\RPC Control\". «\RPC Control\» –        ,   , ,  .    ,   , ,  ,     .       NTFS reparse point ,  ,             .   - ,  -            .<br>
<br>
          .    "\RPC Control\1" &lt;-&gt; «C:\def\2».  ,     «C:\abc\1»,       «C:\def\2».<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Initialement, le processus de création d'un fichier de licence ressemble à ceci: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ln/zh/8w/lnzh8ws9y5e0ewunx4u_pnnhkh8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
lorsque nous connaissons le moment exact de la prochaine opération, nous pouvons créer les liens symboliques suivants (nous ignorerons le nom du dossier source «C: \ ProgramData \ ABBYY \ FineReader \ 15 \ Licenses \»): </font><font style="vertical-align: inherit;">
Où YYYYYYYYYA, YYYYYYYYB, YYYYYYYYC, ... YYYYYYYYYZ - ce sont des horodatages différents dans le YYYYYYYYYY + 10 minutes (au cas où l'horodatage serait légèrement en retard). </font><font style="vertical-align: inherit;">
Ensuite, créez un lien: </font><font style="vertical-align: inherit;">
notez qu'aucun de ces fichiers n'existe vraiment. Cela est nécessaire pour que, lorsque vous vous référez, par exemple, à tmpXXXX_YYYYYYYYB.tmp, deux redirections se produisent et, par conséquent, le service fonctionne avec le fichier "C: \ test \ l2 \ nope". </font><font style="vertical-align: inherit;">
Dès que l'on découvre la création du fichier «C: \ test \ l2 \ nope», il faut immédiatement créer deux nouveaux liens symboliques:</font></font><br>
<br>
<code>tmpXXXX_YYYYYYYYA.tmp &lt;-&gt; C:\test\l1\proxy<br>
tmpXXXX_YYYYYYYYB.tmp &lt;-&gt; C:\test\l1\proxy<br>
tmpXXXX_YYYYYYYYC.tmp &lt;-&gt; C:\test\l1\proxy<br>
…<br>
tmpXXXX_YYYYYYYYZ.tmp &lt;-&gt; C:\test\l1\proxy</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<code>C:\test\l1\proxy &lt;-&gt; C:\test\l2\nope</code><br>
<br><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><br>
<br>
<code>C:\test\l1\proxy &lt;-&gt; C:\test\l2\payload<br>
Licensing.cnt &lt;-&gt; C:\target\path</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le service continuera à écrire le contenu du fichier dans «C: \ test \ l2 \ nope», mais il fera le changement de nom après avoir traversé le nouveau lien symbolique. Ainsi, au lieu de renommer, par exemple, "tmpXXXX_YYYYYYYYC.tmp" en "Licensing.cnt", "C: \ test \ l2 \ payload" sera en fait renommé (déplacé) en "C: \ target \ path". En fait, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous pouvons placer un fichier avec n'importe quel contenu dans n'importe quel chemin au nom de l'utilisateur NT AUTHORITY \ SYSTEM</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schématiquement, cela ressemblera à ceci: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/m2/bq/cb/m2bqcbiptwhuauds0bpsn4giyjo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La couleur indique ce qui sera réellement réalisé en raison de l'influence des liens symboliques. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Augmenter les privilèges en utilisant la primitive résultante est déjà facile - vous pouvez attacher votre dll aux processus système et à d'autres choses similaires. À ce stade, j'ai contacté les représentants d'ABBYY et leur ai transmis des informations sur la vulnérabilité.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À l'heure actuelle, selon ABBYY, la vulnérabilité est fermée.</font></font><br>
<br>
<h2><font color="orange"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chronologie</font></font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">25/11/2019</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - détection de vulnérabilité </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">26/11/2019</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - contact de sécurité demandé au fabricant </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">26/11/2019</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - envoyer le rapport de vulnérabilité au fabricant </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12/09/2019</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - la vulnérabilité a été confirmée par le fabricant </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10/01/2020</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - la vulnérabilité a été corrigée </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le 22/01/2020</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - des vulnérabilités ont été attribuées CVE-2019-20383 </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19/02/2019 .2020</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - publication de cet article </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a maintenant de nombreux projets et nous agrandissons l'équipe «Prospective Monitoring». </font><font style="vertical-align: inherit;">Nous recherchons des experts dans l'étude des codes sources, ainsi que des experts dans l'analyse des applications mobiles. </font><font style="vertical-align: inherit;">Vous voulez rejoindre mon équipe - écrivez-moi, Anastasia (</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ana2121</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) ou par mail info@amonitoring.ru </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cet article en anglais.</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr488814/index.html">Forge of Empires d'AS3 à Haxe. Post mortem</a></li>
<li><a href="../fr488816/index.html">Comment nous avons perdu Mir: un incendie dans une station spatiale, une collision avec un camion Progress, une dépressurisation</a></li>
<li><a href="../fr488818/index.html">Percées #DeepPavlov en 2019: bilan et résultats de l'année</a></li>
<li><a href="../fr488820/index.html">Comment ne pas s'épuiser au travail et que faire si vous continuez de vous épuiser</a></li>
<li><a href="../fr488824/index.html">Meetup DGTL Design Community à Raiffeisenbank: Diffusion</a></li>
<li><a href="../fr488828/index.html">Spam, spam, spam ...</a></li>
<li><a href="../fr488830/index.html">Internet au Turkménistan: prix, disponibilité et restrictions</a></li>
<li><a href="../fr488832/index.html">Étonnamment, l'année dernière, les disques durs d'entreprise étaient plus populaires que les SSD et leurs ventes augmentent</a></li>
<li><a href="../fr488834/index.html">Comment l'erreur de 2009 provoque un conflit entre Docker pour Windows et Razer Synapse</a></li>
<li><a href="../fr488836/index.html">Quelques aspects de l'utilisation de Dictionary lors du développement d'applications chargées</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>