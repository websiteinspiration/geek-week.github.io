<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§õ üìö üëù Automation testing of turnkey web applications, without registration and SMS ü§¶ üë©‚Äçüíº üòô</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It often happens that a web application consists of a large number of dynamically restructuring forms with different text and controls. Testing such a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Automation testing of turnkey web applications, without registration and SMS</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tinkoff/blog/499476/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It often happens that a web application consists of a large number of dynamically restructuring forms with different text and controls. Testing such an application turns into a nightmare. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You need to click 100500 pages and check all the functionality ... And before the next release, check the same again ... And again ... And tomorrow again. At some point, the verification begins to take longer than the development of new functionality. ‚ÄúWhat about e2e tests?‚Äù - you ask. But, firstly, they still need to be written. And secondly, before you start writing them, you need to write test cases. A lot of test cases.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If while reading these lines your forehead is covered with perspiration, do not worry. </font><font style="vertical-align: inherit;">In this article I will share with you the idea of ‚Äã‚Äãhow we at Tinkoff automated the testing of one of the web applications without writing a single test case and e2e test.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vg/_7/al/vg_7alujkcmr1vpvnfes86eirdo.png"><br>
<a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Automatically writing test cases</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It just so happened that testing our web application is mainly related to interface checks. </font><font style="vertical-align: inherit;">You need to check that the button is present on the screen, the desired title and text are displayed, and when you enter an invalid value in </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">input</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , an error message appears. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Accordingly, when writing a test case, you need to record all the actions:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúPressed the button‚Äù</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Entered the value of XXX"</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúSelected the value YYY in the drop-down list‚Äù</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
and checks:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúThe text appeared: XXX‚Äù</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Error message appeared: YYY"</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"The heading appeared: ZZZ"</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After analyzing all the functionality of our web application, we identified about 30 unique actions and checks. It became clear that this process can be automated. To do this, you just need to track all the actions of the tester on the page and the reaction of the site to these actions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's start by intercepting events. To track interaction with controls such as buttons, radio buttons and check boxes, you need to subscribe to the click event. Each framework has its own methods for this. For example, fromEvent in Angular and document.addEventListener in JavaScript and React. For input controls, such as calendar or input, only the type of event you want to subscribe to will change: instead of click, focusout will be.</font></font><br>
<br>
<pre><code class="javascript hljs">fromEvent(<span class="hljs-keyword">this</span>.elementRef.nativeElement, <span class="hljs-string">'click'</span>)<font></font>
.subscribe(<span class="hljs-function"><span class="hljs-params">tagName</span> =&gt;</span> {
 	<span class="hljs-keyword">if</span> (tagName === <span class="hljs-string">'BUTTON'</span>) {
   		<span class="hljs-keyword">this</span>.testCaseService.addAction(<span class="hljs-string">`   "<span class="hljs-subst">${action.name}</span>"`</span>);<font></font>
 	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tagName === <span class="hljs-string">'INPUT-CALENDAR'</span>) {
   		<span class="hljs-keyword">this</span>.testCaseService<font></font>
     			.addAction(<span class="hljs-string">`  "<span class="hljs-subst">${action.name}</span>" "<span class="hljs-subst">${action.value}</span>"`</span>);<font></font>
 	}<font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And finally, the most important thing is checking. </font><font style="vertical-align: inherit;">The way the site should behave in response to the actions of the tester. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What does the tester usually check? </font><font style="vertical-align: inherit;">For example, he entered an invalid value in </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">input</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , the site responded with an error message. </font><font style="vertical-align: inherit;">Or, let's say we clicked on a button and in response a new screen appeared, the title changed, new text appeared, and the controls were rebuilt. </font><font style="vertical-align: inherit;">All these changes are related to the change in the DOM tree. </font><font style="vertical-align: inherit;">There are many options to track them. </font><font style="vertical-align: inherit;">You can, for example, use MutationObserver in React and JavaScript or ngAfterViewInit in Angular (putting a directive on the form elements of interest on the site).</font></font><br>
<br>
<pre><code class="javascript hljs">ngAfterViewInit() {
    <span class="hljs-keyword">const</span> tagName = <span class="hljs-keyword">this</span>.nativeElement.nodeName;
	<span class="hljs-keyword">const</span> text = <span class="hljs-keyword">this</span>.nativeElement.textContent;
    <span class="hljs-keyword">if</span> ([<span class="hljs-string">'SPAN'</span>, <span class="hljs-string">'P'</span>].includes(tagName)) {
 	 	 <span class="hljs-keyword">this</span>.testCaseService.addContent(<span class="hljs-string">`** ** "<span class="hljs-subst">${text}</span>"\n`</span>);<font></font>
     } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tagName === <span class="hljs-string">'H1'</span>) {
 	  	<span class="hljs-keyword">this</span>.testCaseService.addContent(<span class="hljs-string">`** ** "<span class="hljs-subst">${text}</span>"\n`</span>);<font></font>
     } ‚Ä¶	<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The code will be very dependent on layout. </font><font style="vertical-align: inherit;">Let's take a look at the markup. </font><font style="vertical-align: inherit;">These buttons are taken from the Google translator.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ct/eb/f5/ctebf5n4u2p4djpqzvcv6ebwl_0.png"><br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tlid-input-button input-button header-button tlid-input-button-text text-icon"</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"tab"</span> <span class="hljs-attr">tabindex</span>=<span class="hljs-string">"-1"</span>&gt;</span>
  	<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tlid-input-button input-button header-button tlid-input-button-docs documents-icon"</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"tab"</span> <span class="hljs-attr">tabindex</span>=<span class="hljs-string">"-1"</span>&gt;</span>
 	 <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despite the fact that buttons are not represented as </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">button</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tags </font><font style="vertical-align: inherit;">, looking at the markup, you can select all buttons on the page using the ‚Äúinput-button‚Äù css class, and you can get button names from the nested ‚Äútext‚Äù css class. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Half the job was done, it remains only to write down everything that we tracked into a test case. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We include the interception of all actions on the site for a specific key combination and only on the test circuit. </font><font style="vertical-align: inherit;">We stop the interception of all events on the site by a certain key combination. </font><font style="vertical-align: inherit;">This allows you to start and stop the automatic recording of the test case from anywhere.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Automatically writing e2e tests</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you look at the automatically generated test case, then these are essentially user scripts reduced to the same form. So, they can be converted into e2e tests. You can even immediately write e2e tests after intercepting all the actions and checks, bypassing the test cases. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now there are a large number of different frameworks with gherkin notation based on behavioral scripts: SpecFlow, xBehave.net., Cucumber.js, CodeceptJS, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To get features from the test case, you need to add the When </font><font style="vertical-align: inherit;">keyword </font><font style="vertical-align: inherit;">before the actions and before all checks Then and And. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Get the automatically generated e2e test:</font></font><br>
<br>
<pre><code class="lisp hljs">Feature:   <span class="hljs-number">2</span>-<font></font>
  Background:<font></font>
 	When  <span class="hljs-string">""</span> <span class="hljs-string">""</span><font></font>
<font></font>
  Scenario:<font></font>
 	When    <span class="hljs-string">" - "</span>
 	Then    <span class="hljs-string">"  "</span>
 	And   <span class="hljs-string">" - "</span>
 	When    <span class="hljs-string">"  "</span> <span class="hljs-string">""</span>
 	When    <span class="hljs-string">""</span> <span class="hljs-string">"  "</span>
 	When    <span class="hljs-string">""</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To run the test run, the generated features are few - you need to write a handler for all actions and checks. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is good news: you do not need to write a handler for each feature. </font><font style="vertical-align: inherit;">As I said, despite the large number of different forms on the site, we got only 30 unique actions and checks, which means that there will be exactly the same number of methods in the common processor for all e2e tests. </font><font style="vertical-align: inherit;">The code will be slightly different - depending on the chosen framework with gherkin notation and layout on the site. </font><font style="vertical-align: inherit;">But writing the handler itself does not take much time.</font></font><br>
<br>
<pre><code class="lisp hljs">When('   {string}', async function (<span class="hljs-name">button</span>: string) {<font></font>
	const xpath = <span class="hljs-string">"//button"</span><span class="hljs-comment">;</span>
	const btn = await getItemByText(<span class="hljs-name">xpath</span>, button)<span class="hljs-comment">;</span>
	await waitAndClick(<span class="hljs-name">btn</span>)<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>
When('  {string} {string}', async function (<span class="hljs-name">label</span>: string, text: string) {<font></font>
	const xpath = <span class="hljs-string">"//*[contains(text(),'"</span> + label + <span class="hljs-string">"')]/ancestor::outline"</span><span class="hljs-comment">;</span>
	await inputSendKeys(<span class="hljs-name">currentBrowser</span>().element(<span class="hljs-name">by</span>.xpath(<span class="hljs-name">xpath</span>)), text)<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now, checking the next task, a test case is automatically written for the tester and the automatically generated e2e test is run. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In short, you need to:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Subscribe to events of interaction with controls and the site‚Äôs reaction to these actions (through tracking the rebuilding of the DOM tree).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Convert data from paragraph 1 to e2e tests.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Write a general handler for running e2e tests.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This approach will help you get away from the routine. </font><font style="vertical-align: inherit;">You can automate the writing of test cases and e2e tests for simple checks related to the interface. </font><font style="vertical-align: inherit;">We have gone even further and check automatically also the record in the database and sending to third-party services. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I talked about this, as well as versioning, the technology stack, and even about the problems at the first stage of implementation and their solution at </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the Heisenbug-2019 conference in Moscow</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this article, I tried to convey the main idea without going into details.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now it takes us 2 minutes on average to write a test case and an e2e test - this is 60 times faster than the initial calculations, when we wanted to write test cases and e2e tests manually. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We did not change the processes in the team. </font><font style="vertical-align: inherit;">It was no longer necessary to allocate the test capacity for writing test cases and take it to the automation team. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We are completely gone from the notion of regression. </font><font style="vertical-align: inherit;">If earlier, with a two-week sprint, the regression took us more than 3 days, now the regression takes time to run all the e2e tests, and this is only 2 hours. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When manually writing e2e tests, it is very difficult to go in parallel with testing. </font><font style="vertical-align: inherit;">Now, e2e tests are written automatically during the testing of the task, and the tester does not need to check the same functionality twice.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result, our team, without changing the composition, began to work much more efficiently.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en499460/index.html">Concurrency, coroutines, event machines, ... living math</a></li>
<li><a href="../en499464/index.html">MOS Technology 6502 - Taming the semiconductor seed</a></li>
<li><a href="../en499470/index.html">Do not touch! Manage a webpage using a webcam</a></li>
<li><a href="../en499472/index.html">How coronavirus will accelerate the fourth industrial revolution</a></li>
<li><a href="../en499474/index.html">How to implement Atlassian Jira + Confluence in a corporation. Technical issues</a></li>
<li><a href="../en499482/index.html">How investors save finances in a crisis: approaches to diversification, selection of low-risk assets and cost optimization</a></li>
<li><a href="../en499486/index.html">Rhetoric as a safety tool</a></li>
<li><a href="../en499490/index.html">Random Algorithms</a></li>
<li><a href="../en499492/index.html">Is it possible for a developer in Silicon Valley to become a millionaire? Staff Engineer parsing at Lyft</a></li>
<li><a href="../en499502/index.html">Why OceanStor Dorado V6 is the fastest and most reliable storage</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>