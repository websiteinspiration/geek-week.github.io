<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â¡ï¸ ğŸ‘¨ğŸ»â€ğŸš€ ğŸ´ FFmpegã«ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã‚’è¿½åŠ ã™ã‚‹æ–¹æ³• â†—ï¸ â„¹ï¸ ğŸ““</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="FFmpegã¯ã€ä¸€ç¨®ã®ãƒãƒ«ãƒãƒ¡ãƒ‡ã‚£ã‚¢ç™¾ç§‘äº‹å…¸ã§ã‚ã‚‹å£®å¤§ãªã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚FFmpegã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€å¤šæ•°ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ãƒãƒ«ãƒãƒ¡ãƒ‡ã‚£ã‚¢ã‚¿ã‚¹ã‚¯ã‚’è§£æ±ºã§ãã¾ã™ã€‚ã—ã‹ã—ã€ãã‚Œã§ã‚‚ã€FFmpegã‚’æ‹¡å¼µã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚æ¨™æº–çš„ãªæ–¹æ³•ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã¦ã‹ã‚‰ã€æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>FFmpegã«ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã‚’è¿½åŠ ã™ã‚‹æ–¹æ³•</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/480714/"><hr><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FFmpegã¯ã€ä¸€ç¨®ã®ãƒãƒ«ãƒãƒ¡ãƒ‡ã‚£ã‚¢ç™¾ç§‘äº‹å…¸ã§ã‚ã‚‹å£®å¤§ãªã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚</font><font style="vertical-align: inherit;">FFmpegã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€å¤šæ•°ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ãƒãƒ«ãƒãƒ¡ãƒ‡ã‚£ã‚¢ã‚¿ã‚¹ã‚¯ã‚’è§£æ±ºã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã—ã‹ã—ã€ãã‚Œã§ã‚‚ã€FFmpegã‚’æ‹¡å¼µã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">æ¨™æº–çš„ãªæ–¹æ³•ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã¦ã‹ã‚‰ã€æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ã“ã¨ã§ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®è¨˜äº‹ã§ã¯ã€æ–°ã—ã„ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã‚’è¿½åŠ ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦è©³ã—ãèª¬æ˜ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">å¤–éƒ¨é–¢æ•°ã‚’FFmpegã«æ¥ç¶šã™ã‚‹ãŸã‚ã®ã„ãã¤ã‹ã®æ©Ÿèƒ½ã‚‚è€ƒæ…®ã•ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒãªã„å ´åˆã€ã“ã®è¨˜äº‹ã¯FFmpegã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ãã®è¨­å®šã‚’ã‚ˆã‚Šã‚ˆãç†è§£ã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚</font><font style="vertical-align: inherit;">èª­è€…ã¯FFmpegã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€FFmpegã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãƒ—ãƒ­ã‚»ã‚¹ã«ç²¾é€šã—ã¦ãŠã‚Šã€FFmpeg APIã‚’ä½¿ç”¨ã—ãŸãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°çµŒé¨“ãŒã‚ã‚‹ã“ã¨ã‚’å‰æã¨ã—ã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">èª¬æ˜ã¯ã€FFmpeg 4.2 "Ada"ã€2019å¹´8æœˆã«æœ‰åŠ¹ã§ã™ã€‚</font></font><br>
</p><hr><a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç›®æ¬¡</font></font></h1><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç›®æ¬¡</font></font></b><div class="spoiler_text"><p>&nbsp;&nbsp;<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a><br>
&nbsp;&nbsp;<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">1.  </a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">1.1.  </a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">1.2. </a><br>
&nbsp;&nbsp;<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">2.     FFmpeg</a><br>
&nbsp;&nbsp;<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">3.      </a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">3.1.  </a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">3.2. </a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">3.3.  </a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">3.4.  ,  </a><br>
&nbsp;&nbsp;<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">4.   </a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">4.1.   </a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">4.2.  </a><br>
&nbsp;&nbsp;<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a><br>
&nbsp;&nbsp;<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a><br>
</p><br>
</div></div><br>
<a name="id-introdaction"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‰æ›¸ã</font></font></h1><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ï¼ˆã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã€COderã¨DECoderã¨ã„ã†ç”¨èªã®çµ„ã¿åˆã‚ã›ã«ç”±æ¥ï¼‰ã¯éå¸¸ã«ä¸€èˆ¬çš„ãªç”¨èªã§ã‚ã‚Šã€ã“ã®ã‚ˆã†ãªå ´åˆã«ã‚ˆãç™ºç”Ÿã™ã‚‹ã‚ˆã†ã«ã€ãã®æ„å‘³ã¯ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«ã‚ˆã£ã¦è‹¥å¹²ç•°ãªã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ä¸»ãªæ„å‘³ã¯ã€ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ‡ãƒ¼ã‚¿ã‚’åœ§ç¸®/è§£å‡ã™ã‚‹ãŸã‚ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã¾ãŸã¯ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã§ã™ã€‚</font><font style="vertical-align: inherit;">åœ§ç¸®/è§£å‡ã¨ã„ã†ç”¨èªã®ä»£ã‚ã‚Šã«ã€ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°/ãƒ‡ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¨ã„ã†ç”¨èªãŒã‚ˆãä½¿ç”¨ã•ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãŸã ã—ã€å ´åˆã«ã‚ˆã£ã¦ã¯ã€ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã¯é€šå¸¸ã€åœ§ç¸®/è§£å‡ã«ä½¿ç”¨ã•ã‚Œã‚‹æ‰‹æ®µã«é–¢ä¿‚ãªãã€å˜ã«åœ§ç¸®å½¢å¼ï¼ˆã‚³ãƒ¼ãƒ‡ãƒƒã‚¯å½¢å¼ã¨ã‚‚å‘¼ã°ã‚Œã¾ã™ï¼‰ã‚’æ„å‘³ã™ã‚‹ã¨ç†è§£ã•ã‚Œã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">FFmpegã§ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã¨ã„ã†ç”¨èªãŒã©ã®ã‚ˆã†ã«ä½¿ç”¨ã•ã‚Œã‚‹ã‹ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</font></font><br>
</p><br>
<a name="id-1"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã®è­˜åˆ¥</font></font></h1><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FFmpegã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã¯</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">libavcodec</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã‚Œã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
</p><br>
<a name="id-1-1"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1ã€‚</font><font style="vertical-align: inherit;">ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ID</font></font></h2><br>
<p>  <code>libavcodec/avcodec.h</code>   <code>enum AVCodecID</code>.          .       <code>AV_CODEC_ID_XXX</code>,  <code>XXX</code>       .    : <code>AV_CODEC_ID_H264</code>, <code>AV_CODEC_ID_AAC</code>.         <code>AVCodecDescriptor</code> (  <code>libavcodec/avcodec.h</code>,    ):<br>
</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">AVCodecDescriptor</span> {</span>
    <span class="hljs-keyword">enum</span> AVCodecID   id;
    <span class="hljs-keyword">enum</span> AVMediaType type;
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>      *name;
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>      *long_name;
<span class="hljs-comment">// ...</span>
} AVCodecDescriptor;</code></pre><br>
<p>     <code>id</code>,           .         ( <code>type</code>)     ( <code>name</code>),    .   <code>libavcodec/codec_desc.c</code>    <code>AVCodecDescriptor</code>.        .         <code>id</code>,        .         :<br>
</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">const</span> AVCodecDescriptor*
<span class="hljs-title">avcodec_descriptor_get</span><span class="hljs-params">(<span class="hljs-keyword">enum</span> AVCodecID id)</span></span>;
<span class="hljs-function"><span class="hljs-keyword">const</span> AVCodecDescriptor*
<span class="hljs-title">avcodec_descriptor_get_by_name</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *name)</span></span>;
<span class="hljs-function"><span class="hljs-keyword">enum</span> AVMediaType
<span class="hljs-title">avcodec_get_type</span><span class="hljs-params">(<span class="hljs-keyword">enum</span> AVCodecID codec_id)</span></span>;
<span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*
<span class="hljs-title">avcodec_get_name</span><span class="hljs-params">(<span class="hljs-keyword">enum</span> AVCodecID id)</span></span>;</code></pre><br>
<a name="id-1-2"></a><br>
<h2>1.2. </h2><br>
<p>  â€”  ,    / ,   <code>AVCodec</code> (  <code>libavcodec/avcodec.h</code>).    ,     .<br>
</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">AVCodec</span> {</span>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *name;
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *long_name;
    <span class="hljs-keyword">enum</span> AVMediaType type;
    <span class="hljs-keyword">enum</span> AVCodecID   id;
<span class="hljs-comment">// ...</span>
} AVCodec;</code></pre><br>
<p>    â€”  <code>id</code>,  ,       (<code>type</code>),            <code>AVCodecDescriptor</code>.      â€”  (encoders),      ,   (decoders),     â€”   . (           â€” .)    <code>AVCodec</code>,   ,  (    ,    <code>av_codec_is_encoder()</code>  <code>av_codec_is_decoder()</code>,     .      .          .        ,      ( <code>name</code>).   ,       ,      ,           (    ).       ,     ,        .         .      :<br>
</p><br>
<pre><code class="cpp hljs"><span class="hljs-function">AVCodec* <span class="hljs-title">avcodec_find_encoder_by_name</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *name)</span></span>;
<span class="hljs-function">AVCodec* <span class="hljs-title">avcodec_find_decoder_by_name</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *name)</span></span>;
<span class="hljs-function">AVCodec* <span class="hljs-title">avcodec_find_encoder</span><span class="hljs-params">(<span class="hljs-keyword">enum</span> AVCodecID id)</span></span>;
<span class="hljs-function">AVCodec* <span class="hljs-title">avcodec_find_decoder</span><span class="hljs-params">(<span class="hljs-keyword">enum</span> AVCodecID id)</span></span>;</code></pre><br>
<p>          ,        ,          .<br>
</p><br>
<p>      <br>
</p><br>
<p><code>ffmpeg -codecs &gt;codecs.txt</code><br>
</p><br>
<p>  ,  <code>codecs.txt</code>    .        (). , ,     <code>AV_CODEC_ID_H264</code>:<br>
</p><br>
<p><code>DEV.LS<br>
h264<br>
H.264 / AVC / MPEG-4 AVC / MPEG-4 part 10<br>
(decoders: h264 h264_qsv h264_cuvid)<br>
(encoders: libx264 libx264rgb h264_amf h264_nvenc h264_qsv nvenc nvenc_h264)<br>
</code><br>
</p><br>
<p>     ,        : <code>D</code> â€”  , <code>E</code> â€”  , <code>V</code> â€”   , <code>L</code> â€”     , <code>S</code> â€”     .      (<code>h264</code>),       (<code>H.264 / AVC / MPEG-4 AVC / MPEG-4 part 10</code>),         .<br>
</p><br>
<a name="id-2"></a><br>
<h1>2.     FFmpeg</h1><br>
<p>     FFmpeg    ,   <code>FROX</code>.<br>
</p><br>
<p><b> 1.      <code>enum AVCodecID</code>.</b><br>
</p><br>
<p>     <code>libavcodec/avcodec.h</code>.     :<br>
</p><br>
<ol>
<li>         ;</li>
<li>     ;</li>
<li>      .</li>
</ol><br>
<p>   ,      <code>AV_CODEC_ID_FROX</code>.    <code>AV_CODEC_ID_PCM_S64LE</code>    <code>0x10700</code>.<br>
</p><br>
<p><b> 2.     <code>codec_descriptors</code> ( <code>libavcodec/codec_desc.c</code>).</b><br>
</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> AVCodecDescriptor codec_descriptors[] = {
<span class="hljs-comment">// ...</span><font></font>
    {<font></font>
        .id = AV_CODEC_ID_FROX,<font></font>
        .type = AVMEDIA_TYPE_AUDIO,<font></font>
        .name = <span class="hljs-string">"frox"</span>,<font></font>
        .long_name = NULL_IF_CONFIG_SMALL(<span class="hljs-string">"FROX audio"</span>),<font></font>
        .props = AV_CODEC_PROP_LOSSLESS,<font></font>
    },<font></font>
<span class="hljs-comment">// ...</span>
};</code></pre><br>
<p>    Â«Â» ,         <code>id</code>.<br>
</p><br>
<p><b> 3.   <code>AVCodec</code>     .</b><br>
</p><br>
<p>           ,      /     .         ,      .     <code>libavcodec/frox.c</code>.<br>
</p><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"avcodec.h"</span></span><font></font>
<font></font>
<span class="hljs-comment">// context</span><font></font>
<font></font>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">FroxContext</span> {</span>
<span class="hljs-comment">// ...</span><font></font>
} FroxContext;<font></font>
<font></font>
<span class="hljs-comment">// decoder</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">frox_decode_init</span><span class="hljs-params">(AVCodecContext *codec_ctx)</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">frox_decode_close</span><span class="hljs-params">(AVCodecContext *codec_ctx)</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">frox_decode</span><span class="hljs-params">(AVCodecContext *codec_ctx,
<span class="hljs-keyword">void</span>* outdata, <span class="hljs-keyword">int</span> *outdata_size, AVPacket *pkt)</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
}<font></font>
<font></font>
AVCodec ff_frox_decoder = {<font></font>
    .name = <span class="hljs-string">"frox_dec"</span>,<font></font>
    .long_name = NULL_IF_CONFIG_SMALL(<span class="hljs-string">"FROX audio decoder"</span>),<font></font>
    .type = AVMEDIA_TYPE_AUDIO,<font></font>
    .id = AV_CODEC_ID_FROX,<font></font>
    .priv_data_size = <span class="hljs-keyword">sizeof</span>(FroxContext),<font></font>
    .init = frox_decode_init,<font></font>
    .close = frox_decode_close,<font></font>
    .decode = frox_decode,<font></font>
    .capabilities = AV_CODEC_CAP_LOSSLESS,<font></font>
    .sample_fmts = (<span class="hljs-keyword">const</span> <span class="hljs-keyword">enum</span> AVSampleFormat[])<font></font>
        {AV_SAMPLE_FMT_FLT, AV_SAMPLE_FMT_NONE},<font></font>
    .channel_layouts = (<span class="hljs-keyword">const</span> <span class="hljs-keyword">int64_t</span>[])<font></font>
        {AV_CH_LAYOUT_MONO, <span class="hljs-number">0</span> },<font></font>
};<font></font>
<font></font>
<span class="hljs-comment">// encoder</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">frox_encode_init</span><span class="hljs-params">(AVCodecContext *codec_ctx)</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">frox_encode_close</span><span class="hljs-params">(AVCodecContext *codec_ctx)</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">frox_encode</span><span class="hljs-params">(AVCodecContext *codec_ctx,
AVPacket *pkt, <span class="hljs-keyword">const</span> AVFrame *frame, <span class="hljs-keyword">int</span> *got_pkt_ptr)</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
}<font></font>
<font></font>
AVCodec ff_frox_encoder = {<font></font>
    .name = <span class="hljs-string">"frox_enc"</span>,<font></font>
    .long_name = NULL_IF_CONFIG_SMALL(<span class="hljs-string">"FROX audio encoder"</span>),<font></font>
    .type = AVMEDIA_TYPE_AUDIO,<font></font>
    .id = AV_CODEC_ID_FROX,<font></font>
    .priv_data_size = <span class="hljs-keyword">sizeof</span>(FroxContext),<font></font>
    .init = frox_encode_init,<font></font>
    .close = frox_encode_close,<font></font>
    .encode2 = frox_encode,<font></font>
    .sample_fmts = (<span class="hljs-keyword">const</span> <span class="hljs-keyword">enum</span> AVSampleFormat[])<font></font>
        {AV_SAMPLE_FMT_S16, AV_SAMPLE_FMT_NONE},<font></font>
    .channel_layouts = (<span class="hljs-keyword">const</span> <span class="hljs-keyword">int64_t</span>[])<font></font>
        {AV_CH_LAYOUT_MONO, <span class="hljs-number">0</span> },<font></font>
};</code></pre><br>
<p>               â€” <code>FroxContext</code>,         .     ,    <code>AVCodec</code>    .<br>
</p><br>
<p><b> 4.   <code>AVCodec</code>   .</b><br>
</p><br>
<p>   <code>libavcodec/allcodecs.c</code>.          .      :<br>
</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">extern</span> AVCodec ff_frox_decoder;
<span class="hljs-keyword">extern</span> AVCodec ff_frox_encoder;</code></pre><br>
<p>    <code>configure</code>        <code>libavcodec/codec_list.c</code>,      ,   <code>libavcodec/allcodecs.c</code>.      <code>libavcodec/codec_list.c</code>  :<br>
</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> AVCodec * <span class="hljs-keyword">const</span> codec_list[] = {
<span class="hljs-comment">// ...</span><font></font>
    &amp;ff_frox_encoder,<font></font>
<span class="hljs-comment">// ...</span><font></font>
    &amp;ff_frox_decoder,<font></font>
<span class="hljs-comment">// ...</span>
    <span class="hljs-literal">NULL</span> };</code></pre><br>
<p>     <code>configure</code>   <code>config.h</code>,     <br>
</p><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CONFIG_FROX_DECODER 1</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CONFIG_FROX_ENCODER 1</span></code></pre><br>
<p><b> 5.  <code>libavcodec/Makefile</code></b><br>
</p><br>
<p> <code>libavcodec/Makefile</code>.   <code># decoders/encoders</code>,   <br>
</p><br>
<pre><code class="cpp hljs">OBJS-$(CONFIG_FROX_DECODER) += frox.o<font></font>
OBJS-$(CONFIG_FROX_ENCODER) += frox.o</code></pre><br>
<p><b> 6.     .</b><br>
</p><br>
<p> (muxer)   (demuxer)  Â«Â»  .         ,        .       <code>matroska</code> ( <code>*.mkv</code>).<br>
</p><br>
<p>1.   <code>libavformat/matroska.c</code>   <code>ff_mkv_codec_tags</code>     :<br>
</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">const</span> CodecTags ff_mkv_codec_tags[] = {
<span class="hljs-comment">// ...</span>
    {<span class="hljs-string">"A_FROX"</span>, AV_CODEC_ID_FROX},
<span class="hljs-comment">// ...</span>
};</code></pre><br>
<p> <code>"A_FROX"</code>          .        ,        .       <code>codec_id</code>  <code>AVCodecParameters</code>.        <code>AVStream</code>.<br>
</p><br>
<p>2.   <code>libavformat/matroskaenc.c</code>   <code>additional_audio_tags</code>  :<br>
</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> AVCodecTag additional_audio_tags[] = {
<span class="hljs-comment">// ...</span>
    { AV_CODEC_ID_FROX, <span class="hljs-number">0XFFFFFFFF</span> },
<span class="hljs-comment">// ...</span>
};</code></pre><br>
<p>  .    <code>configure</code>.    ,       <code>libavcodec/codec_list.c</code>  <code>config.h</code> .     :<br>
</p><br>
<p><code>make clean<br>
make<br>
</code><br>
</p><br>
<p>    ,    <code>ffmpeg</code> ( <code>ffmpeg.exe</code>,     Windows).  <br>
</p><br>
<p><code>./ffmpeg -codecs &gt;codecs.txt<br>
</code><br>
</p><br>
<p> ,  FFmpeg Â«Â»   ,   <code>codecs.txt</code>  <br>
</p><br>
<p><code>DEA..S frox FROX audio (decoders: frox_dec) (encoders: frox_enc)<br>
</code><br>
</p><br>
<a name="id-3"></a><br>
<h1>3.      </h1><br>
<p>     ,         .<br>
</p><br>
<a name="id-3-1"></a><br>
<h2>3.1.  </h2><br>
<p>     .       ,   . ,   ,          <code>AVClass</code>    .<br>
</p><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"libavutil/opt.h"</span></span><font></font>
<font></font>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">FroxContext</span> {</span>
    <span class="hljs-keyword">const</span> AVClass *av_class;
    <span class="hljs-keyword">int</span>      frox_int;
    <span class="hljs-keyword">char</span>    *frox_str;
    <span class="hljs-keyword">uint8_t</span> *frox_bin;
    <span class="hljs-keyword">int</span>      bin_size;<font></font>
} FroxContext;</code></pre><br>
<p>     <code>AVOption</code>,       .<br>
</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> AVOption frox_options[] = {<font></font>
  { <span class="hljs-string">"frox_int"</span>,
    <span class="hljs-string">"This is a demo option of int type."</span>,<font></font>
    offsetof(FroxContext, frox_int),<font></font>
    AV_OPT_TYPE_INT,<font></font>
    { .i64 = <span class="hljs-number">-1</span> },
    <span class="hljs-number">1</span>, SHRT_MAX },<font></font>
  { <span class="hljs-string">"frox_str"</span>,
    <span class="hljs-string">"This is a demo option of string type."</span>,<font></font>
    offsetof(FroxContext, frox_str),<font></font>
    AV_OPT_TYPE_STRING },<font></font>
  { <span class="hljs-string">"frox_bin"</span>,
    <span class="hljs-string">"This is a demo option of binary type."</span>,<font></font>
    offsetof(FroxContext, frox_bin),<font></font>
    AV_OPT_TYPE_BINARY },<font></font>
  { <span class="hljs-literal">NULL</span> },<font></font>
};</code></pre><br>
<p>     , ,   , .             .<br>
</p><br>
<p>     <code>AVClass</code>.<br>
</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> AVClass frox_class = {<font></font>
    .class_name = <span class="hljs-string">"FroxContext"</span>,<font></font>
    .item_name  = av_default_item_name,<font></font>
    .option     = frox_options,<font></font>
    .version    = LIBAVUTIL_VERSION_INT,<font></font>
};</code></pre><br>
<p>          <code>AVCodec</code>.<br>
</p><br>
<pre><code class="cpp hljs">AVCodec ff_frox_decoder = {
<span class="hljs-comment">// ...</span>
    .priv_data_size = <span class="hljs-keyword">sizeof</span>(FroxContext),<font></font>
    .priv_class = &amp;frox_class,<font></font>
<span class="hljs-comment">// ...</span><font></font>
};<font></font>
<font></font>
AVCodec ff_frox_encoder = {<font></font>
<span class="hljs-comment">// ...</span>
    .priv_data_size = <span class="hljs-keyword">sizeof</span>(FroxContext),<font></font>
    .priv_class = &amp;frox_class,<font></font>
<span class="hljs-comment">// ...</span>
};</code></pre><br>
<p>   <br>
</p><br>
<pre><code class="cpp hljs"><span class="hljs-function">AVCodecContext *<span class="hljs-title">avcodec_alloc_context3</span><span class="hljs-params">(<span class="hljs-keyword">const</span> AVCodec *codec)</span></span>;</code></pre><br>
<p>    <code>AVCodecContext</code>    <code>codec</code>.     <code>codec-&gt;priv_data_size</code>       <code>FroxContext</code>,   <code>codec-&gt;priv_class</code>             <code>av_opt_set_defaults()</code>,       .    <code>FroxContext</code>     <code>priv_data</code>  <code>AVCodecContext</code>.<br>
</p><br>
<p>   FFmpeg API      .<br>
</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">const</span> AVCodec *codec;
<span class="hljs-comment">// ...</span><font></font>
AVCodecContext *codec_ctx = avcodec_alloc_context3(codec);<font></font>
<span class="hljs-comment">// ...</span>
av_opt_set(codec_ctx-&gt;priv_data, <span class="hljs-string">"frox_str"</span>, <span class="hljs-string">"meow"</span>, <span class="hljs-number">0</span>);<font></font>
av_opt_set_int(codec_ctx-&gt;priv_data, <span class="hljs-string">"frox_int"</span>, <span class="hljs-number">42</span>, <span class="hljs-number">0</span>);</code></pre><br>
<p>  â€”    ,        <code>avcodec_open2()</code> (. ).<br>
</p><br>
<p>  <br>
</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">const</span> AVOption* <span class="hljs-title">av_opt_next</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span>* ctx, <span class="hljs-keyword">const</span> AVOption* prev)</span></span>;</code></pre><br>
<p>    ,   .      .      ,  <code>codec_ctx-&gt;codec-&gt;priv_class</code>    ,                 .<br>
</p><br>
<a name="id-3-2"></a><br>
<h2>3.2. </h2><br>
<p>  ,   ,       /.         <code>FroxContext</code>.<br>
</p><br>
<pre><code class="cpp hljs">AVCodecContext *codec_ctx;
<span class="hljs-comment">// ...</span>
FroxContext* frox_ctx = codec_ctx-&gt;priv_data;</code></pre><br>
<p> <code>frox_decode_init()</code>  <code>frox_encode_init()</code>     <br>
</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">avcodec_open2</span><span class="hljs-params">(
    AVCodecContext *codec_ctx, 
    <span class="hljs-keyword">const</span> AVCodec *codec, 
    AVDictionary **options)</span></span>;</code></pre><br>
<p>        ,        <code>AVCodecContext</code>,  <code>frame_size</code>  .<br>
</p><br>
<p> <code>frox_decode_close()</code>  <code>frox_encode_close()</code>    <br>
</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">avcodec_close</span><span class="hljs-params">(AVCodecContext *codec_ctx)</span></span>;</code></pre><br>
<p>     .<br>
</p><br>
<p>    <br>
</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">frox_decode</span><span class="hljs-params">(
    AVCodecContext *codec_ctx,
    <span class="hljs-keyword">void</span> *outdata,
    <span class="hljs-keyword">int</span> *outdata_size,
    AVPacket *pkt)</span></span>;</code></pre><br>
<p>    :<br>
</p><br>
<ol>
<li> ;</li>
<li>     ;</li>
<li>     .</li>
</ol><br>
<p>,        .  <code>outdata</code>      <code>AVFrame</code>,      :<br>
</p><br>
<pre><code class="cpp hljs">AVFrame* frm = outdata;</code></pre><br>
<p>       .      <code>AVFrame</code>,    .    <code>nb_samples</code>, <code>channel_layout</code>, <code>format</code> (  <code>width</code>, <code>height</code>, <code>format</code>).<br>
</p><br>
<p>    <br>
</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">av_frame_get_buffer</span><span class="hljs-params">(AVFrame* frm, <span class="hljs-keyword">int</span> alignment)</span></span>;</code></pre><br>
<p>       ,    <code>outdata</code>,      .    (    ), ,   ,  <br>
</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">av_frame_unref</span><span class="hljs-params">(AVFrame* frm)</span></span>;</code></pre><br>
<p> <code>frox_decode()</code>    ,   ,  ,    <code>pkt</code>.    ,  ,    <code>outdata_size</code>   ,      <code>0</code>.<br>
</p><br>
<p>    <br>
</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">frox_encode</span><span class="hljs-params">(
    AVCodecContext *codec_ctx,
    AVPacket *pkt,
    <span class="hljs-keyword">const</span> AVFrame *frame,
    <span class="hljs-keyword">int</span> *got_pkt_ptr)</span></span>;</code></pre><br>
<p>    :<br>
</p><br>
<ol>
<li> ;</li>
<li>     ;</li>
<li>     .</li>
</ol><br>
<p>     <br>
</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">av_new_packet</span><span class="hljs-params">(AVPacket *pkt, <span class="hljs-keyword">int</span> pack_size)</span></span>;</code></pre><br>
<p>      <code>pkt</code>,      .    (    ), ,   ,  <br>
</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">av_packet_unref</span><span class="hljs-params">(AVPacket *pkt)</span></span>;</code></pre><br>
<p>   ,  ,    <code>got_pkt_ptr</code>   ,      <code>0</code>.    ,   ,   .<br>
</p><br>
<p>      (      ).  :<br>
</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">frox_decode_close</span><span class="hljs-params">(AVCodecContext *codec_ctx)</span>
</span>{<font></font>
    av_log(codec_ctx, AV_LOG_INFO, <span class="hljs-string">"FROX decode close\n"</span>);
<span class="hljs-comment">// ...</span>
}</code></pre><br>
<p>              .<br>
</p><br>
<a name="id-3-3"></a><br>
<h2>3.3.  </h2><br>
<p>    FFmpeg    (time base),       ,   <code>AVRational</code>. (    C++11.  1/1000  .)       (timestamps),   <code>int64_t</code>,        . ,    <code>AVFrame</code>,   <code>pts</code> (presentation timestamp),      ,   . ,    <code>AVPacket</code>,   <code>pts</code> (presentation timestamp)  <code>dts</code> (decompression timestamp).  <code>dts</code>       .       <code>pts</code>,       (  <code>h264</code>   B-frames),              .<br>
</p><br>
<p>      ,  <code>AVStream</code>    â€” <code>time_base</code>,      <code>AVCodecContext</code>.<br>
</p><br>
<p>  ,      <code>av_read_frame()</code>,       .       .       ,      â€”    .             . FFmpeg          <code>best_effort_timestamp</code>  <code>AVFrame</code>.         ,    .<br>
</p><br>
<p>     .   ,  ,      <code>time_base</code>  <code>AVCodecContext</code>   <code>avcodec_open2()</code>.    ,      .    ,     ,      â€”    .       ,   .        <code>time_base</code>   <code>avcodec_open2()</code> ,   ,         .      <code>pts</code>  <code>dts</code> .  ,                   .     <br>
</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">av_packet_rescale_ts</span><span class="hljs-params">(
    AVPacket *pkt, 
    AVRational tb_src, 
    AVRational tb_dst)</span></span>;</code></pre><br>
<p>      ,   <code>dts</code>  ,    . ( .    <code>av_interleaved_write_frame()</code>.)<br>
</p><br>
<a name="id-3-4"></a><br>
<h2>3.4.  ,  </h2><br>
<p>   <code>AVCodec</code>     .    <code>AVCodec</code>:<br>
</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">AVCodec</span> {</span>
<span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">void</span> (*init_static_data)(AVCodec *codec);
    <span class="hljs-keyword">void</span> (*flush)(AVCodecContext *codec_ctx);
<span class="hljs-comment">// ...</span>
} AVCodec;</code></pre><br>
<p>        .<br>
</p><br>
<p>    ,       <br>
</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">avcodec_flush_buffers</span><span class="hljs-params">(AVCodecContext *codec_ctx)</span></span>;</code></pre><br>
<p>  , ,      .<br>
</p><br>
<a name="id-4"></a><br>
<h1>4.   </h1><br>
<a name="id-4-1"></a><br>
<h2>4.1.   </h2><br>
<p>    : ,   FFmpeg,   ,    /    (  pluginâ€™),   FFmpeg.<br>
</p><br>
<p>       .    :<br>
</p><br>
<ol>
<li>      ,   FFmpeg    ;</li>
<li>    C,    ,   C++;</li>
<li>    framework,     FFmpeg.</li>
</ol><br>
<p>   ,   FFmpeg       Â«Â»,         FFmpeg API.             Â«Â» FFmpeg       (  ,     ),     .    â€”     .         .<br>
</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">typedef</span> <span class="hljs-title">int</span><span class="hljs-params">(*<span class="hljs-keyword">dec_extern_t</span>)</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span>*, <span class="hljs-keyword">int</span>, <span class="hljs-keyword">void</span>*)</span></span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">frox_decode</span><span class="hljs-params">(
    AVCodecContext* codec_ctx,
    <span class="hljs-keyword">void</span>* outdata,
    <span class="hljs-keyword">int</span> *outdata_size,
    AVPacket* pkt)</span>
</span>{
    <span class="hljs-keyword">int</span> ret = <span class="hljs-number">-1</span>;
    <span class="hljs-keyword">void</span>* out_buff;
    <span class="hljs-comment">//      out_buff</span><font></font>
    FroxContext *fc = codec_ctx-&gt;priv_data;<font></font>
    <span class="hljs-keyword">if</span> (fc-&gt;bin_size &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">if</span> (fc-&gt;bin_size == <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">dec_extern_t</span>)) {
            <span class="hljs-keyword">dec_extern_t</span> edec;
            <span class="hljs-built_in">memcpy</span>(&amp;edec, fc-&gt;frox_bin, fc-&gt;bin_size);<font></font>
            ret = (*edec)(pkt-&gt;data, pkt-&gt;size, out_buff);<font></font>
            <span class="hljs-keyword">if</span> (ret &gt;= <span class="hljs-number">0</span>) {
            <span class="hljs-comment">//     out_buff  </span><font></font>
            }<font></font>
        }<font></font>
        <span class="hljs-keyword">else</span> { <span class="hljs-comment">/*  */</span> }<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span> { <span class="hljs-comment">/*    */</span> }
<span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">return</span> ret;<font></font>
}</code></pre><br>
<p>   FFmpeg API (     C++)    .<br>
</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">DecodeFroxData</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span>* buff, <span class="hljs-keyword">int</span> size, <span class="hljs-keyword">void</span>* outBuff)</span></span>;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">typedef</span> <span class="hljs-title">int</span><span class="hljs-params">(*<span class="hljs-keyword">dec_extern_t</span>)</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span>*, <span class="hljs-keyword">int</span>, <span class="hljs-keyword">void</span>*)</span></span>;<font></font>
<font></font>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;libavcodec/avcodec.h&gt;</span></span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;libavutil/opt.h&gt;</span></span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// ...</span><font></font>
    AVCodecContext* ctx;<font></font>
<span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">dec_extern_t</span> dec = DecodeFroxData;
    <span class="hljs-keyword">void</span>* pv = &amp;dec;
    <span class="hljs-keyword">auto</span> pb = <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">const</span> <span class="hljs-keyword">uint8_t</span>*&gt;(pv);
    <span class="hljs-keyword">auto</span> sz = <span class="hljs-keyword">sizeof</span>(dec);<font></font>
    av_opt_set_bin(ctx-&gt;priv_data, <span class="hljs-string">"frox_bin"</span>, pb, sz, <span class="hljs-number">0</span>);</code></pre><br>
<a name="id-4-2"></a><br>
<h2>4.2.  </h2><br>
<p>      â€”     .        ,   . ,      .  ,   ,  FFmpeg     ,   Â«Â» ,        .         .     ,   .   FFmpeg API  -       ,   ,      .     .        ,        .     PC (Windows)      DirectShow  AVI .  PC             -   DirectShow.     32- FourCC. (   <code>biCompression</code>  <code>BITMAPINFOHEADER</code>.)  ,      DirectShow   ,   PC    -.        FFmpeg  , ,   ,   <code>codec_tag</code>  <code>AVCodecParameters</code>   FourCC,     .       FFmpeg API    ,    .             FFmpeg   FFmpeg API.<br>
</p><br>
<p>         ,   <code>*.mkv</code>  FFmpeg     ( <code>ENCODER</code>).<br>
</p><br>
<a name="id-concl"></a><br>
<h1></h1><br>
<p>       ,   ,       FFmpeg: , changelog,     ..     Â«Â»  FFmpeg,     ,     .<br>
</p><br>
<a name="id-refs"></a><br>
<h1></h1><br>
<p><b>   FFmpeg</b></p><br>
<p>[1] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">FFmpeg â€”  </a><br>
[2] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">FFmpeg â€” </a><br>
[3] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">FFmpeg â€” </a><br>
[4] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">FFmpeg â€”    Ubuntu</a><br>
</p><br>
<p><b></b></p><br>
<p>[5] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">FFmpeg Compilation Guide</a><br>
[6] Compilation of FFmpeg 4.0 in Windows 10<br>
</p><br>
<p><b>   FFmpeg API</b></p><br>
<p>[7] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">   ffmpeg</a><br>
</p><br>
<p><b> </b></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[8] </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FFmpeg </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«</font></a></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
[9] </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FFmpegãƒ“ãƒ‡ã‚ªã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«</font></font></a><br>
</p><br>
<br>
<br></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja480700/index.html">Chromeã§ã¯console.logï¼ˆï¼‰ã‚’å®Œå…¨ã«ä½¿ç”¨ã—ã¾ã™</a></li>
<li><a href="../ja480702/index.html">äººäº‹ã€ã‚¿ãƒ¬ãƒ³ãƒˆã€ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã€ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ï¼š8å›ç›®ã®ãƒãƒ–ãƒ©ã‚»ãƒŸãƒŠãƒ¼ã¯ã„ã‹ãŒã§ã—ãŸã‹</a></li>
<li><a href="../ja480704/index.html">ã‚µã‚¤ãƒˆä¸Šã§ã‚¢ãƒ€ãƒ—ãƒ†ã‚£ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®èª­ã¿è¾¼ã¿ã‚’è¡Œã„ã¾ã™</a></li>
<li><a href="../ja480708/index.html">æ•°åå¹´ãŒçµ‚ã‚ã‚Šã«è¿‘ã¥ã„ã¦ã„ã¾ã™ã€‚Google Playã§éå»10å¹´é–“ã«æœ€ã‚‚ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸã‚¢ãƒ—ãƒªã¯ã©ã‚Œã§ã™ã‹ã€‚</a></li>
<li><a href="../ja480710/index.html">SFMLã‚²ãƒ¼ãƒ ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°</a></li>
<li><a href="../ja480716/index.html">Matlabå¯¾ ã‚¸ãƒ¥ãƒªã‚¢å¯¾ ãƒ‘ã‚¤ã‚½ãƒ³</a></li>
<li><a href="../ja480718/index.html">ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æˆåŠŸã•ã›ã‚‹ãŸã‚ã®6ã¤ã®ãƒ’ãƒ³ãƒˆ</a></li>
<li><a href="../ja480722/index.html">K8sã®Redisã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼ã¨ã€ã“ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã™ã‚‹ãŸã‚ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®ç°¡å˜ãªæ¦‚è¦</a></li>
<li><a href="../ja480724/index.html">ãƒˆãƒ©ãƒ³ã‚¹ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã‚ŒãŸè¨€èªï¼šã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã‚³ãƒ¼ãƒ‰ã¸ã®å¤‰æ›ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</a></li>
<li><a href="../ja480730/index.html">è‡ªå‹•ãƒ¢ãƒˆé–‹ç™ºã¨Nginx</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>