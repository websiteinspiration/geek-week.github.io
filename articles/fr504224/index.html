<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸŒ¸ ğŸ¯ ğŸš² Comment avons-nous survÃ©cu Ã  la forte augmentation de la charge x10 sur le site distant et quelles conclusions ğŸ§œğŸ¾ ğŸ¦Š ğŸ¤¸ğŸ¾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, Habr! Les deux derniers mois, nous avons vÃ©cu une situation trÃ¨s intÃ©ressante et je voudrais partager notre histoire de mise Ã  l'Ã©chelle des ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Comment avons-nous survÃ©cu Ã  la forte augmentation de la charge x10 sur le site distant et quelles conclusions</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sbermarket/blog/504224/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bonjour, Habr! </font><font style="vertical-align: inherit;">Les deux derniers mois, nous avons vÃ©cu une situation trÃ¨s intÃ©ressante et je voudrais partager notre histoire de mise Ã  l'Ã©chelle des infrastructures. </font><font style="vertical-align: inherit;">Pendant ce temps, SberMarket a multipliÃ© par 4 ses commandes et a lancÃ© un service dans 17 nouvelles villes. </font><font style="vertical-align: inherit;">La croissance explosive de la demande de produits alimentaires nous a obligÃ©s Ã  agrandir notre infrastructure. </font><font style="vertical-align: inherit;">Lisez les dÃ©couvertes les plus intÃ©ressantes et utiles sous le chat.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ln/el/ry/lnelryyy8ylmld9qzjuwsdfrafo.gif"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je m'appelle Dima Bobylev, je suis le directeur technique de SberMarket. </font><font style="vertical-align: inherit;">Comme il s'agit du premier article de notre blog, je vais dire quelques mots sur moi et sur l'entreprise. </font><font style="vertical-align: inherit;">L'automne dernier, j'ai participÃ© au concours des jeunes leaders du Runet. </font><font style="vertical-align: inherit;">Pour le concours, j'ai </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã©crit une courte histoire</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur la faÃ§on dont nous, chez SberMarket, voyons la culture interne et l'approche du dÃ©veloppement du service. </font><font style="vertical-align: inherit;">Et bien qu'il n'ait pas Ã©tÃ© possible de gagner le concours, j'ai formulÃ© pour moi-mÃªme les principes de base pour le dÃ©veloppement de l'Ã©cosystÃ¨me informatique.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors de la gestion d'une Ã©quipe, il est important de comprendre et de trouver un Ã©quilibre entre les besoins de l'entreprise et les besoins de chaque dÃ©veloppeur spÃ©cifique. Maintenant, SberMarket croÃ®t 13 fois d'annÃ©e en annÃ©e, ce qui affecte le produit, nÃ©cessitant une augmentation constante du volume et du rythme de dÃ©veloppement. MalgrÃ© cela, nous consacrons suffisamment de temps aux dÃ©veloppeurs pour l'analyse prÃ©liminaire et l'Ã©criture de code de haute qualitÃ©. L'approche formÃ©e aide non seulement Ã  crÃ©er un produit fonctionnel, mais Ã©galement Ã  poursuivre sa mise Ã  l'Ã©chelle et son dÃ©veloppement. GrÃ¢ce Ã  cette croissance, SberMarket est dÃ©jÃ  devenu un leader des services de livraison de nourriture: nous livrons environ 18 000 commandes par jour chaque jour, mÃªme si dÃ©but fÃ©vrier, il y en avait environ 3 </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7v/jy/m7/7vjym762x2sa2ehkkvlwtzgi-og.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">500. Une fois qu'un client a demandÃ© au coursier SberMarket de lui livrer des produits sans contact - directement sur le balcon</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais passons aux dÃ©tails. </font><font style="vertical-align: inherit;">Au cours des derniers mois, nous avons activement mis Ã  l'Ã©chelle l'infrastructure de notre entreprise. </font><font style="vertical-align: inherit;">Un tel besoin s'explique par des facteurs externes et internes. </font><font style="vertical-align: inherit;">ParallÃ¨lement Ã  l'expansion de la clientÃ¨le, le nombre de magasins connectÃ©s est passÃ© de 90 en dÃ©but d'annÃ©e Ã  plus de 200 Ã  la mi-mai. </font><font style="vertical-align: inherit;">Bien sÃ»r, nous avons prÃ©parÃ©, rÃ©servÃ© l'infrastructure principale et comptÃ© sur la possibilitÃ© de mise Ã  l'Ã©chelle verticale et horizontale de toutes les machines virtuelles situÃ©es dans le cloud Yandex. </font><font style="vertical-align: inherit;">Cependant, la pratique a montrÃ©: "Tout ce qui peut mal tourner va mal". </font><font style="vertical-align: inherit;">Et aujourd'hui, je veux partager les situations les plus intÃ©ressantes qui se sont produites au cours de ces semaines. </font><font style="vertical-align: inherit;">J'espÃ¨re que notre expÃ©rience vous sera utile.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esclave en pleine alerte</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MÃªme avant le dÃ©but de la pandÃ©mie, nous Ã©tions confrontÃ©s Ã  une augmentation du nombre de demandes adressÃ©es Ã  nos serveurs principaux. La tendance Ã  commander des produits avec livraison Ã  domicile a commencÃ© Ã  prendre de l'ampleur, et avec l'introduction des premiÃ¨res mesures d'auto-isolement en rapport avec COVID-19, la charge a augmentÃ© de faÃ§on spectaculaire sous nos yeux toute la journÃ©e. Il Ã©tait nÃ©cessaire de dÃ©charger rapidement les serveurs maÃ®tres de la base de donnÃ©es principale et de transfÃ©rer une partie des demandes de lecture vers les serveurs de rÃ©plique (esclaves). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous nous prÃ©parions Ã  l'avance pour cette Ã©tape, et pour une telle manÅ“uvre, 2 serveurs esclaves avaient dÃ©jÃ  Ã©tÃ© lancÃ©s. Ils ont principalement travaillÃ© sur des tÃ¢ches batch de gÃ©nÃ©ration de flux d'informations pour l'Ã©change de donnÃ©es avec des partenaires. Ces processus ont crÃ©Ã© une charge supplÃ©mentaire et, Ã  juste titre, ont Ã©tÃ© mis Â«en dehors des supportsÂ» quelques mois plus tÃ´t.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme il y avait une rÃ©plication sur Slave, nous avons adhÃ©rÃ© au concept selon lequel les applications ne peuvent fonctionner qu'avec elles en mode lecture seule. Le plan de reprise aprÃ¨s sinistre a suggÃ©rÃ© qu'en cas de catastrophe, nous pourrions simplement monter l'esclave Ã  la place du maÃ®tre et basculer toutes les demandes d'Ã©criture et de lecture sur l'esclave. Cependant, nous voulions Ã©galement utiliser des rÃ©pliques pour les besoins du dÃ©partement analytique, de sorte que les serveurs n'Ã©taient pas complÃ¨tement transfÃ©rÃ©s en lecture seule, et chaque hÃ´te avait son propre ensemble d'utilisateurs, et certains avaient des autorisations d'Ã©criture pour enregistrer les rÃ©sultats de calcul intermÃ©diaires.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jusqu'Ã  un certain niveau de charge, nous avions suffisamment d'assistants pour Ã©crire et lire lors du traitement des requÃªtes http. Ã€ la mi-mars, juste au moment oÃ¹ Sbermarket a dÃ©cidÃ© de passer complÃ¨tement Ã  un site distant, nous avons commencÃ© une augmentation multiple du RPS. De plus en plus de nos clients ont optÃ© pour l'auto-isolement ou le travail Ã  domicile, comme en tÃ©moignent les indicateurs de charge. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les performances du Â«maÃ®treÂ» n'Ã©taient plus suffisantes, nous avons donc commencÃ© Ã  subir certaines des demandes de lecture les plus lourdes pour une rÃ©plique. Pour envoyer de maniÃ¨re transparente des demandes d'Ã©criture au maÃ®tre et de lecture Ã  l'esclave, nous avons utilisÃ© ruby â€‹â€‹gem Â« </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Octopus</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">". Nous avons crÃ©Ã© un utilisateur spÃ©cial avec le suffixe _readonly sans autorisation d'Ã©criture. Mais en raison d'une erreur dans la configuration de l'un des hÃ´tes, une partie des demandes d'Ã©criture est allÃ©e au serveur esclave au nom d'un utilisateur disposant des droits appropriÃ©s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le problÃ¨me ne s'est pas manifestÃ© immÃ©diatement, car une charge accrue a augmentÃ© le dÃ©calage de l'esclave. L'incohÃ©rence des donnÃ©es a Ã©tÃ© rÃ©vÃ©lÃ©e le matin lorsque, aprÃ¨s les importations nocturnes, les esclaves n'ont pas Â«rattrapÃ©Â» le maÃ®tre. Nous avons attribuÃ© cela Ã  la charge Ã©levÃ©e sur le service lui-mÃªme et Ã  l'importation associÃ©e au lancement de nouveaux magasins. Mais donner des informations sur les nombreuses heures de retard Ã©tait inacceptable, et nous sommes passÃ©s au deuxiÃ¨me processus analytique l'esclave, car il avait utilisÃ© </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur des</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ressources lshie et n'Ã©tait pas chargÃ© de requÃªtes de lecture (et nous nous sommes expliquÃ©s Ã  l'absence de retard de rÃ©plication).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque nous avons compris les raisons du Â«fluageÂ» de l'esclave principal, l'analyse a dÃ©jÃ  Ã©chouÃ© pour la mÃªme raison. MalgrÃ© la prÃ©sence de deux serveurs supplÃ©mentaires, sur lesquels nous avions prÃ©vu de transfÃ©rer la charge en cas de crash principal, suite Ã  une malheureuse erreur, il s'est avÃ©rÃ© qu'Ã  un moment critique il n'y en avait pas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais comme nous n'avons pas seulement vidÃ© la base de donnÃ©es (le reste Ã  ce moment-lÃ  Ã©tait d'environ 5 heures), mais aussi un serveur maÃ®tre d'instantanÃ©s, nous avons rÃ©ussi Ã  dÃ©marrer la rÃ©plique dans les 2 heures. Certes, aprÃ¨s cela, nous devions rouler le journal de rÃ©plication pendant une longue pÃ©riode (car le processus est en mode monothread, mais c'est une histoire complÃ¨tement diffÃ©rente).</font></font><br>
<br>
<blockquote><strong>:</strong>     ,            readonly  .      ,        .</blockquote><br>
<h3>      Â«  Â» </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien que nous mettions constamment Ã  jour le catalogue sur le site, les demandes que nous avons faites aux serveurs Slave ont permis un lÃ©ger dÃ©calage de la part de Master. Le temps pendant lequel nous avons dÃ©couvert et Ã©liminÃ© le problÃ¨me des Â«abandons soudains de la distanceÂ» des esclaves Ã©tait plus qu'une Â«barriÃ¨re psychologiqueÂ» (pendant ce temps, les prix auraient pu Ãªtre mis Ã  jour et les clients auraient vu des donnÃ©es obsolÃ¨tes), et nous avons dÃ» basculer toutes les demandes vers le serveur de base de donnÃ©es principal. . En consÃ©quence, le site a fonctionnÃ© lentement ... mais au moins il a fonctionnÃ©. Et pendant que l'esclave rÃ©cupÃ©rait, nous n'avions pas d'autre choix que d'optimiser.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendant que les serveurs esclaves se rÃ©tablissaient, les minutes traÃ®naient lentement, le maÃ®tre restait surchargÃ© et nous avons consacrÃ© tous nos efforts Ã  l'optimisation des tÃ¢ches actives selon la rÃ¨gle de Pareto: nous avons sÃ©lectionnÃ© les requÃªtes TOP qui donnent la majeure partie de la charge et avons commencÃ© Ã  rÃ©gler. Cela a Ã©tÃ© fait directement "Ã  la volÃ©e".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un effet intÃ©ressant a Ã©tÃ© que MySQL chargÃ© dans le globe oculaire rÃ©pond mÃªme Ã  une lÃ©gÃ¨re amÃ©lioration des processus. </font><font style="vertical-align: inherit;">L'optimisation d'une paire de demandes, qui ne reprÃ©sentait que 5% de la charge totale, montrait dÃ©jÃ  un dÃ©chargement tangible du processeur. </font><font style="vertical-align: inherit;">En consÃ©quence, nous avons pu fournir un approvisionnement acceptable en ressources pour que Master puisse travailler avec la base de donnÃ©es et obtenir le temps nÃ©cessaire pour restaurer les rÃ©pliques.&nbsp;</font></font><br>
<br>
<blockquote><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mÃªme une petite optimisation vous permet de "survivre" pendant une surcharge pendant plusieurs heures. </font><font style="vertical-align: inherit;">C'Ã©tait juste assez pour nous lors de la rÃ©cupÃ©ration des serveurs avec des rÃ©pliques. </font><font style="vertical-align: inherit;">Soit dit en passant, nous discuterons du cÃ´tÃ© technique de l'optimisation des requÃªtes dans l'un des articles suivants. </font><font style="vertical-align: inherit;">Alors abonnez-vous Ã  notre blog si cela peut vous Ãªtre utile.</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Organiser le suivi des performances des services partenaires</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous sommes engagÃ©s dans le traitement des commandes des clients, et donc nos services interagissent constamment avec des API tierces - ce sont des passerelles pour envoyer des SMS, des plates-formes de paiement, des systÃ¨mes de routage, un gÃ©ocodeur, le Federal Tax Service et de nombreux autres systÃ¨mes. Et lorsque la charge a commencÃ© Ã  augmenter rapidement, nous avons commencÃ© Ã  nous reposer sur les limitations API de nos partenaires de service, auxquelles nous n'avions mÃªme pas pensÃ© auparavant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un excÃ¨s inattendu de quotas pour les services d'affiliation peut entraÃ®ner des temps d'arrÃªt de votre choix. De nombreuses API bloquent les clients qui dÃ©passent les limites et, dans certains cas, un excÃ¨s de demandes peut surcharger la production avec un partenaire.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, au moment d'augmenter le nombre de livraisons, les services d'accompagnement ne pouvaient pas faire face aux tÃ¢ches de leur distribution, dÃ©termination des itinÃ©raires. En consÃ©quence, il s'est avÃ©rÃ© que les commandes ont Ã©tÃ© passÃ©es et le service crÃ©ant l'itinÃ©raire ne fonctionne pas. Je dois dire que nos logisticiens ont rendu cela presque impossible dans ces conditions, et l'interaction claire de l'Ã©quipe a aidÃ© Ã  compenser les pannes de service temporaires. Mais un tel volume d'applications est impossible Ã  traiter manuellement manuellement, et aprÃ¨s un certain temps, nous rencontrerions un Ã©cart inacceptable entre les ordres et leur exÃ©cution.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un certain nombre de mesures organisationnelles ont Ã©tÃ© prises et le travail coordonnÃ© de l'Ã©quipe a permis de gagner du temps pendant que nous convenions de nouvelles conditions et attendions la modernisation des services de certains partenaires. Il existe d'autres API qui vous plairont avec une endurance Ã©levÃ©e et des tarifs impies en cas de trafic Ã©levÃ©. Par exemple, au dÃ©but, nous avons utilisÃ© une API de mappage bien connue pour dÃ©terminer l'adresse d'un point de livraison. Mais Ã  la fin du mois, ils ont reÃ§u une bonne facture de prÃ¨s de 2 millions de roubles. AprÃ¨s cela, ils ont dÃ©cidÃ© de le remplacer rapidement. Je ne ferai pas de publicitÃ©, mais je dirai que nos dÃ©penses ont considÃ©rablement diminuÃ©.</font></font><br>
<img src="https://habrastorage.org/webt/mn/3x/qr/mn3xqrx5sj531isw8dmeoezlz1g.png"><br>
<blockquote><strong>: </strong>            .    ,    Â«  Â»,   ,        . , ,    &nbsp;      .&nbsp;</blockquote><br>
<h3> ,  Â«<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  </a>Â» ()  </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous sommes habituÃ©s Ã  Â«brancherÂ» la base de donnÃ©es principale ou les serveurs d'applications, mais lors de la mise Ã  l'Ã©chelle, des problÃ¨mes peuvent apparaÃ®tre lÃ  oÃ¹ ils n'Ã©taient pas attendus. Pour la recherche en texte intÃ©gral sur le site, nous utilisons le moteur Apache Solr. Avec une augmentation de la charge, nous avons notÃ© une diminution du temps de rÃ©ponse, et la charge du processeur serveur a atteint 100%. Quoi de plus simple - nous donnerons plus de ressources au conteneur avec Solr. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au lieu du gain de performances attendu, le serveur est simplement Â«mortÂ». Il s'est immÃ©diatement chargÃ© Ã  100% et a rÃ©pondu encore plus lentement. Au dÃ©part, nous avions 2 cÅ“urs et 2 Go de RAM. Nous avons dÃ©cidÃ© de faire ce qui aide habituellement - nous avons donnÃ© au serveur 8 cÅ“urs et 32 â€‹â€‹Go. Tout est devenu bien pire (exactement comment et pourquoi - nous le dirons dans un article sÃ©parÃ©).&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendant plusieurs jours, nous avons compris les subtilitÃ©s de ce problÃ¨me et atteint des performances optimales avec 8 cÅ“urs et 32 â€‹â€‹Go. </font><font style="vertical-align: inherit;">Cette configuration nous permet de continuer Ã  augmenter la charge aujourd'hui, ce qui est trÃ¨s important car la croissance n'est pas seulement en termes de clients, mais aussi en nombre de magasins connectÃ©s - sur 2 mois leur nombre a doublÃ©.&nbsp;</font></font><br>
<br>
<blockquote><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> les mÃ©thodes standard telles que Â«ajouter plus de ferÂ» ne fonctionnent pas toujours. </font><font style="vertical-align: inherit;">Ainsi, lors de l'extension d'un service, vous devez bien comprendre comment il utilise les ressources et prÃ©-tester son fonctionnement dans de nouvelles conditions.&nbsp;</font></font><br>
</blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sans Ã©tat - la clÃ© d'une mise Ã  l'Ã©chelle horizontale facile</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En gÃ©nÃ©ral, notre Ã©quipe adhÃ¨re Ã  une approche bien connue: les services ne doivent pas avoir d'Ã©tat sans Ã©tat et doivent Ãªtre indÃ©pendants de l'environnement d'exÃ©cution. Cela nous a permis de survivre Ã  la croissance de la charge par une simple mise Ã  l'Ã©chelle horizontale. Mais nous avions une exception de service - un gestionnaire pour les longues tÃ¢ches en arriÃ¨re-plan. Il Ã©tait engagÃ© dans l'envoi d'emails et de sms, le traitement d'Ã©vÃ©nements, la gÃ©nÃ©ration de flux, l'importation de prix et de stocks et le traitement d'images. Il se trouve que cela dÃ©pendait du stockage de fichiers local et Ã©tait en une seule copie.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque le nombre de tÃ¢ches dans la file d'attente du processeur a augmentÃ© (et cela s'est naturellement produit avec une augmentation du nombre de commandes), les performances de l'hÃ´te hÃ©bergeant le processeur et le stockage de fichiers sont devenues un facteur limitant. </font><font style="vertical-align: inherit;">En consÃ©quence, la mise Ã  jour de l'assortiment et des prix, l'envoi de notifications aux utilisateurs et de nombreuses autres fonctions critiques bloquÃ©es dans la file d'attente ont cessÃ©. </font><font style="vertical-align: inherit;">L'Ã©quipe Ops a rapidement migrÃ© le stockage de fichiers vers un stockage rÃ©seau de type S3, ce qui nous a permis d'Ã©lever plusieurs machines puissantes pour adapter le gestionnaire de tÃ¢ches en arriÃ¨re-plan.</font></font><br>
<br>
<blockquote><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La rÃ¨gle des apatrides doit Ãªtre respectÃ©e pour tous les composants, sans exception, mÃªme s'il semble "que nous ne dÃ©rangions pas du tout". </font><font style="vertical-align: inherit;">Il vaut mieux consacrer un peu de temps Ã  la bonne organisation du travail de tous les systÃ¨mes que de rÃ©Ã©crire le code Ã  la hÃ¢te et de rÃ©parer le service qui subit une surcharge.</font></font></blockquote><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7 principes pour une croissance intense</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MalgrÃ© la disponibilitÃ© de capacitÃ©s supplÃ©mentaires, dans le processus de croissance, nous avons marchÃ© sur quelques rÃ¢teaux. </font><font style="vertical-align: inherit;">Pendant ce temps, le nombre de commandes a augmentÃ© de plus de 4 fois. </font><font style="vertical-align: inherit;">Maintenant, nous livrons dÃ©jÃ  plus de 17 000 commandes par jour dans 62 villes et prÃ©voyons d'Ã©tendre encore notre gÃ©ographie - au premier semestre 2020, le service devrait Ãªtre lancÃ© dans toute la Russie. </font><font style="vertical-align: inherit;">Afin de faire face Ã  la charge croissante, en tenant compte des bosses dÃ©jÃ  pleines, nous avons dÃ©veloppÃ© pour nous-mÃªmes 7 principes de base du travail dans des conditions de croissance constante:</font></font><br>
<br>
<ol>
<li><strong>-</strong>.     Jira,   &nbsp;    .          .       â€”         .   ,    ,    ,      ,         .</li>
<li><strong> </strong>      .            Â« Â»   .  ,        ,      .           ,     .</li>
<li><strong> </strong>      . -,        . -,     ,           .</li>
<li><strong>   stateless. </strong>   ,        .      .          , ,   S3.     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> https://12factor.net</a>.         ,             .</li>
<li><strong>    . </strong>          ,     .  ,       ,  -    .         ,    .&nbsp;</li>
<li><strong>   . </strong>  ,       .         ,      SMS       .        ,     .</li>
<li><strong> .</strong>      ,       .     , ,    .       API,    -.      .</li>
</ol><br>
<h2></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Non sans pertes, mais nous avons survÃ©cu Ã  cette Ã©tape, et aujourd'hui nous essayons d'adhÃ©rer Ã  tous les principes trouvÃ©s, et chaque machine a la possibilitÃ© d'augmenter facilement les performances x4 pour faire face Ã  toutes les surprises.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans les articles suivants, nous partagerons notre expÃ©rience en matiÃ¨re d'enquÃªte sur la subsidence des performances dans Apache Solr, ainsi que sur l'optimisation des requÃªtes et la faÃ§on dont l'interaction avec le FTS permet Ã  l'entreprise d'Ã©conomiser de l'argent. </font><font style="vertical-align: inherit;">Abonnez-vous Ã  notre blog pour ne rien manquer et dites-nous dans les commentaires si vous avez eu de tels problÃ¨mes pendant la croissance du trafic.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ia/ky/jx/iakyjxz9atsneo1adhjxi_qpwyi.jpeg"></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr504214/index.html">Le dÃ©veloppement de DATA VAULT et la transition vers BUSINESS DATA VAULT</a></li>
<li><a href="../fr504216/index.html">Quel Ã¢ge a cette maison. Comment j'ai fait une carte de l'Ã¢ge des maisons Ã  Saint-PÃ©tersbourg</a></li>
<li><a href="../fr504218/index.html">ProductivitÃ©, stagiaires, seniors et perte d'esprit de la Silicon Valley. La grande interview de Zuckerberg sur le travail Ã  distance</a></li>
<li><a href="../fr504220/index.html">Service de vÃ©rification d'en-tÃªte HTTP du serveur</a></li>
<li><a href="../fr504222/index.html">L'hydrogÃ¨ne est Ã  la tÃªte de tout: comment l'Ã©nergie est gÃ©nÃ©rÃ©e Ã  partir de dÃ©bris plastiques pour un hÃ´tel japonais</a></li>
<li><a href="../fr504226/index.html">Le condensÃ© des Ã©vÃ©nements pour les recruteurs RH et IT en juin 2020</a></li>
<li><a href="../fr504228/index.html">RangeAmp - une nouvelle vulnÃ©rabilitÃ© permet des attaques DDoS avec un facteur d'amplification de dizaines de milliers</a></li>
<li><a href="../fr504230/index.html">NextDNS hors bÃªta - protection de la vie privÃ©e, contournement de la censure de l'Ã‰tat et blocage des publicitÃ©s pour l'ensemble du rÃ©seau domestique</a></li>
<li><a href="../fr504232/index.html">Comment un ingÃ©nieur devient Techlida</a></li>
<li><a href="../fr504236/index.html">DÃ©ployer l'image Docker sur Dokku avec Ansible</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>