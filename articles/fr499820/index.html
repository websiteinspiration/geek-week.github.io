<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüë®‚Äçüëß üòí üõ§Ô∏è Pourquoi nous avons choisi Kotlin comme l'une de nos langues cibles. Partie 2: Kotlin Multiplatform üí• üò§ ‚úçüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nous continuons la s√©rie d'articles sur l'introduction du langage Kotlin dans notre processus de d√©veloppement. Recherchez la premi√®re partie ici . 
 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Pourquoi nous avons choisi Kotlin comme l'une de nos langues cibles. Partie 2: Kotlin Multiplatform</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/domclick/blog/499820/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous continuons la s√©rie d'articles sur l'introduction du langage Kotlin dans notre processus de d√©veloppement. Recherchez la premi√®re partie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En 2017, l'ambitieux projet de Jetbrains a vu le jour, offrant une nouvelle perspective sur le d√©veloppement multiplateforme. Compilation du code kotlin en code natif de diverses plateformes! √Ä notre tour, √† Domklik, nous cherchons toujours des moyens d'optimiser le processus de d√©veloppement. Quoi de mieux que de r√©utiliser du code, pensons-nous? C'est vrai - n'√©crivez pas du code du tout. Et pour que tout fonctionne comme vous le souhaitez. Mais cela ne se produit pas. Et s'il existe une solution qui nous permettrait, sans trop d'efforts, d'utiliser une base de code unique pour diff√©rentes plateformes, pourquoi ne pas essayer?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alors bonjour √† tous! </font><font style="vertical-align: inherit;">Je m'appelle Gennady Vasilkov, je suis d√©veloppeur Android chez Domklik et aujourd'hui je veux partager avec vous notre exp√©rience dans le d√©veloppement de Kotlin Multiplatform pour les appareils mobiles, nous dire quelles difficult√©s nous avons rencontr√©es, comment nous avons r√©solu et avec quoi nous nous sommes retrouv√©s. </font><font style="vertical-align: inherit;">Le sujet int√©ressera s√ªrement ceux qui veulent essayer Kotlin MPP (projets multiplateformes), ou qui l'ont d√©j√† essay√©, mais qui n'ont pas termin√© la production. </font><font style="vertical-align: inherit;">Ou amen√©, mais pas comme je le voudrais. </font><font style="vertical-align: inherit;">Je vais essayer de transmettre notre vision de la fa√ßon dont le processus de d√©veloppement et de livraison des biblioth√®ques d√©velopp√©es doit √™tre organis√© (en utilisant l'une d'entre elles comme exemple, je vais vous dire le d√©but de notre chemin de d√©veloppement dans Kotlin MPP). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Souhaitez-vous des histoires sur la fa√ßon dont nous l'avons fait? </font><font style="vertical-align: inherit;">Nous les avons!</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ax/yh/d9/axyhd9vvdn715-ifysok3lk0gpg.jpeg"><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En bref sur la technologie</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour ceux qui n'ont pas encore entendu ou qui ne se sont pas plong√©s dans le sujet, il se bloque dans le monde Java et va simplement dans le monde Kotlin (ou n'y va pas, mais jette un ≈ìil): Kotlin MPP est une technologie qui vous permet d'utiliser du code une fois √©crit sur de nombreuses plateformes √† la fois. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le d√©veloppement est, sans surprise, dans le langage Kotlin dans IntelliJ IDEA ou Android Studio. Le plus est que tous les d√©veloppeurs Android (au moins avec nous) connaissent et aiment √† la fois le langage et ces merveilleux environnements de d√©veloppement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√âgalement un gros avantage dans la compilation du code r√©sultant dans les langues natives de chaque plate-forme (OBJ-C, JS, tout est clair avec JVM).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Autrement dit, tout est cool. </font><font style="vertical-align: inherit;">√Ä mon avis, Kotlin Multiplatform est id√©al pour apporter la logique m√©tier aux biblioth√®ques. </font><font style="vertical-align: inherit;">Il est √©galement possible d'√©crire une application compl√®tement, mais pour l'instant elle semble trop extr√™me, mais le d√©veloppement de la biblioth√®que convient √† des projets aussi importants que le n√¥tre.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un peu technique, pour comprendre comment fonctionne le projet sur le Kotlin MPP</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le syst√®me de construction est </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gradle</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , il prend en charge la syntaxe dans les scripts groovy et kotlin (kts).</font></font><br>
 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kotlin MPP a le concept de cibles - plates-formes cibles. </font><font style="vertical-align: inherit;">Dans ces blocs, les syst√®mes d'exploitation dont nous avons besoin sont configur√©s, dont le code natif compilera notre code sur Kotlin. </font><font style="vertical-align: inherit;">Dans l'image ci-dessous, 2 cibles sont impl√©ment√©es, jvm et js (l'image est partiellement tir√©e du </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">site Web</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ): la </font></font><br>
<img src="https://habrastorage.org/webt/xw/sd/qk/xwsdqkspxy9vbirtocrlj0cf2n8.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
prise en charge d'autres plates-formes est impl√©ment√©e de la m√™me mani√®re.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ensembles de sources - le nom lui-m√™me est clair que les codes sources des plates-formes sont stock√©s ici. </font><font style="vertical-align: inherit;">Il existe un ensemble de sources et une plate-forme communs (il y en a autant qu'il y a de cibles dans le projet, suivi par l'IDE). </font><font style="vertical-align: inherit;">Il est impossible de ne pas mentionner ici le m√©canisme attendu. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3c/yn/mw/3cynmwhc0ctyakpsq1awmjk9gmu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le m√©canisme permet d'acc√©der au code sp√©cifique √† la plate-forme √† partir du module commun. </font><font style="vertical-align: inherit;">Nous d√©clarons la d√©claration expect dans le module Common et l'impl√©mentons dans ceux de la plateforme. </font><font style="vertical-align: inherit;">Voici un exemple d'utilisation du m√©canisme pour obtenir la date sur les appareils:</font></font><br>
<br>
<pre><code class="kotlin hljs">Common:
<span class="hljs-keyword">internal</span> <span class="hljs-keyword">expect</span> <span class="hljs-keyword">val</span> timestamp: <span class="hljs-built_in">Long</span><font></font>
<font></font>
Android/JVM:<font></font>
<span class="hljs-keyword">internal</span> <span class="hljs-keyword">actual</span> <span class="hljs-keyword">val</span> timestamp: <span class="hljs-built_in">Long</span> 
    <span class="hljs-keyword">get</span>() = java.lang.System.currentTimeMillis()<font></font>
<font></font>
iOS:<font></font>
<span class="hljs-keyword">internal</span> <span class="hljs-keyword">actual</span> <span class="hljs-keyword">val</span> timestamp: <span class="hljs-built_in">Long</span> 
    <span class="hljs-keyword">get</span>() = platform.Foundation.NSDate().timeIntervalSince1970.toLong()
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir pour les modules de plate-forme, les biblioth√®ques syst√®me Java et iOS Foundation sont disponibles, respectivement.</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces points suffisent pour comprendre ce qui sera discut√© plus tard.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notre exp√©rience</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, √† un moment donn√©, nous avons d√©cid√© que tout √©tait accept√© par Kotlin MPP (alors il s'appelait aussi Kotlin / Native) comme standard et nous avons commenc√© √† √©crire des biblioth√®ques dans lesquelles nous partagions le code commun. </font><font style="vertical-align: inherit;">Au d√©but, il s'agissait uniquement de code pour les plates-formes mobiles, √† un moment donn√©, ils ont ajout√© la prise en charge du backend jvm. </font><font style="vertical-align: inherit;">Sur Android, le d√©veloppement et la publication des biblioth√®ques d√©velopp√©es n'ont pas pos√© de probl√®mes, sur iOS, dans la pratique, ils ont rencontr√© des probl√®mes, mais ils ont √©t√© r√©solus avec succ√®s et un mod√®le de travail pour d√©velopper et publier des cadres a √©t√© √©labor√©.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il est temps que quelque chose tra√Æne!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons r√©alis√© diff√©rentes fonctionnalit√©s dans des biblioth√®ques distinctes que nous utilisons dans le projet principal.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1) Analytique</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexte de l'√©v√©nement</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce n'est un secret pour personne que toutes les applications mobiles collectent un tas d'analyses. Les √©v√©nements sont suspendus avec tous les √©v√©nements importants et peu nombreux (par exemple, dans notre application, plus de 600 mesures diverses sont collect√©es). Et qu'est-ce que la collection m√©trique? D'une mani√®re simple, il s'agit d'un appel √† une fonction qui envoie un √©v√©nement avec une certaine cl√© dans les entrailles du moteur d'analyse. Et ensuite, il va dans une vari√©t√© de syst√®mes d'analyse comme Firebase, Appmetrica et autres. Quels sont les probl√®mes avec cela? Duplication constante du m√™me code (plus ou moins) sur deux plateformes! Oui, et le facteur humain ne peut √™tre trouv√© nulle part - les d√©veloppeurs pourraient se tromper, √† la fois dans le nom des cl√©s et dans l'ensemble de m√©tadonn√©es transmises avec l'√©v√©nement. Cela doit clairement √™tre √©crit une fois et utilis√© sur chaque plate-forme. Un candidat id√©al pour faire de la logique g√©n√©rale et de la technologie de test (c'est notre stylo de test dans Kotlin Mpp).</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment mettre en ≈ìuvre</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons transf√©r√© les √©v√©nements eux-m√™mes √† la biblioth√®que (sous forme de fonctions avec une cl√© c√¢bl√©e et un ensemble de m√©tadonn√©es requises dans les arguments) et √©crit une nouvelle logique pour le traitement de ces √©v√©nements. </font><font style="vertical-align: inherit;">Le format de l'√©v√©nement a √©t√© unifi√© et un moteur de gestion (bus) a √©t√© cr√©√©, dans lequel tous les √©v√©nements se sont d√©vers√©s. </font><font style="vertical-align: inherit;">Et pour divers syst√®mes d'analyse, les auditeurs d'adaptateurs ont √©crit (une solution tr√®s utile s'est av√©r√©e √™tre, lors de l'ajout de nouvelles analyses, nous pouvons facilement tout rediriger, ou s√©lectivement, chaque √©v√©nement vers une nouvelle analyse).</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vc/zh/vq/vczhvqo8-r4ap2r0tmwoczqloqe.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Int√©ressant dans le processus de mise en ≈ìuvre</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En raison des fonctionnalit√©s de l'impl√©mentation de l'utilisation des flux dans Kotlin / Native pour iOS, vous ne pouvez pas simplement prendre et travailler avec l'objet Kotlin en tant que singleton et y √©crire des donn√©es √† tout moment. </font><font style="vertical-align: inherit;">Tous les objets qui transf√®rent leur √©tat entre les threads doivent √™tre gel√©s (il existe une fonction freeze () pour cela). </font><font style="vertical-align: inherit;">Mais la biblioth√®que, entre autres, stocke un √©tat qui peut changer pendant la dur√©e de vie de l'application. </font><font style="vertical-align: inherit;">Il existe plusieurs fa√ßons de r√©soudre cette situation, nous avons opt√© pour la plus simple:</font></font><br>
<br>
<pre><code class="kotlin hljs">Common:<font></font>
<font></font>
<span class="hljs-keyword">expect</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AtomicReference</span>&lt;<span class="hljs-type">T</span>&gt;</span>(value_: T) {
    <span class="hljs-keyword">var</span> value: T<font></font>
}<font></font>
<font></font>
Android:<font></font>
<font></font>
<span class="hljs-keyword">actual</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AtomicReference</span>&lt;<span class="hljs-type">T</span>&gt; <span class="hljs-title">actual</span> <span class="hljs-keyword">constructor</span></span>(value_: T) {
    <span class="hljs-keyword">actual</span> <span class="hljs-keyword">var</span> value: T = value_<font></font>
}<font></font>
<font></font>
iOS:<font></font>
<font></font>
<span class="hljs-keyword">actual</span> <span class="hljs-keyword">typealias</span> AtomicReference&lt;V&gt; = kotlin.<span class="hljs-keyword">native</span>.concurrent.AtomicReference&lt;V&gt;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette option convient au stockage d'√©tat simple. </font><font style="vertical-align: inherit;">Dans notre cas, la configuration de la plateforme est stock√©e:</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">object</span> Config {
    <span class="hljs-keyword">val</span> platform = AtomicReference&lt;String?&gt;(<span class="hljs-string">""</span>)
    <span class="hljs-keyword">var</span> manufacturer = AtomicReference&lt;String?&gt;(<span class="hljs-string">""</span>)
    <span class="hljs-keyword">var</span> model = AtomicReference&lt;String?&gt;(<span class="hljs-string">""</span>)
    <span class="hljs-keyword">var</span> deviceId = AtomicReference&lt;String?&gt;(<span class="hljs-string">""</span>)
    <span class="hljs-keyword">var</span> appVersion = AtomicReference&lt;String?&gt;(<span class="hljs-string">""</span>)
    <span class="hljs-keyword">var</span> sessionId = AtomicReference&lt;String?&gt;(<span class="hljs-string">""</span>)
    <span class="hljs-keyword">var</span> debug = AtomicReference&lt;<span class="hljs-built_in">Boolean</span>&gt;(<span class="hljs-literal">false</span>)<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pourquoi est-ce n√©cessaire? Nous n'obtenons pas d'informations au d√©but de l'application, lorsque le module doit d√©j√† √™tre charg√© et que ses objets sont d√©j√† gel√©s. Afin d'ajouter ces informations √† la configuration, elles pourraient ensuite √™tre lues √† partir de diff√©rents flux sur iOS et un tel d√©placement est n√©cessaire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons √©galement √©t√© confront√©s au probl√®me de la publication de la biblioth√®que. Et si Android n'a eu aucun probl√®me avec cela, alors la m√©thode propos√©e par la documentation officielle √† l'√©poque pour connecter directement le framework assembl√© au projet iOS ne nous convenait pas pour un certain nombre de raisons, je voulais obtenir de nouvelles versions aussi simples et transparentes que possible. De plus, la gestion des versions est prise en charge.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La solution est de connecter le framework via un fichier pod. </font><font style="vertical-align: inherit;">Pour ce faire, ils ont g√©n√©r√© le fichier podspec et le framework lui-m√™me, les ont plac√©s dans le r√©f√©rentiel et la connexion de la biblioth√®que au projet est devenue tr√®s simple et pratique pour les d√©veloppeurs iOS. </font><font style="vertical-align: inherit;">De plus, pour la commodit√© du d√©veloppement, nous collectons un artefact unique pour toutes les architectures, le soi-disant framework fat (en fait un binaire en gras dans lequel toutes les architectures et les m√©ta-fichiers ajout√©s g√©n√©r√©s par le plugin kotlin s'entendent). </font><font style="vertical-align: inherit;">La mise en ≈ìuvre de tout cela sous le spoiler:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peu importe comment nous l'avons fait avant la d√©cision officielle</font></font></b>
                        <div class="spoiler_text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apr√®s que le plugin kotlin a collect√© pour nous un tas de diff√©rents frameworks pour diff√©rentes architectures, nous cr√©ons manuellement un nouveau framework universel dans lequel nous copions les m√©tadonn√©es de n'importe quel (dans notre cas, nous avons pris arm64):</font></font><br>
<pre><code class="kotlin hljs"><span class="hljs-comment">//add meta files (headers, modules and plist) from arm64 platform</span><font></font>
task copyMeta() {<font></font>
    dependsOn build<font></font>
<font></font>
    doLast {<font></font>
        copy {<font></font>
            from(<span class="hljs-string">"<span class="hljs-variable">$buildDir</span>/bin/iphone/main/release/framework/<span class="hljs-subst">${frameworkName}</span>.framework"</span>)<font></font>
            into <span class="hljs-string">"<span class="hljs-variable">$buildDir</span>/iphone_universal/<span class="hljs-subst">${frameworkName}</span>.framework"</span><font></font>
        }<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
,    ,   ,   .     lipo,    :<br>
<pre><code class="kotlin hljs"><span class="hljs-comment">//merge binary files into one</span><font></font>
task lipo(type: Exec) {<font></font>
    dependsOn copyMeta<font></font>
<font></font>
    def frameworks = files(<font></font>
            <span class="hljs-string">"<span class="hljs-variable">$buildDir</span>/bin/iphone32/main/release/framework/<span class="hljs-subst">${frameworkName}</span>.framework/<span class="hljs-variable">$frameworkName</span>"</span>,
            <span class="hljs-string">"<span class="hljs-variable">$buildDir</span>/bin/iphone/main/release/framework/<span class="hljs-subst">${frameworkName}</span>.framework/<span class="hljs-variable">$frameworkName</span>"</span>,
            <span class="hljs-string">"<span class="hljs-variable">$buildDir</span>/bin/iphoneSim/main/release/framework/<span class="hljs-subst">${frameworkName}</span>.framework/<span class="hljs-variable">$frameworkName</span>"</span><font></font>
    )<font></font>
    def output = file(<span class="hljs-string">"<span class="hljs-variable">$buildDir</span>/iphone_universal/<span class="hljs-subst">${frameworkName}</span>.framework/<span class="hljs-variable">$frameworkName</span>"</span>)<font></font>
    inputs.files frameworks<font></font>
    outputs.file output<font></font>
    executable = <span class="hljs-string">'lipo'</span><font></font>
    args = frameworks.files<font></font>
    args += [<span class="hljs-string">'-create'</span>, <span class="hljs-string">'-output'</span>, output]<font></font>
}<font></font>
</code></pre><br>
  ,     -       Kotlin MPP   Info.plist   UIRequiredDeviceCapabilities,        (    ).       PlistBuddy:<br>
<pre><code class="kotlin hljs"><span class="hljs-comment">//workaround</span>
<span class="hljs-comment">//remove UIRequiredDeviceCapabilities key from plist file (because we copy this file from arm64, only arm64 architecture was available)</span><font></font>
task editPlistFile(type: Exec) {<font></font>
    dependsOn lipo<font></font>
<font></font>
    executable = <span class="hljs-string">"/bin/sh"</span>
    def script = <span class="hljs-string">'./scripts/edit_plist_file.sh'</span>
    def command = <span class="hljs-string">"Delete :UIRequiredDeviceCapabilities"</span>
    def file = <span class="hljs-string">"<span class="hljs-variable">$buildDir</span>/iphone_universal/<span class="hljs-subst">${frameworkName}</span>.framework/Info.plist"</span><font></font>
<font></font>
    args += [script, command, file]<font></font>
}<font></font>
</code></pre><br>
edit_plist_file.sh:<br>
<pre><code class="bash hljs">/usr/libexec/PlistBuddy -c <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$2</span>"</span>
</code></pre><br>
 ,  zip      (    podspec ):<br>
<pre><code class="kotlin hljs">task zipIosFramework(type: Zip) {<font></font>
    dependsOn editPlistFile<font></font>
    from <span class="hljs-string">"<span class="hljs-variable">$buildDir</span>/iphone_universal/"</span>
    include <span class="hljs-string">'**/*'</span><font></font>
    archiveName = iosArtifactName<font></font>
    destinationDir(file(<span class="hljs-string">"<span class="hljs-variable">$buildDir</span>/iphone_universal_zipped/"</span>))<font></font>
}<font></font>
</code></pre><br>
  podspec :<br>
<pre><code class="kotlin hljs">task generatePodspecFile(type: Exec) {<font></font>
    dependsOn zipIosFramework<font></font>
<font></font>
    executable = <span class="hljs-string">"/bin/sh"</span><font></font>
<font></font>
    def script = <span class="hljs-string">'./scripts/generate_podspec_file.sh'</span><font></font>
<font></font>
    def templateStr = <span class="hljs-string">"version_name"</span>
    def sourceFile = <span class="hljs-string">'./podspec/template.podspec'</span>
    def replaceStr = <span class="hljs-string">"<span class="hljs-variable">$version</span>"</span><font></font>
<font></font>
    args += [script, templateStr, replaceStr, sourceFile, generatedPodspecFile]<font></font>
}<font></font>
</code></pre><br>
 generate_podscpec_file.sh      :<br>
<pre><code class="bash hljs">sed -e s/<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>/<span class="hljs-string">"<span class="hljs-variable">$2</span>"</span>/g &lt;<span class="hljs-string">"<span class="hljs-variable">$3</span>"</span> &gt;<span class="hljs-string">"<span class="hljs-variable">$4</span>"</span>
</code></pre><br>
   curl        :<br>
<pre><code class="kotlin hljs">task uploadIosFrameworkToNexus(type: Exec) {<font></font>
    dependsOn generatePodspecFile<font></font>
<font></font>
    executable = <span class="hljs-string">"/bin/sh"</span>
    def body = <span class="hljs-string">"-s -k -v --user \'<span class="hljs-variable">$userName</span>:<span class="hljs-variable">$password</span>\' "</span> +
            <span class="hljs-string">"--upload-file <span class="hljs-variable">$buildDir</span>/iphone_universal_zipped/<span class="hljs-variable">$iosArtifactName</span> <span class="hljs-variable">$iosUrlRepoPath</span>"</span>
    args += [<span class="hljs-string">'-c'</span>, <span class="hljs-string">"curl <span class="hljs-variable">$body</span>"</span>]<font></font>
}<font></font>
<font></font>
task uploadPodspecFileToNexus(type: Exec) {<font></font>
    dependsOn uploadIosFrameworkToNexus<font></font>
<font></font>
    executable = <span class="hljs-string">"/bin/sh"</span>
    def body = <span class="hljs-string">"-s -k -v --user \'<span class="hljs-variable">$userName</span>:<span class="hljs-variable">$password</span>\' "</span> +
            <span class="hljs-string">"--upload-file <span class="hljs-variable">$generatedPodspecFile</span> <span class="hljs-variable">$iosUrlRepoPath</span>"</span>
    args += [<span class="hljs-string">'-c'</span>, <span class="hljs-string">"curl <span class="hljs-variable">$body</span>"</span>]<font></font>
}<font></font>
</code></pre><br>
        :<br>
<pre><code class="kotlin hljs">task createAndUploadUniversalIosFramework() {<font></font>
    dependsOn uploadPodspecFileToNexus<font></font>
    doLast {<font></font>
        println <span class="hljs-string">'createAndUploadUniversalIosFramework complete'</span><font></font>
    }<font></font>
}<font></font>
</code></pre><br>
<br>
Profit!<br>
</div>
                    </div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au moment de la r√©daction, il existe des solutions officielles pour cr√©er un cadre gras et g√©n√©rer un fichier podspec (et g√©n√©ralement l'int√©gration avec CocoaPods). </font><font style="vertical-align: inherit;">Il nous suffit donc de t√©l√©charger le cadre cr√©√© et le fichier podspec dans le r√©f√©rentiel et de connecter le projet dans iOS de la m√™me mani√®re qu'auparavant:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  fat framework  Jetbrains</a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  podspec   Jetbrains</a><br>
</li>
</ul><br>
<br>
<h4></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir impl√©ment√© un tel sch√©ma avec un emplacement unique pour le stockage des √©v√©nements, un m√©canisme de traitement et d'envoi des m√©triques, notre processus d'ajout de nouvelles m√©triques a √©t√© r√©duit au fait qu'un d√©veloppeur ajoute une nouvelle fonction √† la biblioth√®que, qui d√©crit la cl√© d'√©v√©nement et les m√©tadonn√©es n√©cessaires que le d√©veloppeur doit transmettre pour un √©v√©nement particulier . De plus, le d√©veloppeur d'une autre plateforme t√©l√©charge simplement une nouvelle version de la biblioth√®que et utilise la nouvelle fonction au bon endroit. Il est devenu beaucoup plus facile de maintenir la coh√©rence de l'ensemble du syst√®me d'analyse; il est √©galement beaucoup plus facile maintenant de modifier l'impl√©mentation interne du bus d'√©v√©nements. Par exemple, √† un moment donn√©, pour l'un de nos analystes, il nous a √©t√© n√©cessaire d'impl√©menter notre propre tampon d'√©v√©nements, ce qui a √©t√© fait imm√©diatement dans la biblioth√®que, sans avoir besoin de changer le code sur les plateformes. Profit!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous continuons √† transf√©rer de plus en plus de code vers Kotlin MPP, dans les articles suivants, je continuerai l'histoire de notre introduction au monde du d√©veloppement multiplateforme en utilisant deux autres biblioth√®ques comme exemples, dans lesquelles la s√©rialisation et la base de donn√©es ont √©t√© utilis√©es, en travaillant avec le temps. </font><font style="vertical-align: inherit;">Je vais vous parler des restrictions qui ont √©t√© rencontr√©es lors de l'utilisation de plusieurs frameworks kotlin dans un m√™me projet iOS et comment contourner cette limitation.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et maintenant bri√®vement sur les r√©sultats de nos recherches</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ Tout fonctionne de mani√®re stable en production. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ Base de code unifi√©e de la logique de service m√©tier pour toutes les plateformes (moins d'erreurs et de divergences). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ Co√ªts d'assistance r√©duits et temps de d√©veloppement r√©duit pour les nouvelles exigences. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ Nous augmentons l'expertise des d√©veloppeurs.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liens connexes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Site Web Kotlin Multiplatform: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.jetbrains.com/lp/mobilecrossplatform</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ZY: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne veux pas r√©p√©ter sur le laconicisme du langage, et donc me concentrer sur la logique m√©tier lors de l'√©criture de code. Je peux conseiller plusieurs articles qui </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
couvrent </font><font style="vertical-align: inherit;">ce sujet: </font><font style="vertical-align: inherit;">¬´Kotlin sous le capot - voir bytecode d√©compil√©¬ª - un article d√©crivant le fonctionnement du compilateur Kotlin et couvrant la structure de base du langage. </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">habr.com/en/post/425077</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Deux parties de l'article "Kotlin, compilation en bytecode et performance", compl√©tant l'article pr√©c√©dent. </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">habr.com/ru/company/inforion/blog/330060 </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">habr.com/ru/company/inforion/blog/330064</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rapport de Pasha Finkelstein ¬´Kotlin - deux ans de production et pas un seul √©cart¬ª, bas√© sur l'exp√©rience de l'utilisation et de la mise en ≈ìuvre de Kotlin dans notre entreprise. </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.youtube.com/watch?v=nCDWb7O1ZW4</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr495340/index.html">Comment changer le travail d'un administrateur dans un restaurant pour un bon travail en informatique</a></li>
<li><a href="../fr495342/index.html">R√®glement des cartes bancaires dans le commerce - cr√©ation d'un jeu de donn√©es ouvert et d'une infographie dans Google Data Studio</a></li>
<li><a href="../fr495344/index.html">Unifier: comment Lamoda rend ses services Go coh√©rents</a></li>
<li><a href="../fr495346/index.html">De l'erreur √† l'alerte avec des actions</a></li>
<li><a href="../fr499818/index.html">Marketing de t√©l√©gramme ouzbek</a></li>
<li><a href="../fr499822/index.html">Point d'acc√®s sans fil vs routeur: quelles sont les diff√©rences?</a></li>
<li><a href="../fr499824/index.html">Le condens√© des √©v√©nements pour les recruteurs RH et IT en mai 2020</a></li>
<li><a href="../fr499826/index.html">Pression art√©rielle r√©partie</a></li>
<li><a href="../fr499832/index.html">Comment organiser rapidement et en toute s√©curit√© le travail √† distance des employ√©s? Nous parlons de diff√©rentes approches: avec VDI ‚Äã‚Äãet pas seulement</a></li>
<li><a href="../fr499834/index.html">Rencontrez l'arithmom√®tre Felix</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>