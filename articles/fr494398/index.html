<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌡️ 😱 👨‍👧 Playstation Doom Polygons 👎🏻 🥫 ☮️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sony PlayStation
  
 L'histoire de la PlayStation a commencé en 1988 lorsque Nintendo et Sony ont commencé à travailler ensemble sur un lecteur de CD-...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Playstation Doom Polygons</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/494398/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/98b/897/f95/98b897f955dbdf31ff724bbe1a1841f4.png" alt="image"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sony PlayStation</font></font></h2><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8f7/4aa/015/8f74aa015b0e95be13aac769990538a5.svg"></div> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'histoire de la PlayStation a commencé en 1988 lorsque Nintendo et Sony ont commencé à travailler ensemble sur un lecteur de CD-ROM en option pour la console SNES. Aux termes de l'accord, Sony a pu développer indépendamment des jeux pour cette plate-forme et a conservé le contrôle du format Super Disc - deux concessions inhabituelles de Nintendo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le projet s'est développé avant l'exposition CES '91, au cours de laquelle Sony a annoncé une collaboration sur Play Station. Le lendemain, lors de la même exposition, Nintendo, à la surprise de Sony, a annoncé qu'il avait plutôt conclu un accord de partenariat avec Philips (à des conditions beaucoup plus favorables). Sony, fidèle et humilié publiquement, a tenté de faire appel au conseil d'administration de Sega, qui a immédiatement rejeté l'idée. Dans une interview accordée à 2013, le PDG de SEGA, Tom Kalinske, a rappelé la décision du conseil.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«C'est une idée stupide, Sony ne sait pas comment développer des équipements. </font><font style="vertical-align: inherit;">Ils ne savent pas écrire de logiciels. </font><font style="vertical-align: inherit;">Pourquoi jouons-nous avec eux? " </font><font style="vertical-align: inherit;">- Conseil d'administration de SEGA</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et ils ne se sont pas trompés, Sony avait vraiment peu d'expérience avec les jeux. </font><font style="vertical-align: inherit;">Elle n'a presque pas manifesté d'intérêt pour eux, à l'exception de l'initiative d'une personne - Ken Kutaragi. </font><font style="vertical-align: inherit;">Depuis le moment où il a vu sa fille jouer à la Nintendo Famicom, Ken a convaincu Sony qu'il devait pénétrer ce marché. </font><font style="vertical-align: inherit;">Malgré les recommandations des vice-présidents de Sony, il a même développé pour Nintendo la puce audio (SPC700) utilisée dans SNES.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La plupart des dirigeants de Sony considéraient cela comme un pari risqué, mais Kutaragi a trouvé un soutien en la personne du PDG de Sony, Norio Oga. En juin 1992, Ken a été autorisé à commencer à créer un système de jeu à partir de zéro. Pour calmer le conseil d'administration, le «père de la PlayStation», comme ils l'appelèrent plus tard, a été transféré à la société mère financièrement indépendante Sony Music, et il a commencé à travailler sur ce qui allait devenir la «PlayStation» (déjà sans espace au nom).</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Initialement, les développeurs ne pouvaient pas décider si l'architecture devait se concentrer sur les graphiques sprite 2D ou les graphiques polygonaux 3D. </font><font style="vertical-align: inherit;">Cependant, le succès du jeu Virtua Fighter sorti en octobre 1993 par Sega sur des machines d'arcade japonaises a détruit tous les doutes: la PSX suivra la voie 3D. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le point culminant du projet est survenu deux ans plus tard, lorsque Sony Computer Entertainment a été créé le 3 décembre 1994 et que la console a été lancée au Japon. </font><font style="vertical-align: inherit;">Il a connu un succès instantané et a été vendu le premier jour avec une circulation de 100 000 appareils, 2 millions d'appareils au bout de six mois et 102 millions d'appareils tout au long de leur vie.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6b1/727/175/6b1727175f25b80b4309c920c0e23115.webp"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sony PSX (PS1, PlayStation). </font><font style="vertical-align: inherit;">Photo: Wikipedia</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Architecture</font></font></h2><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/60b/97c/da3/60b97cda359e2e5c27a9028cc13aa22d.svg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le cœur de la machine est le processeur MIPS 32 bits RISC R3000A avec une fréquence de 33,8688 MHz </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[3]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en combinaison avec 2 Mo de DRAM. Il est à noter que cette puce possède également un décodeur de mouvement (MDEC), qui fournit une lecture vidéo avec une résolution de 320x240 à une fréquence de 30 ips. À côté de MDEC, nous voyons le coprocesseur Geometry Transform Engine (GTE), utilisé pour effectuer des opérations mathématiques à virgule fixe rapides sur des vecteurs et des matrices. Le système dans son ensemble est incapable de travailler avec des nombres à virgule flottante.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le GPU est une «boîte noire» contrôlée par le processeur central à l'aide de «commandes». Il dispose de 1 Mo de VRAM, non disponible pour le processeur. À bien des égards, son travail ressemble à celui du merveilleux mode Immédiat OpenGL: il dessine des polygones texturés qui peuvent être «ombrés» en utilisant des couleurs de vertex. Le pipeline graphique est fixe et ne peut pas être programmé. Il n'y a pas de tampon Z (tampon de profondeur). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'unité de traitement du son, l'unité de traitement du son (SPU), comme le GPU, est une boîte noire. Il peut traiter 24 canaux, dispose de 512 Ko de SRAM pour le stockage audio (au format ADPCM) et est capable de mélanger des pistes audio de CD-ROM avec ses canaux audio. L'abréviation SRAM ne signifie pas «RAM statique», mais «RAM sonore».</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La décision la plus audacieuse des ingénieurs Sony a été le choix du support de données. </font><font style="vertical-align: inherit;">Ils ont choisi non pas des cartouches, mais un module CD-ROM à double vitesse, ce qui a réduit le coût des jeux et augmenté considérablement le volume disponible (jusqu'à environ 650 Mo). </font><font style="vertical-align: inherit;">Les inconvénients sont le faible taux de transfert (300 Ko / s) et le temps d'installation monstrueusement important de la tête (300 ms). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il n'y a aucun blitter dans la console. </font><font style="vertical-align: inherit;">Le modèle de programmation de la machine était que les développeurs n'avaient pas touché le fer "nu". </font><font style="vertical-align: inherit;">Cependant, il existe un contrôleur DMA pour transmettre des données de CD / DRAM à VRAM / SRAM.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Système vidéo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malgré le fait que le système vidéo supporte les couleurs 24 bits, très peu de jeux l'ont utilisé (à l'exception des arrière-plans de Heart Of Darkness </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[4]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">En pratique, on peut dire en toute conscience que la plupart des jeux utilisaient des couleurs 16 bits avec un masque 1 bit.</font></font><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><img width="300" height="353" src="https://habrastorage.org/getpro/habr/post_images/5ff/164/4dd/5ff1644dd75bfbad9af9b1d61190ebe1.webp"><br>
</td>
<td><img width="300" height="353" src="https://habrastorage.org/getpro/habr/post_images/5ef/828/585/5ef828585512c3315eef5d72087f27b2.png"></td>
</tr>
</tbody></table></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Espace colorimétrique PSX avec une profondeur de 15 bits par pixel</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Une caractéristique étonnante du système vidéo est l'organisation de la VRAM, qui dépend complètement du développeur. 1 Mo de VRAM est considéré comme un tableau de 1024 x 512 x 16 bits pouvant être librement utilisé. L'application de la mise en mémoire tampon double ou triple est effectuée de manière triviale, car la zone est simplement suffisante pour réserver, dessiner et transférer vers le système de sortie. Les textures sont également en VRAM, à côté des tampons de trame. Pour écrire dans le tampon de trame, les commandes GPU pour le rendu des triangles / quadrangles texturés sont lancées. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les textures peuvent avoir différents formats. Il existe deux sources directes de couleurs 16 bits et 24 bits, ainsi que des sources basées sur une palette appelée Color Look Up Table (CLUT). Les CLUT 8 bits et 4 bits sont pris en charge.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En termes de résolution, la console était limitée aux normes de télévision NTSC et PAL. </font><font style="vertical-align: inherit;">Pour les marchés américain et japonais, le développeur peut choisir une résolution horizontale de 256, 320, 384, 512 ou 640 pixels. </font><font style="vertical-align: inherit;">La résolution verticale était de 240 pixels (lors du saut d'une ligne raster sur deux) ou de 480 pixels en alternance. </font><font style="vertical-align: inherit;">Les deux modes verticaux fonctionnaient à une fréquence de 60 Hz. </font><font style="vertical-align: inherit;">La seule différence entre NTSC et PAL était une résolution verticale accrue (256/512 au lieu de 240/480) et une fréquence de rafraîchissement inférieure (50 Hz).</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mode NTSC (60 Hz) PAL (50 Hz) Remarque</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
=================================================== ========</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
0 256 x 240 256 x 256 Non entrelacé</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1320 x 240320 x 256 non entrelacé</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2 512 x 240 512 x 256 non entrelacé</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3 640 x 240 640 x 256 Non entrelacé</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4 256 x 480 256 x 512 entrelacé</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5320 x 480320 x 512 entrelacé</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6 512 x 480 512 x 512 entrelacé</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7640 x 480640 x 512 Entrelacé</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
8 384 x 240 384 x 256 non entrelacé</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
9 384 x 480 384 x 512 entrelacé</font></font></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Faites attention aux modes avec une résolution horizontale de 384 pixels (8 et 9), qui, à en juger par leur identifiant, ont été ajoutés plus tard.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DOOM sur PSX</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DOOM a été porté sur PSX par Williams Entertainment avec le soutien d'id Software. </font><font style="vertical-align: inherit;">Il a fallu une équipe de cinq personnes un peu moins d'un an </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[5] </font></font></sup><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[6]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour porter le moteur, changer les ressources et modifier le jeu pour que tout fonctionne «seulement» sur 3,5 Mo de RAM.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«Les graphismes ont été dégradés: les textures sont réduites en taille, les sprites, les monstres et les armes aussi. </font><font style="vertical-align: inherit;">[...] Parfois, nous coupons des images d'animation. " </font><font style="vertical-align: inherit;">- Harry Tisley</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le résultat final a été rendu public le 16 novembre 1995. </font><font style="vertical-align: inherit;">Il est considéré comme le meilleur port console du jeu, et certains aspects dépassent même la version PC en raison des hauts de couleur et de la musique de qualité CD.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Jusqu'à présent, c'est le meilleur DOOM!" </font><font style="vertical-align: inherit;">- John Romero</font></font></blockquote><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plan d'étude</font></font></h2><br>
<div style="text-align:center;"><img width="290" height="301" src="https://habrastorage.org/getpro/habr/post_images/9de/26d/ce5/9de26dce56307a9b22370aa22c0c93e9.svg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En raison de la nature du développement, la structure DOOM est basée sur un noyau qui utilise six sous-systèmes pour les E / S. La plupart du temps, j'ai étudié les trois parties que j'ai trouvées les plus intéressantes, à savoir le système de fichiers sur CD-ROM, l'audio basé sur SPU et la vidéo basée sur GPU, car ils sont uniques à l'architecture PSX. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code source DOOM pour la PSX n'a ​​jamais été publié, mais il s'est avéré que cela ne posait aucun problème. Les informations disponibles suffisent.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La première source est le superbe SDK PSY-Q, qui était l'outil «officiel» utilisé par les développeurs PSX de l'époque. Il y a beaucoup de documentation à ce sujet, présentée comme un ensemble de fichiers PDF. Une telle abondance d'informations ne fait que confirmer tout le bien que j'ai entendu à propos de la convivialité de la PSX envers les développeurs. La bibliothèque (c'est-à-dire libcd, libds) développée par Psygnosis est également bien documentée. C'était très agréable de voir des explications claires, surtout par rapport au manque presque complet d'informations sur les autres consoles (oui, je parle de SNES). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une autre source d'information est les nombreux outils externes disponibles aujourd'hui. ISOBuster m'a permis d'ouvrir le contenu du CD. PSound a aidé à analyser les fichiers LCD. La capacité étonnante de l'émulateur no $ PSX de suivre les commandes GPU et SPU est devenue un véritable atout.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais j'ai peut-être été le plus impressionné par l'énorme amour de DOOM pour PSX de la part des fans. </font><font style="vertical-align: inherit;">Une ingénierie inverse complète du jeu a été réalisée. </font><font style="vertical-align: inherit;">PSXDOOM-RE se démarque surtout parce qu'il s'agit d'une base de code C qui peut être compilée à l'aide du SDK PSY-Q dans un jeu PSX à part entière. </font><font style="vertical-align: inherit;">Le code est très fiable car il a été obtenu en réécrivant chaque fonction du code machine en C.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le monde étonnant des CD</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avant de commencer à étudier la mise en œuvre du système de fichiers, j'ai fait une petite excursion pour mieux comprendre le monde merveilleux des CD.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depuis 20 ans, de 1980 à 2000, plusieurs volumes de spécifications ont été publiés qui révèlent ce sujet. Ensemble, ils s'appellent «Rainbow Books». Le premier livre de la série, «Red Book», contient les spécifications d'un disque compact audio (CD). Le «Livre jaune» est un complément au «Livre rouge», il ajoute des spécifications de données pour CD-ROM et ISO-9600. L'Orange Book a ajouté des spécifications pour les CD-DA, CD-R (enregistrables) et CR-WR (réinscriptibles). Le livre blanc est dédié au CD vidéo (VCD). Le Livre vert parle de CD-Interactive (CD-I). Le Blue Book présente des données de CD amélioré (ECD) pour la prise en charge multimédia. Le Scarlet Book est dédié au Super Audio (SACD), qui ajoute un son haute définition. Le Purple Book répertorie la spécification Double Density CD (DDCD), qui a augmenté la capacité du disque de 650 Mo à 1,3 Go. Finalement,Cyan Book détails 9660 spécifications du système de fichiers</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[7]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/52b/2f6/c60/52b2f6c605024780dcf141bcaf02a6a8.svg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rainbow Books contient tout ce que nous savons sur le CD. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au minimum, nous devons comprendre que les CD PSX se composent généralement de secteurs, chacun contenant 2048 octets de données. </font><font style="vertical-align: inherit;">Les secteurs sont regroupés en pistes (qui peuvent être des données ou du son). </font><font style="vertical-align: inherit;">Les pistes sont regroupées en session. </font><font style="vertical-align: inherit;">Les informations des pistes de données peuvent être organisées à l'aide du système de fichiers standard ISO-9660, cependant, le jeu peut également avoir des adresses de secteur codées en dur.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">À l'intérieur du CD de jeu DOOM</font></font></h2><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/88b/62c/636/88b62c636572fe1c4617445525220c58.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous regardez à l'intérieur du CD-ROM en utilisant ISOBuster, vous pouvez voir que DOOM se compose d'une session contenant huit pistes </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[8]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Sept d'entre eux sont des pistes sonores de qualité CD jouées entre les missions et dans la scène finale. </font><font style="vertical-align: inherit;">La piste finale (# 7) utilise même des voix démoniaques numérisées. </font><font style="vertical-align: inherit;">La piste numéro 6 est particulièrement remarquable car elle semble avoir été prise directement de la rave party. </font><font style="vertical-align: inherit;">Il s'avère qu'il s'agit de musique jouée sur la carte super secrète 59 «Club DOOM» (une carte secrète accessible uniquement à partir d'une carte secrète) </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[9]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Permettez-moi de vous laisser apprécier sa folie. </font><font style="vertical-align: inherit;">Avant de commencer, vérifiez le volume sonore.</font></font><br>
<br>
<div class="oembed"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://fabiensanglard.net/doom_psx/Track06.mp3</font></font></a></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La piste restante (numéro 1) est ISO-9660, qui contient le moteur de jeu et la plupart des ressources. </font><font style="vertical-align: inherit;">Après avoir exploré les nombreux ports DOOM, je m'attendais naïvement à un moteur appelé DOOM.EXE, un fichier de ressources PSXDOOM.WAD et peut-être un manifeste. </font><font style="vertical-align: inherit;">Je me trompais beaucoup. </font><font style="vertical-align: inherit;">287 fichiers </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[10] </font></font></sup><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[11] ont été</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> trouvés sur la piste </font><font style="vertical-align: inherit;">, dont 60 .WAD, 120 .IMG et d'innombrables .LCD. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les données sont classées par niveau (cinq fichiers par carte).</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nom du fichier Description</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
=================================================== =====</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MAPDIR0 / MAP01.WAD Géométrie standard (BSP / Rejeter / ...)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MAPDIR0 / MAPTEX01.IMG Textures des plans / murs</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MAPDIR0 / MAPSPR01.IMG Tous les sprites créés par THINGS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MUSIQUE / MUSLEV1.LCD Musique jouable</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SNDMAPS1 / MAP01.LCD Tous les sons émis par THINGS</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsqu'on lui a demandé pourquoi tout avait été arrangé d'une nouvelle manière, le développeur de Crash Bandicoot Andy Gavin a partiellement répondu dans une interview avec Ars Technica. </font><font style="vertical-align: inherit;">[ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">traduction</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur Habré]</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Il faut environ 1/3 de seconde pour déplacer la tête vers n'importe quel point du CD."</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En raison du fait que la vitesse de positionnement de la tête était proche de 300 ms (ce qui est confirmé par la documentation PSY-Q </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[12]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), les développeurs de Williams Entertainment n'ont pas pu enregistrer l'architecture claire du moteur DOOM, qui stockait toutes les ressources dans un fichier (par exemple, DOOM.WAD) et les a téléchargés sur demande. Sur PSX, cela conduirait à un taux de trame terrible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les développeurs ont résolu le problème en lançant une quantité apparemment infinie d'octets sur le CD. Toutes les ressources nécessaires au niveau ont été stockées dans cinq fichiers contenant la géométrie de la carte, la texture. sprites, effets sonores et musique. C'est très cher, mais cela a éliminé la nécessité d'accéder au CD pendant le processus de jeu. </font></font><br>
<br>
<b><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fait intéressant:</font></font></u></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans la liste des fichiers sur la piste de données, il y a un fichier appelé PSXDOOM.WAD (4 806 088 octets), mais il n'est utilisé que pour charger des palettes et plusieurs images de menu. </font><font style="vertical-align: inherit;">Probablement plus activement utilisé dans le processus de développement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prenons l'exemple de la première carte: la quantité totale de données téléchargées est passée de 4 Mo à 900 Ko.</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Taille du nom de fichier (en octets)  </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
=====================================  	</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MAPDIR0 / MAP01.WAD 28 196</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MAPDIR0 / MAPTEX01.IMG 90 744</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MAPDIR0 / MAPSPR01.IMG 590 344</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MUSIQUE / MUSLEV1.LCD 61232</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SNDMAPS1 / MAP01.LCD 143632</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
=====================================</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Total: 914.148</font></font></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sachant que les ressources occupent 914 Ko, vous pourriez penser qu'il restait beaucoup de DRAM inutilisée. Mais vous devez vous rappeler qu'il devait également contenir un fichier exécutable de 428 Ko, ainsi qu'une pile qui change au moment de l'exécution. En fait, seulement environ 1 Mo de DRAM était disponible au moment de l'exécution. </font></font><br>
<br>
<b><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un fait intéressant:</font></font></u></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en examinant le code source de PSXDOOM-RE, j'ai découvert la fonction P_LoadBlocks, qui essaie de lire un CD jusqu'à quatre fois </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[13]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , après quoi elle se rend. C'est l'un des plaisirs de travailler avec des supports faciles à rayer.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne m'attendais pas à ce que le temps d'installation de la tête du CD-ROM affecte autant l'architecture du jeu. Certains jeux, comme Crash Bandicoot, ont été créés à partir de zéro avec un système de page pour diffuser des données à partir d'un CD lors de l'exécution. Dans le cas de DOOM, le moteur n'en était pas capable. Le CD n'est pas utilisé pendant le jeu, à l'exception d'une chanson particulière (oui, du niveau Club DOOM). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les gars d'id Software n'ont jamais été fan du compromis entre la capacité et la vitesse qu'offraient les CD-ROM.</font></font><br>
<br>
<blockquote>«    - .     ,       CD.  - ,     Crash 'n Burn —    ?    .  ,     CD      ,  3DO   .   -   CD- DOOM,        „  DOOM“.           ,     .       .<br>
<br>
           ,     CD.       ». —   (ATARI EXPLORER ONLINE, 22  1994 )</blockquote><br>
<b><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un fait intéressant: les</font></font></u></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> événements dans le jeu DOOM ont été déclenchés à l'aide de «vergetures». </font><font style="vertical-align: inherit;">Lors du franchissement d'une ligne avec une propriété spéciale, une fonction spéciale a été appelée. </font><font style="vertical-align: inherit;">Dans la version "héritée" du moteur, aucune propriété ne vous permettait de jouer des chansons. </font><font style="vertical-align: inherit;">Pour jouer au Club DOOM, une action linedef spéciale a été créée (numéro 142)</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [14]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">C'est incroyable combien d'efforts supplémentaires ont été nécessaires pour créer ce niveau. </font><font style="vertical-align: inherit;">Probablement, les développeurs ont vraiment aimé s'amuser dans les raves.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le cas de l'archvile manquant</font></font></h2><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/daf/8fb/db9/daf8fbdb944deb32c8b6f398615a16ef.webp"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En effectuant des recherches pour mon livre noir Game Engine, je ne pouvais pas comprendre cette phrase du designer Harry Teesley:</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«Archvile avait deux fois plus d'images d'animation que n'importe quel autre monstre, et nous ne pouvions pas l'intégrer dans la PSX. </font><font style="vertical-align: inherit;">Ni son attaque ni l'effet de résurrection ne pouvaient être perdus. </font><font style="vertical-align: inherit;">Il était trop grand. " </font><font style="vertical-align: inherit;">- Harry Tisley (designer) dans une interview avec doomworld.com</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il était évident que le problème n'était pas la capacité de 650 mégaoctets du CD, mais je ne comprenais pas quel était le facteur limitant - DRAM ou VRAM. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ayant compris les limites du CD-ROM, j'ai réalisé que le problème n'était pas de stocker le sprite sur un CD, ni même de le transférer de la DRAM vers la VRAM. </font><font style="vertical-align: inherit;">Le problème est de tout intégrer dans la DRAM. </font></font><br>
<br>
<b><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fait intéressant:</font></font></u></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ArchVile est complètement supprimé du code source de PSXDOOM-RE. </font><font style="vertical-align: inherit;">Même son #DEFINE est commenté </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[15]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CC_ZOMBIE  <span class="hljs-meta-string">"Zombieman"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CC_SHOTGUN  <span class="hljs-meta-string">"Shotgun Guy"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CC_HEAVY  <span class="hljs-meta-string">"Heavy Weapon Dude"</span></span><font></font>
...<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CC_HELL   <span class="hljs-meta-string">"Hell Knight"</span></span>
<span class="hljs-comment">//#define CC_ARCH "Arch-Vile"</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CC_SPIDER <span class="hljs-meta-string">"The Spider Mastermind"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CC_CYBER  <span class="hljs-meta-string">"The Cyberdemon"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CC_HERO   <span class="hljs-meta-string">"Our Hero"</span></span></code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Programmation SPU</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La puce SPU ne comprend qu'un seul format, à savoir ADPCM. </font><font style="vertical-align: inherit;">Il est capable de mixer jusqu'à 24 canaux (y compris la piste audio CD) et possède de puissantes fonctions de manipulation audio.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour apprivoiser cette bête, le DOOM PSX utilise la bibliothèque libWESS (Williams Entertainment Sound System), écrite par l'ingénieur du son Scott Patterson. </font><font style="vertical-align: inherit;">La bibliothèque est assez puissante, elle est capable de recréer le système MiDI, dans lequel une lourde banque de notes (appelée police sonore) est contrôlée par une partition musicale qui prend peu de place. </font><font style="vertical-align: inherit;">Il peut également manipuler des attributs sonores en temps réel tels que le volume, la tonalité, la vitesse de la note et les fonctions ADSR (Attack, Decay, Sustain et Release). </font><font style="vertical-align: inherit;">Toute la musique jouée pendant le jeu est générée à l'aide de libWESS. </font><font style="vertical-align: inherit;">À une exception près, vous l'aurez deviné, il s'agit du Club DOOM, qui est lu à partir du CD numéro 6.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WESS utilise deux formats de fichiers propriétaires. </font><font style="vertical-align: inherit;">Il s'agit de fichiers .WMD contenant des partitions musicales et des effets sonores, et des fichiers .LCD, qui sont au format PSX VAG (sans titre) et contiennent des échantillons ADPCM. </font><font style="vertical-align: inherit;">Lorsque DOOM démarre, la bibliothèque libWESS charge tous les effets sonores (SFX, 89 pièces) et les partitions musicales (19 pièces) stockées dans un petit fichier (55 Ko) appelé DOOMSND.WMD. </font><font style="vertical-align: inherit;">Elle charge également dans les échantillons SRAM «toujours utilisés» publiés par le personnage, les portes, etc.</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MUSIQUE / DOOMSFX.LCD -&gt; SRAM</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MUSIQUE / DOOMSND.WMD -&gt; DRAM</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir chargé la carte, libWESS ouvre MUSIC / MUSLEV% .LCD, qui contient les échantillons ADPCM utilisés dans la musique de cette carte, et SNDMAPS% / MAP %%. LCD, qui contient les échantillons ADPCM nécessaires pour les ennemis à ce niveau. </font><font style="vertical-align: inherit;">Tous les échantillons ADPCM sont chargés directement dans SRAM et ne prennent pas d'espace dans la DRAM.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DOOM sur PSX: GPU</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le domaine de la génération de vidéos, Williams Entertainment devait résoudre deux problèmes: une petite quantité de VRAM (nous y reviendrons plus tard) et le manque de mappage de texture correct en tenant compte de la perspective.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«Aaron Siler et moi avons travaillé sur des versions pour la Nintendo 64 (ce jeu était assez différent) et pour la Playstation. </font><font style="vertical-align: inherit;">Ce sont les premières versions qui n'ont pas été écrites sur du métal nu, car Sony et Nintendo ont forcé les développeurs (au moins des tiers) à écrire des API et ne leur ont pas fourni de documentation sur les registres matériels. </font><font style="vertical-align: inherit;">Au début, la culture SGI a particulièrement limité les développeurs, mais progressivement Nintendo a desserré son emprise.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une histoire amusante sur le développement d'une version pour la Playstation: Aaron et moi avons commencé avec une architecture de moteur différente, qui rendait les triangles du monde, car la console leur fournissait une accélération matérielle complète. </font><font style="vertical-align: inherit;">Dans le cas de N64, cela fonctionnait parfaitement, car il avait un rendu correct en perspective avec une précision sous-pixel (le résultat de l'influence de SGI), mais sur la Playstation, le mappage de texture affine a été effectué avec des coordonnées entières, de sorte que les grands triangles de mur et de sol avaient l'air IMPRESSIONNANTS. » </font><font style="vertical-align: inherit;">- John Carmack (Game Engine Black Book: DOOM)</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour comprendre à quel point cela avait l'air «terrible», j'ai montré ci-dessous trois murs rendus avec une texture affine et prospectivement correcte.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/98b/897/f95/98b897f955dbdf31ff724bbe1a1841f4.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Texturation en perspective</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/67f/f2a/602/67ff2a6028aea5b8a390b13ecdf23f5c.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Affine (PSX)</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Notez qu'il n'y a aucun problème avec un mur droit et que l'angle de perspective augmente, la distorsion devient plus perceptible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le même problème de perception s'est posé aux développeurs de Rage Software lors du portage de DOOM vers SEGA Saturn.</font></font><br>
<br>
<blockquote>«    ,        id Software.      ,      WAD       Saturn,      ,  3D-.   ,           ,          3D-   .     ,    PC.  ,   ,      :  SH2    ,   PC,  68000     .<br>
<br>
   ,      » —   ( DOOM  Saturn)   RetroGamer №134.</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peut-être, puisque les développeurs PSX ont eu plus de temps, ils ont pu résoudre le problème du mappage de texture prospectivement correct en transformant le rendu de polygone GPU en rendu de ligne.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"J'ai dit: tout sauvegarder (alors il n'y avait pas encore de système de contrôle de version!), Nous rendrons le jeu complètement différent." </font><font style="vertical-align: inherit;">Nous avons utilisé un équipement qui rendait des triangles représentant des colonnes ou des lignes d'un pixel de large, tout comme dans le code assembleur sur un PC, et cela fonctionnait très bien. </font><font style="vertical-align: inherit;">Il s'est avéré que la solution la plus courante sur la Playstation était la tessellation de la géométrie sur deux axes, mais j'ai vraiment aimé que Doom semblait moins "nerveux" que la plupart des jeux pour la Playstation de l'époque. "- John Carmack (Game Engine Black Book: DOOM)</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Grâce au projet PSXDOOM-RE </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[16],</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous pouvons découvrir comment il a été mis en œuvre. </font><font style="vertical-align: inherit;">Le pipeline de rendu a été complètement réécrit et divisé en deux étapes. </font><font style="vertical-align: inherit;">Ceci sera discuté plus en détail ci-dessous, mais nous pouvons réellement voir que la fonction de rendu R_Render_Wall transmet des commandes de dessin bien définies avec une largeur de 1 pixel.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">R_Render_Wall</span><span class="hljs-params">(...)</span> </span>{<font></font>
  .<font></font>
  <span class="hljs-keyword">int</span> x1 = ... ; <span class="hljs-comment">// Left end of wall.</span>
  <span class="hljs-keyword">int</span> x2 = ... ; <span class="hljs-comment">// Right end of wall.</span><font></font>
  .<font></font>
  <span class="hljs-keyword">while</span>(x1 &lt; x2) {<font></font>
    .<font></font>
    setRGB0(wallpoly);<font></font>
<font></font>
    setXY3(wallpoly,<font></font>
      x1    , ypos1 - <span class="hljs-number">1</span>,<font></font>
      x1 + <span class="hljs-number">1</span>, ypos2 + <span class="hljs-number">1</span>,<font></font>
      x1    , ypos2 + <span class="hljs-number">1</span>);		<font></font>
<font></font>
    setUV3(wallpoly,<font></font>
         upos, v0,<font></font>
         upos, v1,<font></font>
         upos, v1);  <font></font>
    .<font></font>
    x1 += <span class="hljs-number">1</span>;<font></font>
  }<font></font>
}</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les murs sont rendus dans des colonnes d'un pixel de large. </font><font style="vertical-align: inherit;">Découvrez l'API, qui ressemble au mode Immédiat dans OpenGL. </font></font></i><br>
<br>
<b><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fait intéressant:</font></font></u></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> le concepteur matériel de Sony a conservé l'i-cache du processeur MIPS, mais a désactivé son d-cache pour en faire un bloc-notes à grande vitesse 1K. </font><font style="vertical-align: inherit;">Les procédures de rendu des murs / plans ont largement utilisé ce bloc-notes.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gestion GPU VRAM</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour savoir comment le contrôle VRAM est effectué, j'ai choisi une méthode curieuse: j'ai utilisé la fonction de visualisation de l'émulateur VRAM en temps réel non $ PSX. </font><font style="vertical-align: inherit;">Cette fonction affiche l'intégralité du tableau de pixels 1024 x 512 x 16 bits (bien que sous une forme déformée). </font><font style="vertical-align: inherit;">La fonction de visualisation affiche également la liste complète des instructions GPU transmises par le processeur central dans chaque trame.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/106/6e1/2c4/1066e12c443fa07e91e8f4793afe655d.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No $ PSX - Dieu nous a envoyé un émulateur qui vous permet de regarder à l'intérieur du GPU. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une étude approfondie de la première image VRAM vous permet d'apprendre beaucoup.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dfd/e98/57f/dfde9857f541f946c946445fc5feb1ea.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La première image du jeu s'affiche avec No $ PSX. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les plus évidents sont deux zones de 256 x 240 x 16 bits dans le coin supérieur gauche, qui sont les tampons de trame (par conséquent, le jeu utilise une double mise en mémoire tampon). </font><font style="vertical-align: inherit;">Il convient de noter que 256x240 est la résolution la plus basse possible sur un PSX. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sous les tampons de cadre se trouve un ensemble coloré de pixels - la palette CLUT. </font><font style="vertical-align: inherit;">Notez les nuances de rouge, cela signifie que lorsque l'écran devient rouge lorsque le joueur subit des dégâts, des palettes pré-calculées sont utilisées. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le coin supérieur droit, nous voyons des textures étrangement compressées horizontalement et qui ont de «mauvaises» couleurs. </font><font style="vertical-align: inherit;">Cela s'est produit parce que les textures utilisent des indices 8 bits du CLUT décrits ci-dessus.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parlons à nouveau du feu dans DOOM sur PS1</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En 2018, j'ai étudié comment l'effet du feu a été réalisé </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[17]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">traduction</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur Habré]. </font><font style="vertical-align: inherit;">C'était génial de lui revenir lors de l'exploration des commandes du GPU. </font><font style="vertical-align: inherit;">Notez qu'aucun $ PSX ne marque la zone cible de chaque commande en rouge. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Étape 1: la</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> flamme est mise à jour en RAM et chargée en VRAM (commande CpuToVram).</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d61/e16/8a1/d61e168a1b238160665e78c437c7b2d5.png"></div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Étape 2: la</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> texture de </font><b><font style="vertical-align: inherit;">la</font></b><font style="vertical-align: inherit;"> flamme est dessinée quatre fois le long de l'écran (commande QuadTex). </font><font style="vertical-align: inherit;">La texture de la flamme a une largeur de 32 texels, mais le GPU est utilisé pour la dessiner avec une largeur de 64 pixels. </font><font style="vertical-align: inherit;">Le filtrage bilinéaire n'est pas possible ici, les texels les plus proches sont échantillonnés.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f1a/08b/a2c/f1a08ba2c51a31bd57bcf9b45827bb23.png"></div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Étape 3: la</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> plaque finale DOOM (commande QuadTex) est dessinée au-dessus de tout.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7de/30e/f5b/7de30ef5b64d978cf2f632cfe3ac82b4.png"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plein cadre, équipe par équipe</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une étude des commandes transmises dans le cadre a montré que le moteur est complètement différent de la version PC. Dans ce document, le monde a été entouré d'une courte distance dans la distance. Tout d'abord, tous les murs sont rendus. Au deuxième passage, un espace vertical est comblé entre eux (visplane) (y compris le ciel). Dans le troisième (dernier) passage, les sprites sont rendus, en commençant par le plus éloigné. Tout cela a été fait avec zéro pixel de redessin.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur PSX, le rendu est un peu plus grossier. Tout est rendu en un seul passage, exécuté à partir de loin. Le système de visplane utilisé par le PC pour combler le vide entre les murs n'est pas là. Grâce à un nouveau concept appelé «feuilles», le plan et les murs sont rendus dans l'ordre des sous-secteurs. De telles opérations en «vrai 3D» sont devenues possibles grâce à l'utilisation active des fonctions de projection matricielle GPE. Les sprites sont également rendus simultanément avec les murs / plans sans contrôles de chevauchement et de troncature, ce qui entraîne une petite quantité de redessin.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">R_RenderPlayerView</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  R_BSP();         <span class="hljs-comment">// Phase 1</span>
  R_RenderSKY();   <span class="hljs-comment">// Phase 2</span>
  <span class="hljs-keyword">for</span> (all subsectors from phase <span class="hljs-number">1</span>) {<font></font>
    R_RenderAll(subsector)<font></font>
  }<font></font>
  R_Render_Hud_Weapons();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Examinons chaque étape en détail, en commençant par le ciel, qui est d'abord rendu à l'aide de CopyRectRaw. aucun $ PSX ne montre VRAM à la fin de la trame, mais vous permet de revenir dans l'historique des commandes. Les pixels du ciel ne sont visibles que parce qu'aucun $ PSX n'a ​​de problèmes à percevoir ce hack avec des colonnes d'une largeur de pixel (d'autres émulateurs, tels que ePSXe, ne peuvent pas mieux faire face </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[18]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), mais tous ces pixels seront réécrits. Notez que sous les textures du ciel tous les marqueurs des clés des portes sont rassemblés dans un atlas.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d1d/2ae/868/d1d2ae868238f0282a8495a4e2dd6afd.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, le BSP est parcouru dans l'ordre de loin à près. Pour chaque sous-secteur, tous les murs / plans / sprites sont rendus. Si vous êtes familier avec DOOM BSP, alors souvenez-vous probablement que le compilateur doombsp ne gardait que des segments solides de sous-secteurs. Pour assurer le rendu des avions, un nouveau concept de «feuilles» a été ajouté à la version PSX, dans lequel les segments de séparation BPS (invisibles) étaient stockés. Ces segments sont projetés dans l'espace d'écran pour générer des limites planes. C'est une approche beaucoup plus «propre», car elle vous permet de vous débarrasser des hacks avec de l'espace d'écran et des bugs, par exemple, de la fameuse «piste de limace».</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/558/cde/f1d/558cdef1d6ef68f1272b1e260333fd3b.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la prochaine prise de vue VRAM, les avions du même sous-secteur que le mur que nous avons vu ci-dessus sont rendus sous forme de triangles de 1 pixel de haut. </font><font style="vertical-align: inherit;">Faites également attention à la texture des murs / plans, ils ont tous la même taille. </font><font style="vertical-align: inherit;">Cette fonctionnalité simplifie la sélection des textures VRAM et évite la fragmentation.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/be6/092/6ce/be60926ce5304a264da51ab38a3e2c6a.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous sommes toujours dans le même sous-secteur. </font><font style="vertical-align: inherit;">Les sprites sont maintenant rendus en quadrangles (Quad). </font><font style="vertical-align: inherit;">Ces sprites comprennent des ennemis, des obus, des murs partiellement transparents.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/708/e06/cf6/708e06cf66400378617db2484694433c.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour le plaisir, nous allons montrer des coques de plasma.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fb4/c5a/ebc/fb4c5aebca255019caa7d8c31140c136.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous approchons de la fin des commandes de rendu. </font><font style="vertical-align: inherit;">Ici, en mélangeant le rectangle, l'arme est rendue.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ac2/061/da0/ac2061da0769c7e614503818d5e59755.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dernière étape: rendu d'interface (HUD).</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a34/be3/7e9/a34be37e93d0991d27b5d4fd8a3356c4.png"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Débordement de VRAM!</font></font></h2><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/853/a77/9cc/853a779ccdc0280234e53ab3b6aea59a.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Travailler avec le GPU était un exercice d'allocation d'espace dans la VRAM. Dans le cas des tampons de cadre, CLUT, du contenu statique (interface) et même des murs / plans, la tâche est élémentaire, car ils ont tous la même taille. Mais avec les sprites, les choses sont un peu plus compliquées. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Du fait que les sprites ont des tailles différentes, ils conduisent à la fragmentation. De plus, les textures peuvent couvrir de grandes zones de l'écran et se répéter, et les sprites sont souvent uniques et un nombre imprévisible d'un grand nombre d'entre eux peut être requis dans chaque image. Dans le pire des cas, une trame nécessite un certain nombre de sprites qui ne peuvent pas être placés dans VRAM. Cela s'appelle un débordement de cache de texture et ce problème ne peut pas être résolu. Lorsque cela se produit, le jeu se bloque et affiche un message d'erreur cryptique </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[19]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rappelant à certains d’entre nous le sinistre «Plus de visplans».</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1fb/4a4/f9f/1fb4a4f9fecf0b6420b198b08ff2f84d.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plus vous voyez de sprites en même temps, plus la VRAM est utilisée.</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La différence entre PAL et NTSC</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conclusion du chapitre vidéo, j'ai décidé de voir comment NTSC est converti en PAL. </font><font style="vertical-align: inherit;">Malheureusement, comme dans beaucoup d'autres jeux, le DOOM PSX n'a ​​pas pris en compte l'augmentation de la résolution verticale. </font><font style="vertical-align: inherit;">Lors de la lecture de DOOM sur PS1 en Europe, vous avez vu une image compressée verticalement avec des bordures noires visibles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir appris les principes de la VRAM, il m'est difficile de blâmer les développeurs. </font><font style="vertical-align: inherit;">Si vous regardez attentivement le schéma VRAM dans NTSC, vous remarquerez que l'augmentation de la résolution verticale du tampon de trame viole la structure d'allocation de données entière. </font><font style="vertical-align: inherit;">Il serait impossible de stocker des textures en dessous. </font><font style="vertical-align: inherit;">Ou vous devez déplacer CLUT vers un autre emplacement. </font><font style="vertical-align: inherit;">Trop cher avec relativement peu d'avantages, et même en dépit du fait que les bordures noires interféraient avec le jeu, je conviens que cela n'en valait pas la peine.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remerciements</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Merci à Eric Vazquez (auteur de PSXDOOM-RE), Samuel Villarreal (l'un des développeurs de PSXDOOM-RE) et Dan Leslie (développeur professionnel de jeux pour PlayStation 1) pour avoir généreusement partagé leurs connaissances avec moi.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Matériel de référence</font></font></b><div class="spoiler_text">[ 1] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">The Polygons Of Another World</a><br>
[ 2] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">Game Engine Black Book: DOOM</a><br>
[ 3] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">Everything You Have Always Wanted to Know about the Playstation</a><br>
[ 4] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">@gmontoir — 'Heart of Darkness uses MDEC frames as background bitmaps'.</a><br>
[ 5] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">Five years of DOOM, part 1</a><br>
[ 6] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">Five years of DOOM, part 2</a><br>
[ 7] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://archive.vn/20121209124333/" rel="nofollow">The Great Books</a><br>
[ 8] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">DOOM PSX tracks</a><br>
[ 9] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">MAP59: Club Doom (PlayStation Doom)</a><br>
[10] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">PSXDOOM/tree.txt</a><br>
[11] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">PSXDOOM files</a><br>
[12] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">PSY-Q SDK, CD Hardware</a><br>
[13] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">P_LoadBlocks</a><br>
[14] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">Linedef #142 plays Club Doom</a><br>
[15] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">//#define CC_ARCH</a><br>
[16] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">PSXDOOM-RE Source code</a><br>
[17] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">How DOOM fire was done</a><br>
[18] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">DOOM on ePSXe</a><br>
[19] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">I_Error('Texture Cache Overflow');</a></div></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr494374/index.html">Bus électriques et leurs batteries: qu'est-ce que le titanate de lithium? (Partie 1)</a></li>
<li><a href="../fr494376/index.html">Tampon de profondeur hiérarchique</a></li>
<li><a href="../fr494380/index.html">Introduction à la gestion stratégique des produits</a></li>
<li><a href="../fr494384/index.html">Enquête fonctionnelle</a></li>
<li><a href="../fr494390/index.html">L'impression 3D réduit de moitié les coûts de réglage automatique</a></li>
<li><a href="../fr494400/index.html">Coronavirus et Internet</a></li>
<li><a href="../fr494402/index.html">Étapes de la maturité stratégique</a></li>
<li><a href="../fr494406/index.html">Apprentissage automatique sans professeur. Extrait du livre</a></li>
<li><a href="../fr494408/index.html">Le système de contrefaçon, de restauration et de contrôle des fruits dans une épicerie verte. Extrait du livre</a></li>
<li><a href="../fr494410/index.html">Avant qu'il ne devienne courant: comment nous avons lancé la livraison sans contact</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>