<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛬 🧒🏽 👉🏿 Déterminer la taille appropriée pour le cluster Kafka dans Kubernetes 🛌🏻 🧕🏼 🙆🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Remarque perev. : Dans cet article, Banzai Cloud partage un exemple d'utilisation de ses utilitaires spéciaux pour faciliter le fonctionnement de Kafk...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Déterminer la taille appropriée pour le cluster Kafka dans Kubernetes</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/488920/"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remarque perev.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Dans cet article, Banzai Cloud partage un exemple d'utilisation de ses utilitaires spéciaux pour faciliter le fonctionnement de Kafka au sein de Kubernetes. Ces instructions illustrent comment vous pouvez déterminer la taille optimale de l'infrastructure et configurer Kafka lui-même pour atteindre le débit requis.</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/hw/a_/x4/hwa_x4pat6hztyyuh8lorl015pq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Apache Kafka est une plate-forme de streaming distribuée pour créer des systèmes de streaming en temps réel fiables, évolutifs et hautes performances. Ses fonctionnalités impressionnantes peuvent être étendues avec Kubernetes. Pour ce faire, nous avons développé l'</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> opérateur Kafka Open Source</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et un outil appelé</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Supertubes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ils vous permettent d'exécuter Kafka dans Kubernetes et d'utiliser ses diverses fonctions, telles que le réglage fin de la configuration du courtier, la mise à l'échelle basée sur des métriques avec rééquilibrage, la connaissance du rack (connaissance des ressources matérielles), </font><font style="vertical-align: inherit;">les mises à jour continues </font><font style="vertical-align: inherit;">«douces» </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(gracieuses)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , etc.</font></font><a name="habracut"></a><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essayez les supertubes dans votre cluster:</font></font><br>
<br>
<pre><code class="bash hljs">curl https://getsupertubes.sh | sh  supertubes install -a --no-democluster --kubeconfig &lt;path-to-eks-cluster-kubeconfig-file&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou reportez-vous à la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vous pouvez également lire certaines des fonctionnalités de Kafka, qui sont automatisées avec l'aide de Supertubes et de l'opérateur Kafka. </font><font style="vertical-align: inherit;">Nous en avons déjà parlé sur le blog:</font></font><br>
<br>
<ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oh non! </font><font style="vertical-align: inherit;">Encore un autre opérateur Kafka pour Kubernetes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Surveillez et utilisez Kafka sur la base des métriques de Prometheus</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sensibilisation de Kafka rack sur Kubernetes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Courir Apache Kafka sur Istio - référence</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clusters authentifiés par l'utilisateur et contrôlés par l'accès avec l'opérateur Kafka</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mise à niveau et configuration dynamique de Kafka sur Kubernetes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Filtre de protocole Envoy pour Kafka, maillé</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ul></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque vous décidez de déployer un cluster Kafka dans Kubernetes, vous rencontrerez probablement le problème de déterminer la taille optimale de l'infrastructure sous-jacente et le besoin d'affiner la configuration Kafka pour répondre aux exigences de bande passante. </font><font style="vertical-align: inherit;">Les performances maximales de chaque courtier sont déterminées par les performances des composants de l'infrastructure au cœur, tels que la mémoire, le processeur, la vitesse du disque, la bande passante du réseau, etc.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Idéalement, la configuration du courtier devrait être telle que tous les éléments de l'infrastructure soient utilisés au maximum de leurs capacités. Cependant, dans la vraie vie, cette configuration est très compliquée. Il est plus probable que les utilisateurs configurent des courtiers pour maximiser l'utilisation d'un ou deux composants (disque, mémoire ou processeur). De manière générale, un courtier affiche des performances maximales lorsque sa configuration vous permet d'utiliser le composant le plus lent "dans son intégralité". Nous pouvons donc avoir une idée approximative de la charge qu'un courtier peut gérer.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Théoriquement, nous pouvons également estimer le nombre de courtiers nécessaires pour travailler avec une charge donnée. Cependant, dans la pratique, il existe tellement d'options de configuration à différents niveaux qu'il est très difficile (voire impossible) d'évaluer les performances potentielles d'une certaine configuration. En d'autres termes, il est très difficile de planifier la configuration, à partir de certaines performances données. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour les utilisateurs de Supertubes, nous adoptons généralement l'approche suivante: commencer par une configuration (infrastructure + paramètres), puis mesurer ses performances, ajuster les paramètres du courtier et répéter le processus à nouveau. Cela se produit jusqu'à ce que le potentiel du composant d'infrastructure le plus lent soit pleinement utilisé.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De cette façon, nous obtenons une idée plus claire du nombre de courtiers dont un cluster a besoin pour faire face à une certaine charge (le nombre de courtiers dépend également d'autres facteurs, tels que le nombre minimum de répliques de messages pour assurer la stabilité, le nombre de chefs de partition, etc.). De plus, nous avons une idée du dimensionnement vertical des composants d'infrastructure souhaité. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cet article présentera les étapes que nous prenons pour «tout extraire» des composants les plus lents dans les configurations initiales et mesurer le débit du cluster Kafka. Une configuration hautement résiliente nécessite au moins trois courtiers actifs (</font></font><code>min.insync.replicas=3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) espacées dans trois zones d'accessibilité différentes. </font><font style="vertical-align: inherit;">Pour configurer, faire évoluer et surveiller l'infrastructure Kubernetes, nous utilisons notre propre plateforme de gestion de conteneurs cloud hybride - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pipeline</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il prend en charge sur site (bare metal, VMware) et cinq types de clouds (Alibaba, AWS, Azure, Google, Oracle), ainsi que toute combinaison de ceux-ci.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Réflexions sur l'infrastructure et la configuration du cluster Kafka</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour les exemples ci-dessous, nous avons sélectionné AWS comme fournisseur de services cloud et EKS comme distribution Kubernetes. </font><font style="vertical-align: inherit;">Une configuration similaire peut être implémentée à l'aide de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PKE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , une distribution Kubernetes de Banzai Cloud, certifiée par la CNCF.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Disque</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Amazon propose différents </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">types de volumes EBS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Les SSD sont la </font><font style="vertical-align: inherit;">base de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gp2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">io1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , cependant, pour garantir un débit élevé, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gp2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> consomme des prêts accumulés </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> crédits d' </font><i><font style="vertical-align: inherit;">E / S)</font></i><font style="vertical-align: inherit;"> , c'est pourquoi nous avons préféré le type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">io1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui offre un débit élevé stable.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Types d'instances</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les performances de Kafka dépendent fortement du cache de pages du système d'exploitation, nous avons donc besoin d'instances avec suffisamment de mémoire pour les courtiers (JVM) et de cache de pages. L'instance </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c5.2xlarge</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est un bon début, car elle dispose de 16 Go de mémoire et est </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">optimisée pour fonctionner avec EBS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Son inconvénient est qu'il est capable de fournir des performances maximales pendant pas plus de 30 minutes toutes les 24 heures. Si votre charge de travail nécessite des performances maximales sur une période plus longue, examinez d'autres types d'instances. C'est exactement ce que nous avons fait, en nous arrêtant à </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c5.4xlarge</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Il fournit un débit maximum de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">593,75 Mb / s.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Le débit maximal du </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">volume</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> EBS </font><i><font style="vertical-align: inherit;">io1 est</font></i><font style="vertical-align: inherit;"> supérieur à celui de l'instance </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c5.4xlarge</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , donc l'élément d'infrastructure le plus lent est probablement le débit d'E / S de ce type d'instance (qui devrait également être confirmé par les résultats de nos tests de charge).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Réseau</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La bande passante réseau doit être assez importante par rapport aux performances de l'instance de VM et du disque, sinon le réseau devient un goulot d'étranglement. </font><font style="vertical-align: inherit;">Dans notre cas, l'interface réseau </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c5.4xlarge</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> prend en charge des vitesses allant jusqu'à 10 Gb / s, ce qui est nettement supérieur à la bande passante de l'instance d'E / S de la machine virtuelle.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Déploiement de courtier</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les courtiers doivent être déployés (prévu dans Kubernetes) sur des nœuds dédiés afin d'éviter la concurrence avec d'autres processus pour les ressources processeur, mémoire, réseau et disque.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Version Java</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le choix logique est Java 11, car il est compatible avec Docker dans le sens où la JVM détermine correctement les processeurs et la mémoire disponibles pour le conteneur dans lequel le courtier s'exécute. </font><font style="vertical-align: inherit;">Sachant que les limites du processeur sont importantes, la JVM définit en interne et de manière transparente le nombre de threads GC et de threads du compilateur JIT. </font><font style="vertical-align: inherit;">Nous avons utilisé une image Kafka </font></font><code>banzaicloud/kafka:2.13-2.4.0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui inclut la version 2.4.0 de Kafka (Scala 2.13) dans Java 11.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous souhaitez en savoir plus sur Java / JVM sur Kubernetes, consultez nos publications suivantes:</font></font><br>
<br>
<ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourquoi mon application Java est OOMKilled</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment dimensionner correctement les conteneurs pour les applications Java 10</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ul></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paramètres de mémoire du courtier</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La configuration de la mémoire du courtier comporte deux aspects clés: les paramètres de la JVM et du module Kubernetes. </font><font style="vertical-align: inherit;">La limite de mémoire définie pour le pod doit être supérieure à la taille de segment maximale afin que la machine virtuelle Java dispose de suffisamment d'espace pour la métaspace Java dans sa propre mémoire et pour le cache de page du système d'exploitation que Kafka utilise activement. </font><font style="vertical-align: inherit;">Lors de nos tests, nous avons exécuté des courtiers Kafka avec des paramètres </font></font><code>-Xmx4G -Xms2G</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et la limite de mémoire pour le pod était </font></font><code>10 Gi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Veuillez noter que les paramètres de mémoire de la JVM peuvent être obtenus automatiquement à l'aide de </font></font><code>-XX:MaxRAMPercentage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>-X:MinRAMPercentage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, en fonction de la limite de mémoire du module.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paramètres du processeur du courtier</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De manière générale, vous pouvez augmenter la productivité en augmentant la concurrence en augmentant le nombre de threads utilisés par Kafka. </font><font style="vertical-align: inherit;">Plus il y a de processeurs disponibles pour Kafka, mieux c'est. </font><font style="vertical-align: inherit;">Dans notre test, nous avons commencé avec une limite de 6 processeurs et avons progressivement (itéré) augmenté leur nombre à 15. De plus, nous avons défini </font></font><code>num.network.threads=12</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les paramètres du courtier pour augmenter le nombre de flux qui reçoivent des données du réseau et les envoient. </font><font style="vertical-align: inherit;">Ayant immédiatement découvert que les courtiers suiveurs ne peuvent pas recevoir les répliques assez rapidement, ils ont augmenté </font></font><code>num.replica.fetchers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">à 4 pour augmenter la vitesse à laquelle les courtiers suiveurs ont répliqué les messages des dirigeants.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outil de génération de charge</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assurez-vous que le potentiel du générateur de charge sélectionné ne s'épuise pas avant que le cluster Kafka (dont la référence est en cours d'exécution) n'atteigne sa charge maximale. </font><font style="vertical-align: inherit;">En d'autres termes, il est nécessaire d'effectuer une évaluation préliminaire des capacités de l'outil de génération de charge, ainsi que de sélectionner des types d'instance pour celui-ci avec un nombre suffisant de processeurs et de mémoire. </font><font style="vertical-align: inherit;">Dans ce cas, notre outil produira plus de charge que le cluster Kafka ne peut en digérer. </font><font style="vertical-align: inherit;">Après de nombreuses expériences, nous nous sommes installés sur trois copies de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c5.4xlarge</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dans chacune desquelles le générateur a été lancé.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analyse comparative</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La mesure du rendement est un processus itératif qui comprend les étapes suivantes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> configuration de l'infrastructure (cluster EKS, cluster Kafka, outil de génération de charge, ainsi que Prometheus et Grafana);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> génération de charge pendant une certaine période pour filtrer les écarts aléatoires dans les indicateurs de performance collectés;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> affiner l'infrastructure et la configuration du courtier en fonction des indicateurs de performance observés;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">répéter le processus jusqu'à ce que le niveau requis de bande passante du cluster Kafka soit atteint. </font><font style="vertical-align: inherit;">En même temps, il doit être reproductible de manière stable et présenter des variations de bande passante minimales.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La section suivante décrit les étapes qui ont été effectuées pendant le cluster de test de référence.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outils</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les outils suivants ont été utilisés pour déployer rapidement la configuration de base, la génération de charge et la mesure des performances:</font></font><br>
<br>
<ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Banzai Cloud Pipeline</a>    EKS  Amazon c <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Prometheus</a> (   Kafka  )  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Grafana</a> (   ).   <b></b>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Pipeline</a> ,    ,   ,  ,   ,      .</li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sangrenel</a> —      Kafka.</li>
<li>  Grafana    Kafka  : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kubernetes Kafka</a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Node Exporter</a>.</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supertubes CLI pour la manière la plus simple de configurer un cluster Kafka dans Kubernetes. </font><font style="vertical-align: inherit;">Zookeeper, opérateur Kafka, Envoy et de nombreux autres composants sont installés et correctement configurés pour démarrer le cluster Kafka prêt à la production dans Kubernetes.</font></font><br>
 <ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour installer la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">supertubes CLI,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilisez les instructions fournies </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ul></li>
</ul><br>
<img src="https://habrastorage.org/webt/98/xv/7i/98xv7iy-cxitdjo3xakipblgp5u.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cluster EKS</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Préparez un cluster EKS avec des nœuds de travail </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c5.4xlarge</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dédiés </font><font style="vertical-align: inherit;">dans différentes zones de disponibilité pour les pods avec les courtiers Kafka, ainsi que des nœuds dédiés pour le générateur de charge et l'infrastructure de surveillance.</font></font><br>
<br>
<pre><code class="bash hljs">banzai cluster create -f https://raw.githubusercontent.com/banzaicloud/kafka-operator/master/docs/benchmarks/infrastructure/cluster_eks_202001.json</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque le cluster EKS est opérationnel, activez son </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">service de surveillance</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> intégré </font><font style="vertical-align: inherit;">- il déploiera Prometheus et Grafana sur le cluster.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Composants du système Kafka</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Installez les composants du système Kafka (Zookeeper, kafka-operator) dans l'EKS en utilisant les supertubes CLI:</font></font><br>
<br>
<pre><code class="bash hljs">supertubes install -a --no-democluster --kubeconfig &lt;path-to-eks-cluster-kubeconfig-file&gt;</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cluster Kafka</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par défaut, EKS utilise des </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">volumes gp2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> EBS </font><font style="vertical-align: inherit;">, vous devez donc créer une classe de stockage distincte basée sur les volumes </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">io1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour le cluster Kafka:</font></font><br>
<br>
<pre><code class="plaintext hljs">kubectl create -f - &lt;&lt;EOF<font></font>
apiVersion: storage.k8s.io/v1<font></font>
kind: StorageClass<font></font>
metadata:<font></font>
  name: fast-ssd<font></font>
provisioner: kubernetes.io/aws-ebs<font></font>
parameters:<font></font>
  type: io1<font></font>
  iopsPerGB: "50"<font></font>
  fsType: ext4<font></font>
volumeBindingMode: WaitForFirstConsumer<font></font>
EOF</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Définissez un paramètre pour les courtiers </font></font><code>min.insync.replicas=3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et déployez des modules de courtier sur les nœuds dans trois zones de disponibilité différentes:</font></font><br>
<br>
<pre><code class="bash hljs">supertubes cluster create -n kafka --kubeconfig &lt;path-to-eks-cluster-kubeconfig-file&gt; -f https://raw.githubusercontent.com/banzaicloud/kafka-operator/master/docs/benchmarks/infrastructure/kafka_202001_3brokers.yaml --<span class="hljs-built_in">wait</span> --timeout 600</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les sujets</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons lancé simultanément trois instances du générateur de charge. </font><font style="vertical-align: inherit;">Chacun d'eux écrit dans son propre sujet, c'est-à-dire qu'il nous suffit de trois sujets:</font></font><br>
<br>
<pre><code class="bash hljs">supertubes cluster topic create -n kafka --kubeconfig &lt;path-to-eks-cluster-kubeconfig-file&gt; -f -&lt;&lt;EOF<font></font>
apiVersion: kafka.banzaicloud.io/v1alpha1<font></font>
kind: KafkaTopic<font></font>
metadata:<font></font>
  name: perftest1<font></font>
spec:<font></font>
  name: perftest1<font></font>
  partitions: 12<font></font>
  replicationFactor: 3<font></font>
  retention.ms: <span class="hljs-string">'28800000'</span><font></font>
  cleanup.policy: delete<font></font>
EOF<font></font>
<font></font>
supertubes cluster topic create -n kafka --kubeconfig &lt;path-to-eks-cluster-kubeconfig-file&gt; -f -&lt;&lt;EOF<font></font>
apiVersion: kafka.banzaicloud.io/v1alpha1<font></font>
kind: KafkaTopic<font></font>
metadata:<font></font>
    name: perftest2<font></font>
spec:<font></font>
  name: perftest2<font></font>
  partitions: 12<font></font>
  replicationFactor: 3<font></font>
  retention.ms: <span class="hljs-string">'28800000'</span><font></font>
  cleanup.policy: delete<font></font>
EOF<font></font>
<font></font>
supertubes cluster topic create -n kafka --kubeconfig &lt;path-to-eks-cluster-kubeconfig-file&gt; -f -&lt;&lt;EOF<font></font>
apiVersion: kafka.banzaicloud.io/v1alpha1<font></font>
kind: KafkaTopic<font></font>
metadata:<font></font>
  name: perftest3<font></font>
spec:<font></font>
  name: perftest3<font></font>
  partitions: 12<font></font>
  replicationFactor: 3<font></font>
  retention.ms: <span class="hljs-string">'28800000'</span><font></font>
  cleanup.policy: delete<font></font>
EOF</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour chaque sujet, le facteur de réplication est 3 - la valeur minimale recommandée pour les systèmes de production hautement disponibles.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outil de génération de charge</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons lancé trois instances du générateur de charge (chacune écrite dans une rubrique distincte). </font><font style="vertical-align: inherit;">Pour les pods du générateur de charge, vous devez enregistrer l'affinité des nœuds afin qu'ils ne soient planifiés que sur les nœuds qui leur sont alloués:</font></font><br>
<br>
<pre><code class="plaintext hljs">apiVersion: extensions/v1beta1<font></font>
kind: Deployment<font></font>
metadata:<font></font>
  labels:<font></font>
    app: loadtest<font></font>
  name: perf-load1<font></font>
  namespace: kafka<font></font>
spec:<font></font>
  progressDeadlineSeconds: 600<font></font>
  replicas: 1<font></font>
  revisionHistoryLimit: 10<font></font>
  selector:<font></font>
    matchLabels:<font></font>
      app: loadtest<font></font>
  strategy:<font></font>
    rollingUpdate:<font></font>
      maxSurge: 25%<font></font>
      maxUnavailable: 25%<font></font>
    type: RollingUpdate<font></font>
  template:<font></font>
    metadata:<font></font>
      creationTimestamp: null<font></font>
      labels:<font></font>
        app: loadtest<font></font>
    spec:<font></font>
      affinity:<font></font>
        nodeAffinity:<font></font>
          requiredDuringSchedulingIgnoredDuringExecution:<font></font>
            nodeSelectorTerms:<font></font>
            - matchExpressions:<font></font>
              - key: nodepool.banzaicloud.io/name<font></font>
                operator: In<font></font>
                values:<font></font>
                - loadgen<font></font>
      containers:<font></font>
      - args:<font></font>
        - -brokers=kafka-0:29092,kafka-1:29092,kafka-2:29092,kafka-3:29092<font></font>
        - -topic=perftest1<font></font>
        - -required-acks=all<font></font>
        - -message-size=512<font></font>
        - -workers=20<font></font>
        image: banzaicloud/perfload:0.1.0-blog<font></font>
        imagePullPolicy: Always<font></font>
        name: sangrenel<font></font>
        resources:<font></font>
          limits:<font></font>
            cpu: 2<font></font>
            memory: 1Gi<font></font>
          requests:<font></font>
            cpu: 2<font></font>
            memory: 1Gi<font></font>
        terminationMessagePath: /dev/termination-log<font></font>
        terminationMessagePolicy: File<font></font>
      dnsPolicy: ClusterFirst<font></font>
      restartPolicy: Always<font></font>
      schedulerName: default-scheduler<font></font>
      securityContext: {}<font></font>
      terminationGracePeriodSeconds: 30</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quelques points à prendre en compte:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Le générateur de charge génère des messages de 512 octets et les publie sur Kafka par lots de 500 messages.</font></font></li>
<li>    <code>-required-acks=all</code>   ,          Kafka.  ,          ,  ,    ,  .           <i>(consumers)</i>   ,       ,       ,   .</li>
<li>     20 worker' (<code>-workers=20</code>).  worker  5 producer',     worker'   Kafka.      100 producer',        Kafka.</li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Surveillance de cluster</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendant les tests de résistance du cluster Kafka, nous avons également surveillé son état de santé pour nous assurer qu'il n'y avait pas de redémarrage des pods, des répliques désynchronisées et un débit maximal avec des fluctuations minimales:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le générateur de charge écrit des statistiques standard sur le nombre de messages publiés et le niveau d'erreurs. </font><font style="vertical-align: inherit;">Le pourcentage d'erreurs doit rester dans la valeur </font></font><code>0,00%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cruise Control</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , déployé par kafka-operator, fournit un tableau de bord sur lequel nous pouvons également surveiller l'état du cluster. </font><font style="vertical-align: inherit;">Pour afficher ce panneau, procédez comme suit:</font></font><br>
<br>
<pre><code class="bash hljs">supertubes cluster cruisecontrol show -n kafka --kubeconfig &lt;path-to-eks-cluster-kubeconfig-file&gt;</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le niveau ISR </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(nombre de répliques synchronisées) de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> retrait et d'expansion est 0.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Résultats de mesure</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 courtiers, taille du message - 512 octets</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec des partitions réparties uniformément sur trois courtiers, nous avons réussi à atteindre une performance de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">~ 500 Mb / s (environ 990 000 messages par seconde)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ql/5s/kk/ql5skk9eq59vw1dxiptnpv5baoo.png"><br>
<br>
<img src="https://habrastorage.org/webt/ye/cg/rc/yecgrcrh-mrdchebbysisw4mg3a.png"><br>
<br>
<img src="https://habrastorage.org/webt/5i/t6/it/5it6itlq4hfnndz2f-refjm1sbq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
la consommation de mémoire de la machine virtuelle JVM ne dépassait pas 2 Go: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pc/_s/-f/pc_s-fapugnsmx114p1rssgst8m.png"><br>
<br>
<img src="https://habrastorage.org/webt/2e/1-/qw/2e1-qwc0rb2fqk_bw_hkgr0jbl8.png"><br>
<br>
<img src="https://habrastorage.org/webt/m-/tr/nw/m-trnwodxrqpftqhnrnp35f25cy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
la bande passante du disque atteignait la bande passante d'E / S maximale le nœud sur les trois instances sur </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tr/tx/tg/trtxtgaqntrbc_bwrxmxmxh9opu.png"><br>
<br>
<img src="https://habrastorage.org/webt/_k/ns/dh/_knsdhmjkkc2245qffym_pnkxge.png"><br>
<br>
<img src="https://habrastorage.org/webt/rq/xo/8x/rqxo8xwg5dualnt3uqt2jxmfeta.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
lesquelles </font><font style="vertical-align: inherit;">les courtiers ont travaillé: </font><font style="vertical-align: inherit;">D'après les données sur l'utilisation de la mémoire par les nœuds, il s'ensuit que la mise en mémoire tampon et la mise en cache du système ont pris environ 10 à 15 Go:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/p3/ls/r6/p3lsr6ixa3wx0zfeowuqo_qlpq0.png"><br>
<br>
<img src="https://habrastorage.org/webt/aq/tn/fd/aqtnfdsjnp33e3buy5dxkrvojg4.png"><br>
<br>
<img src="https://habrastorage.org/webt/pi/aa/iv/piaaivarggmqsqiopmtx_doi4tg.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 courtiers, taille du message - 100 octets</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec une diminution de la taille des messages, le débit diminue d'environ 15 à 20%: le temps consacré au traitement de chaque message est affecté. </font><font style="vertical-align: inherit;">De plus, la charge du processeur a presque doublé. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mp/9l/9l/mp9l9lcmuwuh866dce_v0puzrt0.png"><br>
<br>
<img src="https://habrastorage.org/webt/z0/ck/hd/z0ckhdrst6iqql9i5drcksb7y7i.png"><br>
<br>
<img src="https://habrastorage.org/webt/hu/dg/dp/hudgdpo3e8s0ft0zxd7tngwne3y.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Étant donné que les nœuds de courtier ont toujours des noyaux inutilisés, vous pouvez améliorer les performances en modifiant la configuration de Kafka. </font><font style="vertical-align: inherit;">Ce n'est pas une tâche facile, par conséquent, pour augmenter le débit, il est préférable de travailler avec des messages plus volumineux.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 courtiers, taille du message - 512 octets</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez facilement augmenter les performances du cluster Kafka en ajoutant simplement de nouveaux courtiers et en maintenant l'équilibre des partitions (cela garantit une répartition uniforme de la charge entre les courtiers). </font><font style="vertical-align: inherit;">Dans notre cas, après l'ajout d'un courtier, le débit du cluster est passé à </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">~ 580 Mb / s (~ 1,1 million de messages par seconde)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">La croissance s'est avérée plus faible que prévu: cela est principalement dû au déséquilibre des partitions (tous les courtiers ne travaillent pas au plus fort des opportunités). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8x/cs/nq/8xcsnqeafi6tom_rxrbb5jz1zmk.png"><br>
<br>
<img src="https://habrastorage.org/webt/_2/qm/2j/_2qm2jqmcig_qwnypgirtzwcnw0.png"><br>
<br>
<img src="https://habrastorage.org/webt/zn/vx/jm/znvxjmy9hpxm3c29l-x616hfyfa.png"><br>
<br>
<img src="https://habrastorage.org/webt/gm/mt/sc/gmmtscxckvpwqr3ypzmkz45jscu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La consommation de mémoire de la machine JVM reste inférieure à 2 Go: le </font></font><br>
<br>
<img src="https://habrastorage.org/webt/a7/w7/qh/a7w7qh73p6ug6ozgqksh224fanc.png"><br>
<br>
<img src="https://habrastorage.org/webt/pe/cn/gs/pecngsl4nhacfu1drnmevl3p96q.png"><br>
<br>
<img src="https://habrastorage.org/webt/ee/vh/ei/eevheiyiaf_sxnw8epxlsnizxak.png"><br>
<br>
<img src="https://habrastorage.org/webt/lz/gj/lb/lzgjlblbytxjujal32u1nmgjixo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
déséquilibre de partition a affecté le fonctionnement des courtiers avec les disques:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/4w/ga/3j/4wga3j3ogq8d_pesoite7ln9alk.png"><br>
<br>
<img src="https://habrastorage.org/webt/jb/sh/rl/jbshrlplduwv4xrnfdhab65auy8.png"><br>
<br>
<img src="https://habrastorage.org/webt/3r/dw/ox/3rdwox-qntdekifec-vuoooozuc.png"><br>
<br>
<img src="https://habrastorage.org/webt/oz/ux/cd/ozuxcdtsqz-rfgwmun8iljtgxcq.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">résultats</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'approche itérative présentée ci-dessus peut être étendue pour couvrir des scénarios plus complexes, notamment des centaines de consommateurs, le repartitionnement, les mises à jour continues, les redémarrages de pods, etc. Tout cela nous permet d'évaluer les limites des capacités du cluster Kafka dans diverses conditions, d'identifier les goulots d'étranglement dans son travail et de trouver des moyens de les surmonter. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons développé des supertubes pour déployer rapidement et facilement un cluster, le configurer, ajouter / supprimer des courtiers et des rubriques, répondre aux alertes et nous assurer que Kafka fonctionne correctement dans Kubernetes dans son ensemble. Notre objectif est d'aider à se concentrer sur la tâche principale («générer» et «consommer» des messages Kafka), et de fournir tout le travail acharné aux opérateurs Supertubes et Kafka.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous êtes intéressé par les technologies Banzai Cloud et les projets Open Source, abonnez-vous à la société sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LinkedIn</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Twitter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS du traducteur</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lisez aussi dans notre blog:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">« </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une histoire avec l'opérateur Redis dans les K8 et un mini-aperçu des utilitaires pour analyser les données de cette base de données</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> »;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">« </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Migration sans obstacle de RabbitMQ vers Kubernetes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> »;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zetcd de CoreOS: Remplacement de ZooKeeper par ... le stockage etcd</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ."</font></font></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr488908/index.html">Rédacteur KPI ou caractéristiques de l'évaluation du travail des auteurs à distance sur le personnel et les pigistes</a></li>
<li><a href="../fr488910/index.html">Le livre «Amour et mathématiques. Le cœur de la réalité cachée</a></li>
<li><a href="../fr488912/index.html">Python News Bitcoin Price Prediction</a></li>
<li><a href="../fr488916/index.html">Cascadeur: Le problème du chat qui tombe</a></li>
<li><a href="../fr488918/index.html">Ingénieur de données ou mourir: une histoire de développeur unique</a></li>
<li><a href="../fr488926/index.html">5 cours gratuits pour les ingénieurs de Microsoft AI</a></li>
<li><a href="../fr488946/index.html">Menu de la console Python</a></li>
<li><a href="../fr488948/index.html">UPD. Test de l'API REST sur Golang. 120 000 [# / sec] n'est pas la limite?</a></li>
<li><a href="../fr488950/index.html">Temps dans une machine cellulaire</a></li>
<li><a href="../fr488952/index.html">Analyse des sentiments d'expression à l'aide de réseaux de neurones</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>