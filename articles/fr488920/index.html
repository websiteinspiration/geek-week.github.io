<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõ¨ üßíüèΩ üëâüèø D√©terminer la taille appropri√©e pour le cluster Kafka dans Kubernetes üõåüèª üßïüèº üôÜüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Remarque perev. : Dans cet article, Banzai Cloud partage un exemple d'utilisation de ses utilitaires sp√©ciaux pour faciliter le fonctionnement de Kafk...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>D√©terminer la taille appropri√©e pour le cluster Kafka dans Kubernetes</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/488920/"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remarque perev.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Dans cet article, Banzai Cloud partage un exemple d'utilisation de ses utilitaires sp√©ciaux pour faciliter le fonctionnement de Kafka au sein de Kubernetes. Ces instructions illustrent comment vous pouvez d√©terminer la taille optimale de l'infrastructure et configurer Kafka lui-m√™me pour atteindre le d√©bit requis.</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/hw/a_/x4/hwa_x4pat6hztyyuh8lorl015pq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Apache Kafka est une plate-forme de streaming distribu√©e pour cr√©er des syst√®mes de streaming en temps r√©el fiables, √©volutifs et hautes performances. Ses fonctionnalit√©s impressionnantes peuvent √™tre √©tendues avec Kubernetes. Pour ce faire, nous avons d√©velopp√© l'</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> op√©rateur Kafka Open Source</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et un outil appel√©</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Supertubes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ils vous permettent d'ex√©cuter Kafka dans Kubernetes et d'utiliser ses diverses fonctions, telles que le r√©glage fin de la configuration du courtier, la mise √† l'√©chelle bas√©e sur des m√©triques avec r√©√©quilibrage, la connaissance du rack (connaissance des ressources mat√©rielles), </font><font style="vertical-align: inherit;">les mises √† jour continues </font><font style="vertical-align: inherit;">¬´douces¬ª </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(gracieuses)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , etc.</font></font><a name="habracut"></a><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essayez les supertubes dans votre cluster:</font></font><br>
<br>
<pre><code class="bash hljs">curl https://getsupertubes.sh | sh  supertubes install -a --no-democluster --kubeconfig &lt;path-to-eks-cluster-kubeconfig-file&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou reportez-vous √† la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vous pouvez √©galement lire certaines des fonctionnalit√©s de Kafka, qui sont automatis√©es avec l'aide de Supertubes et de l'op√©rateur Kafka. </font><font style="vertical-align: inherit;">Nous en avons d√©j√† parl√© sur le blog:</font></font><br>
<br>
<ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oh non! </font><font style="vertical-align: inherit;">Encore un autre op√©rateur Kafka pour Kubernetes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Surveillez et utilisez Kafka sur la base des m√©triques de Prometheus</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sensibilisation de Kafka rack sur Kubernetes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Courir Apache Kafka sur Istio - r√©f√©rence</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clusters authentifi√©s par l'utilisateur et contr√¥l√©s par l'acc√®s avec l'op√©rateur Kafka</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mise √† niveau et configuration dynamique de Kafka sur Kubernetes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Filtre de protocole Envoy pour Kafka, maill√©</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ul></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque vous d√©cidez de d√©ployer un cluster Kafka dans Kubernetes, vous rencontrerez probablement le probl√®me de d√©terminer la taille optimale de l'infrastructure sous-jacente et le besoin d'affiner la configuration Kafka pour r√©pondre aux exigences de bande passante. </font><font style="vertical-align: inherit;">Les performances maximales de chaque courtier sont d√©termin√©es par les performances des composants de l'infrastructure au c≈ìur, tels que la m√©moire, le processeur, la vitesse du disque, la bande passante du r√©seau, etc.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Id√©alement, la configuration du courtier devrait √™tre telle que tous les √©l√©ments de l'infrastructure soient utilis√©s au maximum de leurs capacit√©s. Cependant, dans la vraie vie, cette configuration est tr√®s compliqu√©e. Il est plus probable que les utilisateurs configurent des courtiers pour maximiser l'utilisation d'un ou deux composants (disque, m√©moire ou processeur). De mani√®re g√©n√©rale, un courtier affiche des performances maximales lorsque sa configuration vous permet d'utiliser le composant le plus lent "dans son int√©gralit√©". Nous pouvons donc avoir une id√©e approximative de la charge qu'un courtier peut g√©rer.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Th√©oriquement, nous pouvons √©galement estimer le nombre de courtiers n√©cessaires pour travailler avec une charge donn√©e. Cependant, dans la pratique, il existe tellement d'options de configuration √† diff√©rents niveaux qu'il est tr√®s difficile (voire impossible) d'√©valuer les performances potentielles d'une certaine configuration. En d'autres termes, il est tr√®s difficile de planifier la configuration, √† partir de certaines performances donn√©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour les utilisateurs de Supertubes, nous adoptons g√©n√©ralement l'approche suivante: commencer par une configuration (infrastructure + param√®tres), puis mesurer ses performances, ajuster les param√®tres du courtier et r√©p√©ter le processus √† nouveau. Cela se produit jusqu'√† ce que le potentiel du composant d'infrastructure le plus lent soit pleinement utilis√©.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De cette fa√ßon, nous obtenons une id√©e plus claire du nombre de courtiers dont un cluster a besoin pour faire face √† une certaine charge (le nombre de courtiers d√©pend √©galement d'autres facteurs, tels que le nombre minimum de r√©pliques de messages pour assurer la stabilit√©, le nombre de chefs de partition, etc.). De plus, nous avons une id√©e du dimensionnement vertical des composants d'infrastructure souhait√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cet article pr√©sentera les √©tapes que nous prenons pour ¬´tout extraire¬ª des composants les plus lents dans les configurations initiales et mesurer le d√©bit du cluster Kafka. Une configuration hautement r√©siliente n√©cessite au moins trois courtiers actifs (</font></font><code>min.insync.replicas=3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) espac√©es dans trois zones d'accessibilit√© diff√©rentes. </font><font style="vertical-align: inherit;">Pour configurer, faire √©voluer et surveiller l'infrastructure Kubernetes, nous utilisons notre propre plateforme de gestion de conteneurs cloud hybride - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pipeline</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il prend en charge sur site (bare metal, VMware) et cinq types de clouds (Alibaba, AWS, Azure, Google, Oracle), ainsi que toute combinaison de ceux-ci.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©flexions sur l'infrastructure et la configuration du cluster Kafka</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour les exemples ci-dessous, nous avons s√©lectionn√© AWS comme fournisseur de services cloud et EKS comme distribution Kubernetes. </font><font style="vertical-align: inherit;">Une configuration similaire peut √™tre impl√©ment√©e √† l'aide de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PKE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , une distribution Kubernetes de Banzai Cloud, certifi√©e par la CNCF.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Disque</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Amazon propose diff√©rents </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">types de volumes EBS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Les SSD sont la </font><font style="vertical-align: inherit;">base de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gp2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">io1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , cependant, pour garantir un d√©bit √©lev√©, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gp2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> consomme des pr√™ts accumul√©s </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cr√©dits d' </font><i><font style="vertical-align: inherit;">E / S)</font></i><font style="vertical-align: inherit;"> , c'est pourquoi nous avons pr√©f√©r√© le type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">io1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui offre un d√©bit √©lev√© stable.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Types d'instances</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les performances de Kafka d√©pendent fortement du cache de pages du syst√®me d'exploitation, nous avons donc besoin d'instances avec suffisamment de m√©moire pour les courtiers (JVM) et de cache de pages. L'instance </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c5.2xlarge</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est un bon d√©but, car elle dispose de 16 Go de m√©moire et est </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">optimis√©e pour fonctionner avec EBS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Son inconv√©nient est qu'il est capable de fournir des performances maximales pendant pas plus de 30 minutes toutes les 24 heures. Si votre charge de travail n√©cessite des performances maximales sur une p√©riode plus longue, examinez d'autres types d'instances. C'est exactement ce que nous avons fait, en nous arr√™tant √† </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c5.4xlarge</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Il fournit un d√©bit maximum de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">593,75 Mb / s.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Le d√©bit maximal du </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">volume</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> EBS </font><i><font style="vertical-align: inherit;">io1 est</font></i><font style="vertical-align: inherit;"> sup√©rieur √† celui de l'instance </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c5.4xlarge</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , donc l'√©l√©ment d'infrastructure le plus lent est probablement le d√©bit d'E / S de ce type d'instance (qui devrait √©galement √™tre confirm√© par les r√©sultats de nos tests de charge).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©seau</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La bande passante r√©seau doit √™tre assez importante par rapport aux performances de l'instance de VM et du disque, sinon le r√©seau devient un goulot d'√©tranglement. </font><font style="vertical-align: inherit;">Dans notre cas, l'interface r√©seau </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c5.4xlarge</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> prend en charge des vitesses allant jusqu'√† 10 Gb / s, ce qui est nettement sup√©rieur √† la bande passante de l'instance d'E / S de la machine virtuelle.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©ploiement de courtier</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les courtiers doivent √™tre d√©ploy√©s (pr√©vu dans Kubernetes) sur des n≈ìuds d√©di√©s afin d'√©viter la concurrence avec d'autres processus pour les ressources processeur, m√©moire, r√©seau et disque.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Version Java</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le choix logique est Java 11, car il est compatible avec Docker dans le sens o√π la JVM d√©termine correctement les processeurs et la m√©moire disponibles pour le conteneur dans lequel le courtier s'ex√©cute. </font><font style="vertical-align: inherit;">Sachant que les limites du processeur sont importantes, la JVM d√©finit en interne et de mani√®re transparente le nombre de threads GC et de threads du compilateur JIT. </font><font style="vertical-align: inherit;">Nous avons utilis√© une image Kafka </font></font><code>banzaicloud/kafka:2.13-2.4.0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui inclut la version 2.4.0 de Kafka (Scala 2.13) dans Java 11.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous souhaitez en savoir plus sur Java / JVM sur Kubernetes, consultez nos publications suivantes:</font></font><br>
<br>
<ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourquoi mon application Java est OOMKilled</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment dimensionner correctement les conteneurs pour les applications Java 10</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ul></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Param√®tres de m√©moire du courtier</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La configuration de la m√©moire du courtier comporte deux aspects cl√©s: les param√®tres de la JVM et du module Kubernetes. </font><font style="vertical-align: inherit;">La limite de m√©moire d√©finie pour le pod doit √™tre sup√©rieure √† la taille de segment maximale afin que la machine virtuelle Java dispose de suffisamment d'espace pour la m√©taspace Java dans sa propre m√©moire et pour le cache de page du syst√®me d'exploitation que Kafka utilise activement. </font><font style="vertical-align: inherit;">Lors de nos tests, nous avons ex√©cut√© des courtiers Kafka avec des param√®tres </font></font><code>-Xmx4G -Xms2G</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et la limite de m√©moire pour le pod √©tait </font></font><code>10 Gi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Veuillez noter que les param√®tres de m√©moire de la JVM peuvent √™tre obtenus automatiquement √† l'aide de </font></font><code>-XX:MaxRAMPercentage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>-X:MinRAMPercentage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, en fonction de la limite de m√©moire du module.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Param√®tres du processeur du courtier</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De mani√®re g√©n√©rale, vous pouvez augmenter la productivit√© en augmentant la concurrence en augmentant le nombre de threads utilis√©s par Kafka. </font><font style="vertical-align: inherit;">Plus il y a de processeurs disponibles pour Kafka, mieux c'est. </font><font style="vertical-align: inherit;">Dans notre test, nous avons commenc√© avec une limite de 6 processeurs et avons progressivement (it√©r√©) augment√© leur nombre √† 15. De plus, nous avons d√©fini </font></font><code>num.network.threads=12</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les param√®tres du courtier pour augmenter le nombre de flux qui re√ßoivent des donn√©es du r√©seau et les envoient. </font><font style="vertical-align: inherit;">Ayant imm√©diatement d√©couvert que les courtiers suiveurs ne peuvent pas recevoir les r√©pliques assez rapidement, ils ont augment√© </font></font><code>num.replica.fetchers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√† 4 pour augmenter la vitesse √† laquelle les courtiers suiveurs ont r√©pliqu√© les messages des dirigeants.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outil de g√©n√©ration de charge</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assurez-vous que le potentiel du g√©n√©rateur de charge s√©lectionn√© ne s'√©puise pas avant que le cluster Kafka (dont la r√©f√©rence est en cours d'ex√©cution) n'atteigne sa charge maximale. </font><font style="vertical-align: inherit;">En d'autres termes, il est n√©cessaire d'effectuer une √©valuation pr√©liminaire des capacit√©s de l'outil de g√©n√©ration de charge, ainsi que de s√©lectionner des types d'instance pour celui-ci avec un nombre suffisant de processeurs et de m√©moire. </font><font style="vertical-align: inherit;">Dans ce cas, notre outil produira plus de charge que le cluster Kafka ne peut en dig√©rer. </font><font style="vertical-align: inherit;">Apr√®s de nombreuses exp√©riences, nous nous sommes install√©s sur trois copies de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c5.4xlarge</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dans chacune desquelles le g√©n√©rateur a √©t√© lanc√©.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analyse comparative</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La mesure du rendement est un processus it√©ratif qui comprend les √©tapes suivantes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> configuration de l'infrastructure (cluster EKS, cluster Kafka, outil de g√©n√©ration de charge, ainsi que Prometheus et Grafana);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> g√©n√©ration de charge pendant une certaine p√©riode pour filtrer les √©carts al√©atoires dans les indicateurs de performance collect√©s;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> affiner l'infrastructure et la configuration du courtier en fonction des indicateurs de performance observ√©s;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r√©p√©ter le processus jusqu'√† ce que le niveau requis de bande passante du cluster Kafka soit atteint. </font><font style="vertical-align: inherit;">En m√™me temps, il doit √™tre reproductible de mani√®re stable et pr√©senter des variations de bande passante minimales.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La section suivante d√©crit les √©tapes qui ont √©t√© effectu√©es pendant le cluster de test de r√©f√©rence.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outils</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les outils suivants ont √©t√© utilis√©s pour d√©ployer rapidement la configuration de base, la g√©n√©ration de charge et la mesure des performances:</font></font><br>
<br>
<ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Banzai Cloud Pipeline</a>    EKS  Amazon c <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Prometheus</a> (   Kafka  )  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Grafana</a> (   ).   <b></b>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Pipeline</a> ,    ,   ,  ,   ,      .</li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sangrenel</a> ‚Äî      Kafka.</li>
<li>  Grafana    Kafka  : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kubernetes Kafka</a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Node Exporter</a>.</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supertubes CLI pour la mani√®re la plus simple de configurer un cluster Kafka dans Kubernetes. </font><font style="vertical-align: inherit;">Zookeeper, op√©rateur Kafka, Envoy et de nombreux autres composants sont install√©s et correctement configur√©s pour d√©marrer le cluster Kafka pr√™t √† la production dans Kubernetes.</font></font><br>
 <ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour installer la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">supertubes CLI,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilisez les instructions fournies </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ul></li>
</ul><br>
<img src="https://habrastorage.org/webt/98/xv/7i/98xv7iy-cxitdjo3xakipblgp5u.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cluster EKS</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pr√©parez un cluster EKS avec des n≈ìuds de travail </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c5.4xlarge</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> d√©di√©s </font><font style="vertical-align: inherit;">dans diff√©rentes zones de disponibilit√© pour les pods avec les courtiers Kafka, ainsi que des n≈ìuds d√©di√©s pour le g√©n√©rateur de charge et l'infrastructure de surveillance.</font></font><br>
<br>
<pre><code class="bash hljs">banzai cluster create -f https://raw.githubusercontent.com/banzaicloud/kafka-operator/master/docs/benchmarks/infrastructure/cluster_eks_202001.json</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque le cluster EKS est op√©rationnel, activez son </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">service de surveillance</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> int√©gr√© </font><font style="vertical-align: inherit;">- il d√©ploiera Prometheus et Grafana sur le cluster.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Composants du syst√®me Kafka</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Installez les composants du syst√®me Kafka (Zookeeper, kafka-operator) dans l'EKS en utilisant les supertubes CLI:</font></font><br>
<br>
<pre><code class="bash hljs">supertubes install -a --no-democluster --kubeconfig &lt;path-to-eks-cluster-kubeconfig-file&gt;</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cluster Kafka</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par d√©faut, EKS utilise des </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">volumes gp2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> EBS </font><font style="vertical-align: inherit;">, vous devez donc cr√©er une classe de stockage distincte bas√©e sur les volumes </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">io1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour le cluster Kafka:</font></font><br>
<br>
<pre><code class="plaintext hljs">kubectl create -f - &lt;&lt;EOF<font></font>
apiVersion: storage.k8s.io/v1<font></font>
kind: StorageClass<font></font>
metadata:<font></font>
  name: fast-ssd<font></font>
provisioner: kubernetes.io/aws-ebs<font></font>
parameters:<font></font>
  type: io1<font></font>
  iopsPerGB: "50"<font></font>
  fsType: ext4<font></font>
volumeBindingMode: WaitForFirstConsumer<font></font>
EOF</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D√©finissez un param√®tre pour les courtiers </font></font><code>min.insync.replicas=3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et d√©ployez des modules de courtier sur les n≈ìuds dans trois zones de disponibilit√© diff√©rentes:</font></font><br>
<br>
<pre><code class="bash hljs">supertubes cluster create -n kafka --kubeconfig &lt;path-to-eks-cluster-kubeconfig-file&gt; -f https://raw.githubusercontent.com/banzaicloud/kafka-operator/master/docs/benchmarks/infrastructure/kafka_202001_3brokers.yaml --<span class="hljs-built_in">wait</span> --timeout 600</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les sujets</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons lanc√© simultan√©ment trois instances du g√©n√©rateur de charge. </font><font style="vertical-align: inherit;">Chacun d'eux √©crit dans son propre sujet, c'est-√†-dire qu'il nous suffit de trois sujets:</font></font><br>
<br>
<pre><code class="bash hljs">supertubes cluster topic create -n kafka --kubeconfig &lt;path-to-eks-cluster-kubeconfig-file&gt; -f -&lt;&lt;EOF<font></font>
apiVersion: kafka.banzaicloud.io/v1alpha1<font></font>
kind: KafkaTopic<font></font>
metadata:<font></font>
  name: perftest1<font></font>
spec:<font></font>
  name: perftest1<font></font>
  partitions: 12<font></font>
  replicationFactor: 3<font></font>
  retention.ms: <span class="hljs-string">'28800000'</span><font></font>
  cleanup.policy: delete<font></font>
EOF<font></font>
<font></font>
supertubes cluster topic create -n kafka --kubeconfig &lt;path-to-eks-cluster-kubeconfig-file&gt; -f -&lt;&lt;EOF<font></font>
apiVersion: kafka.banzaicloud.io/v1alpha1<font></font>
kind: KafkaTopic<font></font>
metadata:<font></font>
    name: perftest2<font></font>
spec:<font></font>
  name: perftest2<font></font>
  partitions: 12<font></font>
  replicationFactor: 3<font></font>
  retention.ms: <span class="hljs-string">'28800000'</span><font></font>
  cleanup.policy: delete<font></font>
EOF<font></font>
<font></font>
supertubes cluster topic create -n kafka --kubeconfig &lt;path-to-eks-cluster-kubeconfig-file&gt; -f -&lt;&lt;EOF<font></font>
apiVersion: kafka.banzaicloud.io/v1alpha1<font></font>
kind: KafkaTopic<font></font>
metadata:<font></font>
  name: perftest3<font></font>
spec:<font></font>
  name: perftest3<font></font>
  partitions: 12<font></font>
  replicationFactor: 3<font></font>
  retention.ms: <span class="hljs-string">'28800000'</span><font></font>
  cleanup.policy: delete<font></font>
EOF</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour chaque sujet, le facteur de r√©plication est 3 - la valeur minimale recommand√©e pour les syst√®mes de production hautement disponibles.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outil de g√©n√©ration de charge</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons lanc√© trois instances du g√©n√©rateur de charge (chacune √©crite dans une rubrique distincte). </font><font style="vertical-align: inherit;">Pour les pods du g√©n√©rateur de charge, vous devez enregistrer l'affinit√© des n≈ìuds afin qu'ils ne soient planifi√©s que sur les n≈ìuds qui leur sont allou√©s:</font></font><br>
<br>
<pre><code class="plaintext hljs">apiVersion: extensions/v1beta1<font></font>
kind: Deployment<font></font>
metadata:<font></font>
  labels:<font></font>
    app: loadtest<font></font>
  name: perf-load1<font></font>
  namespace: kafka<font></font>
spec:<font></font>
  progressDeadlineSeconds: 600<font></font>
  replicas: 1<font></font>
  revisionHistoryLimit: 10<font></font>
  selector:<font></font>
    matchLabels:<font></font>
      app: loadtest<font></font>
  strategy:<font></font>
    rollingUpdate:<font></font>
      maxSurge: 25%<font></font>
      maxUnavailable: 25%<font></font>
    type: RollingUpdate<font></font>
  template:<font></font>
    metadata:<font></font>
      creationTimestamp: null<font></font>
      labels:<font></font>
        app: loadtest<font></font>
    spec:<font></font>
      affinity:<font></font>
        nodeAffinity:<font></font>
          requiredDuringSchedulingIgnoredDuringExecution:<font></font>
            nodeSelectorTerms:<font></font>
            - matchExpressions:<font></font>
              - key: nodepool.banzaicloud.io/name<font></font>
                operator: In<font></font>
                values:<font></font>
                - loadgen<font></font>
      containers:<font></font>
      - args:<font></font>
        - -brokers=kafka-0:29092,kafka-1:29092,kafka-2:29092,kafka-3:29092<font></font>
        - -topic=perftest1<font></font>
        - -required-acks=all<font></font>
        - -message-size=512<font></font>
        - -workers=20<font></font>
        image: banzaicloud/perfload:0.1.0-blog<font></font>
        imagePullPolicy: Always<font></font>
        name: sangrenel<font></font>
        resources:<font></font>
          limits:<font></font>
            cpu: 2<font></font>
            memory: 1Gi<font></font>
          requests:<font></font>
            cpu: 2<font></font>
            memory: 1Gi<font></font>
        terminationMessagePath: /dev/termination-log<font></font>
        terminationMessagePolicy: File<font></font>
      dnsPolicy: ClusterFirst<font></font>
      restartPolicy: Always<font></font>
      schedulerName: default-scheduler<font></font>
      securityContext: {}<font></font>
      terminationGracePeriodSeconds: 30</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quelques points √† prendre en compte:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Le g√©n√©rateur de charge g√©n√®re des messages de 512 octets et les publie sur Kafka par lots de 500 messages.</font></font></li>
<li>    <code>-required-acks=all</code>   ,          Kafka.  ,          ,  ,    ,  .           <i>(consumers)</i>   ,       ,       ,   .</li>
<li>     20 worker' (<code>-workers=20</code>).  worker  5 producer',     worker'   Kafka.      100 producer',        Kafka.</li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Surveillance de cluster</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendant les tests de r√©sistance du cluster Kafka, nous avons √©galement surveill√© son √©tat de sant√© pour nous assurer qu'il n'y avait pas de red√©marrage des pods, des r√©pliques d√©synchronis√©es et un d√©bit maximal avec des fluctuations minimales:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le g√©n√©rateur de charge √©crit des statistiques standard sur le nombre de messages publi√©s et le niveau d'erreurs. </font><font style="vertical-align: inherit;">Le pourcentage d'erreurs doit rester dans la valeur </font></font><code>0,00%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cruise Control</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , d√©ploy√© par kafka-operator, fournit un tableau de bord sur lequel nous pouvons √©galement surveiller l'√©tat du cluster. </font><font style="vertical-align: inherit;">Pour afficher ce panneau, proc√©dez comme suit:</font></font><br>
<br>
<pre><code class="bash hljs">supertubes cluster cruisecontrol show -n kafka --kubeconfig &lt;path-to-eks-cluster-kubeconfig-file&gt;</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le niveau ISR </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(nombre de r√©pliques synchronis√©es) de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> retrait et d'expansion est 0.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©sultats de mesure</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 courtiers, taille du message - 512 octets</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec des partitions r√©parties uniform√©ment sur trois courtiers, nous avons r√©ussi √† atteindre une performance de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">~ 500 Mb / s (environ 990 000 messages par seconde)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ql/5s/kk/ql5skk9eq59vw1dxiptnpv5baoo.png"><br>
<br>
<img src="https://habrastorage.org/webt/ye/cg/rc/yecgrcrh-mrdchebbysisw4mg3a.png"><br>
<br>
<img src="https://habrastorage.org/webt/5i/t6/it/5it6itlq4hfnndz2f-refjm1sbq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
la consommation de m√©moire de la machine virtuelle JVM ne d√©passait pas 2 Go: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pc/_s/-f/pc_s-fapugnsmx114p1rssgst8m.png"><br>
<br>
<img src="https://habrastorage.org/webt/2e/1-/qw/2e1-qwc0rb2fqk_bw_hkgr0jbl8.png"><br>
<br>
<img src="https://habrastorage.org/webt/m-/tr/nw/m-trnwodxrqpftqhnrnp35f25cy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
la bande passante du disque atteignait la bande passante d'E / S maximale le n≈ìud sur les trois instances sur </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tr/tx/tg/trtxtgaqntrbc_bwrxmxmxh9opu.png"><br>
<br>
<img src="https://habrastorage.org/webt/_k/ns/dh/_knsdhmjkkc2245qffym_pnkxge.png"><br>
<br>
<img src="https://habrastorage.org/webt/rq/xo/8x/rqxo8xwg5dualnt3uqt2jxmfeta.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
lesquelles </font><font style="vertical-align: inherit;">les courtiers ont travaill√©: </font><font style="vertical-align: inherit;">D'apr√®s les donn√©es sur l'utilisation de la m√©moire par les n≈ìuds, il s'ensuit que la mise en m√©moire tampon et la mise en cache du syst√®me ont pris environ 10 √† 15 Go:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/p3/ls/r6/p3lsr6ixa3wx0zfeowuqo_qlpq0.png"><br>
<br>
<img src="https://habrastorage.org/webt/aq/tn/fd/aqtnfdsjnp33e3buy5dxkrvojg4.png"><br>
<br>
<img src="https://habrastorage.org/webt/pi/aa/iv/piaaivarggmqsqiopmtx_doi4tg.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 courtiers, taille du message - 100 octets</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec une diminution de la taille des messages, le d√©bit diminue d'environ 15 √† 20%: le temps consacr√© au traitement de chaque message est affect√©. </font><font style="vertical-align: inherit;">De plus, la charge du processeur a presque doubl√©. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mp/9l/9l/mp9l9lcmuwuh866dce_v0puzrt0.png"><br>
<br>
<img src="https://habrastorage.org/webt/z0/ck/hd/z0ckhdrst6iqql9i5drcksb7y7i.png"><br>
<br>
<img src="https://habrastorage.org/webt/hu/dg/dp/hudgdpo3e8s0ft0zxd7tngwne3y.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√âtant donn√© que les n≈ìuds de courtier ont toujours des noyaux inutilis√©s, vous pouvez am√©liorer les performances en modifiant la configuration de Kafka. </font><font style="vertical-align: inherit;">Ce n'est pas une t√¢che facile, par cons√©quent, pour augmenter le d√©bit, il est pr√©f√©rable de travailler avec des messages plus volumineux.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 courtiers, taille du message - 512 octets</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez facilement augmenter les performances du cluster Kafka en ajoutant simplement de nouveaux courtiers et en maintenant l'√©quilibre des partitions (cela garantit une r√©partition uniforme de la charge entre les courtiers). </font><font style="vertical-align: inherit;">Dans notre cas, apr√®s l'ajout d'un courtier, le d√©bit du cluster est pass√© √† </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">~ 580 Mb / s (~ 1,1 million de messages par seconde)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">La croissance s'est av√©r√©e plus faible que pr√©vu: cela est principalement d√ª au d√©s√©quilibre des partitions (tous les courtiers ne travaillent pas au plus fort des opportunit√©s). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8x/cs/nq/8xcsnqeafi6tom_rxrbb5jz1zmk.png"><br>
<br>
<img src="https://habrastorage.org/webt/_2/qm/2j/_2qm2jqmcig_qwnypgirtzwcnw0.png"><br>
<br>
<img src="https://habrastorage.org/webt/zn/vx/jm/znvxjmy9hpxm3c29l-x616hfyfa.png"><br>
<br>
<img src="https://habrastorage.org/webt/gm/mt/sc/gmmtscxckvpwqr3ypzmkz45jscu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La consommation de m√©moire de la machine JVM reste inf√©rieure √† 2 Go: le </font></font><br>
<br>
<img src="https://habrastorage.org/webt/a7/w7/qh/a7w7qh73p6ug6ozgqksh224fanc.png"><br>
<br>
<img src="https://habrastorage.org/webt/pe/cn/gs/pecngsl4nhacfu1drnmevl3p96q.png"><br>
<br>
<img src="https://habrastorage.org/webt/ee/vh/ei/eevheiyiaf_sxnw8epxlsnizxak.png"><br>
<br>
<img src="https://habrastorage.org/webt/lz/gj/lb/lzgjlblbytxjujal32u1nmgjixo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
d√©s√©quilibre de partition a affect√© le fonctionnement des courtiers avec les disques:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/4w/ga/3j/4wga3j3ogq8d_pesoite7ln9alk.png"><br>
<br>
<img src="https://habrastorage.org/webt/jb/sh/rl/jbshrlplduwv4xrnfdhab65auy8.png"><br>
<br>
<img src="https://habrastorage.org/webt/3r/dw/ox/3rdwox-qntdekifec-vuoooozuc.png"><br>
<br>
<img src="https://habrastorage.org/webt/oz/ux/cd/ozuxcdtsqz-rfgwmun8iljtgxcq.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r√©sultats</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'approche it√©rative pr√©sent√©e ci-dessus peut √™tre √©tendue pour couvrir des sc√©narios plus complexes, notamment des centaines de consommateurs, le repartitionnement, les mises √† jour continues, les red√©marrages de pods, etc. Tout cela nous permet d'√©valuer les limites des capacit√©s du cluster Kafka dans diverses conditions, d'identifier les goulots d'√©tranglement dans son travail et de trouver des moyens de les surmonter. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons d√©velopp√© des supertubes pour d√©ployer rapidement et facilement un cluster, le configurer, ajouter / supprimer des courtiers et des rubriques, r√©pondre aux alertes et nous assurer que Kafka fonctionne correctement dans Kubernetes dans son ensemble. Notre objectif est d'aider √† se concentrer sur la t√¢che principale (¬´g√©n√©rer¬ª et ¬´consommer¬ª des messages Kafka), et de fournir tout le travail acharn√© aux op√©rateurs Supertubes et Kafka.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous √™tes int√©ress√© par les technologies Banzai Cloud et les projets Open Source, abonnez-vous √† la soci√©t√© sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LinkedIn</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Twitter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS du traducteur</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lisez aussi dans notre blog:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬´ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une histoire avec l'op√©rateur Redis dans les K8 et un mini-aper√ßu des utilitaires pour analyser les donn√©es de cette base de donn√©es</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬ª;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬´ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Migration sans obstacle de RabbitMQ vers Kubernetes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬ª;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zetcd de CoreOS: Remplacement de ZooKeeper par ... le stockage etcd</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ."</font></font></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr488908/index.html">R√©dacteur KPI ou caract√©ristiques de l'√©valuation du travail des auteurs √† distance sur le personnel et les pigistes</a></li>
<li><a href="../fr488910/index.html">Le livre ¬´Amour et math√©matiques. Le c≈ìur de la r√©alit√© cach√©e</a></li>
<li><a href="../fr488912/index.html">Python News Bitcoin Price Prediction</a></li>
<li><a href="../fr488916/index.html">Cascadeur: Le probl√®me du chat qui tombe</a></li>
<li><a href="../fr488918/index.html">Ing√©nieur de donn√©es ou mourir: une histoire de d√©veloppeur unique</a></li>
<li><a href="../fr488926/index.html">5 cours gratuits pour les ing√©nieurs de Microsoft AI</a></li>
<li><a href="../fr488946/index.html">Menu de la console Python</a></li>
<li><a href="../fr488948/index.html">UPD. Test de l'API REST sur Golang. 120 000 [# / sec] n'est pas la limite?</a></li>
<li><a href="../fr488950/index.html">Temps dans une machine cellulaire</a></li>
<li><a href="../fr488952/index.html">Analyse des sentiments d'expression √† l'aide de r√©seaux de neurones</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>