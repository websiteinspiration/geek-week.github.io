<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë∂üèø üìΩÔ∏è üëõ Em vez de 100 lan√ßamentos de aplicativos - um autoteste ou como salvar um engenheiro de controle de qualidade 20 anos de vida üçñ üí∫ ‚õÑÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° pessoal, meu nome √© Evgeny Demidenko. Nos √∫ltimos anos, desenvolvo um sistema automatizado de teste de jogos na Pixonic. Hoje eu queria compartilh...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Em vez de 100 lan√ßamentos de aplicativos - um autoteste ou como salvar um engenheiro de controle de qualidade 20 anos de vida</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pixonic/blog/503704/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ol√° pessoal, meu nome √© Evgeny Demidenko. Nos √∫ltimos anos, desenvolvo um sistema automatizado de teste de jogos na Pixonic. Hoje eu queria compartilhar nossa experi√™ncia no desenvolvimento, suporte e uso de um sistema desse tipo no projeto War Robots. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para come√ßar, descobriremos o que estamos automatizando com este sistema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro, s√£o testes de regress√£o da interface do usu√°rio, testes de core-gameplay e automa√ß√£o de benchmarks. Todos os tr√™s sistemas como um todo tornam poss√≠vel reduzir a carga sobre o departamento de controle de qualidade antes dos lan√ßamentos, ter mais confian√ßa na refatora√ß√£o em larga escala e profunda e manter constantemente uma avalia√ß√£o geral do desempenho do aplicativo, bem como de suas partes individuais. Outro ponto que quero destacar √© a automa√ß√£o da rotina, por exemplo - teste de qualquer hip√≥tese.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/x-/p8/li/x-p8lisenhooudwb_qghpki8oew.gif" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vou dar alguns n√∫meros. Agora, mais de 600 testes de interface do usu√°rio e cerca de 100 testes principais foram escritos para os rob√¥s de guerra. Somente neste projeto, fizemos cerca de um milh√£o de lan√ßamentos de nossos scripts de teste, cada um dos quais levou cerca de 80 segundos. Se verific√°ssemos esses cen√°rios manualmente, ter√≠amos gasto pelo menos cinco minutos cada. Al√©m disso, lan√ßamos mais de 700 mil benchmarks. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das plataformas, usamos Android e iOS - apenas 12 dispositivos no parque. Dois programadores est√£o envolvidos no desenvolvimento e suporte do sistema, e um engenheiro de controle de qualidade est√° escrevendo e analisando testes.</font></font><br>
<br>
<a name="habracut"></a><br>
<img src="https://habrastorage.org/webt/uf/yw/0w/ufyw0wcb6rt75dkydnmcqfg2zly.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/yt/x1/9g/ytx19guugufvzvniufmworpua6e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quanto √† pilha de software, usamos o NUnit em nosso banco de dados, mas n√£o para testes de unidade, mas para testes de integra√ß√£o e sistema. </font><font style="vertical-align: inherit;">Para jogabilidade central e testes de verifica√ß√£o de compila√ß√£o, usamos a solu√ß√£o integrada do Unity - Unity Test Tools. </font><font style="vertical-align: inherit;">Para escrever e analisar relat√≥rios ap√≥s esses testes, o Allure Test Report da Yandex √© usado, assim como o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TeamCity</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - como um sistema de integra√ß√£o cont√≠nua para a cria√ß√£o de aplicativos, implanta√ß√£o de servidores e execu√ß√£o de testes. </font><font style="vertical-align: inherit;">Usamos o Reposit√≥rio Nexus e o banco de dados PostgreSQL para armazenar nossos artefatos.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/u6/3q/mo/u63qmozjx0tp1pcl6ym9ykqnrwa.jpeg"><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como voc√™ cria, analisa e executa testes</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suponha que desejemos escrever um teste simples que, na janela de configura√ß√µes do jogo, verifique o √≠cone para ativar e desativar o som. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o, escrevemos um teste e o comprometemos com uma ramifica√ß√£o espec√≠fica em nosso reposit√≥rio de testes. Escolhemos os testes que queremos executar, escolhemos uma compila√ß√£o para executar, ou talvez um commit espec√≠fico, no qual a compila√ß√£o ser√° montada. Agora execute o teste, aguarde um pouco e obtenha o resultado. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yh/lh/zh/yhlhzh-ks_cwipqs8r0rz6sgcdk.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/58/g2/vc/58g2vcabu81mbxprwuoalnf9p34.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse caso, 575 testes foram lan√ßados, dos quais 97% foram bem-sucedidos. Demoramos cerca de tr√™s horas para concluir todos os testes. Para compara√ß√£o, os mesmos testes, se feitos manualmente, levariam pelo menos 50 horas de opera√ß√£o cont√≠nua. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o, o que aconteceu com esses 3% dos testes que falharam? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abrimos um teste espec√≠fico e vemos uma mensagem de que ocorreu um erro ao corresponder √†s capturas de tela.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sk/ae/tl/skaetlvcp3-ivmp5aqkzhmolbac.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, abrimos a captura de tela, que naquele momento estava no dispositivo, e vemos que as zonas que n√£o correspondem ao original s√£o marcadas com pixels vermelhos. </font><font style="vertical-align: inherit;">Para compara√ß√£o, n√≥s damos a ele. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/am/h2/vn/amh2vnpzgkyhqtkrfsnski3y1sy.png"><br>
<br>
<img src="https://habrastorage.org/webt/s3/7o/zl/s37ozlopkihi4vpcpwrbslws05i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Naturalmente, depois disso, o engenheiro de controle de qualidade deve cometer um erro para que o comportamento da compila√ß√£o n√£o corresponda ao documento de design do jogo ou atualizar as capturas de tela originais, porque o documento de design do jogo mudou e agora esses elementos n√£o estar√£o no jogo.</font></font><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso parece legal. </font><font style="vertical-align: inherit;">Por que tudo isso √© necess√°rio?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° algum tempo, no projeto War Robots, precis√°vamos fazer uma pequena refatora√ß√£o. </font><font style="vertical-align: inherit;">Consistia em reescrever alguns c√≥digos para disparar armas - em particular, metralhadoras.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante os testes, encontramos uma nuance interessante: a taxa de metralhadoras dependia diretamente do FPS. Esse erro seria irreal para detectar durante o teste manual: primeiro, devido aos recursos de c√°lculo de danos na rede do projeto e, segundo, devido ao fato de o aplicativo War Robots estar bastante otimizado e, naquele momento, ser executado em todos os dispositivos com aproximadamente o mesmo FPS - 30 quadros / s. Obviamente, houve pequenos desvios, mas n√£o foram suficientes para notar um aumento no dano causado pelo disparo de armas durante o teste manual. Ent√£o nos perguntamos: quantos desses bugs ainda temos e quantos podem aparecer durante a refatora√ß√£o?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como n√£o quer√≠amos reduzir o n√∫mero de testes, mas aument√°-los, j√° que t√≠nhamos planejado grandes atualiza√ß√µes e um aumento no n√∫mero de conte√∫do, n√£o quer√≠amos crescer horizontalmente e aumentar o n√∫mero de funcion√°rios do departamento de controle de qualidade. </font><font style="vertical-align: inherit;">Em vez disso, planejamos o crescimento vertical com uma redu√ß√£o na rotina dos funcion√°rios atuais e facilitando a vida deles durante os testes de integra√ß√£o de novos conte√∫dos.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sh/yf/_w/shyf_wvrx43ugfrojh0q57lozoa.jpeg"><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quais ferramentas usamos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando come√ßamos a automatizar os testes, chamamos a aten√ß√£o para as Ferramentas de Teste de Integra√ß√£o do Unity, que estavam embutidas naquele momento no Unity. Escrevemos v√°rias interfaces de usu√°rio e testes principais, conclu√≠mos a refatora√ß√£o que come√ßamos anteriormente e ficamos satisfeitos com ela, porque a solu√ß√£o j√° funcionava, o que significa que nossas suposi√ß√µes estavam corretas e tivemos que seguir em frente. O √∫nico aspecto negativo desta solu√ß√£o, mas muito significativo para n√≥s, foi que os testes n√£o puderam ser executados em dispositivos m√≥veis.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim, tivemos a ideia de usar a estrutura Appium. Este √© um garfo de outra estrutura de teste bem conhecida - Selenium. Por sua vez, talvez seja a estrutura mais famosa para testar aplicativos da Web, cujo conceito principal √© trabalhar com elementos da interface do usu√°rio, obter suas coordenadas e organizar a entrada nesses elementos da interface do usu√°rio. A Appium adotou esse conceito e, al√©m dos drivers da Web existentes no Selenium, tamb√©m adicionou drivers para iOS e Android: eles usam estruturas de teste nativas para cada uma dessas plataformas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como n√£o h√° elementos de interface do usu√°rio nativos no Unity, e h√° apenas um elemento de interface do usu√°rio no qual a imagem √© renderizada, tive que adicionar um acr√©scimo ao Appium UnityDriver, que permite trabalhar com a hierarquia de cenas, obter objetos de cenas e muito mais.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Naquele momento, um engenheiro de controle de qualidade j√° havia aparecido no projeto, as coisas come√ßaram a fluir, o n√∫mero de cen√°rios de teste come√ßou a crescer significativamente, o que gradualmente automatizamos. Come√ßamos a lan√ß√°-los em dispositivos e, em geral, nosso trabalho j√° parecia da maneira que quer√≠amos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No futuro, al√©m dos testes de interface do usu√°rio, come√ßaram a aparecer mais testes b√°sicos e outras ferramentas baseadas em nosso sistema, como resultado do desempenho e qualidade do trabalho em v√°rios dispositivos, suporte adicional para v√°rios outros dispositivos, testes paralelos e tamb√©m abandonamos o Appium em benef√≠cio de sua pr√≥pria estrutura. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lv/mn/sv/lvmnsvmwhtnp3ewe2mpofdem-e4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O √∫nico problema que permaneceu conosco - e ainda √© - foi a hierarquia da interface do usu√°rio. Como se uma hierarquia mudar em uma cena devido √† refatora√ß√£o da interface do usu√°rio ou trabalhar na cena, isso precisa ser suportado nos testes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s as pr√≥ximas inova√ß√µes e revis√µes, a arquitetura de todo o sistema come√ßou a ter a seguinte apar√™ncia. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yu/52/ho/yu52hohx3nmookj9vajusrl7uyg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√≥s pegamos a vers√£o do War Robots, pegamos nossos testes, que est√£o em um reposit√≥rio separado, adicionamos alguns par√¢metros para rodar l√° que nos permitem configurar o in√≠cio dos testes em cada caso e enviamos tudo para o agente TeamCity em um PC remoto. O agente TeamCity lan√ßa nossos testes, passa os par√¢metros de constru√ß√£o e lan√ßamento de "Rob√¥s", ap√≥s os quais os testes come√ßam a funcionar e a "comunicar" independentemente com os dispositivos conectados ao agente do TeamCity por fio: coloque constru√ß√µes neles, execute-os, execute determinados scripts, exclua cria, reinicie o aplicativo e assim por diante.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como os testes e o pr√≥prio aplicativo s√£o executados em dispositivos fisicamente diferentes - em um telefone celular e Mac mini -, precisamos implementar a comunica√ß√£o entre nossa estrutura, a War Robots API e a Unity API. </font><font style="vertical-align: inherit;">Adicionamos um pequeno servidor UDP ao aplicativo, que recebe comandos da estrutura e se comunica com a API do aplicativo e o Unity por meio de manipuladores. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sq/rt/qf/sqrtqfu4f-swgarbf1zgsysocea.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A principal tarefa de nossa estrutura √© organizar o trabalho de testes: a correta prepara√ß√£o, conclus√£o e gerenciamento de dispositivos. </font><font style="vertical-align: inherit;">Em particular, paralelismo para acelerar o trabalho, a escolha certa de dispositivos e capturas de tela, comunica√ß√£o com a compila√ß√£o. </font><font style="vertical-align: inherit;">Ap√≥s concluir os testes, nossa estrutura deve salvar todos os artefatos gerados e gerar um relat√≥rio.</font></font><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dicas para escolher dispositivos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Separadamente, quero prestar aten√ß√£o √† escolha dos dispositivos para teste. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aten√ß√£o consider√°vel deve ser dada aos hubs. Se voc√™ deseja executar benchmarks em seus dispositivos - especialmente se forem dispositivos Android - eles ficar√£o sem energia. Os hubs devem fornecer a energia necess√°ria para os dispositivos usados. H√° outro recurso muito sutil: alguns hubs t√™m energia ativa, e essa energia √© desligada ap√≥s surtos de energia, ap√≥s o que √© ativada apenas pressionando-se fisicamente um bot√£o. Temos esses hubs, e isso √© muito inconveniente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ deseja executar testes de interface de usu√°rio de regress√£o e l√≥gica de teste em dispositivos, n√£o use dispositivos diferentes. </font><font style="vertical-align: inherit;">Adote os mesmos dispositivos - melhor os mais produtivos que voc√™ puder pagar, pois assim voc√™ economizar√° tempo com os freios do dispositivo, a conveni√™ncia de trabalhar com eles e o comportamento do aplicativo em todos os dispositivos ser√° o mesmo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma quest√£o separada √© o uso de farms na nuvem. </font><font style="vertical-align: inherit;">Ainda n√£o os usamos, embora tenhamos pesquisado sobre eles: o que s√£o, quanto custam e como executar nossos testes - mas at√© agora dispomos de nosso parque de dispositivos interno para atender nossos pedidos.</font></font><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Relat√≥rios de teste</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s a conclus√£o dos testes, geramos um relat√≥rio de fasc√≠nio, que inclui todos os artefatos criados durante o teste. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O principal "cavalo de batalha" para analisar o que aconteceu e identificar as causas do acidente durante o teste s√£o os logs. Antes de tudo, n√≥s os coletamos de nossa estrutura, que nos fala sobre o estado do script e o que aconteceu nesse script. Dividimos os logs no sistema (mais detalhado) e o log de controle de qualidade (mais compacto e conveniente para an√°lise). Tamb√©m coletamos logs do sistema de dispositivos (por exemplo, logcat) e logs de um aplicativo Unity.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante a queda dos testes, tamb√©m tiramos uma captura de tela para entender o que estava acontecendo nos dispositivos no momento da queda, gravamos um v√≠deo para entender o que aconteceu antes da falha e tentamos coletar o m√°ximo de informa√ß√µes sobre o status do dispositivo, como os pings de nossos servidores e ifconfig para entender se o dispositivo possui um IP. </font><font style="vertical-align: inherit;">Voc√™ ficar√° surpreso, no entanto, se voc√™ iniciar o aplicativo manualmente 50 vezes, tudo ficar√° bem com ele, mas se voc√™ o executar 50 mil vezes no modo autom√°tico, descobrir√° que a Internet no dispositivo pode ser perdida e n√£o ficar√° clara durante o teste, se havia uma conex√£o antes e depois da queda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tamb√©m coletamos uma lista de processos, energia da bateria, temperatura e geralmente tudo o que podemos alcan√ßar.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/du/vk/o3/duvko3ve8ep_2fsl2wcm5m129wk.jpeg"><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que s√£o boas capturas de tela e v√≠deos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° algum tempo, nosso engenheiro de controle de qualidade sugeriu, al√©m de capturar capturas de tela no outono, em certos locais dos testes, para comparar essas capturas de tela com os modelos que est√£o em nosso reposit√≥rio. Assim, ele prop√¥s economizar tempo no n√∫mero de execu√ß√µes de teste e reduzir o tamanho da base de c√≥digo. Ou seja, com um teste, poder√≠amos verificar a l√≥gica e a parte visual. Do ponto de vista do conceito de teste de unidade, isso n√£o √© muito correto, porque em um teste n√£o devemos testar v√°rias hip√≥teses. Mas este √© um passo deliberado: sabemos como analisar tudo isso corretamente, por isso nos aventuramos a adicionar funcionalidades semelhantes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de tudo, pensamos em adicionar bibliotecas para corresponder √†s capturas de tela, mas percebemos que o uso de imagens com resolu√ß√µes diferentes n√£o √© muito confi√°vel, por isso paramos em dispositivos com a mesma resolu√ß√£o e comparamos as imagens com um determinado limite pixel por pixel.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mk/er/0l/mker0lc9w32qaca97jmykzsdae8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um efeito muito interessante do uso da correspond√™ncia de capturas de tela √© que, se for dif√≠cil automatizar algum processo, n√≥s o automatizaremos o quanto for poss√≠vel, e simplesmente olharemos as capturas de tela manualmente. Foi exatamente isso que fizemos com a localiza√ß√£o de teste. Recebemos uma solicita√ß√£o para testar a localiza√ß√£o de nossos aplicativos. Por isso, come√ßamos a examinar as bibliotecas que permitem o reconhecimento de texto - mas percebemos que isso era pouco confi√°vel e, como resultado, escrevemos v√°rios scripts que "percorrem" telas diferentes e causam pop-ups diferentes. ups e, neste momento, s√£o criadas capturas de tela. Antes de iniciar esse script, alteramos o c√≥digo do idioma no dispositivo, executamos o script, capturamos capturas de tela, alteramos o c√≥digo do idioma novamente e executamos o script novamente. Assim, todos os testes s√£o executados √† noite,para que, de manh√£, o engenheiro de controle de qualidade possa analisar 500 capturas de tela e analisar imediatamente se h√° problemas com a localiza√ß√£o em algum lugar. Sim, as capturas de tela ainda precisam ser assistidas, mas isso √© muito mais r√°pido do que passar manualmente por todas as telas do dispositivo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Äs vezes, capturas de tela e logs n√£o s√£o suficientes: algo estranho come√ßa a acontecer nos dispositivos, mas como eles est√£o localizados remotamente, voc√™ n√£o pode avaliar o que aconteceu l√°. </font><font style="vertical-align: inherit;">Al√©m disso, √†s vezes n√£o est√° claro o que aconteceu literalmente alguns momentos antes do teste cair. </font><font style="vertical-align: inherit;">Portanto, adicionamos uma grava√ß√£o de v√≠deo do dispositivo, que come√ßa com o in√≠cio do teste e √© salva apenas no caso de uma queda. </font><font style="vertical-align: inherit;">Com a ajuda de tais v√≠deos, √© muito conveniente rastrear falhas e congelamentos de aplicativos.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tv/yi/jk/tvyijk8fgyl3_sgkyykx4tdjc2g.jpeg"><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que mais o nosso sistema pode fazer?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° algum tempo, do departamento de testes de controle de qualidade, recebemos uma solicita√ß√£o para desenvolver uma ferramenta para coletar m√©tricas durante os testes manuais. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para que serve? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso √© necess√°rio para que os engenheiros de controle de qualidade, ap√≥s um teste manual, possam analisar adicionalmente o comportamento do FPS e do consumo de mem√≥ria no aplicativo, analisando simultaneamente capturas de tela e v√≠deos que refletem o que estava acontecendo neste dispositivo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O sistema desenvolvido por n√≥s funcionou da seguinte forma. O engenheiro de controle de qualidade lan√ßou o War Robots no dispositivo, ativou a grava√ß√£o da sess√£o do playbench - nosso an√°logo do gamebench - reproduziu o playtest e, em seguida, clicou em "encerrar a sess√£o do playbench", o relat√≥rio gerado foi salvo no reposit√≥rio, ap√≥s o que o engenheiro com os dados desse playtest poderia alcan√ßar seu trabalho m√°quinas e veja o relat√≥rio: quais foram os rebaixamentos no FPS, qual consumo de mem√≥ria, o que estava acontecendo no dispositivo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tamb√©m automatizamos o lan√ßamento de benchmarks no projeto War Robots, essencialmente apenas agrupando os benchmarks existentes em um lan√ßamento autom√°tico. O resultado dos benchmarks √© geralmente um d√≠gito. No nosso caso, esse geralmente √© o FPS m√©dio por benchmark. Al√©m do lan√ßamento autom√°tico, decidimos adicionar outra sess√£o de playbench e, assim, recebemos n√£o apenas uma figura espec√≠fica, como o benchmark funcionava, mas tamb√©m informa√ß√µes gra√ßas √†s quais podemos analisar o que aconteceu com o benchmark naquele momento.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tamb√©m devemos mencionar o teste de solicita√ß√£o de recebimento. </font><font style="vertical-align: inherit;">Desta vez, foi mais para ajudar a equipe de desenvolvimento do cliente, em vez de engenheiros de controle de qualidade. </font><font style="vertical-align: inherit;">Executamos o chamado teste de verifica√ß√£o de compila√ß√£o para cada solicita√ß√£o de recebimento. </font><font style="vertical-align: inherit;">Voc√™ pode execut√°-los nos dispositivos e no editor do Unity para acelerar o trabalho de verifica√ß√£o da l√≥gica. </font><font style="vertical-align: inherit;">Tamb√©m executamos um conjunto de testes principais em ramifica√ß√µes separadas, onde ocorre uma esp√©cie de reprojeto de alguns elementos ou refatora√ß√£o de c√≥digo.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6x/xj/t8/6xxjt8np3nxlfacdadgagz-qxry.jpeg"><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E outros recursos √∫teis</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No final, quero me debru√ßar sobre alguns casos interessantes que conhecemos nos √∫ltimos anos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um dos casos mais interessantes que apareceu recentemente conosco √© o benchmark durante brigas com bots.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para o novo projeto, o Pixonic Dino Squad desenvolveu um sistema no qual o engenheiro de controle de qualidade podia fazer um teste de brincadeira com bots, para n√£o esperar por seus colegas, mas testar algumas hip√≥teses. Nosso engenheiro de controle de qualidade, por sua vez, pediu para adicionar a capacidade n√£o apenas de brincar com bots, mas tamb√©m para que eles possam brincar entre si. Assim, simplesmente lan√ßamos o aplicativo e, neste momento, o bot come√ßa a jogar com outros bots. Ao mesmo tempo, toda a intera√ß√£o √© em rede, com servidores reais, ao inv√©s de jogadores jogando no computador. Tudo isso √© envolvido em benchmarks e uma sess√£o de playbench com gatilhos para o in√≠cio da noite. Assim, √† noite, iniciamos v√°rias batalhas entre bots e bots; nesse momento, o FPS e o consumo de mem√≥ria s√£o gravados, capturas de tela s√£o capturadas e v√≠deos s√£o gravados. De manh√£, o engenheiro de controle de qualidade chega e pode ver,quais testes foram realizados e o que aconteceu neles.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tamb√©m vale a pena conferir o vazamento de textura. </font><font style="vertical-align: inherit;">Esse √© um tipo de suban√°lise do uso de mem√≥ria - mas aqui verificamos principalmente o uso, por exemplo, de texturas de garagem em batalha. </font><font style="vertical-align: inherit;">Consequentemente, na batalha n√£o deve haver atlas usados ‚Äã‚Äãna garagem e, quando sa√≠mos da batalha, as texturas usadas na batalha n√£o devem permanecer na mem√≥ria. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um efeito colateral interessante do nosso sistema √© que, quase desde o in√≠cio de seu uso, rastreamos o tempo de carregamento do aplicativo. </font><font style="vertical-align: inherit;">No caso da War Robots, esse tempo n√£o √© forte, mas est√° em constante crescimento, porque novos conte√∫dos est√£o sendo adicionados e a qualidade desse conte√∫do est√° melhorando - mas podemos manter esse par√¢metro sob controle e sempre estar ciente de seu tamanho.</font></font><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em vez de uma conclus√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No final, gostaria de chamar a aten√ß√£o para os problemas que temos que conhecemos e que gostar√≠amos de resolver em primeiro lugar. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/s3/8o/ow/s38oowcmbceqawngd_udbsvt3eq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O primeiro e mais doloroso s√£o as altera√ß√µes na interface do usu√°rio. Como estamos trabalhando com uma caixa preta, n√£o incorporamos nada no aplicativo War Robots, exceto nosso servidor - ou seja, testamos tudo da mesma maneira que um engenheiro de controle de qualidade testaria. Mas, de alguma forma, precisamos acessar os elementos na cena. E n√≥s os encontramos no caminho absoluto. Assim, quando algo muda no palco, especialmente em um alto n√≠vel de hierarquia, precisamos apoiar essas mudan√ßas em um grande n√∫mero de testes. Infelizmente, n√£o podemos fazer nada com isso agora. Obviamente, existem algumas solu√ß√µes, mas elas trazem problemas adicionais.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O segundo grande problema √© a infraestrutura. Como eu disse, se voc√™ executar o aplicativo 50 vezes com as m√£os, n√£o perceber√° a maioria dos problemas que aparecer√£o se executar o aplicativo 50 mil vezes. Esses problemas que podem ser facilmente resolvidos no modo manual - por exemplo, reinstalar compila√ß√µes ou reiniciar a Internet - ser√£o uma verdadeira dor de automa√ß√£o, porque todos esses problemas devem ser tratados corretamente, uma mensagem de erro exibida e desde que possam ocorrer. Em particular, precisamos determinar por que os testes foram reprovados: devido a uma l√≥gica defeituosa ou algum tipo de problema de infraestrutura, ou por qualquer outro motivo. Existem muitos problemas com dispositivos low-end: eles n√£o t√™m builds, a Internet cai, os dispositivos congelam, travam, n√£o ligam, s√£o descarregados rapidamente e assim por diante.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tamb√©m gostaria de interagir com as interfaces de usu√°rio nativas, mas at√© agora n√£o temos essa oportunidade. </font><font style="vertical-align: inherit;">Sabemos como fazer isso, mas a presen√ßa de outros pedidos de funcionalidade n√£o nos permite chegar a isso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E, pessoalmente, meu desejo √© cumprir os padr√µes existentes no setor, mas isso tamb√©m est√° nos planos para o futuro, talvez at√© este ano.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt503690/index.html">Melhores pr√°ticas do Kubernetes. Atualiza√ß√£o de cluster de tempo de inatividade zero do Kubernetes</a></li>
<li><a href="../pt503696/index.html">Gears of war: quando computadores anal√≥gicos mec√¢nicos dominavam o mar</a></li>
<li><a href="../pt503698/index.html">Contabilidade remota - como um benef√≠cio comercial</a></li>
<li><a href="../pt503700/index.html">Criando formul√°rios de rea√ß√£o em 2020</a></li>
<li><a href="../pt503702/index.html">Usando dados brutos no Google Analytics na pr√°tica</a></li>
<li><a href="../pt503706/index.html">Por que essas regras clim√°ticas irritantes s√£o necess√°rias para lan√ßar e pousar foguetes?</a></li>
<li><a href="../pt503710/index.html">PyDoma [PyData Moscow Meetup # 12]: 26 de maio de 2020</a></li>
<li><a href="../pt503712/index.html">Status e desempenho das solu√ß√µes de armazenamento persistente Kubernetes</a></li>
<li><a href="../pt503716/index.html">Voc√™ precisa de nuvens no espa√ßo</a></li>
<li><a href="../pt503718/index.html">Advogado rob√¥, aplicativo de coleta de lixo e muito mais: hackathon de tubo on-line com pizza on-line vence a crise</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>