<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚§µÔ∏è ü§ûüèª üòô Aprovisionamiento de metal desnudo h√°galo usted mismo o preparaci√≥n autom√°tica del servidor desde cero üìµ üëû üëΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola, soy Denis y una de mis √°reas de actividad es el desarrollo de soluciones de infraestructura en X5. Hoy me gustar√≠a compartir con ustedes sobre c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Aprovisionamiento de metal desnudo h√°galo usted mismo o preparaci√≥n autom√°tica del servidor desde cero</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/X5RetailGroup/blog/493124/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hola, soy Denis y una de mis √°reas de actividad es el desarrollo de soluciones de infraestructura en X5. </font><font style="vertical-align: inherit;">Hoy me gustar√≠a compartir con ustedes sobre c√≥mo pueden implementar un sistema automatizado de preparaci√≥n del servidor basado en herramientas disponibles p√∫blicamente. </font><font style="vertical-align: inherit;">En mi opini√≥n, esta es una soluci√≥n interesante, simple y flexible.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cs/aj/wx/csajwx5dsd-sdlngyst-pfrollu.png"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por preparaci√≥n se entiende: hacer desde un nuevo servidor listo para usar, un servidor totalmente configurado con SO </font><font style="vertical-align: inherit;">Linux o con el hipervisor ESXi (la conversi√≥n del servidor de Windows no se trata en este art√≠culo). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T√©rminos</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">servidores: servidores que deben configurarse.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">servidor de instalaci√≥n: el servidor principal que proporciona todo el proceso de preparaci√≥n a trav√©s de la red.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øPor qu√© necesitas automatizaci√≥n?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Digamos que hay un problema: preparar en masa el servidor desde cero, en el pico: 30 por d√≠a. </font><font style="vertical-align: inherit;">Servidores de diferentes fabricantes y modelos, se pueden instalar diferentes sistemas operativos en ellos, un hipervisor puede o no existir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Qu√© operaciones se incluyen en el proceso de configuraci√≥n (sin automatizaci√≥n):</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conecte el teclado, el mouse, el monitor al servidor;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">configurar BIOS, RAID, IPMI;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">actualizar el firmware del componente;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">implementar una imagen del sistema de archivos (o instalar un hipervisor y copiar m√°quinas virtuales);</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota. </font><font style="vertical-align: inherit;">Alternativamente, es posible implementar el sistema operativo a trav√©s de la instalaci√≥n con un archivo de respuesta autom√°tica. </font><font style="vertical-align: inherit;">Pero esto no se discutir√° en el art√≠culo. </font><font style="vertical-align: inherit;">Aunque ver√° a continuaci√≥n que agregar esta funcionalidad es f√°cil.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">configurar los par√°metros del sistema operativo (nombre de host, IP, etc.).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con este enfoque, la misma configuraci√≥n se realiza secuencialmente en cada servidor. </font><font style="vertical-align: inherit;">La efectividad de tal trabajo es muy baja. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La esencia de la automatizaci√≥n es excluir la participaci√≥n humana del proceso de preparaci√≥n del servidor. </font><font style="vertical-align: inherit;">Cuanto m√°s se pueda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gracias a la automatizaci√≥n, el tiempo de inactividad entre operaciones se reduce y se hace posible preparar varios servidores al mismo tiempo. </font><font style="vertical-align: inherit;">La probabilidad de errores debidos al factor humano tambi√©n se reduce considerablemente.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/g7/ic/x1/g7icx1q3tb0yanpntf9jmw8n4p4.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øC√≥mo se configuran los servidores autom√°ticamente?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Analizaremos todos los pasos en detalle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tiene un servidor Linux que utiliza como servidor de instalaci√≥n PXE. </font><font style="vertical-align: inherit;">Los servicios est√°n instalados y configurados en √©l: DHCP, TFTP. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, cargamos el servidor (que necesita ser configurado) por PXE. </font><font style="vertical-align: inherit;">Recordemos c√≥mo funciona:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El servidor seleccionado para arrancar a trav√©s de la red.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El servidor carga el PXE-ROM de la tarjeta de red y se pone en contacto con el servidor de instalaci√≥n a trav√©s de DHCP para obtener la direcci√≥n de red.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El DHCP del servidor de instalaci√≥n proporciona la direcci√≥n, as√≠ como las instrucciones para su posterior descarga a trav√©s de PXE.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El servidor descarga el gestor de arranque de red desde el servidor de instalaci√≥n a trav√©s de PXE; la descarga adicional se realiza de acuerdo con el archivo de configuraci√≥n de PXE.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La descarga se realiza en funci√≥n de los par√°metros recibidos (kernel, initramfs, puntos de montaje, imagen de squashfs, etc.).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota. </font><font style="vertical-align: inherit;">Este art√≠culo describe el arranque PXE a trav√©s del modo BIOS. </font><font style="vertical-align: inherit;">Actualmente, los fabricantes est√°n introduciendo activamente el modo de arranque UEFI. </font><font style="vertical-align: inherit;">Para PXE, la diferencia estar√° en la configuraci√≥n del servidor DHCP y la presencia de un gestor de arranque adicional. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considere un ejemplo de configuraci√≥n del servidor PXE (men√∫ pxelinux). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Archivo pxelinux.cfg / default:</font></font><br>
<br>
<pre><code class="plaintext hljs">default menu.c32<font></font>
prompt 0<font></font>
timeout 100<font></font>
menu title X5 PXE Boot Menu<font></font>
LABEL InstallServer Menu<font></font>
	MENU LABEL InstallServer<font></font>
	KERNEL menu.c32<font></font>
	APPEND pxelinux.cfg/installserver<font></font>
LABEL VMware Menu<font></font>
	MENU LABEL VMware ESXi Install<font></font>
	KERNEL menu.c32<font></font>
	APPEND pxelinux.cfg/vmware<font></font>
LABEL toolkit //   <font></font>
	MENU LABEL Linux Scripting Toolkits<font></font>
	MENU default<font></font>
	KERNEL menu.c32<font></font>
	APPEND pxelinux.cfg/toolkit //    </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Archivo pxelinux.cfg / toolkit:</font></font><br>
<br>
<pre><code class="plaintext hljs">prompt 0<font></font>
timeout 100<font></font>
menu title X5 PXE Boot Menu<font></font>
label mainmenu<font></font>
    menu label ^Return to Main Menu<font></font>
    kernel menu.c32<font></font>
    append pxelinux.cfg/default<font></font>
label x5toolkit-auto //   ‚Äî  <font></font>
        menu label x5 toolkit autoinstall<font></font>
        menu default<font></font>
        kernel toolkit/tkcustom-kernel<font></font>
        append initrd=toolkit/tk-initramfs.gz quiet net.ifnames=0 biosdevname=0 nfs_toolkit_ip=192.168.200.1 nfs_toolkit_path=tftpboot/toolkit nfs_toolkit_script=scripts/mount.sh script_cmd=master-install.sh CMDIS2=‚Äù‚Ä¶‚Äù<font></font>
label x5toolkit-shell //   - <font></font>
        menu label x5 toolkit shell<font></font>
        kernel toolkit/tkcustom-kernel<font></font>
        append initrd=toolkit/tkcustom-initramfs.gz quiet net.ifnames=0 biosdevname=0 nfs_toolkit_ip=192.168.200.1 nfs_toolkit_path=tftpboot/toolkit nfs_toolkit_script=scripts/mount.sh script_cmd=/bin/bash CMDIS2=‚Äù‚Ä¶‚Äù</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El kernel y initramfs en esta etapa son una imagen de Linux intermedia, con la ayuda de la cual se llevar√° a cabo la preparaci√≥n b√°sica y la configuraci√≥n del servidor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como puede ver, el gestor de arranque pasa muchos par√°metros al n√∫cleo. </font><font style="vertical-align: inherit;">Algunos de estos par√°metros son utilizados por el n√∫cleo mismo. </font><font style="vertical-align: inherit;">Y podemos usar algunos para nuestros propios fines. </font><font style="vertical-align: inherit;">Esto se describir√° m√°s adelante, pero por ahora puede recordar que todos los par√°metros pasados ‚Äã‚Äãestar√°n disponibles en la imagen de Linux intermedia a trav√©s de / proc / cmdline. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øD√≥nde conseguirlos, el kernel y initramfs? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como base, puede elegir cualquier distribuci√≥n de Linux. </font><font style="vertical-align: inherit;">A qu√© prestamos atenci√≥n al elegir:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la imagen de arranque debe ser universal (controladores disponibles, la capacidad de instalar utilidades adicionales);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">muy probablemente, initramfs necesitar√° ser personalizado.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øC√≥mo se hace esto en nuestra soluci√≥n para X5? Elegimos CentOS 7 como base. Hagamos el siguiente truco: preparar la estructura de la imagen futura, empaquetarla en el archivo y crear initramfs, dentro de la cual estar√° nuestro archivo del sistema de archivos. Al cargar la imagen, el archivo se desplegar√° en la secci√≥n tmpfs creada. Por lo tanto, obtenemos una imagen live-linux m√≠nima pero completa con todas las utilidades necesarias, que consta de solo dos archivos: vmkernel e initramfs.</font></font><br>
<br>
<pre><code class="plaintext hljs"># : <font></font>
<font></font>
mkdir -p /tftpboot/toolkit/CustomTK/rootfs /tftpboot/toolkit/CustomTK/initramfs/bin<font></font>
<font></font>
# :<font></font>
<font></font>
yum groups -y install "Minimal Install" --installroot=/tftpboot/toolkit/CustomTK/rootfs/<font></font>
yum -y install nfs-utils mariadb ntpdate mtools syslinux mdadm tbb libgomp efibootmgr dosfstools net-tools pciutils openssl make ipmitool OpenIPMI-modalias rng-tools --installroot=/tftpboot/toolkit/CustomTK/rootfs/<font></font>
yum -y remove biosdevname --installroot=/tftpboot/toolkit/CustomTK/rootfs/<font></font>
<font></font>
#  initramfs:<font></font>
<font></font>
wget https://busybox.net/downloads/binaries/1.31.0-defconfig-multiarch-musl/busybox-x86_64 -O /tftpboot/toolkit/CustomTK/initramfs/bin/busybox<font></font>
chmod a+x /tftpboot/toolkit/CustomTK/initramfs/bin/busybox<font></font>
cp /tftpboot/toolkit/CustomTK/rootfs/boot/vmlinuz-3.10.0-957.el7.x86_64 /tftpboot/toolkit/tkcustom-kernel<font></font>
<font></font>
#  /tftpboot/toolkit/CustomTK/initramfs/init (  ):<font></font>
<font></font>
#!/bin/busybox sh<font></font>
/bin/busybox --install /bin<font></font>
mkdir -p /dev /proc /sys /var/run /newroot<font></font>
mount -t proc proc /proc<font></font>
mount -o mode=0755 -t devtmpfs devtmpfs /dev<font></font>
mkdir -p /dev/pts /dev/shm /dev/mapper /dev/vc<font></font>
mount -t devpts -o gid=5,mode=620 devpts /dev/pts<font></font>
mount -t sysfs sysfs /sys<font></font>
mount -t tmpfs -o size=4000m tmpfs /newroot<font></font>
echo -n "Extracting rootfs... "<font></font>
xz -d -c -f rootfs.tar.xz | tar -x -f - -C /newroot<font></font>
echo "done"<font></font>
mkdir -p /newroot/dev /newroot/proc /newroot/sys<font></font>
mount --move /sys  /newroot/sys<font></font>
mount --move /proc /newroot/proc<font></font>
mount --move /dev  /newroot/dev<font></font>
exec switch_root /newroot /sbin/init<font></font>
<font></font>
#  rootfs  initramfs:<font></font>
<font></font>
cd /tftpboot/toolkit/CustomTK/rootfs<font></font>
tar cJf /tftpboot/toolkit/CustomTK/initramfs/rootfs.tar.xz --exclude ./proc --exclude ./sys --exclude ./dev .<font></font>
cd /tftpboot/toolkit/CustomTK/initramfs<font></font>
find . -print0 | cpio --null -ov --format=newc | gzip -9 &gt; /tftpboot/toolkit/tkcustom-initramfs-new.gz</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, hemos especificado un kernel e initramfs que deben cargarse. </font><font style="vertical-align: inherit;">Como resultado, en esta etapa, descargando la imagen intermedia de Linux a trav√©s de PXE, obtenemos la consola del sistema operativo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Genial, pero ahora necesitamos transferir el control a nuestra "automatizaci√≥n". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se puede hacer as√≠. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supongamos que, despu√©s de cargar la imagen, planeamos transferir el control al script mount.sh. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Incluimos el script mount.sh en ejecuci√≥n autom√°tica. </font><font style="vertical-align: inherit;">Para hacer esto, necesita modificar initramfs:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">descomprimir initramfs (si usamos la versi√≥n anterior de initramfs, esto no es obligatorio)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">incluir en el c√≥digo de inicio que analizar√° los par√°metros pasados ‚Äã‚Äãa trav√©s de / proc / cmdline y continuar√° transfiriendo el control;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">paquete initramfs.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota. En el caso del kit de herramientas X5, el control de arranque se transfiere al script </font></font><code>/opt/x5/toolkit/bin/hook.sh   override.conf  getty tty1 (ExecStart=‚Ä¶) </code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
, por lo que se carga la imagen, en la que el script mount.sh comienza al inicio. A continuaci√≥n, el script mount.sh en el proceso de an√°lisis analiza los par√°metros pasados ‚Äã‚Äã(script_cmd =) y lanza el programa / script necesario. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
label toolkit- </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auto</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
kernel ... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
append ... nfs_toolkit_script = scripts / mount.sh </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">script_cmd = master-install.sh</font></font><br>
</b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
label toolkit- </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
kernel ... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
append ... nfs_toolkit_script = scripts / mount.sh </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">script_cmd = / bin / bash</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/w9/xc/8b/w9xc8b87fob_jooqjazqiyyiccm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Aqu√≠ en el lado izquierdo est√° el men√∫ PXE , a la derecha est√° el esquema de transferencia de control.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con la transferencia de control, lo descubrimos. </font><font style="vertical-align: inherit;">Dependiendo de la elecci√≥n del men√∫ PXE, se inicia el script de autoajuste o la consola de depuraci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el caso de la configuraci√≥n autom√°tica, se montan los directorios necesarios del servidor de instalaci√≥n, en los que hay:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">guiones;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plantillas BIOS / UEFI guardadas de varios servidores;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">firmware;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilidades para servidores;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">troncos</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n, el script mount.sh transfiere el control al script master-install.sh desde el directorio de scripts. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El √°rbol de guiones (el orden de su lanzamiento) se ve m√°s o menos as√≠:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instalaci√≥n maestra</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">funciones compartidas (funciones comunes)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">info (salida de informaci√≥n)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modelos (configuraci√≥n de par√°metros de instalaci√≥n basados ‚Äã‚Äãen el modelo del servidor)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prepare_utils (instalando las utilidades necesarias)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fwupdate (actualizaci√≥n de firmware)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diag (diagn√≥stico elemental)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">biosconf (configuraci√≥n BIOS / UEFI)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">clockfix (establecer la hora en la placa base)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">srmconf (configuraci√≥n de la interfaz remota)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">raidconf (configuraci√≥n de vol√∫menes l√≥gicos)</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
uno de:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preinstalaci√≥n (transferencia de control al instalador del sistema operativo o hipervisor, por ejemplo ESXi)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instalaci√≥n combinada (inicio directo de desempaquetar la imagen)</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ahora sabemos:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√≥mo arrancar el servidor a trav√©s de PXE;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√≥mo transferir el control a tu propio script.</font></font></li>
</ul></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Continuemos. </font><font style="vertical-align: inherit;">Los siguientes problemas se han vuelto relevantes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øC√≥mo identificar el servidor que estamos preparando?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øQu√© utilidades y c√≥mo configurar el servidor?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øC√≥mo obtener la configuraci√≥n de un servidor espec√≠fico?</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øC√≥mo identificar el servidor que estamos preparando?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es simple - DMI:</font></font><br>
<br>
<pre><code class="plaintext hljs">dmidecode ‚Äìs system-product-name<font></font>
dmidecode ‚Äìs system-manufacturer<font></font>
dmidecode ‚Äìs system-serial-number</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tiene todo lo que necesita: un proveedor, un modelo, un n√∫mero de serie. </font><font style="vertical-align: inherit;">Si no est√° seguro de que esta informaci√≥n se presente en todos los servidores, puede identificarlos por direcci√≥n MAC. </font><font style="vertical-align: inherit;">O de ambas maneras al mismo tiempo si los proveedores de servidores son diferentes y en algunos modelos la informaci√≥n del n√∫mero de serie simplemente no est√° disponible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seg√∫n la informaci√≥n recibida, se montan las carpetas de red del servidor de instalaci√≥n y se carga todo lo necesario (utilidades, firmware, etc.).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øQu√© utilidades y c√≥mo configurar el servidor?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dar√© utilidades para Linux para algunos fabricantes. </font><font style="vertical-align: inherit;">Todas las utilidades est√°n disponibles en los sitios web oficiales de los proveedores. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xx/xh/3f/xxxh3f0pg48elgtr8qn9r_wjp4q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con el firmware, creo que todo est√° claro. </font><font style="vertical-align: inherit;">Por lo general, vienen en ejecutables empaquetados. </font><font style="vertical-align: inherit;">El archivo ejecutable controla el proceso de actualizaci√≥n del firmware e informa un c√≥digo de retorno. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El BIOS y el IPMI generalmente se configuran a trav√©s de plantillas. </font><font style="vertical-align: inherit;">Si es necesario, la plantilla se puede editar antes de cargar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las utilidades RAID para algunos proveedores tambi√©n pueden configurarse de acuerdo con la plantilla. </font><font style="vertical-align: inherit;">Si este no es el caso, tendr√° que escribir un script de configuraci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El procedimiento para configurar RAID suele ser el siguiente:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solicitamos la configuraci√≥n actual.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si ya hay arreglos l√≥gicos, lo borramos.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Observamos qu√© discos f√≠sicos est√°n presentes y cu√°ntos de ellos.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crea una nueva matriz l√≥gica. </font><font style="vertical-align: inherit;">Interrumpimos el proceso en caso de error.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øC√≥mo obtener la configuraci√≥n de un servidor espec√≠fico?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supongamos que todas las configuraciones del servidor se almacenan en el servidor de instalaci√≥n. </font><font style="vertical-align: inherit;">En este caso, para responder a nuestra pregunta, primero debe decidir: c√≥mo transferir la configuraci√≥n al servidor de instalaci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al principio, es bastante posible hacerlo con archivos de texto. </font><font style="vertical-align: inherit;">(En el futuro, puede usar un archivo de texto como una forma de respaldo para transferir la configuraci√≥n). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede "compartir" un archivo de texto en el servidor de instalaci√≥n. </font><font style="vertical-align: inherit;">Y agr√©guelo al script mount.sh. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las l√≠neas, por ejemplo, se ver√°n as√≠: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&lt;n√∫mero de serie&gt; &lt;nombre del host&gt; &lt;subred&gt; El </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ingeniero transferir√° estas l√≠neas al archivo desde su m√°quina de trabajo. </font><font style="vertical-align: inherit;">Y luego, al configurar el servidor, los par√°metros para un servidor espec√≠fico se leer√°n del archivo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero, en el futuro, es mejor usar la base de datos para almacenar la configuraci√≥n, los estados y los registros de instalaci√≥n del servidor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por supuesto, una base de datos no puede funcionar, y tendr√° que crear una parte del cliente, con la ayuda de la cual se transferir√° la configuraci√≥n a la base de datos. Esto es m√°s dif√≠cil de implementar que un archivo de texto, pero en realidad no es tan dif√≠cil como parece. La versi√≥n m√≠nima del cliente, que simplemente transferir√° datos a la base de datos, es bastante factible de escribir usted mismo. En el futuro, ser√° posible mejorar el programa del cliente tambi√©n en modo libre (informes, impresi√≥n de etiquetas, env√≠o de notificaciones, etc., lo que se le ocurra). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de realizar una solicitud espec√≠fica a la base de datos e indicar el n√∫mero de serie del servidor, obtenemos los par√°metros necesarios para configurar el servidor.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, no necesitamos inventar bloqueos para acceso simult√°neo, como es el caso de un archivo de texto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Podemos escribir el registro de configuraci√≥n en todas las etapas de la base de datos y controlar el proceso de instalaci√≥n a trav√©s de eventos y marcas de las etapas de preparaci√≥n. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ahora sabemos c√≥mo:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cargar el servidor a trav√©s de PXE;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">transferir el control a nuestro script;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">identificar el servidor que se preparar√° por n√∫mero de serie;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">configurar el servidor con las utilidades apropiadas;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">transferir configuraciones a la base de datos del servidor de instalaci√≥n utilizando la parte del cliente.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Descubr√≠ c√≥mo:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el servidor instalado recibe la configuraci√≥n necesaria de la base de datos;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">todo el progreso de la preparaci√≥n se registra en la base de datos (registros, eventos, indicadores de etapa).</font></font></li>
</ul></b><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øQu√© pasa con los diferentes tipos de software que se instalan? </font><font style="vertical-align: inherit;">¬øC√≥mo instalar un hipervisor, copiar una VM y configurar todo esto?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el caso de implementar una imagen del sistema de archivos (linux) en el hardware, todo es bastante simple:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Despu√©s de configurar todos los componentes del servidor, implemente la imagen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instale el gestor de arranque grub.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hacemos chroot y configuramos todo lo necesario.</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥mo transferir el control al instalador del sistema operativo (usando ESXi como ejemplo).</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Organizamos la transferencia de control de nuestro script al instalador del hipervisor utilizando el archivo de respuesta autom√°tica (kickstart):</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eliminar las particiones actuales en el disco.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crea una partici√≥n de 500 MB.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lo marcamos como arranque.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formatear en FAT32.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Copiamos los archivos de instalaci√≥n de ESXi a la ra√≠z.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instalar syslinux.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Copie syslinux.cfg a / syslinux /</font></font></li>
</ul><br>
<pre><code class="plaintext hljs">default esxi<font></font>
prompt 1<font></font>
timeout 50<font></font>
label esxi<font></font>
kernel mboot.c32<font></font>
append -c boot.cfg</code></pre><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Copie mboot.c32 a / syslinux.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En boot.cfg debe haber kernelopt = ks = ftp: // &lt;IP del servidor de instalaci√≥n&gt; /ks_esxi.cfg</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reinicia el servidor.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de reiniciar el servidor, el instalador de ESXi se iniciar√° desde su disco duro. </font><font style="vertical-align: inherit;">Todos los archivos de instalaci√≥n necesarios se cargar√°n en la memoria y comenzar√° la instalaci√≥n de ESXi, de acuerdo con el archivo de respuesta autom√°tica especificado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ hay algunas l√≠neas del archivo de respuesta autom√°tica ks_esxi.cfg:</font></font><br>
<br>
<pre><code class="plaintext hljs">%firstboot --interpreter=busybox<font></font>
‚Ä¶<font></font>
#   <font></font>
<font></font>
SYSSN=$(esxcli hardware platform get | grep Serial | awk -F " " '{print $3}')<font></font>
<font></font>
#  IP<font></font>
<font></font>
IPADDRT=$(esxcli network ip interface ipv4 get | grep vmk0 | awk -F " " '{print $2}')<font></font>
LAST_OCTET=$(echo $IPADDRT | awk -F'.' '{print $4}')<font></font>
<font></font>
#  NFS -<font></font>
<font></font>
esxcli storage nfs add -H is -s /srv/nfs_share -v nfsshare1<font></font>
<font></font>
#    ssh,   ssh-<font></font>
<font></font>
mv /etc/ssh /etc/ssh.tmp<font></font>
cp -R /vmfs/volumes/nfsshare1/ssh /etc/<font></font>
chmod go-r /etc/ssh/ssh_host_rsa_key<font></font>
<font></font>
#  ovftool,    ,    <font></font>
<font></font>
cp -R /vmfs/volumes/nfsshare1/ovftool /vmfs/volumes/datastore1/<font></font>
<font></font>
#  <font></font>
<font></font>
/vmfs/volumes/datastore1/ovftool/tools/ovftool --acceptAllEulas --noSSLVerify --datastore=datastore1 --name=VM1 /vmfs/volumes/nfsshare1/VM_T/VM1.ova vi://root:esxi_password@127.0.0.1<font></font>
/vmfs/volumes/datastore1/ovftool/tools/ovftool --acceptAllEulas --noSSLVerify --datastore=datastore1 --name=VM2 /vmfs/volumes/nfsshare1/VM_T/VM2.ova vi://root:esxi_password@127.0.0.1<font></font>
<font></font>
#      <font></font>
<font></font>
ssh root@is "mysql -h'192.168.0.1' -D'servers' -u'user' -p'secretpassword' -e \"SELECT ... WHERE servers.serial='$SYSSN'\"" | grep -v ^$ | sed 's/NULL//g' &gt; /tmp/servers<font></font>
...<font></font>
#    <font></font>
<font></font>
echo '#!/bin/sh' &gt; /vmfs/volumes/datastore1/netconf.sh<font></font>
echo "esxcli network ip interface ipv4 set -i=vmk0 -t=static --ipv4=$IPADDR --netmask=$S_SUB || exit 1" &gt;&gt; /vmfs/volumes/datastore1/netconf.sh<font></font>
echo "esxcli network ip route ipv4 add -g=$S_GW -n=default || exit 1" &gt;&gt; /vmfs/volumes/datastore1/netconf.sh<font></font>
chmod a+x /vmfs/volumes/datastore1/netconf.sh<font></font>
<font></font>
#   guestinfo.esxihost.id,     <font></font>
<font></font>
echo "guestinfo.esxihost.id = \"$SYSSN\"" &gt;&gt; /vmfs/volumes/datastore1/VM1/VM1.vmx<font></font>
echo "guestinfo.esxihost.id = \"$SYSSN\"" &gt;&gt; /vmfs/volumes/datastore1/VM2/VM2.vmx<font></font>
...<font></font>
#    <font></font>
<font></font>
SYSNAME=$(esxcli hardware platform get | grep Product | sed 's/Product Name://' | sed 's/^\ *//')<font></font>
UUID=$(vim-cmd hostsvc/hostsummary | grep uuid | sed 's/\ //g;s/,$//' | sed 's/^uuid="//;s/"$//')<font></font>
ssh root@is "mysql -D'servers' -u'user' -p'secretpassword' -e \"UPDATE servers ... SET ... WHERE servers.serial='$SYSSN'\""<font></font>
ssh root@is "mysql -D'servers' -u'user' -p'secretpassword' -e \"INSERT INTO events ...\""<font></font>
<font></font>
#   SSH<font></font>
<font></font>
rm -rf /etc/ssh<font></font>
mv /etc/ssh.tmp /etc/ssh<font></font>
<font></font>
#    <font></font>
<font></font>
esxcli system hostname set --fqdn=esx-${G_NICK}.x5.ru<font></font>
/vmfs/volumes/datastore1/netconf.sh<font></font>
reboot<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En esta etapa, se instala y configura un hipervisor, se copian las m√°quinas virtuales. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øC√≥mo configurar m√°quinas virtuales ahora? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hicimos trampa un poco: durante la instalaci√≥n configuramos el par√°metro guestinfo.esxihost.id = "$ SYSSN" en el archivo VM1.vmx, indicando el n√∫mero de serie del servidor f√≠sico en √©l. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora, despu√©s de comenzar, la m√°quina virtual (con el paquete vmware-tools instalado) puede acceder a este par√°metro:</font></font><br>
<br>
<pre><code class="plaintext hljs">ESXI_SN=$(vmtoolsd --cmd "info-get guestinfo.esxihost.id")</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es decir, la VM podr√° identificarse (conoce el n√∫mero de serie del host f√≠sico), realizar una solicitud a la base de datos del servidor de instalaci√≥n y obtener los par√°metros que deben configurarse. </font><font style="vertical-align: inherit;">Todo esto se ejecuta en un script que debe iniciarse autom√°ticamente cuando se inicia guestos vm (pero una vez: RunOnce). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ahora sabemos c√≥mo:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cargar el servidor a trav√©s de PXE;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">transferir el control a nuestro script;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">identificar el servidor que se preparar√° por n√∫mero de serie;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">configurar el servidor con las utilidades apropiadas;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">transferir configuraciones a la base de datos del servidor de instalaci√≥n utilizando la parte del cliente;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configure varios tipos de PO, incluida la implementaci√≥n del hipervisor esxi y la configuraci√≥n de m√°quinas virtuales (y todo de forma autom√°tica).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Descubr√≠ c√≥mo:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el servidor instalado recibe la configuraci√≥n necesaria de la base de datos;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">todo el progreso de la preparaci√≥n se registra en la base de datos (registros, eventos, indicadores de etapa).</font></font></li>
</ul></b><br>
<u><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En pocas palabras:</font></font></b></u><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
creo que la singularidad de esta soluci√≥n radica en su flexibilidad, simplicidad, sus capacidades y versatilidad. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por favor escribe en los comentarios lo que piensas.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es493112/index.html">C√≥mo comenzar un nuevo negocio en 6 meses en lugar de 3 a√±os</a></li>
<li><a href="../es493114/index.html">C√≥mo el ingeniero de datos observ√≥ los datos</a></li>
<li><a href="../es493116/index.html">"¬°M√°s interactividad!" o ¬øC√≥mo fue TeamLead Conf 2020?</a></li>
<li><a href="../es493118/index.html">Descripci√≥n general de la extensi√≥n de etiquetado de memoria (Armv8.5-A)</a></li>
<li><a href="../es493122/index.html">Oficina de Banzai Games: Jap√≥n en el centro de Mosc√∫</a></li>
<li><a href="../es493126/index.html">Antipatrones de arquitectura orientada a eventos</a></li>
<li><a href="../es493130/index.html">–ü–æ—á–µ–º—É –Ω–µ —Å—Ç–æ–∏—Ç –±–æ—è—Ç—å—Å—è –∫–æ—Ä–æ–Ω–∞–≤–∏—Ä—É—Å–∞: –º–∏—Ñ—ã –∏ –ø–æ—á—Ç–∏ –ø—Ä–∞–≤–¥–∞ –æ COVID-2019</a></li>
<li><a href="../es493132/index.html">Alrededor de data.table</a></li>
<li><a href="../es493136/index.html">FAST VP en Unity Storage: c√≥mo funciona</a></li>
<li><a href="../es493138/index.html">H√°blame: qu√© pueden hacer los bots de voz hoy</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>