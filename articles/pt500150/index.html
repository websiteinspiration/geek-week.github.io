<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßöüèø ‚ÜòÔ∏è üë≠ Rob√¥ ROS e Mendigo de Grade Neural üö∞ üë©üèª‚Äçüöí üëµüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Geralmente, duas dessas quest√µes surgem para tais of√≠cios: "como?" e para qu√™?" A publica√ß√£o em si √© dedicada √† primeira pergunta, e responderei imedi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Rob√¥ ROS e Mendigo de Grade Neural</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/500150/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Geralmente, duas dessas quest√µes surgem para tais of√≠cios: "como?" e para qu√™?" A publica√ß√£o em si √© dedicada √† primeira pergunta, e responderei imediatamente √† segunda: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
iniciei este projeto para dominar a rob√≥tica, come√ßando com o Raspberry Pi e a c√¢mera. Como voc√™ sabe, uma das melhores maneiras de aprender algo √© criar uma tarefa t√©cnica e tentar cumpri-la, enquanto obt√©m as habilidades necess√°rias. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Naquela √©poca, eu ainda n√£o tinha id√©ias brilhantes no campo da rob√≥tica, ent√£o decidi fazer um projeto exclusivamente divertido - um rob√¥ mendigo. O resultado √© um rob√¥ aut√¥nomo no Raspberry Pi e ROS, usando o Movidius Neural Cumpute Stick para detectar rostos. Ele anda pela sala, procurando por pessoas, e balan√ßa uma lata na frente deles. Aqui est√° a apar√™ncia desse rob√¥:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pt/wp/nt/ptwpntdd13lkskxbxjuhoyx1oom.jpeg"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O rob√¥ se move aleatoriamente pela sala e, se notar uma pessoa, rola at√© ele e sacode uma jarra para coisas pequenas. </font><font style="vertical-align: inherit;">Por divers√£o, adicionei uma pequena express√£o facial a ele - ele sabe como mover as sobrancelhas: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2x/lm/aw/2xlmaw5tm_hogsuqfuvqwjmeblk.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ap√≥s a primeira tentativa, o rob√¥ tenta encontrar seu rosto novamente √† vista, vira-se para a pessoa e sacode o banco novamente. </font><font style="vertical-align: inherit;">Mas o que acontece se voc√™ sair neste momento:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ko/8x/xz/ko8xxzvzo_owit62gkv8z3wn1ik.gif"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rob√¥</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tomei a id√©ia de um rob√¥ implorador da </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">revista Popular Mechanics</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">A autoria do prot√≥tipo de Chris Eckert, chamada Gimme, parece muito esteticamente agrad√°vel.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/374/8d6/dbc/3748d6dbcb97d04751dacd866eb94e07.jpg" alt="imagem" width="300" height="300"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como eu queria me concentrar mais na funcionalidade, o gabinete foi montado a partir de materiais improvisados. </font><font style="vertical-align: inherit;">Em particular, os cantos de PVC provaram ser o material mais vers√°til com o qual voc√™ pode conectar quase duas partes. </font><font style="vertical-align: inherit;">Parece que no momento o rob√¥ √© composto por cinco por cento de cantos de PVC e parafusos M3. </font><font style="vertical-align: inherit;">O gabinete em si consiste em tr√™s plataformas laminadas nas quais a cabe√ßa e todos os componentes eletr√¥nicos est√£o montados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A base do rob√¥ √© o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raspberry Pi 2B</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , e o c√≥digo est√° escrito em C ++ e est√° no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vis√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para perceber a realidade, o rob√¥ usa a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√¢mera Paspberry Pi Camera Module v2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que pode ser controlada usando a biblioteca </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RaspiCam</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para detec√ß√£o de rosto, tentei v√°rias abordagens diferentes. A qualidade dos detectores cl√°ssicos da OpenCV n√£o me satisfazia, ent√£o, no final, cheguei a uma solu√ß√£o n√£o padronizada. Detec√ß√£o de pessoas envolvidas na rede neural em execu√ß√£o no dispositivo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Movidius Neural Compute Stick (NCS)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sob a estrutura de controle </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenVINO</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O NCS √© uma pe√ßa de hardware para o lan√ßamento eficaz de redes neurais, dentro da qual existem v√°rios processadores vetoriais especialmente adaptados para isso. O dispositivo est√° conectado via USB e consome apenas 1 Watt de energia. Assim, o NCS atua como um coprocessador para o Raspberry Pi, que n√£o puxa a rede neural. Enquanto o NCS est√° processando o pr√≥ximo quadro, o processador Paspberry est√° livre para outras opera√ß√µes. Vale ressaltar que, para uma opera√ß√£o ideal do dispositivo, √© necess√°ria uma interface USB 3.0, que n√£o est√° dispon√≠vel nas vers√µes mais antigas do Raspberry; com o USB 2.0, ele tamb√©m funciona, apenas mais devagar. Al√©m disso, para n√£o bloquear os conectores USB Raspberry, conecto o NCS a ele atrav√©s de um cabo USB curto. Escrevi em detalhes sobre como trabalhar com o Neural Compute Stick </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no meu artigo anterior</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No come√ßo eu tentei treinar</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">detector de rosto pr√≥prio com arquitetura MobileNet + SSD</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> em conjuntos de dados abertos. O detector realmente funcionou, mas n√£o √© muito est√°vel: com a inevit√°vel deteriora√ß√£o das condi√ß√µes de disparo (exposi√ß√£o e fotos desfocadas), a qualidade do detector diminuiu bastante. No entanto, depois de algum tempo, os detectores de rosto prontos apareceram no OpenVINO, e eu mudei para um detector com a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arquitetura SqueezeNet light + SSD</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que n√£o s√≥ funcionou melhor em v√°rias condi√ß√µes de disparo, mas tamb√©m foi mais r√°pido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de carregar a imagem no NCS para obter as previs√µes do detector, a imagem deve ser pr√©-processada. O detector de minha escolha funciona com imagens coloridas</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>300</mn><mo>&amp;#x00D7;</mo><mn>300</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.815ex" height="2.009ex" viewBox="0 -755.5 4225.9 865.1" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-33"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-30" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-30" x="1001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-D7" x="1723" y="0"></use><g transform="translate(2724,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-33"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-30" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-30" x="1001" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>300</mn><mo>√ó</mo><mn>300</mn></math></span></span><script type="math/tex" id="MathJax-Element-1">300 \times 300</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, para que a imagem precise ser compactada primeiro. Para fazer isso, eu uso o algoritmo de dimensionamento mais leve - o m√©todo vizinho mais pr√≥ximo (INTER_NEAREST na biblioteca OpenCV). Funciona um pouco mais r√°pido que os m√©todos de interpola√ß√£o e quase n√£o afeta o resultado. Tamb√©m vale a pena prestar aten√ß√£o na ordem dos canais de imagem: o detector espera a ordem BGR, portanto, √© necess√°rio definir o mesmo para a c√¢mera.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tamb√©m tentei separar o processamento de v√≠deo em dois fluxos, um dos quais recebeu o pr√≥ximo quadro da c√¢mera e o processou, e o outro naquele momento carregou o quadro anterior no NCS e esperou pelos resultados do detector. Com esse esquema, tecnicamente, a velocidade de processamento aumenta, mas o atraso entre o recebimento do quadro e o recebimento de detec√ß√µes tamb√©m aumenta. Por causa desse atraso na realidade, monitorar o rosto se torna apenas mais dif√≠cil, ent√£o, no final, recusei esse esquema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m de realmente detectar rostos, eles tamb√©m precisam ser rastreados para evitar erros no detector. Para fazer isso, eu uso o rastreador leve </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simple Online Realtime Tracker (SORT)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Este rastreador simples consiste em duas partes: o </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">algoritmo h√∫ngaro</font></a><font style="vertical-align: inherit;"> √© usado para combinar objetos em quadros adjacentes</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, e para prever a trajet√≥ria do objeto, se ele desaparecer repentinamente - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">filtro Kalman</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Enquanto brincava com o rastreamento de rostos, descobri que as trajet√≥rias previstas pelo filtro Kalman podem ser muito implaus√≠veis com movimentos bruscos, o que novamente apenas complica o processo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, desliguei o filtro Kalman, deixando apenas o algoritmo de correspond√™ncia de faces e o contador do n√∫mero seq√ºencial de quadros em que a face foi detectada - desta maneira, me livrei dos falsos positivos do detector. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plataforma superior, da esquerda para a direita: c√¢mera, servos para controlar a cabe√ßa e as sobrancelhas, interruptor, terminais de energia, bot√£o vermelho grande.</font></font></i><br>
<img src="https://habrastorage.org/webt/hb/ky/kk/hbkykkpwtkhtfl39aonaop5indg.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tr√°fego</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para movimenta√ß√£o, o rob√¥ possui cinco servos: dois servos de rota√ß√£o cont√≠nua FS5103R giram as rodas; Existem mais dois FS5109Ms comuns, um dos quais gira a cabe√ßa e o outro sacode a lata; finalmente, o pequeno SG90 move as sobrancelhas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para ser honesto, os mini-servos SG90 pareciam lixo para mim - um dos meus servos tinha a largura de pulso de controle incorreta e apenas um sobreviveu entre os outros quatro. Para ser justo, acidentalmente levei um dos criados com o cotovelo, mas os outros dois simplesmente n√£o aguentavam a carga (eu costumava us√°-los na cabe√ßa e na lata). At√© o √∫ltimo servo, que conseguiu o trabalho mais simples - mover as sobrancelhas, tem que enfiar um peda√ßo de pau de vez em quando, para que n√£o cunha. Com outros servos, n√£o notei nenhum problema. √â verdade que, √†s vezes, os servos de rota√ß√£o cont√≠nua precisam ser calibrados para que n√£o girem no estado inativo - para isso, existe um pequeno regulador neles que pode ser girado com uma chave de fenda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gerenciar servos com Raspberry, ao que parece, n√£o √© t√£o simples. Primeiro, eles s√£o controlados por</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modula√ß√£o de largura de pulso (PWM / PWM)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e no Raspberry existem apenas dois pinos nos quais o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWM √© suportado por hardware</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Em segundo lugar, √© claro, o Raspberry n√£o ser√° capaz de alimentar os servos, n√£o suportar√° isso. Felizmente, esses problemas s√£o resolvidos usando um controlador PWM externo. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O Adafruit PCA9685</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© um controlador PWM de 16 canais que pode ser controlado via </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interface I2C</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Tamb√©m √© muito conveniente que tenha terminais para fornecer energia para servos. Al√©m disso, [teoricamente] √© poss√≠vel encadear at√© 62 controladores enquanto recebe at√© 992 pinos de controle - para isso, √© necess√°rio atribuir um endere√ßo exclusivo a cada controlador usando jumpers especiais. Ent√£o, se voc√™ precisa de um ex√©rcito de servos de repente, sabe o que fazer.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para controlar o PCA9685, existe uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">biblioteca de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> alto n√≠vel </font><font style="vertical-align: inherit;">que atua como uma extens√£o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WiringPi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Trabalhar com isso √© bastante conveniente - durante a inicializa√ß√£o, ele cria 16 pinos virtuais nos quais voc√™ pode gravar um sinal PWM, mas primeiro voc√™ precisa calcular o n√∫mero de ticks. </font><font style="vertical-align: inherit;">Para girar a alavanca do servo para um determinado √¢ngulo na faixa [0, 180], primeiro voc√™ deve converter esse √¢ngulo na faixa de comprimentos de pulso de controle em milissegundos [SERVO_MS_MIN, SERVO_MS_MAX]. </font><font style="vertical-align: inherit;">Para todos os meus servos, esses valores s√£o aproximadamente 0,6 ms e 2,4 ms, respectivamente. </font><font style="vertical-align: inherit;">Em geral, esses valores podem ser encontrados na folha de dados do servo, mas a pr√°tica demonstrou que eles podem diferir e, portanto, podem precisar ser selecionados. </font><font style="vertical-align: inherit;">Em seguida, divida o valor resultante por 20 ms (o valor padr√£o da dura√ß√£o do ciclo de controle) e multiplique pelo n√∫mero m√°ximo de ticks PCA9685 (4096):</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">driveDegs</span><span class="hljs-params">(<span class="hljs-keyword">float</span> angle, <span class="hljs-keyword">int</span> pin)</span> </span>{
    <span class="hljs-keyword">int</span> ticks = (<span class="hljs-keyword">int</span>) (PCA_MAX_PWM * (angle/<span class="hljs-number">180.0f</span>*(SERVO_MS_MAX-SERVO_MS_MIN) + SERVO_MS_MIN) / <span class="hljs-number">20.0f</span>); <font></font>
    pwmWrite(pin, ticks);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da mesma forma, isso √© feito com servos de rota√ß√£o cont√≠nua - em vez de um √¢ngulo, definimos a velocidade no intervalo [-1,1].</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Montei o chassi do rob√¥, bem como o corpo, a partir de meios improvisados: coloquei rodas de m√≥veis nos servocontroladores de rota√ß√£o cont√≠nua e um suporte de bola de m√≥veis atua como a terceira roda. Anteriormente, em vez disso, havia uma roda em um suporte rotativo, mas com esse chassi era dif√≠cil fazer curvas precisas, ent√£o tive que substitu√≠-lo. H√° tamb√©m uma pequena roda sob a lata para transferir parte do peso do servo para a carca√ßa. Uma coisa simples que n√£o me era √≥bvia inicialmente foi que as servo-alavancas devem ser fixadas com um parafuso, especialmente para as rodas, para que n√£o caiam ao longo do caminho. Por causa dessa estupidez, tive que refazer o chassi uma vez. Tamb√©m fiz do rob√¥ um p√°ra-choque amplo feito de cantos de PVC, para que n√£o ficasse preso com tanta frequ√™ncia.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, sobre o que voc√™ pode fazer sobre isso. Primeiramente, voc√™ pode agitar a jarra e mover as sobrancelhas - para isso, basta girar a alavanca do servo para √¢ngulos pr√©-selecionados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em segundo lugar, voc√™ pode girar sua cabe√ßa. Eu n√£o queria que a cabe√ßa girasse na velocidade m√°xima do servo, porque ela tem uma c√¢mera. Portanto, decidi reduzir programaticamente a velocidade: preciso girar a alavanca em um pequeno √¢ngulo e esperar alguns milissegundos - e assim por diante at√© que o √¢ngulo desejado seja atingido. Nesse caso, √© necess√°rio lembrar a posi√ß√£o absoluta atual da cabe√ßa e sempre verificar se ela excedeu os limites permitidos (no meu rob√¥, ela est√° na faixa de [10, 90] graus).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em terceiro lugar, voc√™ pode alterar a dire√ß√£o do movimento alterando a velocidade de rota√ß√£o das rodas. </font><font style="vertical-align: inherit;">Da mesma maneira, voc√™ pode girar a plataforma, por exemplo, para seguir a face. </font><font style="vertical-align: inherit;">A velocidade angular de rota√ß√£o depende tanto dos pr√≥prios servos quanto da localiza√ß√£o no chassi; portanto, √© mais f√°cil medi-lo uma vez e lev√°-lo em considera√ß√£o nas curvas. </font><font style="vertical-align: inherit;">Para encontrar o atraso necess√°rio entre ligar os motores para rota√ß√£o e deslig√°-los, √© necess√°rio dividir o m√≥dulo de √¢ngulo pela velocidade angular. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por fim, voc√™ pode girar a cabe√ßa e o chassi simultaneamente e de forma ass√≠ncrona para n√£o perder tempo. </font><font style="vertical-align: inherit;">Eu fa√ßo assim:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">auto</span> waitRotation = <span class="hljs-built_in">std</span>::async(<span class="hljs-built_in">std</span>::launch::async, rotatePlatform, platformAngle);<font></font>
success = driveHead(headAngle);<font></font>
waitRotation.wait();<font></font>
</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plataforma central, da esquerda para a direita: PCA9685, barramento de for√ßa, Raspberry Pi, MCP3008 ADC</font></font></i><br>
<img src="https://habrastorage.org/webt/bq/q1/8_/bqq18_ilwmgadlcsz0ydepdk44u.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Navega√ß√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como eu n√£o compliquei nada, o rob√¥ usa apenas dois tel√™metros infravermelhos Sharp GP2Y0A02YK para navega√ß√£o. Isso tamb√©m n√£o √© t√£o simples, porque os sensores s√£o anal√≥gicos, mas o Raspberry, ao contr√°rio do Arduino, </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">n√£o</font></a><font style="vertical-align: inherit;"> possui </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entradas anal√≥gicas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Esse problema foi resolvido pelo conversor anal√≥gico-digital (ADC / ADC) - eu uso o MCP3008 de 10 bits e 8 canais. Ele √© vendido como um microcircuito separado, portanto teve que ser soldado a uma placa de circuito impresso e os pinos tamb√©m foram soldados l√° para tornar a conex√£o mais conveniente. Al√©m disso, seguindo o conselho do meu bati, que se atrapalha mais em circuitos, soldei dois capacitores (cer√¢micos e eletrol√≠ticos) entre as pernas da fonte de alimenta√ß√£o e o solo para absorver o ru√≠do da parte digital de todo o circuito. Os sensores produzem n√£o mais que tr√™s volts na sa√≠da; portanto, 3.3v com Raspberry pode ser conectado como uma tens√£o ADC de refer√™ncia (VREF) - a mesma da fonte de alimenta√ß√£o MCP3008 (VDD). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O MCP3008 pode ser controlado pela interface </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SPI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e, para isso, √© f√°cil encontrar </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√≥digo pronto no GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apesar disso, para um trabalho conveniente com o ADC, voc√™ precisar√° de algumas dan√ßas com um pandeiro.</font></font></b>
                        <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">analogRead</span><span class="hljs-params">(mcp3008Spi &amp;adc, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> channel)</span>
</span>{
    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> spi_data[<span class="hljs-number">3</span>];
    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> val = <span class="hljs-number">0</span>;<font></font>
<font></font>
    spi_data[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>;  <span class="hljs-comment">// start bit</span>
    spi_data[<span class="hljs-number">1</span>] = <span class="hljs-number">0b10000000</span> | ( channel &lt;&lt; <span class="hljs-number">4</span>); <span class="hljs-comment">// mode and channel</span>
    spi_data[<span class="hljs-number">2</span>] = <span class="hljs-number">0</span>; <span class="hljs-comment">// anything</span>
    adc.spiWriteRead(spi_data, <span class="hljs-keyword">sizeof</span>(spi_data));<font></font>
  <font></font>
    <span class="hljs-comment">// read value, combine last two bits of second byte with whole third byte</span>
    val = (spi_data[<span class="hljs-number">1</span>]&lt;&lt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0b1100000000</span>; <font></font>
    val |= (spi_data[<span class="hljs-number">2</span>] &amp; <span class="hljs-number">0xff</span>);
    <span class="hljs-keyword">return</span> val;<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tr√™s bytes devem ser enviados para o MCP3008, onde o bit inicial √© gravado no primeiro byte e o n√∫mero do modo e do canal (0-7) no segundo. </font><font style="vertical-align: inherit;">Tamb√©m recebemos tr√™s bytes, ap√≥s o qual precisamos colar os dois bits menos significativos do segundo byte com todos os bits do terceiro byte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora que podemos obter os valores dos sensores, precisamos calibr√°-los, porque os dois sensores podem diferir ligeiramente um do outro. </font><font style="vertical-align: inherit;">Em geral, a exibi√ß√£o √† dist√¢ncia devido √† intensidade do sinal desses sensores n√£o √© linear e n√£o √© muito simples ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para mais detalhes, consulte a folha de dados em pdf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Portanto, basta captar dois coeficientes, quando multiplicados pelos quais os sensores fornecer√£o um valor de 1,0 a uma dist√¢ncia igual e significativa.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As leituras dos sensores podem ser bastante barulhentas, especialmente em obst√°culos dif√≠ceis, ent√£o eu uso uma m√©dia m√≥vel ponderada exponencialmente (EWMA) para suavizar o sinal de cada sensor. </font><font style="vertical-align: inherit;">Selecionei os par√¢metros de suaviza√ß√£o a olho nu, para que o sinal n√£o fa√ßa barulho e n√£o fique muito atr√°s da realidade. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vista frontal: banco, tel√©metros e p√°ra-choques.</font></font></i><br>
<img src="https://habrastorage.org/webt/kb/vw/l-/kbvwl-usmln86iqj8aq236ifhpo.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nutri√ß√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro, vamos avaliar qual corrente o rob√¥ consumir√° ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sobre o consumo atual de framboesa e perif√©ricos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raspberry Pi 2B: n√£o inferior a 350 mA, mas mais sob carga (at√© 750-820 mA (?));</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√¢mera: cerca de 250 mA;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vara de computa√ß√£o neural: consumo de energia declarado de 1 watt, a uma voltagem de 5 volts no USB √© de 200 mA;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sensores IR: 33 mA cada ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">folha de dados, pdf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> );</font></font></li>
<li>MCP3008:  ,  0.5  (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">, pdf</a>);</li>
<li>PCA9685:  , 6  (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">, pdf</a>);</li>
<li>:  ~150-200   1500-2000     (stall current),          (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"> FS5109M, pdf</a>)</li>
<li>HDMI (   ): 50 ;</li>
<li> +  ( ): ~200 .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No total, pode-se estimar que 1,5-2,5 amperes devem ser suficientes, desde que todos os servos n√£o se movam simultaneamente sob carga pesada. Ao mesmo tempo, o Raspberry precisa de 5 volts condicionais de voltagem e para servos - 4,8-6 volts. Resta encontrar uma fonte de energia que atenda a esses requisitos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, decidi alimentar o rob√¥ com baterias 18650. Se voc√™ pegar duas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">baterias ROBITON 3.4 / Li18650</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (3,6 volts, 3400 mAh, corrente m√°xima de descarga 4875 mA) e conect√°-las em s√©rie, elas podem produzir at√© 4,8 amperes a uma voltagem de 7,2 volts. Com uma corrente de consumo de 1,5-2,5 amperes, eles devem ser suficientes por uma hora ou duas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As baterias, por sinal, t√™m um problema: apesar do fator de forma indicado 18650, seus tamanhos est√£o longe de</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>18</mn><mo>&amp;#x00D7;</mo><mn>650</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.653ex" height="2.009ex" viewBox="0 -755.5 3725.4 865.1" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-38" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-D7" x="1223" y="0"></use><g transform="translate(2223,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-36"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-35" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-30" x="1001" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>18</mn><mo>√ó</mo><mn>650</mn></math></span></span><script type="math/tex" id="MathJax-Element-2">18 \times 650</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mm - s√£o v√°rios mil√≠metros mais longos devido ao circuito de controle de carregamento embutido. Por causa disso, tive que esfaquear o compartimento da bateria com uma faca, para que eles se encaixassem l√°. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Resta apenas baixar a tens√£o para 5 volts. Para isso, eu uso dois conversores DC-DC </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reduzidos separados DFRobot Power Module</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Este peda√ßo de ferro permite diminuir a tens√£o com uma tens√£o de entrada de 3,6-25 volts e uma diferen√ßa de tens√£o de pelo menos 0,6 volts. Por conveni√™ncia, ele possui uma chave que permite selecionar exatamente 5 volts na sa√≠da ou configurar uma tens√£o de sa√≠da arbitr√°ria usando um regulador especial. Defino os dois conversores em 5 volts; um deles alimenta o Raspberry atrav√©s de um conector Micro-USB e o segundo alimenta servos atrav√©s dos terminais PCA9685. Isso √© necess√°rio para maximizar a fonte de alimenta√ß√£o das partes l√≥gicas e de energia do rob√¥, para que elas n√£o interfiram.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No est√°gio de depura√ß√£o, usei uma fonte de alimenta√ß√£o chinesa de 9 volts e 2 amp√®res em vez das baterias, e foi suficiente para o rob√¥ funcionar - eu a conectei, como as baterias, a dois conversores DC-DC. Portanto, por conveni√™ncia, criei terminais no rob√¥, nos quais voc√™ pode conectar uma fonte de alimenta√ß√£o ou compartimento de bateria para escolher. Isso ajudou muito quando eu reescrevi completamente todo o c√≥digo no ROS, e tive que depurar o rob√¥ por um longo tempo, incluindo servos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por conveni√™ncia, eu tamb√©m tive que fazer um "barramento de for√ßa" - na verdade, apenas um peda√ßo da placa com tr√™s fileiras de pinos conectados para terra, 3,3v e 5v, respectivamente. O barramento se conecta aos pinos correspondentes de framboesa. Somente rangefinders IR s√£o alimentados a partir do barramento 5v, e MCP3008 e PCA9685 a partir do barramento 3.3v.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E, √© claro, de acordo com a boa e velha tradi√ß√£o, eu coloco o Grande Bot√£o Vermelho no rob√¥ - quando pressionado, ele simplesmente interrompe todo o circuito de pot√™ncia. </font><font style="vertical-align: inherit;">N√£o era necess√°rio us√°-lo para uma parada de emerg√™ncia, mas ligar o rob√¥ com a ajuda de um bot√£o √© realmente mais conveniente. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plataforma inferior, da esquerda para a direita: compartimento da bateria, conversores NCS, DC-DC, servomotores com rodas, tel√©metros.</font></font></i><br>
<img src="https://habrastorage.org/webt/od/tf/6b/odtf6b5gksijt0nhbflim7wrh1m.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Controle de rob√¥</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o h√° Wi-Fi no Raspberry Pi 2B, ent√£o eu tenho que conectar via ssh atrav√©s de um cabo Ethernet (a prop√≥sito, isso tamb√©m pode ser feito </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diretamente do laptop, sem o uso de um roteador</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Acontece que este esquema: n√≥s nos conectamos via ssh atrav√©s do cabo, ligamos o rob√¥ e o retiramos. Em seguida, ele pode ser retornado ao seu lugar para acessar o Raspberry novamente. Existem solu√ß√µes mais elegantes, mas decidi n√£o complicar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para que o rob√¥ possa ser facilmente parado sem desligar, eu adicionei um grande interruptor sovi√©tico (de um submarino?). Quando voc√™ o desliga, o programa termina e o rob√¥ para. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O switch se conecta ao terra e a um dos pinos do Raspberry GPIO, e voc√™ pode ler usando </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a biblioteca WiringPi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cpp hljs">wiringPiSetup();<font></font>
pinMode(PIN_SWITCH, INPUT);<font></font>
pullUpDnControl(PIN_SWITCH, PUD_UP);<font></font>
<span class="hljs-keyword">bool</span> value = digitalRead(BB_PIN_SWITCH);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â importante notar que, com essa conex√£o, a tens√£o no pino deve ser puxada para 3,3v e, ao mesmo tempo, produzir√° um sinal alto no estado aberto e um sinal baixo no estado fechado.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Juntando tudo</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T√≥picos</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Agora, todas as op√ß√µes acima precisam ser combinadas em um programa que controla o rob√¥. </font><font style="vertical-align: inherit;">Na primeira vers√£o do rob√¥, eu fiz isso usando threads ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pthread</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Esta vers√£o est√° no ramo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">principal</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mas o c√≥digo √© bastante assustador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O programa funciona em quatro threads: um thread tira quadros da c√¢mera e inicia o detector no NCS; </font><font style="vertical-align: inherit;">o segundo fluxo l√™ dados de rangefinders; </font><font style="vertical-align: inherit;">o terceiro segmento monitora o comutador e define a vari√°vel global </font></font><code>is_running</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">como</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se estiver desligado; O thread principal √© respons√°vel pelo comportamento do rob√¥ e pelo servo controle. Os threads t√™m ponteiros em comum com o thread principal, pelo qual eles escrevem os resultados de seu trabalho. Limitei os vetores que armazenam informa√ß√µes sobre as faces encontradas pelo detector no mutex e declarei as outras vari√°veis ‚Äã‚Äãcomuns mais simples como at√¥micas. Para coordenar o fluxo do detector de rosto com a rosca principal, h√° um sinalizador </font></font><code>face_processed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que √© redefinido quando um novo resultado vem do detector e sobe quando a rosca principal usa esse resultado para selecionar um comportamento - isso √© necess√°rio para n√£o processar dados antigos que podem n√£o ser relevantes depois de se mudar. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
vers√£o </font><b><font style="vertical-align: inherit;">ROS</font></b><font style="vertical-align: inherit;"> com fluxos funcionou bem, mas eu comecei tudo isso para aprender algo, ent√£o por que n√£o ao mesmo tempo mestre</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ros</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ? </font><font style="vertical-align: inherit;">Eu escuto esse framework h√° muito tempo, e at√© tive que trabalhar um pouco com ele em um hackathon, ent√£o no final decidi reescrever todo o c√≥digo no ROS. </font><font style="vertical-align: inherit;">Esta vers√£o do c√≥digo est√° no ramo padr√£o do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ros</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e parece muito mais decente. </font><font style="vertical-align: inherit;">√â claro que a implementa√ß√£o no ROS quase certamente ser√° mais lenta que a implementa√ß√£o nos fluxos devido √† sobrecarga de envio de mensagens e tudo mais - a √∫nica quest√£o √© quanto?</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conceito ROS</font></font></b>
                        <div class="spoiler_text">ROS (Robot Operating System) ‚Äî     ,             ,   ,        .<br>
<br>
    ,  ,  ,     (node), ,    ,       .<br>
<br>
      (topic)      (message)  ,         -    . <br>
<br>
    ‚Äî   (service).         ,       ,     .      ¬´ ¬ª,    .<br>
<br>
         <code>.msg</code>  <code>.srv</code> .          .<br>
<br>
 ROS    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"> </a>.<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para o meu rob√¥, n√£o usei nenhum pacote pronto com algoritmos do ROS, apenas projetei o c√≥digo do rob√¥ em um pacote separado que consiste em cinco n√≥s se comunicando usando mensagens e servi√ßos ROS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O n√≥ mais simples </font></font><code>switch_node</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, monitora o estado do comutador. Assim que o comutador √© desligado, o n√≥ come√ßa a enviar mensagens n√£o informativas do tipo </font></font><code>bool</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no t√≥pico </font></font><code>terminator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Este √© um sinal para o n√≥ principal de que est√° na hora de concluir o trabalho. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O segundo n√≥ ,, </font></font><code>sensor_node</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l√™ periodicamente as leituras dos dois rangefinders de infravermelho e as envia para o t√≥pico em </font></font><code>sensor_state</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uma mensagem. Al√©m disso, este n√≥ √© respons√°vel pelo processamento do sinal: escala por fatores de calibra√ß√£o e m√©dia m√≥vel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terceiro n√≥</font></font><code>camera_node</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ele √© respons√°vel por tudo relacionado aos rostos: ele tira imagens da c√¢mera, processa-os, recebe os resultados do detector, passa-os pelo rastreador e encontra o rosto mais pr√≥ximo do centro do quadro - o rob√¥ n√£o usa o resto de qualquer maneira, mas voc√™ deseja fazer mensagens menores. As mensagens que o n√≥ envia para o t√≥pico </font></font><code>camera_state</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cont√™m o n√∫mero do quadro, o fato de ter uma face (porque voc√™ tamb√©m precisa saber sobre a aus√™ncia de uma face), as coordenadas relativas do canto superior esquerdo, a largura e a altura da face. √â assim que a descri√ß√£o do tipo de mensagem no arquivo se parece </font></font><code>DetectionBox.msg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">int64 count<font></font>
bool present<font></font>
float32 x<font></font>
float32 y<font></font>
float32 width<font></font>
float32 height<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O quarto n√≥ </font></font><code>servo_node</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© respons√°vel pelos servos. Em primeiro lugar, suporta um servi√ßo </font></font><code>servo_action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que permite que uma das a√ß√µes seja executada pelos servos por seu n√∫mero: colocar todo o n√≥ em seu estado inicial (sobrancelhas, banco, cabe√ßa, parar o chassi); transferir a cabe√ßa para seu estado inicial; agite o frasco; retrate com uma sobrancelha uma das tr√™s express√µes (boa, neutra, m√°). Em segundo lugar, usando o servi√ßo, </font></font><code>servo_speed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voc√™ pode definir novas velocidades para as duas rodas enviando-as na solicita√ß√£o. Ambos os servi√ßos n√£o retornam nada. Finalmente, existe um servi√ßo </font></font><code>servo_head_platform</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que permite girar a cabe√ßa e / ou o chassi em um determinado √¢ngulo em rela√ß√£o √† posi√ß√£o atual. Este servi√ßo retorna </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se for poss√≠vel girar a cabe√ßa pelo menos parcialmente e</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">caso contr√°rio, no caso em que a cabe√ßa j√° esteja na borda do √¢ngulo admiss√≠vel, e estamos tentando mov√™-la ainda mais. </font><font style="vertical-align: inherit;">Se os dois √¢ngulos da solicita√ß√£o forem diferentes de zero, o servi√ßo girar√° assincronamente, conforme indicado acima. </font><font style="vertical-align: inherit;">No loop principal, o n√≥ servo n√£o faz nada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui, por exemplo, est√° uma descri√ß√£o do servi√ßo </font></font><code>servo_head_platform</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">float32 head_delta<font></font>
float32 platform_delta<font></font>
---<font></font>
bool head_success<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada um dos n√≥s listados suporta um servi√ßo </font></font><code>terminate_{switch, camera, sensor, servo}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com uma solicita√ß√£o de resposta vazia, que interrompe a opera√ß√£o do n√≥. </font><font style="vertical-align: inherit;">√â implementado desta maneira:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algum c√≥digo</font></font></b>
                        <div class="spoiler_text"><pre><code class="cpp hljs">...
<span class="hljs-built_in">std</span>::<span class="hljs-keyword">atomic_bool</span> is_running; <span class="hljs-comment">// global</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">terminate_node</span><span class="hljs-params">(std_srvs::Empty::Request &amp;req, std_srvs::Empty::Response &amp;ignored)</span> </span>{<font></font>
    is_running = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span> </span>{<font></font>
    is_running = <span class="hljs-literal">true</span>;<font></font>
    ...<font></font>
    <span class="hljs-keyword">while</span> (is_running &amp;&amp; ros::ok()) {
        <span class="hljs-comment">// do stuff</span><font></font>
    }<font></font>
    ...<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O n√≥ possui uma vari√°vel global </font></font><code>is_running</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, cujo valor determina o ciclo principal do n√≥. O servi√ßo simplesmente redefine essa vari√°vel e o loop principal √© interrompido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° tamb√©m um n√≥ principal </font></font><code>beggar_bot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no qual a l√≥gica b√°sica do rob√¥ √© implementada. Antes do in√≠cio do loop principal, ele assina t√≥picos </font></font><code>sensor_state</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>camera_state</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">salva o conte√∫do de mensagens em vari√°veis ‚Äã‚Äãglobais em fun√ß√µes de retorno de chamada. Ele tamb√©m est√° inscrito no t√≥pico </font></font><code>terminator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, cujo retorno de chamada redefine o sinalizador </font></font><code>is_running</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, interrompendo o loop principal. Al√©m disso, antes do in√≠cio do ciclo, o n√≥ anuncia as interfaces para os servi√ßos do n√≥ servo e aguarda alguns segundos para que os outros n√≥s sejam inicializados. Depois que o loop principal termina, esse n√≥ chama os servi√ßos</font></font><code>terminate_{switch, camera, sensor, servo}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, desativando todos os outros n√≥s e, em seguida, desativando-o. Ou seja, quando o interruptor √© desligado, todos os cinco n√≥s concluem a opera√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mudar para o ROS me for√ßou a mudar bastante a estrutura do programa. Por exemplo, anteriormente era poss√≠vel alterar a velocidade da roda com alta frequ√™ncia, e isso funcionava bem, mas o servi√ßo ROS trabalha em uma ordem de magnitude mais lenta, ent√£o tive que reescrever o c√≥digo para que o servi√ßo fosse chamado apenas quando a velocidade realmente mudar (no "modo lento"). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O ROS tamb√©m permite executar comodamente todos os n√≥s do rob√¥. Para fazer isso, voc√™ precisa escrever </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">um arquivo de inicializa√ß√£o .launch</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> listando todos os n√≥s e outros atributos do rob√¥ no formato xml e, em seguida, execute o comando:</font></font><br>
<br>
<pre><code class="plaintext hljs">roslaunch beggar_bot robot.launch</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ROS x pthread</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Agora, finalmente, voc√™ pode comparar a velocidade da vers√£o ROS e da vers√£o pthread. </font><font style="vertical-align: inherit;">Eu fa√ßo da seguinte maneira: o thread / n√≥ respons√°vel por trabalhar com a c√¢mera considera seu FPS (como o elemento mais lento), desde que todo o resto tamb√©m funcione. </font><font style="vertical-align: inherit;">Para a vers√£o pthread, eu sempre obtive o FPS 9.99 ou mais; para a vers√£o ROS, ficou em torno de 8.3. </font><font style="vertical-align: inherit;">De fato, isso √© suficiente para um brinquedo assim, mas a sobrecarga √© bastante percept√≠vel.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comportamento do rob√¥</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A id√©ia √© bastante simples: se o rob√¥ v√™ uma pessoa, ele deve dirigir-se a ele e apertar a lata. Agitar a jarra √© bastante simples e divertido, mas primeiro voc√™ precisa chegar √† pessoa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existe uma fun√ß√£o </font></font><code>follow_face</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que, se houver uma face no quadro, gira o chassi e a cabe√ßa do rob√¥ em sua dire√ß√£o (somente a face mais pr√≥xima do centro √© levada em considera√ß√£o). Isso √© necess√°rio para que o rob√¥ mantenha sempre o curso de uma pessoa, se ela estiver na moldura, e tamb√©m olhe diretamente na cara quando ele sacode uma jarra. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A </font></font><code>camera_state</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mesma vari√°vel √© usada </font><font style="vertical-align: inherit;">para sincronizar esta fun√ß√£o com o t√≥pico </font><font style="vertical-align: inherit;">.</font></font><code>face_processed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, como na vers√£o com fluxos. A ideia √© a mesma - queremos processar dados apenas uma vez, porque o rob√¥ est√° em constante movimento. A fun√ß√£o primeiro espera at√© que o retorno de chamada do t√≥pico com as detec√ß√µes diminua o sinalizador de que o √∫ltimo quadro foi processado. Enquanto ela espera, ela liga constantemente </font></font><code>ros::spinOnce()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para receber novas mensagens (em geral, isso deve ser feito sempre que o programa espera novos dados). Se houver uma face no quadro, os √¢ngulos s√£o calculados, o que precisa girar a plataforma e a cabe√ßa - isso pode ser feito conhecendo as coordenadas relativas do centro da face e o campo de vis√£o da c√¢mera na horizontal e na vertical. Depois disso, voc√™ pode ligar para o servi√ßo </font></font><code>servo_head_platform</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e mover o rob√¥.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° um ponto sutil: as informa√ß√µes sobre a posi√ß√£o do rosto ficam atr√°s do movimento real do rosto e podem ficar atr√°s dos movimentos do pr√≥prio rob√¥. Portanto, o rob√¥ pode superestimar o √¢ngulo de rota√ß√£o, pelo que a cabe√ßa come√ßa a se mover para frente e para tr√°s com amplitude crescente. Para evitar isso, fa√ßo atrasos ap√≥s a movimenta√ß√£o (300 ms) e tamb√©m pulo um quadro ap√≥s a movimenta√ß√£o. Para a mesma finalidade, os √¢ngulos de rota√ß√£o do chassi e da cabe√ßa s√£o multiplicados por um fator de 0,8 (os componentes P do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">controlador PID</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fazem sentido </font><font style="vertical-align: inherit;">). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fun√ß√£o</font></font><code>follow_face</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retorna o status de uma pessoa. </font><font style="vertical-align: inherit;">Uma pessoa pode: estar ausente, estar perto o suficiente do centro, estar muito longe do rob√¥; </font><font style="vertical-align: inherit;">outra op√ß√£o - quando ligamos o rob√¥ e n√£o sabemos o que aconteceu com o rosto (no processo de busca); </font><font style="vertical-align: inherit;">ainda h√° um caso raro em que a cabe√ßa est√° na borda, e √© por isso que √© imposs√≠vel virar o rosto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma coisa bastante simples acontece no loop principal:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ligue </font></font><code>follow_face</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">at√© a pessoa ter um determinado status (qualquer um, exceto "no processo de pesquisa"). </font><font style="vertical-align: inherit;">No final desta etapa, o rob√¥ olhar√° diretamente para o rosto.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se o rosto for encontrado e estiver pr√≥ximo: </font></font><br>
 <ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agite a lata;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encontre o rosto novamente;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se o rosto estiver no lugar, fa√ßa uma boa express√£o com as sobrancelhas e agite o frasco novamente;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se o rosto desapareceu, fa√ßa uma express√£o de raiva com as sobrancelhas;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vire-se, v√° para o in√≠cio do ciclo.</font></font></li>
</ol><br>
 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se n√£o houver pessoa (ou estiver longe) - navegue pela sala:</font></font><br>
 <ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se houver longe de obst√°culos de ambos os lados, siga em frente (se o rosto foi encontrado, mas se mostrou muito distante, o rob√¥ ir√° para a pessoa);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se houver obst√°culos pr√≥ximos dos dois lados, fa√ßa uma curva aleat√≥ria no intervalo </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><mn>90</mn><mo>,</mo><mn>180</mn><mo stretchy=&quot;false&quot;>]</mo><mo>&amp;#x222A;</mo><mo stretchy=&quot;false&quot;>[</mo><mo>&amp;#x2212;</mo><mn>180</mn><mo>,</mo><mo>&amp;#x2212;</mo><mn>90</mn><mo stretchy=&quot;false&quot;>]</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="22.479ex" height="2.634ex" viewBox="0 -809.3 9678.3 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-5B" x="0" y="0"></use><g transform="translate(278,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-39"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-30" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-2C" x="1279" y="0"></use><g transform="translate(1724,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-38" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-30" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-5D" x="3226" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-222A" x="3726" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-5B" x="4616" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-2212" x="4895" y="0"></use><g transform="translate(5673,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-38" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-30" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-2C" x="7175" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-2212" x="7620" y="0"></use><g transform="translate(8398,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-39"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-30" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-5D" x="9399" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mn>90</mn><mo>,</mo><mn>180</mn><mo stretchy="false">]</mo><mo>‚à™</mo><mo stretchy="false">[</mo><mo>‚àí</mo><mn>180</mn><mo>,</mo><mo>‚àí</mo><mn>90</mn><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-3">[90, 180] \cup [-180, -90]</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se o obst√°culo estiver apenas de um lado, gire na dire√ß√£o oposta em um √¢ngulo aleat√≥rio </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><mn>0</mn><mo>,</mo><mn>90</mn><mo stretchy=&quot;false&quot;>]</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.815ex" height="2.634ex" viewBox="0 -809.3 2503.7 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-30" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-2C" x="779" y="0"></use><g transform="translate(1224,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-39"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-30" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-5D" x="2225" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mn>0</mn><mo>,</mo><mn>90</mn><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-4">[0, 90]</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se o movimento para a frente continuar por muito tempo (possivelmente travado), recue um pouco e fa√ßa uma curva aleat√≥ria no intervalo </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><mn>90</mn><mo>,</mo><mn>180</mn><mo stretchy=&quot;false&quot;>]</mo><mo>&amp;#x222A;</mo><mo stretchy=&quot;false&quot;>[</mo><mo>&amp;#x2212;</mo><mn>180</mn><mo>,</mo><mo>&amp;#x2212;</mo><mn>90</mn><mo stretchy=&quot;false&quot;>]</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="22.479ex" height="2.634ex" viewBox="0 -809.3 9678.3 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-5B" x="0" y="0"></use><g transform="translate(278,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-39"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-30" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-2C" x="1279" y="0"></use><g transform="translate(1724,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-38" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-30" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-5D" x="3226" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-222A" x="3726" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-5B" x="4616" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-2212" x="4895" y="0"></use><g transform="translate(5673,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-38" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-30" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-2C" x="7175" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-2212" x="7620" y="0"></use><g transform="translate(8398,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-39"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-30" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhjfs-2U697WckjEf7LamT4qsfS9cA#MJMAIN-5D" x="9399" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mn>90</mn><mo>,</mo><mn>180</mn><mo stretchy="false">]</mo><mo>‚à™</mo><mo stretchy="false">[</mo><mo>‚àí</mo><mn>180</mn><mo>,</mo><mo>‚àí</mo><mn>90</mn><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-5">[90, 180] \cup [-180, -90]</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></li>
</ol><br>
 </li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse algoritmo n√£o afirma ser uma forte intelig√™ncia artificial; no entanto, o comportamento aleat√≥rio e um amplo amortecedor permitem que o rob√¥ saia de quase qualquer posi√ß√£o mais cedo ou mais tarde.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apesar de sua aparente simplicidade, este projeto abrange muitos t√≥picos n√£o triviais: trabalho com sensores anal√≥gicos, trabalho com PWM, vis√£o computacional, coordena√ß√£o de tarefas ass√≠ncronas. </font><font style="vertical-align: inherit;">Al√©m disso, √© incrivelmente divertido. </font><font style="vertical-align: inherit;">Provavelmente, al√©m disso, farei algo mais significativo, mas mais com um vi√©s no aprendizado profundo. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como um b√¥nus - a galeria:</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/el/cw/jd/elcwjdoa21liogjvhakstzg-yru.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/il/12/fp/il12fpucbbreblnwyb2ojwsfmwu.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/3w/kr/7m/3wkr7mfjqjo2b_f9kvekia82ztq.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/z4/3q/wr/z43qwrmlfgwndbi3dw-jnvxzqew.jpeg"></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt500140/index.html">"At√© 10 mil": mais de 25 avalia√ß√µes de fones de ouvido</a></li>
<li><a href="../pt500142/index.html">Gerenciar direitos no n√≠vel da instala√ß√£o</a></li>
<li><a href="../pt500144/index.html">David O'Brien (Xirus): M√©tricas! M√©tricas! M√©tricas! Parte 1</a></li>
<li><a href="../pt500146/index.html">Procura de emprego na Alemanha como gerente de produtos e muito mais. Parte 3/5. O que voc√™ precisa fazer antes de come√ßar a enviar curr√≠culos</a></li>
<li><a href="../pt500148/index.html">Filtro de firewall Mikrotik: script gerando a base para uma pol√≠tica de filtragem</a></li>
<li><a href="../pt500152/index.html">Como integrei o terminal POS e o FR IKKM-Touch em 1C: empresa</a></li>
<li><a href="../pt500154/index.html">Aprendizado de m√°quina confidencial. Biblioteca PySyft</a></li>
<li><a href="../pt500158/index.html">Intera√ß√£o SwiftUI com Redux</a></li>
<li><a href="../pt500160/index.html">Elementos visuais</a></li>
<li><a href="../pt500162/index.html">Tutorial sobre processamento de dados esportivos em python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>