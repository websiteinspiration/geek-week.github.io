<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥅 🧝🏽 🌨️ iOS 13上的合成布局。基础 ‼️ 👲🏻 🔗</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="下午好，
 

在实践中，iOS开发常常面临一个列表或者作为一个集合的形式显示大量信息的任务;作为一项规则，他们是伟大的这UITableView两种UICollectionView。还经常遇到实现屏幕的任务，该屏幕是列表和集合的组合。
 

在本文中，我们将考虑iOS 13带来了哪些新功能来实现此任...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>iOS 13上的合成布局。基础</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495076/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下午好，</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在实践中，iOS开发常常面临一个列表或者作为一个集合的形式显示大量信息的任务;作为一项规则，他们是伟大的这</font></font><code>UITableView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">两种</font></font><code>UICollectionView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">还经常遇到实现屏幕的任务，该屏幕是列表和集合的组合。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本文中，我们将考虑</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iOS 13</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带来</font><font style="vertical-align: inherit;">了</font><font style="vertical-align: inherit;">哪些新功能</font><font style="vertical-align: inherit;">来实现此任务。</font></font></p><br>
<p><img src="https://habrastorage.org/webt/v3/ko/id/v3koidieod2tld3tki2h0f2wc6k.png"></p><a name="habracut"></a><br>
<h2 id="vvedenie"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></h2><br>
<p>     ,        ,   ,     ,     <em>AppStore</em>.</p><br>
<p><img src="https://habrastorage.org/webt/wt/yb/dw/wtybdwnr4zslldx8gql3dukj7iy.gif"></p><br>
<p>    ? </p><br>
<p> iOS 13,       </p><br>
<ul>
<li>,      </li>
<li>,       </li>
<li>,    </li>
<li>   <code>UIScrollView</code> </li>
</ul><br>
<p>     .</p><br>
<ul>
<li>    </li>
<li>   </li>
<li>  </li>
<li>   <code>self-sizing</code> </li>
<li>    iPad  iPhone</li>
<li>     </li>
</ul><br>
<p>         iOS 12.</p><br>
<h3 id="compositional-layout">Compositional Layout</h3><br>
<p> iOS 13 Apple       ,        — <strong>Compositional Layout</strong>,     3-  — <em></em>, <em></em>  <em></em>.</p><br>
<p>    — <em></em>,        , <em></em> ,        ,       <em></em>,     ,      ,     .</p><br>
<p><img src="https://habrastorage.org/webt/v3/ko/id/v3koidieod2tld3tki2h0f2wc6k.png"></p><br>
<p><strong>Compositional Layout</strong> —   ,        ,      .</p><br>
<p>      </p><br>
<ul>
<li><strong>    </strong></li>
<li><strong>    </strong></li>
<li><strong>   </strong></li>
</ul><br>
<p><strong>    </strong> — ,          ,       -       .      ,      .</p><br>
<p><strong>    </strong> —  grid-,   flow-   ,      .</p><br>
<p><strong>   </strong> —    ,     ,    .</p><br>
<p>    <strong>Compositional Layout</strong>.       4 :</p><br>
<ul>
<li><strong><code>NSCollectionLayoutSize</code></strong> —   ;</li>
<li><strong><code>NSCollectionLayoutItem</code></strong> —   ;</li>
<li><strong><code>NSCollectionLayoutGroup</code></strong> —    ,       ;</li>
<li><strong><code>NSCollectionLayoutSection</code></strong> —      ;</li>
<li><strong><code>UICollectionViewCompositionalLayout</code></strong> —   .</li>
</ul><br>
<p>   <code>UICollectionViewCompositionalLayout</code>.</p><br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UICollectionViewCompositionalLayout</span> : <span class="hljs-title">UICollectionViewLayout</span> </span>{ ... }</code></pre><br>
<p>   <code>UICollectionViewCompositionalLayout</code>   <code>UICollectionViewLayout</code>,       <code>UICollectionView</code>.</p><br>
<h3 id="list-layout">List Layout</h3><br>
<p>      .     storyboard-,   <code>UIViewController</code>,   <code>viewDidLoad()</code>   <code>UICollectionView</code>    <code>init(frame:, layout:)</code>    <strong><code>UICollectionViewCompositionalLayout</code></strong>.          ,       <code>UICollectionViewCompositionalLayout</code>.</p><br>
<p>  ,   .      ,   ,   ,   . </p><br>
<p><img src="https://habrastorage.org/webt/7e/jk/r9/7ejkr9pjvxbr2i-z6ckqh3h2hu8.png"></p><br>
<p>    .</p><br>
<pre><code class="swift hljs">    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createLayout</span><span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">UICollectionViewLayout</span> {
        <span class="hljs-keyword">let</span> itemSize = <span class="hljs-type">NSCollectionLayoutSize</span>(<font></font>
            widthDimension: .fractionalWidth(<span class="hljs-number">1.0</span>),<font></font>
            heightDimension: .fractionalHeight(<span class="hljs-number">1.0</span>))
        <span class="hljs-keyword">let</span> item = <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)<font></font>
<font></font>
        <span class="hljs-keyword">let</span> groupSize = <span class="hljs-type">NSCollectionLayoutSize</span>(<font></font>
            widthDimension: .fractionalWidth(<span class="hljs-number">1.0</span>),<font></font>
            heightDimension: .absolute(<span class="hljs-number">44</span>))
        <span class="hljs-keyword">let</span> group = <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitems: [item])<font></font>
<font></font>
        <span class="hljs-keyword">let</span> section = <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)<font></font>
<font></font>
        <span class="hljs-keyword">let</span> layout = <span class="hljs-type">UICollectionViewCompositionalLayout</span>(section: section)
        <span class="hljs-keyword">return</span> layout<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">configureHierarchy</span><span class="hljs-params">()</span></span> {<font></font>
        collectionView = <span class="hljs-type">UICollectionView</span>(frame: view.bounds, collectionViewLayout: createLayout())
        <span class="hljs-comment">// ...</span>
    }</code></pre><br>
<p> <code>itemSize</code>     ,        ,      <strong><code>NSCollectionLayoutDimension</code></strong>.        . </p><br>
<ul>
<li><strong><code>fractionalWidth(_:)</code></strong>,  ,    0  1 ,     , <code>0.5</code> —      () ;</li>
<li><strong><code>fractionalHeight(_: )</code></strong>,  ,    0  1 ,     , <code>0.5</code> —      () ;</li>
<li><strong><code>absolute(_: )</code></strong>,  ,   ,  <code>44.0</code>;</li>
<li><strong><code>estimated(_:)</code></strong>,  ,       .</li>
</ul><br>
<p>   <code>itemSize</code>   <code>widthDimension = .fractionalWidth(1.0)</code>, <code>heightDimension = .fractionalHeight(1.0)</code>,            ,    .            .</p><br>
<p>       , <code>widthDimension: .fractionalWidth(1.0), heightDimension: .absolute(44)</code>,        ,    ,       <code>44.0</code>.</p><br>
<p>     :</p><br>
<ul>
<li><strong><code>horizontal(layoutSize: , subitem: , count: )</code></strong>,  ,          ;</li>
<li><strong><code>horizontal(layoutSize:, subitems: )</code></strong>,  ,       ,      ;</li>
<li><strong><code>vertical(layoutSize:, subitem:, count:)</code></strong>,  ,          ;</li>
<li><strong><code>vertical(layoutSize:, subitems: )</code></strong>,  ,       ,      ;</li>
<li><strong><code>custom(layoutSize:, itemProvider: )</code></strong>,   ,      .</li>
</ul><br>
<p>   , <code>.horizontal</code>  <code>.vertical</code>   ,    ,    , <code>.custom</code>     ,    ,     .</p><br>
<p>    <code>NSCollectionLayoutGroup.horizontal(layoutSize: groupSize, subitems: [item])</code>   ,          ,   .</p><br>
<p>    NSCollectionLayoutSection(group: group),      .          <code>Compositional Layout</code>.</p><br>
<p> ,       ,   .     ?</p><br>
<h3 id="grid-layout">Grid Layout</h3><br>
<p><img src="https://habrastorage.org/webt/rj/tp/0e/rjtp0ecy-d-dp-1sjwsfrngzijy.png"></p><br>
<p> ,     ?     ,           ,        ,    . </p><br>
<pre><code class="swift hljs"><span class="hljs-keyword">let</span> itemSize = <span class="hljs-type">NSCollectionLayoutSize</span>(<font></font>
            widthDimension: .fractionalWidth(<span class="hljs-number">1.0</span>/<span class="hljs-number">4.0</span>), <span class="hljs-comment">// &lt;---</span>
            heightDimension: .fractionalHeight(<span class="hljs-number">1.0</span>))</code></pre><br>
<p>,      4     ,     .</p><br>
<p><img src="https://habrastorage.org/webt/qb/r_/6n/qbr_6ndntgy1mbhirtidwcm_bhc.png"></p><br>
<h3 id="two-column-layout">Two Column Layout</h3><br>
<p>  ,       ,       ,          ,   ,    <code>widthDimension</code>  .</p><br>
<p><img src="https://habrastorage.org/webt/mc/gj/vg/mcgjvgnlhj1p9e6b6nj9xf8xtvm.png"></p><br>
<p>    .</p><br>
<pre><code class="swift hljs">    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createLayout</span><span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">UICollectionViewLayout</span> {
        <span class="hljs-keyword">let</span> spacing: <span class="hljs-type">CGFloat</span> = <span class="hljs-number">10</span>
        <span class="hljs-keyword">let</span> itemSize = <span class="hljs-type">NSCollectionLayoutSize</span>(<font></font>
            widthDimension: .fractionalWidth(<span class="hljs-number">1.0</span>),<font></font>
            heightDimension: .fractionalHeight(<span class="hljs-number">1.0</span>))
        <span class="hljs-keyword">let</span> item = <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)<font></font>
<font></font>
        <span class="hljs-keyword">let</span> groupSize = <span class="hljs-type">NSCollectionLayoutSize</span>(<font></font>
            widthDimension: .fractionalWidth(<span class="hljs-number">1.0</span>),<font></font>
            heightDimension: .absolute(<span class="hljs-number">44</span>))
        <span class="hljs-keyword">let</span> group = <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitem: item, <span class="hljs-built_in">count</span>: <span class="hljs-number">2</span>) <span class="hljs-comment">// &lt;---</span><font></font>
        group.interItemSpacing = .fixed(spacing)<font></font>
<font></font>
        <span class="hljs-keyword">let</span> section = <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)<font></font>
        section.contentInsets = .<span class="hljs-keyword">init</span>(top: spacing, leading: spacing, bottom: spacing, trailing: spacing)<font></font>
        section.interGroupSpacing = spacing<font></font>
<font></font>
        <span class="hljs-keyword">let</span> layout = <span class="hljs-type">UICollectionViewCompositionalLayout</span>(section: section)
        <span class="hljs-keyword">return</span> layout<font></font>
    }</code></pre><br>
<p>         <code>group.interItemSpacing = .fixed(spacing)</code>,      <code>section.interGroupSpacing = spacing</code>,     <code>contentInset</code>   <code>section.contentInsets = .init(top: spacing, leading: spacing, bottom: spacing, trailing: spacing)</code>.          <code>spacing</code>.</p><br>
<p>   ,      <code>interItemSpacing</code>      ,       <code>interGroupSpacing</code>,     <code>NSCollectionLayoutSpacing</code>.</p><br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NSCollectionLayoutSpacing</span> : <span class="hljs-title">NSObject</span>, <span class="hljs-title">NSCopying</span> </span>{
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">func</span> <span class="hljs-title">fixed</span>(<span class="hljs-title">_</span> <span class="hljs-title">fixedSpacing</span>: <span class="hljs-title">CGFloat</span>) -&gt; <span class="hljs-title">Self</span> // <span class="hljs-title">i</span>.<span class="hljs-title">e</span>. ==
    <span class="hljs-title">class</span> <span class="hljs-title">func</span> <span class="hljs-title">flexible</span>(<span class="hljs-title">_</span> <span class="hljs-title">flexibleSpacing</span>: <span class="hljs-title">CGFloat</span>) -&gt; <span class="hljs-title">Self</span> // <span class="hljs-title">i</span>.<span class="hljs-title">e</span>. &gt;=
    // ...
}</span></code></pre><br>
<ul>
<li><strong><code>func fixed(_ fixedSpacing: )</code></strong>,     ;</li>
<li><strong><code>func flexible(_ flexibleSpacing:)</code></strong>,      ,    ,      ;</li>
</ul><br>
<h3 id="inset-items-grid-layout">Inset Items Grid Layout</h3><br>
<p>  ,    ,   ?   ,      ,      . ,    5 ,   ,      1.0/5.0   ,      .         ,    1.0/5.0  .        ,       .<br>
  ,    <code>.contentInsets</code>   <code>NSCollectionLayoutItem</code>.</p><br>
<p><img src="https://habrastorage.org/webt/y7/gs/gj/y7gsgjqcyst2_2rlfwhd_3n77i8.png"></p><br>
<p>    .</p><br>
<pre><code class="swift hljs">    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createLayout</span><span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">UICollectionViewLayout</span> {
        <span class="hljs-keyword">let</span> spacing: <span class="hljs-type">CGFloat</span> = <span class="hljs-number">10</span>
        <span class="hljs-keyword">let</span> itemSize = <span class="hljs-type">NSCollectionLayoutSize</span>(<font></font>
            widthDimension: .fractionalWidth(<span class="hljs-number">0.2</span>),<font></font>
            heightDimension: .fractionalHeight(<span class="hljs-number">1.0</span>))
        <span class="hljs-keyword">let</span> item = <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)<font></font>
        item.contentInsets = .<span class="hljs-keyword">init</span>(top: spacing, leading: spacing, bottom: spacing, trailing: spacing)<font></font>
<font></font>
        <span class="hljs-keyword">let</span> groupSize = <span class="hljs-type">NSCollectionLayoutSize</span>(<font></font>
            widthDimension: .fractionalWidth(<span class="hljs-number">1.0</span>),<font></font>
            heightDimension: .fractionalWidth(<span class="hljs-number">0.2</span>))
        <span class="hljs-keyword">let</span> group = <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitems: [item])<font></font>
<font></font>
        <span class="hljs-keyword">let</span> section = <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)
        <span class="hljs-keyword">let</span> layout = <span class="hljs-type">UICollectionViewCompositionalLayout</span>(section: section)
        <span class="hljs-keyword">return</span> layout<font></font>
    }</code></pre><br>
<h3 id="distinct-sections-layout">Distinct Sections Layout</h3><br>
<p>         ,             .</p><br>
<p>      <code>UICollectionViewCompositionalLayout</code>  ,           <code>UICollectionViewCompositionalLayoutSectionProvider</code>. </p><br>
<pre><code class="swift hljs"><span class="hljs-keyword">typealias</span> <span class="hljs-type">UICollectionViewCompositionalLayoutSectionProvider</span> = (<span class="hljs-type">Int</span>, <span class="hljs-type">NSCollectionLayoutEnvironment</span>) -&gt; <span class="hljs-type">NSCollectionLayoutSection?</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UICollectionViewCompositionalLayout</span> : <span class="hljs-title">UICollectionViewLayout</span> </span>{
   <span class="hljs-keyword">init</span>(section: <span class="hljs-type">NSCollectionLayoutSection</span>)
   <span class="hljs-keyword">init</span>(sectionProvider: @escaping <span class="hljs-type">UICollectionViewCompositionalLayoutSectionProvider</span>)
   <span class="hljs-comment">// ...</span>
}</code></pre><br>
<p><code>UICollectionViewCompositionalLayoutSectionProvider</code>  2 ,    ,  ,       .</p><br>
<p>  3 ,        ,     grid-  3- ,       grid-,   5- .</p><br>
<p><img src="https://habrastorage.org/webt/km/dz/49/kmdz49rcuj9x8h4nlnyiy4xa8z4.png"></p><br>
<p>    .</p><br>
<pre><code class="swift hljs">    <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">Section</span>: <span class="hljs-title">Int</span>, <span class="hljs-title">CaseIterable</span> </span>{
        <span class="hljs-keyword">case</span> list
        <span class="hljs-keyword">case</span> grid3
        <span class="hljs-keyword">case</span> grid5<font></font>
<font></font>
        <span class="hljs-keyword">var</span> columnCount: <span class="hljs-type">Int</span> {
            <span class="hljs-keyword">switch</span> <span class="hljs-keyword">self</span> {
            <span class="hljs-keyword">case</span> .list:
                <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>
            <span class="hljs-keyword">case</span> .grid3:
                <span class="hljs-keyword">return</span> <span class="hljs-number">3</span>
            <span class="hljs-keyword">case</span> .grid5:
                <span class="hljs-keyword">return</span> <span class="hljs-number">5</span><font></font>
            }<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createLayout</span><span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">UICollectionViewLayout</span> {
        <span class="hljs-keyword">let</span> layout = <span class="hljs-type">UICollectionViewCompositionalLayout</span> { (sectionIndex, layoutEnvironment) -&gt; <span class="hljs-type">NSCollectionLayoutSection?</span> <span class="hljs-keyword">in</span><font></font>
<font></font>
            <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> sectionKind = <span class="hljs-type">Section</span>(rawValue: sectionIndex) <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span> }
            <span class="hljs-keyword">let</span> columns = sectionKind.columnCount<font></font>
<font></font>
            <span class="hljs-keyword">let</span> itemSize = <span class="hljs-type">NSCollectionLayoutSize</span>(<font></font>
                widthDimension: .fractionalWidth(<span class="hljs-number">1.0</span>),<font></font>
                heightDimension: .fractionalHeight(<span class="hljs-number">1.0</span>))
            <span class="hljs-keyword">let</span> item = <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)<font></font>
            item.contentInsets = .<span class="hljs-keyword">init</span>(top: <span class="hljs-number">2</span>, leading: <span class="hljs-number">2</span>, bottom: <span class="hljs-number">2</span>, trailing: <span class="hljs-number">2</span>)<font></font>
<font></font>
            <span class="hljs-keyword">let</span> groupHeight = columns == <span class="hljs-number">1</span> ?
                <span class="hljs-type">NSCollectionLayoutDimension</span>.absolute(<span class="hljs-number">44</span>) :
                <span class="hljs-type">NSCollectionLayoutDimension</span>.fractionalWidth(<span class="hljs-number">0.2</span>)<font></font>
<font></font>
            <span class="hljs-keyword">let</span> groupSize = <span class="hljs-type">NSCollectionLayoutSize</span>(<font></font>
                widthDimension: .fractionalWidth(<span class="hljs-number">1.0</span>),<font></font>
                heightDimension: groupHeight)<font></font>
            <span class="hljs-keyword">let</span> group = <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitem: item, <span class="hljs-built_in">count</span>: columns)<font></font>
<font></font>
            <span class="hljs-keyword">let</span> section = <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)<font></font>
            section.contentInsets = .<span class="hljs-keyword">init</span>(top: <span class="hljs-number">20</span>, leading: <span class="hljs-number">20</span>, bottom: <span class="hljs-number">20</span>, trailing: <span class="hljs-number">20</span>)
            <span class="hljs-keyword">return</span> section<font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> layout<font></font>
    }<font></font>
<span class="hljs-comment">// ...</span></code></pre><br>
<h3 id="adaptive-sections-layout">Adaptive Sections Layout</h3><br>
<p>        ,       <code>NSCollectionLayoutEnvironment</code> ,      <code>traitCollection</code>.</p><br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">NSCollectionLayoutEnvironment</span> : <span class="hljs-title">NSObjectProtocol</span> </span>{
    <span class="hljs-keyword">var</span> container: <span class="hljs-type">NSCollectionLayoutContainer</span> { <span class="hljs-keyword">get</span> }
    <span class="hljs-keyword">var</span> traitCollection: <span class="hljs-type">UITraitCollection</span> { <span class="hljs-keyword">get</span> }<font></font>
}</code></pre><br>
<p>    <em>ompact</em> size-class  ,     ,       ,    ,     . </p><br>
<p>   <code>traitCollection.verticalSizeClass</code>  <code>layoutEnvironment</code>      .</p><br>
<p>       <code>container.effectiveContentSize</code>  <code>layoutEnvironment</code>       .</p><br>
<p><img src="https://habrastorage.org/webt/gm/e5/n_/gme5n_kxueln1vmgtazm3u-g2gg.png"></p><br>
<p>        .</p><br>
<p><img src="https://habrastorage.org/webt/my/m5/6w/mym56wfknv-tek6_s9igi6ico3a.png"></p><br>
<p>    .</p><br>
<pre><code class="swift hljs">    <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">Section</span>: <span class="hljs-title">Int</span>, <span class="hljs-title">CaseIterable</span> </span>{
        <span class="hljs-keyword">case</span> list
        <span class="hljs-keyword">case</span> grid3
        <span class="hljs-keyword">case</span> grid5<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">columnCount</span><span class="hljs-params">(<span class="hljs-keyword">for</span> width: CGFloat)</span></span> -&gt; <span class="hljs-type">Int</span> {
            <span class="hljs-keyword">let</span> wideMode = width &gt; <span class="hljs-number">800</span>
            <span class="hljs-keyword">switch</span> <span class="hljs-keyword">self</span> {
            <span class="hljs-keyword">case</span> .list:
                <span class="hljs-keyword">return</span> wideMode ? <span class="hljs-number">2</span> : <span class="hljs-number">1</span>
            <span class="hljs-keyword">case</span> .grid3:
                <span class="hljs-keyword">return</span> wideMode ? <span class="hljs-number">6</span> : <span class="hljs-number">3</span>
            <span class="hljs-keyword">case</span> .grid5:
                <span class="hljs-keyword">return</span> wideMode ? <span class="hljs-number">10</span> : <span class="hljs-number">5</span><font></font>
            }<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createLayout</span><span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">UICollectionViewLayout</span> {
        <span class="hljs-keyword">let</span> layout = <span class="hljs-type">UICollectionViewCompositionalLayout</span> { (sectionIndex, layoutEnvironment) -&gt; <span class="hljs-type">NSCollectionLayoutSection?</span> <span class="hljs-keyword">in</span><font></font>
<font></font>
            <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> sectionKind = <span class="hljs-type">Section</span>(rawValue: sectionIndex) <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span> }
            <span class="hljs-keyword">let</span> columns = sectionKind.columnCount(<span class="hljs-keyword">for</span>: layoutEnvironment.container.effectiveContentSize.width)<font></font>
<font></font>
            <span class="hljs-keyword">let</span> itemSize = <span class="hljs-type">NSCollectionLayoutSize</span>(<font></font>
                widthDimension: .fractionalWidth(<span class="hljs-number">1.0</span>),<font></font>
                heightDimension: .fractionalHeight(<span class="hljs-number">1.0</span>))
            <span class="hljs-keyword">let</span> item = <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)<font></font>
            item.contentInsets = .<span class="hljs-keyword">init</span>(top: <span class="hljs-number">2</span>, leading: <span class="hljs-number">2</span>, bottom: <span class="hljs-number">2</span>, trailing: <span class="hljs-number">2</span>)<font></font>
<font></font>
            <span class="hljs-keyword">let</span> groupHeight = layoutEnvironment.traitCollection.verticalSizeClass == .compact ?
                <span class="hljs-type">NSCollectionLayoutDimension</span>.absolute(<span class="hljs-number">44</span>) :
                <span class="hljs-type">NSCollectionLayoutDimension</span>.fractionalWidth(<span class="hljs-number">0.2</span>)<font></font>
<font></font>
            <span class="hljs-keyword">let</span> groupSize = <span class="hljs-type">NSCollectionLayoutSize</span>(<font></font>
                widthDimension: .fractionalWidth(<span class="hljs-number">1.0</span>),<font></font>
                heightDimension: groupHeight)<font></font>
            <span class="hljs-keyword">let</span> group = <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitem: item, <span class="hljs-built_in">count</span>: columns)<font></font>
<font></font>
            <span class="hljs-keyword">let</span> section = <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)<font></font>
            section.contentInsets = .<span class="hljs-keyword">init</span>(top: <span class="hljs-number">20</span>, leading: <span class="hljs-number">20</span>, bottom: <span class="hljs-number">20</span>, trailing: <span class="hljs-number">20</span>)
            <span class="hljs-keyword">return</span> section<font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> layout<font></font>
    }<font></font>
<font></font>
<span class="hljs-comment">// ...</span></code></pre><br>
<h3 id="nested-groups">Nested Groups</h3><br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NSCollectionLayoutGroup</span> : <span class="hljs-title">NSCollectionLayoutItem</span>, <span class="hljs-title">NSCopying</span> </span>{ ... }</code></pre><br>
<p>     <code>NSCollectionLayoutGroup</code>,   ,     <code>NSCollectionLayoutItem</code>,    ,      ,         . </p><br>
<p><img src="https://habrastorage.org/webt/eb/w2/0o/ebw20oxbfq-d_htnngu2dcyls_k.png"></p><br>
<p>    .</p><br>
<pre><code class="swift hljs">    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createLayout</span><span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">UICollectionViewLayout</span> {
        <span class="hljs-keyword">let</span> layout = <span class="hljs-type">UICollectionViewCompositionalLayout</span> {<font></font>
            (sectionIndex: <span class="hljs-type">Int</span>, layoutEnvironment: <span class="hljs-type">NSCollectionLayoutEnvironment</span>) -&gt; <span class="hljs-type">NSCollectionLayoutSection?</span> <span class="hljs-keyword">in</span><font></font>
<font></font>
            <span class="hljs-keyword">let</span> leadingItem = <span class="hljs-type">NSCollectionLayoutItem</span>(<font></font>
                layoutSize: <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">0.7</span>),<font></font>
                                                   heightDimension: .fractionalHeight(<span class="hljs-number">1.0</span>)))<font></font>
            leadingItem.contentInsets = <span class="hljs-type">NSDirectionalEdgeInsets</span>(top: <span class="hljs-number">10</span>, leading: <span class="hljs-number">10</span>, bottom: <span class="hljs-number">10</span>, trailing: <span class="hljs-number">10</span>)<font></font>
<font></font>
            <span class="hljs-keyword">let</span> trailingItem = <span class="hljs-type">NSCollectionLayoutItem</span>(<font></font>
                layoutSize: <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1.0</span>),<font></font>
                                                   heightDimension: .fractionalHeight(<span class="hljs-number">0.3</span>)))<font></font>
            trailingItem.contentInsets = <span class="hljs-type">NSDirectionalEdgeInsets</span>(top: <span class="hljs-number">10</span>, leading: <span class="hljs-number">10</span>, bottom: <span class="hljs-number">10</span>, trailing: <span class="hljs-number">10</span>)
            <span class="hljs-keyword">let</span> trailingGroup = <span class="hljs-type">NSCollectionLayoutGroup</span>.vertical(<font></font>
                layoutSize: <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">0.3</span>),<font></font>
                                                   heightDimension: .fractionalHeight(<span class="hljs-number">1.0</span>)),<font></font>
                subitem: trailingItem, <span class="hljs-built_in">count</span>: <span class="hljs-number">2</span>)<font></font>
<font></font>
            <span class="hljs-keyword">let</span> bottomNestedGroup = <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(<font></font>
                layoutSize: <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1.0</span>),<font></font>
                                                   heightDimension: .fractionalHeight(<span class="hljs-number">0.6</span>)),<font></font>
                subitems: [leadingItem, trailingGroup])<font></font>
<font></font>
            <span class="hljs-keyword">let</span> topItem = <span class="hljs-type">NSCollectionLayoutItem</span>(<font></font>
                layoutSize: <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1.0</span>),<font></font>
                                               heightDimension: .fractionalHeight(<span class="hljs-number">0.3</span>)))<font></font>
            topItem.contentInsets = <span class="hljs-type">NSDirectionalEdgeInsets</span>(top: <span class="hljs-number">10</span>, leading: <span class="hljs-number">10</span>, bottom: <span class="hljs-number">10</span>, trailing: <span class="hljs-number">10</span>)<font></font>
<font></font>
            <span class="hljs-keyword">let</span> nestedGroup = <span class="hljs-type">NSCollectionLayoutGroup</span>.vertical(<font></font>
                layoutSize: <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1.0</span>),<font></font>
                                                   heightDimension: .fractionalHeight(<span class="hljs-number">0.4</span>)),<font></font>
                subitems: [topItem, bottomNestedGroup])<font></font>
            <span class="hljs-keyword">let</span> section = <span class="hljs-type">NSCollectionLayoutSection</span>(group: nestedGroup)
            <span class="hljs-keyword">return</span> section<font></font>
<font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> layout<font></font>
    }</code></pre><br>
<h3 id="nested-groups-scrolling">Nested Groups Scrolling</h3><br>
<p>    ? !  ,    ,      .</p><br>
<pre><code class="swift hljs"><span class="hljs-comment">// ...</span><font></font>
section.orthogonalScrollingBehavior = .continuous<font></font>
<span class="hljs-comment">// ...</span></code></pre><br>
<p><img src="https://habrastorage.org/webt/po/jm/ni/pojmnitfpx3rpmjfirtpi6er4gu.gif"></p><br>
<h2 id="zaklyuchenie"></h2><br>
<p>iOS 13       <code>UICollectionView</code>,   <strong>Compositional Layout</strong>         .<br>
            .         .</p><br>
<h2 id="ssylki">:</h2><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">https://github.com/TikhonovAlexander/Collection-View-Layout-iOS13</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Apple: UICollectionViewCompositionalLayout</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">WWDC 2019: Advances in Collection View Layout</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Apple's sample: Using Collection View Compositional Layouts and Diffable Data Sources</a></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN495036/index.html">Flask上的一个简单Telegram机器人，提供天气报告</a></li>
<li><a href="../zh-CN495038/index.html">融合设计</a></li>
<li><a href="../zh-CN495042/index.html">＃01-整个字节不足... | 什么是简介？</a></li>
<li><a href="../zh-CN495068/index.html">OpenGL RAII风格的原语</a></li>
<li><a href="../zh-CN495072/index.html">移动设备上的家庭办公室：使用Samsung DeX</a></li>
<li><a href="../zh-CN495078/index.html">我们如何使用itracker进行定量实验</a></li>
<li><a href="../zh-CN495080/index.html">经验丰富的技术总监的故事</a></li>
<li><a href="../zh-CN495082/index.html">零信任信息</a></li>
<li><a href="../zh-CN495086/index.html">2020年4月HR和IT招聘人员的事件摘要</a></li>
<li><a href="../zh-CN495090/index.html">40年来分析高能物理中的大量数据：Rene Bran访谈</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>