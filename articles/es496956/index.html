<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔧 🐁 🔶 ¿Por qué aparecieron los servidores web asíncronos? 👩🏽‍🏫 🕴🏿 👼🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos. En contacto Vladislav Rodin. Actualmente, soy el jefe del curso High Load Architect en OTUS, y también doy cursos sobre arquitectura de ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>¿Por qué aparecieron los servidores web asíncronos?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/496956/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hola a todos. </font><font style="vertical-align: inherit;">En contacto Vladislav Rodin. </font><font style="vertical-align: inherit;">Actualmente, soy el jefe del curso High Load Architect en OTUS, y también doy cursos sobre arquitectura de software. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Además de la enseñanza, como puede ver, he estado escribiendo para un material de copyright del blog OTUS Habré y el artículo de hoy quiero coincidir con el inicio del curso </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«Administrador de Linux"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que ahora está abierto.</font></font></b></i><br>
<br>
<img src="https://habrastorage.org/webt/mq/fl/9f/mqfl9f73j0kklcb2wikqonkd4rk.png"><br>
<hr><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introducción</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¿Por qué la aplicación web se ralentiza y no retiene la carga? </font><font style="vertical-align: inherit;">Los desarrolladores, que fueron los primeros en encontrar esa pregunta y realizaron investigaciones en algunos sistemas, llegaron a la decepcionante conclusión de que optimizar una lógica de negocios por sí sola no sería suficiente. </font><font style="vertical-align: inherit;">La respuesta a esta pregunta se encuentra en un nivel inferior, en el nivel del sistema operativo. </font><font style="vertical-align: inherit;">Para que su aplicación sostenga la carga, es necesario revisar su concepto arquitectónico de tal manera que funcione efectivamente a este nivel. </font><font style="vertical-align: inherit;">Esto condujo a la aparición de servidores web asincrónicos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desafortunadamente, no pude encontrar un solo material que me permita restaurar todas las relaciones causa-efecto en la evolución de los servidores web a la vez. </font><font style="vertical-align: inherit;">Entonces surgió la idea de escribir este artículo, que, espero, se convertirá en tal material.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Características del sistema operativo Linux</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de hablar sobre los modelos de servidores web, me permito recordar algunas características de los procesos y subprocesos en Linux. </font><font style="vertical-align: inherit;">Lo necesitaremos al analizar las ventajas y desventajas de los modelos anteriores.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cambio de contexto</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo más probable es que cualquier usuario que sepa que solo se puede ejecutar un programa en un núcleo de procesador a la vez preguntará: "¿Por qué se pueden iniciar 20 programas en mi procesador de 4 núcleos a la vez?". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De hecho, esto se debe al hecho de que tiene lugar la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">multitarea preventiva</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">El sistema operativo asigna una cierta cantidad de tiempo (~ 50 μs) y coloca el programa para que se ejecute en el núcleo durante este tiempo. </font><font style="vertical-align: inherit;">Después de que se agote el tiempo, el </font><b><font style="vertical-align: inherit;">cambio de contexto</font></b><font style="vertical-align: inherit;"> se </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interrumpe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cambia</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Es decir, el sistema operativo simplemente ejecuta el siguiente programa. </font><font style="vertical-align: inherit;">Dado que el cambio ocurre con frecuencia, tenemos la impresión de que todos los programas funcionan simultáneamente. </font><font style="vertical-align: inherit;">Preste atención a la alta frecuencia de conmutación, esto será importante para la presentación posterior. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El cambio de contexto se mencionó anteriormente. </font><font style="vertical-align: inherit;">Que incluye? </font><font style="vertical-align: inherit;">Al cambiar el contexto, es necesario guardar los registros del procesador, borrar su canal de instrucciones, guardar las regiones de memoria asignadas al proceso. </font><font style="vertical-align: inherit;">En general, la operación es bastante costosa. </font><font style="vertical-align: inherit;">Tarda ~ 0.5 μs, mientras que la ejecución de una línea simple de código es ~ 1 ns. </font><font style="vertical-align: inherit;">Además, con un aumento en el número de procesos por núcleo de procesador, aumentará la sobrecarga para el cambio de contexto.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modelos de servidor web</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Actualmente, existen los siguientes modelos de servidor web:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trabajador</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prefork</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">asincrónico</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conjunto</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Discutamos cada uno de ellos por separado.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabajador y prefork</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Históricamente, con estos modelos, todo comenzó. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La esencia es muy simple</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : un cliente viene a nosotros, seleccionamos un controlador separado para él, que procesa el cliente entrante desde el principio hasta el final. Un controlador puede ser un proceso (prefork) o un subproceso (trabajador). Un ejemplo de dicho servidor web es el conocido Apache. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Haré una reserva de inmediato: crear un nuevo controlador para cada cliente es costoso. Primero, con un número constante de núcleos, un aumento en el número de procesadores conduce a un aumento en la latencia (debido a cambios de contexto). En segundo lugar, la cantidad de memoria requerida crece linealmente con el aumento de clientes, porque incluso si usa hilos de intercambio de memoria, cada hilo tiene su propia pila. Por lo tanto, el </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">número de clientes procesados ​​simultáneamente es limitado.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El tamaño de la agrupación, que, a su vez, depende de la cantidad de núcleos de procesador. </font><font style="vertical-align: inherit;">El problema se resuelve utilizando métodos de escala vertical. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otro inconveniente fundamental de tales servidores es el uso no óptimo de los recursos. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los procesos (o subprocesos) están inactivos la mayor parte del tiempo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Imagine la siguiente situación: durante el procesamiento del cliente, es necesario tomar algunos datos del disco duro, hacer una solicitud a la base de datos o escribir algo en la red. </font><font style="vertical-align: inherit;">Dado que leer desde un disco duro en Linux es una </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">operación de bloqueo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , el proceso (o subproceso) se bloqueará esperando una respuesta, pero aún participará en la asignación del tiempo del procesador.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabajador vs prefork</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trabajador y prefork tienen bastantes diferencias fundamentales. </font><font style="vertical-align: inherit;">Las secuencias son algo más económicas en memoria porque lo comparten. </font><font style="vertical-align: inherit;">Por la misma razón, un cambio de contexto entre ellos es más fácil que entre procesos. </font><font style="vertical-align: inherit;">Sin embargo, en el caso de un trabajador, el código se vuelve multiproceso, porque los hilos deben estar sincronizados. </font><font style="vertical-align: inherit;">Como resultado, obtenemos todos los "encantos" del código multiproceso: se hace más difícil escribirlo, leerlo, probarlo y depurarlo.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modelo asincrónico</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, trabajador y prefork no permiten procesar una gran cantidad de clientes al mismo tiempo debido al tamaño limitado de la agrupación, y tampoco utilizan de manera óptima los recursos debido a la conmutación de contexto y el bloqueo de llamadas al sistema. Como puede ver, el problema es multihilo y un programador pesado del sistema operativo. Esto lleva a la siguiente idea: procesemos clientes en un solo hilo, pero dejemos que se cargue al 100%. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dichos servidores se basan en un bucle de eventos y una plantilla de reactor ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">máquina de eventos</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). El código del cliente, al iniciar una operación de E / S, registra una </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devolución de llamada</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en una cola de prioridad (la prioridad es el tiempo de preparación). El bucle de eventos sondea los descriptores que esperan E / S y luego actualiza la prioridad (si está disponible). Además, el bucle de eventos extrae eventos de la cola de prioridad, lo que hace que las devoluciones de llamada devuelvan el control al bucle de eventos al final. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este modelo le permite manejar una gran cantidad de clientes, evitando gastos generales para cambiar el contexto</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Este modelo no es perfecto y tiene varias desventajas. En primer lugar, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no se consume más de un núcleo de procesador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , porque solo hay un proceso. Esto se trata utilizando un modelo combinado, que se discutirá a continuación. En segundo lugar, los </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">clientes están conectados por este proceso.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">El código debe escribirse con cuidado. </font><font style="vertical-align: inherit;">Pérdidas de memoria, errores conducen al hecho de que todos los clientes se caen a la vez. </font><font style="vertical-align: inherit;">Además, este proceso no debe ser bloqueado por nada, la devolución de llamada no debe consistir en resolver algunas tareas difíciles, porque todos los clientes serán bloqueados. </font><font style="vertical-align: inherit;">En tercer lugar, el </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">código asincrónico es mucho más complicado</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Es necesario registrar una devolución de llamada adicional para que los datos no lleguen, para resolver el problema de cómo bifurcar correctamente, etc.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modelo combinado</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este modelo se usa en servidores reales. </font><font style="vertical-align: inherit;">Este modelo tiene un grupo de procesos, cada uno de los cuales tiene un grupo de subprocesos, cada uno de los cuales, a su vez, utiliza un modelo de procesamiento basado en la entrada-salida asíncrona. </font><font style="vertical-align: inherit;">Nginx presenta un modelo combinado.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusión</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, volviendo a los conceptos básicos del sistema operativo, examinamos las diferencias conceptuales entre los modelos de servidor web utilizados en Apache y Nginx. </font><font style="vertical-align: inherit;">Cada uno de ellos tiene sus propias ventajas y desventajas, por lo que su combinación a menudo se usa en la producción. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La idea del procesamiento asincrónico ha evolucionado aún más: a nivel de las plataformas de lenguaje, surgieron los conceptos de hilos / fibras / gorutinas verdes, que le permiten "esconder bajo el capó" la asincronía de entrada y salida, dejando al desarrollador feliz con un hermoso código sincrónico. </font><font style="vertical-align: inherit;">Sin embargo, este concepto merece un artículo separado.</font></font><br>
<br>
<hr><br>
<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Aprende más sobre el curso.</font></font></a></b><br>
<br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es496944/index.html">Eventos digitales en San Petersburgo del 13 al 19 de abril.</a></li>
<li><a href="../es496946/index.html">Una vez más sobre las llaves de hardware GPG por un centavo</a></li>
<li><a href="../es496950/index.html">El diseño es diseño, no la belleza de las imágenes.</a></li>
<li><a href="../es496952/index.html">Qualcomm QCC3020: el auge de los auriculares chinos TWS</a></li>
<li><a href="../es496954/index.html">Desarrollo en Wargaming - reunión con Maxim Baryshnikov, Jefe de Plataforma (Parte I)</a></li>
<li><a href="../es496958/index.html">Interesante CSS encuentra en el nuevo diseño de Facebook</a></li>
<li><a href="../es496960/index.html">Acelerar los gráficos con OffscreenCanvas</a></li>
<li><a href="../es496962/index.html">¿Cómo ordenar un servidor sobrecargado?</a></li>
<li><a href="../es496964/index.html">Seminarios semanales de IBM - abril de 2020</a></li>
<li><a href="../es496966/index.html">Colores CSS LCH</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>