<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöë üê• ‚òùüèª NSA, Ghidra and Unicorns ü¶è üôã üêõ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This time, the PVS-Studio team was attracted by Ghidra, a large and evil framework for reverse engineering with which you can analyze various binary f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>NSA, Ghidra and Unicorns</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/504780/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/zb/b9/po/zbb9pocjsbhx8woze4xo8picks0.png" alt="NSA, Ghidra and Unicorns"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This time, the PVS-Studio team was attracted by Ghidra, a large and evil framework for reverse engineering with which you can analyze various binary files and do all kinds of scary things with them. </font><font style="vertical-align: inherit;">The most interesting thing about it is not that it is free to use or extends well with plugins, but that it was written in the NSA and posted on GitHub for everyone. </font><font style="vertical-align: inherit;">On the one hand, the NSA seems to have enough resources to keep the code base clean. </font><font style="vertical-align: inherit;">And on the other hand, new contributors who were not very familiar with it could have accidentally added undetected bugs lately. </font><font style="vertical-align: inherit;">Therefore, armed with a static analysis, we decided to look for weaknesses in this project.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prelude</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In total, the PVS-Studio static analyzer issued 651 high, 904 medium, and 909 low warnings in the Java part of the Ghidra project ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">release 9.1.2, commit 687ce7f</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Among them, about half of the high and medium responses were triggered by the </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">V6022</font></a><font style="vertical-align: inherit;"> diagnostic.</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parameter is not used inside method's body ", which usually appears after refactoring, when some parameter was no longer needed or some functionality was temporarily disabled by comments. A quick look at these warnings (there are too many of them to view each as an outside observer ) in this project did not reveal anything obviously suspicious. It is probably permissible for this project to temporarily disable this diagnostics in the analyzer settings so as not to be distracted by it. In practice, you can often see typos in the name of the setter or constructor parameter and, generally speaking, it should I‚Äôm sure most readers at least once come across a similar unpleasant pattern:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span> </span>{
  <span class="hljs-keyword">private</span> String value;
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">A</span><span class="hljs-params">(String val)</span> </span>{ <span class="hljs-comment">// V6022</span>
    <span class="hljs-keyword">this</span>.value = value;<font></font>
  }<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">hashCode</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> value.hashCode(); <span class="hljs-comment">// NullPointerException</span><font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
More than half of the low warnings were made by the " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V6008</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Potential null dereference of 'variable'" </font><font style="vertical-align: inherit;">diagnostic </font><font style="vertical-align: inherit;">- for example, the value </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">File.getParentFile () is</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> often used </font><font style="vertical-align: inherit;">without checking for </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . If the file object on which this method was called was constructed without an absolute path, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> will be returned </font><font style="vertical-align: inherit;">and the absence of verification may drop the application. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By tradition, we will analyze only warnings of high and medium levels, since the bulk of real errors are contained in them. When working with analyzer reports, we always recommend analyzing warnings in descending order of their reliability.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, we consider a few fragments indicated by the analyzer that seemed suspicious or interesting to me. </font><font style="vertical-align: inherit;">The code base of the project turned out to be of impressive size, and it is almost impossible to find such places manually.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragment 1: broken validation</font></font></h2><br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">parseDataTypeTextEntry</span><span class="hljs-params">()</span>
<span class="hljs-keyword">throws</span> InvalidDataTypeException </span>{<font></font>
  ...<font></font>
  <span class="hljs-keyword">try</span> {<font></font>
    newDataType = parser.parse(selectionField.getText(),<font></font>
                               getDataTypeRootForCurrentText());<font></font>
  }<font></font>
  <span class="hljs-keyword">catch</span> (CancelledException e) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (newDataType != <span class="hljs-keyword">null</span>) {
    <span class="hljs-keyword">if</span> (maxSize &gt;= <span class="hljs-number">0</span>
        &amp;&amp; newDataType.getLength() &gt; newDataType.getLength()) { <span class="hljs-comment">// &lt;=</span>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidDataTypeException(<span class="hljs-string">"data-type larger than "</span>
                                         + maxSize + <span class="hljs-string">" bytes"</span>);<font></font>
    }<font></font>
    selectionField.setSelectedValue(newDataType);<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warning: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V6001</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> There are identical sub-expressions 'newDataType.getLength ()' to the left and to the right of the '&gt;' operator. DataTypeSelectionEditor.java data66 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This class provides a graphical component for selecting a data type that supports auto-completion. The developer using this component can set the maximum permissible size of the selected data type (via the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">maxSize</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> field </font><font style="vertical-align: inherit;">) or make it unlimited by setting a negative value. It was assumed that when validating the entered data, exceeding the limit throws an exception, which is then caught up the call stack and the user is shown a message.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It seems that the author of the component was distracted right at the time of writing this test, or maybe he thought about the meaning of life, but in the end, validation simply does not work, since the number can never be greater than itself and, accordingly, we get ignoring this condition. This means that this component can provide invalid data. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another similar error was found in two more classes: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GuidUtil</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewGuid</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GuidUtil</span> </span>{<font></font>
  ...<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> GuidInfo <span class="hljs-title">parseLine</span><span class="hljs-params">(...)</span> </span>{<font></font>
    ...<font></font>
    <span class="hljs-keyword">long</span>[] data = <span class="hljs-keyword">new</span> <span class="hljs-keyword">long</span>[<span class="hljs-number">4</span>];<font></font>
    ...<font></font>
    <span class="hljs-keyword">if</span> (isOK(data)) {
      <span class="hljs-keyword">if</span> (!hasVersion) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> GuidInfo(guidString, name, guidType);<font></font>
      }<font></font>
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> VersionedGuidInfo(guidString, version, name, guidType);<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<font></font>
  }<font></font>
  ...<font></font>
  <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isOK</span><span class="hljs-params">(<span class="hljs-keyword">long</span>[] data)</span> </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; data.length; i++) {
      <span class="hljs-keyword">if</span> ((data[i] != <span class="hljs-number">0</span>) || (data[i] != <span class="hljs-number">0xFFFFFFFFL</span>)) { <span class="hljs-comment">// &lt;=</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<font></font>
      }<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<font></font>
  }<font></font>
  ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">warning</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">V6007</font></a><font style="vertical-align: inherit;"> Expression 'data [i]! = 0xFFFFFFFFL' is always true. GuidUtil.java:200 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> loop of </font><font style="vertical-align: inherit;">the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">isOK</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><font style="vertical-align: inherit;">checks that the same value is not equal to two different numbers at the same time. If so, then the GUID is immediately recognized as valid. That is, the GUID will be invalid only if the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> array is </font><font style="vertical-align: inherit;">empty, and this never happens, since the value of the corresponding variable is assigned only once - at the beginning of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parseLine</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><font style="vertical-align: inherit;">. </font><i><font style="vertical-align: inherit;">IsOK</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
method </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">body</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in both classes it completely coincides, which suggests the idea of ‚Äã‚Äãanother copy-paste of incorrect code. </font><font style="vertical-align: inherit;">What exactly the author wanted to check, I'm not sure, but I can assume that this method should be fixed as follows:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isOK</span><span class="hljs-params">(<span class="hljs-keyword">long</span>[] data)</span> </span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; data.length; i++) {
    <span class="hljs-keyword">if</span> ((data[i] == <span class="hljs-number">0</span>) || (data[i] == <span class="hljs-number">0xFFFFFFFFL</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragment 2: hiding exceptions</font></font></h2><br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">putByte</span><span class="hljs-params">(<span class="hljs-keyword">long</span> offsetInMemBlock, <span class="hljs-keyword">byte</span> b)</span>
<span class="hljs-keyword">throws</span> MemoryAccessException, IOException </span>{
  <span class="hljs-keyword">long</span> offsetInSubBlock = offsetInMemBlock - subBlockOffset;
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">if</span> (ioPending) {
      <span class="hljs-keyword">new</span> MemoryAccessException(<span class="hljs-string">"Cyclic Access"</span>); <span class="hljs-comment">// &lt;=</span><font></font>
    }<font></font>
    ioPending = <span class="hljs-keyword">true</span>;<font></font>
    doPutByte(mappedAddress.addNoWrap(offsetInSubBlock / <span class="hljs-number">8</span>),<font></font>
              (<span class="hljs-keyword">int</span>) (offsetInSubBlock % <span class="hljs-number">8</span>), b);<font></font>
  }<font></font>
  <span class="hljs-keyword">catch</span> (AddressOverflowException e) {
    <span class="hljs-keyword">new</span> MemoryAccessException(<span class="hljs-string">"No memory at address"</span>); <span class="hljs-comment">// &lt;=</span><font></font>
  }<font></font>
  <span class="hljs-keyword">finally</span> {<font></font>
    ioPending = <span class="hljs-keyword">false</span>;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warning: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V6006</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The object was created but it is not being used. The 'throw' keyword could be missing: 'new MemoryAccessException ("Cyclic Access")'. BitMappedSubMemoryBlock.java:99 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The exception objects themselves, as you know, do nothing (or, at least, should not do anything). Almost always, their new instances are thrown through </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">throw</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , in some rare cases - transferred somewhere or, perhaps, placed in a collection. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The class containing this method is a wrapper over a memory block that allows you to read and write data. Here, due to the fact that exceptions are not thrown, the imposed restriction of access to the current memory block with the </font><i><font style="vertical-align: inherit;">ioPending</font></i><font style="vertical-align: inherit;"> flag </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">may be violated</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and, in addition, an </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AddressOverflowException is</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ignored </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Thus, the data can be silently corrupted, and instead of explicitly indicating an error at a particular place, the developer will receive strange artifacts that have to be analyzed by the debugger. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There were eight of these lost exceptions:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BitMappedSubMemoryBlock.java: lines 77, 99, 106, 122</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ByteMappedSubMemoryBlock.java: lines 52, 73, 92, 114</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is characteristic that in the same files there are extremely similar methods in which </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">throw is</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> present. </font><font style="vertical-align: inherit;">Most likely, one method was originally written similarly to the above fragment, after which it was copied several times, somehow found an error and corrected it in those places that they could remember.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragment 3: minefield</font></font></h2><br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">processSelection</span><span class="hljs-params">(OptionsTreeNode selectedNode)</span> </span>{
  <span class="hljs-keyword">if</span> (selectedNode == <span class="hljs-keyword">null</span>) {<font></font>
    setViewPanel(defaultPanel, selectedNode); <span class="hljs-comment">// &lt;=</span>
    <span class="hljs-keyword">return</span>;<font></font>
  }<font></font>
  ...<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setViewPanel</span><span class="hljs-params">(JComponent component, OptionsTreeNode selectedNode)</span> </span>{<font></font>
  ...<font></font>
  setHelpLocation(component, selectedNode);<font></font>
  ...<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setHelpLocation</span><span class="hljs-params">(JComponent component, OptionsTreeNode node)</span> </span>{<font></font>
  Options options = node.getOptions();<font></font>
  ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">warning</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">V6008</font></a><font style="vertical-align: inherit;"> Null dereference of 'selectedNode' in function 'setViewPanel'. OptionsPanel.java:266 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The analyzer lied a bit - at the moment, calling the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">processSelection</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><i><font style="vertical-align: inherit;">does</font></i><font style="vertical-align: inherit;"> not lead to a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullPointerException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , since this method is called only two times, and before it is called, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">selectedNode is</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> explicitly checked for </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . This should not be done, since another developer can see that the method explicitly handles the case </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">selectedNode == null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and decide that this is a valid value, which then will result in the application crashing. Such surprises are especially dangerous just in open projects, since people who do not know the code base thoroughly participate in them.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In general, I must say that the whole </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">processSelection</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><font style="vertical-align: inherit;">looks rather strange. </font><font style="vertical-align: inherit;">It is likely that this is a copy-paste error, since in the same method an if block with the same body is encountered twice more, although with different conditions. </font><font style="vertical-align: inherit;">However, at this point, the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">selectedNode will</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no longer be </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">setViewPanel-setHelpLocation</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> call chain </font><font style="vertical-align: inherit;">will not result in a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullPointerException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragment 4: auto-completion for evil</font></font></h2><br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span>[] UNSUPPORTED_OPCODES_LIST = { ... };
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Set&lt;Integer&gt; UNSUPPORTED_OPCODES = <span class="hljs-keyword">new</span> HashSet&lt;&gt;();<font></font>
<font></font>
<span class="hljs-keyword">static</span> {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> opcode : UNSUPPORTED_OPCODES) {<font></font>
    UNSUPPORTED_OPCODES.add(opcode);<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warning: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V6053</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The collection is modified while the iteration is in progress. ConcurrentModificationException may occur. DWARFExpressionOpCodes.java:205 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this case, the analyzer again lied a bit - the exception will not be thrown, since the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNSUPPORTED_OPCODES</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> collection </font><i><font style="vertical-align: inherit;">is</font></i><font style="vertical-align: inherit;"> always empty and the loop simply will not execute. In addition, it so happened that the collection is a multitude, and adding an already present element will not change it. Most likely, the author entered in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for-each</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the name of the collection through auto-completion and did not notice that the wrong field was proposed. </font><font style="vertical-align: inherit;">Modification of the collection during iteration on it is impossible, but in good circumstances, as in this case, the application may not fall. </font><font style="vertical-align: inherit;">Here, this typo has an indirect effect: the machine that parses DWARF files relies on this collection to stop the analysis when finding unsupported opcodes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Starting with Java 9, it is worth using the factory methods of the standard library for constant collections: for example, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Set.of (T ... elements) is</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> not only much more convenient, but also immediately makes the created collection immutable, which increases the reliability of the code.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragment 5: there is everything</font></font></h2><br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setValueAt</span><span class="hljs-params">(Object aValue, <span class="hljs-keyword">int</span> row, <span class="hljs-keyword">int</span> column)</span> </span>{<font></font>
  ...<font></font>
  <span class="hljs-keyword">int</span> index = indexOf(newName);
  <span class="hljs-keyword">if</span> (index &gt;= <span class="hljs-number">0</span>) {                  <span class="hljs-comment">// &lt;=</span><font></font>
    Window window = tool.getActiveWindow();<font></font>
    Msg.showInfo(getClass(), window, <span class="hljs-string">"Duplicate Name"</span>,
                 <span class="hljs-string">"Name already exists: "</span> + newName);
    <span class="hljs-keyword">return</span>;<font></font>
  }<font></font>
<font></font>
  ExternalPath path = paths.get(row); <span class="hljs-comment">// &lt;=</span><font></font>
  ...<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-title">indexOf</span><span class="hljs-params">(String name)</span> </span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; paths.size(); i++) {<font></font>
    ExternalPath path = paths.get(i);<font></font>
    <span class="hljs-keyword">if</span> (path.getName().equals(name)) {
      <span class="hljs-keyword">return</span> i;<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio warnings:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V6007</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Expression 'index&gt; = 0' is always true. </font><font style="vertical-align: inherit;">ExternalNamesTableModel.java:105</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">V6019</a> Unreachable code detected. It is possible that an error is present. ExternalNamesTableModel.java:109</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The author thought about it, and in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexOf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><i><font style="vertical-align: inherit;">,</font></i><font style="vertical-align: inherit;"> instead of "index" -1 for an unknown value returns 0 - the index of the first element of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">paths</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> collection </font><font style="vertical-align: inherit;">. Even if the collection is empty. Or maybe the method was generated, but forgot to change the default return value. As a result, the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">setValueAt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><i><font style="vertical-align: inherit;">will</font></i><font style="vertical-align: inherit;"> discard any value passed to it and display the user with a "Name already exists" error, even if there is no existing name. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By the way, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexOf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is not used anywhere else, and its value is needed only in order to determine whether the element you are looking for exists. Perhaps, instead of a separate method, write </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for-each</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> directly in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">setValueAt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and make </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">return</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">on a matching item instead of games with indexes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Note: I could not reproduce the alleged error. </font><font style="vertical-align: inherit;">The </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">setValueAt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method is </font><i><font style="vertical-align: inherit;">probably</font></i><font style="vertical-align: inherit;"> no longer used or called only under certain conditions.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragment 6: keep silence</font></font></h2><br>
<pre><code class="java hljs"><span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> Map&lt;Character, String&gt; DELIMITER_NAME_MAP = <span class="hljs-keyword">new</span> HashMap&lt;&gt;(<span class="hljs-number">20</span>);
<span class="hljs-comment">// Any non-alphanumeric char can be used as a delimiter.</span>
<span class="hljs-keyword">static</span> {<font></font>
  DELIMITER_NAME_MAP.put(<span class="hljs-string">' '</span>, <span class="hljs-string">"Space"</span>);<font></font>
  DELIMITER_NAME_MAP.put(<span class="hljs-string">'~'</span>, <span class="hljs-string">"Tilde"</span>);<font></font>
  DELIMITER_NAME_MAP.put(<span class="hljs-string">'`'</span>, <span class="hljs-string">"Back quote"</span>);<font></font>
  DELIMITER_NAME_MAP.put(<span class="hljs-string">'@'</span>, <span class="hljs-string">"Exclamation point"</span>);<font></font>
  DELIMITER_NAME_MAP.put(<span class="hljs-string">'@'</span>, <span class="hljs-string">"At sign"</span>);<font></font>
  DELIMITER_NAME_MAP.put(<span class="hljs-string">'#'</span>, <span class="hljs-string">"Pound sign"</span>);<font></font>
  DELIMITER_NAME_MAP.put(<span class="hljs-string">'$'</span>, <span class="hljs-string">"Dollar sign"</span>);<font></font>
  DELIMITER_NAME_MAP.put(<span class="hljs-string">'%'</span>, <span class="hljs-string">"Percent sign"</span>);<font></font>
  ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warning: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V6033</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> An item with the same key '@' has already been added. FilterOptions.java:45 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ghidra supports filtering data in various contexts: for example, you can filter the list of project files by name. In addition, filtering by several keywords at once is implemented: '.java, .c' when the 'OR' mode is on, displays all files whose name contains either '.java' or '.c'. It is understood that any special character can be used as a word separator (a specific separator is selected in the filter settings), but in reality the exclamation mark was not available.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In such initialization sheets, it is very easy to seal up, as they are often written using copy-paste, and when you look at such code, your eyes quickly blur. </font><font style="vertical-align: inherit;">And if the typo was not on two adjacent lines, then by hand it will almost certainly no one see.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragment 7: remainder of division is always 0</font></font></h2><br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setFactorys</span><span class="hljs-params">(FieldFactory[] fieldFactorys,
                 DataFormatModel dataModel, <span class="hljs-keyword">int</span> margin)</span> </span>{<font></font>
  factorys = <span class="hljs-keyword">new</span> FieldFactory[fieldFactorys.length];<font></font>
<font></font>
  <span class="hljs-keyword">int</span> x = margin;
  <span class="hljs-keyword">int</span> defaultGroupSizeSpace = <span class="hljs-number">1</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; factorys.length; i++) {<font></font>
    factorys[i] = fieldFactorys[i];<font></font>
    factorys[i].setStartX(x);<font></font>
    x += factorys[i].getWidth();<font></font>
    <span class="hljs-comment">// add in space between groups</span>
    <span class="hljs-keyword">if</span> (((i + <span class="hljs-number">1</span>) % defaultGroupSizeSpace) == <span class="hljs-number">0</span>) { <span class="hljs-comment">// &lt;=</span><font></font>
      x += margin * dataModel.getUnitDelimiterSize();<font></font>
    }<font></font>
  }<font></font>
  width = x - margin * dataModel.getUnitDelimiterSize() + margin;<font></font>
  layoutChanged();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio warnings:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V6007</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Expression '((i + 1)% defaultGroupSizeSpace) == 0' is always true. </font><font style="vertical-align: inherit;">ByteViewerLayoutModel.java:66</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V6048</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> This expression can be simplified. </font><font style="vertical-align: inherit;">Operand 'defaultGroupSizeSpace' in the operation equals 1. ByteViewerLayoutModel.java:66</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The hex byte viewer supports the choice of the size of the displayed groups: for example, you can configure the output in the format 'ffff ffff' or 'ff ff ff ff'. The </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">setFactorys</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method is responsible for the location of these groups in the user interface </font><font style="vertical-align: inherit;">. Despite the fact that customization and display work correctly, the cycle in this method looks extremely suspicious: the remainder of the division by one is always zero, which means that the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> coordinate </font><font style="vertical-align: inherit;">will increase at each iteration. Suspicion adds properties and availability </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">groupSize</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in setting </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DataModel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Remaining garbage after refactoring? Or maybe the </font><i><font style="vertical-align: inherit;">defaultGroupSizeSpace</font></i><font style="vertical-align: inherit;"> variable calculations were lost</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? </font><font style="vertical-align: inherit;">In any case, an attempt to replace its value with </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dataModel.getGroupSize ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> broke the layout, and perhaps only the author of this code can give an unambiguous answer.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragment 8: broken validation, part 2</font></font></h2><br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">parseArrayDimensions</span><span class="hljs-params">(String datatype,
                                    List&lt;Integer&gt; arrayDimensions)</span> </span>{<font></font>
  String dataTypeName = datatype;<font></font>
  <span class="hljs-keyword">boolean</span> zeroLengthArray = <span class="hljs-keyword">false</span>;
  <span class="hljs-keyword">while</span> (dataTypeName.endsWith(<span class="hljs-string">"]"</span>)) {
    <span class="hljs-keyword">if</span> (zeroLengthArray) {                   <span class="hljs-comment">// &lt;=</span>
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>; <span class="hljs-comment">// only last dimension may be 0</span><font></font>
    }<font></font>
    <span class="hljs-keyword">int</span> rBracketPos = dataTypeName.lastIndexOf(<span class="hljs-string">']'</span>);
    <span class="hljs-keyword">int</span> lBracketPos = dataTypeName.lastIndexOf(<span class="hljs-string">'['</span>);
    <span class="hljs-keyword">if</span> (lBracketPos &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">int</span> dimension;
    <span class="hljs-keyword">try</span> {<font></font>
      dimension = Integer.parseInt(dataTypeName.substring(lBracketPos + <span class="hljs-number">1</span>,<font></font>
                                                          rBracketPos));<font></font>
      <span class="hljs-keyword">if</span> (dimension &lt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>; <span class="hljs-comment">// invalid dimension</span><font></font>
      }<font></font>
    }<font></font>
    <span class="hljs-keyword">catch</span> (NumberFormatException e) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<font></font>
    }<font></font>
    dataTypeName = dataTypeName.substring(<span class="hljs-number">0</span>, lBracketPos).trim();<font></font>
    arrayDimensions.add(dimension);<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> dataTypeName;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warning: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V6007</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Expression 'zeroLengthArray' is always false. PdbDataTypeParser.java:278 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This method parses the dimension of a multidimensional array and returns either the text remaining after parsing or </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for invalid data. A comment next to one of the validation checks states that only the last read size can be zero. The analysis goes from right to left, so it is understood that '[0] [1] [2]' is a valid input text, and '[2] [1] [0]' is not. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But, trouble: no one added the check that the next size is zero, and the parser eats invalid data without unnecessary questions. You should probably fix the try block as follows:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">try</span> {<font></font>
  dimension = Integer.parseInt(dataTypeName.substring(lBracketPos + <span class="hljs-number">1</span>,<font></font>
                                                      rBracketPos));<font></font>
  <span class="hljs-keyword">if</span> (dimension &lt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>; <span class="hljs-comment">// invalid dimension</span>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (dimension == <span class="hljs-number">0</span>) {<font></font>
    zeroLengthArray = <span class="hljs-keyword">true</span>;<font></font>
  }<font></font>
}<font></font>
<span class="hljs-keyword">catch</span> (NumberFormatException e) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Naturally, there is the possibility that this criterion of validity over time turned out to be unnecessary, or the author‚Äôs comment has a different meaning and it is necessary to check the first dimension read. </font><font style="vertical-align: inherit;">In any case, data validation is a critical part of any application, which must be taken with full responsibility. </font><font style="vertical-align: inherit;">Errors in it can lead to quite harmless crashes of the application, as well as to security holes, data leakage, data corruption or loss (for example, if you skip SQL injection during query validation).</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A bit about the rest of the warnings</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The reader may notice that a lot of warnings were issued, but few were considered. Not very neatly tuned cloc in the project counted about 1.25 million lines of Java code (not empty and not comments). The fact is that almost all warnings are extremely similar: here they forgot to check for </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , they did not delete the unused legacy code there. I don‚Äôt really want to bore the reader by listing the same thing, and I mentioned part of such cases at the beginning of the article. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another example is the fifty warning ‚Äú </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V6009</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Function receives an odd argument‚Äù in the context of inaccurate use of the </font><i><font style="vertical-align: inherit;">substring</font></i><font style="vertical-align: inherit;"> method</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(CParserUtils.java:280, ComplexName.java:48 and others) to get the rest of the string after any separator. </font><font style="vertical-align: inherit;">Developers often hope that this separator will be present in the string and forget that otherwise </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexOf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> will return -1, which is an incorrect value for </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">substring</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Naturally, if the data was validated or received not from outside, then the probability of the application crashing is significantly reduced. </font><font style="vertical-align: inherit;">However, in general, these are potentially dangerous places that we want to help get rid of.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In general, Ghidra pleased with the quality of the code - no special nightmares are evident. </font><font style="vertical-align: inherit;">The code is well formatted and has a very consistent style: in most cases, variables, methods, and everything else are given clear names, explanatory comments are found, a huge number of tests are present. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Naturally, there were no problems, among which:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dead code, which, most likely, remained after numerous refactoring;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Many javadocs are hopelessly outdated and, for example, indicate non-existent parameters;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There is no possibility of convenient development </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">when using IntelliJ IDEA</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A modular system built around reflection makes navigating a project and finding dependencies between components much more difficult.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Please do not neglect developer tools. </font><font style="vertical-align: inherit;">Static analysis, like seat belts, is not a panacea, but it will help prevent some disasters before release. </font><font style="vertical-align: inherit;">And nobody likes to use the logged-in software. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can read about other proven projects in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">our blog</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">And we also have a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trial license</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and various </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">options for</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> using the analyzer without the need to pay for it.</font></font><br>
<br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="></a></p><div style="text-align:center;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/eb2/f9c/3bb/eb2f9c3bb5f32f39239298d36431961c.png"></a></div><p></p><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you want to share this article with an English-speaking audience, then please use the link to the translation: Nikita Lazeba. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NSA, Ghidra, and Unicorns</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en504768/index.html">Analyst internship in Yandex: analysis of test tasks</a></li>
<li><a href="../en504770/index.html">Linux Gaming Distributions</a></li>
<li><a href="../en504772/index.html">Digital events in Moscow from June 1 to 7</a></li>
<li><a href="../en504774/index.html">Survey of IT executives about changing needs for IT services</a></li>
<li><a href="../en504776/index.html">Writing a game engine in your first year: easy! (Almost)</a></li>
<li><a href="../en504784/index.html">Sectigo's AddTrust root certificate expired on May 30, 2020, which caused problems in OpenSSL 1.0.x and GnuTLS clients</a></li>
<li><a href="../en504786/index.html">Everything you need to know about caching</a></li>
<li><a href="../en504790/index.html">A selection of articles on machine learning: cases, guides and studies for May 2020</a></li>
<li><a href="../en504792/index.html">Duty boarding house. How NSPK saved its duty room from a coronavirus</a></li>
<li><a href="../en504796/index.html">Udalenka is cool. Maybe stay forever?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>