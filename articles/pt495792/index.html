<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë• üéÆ ‚ÜôÔ∏è Confer√™ncia DEFCON 27. Buttplug: True Penetration Testing. Parte 2 üÜî üë©üèΩ‚Äçüç≥ üêö</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Os analistas acreditam que atualmente existem cerca de 10 bilh√µes de dispositivos do mundo da Internet das Coisas (IoT). √Äs vezes, esses dispositivos ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Confer√™ncia DEFCON 27. Buttplug: True Penetration Testing. Parte 2</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/495792/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os analistas acreditam que atualmente existem cerca de 10 bilh√µes de dispositivos do mundo da Internet das Coisas (IoT). √Äs vezes, esses dispositivos ganham seu lugar no mercado, literalmente subindo no traseiro humano. Como se viu, chips de r√°dio baratos e de baixa pot√™ncia n√£o s√£o √≥timos apenas para automa√ß√£o residencial - eles tamb√©m mudam a maneira como as pessoas interagem com brinquedos sexuais. Neste relat√≥rio, mergulharemos no mundo das dild√¥nicas da televis√£o, a tecnologia do sexo a uma dist√¢ncia na qual t√°til, temperatura e outras sensa√ß√µes s√£o transmitidas entre os parceiros atrav√©s de uma linha de comunica√ß√£o bidirecional. O orador lhe dir√° que a seguran√ßa dos brinquedos sexuais anal eletr√¥nicos eletr√¥nicos Buttplug pode se opor a um invasor que encontra e explora vulnerabilidades em cada n√≠vel da pilha. Por fim, isso permite que os brinquedos sexuais sejam comprometidos,e os dispositivos aos quais eles se conectam.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/z5/yr/ar/z5yraruqzcjhhyd_pc_eym4a5ly.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um hacker com o apelido smea, ou Smealum, iniciou sua carreira como desenvolvedor de videogames para consoles de jogos como o Nintendo DS, tentando simultaneamente decifr√°-los. Em algum momento, os consoles adquiriram sistemas de seguran√ßa s√©rios, e Smea passou do software dom√©stico para o desenvolvimento de t√©cnicas para quebr√°-lo. Smea √© conhecido por seu "trabalho" no Nintendo 3DS e no Wii U, embora tamb√©m tenha contribu√≠do para o desenvolvimento de explora√ß√µes para os mais populares navegadores da Web e pilhas de virtualiza√ß√£o. Provavelmente, agora ele se interessou em invadir plugues anal "inteligentes".</font></font><a name="habracut"></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Confer√™ncia DEFCON 27. Buttplug: True Penetration Testing. Parte 1</font></font></a><br>
<br>
<img src="https://habrastorage.org/webt/xq/wz/de/xqwzdenvl7ovwamxxyxf_byvjiu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Obviamente, voc√™ pode gerenciar as mensagens recebidas mesmo com um comprimento de linha t√£o curto. Por exemplo, 30 caracteres s√£o suficientes para executar JavaScript malicioso. Este slide mostra um exemplo de tag com um comprimento de 30 caracteres para uma imagem de uma fonte inexistente &lt;img src = a onerror = 'alert (1)'&gt;, que faz com que o aplicativo exiba uma mensagem de erro. Esta mensagem ser√° exibida sempre que o carregamento da imagem for realmente imposs√≠vel. A captura de tela mostra que a conex√£o atrav√©s de um dongle comprometido permite executar JavaScript malicioso.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kd/p8/9x/kdp89xy1fdjf_ib5vcifs6wmix4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O limite de 32 caracteres √© irritante porque √© dif√≠cil perceber a carga √∫til do volume, mas √© bem poss√≠vel. Ent√£o, voc√™ percebe que comprometemos o aplicativo com sucesso usando uma chave USB e agora estamos no meio do caminho para reverter os hackers, ou seja, comprometer o aplicativo usando um bootplag de hacker. O hacking em um site de computador com dongle pode ocorrer de duas maneiras: atrav√©s de um computador, voc√™ pode comprometer um dongle e, atrav√©s de um dongle, pode comprometer um computador.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O dongle atua como uma pequena ponte entre o plug de inicializa√ß√£o e o aplicativo. Surge a pergunta: √© poss√≠vel usar a mesma vulnerabilidade para comprometer um aplicativo em um computador diretamente atrav√©s do bootplag. Infelizmente, a resposta a esta pergunta √© negativa e o motivo √© que h√° outra limita√ß√£o no tamanho dos caracteres da mensagem que v√™m do plug-in de inicializa√ß√£o para o aplicativo.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bi/xp/_c/bixp_ckg43nxt6acd4aq_px4wae.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O dongle simplesmente empacota as mensagens do plug-in de inicializa√ß√£o e as envia para o aplicativo, e nesta etapa voc√™ pode inserir seu c√≥digo HTML nelas. No entanto, por vez, ele pode receber uma mensagem com tamanho n√£o superior a 20 bytes, o que n√£o √© suficiente para executar um ataque XSS. No entanto, h√° um erro no firmware do dongle: n√£o h√° verifica√ß√£o do terminador nulo no final da linha. Portanto, se voc√™ puder colocar alguns dados n√£o inicializados ap√≥s o final de uma sequ√™ncia de 20 caracteres, poder√° enviar ao aplicativo mais de 20 caracteres. Infelizmente, n√£o encontrei uma maneira de usar essa vulnerabilidade na pr√°tica, mas vale a pena lembrar essa oportunidade.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, o problema √© que voc√™ provavelmente n√£o pode usar esta vulnerabilidade para for√ßar o aplicativo a executar o c√≥digo recebido diretamente do plug-in de inicializa√ß√£o. √â triste, mas ainda mais triste, se voc√™ olhar para o firmware do dongle, poder√° ver que, em princ√≠pio, ele n√£o faz nada com os dados recebidos, mas simplesmente copia-o para uma nova linha e envia-o ainda mais. Portanto, n√£o poderemos usar sua vulnerabilidade para atacar por meio do transbordamento do buffer de mem√≥ria. No entanto, se for imposs√≠vel hackear o aplicativo diretamente do plug-in de inicializa√ß√£o, talvez seja poss√≠vel fazer isso atrav√©s da cadeia de plug-dongle-computador de inicializa√ß√£o? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O bom √© que o chip dongle permite que voc√™ coloque muito mais c√≥digo do que o necess√°rio para o programa de desenvolvedor Lovense Hush original.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/9m/bf/k7/9mbfk7wqpqdoodi2nndnppiirfo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A mem√≥ria flash do dongle cont√©m uma √°rea reservada para o carregador DFU, uma √°rea para o pr√≥prio aplicativo Lovense e uma √°rea SoftDevice fechada para o driver de hardware do chip Nordic Semiconductor BLE. √â aqui que o pr√≥prio protocolo BLE √© processado. Por exemplo, quando um aplicativo deseja enviar uma mensagem BLE para um brinquedo, ele acessa o SoftDevice atrav√©s de uma chamada SVC. Al√©m dessas tr√™s √°reas, o dongle possui uma √°rea n√£o utilizada de mem√≥ria flash com um volume suficientemente grande. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para encontrar a vulnerabilidade na pilha do BLE SoftDevice, voc√™ precisa usar a engenharia reversa, pois ela n√£o √© de c√≥digo aberto. Fiz o mesmo para encontrar a vulnerabilidade do plug-in de firmware. Nesse caso, √© muito f√°cil acompanhar o fluxo de dados, porque tamb√©m n√£o existe ASLR e √© f√°cil determinar o c√≥digo que processar√° essas mensagens.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yh/wq/ch/yhwqchpeynrmburahytjp2gxqd8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä direita, no slide, voc√™ v√™ o manipulador de pacotes de entrada GATTC (um perfil de atributos comuns), que, em ess√™ncia, √© um dongle. Em particular, √© um manipulador de leitura por tipo de pacotes de resposta. N√£o sou especialista em dispositivos Bluetooth, mas acho que o ponto aqui √© que o dongle l√™ o tipo de dispositivo perif√©rico e usa manipuladores para todas as variantes dos atributos associados a esse tipo. Isso significa que, de fato, voc√™ pode obter mais de um atributo por vez, e o tamanho de cada manipulador de um par de dados de atributo √© codificado como um campo dentro do pacote, o que permite gerenci√°-los.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ck/sa/9h/cksa9hsxwiqwgqoyklkgwwhx2pa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O slide mostra uma amostra desse pacote. Os clientes GATT podem enviar um pacote de solicita√ß√£o de leitura por tipo que cont√©m o tipo e o intervalo de descritores para leitura. Os servidores que respondem √† solicita√ß√£o de leitura por tipo retornam dados associados aos manipuladores dentro do intervalo correspondente a esse tipo. O n√∫mero de pares de descritores / dados √© determinado dividindo o comprimento do pacote restante pelo comprimento do campo do par de descritores / dados, e esse campo √© sempre 0x7 ou 0x15.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j7/zf/gm/j7zfgmebqqi3va1lslmsmr3pzr8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O slide mostra a opera√ß√£o da fun√ß√£o na qual estamos interessados: voc√™ v√™ como o pacote √© preenchido com dados de uma matriz de atributos e um tamanho de buffer fixo √© alocado para eles. √â aqui que o valor do descritor √© colocado e o ponteiro associado a ele. Uma matriz de atributos s√£o dados bin√°rios que s√£o colocados dentro do buffer em formato hexadecimal. Os dados s√£o destacados em azul e, ao lado, o descritor 0D e o ponteiro associado 00, destacado em laranja. O pacote do segundo e terceiro manipulador √© semelhante.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A vulnerabilidade √© a seguinte. Se voc√™ ler o c√≥digo √† direita, poder√° ver o par√¢metro attribute_data_length colocado no quadro roxo - o comprimento da mensagem recebida, cujo valor √© completamente controlado por um invasor em potencial. Se colocarmos um valor zero, obteremos um loop infinito. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wk/mo/hi/wkmohi2rrehqx3o1mgupqhdseek.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O loop se torna infinito porque o c√≥digo n√£o verifica se os dados que ele grava no buffer de sa√≠da est√£o dentro desse buffer de sa√≠da. Como resultado, obtemos um estouro cl√°ssico de buffer de pilha, pois o dispositivo n√£o possui ASLR ou DEP e o c√≥digo √© executado imediatamente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Atribuindo um valor zero e obtendo um loop infinito, voc√™ realmente substitui todos os dados da RAM por lixo. No entanto, esta √© uma solu√ß√£o malsucedida, pois √© prov√°vel que cause uma falha no dispositivo. Mas se voc√™ usar o valor 1, isso limitar√° o n√∫mero de bytes que est√£o dentro da mensagem recebida. Isso significa o seguinte - voc√™ pode sobrecarregar levemente esse buffer e, em seguida, o buffer, que √© baseado na pilha, poder√° danificar tudo o que estiver ao lado dele.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vg/rf/iy/vgrfiyhiseechjyxntzkrztnp14.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos ver como √© a pilha antes do estouro. A matriz de atributos do buffer sobre os quais falamos √© destacada em amarelo, os registros salvos em azul e o endere√ßo de retorno em laranja. Ao definir o comprimento do atributo como 0x01, podemos causar um estouro de muitos pares de ponteiros de identificador / dados. Os descritores consistem em 2 bytes, mas os dois primeiros bytes do descritor DWORD n√£o s√£o limpos. O buffer que estamos transbordando est√° na pilha sem cookies, sem ASLR, sem DEP.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/es/oo/ko/esooko6lhrdqef9gglnoyx2ffh8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, testamos o sistema: envie um pacote cheio de bytes 0xDA com um comprimento de atributo 0x01. Acontece que reescrevemos o endere√ßo de retorno com um ponteiro para nossos dados de atributo. Como n√£o h√° DEP, isso significa que sempre que a fun√ß√£o retornar, o c√≥digo que est√° dentro do nosso pacote ser√° executado. A √∫nica limita√ß√£o √© que precisamos que o endere√ßo de retorno tenha o LSB definido para o bit menos significativo, para que o c√≥digo seja executado no modo Thumb, porque o processador Cortex M0 n√£o suporta o modo ARM.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rc/5w/gl/rc5wglu00lbsx5v9gnix6v1as2c.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tamb√©m reescrevemos v√°rias vari√°veis ‚Äã‚Äãlocais, garantindo que n√£o reescrevemos nada usado no caminho de volta. Basicamente, temos um pacote backdoor cl√°ssico. Se voc√™ prestar aten√ß√£o a essa pilha, ver√° que a reescrita n√£o corresponde √† borda, o que causar√° uma falha no programa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° outro requisito em rela√ß√£o aos registros armazenados. Essas s√£o vari√°veis ‚Äã‚Äãlocais que tamb√©m s√£o substitu√≠das quando a fun√ß√£o retorna. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ft/kv/m2/ftkvm2tpkt7iepg-fwtrpx2kkiq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um deles √© usado para desreferenciar uma borda de 32 bits, e a incompatibilidade de conte√∫do com a borda far√° com que o programa trave. Portanto, voc√™ precisa garantir que save_arg_3 = 0, saved_arg_4 corresponda a DWORD, ou seja, esteja dentro da borda e LSB esteja definido.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, precisamos garantir que este pacote esteja funcionando. Felizmente, isso √© realmente f√°cil, porque a maneira como o SoftDevice distribui esses pacotes recebidos √© um buffer de anel sem requisitos de alinhamento for√ßado. O Whiteshark tornou poss√≠vel verificar se o alinhamento do pacote subsequente pode ser controlado alterando o tamanho do pacote anterior. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mr/3j/ia/mr3jiaai4k_cnlfzea9a0zyvgqi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Amarelo e azul destacaram 2 pacotes enviados antes do envio do pacote de explora√ß√£o. Isso permite que eu controle o alinhamento do √∫ltimo pacote e fa√ßa com que ele n√£o cause uma falha no programa, que √© o nosso objetivo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Percebo que h√° um obst√°culo de engenharia: o Nordic SoftDevice n√£o fornece uma interface para o envio de pacotes BLE brutos. </font><font style="vertical-align: inherit;">Para contornar isso, voc√™ pode usar 2 op√ß√µes: implementar sua pr√≥pria pilha BLE ou quebrar alguns ganchos nos pacotes originais. </font><font style="vertical-align: inherit;">Como sou pregui√ßoso, escolhi a op√ß√£o 2. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esses ganchos s√£o bastante simples, mas requerem alguma engenharia reversa. </font><font style="vertical-align: inherit;">Os m√©todos de hackers podem ser encontrados no github, a interface √© bastante "suja" e n√£o h√° garantias de que isso funcione, mas eu fiz. </font><font style="vertical-align: inherit;">Voc√™ ainda est√° melhor usando o BTLEJack.</font></font><br>
<br>
<pre><code class="plaintext hljs">void ble_outgoing_hook(uint8_t* buffer, uint8_t length);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse ponteiro do SoftDevice √© chamado sempre que um pacote BLE √© enviado, para que possa ser modificado antecipadamente:</font></font><br>
<br>
<pre><code class="plaintext hljs">int ble_incoming_hook(uint8_t* buffer, uint16_t length);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este SoftDevice do gancho chama sempre que um pacote BLE √© recebido. O valor de retorno determina se o processamento normal do SoftDevice deve ser ignorado.</font></font><br>
<br>
<pre><code class="plaintext hljs">int send_packet(void* handle, void* buffer, uint16_t length);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â assim que a fun√ß√£o de enviar o pacote bruto para esta conex√£o BLE se parece. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como posso processar mais de 4 bytes de c√≥digo por vez? Precisa enviar alguns pacotes! √Ä direita, voc√™ v√™ o buffer de anel dos pacotes BLE recebidos. O primeiro pacote √© mostrado em verde: o c√≥digo do shell que executa uma chamada de fun√ß√£o com par√¢metros controlados e depois retorna "clean". O segundo pacote √© mostrado em amarelo - este √© um buffer de dados que pode ser usado por uma chamada de fun√ß√£o. O terceiro pacote √© mostrado em azul - um buffer que cont√©m os valores dos par√¢metros de chamada de fun√ß√£o e laranja - o pacote que inicia a vulnerabilidade usando a instru√ß√£o C1 E7. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/47/up/ki/47upki5tumqqj_c4ysc09rw2i0g.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de retornar a fun√ß√£o pura, podemos reenviar este pacote. O envio desses 4 pacotes executa qualquer parte arbitr√°ria do c√≥digo dentro do dongle, e isso pode ser feito repetidamente.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/z2/hg/jg/z2hgjgfs0udpsjpfcm0l7gppqmw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso √© conveniente porque, dessa maneira, posso realmente chamar o memcpy v√°rias vezes para copiar o bin√°rio maior do c√≥digo do shell na RAM. Em seguida, chamamos essa fun√ß√£o para corrigir o c√≥digo do dongle original na mem√≥ria e us√°-lo para comprometer o aplicativo instalado no computador. Como a carga √∫til do XSS √© grande, n√£o a enviamos, mas a geramos no c√≥digo do shell no pr√≥prio dongle. O c√≥digo do shell √© o seguinte. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/c7/bi/oy/c7bioypcqko4flgvncaxbz8e2qm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado dessas manipula√ß√µes, √© obtido o seguinte: se podemos controlar o aplicativo, podemos controlar o dongle e o bootplag.</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/zq/qj/dv/zqqjdv3mounl3az58buw63jinri.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem duas maneiras de hackear a se√ß√£o do dongle de etiqueta: o dongle pode comprometer o brinquedo, e o tag de viola√ß√£o pode comprometer o dongle e o computador. O b√¥nus √© que a vulnerabilidade do Nordic BLE est√° presente n√£o apenas nos produtos Lovense, mas tamb√©m em todos os dispositivos que usam o SoftDevise S110, S120 ou S130 para o lado do cliente do BLE.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, temos a oportunidade de comprometer o aplicativo usando o bootplag. Como isso pode ser usado? Ainda estamos apenas executando o c√≥digo JavaScript dentro do aplicativo Lovense, e a pergunta √©: o que isso nos d√°? Acontece que o aplicativo lovense.exe roda no Medium IL e no Windows, oferece possibilidades verdadeiramente ilimitadas: mesmo sem privil√©gios de administrador, voc√™ pode acessar arquivos no seu computador, executar c√≥digo arbitr√°rio, implementar XSS, acessar a rede etc.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ze/zo/ng/zezongcdgttvaxcxleyye2bzrwi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A pr√≥xima pergunta: se voc√™ pode criar um programa de ransomware que n√£o apenas infecte a etiqueta de inicializa√ß√£o, mas tamb√©m o computador do usu√°rio, existe uma maneira de divulg√°-la ainda mais, tornando-a viral? Agora, temos um hack no n√≠vel local, mas para um hacker, seria muito mais √∫til obter controle sobre muitos computadores de usu√°rios via Internet. Como vamos fazer isso? As fun√ß√µes sociais do brinquedo, como bate-papo por v√≠deo, bate-papo por texto, transfer√™ncia de imagens e o pr√≥prio controle remoto, expandem significativamente a superf√≠cie de ataque. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O controle remoto √© um excelente objetivo, porque se um desenvolvedor quiser usar um programa propriet√°rio, ele definitivamente ter√° bugs e vulnerabilidades. Como us√°-lo? Por exemplo, voc√™ pode enviar a um parceiro um objeto JSON contendo comandos, por exemplo, o comando "Vibrar: 10":</font></font><br>
<br>
<pre><code class="plaintext hljs">{<font></font>
cate: "id",<font></font>
id: {<font></font>
DEADBABEBEEF: {<font></font>
v: 10<font></font>
}<font></font>
}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse caso, o receptor analisa o JSON recebido, gera um comando para o brinquedo e o envia mais adiante, e aqui existem 2 modos. O primeiro modo "id:" envia um comando para um brinquedo sexual espec√≠fico, o segundo modo "all:" envia um comando para todos os brinquedos remotos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os dados recebidos s√£o validados corretamente? Como o JSON √© muito flex√≠vel, o c√≥digo, esperando um n√∫mero, pode obter uma sequ√™ncia inteira. Se conseguirmos controlar os comandos enviados ao brinquedo, provavelmente poderemos usar o bug do analisador de dongle. No pr√≥ximo slide, o quadro laranja mostra onde os dados de entrada s√£o usados ‚Äã‚Äãe o azul mostra onde est√£o marcados.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse erro √© que o aplicativo n√£o verifica adequadamente se a entrada para um comando como vibrar √© realmente um n√∫mero inteiro. Nesse caso, no modo "id:", apenas se o √≠ndice de intensidade de vibra√ß√£o for n&gt; = 0 ser√° verificado e se voc√™ passar um n√∫mero inteiro 12 maior que zero, esse par√¢metro ser√° aprovado no teste. Mesmo se voc√™ passar uma string, ou seja, o n√∫mero entre aspas "12", o sistema a aceitar√°. Ele n√£o aceitar√° apenas uma string na forma de uma combina√ß√£o de n√∫meros e letras, por exemplo, "12test".</font></font><br>
<br>
<img src="https://habrastorage.org/webt/p3/wo/30/p3wo30wl9o4ep3sbfovnxegq2zw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como voc√™ pode ver, essa verifica√ß√£o n√£o nos permite inserir um comando de texto. No entanto, se voc√™ olhar na parte inferior do c√≥digo, ver√° a mesma verifica√ß√£o, s√≥ que desta vez o aplicativo verifica a condi√ß√£o n &lt;0. Agora, se inserirmos "12test", n√£o passaremos no teste, porque o aplicativo considerar√° que a express√£o fornecida como uma string n√£o √© menor que 0. Mas se inserirmos uma string com uma verifica√ß√£o de desigualdade no formul√°rio! ("12test" &lt;0), o sistema considerar√° verdadeiro , apesar de n√£o ser um n√∫mero inteiro e nem um n√∫mero, mas uma combina√ß√£o alfanum√©rica. Em ess√™ncia, isso significa que podemos inserir neste comando uma sequ√™ncia arbitr√°ria que ser√° enviada ao dongle. Isso nos permite enviar o c√≥digo de explora√ß√£o da mesma maneira que fizemos antes para comprometer o dongle atrav√©s do analisador JSON. A √∫nica diferen√ßa √© que agora isso pode ser feito via Internet.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/br/ep/cv/brepcvtjvqntad29bb6yrjzvmqg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, gra√ßas a um erro na implementa√ß√£o do filtro para verificar os dados recebidos, tivemos a oportunidade de comprometer remotamente o dongle por meio do aplicativo Lovense, atrav√©s do qual, por sua vez, podemos quebrar o computador do usu√°rio. Hackear um dongle √© √≥timo, mas a condi√ß√£o para o sucesso √© o consentimento do parceiro em transferir o controle remoto do brinquedo para o atacante disfar√ßado. Isso √© conveniente para um ataque direcionado, mas completamente inadequado para um ataque viral. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, o bate-papo e as imagens de texto n√£o exigem nenhuma permiss√£o, o que permite perfeitamente um ataque cl√°ssico ao XSS enviando c√≥digo HTML malicioso em uma mensagem de texto do bate-papo. A distribui√ß√£o do v√≠rus se torna trivial: basta criar a fun√ß√£o JavaScript correta e enviar spam a seus amigos.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kh/l_/8x/khl_8xhfj3bvdiisecommxrbloe.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse est√°gio, podemos executar o c√≥digo apenas enviando uma mensagem e basicamente alcan√ßamos nosso objetivo. </font><font style="vertical-align: inherit;">A carga √∫til final do XSS funciona assim:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fa√ßa tudo o que deve acontecer na m√°quina da v√≠tima.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pegue um objeto JavaScript que permita acessar o bate-papo.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Envie uma carga XSS que baixa esse script para os computadores de todos os seus amigos.</font></font></li>
</ol><br>
<img src="https://habrastorage.org/webt/8_/x5/6c/8_x56cslpr-tywovkeqgo7qbml0.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim, comprometemos todos os n√≥s da rede, desde o plug-in de inicializa√ß√£o at√© a Internet. </font><font style="vertical-align: inherit;">Agora voc√™ pode comprometer qualquer dispositivo a partir de qualquer dispositivo - criamos um butt worm ou um v√≠rus chamado "ass worm".</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gj/iq/lu/gjiqlujshp5vcsj5tm-hv6cbl8q.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como prometi, agora vou mostrar um v√≠deo ao vivo. A primeira coisa que mostrarei √© usar o conector BTLE para interceptar a conex√£o entre o plug-in de inicializa√ß√£o e a m√°quina virtual normal do Windows √† qual o dongle est√° conectado. Agora vou tentar ativar o bootplag - espero que todos voc√™s ou√ßam os sons da vibra√ß√£o! (riso). Ent√£o, funcionou, agora vou tentar adicionar meu brinquedo ao painel de controle do aplicativo. Veja que o programa encontrou o Hush, mas espere um minuto! Esqueci de iniciar o processo do conector BTLE. O √∫nico motivo pelo qual voc√™ precisa usar o conector BTLE nesse modo √© porque facilita a demonstra√ß√£o ao vivo, mas, na pr√°tica, voc√™ pode interceptar uma conex√£o existente sem a necessidade de farejar. Ent√£o, estou lan√ßando essa coisa apenas para simplificar o experimento. Vamos repetir tudo de novo. Voc√™ v√™ que a conex√£o com o brinquedo est√° estabelecida.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nz/v6/_h/nzv6_hy7ygt8gu9nqx7opfjz6-u.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O farejador √† esquerda mostra que encontrou essa conex√£o. Portanto, temos um aplicativo associado ao nosso brinquedo sexual. N√£o sei se voc√™ sabe que eu realmente posso controlar o plug-in de inicializa√ß√£o (smea move o controle deslizante para cima, ap√≥s o qual um som amplificado de vibra√ß√£o √© ouvido). Agora desligo essa coisa (move o controle deslizante para baixo, o som da vibra√ß√£o desaparece). Agora eu preciso invadir essa conex√£o. Para fazer isso, copio v√°rios par√¢metros, colo-os na linha smea @ ubuntu e, no final, insiro o par√¢metro t - um comando para interceptar a conex√£o.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/u4/cm/bo/u4cmbo-uglzsqjur_ikimj7lifg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se isso funcionar, ele eliminar√° a conex√£o com o aplicativo. Como voc√™ pode ver, uma mensagem apareceu na janela do aplicativo informando que a conex√£o com o dispositivo foi perdida. Obrigado jack BTLE por uma √≥tima ferramenta! O log de inicializa√ß√£o desconectou-se do aplicativo e agora √© controlado pela m√°quina virtual do ubuntu. Teoricamente, devemos ser capazes de faz√™-lo vibrar remotamente. Eu digito a equipe Vibrate 20 e, como voc√™ pode ver, tudo funciona - fomos capazes de controlar remotamente o bootplag sem a ajuda do aplicativo oficial (aplausos da plat√©ia). Agora vou coloc√°-lo no modo DFU e, se funcionar, terei que parar com isso. Entro no comando apropriado e a vibra√ß√£o para.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/1-/e4/xa/1-e4xaksu_5edfbsymanvlja6ii.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora pego meu smartphone e verifico se consigo reconectar o brinquedo atrav√©s do aplicativo. Entre meus aplicativos, encontro a atualiza√ß√£o do plug-in de firmware e seleciono o DfuTarg de destino - o dispositivo no qual √© necess√°rio atualizar o firmware, mas de fato - introduzo uma explora√ß√£o maliciosa nele. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yj/ft/wt/yjftwtho753czqelp_td1n8gtq4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ v√™ como √© o processo de atualiza√ß√£o. Uma mensagem aparece na tela informando que o firmware do dispositivo foi atualizado com sucesso. Agora vou tentar novamente conectar o bootplag ao aplicativo instalado no meu computador, e voc√™ v√™ o que acontece: o protetor de tela ransomware aparece na tela (aplausos da plat√©ia)! </font></font><br>
<br>
<img src="https://habrastorage.org/webt/o6/fz/tj/o6fztjlfigtenb5mujgp6ukz9ho.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚ÄúOpa, seu plug anal est√° criptografado! Pague pela restaura√ß√£o do acesso a este importante brinquedo com US $ 50 bitcoins em 3 dias; caso contr√°rio, em uma semana voc√™ o perder√° para sempre. ‚Äù Veja como funciona!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o, voc√™ executou o c√≥digo no dongle, depois no computador e pela Internet chegou ao plug-in de inicializa√ß√£o. Como voc√™ pode ver, em termos de seguran√ßa, esse plug anal √© muito fraco, provavelmente foi fabricado pela Cor√©ia do Norte. Voc√™ viu que eu tinha uma m√°quina virtual instalada que executava o aplicativo sem estar conectada a um dongle ou outro hardware. Esta VM estava conectada √† Internet e parecia estar conectada ao computador do meu amigo. Portanto, conseguimos com sucesso a dissemina√ß√£o viral do ransomware.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penso que com tudo o que foi dito, algumas li√ß√µes √∫teis podem ser aprendidas. Usando este dispositivo como exemplo, examinamos o qu√£o vulner√°vel o mundo da Internet pode ser. Alguns dispositivos s√£o usados ‚Äã‚Äãpara suporte √† vida e as pessoas n√£o percebem o qu√£o vulner√°veis ‚Äã‚Äãs√£o essas novas tecnologias. Ao invadir uma coisa ‚Äúinteligente‚Äù, voc√™ pode conectar outros dispositivos ‚Äúinteligentes‚Äù em sua casa via Internet. Espero que o resultado da minha pesquisa seja aplic√°vel n√£o apenas aos brinquedos sexuais. Al√©m disso, pretendo aprender todo o c√≥digo para isso, ent√£o junte-se a mim no Twitter. Tamb√©m vou publicar minhas ferramentas no GitHub hoje, caso voc√™ queira come√ßar a invadir seus pr√≥prios bootloops.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wp/45/wc/wp45wcacsbefq8-9i-6p3k-qqmg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quero agradecer a todos os meus amigos que me ajudaram nos penteados e me apresentaram o mundo dos plugues de batalha, sendo gays extremos. </font><font style="vertical-align: inherit;">Eu n√£o vou dar nomes, mas Aaron, voc√™ mesmo sabe quem √© (risos). </font><font style="vertical-align: inherit;">Obrigado pessoal, isso foi incr√≠vel!</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/RnxcPeemHSc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um pouco de publicidade :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obrigado por ficar com a gente. Voc√™ gosta dos nossos artigos? Deseja ver materiais mais interessantes? Ajude-nos fazendo um pedido ou recomendando aos seus amigos o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS baseado em nuvem para desenvolvedores a partir de US $ 4,99</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , um </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">anal√≥gico exclusivo de servidores </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b√°sicos </font></font></a><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">que foi inventado por n√≥s para voc√™: </font></b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">Toda a verdade sobre o VPS (KVM) E5-2697 v3 (6 n√∫cleos) 10GB DDR4 480GB SSD 1Gbps de 10GB de US $ 19 ou como dividir o servidor?</font></a><font style="vertical-align: inherit;"> (as op√ß√µes est√£o dispon√≠veis com RAID1 e RAID10, at√© 24 n√∫cleos e at√© 40GB DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2 vezes mais barato no data center Equinix Tier IV em Amsterd√£?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Somente n√≥s temos </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 TVs Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV a partir de US $ 199</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na Holanda!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - a partir de US $ 99! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leia sobre</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> como construir infraestrutura </font><font style="vertical-align: inherit;">classe c usando servidores Dell R730xd E5-2650 v4 que custam 9.000 euros por um centavo?</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt495782/index.html">FOSS News No. 10 - revis√£o de not√≠cias gratuitas e de c√≥digo aberto de 30 de mar√ßo a 5 de abril de 2020</a></li>
<li><a href="../pt495784/index.html">SamsPcbGuide, Parte 14: Tecnologia - Microdesenvolvimento e tecnologia de chip integrado</a></li>
<li><a href="../pt495786/index.html">Anula√ß√£o global</a></li>
<li><a href="../pt495788/index.html">Um dispositivo de um coronav√≠rus ou outro carrinho de um peda√ßo de p√£o?</a></li>
<li><a href="../pt495790/index.html">Troca como ferramenta para prote√ß√£o de riscos: por que precisamos de futuros incomuns</a></li>
<li><a href="../pt495794/index.html">Sobre verbos frasais</a></li>
<li><a href="../pt495796/index.html">Escolhendo cart√µes flash: um guia detalhado para proteger variedades digitais</a></li>
<li><a href="../pt495798/index.html">Kubernetes em 3 dias. Quase complicado</a></li>
<li><a href="../pt495800/index.html">Se eu ensinasse Frontend hoje. Dicas para iniciantes</a></li>
<li><a href="../pt495802/index.html">O resumo de materiais frescos do mundo do front-end da √∫ltima semana n¬∫ 409 (30 de mar√ßo a 5 de abril de 2020)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>