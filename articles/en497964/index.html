<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ÜîÔ∏è üåº üòÆ Telemedicine. Reverse Engineering Electronic Stethoscope üèµÔ∏è üíü üëî</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I‚Äôve been engaged in the development of electronics for more than 10 years, but it somehow happened that my first project in the field of medicine onl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Telemedicine. Reverse Engineering Electronic Stethoscope</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/497964/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ia/e-/xv/iae-xv2nrkl_avl3oitfn0omrmc.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 I‚Äôve been engaged in the development of electronics for more than 10 years, but it somehow happened that my first project in the field of medicine only appeared last year, </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and after that I didn‚Äôt get off this topic</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">As usual in such cases, the development, it was decided to start with the study of prototypes. </font><font style="vertical-align: inherit;">In this article I want to share the side results of the reverse engineering of the fetus of a telemedicine startup with Chinese roots - an electronic stethoscope. </font><font style="vertical-align: inherit;">If you are interested in what the insides of a typical representative of startups in the field of telemetry, launched in the early 2010s, are hidden, and why such a circuit design solution was chosen, you are welcome to cat.</font></font><br>
<a name="habracut"></a><br>
<img src="https://habrastorage.org/webt/wz/sf/8h/wzsf8hu2ps5h83v6zqjekrlitkm.jpeg"><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Click if you don‚Äôt know, but what kind of beast is this - a stethoscope?</font></font></b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/webt/tg/zm/o_/tgzmo_gbiuhuxupdue9oczu2rna.jpeg" align="left">C    ,           .       ,    , , , .         :  (   ),  ( )   (   ).   ¬´¬ª         <i></i>.     ¬´¬ª ,      ,    .<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Despite the fact that the guys started with their project in Australia, they managed to raise the first round of investments only in China. </font><font style="vertical-align: inherit;">Given that the backbone of the team was from the Eternal Empire, and China has a serious government program to help startups, this is not at all surprising. </font><font style="vertical-align: inherit;">However, we were distracted, the topic of this article is the internal structure of the device, and not the history of the startup's development. </font><font style="vertical-align: inherit;">About this, perhaps next time.</font></font><br>
<br>
<h3><font color="#66a3be"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's look inside the package</font></font></font></h3><br>
<img src="https://habrastorage.org/webt/4s/jh/4d/4sjh4d1l79ym65zknzg2ucr7fqe.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Looking inside, an extremely high-quality cardboard packaging, we find a pleasant-to-touch case with two devices. The one that is larger and extended like a crocodile is a non-contact thermometer. Round is our today's patient, a stethoscope. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The guys missed a lot with the thermometer - not only did the stability of the measurements turn out to be extremely low, but the reliability of the work also let us down. For reverse engineering, we bought a used device and the non-contact thermometer in it turned out to be faulty. So let's focus on the stethoscope. First, let's take a closer look at the connecting cable.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/on/vu/ed/onvued1yqhfjrdrzkwvvfrmjd-0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can see that on the one hand it ends with an audio jack, and on the other hand with a microUSB connector. </font><font style="vertical-align: inherit;">Why is it easier to understand if you mentally travel back to 2012 - the year the startup was born. </font><font style="vertical-align: inherit;">In those days, on Kickstarter, you could find a huge number of a wide variety of devices connected to the gadget in such an exotic way. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All of them were designed primarily to work with the then generation of the iPhone. </font><font style="vertical-align: inherit;">He did not have a USB connector, and the organization of signal transmission over wireless channels with him was extremely difficult. </font><font style="vertical-align: inherit;">Therefore, the gadgets were connected via an audio cable, through a headset jack, and the exchange of commands was carried out using audio signals encoded by the frequency and duration of the packets. </font><font style="vertical-align: inherit;">It is this principle of communication that is also used in our experimental subject. </font><font style="vertical-align: inherit;">It‚Äôs time, however, to look under his hood!</font></font><br>
<br>
<h3><font color="#66a3be"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It's time to move on to the details</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The cast metal case consists of two halves connected by a thread. Inside the case are two scarves. One of them is not worthy of our attention - only the holder of a three-volt battery is not located in it, but the second is worth considering in more detail and even on both sides. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tu/z-/ry/tuz-ryxmpnm7o9dn3k_vxs8mxtk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On the left side of the boards we see a microUSB connector. The choice fell on him because it is much smaller in size than a standard audio jack with a diameter of 3.5 mm. The upper part of the board is shown on the right. It houses numerous power-blocking capacities and protective elements in three-lead SOT23 cases resembling transistors. Recall that we are dealing with a medical device, and even the simplest level of certification requires them.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mn/m5/2k/mnm52kdjcnt5ivaegxqujoegyo8.jpeg" align="left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The heart, and part-time and ear, of this device is certainly a microphone. A cheap electret, which, similarly to a headset microphone, can be powered from a phone, cannot be used here. Useful information of sound signals arriving at the headset of a stethoscope / phonendoscope lies in the range from 20 Hz to Hz 600. The lower range is limited by the frequency properties of the ear, the upper maximum frequency in which the noise of the heart and internal organs are located. Finding a compact microphone with such a frequency response is not easy. This device used an analog microphone manufactured by MEMS technology. The signal from it, without any additional amplification, entered the audio section of the smartphone. The microphone was carefully covered with a rubber pad, which I took off for a better view.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For convenience, I assigned numbers to the key components, and depicted below a greatly simplified functional diagram of the device. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2s/ba/9g/2sba9gvzfwhncjwhthrjx27aols.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It would seem that it is enough to put a microphone with a battery and not complicate everything with additional chips. However, even in the absence of an input signal, the current consumption of the microphone is enough to drain the battery in a few days. Of course, it would be possible to install a small-sized mechanical switch on the instrument case, but this is not the way of the Jedi, primarily because it is easy to forget to turn it off or, on the contrary, accidentally turn it on. As a result, at a time when you urgently need to listen to the patient‚Äôs lungs, the device will be inoperative. For medical applications, this is not at all buzzing, you can even say more - is unacceptable.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Our Chinese, reluctantly, had to go on to complicate the scheme. </font><font style="vertical-align: inherit;">First of all, they added a microcontroller from the STM32L series with ultra-low consumption </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (For low- </font><font style="vertical-align: inherit;">power </font><font style="vertical-align: inherit;">microcontrollers, see </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">one of my previous articles</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) Then they installed a voltage regulator in the power supply circuit of microphone </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and finally went bankrupt on an analog switch chip. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The following functions are assigned to the control microcontroller:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microphone Power Supply</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Determination of the voltage level of the battery and, if necessary, the formation of a signal about its imminent discharge</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detection of a control sinusoidal audio signal from a smartphone</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Generation of an analog sinusoidal signal for the process of data exchange with a smartphone</font></font></li>
<li>   ,      </li>
</ul><br>
<h3><font color="#66a3be">    </font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After the user applies a stethoscope to the body of a person, he presses the button located on the screen of the smartphone. The smartphone sends a control audio sequence in which the listening time is encoded. She goes to the comparator microcontroller. Having sensed a voltage drop at its input, the microcontroller interrupts the state of deep sleep, decrypts the input signal and sends a response sound sequence containing information about the battery level to the microphone input of the phone. After that, the microcontroller supplies power to the microphone for a specified time and switches the audio switch to the mode of transmitting the signal from the microphone to the microphone input of the phone. At the end of a predetermined period of time, everything returns to its original state and the microcontroller plunges into deep sleep.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The smartphone uses the firmware to record the audio signal as a file in its own memory. </font><font style="vertical-align: inherit;">In the future, you can listen to it, view it on the smartphone screen and even transfer it to the clouds for analysis and detailed processing.</font></font><br>
<br>
<h3><font color="#66a3be"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Device disadvantages</font></font></font></h3><br>
<img src="https://habrastorage.org/webt/ti/rp/pp/tirpppgemguddhyduwpotcp4r0u.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Like many medical first-wave startups, to which I refer projects launched in the early 2010s, this one ultimately crashed. </font><font style="vertical-align: inherit;">However, there is an idea to devote my next article to a detailed analysis of the reasons for the ups and downs of medical startups of that generation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this, I note only the obvious miscalculations associated with technical performance. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a small charge for the mind, I suggest finding obvious blunders by ourselves, and then open the spoiler and compare with those</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">which I noticed</font></font></b>
                        <div class="spoiler_text">         .  ,            .  ,              .<br>
<br>
<img src="https://habrastorage.org/webt/42/oq/qn/42oqqnjcar6ehfxecf_2wleltto.jpeg" align="left">  ,          ,     ,      .  ,      ,        ,        ,             . <br>
<br>
        ‚Äî  .         .   ,          .             ,                   .       ,    . ,             .<br>
</div>
                    </div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In conclusion, a big request to take a few seconds on a small but important poll for me. </font><font style="vertical-align: inherit;">Thank.</font></font></i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en497950/index.html">21 lessons learned in 21 years of programming</a></li>
<li><a href="../en497952/index.html">English abbreviations and IT titles that we mispronounce</a></li>
<li><a href="../en497956/index.html">Sars miraculous? Genealogy of Wuhan Coronavirus</a></li>
<li><a href="../en497958/index.html">They are among us: exploring vulnerabilities and malicious code in Zoom for Windows</a></li>
<li><a href="../en497960/index.html">Linux network installation</a></li>
<li><a href="../en497968/index.html">Web Developer Resources: APIs and UI Elements</a></li>
<li><a href="../en497980/index.html">How much water has leaked? We solve the problem by a moonwalk on Haskell</a></li>
<li><a href="../en497982/index.html">Functional and process approach to management. How and what to manage?</a></li>
<li><a href="../en497984/index.html">Migrating from reCAPTCHA to hCaptcha in Cloudflare</a></li>
<li><a href="../en497986/index.html">Monitoring all memory used by a webpage: performance.measureMemory ()</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>