<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘§ğŸ¾ ğŸ‘ƒğŸ¿ ğŸ¥„ Macro untuk pythonist. Laporan Yandex ğŸš½ ğŸ‘©ğŸ½â€ğŸ¤â€ğŸ‘¨ğŸ¾ ğŸ¤²ğŸ¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bagaimana saya bisa memperpanjang sintaks Python dan menambahkan fitur yang diperlukan untuk itu? Musim panas lalu di PyCon saya mencoba memahami topi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Macro untuk pythonist. Laporan Yandex</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/495294/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana saya bisa memperpanjang sintaks Python dan menambahkan fitur yang diperlukan untuk itu? </font><font style="vertical-align: inherit;">Musim panas lalu di PyCon saya mencoba memahami topik ini. </font><font style="vertical-align: inherit;">Dari laporan ini Anda dapat mengetahui bagaimana perpustakaan pola, macropy, pytest diatur dan bagaimana mereka mencapai hasil yang menarik. </font><font style="vertical-align: inherit;">Pada akhirnya ada contoh pembuatan kode menggunakan makro di HyLang, bahasa mirip Lisp yang berjalan di atas Python.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/IMkvg45Vw70" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Hai kawan. </font><font style="vertical-align: inherit;">Pertama-tama, saya ingin mengucapkan terima kasih kepada penyelenggara PyCon. </font><font style="vertical-align: inherit;">Saya seorang pengembang di Yandex. </font><font style="vertical-align: inherit;">Laporan ini bukan tentang pekerjaan sama sekali, tetapi tentang hal-hal eksperimental. </font><font style="vertical-align: inherit;">Mungkin mereka akan mengarahkan salah satu dari Anda pada gagasan bahwa dengan Python Anda dapat melakukan hal-hal keren yang bahkan tidak Anda ketahui sebelumnya, tidak berpikir ke arah ini.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sedikit bagi mereka yang tidak mengetahui apa itu makro: ini adalah metode pembuatan kode ketika beberapa ekspresi dalam bahasa diperluas menjadi kode yang lebih kompleks. </font><font style="vertical-align: inherit;">Apa barangnya untukmu? </font><font style="vertical-align: inherit;">Bagi Anda, catatan makro singkat, itu mengungkapkan beberapa abstraksi, tetapi itu banyak pekerjaan di bawah tenda untuk Anda, dan Anda tidak perlu menulis semua kode ini dengan tangan Anda.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pytest</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kemungkinan besar, Anda menemukan kerangka uji pytest, banyak di sini hampir pasti menggunakannya. Saya tidak tahu apakah Anda pernah memperhatikan, tetapi di bawah tenda ia juga melakukan sihir. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/al/o6/qv/alo6qvpzofmabtejvqqojenx31a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Misalnya, Anda memiliki tes sederhana. Jika Anda menjalankannya tanpa pytest, maka ia akan melempar AssertionError dengan sederhana. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ih/an/ck/ihanckzzqzelb5o87nfx9olt2vw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sayangnya, contoh saya sedikit merosot, dan di sini segera jelas bahwa len diambil dari daftar tiga elemen. Tetapi jika beberapa fungsi dipanggil, maka Anda tidak akan pernah tahu dari AssertionError sedemikian rupa sehingga fungsi tersebut dikembalikan. Dia mengembalikan sesuatu yang tidak sama dengan seratus. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cu/ko/sa/cukosarqifegg5uvzo14xneczkc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Namun, jika ini dijalankan di bawah pytest, maka itu akan menampilkan informasi debug tambahan. Bagaimana dia melakukannya di dalam?</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6h/g9/vr/6hg9vr5nedvvkvzxlsupjqor71a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sihir ini bekerja sangat sederhana. Pytest membuat kait khusus sendiri yang menyala ketika modul dengan tes memuat. Setelah itu, pytest secara independen mem-parsing file Python ini, dan sebagai hasil parsing, representasi perantara diperoleh, yang disebut AST-tree. Pohon AST adalah konsep dasar yang memungkinkan Anda untuk mengubah kode Python dengan cepat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah menerima pohon seperti itu, pytest memaksakan transformasi di atasnya yang mencari semua ekspresi yang disebut assert. Dia mengubahnya dengan cara tertentu, dia mengkompilasi pohon AST baru yang dihasilkan, dan dia mendapat modul dengan tes, yang kemudian berjalan pada Mesin Virtual Python biasa.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/t3/fj/x-/t3fjx-trld3abinbaqxioiizptg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti inilah bentuk pohon AST asli yang tidak dikonversi menjadi pytest. </font><font style="vertical-align: inherit;">Area merah yang disorot adalah Assert kami. </font><font style="vertical-align: inherit;">Jika Anda melihat lebih dekat, Anda akan melihat bagian kiri dan kanannya, daftar itu sendiri. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika pytest mengkonversi ini dan menghasilkan tahun baru, pohon itu mulai terlihat seperti ini. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yv/xh/qb/yvxhqbjsokha_vdwfn9-ksm0isi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada sekitar seratus baris kode yang dihasilkan pytest untuk Anda. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cu/fc/zi/cufczioilng0zfzx05nbrtwgl8g.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda mengubah pohon AST ini kembali ke Python, itu akan terlihat seperti ini. </font><font style="vertical-align: inherit;">Area yang disorot dengan warna merah di sini adalah tempat pytest menghitung bagian kiri dan kanan ekspresi, menghasilkan pesan kesalahan, dan memunculkan AssertionError jika ada yang salah dengan pesan kesalahan ini.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pencocokan pola</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa lagi yang bisa Anda lakukan dengan hal seperti itu? Anda dapat mengonversi kode Python apa pun. Dan ada satu perpustakaan indah yang saya temukan secara tidak sengaja di PyPI, menarik untuk digali di sana. Dia melakukan pencocokan pola. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3k/yb/eq/3kybeqrilpfpqnvj4bmeon62ibm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mungkin kode ini tidak asing bagi seseorang. Dia menganggap faktorial secara rekursif. Mari kita lihat bagaimana hal itu dapat direkam menggunakan pencocokan pola.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xy/cv/as/xycvassi6jwpp9getvm4sy4bbmm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk melakukan ini, cukup gantung dekorator pada fungsi. Harap dicatat: di dalam tubuh, fungsinya sudah bekerja secara berbeda. Masing-masing ifs adalah aturan untuk pencocokan pola, yang mem-parsing ekspresi yang merupakan input ke fungsi dan entah bagaimana mengubahnya. Selain itu, bahkan tidak ada pengembalian eksplisit dari hasilnya. Karena pustaka pola, ketika ia mentransformasikan fungsi tubuh, pertama, ia memeriksa bahwa ia hanya berisi jika, dan kedua, ia menambahkan pengembalian implisit dari hasilnya, sehingga mengubah semantik bahasa. Artinya, dia membuat DSL baru, yang bekerja sedikit berbeda. Dan berkat ini, Anda dapat menuliskan beberapa hal secara deklaratif. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3k/yb/eq/3kybeqrilpfpqnvj4bmeon62ibm.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fungsi sebelumnya seolah ditulis dalam tiga baris.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xy/cv/as/xycvassi6jwpp9getvm4sy4bbmm.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/pj/fm/ux/pjfmuxf4zsl_zpppzidv9oirkim.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan sisa baris menambahkan fungsionalitas tambahan yang memungkinkan, misalnya, membaca faktorial dari daftar nilai atau melewatkannya melalui fungsi sewenang-wenang. </font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana cara menulis konversi sendiri? </font><font style="vertical-align: inherit;">macropy!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang Anda mungkin bertanya-tanya, tetapi bagaimana Anda bisa menerapkannya sendiri? Karena itu membosankan untuk dilakukan, seperti pytest: file parse secara manual, cari kode yang perlu dikonversi. Dalam pytest, ini dilakukan oleh modul terpisah untuk seribu atau lebih baris. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agar tidak melakukan ini sendiri, beberapa orang pintar sudah membuat modul untuk kami yang disebut macropy. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Versi modul ini adalah untuk Python kedua dan ketiga. Mereka menulisnya kembali pada zaman Python kedua. Kemudian orang-orang punya lelucon untuk mencari tahu apa yang bisa dilakukan dengan Python, dan perpustakaan menyertakan berbagai contoh. Mari kita lihat mereka, mereka akan memberi Anda gambaran tentang apa yang dapat Anda lakukan dengan teknik ini. Hal keren pertama yang mereka jelaskan dalam tutorial adalah makro yang mengimplementasikan string format untuk Python kedua, seperti yang ketiga.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/er/3h/vv/er3hvvz7g-0edq1spxz5bukrk3q.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ekspresi yang disorot dengan warna merah hanyalah sintaks dari panggilan makro. Huruf S adalah nama makro, dan kemudian dalam tanda kurung siku adalah ekspresi yang dikonversi. Akibatnya, variabel diganti di sini. Ini berfungsi dalam Python kedua, tetapi yang ketiga tidak lagi diperlukan dalam makro seperti itu. Jadi, misalnya, Anda dapat membuat makro Anda sendiri, yang mengimplementasikan semantik yang lebih kompleks dan melakukan lebih banyak hal menyenangkan daripada string format standar.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jw/bf/hx/jwbfhxtuxzzrbjd-vvu3rhdsok8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika makro berkembang, dan ini terjadi pada saat memuat modul, itu hanya mengkonversi ke kode itu. Placeholder dimasukkan ke dalam format string dan prosedur substitusi diterapkan padanya. Selanjutnya Python sudah dengan cara standar mengkompilasi semua ini. Dalam runtime, tidak ada ekspansi makro yang terjadi. Semua itu terjadi ketika modul dimuat. Oleh karena itu, pada hal seperti itu, Anda bahkan dapat membuat optimasi atau perhitungan yang akan terjadi pada saat memuat modul dan menghasilkan bytecode yang lebih optimal. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2i/gz/9t/2igz9tsitqjebyuxpln51mhknra.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Contoh kedua juga menarik. Ini adalah notasi singkat untuk menulis lambda. Makro f mengambil serangkaian argumen dan mengembalikan fungsi sebagai gantinya. Setiap ekspresi dimulai dengan nama makro "f", tanda kurung, dan kemudian benar-benar ekspresi apa pun dikonversi ke lambda.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/l5/vq/ym/l5vqym-i-69vtjohomf2nsxfsj0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menurut pendapat saya, ini juga keren, terutama bagi mereka yang suka mengembangkan dan menulis kode dalam gaya fungsional dan menggunakan MapReduce. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0j/fx/xc/0jfxxcdmblyze8e4bcxqrqrgaoy.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini adalah contoh lain yang sudah dikenal. Fungsi ini mempertimbangkan faktorial, kode disorot dengan warna merah. Apa yang akan terjadi ketika dia dipanggil? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ov/gj/v0/ovgjv0vqgcbzx0wxy5q-kuvozzg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini akan melempar kesalahan dalam Python, karena akan berjalan ke batas tumpukan dan akan ada RecursionError yang jelek. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wi/zz/1h/wizz1haarmzw9is0q0k3n_r6mji.jpeg" width="600"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagaimana ini bisa diperbaiki? Menggunakan macropy, memperbaiki masalah sangat sederhana. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wc/ej/-n/wcej-na40treik2p0hkdp1jfbns.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda menggantung dekorator, dibutuhkan fungsi tubuh dan mengubahnya dengan cara ajaib. Anda tidak perlu mengubah apa pun dalam fungsi itu sendiri, makropi akan melakukan segalanya untuk Anda. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xc/c8/ld/xcc8ldcmcykmbaxjceek4xsgrka.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan fungsinya akan kembali ke hasil yang cukup normal, pergi jauh ke bawah tanah. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ek/uq/mi/ekuqmigu-x5hhmdyyy8q04wob5c.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagaimana macropy melakukannya?</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fz/1r/5f/fz1r5ff8_v-egywcvufzvw-zsec.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini menggantikan semua panggilan ke fungsi itu sendiri dengan objek TailCall khusus, yang kemudian dipanggil secara loop oleh dekorator TCO. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dg/25/5b/dg255bb2t_mzo9ku4ucwq-uz31o.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rangkaiannya terlihat seperti ini. Dekorator dalam loop memanggil fungsi hingga mengembalikan beberapa hasil normal alih-alih TailCall. Dan jika dia kembali, maka kembalikan. Dan itu saja. Hal-hal keren ini bisa dilakukan dengan makro! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Makropi juga termasuk contoh lain. Saya harap mereka yang penasaran dengan Anda pergi dan melihatnya sendiri. Katakanlah ada beberapa hal yang berguna untuk debugging.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wd/hg/rq/wdhgrqonz6lfdcicgdynvnfipfs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya akan bercerita tentang hal keren lainnya. Salah satu contoh adalah makro kueri ini. Apa yang dia lakukan? Di dalamnya, Anda menulis kode Python biasa, yang kemudian dapat Anda gunakan sebagai hasil biasa dari mengeksekusi ungkapan ini. Tapi di dalam, makropi mengubah kode ini dan membuatnya menjadi kode bahasa query Alchemy SQL. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ag/qb/jk/agqbjkyzfbun_tbdnjxww5lutms.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dia menulis ulang untukmu, membuat ekspresi yang mengerikan ini. Itu dapat ditulis ulang dengan tangan, maka akan lebih pendek. Saya melakukannya. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4k/ts/5w/4kts5wogftqmpcceukufkib56be.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inilah ekspresi aslinya. Setelah memperluas makro, dibutuhkan sesuatu seperti ini. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/du/i0/uv/dui0uvfpouzuuioj2tmirtfyg5c.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mungkin seseorang tertarik untuk menulis kode yang lebih mirip dengan Python, dan tidak memaksa pengembang mereka untuk menulis kueri pada DSL Alchemy SQL.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan cara yang sama, Anda dapat menghasilkan apa pun dari Python - SQL murni, JavaScript - dan simpan di suatu tempat di sebelah file, lalu gunakan di frontend. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kk/s3/j3/kks3j3s2wwep0vejhof8-3fw-oq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang mari kita lihat bagaimana membuat makro Anda sendiri. Dengan macropy, itu sangat sederhana. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Makro adalah fungsi yang mengambil pohon AST pada input dan, entah bagaimana mengubahnya, mengembalikan yang baru. Berikut adalah contoh makro yang menambahkan deskripsi ke panggilan tegas yang berisi ekspresi sumber sehingga kita bisa memahami mengapa kesalahan AssertionError terjadi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini, fungsi replace_assert internal adalah pembantu. Dia melakukan keturunan rekursif di pohon untuk Anda. Di dalam replace_assert, elemen subtree dilewatkan.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3u/qn/wa/3uqnwavrca79l0wumgmnfxfcm58.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena ini, Anda dapat memeriksa jenis dan dalam? jika ini panggilan yang tegas, lakukan sesuatu dengannya. Di sini saya akan memberikan contoh sintetis sederhana yang mengambil bagian kiri, bagian kanan, membuat pesan kesalahan dari mereka, dan menulis semuanya ke atribut msg. Ini adalah pesan yang perlu dikembalikan. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rf/re/hn/rfrehnypphthxdzqbjwehtj3fas.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/va/ak/jm/vaakjmq4tpgqjwttqmi8nepgtym.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/x7/hq/cs/x7hqcswjuj59uhp5thatiojofja.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat menggunakannya, Anda melampirkan makro seperti itu ke blok kode menggunakan dengan konteks konteks, dan semua kode yang masuk ke dalam konteks konteks melewati transformasi ini. Terlihat di bawah ini bahwa pesan kesalahan kami telah ditambahkan ke AssertionError, yang kami bentuk dari ekspresi len ([1, 2, 3]).</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yo/zo/zc/yozozclanvtdlinutuvnl58puve.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Namun, metode ini memiliki satu keterbatasan yang membuat saya pribadi sedih. </font><font style="vertical-align: inherit;">Saya mencoba sebagai percobaan untuk membuat desain baru yang akan berfungsi dalam bahasa tersebut. </font><font style="vertical-align: inherit;">Sebagai contoh, beberapa orang menyukai switch atau konstruksi kondisional seperti kecuali. </font><font style="vertical-align: inherit;">Tetapi sayangnya, ini tidak mungkin: makropi dan alat lain yang bekerja dengan pohon AST digunakan ketika kode sumber sudah dibaca dan dipecah menjadi token. </font><font style="vertical-align: inherit;">Kode ini dibaca oleh parser Python, yang tata bahasanya diperbaiki pada interpreter. </font><font style="vertical-align: inherit;">Untuk mengubahnya, Anda perlu mengkompilasi ulang Python. </font><font style="vertical-align: inherit;">Tentu saja, Anda bisa melakukan ini, tetapi itu sudah menjadi garpu dari Python, dan bukan perpustakaan yang bisa diletakkan di PyPI. </font><font style="vertical-align: inherit;">Oleh karena itu, konstruksi seperti itu tidak mungkin menggunakan makropi.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HyLang</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untungnya, untuk umur panjang saya, saya menulis tidak hanya dengan Python dan tertarik pada berbagai bahasa alternatif lainnya. Ada sintaksis yang banyak tidak suka, tetapi lebih sederhana dan fleksibel. Ini adalah ekspresi-s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untungnya bagi kami, ada add-in Python yang disebut HyLang. Hal ini agak mengingatkan pada Clojure, hanya Clojure yang berjalan di atas JVM, dan HyLang berjalan di atas Python Virtual Machine. Artinya, ini memberi Anda sintaks baru untuk menulis kode. Tetapi pada saat yang sama, semua kode yang Anda tulis akan sepenuhnya kompatibel dengan pustaka Python yang ada, dan dapat digunakan dari pustaka Python. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/54/sc/rr/54scrrucaeden67utnbyx3jva0i.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Itu terlihat seperti ini.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qo/vr/w7/qovrw7a-mivofegxjhx61jtlky0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagian di sebelah kiri ditulis dengan Python, di sebelah kanan - di HyLang. Dan dari bawah untuk keduanya adalah bytecode, yang hasilnya. Anda mungkin memperhatikan bahwa itu persis sama, hanya sintaks yang berubah. Ekspresi HyLang, yang tidak disukai banyak orang. Penentang "kurung" tidak mengerti bahwa sintaksis seperti itu memberikan kekuatan yang luar biasa pada bahasa karena memberikan keseragaman pada konstruksi bahasa. Dan keseragaman memungkinkan Anda menggunakan makro untuk mengimplementasikan desain apa pun. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini dicapai karena fakta bahwa di dalam setiap ekspresi elemen pertama selalu semacam tindakan. Dan kemudian argumennya pergi.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan semua kode terdiri dari ekspresi bersarang yang mudah dikonversi dan membuka makro di sana. Karena ini, tentu saja konstruksi apa pun dapat dibuat di HyLang, baru, yang sama sekali tidak dapat dibedakan dalam kode dari fitur standar bahasa. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/o5/-u/rw/o5-urwww9tzewkt4ufq7krycxj8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita lihat bagaimana makro sederhana bekerja di HyLang. Untuk melakukan hal yang sama yang kami lakukan dengan Assert menggunakan macropy, Anda hanya perlu kode ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Makro HyLang kami menerima input, yaitu kode. Lebih lanjut, makro dapat dengan mudah menggunakan bagian mana pun dari kode ini untuk membuat kode baru. Perbedaan utama antara makro dan fungsi: ekspresi adalah input, bukan nilai. Jika kami menyebut makro kami sebagai (is (= 1 2)) maka ia akan menerima ekspresi (= 1 2) alih-alih Salah.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/uc/5b/az/uc5bazq37xtwjlsbaf54_kpe8zu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi kami dapat membuat pesan kesalahan bahwa ada sesuatu yang salah. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hn/a9/cm/hna9cmzwxvf87k5e4i0py87cs84.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan kemudian kembalikan kode yang baru. Sintaks backtick dan tilde ini memiliki arti seperti berikut ini. Kutipan belakang mengatakan: ambil ungkapan ini apa adanya dan kembalikan seperti apa adanya. Dan tilde mengatakan: gantilah nilai variabel di sini. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pi/qn/en/piqnenjm28v8jm0i-hfsdx3ib18.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oleh karena itu, ketika kami menulis ini, makro pada ekspansi akan kembali kepada kami ekspresi baru, yang karenanya akan ditegaskan dengan pesan kesalahan tambahan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hyang adalah hal yang keren. </font><font style="vertical-align: inherit;">Benar, sementara kita tidak menggunakannya. </font><font style="vertical-align: inherit;">Mungkin kita tidak akan pernah melakukannya. </font><font style="vertical-align: inherit;">Semua item ini bersifat eksperimental. </font><font style="vertical-align: inherit;">Saya ingin Anda pergi dari sini dengan perasaan bahwa dengan Python Anda dapat melakukan beberapa hal yang mungkin tidak pernah terpikirkan sebelumnya. </font><font style="vertical-align: inherit;">Dan mungkin beberapa dari mereka akan menemukan aplikasi praktis dalam pekerjaan Anda yang sedang berlangsung. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Itu semua untuk saya. </font><font style="vertical-align: inherit;">Anda dapat melihat tautannya:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pola</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MakroPy</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HyLang</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Buku OnLisp</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - untuk studi lanjutan tentang kemampuan makro. </font><font style="vertical-align: inherit;">Ini untuk mereka yang sangat tertarik. </font><font style="vertical-align: inherit;">Benar, buku ini tidak sepenuhnya didasarkan pada Python, tetapi pada Common Lisp. </font><font style="vertical-align: inherit;">Tetapi untuk studi yang lebih dalam, ini bahkan akan menarik.</font></font></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id495278/index.html">Database, kartu, daftar periksa, atau Mengapa manajer pengetahuan bisnis</a></li>
<li><a href="../id495280/index.html">Max Patrol SIEM. Keamanan Informasi Ikhtisar Sistem Manajemen Kejadian</a></li>
<li><a href="../id495282/index.html">Validasi XML menggunakan XSD, JAXB, dan Spring Framework</a></li>
<li><a href="../id495290/index.html">Menjelajahi kualitas kode sistem operasi Zephyr</a></li>
<li><a href="../id495292/index.html">InterSystems IRIS 2020.1 Rilis</a></li>
<li><a href="../id495296/index.html">Forensik, injeksi SQL, dan kucing yang lama menderita: analisis tugas No. 3 dari panggung online NeoQUEST-2020</a></li>
<li><a href="../id495298/index.html">Evaluasi Pilihan Monte Carlo Clojure</a></li>
<li><a href="../id495302/index.html">Cara meningkatkan penjualan 2,5 kali dalam 4 bulan di toko online - sebuah kasus untuk promosi SEO</a></li>
<li><a href="../id495304/index.html">Peremajaan sel manusia karena pemrograman ulang mereka</a></li>
<li><a href="../id495308/index.html">Menyapu jalan untuk tetap hidup</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>