<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üñ±Ô∏è üíü üêÜ Uma l√¢mpada inteligente para os "ricos" com as m√£os "pregui√ßosas", √© "simples" e conveniente üë∞üèº üë®üèª‚Äçüéì üçø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introdu√ß√£o
 Ele fez uma ilumina√ß√£o ‚Äúmoderna‚Äù na cozinha para uma pia, fog√£o e mesa de corte com base em uma faixa de LED sob o controle do arduino (qu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Uma l√¢mpada inteligente para os "ricos" com as m√£os "pregui√ßosas", √© "simples" e conveniente</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488480/"><img src="https://habrastorage.org/webt/os/hi/gl/oshiglmjknpmabuu6ivivauqzdw.jpeg"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introdu√ß√£o</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ele fez uma ilumina√ß√£o ‚Äúmoderna‚Äù na cozinha para uma pia, fog√£o e mesa de corte com base em uma faixa de LED sob o controle do arduino (que seja chamada l√¢mpada 1). </font><font style="vertical-align: inherit;">Esse design funcionou por 2 anos, at√© que a parte de poder dos "c√©rebros" se deteriorou. </font><font style="vertical-align: inherit;">Esta √© uma excelente ocasi√£o para reinventar a roda do ‚Äúlixo improvisado‚Äù novamente (l√¢mpada 2). </font><font style="vertical-align: inherit;">√â verdade que desta vez o "lixo" ser√° caro e compat√≠vel com a casa inteligente Z-wave. </font><font style="vertical-align: inherit;">A seguir, a hist√≥ria da substitui√ß√£o do arduino pelo ZUNo (um m√≥dulo compat√≠vel com arduino para criar um dispositivo de onda Z) com economia m√°xima de c√≥digo e uma explica√ß√£o das altera√ß√µes necess√°rias.</font></font><br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que aconteceu antes de eu aparecer l√°</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Era uma vez, para lavar a lou√ßa ou cozinhar alimentos, era necess√°rio acender a l√¢mpada acima da pia. </font><font style="vertical-align: inherit;">Era um candeeiro de mesa refeito. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o gostei de pressionar o pequeno interruptor com as m√£os molhadas, porque ele trocou 220 volts para a l√¢mpada incandescente. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tl/yz/dq/tlyzdqgfcsedxxsswsqlekygins.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, a luz da l√¢mpada caiu principalmente sobre a pia, mas eu queria iluminar melhor a mesa e o fog√£o. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objetivos.</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fa√ßa a luz ligar / desligar na cozinha sem contato;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Iluminar uniformemente a pia, mesa de cozinha e fog√£o;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Economize energia substituindo l√¢mpadas incandescentes por LEDs.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ele montou a l√¢mpada 1. Consistia em uma caixa de alum√≠nio de 2 metros com um difusor para fita RGB e uma unidade de controle. Uma caixa e um difusor foram comprados prontos na loja, havia uma fita e a unidade de controle j√° estava h√° muito tempo no canto e aguardava nos bastidores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O caso era industrial (√† prova de poeira, √† prova d'√°gua). Como a fita tem 12 volts, a fonte de alimenta√ß√£o de 220 V a 12 V est√° localizada na unidade, o painel de isolamento galv√¢nico para controlar a fita com base no TLP250 (acoplador √≥ptico) tamb√©m controlava todo esse arduino em um design compacto.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Consegui o isolamento galv√¢nico do projeto antigo. Uma vez, criei uma luz de fundo para um minibar na minha mesa de cabeceira. Quando a porta foi aberta, o touch pad registrou uma altera√ß√£o na capacidade e acendeu uma luz suave e cintilante. Ou seja, o conselho era adequado para o projeto atual, tudo o que restava era cortar tudo o que era desnecess√°rio. Havia um conversor linear de 5 volts na placa, alimentado por ZUNo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Foi planejado acender a l√¢mpada com uma bandeja manual no medidor de dist√¢ncia ultrass√¥nico. Ele o montou na tampa e todas as outras partes entraram na caixa. Tudo "confiavelmente" fixado com adesivo hot melt. No momento do teste, apertei o bot√£o ao lado da fonte de alimenta√ß√£o da unidade de controle do interruptor de luz para instala√ß√£o externa.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/r2/dn/tj/r2dntjzjoijyn-g7vk4vdkg-d5y.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ligar as luzes se tornou mais conveniente e seguro. </font><font style="vertical-align: inherit;">Estava preso de cabe√ßa para baixo no fundo do arm√°rio da cozinha e era mais dif√≠cil conseguir √°gua das m√£os molhadas por dentro.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√µes da unidade de controle anterior</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A ilumina√ß√£o da √°rea de trabalho da cozinha tornou-se mais uniforme e agrad√°vel, devido √† reprodu√ß√£o de cores n√£o natural da minha faixa de LED, a cor de alguns produtos mudou. </font><font style="vertical-align: inherit;">Por exemplo: as cenouras pareciam muito mais apetitosas devido √† cor mais brilhante. </font><font style="vertical-align: inherit;">Mas n√£o interferiu muito e espero que n√£o tenha causado muito dano. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com o contato on / off, tudo ficou pior. </font><font style="vertical-align: inherit;">Funcionou. </font><font style="vertical-align: inherit;">Por√©m, ap√≥s 5 minutos no estado desligado, os flashes come√ßaram na faixa de LEDs. </font><font style="vertical-align: inherit;">N√£o comecei a refazer o circuito nos acopladores √≥pticos e deixei tudo como est√°. </font><font style="vertical-align: inherit;">Apenas para ligar e desligar come√ßou a usar o novo interruptor. </font><font style="vertical-align: inherit;">Todos gostaram de sua localiza√ß√£o e forma.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante dois anos de uso, a gordura e outros compostos secretados durante o cozimento se acumularam no corpo e dentro dele. </font><font style="vertical-align: inherit;">Esta placa penetrou parcialmente na carca√ßa atrav√©s dos orif√≠cios para a entrada dos fios. </font><font style="vertical-align: inherit;">Por√©m, devido √† superf√≠cie brilhante do corpo, essa subst√¢ncia condensa em uma massa gelatinosa. </font><font style="vertical-align: inherit;">√â agrad√°vel ao toque, inodoro e ... (eu n√£o provei). </font><font style="vertical-align: inherit;">Tirei algumas fotos do local na forma de um germe de drag√£o. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jz/fr/ys/jzfrystsmthfk7fy5j_o70kkcfm.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/ot/br/mg/otbrmglxan7uooc1a1e4n88z9iq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nas paredes, essa subst√¢ncia se transforma em um terr√≠vel ataque, que n√£o √© apenas lavado.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que se tornou</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de vasculhar os compartimentos, encontrei um m√≥dulo de expans√£o inacabado para o ZUNo. </font><font style="vertical-align: inherit;">O ZUNo √© uma placa do tipo arduino para projetar seu pr√≥prio dispositivo compat√≠vel com a casa inteligente Z-Wave. </font><font style="vertical-align: inherit;">Est√° programado no ambiente do arduino.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Especifica√ß√µes do Fabricante:</font></font></b><div class="spoiler_text"><ul>
<li>28 kB Flash memory for your sketches</li>
<li>2 kB RAM available</li>
<li>Z-Wave RF transmitter at 9.6/40/100 kbps</li>
<li>26 GPIO (overlaps with special hardware controllers)</li>
<li>4 ADC</li>
<li>5 PWM</li>
<li>2 UART</li>
<li>1 USB (serial port)</li>
<li>16 kB EEPROM</li>
<li>1 SPI (master or slave)</li>
<li>4 IR controllers, 1 IR learn capability</li>
<li>1 TRIAC/ZEROX to control dimmer</li>
<li>3 Interrupts</li>
<li>1 Timer 4 MHz</li>
<li>I2C (software)</li>
<li>1-Wire (software)</li>
<li>8x6 Keypad Scanner (software)</li>
<li>2 service LED, 1 service button</li>
<li>1 user test LED</li>
</ul><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O m√≥dulo de expans√£o faz do ZUNo uma placa de depura√ß√£o completa que, ap√≥s a depura√ß√£o do prot√≥tipo, pode ser usada como um dispositivo completo. </font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algumas informa√ß√µes do fabricante:</font></font></b><div class="spoiler_text"><ul>
<li>One 0-10 V analog output ‚Äî control industrial dimmers</li>
<li>Up to four PWM or switch outputs (up to 5 A per channel) ‚Äî control contactors, switches, halogen bulbs or LED strips</li>
<li>Up to eight digital 0/3 V inputs or outputs ‚Äî connect various low voltage digital senors and actors</li>
<li>Up to four digital 0/3, 0/5 or 0/12 V digital or analog inputs ‚Äî connect industrial 10 V sensors or any Arduino-compatible sensor</li>
<li>RS485 or UART ‚Äî for industial meters</li>
<li>OneWire ‚Äî for DS18B20 or other sensors</li>
</ul><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para o meu projeto, preciso de 3 transistores poderosos para alternar 12 volts para uma faixa de LED e um conversor de 12 volts para 5 volts para alimentar o ZUNo. </font><font style="vertical-align: inherit;">O restante da periferia do m√≥dulo de expans√£o n√£o √© soldado ou testado. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4j/kr/tt/4jkrtt63ocqqrkugav0nrtfvtn8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesta parte do circuito, n√£o h√° diodo suficiente para a fonte de alimenta√ß√£o, para prote√ß√£o contra a "invers√£o de polaridade", e os resistores nas portas dos transistores de efeito de campo de pot√™ncia tiveram que ser conectados ao port√£o, e n√£o na frente do resistor limitador. </font><font style="vertical-align: inherit;">Escreverei mais sobre isso nas conclus√µes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este m√≥dulo de expans√£o √© fornecido em uma caixa da Gainta. </font><font style="vertical-align: inherit;">Minha unidade de controle anterior tamb√©m estava no caso desta empresa, mas de tamanho diferente. </font><font style="vertical-align: inherit;">Infelizmente, as fixa√ß√µes no m√≥dulo n√£o se encaixavam no gabinete antigo, e eu n√£o queria perfurar um novo, deixei o gabinete antigo. </font><font style="vertical-align: inherit;">A prancha foi "plantada" em adesivo hot melt.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wm/ls/ah/wmlsahydh07_hxmpqaryl1atchs.jpeg"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um pouco sobre como programar o Arduino e o ZUNo</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os dispositivos de onda Z devem ter um certo n√∫mero de classes. As classes descrevem fun√ß√µes do dispositivo e interfaces de intera√ß√£o. Por exemplo, minha l√¢mpada controla uma faixa de LED composta por tr√™s cores (vermelho, verde, azul). Essas fun√ß√µes s√£o executadas pela classe multin√≠vel Switch. Se o adicionarmos ao esbo√ßo, podemos alterar remotamente o brilho de uma das cores. Para controlar tr√™s cores, voc√™ precisa criar tr√™s inst√¢ncias dessa classe. N√£o vou falar sobre isso com mais detalhes e detalhes. Como a manipula√ß√£o de rotina da classe est√° oculta para os usu√°rios do ZUNo pela no√ß√£o de "canal". Por exemplo, eu preciso de tr√™s classes de Switch multin√≠vel, portanto, no c√≥digo devem aparecer 3 canais do Switch multin√≠vel e v√°rias fun√ß√µes de retorno de chamada para controle de r√°dio. Como fazer isso? Voc√™ tamb√©m precisa adicionar a classe b√°sica Switch,para ligar e desligar a l√¢mpada com o toque de um bot√£o (na interface do controlador de rede) e n√£o para configurar 3 canais por vez.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ precisa acessar o site dos desenvolvedores, onde s√£o apresentados exemplos de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">z-uno.z-wave.me/Reference/ZUNO_SWITCH_MULTILEVEL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Cada classe suportada pelo ZUNo tem uma descri√ß√£o e um exemplo. </font><font style="vertical-align: inherit;">Em seguida, copie e cole as fun√ß√µes propostas no seu esbo√ßo. </font><font style="vertical-align: inherit;">Agora, no esbo√ßo, existem tr√™s canais de v√°rios n√≠veis do switch e 6 fun√ß√µes de retorno de chamada para responder a comandos no r√°dio. </font><font style="vertical-align: inherit;">Como n√£o sou muito sofisticado nas aulas do Z-Wave, meu dispositivo de faixa de LED anterior funcionou com esse conjunto de aulas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os canais foram declarados assim:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T√≠tulo de spoiler</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs">ZUNO_SETUP_CHANNELS(<font></font>
      ZUNO_SWITCH_MULTILEVEL(getRed, setRed),<font></font>
      ZUNO_SWITCH_MULTILEVEL(getGreen, setGreen),<font></font>
      ZUNO_SWITCH_MULTILEVEL(getBlue, setBlue),<font></font>
      ZUNO_SWITCH_BINARY(switch_getter, switch_setter)<font></font>
);</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso levou √† gera√ß√£o dos seguintes widgets no controlador ap√≥s adicionar √† rede: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/to/-y/if/to-yif5eaf9xkuxdk4t2oxp6ph4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para ajustar a cor, era necess√°rio abrir e configurar cada cor no menu do controlador separadamente. </font><font style="vertical-align: inherit;">N√£o √© conveniente e lento. </font><font style="vertical-align: inherit;">No entanto, tive sorte. </font><font style="vertical-align: inherit;">Acabou que n√£o estou sozinha. </font><font style="vertical-align: inherit;">Eles pensaram em n√≥s e criaram o canal </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">z-uno.z-wave.me/Reference/ZUNO_SWITCH_COLOR</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Agora, h√° apenas um canal e duas fun√ß√µes de retorno de chamada no sketch. </font><font style="vertical-align: inherit;">No menu do controlador, a configura√ß√£o de cores √© realizada separadamente para cada cor e tamb√©m de uma s√≥ vez, selecionando na paleta.</font></font><br>
<br>
<pre><code class="cpp hljs">ZUNO_SETUP_CHANNELS(ZUNO_SWITCH_COLOR(SWITCH_COLOR_FLAGS_RED|SWITCH_COLOR_FLAGS_GREEN|SWITCH_COLOR_FLAGS_BLUE, getterFunction, setterFunction));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E no menu do controlador fica assim: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/m3/zn/qk/m3znqkbwue228cttqmqmhggvwxu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A pr√≥xima fun√ß√£o responde a solicita√ß√µes via r√°dio. </font><font style="vertical-align: inherit;">Pode haver uma solicita√ß√£o para ler o status de um dos canais de cores.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">BYTE <span class="hljs-title">getterFunction</span><span class="hljs-params">(BYTE component)</span> </span>{
  <span class="hljs-keyword">switch</span>(component)<font></font>
  {<font></font>
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_RED:
      <span class="hljs-keyword">return</span> pwmR;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_GREEN:
      <span class="hljs-keyword">return</span> pwmG;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_BLUE:
      <span class="hljs-keyword">return</span> pwmB;
      <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">3</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E esta √© uma fun√ß√£o para definir cores na interface do controlador.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setterFunction</span><span class="hljs-params">(BYTE component, BYTE newValue)</span> 
</span>{
  <span class="hljs-keyword">switch</span>(component)<font></font>
  {<font></font>
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_RED:<font></font>
      pwmR = newValue;<font></font>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_GREEN:<font></font>
      pwmG = newValue;<font></font>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_BLUE:<font></font>
      pwmB = newValue;<font></font>
      <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
  radio_action = <span class="hljs-number">1</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse √© todo o c√≥digo que voc√™ precisa adicionar para transformar um esbo√ßo do arduino em um esbo√ßo do ZUNo.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s a montagem e instala√ß√£o, todas as tarefas declaradas foram conclu√≠das. </font><font style="vertical-align: inherit;">No entanto, o h√°bito de acender a luz com o interruptor permaneceu (acabou sendo muito conveniente). </font><font style="vertical-align: inherit;">A op√ß√£o de inclus√£o sem contato tamb√©m funciona. </font><font style="vertical-align: inherit;">Entre as defici√™ncias, quero observar a oscila√ß√£o da l√¢mpada LED por um segundo ap√≥s aplicar energia √† unidade de controle. </font><font style="vertical-align: inherit;">Isso ocorre devido √† longa inicializa√ß√£o dos perif√©ricos ZUNo. </font><font style="vertical-align: inherit;">Neste ponto, as pernas s√£o imprevis√≠veis. </font><font style="vertical-align: inherit;">Acho que o resistor pull-up no port√£o do transistor corrigir√° a situa√ß√£o se voc√™ o colocar ap√≥s o resistor limitador. </font><font style="vertical-align: inherit;">Se o c√≥digo de inicializa√ß√£o ajustar as pernas √† sa√≠da e alterar os n√≠veis l√≥gicos intencionalmente, voc√™ poder√° experimentar o filtro RC, que n√£o passar√° pulsos curtos. </font><font style="vertical-align: inherit;">Ainda n√£o o fiz e talvez nunca o fa√ßa!</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">achados</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O ZUNo e seu m√≥dulo de expans√£o simplificam bastante a "criatividade t√©cnica dom√©stica". No entanto, considero esses produtos muito caros e, se trabalhasse em outro lugar e o equipamento Z-Wave n√£o estivesse por a√≠, faria tudo no ESP8266. Durante o desenvolvimento, aprendi um novo "padr√£o" para marcar os fios da fonte de alimenta√ß√£o.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sx/c4/4h/sxc44hipyu2ml_agdxtaqthtvrs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, n√£o apenas a terra est√° marcada com uma faixa preta, mas, como no meu caso, o fio "positivo". Para o m√≥dulo de expans√£o, isso foi importante. O conversor LM2594 de 5 volts falhou (o pre√ßo no Chip and Dip √© de cerca de 200 rublos). Espero que na pr√≥xima vers√£o do m√≥dulo de expans√£o haja um diodo de prote√ß√£o contra a "invers√£o de polaridade". E vou verificar a polaridade dos fios de alimenta√ß√£o. Outra desvantagem est√° associada ao corpo. O gabinete parece bom, mas n√£o consegui conectar os fios sem pin√ßa aos blocos de terminais. Espero que exista uma vers√£o com outros blocos de terminais (para conectar os fios de cima ou em √¢ngulo). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o gosto de armazenar fotos em servi√ßos na nuvem e fazer backups com frequ√™ncia. Portanto, a maioria das fotografias associadas ao processo de design e a l√¢mpada 1 est√£o irremediavelmente corrompidas.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zz/wz/ov/zzwzovgton7f2yxvy-2bd4zhucu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso √© tudo o que resta do processo de montagem e depura√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E parece que a luz de fundo √© posta em opera√ß√£o, se voc√™ dobrar um pouco. </font><font style="vertical-align: inherit;">Se voc√™ endireitar, a caixa e o interruptor n√£o estar√£o vis√≠veis.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ya/qj/hn/yaqjhnpkhd7ge2ohejbp9ywkqpq.jpeg"> <br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esbo√ßo para o ZUNo. </font><font style="vertical-align: inherit;">Anexo, apenas para confirmar que tudo √© elementar</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"EEPROM.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"EEPR.h"</span></span><font></font>
<font></font>
<span class="hljs-keyword">int</span> readPin = <span class="hljs-number">9</span>;
<span class="hljs-keyword">int</span> triggerPin = <span class="hljs-number">10</span>;<font></font>
byte controlState = <span class="hljs-number">0</span>;<font></font>
word lastValue;<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> REDPIN   PWM1     <span class="hljs-comment">// pin connection R </span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> GREENPIN PWM2     <span class="hljs-comment">// pin connection G</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> BLUEPIN  PWM3     <span class="hljs-comment">// pin connection B</span></span><font></font>
<font></font>
ZUNO_SETUP_CHANNELS(ZUNO_SWITCH_COLOR(SWITCH_COLOR_FLAGS_RED|SWITCH_COLOR_FLAGS_GREEN|SWITCH_COLOR_FLAGS_BLUE, getterFunction, setterFunction));<font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ON 1</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> OFF 0</span>
<span class="hljs-keyword">uint8_t</span> switch_=OFF;<font></font>
<font></font>
<span class="hljs-keyword">uint8_t</span> pwmR=<span class="hljs-number">0</span>;
<span class="hljs-keyword">uint8_t</span> pwmG=<span class="hljs-number">0</span>;
<span class="hljs-keyword">uint8_t</span> pwmB=<span class="hljs-number">0</span>;
<span class="hljs-keyword">uint8_t</span> b_pwmR=<span class="hljs-number">0</span>;
<span class="hljs-keyword">uint8_t</span> b_pwmG=<span class="hljs-number">0</span>;
<span class="hljs-keyword">uint8_t</span> b_pwmB=<span class="hljs-number">0</span>;<font></font>
<font></font>
<span class="hljs-keyword">enum</span><font></font>
{<font></font>
  DEF_R = <span class="hljs-number">255</span>,<font></font>
  DEF_G = <span class="hljs-number">255</span>,<font></font>
  DEF_B = <span class="hljs-number">255</span><font></font>
};<font></font>
<span class="hljs-keyword">uint8_t</span> radio_action = <span class="hljs-number">0</span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> 
</span>{ <font></font>
  init_EEPROM();<font></font>
  Serial.begin();<font></font>
  pinMode(readPin, INPUT);<font></font>
  pinMode(triggerPin, OUTPUT);<font></font>
  digitalWrite(triggerPin, LOW);<font></font>
  pinMode(REDPIN, OUTPUT);<font></font>
  pinMode(GREENPIN, OUTPUT);<font></font>
  pinMode(BLUEPIN, OUTPUT);<font></font>
  analogWrite(REDPIN, pwmR &amp; <span class="hljs-number">0xff</span>);<font></font>
  analogWrite(GREENPIN, pwmG &amp; <span class="hljs-number">0xff</span>);<font></font>
  analogWrite(BLUEPIN, pwmB &amp; <span class="hljs-number">0xff</span>);<font></font>
  <font></font>
} <font></font>
<span class="hljs-keyword">int</span> act=<span class="hljs-number">1</span>;
<span class="hljs-keyword">int</span> actf = <span class="hljs-number">0</span>;
<span class="hljs-keyword">int</span> cnt=<span class="hljs-number">57</span>; <font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">int</span> tmp;
  <span class="hljs-comment">// trigger measurement</span><font></font>
  digitalWrite(triggerPin, LOW);<font></font>
  delayMicroseconds(<span class="hljs-number">10</span>);<font></font>
  digitalWrite(triggerPin, HIGH);<font></font>
  delayMicroseconds(<span class="hljs-number">10</span>);<font></font>
  digitalWrite(triggerPin, LOW);<font></font>
  <span class="hljs-comment">// read pulse width</span>
  tmp = pulseIn(readPin, HIGH, <span class="hljs-number">100000</span>);<font></font>
  lastValue = tmp / <span class="hljs-number">58</span>;<font></font>
  Serial.print(<span class="hljs-string">" cm= "</span>);<font></font>
  Serial.println(lastValue);<font></font>
  <span class="hljs-keyword">if</span> (lastValue &lt; <span class="hljs-number">30</span>)<font></font>
  {<font></font>
    cnt++;<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span><font></font>
  {<font></font>
    cnt--;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (cnt &gt; <span class="hljs-number">55</span>)<font></font>
  { <font></font>
    act=<span class="hljs-number">1</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (cnt &gt; <span class="hljs-number">60</span>)<font></font>
    cnt= <span class="hljs-number">60</span>;
  <span class="hljs-keyword">if</span> (cnt &lt; <span class="hljs-number">50</span>)<font></font>
  {<font></font>
    act=<span class="hljs-number">0</span>;<font></font>
    actf=<span class="hljs-number">0</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (cnt &lt; <span class="hljs-number">45</span> )<font></font>
    cnt = <span class="hljs-number">45</span>;<font></font>
  <font></font>
  <span class="hljs-keyword">if</span> ((act == <span class="hljs-number">1</span>) &amp;&amp; (actf == <span class="hljs-number">0</span>))<font></font>
  {  <font></font>
    actf = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">if</span> (switch_ == OFF)<font></font>
    {<font></font>
      switch_=ON;<font></font>
      b_pwmG = pwmG;<font></font>
      b_pwmB = pwmB;<font></font>
      b_pwmR = pwmR;<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
      switch_=OFF;<font></font>
      b_pwmR=<span class="hljs-number">0</span>;<font></font>
      b_pwmG=<span class="hljs-number">0</span>;<font></font>
      b_pwmB=<span class="hljs-number">0</span>;<font></font>
    }<font></font>
    analogWrite(REDPIN, b_pwmR &amp; <span class="hljs-number">0xff</span>);<font></font>
    analogWrite(GREENPIN, b_pwmG &amp; <span class="hljs-number">0xff</span>);<font></font>
    analogWrite(BLUEPIN, b_pwmB &amp; <span class="hljs-number">0xff</span>); <font></font>
  } <font></font>
  <font></font>
  Serial.print(<span class="hljs-string">"cnt = "</span>);    <font></font>
  Serial.print(cnt);  <font></font>
  Serial.print(<span class="hljs-string">" || "</span>);    <font></font>
  Serial.print(pwmR);  <font></font>
  Serial.print(<span class="hljs-string">" "</span>);      <font></font>
  Serial.print(pwmG);  <font></font>
  Serial.print(<span class="hljs-string">" "</span>);<font></font>
  Serial.print(pwmB);  <font></font>
  Serial.print(<span class="hljs-string">" "</span>);<font></font>
  Serial.println(<span class="hljs-string">""</span>);
 <span class="hljs-comment">// delay(10);</span><font></font>
<font></font>
 <span class="hljs-keyword">if</span>(radio_action)<font></font>
 {<font></font>
    radio_action = <span class="hljs-number">0</span>;<font></font>
    eepr_save_col();<font></font>
    analogWrite(REDPIN, pwmR &amp; <span class="hljs-number">0xff</span>);<font></font>
    analogWrite(GREENPIN, pwmG &amp; <span class="hljs-number">0xff</span>);<font></font>
    analogWrite(BLUEPIN, pwmB &amp; <span class="hljs-number">0xff</span>);<font></font>
 }<font></font>
}<font></font>
<font></font>
<span class="hljs-function">BYTE <span class="hljs-title">getterFunction</span><span class="hljs-params">(BYTE component)</span> </span>{
  <span class="hljs-keyword">switch</span>(component)<font></font>
  {<font></font>
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_RED:
      <span class="hljs-keyword">return</span> pwmR;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_GREEN:
      <span class="hljs-keyword">return</span> pwmG;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_BLUE:
      <span class="hljs-keyword">return</span> pwmB;
      <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">3</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setterFunction</span><span class="hljs-params">(BYTE component, BYTE newValue)</span> 
</span>{
  <span class="hljs-keyword">switch</span>(component)<font></font>
  {<font></font>
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_RED:<font></font>
      pwmR = newValue;<font></font>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_GREEN:<font></font>
      pwmG = newValue;<font></font>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_BLUE:<font></font>
      pwmB = newValue;<font></font>
      <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
  radio_action = <span class="hljs-number">1</span>;<font></font>
}<font></font>
</code></pre><br>
</div></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt488470/index.html">Kim Dotcom: Caught, a pessoa mais procurada online. Parte 4</a></li>
<li><a href="../pt488472/index.html">Leitura de fim de semana: 10 materiais sobre dispositivos de √°udio - de r√°dios sovi√©ticos a plugues com cancelamento de ru√≠do</a></li>
<li><a href="../pt488474/index.html">Sobre cor, som e ‚Äúexplora√ß√£o de multid√µes‚Äù como um tipo separado de beleza</a></li>
<li><a href="../pt488476/index.html">Bobina de tubo de Tesla</a></li>
<li><a href="../pt488478/index.html">Transferir todos os bancos de dados do MS SQL Server para outra m√°quina</a></li>
<li><a href="../pt488482/index.html">Quanto √© Appium para as pessoas</a></li>
<li><a href="../pt488484/index.html">Lan√ßamento do SQL - evento Microsoft SQL Server 2019</a></li>
<li><a href="../pt488488/index.html">Para o OpenBSD. Um pouco de prazer</a></li>
<li><a href="../pt488490/index.html">Likbez em respiradores. O respirador ajuda na infec√ß√£o por v√≠rus? Vis√£o geral de 11 respiradores</a></li>
<li><a href="../pt488498/index.html">Laborat√≥rios da ITMO University: ilumina√ß√£o LED, optoeletr√¥nica de microondas e telecomunica√ß√µes √≥pticas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>