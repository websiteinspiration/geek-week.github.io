<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤘🏾 🌉 🏴 NetflixマイクロサービスがPub-Subデータを処理する方法 🌝 👓 🍽️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="記事の翻訳は、特にコース「高負荷アーキテクト」の学生のために準備されました。
 
 
 
 
 前書き
 Netflixマイクロサービスアーキテクチャでは、1つのエンドポイントから複数のエンドポイントへのデータセットの転送は非常に困難な場合があります。これらのデータセットには、サービス構成からバッチ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>NetflixマイクロサービスがPub-Subデータを処理する方法</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/479572/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記事の翻訳は、特にコース</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「高負荷アーキテクト」の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">学生のために準備されました</font><font style="vertical-align: inherit;">。</font></font><br>
</i><br>
<br>
<img src="https://habrastorage.org/webt/ro/7u/1i/ro7u1is2mtzuzuuuzpdm07pgzc8.png"><br>
<hr><br>
 <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前書き</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Netflixマイクロサービスアーキテクチャでは、1つのエンドポイントから複数のエンドポイントへのデータセットの転送は非常に困難な場合があります。これらのデータセットには、サービス構成からバッチ処理結果まで、何でも含めることができます。アクセスを最適化するには、常駐データベースが必要になることが多く、データを更新した直後に変更を送信する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データセットの分散配布の必要性を反映する1つの例は、次のようになります。Netflixは常に、膨大な数のA / Bテストを実行します。これらのテストはいくつかのサービスとコマンドをカバーしており、テストオペレーターはオンザフライで再構成できるはずです。また、最新のテスト構成を取得できなかったノードを検出する機能と、問題が発生した場合に古いバージョンにロールバックする機能も必要です。</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
配布する必要のあるデータセットの別の例は、機械学習モデルの出力シーケンスです。その結果は複数のチームで使用できますが、MLチームは、クリティカルな状況での中断のないアクセスサービスのサポートに必ずしも関心があるわけではありません。各チームが簡潔にロールバックできるようにバックアップを作成する必要がある状況ではなく、複数のチームが1つのチームの結果を使用できるように特別な注意が払われます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インフラストラクチャレベルでのサポートがなければ、各チームは最終的に独自のソリューションを実装しようとしますが、成功の度合いはチームによって異なります。データセット自体のサイズは、数バイトから数ギガバイトまでさまざまです。オペレーターが独自のソリューションを作成せずにすばやく変更できるように、特別なツールを使用してプロセスの進行状況を監視し、誤動作を検出する機能を作成することが重要です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/96/wa/uw/96wauwyjpxs3xx0kljnxvxcmk2i.png"> <br>
 <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データの普及</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Netflixでは、グーテンベルクと呼ばれる内部のパブ/サブデータシステムを使用しています。</font><font style="vertical-align: inherit;">Gutenbergを使用すると、バージョニング付きのデータセットを配布できます。受信者はデータをサブスクライブし、公開時に最新バージョンを受け取ります。</font><font style="vertical-align: inherit;">データセットの各バージョンは変更されずに残り、データの完全な表現が含まれます。つまり、以前のバージョンに依存しません。</font><font style="vertical-align: inherit;">Gutenbergでは、デバッグ、データ問題の迅速な解決、機械学習モデルの再トレーニングなどが必要な場合に、古いバージョンのデータを表示できます。</font><font style="vertical-align: inherit;">この記事では、グーテンベルクの高レベルのアーキテクチャについて説明します。</font></font><br>
 <br>
 <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データ・モデル</font></font></h4><br>
 <img src="https://habrastorage.org/webt/7g/7z/b6/7g7zb66okgkinf1xxzvlyxk-60w.png"><br>
 <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1トピック-&gt;多くのバージョン</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
グーテンベルクのトップレベルのデザインは「テーマ」です。公開者はトピック内でデータを公開し、受信者はそれからデータを抽出します。トピックのパブリケーションは、個別のバージョンとして追加されます。これらは、ユースケースに応じてバージョンの数を決定する特定のストレージポリシーによって特徴付けられます。たとえば、10個のバージョンまたは過去10日間のバージョンを格納するようにテーマを構成できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各バージョンには、メタデータ（キーと値）とデータポインターが含まれています。データインデックスは、公開されたデータが実際に格納される場所を示す特別なメタデータと見なすことができます。現在、グーテンベルクは直接データポインター（ペイロードがデータポインター自体の値に書き込まれている場合）とS3データポインター（ペイロードがS3に格納されている場合）をサポートしています。直接データポインターは通常、データが小さい（1 MB未満）場合に使用され、データボリュームが大きい場合はS3がバックアップストレージとして使用されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/z7/we/mp/z7wemphye670skkx23aemtfkdyi.png"><br>
 <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1トピック-&gt;多くの公開セット</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gutenbergは、特定の受信者ユーザーのセットにパブリケーションを送信する機能を提供します。たとえば、セットを特定のリージョン、アプリケーション、またはクラスターでグループ化できます。これを使用して、データ変更の品質を制御したり、アプリケーションのサブセットがサブスクライブできるようにデータセットを制限したりできます。パブリッシャーは、特定のバージョンのデータの公開領域を決定し、以前に公開されたデータに領域を追加できます。これは、データの最新バージョンの概念が特定の領域に依存することを意味することに注意してください。2つのアプリケーションは、発行者が定義した発行領域に応じて、最新の異なるバージョンのデータを受け取る場合があります。 Gutenbergサービスは、最新バージョンとして何を送信するかを決定する前に、受信側アプリケーションを発行領域にマップします。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユースケース</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Gutenbergの最も一般的な使用例は、1つの発行者から複数の受信者にさまざまなサイズのデータ​​を配布することです。</font><font style="vertical-align: inherit;">多くの場合、データは受信者のメモリに保存され、「共有キャッシュ」として使用されます。この場合、データは受信者のコードの実行中に常に利用可能であり、必要に応じて内部で自動的に置き換えられます。</font><font style="vertical-align: inherit;">これらの使用例の多くは、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Open Connect Appliance</font></a><font style="vertical-align: inherit;">キャッシュの構成など、「構成」にグループ化できます。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、サポートされているデバイスタイプID、サポートされている支払い方法のメタデータ、A / Bテスト構成。 Gutenbergは、このデータの公開と受信の間の抽象化を提供します。これにより、パブリッシャーは、下流の受信者に影響を与えることなく、アプリケーションを自由に反復できます。場合によっては、公開はGutenbergが管理するユーザーインターフェースを使用して行われ、チームは独自の公開アプリケーションをまったく操作する必要がありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gutenbergシステムのもう1つの用途は、バージョン管理されたデータのリポジトリです。これは、チームが履歴データに基づいてモデルを構築およびトレーニングし、それらが時間とともにどのように変化するかを確認してから、特定のパラメーターを変更してアプリケーションを再度実行する機械学習アプリケーションに役立ちます。ほとんどの場合、バッチ計算では、これらの計算の結果をさまざまなバージョンのデータセットとして保存および配布するためにGutenbergが使用されます。オンラインユースケースはトピックにサブスクライブし、最新バージョンセットからのリアルタイムデータを提供します。一方、自律システムは同じトピックの履歴データを使用して、たとえば機械学習モデルを教えることができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gutenbergはイベントシステムとして設計されておらず、バージョン管理とデータ配信のみを目的としていることに注意してください。</font><font style="vertical-align: inherit;">特に、頻繁な発行は、サブスクライバーが各バージョンを受け取る必要があることを意味するものではありません。</font><font style="vertical-align: inherit;">彼が更新を要求すると、現在のバージョンが現在のバージョンより大幅に遅れている場合でも、最新バージョンを受け取ります。</font><font style="vertical-align: inherit;">従来のpub-subまたはイベントシステムは、順次送信される小さなメッセージに適しています。</font><font style="vertical-align: inherit;">つまり、受信者は、イベントの（圧縮された）ストリーム全体を消費することで、データセット全体のアイデアを作成できます。</font><font style="vertical-align: inherit;">ただし、グーテンベルクは、データセットの完全で不変の表現を公開して使用することを目的としています。</font></font><br>
 <br>
 <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">開発とアーキテクチャ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gutenbergは、gRPCサービスとREST API、およびgRPC APIを使用するJavaクライアントライブラリで構成されています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lw/bz/m_/lwbzm_dd871-cgpebuwlmorejd4.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高レベルのアーキテクチャ</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">お客様</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gutenbergクライアントライブラリは、サブスクリプションの管理、S3のロード/アンロード、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Atlas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メトリック、</font><font style="vertical-align: inherit;">および</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Archaius</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロパティを使用して構成できるパラメーター</font><font style="vertical-align: inherit;">などのタスクを処理し</font><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">彼女はgRPCを介してGutenbergサービスとやり取りし、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eureka</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">してサービスを発見します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出版物</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パブリッシャーは通常、高レベルAPIを使用して文字列、ファイル、バイト配列を公開します。</font><font style="vertical-align: inherit;">データのサイズに応じて、データへの直接ポインターとして公開するか、S3にアップロードして、データポインターS3として公開できます。</font><font style="vertical-align: inherit;">クライアントは、パブリッシャーの代わりにペイロードをS3にアップロードするか、すでにS3にあるペイロードメタデータのみを公開できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
直接データポインターは自動的にグローバルに複製されます。</font><font style="vertical-align: inherit;">S3で公開されたデータは、デフォルトで複数の領域でパブリッシャーによってアップロードされますが、これもカスタマイズできます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サブスクリプション管理</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 クライアントライブラリは、受信者のサブスクリプション管理を提供します。これにより、ユーザーは、ライブラリがデータを抽出する特定のトピック（S3などから）のサブスクリプションを作成して、ユーザーが設定した受信者にそれらを転送できます。サブスクリプションはサーベイモデルに従って機能します—サービスから30秒ごとに新しい更新を要求し、最後に受け取ったバージョンを送信します。サブスクライブしたクライアントは、修正されていない場合、現在のバージョンより古いバージョンのデータを使用しません（以下の「フォールトトレランス」を参照）。繰り返されるリクエストロジックは配線され、構成可能です。たとえば、ユーザーは、ダウンロードプロセスが中断した場合に古いバージョンのデータを使用するように、または起動時に最新バージョンのデータを処理するようにGutenbergを構成できます。フィードバックと互換性のないデータ変更を処理するため。 Gutenbergは、最新のデータを保存し、変更が到着したときに内部でそれらを自動的に更新する事前構成済みのサブスクリプションも提供します。これは、サブスクライバーが常に現在の値のみを考慮する場合にサブスクリプションを使用するためのほとんどのオプションを満たします。これにより、たとえば、これまでに公開されたことのないトピック（たとえば、テーマが構成に使用されている場合）のデフォルト値を指定できます。トピック固有のエラーがある場合（有効なデフォルト値がある場合にサービスの起動がブロックされないようにするため）。これは最新のデータを保存し、内部では変更があったときに自動的に更新します。これは、サブスクライバーが常に現在の値のみを気にするほとんどのサブスクリプションのユースケースを満たします。これにより、たとえば、これまでに投稿されたことのないトピック（たとえば、テーマが構成に使用されている場合）のデフォルト値を指定できます。トピック固有のエラーがある場合（有効なデフォルト値がある場合にサービスの起動がブロックされないようにするため）。これは最新のデータを保存し、内部では変更があったときに自動的に更新します。これは、サブスクライバーが常に現在の値のみを気にするほとんどのサブスクリプションのユースケースを満たします。これにより、ユーザーは、たとえば、これまでに投稿されたことのないトピック（たとえば、テーマが構成に使用されている場合）のデフォルト値を指定できます。トピック固有のエラーがある場合（有効なデフォルト値がある場合にサービスの起動がブロックされないようにするため）。これまでにパブリケーションが存在したことがない場合（たとえば、テーマが構成に使用されている場合）、またはテーマに応じてエラーが発生した場合（有効なデフォルト値がある場合にサービスの開始がブロックされないようにするため）。これまでにパブリケーションが存在したことがない場合（たとえば、構成にテーマが使用されている場合）、またはテーマに応じてエラーが発生した場合（有効なデフォルト値がある場合にサービスの起動がブロックされないようにするため）。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">受信者API</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Gutenbergは、高レベルのクライアントAPIも提供します。これには内部で低レベルのgRPC APIがあり、クエリ実行の追加機能と透過性を提供します。</font><font style="vertical-align: inherit;">1つの例は、特定のテーマとバージョンのデータをダウンロードすることです。これは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Netflix Hollowに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接続されたコンポーネントで広く使用されています</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">別の例は、特定の時点でのトピックの最新バージョンの受信です。これは、機械学習モデルのデバッグまたは教育の一般的な使用例です。</font></font><br>
 <br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クライアントの持続可能性と「透明性」</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Gutenbergは、最新のデータから開始することを保証するのではなく、受信者サービスを正常に開始できるようにすることに重点を置いて設計されました。このため、クライアントライブラリは、Gutenbergサービスとやり取りできないときに状態を処理するためのバックアップロジックを使用して構築されました。 HTTPリクエストが失敗した場合、クライアントは公開されたトピックのバックアップメタデータキャッシュをS3からロードし、それを使用します。このキャッシュには、更新を適用するかどうか、およびデータを取得する場所（パブリケーションメタデータ自体またはS3から）を決定するためのすべての情報が含まれています。これにより、サービスを使用せずに、データ（バックアップキャッシュの現在の状態によっては古くなっている可能性があります）を取得できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クライアントライブラリを提供する利点の1つは、一般的なインフラストラクチャの問題と特定のアプリケーションのエラーを報告するために使用できるメトリックを取得できることです。</font><font style="vertical-align: inherit;">今日、これらのメトリックは、典型的な問題が発生した場合のパブリケーションとアラートのSLI分布を監視するためにGutenbergチームによって使用されています。</font><font style="vertical-align: inherit;">一部の顧客は、これらのメトリックを使用して、個々の発行の失敗や特定のトピックの拒否など、特定のアプリケーション固有のエラーを報告します。</font></font><br>
 <br>
 <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーバ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Gutenbergは、</font><font style="vertical-align: inherit;">gRPCおよびRESTエンドポイントを提供</font><font style="vertical-align: inherit;">する</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Governator</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / Tomcat </font><font style="vertical-align: inherit;">アプリケーションです</font><font style="vertical-align: inherit;">。グローバルに複製されたCassandraクラスターを使用して、各リージョンでパブリケーションメタデータを保存および配布します。受信者リクエストを処理するインスタンスは、公開リクエストを処理するインスタンスとは別にスケーリングされます。公開のリクエストの約1,000倍の公開リクエストがあります。また、これにより、出版の事実が領収書に依存することを排除できるため、出版物の急増が領収書に影響を与えることはなく、その逆も同様です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
受信者要求クラスター内の各インスタンスは、最近のパブリケーションの独自のメモリ内キャッシュを処理し、数秒ごとにCassandraからそれを引き出します。これは、トラフィックをCassandraクラスターに転送せずに、署名されたクライアントからの多数の受信要求を処理するために必要です。さらに、ttlリクエストプールが小さいキャッシュは、Cassandraの速度を潜在的に低下させ、リージョン全体に影響を与える可能性のあるクエリスパイクから保護します。大規模なクラスターの再配布と同時に発生する突然のエラーにより、Gutenbergサービスの運用が中断される状況がありました。さらに</font><font style="vertical-align: inherit;">、元のアプリケーションに</font><font style="vertical-align: inherit;">あるアダプティブ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同時実行リミッター</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用して、他の</font><font style="vertical-align: inherit;">アプリケーションに影響を与えることなく、正しく動作しないアプリケーションを抑制します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
S3で複数の地域にデータが公開されている場合、サーバーは、クライアントの場所に応じて、ダウンロードのためにクライアントに送り返すセグメントを決定します。また、サービスがクライアントに「最も近い」リージョンのセグメントを提供したり、現在のリージョンが何らかの理由で切断された場合にクライアントを強制的に別のリージョンに移動したりすることもできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サブスクリプションデータを受信者に返す前に、Gutenbergは最初にデータの整合性をチェックします。検証が失敗し、サブスクライバーが既に一部のデータを受信して​​いる場合、サービスは何も返さないため、実際には更新を利用できません。サブスクライバークライアントがまだデータを受信して​​いない場合（通常、これは開始したことを意味します）、サービスはトピックの履歴を要求し、整合性チェックに合格した最後の値を返します。これは、Cassandraレベルでのレプリケーションの一時的な遅延が観察されるためです。サブスクライバーが新しいデータを要求するまでに、最新の公開バージョンに関連付けられたメタデータは部分的にしかレプリケートされませんでした。これは、クライアントが不完全なデータを受信する原因となり、データリクエストエラーまたはビジネスロジックのエラーにつながる可能性があります。サーバーでこのような整合性チェックを実行すると、データウェアハウスサービスの選択に伴う、起こり得る整合性のアラートから受信者が保護されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
トピックのパブリケーションおよびこれらのトピックを使用するサイトを監視する機能は、使用状況情報を監査および収集するための重要な機能です。このデータを収集するために、サービスはパブリッシャーと受信者からの要求（サブスクライバーとその他からのデータ更新要求の両方）をインターセプトし、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Keystone</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">パイプライン</font></a><font style="vertical-align: inherit;">を使用してそれらをElasticsearchにインデックス付けします</font><font style="vertical-align: inherit;">。そのため、使用されていてもはや存在しないトピックを監視するためのデータを取得する機会があります。テーマの所有者がサブスクライバーを個別に管理できるように、内部UIからKibanaダッシュボードへの詳細なリンクを公開しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gutenbergサービスは、発行元と受信者の要求を処理するクラスターに加えて、定期的な要求を処理する別のクラスターを起動します。特に、彼は2つの問題を解決します。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数分ごとに、すべての最新のパブリケーションとメタデータが収集され、S3に送信されます。</font><font style="vertical-align: inherit;">これにより、前述のように、クライアントが使用するバックアップキャッシュの開始が開始されます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ガベージコレクターは、保持ポリシーを満たさないトピックのバージョンを削除します。</font><font style="vertical-align: inherit;">また、関連データ（S3オブジェクトなど）を削除し、明確に定義されたデータライフサイクルを保証するのに役立ちます。</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">耐障害性</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スナップ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アプリケーション開発の世界では、失敗したデプロイメントが発生します。以前のバージョンへのロールバックは、このような問題を修正するための一般的な戦略です。</font><font style="vertical-align: inherit;">動作は時間とともに変化するデータによって決定されるため、データ駆動型アーキテクチャでは状況が複雑になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グーテンベルクは、データの影響を広め、多くの場合、システムの動作を制御します。これは、何か問題が発生した場合に、実証済みの適切なバージョンのデータにロールバックする方法が必要であることを意味します。状況を緩和するために、グーテンベルクはテーマを特定のバージョンに「リンク」することを可能にします。ピンはデータの最新バージョンを上書きし、クライアントにこのバージョンへのアップグレードを強制します。これにより、最新の有効なバージョンを公開する方法を理解するのではなく、重大な状況をすばやく修正できます。公開領域にバインドを適用して、この領域の受信者だけがデータを使用できるようにすることもできます。ピンはアクティブバインディング中に公開されたデータもオーバーライドしますが、ピンが削除されると、クライアントは最新バージョンを受け取ります。これは、最後に固定されたバージョンまたはその時点で公開された新しいバージョンである可能性があります。古いものは修正されましたが。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">順次展開</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新しいコードをデプロイするときは、トラフィックのサブセットで新しいアセンブリを作成するか、それらを徐々にデプロイするか、または他の方法でデプロイのリスクを減らして速度を低下させることが推奨されます。</font><font style="vertical-align: inherit;">データが動作を制御する場合は、同様の原則を適用する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gutenbergが提供する機能の1つは、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Spinnakerパイプライン</font></a><font style="vertical-align: inherit;">を使用してデータを段階的にデプロイする機能</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">特定のトピックでは、ユーザーは移動先の発行領域と移行の遅延時間を構成します。</font><font style="vertical-align: inherit;">このスレッドで公開すると、パイプラインが起動し、パイプラインが各エリアで同じバージョンのデータを順次公開します。</font><font style="vertical-align: inherit;">ユーザーはパイプラインを操作できます。たとえば、アプリケーションが正しく動作しなくなった場合にパイプラインを一時停止またはキャンセルしたり、パブリケーションを高速化して早期に取得したりできます。</font><font style="vertical-align: inherit;">たとえば、一部のトピックでは、一度に1つのAWSリージョンのデータの新しいバージョンをデプロイしています。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スケーリング</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グーテンベルクは、過去3年間Netflixで使用されています。現在、グーテンベルクには少なくとも数万の制作に関するトピックが保存されており、そのうち約4分の1が過去6か月に少なくとも1回は公開されています。トピックはさまざまな頻度で公開されます-1分あたり数十回から数か月に1回。つまり、平均して1秒あたり約1〜2回の公開があり、ピークとディップは12時間の差があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
所定の24時間以内に、少なくとも1つのトピックにサブスクライブされるノードの数は、6桁の数値の範囲です。</font><font style="vertical-align: inherit;">平均的なサイトのサブスクリプションの平均数が7の場合、いずれかのサイトがサブスクライブするトピックの最大数は200に達します。サブスクリプションアプリケーションに加えて、特定のトピックの特定のバージョンを要求する多数のアプリケーション（機械学習やHollowなど）があります。</font><font style="vertical-align: inherit;">現在、トピックにサブスクライブせずにリクエストを行うノードの数は数十万の範囲にあり、リクエストされるトピックの最大数は60ですが、平均値は4です。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">今後の作業</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下は、グーテンベルクを改善するために概説した作業計画です。</font></font><br>
<br>
<ul>
<li><b>  </b>:    Gutenberg   Java-,        Node.JS  Python-.       ,   REST API Gutenberg   .     ,       Node.JS  Python.</li>
<li><b>   </b>:     Gutenberg               .        Gutenberg.</li>
<li><b>  </b>:            ,     . ,                  .</li>
<li><b> </b>: ,   Gutenberg,    Gutenberg     .            ,        .</li>
<li><b> </b>:      ,     ,            .           ,   Elasticsearch.</li>
<li><b>  </b>:   Netflix –       .           ,    Gutenberg  ,           .</li>
</ul><br>
<i>  .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>.</i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja479562/index.html">シンプルなマルチプラットフォームボットの構造を作成する</a></li>
<li><a href="../ja479564/index.html">ClickHouse +グラファイト：ディスク容量の消費を大幅に削減する方法</a></li>
<li><a href="../ja479566/index.html">マトリックスの潜在的な抑制またはリバースエンジニアリングの抑制システム+同時時間の証明</a></li>
<li><a href="../ja479568/index.html">私は会社でプログラマーとして働いていますが、50年間は別の方法で知りたいです</a></li>
<li><a href="../ja479570/index.html">Pythonエントリポイント</a></li>
<li><a href="../ja479574/index.html">ITILサービス管理の4つの側面</a></li>
<li><a href="../ja479578/index.html">印刷アウトソーシング：請負業者が請求金額を請求していないことを確認する方法</a></li>
<li><a href="../ja479580/index.html">ゴールデンカノングリッド：フロントエンドのホラーストーリー</a></li>
<li><a href="../ja479584/index.html">一般的な侵入検知および防止システム</a></li>
<li><a href="../ja479586/index.html">Efros Config Inspectorは、それを使用しない人にもメリットがあります</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>