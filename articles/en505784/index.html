<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöµüèø üëß ü§∞üèæ How and why the noatime option improves Linux system performance üéª üôáüèª üè≥Ô∏è‚Äçüåà</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Updating atime affects system performance. What happens there and what to do about it - read the article.
 
 
 Whenever I update Linux on my home comp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>How and why the noatime option improves Linux system performance</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vdsina/blog/505784/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Updating atime affects system performance. </font><font style="vertical-align: inherit;">What happens there and what to do about it - read the article.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ul/95/o-/ul95o-nvhv-_qxazmshaml17zwq.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Whenever I update Linux on my home computer, I have to solve certain problems. Over the years, this has become a habit: I make backup copies of my files, erase the system, install everything from scratch, restore my files, then reinstall my favorite applications. I also change the system settings for myself. Sometimes it takes too much time. And recently, I wondered if I needed this headache.</font></font><br>
<a name="habracut"></a><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atime</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is one of three timestamps for files on Linux (more on this later). </font><font style="vertical-align: inherit;">In particular, I wondered if it would still be worthwhile to disable atime on later Linux systems. </font><font style="vertical-align: inherit;">Since atime is updated every time a file is accessed, I realized that it has a significant impact on system performance. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I recently upgraded to Fedora 32 and out of habit started by disabling atime. </font><font style="vertical-align: inherit;">I thought: do I really need it? </font><font style="vertical-align: inherit;">I decided to study this issue and that's what I dug up.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A little bit about file timestamps</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To understand, you need to take a step back and recall a few things about Linux file systems and how the kernel assigns timestamps to files and directories. </font><font style="vertical-align: inherit;">You can see the date of the last change of files and directories by running the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ls -l (long) command</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or just by looking at the information about it in the file manager. </font><font style="vertical-align: inherit;">But behind the scenes, the Linux kernel tracks several timestamps for files and directories:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When was the last time the file was modified (mtime)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When was the last time the properties and file metadata were changed (ctime)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When was the last time a file was accessed (atime)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can use the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stat</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> command </font><font style="vertical-align: inherit;">to view file or directory information. </font><font style="vertical-align: inherit;">Here is the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ etc / fstab file</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> from one of my test servers:</font></font></li>
</ol><br>
<pre><code class="bash hljs">$ <span class="hljs-built_in">stat</span> fstab<font></font>
  File: fstab<font></font>
  Size: 261             Blocks: 8          IO Block: 4096   regular file<font></font>
Device: b303h/45827d    Inode: 2097285     Links: 1<font></font>
Access: (0664/-rw-rw-r--)  Uid: (    0/    root)   Gid: (    0/    root)<font></font>
Context: system_u:object_r:etc_t:s0<font></font>
Access: 2019-04-25 21:10:18.083325111 -0500<font></font>
Modify: 2019-05-16 10:46:47.427686706 -0500<font></font>
Change: 2019-05-16 10:46:47.434686674 -0500<font></font>
 Birth: 2019-04-25 21:03:11.840496275 -0500</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here you can see that this file was created on April 25, 2019, when I installed the system. </font><font style="vertical-align: inherit;">My </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ etc / fstab file</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> was last modified on May 16, 2019, and all other attributes were changed at about the same time. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If I copy </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ etc / fstab</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to a new file, the dates change, indicating that this is a new file:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo cp fstab fstab.bak<font></font>
$ <span class="hljs-built_in">stat</span> fstab.bak<font></font>
  File: fstab.bak<font></font>
  Size: 261             Blocks: 8          IO Block: 4096   regular file<font></font>
Device: b303h/45827d    Inode: 2105664     Links: 1<font></font>
Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)<font></font>
Context: unconfined_u:object_r:etc_t:s0<font></font>
Access: 2020-05-12 17:53:58.442659986 -0500<font></font>
Modify: 2020-05-12 17:53:58.443659981 -0500<font></font>
Change: 2020-05-12 17:53:58.443659981 -0500<font></font>
 Birth: 2020-05-12 17:53:58.442659986 -0500</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But if I just rename the file without changing its contents, Linux will only update the file modification time:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo mv fstab.bak fstab.tmp<font></font>
$ <span class="hljs-built_in">stat</span> fstab.tmp<font></font>
  File: fstab.tmp<font></font>
  Size: 261             Blocks: 8          IO Block: 4096   regular file<font></font>
Device: b303h/45827d    Inode: 2105664     Links: 1<font></font>
Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)<font></font>
Context: unconfined_u:object_r:etc_t:s0<font></font>
Access: 2020-05-12 17:53:58.442659986 -0500<font></font>
Modify: 2020-05-12 17:53:58.443659981 -0500<font></font>
Change: 2020-05-12 17:54:24.576508232 -0500<font></font>
 Birth: 2020-05-12 17:53:58.442659986 -0500</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
These timestamps are very useful for certain Unix programs. For example, biff is a program that notifies you of a new message in an email. Now few people use </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">biff</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , but in those days when mailboxes were local to the system, biff was quite widespread. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
How does the program know if you have new mail in your inbox? biff compares the last modified time (when the inbox was updated with a new email) and the last access time (the last time you read your email). If the change occurred later than access, then biff will understand that a new letter has arrived and will notify you of this. Mutt's email client works in much the same way.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The last access timestamp is also useful if you need to collect statistics on file system usage and tune performance. System administrators need to know which objects are being accessed in order to properly configure the file system. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But for most modern programs this label is no longer needed, so there was a proposal not to use it. In 2007, Linus Torvalds and several other kernel developers discussed atime in the context of a performance issue. Linux kernel developer Ingo Molnar made the following remark about atime and the ext3 file system:</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúIt's rather strange that every desktop and Linux server suffers from a noticeable decrease in I / O performance due to constant updates of atime, although there are only two real users: tmpwatch [which can be configured to use ctime, so this is not a big problem] and some backup tools. " </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But people still use some programs that need this label. </font><font style="vertical-align: inherit;">So removing atime will disrupt their work. </font><font style="vertical-align: inherit;">Linux kernel developers should not infringe on user freedom.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solomon's decision</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linux distributions include many applications, and users can also download and install other programs according to their needs. This is a key advantage of an open source OS. But this makes it difficult to optimize the performance of your file system. Removing resource-intensive components can disrupt the system. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a compromise, Linux kernel developers have introduced the new relaytime option, which aims to strike a balance between performance and compatibility:</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atime is updated only if the previous access time is less than the current time for modifying or changing the status ... Starting with Linux 2.6.30, the kernel uses this option by default (if noatime is not specified) ... Also, starting with Linux 2.6 .30, the time the file was last accessed is always updated if it is more than 1 day old. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Modern Linux systems (starting with Linux 2.6.30, released in 2009) already use relaytime, which should give a really big performance boost. </font><font style="vertical-align: inherit;">This means that you do not need to configure the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ etc / fstab file</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and with relaytime you can rely on the default value.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Improving system performance with noatime</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But if you want to tune your system to get maximum performance, disabling atime is still possible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The performance change may not be very noticeable on very fast modern drives (such as NVME or Fast SSD), but there is a slight increase. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you know that you are not using software that requires atime, you can slightly improve performance by including the noatime option in the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ etc / fstab file</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">After that, the kernel will not constantly update atime. </font><font style="vertical-align: inherit;">Use the noatime option when mounting the file system:</font></font><br>
<br>
<pre><code class="bash hljs">/dev/mapper/fedora_localhost--live-root /          ext4   defaults,noatime,x-systemd.device-timeout=0 1 1<font></font>
UUID=be37c451-915e-4355-95c4-654729cf662a /boot    ext4   defaults,noatime        1 2<font></font>
UUID=C594-12B1                          /boot/efi  vfat   <span class="hljs-built_in">umask</span>=0077,shortname=winnt 0 2<font></font>
/dev/mapper/fedora_localhost--live-home /home      ext4   defaults,noatime,x-systemd.device-timeout=0 1 2<font></font>
/dev/mapper/fedora_localhost--live-swap none       swap   defaults,x-systemd.device-timeout=0 0 0</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The changes will take effect the next time you reboot.</font></font><br>
<br>
<hr><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As an advertisement</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Need a server to host the site? </font><font style="vertical-align: inherit;">Our company offers </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reliable servers</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> with daily or one-time payment, each server is connected to an Internet channel of 500 Megabits and is free from DDoS attacks!</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/9fa/cf4/a34/9facf4a348ef01048b4eb5e16ae66daa.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en505764/index.html">Robot Interview</a></li>
<li><a href="../en505766/index.html">Monitoring data at rest with a DCAP system</a></li>
<li><a href="../en505772/index.html">Digital events in Moscow from June 8 to 14</a></li>
<li><a href="../en505778/index.html">HCI: turnkey solutions for building a flexible corporate IT infrastructure</a></li>
<li><a href="../en505780/index.html">How to make a quote generator in an hour</a></li>
<li><a href="../en505786/index.html">5 classic art techniques to create a good presentation</a></li>
<li><a href="../en505788/index.html">Ozon Go Demo Day</a></li>
<li><a href="../en505796/index.html">CO2, Sp02 and COVID-19: why you need to ventilate more often (few measurements)</a></li>
<li><a href="../en505798/index.html">PHP 25 years: a brief history of the language and a 50% discount on PhpStorm</a></li>
<li><a href="../en505802/index.html">Hosting and dedicated servers: answer questions. Part 4</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>