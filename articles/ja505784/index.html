<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔑 🌹 👂🏼 noatimeオプションがLinuxシステムのパフォーマンスを向上させる方法と理由 💑 🎅 👸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="atimeを更新すると、システムのパフォーマンスに影響します。そこで何が起こり、それに対して何をすべきか-記事を読んでください。
 
 
 自宅のコンピューターでLinuxを更新するときは常に、特定の問題を解決する必要があります。長年にわたり、これは習慣になりました。ファイルのバックアップコピーを作...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>noatimeオプションがLinuxシステムのパフォーマンスを向上させる方法と理由</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vdsina/blog/505784/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atimeを更新すると、システムのパフォーマンスに影響します。</font><font style="vertical-align: inherit;">そこで何が起こり、それに対して何をすべきか-記事を読んでください。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ul/95/o-/ul95o-nvhv-_qxazmshaml17zwq.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
自宅のコンピューターでLinuxを更新するときは常に、特定の問題を解決する必要があります。長年にわたり、これは習慣になりました。ファイルのバックアップコピーを作成し、システムを消去し、すべてを最初からインストールし、ファイルを復元してから、お気に入りのアプリケーションを再インストールします。システム設定も自分で変更します。時々時間がかかりすぎます。そして最近、私はこの頭痛が必要かどうか疑問に思いました。</font></font><br>
<a name="habracut"></a><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atime</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -Linuxのファイルの3つのタイムスタンプのうちの1つ（詳しくは後で説明）。</font><font style="vertical-align: inherit;">特に、後のLinuxシステムでatimeを無効にすることはまだ価値があるのか​​と思いました。</font><font style="vertical-align: inherit;">atimeはファイルにアクセスするたびに更新されるため、システムパフォーマンスに大きな影響があることに気付きました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最近Fedora 32にアップグレードしましたが、atimeを無効にすることから始めました。</font><font style="vertical-align: inherit;">私は思った：本当に必要なのか？</font><font style="vertical-align: inherit;">私はこの問題を研究することに決めました、そしてそれは私が掘り起こしたものです。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルのタイムスタンプについて少し</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
理解するには、一歩下がってLinuxファイルシステムに関するいくつかのことと、カーネルがファイルとディレクトリにタイムスタンプを割り当てる方法を思い出す必要があります。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ls -l（long）コマンドを</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実行する</font><font style="vertical-align: inherit;">か、ファイルマネージャーでその情報を確認するだけ</font><font style="vertical-align: inherit;">で、ファイルとディレクトリが最後に変更された日付を確認でき</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">しかし、舞台裏で、Linuxカーネルはファイルとディレクトリのいくつかのタイムスタンプを追跡します。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルが最後に変更されたのはいつですか（mtime）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロパティとファイルのメタデータが最後に変更されたのはいつですか（ctime）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルが最後にアクセスされたのはいつですか（atime）</font></font></li>
<li><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stat</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コマンド</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">使用して、</font><font style="vertical-align: inherit;">ファイルまたはディレクトリの情報を表示できます。</font><font style="vertical-align: inherit;">ここ</font><font style="vertical-align: inherit;">に私のテストサーバーの1 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">つから</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の</font><b><font style="vertical-align: inherit;">/ etc / fstabファイル</font></b><font style="vertical-align: inherit;">があります：</font></font></li>
</ol><br>
<pre><code class="bash hljs">$ <span class="hljs-built_in">stat</span> fstab<font></font>
  File: fstab<font></font>
  Size: 261             Blocks: 8          IO Block: 4096   regular file<font></font>
Device: b303h/45827d    Inode: 2097285     Links: 1<font></font>
Access: (0664/-rw-rw-r--)  Uid: (    0/    root)   Gid: (    0/    root)<font></font>
Context: system_u:object_r:etc_t:s0<font></font>
Access: 2019-04-25 21:10:18.083325111 -0500<font></font>
Modify: 2019-05-16 10:46:47.427686706 -0500<font></font>
Change: 2019-05-16 10:46:47.434686674 -0500<font></font>
 Birth: 2019-04-25 21:03:11.840496275 -0500</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このファイルは、システムをインストールした2019年4月25日に作成されたことがわかります。</font><font style="vertical-align: inherit;">私の</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ etc / fstabファイル</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は2019年5月16日に最後に変更され、他のすべての属性がほぼ同時に変更されました。</font><b><font style="vertical-align: inherit;">/ etc / fstab</font></b><font style="vertical-align: inherit;">を新しいファイル</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
にコピー</font><font style="vertical-align: inherit;">すると、日付が変更され、これが新しいファイルであることを示します。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="bash hljs">$ sudo cp fstab fstab.bak<font></font>
$ <span class="hljs-built_in">stat</span> fstab.bak<font></font>
  File: fstab.bak<font></font>
  Size: 261             Blocks: 8          IO Block: 4096   regular file<font></font>
Device: b303h/45827d    Inode: 2105664     Links: 1<font></font>
Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)<font></font>
Context: unconfined_u:object_r:etc_t:s0<font></font>
Access: 2020-05-12 17:53:58.442659986 -0500<font></font>
Modify: 2020-05-12 17:53:58.443659981 -0500<font></font>
Change: 2020-05-12 17:53:58.443659981 -0500<font></font>
 Birth: 2020-05-12 17:53:58.442659986 -0500</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、内容を変更せずにファイルの名前を変更すると、Linuxはファイルの変更時刻のみを更新します。</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo mv fstab.bak fstab.tmp<font></font>
$ <span class="hljs-built_in">stat</span> fstab.tmp<font></font>
  File: fstab.tmp<font></font>
  Size: 261             Blocks: 8          IO Block: 4096   regular file<font></font>
Device: b303h/45827d    Inode: 2105664     Links: 1<font></font>
Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)<font></font>
Context: unconfined_u:object_r:etc_t:s0<font></font>
Access: 2020-05-12 17:53:58.442659986 -0500<font></font>
Modify: 2020-05-12 17:53:58.443659981 -0500<font></font>
Change: 2020-05-12 17:54:24.576508232 -0500<font></font>
 Birth: 2020-05-12 17:53:58.442659986 -0500</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのタイムスタンプは、特定のUnixプログラムで非常に役立ちます。たとえば、biffは電子メールで新しいメッセージを通知するプログラムです。現在</font><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">biffを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用する人はほとんどいません</font><font style="vertical-align: inherit;">が、メールボックスがシステムにローカルだった当時は、biffは非常に広まっていました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プログラムは、受信トレイに新着メールがあるかどうかをどのようにして知るのですか？ biffは、最終変更時刻（受信トレイが新しいメールで更新されたとき）と最終アクセス時刻（メールを最後に読んだとき）を比較します。変更がアクセスよりも後に発生した場合、biffは新しい手紙が届いたことを理解し、これを通知します。 Muttの電子メールクライアントもほとんど同じように機能します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最終アクセスのタイムスタンプは、ファイルシステムの使用状況に関する統計を収集し、パフォーマンスを調整する必要がある場合にも役立ちます。システム管理者は、ファイルシステムを適切に構成するために、どのオブジェクトにアクセスしているかを知る必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、最近のほとんどのプログラムではこのラベルが不要になったため、このラベルを使用しないという提案がありました。 2007年、Linus Torvaldsと他の数人のカーネル開発者が、パフォーマンスの問題のコンテキストで議論しました。 Linuxカーネル開発者のIngo Molnarは、atimeとext3ファイルシステムについて次のように述べています。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「実際のユーザーは2人しかいないが、tmpwatch [ctimeを使用するように構成できるため、これは大きな問題ではない]と一部のバックアップツール。」</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、人々はまだこのラベルを必要とするいくつかのプログラムを使用しています。</font><font style="vertical-align: inherit;">したがって、atimeを削除すると、作業が中断されます。</font><font style="vertical-align: inherit;">Linuxカーネル開発者は、ユーザーの自由を侵害するべきではありません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソロモンの決定</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linuxディストリビューションには多くのアプリケーションが含まれており、ユーザーは必要に応じて他のプログラムをダウンロードしてインストールすることもできます。これは、オープンソースOSの重要な利点です。しかし、これによりファイルシステムのパフォーマンスを最適化することが難しくなります。リソースを大量に消費するコンポーネントを削除すると、システムが混乱する可能性があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linuxカーネルの開発者は妥協案として、パフォーマンスと互換性のバランスを取ることを目的とした新しいrelaytimeオプションを導入しました。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atimeは、前回のアクセス時間が現在のステータスの変更または変更時間よりも短い場合にのみ更新されます... Linux 2.6.30以降、カーネルはこのオプションをデフォルトで使用します（noatimeが指定されていない場合）...さらに、Linux 2.6以降.30、ファイルが最後にアクセスされた時刻は、1日以上経過している場合は常に更新されます。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最新のLinuxシステム（2009年にリリースされたLinux 2.6.30以降）はすでにリレー時間を使用しているため、パフォーマンスが大幅に向上します。</font><font style="vertical-align: inherit;">これは、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ etc / fstabファイル</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を構成する必要がないことを意味します</font><font style="vertical-align: inherit;">。relaytimeを使用すると、デフォルト値を信頼できます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">noatimeによるシステムパフォーマンスの向上</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、システムを調整して最大のパフォーマンスを得たい場合でも、atimeを無効にすることは可能です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パフォーマンスの変化は、非常に高速な最近のドライブ（NVMEやFast SSDなど）ではそれほど目立たない場合がありますが、若干の増加があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
atimeを必要とするソフトウェアを使用していないことがわかっている場合は、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ etc / fstabファイルに</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> noatimeオプションを含めることで、パフォーマンスをわずかに改善でき</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">その後、カーネルは常に更新されません。</font><font style="vertical-align: inherit;">ファイルシステムをマウントするときは、noatimeオプションを使用します。</font></font><br>
<br>
<pre><code class="bash hljs">/dev/mapper/fedora_localhost--live-root /          ext4   defaults,noatime,x-systemd.device-timeout=0 1 1<font></font>
UUID=be37c451-915e-4355-95c4-654729cf662a /boot    ext4   defaults,noatime        1 2<font></font>
UUID=C594-12B1                          /boot/efi  vfat   <span class="hljs-built_in">umask</span>=0077,shortname=winnt 0 2<font></font>
/dev/mapper/fedora_localhost--live-home /home      ext4   defaults,noatime,x-systemd.device-timeout=0 1 2<font></font>
/dev/mapper/fedora_localhost--live-swap none       swap   defaults,x-systemd.device-timeout=0 0 0</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変更は、次回再起動したときに有効になります。</font></font><br>
<br>
<hr><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">広告として</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サイトをホストするサーバーが必要ですか？</font><font style="vertical-align: inherit;">当社は</font><font style="vertical-align: inherit;">、DDoS攻撃から保護された500メガビットの無料インターネットチャネルに接続されている各サーバーに対して、毎日または1回の支払いで</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信頼できるサーバー</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">提供しています</font><font style="vertical-align: inherit;">！</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/9fa/cf4/a34/9facf4a348ef01048b4eb5e16ae66daa.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja505764/index.html">ロボットインタビュー</a></li>
<li><a href="../ja505766/index.html">DCAPシステムを使用した静止時のデータの監視</a></li>
<li><a href="../ja505772/index.html">6月8日から14日までのモスクワでのデジタルイベント</a></li>
<li><a href="../ja505778/index.html">HCI：柔軟な企業ITインフラストラクチャを構築するためのターンキーソリューション</a></li>
<li><a href="../ja505780/index.html">1時間で見積もりジェネレーターを作成する方法</a></li>
<li><a href="../ja505786/index.html">優れたプレゼンテーションを作成するための5つのクラシックアートテクニック</a></li>
<li><a href="../ja505788/index.html">Ozon Goデモデー</a></li>
<li><a href="../ja505796/index.html">CO2、Sp02、COVID-19：より頻繁に換気する必要がある理由（測定が少ない）</a></li>
<li><a href="../ja505798/index.html">PHP 25年：言語の簡単な歴史とPhpStormの50％割引</a></li>
<li><a href="../ja505802/index.html">ホスティングサーバーと専用サーバー：質問に答えます。パート4</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>