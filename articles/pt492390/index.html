<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôçüèæ ü§õüèΩ ü§π Guerra no freio. Otimizando o n√∫mero de renderiza√ß√µes de componentes no React Native üîì üÜë üë®üèæ‚Äçüè≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° Habr! Meu nome √© Kamo Spertsyan, estou envolvido no desenvolvimento do React Native no Profi.ru. Se voc√™ decidir usar a tecnologia React Native pa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Guerra no freio. Otimizando o n√∫mero de renderiza√ß√µes de componentes no React Native</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492390/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ol√° Habr! Meu nome √© Kamo Spertsyan, estou envolvido no desenvolvimento do React Native no Profi.ru. Se voc√™ decidir </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usar a tecnologia React Native</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para fornecer rapidamente recursos do produto e se concentrar na velocidade de desenvolvimento, √© prov√°vel que encontre problemas de desempenho. Pelo menos foi o que aconteceu conosco. Ap√≥s seis meses de desenvolvimento ativo, o desempenho de nosso aplicativo caiu abaixo de um n√≠vel cr√≠tico - tudo ficou muito lento. Portanto, adotamos a otimiza√ß√£o - removemos todos os "freios" durante a inicializa√ß√£o, transi√ß√µes entre telas, renderizando telas, rea√ß√µes √†s a√ß√µes do usu√°rio. Como resultado, em tr√™s meses eles trouxeram a experi√™ncia do usu√°rio para o n√≠vel nativo. Neste artigo, quero falar sobre como otimizamos o aplicativo no React Native e resolvemos o problema de renderiza√ß√µes de v√°rios componentes.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tv/qy/9b/tvqy9bo_jyqc4cz044_gneepvmw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Reuni recomenda√ß√µes que ajudar√£o a minimizar o n√∫mero de redesenhos in√∫teis de componentes. </font><font style="vertical-align: inherit;">Para maior clareza, nos exemplos eu comparo as implementa√ß√µes "ruim" e "boa". </font><font style="vertical-align: inherit;">O artigo ser√° √∫til para aqueles que j√° enfrentam um desempenho ruim do aplicativo e para aqueles que n√£o desejam permitir isso no futuro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usamos React Native emparelhado com Redux. </font><font style="vertical-align: inherit;">Algumas dicas est√£o relacionadas a esta biblioteca. </font><font style="vertical-align: inherit;">Tamb√©m no exemplo, eu uso a biblioteca Redux-thunk - para simular o trabalho com a rede.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quando pensar em desempenho?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De fato, vale lembrar desde o in√≠cio do trabalho no aplicativo. Mas se o seu aplicativo j√° estiver diminuindo a velocidade - n√£o se desespere, tudo pode ser corrigido. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo mundo sabe, mas s√≥ para garantir, vou mencionar: √© melhor verificar o desempenho em dispositivos fracos. Se voc√™ estiver desenvolvendo em dispositivos avan√ßados, talvez n√£o conhe√ßa os "freios" dos usu√°rios finais. Decida por si mesmo os dispositivos pelos quais voc√™ ser√° guiado. Me√ßa o tempo ou o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FPS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nos gr√°ficos de controle para comparar com os resultados ap√≥s a otimiza√ß√£o.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Reagir nativo imediatamente fornece a capacidade de medir aplicativos FPS atrav√©s das Ferramentas do desenvolvedor ‚Üí Mostrar monitor de desempenho. </font><font style="vertical-align: inherit;">O valor de refer√™ncia √© 60 quadros por segundo. </font><font style="vertical-align: inherit;">Quanto menor esse indicador, mais forte o aplicativo "fica mais lento" - n√£o responde ou reage com um atraso √†s a√ß√µes do usu√°rio. </font><font style="vertical-align: inherit;">Um dos principais efeitos no FPS √© o n√∫mero de renderiza√ß√µes, cuja ‚Äúgravidade‚Äù depende da complexidade dos componentes.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descri√ß√£o do exemplo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu mostro todas as recomenda√ß√µes no exemplo de um aplicativo simples com uma lista de not√≠cias. </font><font style="vertical-align: inherit;">O aplicativo possui uma tela, localizada </font></font><code>FlatList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com as not√≠cias. </font><font style="vertical-align: inherit;">Um item de not√≠cia √© um componente </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que consiste em dois componentes menores - o t√≠tulo ( </font></font><code>NewsItemTitle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) e o corpo ( </font></font><code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">O exemplo inteiro pode ser visto </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Al√©m disso, no texto h√° links para v√°rias ramifica√ß√µes do reposit√≥rio para exemplos espec√≠ficos. </font><font style="vertical-align: inherit;">O reposit√≥rio √© usado para a conveni√™ncia dos leitores que desejam explorar exemplos mais profundamente. </font><font style="vertical-align: inherit;">O c√≥digo no reposit√≥rio e nos exemplos abaixo n√£o afirma ser perfeito - √© necess√°rio apenas para fins de demonstra√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abaixo, todos os componentes s√£o mostrados esquematicamente com links e acess√≥rios.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/d9/ng/z6/d9ngz6hldmphbkjky1a-7-38nlq.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No m√©todo de renderiza√ß√£o de cada componente, adicionei a sa√≠da ao console de informa√ß√µes exclusivas sobre ele: </font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_{no}<font></font>
ITEM_TITLE_{no}<font></font>
ITEM_BODY_{no}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
onde </font></font><code>{no}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© o n√∫mero de s√©rie do notici√°rio para distinguir entre diferentes renderiza√ß√µes de not√≠cias e v√°rias renderiza√ß√µes do mesmo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para testar em cada </font></font><code>refresh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lista de not√≠cias, s√£o adicionadas not√≠cias adicionais ao seu in√≠cio. </font><font style="vertical-align: inherit;">Ao mesmo tempo, a seguinte mensagem √© exibida no console:</font></font><br>
<br>
<pre><code class="plaintext hljs">--------------[ REFRESHING ]--------------</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esses registros ajudar√£o a entender se h√° um problema em algum componente espec√≠fico e, posteriormente, a determinar se foi poss√≠vel otimiz√°-lo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se implementado corretamente, nosso log ap√≥s o lan√ßamento e v√°rias atualiza√ß√µes devem ficar assim:</font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_3<font></font>
ITEM_TITLE_3<font></font>
ITEM_BODY_3<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_4<font></font>
ITEM_TITLE_4<font></font>
ITEM_BODY_4</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No primeiro in√≠cio, a tela em si e duas not√≠cias iniciais s√£o sorteadas. </font><font style="vertical-align: inherit;">Ao atualizar o quadro, a tela √© renderizada novamente, porque seus dados realmente mudaram. </font><font style="vertical-align: inherit;">Mais not√≠cias aparecem. </font><font style="vertical-align: inherit;">Todas as not√≠cias anteriores n√£o s√£o redesenhadas, pois n√£o houve altera√ß√µes nos dados.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quando um componente √© renderizado?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em React e React Native, h√° duas condi√ß√µes para renderizar um componente:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mudando seus adere√ßos / estado,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">render do componente pai.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma fun√ß√£o pode ser redefinida em um componente </font></font><code>shouldComponentUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- ela recebe novos Props e State como uma entrada e informa se o componente deve ser renderizado. Freq√ºentemente, para evitar re-renderiza√ß√µes desnecess√°rias, </font><font style="vertical-align: inherit;">basta </font><font style="vertical-align: inherit;">uma </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">compara√ß√£o superficial</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dos objetos Props e State. Por exemplo, isso elimina renderiza√ß√µes desnecess√°rias quando o componente pai √© alterado, se eles n√£o afetam o componente filho. Para n√£o escrever uma compara√ß√£o de superf√≠cie manualmente a cada vez, voc√™ pode herdar um componente </font></font><code>React.PureComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que encapsula essa verifica√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando usamos a fun√ß√£o link de conex√£o, a biblioteca Redux cria um novo componente que √© "conectado" ao estado global. Altera√ß√µes nesse estado acionam um m√©todo</font></font><code>mapStateToProps</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que retorna novos adere√ßos. </font><font style="vertical-align: inherit;">Em seguida, √© iniciada uma compara√ß√£o de adere√ßos antigos e novos, independentemente de o componente ter sido declarado </font></font><code>PureComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou n√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considere essas nuances em nosso exemplo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deixar o </font><font style="vertical-align: inherit;">componente </font><font style="vertical-align: inherit;">passar </font></font><code>connect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>NewsItemTitle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">herdar de </font></font><code>React.Component</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- de </font></font><code>React.PureComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo de exemplo completo</font></font></a><br>
<br>
<pre><code class="plaintext hljs">export class NewsItemTitle extends React.Component<font></font>
export class NewsItemBody extends React.PureComponent</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A seguir, como ser√° o registro ap√≥s uma atualiza√ß√£o de quadro:</font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_3<font></font>
ITEM_TITLE_3<font></font>
ITEM_BODY_3<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode ver que os componentes de not√≠cias e t√≠tulos s√£o redesenhados. </font><font style="vertical-align: inherit;">Vamos consider√°-los por sua vez. </font></font><br>
<br>
<code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">declarado usando </font></font><code>connect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Como acess√≥rio, esse componente recebe um identificador, pelo qual recebe posteriormente not√≠cias em </font></font><code>mapStateToProps</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">const mapStateToProps = (state, ownProps) =&gt; ({<font></font>
  item: state.newsMap[ownProps.itemKey],<font></font>
});</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como ao atualizar o painel, todas as not√≠cias s√£o baixadas novamente, o objeto ser√° </font></font><code>item</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atualizado e depois se referir√° a v√°rias c√©lulas de mem√≥ria. Em outras palavras, eles ser√£o objetos diferentes, mesmo que todos os campos contidos sejam os mesmos. Portanto, uma compara√ß√£o do componente State'ov anterior e novo retorna </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. O componente ser√° renderizado novamente, apesar do fato de que os dados n√£o foram alterados. </font></font><br>
<br>
<code>NewsItemTitle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© herdado de </font></font><code>React.Component</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, portanto, √© renderizado novamente sempre que o componente pai √© renderizado. Isso acontece independentemente dos valores dos adere√ßos antigos e novos. </font></font><br>
<br>
<code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">herdado de </font></font><code>React.PureComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, para comparar adere√ßos antigos e novos. Nas not√≠cias 1 e 2, seus valores s√£o equivalentes; portanto, o componente √© renderizado apenas para as not√≠cias 3. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para otimizar as renderiza√ß√µes</font></font><code>NewsItemTitle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apenas declare como </font></font><code>React.PureComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">No caso de, voc√™ </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deve redefinir a fun√ß√£o </font></font><code>shouldComponentUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">shouldComponentUpdate(nextProps) {<font></font>
  return !shallowEqual(this.props.item, nextProps.item);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo de exemplo completo</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Aqui </font></font><code>shallowEqual</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est√° um recurso para compara√ß√£o de superf√≠cie de objetos que o Redux fornece. </font><font style="vertical-align: inherit;">Voc√™ pode escrever assim:</font></font><br>
<br>
<pre><code class="plaintext hljs">shouldComponentUpdate(nextProps) {<font></font>
  return (<font></font>
    this.props.item.title !== nextProps.item.title ||<font></font>
    this.props.item.body !== nextProps.item.body<font></font>
  );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√° a apar√™ncia do nosso log depois disso: </font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_3<font></font>
ITEM_TITLE_3<font></font>
ITEM_BODY_3</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota</font></font></b><div class="spoiler_text"> <code>shouldComponentUpdate</code>  <code>NewsItem</code> ,  <code>NewsItemTitle</code>   .        . <code>NewsItemTitle</code>    -         <code>NewsItem</code>,     .<br>
</div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">React.memo e componentes funcionais</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o √© </font></font><code>shouldComponentUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">poss√≠vel </font><font style="vertical-align: inherit;">substituir </font><font style="vertical-align: inherit;">em um componente funcional. </font><font style="vertical-align: inherit;">Mas isso n√£o significa que, para otimizar um componente funcional, voc√™ tenha que reescrev√™-lo em uma classe. </font><font style="vertical-align: inherit;">Para esses casos, a fun√ß√£o de memoriza√ß√£o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">React.memo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">fornecida</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ele aceita uma entrada de componente e uma fun√ß√£o de compara√ß√£o opcional </font></font><code>areEqual</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Quando chamado, ele </font></font><code>areEqual</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">adquire adere√ßos antigos e novos e deve retornar o resultado da compara√ß√£o. </font><font style="vertical-align: inherit;">A diferen√ßa com o </font></font><code>shouldComponentUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que </font></font><code>areEqual</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deve retornar </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se os adere√ßos forem iguais, e n√£o vice-versa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, a </font></font><code>NewsItemTitle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memoriza√ß√£o pode ser assim:</font></font><br>
<br>
<pre><code class="plaintext hljs">areEqual(prevProps, nextProps) {<font></font>
  return shallowEqual(prevProps, nextProps);<font></font>
}<font></font>
export OptimizedNewsItemTitle = React.memo(NewsItemTitle, areEqual)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ n√£o passar </font></font><code>areEqual</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em </font></font><code>React.memo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, em seguida, uma compara√ß√£o superficial de adere√ßos ser√° feita, ent√£o o nosso exemplo pode ser simplificada:</font></font><br>
<br>
<pre><code class="plaintext hljs">export OptimizedNewsItemTitle = React.memo(NewsItemTitle)</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fun√ß√µes Lambda em adere√ßos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para processar eventos de componentes, as fun√ß√µes podem ser passadas para seus props. </font><font style="vertical-align: inherit;">O exemplo mais impressionante √© a implementa√ß√£o </font></font><code>onPress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Frequentemente, fun√ß√µes lambda an√¥nimas s√£o usadas para isso. </font><font style="vertical-align: inherit;">Digamos </font></font><code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que queremos mostrar apenas a visualiza√ß√£o e, se voc√™ clicar nela - o texto inteiro. </font><font style="vertical-align: inherit;">Para fazer isso, ao renderizar </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">passaremos o seguinte suporte:</font></font><br>
<br>
<pre><code class="plaintext hljs">&lt;NewsItemBody<font></font>
  ...<font></font>
  onPress={() =&gt; this.props.expandBody()}<font></font>
  ...<font></font>
/&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√° a apar√™ncia do log nesta implementa√ß√£o quando o m√©todo </font></font><code>shouldComponentUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exclu√≠do:</font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_3<font></font>
ITEM_TITLE_3<font></font>
ITEM_BODY_3<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os corpos de not√≠cias 1 e 2 s√£o renderizados, embora seus dados n√£o tenham sido alterados, mas </font></font><code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s√£o </font></font><code>PureComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Isso se deve ao fato de que para cada renderiza√ß√£o, o </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valor de adere√ßos </font></font><code>onPress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© criado novamente. </font><font style="vertical-align: inherit;">Tecnicamente, </font></font><code>onPress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com cada renderiza√ß√£o, ele aponta para uma nova √°rea na mem√≥ria, portanto, uma compara√ß√£o superficial de adere√ßos em </font></font><code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retornos falsos. </font><font style="vertical-align: inherit;">O problema foi corrigido pela seguinte entrada:</font></font><br>
<br>
<pre><code class="plaintext hljs">&lt;NewsItemBody<font></font>
  ...<font></font>
  onPress={this.props.expandBody}<font></font>
  ...<font></font>
/&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Registro: </font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_3<font></font>
ITEM_TITLE_3<font></font>
ITEM_BODY_3<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo de exemplo completo</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Infelizmente, uma fun√ß√£o an√¥nima nunca pode ser reescrita como m√©todo ou campo de classe para esse registro. O caso mais comum √© quando, dentro da fun√ß√£o lambda, s√£o utilizadas as vari√°veis ‚Äã‚Äãde escopo da fun√ß√£o na qual ela √© declarada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considere este caso em nosso exemplo. Para alternar da lista geral para a tela de uma not√≠cia, adicionamos o processamento de clicar no corpo da not√≠cia. O m√©todo </font></font><code>renderItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">component </font></font><code>FlatList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ter√° a seguinte apar√™ncia:</font></font><br>
<br>
<pre><code class="plaintext hljs">const renderItem = ({item}) =&gt; (<font></font>
  &lt;NewsItem<font></font>
    itemKey={item}<font></font>
    onBodyPress={() =&gt; this.onItemBodyPress(item)}<font></font>
  /&gt;<font></font>
);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma fun√ß√£o an√¥nima </font></font><code>onBodyPress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√£o pode ser declarada em uma classe, porque a vari√°vel </font></font><code>item</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">necess√°ria para acessar uma not√≠cia espec√≠fica </font><font style="vertical-align: inherit;">desaparecer√° do escopo </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A solu√ß√£o mais simples para o problema √© alterar a assinatura dos acess√≥rios do </font></font><code>onBodyPress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">componente </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para que o par√¢metro necess√°rio seja passado para a fun√ß√£o quando chamado. </font><font style="vertical-align: inherit;">Nesse caso, esse √© o identificador de not√≠cias.</font></font><br>
<br>
<pre><code class="plaintext hljs">const renderItem = ({item}) =&gt; (<font></font>
  &lt;NewsItem<font></font>
    itemKey={item}<font></font>
    onBodyPress={item =&gt; this.onItemBodyPress(item)}<font></font>
  /&gt;<font></font>
);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse caso, j√° podemos remover a fun√ß√£o an√¥nima no m√©todo da classe component.</font></font><br>
<br>
<pre><code class="plaintext hljs">const renderItem = ({item}) =&gt; (<font></font>
  &lt;NewsItem<font></font>
    itemKey={item}<font></font>
    onBodyPress={this.onItemBodyPress}<font></font>
  /&gt;<font></font>
);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, essa solu√ß√£o exigir√° que alteremos o componente </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="plaintext hljs">class NewsItemComponent extends React.Component {<font></font>
render() {<font></font>
  ...<font></font>
  return (<font></font>
      ...<font></font>
      &lt;NewsItemBody<font></font>
        ...<font></font>
        onPress={() =&gt; this.props.onBodyPress(this.props.item)}<font></font>
        ...<font></font>
      /&gt;<font></font>
      ...<font></font>
  );<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E, novamente, voltamos ao problema indicado - passamos uma nova fun√ß√£o lambda para o componente filho para cada renderiza√ß√£o do pai. </font><font style="vertical-align: inherit;">S√≥ agora descemos um n√≠vel. </font><font style="vertical-align: inherit;">Registro:</font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_3<font></font>
ITEM_TITLE_3<font></font>
ITEM_BODY_3<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para se livrar desse problema na raiz, voc√™ pode usar o gancho </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">useCallback</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Permite memorizar uma chamada de fun√ß√£o passando um argumento. </font><font style="vertical-align: inherit;">Se o argumento da fun√ß√£o n√£o for alterado, o resultado da chamada </font></font><code>useCallback</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apontar√° para a mesma √°rea de mem√≥ria. </font><font style="vertical-align: inherit;">No nosso exemplo, isso significa que, ao redesenhar as mesmas not√≠cias, o </font></font><code>onPress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">componente </font><font style="vertical-align: inherit;">prop </font></font><code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√£o ser√° alterado. </font><font style="vertical-align: inherit;">Os ganchos s√≥ podem ser usados ‚Äã‚Äãem componentes funcionais; portanto, a apar√™ncia final do componente </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ser√° a seguinte:</font></font><br>
<br>
<pre><code class="plaintext hljs">function NewsItemComponent(props) {<font></font>
  ...<font></font>
  const {itemKey, onBodyPress} = props.item;<font></font>
  const onPressBody = useCallback(() =&gt; onBodyPress(itemKey), [itemKey, onBodyPress]);<font></font>
  return (<font></font>
    &lt;View&gt;<font></font>
      ...<font></font>
      &lt;NewsItemBody<font></font>
        ...<font></font>
        onPress={onPressBody}<font></font>
        ...<font></font>
      /&gt;<font></font>
    &lt;/View&gt;<font></font>
  );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E o log: </font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_3<font></font>
ITEM_TITLE_3<font></font>
ITEM_BODY_3<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo de exemplo completo</font></font></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Matrizes e objetos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em JavaScript, fun√ß√µes s√£o representadas como objetos, juntamente com matrizes. </font><font style="vertical-align: inherit;">Portanto, o exemplo do bloco anterior √© um caso especial de cria√ß√£o de um novo objeto em props. </font><font style="vertical-align: inherit;">√â bastante comum, ent√£o coloquei em um par√°grafo separado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Qualquer cria√ß√£o de novas fun√ß√µes, matrizes ou objetos em adere√ßos leva a um re-renderizador de componentes. </font><font style="vertical-align: inherit;">Considere esta regra no exemplo a seguir. </font><font style="vertical-align: inherit;">Vamos passar em um </font></font><code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">estilo combinado de dois valores:</font></font><br>
<br>
<pre><code class="plaintext hljs">&lt;NewsItemBody<font></font>
  ...<font></font>
  style={[styles.body, styles.item]}<font></font>
  ...<font></font>
/&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E, novamente, o log mostra os renderizadores de componentes extras:</font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_3<font></font>
ITEM_TITLE_3<font></font>
ITEM_BODY_3<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para resolver esse problema, voc√™ pode selecionar um estilo separado que ir√° combinar </font></font><code>body</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>item</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ou, por exemplo, mover a declara√ß√£o da matriz </font></font><code>[styles.body, styles.item]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para uma vari√°vel global. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo de exemplo completo</font></font></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redutores de matriz</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considere outra fonte popular de "freios" associados ao uso </font></font><code>FlatList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Um aplicativo cl√°ssico que cont√©m uma longa lista de itens do servidor implementa a pagina√ß√£o. </font><font style="vertical-align: inherit;">Ou seja, ele carrega um conjunto limitado de elementos na forma da primeira p√°gina, quando a lista de elementos atuais termina, carrega a p√°gina seguinte e assim por diante. </font><font style="vertical-align: inherit;">Um redutor da lista de itens pode ficar assim:</font></font><br>
<br>
<pre><code class="plaintext hljs">const newsIdList = (state = [], action) =&gt; {<font></font>
  if (action.type === 'GOT_NEWS') {<font></font>
    return action.news.map(item =&gt; item.key);<font></font>
  } else if (action.type === 'GOT_OLDER_NEWS') {<font></font>
    return [...state, ...action.news.map(item =&gt; item.key)];<font></font>
  }<font></font>
  return state;<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando cada p√°gina seguinte √© carregada no estilo do aplicativo, uma nova matriz de identificadores √© criada. </font><font style="vertical-align: inherit;">Se passarmos essa matriz para props mais tarde </font></font><code>FlatList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, eis a apar√™ncia do log de renderiza√ß√£o do componente:</font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_&lt;1..10&gt;<font></font>
--------------[ LOADING NEXT PAGE ]--------------<font></font>
SCREEN<font></font>
ITEM_&lt;1..10&gt;<font></font>
ITEM_&lt;1..20&gt;<font></font>
--------------[ LOADING NEXT PAGE ]--------------<font></font>
SCREEN<font></font>
ITEM_&lt;1..20&gt;<font></font>
ITEM_&lt;1..30&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para este exemplo, fiz algumas altera√ß√µes no aplicativo de teste.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Defina o tamanho da p√°gina como 10 not√≠cias.</font></font></li>
<li>   <code>item</code>   <code>NewsItem</code>  <code>FlatList</code>-,        connect. <code>NewsItem</code>    <code>React.Component</code>    .</li>
<li>     .</li>
<li>       .       ‚Ññ1     .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O exemplo mostra que, quando cada p√°gina seguinte √© carregada, todos os elementos antigos s√£o renderizados novamente, ent√£o os elementos antigos e os elementos da nova p√°gina s√£o renderizados novamente. Para os amantes da matem√°tica: se o tamanho da p√°gina for igual </font></font><code>X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, quando a </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i </font><font style="vertical-align: inherit;">- </font><font style="vertical-align: inherit;">√©sima p√°gina for </font><font style="vertical-align: inherit;">carregada, em </font><font style="vertical-align: inherit;">vez de renderizar apenas </font></font><code>X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">novos elementos, os elementos ser√£o renderizados </font></font><code>(i - 1) * X + i * X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚ÄúOk‚Äù, voc√™ diz, ‚Äúeu entendo por que todos os elementos s√£o desenhados ap√≥s adicionar uma nova p√°gina: o redutor retornou uma nova matriz, uma nova √°rea de mem√≥ria, tudo isso. Mas por que precisamos renderizar a lista antiga antes de adicionar novos elementos? ‚Äù "Boa pergunta", eu vou responder. Isso √© consequ√™ncia do trabalho com o estado do componente </font></font><code>VirtualizedList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em cuja base</font></font><code>FlatList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">N√£o vou entrar em detalhes, pois eles publicam um artigo separado. </font><font style="vertical-align: inherit;">Quem se importa, eu aconselho voc√™ a se aprofundar na </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documenta√ß√£o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e na fonte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como se livrar de tal n√£o otimiza√ß√£o? </font><font style="vertical-align: inherit;">Reescrevemos o redutor para que ele n√£o retorne uma nova matriz para cada p√°gina, mas adicione elementos √† existente:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aten√ß√£o! </font><font style="vertical-align: inherit;">Antipattern!</font></font></b><div class="spoiler_text">          .     ,    , ,  <code>PureComponent</code>,          .      ,             .      .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"> Redux</a>.<br>
</div></div><br>
<pre><code class="plaintext hljs">const newsIdList = (state = [], action) =&gt; {<font></font>
  if (action.type === 'GOT_NEWS') {<font></font>
    return action.news.map(item =&gt; item.key);<font></font>
  } else if (action.type === 'GOT_OLDER_NEWS') {<font></font>
    action.news.forEach(item =&gt; state.push(item.key));<font></font>
    return state;<font></font>
    // return [...state, ...action.news.map(item =&gt; item.key)];<font></font>
  }<font></font>
  return state;<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois disso, nosso log ficar√° assim:</font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_&lt;1..10&gt;<font></font>
--------------[ LOADING NEXT PAGE ]--------------<font></font>
SCREEN<font></font>
ITEM_&lt;1..20&gt;<font></font>
--------------[ LOADING NEXT PAGE ]--------------<font></font>
SCREEN<font></font>
ITEM_&lt;1..30&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nos livramos da renderiza√ß√£o de elementos antigos </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">antes de</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adicionar elementos a uma nova p√°gina, mas os elementos antigos ainda s√£o desenhados </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ap√≥s a</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> atualiza√ß√£o da lista. O n√∫mero de renderiza√ß√µes para a pr√≥xima p√°gina agora √© igual </font></font><code>i * X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. A f√≥rmula ficou mais simples, mas n√£o vamos parar por a√≠. Temos apenas </font></font><code>X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">novos elementos e queremos apenas </font></font><code>X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">novas renderiza√ß√µes. Usaremos os truques j√° conhecidos para remover as renderiza√ß√µes de not√≠cias que n√£o mudaram os adere√ßos. Voltar conectar a </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_&lt;1..10&gt;<font></font>
--------------[ LOADING NEXT PAGE ]--------------<font></font>
SCREEN<font></font>
ITEM_&lt;11..20&gt;<font></font>
--------------[ LOADING NEXT PAGE ]--------------<font></font>
SCREEN<font></font>
ITEM_&lt;21..30&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bem! Agora podemos ficar satisfeitos conosco. N√£o h√° lugar para otimizar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo de exemplo completo</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Um leitor atento indicar√° que, ap√≥s aplicar a conex√£o ao </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">log, ser√° semelhante ao √∫ltimo exemplo, n√£o importa como voc√™ implemente o redutor. E estar√° certo - se o componente de not√≠cias verificar seus acess√≥rios antes da renderiza√ß√£o, n√£o importa se a matriz antiga √© usada pelo redutor ou se ela cria uma nova. Apenas novos elementos s√£o desenhados e apenas uma vez. No entanto, alterar a matriz antiga em vez de criar uma nova nos salva de renderiza√ß√µes desnecess√°rias do componente </font></font><code>FlatList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usado nela </font></font><code>VirtualizedList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e de itera√ß√µes desnecess√°rias de verifica√ß√µes de equival√™ncia de props </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Com um grande n√∫mero de elementos, isso tamb√©m aumenta o desempenho.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O uso de matrizes e objetos mut√°veis ‚Äã‚Äãnos redutores deve ser extremamente cauteloso. </font><font style="vertical-align: inherit;">Neste exemplo, isso √© justificado, mas se voc√™ tiver, digamos, normal </font></font><code>PureComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, quando adicionar elementos √† matriz mut√°vel, os componentes n√£o ser√£o renderizados. </font><font style="vertical-align: inherit;">De fato, seus objetos permanecem inalterados, pois antes e depois da atualiza√ß√£o dos pontos da matriz para a mesma √°rea de mem√≥ria. </font><font style="vertical-align: inherit;">Isso pode levar a consequ√™ncias inesperadas. </font><font style="vertical-align: inherit;">N√£o √© de admirar que o exemplo descrito viole os </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">princ√≠pios do Redux</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E algo mais...</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ usar bibliotecas no n√≠vel da apresenta√ß√£o, aconselho que voc√™ entenda em detalhes como elas s√£o implementadas. </font><font style="vertical-align: inherit;">Em nosso aplicativo, usamos um componente </font></font><code>Swipeable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">da biblioteca </font></font><code>react-native-gesture-handler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ele permite implementar um bloco de a√ß√µes adicionais ao trocar cart√µes da lista. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No c√≥digo, fica assim:</font></font><br>
<br>
<pre><code class="plaintext hljs">&lt;Swipeable<font></font>
  ...<font></font>
  renderRightActions={this.renderRightActions}<font></font>
  ...<font></font>
&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
M√©todo </font></font><code>renderRightActions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>renderLeftActions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retorna o componente que √© exibido ap√≥s o furto. Determinamos e alteramos a altura do painel durante a troca de componentes para ajustar o conte√∫do necess√°rio. Esse √© um processo que consome muitos recursos, mas se ocorrer durante a anima√ß√£o de furto, o usu√°rio n√£o ver√° interfer√™ncia.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/wz/n1/vg/wzn1vghiy6-wjclqcy8itdy1fns.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O problema √© que o componente </font></font><code>Swipeable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chama o m√©todo </font></font><code>renderRightActions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no momento da renderiza√ß√£o do componente principal. Todos os c√°lculos e at√© a renderiza√ß√£o da barra de a√ß√£o, que n√£o √© vis√≠vel antes do furto, ocorrem com anteced√™ncia. Portanto, todas essas a√ß√µes s√£o executadas para todos os cart√µes da lista ao mesmo tempo. Isso causou "freios" significativos ao rolar a prancha. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O problema foi resolvido da seguinte maneira. Se o painel de a√ß√£o for desenhado junto com o componente principal, e n√£o como resultado do furto, o m√©todo </font></font><code>renderRightActions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retornar√° um vazio do </font></font><code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tamanho do componente principal. Caso contr√°rio, desenharemos o painel de a√ß√µes adicionais como antes.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dou este exemplo porque as bibliotecas de suporte nem sempre funcionam como o esperado. </font><font style="vertical-align: inherit;">E se essas s√£o bibliotecas no n√≠vel da apresenta√ß√£o, √© melhor garantir que elas n√£o estejam desperdi√ßando recursos desnecess√°rios.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">achados</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s eliminar os problemas descritos no artigo, aceleramos significativamente o aplicativo no React Native. </font><font style="vertical-align: inherit;">Agora √© dif√≠cil diferenci√°-lo no desempenho de um similar, implementado nativamente. </font><font style="vertical-align: inherit;">O excesso de renderiza√ß√µes diminuiu o carregamento de telas individuais e a rea√ß√£o √†s a√ß√µes do usu√°rio. </font><font style="vertical-align: inherit;">Acima de tudo, era percept√≠vel nas listas, onde dezenas de componentes s√£o desenhados ao mesmo tempo. </font><font style="vertical-align: inherit;">N√£o otimizamos tudo, mas as telas principais do aplicativo n√£o ficam mais lentas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os principais pontos do artigo est√£o listados abaixo a seguir.</font></font><br>
<br>
<ol>
<li> React Native      :  Props/State-     .</li>
<li>,   <code>React.PureComponent</code>,     ,       .</li>
<li>    ,    <code>shouldComponentUpdate</code>      <code>React.Memo</code>   .</li>
<li>-        .      ,         (shallow compare).               ,     .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O suporte a bibliotecas no n√≠vel da apresenta√ß√£o pode levar ao desperd√≠cio inesperado de recursos. </font><font style="vertical-align: inherit;">Vale a pena ter cuidado em sua aplica√ß√£o.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso √© tudo. </font><font style="vertical-align: inherit;">Espero que voc√™ encontre as informa√ß√µes √∫teis. </font><font style="vertical-align: inherit;">Ficarei feliz em qualquer feedback!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fontes √∫teis</font></font></h2><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compreendendo a renderiza√ß√£o no React + Redux</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comparando objetos em JavaScript</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Melhorando o desempenho em reagir componentes funcionais usando React.memo ()</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como o Discord atinge o desempenho nativo do iOS com o React Native</font></font></a></li>
</ol></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt492374/index.html">Experi√™ncia: Redux do mundo OOP</a></li>
<li><a href="../pt492376/index.html">Como fazer com que seu artigo ou documenta√ß√£o seja compreendido com rapidez e precis√£o</a></li>
<li><a href="../pt492378/index.html">Reactjs, Material-UI com JSS. Guia breve</a></li>
<li><a href="../pt492384/index.html">Hack The Box - Passo a passo do carteiro Redis e WebMin</a></li>
<li><a href="../pt492386/index.html">Como o setor de TI ajuda o mundo a produzir menos alimentos</a></li>
<li><a href="../pt492392/index.html">Dicas e truques do IntelliJ IDEA: 3. Personalizando o estilo do c√≥digo para cada pasta</a></li>
<li><a href="../pt492394/index.html">Universo escuro. Parte 2</a></li>
<li><a href="../pt492398/index.html">Configuramos nossos dispositivos para trabalho remoto, podcasting, v√≠deo e streaming</a></li>
<li><a href="../pt492404/index.html">Flutter + arduino nano 33 BLE sense = sensor BLE muito simples</a></li>
<li><a href="../pt492406/index.html">Podcasts para o geek: alguns programas comprovados sobre gerenciamento de projetos, an√°lise de tecnologia e GTD</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>