<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎖️ 🏇🏻 🧜🏻 Fermat and Miller-Rabin simplicity tests 🐡 ♦️ 👩🏾‍🎨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salute to the Habrovsk citizens! Today we continue to share useful material, a translation of which was prepared specifically for students of the cour...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Fermat and Miller-Rabin simplicity tests</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/486116/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Salute to the Habrovsk citizens! </font><font style="vertical-align: inherit;">Today we continue to share useful material, a translation of which was prepared specifically for students of the course </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Algorithms for Developers"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
</i><br>
<img src="https://habrastorage.org/webt/qf/dz/58/qfdz58atfebt2egzwexicnh03t4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Given a number </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, how to understand that this number is prime? </font><font style="vertical-align: inherit;">Suppose that it is </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">initially odd, because otherwise the task is quite simple. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The most obvious idea would be to look for all the divisors of a number </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, but so far the main problem is to find an efficient algorithm.</font></font><a name="habracut"></a><br>
<hr><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Farm Test</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fermat’s Theorem</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , if </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is a prime, then the following equality holds for any a </font><font style="vertical-align: inherit;">. From here we can derive the Fermat test rule for checking the simplicity of a number: take a random one </font><font style="vertical-align: inherit;">and check whether the equality holds </font><font style="vertical-align: inherit;">. If equality is not respected, then most likely </font><font style="vertical-align: inherit;">- composite. </font><font style="vertical-align: inherit;">
Nevertheless, the condition of equality can be met, even if it </font><font style="vertical-align: inherit;">is not a simple one. Take for example </font><font style="vertical-align: inherit;">. According to the Chinese </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">remainder theorem</font></a><font style="vertical-align: inherit;"> : </font><font style="vertical-align: inherit;">
where each the Z ∈ a </font><sup><font style="vertical-align: inherit;">* </font></sup><sub><font style="vertical-align: inherit;">561</font></sub><font style="vertical-align: inherit;"> corresponds to the following: </font><font style="vertical-align: inherit;">
According to Fermat's Last Theorem, </font><font style="vertical-align: inherit;">, </font><font style="vertical-align: inherit;">, </font><font style="vertical-align: inherit;">. Since 2, 10, and 16 are all 560 dividers, this means that</font></font><code>a<sup>n−1</sup>=1 (mod n)</code><font style="vertical-align: inherit;"></font><code>a ∈ {1, ..., n−1}</code><font style="vertical-align: inherit;"></font><code> a<sup>n−1</sup>=1 (mod n)</code><font style="vertical-align: inherit;"></font><code>n</code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><code>n</code><font style="vertical-align: inherit;"></font><code><code>n</code> = 561 = 3 × 11 × 17</code><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<code> Z<sub>561</sub> = Z<sub>3</sub> × Z<sub>11</sub> × Z<sub>17</sub></code><br>
<br><font style="vertical-align: inherit;"></font><sup><font style="vertical-align: inherit;"></font></sup><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><br>
<br>
<code>(x,y,z) ∈ Z<sup>∗</sup><sub>3</sub>×Z<sup>∗</sup><sub>11</sub>11×Z<sup>∗</sup><sub>17</sub>.</code><br>
<br><font style="vertical-align: inherit;"></font><code> x<sup>2</sup>=1</code><font style="vertical-align: inherit;"></font><code>y<sup>10</sup>=1</code><font style="vertical-align: inherit;"></font><code><i></i> z<sup>16</sup>=1</code><font style="vertical-align: inherit;"></font><code>(x,y,z)<sup>560</sup> = (1, 1, 1)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in other words </font><font style="vertical-align: inherit;">for anyone </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">
It does not matter which a we choose, 561 will always pass the Fermat test, despite the fact that it is composite, as long as a is mutually simple with </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Such numbers are called Carmichael numbers and it turns out that there are an infinite number of them. </font><font style="vertical-align: inherit;">
If it is </font><font style="vertical-align: inherit;">not coprime with </font><font style="vertical-align: inherit;">, then it does not pass the Fermat test, but in this case we can abandon the tests and continue to search for divisors </font><font style="vertical-align: inherit;">by computing the GCD ( </font><i><font style="vertical-align: inherit;">a, n</font></i><font style="vertical-align: inherit;"> ).</font></font><code>a<sup>560</sup> = 1</code><font style="vertical-align: inherit;"></font><code> a ∈ Z<sup>∗</sup><sub>561</sub></code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><code>n</code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><code>a</code><font style="vertical-align: inherit;"></font><code>n</code><font style="vertical-align: inherit;"></font><code>n</code><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
 <br>
 <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Miller-Rabin Test</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 We can refine the test by saying that </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is simple if and only if the solutions </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">are</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">
Thus, if n passes the Fermat test, that is </font><font style="vertical-align: inherit;">, then we check to ensure that </font><font style="vertical-align: inherit;">, since </font><font style="vertical-align: inherit;">this is the square root of 1. </font><font style="vertical-align: inherit;">
Unfortunately, numbers such as 1729, the third Carmichael number, can still fool this improved test. What if we iterate over? That is, until this is possible, we will reduce the exponent by half, until we reach a number other than 1. If we get in the end something other than -1, then it </font><font style="vertical-align: inherit;">will be composite. </font><font style="vertical-align: inherit;">
Speaking more formally, then let 2 </font><sup><font style="vertical-align: inherit;">S</font></sup></font><code>x<sup>2</sup> = 1 (mod n)</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"></font></a> <code>x = ±1</code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><code>a<sup>n−1</sup> = 1</code><font style="vertical-align: inherit;"></font><code>a<sup>(n−1)/2</sup> = ±1</code><font style="vertical-align: inherit;"></font><code>a<sup>(n−1)/2</sup> </code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><code>n</code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><sup><font style="vertical-align: inherit;"></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will be the largest power of 2, divisible by n-1, that is, </font><font style="vertical-align: inherit;">for some odd number </font><font style="vertical-align: inherit;">. Each number in the sequence </font><font style="vertical-align: inherit;">, </font><font style="vertical-align: inherit;">, ..., </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">
This is the square root of the previous member of the sequence. </font><font style="vertical-align: inherit;">
 Then if </font><font style="vertical-align: inherit;">is a prime number, then the sequence must begin with 1 and each subsequent number must also be 1, or the first member of the sequence may not be 1, but then it is -1. </font><font style="vertical-align: inherit;">
The Miller-Rabin test takes random </font><font style="vertical-align: inherit;">. If the above sequence does not start with 1, or the first member of the sequence is not 1 or -1, then it </font><font style="vertical-align: inherit;">is not simple. </font><font style="vertical-align: inherit;">
It turns out that for any compound</font></font><code>n−1=2<sup>S</sup>q</code><font style="vertical-align: inherit;"></font><code>q</code><font style="vertical-align: inherit;"></font><br>
<br>
<code>a<sup>n−1</sup> = a<sup>(2^S)q</sup></code><font style="vertical-align: inherit;"></font><code>a<sup>(2^S-1)q</sup></code><font style="vertical-align: inherit;"></font><code>aq</code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
 <br><font style="vertical-align: inherit;"></font><code>n</code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><code> a∈ Z<sub>n</sub></code><font style="vertical-align: inherit;"></font><code>n</code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, including Carmichael numbers, the probability of passing the Miller-Rabin test is approximately 1/4. (On average, much less.) Thus, the likelihood that </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">several test runs will pass decreases exponentially. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Miller-Rabin test fails with a sequence starting with 1, then we get a non-trivial square root of 1 modulo </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and we can </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">effectively find the divisors</font></font></a> <code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Therefore, Carmichael numbers are always convenient to factor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When the test is applied to numbers of the form </font></font><code>pq</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, where </font></font><code>p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>q</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">are large prime numbers, they do not pass the Miller-Rabin test in almost all cases, since the sequence does not start with 1. So, we won’t be able to break the RSA.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In practice, the Miller-Rabin test is implemented as follows:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Given </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, you need to find </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">such that </font><font style="vertical-align: inherit;">for some odd </font><font style="vertical-align: inherit;">.</font></font><code>n – 1 = 2<sup>S</sup>q</code><font style="vertical-align: inherit;"></font><code>q</code><font style="vertical-align: inherit;"></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Take random </font></font><code>a ∈ {1,...,n−1}</code></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If a </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">q</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = 1, then </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the test passes and we stop execution.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To </font></font><code> i= 0, ... , s−1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">check equality </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">If equality is satisfied, then </font><font style="vertical-align: inherit;">the test passes (stop execution).</font></font><code>a<sup>(2^i)q</sup> = −1</code><font style="vertical-align: inherit;"></font><code>n</code><font style="vertical-align: inherit;"></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If none of the above conditions is met, then </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- composite.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Before performing the Miller-Rabin test, it is worthwhile to carry out a few more trivial divisions into small primes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Strictly speaking, these tests are tests for whether a number is considered to be compound, since they do not prove in fact that the number being checked is prime, but they definitely prove that it can be compound. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are still deterministic algorithms working in polynomial time to determine simplicity (Agrawal, Kayal and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saxena</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), but today they are considered impractical.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/en486116/">https://habr.com/ru/post/en486116/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en486100/index.html">How to create a decentralized application that scales? Use less blockchain</a></li>
<li><a href="../en486106/index.html">Adaptive Backlight for Raspberry Pi TV - Ambilight Analog</a></li>
<li><a href="../en486108/index.html">SSD for gamers and data storage of the future: Seagate at CES 2020</a></li>
<li><a href="../en486112/index.html">Flask web applications: how to deal with cyclic imports</a></li>
<li><a href="../en486114/index.html">Leading scientists in the field of neuroscience will gather at the annual congress of the neuronet industry union</a></li>
<li><a href="../en486120/index.html">Normalization of deviance. How bad practices are becoming the norm in our industry</a></li>
<li><a href="../en486122/index.html">Child ReactJS with 135 lines of code</a></li>
<li><a href="../en486124/index.html">Impala vs Hive vs Spark SQL: Choosing the right SQL engine to work properly in the Cloudera Data Warehouse</a></li>
<li><a href="../en486126/index.html">Microservices with Spring Boot. Part 5. Using the Eureka name server</a></li>
<li><a href="../en486128/index.html">Quality Architect: who is it and when is it needed</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>