<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⛳️ ☝🏿 📧 iOS应用程序的组装和交付功能 🧚🏼 🤰🏼 🤷</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在本文中，Plarium Krasnodar工作室的DevOps工程师Maxim Shestakov分享了他在CI / CD调试期间积累的iOS应用程序的构建和交付方面的经验。
 
 
 
 训练
 与Apple设备开发应用程序相关联的每个人都已经设法体会到了有争议的基础设施的可用性。困难无处不在：...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>iOS应用程序的组装和交付功能</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/plarium/blog/490698/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本文中，Plarium Krasnodar工作室的DevOps工程师Maxim Shestakov分享了他在CI / CD调试期间积累的iOS应用程序的构建和交付方面的经验。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ls/eq/j8/lseqj8pl9g9h1yrdm-h-ekpzuno.jpeg"><a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">训练</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
与Apple设备开发应用程序相关联的每个人都已经设法体会到了有争议的基础设施的可用性。</font><font style="vertical-align: inherit;">困难无处不在：从开发人员资料菜单到调试和组装工具。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
网上有很多有关基本知识的文章，因此我们将尝试重点介绍。</font><font style="vertical-align: inherit;">这是成功构建应用程序所需要的：</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开发者账户</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于macOS的设备充当构建服务器；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开发人员证书</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，该</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">证书</font></a><font style="vertical-align: inherit;">将用于对应用程序进行签名；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建的具有唯一</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序</font><font style="vertical-align: inherit;">（应注意捆绑标识符的重要性，因为使用通配符ID使得无法使用应用程序的许多功能，例如：关联域，推送通知，Apple登录等）；</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序签名</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">档案</font></a><font style="vertical-align: inherit;">。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
开发人员证书应通过任何macOS设备上的钥匙串生成。</font><font style="vertical-align: inherit;">证书的类型非常重要。</font><font style="vertical-align: inherit;">根据应用程序环境（开发，质量保证，分段，生产），它会有所不同（开发或分发）以及应用程序签名配置文件的类型。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
配置文件的主要类型：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开发-旨在使用开发证书（iPhone开发人员的名称形式：XXXXX）来签署开发团队的应用程序；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特设-用于使用开发人员的发行证书（iPhone发行类型的名称：XXXXX）由质量检查部门签署测试应用程序并进行内部验证；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">App Store-发布版本，用于通过TestFlight进行外部测试，并使用开发者的发行证书上传到App Store。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
生成“开发”和“临时”配置文件时，还会显示</font><font style="vertical-align: inherit;">可在其上安装构建</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的设备</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">列表</font></a><font style="vertical-align: inherit;">，这使您可以进一步限制用户的访问。</font><font style="vertical-align: inherit;">App Store配置文件没有设备列表，因为TestFlight负责封闭Beta测试期间的访问控制，这将在后面进行讨论。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了清楚起见，您可以在下面的平板电脑形式显示开发者资料。</font><font style="vertical-align: inherit;">更容易了解我们所需的装配参数以及从何处获取它们。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qd/dt/u9/qddtu9hfklorm9kmotcctpr-hoc.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部件</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了使按项目和环境分离程序集更加容易，我们使用视图的概要文件</font></font><code>${ProjectName}_${Instance}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的名称，即项目+实例的名称（取决于应用程序环境：Dev，QA，GD，Staging，Live等）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
导入到构建服务器时，概要文件将其名称更改为唯一ID，然后移至该文件夹</font></font><code>/Users/$Username/Library/MobileDevice/Provisioning Profiles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font><font style="vertical-align: inherit;">该文件夹</font></font><code>$Username</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与构建服务器用户帐户名相对应）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
生成* .ipa文件有两种方法-过时的（PackageApplication）和现代的（通过创建XcAchive并导出）。</font><font style="vertical-align: inherit;">第一种方法被认为已过时，因为从8.3版开始，应用文件打包模块已从Xcode发行版中删除。</font><font style="vertical-align: inherit;">要使用它，您需要将模块从旧的Xcode（8.2和更早版本）复制到文件夹中：</font></font><br>
<code>/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/usr/bin/ </code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后运行命令：</font></font><br>
<br>
<pre><code class="bash hljs">chmod +x /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/usr/bin/*</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来，您需要收集应用程序的* .app文件：</font></font><br>
<br>
<pre><code class="bash hljs">xcodebuild \<font></font>
-workspace <span class="hljs-variable">$ProjectDir</span>/<span class="hljs-variable">$ProjectName</span>.xcworkspace \<font></font>
-scheme <span class="hljs-variable">$SchemeName</span> \<font></font>
-sdk iphoneos \<font></font>
build \<font></font>
-configuration Release \<font></font>
-derivedDataPath build \<font></font>
CODE_SIGN_IDENTITY=”<span class="hljs-variable">$DevAccName</span>”\<font></font>
PROVISIONING_PROFILE=”<span class="hljs-variable">$ProfileId</span>”<font></font>
DEPLOYMENT_POSTPROCESSING=YES \<font></font>
SKIP_INSTALL=YES \<font></font>
ENABLE_BITCODE=NO<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
其中：</font></font><br>
<br>
<code>-workspace</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-项目文件的路径。</font></font><br>
<br>
<code>-scheme</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-项目中指定的二手电路。</font></font><br>
<br>
<code>-derivedDataPath</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-卸载组合应用程序（* .app）的路径。</font></font><br>
<br>
<code>CODE_SIGN_IDENTITY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-可以在钥匙串中验证的开发者帐户的名称（iPhone开发者：XXXX XXXXXXX，括号中没有TeamID）。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pm/lk/fe/pmlkfeglfyjjkdndrmzvtzr8bsu.jpeg"><br>
<br>
<code>PROVISIONING_PROFILE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-用于签署应用程序的配置文件ID，可通过以下命令获得：</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> <span class="hljs-string">"/Users/<span class="hljs-variable">$Username</span>/Library/MobileDevice/Provisioning Profiles/"</span> &amp;&amp; find *.mobileprovision -<span class="hljs-built_in">type</span> f | xargs grep -li <span class="hljs-string">"&gt;<span class="hljs-variable">${ProjectName}</span>_<span class="hljs-variable">${Instance}</span>&lt;"</span> | sed -e <span class="hljs-string">'s/.mobileprovision//'</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果应用程序使用其他配置文件（例如，用于“推送通知”），则请</font></font><code>PROVISIONING_PROFILE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指示：</font></font><br>
<br>
<pre><code class="bash hljs">APP_PROFILE=”<span class="hljs-variable">$AppProfile</span>” \<font></font>
EXTENSION_PROFILE=”<span class="hljs-variable">$ExtProfile</span>” \</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来，应将生成的* .app文件打包在* .ipa中。</font><font style="vertical-align: inherit;">为此，您可以使用以下形式的命令：</font></font><br>
<br>
<pre><code class="bash hljs">/usr/bin/xcrun --sdk iphoneos PackageApplication \<font></font>
-v $(find <span class="hljs-string">"<span class="hljs-variable">$ProjectDir</span>/build/Build/Products/Release-iphoneos"</span> -name <span class="hljs-string">"*.app"</span>) \<font></font>
-o <span class="hljs-string">"<span class="hljs-variable">$ProjectDir</span>/<span class="hljs-variable">$ProjectName_</span><span class="hljs-variable">$Instance</span>.ipa"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，从Apple的角度来看，此方法已过时。</font><font style="vertical-align: inherit;">通过从应用程序存档导出获取* .ipa是很重要的。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，您需要使用以下命令收集存档：</font></font><br>
<br>
<pre><code class="bash hljs">xcodebuild \<font></font>
-workspace <span class="hljs-variable">$ProjectDir</span>/<span class="hljs-variable">$ProjectName</span>.xcworkspace \<font></font>
-scheme <span class="hljs-variable">$SchemeName</span> \<font></font>
-sdk iphoneos \<font></font>
-configuration Release \<font></font>
archive \<font></font>
-archivePath <span class="hljs-variable">$ProjectDir</span>/build/<span class="hljs-variable">$ProjectName</span>.xcarchive \<font></font>
CODE_SIGN_IDENTITY=”<span class="hljs-variable">$DevAccName</span>” \<font></font>
PROVISIONING_PROFILE=”<span class="hljs-variable">$ProfileId</span>”<font></font>
ENABLE_BITCODE=NO \<font></font>
SYNCHRONOUS_SYMBOL_PROCESSING=FALSE</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
区别在于汇编方法和</font></font><code>SYNCHRONOUS_SYMBOL_PROCESSING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在汇编过程中禁用字符卸载</font><font style="vertical-align: inherit;">的选项</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来，我们需要生成一个带有导出设置的文件：</font></font><br>
<br>
<pre><code class="bash hljs">ExportSettings=<span class="hljs-string">"<span class="hljs-variable">$ProjectDir</span>/exportOptions.plist"</span><font></font>
<font></font>
cat &lt;&lt; EOF &gt; <span class="hljs-variable">$ExportSettings</span>
&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;<font></font>
&lt;!DOCTYPE plist PUBLIC <span class="hljs-string">"-//Apple//DTD PLIST 1.0//EN"</span> <span class="hljs-string">"http://www.apple.com/DTDs/PropertyList-1.0.dtd"</span>&gt;<font></font>
&lt;plist version=<span class="hljs-string">"1.0"</span>&gt;<font></font>
&lt;dict&gt;<font></font>
&lt;key&gt;compileBitcode&lt;/key&gt;<font></font>
&lt;<span class="hljs-literal">false</span>/&gt;<font></font>
&lt;key&gt;uploadBitcode&lt;/key&gt;<font></font>
&lt;<span class="hljs-literal">false</span>/&gt;<font></font>
&lt;key&gt;uploadSymbols&lt;/key&gt;<font></font>
&lt;<span class="hljs-literal">false</span>/&gt;<font></font>
&lt;key&gt;method&lt;/key&gt;<font></font>
&lt;string&gt;<span class="hljs-variable">$Method</span>&lt;/string&gt;<font></font>
&lt;key&gt;provisioningProfiles&lt;/key&gt;<font></font>
&lt;dict&gt;<font></font>
&lt;key&gt;<span class="hljs-variable">$BundleID</span>&lt;/key&gt;<font></font>
&lt;string&gt;<span class="hljs-variable">$ProfileId</span>&lt;/string&gt;<font></font>
&lt;/dict&gt;<font></font>
&lt;key&gt;signingCertificate&lt;/key&gt;<font></font>
&lt;string&gt;<span class="hljs-variable">$DevAccName</span>&lt;/string&gt;<font></font>
&lt;key&gt;signingStyle&lt;/key&gt;<font></font>
&lt;string&gt;manual&lt;/string&gt;<font></font>
&lt;key&gt;stripSwiftSymbols&lt;/key&gt;<font></font>
&lt;<span class="hljs-literal">true</span>/&gt;<font></font>
&lt;key&gt;teamID&lt;/key&gt;<font></font>
&lt;string&gt;<span class="hljs-variable">$TeamID</span>&lt;/string&gt;<font></font>
&lt;key&gt;thinning&lt;/key&gt;<font></font>
&lt;string&gt;&lt;none&gt;&lt;/string&gt;<font></font>
&lt;/dict&gt;<font></font>
&lt;/plist&gt;<font></font>
EOF<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
其中：</font></font><br>
<br>
<code>$Method</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-交付方式与应用程序签名配置文件的类型相对应，即对于开发，对于Ad Hoc-ad-hoc，对于App Store-app-store，值将为development。</font></font><br>
<br>
<code>$BundleID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-在应用程序设置中指定的应用程序ID。</font><font style="vertical-align: inherit;">您可以使用以下命令进行检查：</font></font><br>
<br>
<pre><code class="bash hljs">defaults <span class="hljs-built_in">read</span> <span class="hljs-variable">$ProjectDir</span>/Info CFBundleIdentifier</code></pre><br>
<code>$DevAccName  $ProfileId</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-先前使用的开发人员名称和签名配置文件ID的设置，必须与导出设置中的值匹配。</font></font><br>
<br>
<code>$TeamID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-开发人员名称后方括号中的十位数ID，例如：iPhone开发人员：.......（XXXXXXXXXX）；</font><font style="vertical-align: inherit;">可以签入钥匙串。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来，使用export命令，获得必要的* .ipa文件：</font></font><br>
<br>
<pre><code class="bash hljs">xcodebuild \<font></font>
-exportArchive \<font></font>
-archivePath <span class="hljs-variable">$ProjectDir</span>/build/<span class="hljs-variable">$ProjectName</span>.xcarchive \<font></font>
-exportPath <span class="hljs-variable">$ProjectDir</span> \<font></font>
-exportOptionsPlist <span class="hljs-variable">$ExportSettings</span></code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交货</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，已组装的文件必须交付给最终用户，即安装在设备上。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于Development和Ad Hoc构建的分发，有很多服务，例如HockeyApp，AppBlade和其他服务，但是在本文中，我们将讨论用于分发应用程序的独立服务器。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
安装适用于iOS的应用程序分为两个阶段：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过Items Service获取应用程序安装清单。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据清单中通过HTTPS指定的信息安装* .ipa文件。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，对于初学者来说，我们需要使用以下命令生成安装清单（文件类型* .plist）：</font></font><br>
<br>
<pre><code class="bash hljs">cat &lt;&lt; EOF &gt; <span class="hljs-variable">$manifest</span>
&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;<font></font>
&lt;!DOCTYPE plist PUBLIC <span class="hljs-string">"-//Apple//DTD PLIST 1.0//EN"</span> <span class="hljs-string">"http://www.apple.com/DTDs/PropertyList-1.0.dtd"</span>&gt;<font></font>
&lt;plist version=<span class="hljs-string">"1.0"</span>&gt;<font></font>
&lt;dict&gt;<font></font>
&lt;key&gt;items&lt;/key&gt;<font></font>
&lt;array&gt;<font></font>
&lt;dict&gt;<font></font>
&lt;key&gt;assets&lt;/key&gt;<font></font>
&lt;array&gt;<font></font>
&lt;dict&gt;<font></font>
&lt;key&gt;kind&lt;/key&gt;<font></font>
&lt;string&gt;software-package&lt;/string&gt;<font></font>
&lt;key&gt;url&lt;/key&gt;<font></font>
&lt;string&gt;<span class="hljs-variable">$ipaUrl</span>&lt;/string&gt;<font></font>
&lt;/dict&gt;<font></font>
&lt;/array&gt;<font></font>
&lt;key&gt;metadata&lt;/key&gt;<font></font>
&lt;dict&gt;<font></font>
&lt;key&gt;bundle-identifier&lt;/key&gt;<font></font>
&lt;string&gt;<span class="hljs-variable">$BundleID</span>&lt;/string&gt;<font></font>
&lt;key&gt;bundle-version&lt;/key&gt;<font></font>
&lt;string&gt;<span class="hljs-variable">$AppVersion</span>&lt;/string&gt;<font></font>
&lt;key&gt;kind&lt;/key&gt;<font></font>
&lt;string&gt;software&lt;/string&gt;<font></font>
&lt;key&gt;title&lt;/key&gt;<font></font>
&lt;string&gt;<span class="hljs-variable">$ProjectName_</span><span class="hljs-variable">$Instance</span>&lt;/string&gt;<font></font>
&lt;key&gt;subtitle&lt;/key&gt;<font></font>
&lt;string&gt;<span class="hljs-variable">$Instance</span>&lt;/string&gt;<font></font>
&lt;/dict&gt;<font></font>
&lt;/dict&gt;<font></font>
&lt;/array&gt;<font></font>
&lt;/dict&gt;<font></font>
&lt;/plist&gt;<font></font>
EOF</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如您所见，清单几乎包含了应用程序组装中涉及的所有参数。</font><font style="vertical-align: inherit;">可以使用以下命令检查</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
应用程序版本（</font></font><code>$AppVersion</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）：</font></font><br>
<br>
<pre><code class="bash hljs">defaults <span class="hljs-built_in">read</span> <span class="hljs-variable">$ProjectDir</span>/Info CFBundleVersion</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该参数</font></font><code>$ipaUrl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含下载* .ipa文件的直接链接。</font><font style="vertical-align: inherit;">从iOS的第七版开始，必须通过HTTPS安装该应用程序。</font><font style="vertical-align: inherit;">在第八版中，清单格式略有变化：删除了带有表单应用程序图标设置的块</font></font><br>
<br>
<pre><code class="bash hljs">&lt;images&gt;<font></font>
   &lt;image&gt;...&lt;/image&gt;<font></font>
&lt;/images&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，要安装该应用程序，一个带有表单链接的简单html页面就足够了：</font></font><br>
<br>
<pre><code class="bash hljs">itms-services://?action=download-manifest&amp;url=https://<span class="hljs-variable">$ServerUrl</span>/<span class="hljs-variable">$ProjectName</span>/<span class="hljs-variable">$Instance</span>/iOS/<span class="hljs-variable">$AppVersion</span>/manifest.plist</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了满足开发和测试部门的需求，Plarium创建了其构建安装应用程序，该应用程序为我们提供：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自治与独立</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过“临时”动态创建的链接进行集中式访问控制和安全安装应用程序，</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可扩展的功能（也就是说，如有必要，开发团队可以将缺少的功能集成到现有应用程序中）。</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">测试中</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，我们将讨论使用</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TestFlight的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">预发布应用程序测试</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
下载的先决条件是App Store签名配置文件类型和是否存在生成的API密钥。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有几种下载应用程序的方法：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过Xcode（整理器），</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过altool，</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过Application Loader（适用于旧版本的Xcode）（现在称为Transporter）。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于自动加载，使用altool，它也有两种授权方法：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用专用密码，</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API密钥</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最好使用API​​密钥下载应用程序。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要获取API密钥，请点击</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链接</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并生成密钥。</font><font style="vertical-align: inherit;">除了* .p8格式的密钥本身之外，我们还将需要两个参数：IssuerID和KeyID。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7j/el/tr/7jeltrm88wb-m74uokirbdw59xs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来，我们将下载的密钥导入到构建服务器：</font></font><br>
<br>
<pre><code class="bash hljs">mkdir -p ~/.appstoreconnect/private_keys<font></font>
mv ~/Downloads/AuthKey_<span class="hljs-variable">${KeyID}</span>.p8 ~/.appstoreconnect/private_keys/</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在将应用程序加载到TestFlight之前，您需要验证应用程序，请使用以下命令执行此操作：</font></font><br>
<br>
<pre><code class="bash hljs">xcrun altool \<font></font>
--validate-app \<font></font>
-t ios \<font></font>
-f $(find <span class="hljs-string">"<span class="hljs-variable">$ProjectDir</span>"</span> -name <span class="hljs-string">"*.ipa"</span>) \<font></font>
--apiKey “<span class="hljs-variable">$KeyID</span>” \<font></font>
--apiIssuer “<span class="hljs-variable">$IssuerID</span>” </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API密钥生成页面中的</font><font style="vertical-align: inherit;">
where </font></font><code>apiKey</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>apiIssuer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有字段值。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后，在成功验证后，我们使用</font></font><code>--upload-app</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有相同参数</font><font style="vertical-align: inherit;">的命令加载应用程序</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apple会在一到两天内对应用程序进行测试，之后，外部测试人员可以使用该应用程序：他们将通过电子邮件发送安装链接。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通过altool下载应用程序的另一种方法是使用特定于应用程序的密码。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要获取应用专用密码，您需要点击</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链接</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并在“安全性”部分生成该</font><font style="vertical-align: inherit;">密码</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/k6/3k/lk/k63klknhpg0dtwoukakdzmn02om.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来，使用此密码在Keychain中创建构建服务器记录。</font><font style="vertical-align: inherit;">从Xcode版本11开始，可以使用以下命令完成此操作：</font></font><br>
<br>
<pre><code class="bash hljs">xcrun altool --store-password-in-keychain-item <span class="hljs-string">"Altool"</span> -u <span class="hljs-string">"<span class="hljs-variable">$DeveloperName</span>"</span> -p <span class="hljs-variable">$AppPswd</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
其中：</font></font><br>
<br>
<code>$DeveloperName</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是用于登录Apple服务的iOS开发人员帐户的名称。</font></font><br>
<br>
<code>$AppPswd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-生成的应用专用密码。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来，我们获取asc-provider参数的值，并使用以下命令验证导入密码的成功：</font></font><br>
<br>
<pre><code class="bash hljs">xcrun altool --list-providers -u <span class="hljs-string">"<span class="hljs-variable">$DeveloperName</span>"</span> -p <span class="hljs-string">"@keychain:Altool"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们得出结论：</font></font><br>
<br>
<pre><code class="bash hljs">Provider listing:<font></font>
- Long Name - - Short Name -<font></font>
XXXXXXX        XXXXXXXXX</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如您所见，所需的简称（asc-provider）值与构建应用程序时使用的$ TeamID参数匹配。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要在TestFlight中验证并加载应用程序，请使用以下命令：</font></font><br>
<br>
<pre><code class="bash hljs">xcrun altool \<font></font>
--(validate|upload)-app \  <font></font>
-f $(find <span class="hljs-string">"<span class="hljs-variable">$ProjectDir</span>"</span> -name <span class="hljs-string">"*.ipa"</span>) \<font></font>
-u <span class="hljs-string">"<span class="hljs-variable">$DeveloperName</span>"</span> \<font></font>
-p <span class="hljs-string">"@keychain:Altool"</span> \</code></pre><br><font style="vertical-align: inherit;"></font><code>-p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以采用</font></font><code>$AppPswd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未加密（显式）形式</font><font style="vertical-align: inherit;">的值</font><font style="vertical-align: inherit;">
作为参数值</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，正如已经提到的那样，从可操作性的角度来看，最好选择用于授权工具的API密钥，因为在不同版本的Xcode中会遇到各种问题（它看不到钥匙串，卸载过程中的授权错误等）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
实际上，仅此而已。</font><font style="vertical-align: inherit;">我希望所有参与App Store成功构建和无故障发布的人。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN490684/index.html">结构化布线的电缆选择</a></li>
<li><a href="../zh-CN490686/index.html">来自世界开放地图500号的新闻（11.02.2020-17.02.2020）</a></li>
<li><a href="../zh-CN490690/index.html">我们创建PHP + LDAP的WEB地址目录</a></li>
<li><a href="../zh-CN490694/index.html">源代码中的热门注释</a></li>
<li><a href="../zh-CN490696/index.html">商业邮件的工作原理-在线商店和主要发件人</a></li>
<li><a href="../zh-CN490700/index.html">自然语言处理课程</a></li>
<li><a href="../zh-CN490704/index.html">日本和加利福尼亚的卡诺模型</a></li>
<li><a href="../zh-CN490708/index.html">芬兰航空公司Finnair：机组人员的培训方式以及有关厨房内部的一些知识</a></li>
<li><a href="../zh-CN490714/index.html">如何获得每个代码10万个。完整的初学者指南</a></li>
<li><a href="../zh-CN490716/index.html">如何确保小型企业局域网的高质量运行？</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>