<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👲🏻 👨‍💻 🥚 RunUO-Prüfung des PVS-Studio-Analysators 🧜🏻 👎 🤜🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dieser Artikel befasst sich mit der Überprüfung des RunUO-Projekts mit dem statischen Analysator PVS-Studio. RunUO ist ein Server-Software-Emulator fü...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>RunUO-Prüfung des PVS-Studio-Analysators</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/487106/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/pk/vz/nb/pkvznbl6d22oijuluuu2xfoztcs.png" alt="Bild 1"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Artikel befasst sich mit der Überprüfung des RunUO-Projekts mit dem statischen Analysator PVS-Studio. </font><font style="vertical-align: inherit;">RunUO ist ein Server-Software-Emulator für Ultima Online, ein Spiel, das einst die Herzen vieler MMORPG-Fans eroberte.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einführung</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RunUO</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist ein Server-Software-Emulator für MMORPG Ultima Online. Das Ziel dieses Projekts ist es, eine stabile Software zu erstellen, die mit den offiziellen Servern von EA Games konkurrieren kann. RunUO wurde bereits im Jahr 2002 erstellt, verliert jedoch nicht an Relevanz und wird bis heute aktiv genutzt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Zweck der Projektüberprüfung besteht darin, das Thema der statischen Analyse bekannt zu machen. Wir überprüfen verschiedene Projekte - Spiele ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), Bibliotheken ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), Messenger ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), Browser ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) und vieles mehr ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiel)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) um die Aufmerksamkeit eines vielfältigen Publikums auf sich zu ziehen. Mit diesen Artikeln möchten wir auf die Bedeutung der Verwendung statischer Analysen in der Entwicklung aufmerksam machen. Die statische Analyse macht den Code zuverlässiger und sicherer. Außerdem können Sie bei regelmäßiger Verwendung Fehler frühestens finden und beseitigen. Dies spart Entwicklern Zeit und Mühe, da niemand </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50 Stunden</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> damit verbringen möchte, </font><font style="vertical-align: inherit;">nach dem Fehler zu suchen, den der Analysator finden kann.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir helfen auch der Open-Source-Community. </font><font style="vertical-align: inherit;">Durch Artikel mit gefundenen Fehlern tragen wir zur Entwicklung von Open Source bei. </font><font style="vertical-align: inherit;">In den Artikeln analysieren wir jedoch nicht alle Warnungen. </font><font style="vertical-align: inherit;">Einige Warnungen schienen uns zu langweilig, um in den Artikel einzusteigen, andere erwiesen sich als falsch positiv usw. </font><font style="vertical-align: inherit;">Daher sind wir bereit, eine </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kostenlose Lizenz</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> für Open Source-Projekte </font><font style="vertical-align: inherit;">bereitzustellen </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Darüber hinaus mag das, was uns für den Artikel langweilig erschien, für die Entwickler des getesteten Projekts sehr interessant erscheinen, da die Entwickler des Projekts dennoch besser wissen, welche Probleme am kritischsten sind.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Codeteile, die bei der Prüfung des Analysatorberichts aufgefallen sind</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warnung:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3010 Der Rückgabewert der Funktion 'Intern' muss verwendet werden. </font><font style="vertical-align: inherit;">BasePaintedMask.cs 49</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">string</span> <span class="hljs-title">Intern</span>(<span class="hljs-params"> <span class="hljs-keyword">string</span> str </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( str == <span class="hljs-literal">null</span> )
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( str.Length == <span class="hljs-number">0</span> )
    <span class="hljs-keyword">return</span> String.Empty;<font></font>
<font></font>
  <span class="hljs-keyword">return</span> String.Intern( str );<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">BasePaintedMask</span>(<span class="hljs-params"> <span class="hljs-keyword">string</span> staffer, <span class="hljs-keyword">int</span> itemid </span>)
                            : <span class="hljs-title">base</span>(<span class="hljs-params"> itemid + Utility.Random( <span class="hljs-number">2</span> </span>) )</span><font></font>
{<font></font>
  m_Staffer = staffer;<font></font>
<font></font>
  Utility.Intern( m_Staffer );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Rückgabewert der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intern ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -Methode wird </font><font style="vertical-align: inherit;">nirgendwo berücksichtigt, wie vom Analysator angegeben. </font><font style="vertical-align: inherit;">Vielleicht ist dies ein Fehler oder redundanter Code. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warnung:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3017 Es wurde ein Muster erkannt: (Element ist BasePotion) || </font><font style="vertical-align: inherit;">((Element ist BasePotion) &amp;&amp; ...). </font><font style="vertical-align: inherit;">Der Ausdruck ist zu groß oder enthält einen logischen Fehler. </font><font style="vertical-align: inherit;">Cleanup.cs 137</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">IsBuggable</span>(<span class="hljs-params"> Item item </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( item <span class="hljs-keyword">is</span> Fists )
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> ( item <span class="hljs-keyword">is</span> ICommodity || item <span class="hljs-keyword">is</span> Multis.BaseBoat<font></font>
    || item <span class="hljs-keyword">is</span> Fish || item <span class="hljs-keyword">is</span> BigFish<font></font>
    || item <span class="hljs-keyword">is</span> BasePotion || item <span class="hljs-keyword">is</span> Food || item <span class="hljs-keyword">is</span> CookableFood<font></font>
    || item <span class="hljs-keyword">is</span> SpecialFishingNet || item <span class="hljs-keyword">is</span> BaseMagicFish<font></font>
    || item <span class="hljs-keyword">is</span> Shoes || item <span class="hljs-keyword">is</span> Sandals<font></font>
    || item <span class="hljs-keyword">is</span> Boots || item <span class="hljs-keyword">is</span> ThighBoots<font></font>
    || item <span class="hljs-keyword">is</span> TreasureMap || item <span class="hljs-keyword">is</span> MessageInABottle<font></font>
    || item <span class="hljs-keyword">is</span> BaseArmor || item <span class="hljs-keyword">is</span> BaseWeapon<font></font>
    || item <span class="hljs-keyword">is</span> BaseClothing<font></font>
    || ( item <span class="hljs-keyword">is</span> BaseJewel &amp;&amp; Core.AOS )<font></font>
    || ( item <span class="hljs-keyword">is</span> BasePotion &amp;&amp; Core.ML )<font></font>
  {<font></font>
    ....<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt Unterausdrücke, die vereinfacht werden können. </font><font style="vertical-align: inherit;">Ich werde sie aufschreiben, damit es klarer wird:</font></font><br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> (item <span class="hljs-keyword">is</span> BasePotion || ( item <span class="hljs-keyword">is</span> BasePotion &amp;&amp; Core.ML ))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Angenommen, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item ist BasePotion = to true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dann ist die Bedingung trotz </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Core.ML wahr</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Wenn das </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Element BasePotion = bis false lautet</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ist die Bedingung unabhängig vom Wert </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Core.ML</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erneut </font><i><font style="vertical-align: inherit;">false</font></i><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ein solcher Code ist meistens einfach redundant. Es gibt jedoch schlimmere Situationen, in denen der Programmierer einen Fehler gemacht und die falsche Variable in den zweiten Unterausdruck geschrieben hat. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warnung:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3031 Eine übermäßige Überprüfung kann vereinfacht werden. </font><font style="vertical-align: inherit;">Das '||' </font><font style="vertical-align: inherit;">Der Operator ist von den entgegengesetzten Ausdrücken 'bPlayerOnly' und '! bPlayerOnly' umgeben. </font><font style="vertical-align: inherit;">BaseCreature.cs 3005</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">double</span> <span class="hljs-title">GetFightModeRanking</span>(<span class="hljs-params"> Mobile m,
                                           FightMode acqType,
                                           <span class="hljs-keyword">bool</span> bPlayerOnly </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( ( bPlayerOnly &amp;&amp; m.Player ) ||  !bPlayerOnly )<font></font>
  {<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Code ist entweder redundant oder fehlerhaft. </font><font style="vertical-align: inherit;">Sein Problem ist, dass auf beiden Seiten von '||' </font><font style="vertical-align: inherit;">sind im Sinne von Subexpression unterschiedlich. </font><font style="vertical-align: inherit;">Wenn wir es so schneiden:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> ( m.Player || !bPlayerOnly )</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
dann wird sich nichts ändern. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warnung:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3001 Links und rechts vom '||' gibt es identische Unterausdrücke 'deed is SmallBrickHouseDeed'. </font><font style="vertical-align: inherit;">Operator. </font><font style="vertical-align: inherit;">RealEstateBroker.cs 132</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">ComputePriceFor</span>(<span class="hljs-params"> HouseDeed deed </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">int</span> price = <span class="hljs-number">0</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> ( deed <span class="hljs-keyword">is</span> SmallBrickHouseDeed ||    <span class="hljs-comment">// &lt;=</span>
       deed <span class="hljs-keyword">is</span> StonePlasterHouseDeed ||<font></font>
       deed <span class="hljs-keyword">is</span> FieldStoneHouseDeed ||<font></font>
       deed <span class="hljs-keyword">is</span> SmallBrickHouseDeed ||    <span class="hljs-comment">// &lt;=</span>
       deed <span class="hljs-keyword">is</span> WoodHouseDeed ||<font></font>
       deed <span class="hljs-keyword">is</span> WoodPlasterHouseDeed ||<font></font>
       deed <span class="hljs-keyword">is</span> ThatchedRoofCottageDeed )<font></font>
      ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich denke, es lohnt sich nicht, hier etwas zu erklären, den nächsten oder falschen oder redundanten Code. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warnung:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3067 Es ist möglich, dass der Block 'else' vergessen oder auskommentiert wurde, wodurch die Betriebslogik des Programms geändert wurde. </font><font style="vertical-align: inherit;">BaseHouse.cs 1558</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SetLockdown</span>(<span class="hljs-params"> Item i, <span class="hljs-keyword">bool</span> locked, <span class="hljs-keyword">bool</span> checkContains </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( m_LockDowns == <span class="hljs-literal">null</span> )
    <span class="hljs-keyword">return</span>;<font></font>
<font></font>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">region</span> Mondain's Legacy</span>
  <span class="hljs-keyword">if</span> ( i <span class="hljs-keyword">is</span> BaseAddonContainer )<font></font>
    i.Movable = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">else</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">endregion</span></span><font></font>
<font></font>
  i.Movable = !locked;<font></font>
  i.IsLockedDown = locked;<font></font>
<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine seltene Warnung. </font><font style="vertical-align: inherit;">Der Analysator hat die Codeformatierung nach der Anweisung </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#endregion</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> als </font><i><font style="vertical-align: inherit;">verdächtig eingestuft. </font></i><font style="vertical-align: inherit;">Wenn Sie den Code nicht lesen, sieht er wie eine Zeile aus</font></font><br>
<br>
<pre><code class="cs hljs">i.Movable = !locked;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
wird in jedem Fall ausgeführt, unabhängig von der Variablen </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vielleicht wurden hier geschweifte Klammern vergessen ... Im Allgemeinen sollten Entwickler diesen Code überprüfen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warnung:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3043 Die Betriebslogik des Codes entspricht nicht seiner Formatierung. </font><font style="vertical-align: inherit;">Die Anweisung wird rechts eingerückt, aber immer ausgeführt. </font><font style="vertical-align: inherit;">Möglicherweise fehlen geschweifte Klammern. </font><font style="vertical-align: inherit;">Erdbeben.cs 57</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnCast</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( Core.AOS )<font></font>
  {<font></font>
    damage = m.Hits / <span class="hljs-number">2</span>;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> ( !m.Player )<font></font>
      damage = Math.Max( Math.Min( damage, <span class="hljs-number">100</span> ), <span class="hljs-number">15</span> );<font></font>
      damage += Utility.RandomMinMax( <span class="hljs-number">0</span>, <span class="hljs-number">15</span> );            <span class="hljs-comment">// &lt;=</span><font></font>
<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span><font></font>
  {<font></font>
    ....<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Code fehlen möglicherweise geschweifte Klammern. </font><font style="vertical-align: inherit;">Diese Schlussfolgerung kann aufgrund der seltsamen Formatierung des Codes im Hauptteil von </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if (! M.Player) gezogen werden</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warnung:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3083 Unsicherer Aufruf des Ereignisses 'ServerStarted', NullReferenceException ist möglich. </font><font style="vertical-align: inherit;">Überlegen Sie, ob Sie einer lokalen Variablen ein Ereignis zuweisen möchten, bevor Sie es aufrufen. </font><font style="vertical-align: inherit;">EventSink.cs 921</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">InvokeServerStarted</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( ServerStarted != <span class="hljs-literal">null</span> )<font></font>
    ServerStarted();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Methode verwendet einen möglicherweise unsicheren Aufruf des </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RefreshStarted-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ereignishandlers </font><font style="vertical-align: inherit;">, wie der Analysator angibt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Warum ist es gefährlich? Stellen Sie sich diese Situation vor. Das </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerStarted-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ereignis </font><font style="vertical-align: inherit;">hat nur einen Abonnenten. Im Moment zwischen der Überprüfung auf null und dem direkten Aufrufen des </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerStarted ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -Ereignishandlers </font><font style="vertical-align: inherit;">in einem anderen Thread wurde eine Abmeldung von diesem Ereignis vorgenommen. Dies </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">löst</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eine </font><i><font style="vertical-align: inherit;">NullReferenceException aus</font></i><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der einfachste Weg, um diese Situation zu verhindern, besteht darin, einen sicheren Ereignisaufruf mit dem Operator '?' Bereitzustellen:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">InvokeServerStarted</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  ServerStarted?.Invoke();<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warnung:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3054 Möglicherweise unsichere, doppelt überprüfte Verriegelung. Verwenden Sie flüchtige Variablen oder Synchronisationsprimitive, um dies zu vermeiden. Item.cs 1624</font></font><br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> Packet m_RemovePacket;<font></font>
....<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">object</span> _rpl = <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>();
<span class="hljs-keyword">public</span> Packet RemovePacket<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (m_RemovePacket == <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
      <span class="hljs-keyword">lock</span> (_rpl)<font></font>
      {<font></font>
        <span class="hljs-keyword">if</span> (m_RemovePacket == <span class="hljs-literal">null</span>)<font></font>
        {<font></font>
          m_RemovePacket = <span class="hljs-keyword">new</span> RemoveItem(<span class="hljs-keyword">this</span>);<font></font>
          m_RemovePacket.SetStatic();<font></font>
        }<font></font>
      }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> m_RemovePacket;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Analysatorwarnung ist mit der unsicheren Verwendung des doppelt überprüften Sperrmusters verbunden. Wie Sie dem obigen Code entnehmen können, wurde eine doppelte Überprüfungssperre angewendet, um das generative Muster Loners zu implementieren. Wenn wir versuchen, eine Instanz der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Packet-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Klasse durch </font><font style="vertical-align: inherit;">Zugriff auf die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RemovePacket-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Eigenschaft </font><i><font style="vertical-align: inherit;">abzurufen</font></i><font style="vertical-align: inherit;"> , überprüft der Getter das Feld </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auf Gleichheit auf Null. Wenn die Prüfung bestanden ist, gelangen wir in den Hauptteil der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lock-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Anweisung </font><font style="vertical-align: inherit;">, in der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">das</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Feld </font><i><font style="vertical-align: inherit;">m_RemovePacket initialisiert wird</font></i><font style="vertical-align: inherit;"> . Eine interessante Situation tritt in dem Moment auf, in dem der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hauptthread die</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Variable </font><i><font style="vertical-align: inherit;">m_RemovePacket bereits</font></i><font style="vertical-align: inherit;"> über den Konstruktor </font><font style="vertical-align: inherit;">initialisiert, die </font><i><font style="vertical-align: inherit;">Methode</font></i><font style="vertical-align: inherit;"> jedoch noch nicht aufgerufen hat</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SetStatic ().</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Theoretisch kann ein anderer Thread </font><font style="vertical-align: inherit;">im sehr ungünstigen Moment </font><font style="vertical-align: inherit;">auf die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RemovePacket-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Eigenschaft zugreifen </font><font style="vertical-align: inherit;">. Das Überprüfen von </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auf Gleichheit mit Null </font><i><font style="vertical-align: inherit;">schlägt</font></i><font style="vertical-align: inherit;"> nicht mehr fehl und der aufrufende Thread erhält einen Link zu einem unvollständig gebrauchsfertigen Objekt. Um dieses Problem zu lösen, können </font><font style="vertical-align: inherit;">Sie eine Zwischenvariable der </font><i><font style="vertical-align: inherit;">Packet-</font></i><font style="vertical-align: inherit;"> Klasse </font><font style="vertical-align: inherit;">im Hauptteil der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lock-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Anweisung </font><font style="vertical-align: inherit;">erstellen </font><font style="vertical-align: inherit;">, sie über einen Konstruktoraufruf und die </font><i><font style="vertical-align: inherit;">SetStatic ()</font></i><font style="vertical-align: inherit;"> -Methode initialisieren </font><font style="vertical-align: inherit;">und sie dann der Variablen </font><i><font style="vertical-align: inherit;">m_RemovePacket</font></i><font style="vertical-align: inherit;"> zuweisen </font><font style="vertical-align: inherit;">. In diesem Fall könnte der Hauptteil der </font><i><font style="vertical-align: inherit;">lock-</font></i><font style="vertical-align: inherit;"> Anweisung folgendermaßen </font><font style="vertical-align: inherit;">aussehen:</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">lock</span> (_rpl)<font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (m_RemovePacket == <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    Packet instance = <span class="hljs-keyword">new</span> RemoveItem(<span class="hljs-keyword">this</span>);<font></font>
    instance.SetStatic();<font></font>
    m_RemovePacket = instance;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Problem scheint behoben zu sein und der Code funktioniert wie erwartet. Aber das ist nicht so. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt noch einen weiteren Punkt: Der Analysator schlägt nicht nur die Verwendung des Schlüsselworts </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">volatile vor</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . In der Release - </font><font style="vertical-align: inherit;">Version des Programms, die Compiler - </font><font style="vertical-align: inherit;">Optimierung und Neuordnungs die Linien des Aufrufs zur durchführen kann </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">setstatic ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Methode </font><font style="vertical-align: inherit;">und weisen Sie </font><font style="vertical-align: inherit;">das </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instanz</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Variable </font><font style="vertical-align: inherit;">auf das </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Feld </font><font style="vertical-align: inherit;">(aus der Sicht des Compilers, nicht die Semantik des Programms verletzt werden). Und wir kehren wieder zu dem Punkt zurück, an dem wir begonnen haben - der Möglichkeit, die nicht initialisierte Variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_RemovePacket zu erhalten</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Es ist unmöglich genau zu sagen, wann diese Neuordnung stattfinden kann und ob sie überhaupt stattfinden wird: die CLR-Version, die Architektur des verwendeten Prozessors usw. Es lohnt sich immer noch, sich vor einem solchen Szenario zu schützen, und eine der Lösungen (die jedoch nicht die produktivste ist) besteht darin, das </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">flüchtige</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Schlüsselwort zu verwenden </font><font style="vertical-align: inherit;">. Eine Variable, die mit dem </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">flüchtigen Modifikator</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> deklariert </font><font style="vertical-align: inherit;">wird, unterliegt während der Optimierung durch den Compiler keinen Permutationen. Ein endgültig festgelegter Code könnte folgendermaßen aussehen:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> Packet m_RemovePacket;<font></font>
....<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">object</span> _rpl = <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>();
<span class="hljs-keyword">public</span> Packet RemovePacket<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (m_RemovePacket == <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
      <span class="hljs-keyword">lock</span> (_rpl)<font></font>
      {<font></font>
        <span class="hljs-keyword">if</span> (m_RemovePacket == <span class="hljs-literal">null</span>)<font></font>
        {<font></font>
          Packet instance = <span class="hljs-keyword">new</span> RemoveItem(<span class="hljs-keyword">this</span>);<font></font>
          instance.SetStatic();<font></font>
          m_RemovePacket = instance;<font></font>
        }<font></font>
      }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> m_RemovePacket;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Manchmal kann die Verwendung eines </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">flüchtigen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Feldes aufgrund des Overheads beim Zugriff auf ein solches Feld unerwünscht sein. Wir werden nicht im Detail auf dieses Thema eingehen und lediglich darauf hinweisen, dass im betrachteten Beispiel ein Atomfelddatensatz nur einmal benötigt wird (wenn auf die Eigenschaft zum ersten Mal zugegriffen wird). Wenn Sie das Feld jedoch als </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">flüchtig</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> deklarieren, </font><font style="vertical-align: inherit;">führt der Compiler das atomare Lesen und Schreiben durch das ist möglicherweise nicht optimal in Bezug auf die Leistung. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher besteht ein anderer Ansatz zur Korrektur dieser Analysatorwarnung, um zusätzlichen Overhead beim Deklarieren eines </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">flüchtigen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Felds </font><font style="vertical-align: inherit;">zu vermeiden </font><font style="vertical-align: inherit;">, darin, den </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Typ Lazy &lt;T&gt;</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zum Sichern des </font><i><font style="vertical-align: inherit;">Felds m_RemovePacket zu</font></i><font style="vertical-align: inherit;"> verwenden</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">statt Doppelverriegelung zu überprüfen. </font><font style="vertical-align: inherit;">In diesem Fall kann der Getter-Body durch die Initialisierungsmethode ersetzt werden, die an den Konstruktor der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy &lt;T&gt;</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -Instanz übergeben wird </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> Lazy&lt;Packet&gt; m_RemovePacket = <span class="hljs-keyword">new</span> Lazy&lt;Packet&gt;(() =&gt;<font></font>
  {<font></font>
    Packet instance = <span class="hljs-keyword">new</span> RemoveItem(<span class="hljs-keyword">this</span>);<font></font>
    instance.SetStatic();<font></font>
    <span class="hljs-keyword">return</span> instance;<font></font>
  }, LazyThreadSafetyMode.ExecutionAndPublication);<font></font>
<font></font>
....<font></font>
<span class="hljs-keyword">public</span> Packet RemovePacket<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">return</span> m_RemovePacket.Value;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Initialisierungsmethode wird einmal aufgerufen, wenn zum ersten Mal auf den </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Typ zugegriffen wird, </font><font style="vertical-align: inherit;">und die Thread-Sicherheit beim gleichzeitigen Zugriff auf die Eigenschaft von mehreren Threads aus wird durch den </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy &lt;T&gt; -Typ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> garantiert </font><font style="vertical-align: inherit;">(der Thread-Sicherheitsmodus wird durch den zweiten Parameter des </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Konstruktors gesteuert </font><font style="vertical-align: inherit;">). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warnung:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3131 Der Ausdruck "Ziel" wird auf Kompatibilität mit dem Typ "IAxe" überprüft, jedoch in den Typ "Element" umgewandelt. </font><font style="vertical-align: inherit;">HarvestTarget.cs 61</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnTarget</span>(<span class="hljs-params"> Mobile <span class="hljs-keyword">from</span>, <span class="hljs-keyword">object</span> targeted </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( m_System <span class="hljs-keyword">is</span> Lumberjacking &amp;&amp;<font></font>
            targeted <span class="hljs-keyword">is</span> IAxe &amp;&amp; m_Tool <span class="hljs-keyword">is</span> BaseAxe )<font></font>
  {<font></font>
    IAxe obj = (IAxe)targeted;<font></font>
    Item item = (Item)targeted;<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gezielte</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Variable </font><font style="vertical-align: inherit;">wurde geprüft , </font><font style="vertical-align: inherit;">die Typ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iAXE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , aber </font><font style="vertical-align: inherit;">niemand überprüft </font><font style="vertical-align: inherit;">zu gehören , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Artikel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , wie die Analyseberichte. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warnung:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3070 Nicht initialisierte Variable 'Zero' wird beim Initialisieren der Variablen 'm_LastMobile' verwendet. Serial.cs 29</font></font><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> Serial : IComparable, IComparable&lt;Serial&gt;<font></font>
{<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> m_Serial;<font></font>
<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Serial m_LastMobile = Zero;                <span class="hljs-comment">// &lt;=</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Serial m_LastItem = <span class="hljs-number">0x40000000</span>;<font></font>
<font></font>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Serial LastMobile { .... }
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Serial LastItem { .... }<font></font>
<font></font>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> Serial MinusOne = <span class="hljs-keyword">new</span> Serial( <span class="hljs-number">-1</span> );
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> Serial Zero = <span class="hljs-keyword">new</span> Serial( <span class="hljs-number">0</span> );     <span class="hljs-comment">// &lt;=</span><font></font>
  ....<font></font>
  <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">Serial</span>(<span class="hljs-params"> <span class="hljs-keyword">int</span> serial </span>)</span><font></font>
  {<font></font>
    m_Serial = serial;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Insofern gibt es hier keinen Fehler, das Schreiben ist jedoch nicht sehr gut. Aufgrund der Zuweisung von </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_LastMobile zum</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wert einer nicht initialisierten </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wird mit dem Standardkonstruktor </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Serial ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eine Struktur erstellt </font><font style="vertical-align: inherit;">, die zur Initialisierung von </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_Serial = 0 führt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dies entspricht wiederum dem Aufruf einer </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">neuen Seriennummer (0)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Tatsächlich haben die Entwickler das Glück, dass </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">serial</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gleich </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 sein</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sollte. Wenn es einen anderen Wert gegeben hätte, würde dies zu einem Fehler führen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warnung:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3063 Ein Teil des bedingten Ausdrucks ist immer wahr, wenn er ausgewertet wird: m_Serial &lt;= 0x7FFFFFFF. Serial.cs 83</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> IsItem<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">return</span> ( m_Serial &gt;= <span class="hljs-number">0x40000000</span> &amp;&amp; m_Serial &lt;= <span class="hljs-number">0x7FFFFFFF</span> );<font></font>
  }<font></font>
}</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x7FFFFFFF</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist der maximal mögliche Wert, den </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Int32</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> enthalten kann </font><font style="vertical-align: inherit;">. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unabhängig davon</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , welchen Wert die Variable </font><i><font style="vertical-align: inherit;">m_Serial hat</font></i><font style="vertical-align: inherit;"> , ist sie in jedem Fall kleiner oder gleich </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x7FFFFFFF</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warnung:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3004 Die Anweisung 'then' entspricht der Anweisung 'else'. </font><font style="vertical-align: inherit;">Serialization.cs 1571</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteDeltaTime</span>(<span class="hljs-params"> DateTime <span class="hljs-keyword">value</span> </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">try</span> <font></font>
  { <font></font>
    d = <span class="hljs-keyword">new</span> TimeSpan( ticks-now ); <font></font>
  }<font></font>
  <span class="hljs-keyword">catch</span> <font></font>
  {<font></font>
    <span class="hljs-keyword">if</span>( ticks &lt; now ) <font></font>
      d = TimeSpan.MaxValue; <font></font>
    <span class="hljs-keyword">else</span> <font></font>
      d = TimeSpan.MaxValue;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Analysator warnt vor einem verdächtigen Code, bei dem die wahren und falschen Zweige der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if-Anweisung</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vollständig übereinstimmen. </font><font style="vertical-align: inherit;">Vielleicht sollte einer der Zweige </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TimeSpan.MinValue haben. </font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der gleiche Code wurde an mehreren Stellen gefunden: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V3004 Die Anweisung 'then' entspricht der Anweisung 'else'. </font><font style="vertical-align: inherit;">Item.cs 2103</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Serialize</span>(<span class="hljs-params"> GenericWriter writer </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <font></font>
  <span class="hljs-keyword">if</span>( ticks &lt; now ) <font></font>
    d = TimeSpan.MaxValue; <font></font>
  <span class="hljs-keyword">else</span> <font></font>
    d = TimeSpan.MaxValue;<font></font>
  <font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V3004 Die Anweisung 'then' entspricht der Anweisung 'else'. </font><font style="vertical-align: inherit;">Serialization.cs 383</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteDeltaTime</span>(<span class="hljs-params"> DateTime <span class="hljs-keyword">value</span> </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <font></font>
  <span class="hljs-keyword">if</span>( ticks &lt; now ) <font></font>
    d = TimeSpan.MaxValue; <font></font>
  <span class="hljs-keyword">else</span> <font></font>
    d = TimeSpan.MaxValue;<font></font>
  <font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe "Dies" aus einem Grund verwendet. Es ist sehr wahrscheinlich, dass es unter anderem nicht ohne Kopieren und Einfügen auskommt. Diese Codefragmente sehen sehr schmerzhaft aus. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warnung PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3051 Eine übermäßige Besetzung. </font><font style="vertical-align: inherit;">Das Objekt ist bereits vom Typ 'Item'. </font><font style="vertical-align: inherit;">Mobile.cs 11237</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> Item Talisman<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">return</span> FindItemOnLayer( Layer.Talisman ) <span class="hljs-keyword">as</span> Item;<font></font>
  }<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> Item <span class="hljs-title">FindItemOnLayer</span>(<span class="hljs-params"> Layer layer </span>)</span><font></font>
{<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Analysatorwarnung kann erhalten werden, wenn der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bediener übermäßig verwendet wird </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In diesem Abschnitt des Codes gibt es keinen Fehler, aber es macht auch keinen Sinn, das Objekt in einen eigenen Typ umzuwandeln. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Warnung </font><b><font style="vertical-align: inherit;">:</font></b><font style="vertical-align: inherit;"> V3148 Das Umwandeln des potenziellen 'Null'-Werts von' toSet 'in einen Werttyp kann zu NullReferenceException führen. </font><font style="vertical-align: inherit;">Eigenschaften.cs 502</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">string</span> <span class="hljs-title">ConstructFromString</span>(<span class="hljs-params"> .... </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">object</span> toSet;
  <span class="hljs-keyword">bool</span> isSerial = IsSerial( type );<font></font>
<font></font>
  <span class="hljs-keyword">if</span> ( isSerial ) <span class="hljs-comment">// mutate into int32</span>
    type = m_NumericTypes[<span class="hljs-number">4</span>];<font></font>
<font></font>
  ....<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">value</span> == <span class="hljs-literal">null</span> )<font></font>
  {<font></font>
    toSet = <span class="hljs-literal">null</span>;<font></font>
  }<font></font>
  ....<font></font>
<font></font>
  <span class="hljs-keyword">if</span> ( isSerial ) <span class="hljs-comment">// mutate back</span><font></font>
    toSet = (Serial)((Int32)toSet);<font></font>
<font></font>
  constructed = toSet;<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Abschnitt des Codes, sind wir in dem Fall interessiert , </font><font style="vertical-align: inherit;">wenn der variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wert</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dann </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auch </font><font style="vertical-align: inherit;">die Variable </font><i><font style="vertical-align: inherit;">toSet </font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Wenn die Variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Serial == true ist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , wird </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toSet</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Int32 umgewandelt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , was zu </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NRE führt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie können diesen Code beheben, indem Sie beispielsweise standardmäßig 0 hinzufügen:</font></font><br>
<br>
<pre><code class="cs hljs">toSet = (Serial)((Int32)(toSet ?? <span class="hljs-number">0</span>));</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warnung:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3031 Eine übermäßige Überprüfung kann vereinfacht werden. </font><font style="vertical-align: inherit;">Das '||' </font><font style="vertical-align: inherit;">Der Operator ist von entgegengesetzten Ausdrücken 'pack == null' und 'pack! = null' umgeben. </font><font style="vertical-align: inherit;">BODBuyGump.cs 64</font></font><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnResponse</span>(<span class="hljs-params">Server.Network.NetState sender, RelayInfo info</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> ( (pack == <span class="hljs-literal">null</span>) ||<font></font>
       ((pack != <span class="hljs-literal">null</span>) &amp;&amp;<font></font>
        (!pack.CheckHold(<font></font>
                m_From,<font></font>
                item,<font></font>
                <span class="hljs-literal">true</span>,
                <span class="hljs-literal">true</span>,
                <span class="hljs-number">0</span>,<font></font>
                item.PileWeight + item.TotalWeight)) ) )<font></font>
  {<font></font>
    pv.SayTo(m_From, <span class="hljs-number">503204</span>);<font></font>
    m_From.SendGump(<span class="hljs-keyword">new</span> BOBGump(m_From, m_Book, m_Page, <span class="hljs-literal">null</span>));<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Code kann vereinfacht werden, wie der Analysator berichtet: </font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> ((pack == <span class="hljs-literal">null</span>) || ((pack != <span class="hljs-literal">null</span>) &amp;&amp; (!pack.CheckHold(....))))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Links und rechts vom Operator '||' </font><font style="vertical-align: inherit;">Es gibt Ausdrücke, deren Bedeutung entgegengesetzt ist. </font><font style="vertical-align: inherit;">Hier ist das </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prüfpaket! = Null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> redundant, da zuvor das entgegengesetzte Bedingungspaket </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">== Null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> geprüft </font><font style="vertical-align: inherit;">wird und diese Ausdrücke durch den Operator '||' getrennt werden. </font><font style="vertical-align: inherit;">Diese Zeile kann wie folgt gekürzt werden:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> (pack == <span class="hljs-literal">null</span> || !pack.CheckHold(....))</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warnung:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3080 Mögliche Null-Dereferenzierung. </font><font style="vertical-align: inherit;">Betrachten Sie die Überprüfung der "Gewinner". </font><font style="vertical-align: inherit;">CTF.cs 1302</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Finish_Callback</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  ....<font></font>
  CTFTeamInfo winner = ( teams.Count &gt; <span class="hljs-number">0</span> ? teams[<span class="hljs-number">0</span>] : <span class="hljs-literal">null</span> );<font></font>
<font></font>
  .... <font></font>
<font></font>
  m_Context.Finish( m_Context.Participants[winner.TeamID] <span class="hljs-keyword">as</span> Participant );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nehmen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
wir an, </font><i><font style="vertical-align: inherit;">Teams</font></i><font style="vertical-align: inherit;"> . Die </font><i><font style="vertical-align: inherit;">Anzahl</font></i><font style="vertical-align: inherit;"> ist </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dann ist </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gewinner = null.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Und weiter im Code wird auf die Eigenschaft </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">won.TeamID zugegriffen,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ohne nach </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null zu </font></font></i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">suchen</font></i><font style="vertical-align: inherit;"> , was zum Zugriff durch eine Nullreferenz führt. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warnung:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3041 Der Ausdruck wurde implizit vom Typ 'int' in den Typ 'double' umgewandelt. Erwägen Sie die Verwendung eines expliziten Typgusses, um den Verlust eines Bruchteils zu vermeiden. Ein Beispiel: double A = (double) (X) / Y; StormsEye.cs 87</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Gain</span>(<span class="hljs-params"> Mobile <span class="hljs-keyword">from</span>, Skill skill </span>)</span> <font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">from</span>.Player &amp;&amp; <font></font>
     ( skills.Total / skills.Cap ) &gt;= Utility.RandomDouble())<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieses Codefragment enthält die Operation zum Teilen der Variablen </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Skills.Total</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Skills.Cap</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vom Typ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Das Ergebnis wird dann implizit in den Typ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">double</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> konvertiert </font><font style="vertical-align: inherit;">, wie der Analysator berichtet. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warnung:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3085 Der Name des Felds 'typeofObject' in einem verschachtelten Typ ist nicht eindeutig. Der äußere Typ enthält ein statisches Feld mit identischem Namen. PropsGump.cs 744</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Type typeofObject = <span class="hljs-keyword">typeof</span>( <span class="hljs-keyword">object</span> );<font></font>
....<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title">GroupComparer</span> : <span class="hljs-title">IComparer</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Type typeofObject = <span class="hljs-keyword">typeof</span>( Object );<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typeofObject</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wurde in diesem Codeabschnitt in einer verschachtelten Klasse erstellt </font><font style="vertical-align: inherit;">. Das Problem ist, dass es in der äußeren Klasse eine Variable mit demselben Namen gibt und aufgrund dessen Fehler auftreten können. Es ist besser, dies nicht zuzulassen, um die Wahrscheinlichkeit solcher Fehler aufgrund von Unaufmerksamkeit zu verringern. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warnung:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3140 Property Accessors verwenden unterschiedliche Sicherungsfelder. WallBanner.cs 77</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> m_IsRewardItem;<font></font>
<font></font>
[<span class="hljs-meta">CommandProperty( AccessLevel.GameMaster )</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> IsRewardItem<font></font>
{<font></font>
  <span class="hljs-keyword">get</span>{ <span class="hljs-keyword">return</span> m_IsRewardItem; }
  <span class="hljs-keyword">set</span>{ m_IsRewardItem = <span class="hljs-keyword">value</span>; InvalidateProperties(); }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> m_East;<font></font>
<font></font>
[<span class="hljs-meta">CommandProperty( AccessLevel.GameMaster )</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> East<font></font>
{<font></font>
  <span class="hljs-keyword">get</span>{ <span class="hljs-keyword">return</span> m_East; }
  <span class="hljs-keyword">set</span>{ m_IsRewardItem = <span class="hljs-keyword">value</span>; InvalidateProperties(); }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und hier ist ein Fehler aufgetreten, der durch Kopieren und Einfügen aufgetreten ist. Die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">festgelegte</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Zugriffsmethode der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">East-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Eigenschaft </font><font style="vertical-align: inherit;">bestand darin, einen Wert für </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_East</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und nicht </font><font style="vertical-align: inherit;">für </font><i><font style="vertical-align: inherit;">m_IsRewardItem </font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zuzuweisen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio-</font></font></b> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Warnungen </font><b><font style="vertical-align: inherit;">:</font></b><font style="vertical-align: inherit;"> V3012 Der Operator '?:' Gibt unabhängig von seinem bedingten Ausdruck immer ein und denselben Wert zurück: 0xe7f. TreasureChestLevel2.cs 52 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V3012 Der Operator '?:' Gibt unabhängig von seinem bedingten Ausdruck immer ein und denselben Wert zurück: 0xe77. TreasureChestLevel2.cs 57</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SetChestAppearance</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">bool</span> UseFirstItemId = Utility.RandomBool();<font></font>
<font></font>
  <span class="hljs-keyword">switch</span>( Utility.RandomList( <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span> ) )<font></font>
  {<font></font>
    ....<font></font>
    <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:<span class="hljs-comment">// Keg</span>
      <span class="hljs-keyword">this</span>.ItemID = ( UseFirstItemId ? <span class="hljs-number">0xe7f</span> : <span class="hljs-number">0xe7f</span> );
      <span class="hljs-keyword">this</span>.GumpID = <span class="hljs-number">0x3e</span>;
      <span class="hljs-keyword">break</span>;<font></font>
<font></font>
    <span class="hljs-keyword">case</span> <span class="hljs-number">7</span>:<span class="hljs-comment">// Barrel</span>
      <span class="hljs-keyword">this</span>.ItemID = ( UseFirstItemId ? <span class="hljs-number">0xe77</span> : <span class="hljs-number">0xe77</span> );
      <span class="hljs-keyword">this</span>.GumpID = <span class="hljs-number">0x3e</span>;
      <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Irgendeine Art von Illusion der Wahl :) Unabhängig vom Wert von </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UseFirstItemId</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this.ItemID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wird entweder </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xe7f</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> im ersten Fall, oder </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xe77</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in den zweiten. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warnung PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3066 Möglicherweise falsche Reihenfolge der an die OnSwing-Methode übergebenen Argumente: 'Verteidiger' und 'Angreifer'. </font><font style="vertical-align: inherit;">BaseWeapon.cs 1188</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">int</span> <span class="hljs-title">AbsorbDamageAOS</span>(<span class="hljs-params"> Mobile attacker,
                                    Mobile defender,
                                    <span class="hljs-keyword">int</span> damage </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> ( weapon != <span class="hljs-literal">null</span> )<font></font>
  {<font></font>
    defender.FixedParticles(<span class="hljs-number">0x3779</span>,
                            <span class="hljs-number">1</span>,
                            <span class="hljs-number">15</span>,
                            <span class="hljs-number">0x158B</span>,
                            <span class="hljs-number">0x0</span>,
                            <span class="hljs-number">0x3</span>,<font></font>
                            EffectLayer.Waist);<font></font>
    weapon.OnSwing( defender, attacker );<font></font>
  }<font></font>
  ....<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> TimeSpan <span class="hljs-title">OnSwing</span>(<span class="hljs-params"> Mobile attacker, Mobile defender </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">return</span> OnSwing( attacker, defender, <span class="hljs-number">1.0</span> );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dem Analysator erschien es verdächtig, dass der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OnSwing ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -Methode </font><font style="vertical-align: inherit;">Argumente in umgekehrter Reihenfolge übergeben wurden. </font><font style="vertical-align: inherit;">Möglicherweise liegt dies an einem Fehler. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warnung:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3092 Bereichsüberschneidungen sind innerhalb von bedingten Ausdrücken möglich. </font><font style="vertical-align: inherit;">Beispiel: if (A&gt; 0 &amp;&amp; A &lt;5) {...} else if (A&gt; 3 &amp;&amp; A &lt;9) {...}. </font><font style="vertical-align: inherit;">HouseFoundation.cs 1883</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">IsFixture</span>(<span class="hljs-params"> <span class="hljs-keyword">int</span> itemID </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( itemID &gt;= <span class="hljs-number">0x319C</span> &amp;&amp; itemID &lt; <span class="hljs-number">0x31B0</span> ) 
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  <span class="hljs-comment">// ML doors</span>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( itemID == <span class="hljs-number">0x2D46</span> ||<font></font>
           itemID == <span class="hljs-number">0x2D48</span> ||<font></font>
           itemID == <span class="hljs-number">0x2FE2</span> ||<font></font>
           itemID == <span class="hljs-number">0x2FE4</span> )
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( itemID &gt;= <span class="hljs-number">0x2D63</span> &amp;&amp; itemID &lt; <span class="hljs-number">0x2D70</span> )
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( itemID &gt;= <span class="hljs-number">0x319C</span> &amp;&amp; itemID &lt; <span class="hljs-number">0x31AF</span> ) 
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unter Bedingungen getestete Bereiche kreuzen sich. </font><font style="vertical-align: inherit;">Dies schien dem Analysator verdächtig. </font><font style="vertical-align: inherit;">Auch wenn dieser Code korrekt funktioniert, lohnt es sich, ihn zu reparieren. </font><font style="vertical-align: inherit;">Stellen Sie sich </font><font style="vertical-align: inherit;">eine Situation , </font><font style="vertical-align: inherit;">in der </font><font style="vertical-align: inherit;">wir den Körper der letzten neu zu schreiben benötigt , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wenn</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> so , </font><font style="vertical-align: inherit;">dass, wenn die Bedingung erfüllt ist, kehrt das Verfahren </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">falsch</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Wenn </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itemID ist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gleich, sagen wir, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x319C</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wird das Verfahren immer noch zurückkehren </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wahr</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dies führt wiederum zu einem Zeitverlust bei der Suche nach Fehlern.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RunUO wurde vor langer Zeit erstellt, es wurde viel Arbeit geleistet. Am Beispiel dieses Projekts können Sie jedoch die Vorteile der statischen Analyse für Projekte mit einem Verlauf erkennen. </font><font style="vertical-align: inherit;">Der Analysator für 543.000 Zeilen Projektcode gab ungefähr 500 Warnungen aus (ohne </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">den</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> niedrigen </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><u><font style="vertical-align: inherit;">Pegel</font></u></a><font style="vertical-align: inherit;"> ), von denen die meisten aufgrund ihrer Einheitlichkeit nicht im Artikel enthalten waren. </font><font style="vertical-align: inherit;">Um das Ergebnis der Analyse genauer kennenzulernen, empfehle ich die Verwendung einer </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kostenlosen Lizenz für Open Source-Projekte</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/c78/30f/70c/c7830f70c5577c3d6704f254d7cad6a3.png" align="left"></a></p><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie diesen Artikel einem englischsprachigen Publikum zugänglich machen möchten, verwenden Sie bitte den Link zur Übersetzung: Ekaterina Nikiforova. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RunUO Check mit dem PVS-Studio Analyzer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de487106/">https://habr.com/ru/post/de487106/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de487092/index.html">Modellierung von Geschäftsprozessen als Teil eines Projekts zur Implementierung eines ERP-Systems</a></li>
<li><a href="../de487094/index.html">Wiederaufbereitungsereignisse von Kafka erhalten</a></li>
<li><a href="../de487096/index.html">Schnipsel. So vereinfachen Sie die Arbeit mit der Dokumentation</a></li>
<li><a href="../de487098/index.html">Zeichnen mit Ameisen: prozedurale Bilder unter Verwendung von Algorithmen zur Optimierung von Ameisenkolonien</a></li>
<li><a href="../de487100/index.html">Unveränderliche Datenstrukturen auf dem neuesten Stand der Technik</a></li>
<li><a href="../de487108/index.html">Mobiles Spielerprofil: MyTracker Research</a></li>
<li><a href="../de487110/index.html">Slurm SRE. Ein komplettes Experiment mit Experten von Booking.com und Google.com</a></li>
<li><a href="../de487112/index.html">Rand des Wahnsinns: Der Grundkreis</a></li>
<li><a href="../de487116/index.html">Warum Discord von Go nach Rust migriert</a></li>
<li><a href="../de487118/index.html">Loki - Sammeln von Protokollen nach dem Prometheus-Ansatz</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>