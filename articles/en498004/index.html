<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöª üèÄ ‚õ±Ô∏è Workstation in a docker container üëèüèø üëú üíü</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For what? All kinds of ideas constantly come to me and some of them I immediately want to try, but the workstation is not always at hand, so I set up ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Workstation in a docker container</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/498004/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For what? All kinds of ideas constantly come to me and some of them I immediately want to try, but the workstation is not always at hand, so I set up the IDE for everything that comes to hand. As a result, the devices began to be cluttered, and it became difficult to maintain and update them. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To solve this problem, I decided to place such a ‚Äúnotebook‚Äù in the cloud, and that would be updated daily and delete all the accumulated garbage. And to work, connect to it remotely. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kv/5h/ry/kv5hryhobajnk6wddlszosiiira.jpeg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result, without suspecting it, he made a very convenient tool for solving a large number of tasks: a notebook, a test site, to see what the phone does not show, a secure sandbox, and running scripts for programs that work only on the GUI and many others. etc. And in the article I want to share the method of creating such containers.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To create such a container, you must write your Dockerfile. </font><font style="vertical-align: inherit;">And in the article I will describe the whole process of its creation. </font><font style="vertical-align: inherit;">Who does not want to create himself, but wants to take and try, then at the bottom of the article there will be links to ready-made images.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">operating system</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Any Linux will do. </font><font style="vertical-align: inherit;">Personally, I prefer the beautiful OpenSuse, but comparing its memory consumption with CentOS I decided to choose the latter. </font><font style="vertical-align: inherit;">Indeed, the less memory a container consumes, the more you can save on its hosting. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's start creating a dockerfile:</font></font><br>
<br>
<pre><code class="bash hljs">FROM centos:7
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remote access</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order to connect to the container on it, you must configure the VNC remote access server. </font><font style="vertical-align: inherit;">Two factors must be understood for this:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The system does not have a monitor. </font><font style="vertical-align: inherit;">Therefore, it will have to be emulated. </font><font style="vertical-align: inherit;">There is a special x0vncserver server for this.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VNC Server should not be resourceful. </font><font style="vertical-align: inherit;">After all, you have to pay for them. </font><font style="vertical-align: inherit;">And the lags in the signal transmission should be minimal, otherwise they cause discomfort.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To solve both problems, I chose TigerVNC Server for the server and TightVNC for the client. </font><font style="vertical-align: inherit;">TigerVNC Server is included in the delivery of any Linux, lightweight, fast, and also supports work without a monitor through x0vncserver. </font><font style="vertical-align: inherit;">The TightVNC client provides such fast transfer of pictures that it feels like it is not a remote connection, but a program running on a computer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Extend Dockerfile:</font></font><br>
<br>
<pre><code class="bash hljs">FROM centos:7<font></font>
<font></font>
RUN yum install -y epel-release dnf \<font></font>
        &amp;&amp; \<font></font>
        dnf install -y \<font></font>
            tigervnc-server \<font></font>
        &amp;&amp; \<font></font>
        yum clean all &amp;&amp; dnf clean all \<font></font>
        &amp;&amp; \<font></font>
        rm -rf /var/cache/yum/* &amp;&amp; rm -rf /var/cache/dnf/*<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After installing the programs, we clear the cache to lighten the weight of the image.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desktop</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I really love KDE with the Breeze theme, but KDE is a very gluttonous desktop. </font><font style="vertical-align: inherit;">Gnome and its derivatives were even more gluttonous. </font><font style="vertical-align: inherit;">Xfce, Ice is not too beautiful. </font><font style="vertical-align: inherit;">Fortunately, there is a solution - the LXQT desktop with the Kde-Plasma theme. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Install the desktop:</font></font><br>
<br>
<pre><code class="bash hljs">FROM centos:7<font></font>
<font></font>
RUN yum install -y epel-release dnf \<font></font>
        &amp;&amp; \<font></font>
        dnf install -y \<font></font>
            tigervnc-server \<font></font>
            openbox obconf-qt \<font></font>
            lxqt-about lxqt-common lxqt-config lxqt-globalkeys lxqt-notificationd \<font></font>
            lxqt-openssh-askpass lxqt-panel lxqt-policykit lxqt-qtplugin lxqt-runner \<font></font>
            lxqt-session pcmanfm-qt \<font></font>
            dejavu-sans-mono-fonts \<font></font>
            xterm nano htop expect sudo \<font></font>
        &amp;&amp; \<font></font>
        yum clean all &amp;&amp; dnf clean all \<font></font>
        &amp;&amp; \<font></font>
        rm -rf /var/cache/yum/* &amp;&amp; rm -rf /var/cache/dnf/*<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A little more and you can run.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">User Creation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the container it is necessary to work from some user. </font><font style="vertical-align: inherit;">To do this, create it and set a password, as well as set a password for the root user:</font></font><br>
<br>
<pre><code class="bash hljs">... Dockerfile<font></font>
<font></font>
ENV HOME=/home/headless<font></font>
<font></font>
RUN /bin/dbus-uuidgen --ensure &amp;&amp; \<font></font>
        useradd headless &amp;&amp; \<font></font>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"centos"</span> | passwd --stdin root &amp;&amp; \
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"centos"</span> | passwd --stdin headless
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here headless is the user whom we create and from whom we will work, ‚Äúcentos‚Äù is the password specified by the user and root. </font><font style="vertical-align: inherit;">It is better to pass it from external parameters when the container starts, but even in this form the container will not be vulnerable, because </font><font style="vertical-align: inherit;">the connection will be password-protected in VNC via the password in the arguments.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configure vnc server startup</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To start, you need an auxiliary script that will configure our VNC Server:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment">#!/usr/bin/expec</span><font></font>
<font></font>
spawn /usr/bin/vncserver :1 -<span class="hljs-built_in">fg</span> -geometry 1820x960<font></font>
expect <span class="hljs-string">"Password:"</span>
send <span class="hljs-string">"<span class="hljs-variable">$env</span>(password)\r"</span>
expect <span class="hljs-string">"Verify:"</span>
send <span class="hljs-string">"<span class="hljs-variable">$env</span>(password)\r"</span>
expect <span class="hljs-string">"Would you like to enter a view-only password (y/n)?"</span>
send <span class="hljs-string">"n\r"</span><font></font>
<font></font>
<span class="hljs-built_in">set</span> timeout -1<font></font>
expect eof<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It must be put next to the Dockefile, later it will be included in the container and the program will start from it. </font><font style="vertical-align: inherit;">In this file, you must specify the resolution in which you plan to work, for example, I have 1820x960 set. </font><font style="vertical-align: inherit;">If you specify less than the size of the client window, the server may crash due to lack of memory. </font><font style="vertical-align: inherit;">If you specify more, then the picture will need to be scaled and the elements of the desktop will become too small. </font><font style="vertical-align: inherit;">Also in this script, a password will be set from the variables that will be passed in the container launch parameters. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It remains to copy this file to the container and add the parameters for its launch:</font></font><br>
<br>
<pre><code class="bash hljs">... Dockerfile<font></font>
<font></font>
COPY ./startup.sh <span class="hljs-variable">${HOME}</span>
RUN mkdir -p <span class="hljs-variable">${HOME}</span>/.vnc \<font></font>
        &amp;&amp; \<font></font>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">'#!/bin/sh'</span> &gt; <span class="hljs-variable">${HOME}</span>/.vnc/xstartup &amp;&amp; \
        <span class="hljs-built_in">echo</span> <span class="hljs-string">'exec startlxqt'</span> &gt;&gt; <span class="hljs-variable">${HOME}</span>/.vnc/xstartup &amp;&amp; \<font></font>
        chmod 775 <span class="hljs-variable">${HOME}</span>/.vnc/xstartup \<font></font>
        &amp;&amp; \<font></font>
        chown headless:headless -R <span class="hljs-variable">${HOME}</span><font></font>
<font></font>
<font></font>
WORKDIR <span class="hljs-variable">${HOME}</span><font></font>
USER headless<font></font>
ENTRYPOINT [<span class="hljs-string">"expect"</span>, <span class="hljs-string">"./startup.sh"</span>]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That's all, you can run. </font><font style="vertical-align: inherit;">If you are confused in compiling the Dockerfile, then its full version can be found in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my repository</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and the finished container in the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docker hub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To start the finished container, you must run the command:</font></font><br>
<br>
<pre><code class="bash hljs">docker run -it --rm -e password=<span class="hljs-string">'YOUR_VNC_PASSWORD'</span> -p5901:5901 labeg/centos-lxqt-vnc
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And connect using the TightVNC client. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ho/su/mn/hosumn20fgmt0vg-wpvjq8k9r-s.jpeg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After connecting, you must enter the user password specified earlier. </font><font style="vertical-align: inherit;">It is also recommended that you change it immediately for greater safety. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To enable beautiful design as in the screenshot above, go to Start&gt; Preferences&gt; Appearance&gt; LXQt Theme and select the Kde-plasma theme.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Programs for work</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now you can create a second image with work programs. </font><font style="vertical-align: inherit;">To do this, just take the image created above and supplement it with scripts for installing packages:</font></font><br>
<br>
<pre><code class="bash hljs">FROM labeg/centos-lxqt-vnc:latest<font></font>
<font></font>
USER root<font></font>
<font></font>
<span class="hljs-comment"># dotnet vscode monodevelop nodejs git2</span><font></font>
RUN rpm -Uvh https://packages.microsoft.com/config/rhel/7/packages-microsoft-prod.rpm \<font></font>
        &amp;&amp; \<font></font>
        rpm --import https://packages.microsoft.com/keys/microsoft.asc &amp;&amp; \<font></font>
        sh -c <span class="hljs-string">'echo -e "[code]\nname=Visual Studio Code\nbaseurl=https://packages.microsoft.com/yumrepos/vscode\nenabled=1\ngpgcheck=1\ngpgkey=https://packages.microsoft.com/keys/microsoft.asc" &gt; /etc/yum.repos.d/vscode.repo'</span> \<font></font>
        &amp;&amp; \<font></font>
        rpm --import <span class="hljs-string">"http://keyserver.ubuntu.com/pks/lookup?op=get&amp;search=0x3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF"</span> &amp;&amp; \<font></font>
        su -c <span class="hljs-string">'curl https://download.mono-project.com/repo/centos7-vs.repo | tee /etc/yum.repos.d/mono-centos7-vs.repo'</span> \<font></font>
        &amp;&amp; \<font></font>
        yum install -y https://centos7.iuscommunity.org/ius-release.rpm \<font></font>
        &amp;&amp; \<font></font>
        curl -sL https://rpm.nodesource.com/setup_13.x | bash - \<font></font>
        &amp;&amp; \<font></font>
        dnf install -y geany git2u git2u-gui code monodevelop firefox dotnet-sdk-3.1 nodejs gnome-terminal gnome-system-monitor \<font></font>
        &amp;&amp; \<font></font>
        npm install -g gulp typescript npm-check-updates \<font></font>
        &amp;&amp; \<font></font>
        chown headless:headless -R <span class="hljs-variable">${HOME}</span><font></font>
<font></font>
USER headless<font></font>
<font></font>
RUN code --install-extension ms-vscode.vscode-typescript-tslint-plugin &amp;&amp; \<font></font>
    code --install-extension dbaeumer.vscode-eslint &amp;&amp; \<font></font>
    code --install-extension mrmlnc.vscode-scss &amp;&amp; \<font></font>
    code --install-extension visualstudioexptteam.vscodeintellicode &amp;&amp; \<font></font>
    code --install-extension ms-dotnettools.csharp &amp;&amp; \<font></font>
    code --install-extension joelday.docthis &amp;&amp; \<font></font>
    code --install-extension mrmlnc.vscode-remark &amp;&amp; \<font></font>
    code --install-extension eamodio.gitlens<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The script installs tools for Typescript and C # development under Linux. </font><font style="vertical-align: inherit;">This is NodeJS, VS Code with the necessary extensions and Monodevelop (aka Visual Studio for Mac). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It starts as simple as the previous image:</font></font><br>
<br>
<pre><code class="bash hljs">docker run -it --rm -e password=<span class="hljs-string">'YOUR_VNC_PASSWORD'</span> -p5901:5901 labeg/devpc
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now in seconds you can deploy a clean working environment.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/41/bc/un/41bcungih1mb9w0w-tj3oezapyg.png" alt="image"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Repositories and finished images</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you need ready-made repositories and images, or if you want to improve existing ones, for example, through the startup parameters, set the user password, screen resolution, or restart the VNC server after it crashes, then welcome to my repositories. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Basic image with the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gihub </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dockerhub desktop</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Image with Typescript and C # </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gihub </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dockerhub tools</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en497990/index.html">PostgreSQL: Development of extensions (functions) in C language</a></li>
<li><a href="../en497994/index.html">Language mechanics escape analysis</a></li>
<li><a href="../en497996/index.html">You do not want to strengthen immunity. Or the extremes of the human body</a></li>
<li><a href="../en498000/index.html">Things I would like to know before developing my own game</a></li>
<li><a href="../en498002/index.html">Pocket Guide to the Z3</a></li>
<li><a href="../en498006/index.html">Choosing a Patent Attorney</a></li>
<li><a href="../en498012/index.html">Mikrotik RouterOS in Docker with Qemu</a></li>
<li><a href="../en498014/index.html">PyDERASN: as I added big-data support</a></li>
<li><a href="../en498018/index.html">On-line analytics in microservice architecture: help and suggest Postgres FDW Ã∂ –∏ Post Post Ã∂–øÃ∂—ÄÃ∂–æÃ∂—ÅÃ∂—ÇÃ∂–∏Ã∂—Ç –∏—åÃ∂</a></li>
<li><a href="../en498020/index.html">About one indicator applicable for the visual assessment of rapidly growing functions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>