<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßúüèΩ üÜí üëäüèª HackTheBox. Walkthrough Traverxec. RCE in nostromo web server, GTFOBins technique üëó üßõüèø ‚ÑπÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I continue to publish solutions sent for further processing from the HackTheBox site . 
 
 In this article, we get RCE in the nostromo web server, get...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>HackTheBox. Walkthrough Traverxec. RCE in nostromo web server, GTFOBins technique</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/496736/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/cv/1r/l2/cv1rl2phuplnxh3mafitonbonxg.png" alt="image"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I continue to publish solutions sent for </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">further processing</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> from the </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">HackTheBox</font></a><font style="vertical-align: inherit;"> site </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this article, we get RCE in the nostromo web server, get the meterpreter shell from under the active metasploit session, dig into the nostromo configs, tweak the SSH key encryption password and use the GTFOBins technique to increase privileges. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Connection to the laboratory is via VPN. </font><font style="vertical-align: inherit;">It is recommended not to connect from a work computer or from a host where the data important to you is available, since you get into a private network with people who know something in the field of information security :)</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Organizational Information</font></font></b><div class="spoiler_text">      ,     ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">  Telegram</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">    </a>   .    , ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">    </a>.<br>
<a name="habracut"></a><br>
      .          ,  -      ,      .<br>
</div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recon</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This machine has an IP address of 10.10.10.165, which I add to / etc / hosts.</font></font><br>
<br>
<pre><code class="plaintext hljs">10.10.10.165    traverxec.htb</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First, we scan open ports. </font><font style="vertical-align: inherit;">Since it takes a long time to scan all the ports with nmap, I will first do this with masscan. </font><font style="vertical-align: inherit;">We scan all TCP and UDP ports from the tun0 interface at a speed of 1000 packets per second.</font></font><br>
<br>
<pre><code class="bash hljs">masscan -e tun0 -p1-65535,U:1-65535 10.10.10.165 --rate=1000</code></pre><br>
<img src="https://habrastorage.org/webt/fj/ny/t_/fjnyt_s0uh92kz_s1gh9hfx6wg8.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now, for more detailed information about the services that operate on ports, we will run a scan with the -A option.</font></font><br>
<br>
<pre><code class="bash hljs">nmap -A traverxec.htb -p22,80</code></pre><br>
<img src="https://habrastorage.org/webt/vv/iy/e5/vviye568fbxzztimw0crgfelkvg.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thus we have SSH and the Nostromo web server. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's check the Nostromo web server for known exploits for version 1.9.6. </font><font style="vertical-align: inherit;">For these purposes, you can use searchsploit, this program provides the ability to conveniently work with exploits that are in the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exploit-db</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> database </font><font style="vertical-align: inherit;">. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tr/g1/kl/trg1kl1-jhuy1e-xbol-tvp4ddc.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As you can see from the result, the second exploit does not suit us, and the first has a Metasploit mark, which indicates that this module is implemented for the Metasploit Framework context.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entry point</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Download msfconsole and do an exploit search. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fr/k0/xh/frk0xh4ycvbvbuuu5a2dppqdsi0.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now we know the full name of the exploit and can use it. After loading the exploit, we‚Äôll review information about it. So we will find out the basic options for its use and a description of the exploit itself. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qt/jz/5l/qtjz5lgkje5eyr5gfakrbenpyys.png" alt="image"><br>
<br>
<img src="https://habrastorage.org/webt/zc/ob/g0/zcobg0enb9nmevjoef5o4edhw3q.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fine! This exploit is suitable for our version of nostromo. We set the basic options and check the operation of the exploit. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xc/wu/8q/xcwu8qvsmj8xv9emj5w8czqsmei.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For convenience, we get a meterpreter shell. To do this, send the session to work in the background - Ctrl + Z and confirm. And if we look at the working sessions, then we will see the one that has just been minimized. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/q6/z8/ih/q6z8ih4_ukj9sb_cx27yj0bvtxs.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To get the meterpreter shell in a running session, you can use the post operation module post / multi / manage / shell_to_meterpreter. Quickly use this module as follows.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zn/fp/el/znfpel4wruv68vmt3mex2lbtsgw.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We are informed that the meterpreter shell is open in the second session. </font><font style="vertical-align: inherit;">Therefore, we launch the second session.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sb/9q/vl/sb9qvl7qwj8bd8ihk2ubyuwqu4i.png" alt="image"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">USER</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And the first thing you need to look around at the host. </font><font style="vertical-align: inherit;">To do this, load the enumeration script for Linux onto the machine. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xm/wf/wg/xmwfwg7z4jo7djlzeg3paok4nao.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, call the shell, give the right to execute and run the script. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bt/yp/xm/btypxmb6ifsxq2bpbanhlvixg0i.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Analyzing the output, we find the password hash from .htpasswd. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/z0/p0/80/z0p080wkwaiyit1rvpwathmbw1k.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Further revolving around is a waste of time ... Realizing this and not knowing where to go further, it was decided to look at the configurations of the web server. </font><font style="vertical-align: inherit;">Fortunately, the directory is indicated in the path to this file. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gs/1a/4k/gs1a4kocl9nkfdfc_pgr_0rzke4.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, look at the nhttp.conf file.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/w_/a2/vw/w_a2vwhedko3pclch6x0qdl5dee.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The fact is that the root directory in nostromo is specified in the configuration file as homedirs_public. That is, this is the public_www directory. This directory is located in the user's home (homedirs - / home) directory (serveradmin - david@traverxec.htb). Summarizing the above, the index.html file is located in the directory / home / david / public_www. For users to be able to access this page, the directory must have read permissions for everyone. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bo/eq/ut/boequtfe3tuoieb2hkikhvu4lzo.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Guesses are confirmed. In addition, we see some kind of directory, let's look what's there. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qt/ef/qz/qtefqz9je5ncyz7m_srpuqs_3ms.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There we find a backup of SSH files. Download them. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kf/uj/dy/kfujdyz6tpyctmmnv9iidjp4sxw.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unzip the files. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/be/_z/ls/be_zlsvrskmjle3wjuqt7wnwzki.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And we have a private user key, but when trying to connect, we are asked for a password. This means that the key is encrypted.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xp/l5/b9/xpl5b9dszoqgazqhnegdbdpxwhs.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But we can scroll through it. </font><font style="vertical-align: inherit;">First we bring to the desired format. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/op/n4/tt/opn4ttcwbqy0x2wnh121n7gmx1u.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Save the hash to a file and scroll through the rockyou.txt dictionary using JohnTheRipper. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/5u/wa/gy/5uwagyhwgn3q6wooowuaozoabdo.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So we find the key encryption password. </font><font style="vertical-align: inherit;">Using it and a key, we connect via SSH.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/uw/yb/zt/uwybztn8hjh3wxk3ztlcqehu4yq.png" alt="image"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ROOT</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We look at what we have in the user directory. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bp/rw/yt/bprwytxtrsoygh1lcrothjokkss.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the bin directory we find an interesting file. Let's see what kind of script. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ql/r8/db/qlr8db-h0ei6dh0zoj6zghxba_c.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This script prints lines and then executes a command from under sudo, the output of which passes to cat, which is very interesting. Run this command and see a rather massive output. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yk/1a/jr/yk1ajrab-e0agxgzl62h3io8fjq.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Redirecting to cat immediately prompted me to think about using GTFOBins technology. The bottom line is that from different system utilities we can get the ability to read, write files, execute commands, etc. An example of how to do this for different programs can be found </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The fact is that if we squeeze the terminal window and execute the command without translating the output to cat, the output will automatically be sent to less, where we can get the shell using! / Bin / sh. </font><font style="vertical-align: inherit;">Since the command is executed under sudo, we get a shell with maximum privileges. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xw/dh/ri/xwdhrig3bezslvukrbvhrhzouzm.png" alt="image"><br>
<br>
<img src="https://habrastorage.org/webt/om/jr/em/omjremzjxyv9mucajiqubondkra.png" alt="image"><br>
<br>
<img src="https://habrastorage.org/webt/zk/oc/hk/zkochkpophrr-pb44ne88kxdncq.png" alt="image"><br>
<br>
<img src="https://habrastorage.org/webt/wn/5e/eb/wn5eebic3wywhci2tmaf2whwjxc.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So we get the root user on the system. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can join us on </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telegram</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">There you can find interesting materials, merged courses, as well as software. </font><font style="vertical-align: inherit;">Let's put together a community in which there will be people who are versed in many areas of IT, then we can always help each other on any IT and information security issues.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en496720/index.html">LLHD Project - Universal Hardware Description Language</a></li>
<li><a href="../en496722/index.html">Tinkov API. Investment. First steps</a></li>
<li><a href="../en496726/index.html">Gent to the bottom</a></li>
<li><a href="../en496728/index.html">Manual testers are not needed or it‚Äôs time for automation</a></li>
<li><a href="../en496734/index.html">Do you want to be more effective - ‚Äúbreak your arm‚Äù</a></li>
<li><a href="../en496738/index.html">Microsoft invests $ 20 million to fight COVID-19 with AI</a></li>
<li><a href="../en496740/index.html">10 reasons to upgrade to the new Microsoft Edge</a></li>
<li><a href="../en496742/index.html">About one solution to the problem of thieves and prostitutes in online educational services systems</a></li>
<li><a href="../en496744/index.html">How to save finances and even make money in the face of falling markets: structural products</a></li>
<li><a href="../en496750/index.html">Stratification, or how to learn to trust data</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>