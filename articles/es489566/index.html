<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•ö ü§Ωüèª üë©üèø‚Äçüç≥ Construir C ++ con bazel üë©üèø‚Äçüî¨ üåé üéä</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introducci√≥n y motivaci√≥n
 Recientemente, han aparecido publicaciones en Habr que cmake y c ++ son amigos, se dan ejemplos de c√≥mo recopilar bibliotec...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Construir C ++ con bazel</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/489566/"><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introducci√≥n y motivaci√≥n</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recientemente, han aparecido publicaciones en Habr que cmake y c ++ son amigos, se dan ejemplos de c√≥mo recopilar bibliotecas de solo encabezado y no solo, pero no hay una descripci√≥n general de al menos algunos sistemas de compilaci√≥n nuevos: bazel, buck, gn y otros. </font><font style="vertical-align: inherit;">Si usted, como yo, escribe en C ++ en 2k20, le sugiero que se familiarice con Bazel como un sistema de compilaci√≥n para un proyecto de C ++. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dejaremos la pregunta de qu√© cmake y otros sistemas existentes son malos y nos concentraremos en lo que Bazel puede hacer. </font><font style="vertical-align: inherit;">Para decidir qu√© es lo mejor espec√≠ficamente para ti, lo dejo espec√≠ficamente para ti.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comencemos con la definici√≥n y la motivaci√≥n. </font><font style="vertical-align: inherit;">Bazel es un sistema de compilaci√≥n multiling√ºe de Google que puede construir proyectos en c ++. </font><font style="vertical-align: inherit;">¬øPor qu√© deber√≠amos mirar a otro sistema de compilaci√≥n? </font><font style="vertical-align: inherit;">En primer lugar, debido a que algunos proyectos grandes ya est√°n yendo hacia ella, por ejemplo Tensorflow, Kubernetes y Gtest, y en consecuencia, para integrarse con ellos, ya debe poder usar bazel. </font><font style="vertical-align: inherit;">En segundo lugar, adem√°s de Google, Bazel todav√≠a usa spaceX, nvidia y otras compa√±√≠as a juzgar por sus actuaciones en bazelcon. </font><font style="vertical-align: inherit;">Finalmente, bazel es un proyecto de c√≥digo abierto bastante popular en github, por lo que definitivamente vale la pena echarle un vistazo y probarlo.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejemplo 1. Trivial</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay main.cc y necesitas compilarlo: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
main.cc</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
   <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Hello, habr"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
   <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo comienza con una declaraci√≥n de espacio de trabajo. En t√©rminos de espacio de trabajo de Bazel, este es el directorio en el que se encuentran todos sus archivos de origen. Para designar este espacio de trabajo, debe crear un archivo vac√≠o con el nombre ESPACIO DE TRABAJO en el directorio que necesitamos, generalmente este es el directorio src. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La unidad m√≠nima para organizar el c√≥digo en bazel es un paquete. El paquete est√° definido por el directorio fuente y un archivo BUILD especial que describe c√≥mo se ensamblan estas fuentes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agregue el paquete principal a nuestro proyecto: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wq/dq/7l/wqdq7lk5ecrf91hqc2u7og0y3do.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
en el archivo BUILD, ahora debemos describir lo que queremos construir desde nuestro main. Naturalmente, queremos compilar un binario ejecutable, por lo que utilizaremos la regla cc_binary. Bazel ya admite C ++ fuera de la caja, por lo que ya hay un cierto conjunto de reglas para construir objetivos de C ++, conoceremos el resto m√°s adelante.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agregue la regla cc_binary al archivo BUILD, tiene un nombre que tendr√° un archivo ejecutable y una matriz de fuentes que se pasar√°n al compilador. </font><font style="vertical-align: inherit;">Todo esto se describe en starlark, que es una pit√≥n truncada.</font></font><br>
<br>
<pre><code class="python hljs">cc_binary(<font></font>
  name = <span class="hljs-string">"hello_world"</span>,<font></font>
  srcs = <span class="hljs-string">"main.cc"</span><font></font>
)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bazel, a diferencia de cmake, no se basa en comandos, pero permite describir declarativamente dependencias a trav√©s de reglas. </font><font style="vertical-align: inherit;">Esencialmente, las reglas asocian m√∫ltiples artefactos con una operaci√≥n espec√≠fica. </font><font style="vertical-align: inherit;">Utiliz√°ndolos, Bazel crea un gr√°fico de comandos, que luego se almacena en cach√© y se ejecuta. </font><font style="vertical-align: inherit;">En nuestro caso, el archivo fuente main.cc est√° asociado con una operaci√≥n de compilaci√≥n, cuyo resultado es el artefacto hello_world, un archivo ejecutable binario. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para obtener ahora nuestro ejecutable, debemos ir al directorio con espacio de trabajo y escribir:</font></font><br>
<br>
<pre><code class="bash hljs">bazel build //main:hello_world
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El sistema de compilaci√≥n acepta el comando de compilaci√≥n y el camino hacia nuestro objetivo, comenzando desde la ra√≠z de nuestro proyecto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El binario resultante se ubicar√° en bazel-bin / main / hello_world.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejemplo 2. Construye con tu biblioteca</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afortunadamente, nadie necesita proyectos tan simples, as√≠ que veamos c√≥mo agregar funcionalidad a nuestro proyecto. </font><font style="vertical-align: inherit;">Agregue una biblioteca que se construir√° por separado y se vincular√° a nuestra principal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deja que sea Square, una biblioteca que proporcionar√° una funci√≥n de cuadratura inequ√≠voca. </font><font style="vertical-align: inherit;">Agregar una nueva biblioteca significa agregar un nuevo paquete, tambi√©n llam√©moslo cuadrado. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kv/kr/0o/kvkr0o7nryy4fddsibmtge2dabo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cuadrado.h</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> SQUQRE_SQUARE_H_</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SQUQRE_SQUARE_H_</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Square</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span></span>;<font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">// SQUQRE_SQUARE_H_</span></span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
square.cc</font></font><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"square/square.h"</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Square</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>{
  <span class="hljs-keyword">return</span> x * x;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Presta atenci√≥n a la conexi√≥n del archivo de encabezado, lo hago a trav√©s de la ruta desde el espacio de trabajo, aunque el archivo est√© en el mismo directorio. Este enfoque se adopta en la gu√≠a de estilo de c√≥digo de cromo, que se hereda de la gu√≠a de estilo google c ++. Este m√©todo le permite comprender de inmediato desde d√≥nde est√° conectado el archivo de encabezado. No se preocupe, habr√° un archivo, Bazel agregar√° rutas para buscar archivos de encabezado, pero si no sigue esta regla, es posible que no se encuentren archivos de encabezado durante la compilaci√≥n de Bazel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el archivo BUILD de nuestra biblioteca, describimos la regla para construir las bibliotecas cc_library:</font></font><br>
<br>
<pre><code class="python hljs">cc_library(<font></font>
  name = <span class="hljs-string">"square"</span>,<font></font>
  srcs = [<span class="hljs-string">"square.cc"</span>],<font></font>
  hdrs = [<span class="hljs-string">"square.h"</span>],<font></font>
  visibility = [<span class="hljs-string">"//visibility:public"</span>]<font></font>
)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ enumeramos por separado los archivos de origen y encabezado, y tambi√©n especificamos la visibilidad en p√∫blico. </font><font style="vertical-align: inherit;">Esto √∫ltimo es necesario para que podamos depender de nuestra biblioteca en cualquier parte de nuestro proyecto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En main.cc usamos nuestra biblioteca:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"square/square.h"</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Hello, bazel!"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; Square(<span class="hljs-number">2</span>) &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nuevamente, llamo la atenci√≥n sobre el hecho de que incluimos el archivo de encabezado de la biblioteca a trav√©s de la ruta desde el espacio de trabajo. </font><font style="vertical-align: inherit;">Esto ya es absolutamente necesario aqu√≠, porque bazel usa contenedores de Linux debajo del cap√≥ para garantizar un nivel m√≠nimo de estanqueidad del ensamblaje y, en consecuencia, montar√° los archivos de encabezado de la biblioteca cuadrada solo para que se ubiquen a trav√©s de la ruta desde el espacio de trabajo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y describimos la dependencia en la regla de ensamblaje para main en la biblioteca cuadrada.</font></font><br>
<br>
<pre><code class="python hljs">cc_binary(<font></font>
  name = <span class="hljs-string">"hello_world"</span>,<font></font>
  srcs = [<span class="hljs-string">"main.cc"</span>],<font></font>
  deps = [<span class="hljs-string">"//square:square"</span>]<font></font>
)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo nuestro programa se ensambla de la misma manera que sin usar la biblioteca, Bazel comprender√° de qu√© depende, construir√° un gr√°fico, almacenar√° en cach√© los resultados y reconstruir√° solo lo que necesita ser reconstruido.</font></font><br>
<br>
<pre><code class="bash hljs">bazel build //main:hello_world
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejemplo 3. Pruebas de conexi√≥n</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øC√≥mo vivir sin pruebas? </font><font style="vertical-align: inherit;">¬°De ninguna manera! </font><font style="vertical-align: inherit;">Para conectarse a bazel GTest, que por cierto ya admite el ensamblaje con bazel, debe agregar una dependencia externa. </font><font style="vertical-align: inherit;">Esto se hace en el archivo WORKSPACE:</font></font><br>
<br>
<pre><code class="python hljs">load(<span class="hljs-string">"@bazel_tools//tools/build_defs/repo:git.bzl"</span>, <span class="hljs-string">"git_repository"</span>)<font></font>
<font></font>
git_repository(<font></font>
  name = <span class="hljs-string">"googletest"</span>,<font></font>
  remote = <span class="hljs-string">"https://github.com/google/googletest"</span>,<font></font>
  tag = <span class="hljs-string">"release-1.8.1"</span><font></font>
)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al igual que los hipsters, conectaron la regla git_repository y le dijeron a bazel qu√© versi√≥n descargar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n, creamos un paquete separado para pruebas de prueba y agregamos pruebas a nuestra biblioteca: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
square_unittest.cc</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"gtest/gtest.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"square/square.h"</span></span><font></font>
<font></font>
TEST(SquareTests, Basics) {<font></font>
    EXPECT_EQ(Square(<span class="hljs-number">-1</span>), <span class="hljs-number">1</span>);<font></font>
    EXPECT_EQ(Square(<span class="hljs-number">1</span>), <span class="hljs-number">1</span>);<font></font>
    EXPECT_EQ(Square(<span class="hljs-number">2</span>), <span class="hljs-number">4</span>);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora es el turno de definir una regla para las pruebas.</font></font><br>
<br>
<pre><code class="python hljs">cc_test(<font></font>
  name = <span class="hljs-string">"unittests"</span>,<font></font>
  srcs = [<span class="hljs-string">"square_unittest.cc"</span>],<font></font>
  deps = [<font></font>
   <span class="hljs-string">"//square:square"</span>,
   <span class="hljs-string">"@googletest//:gtest_main"</span><font></font>
  ]<font></font>
)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agregamos dependencias en nuestra biblioteca y en gtest_main para que la biblioteca gtest nos proporcione una implementaci√≥n de iniciador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las pruebas se ejecutan con el comando:</font></font><br>
<br>
<pre><code class="bash hljs">bazel <span class="hljs-built_in">test</span> //<span class="hljs-built_in">test</span>:unittests
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bazel descargar√° y crear√° GTest, vincular√° todo lo que se necesita para las pruebas y las ejecutar√° ellos mismos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menciono que Bazel tambi√©n sabe c√≥mo hacer cobertura de c√≥digo:</font></font><br>
<br>
<pre><code class="bash hljs">bazel coverage //<span class="hljs-built_in">test</span>:unittests
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y si necesita depurar pruebas, puede compilar todo en modo de depuraci√≥n con caracteres como este:</font></font><br>
<br>
<pre><code class="bash hljs">bazel build //<span class="hljs-built_in">test</span>:unittests --compilation_mode=dbg -s
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejemplo 4. Conexi√≥n de otras bibliotecas que no saben bazel</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por supuesto, el mundo no se basa solo en Bazel, por lo que tambi√©n debe poder conectar otras bibliotecas. </font><font style="vertical-align: inherit;">Recientemente, en mi proyecto, necesitaba una biblioteca para analizar los argumentos de la l√≠nea de comandos. </font><font style="vertical-align: inherit;">Bueno, no me escribas en 2k20 tu propia biblioteca y te distraigas del trabajo principal. </font><font style="vertical-align: inherit;">Realmente no quiero usar medias tintas, como getops, ni arrastrar impulso a mi proyecto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No para publicidad, conectaremos la biblioteca CLI11, que usa nada m√°s que el est√°ndar STL C ++ 11 y proporciona una interfaz m√°s o menos conveniente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una biblioteca es solo de encabezado, lo que hace que la conexi√≥n sea especialmente f√°cil. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Conecte la dependencia externa en WORKSPACE:</font></font><br>
<br>
<pre><code class="python hljs">load(<span class="hljs-string">"@bazel_tools//tools/build_defs/repo:http.bzl"</span>, <span class="hljs-string">"http_file"</span>)<font></font>
<font></font>
http_file(<font></font>
  name = <span class="hljs-string">"CLI11"</span>,<font></font>
  downloaded_file_path = <span class="hljs-string">"CLI11.hpp"</span>,<font></font>
  urls = [<span class="hljs-string">"https://github.com/CLIUtils/CLI11/releases/download/v1.9.0/CLI11.hpp"</span>],<font></font>
  sha256 = <span class="hljs-string">"6f0a1d8846ed7fa4c2b66da3eb252aa03d27170258df..."</span>,<font></font>
)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agregamos el directorio de terceros y agregamos el paquete CLI11 para la conveniencia de crear dependencias en esta biblioteca:</font></font><br>
<br>
<pre><code class="python hljs">cc_library(<font></font>
  name = <span class="hljs-string">"CLI11"</span>,<font></font>
  hdrs = [<span class="hljs-string">"@CLI11//file"</span>],<font></font>
  strip_include_prefix = <span class="hljs-string">"/external/CLI11/file"</span>,<font></font>
  include_prefix = <span class="hljs-string">"CLI11"</span>,<font></font>
  linkstatic = <span class="hljs-literal">True</span>,<font></font>
  visibility = [<span class="hljs-string">"//visibility:public"</span>],<font></font>
)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bazel buscar√° por defecto el archivo de la biblioteca por la ruta / external / CLI11 para que cambiemos un poco las rutas para conectarlo a trav√©s de CLI11 /. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
main.cc</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"CLI11/CLI11.hpp"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"square/square.h"</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Hello, bazel!"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; Square(<span class="hljs-number">2</span>) &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dependiendo de main, agregue "// third_party / CLI11: CLI11" y todo comenzar√° a funcionar. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No s√© sobre usted, pero conectar esta biblioteca desconocida y usarla en un proyecto de C ++ de esta forma me deleita. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
S√≠, con la biblioteca de solo encabezado dir√° que todo es simple, pero con una biblioteca que no es solo de encabezado que a√∫n no est√° construida con bazel, todo es igual de simple. </font><font style="vertical-align: inherit;">Simplemente desc√°rguelo a trav√©s de http_archive o git_repository y agregue un archivo externo BUILD en el directorio de terceros, donde describe c√≥mo construir su biblioteca. </font><font style="vertical-align: inherit;">Bazel admite llamar a cualquier cmd e incluso llamar a cmake, a trav√©s de la regla cmake_external.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejemplo 5. Scripts y automatizaci√≥n.</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øQui√©n necesita un proyecto en c ++ simple en 2k20 sin scripts para la automatizaci√≥n? </font><font style="vertical-align: inherit;">Por lo general, estos scripts son necesarios para ejecutar pruebas de rendimiento o para implementar sus artefactos en alg√∫n lugar de CI. </font><font style="vertical-align: inherit;">Bueno, generalmente est√°n escritos en python. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para esto, Bazel tambi√©n es adecuado, ya que se puede usar en casi todos los lenguajes populares y est√° dise√±ado para recopilar tales solyanka de diferentes lenguajes de programaci√≥n que a menudo se encuentran en proyectos reales. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos a conectar el script de Python que ejecutar√° nuestro main. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agregue el paquete de perf-tests:</font></font><br>
<br>
<pre><code class="python hljs">py_binary(<font></font>
  name = <span class="hljs-string">"perf_tests"</span>,<font></font>
  srcs = [<span class="hljs-string">"perf_tests.py"</span>],<font></font>
  data = [<font></font>
    <span class="hljs-string">"//main:hello_world"</span>,<font></font>
  ],<font></font>
)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como dependencia de datos, agregue la dependencia binaria hello_world. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
perf_tests.py</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> subprocess
<span class="hljs-keyword">import</span> time<font></font>
<font></font>
start_time = time.time()<font></font>
process = subprocess.run([<span class="hljs-string">'main/hello_world, '</span>param1<span class="hljs-string">', ],
                         stdout=subprocess.PIPE,
                         universal_newlines=True)
end_time = time.time()
print("--- %s seconds ---" % (end_time - start_time))
</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para ejecutar nuestras pruebas, simplemente escribimos:</font></font><br>
<pre><code class="bash hljs">bazel run //perf-tests:perf_tests
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusi√≥n y lo que no se toca.</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Analizamos brevemente a bazel y sus caracter√≠sticas principales para ensamblar archivos ejecutables y bibliotecas, tanto de terceros como nuestras. </font><font style="vertical-align: inherit;">Para mi gusto, resulta bastante concisa y muy r√°pida. </font><font style="vertical-align: inherit;">No hay necesidad de sufrir y buscar alg√∫n tutorial de cmake para hacer algo trivial y limpiar CmakeCache. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si est√° interesado, todav√≠a queda mucho por la borda: b√∫feres de protocolo, desinfectantes, configuraciones de cadena de herramientas para compilar para diferentes plataformas / arquitecturas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gracias por leer, y espero haberte sido √∫til.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es489554/index.html">Peque√±as sutilezas de java.lang.String</a></li>
<li><a href="../es489556/index.html">No le d√© nombres a los hilos de ThreadPool cuando depure en VS</a></li>
<li><a href="../es489558/index.html">Acerca de Samsung actualiz√≥ el televisor insignia: Q950: cambios, jambas, as√≠ como pron√≥sticos para el nuevo dispositivo</a></li>
<li><a href="../es489560/index.html">Reaccione el formulario de comentarios nativos con AWS + Telegram</a></li>
<li><a href="../es489562/index.html">Pruebas en Kotlin con Spock</a></li>
<li><a href="../es489568/index.html">Conferencia DEFCON 27. Duplicaci√≥n de llaves mec√°nicas con acceso limitado. Parte 1</a></li>
<li><a href="../es489576/index.html">Los matices de la medicina moderna.</a></li>
<li><a href="../es489582/index.html">En busca de Godzilla. Redes neuronales y cotizaciones de pron√≥stico basadas en intercambio y datos "externos"</a></li>
<li><a href="../es489584/index.html">C√≥mo mejorar su servicio API en node.js. Parte 1</a></li>
<li><a href="../es489586/index.html">Visualizaci√≥n de sonido en l√°mparas vintage.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>