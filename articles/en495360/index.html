<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úâÔ∏è üë®üèΩ‚Äçüè≠ üõÑ How we automated porting products from C # to C ++ ü§æüèº ‚öîÔ∏è ü§∑üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, Habr. In this post I will talk about how we managed to organize a monthly release of libraries for the C ++ language, the source code of which ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>How we automated porting products from C # to C ++</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495360/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hello, Habr. </font><font style="vertical-align: inherit;">In this post I will talk about how we managed to organize a monthly release of libraries for the C ++ language, the source code of which is developed in C #. </font><font style="vertical-align: inherit;">This is not about managed C ++, or even about creating a bridge between unmanaged C ++ and the CLR environment ‚Äî it's about automating C ++ code generation that repeats the API and functionality of the original C # code.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We wrote the necessary infrastructure for translating code between languages ‚Äã‚Äãand emulating the functions of the .Net library ourselves, thus solving a problem that is usually considered academic. This allowed us to start releasing monthly releases of pre-Donets products for the C ++ language too, getting the code for each release from the corresponding version of the C # code. At the same time, the tests that covered the original code are ported along with it and allow you to control the performance of the resulting solution along with specially written tests in C ++.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this article I will briefly describe the history of our project and the technologies used in it. </font><font style="vertical-align: inherit;">I will touch on the issues of economic justification only in passing, since the technical side is much more interesting to me. </font><font style="vertical-align: inherit;">In the following articles of the series, I plan to dwell in more detail on topics such as code generation and memory management, as well as on some others, if the community has relevant questions.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Background</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Initially, our company was engaged in the release of libraries for the .Net platform. </font><font style="vertical-align: inherit;">These libraries mainly provide APIs for working with some file formats (documents, tables, slides, graphics) and protocols (email), occupying a certain niche in the market for such solutions. </font><font style="vertical-align: inherit;">All development was conducted in C #.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At the end of the 2000s, the company decided to enter a new market for itself, starting to release similar products for Java. Development from scratch would obviously require an investment of resources comparable to the initial development of all affected products. The option of wrapping the Donnet code into a layer that translates calls and data from Java to .Net and vice versa was also rejected for some reasons. Instead, the question was posed as to whether it is possible in any way to completely migrate existing code to the new platform. This was all the more relevant since it was not a one-time promotion, but a monthly release of new releases of each product, synchronized between two languages.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It was decided to break the decision into two parts. </font><font style="vertical-align: inherit;">The first - the so-called Porter - would convert the C # source code syntax to Java, simultaneously replacing .Net types and methods with their counterparts from Java libraries. </font><font style="vertical-align: inherit;">The second - the Library - would emulate the work of those parts of the .Net library for which it is difficult or impossible to establish direct correspondence with Java, attracting available third-party components for this. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In favor of the principal feasibility of such a plan, the following spoke:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ideologically, the C # and Java languages ‚Äã‚Äãare quite similar - at least, with the structure of types and the organization of work with memory;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It was about porting libraries; there was no need to port the GUI;</font></font></li>
<li>  ,  , -    ,        System.Net  System.Drawing;</li>
<li>   ,        .Net ( Framework,   Standard   Xamarin),          .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I will not go into details, since they deserve a separate article (and not one). </font><font style="vertical-align: inherit;">I can only say that it took about two years from the start of development to the release of the first Java product, and since then the release of Java products has become a regular practice of the company. </font><font style="vertical-align: inherit;">During the development of the project, the porter has evolved from a simple utility that converts text according to established rules, to a complex code generator that works with the AST representation of the source code. </font><font style="vertical-align: inherit;">The library is also overgrown with code. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The success of the Java direction determined the company's desire to further expand into new markets for itself, and in 2013 the question was raised about the release of products for the C ++ language in a similar scenario.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formulation of the problem</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order to ensure the release of positive versions of products, it was necessary to create a framework that would allow you to get C ++ code from arbitrary C # code, compile it, check it and give it to the client. It was about libraries with volumes ranging from several hundred thousand to several million lines (excluding dependencies).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At the same time, experience with the Java porter was taken into account: initially, when it was just a simple tool for converting syntaxes, the practice of manually finalizing the ported code naturally arose. In the short term, focused on the speedy release of products, this was relevant, since it allowed to accelerate the development process, however, in the long term, this significantly increased the costs of preparing each version for release due to the need to correct each translation error every time it occurs.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Of course, this complexity was manageable - at least by transferring only patches into the resulting Java code, which are calculated as the difference between the output of the porter for the next two revisions of the C # code. This approach made it possible to correct each ported line only once and in the future use the already developed code where no changes were made. However, when developing a positive porter, the goal was to get rid of the stage of fixing the ported code, instead fixing the framework itself. Thus, each arbitrarily rare translation error would be corrected once - in the porter code, and this fix would apply to all future releases of all ported products. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition to the porter itself, it was also required to develop a library in C ++ that would solve the following problems:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Emulation of the .Net environment to the extent that it is necessary for the ported code to work;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adapting ported C # code to the realities of C ++ (type structure, memory management, other service code);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Smoothing the differences between ‚Äúrewritten C #‚Äù and C ++ itself, to make it easier for programmers not familiar with .Net paradigms to use ported code.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For obvious reasons, no attempt was made to directly map .Net types to types from the standard library. </font><font style="vertical-align: inherit;">Instead, it was decided to always use types from his library as a replacement for the Donnet types. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Many readers will immediately ask why they did not use existing implementations like </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mono</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">There were reasons for that.</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">By attracting such a finished library, it would be possible to satisfy only the first requirement, but not the second and not the third.</font></font></li>
<li> Mono   C# ,  ,   ,       .</li>
<li>      (API,  ,   ,   C++,   )   ,     .</li>
<li>    ,    .Net,                  .  ,           ,      .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Theoretically, such a library could be translated into C ++ entirely using a port, however, this would require a fully functional porter at the very beginning of development, since without a system library debugging of any ported code is impossible in principle. In addition, the question of optimizing the translated code of the system library would be even more acute than for the code of ported products, since calls to the system library tend to become a bottleneck. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result, it was decided to develop the library as a set of adapters that provide access to functions already implemented in third-party libraries, but through a .Net-like API (similar to Java). This would reduce the work and use ready-made, already optimized, C ++ components.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An important requirement for the framework was that the ported code had to be able to work as part of user applications (as far as libraries were concerned). This meant that the memory management model should have been made clear to C ++ programmers, since we cannot force arbitrary client code to run in a garbage collection environment. The use of smart pointers was chosen as a compromise model. About how we managed to ensure such a transition (in particular, to solve the problem of circular references), I will discuss in a separate article.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another requirement was the ability to port not only libraries, but also tests for them. </font><font style="vertical-align: inherit;">The company boasts a high culture of test coverage of its products, and the ability to run in C ++ the same tests that were written for the original code would greatly simplify the search for problems after translation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The remaining requirements (launch format, test coverage, technology, etc.) concerned mainly the methods of working with the project and on the project. </font><font style="vertical-align: inherit;">I will not dwell on them.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Story</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Before continuing, I have to say a few words about the structure of the company. The company works remotely, all the teams in it are distributed. The development of a certain product is usually the responsibility of a team, united by language (almost always) and geography (mainly). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Active work on the project began in the fall of 2013. Due to the distributed structure of the company, and also due to some doubts about the success of the development, three versions of the framework were launched immediately: two of them served one product each, the third covered three at once. It was assumed that this would then stop the development of less effective solutions and reallocate resources if necessary.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the future, four more teams joined the work on the ‚Äúcommon‚Äù framework, two of which later reconsidered their decision and refused to release products for C ++. At the beginning of 2017, a decision was made to stop the development of one of the ‚Äúindividual‚Äù solutions and transfer the corresponding team to work with a ‚Äúcommon‚Äù framework. The stopped development assumed the use of the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Boehm GC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> as a means of memory management and contained a much richer implementation of some parts of the system library, which was then transferred to the ‚Äúgeneral‚Äù solution.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thus, two developments came to the finish line - that is, to the release of ported products - one ‚Äúindividual‚Äù and one ‚Äúcollective‚Äù. The first releases based on our (‚Äúcommon‚Äù) framework happened in February 2018. Subsequently, the releases of all six teams using this solution became monthly, and the framework itself was released as a separate product of the company. Even the question was raised of making it open-source, but this discussion has not yet developed. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The team, which continued to work independently on a similar framework, also released its first C ++ release in 2018.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first releases contained truncated versions of the original products, which allowed to delay the work of broadcasting unimportant parts as much as possible. </font><font style="vertical-align: inherit;">In subsequent releases, a portion-wise addition of functionality has occurred (and is occurring).</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Organization of work on the project</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The organization of joint work on the project by several teams managed to undergo significant changes. Initially, it was decided that one large, ‚Äúcentral‚Äù, team would be responsible for the development, support, and fixing of the framework, while the small ‚Äúproduct‚Äù teams involved in the release of final products in C ++ would be mainly responsible for trying to port their code and providing feedback (information about porting, compilation and execution errors). Such a scheme, however, turned out to be unproductive, since the central team was overloaded with requests from all the ‚Äúproduct‚Äù teams, and they could not move on until the problems they encountered were resolved.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For reasons that are largely independent of the state of this particular development, it was decided to disband the ‚Äúcentral‚Äù team and transfer people to ‚Äúproduct‚Äù teams, which were now responsible for fixing the framework to their needs. In this case, each team itself would make a decision on whether to use its common groundwork or generate its own fork of the project. Such a statement of the question was relevant for the Java framework, whose code was stable at that time, but consolidation of efforts was required to fill the C ++ library as soon as possible, so that the teams still worked together.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This form of work also had its drawbacks, so in the future another reform was carried out. The ‚Äúcentral‚Äù team was restored, although in a smaller composition, but with different functions: now it was not responsible for the actual development of the project, but for the organization of joint work on it. This included support for the CI environment, organizing Merge Request practices, holding regular meetings with development participants, supporting documentation, covering tests, helping with architectural solutions and troubleshooting, and so on. In addition, the team took on the work to eliminate technical debt and other resource-intensive areas. In this mode, development continues to this day.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thus, the project was initiated by the efforts of several (about five) developers and in the best of times numbered about twenty people. Some ten to fifteen people responsible for the development and support of the framework and the release of six ported products can be considered a stable value in recent years. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The author of these lines joined the company in mid-2016, starting to work in one of the teams broadcasting their code using a ‚Äúcommon‚Äù solution. In the winter of the same year, when it was decided to recreate the ‚Äúcentral‚Äù team, I moved to the position of her team leader. Thus, my experience in the project today is more than three and a half years.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The autonomy of the teams responsible for the release of ported products has led to the fact that in some cases it turned out to be easier for developers to supplement the porter with operating modes than to compromise on how it should behave by default. </font><font style="vertical-align: inherit;">This explains more than you might expect, the number of options available when configuring the porter.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Technologies</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is time to talk about the technologies used in the project. Porter is a console application written in C #, because in this form it is easier to embed in scripts that perform tasks such as "port-compile-run tests." In addition, there is a GUI component that allows you to achieve the same goals by clicking on the buttons. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The ancient </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NRefactory</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> library is responsible for parsing code and resolving semantics </font><font style="vertical-align: inherit;">. Unfortunately, at the time the project started, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Roslyn</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> was not yet available, although migration to it, of course, is in our plans. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Porter uses </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">AST wood</font></a><font style="vertical-align: inherit;"> walkways</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to collect information and generate C ++ output code. When C ++ code is generated, the AST representation is not created, and all the code is saved as plain text. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In many cases, the porter needs additional information for fine tuning. Such information is transmitted to him in the form of options and attributes. The options apply to the entire project immediately and allow you to set, for example, the names of export macro members of classes or C # preprocessor definitions used in code analysis. Attributes are hung on types and entities and determine the processing specific to them (for example, the need to generate keywords ‚Äúconst‚Äù or ‚Äúmutable‚Äù for class members or to exclude them from porting).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C # classes and structures are translated into C ++ classes, their members and executable code are translated into the nearest equivalents. Generic types and methods map to C ++ templates. C # links are translated into smart pointers (strong or weak) defined in the Library. More details about the principles of the porter will be discussed in a separate article. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thus, the original C # assembly is converted to a C ++ project, which instead of .Net libraries depends on our shared library. This is shown in the following diagram: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/of/d1/s-/ofd1s-pimst_5rrcxzz8t-fh0nq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cmake is used to build the library and ported projects. The compilers VS 2017 and 2019 (Windows), GCC and Clang (Linux) are currently supported.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As mentioned above, most of our .Net implementations are thin layers of third-party libraries that do the bulk of the work. </font><font style="vertical-align: inherit;">It includes:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Skia</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - for working with graphics;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Botan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - to support encryption functions;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ICU</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - for working with strings, encodings and cultures;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Libxml2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - for working with XML;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PCRE2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - for working with regular expressions;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zlib</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - to implement compression functions;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Boost</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - for various purposes;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">several other libraries.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Both the porter and the library are covered in numerous tests. </font><font style="vertical-align: inherit;">Library tests use the gtest framework. </font><font style="vertical-align: inherit;">Porter tests are written mainly in NUnit / xUnit and are divided into several categories, certifying that:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the porter output on these input files matches the target;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the output of the ported programs after compilation and launch coincides with the target;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NUnit tests from input projects are successfully converted to gtest tests in ported projects and pass;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ported Projects API works successfully in C ++;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the impact of individual options and attributes on the translation process is as expected.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We use </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitLab</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to store the source code </font><font style="vertical-align: inherit;">. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jenkins was</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> chosen as the CI environment </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ported products are available as Nuget packages and as download archives.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Problems</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
While working on the project, we had to face a lot of problems. </font><font style="vertical-align: inherit;">Some of them were expected, while others appeared already in the process. </font><font style="vertical-align: inherit;">We briefly list the main ones.</font></font><br>
<br>
<ol>
<li><b>     .Net  C++.</b><br>
  ,   C++    Object,       RTTI.           .Net   STL.</li>
<li><b>   .</b><br>
       ,          ,    . ,  C#     ,   C++ ‚Äî .</li>
<li><b>  .</b><br>
   ‚Äî   .          ,   .   ,            .</li>
<li><b>    .</b><br>
 C++   ,        ,        .</li>
<li><b>    C#.</b><br>
 C#    ,      C++.    ,     :<br>
<br>
<ul>
<li>   ,    ;</li>
<li>   ,       (,       yeild);</li>
<li>,      (,            ,       ,        C#);</li>
<li>,   C++ (,  C#        foreground-).</li>
</ul></li>
<li><b>  .</b><br>
,        .Net  ,          .</li>
<li><b>   .</b><br>
- ,     ,        ¬´¬ª ,     .  ,  ,  ,     ,     using,             -.                 .   ,             .</li>
<li><b> .</b><br>
         ,    ,   ,  ,   ,    /     -          .</li>
<li><b>    .</b><br>
     .       ,           .    ,       ,      ,     .</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Difficulties with the protection of intellectual property. </font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If C # code is fairly easily obfuscated by boxed solutions, then in C ++ you have to make additional efforts, since many class members cannot be deleted from header files without consequences. </font><font style="vertical-align: inherit;">Translating generic classes and methods into templates also creates vulnerabilities by exposing algorithms.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despite this, the project is very interesting from a technical point of view. </font><font style="vertical-align: inherit;">Work on it allows you to learn a lot and learn a lot. </font><font style="vertical-align: inherit;">The academic nature of the task also contributes to this.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Summary</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As part of the project, we were able to implement a system that solves an interesting academic problem for the sake of its direct practical application. We organized a monthly issue of company libraries in a language for which they were not originally intended. It turned out that most of the problems are completely solvable, and the resulting solution is reliable and practical. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Soon it is planned to publish two more articles. One of them will describe in detail, with examples, how a porter works and how C # constructs are displayed in C ++. In another speech, we will talk about how we managed to ensure compatibility of memory models of two languages.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I will try to answer the questions in the comments. </font><font style="vertical-align: inherit;">If readers show interest in other aspects of our development and the answers begin to go beyond correspondence in the comments, we will consider the possibility of publishing new articles.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en495346/index.html">From error to alert with actions</a></li>
<li><a href="../en495348/index.html">Research: How Covid-19 Affects Email Marketing Performance</a></li>
<li><a href="../en495350/index.html">Home web server, or your own hosting provider</a></li>
<li><a href="../en495354/index.html">How to release products continuously in 20 languages ‚Äã‚Äãand not die?</a></li>
<li><a href="../en495356/index.html">Implementing the RAFT Consensus Algorithm for Distributed KV Storage in Java</a></li>
<li><a href="../en495362/index.html">Self-isolate and program: how not to go crazy at home and spend time usefully</a></li>
<li><a href="../en495364/index.html">API Style Guide, or don't make users think</a></li>
<li><a href="../en495366/index.html">16 types of programmers, or Developers are not the same robots</a></li>
<li><a href="../en495368/index.html">We self-register for self-walking self-dogs in conditions of self-isolation</a></li>
<li><a href="../en495370/index.html">Public is evil</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>