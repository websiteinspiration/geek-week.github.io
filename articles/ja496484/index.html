<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ†• ğŸ‘¨ğŸ¿â€ğŸ­ ğŸ‘ŠğŸ» å‹¾é…ã¨åŒæ§˜ã®é™ä¸‹ã«ã‚ˆã‚‹kæœ€è¿‘å‚ï¼ˆã‚¦ã‚§ãƒ«ã€ã¾ãŸã¯ä»–ã®ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ï¼‰ã®ç‰¹å¾´ã®é‡è¦æ€§ã®é¸æŠ ğŸ˜¾ ğŸ™Š ğŸ¤¹ğŸ¾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æ©Ÿæ¢°å­¦ç¿’ã®æœ€ã‚‚å˜ç´”ãªã‚¿ã‚¹ã‚¯ã‚’è©¦ã—ã¦ã¿ãŸã¨ã“ã‚ã€ã‹ãªã‚Šåºƒã„ç¯„å›²ã§åŒæ™‚ã«18å€‹ã®ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’é¸æŠã™ã‚‹ã®ã¯èˆˆå‘³æ·±ã„ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚ç§ã®å ´åˆã€ã™ã¹ã¦ãŒéå¸¸ã«å˜ç´”ãªãŸã‚ã€åŠ›ãšãã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã®åŠ›ã§ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã§ãã¾ã—ãŸã€‚
 
 ä½•ã‹ã‚’å­¦ã¶ã¨ãã€ã‚ã‚‹ç¨®ã®è‡ªè»¢è»Šã‚’ç™ºæ˜ã™ã‚‹ã“ã¨ã¯éå¸¸ã«èˆˆå‘³æ·±ã„ã“ã¨ãŒ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>å‹¾é…ã¨åŒæ§˜ã®é™ä¸‹ã«ã‚ˆã‚‹kæœ€è¿‘å‚ï¼ˆã‚¦ã‚§ãƒ«ã€ã¾ãŸã¯ä»–ã®ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ï¼‰ã®ç‰¹å¾´ã®é‡è¦æ€§ã®é¸æŠ</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/496484/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/eg/qm/x6/egqmx63h8mgrbxfytg9nmuaby-g.gif" alt="çœŸã®ãƒŠãƒ³ã‚»ãƒ³ã‚¹ã¯ä¸å¯èƒ½ã‚’å®Ÿç¾ã™ã‚‹ã ã‘ã§ãªãã€è­¦å‘Šã®ä¾‹ã¨ã—ã¦ã‚‚æ©Ÿèƒ½ã—ã¾ã™"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ©Ÿæ¢°å­¦ç¿’ã®æœ€ã‚‚å˜ç´”ãªã‚¿ã‚¹ã‚¯ã‚’è©¦ã—ã¦ã¿ãŸã¨ã“ã‚ã€ã‹ãªã‚Šåºƒã„ç¯„å›²ã§åŒæ™‚ã«18å€‹ã®ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’é¸æŠã™ã‚‹ã®ã¯èˆˆå‘³æ·±ã„ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚ç§ã®å ´åˆã€ã™ã¹ã¦ãŒéå¸¸ã«å˜ç´”ãªãŸã‚ã€åŠ›ãšãã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã®åŠ›ã§ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã§ãã¾ã—ãŸã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½•ã‹ã‚’å­¦ã¶ã¨ãã€ã‚ã‚‹ç¨®ã®è‡ªè»¢è»Šã‚’ç™ºæ˜ã™ã‚‹ã“ã¨ã¯éå¸¸ã«èˆˆå‘³æ·±ã„ã“ã¨ãŒã§ãã¾ã™ã€‚æ™‚ã«ã¯ã€æœ¬å½“ã«ä½•ã‹æ–°ã—ã„ã‚‚ã®ã‚’æ€ã„ã¤ãã“ã¨ãŒåˆ¤æ˜ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚æ™‚ã€…ã€ã™ã¹ã¦ãŒç§ã®å‰ã«ç™ºæ˜ã•ã‚ŒãŸã“ã¨ãŒåˆ¤æ˜ã—ã¾ã™ã€‚ã—ã‹ã—ã€ç§ãŒãšã£ã¨å‰ã«é€²ã‚“ã é“ã‚’ç¹°ã‚Šè¿”ã—ã¦ã‚‚ã€å ±é…¬ã¨ã—ã¦ã€ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®æ ¹æœ¬çš„ãªãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã¨ãã‚Œã‚‰ã®æ©Ÿèƒ½ã¨å†…éƒ¨ã®åˆ¶é™ã‚’ã‚ˆãç†è§£ã—ã¾ã™ã€‚ç§ã¯ã‚ãªãŸã‚’æ‹›å¾…ã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pythonã¨DSã§ã¯ã€æ§ãˆã‚ã«è¨€ã£ã¦ã‚‚ã€ç§ã¯åˆå¿ƒè€…ã§ã™ã€‚å¤ã„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®ç¿’æ…£ã«å¾“ã£ã¦ã€1ã¤ã®ãƒãƒ¼ãƒ ã«å®Ÿè£…ã§ãã‚‹å¤šãã®ã“ã¨ã‚’è¡Œã„ã¾ã™ã€‚Pythonã¯ã€æ™‚ã€…ã§ã¯ãªãã€æ¡é•ã„ã«é€Ÿåº¦ã‚’è½ã¨ã™ã“ã¨ã§ç½°ã›ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã—ãŸãŒã£ã¦ã€ã™ã¹ã¦ã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒªãƒã‚¸ãƒˆãƒªã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚ˆã‚ŠåŠ¹ç‡çš„ã«å®Ÿè£…ã™ã‚‹æ–¹æ³•ã‚’çŸ¥ã£ã¦ã„ã‚‹å ´åˆ-æ¥ãšã‹ã—ãŒã‚‰ãªã„ã§ã€ãã“ã§ç·¨é›†ã™ã‚‹ã‹ã€ã‚³ãƒ¡ãƒ³ãƒˆã«æ›¸ãè¾¼ã‚“ã§ãã ã•ã„ã€‚</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/kraidiky/GDforHyperparameters</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ã™ã§ã«ã‚¯ãƒ¼ãƒ«ãªãƒ‡ãƒ¼ã‚¿ã‚µã‚¿ãƒ‹ã‚¹ãƒˆã§ã‚ã‚Šã€ã“ã®äººç”Ÿã®ã™ã¹ã¦ã‚’è©¦ã—ãŸã“ã¨ãŒã‚ã‚‹äººã¯ã€ã“ã®ã‚¿ã‚¹ã‚¯ã ã‘ã§ãªãã€å­¦ç¿’ãƒ—ãƒ­ã‚»ã‚¹ã®è¦–è¦šåŒ–ã‚‚èˆˆå‘³æ·±ã„ã¨æ€ã„ã¾ã™ã€‚</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å•é¡Œã®å®šå¼åŒ–</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ODS.aiã‹ã‚‰ã®ã“ã®ã‚ˆã†ãªå„ªã‚ŒãŸDSã‚³ãƒ¼ã‚¹ãŒã‚ã‚Šã€3ç•ªç›®ã®è¬›ç¾©ã€Œ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ†é¡ã€æ±ºå®šæœ¨ã€æœ€è¿‘å‚ã®æ–¹æ³•ã€ãŒã‚ã‚Šã¾ã™</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ãã“ã§ã¯ã€éå¸¸ã«å˜ç´”ã§ãŠãã‚‰ãã¯åˆæˆãƒ‡ãƒ¼ã‚¿ã§ã€æœ€ã‚‚å˜ç´”ãªæ±ºå®šæœ¨ãŒ94.5ï¼…ã®ç²¾åº¦ã‚’ã©ã®ã‚ˆã†ã«ä¸ãˆã‚‹ã‹ãŒç¤ºã•ã‚Œã€kæœ€è¿‘å‚ã®åŒã˜â€‹â€‹éå¸¸ã«å˜ç´”ãªæ–¹æ³•ãŒå‰å‡¦ç†ãªã—ã§89ï¼…ã‚’ä¸ãˆã‚‹</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ‡ãƒ¼ã‚¿ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã¨ãƒ­ãƒ¼ãƒ‰</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">from</span> matplotlib <span class="hljs-keyword">import</span> pyplot <span class="hljs-keyword">as</span> plt<font></font>
%matplotlib inline<font></font>
<span class="hljs-keyword">import</span> warnings<font></font>
warnings.filterwarnings(<span class="hljs-string">'ignore'</span>)<font></font>
<font></font>
df = pd.read_csv(<span class="hljs-string">'data/telecom_churn.csv'</span>)<font></font>
df[<span class="hljs-string">'Voice mail plan'</span>] = pd.factorize(df[<span class="hljs-string">'Voice mail plan'</span>])[<span class="hljs-number">0</span>]<font></font>
df[<span class="hljs-string">'International plan'</span>] = pd.factorize(df[<span class="hljs-string">'International plan'</span>])[<span class="hljs-number">0</span>]<font></font>
df[<span class="hljs-string">'Churn'</span>] = df[<span class="hljs-string">'Churn'</span>].astype(<span class="hljs-string">'int32'</span>)<font></font>
states = df[<span class="hljs-string">'State'</span>]<font></font>
y = df[<span class="hljs-string">'Churn'</span>]<font></font>
df.drop([<span class="hljs-string">'State'</span>,<span class="hljs-string">'Churn'</span>], axis = <span class="hljs-number">1</span>, inplace=<span class="hljs-literal">True</span>)<font></font>
df.head()<font></font>
</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ¨æã¨knnã‚’æ¯”è¼ƒã™ã‚‹</font></font></b><div class="spoiler_text"><pre><code class="python hljs">%%time
<span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split, StratifiedKFold
<span class="hljs-keyword">from</span> sklearn.tree <span class="hljs-keyword">import</span> DecisionTreeClassifier
<span class="hljs-keyword">from</span> sklearn.neighbors <span class="hljs-keyword">import</span> KNeighborsClassifier
<span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> GridSearchCV, cross_val_score
<span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> accuracy_score<font></font>
<font></font>
X_train, X_holdout, y_train, y_holdout = train_test_split(df.values, y, test_size=<span class="hljs-number">0.3</span>,<font></font>
random_state=<span class="hljs-number">17</span>)<font></font>
<font></font>
tree = DecisionTreeClassifier(random_state=<span class="hljs-number">17</span>, max_depth=<span class="hljs-number">5</span>)<font></font>
knn = KNeighborsClassifier(n_neighbors=<span class="hljs-number">10</span>)<font></font>
<font></font>
tree_params = {<span class="hljs-string">'max_depth'</span>: range(<span class="hljs-number">1</span>,<span class="hljs-number">11</span>), <span class="hljs-string">'max_features'</span>: range(<span class="hljs-number">4</span>,<span class="hljs-number">19</span>)}<font></font>
tree_grid = GridSearchCV(tree, tree_params, cv=<span class="hljs-number">10</span>, n_jobs=<span class="hljs-number">-1</span>, verbose=<span class="hljs-literal">False</span>)<font></font>
tree_grid.fit(X_train, y_train)<font></font>
tree_grid.best_params_, tree_grid.best_score_, accuracy_score(y_holdout, tree_grid.predict(X_holdout))<font></font>
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ï¼ˆ{'max_depth'ï¼š6ã€ 'max_features'ï¼š16}ã€0.944706386626661ã€0.945ï¼‰</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">knnã‚‚åŒã˜</font></font></b><div class="spoiler_text"><pre><code class="python hljs">%%time
<span class="hljs-keyword">from</span> sklearn.pipeline <span class="hljs-keyword">import</span> Pipeline
<span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> StandardScaler<font></font>
<font></font>
knn_pipe = Pipeline([(<span class="hljs-string">'scaler'</span>, StandardScaler()), (<span class="hljs-string">'knn'</span>, KNeighborsClassifier(n_jobs=<span class="hljs-number">-1</span>))])<font></font>
knn_params = {<span class="hljs-string">'knn__n_neighbors'</span>: range(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)}<font></font>
knn_grid = GridSearchCV(knn_pipe, knn_params, cv=<span class="hljs-number">10</span>, n_jobs=<span class="hljs-number">-1</span>, verbose=<span class="hljs-literal">False</span>)<font></font>
<font></font>
knn_grid.fit(X_train, y_train)<font></font>
knn_grid.best_params_, knn_grid.best_score_, accuracy_score(y_holdout, knn_grid.predict(X_holdout))<font></font>
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ï¼ˆ{'knn__n_neighbors'ï¼š9}ã€0.8868409772824689ã€0.891ï¼‰</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã®æ™‚ç‚¹ã§ã€ãƒ¡ãƒˆãƒªãƒƒã‚¯ã‚’å‡¦ç†ã§ããªã‹ã£ãŸãŸã‚ã€æ˜ã‚‰ã‹ã«ä¸æ­£ç›´ã§ã‚ã‚‹knnã‚’æ®‹å¿µã«æ€ã„ã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ç§ã¯é ­ã®ä¸­ã§è€ƒãˆã¦ã„ãªã‹ã£ãŸã®ã§ã€ãƒ„ãƒªãƒ¼ã‹ã‚‰feature_importances_ã‚’å–å¾—ã—ã€å…¥åŠ›ã‚’æ­£è¦åŒ–ã—ã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ã—ãŸãŒã£ã¦ã€ãƒ•ã‚£ãƒ¼ãƒãƒ£ãŒé‡è¦ã§ã‚ã‚‹ã»ã©ã€ãƒã‚¤ãƒ³ãƒˆé–“ã®è·é›¢ãŒå¤§ãããªã‚Šã¾ã™ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ©Ÿèƒ½ã®é‡è¦æ€§ã«æ­£è¦åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚£ãƒ¼ãƒ‰ã—ã¾ã™</font></font></b><div class="spoiler_text"><pre><code class="python hljs">%%time<font></font>
feature_importances = pd.DataFrame({<span class="hljs-string">'features'</span>: df.columns, <span class="hljs-string">'importance'</span>:tree_grid.best_estimator_.feature_importances_})<font></font>
print(feature_importances.sort_values(by=[<span class="hljs-string">'importance'</span>], inplace=<span class="hljs-literal">False</span>, ascending=<span class="hljs-literal">False</span>))<font></font>
<font></font>
scaler = StandardScaler().fit(X_train)<font></font>
X_train_transformed = scaler.transform(X_train)<font></font>
X_train_transformed = X_train_transformed * np.array(feature_importances[<span class="hljs-string">'importance'</span>])<font></font>
<font></font>
X_holdout_transformed = scaler.transform(X_holdout)<font></font>
X_holdout_transformed = X_holdout_transformed * np.array(feature_importances[<span class="hljs-string">'importance'</span>])<font></font>
<font></font>
knn_grid = GridSearchCV(KNeighborsClassifier(n_jobs=<span class="hljs-number">-1</span>), {<span class="hljs-string">'n_neighbors'</span>: range(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>, <span class="hljs-number">2</span>)}, cv=<span class="hljs-number">5</span>, n_jobs=<span class="hljs-number">-1</span>, verbose=<span class="hljs-literal">False</span>)<font></font>
knn_grid.fit(X_train_transformed, y_train)<font></font>
<span class="hljs-keyword">print</span> (knn_grid.best_params_, knn_grid.best_score_, accuracy_score(y_holdout, knn_grid.predict(X_holdout_transformed)))
</code></pre></div></div><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1æ—¥ã®åˆè¨ˆåˆ†</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.270386</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ã‚³ãƒ¼ãƒ«</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.147185</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆè¨ˆå‰å¤œ</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.135475</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å›½éš›è¨ˆç”»</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.097249</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç·å›½éš›æ–™é‡‘</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.091671</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å›½éš›é€šè©±ã®åˆè¨ˆ</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">09.090008</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vmailãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ•°</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.050646</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç·ã‚¤ãƒ–æ–™é‡‘</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.038593</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1æ—¥ã®åˆè¨ˆæ–™é‡‘</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.026422</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼“</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒœã‚¤ã‚¹ãƒ¡ãƒ¼ãƒ«ãƒ—ãƒ©ãƒ³</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.017068</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åä¸€</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆè¨ˆå¤œåˆ†</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.014185</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åä¸‰</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç·å®¿æ³Šæ–™é‡‘</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.005742</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç·å¤œé–“é€šè©±</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.005502</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‰å¤œåˆè¨ˆ</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.003614</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç·é€šè©±</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.002246</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆè¨ˆå›½éš›åˆ†</font></font></td>
<td>0.002009</td>
</tr>
<tr>
<td>0</td>
<td>Account length</td>
<td>0.001998</td>
</tr>
<tr>
<td>1</td>
<td>Area code</td>
<td>0.000000</td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
{'n_neighbors'ï¼š5} 0.909129875696528 0.913 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ„ãƒªãƒ¼ã¯knnã¨å°‘ã—ã ã‘çŸ¥è­˜ã‚’å…±æœ‰ã—ã¦ã„ã¦ã€ä»Šã§ã¯91ï¼…ã¨è¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ãŒã€ã“ã‚Œã¯ãƒãƒ‹ãƒ©ãƒ„ãƒªãƒ¼ã®94.5ï¼…ã‹ã‚‰ãã‚Œã»ã©é›¢ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãã—ã¦ã‚¢ã‚¤ãƒ‡ã‚¢ãŒæµ®ã‹ã‚“ã ã€‚ã—ã‹ã—ã€å®Ÿéš›ã«ã¯ã€knnãŒæœ€è‰¯ã®çµæœã‚’ç¤ºã™ã‚ˆã†ã«å…¥åŠ›ã‚’æ­£è¦åŒ–ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã—ã‚‡ã†ã‹ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã¾ãšã€ã“ã‚ŒãŒã©ã‚Œã ã‘ã€Œé¡ã€ã¨è¦‹ãªã•ã‚Œã‚‹ã‹ã‚’é ­ã®ä¸­ã§è¦‹ç©ã‚‚ã‚Šã¾ã™ã€‚æˆ‘ã€…ãŒä½œã‚‹ãã‚Œãã‚Œã®ãŸã‚ã®18ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ã€ä¾‹ãˆã°ã€å¯¾æ•°ç›®ç››ã®å› å­ã®10ã®å¯èƒ½ãªã‚¹ãƒ†ãƒƒãƒ—ã§ã™ã€‚ 10e18ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã™ã€‚ã™ã¹ã¦ã®å¯èƒ½ãªå¥‡æ•°ã®ãƒã‚¤ãƒãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹1ã¤ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯10æœªæº€ã§ã‚ã‚Šã€äº¤å·®æ¤œå®šã‚‚10ã§ã™ã€‚ç´„1.5ç§’ã ã¨æ€ã„ã¾ã™ã€‚ãã‚Œã¯420å„„å¹´ã«ãªã‚Šã¾ã™ã€‚ãŠãã‚‰ãã€å¤œã®è¨ˆç®—ã‚’æ®‹ã™ã¨ã„ã†è€ƒãˆã¯æ”¾æ£„ã•ã‚Œãªã‘ã‚Œã°ãªã‚‰ãªã„ã§ã—ã‚‡ã†ã€‚ :)ãã—ã¦ã€ã“ã®ã‚ãŸã‚Šã®ã©ã“ã‹ã§ã€ã€Œã­ãˆï¼ã ã‹ã‚‰ã€é£›ã¶ãƒã‚¤ã‚¯ã‚’ä½œã‚ã†ï¼ã€</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‹¾é…æ¤œç´¢</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å®Ÿéš›ã€ã“ã®ã‚¿ã‚¹ã‚¯ã§ä½¿ç”¨ã§ãã‚‹æœ€å¤§æ•°ã¯1ã¤ã ã‘ã§ã™ã€‚</font><font style="vertical-align: inherit;">ã¾ã‚ã€ãã‚Œã¯ã‚‚ã¡ã‚ã‚“ã€è‰¯ã„çµæœã®å…¨é ˜åŸŸã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€ãã‚Œã‚‰ã¯ã‹ãªã‚Šä¼¼ã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã—ãŸãŒã£ã¦ã€å‹¾é…ã«æ²¿ã£ã¦æ­©ãã ã‘ã§ã€æœ€é©ãªç‚¹ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">æœ€åˆã®è€ƒãˆã¯éºä¼çš„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’ä¸€èˆ¬åŒ–ã™ã‚‹ã“ã¨ã§ã—ãŸãŒã€ã“ã“ã§ã¯é©å¿œåœ°å½¢ãŒã‚ã¾ã‚Šäº¤å·®ã—ã¦ã„ãªã„ã‚ˆã†ã§ã€ã“ã‚Œã¯å°‘ã—ã‚„ã‚Šéãã§ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‰‹å§‹ã‚ã«æ‰‹å‹•ã§ã‚„ã£ã¦ã¿ã¾ã™ã€‚</font><font style="vertical-align: inherit;">å› å­ã‚’ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã¨ã—ã¦ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹ã«ã¯ã€ã‚¹ã‚±ãƒ¼ãƒ©ãƒ¼ã‚’å‡¦ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">å‰ã®ä¾‹ã§ã¯ã€ãƒ¬ãƒƒã‚¹ãƒ³ã¨åŒã˜ã‚ˆã†ã«ã€StandartScalerã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚ã“ã‚Œã¯ã€å¹³å‡ã§ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚µãƒ³ãƒ—ãƒ«ã‚’ä¸­å¤®ã«é…ç½®ã—ã€sigma = 1ã«ã—ã¾ã—ãŸã€‚ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å†…ã§é©åˆ‡ã«ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã™ã‚‹ã«ã¯ã€ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’å°‘ã—ãƒˆãƒªãƒƒã‚­ãƒ¼ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ç§ã¯sklearn.preprocessingã«ã‚ã‚‹ã‚³ãƒ³ãƒãƒ¼ã‚¿ãƒ¼ã®ä¸­ã‹ã‚‰è‡ªåˆ†ã®ã‚±ãƒ¼ã‚¹ã«é©ã—ãŸã‚‚ã®ã‚’æ¢ã—å§‹ã‚ã¾ã—ãŸãŒã€ä½•ã‚‚è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</font><font style="vertical-align: inherit;">ã—ãŸãŒã£ã¦ã€è¿½åŠ ã®è¦ç´ ã®ãƒãƒ³ãƒ‰ãƒ«ã‚’ãã‚Œã«ã¶ã‚‰ä¸‹ã’ã¦ã€StandartScalerã‹ã‚‰ç¶™æ‰¿ã—ã‚ˆã†ã¨ã—ã¾ã—ãŸã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åç¾©åŒ–ã®ãŸã‚ã®ã‚¯ãƒ©ã‚¹ã¨ã€sklearnãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¨ã‚ãšã‹ã«äº’æ›æ€§ã®ã‚ã‚‹ã‚¹ã‚±ãƒ¼ãƒ«ã«ã‚ˆã‚‹ä¹—ç®—</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">from</span> sklearn.base <span class="hljs-keyword">import</span> TransformerMixin
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StandardAndPoorScaler</span>(<span class="hljs-params">StandardScaler, TransformerMixin</span>):</span>
    <span class="hljs-comment">#normalization = None</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, copy=True, with_mean=True, with_std=True, normalization = None</span>):</span>
        <span class="hljs-comment">#print("new StandardAndPoorScaler(normalization=", normalization.shape if normalization is not None else normalization, ") // ", type(self))</span><font></font>
        self.normalization = normalization<font></font>
        super().__init__(copy, with_mean, with_std)<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fit</span>(<span class="hljs-params">self, X, y=None</span>):</span>
        <span class="hljs-comment">#print(type(self),".fit(",X.shape, ",", y.shape if y is not None else "&lt;null&gt;",")")</span><font></font>
        super().fit(X, y)<font></font>
        <span class="hljs-keyword">return</span> self
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">partial_fit</span>(<span class="hljs-params">self, X, y=None</span>):</span>
        <span class="hljs-comment">#print(type(self),".partial_fit(",X.shape, ",", y.shape if y is not None else "&lt;null&gt;)")</span><font></font>
        super().partial_fit(X, y)<font></font>
        <span class="hljs-keyword">if</span> self.normalization <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<font></font>
            self.normalization = np.ones((X.shape[<span class="hljs-number">1</span>]))
        <span class="hljs-keyword">elif</span> type(self.normalization) != np.ndarray:<font></font>
            self.normalization = np.array(self.normalization)<font></font>
        <span class="hljs-keyword">if</span> X.shape[<span class="hljs-number">1</span>] != self.normalization.shape[<span class="hljs-number">0</span>]:
            <span class="hljs-keyword">raise</span> <span class="hljs-string">"X.shape[1]="</span>+X.shape[<span class="hljs-number">1</span>]+<span class="hljs-string">" in equal self.scale.shape[0]="</span>+self.normalization.shape[<span class="hljs-number">0</span>]
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">transform</span>(<span class="hljs-params">self, X, copy=None</span>):</span>
        <span class="hljs-comment">#print(type(self),".transform(",X.shape,",",copy,").self.normalization", self.normalization)</span><font></font>
        Xresult = super().transform(X, copy)<font></font>
        Xresult *= self.normalization<font></font>
        <span class="hljs-keyword">return</span> Xresult
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_reset</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment">#print(type(self),"._reset()")</span><font></font>
        super()._reset()<font></font>
    <font></font>
scaler = StandardAndPoorScaler(normalization = feature_importances[<span class="hljs-string">'importance'</span>])<font></font>
scaler.fit(X = X_train, y = <span class="hljs-literal">None</span>)<font></font>
print(scaler.normalization)<font></font>
</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã®ã‚¯ãƒ©ã‚¹ã‚’é©ç”¨ã—ã‚ˆã†ã¨ã—ã¦ã„ã¾ã™</font></font></b><div class="spoiler_text"><pre><code class="python hljs">%%time<font></font>
knn_pipe = Pipeline([(<span class="hljs-string">'scaler'</span>, StandardAndPoorScaler()), (<span class="hljs-string">'knn'</span>, KNeighborsClassifier(n_jobs=<span class="hljs-number">-1</span>))])<font></font>
<font></font>
knn_params = {<span class="hljs-string">'knn__n_neighbors'</span>: range(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>, <span class="hljs-number">4</span>), <span class="hljs-string">'scaler__normalization'</span>: [feature_importances[<span class="hljs-string">'importance'</span>]]}<font></font>
knn_grid = GridSearchCV(knn_pipe, knn_params, cv=<span class="hljs-number">5</span>, n_jobs=<span class="hljs-number">-1</span>, verbose=<span class="hljs-literal">False</span>)<font></font>
<font></font>
knn_grid.fit(X_train, y_train)<font></font>
knn_grid.best_params_, knn_grid.best_score_, accuracy_score(y_holdout, knn_grid.predict(X_holdout))<font></font>
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ï¼ˆ{'knn__n_neighbors'ï¼š5ã€ 'scaler__normalization'ï¼šNameï¼šé‡è¦åº¦ã€dtypeï¼šfloat64}ã€0.909558508358337ã€0.913ï¼‰</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
çµæœã¯ç§ã®æœŸå¾…ã¨ã¯å°‘ã—ç•°ãªã‚Šã¾ã™ã€‚ã¾ã‚ã€ãã‚Œã¯åŸå‰‡ã¨ã—ã¦ã€ã™ã¹ã¦ãŒæ©Ÿèƒ½ã—ã¾ã™ã€‚ã“ã‚Œã‚’ç†è§£ã™ã‚‹ãŸã‚ã«ã€ç§ã¯ã™ã¹ã¦ã®æ ¹æ€§ã‚’å‚™ãˆãŸã“ã®ã‚¯ãƒ©ã‚¹ã‚’3æ™‚é–“ã§ã‚¼ãƒ­ã‹ã‚‰å†ç¾ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€ãã‚Œã‹ã‚‰åˆã‚ã¦ã€sklearnãŒä½•ã‚‰ã‹ã®æ–¹æ³•ã§é–“é•ã£ã¦ä½œæˆã•ã‚ŒãŸãŸã‚ã§ã¯ãªãã€GridSearchCVãŒãƒ¡ã‚¤ãƒ³ã‚¹ãƒˆãƒªãƒ¼ãƒ ã«ã‚¯ãƒ­ãƒ¼ãƒ³ã‚’ä½œæˆã™ã‚‹ãŸã‚ã€å°åˆ·ãŒå°åˆ·ã•ã‚Œãªã„ã“ã¨ã«æ°—ä»˜ãã¾ã—ãŸã§ã™ãŒã€ä»–ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã§æ§‹æˆã—ã¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã—ã¾ã™ã€‚ãã—ã¦ã€ä»–ã®ã‚¹ãƒˆãƒªãƒ¼ãƒ ã§å°åˆ·ã—ãŸã‚‚ã®ã¯ã™ã¹ã¦å¿˜ã‚Œå»ã‚‰ã‚Œã¾ã™ã€‚ã—ã‹ã—ã€n_jobs = 1ã‚’æŒ‡å®šã™ã‚‹ã¨ã€ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã•ã‚ŒãŸé–¢æ•°ã¸ã®ã™ã¹ã¦ã®å‘¼ã³å‡ºã—ãŒã‹ã‚ã„ã„ã‚‚ã®ã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚çŸ¥è­˜ã¯éå¸¸ã«é«˜ä¾¡ã«ãªã‚Šã¾ã—ãŸãŒã€ä»Šã§ã¯ãã‚Œã‚‚æ‰‹ã«å…¥ã‚Šã€é€€å±ˆãªè¨˜äº‹ã‚’èª­ã‚“ã§ãŠé‡‘ã‚’æ”¯æ‰•ã„ã¾ã—ãŸã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã•ã¦ã€å…ˆã«é€²ã¿ã¾ã—ã‚‡ã†ã€‚</font><font style="vertical-align: inherit;">ã“ã“ã§ã€å„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã«ã„ãã¤ã‹ã®åˆ†æ•£ã‚’ä¸ãˆã€ãã‚Œã‹ã‚‰ã€æœ€è‰¯ã®å€¤ã®å‘¨ã‚Šã§å°‘ã—å°‘ãªãã—ã¦ã€ç¾å®Ÿã¨åŒæ§˜ã®çµæœãŒå¾—ã‚‰ã‚Œã‚‹ã¾ã§ç¶šã‘ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã‚Œã¯ã€æœ€çµ‚çš„ã«ç§ã®å¤¢ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’å–å¾—ã™ã‚‹ãŸã‚ã®æœ€åˆã®å¤±ç¤¼ãªãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã«ãªã‚Šã¾ã™ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã„ãã¤ã‹ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒç•°ãªã‚‹ã€é‡ã¿ä»˜ã‘ã®ã„ãã¤ã‹ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’å½¢æˆã—ã¾ã™</font></font></b><div class="spoiler_text"><pre><code class="python hljs">feature_base = feature_importances[<span class="hljs-string">'importance'</span>]<font></font>
searchArea = np.array([feature_base - <span class="hljs-number">.05</span>, feature_base, feature_base + <span class="hljs-number">.05</span>])<font></font>
searchArea[searchArea &lt; <span class="hljs-number">0</span>] = <span class="hljs-number">0</span>
searchArea[searchArea &gt; <span class="hljs-number">1</span>] = <span class="hljs-number">1</span>
print(searchArea[<span class="hljs-number">2</span>,:] - searchArea[<span class="hljs-number">0</span>,:])<font></font>
<font></font>
<span class="hljs-keyword">import</span> itertools<font></font>
<font></font>
affected_props = [<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>]<font></font>
parametrs_ranges = np.concatenate([<font></font>
    np.linspace(searchArea[<span class="hljs-number">0</span>,affected_props], searchArea[<span class="hljs-number">1</span>,affected_props], <span class="hljs-number">2</span>, endpoint=<span class="hljs-literal">False</span>),<font></font>
    np.linspace(searchArea[<span class="hljs-number">1</span>,affected_props], searchArea[<span class="hljs-number">2</span>,affected_props], <span class="hljs-number">3</span>, endpoint=<span class="hljs-literal">True</span>)]).transpose()<font></font>
<font></font>
print(parametrs_ranges) <span class="hljs-comment">#      .  125 </span>
recombinations = itertools.product(parametrs_ranges[<span class="hljs-number">0</span>],parametrs_ranges[<span class="hljs-number">1</span>],parametrs_ranges[<span class="hljs-number">1</span>])<font></font>
<font></font>
variances = []<font></font>
<span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> recombinations: <span class="hljs-comment">#          ,       Python .</span><font></font>
    varince = feature_base.copy()<font></font>
    varince[affected_props] = item<font></font>
    variances.append(varince)<font></font>
print(variances[<span class="hljs-number">0</span>])<font></font>
print(len(variances))<font></font>
<span class="hljs-comment">#  knn   ,               .</span>
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã•ã¦ã€æœ€åˆã®å®Ÿé¨“ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã¯æº–å‚™ãŒã§ãã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">æ¬¡ã«ã€çµæœã®15ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’å¾¹åº•çš„ã«æ¤œç´¢ã™ã‚‹ã“ã¨ã‹ã‚‰å§‹ã‚ã¦ã€ãƒ‡ãƒ¼ã‚¿ã‚’å®Ÿé¨“ã—ã¦ã¿ã¾ã™ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¨˜äº‹ã®ã‚ˆã†ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®è©¦é¨“çš„ãªé¸æŠã‚’è¡Œã„ã¾ã™</font></font></b><div class="spoiler_text"><pre><code class="python hljs">%%time
<span class="hljs-comment">#scale = np.ones([18])</span>
knn_pipe = Pipeline([(<span class="hljs-string">'scaler'</span>, StandardAndPoorScaler()), (<span class="hljs-string">'knn'</span>, KNeighborsClassifier(n_neighbors = <span class="hljs-number">7</span> , n_jobs=<span class="hljs-number">-1</span>))])<font></font>
<font></font>
knn_params = {<span class="hljs-string">'scaler__normalization'</span>: variances} <span class="hljs-comment"># 'knn__n_neighbors': range(3, 9, 2), </span>
knn_grid = GridSearchCV(knn_pipe, knn_params, cv=<span class="hljs-number">10</span>, n_jobs=<span class="hljs-number">-1</span>, verbose=<span class="hljs-literal">False</span>)<font></font>
<font></font>
knn_grid.fit(X_train, y_train)<font></font>
knn_grid.best_params_, knn_grid.best_score_, accuracy_score(y_holdout, knn_grid.predict(X_holdout))</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã¾ã‚ã€ã™ã¹ã¦ãŒæ‚ªã„ã§ã™ã€æ™‚é–“ã¯çªç ´ã«è²»ã‚„ã•ã‚Œã¾ã—ãŸã€ãã—ã¦çµæœã¯éå¸¸ã«ä¸å®‰å®šã§ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã‚Œã¯ã€X_holdoutãƒã‚§ãƒƒã‚¯ã‹ã‚‰ã‚‚è¦‹ã‚‰ã‚Œã€çµæœã¯ã€å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã«å°ã•ãªå¤‰æ›´ã‚’åŠ ãˆãŸä¸‡è¯é¡ã®ã‚ˆã†ã«è¸Šã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">åˆ¥ã®æ–¹æ³•ã‚’è©¦ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ä¸€åº¦ã«1ã¤ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã®ã¿ã‚’å¤‰æ›´ã—ã¾ã™ãŒã€ã¯ã‚‹ã‹ã«å¤§ããªé›¢æ•£åŒ–ã‚’è¡Œã„ã¾ã™ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4ç•ªç›®ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’1ã¤å¤‰æ›´ã—ã¾ã™</font></font></b><div class="spoiler_text"><pre><code class="python hljs">%%time<font></font>
affected_property = <span class="hljs-number">4</span><font></font>
parametrs_range = np.concatenate([<font></font>
    np.linspace(searchArea[<span class="hljs-number">0</span>,affected_property], searchArea[<span class="hljs-number">1</span>,affected_property], <span class="hljs-number">29</span>, endpoint=<span class="hljs-literal">False</span>),<font></font>
    np.linspace(searchArea[<span class="hljs-number">1</span>,affected_property], searchArea[<span class="hljs-number">2</span>,affected_property], <span class="hljs-number">30</span>, endpoint=<span class="hljs-literal">True</span>)]).transpose()<font></font>
<font></font>
print(searchArea[<span class="hljs-number">1</span>,affected_property])<font></font>
print(parametrs_range) <span class="hljs-comment"># C   ,  .</span><font></font>
<font></font>
<font></font>
variances = []<font></font>
<span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> parametrs_range: <span class="hljs-comment">#          ,       Python .</span><font></font>
    varince = feature_base.copy()<font></font>
    varince[affected_property] = item<font></font>
    variances.append(varince)<font></font>
print(variances[<span class="hljs-number">0</span>])<font></font>
print(len(variances))<font></font>
<span class="hljs-comment">#  knn   ,               .</span><font></font>
<font></font>
knn_pipe = Pipeline([(<span class="hljs-string">'scaler'</span>, StandardAndPoorScaler()), (<span class="hljs-string">'knn'</span>, KNeighborsClassifier(n_neighbors = <span class="hljs-number">7</span> , n_jobs=<span class="hljs-number">-1</span>))])<font></font>
<font></font>
knn_params = {<span class="hljs-string">'scaler__normalization'</span>: variances} <span class="hljs-comment"># 'knn__n_neighbors': range(3, 9, 2), </span>
knn_grid = GridSearchCV(knn_pipe, knn_params, cv=<span class="hljs-number">10</span>, n_jobs=<span class="hljs-number">-1</span>, verbose=<span class="hljs-literal">False</span>)<font></font>
<font></font>
knn_grid.fit(X_train, y_train)<font></font>
knn_grid.best_params_, knn_grid.best_score_, accuracy_score(y_holdout, knn_grid.predict(X_holdout))</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ï¼ˆ{'scaler__normalization'ï¼š4 0.079957åå‰ï¼šé‡è¦åº¦ã€dtypeï¼šfloat64}ã€0.9099871410201458ã€0.913ï¼‰</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã•ã¦ã€ã‚¬ãƒãƒ§ã‚¦ã«ã¯ä½•ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ</font><font style="vertical-align: inherit;">ç›¸äº’æ¤œè¨¼ã§10åˆ†ã®1ã€œ2ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆã®ã‚·ãƒ•ãƒˆã€ãŠã‚ˆã³åˆ¥ã®influenced_propertyã‚’è¦‹ã‚‹ã¨X_holdoutã§0.5ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆã®ã‚¸ãƒ£ãƒ³ãƒ—ã€‚</font><font style="vertical-align: inherit;">æ˜ã‚‰ã‹ã«ã€ãƒ„ãƒªãƒ¼ãŒç§ãŸã¡ã«ãã®ã‚ˆã†ãªãƒ‡ãƒ¼ã‚¿ã«ã¤ã„ã¦ä¸å¯èƒ½ã§ã‚ã‚‹ã¨ã„ã†äº‹å®Ÿã‹ã‚‰å§‹ã‚ã‚‹ãªã‚‰ã°ã€çŠ¶æ³ã‚’æ”¹å–„ã™ã‚‹ã“ã¨ã¯ä¸å¯æ¬ ã§å®‰ä¾¡ã§ã™ã€‚</font><font style="vertical-align: inherit;">ã—ã‹ã—ã€æœ€åˆã®æ—¢çŸ¥ã®é‡ã¿ã®åˆ†å¸ƒãŒãªãã€å°ã•ãªã‚¹ãƒ†ãƒƒãƒ—ã§ã‚µã‚¤ã‚¯ãƒ«ã®ä»»æ„ã®ãƒã‚¤ãƒ³ãƒˆã§åŒã˜ã“ã¨ã‚’ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ç§ãŸã¡ãŒã“ã‚Œã‹ã‚‰ä½•ã‚’ã™ã‚‹ã‹ã¯éå¸¸ã«èˆˆå‘³æ·±ã„ã§ã™ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆæœŸå……å¡«</font></font></b><div class="spoiler_text"><pre><code class="python hljs">searchArea = np.array([np.zeros((<span class="hljs-number">18</span>,)), np.ones((<span class="hljs-number">18</span>,)) /<span class="hljs-number">18</span>, np.ones((<span class="hljs-number">18</span>,))])<font></font>
print(searchArea[:,<span class="hljs-number">0</span>])<font></font>
<font></font>
history_parametrs = [searchArea[<span class="hljs-number">1</span>,:].copy()]<font></font>
scaler = StandardAndPoorScaler(normalization=searchArea[<span class="hljs-number">1</span>,:])<font></font>
scaler.fit(X_train)<font></font>
knn = KNeighborsClassifier(n_neighbors = <span class="hljs-number">7</span> , n_jobs=<span class="hljs-number">-1</span>)<font></font>
knn.fit(scaler.transform(X_train), y_train)<font></font>
history_holdout_score = [accuracy_score(y_holdout, knn.predict(scaler.transform(X_holdout)))]</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1ã¤ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’ã‚ãšã‹ã«å¤‰æ›´ã™ã‚‹é–¢æ•°ï¼ˆãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ä»˜ãï¼‰</font></font></b><div class="spoiler_text"><pre><code class="python hljs">%%time
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">changePropertyNormalization</span>(<span class="hljs-params">affected_property, points_count = <span class="hljs-number">15</span></span>):</span><font></font>
    test_range = np.concatenate([<font></font>
        np.linspace(searchArea[<span class="hljs-number">0</span>,affected_property], searchArea[<span class="hljs-number">1</span>,affected_property], points_count//<span class="hljs-number">2</span>, endpoint=<span class="hljs-literal">False</span>),<font></font>
        np.linspace(searchArea[<span class="hljs-number">1</span>,affected_property], searchArea[<span class="hljs-number">2</span>,affected_property], points_count//<span class="hljs-number">2</span> + <span class="hljs-number">1</span>, endpoint=<span class="hljs-literal">True</span>)]).transpose()<font></font>
    variances = [searchArea[<span class="hljs-number">1</span>,:].copy() <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(test_range.shape[<span class="hljs-number">0</span>])]
    <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> range(len(variances)):<font></font>
        variances[row][affected_property] = test_range[row]<font></font>
    <font></font>
    knn_pipe = Pipeline([(<span class="hljs-string">'scaler'</span>, StandardAndPoorScaler()), (<span class="hljs-string">'knn'</span>, KNeighborsClassifier(n_neighbors = <span class="hljs-number">7</span> , n_jobs=<span class="hljs-number">-1</span>))])<font></font>
    knn_params = {<span class="hljs-string">'scaler__normalization'</span>: variances} <span class="hljs-comment"># 'knn__n_neighbors': range(3, 9, 2), </span>
    knn_grid = GridSearchCV(knn_pipe, knn_params, cv=<span class="hljs-number">10</span>, n_jobs=<span class="hljs-number">-1</span>, verbose=<span class="hljs-literal">False</span>)<font></font>
<font></font>
    knn_grid.fit(X_train, y_train)<font></font>
    holdout_score = accuracy_score(y_holdout, knn_grid.predict(X_holdout))<font></font>
    best_param = knn_grid.best_params_[<span class="hljs-string">'scaler__normalization'</span>][affected_property]<font></font>
    print(affected_property,<font></font>
          <span class="hljs-string">'property:'</span>, searchArea[<span class="hljs-number">1</span>, affected_property], <span class="hljs-string">"=&gt;"</span>, best_param,
          <span class="hljs-string">'holdout:'</span>, history_holdout_score[<span class="hljs-number">-1</span>], <span class="hljs-string">"=&gt;"</span>, holdout_score, <span class="hljs-string">'('</span>, knn_grid.best_score_, <span class="hljs-string">')'</span>)
    <span class="hljs-comment">#             .</span><font></font>
    before = searchArea[:, affected_property]<font></font>
    propertySearchArea = searchArea[:, affected_property].copy()<font></font>
    <span class="hljs-keyword">if</span> best_param == propertySearchArea[<span class="hljs-number">0</span>]:<font></font>
        print(<span class="hljs-string">'|&lt;&lt;'</span>)<font></font>
        searchArea[<span class="hljs-number">0</span>, affected_property] = best_param/<span class="hljs-number">2</span> <span class="hljs-keyword">if</span> best_param &gt; <span class="hljs-number">0.01</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>
        searchArea[<span class="hljs-number">2</span>, affected_property] = (best_param + searchArea[<span class="hljs-number">2</span>, affected_property])/<span class="hljs-number">2</span>
        searchArea[<span class="hljs-number">1</span>, affected_property] = best_param
    <span class="hljs-keyword">elif</span> best_param == propertySearchArea[<span class="hljs-number">2</span>]:<font></font>
        print(<span class="hljs-string">'&gt;&gt;|'</span>)<font></font>
        searchArea[<span class="hljs-number">2</span>, affected_property] = (best_param + <span class="hljs-number">1</span>)/<span class="hljs-number">2</span> <span class="hljs-keyword">if</span> best_param &lt; <span class="hljs-number">0.99</span> <span class="hljs-keyword">else</span> <span class="hljs-number">1</span>
        searchArea[<span class="hljs-number">0</span>, affected_property] = (best_param + searchArea[<span class="hljs-number">0</span>, affected_property])/<span class="hljs-number">2</span>
        searchArea[<span class="hljs-number">1</span>, affected_property] = best_param
    <span class="hljs-keyword">elif</span> best_param &lt; (propertySearchArea[<span class="hljs-number">0</span>] + propertySearchArea[<span class="hljs-number">1</span>])/<span class="hljs-number">2</span>:<font></font>
        print(<span class="hljs-string">'&lt;&lt;'</span>)<font></font>
        searchArea[<span class="hljs-number">0</span>, affected_property] = max(propertySearchArea[<span class="hljs-number">0</span>]*<span class="hljs-number">1.1</span> - <span class="hljs-number">.1</span>*propertySearchArea[<span class="hljs-number">1</span>], <span class="hljs-number">0</span>)<font></font>
        searchArea[<span class="hljs-number">2</span>, affected_property] = (best_param + propertySearchArea[<span class="hljs-number">2</span>])/<span class="hljs-number">2</span>
        searchArea[<span class="hljs-number">1</span>, affected_property] = best_param
    <span class="hljs-keyword">elif</span> best_param &gt; (propertySearchArea[<span class="hljs-number">1</span>] + propertySearchArea[<span class="hljs-number">2</span>])/<span class="hljs-number">2</span>:<font></font>
        print(<span class="hljs-string">'&gt;&gt;'</span>)<font></font>
        searchArea[<span class="hljs-number">0</span>, affected_property] = (best_param + propertySearchArea[<span class="hljs-number">0</span>])/<span class="hljs-number">2</span>
        searchArea[<span class="hljs-number">2</span>, affected_property] = min(propertySearchArea[<span class="hljs-number">2</span>]*<span class="hljs-number">1.1</span> - <span class="hljs-number">.1</span>*propertySearchArea[<span class="hljs-number">1</span>], <span class="hljs-number">1</span>)<font></font>
        searchArea[<span class="hljs-number">1</span>, affected_property] = best_param
    <span class="hljs-keyword">elif</span> best_param &lt; propertySearchArea[<span class="hljs-number">1</span>]:<font></font>
        print(<span class="hljs-string">'&lt;'</span>)<font></font>
        searchArea[<span class="hljs-number">2</span>, affected_property] = searchArea[<span class="hljs-number">1</span>, affected_property]*<span class="hljs-number">.25</span> + <span class="hljs-number">.75</span>*searchArea[<span class="hljs-number">2</span>, affected_property]<font></font>
        searchArea[<span class="hljs-number">1</span>, affected_property] = best_param
    <span class="hljs-keyword">elif</span> best_param &gt; propertySearchArea[<span class="hljs-number">1</span>]:<font></font>
        print(<span class="hljs-string">'&gt;'</span>)<font></font>
        searchArea[<span class="hljs-number">0</span>, affected_property] = searchArea[<span class="hljs-number">1</span>, affected_property]*<span class="hljs-number">.25</span> + <span class="hljs-number">.75</span>*searchArea[<span class="hljs-number">0</span>, affected_property]<font></font>
        searchArea[<span class="hljs-number">1</span>, affected_property] = best_param
    <span class="hljs-keyword">else</span>:<font></font>
        print(<span class="hljs-string">'='</span>)<font></font>
        searchArea[<span class="hljs-number">0</span>, affected_property] = searchArea[<span class="hljs-number">1</span>, affected_property]*<span class="hljs-number">.25</span> + <span class="hljs-number">.75</span>*searchArea[<span class="hljs-number">0</span>, affected_property]<font></font>
        searchArea[<span class="hljs-number">2</span>, affected_property] = searchArea[<span class="hljs-number">1</span>, affected_property]*<span class="hljs-number">.25</span> + <span class="hljs-number">.75</span>*searchArea[<span class="hljs-number">2</span>, affected_property]<font></font>
    normalization = searchArea[<span class="hljs-number">1</span>,:].sum() <span class="hljs-comment">#,      .</span><font></font>
    searchArea[:,:] /= normalization<font></font>
    print(before, <span class="hljs-string">"=&gt;"</span>,searchArea[:, affected_property])<font></font>
    history_parametrs.append(searchArea[<span class="hljs-number">1</span>,:].copy())<font></font>
    history_holdout_score.append(holdout_score)<font></font>
    <font></font>
changePropertyNormalization(<span class="hljs-number">1</span>, <span class="hljs-number">9</span>)<font></font>
changePropertyNormalization(<span class="hljs-number">1</span>, <span class="hljs-number">9</span>)
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç§ã¯ä½•ã‚‚æœ€é©åŒ–ã›ãšã€ãã®çµæœã€æ¬¡ã®æ±ºå®šçš„ãªã‚¹ãƒ†ãƒƒãƒ—ã‚’ã»ã¼30åˆ†ç¶šã‘ã¾ã—ãŸã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éš ã—ãƒ†ã‚­ã‚¹ãƒˆ</font></font></b><div class="spoiler_text">       40 .<pre><code class="python hljs">%%time
<span class="hljs-comment">#   </span>
searchArea = np.array([np.zeros((<span class="hljs-number">18</span>,)), np.ones((<span class="hljs-number">18</span>,)) /<span class="hljs-number">18</span>, np.ones((<span class="hljs-number">18</span>,))])<font></font>
print(searchArea[:,<span class="hljs-number">0</span>])<font></font>
<font></font>
history_parametrs = [searchArea[<span class="hljs-number">1</span>,:].copy()]<font></font>
scaler = StandardAndPoorScaler(normalization=searchArea[<span class="hljs-number">1</span>,:])<font></font>
scaler.fit(X_train)<font></font>
knn = KNeighborsClassifier(n_neighbors = <span class="hljs-number">7</span> , n_jobs=<span class="hljs-number">-1</span>)<font></font>
knn.fit(scaler.transform(X_train), y_train)<font></font>
history_holdout_score = [accuracy_score(y_holdout, knn.predict(scaler.transform(X_holdout)))]<font></font>
<font></font>
<span class="hljs-keyword">for</span> tick <span class="hljs-keyword">in</span> range(<span class="hljs-number">40</span>):
    <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> range(searchArea.shape[<span class="hljs-number">1</span>]):<font></font>
        changePropertyNormalization(p, <span class="hljs-number">7</span>)<font></font>
    <font></font>
print(searchArea[<span class="hljs-number">1</span>,:])<font></font>
print(history_holdout_score)</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
knnã®çµæœã®ç²¾åº¦ï¼š91.9ï¼…ãƒ„ãƒªãƒ¼ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å¼•ãè£‚ãã¨ãã‚ˆã‚Šã‚‚å„ªã‚Œã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãã—ã¦ã€å…ƒã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚ˆã‚Šã‚‚ã¯ã‚‹ã‹ã«å„ªã‚Œã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ‡ã‚£ã‚·ã‚¸ãƒ§ãƒ³ãƒ„ãƒªãƒ¼ã«å¾“ã£ã¦ã€æ©Ÿèƒ½ã®é‡è¦æ€§ã¨æ¯”è¼ƒã—ã¾ã™ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">knnã«ã‚ˆã‚‹æ©Ÿèƒ½ã®é‡è¦æ€§ã®è¦–è¦šåŒ–</font></font></b><div class="spoiler_text"><pre><code class="python hljs">feature_importances[<span class="hljs-string">'knn_importance'</span>] = history_parametrs[<span class="hljs-number">-1</span>]<font></font>
diagramma = feature_importances.copy()<font></font>
indexes = diagramma.index<font></font>
diagramma.index = diagramma[<span class="hljs-string">'features'</span>]<font></font>
diagramma.drop(<span class="hljs-string">'features'</span>, <span class="hljs-number">1</span>, inplace = <span class="hljs-literal">True</span>)<font></font>
diagramma.plot(kind=<span class="hljs-string">'bar'</span>);<font></font>
plt.savefig(<span class="hljs-string">"images/pic1.png"</span>, format = <span class="hljs-string">'png'</span>)<font></font>
plt.show()<font></font>
feature_importances</code></pre></div></div><br>
<img src="https://habrastorage.org/webt/kk/pe/nf/kkpenftrnyfl6dpu4p1qh2dnwqq.gif"><br>
<br>
<img src="https://habrastorage.org/webt/ui/o2/rp/uio2rplq9j2p5cxppq7jb7h_mpk.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚ã‚‹ã‚ˆã†ã«è¦‹ãˆã‚‹ï¼Ÿ</font><font style="vertical-align: inherit;">ã¯ã„ã€ãã†ã§ã™ã€‚</font><font style="vertical-align: inherit;">ã—ã‹ã—ã€ã¾ã£ãŸãåŒã˜ã¨ã„ã†ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</font><font style="vertical-align: inherit;">èˆˆå‘³æ·±ã„è¦³å¯Ÿã€‚</font><font style="vertical-align: inherit;">ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã«ã¯ã€ã€Œåˆè¨ˆå¤œé–“åˆ†ã€ã‚„ã€Œåˆè¨ˆå¤œé–“æ–™é‡‘ã€ãªã©ã€äº’ã„ã«å®Œå…¨ã«é‡è¤‡ã™ã‚‹ã„ãã¤ã‹ã®æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã—ãŸãŒã£ã¦ã€æ³¨æ„ã‚’æ‰•ã£ã¦ãã ã•ã„ã€‚knnè‡ªä½“ã¯ã€ãã®ã‚ˆã†ãªç¹°ã‚Šè¿”ã•ã‚Œã‚‹æ©Ÿèƒ½ã®é‡è¦ãªéƒ¨åˆ†ã‚’è¦‹ã¤ã‘å‡ºã—ã¾ã—ãŸã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çµæœã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã™ã€‚ãã‚Œä»¥å¤–ã®å ´åˆã¯ã€ä»•äº‹ã«æˆ»ã‚‹ã®ãŒã‚„ã‚„ä¸ä¾¿ã§ã™...ã€‚</font></font></b><div class="spoiler_text"><pre><code class="python hljs">parametrs_df = pd.DataFrame(history_parametrs)<font></font>
parametrs_df[<span class="hljs-string">'scores'</span>] = history_holdout_score<font></font>
parametrs_df.index.name = <span class="hljs-string">'index'</span>
parametrs_df.to_csv(<span class="hljs-string">'parametrs_and_scores.csv'</span>)
</code></pre></div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èª¿æŸ»çµæœ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã¾ã‚ã€çµæœ.919è‡ªä½“ã¯knnã«ã¨ã£ã¦æ‚ªã„ã“ã¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãƒãƒ‹ãƒ©ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚ˆã‚Šã‚‚ã‚¨ãƒ©ãƒ¼ãŒ1.5å€å°‘ãªãã€feature_importanceãƒ„ãƒªãƒ¼ã‚’å®Ÿè¡Œã—ãŸã¨ãã‚ˆã‚Šã‚‚7ï¼…å°‘ãªããªã£ã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã—ã‹ã—ã€æœ€ã‚‚èˆˆå‘³æ·±ã„ã®ã¯ã€knnè‡ªä½“ã«å¿œã˜ãŸfeature_importanceãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã§ã™ã€‚</font><font style="vertical-align: inherit;">ãã‚Œã¯æœ¨ãŒç§ãŸã¡ã«è¨€ã£ãŸã“ã¨ã¨ã¯å°‘ã—ç•°ãªã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãŸã¨ãˆã°ã€treeã¨knnã¯ã€ã©ã®æ¨™è­˜ãŒç§ãŸã¡ã«ã¨ã£ã¦ã¾ã£ãŸãé‡è¦ã§ã¯ãªã„ã‹ã«ã¤ã„ã¦ç•°ãªã‚‹æ„è¦‹ã‚’æŒã£ã¦ã„ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã•ã¦ã€æœ€å¾Œã«ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pythonã«é–¢ã™ã‚‹ç°¡å˜ãªè³ªå•ã«ç­”ãˆã‚‹ãŸã‚ã«ã€</font><font style="vertical-align: inherit;">mlcourse.ai </font><font style="vertical-align: inherit;">odsã¨Googleã®</font><font style="vertical-align: inherit;">3ã¤ã®è¬›ç¾©ã®çŸ¥è­˜ã‚’æŒã£ã¦ã„ã‚‹ãŸã‚ã€æ¯”è¼ƒçš„æ–°ã—ãã¦çã—ã„ã‚‚ã®ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ãŸ</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç§ã®æ„è¦‹ã§ã¯ã€æ‚ªããªã„ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¹ãƒ©ã‚¤ãƒ‰ã—ã¾ã™</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®ä½œæ¥­ã®å‰¯ç”£ç‰©ã¯ã€ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãŒé€²ã‚“ã çµŒè·¯ã§ã™ã€‚ãŸã ã—ã€çµŒè·¯ã¯18æ¬¡å…ƒã§ã‚ã‚Šã€ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãŒãã“ã§è¡Œã£ã¦ã„ã‚‹ã“ã¨ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è¿½è·¡ã™ã‚‹ãŸã‚ã«å½¼ã®æ„è­˜ã‚’å°‘ã—å¦¨ã’ã¾ã™ã€‚ã‚´ãƒŸã®å­¦ç¿’ã‚„ä½¿ç”¨ã¯ãã‚Œã»ã©ä¾¿åˆ©ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã‚¨ãƒ©ãƒ¼ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ã‚ˆã‚Œã°ã€ã“ã‚Œã¯å®Ÿéš›ã«ã¯å¸¸ã«è¦‹ãˆã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã‚¨ãƒ©ãƒ¼ã¯é•·ã„é–“é¡•è‘—ã«å¤‰åŒ–ã—ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ãŒã€ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯éå¸¸ã«ãƒ“ã‚¸ãƒ¼ã§ã‚ã‚Šã€ã‚¢ãƒ€ãƒ—ãƒ†ã‚£ãƒ–ã‚¹ãƒšãƒ¼ã‚¹ã®é•·ãã¦ç‹­ã„è°·ã‚’ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ã¾ãšæœ€åˆã«ã€æœ€åˆã®æœ€ã‚‚å˜ç´”ã ãŒéå¸¸ã«æœ‰ç›Šãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’ä½¿ç”¨ã—ã¾ã™ã€‚18æ¬¡å…ƒç©ºé–“ã‚’2æ¬¡å…ƒç©ºé–“ã«ãƒ©ãƒ³ãƒ€ãƒ ã«æŠ•å½±ã—ã€ã™ã¹ã¦ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã®å¯„ä¸ãŒã€ãã®é‡è¦æ€§ã«é–¢ä¿‚ãªãå˜ä¸€ã«ãªã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚å®Ÿéš›ã«ã¯ã€18æ¬¡å…ƒã®ãƒ‘ã‚¹ã¯ã€ç§ãŸã¡ã®è¨˜äº‹ã§ã¯ã€éå¸¸ã«å°ã•ã„</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦—ãä»¥ä¸Šã®ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ä¾‹å¤–</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç§ã¯åŒæ§˜ã«ã€ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒæŒã£ã¦ã„ãŸã™ã¹ã¦ã®ã‚·ãƒŠãƒ—ã‚¹ã®é±—ã®ç©ºé–“ã«æ„Ÿå¿ƒã—ã€ãã‚Œã¯ç´ æ™´ã‚‰ã—ãã¦æœ‰ç›Šã§ã—ãŸã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚¹ãƒ†ãƒ¼ã‚¸è‡ªä½“ã‚’é€šéã—ã¦ã€ä»•äº‹ã«æˆ»ã£ãŸå ´åˆã€ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å–ã‚Šã¾ã™</font></font></b><div class="spoiler_text"><pre><code class="python hljs">parametrs_df = pd.read_csv(<span class="hljs-string">'parametrs_and_scores.csv'</span>, index_col = <span class="hljs-string">'index'</span>)<font></font>
history_holdout_score = np.array(parametrs_df[<span class="hljs-string">'scores'</span>])<font></font>
parametrs_df.drop(<span class="hljs-string">'scores'</span>,axis=<span class="hljs-number">1</span>)<font></font>
history_parametrs = np.array(parametrs_df.drop(<span class="hljs-string">'scores'</span>,axis=<span class="hljs-number">1</span>))</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¤œè¨¼ã®ã‚¨ãƒ©ãƒ¼ã¯ã€ã‚ã‚‹æ™‚ç‚¹ã‹ã‚‰å¤‰åŒ–ã—ãªããªã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã“ã§ã¯ã€å­¦ç¿’ã‚’è‡ªå‹•çš„ã«åœæ­¢ã—ã¦ã€å—ä¿¡ã—ãŸæ©Ÿèƒ½ã‚’ä¸€ç”Ÿä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ãŒã€ã™ã§ã«å°‘ã—æ™‚é–“ãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">:(</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã©ã®ãã‚‰ã„å‹‰å¼·ã™ã‚‹ã‹ã‚’æ±ºå®šã—ã¾ã™ã€‚</font></font></b><div class="spoiler_text"><pre><code class="python hljs">last = history_holdout_score[<span class="hljs-number">-1</span>]<font></font>
steps = np.arange(<span class="hljs-number">0</span>, history_holdout_score.shape[<span class="hljs-number">0</span>])[history_holdout_score != last].max()<font></font>
print(steps/<span class="hljs-number">18</span>)</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
35.5555555555555556ä¸€åº¦ã«</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1ã¤ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’å¤‰æ›´ã—ãŸãŸã‚ã€1ã¤ã®æœ€é©åŒ–ã‚µã‚¤ã‚¯ãƒ«</font><font style="vertical-align: inherit;">ã¯</font><font style="vertical-align: inherit;">18ã‚¹ãƒ†ãƒƒãƒ—ã§</font><font style="vertical-align: inherit;">æ§‹æˆã•ã‚Œã¦ã„</font><font style="vertical-align: inherit;">ã¾ã™ã€‚</font><font style="vertical-align: inherit;">36ã®æ„å‘³ã®ã‚ã‚‹ã‚¹ãƒ†ãƒƒãƒ—ã€ã¾ãŸã¯ãã®ã‚ˆã†ãªã‚‚ã®ãŒã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">æ¬¡ã«ã€ãƒ¡ã‚½ãƒƒãƒ‰ãŒãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã•ã‚ŒãŸè»Œé“ã‚’è¦–è¦šåŒ–ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</font></font><br>
<br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éš ã—ãƒ†ã‚­ã‚¹ãƒˆ</font></font></b><div class="spoiler_text"><pre><code class="python hljs">%%time
<span class="hljs-comment">#    :</span>
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<font></font>
%matplotlib inline<font></font>
<span class="hljs-keyword">import</span> random
<span class="hljs-keyword">import</span> math<font></font>
random.seed(<span class="hljs-number">17</span>)<font></font>
property_projection = np.array([[math.sin(a), math.cos(a)] <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> [random.uniform(-math.pi, math.pi) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(history_parametrs[<span class="hljs-number">0</span>].shape[<span class="hljs-number">0</span>])]]).transpose()<font></font>
history = np.array(history_parametrs[::<span class="hljs-number">18</span>]) <span class="hljs-comment">#   - 18 .</span>
<span class="hljs-comment">#           . :(</span>
points = np.array([(history[i] * property_projection).sum(axis=<span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(history.shape[<span class="hljs-number">0</span>])])<font></font>
plt.plot(points[:<span class="hljs-number">36</span>,<span class="hljs-number">0</span>],points[<span class="hljs-number">0</span>:<span class="hljs-number">36</span>,<span class="hljs-number">1</span>]);<font></font>
plt.savefig(<span class="hljs-string">"images/pic2.png"</span>, format = <span class="hljs-string">'png'</span>)<font></font>
plt.show()</code></pre></div></div><br>
<img src="https://habrastorage.org/webt/jt/zs/rc/jtzsrcgk60i_aeqhcvxjq9atvee.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ—…è¡Œã®å¤§éƒ¨åˆ†ãŒæœ€åˆã®4ã¤ã®ã‚¹ãƒ†ãƒƒãƒ—ã§å®Œäº†ã—ãŸã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">å¢—åŠ ã®æ®‹ã‚Šã®éƒ¨åˆ†ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åˆã®4ãƒã‚¤ãƒ³ãƒˆãªã—</font></font></b><div class="spoiler_text"><pre><code class="python hljs">plt.plot(points[<span class="hljs-number">4</span>:<span class="hljs-number">36</span>,<span class="hljs-number">0</span>],points[<span class="hljs-number">4</span>:<span class="hljs-number">36</span>,<span class="hljs-number">1</span>]);<font></font>
plt.savefig(<span class="hljs-string">"images/pic3.png"</span>, format = <span class="hljs-string">'png'</span>)</code></pre></div></div><br>
<img src="https://habrastorage.org/webt/gq/xh/wa/gqxhwawt9nnsmypgk3tkry9vbpw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ‘ã‚¹ã®æœ€å¾Œã®éƒ¨åˆ†ã‚’è©³ã—ãè¦‹ã¦ã€ç›®çš„åœ°ã«åˆ°ç€ã—ãŸå¾Œã®æ•™å¸«ã®è¡Œå‹•ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿‘ããªã£ã¦ã‚‹</font></font></b><div class="spoiler_text"><pre><code class="python hljs">plt.plot(points[<span class="hljs-number">14</span>:<span class="hljs-number">36</span>,<span class="hljs-number">0</span>],points[<span class="hljs-number">14</span>:<span class="hljs-number">36</span>,<span class="hljs-number">1</span>]);<font></font>
plt.savefig(<span class="hljs-string">"images/pic4.png"</span>, format = <span class="hljs-string">'png'</span>)<font></font>
plt.show()<font></font>
plt.plot(points[<span class="hljs-number">24</span>:<span class="hljs-number">36</span>,<span class="hljs-number">0</span>],points[<span class="hljs-number">24</span>:<span class="hljs-number">36</span>,<span class="hljs-number">1</span>]);<font></font>
plt.plot(points[<span class="hljs-number">35</span>:,<span class="hljs-number">0</span>],points[<span class="hljs-number">35</span>:,<span class="hljs-number">1</span>], color = <span class="hljs-string">'red'</span>);<font></font>
plt.savefig(<span class="hljs-string">"images/pic5.png"</span>, format = <span class="hljs-string">'png'</span>)<font></font>
plt.show()</code></pre></div></div><br>
<img src="https://habrastorage.org/webt/a5/kq/6m/a5kq6mq5yxl3roojyjfzdw8wq8a.png"><br>
<br>
<img src="https://habrastorage.org/webt/g5/lo/gs/g5logsa_jmna5lveoc-w0679koy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãŒç†±å¿ƒã«è¨“ç·´ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚å½¼ãŒç›®çš„åœ°ã‚’è¦‹ã¤ã‘ã‚‹ã¾ã§ã€‚ã‚‚ã¡ã‚ã‚“ã€å…·ä½“çš„ãªãƒã‚¤ãƒ³ãƒˆã¯ã€äº¤å·®æ¤œè¨¼ã®ãƒ©ãƒ³ãƒ€ãƒ åŒ–ã«ä¾å­˜ã—ã¾ã™ã€‚ã—ã‹ã—ã€ç‰¹å®šã®ãƒã‚¤ãƒ³ãƒˆã«é–¢ä¿‚ãªãã€ä½•ãŒèµ·ã“ã£ã¦ã„ã‚‹ã‹ã«ã¤ã„ã¦ã®å…¨ä½“åƒã¯ç†è§£ã§ãã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã¡ãªã¿ã«ã€ç§ã¯ãã®ã‚ˆã†ãªã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦å­¦ç¿’ãƒ—ãƒ­ã‚»ã‚¹ã‚’ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã—ã¦ã„ã¾ã—ãŸã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è»Œé“å…¨ä½“ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€ã‚¹ã‚±ãƒ¼ãƒ«ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚°ã‚’ä¼´ã†æœ€å¾Œã®ã„ãã¤ã‹ã®ã‚¹ãƒ†ãƒƒãƒ—ã€‚ä¾‹ã¯ã€ä»–ã®è¨˜äº‹ã€Œãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ã‚¹ãƒ­ãƒ¼ã‚’ã‚¹ãƒ‘ã‚¤ã™ã‚‹ã€ã«ã‚ã‚Šã¾ã™ã€‚ãã—ã¦ã‚‚ã¡ã‚ã‚“ã€ãã®ã‚ˆã†ãªè¦–è¦šåŒ–ã«é­é‡ã—ãŸã™ã¹ã¦ã®äººã¯ã€ãªãœã™ã¹ã¦ã®è¦å› ãŒåŒã˜é‡ã¿ã€é‡è¦æ€§ã‚’æŒã£ã¦ã„ã‚‹ã®ã‹ã€ãã—ã¦ãªãœç•°ãªã‚‹ã®ã‹ã‚’ã™ãã«å°‹ã­ã¾ã™ã€‚å‰å›ã®è¨˜äº‹ã§ã¯ã€ã‚·ãƒŠãƒ—ã‚¹ã®é‡è¦æ€§ã‚’å†è©•ä¾¡ã—ã‚ˆã†ã¨ã—ã¾ã—ãŸãŒã€æƒ…å ±é‡ãŒå°‘ãªããªã‚Šã¾ã—ãŸã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»Šå›ã¯ã€æ–°ã—ã„çŸ¥è­˜ã‚’èº«ã«ã¤ã‘ã¦ã€t-SNEã‚’ä½¿ç”¨ã—ã¦ã€å¤šæ¬¡å…ƒç©ºé–“ã‚’ã™ã¹ã¦æ”¹å–„ã§ãã‚‹æŠ•å½±ã«å±•é–‹ã—ã¦ã¿ã¾ã™ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t-SNE</font></font></b><div class="spoiler_text"><pre><code class="python hljs">%%time
<span class="hljs-keyword">import</span> sklearn.manifold <span class="hljs-keyword">as</span> manifold<font></font>
tsne = manifold.TSNE(random_state=<span class="hljs-number">19</span>)<font></font>
tsne_representation = tsne.fit_transform(history)<font></font>
plt.plot(tsne_representation[:, <span class="hljs-number">0</span>], tsne_representation[:, <span class="hljs-number">1</span>])<font></font>
plt.savefig(<span class="hljs-string">"images/pic6.png"</span>, format = <span class="hljs-string">'png'</span>)<font></font>
plt.show();</code></pre></div></div><br>
<img src="https://habrastorage.org/webt/qe/bp/nn/qebpnnz71ywbxgqvhzj3fpv8vzc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
t-Sneã¯ã‚¹ãƒšãƒ¼ã‚¹ã‚’åºƒã’ã¦ã€å¤‰æ›´ãŒã™ãã«æ­¢ã¾ã£ãŸæ©Ÿèƒ½ã®å¤‰æ›´ã®ã‚¹ã‚±ãƒ¼ãƒ«ã‚’å®Œå…¨ã«é£Ÿã„æ­¢ã‚ãŸã‚ˆã†ã§ã‚ã‚Šã€ãã®ãŸã‚ç”»åƒã¯å®Œå…¨ã«æœ‰ç›Šã§ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</font><font style="vertical-align: inherit;">çµè«–-ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’æ„å›³ã—ã¦ã„ãªã„å ´æ‰€ã«å…¥ã‚Œã‚ˆã†ã¨ã—ãªã„ã§ãã ã•ã„ã€‚ï¼š\</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚ãªãŸã¯ã•ã‚‰ã«èª­ã‚€ã“ã¨ãŒã§ãã¾ã›ã‚“</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç§ã¯ã¾ãŸã€tsneã‚’å†…éƒ¨ã«æ³¨å…¥ã—ã¦ä¸­é–“ã®æœ€é©åŒ–çŠ¶æ…‹ã‚’è¦–è¦šåŒ–ã—ã€ç¾ã—ã•ãŒæ˜ã‚‰ã‹ã«ãªã‚‹ã“ã¨ã‚’æœŸå¾…ã—ã¾ã—ãŸã€‚ã—ã‹ã—ã€ãã‚Œã¯ç¾ã—ã•ã§ã¯ãªãã€ã‚´ãƒŸã§ã‚ã‚‹ã“ã¨ãŒåˆ¤æ˜ã—ã¾ã—ãŸã€‚èˆˆå‘³ãŒã‚ã‚Œã°ã€ãã®æ–¹æ³•ã‚’ã”è¦§ãã ã•ã„ã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«ã¯ã€ãã®ã‚ˆã†ãªæŒ¿å…¥ã‚³ãƒ¼ãƒ‰ã®ä¾‹ãŒ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ•£ã‚‰ã‹ã£ã¦</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã„ã¾ã™ãŒã€</font><b><font style="vertical-align: inherit;">sklearn.manifold.t_sne</font></b><font style="vertical-align: inherit;">å†…éƒ¨é–¢æ•°</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_gradient_descentã«</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å«ã¾ã‚Œã¦ã„ã‚‹ä»£æ›¿ç‰©ã§ã‚ã‚Š</font><font style="vertical-align: inherit;">ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚ˆã£ã¦ã¯ã€ç½²åã¨å†…éƒ¨å¤‰æ•°ã®å‡¦ç†ã®ä¸¡æ–¹ãŒéå¸¸ã«ç•°ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹</font><font style="vertical-align: inherit;">ãŸã‚ã€å˜ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹ã ã‘ã§ã¯ã€ãƒœãƒƒãƒˆã¯ä½œæˆã•ã‚Œã¾ã›ã‚“</font><font style="vertical-align: inherit;">ã€‚ã ã‹ã‚‰è‡ªåˆ†ã§ã‚½ãƒ¼ã‚¹ã‚’è¦‹ã¤ã‘ã¦ã€ãã“ã‹ã‚‰é–¢æ•°ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å–ã‚Šå‡ºã—ã€ãã“ã«1è¡Œã ã‘ã‚’æŒ¿å…¥ã—ã¦ã€è‡ªåˆ†ã®å¤‰æ•°ã«ä¸­é–“ãƒ€ãƒ³ãƒ—ã‚’è¿½åŠ ã—ã¾ã™</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã€‚positions.appendï¼ˆp.copyï¼ˆï¼‰ï¼‰ï¼ƒç¾åœ¨ã®ä½ç½®ã‚’ä¿å­˜ã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã—ã¦ã€ã‚¿ã‚¤ãƒ—ã—ã¦ã€çµæœã¨ã—ã¦å¾—ã‚‰ã‚Œã‚‹ã‚‚ã®ã‚’ç¾ã—ãè¦–è¦šåŒ–ã—ã¾ã™ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ³¨å…¥ã‚³ãƒ¼ãƒ‰</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> time
<span class="hljs-keyword">from</span> scipy <span class="hljs-keyword">import</span> linalg
<span class="hljs-comment"># This list will contain the positions of the map points at every iteration.</span><font></font>
positions = []<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_gradient_descent</span>(<span class="hljs-params">objective, p0, it, n_iter,
                      n_iter_check=<span class="hljs-number">1</span>, n_iter_without_progress=<span class="hljs-number">300</span>,
                      momentum=<span class="hljs-number">0.8</span>, learning_rate=<span class="hljs-number">200.0</span>, min_gain=<span class="hljs-number">0.01</span>,
                      min_grad_norm=<span class="hljs-number">1e-7</span>, verbose=<span class="hljs-number">0</span>, args=None, kwargs=None</span>):</span>
    <span class="hljs-comment"># The documentation of this function can be found in scikit-learn's code.</span>
    <span class="hljs-keyword">if</span> args <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<font></font>
        args = []<font></font>
    <span class="hljs-keyword">if</span> kwargs <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<font></font>
        kwargs = {}<font></font>
<font></font>
    p = p0.copy().ravel()<font></font>
    update = np.zeros_like(p)<font></font>
    gains = np.ones_like(p)<font></font>
    error = np.finfo(np.float).max<font></font>
    best_error = np.finfo(np.float).max<font></font>
    best_iter = i = it<font></font>
<font></font>
    tic = time()<font></font>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(it, n_iter):<font></font>
        positions.append(p.copy()) <span class="hljs-comment"># We save the current position.</span><font></font>
        <font></font>
        check_convergence = (i + <span class="hljs-number">1</span>) % n_iter_check == <span class="hljs-number">0</span>
        <span class="hljs-comment"># only compute the error when needed</span>
        kwargs[<span class="hljs-string">'compute_error'</span>] = check_convergence <span class="hljs-keyword">or</span> i == n_iter - <span class="hljs-number">1</span><font></font>
<font></font>
        error, grad = objective(p, *args, **kwargs)<font></font>
        grad_norm = linalg.norm(grad)<font></font>
<font></font>
        inc = update * grad &lt; <span class="hljs-number">0.0</span><font></font>
        dec = np.invert(inc)<font></font>
        gains[inc] += <span class="hljs-number">0.2</span>
        gains[dec] *= <span class="hljs-number">0.8</span><font></font>
        np.clip(gains, min_gain, np.inf, out=gains)<font></font>
        grad *= gains<font></font>
        update = momentum * update - learning_rate * grad<font></font>
        p += update<font></font>
<font></font>
        <span class="hljs-keyword">if</span> check_convergence:<font></font>
            toc = time()<font></font>
            duration = toc - tic<font></font>
            tic = toc<font></font>
<font></font>
            <span class="hljs-keyword">if</span> verbose &gt;= <span class="hljs-number">2</span>:<font></font>
                print(<span class="hljs-string">"[t-SNE] Iteration %d: error = %.7f,"</span>
                      <span class="hljs-string">" gradient norm = %.7f"</span>
                      <span class="hljs-string">" (%s iterations in %0.3fs)"</span>
                      % (i + <span class="hljs-number">1</span>, error, grad_norm, n_iter_check, duration))<font></font>
<font></font>
            <span class="hljs-keyword">if</span> error &lt; best_error:<font></font>
                best_error = error<font></font>
                best_iter = i<font></font>
            <span class="hljs-keyword">elif</span> i - best_iter &gt; n_iter_without_progress:
                <span class="hljs-keyword">if</span> verbose &gt;= <span class="hljs-number">2</span>:<font></font>
                    print(<span class="hljs-string">"[t-SNE] Iteration %d: did not make any progress "</span>
                          <span class="hljs-string">"during the last %d episodes. Finished."</span>
                          % (i + <span class="hljs-number">1</span>, n_iter_without_progress))
                <span class="hljs-keyword">break</span>
            <span class="hljs-keyword">if</span> grad_norm &lt;= min_grad_norm:
                <span class="hljs-keyword">if</span> verbose &gt;= <span class="hljs-number">2</span>:<font></font>
                    print(<span class="hljs-string">"[t-SNE] Iteration %d: gradient norm %f. Finished."</span>
                          % (i + <span class="hljs-number">1</span>, grad_norm))
                <span class="hljs-keyword">break</span><font></font>
<font></font>
    <span class="hljs-keyword">return</span> p, error, i<font></font>
<font></font>
manifold.t_sne._gradient_descent = _gradient_descent</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€Œå›ºå®šã€t-SNEã‚’é©ç”¨ã™ã‚‹</font></font></b><div class="spoiler_text"><pre><code class="python hljs">tsne_representation = manifold.TSNE(random_state=<span class="hljs-number">17</span>).fit_transform(history)<font></font>
X_iter = np.dstack(position.reshape(<span class="hljs-number">-1</span>, <span class="hljs-number">2</span>) <span class="hljs-keyword">for</span> position <span class="hljs-keyword">in</span> positions)<font></font>
position_reshape = [position.reshape(<span class="hljs-number">-1</span>, <span class="hljs-number">2</span>) <span class="hljs-keyword">for</span> position <span class="hljs-keyword">in</span> positions]<font></font>
print(position_reshape[<span class="hljs-number">0</span>].shape)<font></font>
print(<span class="hljs-string">'[0] min'</span>, position_reshape[<span class="hljs-number">0</span>][:,<span class="hljs-number">0</span>].min(),<span class="hljs-string">'max'</span>, position_reshape[<span class="hljs-number">0</span>][:,<span class="hljs-number">0</span>].max())<font></font>
print(<span class="hljs-string">'[1] min'</span>, position_reshape[<span class="hljs-number">1</span>][:,<span class="hljs-number">0</span>].min(),<span class="hljs-string">'max'</span>, position_reshape[<span class="hljs-number">1</span>][:,<span class="hljs-number">0</span>].max())<font></font>
print(<span class="hljs-string">'[2] min'</span>, position_reshape[<span class="hljs-number">2</span>][:,<span class="hljs-number">0</span>].min(),<span class="hljs-string">'max'</span>, position_reshape[<span class="hljs-number">2</span>][:,<span class="hljs-number">0</span>].max())
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ï¼ˆ</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
41ã€2 </font><font style="vertical-align: inherit;">ï¼‰</font><font style="vertical-align: inherit;">[0]æœ€å°-0.00018188123æœ€å¤§0.00027207955 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[1]æœ€å°-0.05136269æœ€å¤§0.032607622 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[2]æœ€å°-4.392309æœ€å¤§7.9074526 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å€¤ã¯éå¸¸ã«åºƒã„ç¯„å›²ã§å¤‰åŒ–ã™ã‚‹ãŸã‚ã€æç”»ã™ã‚‹å‰ã«ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚µã‚¤ã‚¯ãƒ«ã§ã¯ã€ã“ã‚Œã¯ã™ã¹ã¦ã‚†ã£ãã‚Šã¨è¡Œã‚ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">:(</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§ã¯ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã—ã¾ã™</font></font></b><div class="spoiler_text"><pre><code class="python hljs">%%time
<span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> MinMaxScaler<font></font>
minMaxScaler = MinMaxScaler()<font></font>
minMaxScaler.fit_transform(position_reshape[<span class="hljs-number">0</span>])<font></font>
position_reshape = [minMaxScaler.fit_transform(frame) <span class="hljs-keyword">for</span> frame <span class="hljs-keyword">in</span> position_reshape]<font></font>
position_reshape[<span class="hljs-number">0</span>].min(), position_reshape[<span class="hljs-number">0</span>].max()</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¢ãƒ‹ãƒ¡ãƒ¼ãƒˆ</font></font></b><div class="spoiler_text"><pre><code class="python hljs">%%time<font></font>
<font></font>
<span class="hljs-keyword">from</span> matplotlib.animation <span class="hljs-keyword">import</span> FuncAnimation, PillowWriter
<span class="hljs-comment">#plt.style.use('seaborn-pastel')</span><font></font>
<font></font>
fig = plt.figure()<font></font>
<font></font>
ax = plt.axes(xlim=(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>), ylim=(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>))<font></font>
line, = ax.plot([], [], lw=<span class="hljs-number">3</span>)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">init</span>():</span><font></font>
    line.set_data([], [])<font></font>
    <span class="hljs-keyword">return</span> line,
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">animate</span>(<span class="hljs-params">i</span>):</span>
    x = position_reshape[i][:,<span class="hljs-number">0</span>]<font></font>
    y = position_reshape[i][:,<span class="hljs-number">1</span>]<font></font>
    line.set_data(x, y)<font></font>
    <span class="hljs-keyword">return</span> line,<font></font>
<font></font>
anim = FuncAnimation(fig, animate, init_func=init, frames=<span class="hljs-number">36</span>, interval=<span class="hljs-number">20</span>, blit=<span class="hljs-literal">True</span>, repeat_delay = <span class="hljs-number">1000</span>)<font></font>
anim.save(<span class="hljs-string">'images/animate_tsne_learning.gif'</span>, writer=PillowWriter(fps=<span class="hljs-number">5</span>))
</code></pre></div></div><br>
<img src="https://habrastorage.org/webt/lh/dq/g6/lhdqg6khzhplw6jtkei6y0s3pdu.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚¹ã‚­ãƒ«ã®ç‚¹ã§ã¯æœ‰ç›Šã§ã™ãŒã€ã“ã®ã‚¿ã‚¹ã‚¯ã§ã¯ã¾ã£ãŸãå½¹ã«ç«‹ãŸãšã€é†œã„ã§ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã‚Œã«ã¤ã„ã¦ç§ã¯ã‚ãªãŸã«åˆ¥ã‚Œã‚’å‘Šã’ã¾ã™ã€‚</font><font style="vertical-align: inherit;">knnã‹ã‚‰ã§ã‚‚ã€ä½•ã‹æ–°ã—ã„ã€èˆˆå‘³æ·±ã„ã‚³ãƒ¼ãƒ‰ã‚„ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã§ãã‚‹ã¨ã„ã†è€ƒãˆãŒã€ç–«ç—…ã®é–“ã«ã“ã®çŸ¥çš„ãªã”ã¡ãã†ã§ãƒ‡ãƒ¼ã‚¿ã‚’æ¥½ã—ã‚€æ–¹æ³•ã«ã‚‚å½¹ç«‹ã¤ã“ã¨ã‚’é¡˜ã£ã¦ã„ã¾ã™ã€‚</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja496466/index.html">ååˆ†ã«é€Ÿã„å…‰æºã«ã¯èµ¤ã„ãƒ‰ãƒƒãƒ—ãƒ©ãƒ¼ã‚·ãƒ•ãƒˆãŒã‚ã‚Šã¾ã™</a></li>
<li><a href="../ja496472/index.html">GitHubã®10ã®èˆˆå‘³æ·±ã„ãƒªãƒã‚¸ãƒˆãƒªã€‚é–‹ç™ºè€…ã«ã¯ä¾¿åˆ©ã§ã™ã€‚</a></li>
<li><a href="../ja496476/index.html">Windows Server Coreã‚’ä½¿ç”¨ã—ã¦Windows Serverã‚’ä½é›»åŠ›VPSã«ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹</a></li>
<li><a href="../ja496480/index.html">æœªæ¥ã®æ²ˆé»™ã®éŸ³</a></li>
<li><a href="../ja496482/index.html">ãƒãƒ¼ãƒ ç®¡ç†ã®ãŸã‚ã®æƒ…å ±ã«åŸºã¥ããƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã®è‚²æˆ</a></li>
<li><a href="../ja496486/index.html">æ„è¦‹ï¼šSpamhaus-ã‚ªãƒ³ãƒ©ã‚¤ãƒ³æ¤œé–²ã¾ãŸã¯ã‚¯ãƒªãƒ¼ãƒ³Webæˆ¦é—˜æ©Ÿï¼Ÿ</a></li>
<li><a href="../ja496488/index.html">IaaSãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ãŒBGPãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¸ã®æ”»æ’ƒã¨æˆ¦ã†</a></li>
<li><a href="../ja496490/index.html">Mediastreamer2 VoIPã‚¨ãƒ³ã‚¸ãƒ³ã‚’ç ”ç©¶ã—ã¾ã™ã€‚ãƒ‘ãƒ¼ãƒˆ7</a></li>
<li><a href="../ja496492/index.html">åŸºæœ¬çš„ãªLXDæ©Ÿèƒ½-Linuxã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚·ã‚¹ãƒ†ãƒ </a></li>
<li><a href="../ja496494/index.html">ã‚·ã‚¹ãƒ†ãƒ ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã§ãƒãƒªã‚ªã®éŸ³æ¥½ã‚’å†ç”Ÿã—ã¾ã™</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>