<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎁 👨🏻 🍀 À propos des sauvegardes dans Proxmox VE 🍥 👸🏽 🏷️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans l'article «La magie de la virtualisation: un cours d'introduction à Proxmox VE», nous avons réussi à installer un hyperviseur sur le serveur, à y...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>À propos des sauvegardes dans Proxmox VE</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/selectel/blog/486194/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/wt/vx/xu/wtvxxuyee73gugficymc7t4x0zm.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans l'article </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«La magie de la virtualisation: un cours d'introduction à Proxmox VE»,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous avons réussi à installer un hyperviseur sur le serveur, à y connecter le stockage, à prendre soin de la sécurité de base et même à créer la première machine virtuelle. Nous allons maintenant voir comment implémenter les tâches les plus élémentaires que vous devez effectuer afin de toujours pouvoir restaurer les services en cas de panne. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les outils Proxmox établis vous permettent non seulement de sauvegarder des données, mais également de créer des ensembles d'images préconfigurées de systèmes d'exploitation pour un déploiement rapide. Cela aide non seulement si nécessaire à créer un nouveau serveur pour n'importe quel service en quelques secondes, mais réduit également les temps d'arrêt au minimum.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous ne parlerons pas de la nécessité de créer des sauvegardes, car cela est évident et a longtemps été un axiome. </font><font style="vertical-align: inherit;">Arrêtons-nous sur certaines choses et caractéristiques non évidentes.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, considérez comment les données sont enregistrées pendant la procédure de sauvegarde.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algorithmes de sauvegarde</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour commencer, Proxmox a une bonne boîte à outils de dotation en personnel pour créer des sauvegardes de machines virtuelles. </font><font style="vertical-align: inherit;">Il vous permet d'enregistrer facilement toutes les données de la machine virtuelle et prend en charge deux mécanismes de compression, ainsi que trois méthodes pour créer ces copies. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Examinons d'abord les mécanismes de compression:</font></font><br>
<br>
<ol>
<li><b> LZO</b>.     ,     90- .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a> (  Proxmox  lzop).        . ,   ,     ,        .</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compression du GZIP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">En utilisant cet algorithme, la sauvegarde sera compressée à la volée avec l'utilitaire GNU Zip, qui utilise le puissant algorithme Deflate créé par </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Phil Katz</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">L'accent principal est mis sur la compression maximale des données, ce qui réduit l'espace disque occupé par les sauvegardes. </font><font style="vertical-align: inherit;">La principale différence avec LZO est que les procédures de compression / décompression prennent un temps assez long.</font></font></li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modes d'archivage</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Proxmox propose trois méthodes de sauvegarde parmi lesquelles l'administrateur système peut choisir. </font><font style="vertical-align: inherit;">En les utilisant, vous pouvez résoudre le problème requis en déterminant la priorité entre le besoin de temps d'arrêt et la fiabilité de la sauvegarde:</font></font><br>
<br>
<ol>
<li><b> Snapshot ()</b>.       Live backup,          .       VM,       —    -         .  ,   ,      .     ,     ,    .</li>
<li><b> Suspend ()</b>.    «»  ,     .     ,        ,     . ,        ,    /  ,      . ,       .              .</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mode d'arrêt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">La méthode de sauvegarde la plus fiable, mais nécessitant un arrêt complet de la machine virtuelle. </font><font style="vertical-align: inherit;">Une commande est envoyée à l'arrêt normalement, après l'arrêt, une sauvegarde est effectuée, puis une commande est émise pour allumer la machine virtuelle. </font><font style="vertical-align: inherit;">Le nombre d'erreurs avec cette approche est minime et le plus souvent réduit à zéro. </font><font style="vertical-align: inherit;">Les sauvegardes créées de cette manière se déploient presque toujours correctement.</font></font></li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Effectuer la procédure de sauvegarde</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour sauvegarder:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous passons à la machine virtuelle nécessaire.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sélectionnez l'élément de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">réservation</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cliquez sur le bouton </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Réserver maintenant</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Une fenêtre s'ouvrira dans laquelle vous pourrez sélectionner les options pour la future sauvegarde.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/et/gn/fu/etgnfuz7yjw9dohf4ktcvphtxry.png"></div><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En tant que stockage, nous indiquons celui que nous avons connecté </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans la partie précédente</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Après avoir sélectionné les paramètres, cliquez sur le bouton </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sauvegarder</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et attendez que la sauvegarde soit créée. </font><font style="vertical-align: inherit;">Ceci sera indiqué par l'inscription </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TASK OK</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/u-/8i/pc/u-8ipc1amu1z51u4ibgh9tjxs-o.png"></div><br>
</li>
</ol><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les archives maintenant créées avec des sauvegardes de machines virtuelles seront disponibles pour téléchargement à partir du serveur. </font><font style="vertical-align: inherit;">Le moyen de copie le plus simple et le plus courant est SFTP. </font><font style="vertical-align: inherit;">Pour ce faire, utilisez le populaire client FTP multiplateforme FileZilla, qui peut fonctionner en utilisant le protocole SFTP.</font></font><br>
<br>
<ol>
<li>  <b></b>  IP-   ,   <b> </b>  root,   <b></b> — ,     ,    <b></b>  «22» (   ,     SSH-).</li>
<li>  <b> </b> ,      ,        ,   .</li>
<li>   <b>/mnt/storage</b>.         «dump».    :<ul>
<li><b>vzdump-qemu-_--.vma.gz</b>     GZIP;</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vzdump-qemu-machine_number-date-time.vma.lzo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> si la méthode LZO est sélectionnée.</font></font></li>
</ul></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est recommandé de télécharger les sauvegardes immédiatement depuis le serveur et de les enregistrer dans un endroit sûr, par exemple, dans notre stockage cloud. </font><font style="vertical-align: inherit;">Si vous décompressez un fichier avec une résolution vma, l'utilitaire du même nom fourni avec Proxmox, puis les fichiers avec les extensions </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">raw</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fw</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> seront à l'intérieur </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ces fichiers contiennent les éléments suivants:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">raw</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - image disque;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Configuration VM;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fw</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - paramètres du pare-feu.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Restore depuis une sauvergarde</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considérez la situation où la machine virtuelle a été accidentellement supprimée et sa récupération d'urgence à partir de la sauvegarde est requise:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ouvrez le stockage sur lequel se trouve la sauvegarde.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Accédez à l'onglet </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenu</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sélectionnez la copie souhaitée et cliquez sur le bouton </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Restaurer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/bg/ou/ts/bgoutsyb4clkt_qx4xy88avgtqq.png"></div><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous spécifions le stockage cible et l'ID qui seront attribués à la machine une fois le processus terminé.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cliquez sur le bouton </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Restaurer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une fois la récupération terminée, la VM apparaîtra dans la liste des disponibles.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clonage de machine virtuelle</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, supposons qu'une entreprise doive apporter des modifications à un service critique. </font><font style="vertical-align: inherit;">Une telle modification est implémentée en apportant de nombreuses modifications aux fichiers de configuration. </font><font style="vertical-align: inherit;">Le résultat est imprévisible et toute erreur peut entraîner une défaillance du service. </font><font style="vertical-align: inherit;">Pour empêcher une telle expérience d'affecter un serveur en cours d'exécution, il est recommandé de cloner la machine virtuelle.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le mécanisme de clonage créera une copie exacte du serveur virtuel avec lequel il est permis d'effectuer des modifications sans affecter le fonctionnement du service principal. Ensuite, si les modifications sont appliquées avec succès, la nouvelle machine virtuelle démarre et l'ancienne s'arrête. Il y a une caractéristique dans ce processus qui doit toujours être gardée en mémoire. Sur la machine clonée, l'adresse IP sera exactement la même que la machine virtuelle source, c'est-à-dire qu'au démarrage, un conflit d'adresse se produira.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous vous expliquerons comment éviter une telle situation. Immédiatement avant d'effectuer le clonage, vous devez apporter des modifications à la configuration du réseau. Pour ce faire, vous devez modifier temporairement l'adresse IP, mais ne redémarrez pas le service réseau. Après le clonage sur la machine principale, vous devez rétablir les paramètres et, sur la machine clonée, spécifier toute autre adresse IP. Ainsi, nous obtenons deux copies du même serveur à différentes adresses. Cela introduira rapidement un nouveau service. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si ce service est un serveur Web, il vous suffit de modifier l'enregistrement A de votre fournisseur DNS, après quoi les demandes des clients pour ce nom de domaine seront déjà envoyées à l'adresse de la machine virtuelle clonée.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soit dit en passant, Selectel offre à tous ses clients le service de placer gratuitement un nombre illimité de domaines sur les serveurs NS. </font><font style="vertical-align: inherit;">La gestion des enregistrements s'effectue à la fois à l'aide de notre panneau de contrôle et à l'aide d'une API spéciale. </font><font style="vertical-align: inherit;">En savoir plus à ce sujet </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans notre base de connaissances</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le clonage d'une machine virtuelle dans Proxmox est une tâche très simple. </font><font style="vertical-align: inherit;">Pour l'exécuter, vous devez effectuer les étapes suivantes:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Allez à la voiture dont nous avons besoin.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Choisissez dans le menu </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plus</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cliquez sur </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le clone</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans la fenêtre qui s'ouvre, remplissez le paramètre Name.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/3n/on/wn/3nonwng-06gxpllialr7u_9ck2m.png"></div></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clonez en appuyant sur le bouton </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cloner</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cet outil vous permet de faire une copie d'une machine virtuelle non seulement sur le serveur local. </font><font style="vertical-align: inherit;">Si plusieurs serveurs de virtualisation sont combinés dans un cluster, alors en utilisant cet outil, vous pouvez immédiatement déplacer la copie créée vers le serveur physique souhaité. </font><font style="vertical-align: inherit;">Une fonction utile est le choix du stockage sur disque (paramètre </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Target Storage</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), ce qui est très pratique lors du déplacement d'une machine virtuelle d'un support physique à un autre.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formats de lecteur virtuel</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous vous en dirons plus sur les formats de disques utilisés dans Proxmox:</font></font><br>
<br>
<ol>
<li><b>RAW</b>.     .       «  »    .    ,       mount   linux-.      «» ,        .<br>
<br>
     ,        ,             RAW (        ).</li>
<li><b>QEMU image format (qcow2)</b>. ,       .    ,             . ,    40  ,      2 ,         VM.        .<br>
<br>
       :        ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  nbd</a>,     <b>qemu-nbd</b>,            .       ,   ,       .<br>
<br>
 ,    -      ,           .        ,     RAW.</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Format d'image VMware (vmdk)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ce format est natif de l'hyperviseur VMware vSphere et a été inclus avec Proxmox pour des raisons de compatibilité. </font><font style="vertical-align: inherit;">Il vous permet de migrer une machine virtuelle VMware vers l'infrastructure Proxmox. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'utilisation de vmdk sur une base continue n'est pas recommandée, ce format est le plus lent de Proxmox, il ne convient donc qu'à la migration, pas plus. </font><font style="vertical-align: inherit;">Dans un avenir prévisible, cette lacune sera probablement éliminée.</font></font></li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Travailler avec des images disque</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inclus avec Proxmox est un utilitaire très pratique appelé </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qemu-img</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">L'une de ses fonctions est de convertir des images de disques virtuels. </font><font style="vertical-align: inherit;">Pour l'utiliser, ouvrez simplement la console de l'hyperviseur et exécutez la commande au format:</font></font><br>
<br>
<pre><code class="plaintext hljs">qemu-img convert -f vmdk test.vmdk -O qcow2 test.qcow2</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans l'exemple ci-dessus, l'image vmdk du lecteur virtuel VMware appelé </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">test</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sera convertie au format </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qcow2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il s'agit d'une commande très utile lorsque vous devez corriger une erreur dans la sélection de format initiale. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Grâce à la même commande, vous pouvez forcer l'image souhaitée en utilisant l'argument </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">create</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="plaintext hljs">qemu-img create -f raw test.raw 40G</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une telle commande créera une image de test au format </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RAW</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , d'une taille de 40 Go. </font><font style="vertical-align: inherit;">Maintenant, il convient à la connexion à l'une des machines virtuelles.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redimensionner un disque virtuel</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conclusion, nous allons montrer comment augmenter la taille d'une image disque si, pour une raison quelconque, l'espace sur elle n'est plus suffisant. </font><font style="vertical-align: inherit;">Pour ce faire, utilisez l'argument resize:</font></font><br>
<br>
<pre><code class="plaintext hljs">qemu-img resize -f raw test.raw 80G</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, notre image est devenue la taille de 80 Go. </font><font style="vertical-align: inherit;">Vous pouvez afficher des informations détaillées sur l'image à l'aide de l'argument </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">info</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="plaintext hljs">qemu-img info test.raw</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N'oubliez pas que l'extension d'image elle-même n'augmentera pas automatiquement la taille de la partition - elle ajoutera simplement l'espace libre disponible. </font><font style="vertical-align: inherit;">Pour agrandir la section, utilisez la commande:</font></font><br>
<br>
<pre><code class="plaintext hljs">resize2fs /dev/sda1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
où </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ dev / sda1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est la partition souhaitée.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Automatisez les sauvegardes</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'utilisation de la méthode manuelle de création de sauvegardes est une tâche très longue et prend beaucoup de temps. </font><font style="vertical-align: inherit;">Par conséquent, Proxmox VE inclut un outil pour les sauvegardes planifiées automatiques. </font><font style="vertical-align: inherit;">Considérez comment procéder:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">À l'aide de l'interface Web de l'hyperviseur, ouvrez l'élément </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datacenter</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sélectionnez l'élément de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">réservation</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cliquez sur le bouton </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajouter</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous définissons les paramètres de l'ordonnanceur.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/5d/a0/tu/5da0tunglle5mwsvudggbwjyuhc.png"></div><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cochez la case </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Activer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enregistrez les modifications à l'aide du bouton </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Créer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, le planificateur démarre automatiquement le programme de sauvegarde à l'heure exacte spécifiée, en fonction de la planification spécifiée.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons envisagé des méthodes régulières de sauvegarde et de récupération des machines virtuelles. Leur utilisation vous permet de sauvegarder toutes les données sans aucun problème et de les restaurer de toute urgence en cas d'urgence. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sûr, ce n'est pas le seul moyen possible de sauvegarder des données importantes. Il existe de nombreux outils, par exemple </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Duplicity</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , avec lesquels vous pouvez créer des copies complètes et incrémentielles du contenu des serveurs virtuels basés sur Linux.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors de l'exécution de procédures de sauvegarde, vous devez toujours considérer qu'elles chargent activement le sous-système de disque. </font><font style="vertical-align: inherit;">À cet égard, il est recommandé d'effectuer ces procédures à des moments de charge minimale afin d'éviter les retards lors de l'exécution des opérations d'E / S à l'intérieur des machines. </font><font style="vertical-align: inherit;">Vous pouvez surveiller l'état des retards de fonctionnement du disque directement à partir de l'interface Web de l'hyperviseur (paramètre de délai IO).</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr486184/index.html">Comment utiliser efficacement la recherche</a></li>
<li><a href="../fr486186/index.html">Nuage catastrophique: comment cela fonctionne</a></li>
<li><a href="../fr486188/index.html">Présentation du système de sauvegarde PostgreSQL wal-g</a></li>
<li><a href="../fr486190/index.html">Notre expérience dans le développement d'un pilote CSI dans Kubernetes pour Yandex.Cloud</a></li>
<li><a href="../fr486192/index.html">Les cyber fraudeurs piratent les opérateurs mobiles pour accéder aux numéros de téléphone des abonnés</a></li>
<li><a href="../fr486198/index.html">Parler est difficile. Essais sur la communication avec les non-programmeurs</a></li>
<li><a href="../fr486200/index.html">Conseils Docker: nettoyez votre machine des déchets indésirables</a></li>
<li><a href="../fr486202/index.html">Alpine recueille les versions Docker sous Python 50 fois plus lentement et les images 2 fois plus lourdes</a></li>
<li><a href="../fr486204/index.html">Profession: Administrateur système</a></li>
<li><a href="../fr486206/index.html">Quels types de fraude ai-je rencontrés en freelance et en sous-traitance</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>