<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍑 🤽🏾 📓 Proxmox VEでのクラスタリング 🚆 ‼️ 🥉</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="過去の記事で、Proxmox VEとは何か、それがどのように機能するかについて話し始めました。本日は、クラスタリング機能の使用方法について説明し、クラスタリング機能の利点を示します。
 
 クラスターとは何ですか？なぜ必要なのですか？クラスター（英語のクラスターから）は、高速通信チャネルによって接続...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Proxmox VEでのクラスタリング</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/selectel/blog/489914/"><img src="https://habrastorage.org/webt/ba/4_/p0/ba4_p0pjj8nlzulpcdlsdbez4mo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
過去の記事で、Proxmox VEとは何か、それがどのように機能するかについて話し始めました。</font><font style="vertical-align: inherit;">本日は、クラスタリング機能の使用方法について説明し、クラスタリング機能の利点を示します。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスターとは何ですか？なぜ必要なのですか？</font><font style="vertical-align: inherit;">クラスター（英語のクラスターから）は、高速通信チャネルによって接続されたサーバーのグループであり、全体として機能し、ユーザーを表します。</font><font style="vertical-align: inherit;">クラスターを使用するには、いくつかの基本的なシナリオがあります。</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フォールトトレランスを提供し</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます（高可用性）。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">負荷分散</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（負荷分散）。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生産性の向上</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（高性能）。</font></font></li>
<li><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分散コンピューティングの</font><b><font style="vertical-align: inherit;">実行</font></b></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各シナリオには、クラスターコンポーネントに対する独自の要件があります。</font><font style="vertical-align: inherit;">たとえば、分散コンピューティングを実行するクラスターの場合、主な要件は、高速な浮動小数点演算とネットワークの低遅延です。</font><font style="vertical-align: inherit;">このようなクラスターは、研究目的でよく使用されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分散コンピューティングのトピックについて触れたので、</font><b><font style="vertical-align: inherit;">グリッドシステムの</font></b><font style="vertical-align: inherit;">ようなものがまだあることに注意したい</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（英語から。グリッド-ラティス、ネットワーク）。</font><font style="vertical-align: inherit;">一般的な類似性にもかかわらず、グリッドシステムとクラスターを混同しないでください。</font><font style="vertical-align: inherit;">グリッドは通常の意味ではクラスターではありません。</font><font style="vertical-align: inherit;">クラスターとは対照的に、グリッドに含まれるノードはほとんどの場合異種であり、可用性が低いという特徴があります。</font><font style="vertical-align: inherit;">このアプローチは、分散コンピューティングの問題の解決を簡素化しますが、ノードから単一の全体を作成することはできません。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">グリッドシステムの顕著な例は、人気のあるコンピューティングプラットフォーム</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BOINC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Berkeley Open Infrastructure for Network Computing）です。</font><font style="vertical-align: inherit;">このプラットフォームは元々</font><font style="vertical-align: inherit;">、電波信号を分析して地球外の情報を検索する問題に対処</font><font style="vertical-align: inherit;">する</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SETI @ホームプロジェクト</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">家庭</font></a><font style="vertical-align: inherit;">での地球外の情報の検索）用に</font><font style="vertical-align: inherit;">作成されました</font><font style="vertical-align: inherit;">。</font></font></blockquote><div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使い方</font></font></b><div class="spoiler_text">  ,   ,     ,      - (  SETI@home      ).              SETI.       ,        .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これでクラスターとは何かが明確に理解できたので、クラスターを作成してデプロイする方法を検討することをお勧めします。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Proxmox VE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オープンソース仮想化システムを使用します</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスターの作成を開始する前に、Proxmoxの制限とシステム要件を明確に理解することが特に重要です。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスタ内のノードの最大数は</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてのノードに</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同じバージョンのProxmox</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が必要です</font><font style="vertical-align: inherit;">（例外はありますが、実稼働には推奨されません）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将来的に高可用性機能を使用する予定の場合、クラスターには</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">少なくとも3つのノード</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が必要</font><font style="vertical-align: inherit;">です。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ノードが相互に通信する</font><font style="vertical-align: inherit;">ためには、corosync用</font><font style="vertical-align: inherit;">のポート</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UDP / 5404</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UDP / 5405</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、および</font><font style="vertical-align: inherit;">SSH用の</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP / 22</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が開いている必要があります</font><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ノード間のネットワーク遅延は</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 msを</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">超えてはなりません</font><font style="vertical-align: inherit;">。</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスターの作成</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重要！</font><font style="vertical-align: inherit;">以下の設定はテスト用です。</font><font style="vertical-align: inherit;">Proxmox VE </font><font style="vertical-align: inherit;">の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公式ドキュメントを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必ず確認してください</font><font style="vertical-align: inherit;">。</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テストクラスターを開始するために、同じ構成（2コア、2 GBのRAM）のProxmoxハイパーバイザーがインストールされた3台のサーバーを使用しました。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Proxmoxのインストール方法を知りたい場合は、以前の記事「</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仮想化マジック：Proxmox VEの入門コース</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」を読むことをお勧めします</font><font style="vertical-align: inherit;">。</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初は、OSのインストール後、単一サーバーが</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スタンドアロンモードで</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実行され</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;">。</font></font><br>
 <br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/2l/b9/1x/2lb91xdrokvieydn63rr9fb7ndo.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">対応するセクションの</font><font style="vertical-align: inherit;">
[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスター</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の</font><b><font style="vertical-align: inherit;">作成</font></b><font style="vertical-align: inherit;"> ]ボタンをクリックしてクラスターを作成します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/4k/sr/me/4ksrmekzntmzfig-2ymdwx7oahs.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将来のクラスターに名前を付け、アクティブなネットワーク接続を選択します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/cy/ww/bt/cywwbtaea7ogttm77ebrwtwo7f8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[作成]ボタンをクリックします。</font><font style="vertical-align: inherit;">サーバーは2048ビットの鍵を生成し、それを新しいクラスターのパラメーターと一緒に構成ファイルに書き込みます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/qv/r3/wy/qvr3wyzqfxrgscstbwz0mzxztv0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
表記</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TASK OK</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、操作が成功したことを示します。</font><font style="vertical-align: inherit;">これで、システムに関する一般的な情報を見ると、サーバーがクラスターモードに切り替えられていることがわかります。</font><font style="vertical-align: inherit;">これまでのところ、クラスターは1つのノードのみで構成されています。つまり、クラスターに必要な機能がありません。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/cv/zl/17/cvzl17xrzcnv4tbjlgcgutbd6vc.png"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスターに参加する</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
作成したクラスターに接続する前に、接続を完了するための情報を取得する必要があります。</font><font style="vertical-align: inherit;">これを行うには</font><font style="vertical-align: inherit;">、[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスタ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ] </font><font style="vertical-align: inherit;">セクション</font><font style="vertical-align: inherit;">に移動し、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[情報に参加</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]ボタンをクリックします</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/7g/se/mi/7gsemira1cy79g3f9yxopfxc_mo.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開いたウィンドウで、同じ名前のフィールドの内容に注目します。</font><font style="vertical-align: inherit;">コピーする必要があります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/rw/-i/7h/rw-i7hhyo_yqrqy-o9oh2jxmi9g.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
必要なすべての接続パラメーターは、ここにエンコードされます：接続用のサーバーアドレスとフィンガープリント。</font><font style="vertical-align: inherit;">クラスタに含める必要があるサーバーに渡します。</font><font style="vertical-align: inherit;">[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスター</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><b><font style="vertical-align: inherit;">参加</font></b><font style="vertical-align: inherit;"> ]ボタン</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">クリックし、</font><font style="vertical-align: inherit;">開いたウィンドウで、コピーしたコンテンツを貼り付けます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/bt/fh/0v/btfh0vp9foxegb2lcca-d-kww1c.png"></div><br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peer Address</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fingerprint</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
フィールド</font><font style="vertical-align: inherit;">は自動的に入力されます。</font><font style="vertical-align: inherit;">ノード番号1のrootパスワードを入力し、ネットワーク接続を選択して、[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参加</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]ボタンをクリックします</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/v-/um/i3/v-umi3rqffairr3yhnn2tz2uafi.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスターに参加すると、GUI Webページの更新が停止する場合があります。</font><font style="vertical-align: inherit;">これは正常です。ページをリロードしてください。</font><font style="vertical-align: inherit;">まったく同じ方法で、もう1つノードを追加すると、3つの稼働ノードの本格的なクラスターが作成されます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/tc/wb/mx/tcwbmxrp1umdagapsce7tv4qfie.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、1つのGUIからすべてのクラスターノードを制御できます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/e4/at/cb/e4atcbt-_ihvdai9jjjmiamgrds.png"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高可用性組織</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Proxmoxはそのままで、仮想マシンとLXCコンテナーの両方のHA組織機能をサポートします。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ha-manager</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーティリティ</font><font style="vertical-align: inherit;">は、障害が発生したノードから正常なノードにフェイルオーバーを実行することにより、エラーと障害を検出して処理します。</font><font style="vertical-align: inherit;">このメカニズムが正しく機能するためには、仮想マシンとコンテナーに共通のファイルストレージが必要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
高可用性機能がアクティブ化されると、ha-managerソフトウェアスタックは仮想マシンまたはコンテナーのステータスを継続的に監視し始め、クラスター内の他のノードと非同期に対話し始めます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">共有ストレージを接続</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、192.168.88.18に小さなNFSファイルストレージをデプロイしました。</font><font style="vertical-align: inherit;">クラスターのすべてのノードで使用できるように、次の操作を行う必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Webインターフェースのメニューで</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datacenter-Storage-Add-NFS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を選択し</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/vr/pd/3u/vrpd3uedlwasqpg0m19g8pvtb2o.png"></div><br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
フィールド</font><font style="vertical-align: inherit;">と</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーバー</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールドに入力します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エクスポート]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドロップダウンリストで</font><font style="vertical-align: inherit;">、使用可能なディレクトリから目的のディレクトリを選択し</font><font style="vertical-align: inherit;">、</font><font style="vertical-align: inherit;">[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンテンツ]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リスト</font><font style="vertical-align: inherit;">で必要なデータタイプを選択します。</font><font style="vertical-align: inherit;">[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">追加</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]ボタンをクリックすると、</font><font style="vertical-align: inherit;">ストレージがクラスターのすべてのノードに接続されます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/6d/mu/fy/6dmufyavxpq4dcxaqxarozuughm.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ノードのいずれかに仮想マシンとコンテナを作成するとき、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ストレージをストレージ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">として</font><font style="vertical-align: inherit;">指定します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HAをカスタマイズする</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、Ubuntu 18.04でコンテナを作成し、高可用性を構成します。</font><font style="vertical-align: inherit;">コンテナーを作成して起動した後、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datacenter-HA-Add</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セクションに移動し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">開いたフィールドで、仮想マシン/コンテナーのIDと、再起動してノード間を移動する最大試行回数を指定します。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この量を超えると、ハイパーバイザーはVMを障害としてマークし、エラー状態に移行します。その後、VMでのアクションの実行が停止されます。</font></font></blockquote><div style="text-align:center;"><img src="https://habrastorage.org/webt/p4/h9/ng/p4h9nglzk5gtsojtebmvlny9cvq.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">追加</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]ボタンをクリックした後、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ha-manager</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーティリティは</font><font style="vertical-align: inherit;">、指定されたIDを持つVMが現在監視されていることをすべてのクラスターノードに通知し、落ちた場合は別のノードで再起動する必要があります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ni/6x/q5/ni6xq5soctxwt3-abx9bs0gvo8o.png"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラッシュする</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スイッチングメカニズムがどのように機能するかを確認するために、node1の電源を異常終了させて​​みましょう。</font><font style="vertical-align: inherit;">別のノードからクラスターに何が起こるかを調べます。</font><font style="vertical-align: inherit;">システムが障害を記録したことがわかります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/df/wc/ve/dfwcve9i2iplppnbexfsomn0w40.png"></div><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HAメカニズムの動作は、VMの継続的な動作を意味するものではありません。</font><font style="vertical-align: inherit;">ノードが「落ちる」とすぐに、VMの動作は、別のノードでの自動再起動まで一時的に停止されます。</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そしてここで「魔法」が始まります。クラスターは自動的にノードを再割り当てしてVMを実行し、120秒以内に作業が自動的に復元されました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/sl/ep/j6/slepj6ytjfwkdkfx--i7kvrxega.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
node2は栄養物を消します。</font><font style="vertical-align: inherit;">クラスターが耐えることができ、VMが自動的に動作状態に戻るかどうかを見てみましょう。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/7c/ge/k6/7cgek6uuanswhta3osmoshozk10.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
悲しいかな、私たちが見るように、唯一残っているノードにクォーラムがなくなり、HAが自動的に無効になるという問題がありました。</font><font style="vertical-align: inherit;">コンソールにクォーラムインストールを強制するコマンドを提供します。</font></font><br>
<br>
<pre><code class="plaintext hljs">pvecm expected 1</code></pre><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/qk/n6/jw/qkn6jwdgtovfx9ns7kt2veahb0w.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2分後、HAメカニズムは正常に動作し、node2が見つかりませんでした。node3でVMを起動しました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/6s/z2/xm/6sz2xmx1djx-_rm6k_y3uz6xcpu.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
node1とnode2をオンに戻すとすぐに、クラスターは完全に復元されました。</font><font style="vertical-align: inherit;">VMはnode1に戻らないことに注意してください。ただし、これは手動で行うことができます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要約する</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Proxmoxのクラスタリングメカニズムがどのように機能するかについて説明し、仮想マシンとコンテナ用にHAがどのように構成されているかも示しました。</font><font style="vertical-align: inherit;">クラスタリングとHAを適切に使用することで、インフラストラクチャの信頼性が大幅に向上し、災害復旧も可能になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスターを作成する前に、クラスターをどのような目的で使用するか、また将来どの程度拡張する必要があるかをすぐに計画する必要があります。</font><font style="vertical-align: inherit;">また、将来のクラスターが障害なしで機能するように、遅延を最小限に抑えてネットワークインフラストラクチャの可用性を確認する必要もあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
教えてください-Proxmoxでクラスタリング機能を使用していますか？</font><font style="vertical-align: inherit;">コメントでお会いしましょう。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Proxmox VEハイパーバイザーに関する以前の記事：</font></font></i><br>
<br>
<ul>
<li><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仮想化の魔法：Proxmox VEの入門コース</font></font></a></i></li>
<li><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Proxmox VEのバックアップについて</font></font></a></i></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja489900/index.html">PostgreSQLアンチパターン：トリガーをバイパスしてデータを変更する</a></li>
<li><a href="../ja489902/index.html">投資ポートフォリオの効果を測定する方法：3つの実際的なアプローチ</a></li>
<li><a href="../ja489904/index.html">アップデートをテストする理由と方法</a></li>
<li><a href="../ja489906/index.html">OpenCVの仮想試着室</a></li>
<li><a href="../ja489912/index.html">Web開発でマイクロサービスをデバッグするときの苦痛</a></li>
<li><a href="../ja489916/index.html">プロトブフまたはJSON構造のフロントエンド通信プロトコル？</a></li>
<li><a href="../ja489918/index.html">仮想燃料カードプロジェクトの実装方法</a></li>
<li><a href="../ja489920/index.html">サイト、IPv6に移動、2つ</a></li>
<li><a href="../ja489924/index.html">Elasticsearchはどこから始まりますか</a></li>
<li><a href="../ja489926/index.html">ブラックフライデー：開発者の目を通して負荷を確認する</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>