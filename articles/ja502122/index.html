<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>✔️ 💞 🧔 Thanos-スケーラブルなプロメテウス 🥥 🏿 ☝🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="記事の翻訳は、DevOpsの実践とツールコースの学生のために特別に準備されました。
 
 
 
  (Fabian Reinartz) — , Go . Prometheus Kubernetes SIG instrumentation. production- SoundCloud CoreOS....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Thanos-スケーラブルなプロメテウス</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/502122/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記事の翻訳は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DevOpsの実践とツール</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コースの学生のために特別に準備されました</font><font style="vertical-align: inherit;">。</font></font></i></b><br>
<br>
<img src="https://habrastorage.org/webt/hn/yb/6z/hnyb6zs1kjgdaigpvcdypntr4yo.png"><br>
<hr><br>
<i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  (Fabian Reinartz)</a> —   ,  Go     .    Prometheus   Kubernetes SIG instrumentation.     production-  SoundCloud      CoreOS.      Google.<br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  (Bartek Plotka)</a> —    Improbable.       .      Intel,    Mesos  production- SRE    Improbable.    .   : Golang, open source  .</i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
主力のSpatialOS製品を見ると、Improbableには数十のKubernetesクラスターを備えた非常に動的なグローバルクラウドインフラストラクチャが必要であると推測できます。私たちは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロメテウス</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">監視システムを使用した最初の一人でした</font><font style="vertical-align: inherit;">。 Prometheusは、数百万のメトリックをリアルタイムで追跡でき、必要な情報を取得するための強力なクエリ言語が付属しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
シンプルさと信頼性Prometheusは、その主な利点の1つです。しかし、一定の基準を通過したため、いくつかの欠点に直面しました。これらの問題を解決するために、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Thanos</font></a><font style="vertical-align: inherit;">を開発し</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ました</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-Improbableが作成したオープンソースプロジェクト。シームレスに既存のPrometheusクラスターを、履歴データの無制限のリポジトリを持つ単一の監視システムに変換します。</font><font style="vertical-align: inherit;">Thanosはgithub </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">から</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">入手でき</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><a name="habracut"></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Improbableの最新ニュースで最新情報を入手してください。</font></font></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サノスの目標</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一定の規模では、バニラプロメテウスの能力を超える問題が発生します。</font><font style="vertical-align: inherit;">ペタバイトの履歴データを確実かつ経済的に保存する方法 </font><font style="vertical-align: inherit;">これは、要求に対する応答時間を損なうことなく実行できますか？</font><font style="vertical-align: inherit;">単一のAPIリクエストで、異なるPrometheusサーバーにあるすべてのメトリックにアクセスできますか？</font><font style="vertical-align: inherit;">Prometheus HAを使用して収集された複製データを何らかの形で組み合わせることが可能ですか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの問題に対処するために、Thanosを作成しました。</font><font style="vertical-align: inherit;">次のセクションでは、これらの問題への取り組み方と、追求した目標について説明します。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prometheusの複数のインスタンスからのデータのクエリ（グローバルクエリ）</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prometheusは、シャーディングへの機能的アプローチを提供します。 1つのPrometheusサーバーでさえ、ほとんどすべてのユースケースで水平分割の困難からユーザーを解放するために十分なスケーラビリティを提供します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは優れた展開モデルですが、単一のAPIまたはUI-グローバルビューを使用して、さまざまなPrometheusサーバー上のデータにアクセスする必要があることがよくあります。もちろん、1つのGrafanaパネルに複数のリクエストを表示することは可能ですが、各リクエストは1つのPrometheusサーバーでのみ実行できます。一方、Thanosでは、1つのエンドポイントからすべてアクセスできるため、複数のPrometheusサーバーからのデータをクエリして集約できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以前は、Improbableのグローバルビューを取得するために、Prometheusインスタンスをマルチレベルに編成しました</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">階層連盟</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。これは、各リーフサーバーからメトリックの一部を収集する1つのPrometheusメタサーバーを作成することを意味しました。これは</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pv/0j/w3/pv0jw3yhsdl31rqexmamjdx4tiy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題があることが判明し、構成が複雑になり、潜在的な障害点が追加され、複雑なルールを適用して、フェデレーションエンドポイントに適切なデータのみを提供しました。さらに、この種のフェデレーションでは、1つのAPIリクエストからすべてのデータにアクセスできるわけではないため、実際のグローバルビューを取得できません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これと密接に関連しているのは、Prometheus高可用性（HA）サーバーで収集されたデータの単一の表示です。 Prometheus HAモデルは、独立して2回データを収集します。これは非常に単純であるため、単純にすることはできません。ただし、両方のスレッドを組み合わせて重複排除した表現を使用すると、はるかに便利です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、高可用性のPrometheusサーバーが必要です。 Improbableでは、毎分データを監視することに真剣に取り組んでいますが、クラスターごとにPrometheusのインスタンスを1つ持つことは単一障害点です。構成エラーやハードウェア障害があると、重要なデータが失われる可能性があります。再起動はスクレイピング間隔よりも大幅に長くなる可能性があるため、単純なデプロイメントでも、メトリックのコレクションに小さな不具合が発生する可能性があります。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">履歴データの信頼できるストレージ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
安価で高速かつ長期間のメトリックストレージが私たちの夢です（ほとんどのPrometheusユーザーが共有しています）。</font><font style="vertical-align: inherit;">Improbableでは、メトリックの保存期間を9日間に設定する必要がありました（Prometheus 1.8の場合）。</font><font style="vertical-align: inherit;">これは、私たちが振り返ることができる範囲に明らかな制限を加えます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
時系列の数がサーバー全体のパフォーマンスに影響を与えなくなったため、Prometheus 2.0はこの点で優れています（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prometheus 2に関するKubeCon基調講演を</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参照</font><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">ただし、Prometheusはローカルドライブにデータを保存します。</font><font style="vertical-align: inherit;">非常に効率的なデータ圧縮によりローカルSSDの使用を大幅に削減できますが、保存される履歴データの量には制限があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Improbableでは、信頼性、シンプルさ、コストも重視しています。</font><font style="vertical-align: inherit;">大きなローカルドライブは、操作とバックアップがより困難です。</font><font style="vertical-align: inherit;">それらはより高価であり、より多くのバックアップツールを必要とし、それが不必要な複雑さにつながります。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ダウンサンプリング</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
履歴データの処理を開始するとすぐに、O-bigには根本的な問題があり、数週間、数か月、数年間データを処理する場合にクエリが遅くなることがわかりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この問題の標準的な解決策は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ダウン</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サンプリング、つまり信号をダウンサンプリングすることです。</font><font style="vertical-align: inherit;">ダウンサンプリングすることで、より大きな時間範囲に「スケールダウン」し、同じ数のサンプルを維持できるため、リクエストの応答性を維持できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
古いデータのダウンサンプリングは、長期ストレージソリューションの必然的な要件であり、バニラプロメテウスを超えています。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">追加の目標</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thanosプロジェクトの最初の目標の1つは、既存のPrometheusインストールとシームレスに統合することでした。</font><font style="vertical-align: inherit;">2番目の目標は、最小限の進入障壁を備えた単純な操作でした。</font><font style="vertical-align: inherit;">依存関係は小規模ユーザーと大規模ユーザーの両方で簡単に満たす必要があります。これは、基本コストが低いことも意味します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タノス建築</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前のセクションで目標を挙げた後、それらに取り組み、Thanosがこれらの問題をどのように解決するかを見てみましょう。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">グローバルビュー</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prometheusの既存のインスタンスのグローバルビューを取得するには、単一の要求エントリポイントをすべてのサーバーに関連付ける必要があります。これは、Thanos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sidecar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンポーネントが行うこととまったく同じ</font><font style="vertical-align: inherit;">です。各Prometheusサーバーの横にデプロイされ、プロキシとして機能し、ストアのgRPCインターフェースを介してローカルのPrometheusデータを提供します。これにより、ラベルと時間範囲で時系列データを選択できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一方、標準のPrometheus HTTP APIを介してPromQLリクエストに応答するだけではなく、ステートレスな水平方向にスケーラブルなクエリアコンポーネントがあります。コンポーネントクエリア、サイドカー、その他のThanos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、ゴシッププロトコルを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介し</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">て</font></a><font style="vertical-align: inherit;">通信し</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/1p/zn/ts/1pzntsrxrwhxxvdou57tpxhypwm.jpeg"><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クエリアは、リクエストを受信すると、対応するStore APIサーバー、つまりサイドカーに接続し、対応するPrometheusサーバーから時系列データを受信します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">その後、回答を組み合わせ、PromQLクエリを実行します。</font><font style="vertical-align: inherit;">クエリアは、結合されていないデータと、Prometheus HAサーバーからの重複データの両方を組み合わせることができます。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これにより、パズルの大部分が解決されます-分離されたPrometheusサーバーからのデータを1つのビューに結合します。</font><font style="vertical-align: inherit;">実際、Thanosはこの機会にのみ使用できます。</font><font style="vertical-align: inherit;">既存のPrometheusサーバーは変更を加える必要はありません！</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">無制限の賞味期限！</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、遅かれ早かれ、Prometheusの通常のストレージ時間を超えるデータを保存する必要があります。履歴データを保存するために、オブジェクトストレージを選択しました。クラウドやローカルデータセンターで広く利用でき、非常に経済的です。さらに、よく知られているS3 APIを介して、ほとんどすべてのオブジェクトストレージにアクセスできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prometheusは、約2時間ごとにRAMからディスクにデータを書き込みます。保存されたデータのブロックには、一定期間のすべてのデータが含まれ、不変です。 Thanos Sidecarは単にPrometheusデータカタログを見て、新しいブロックが表示されたら、それらをオブジェクトストレージバケットにロードできるため、これは非常に便利です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ss/l6/lh/ssl6lhmk5kyfwe0luqcsbpe8z9w.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ディスクに書き込んだ直後にオブジェクトストレージにダウンロードすると、「スクレーパー」（PrometheusおよびThanos Sidecar）のシンプルさを維持することもできます。これにより、サポート、コスト、システム設計が簡素化されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、データのバックアップは非常に簡単です。しかし、オブジェクトストレージ内のデータのクエリについてはどうでしょうか。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thanos Storeコンポーネントは、オブジェクトストレージからデータを取得するためのプロキシとして機能します。 Thanos Sidecarと同様に、ゴシップクラスターに参加し、ストアAPIを実装します。したがって、既存のクエリアは、時系列データの別のソースとしてサイドカーと見なすことができます-特別な構成は必要ありません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vq/n_/pl/vqn_pl2z-oq1-m1yiix-y-tgvwc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
時系列データブロックは、いくつかの大きなファイルで構成されています。オンデマンドでそれらをダウンロードすることは非常に非効率的であり、ローカルキャッシングは巨大なメモリとディスク領域を必要としました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
代わりに、Store GatewayはPrometheusストレージ形式の処理方法を認識しています。巧妙なクエリプランナーとブロックの必要なインデックス部分のみのキャッシュにより、複雑なクエリをオブジェクトストレージファイルへのHTTPリクエストの最小数に減らすことが可能になりました。したがって、リクエスト数を4桁から6桁削減し、ローカルSSD上のデータリクエストと一般的に区別することが困難な応答時間を実現できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qx/c-/hv/qxc-hvkg1llfi9oaoee6uxtla9c.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上の図に示すように、Thanos Querierは、Prometheusストレージ形式を使用し、関連するデータを並べて配置することにより、オブジェクトストレージでの単一のデータ要求のコストを大幅に削減します。</font><font style="vertical-align: inherit;">このアプローチを使用すると、多数の単一クエリを最小数の一括操作に組み合わせることができます。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">圧縮とダウンサンプリング</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新しい時系列データブロックがオブジェクトストレージに正常に読み込まれた後、それは「履歴」データと見なされ、Store Gatewayを介してすぐに利用可能になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、しばらくすると、1つのソース（Sidecarを含むPrometheus）のブロックが蓄積され、完全なインデックス作成機能が使用されなくなります。この問題を解決するために、Compactorと呼ばれる別のコンポーネントを導入しました。ローカルのPrometheus圧縮メカニズムをオブジェクトストアの履歴データに適用するだけで、単純な定期的なバッチジョブとして実行できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lp/wt/sy/lpwtsym1qftrslmkks3fre9q2o8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
効率的な圧縮のおかげで、リポジトリ内で長期間クエリを実行しても、データサイズの問題は発生しません。ただし、10億の値をアンパックしてクエリプロセッサを介して実行する潜在的なコストは、クエリの実行時間の急激な増加につながります。一方、画面のピクセルあたり数百のデータポイントがあるため、データをフル解像度で視覚化することさえ不可能になります。したがって、ダウンサンプリングが可能であるだけでなく、精度が著しく低下することもありません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xm/ju/gh/xmjughzg4svkzo0behzid9tt02s.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データをダウンサンプリングするために、Compactorは5分と1時間の分解能でデータを継続的に集計します。 TSDB XOR圧縮を使用してエンコードされた未加工フラグメントごとに、1つのブロックの最小値、最大値、合計など、さまざまなタイプの集約データが保存されます。これにより、クエリアはこのPromQLクエリに適した集計を自動的に選択できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
精度を下げてデータを使用するために、ユーザーは特別な構成を必要としません。クエリアは、ユーザーがズームインまたはズームアウトすると、異なる解像度と生データを自動的に切り替えます。必要に応じて、ユーザーはリクエストの「step」パラメータを介してこれを直接制御できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1 GBを保存するコストは小さいため、デフォルトでは、Thanosは元のデータ、つまり5分と1時間の解像度のデータを保存します。</font><font style="vertical-align: inherit;">元のデータを削除する必要はありません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記録ルール</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thanosの場合でも、記録ルールは監視スタックの重要な部分です。</font><font style="vertical-align: inherit;">リクエストの複雑さ、待ち時間、コストを削減します。</font><font style="vertical-align: inherit;">また、ユーザーが集約されたメトリックデータを取得するのにも便利です。</font><font style="vertical-align: inherit;">ThanosはPrometheusのバニラインスタンスに基づいているため、レコーディングルールとアラートルールを既存のPrometheusサーバーに保存することは完全に許容されます。</font><font style="vertical-align: inherit;">ただし、これで十分でない場合もあります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">グローバルアラートとルール（たとえば、3つのクラスターのうち2つ以上のクラスターでサービスが停止している場合のアラート）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ローカルストレージ外のデータのルール。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてのルールとアラートを1つの場所に保持したいという願望。</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/wu/da/bf/wudabfepzgopbamehs1hqzx5s7o.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらすべてのケースで、ThanosにはRulerと呼ばれる別のコンポーネントが含まれており、Thanosクエリを通じてルールとアラートを計算します。</font><font style="vertical-align: inherit;">よく知られているStoreAPIを提供することで、Queryノードは新しく計算されたメトリックにアクセスできます。</font><font style="vertical-align: inherit;">後で、それらもオブジェクトストレージに格納され、Store Gatewayを通じて利用できるようになります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タノスの力</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thanosは、要件に合わせてカスタマイズできるほど柔軟です。</font><font style="vertical-align: inherit;">これは、単純なPrometheusから移行する場合に特に便利です。</font><font style="vertical-align: inherit;">Thanosのコンポーネントについて学んだことを簡単に見てみましょう。</font><font style="vertical-align: inherit;">バニラプロメテウスを「無制限のメトリックストレージ」の世界に転送する方法は次のとおりです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/d-/y0/cn/d-y0cnjpddmhvlfbw-8c7fvqt7o.jpeg"><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ThanosサイドカーをPrometheusサーバーに追加します-たとえば、Kubernetesポッド内の隣接するコンテナー。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">複数のThanos Querierレプリカを展開して、データを表示します。</font><font style="vertical-align: inherit;">この時点で、スクレイパーとクエリアの間にゴシップを設定するのは簡単です。</font><font style="vertical-align: inherit;">メトリック「thanos_cluster_members」を使用して、コンポーネントの相互作用をテストします。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これら2つの手順だけで、グローバルなビューと、潜在的なPrometheus HAレプリカからのシームレスなデータ重複排除を提供できます。</font><font style="vertical-align: inherit;">ダッシュボードをQuerier HTTPエンドポイントに接続するか、Thanos UIインターフェースを直接使用するだけです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、メトリックと長期保存をバックアップする必要がある場合は、さらに3つの手順を実行する必要があります。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS S3またはGCSバケットを作成します。</font><font style="vertical-align: inherit;">これらのバケットにデータをコピーするようにサイドカーを構成します。</font><font style="vertical-align: inherit;">これで、ローカルデータストレージを最小化できます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Store Gatewayを展開し、既存のゴシップクラスターに接続します。</font><font style="vertical-align: inherit;">これで、バックアップでデータリクエストを送信できます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compactorを展開して、圧縮とダウンサンプリングを使用して、クエリのパフォーマンスを長期間にわたって向上させます。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あなたがもっと知りたい場合は、私たちを見て気軽に</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マニフェストkubernetesの例</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">始めます</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
わずか5つのステップで、Prometheusをグローバルなビュー、無制限のストレージ時間、およびメトリックの潜在的な高可用性を備えた信頼性の高いモニタリングシステムに変えました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プルリクエスト：私たちはあなたを必要としています！</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thanos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は当初からオープンソースプロジェクトでした。</font><font style="vertical-align: inherit;">Prometheusとのシームレスな統合と、Thanosの一部のみを使用する機能により、追加の労力なしでモニタリングシステムをスケーリングするための優れた選択肢となります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GitHubのプルリクエストと問題はいつでも歓迎します。</font><font style="vertical-align: inherit;">同時に、</font><font style="vertical-align: inherit;">質問やフィードバックがある場合、または経験を共有したい場合は</font><font style="vertical-align: inherit;">、Githubの問題を通じてお問い合わせいただくか、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Improbable-eng #thanos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をご利用ください。</font><font style="vertical-align: inherit;">Improbableでの仕事を気に入っていただけましたら、お気軽にお問い合わせください</font><font style="vertical-align: inherit;">。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空室があり</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コースの詳細をご覧ください。</font></font><br>
</a><br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja502104/index.html">秘書ロボット、ボットインフォーマント、ボットセラピスト、およびオンラインハッカソンVirusHackの他のプロジェクト</a></li>
<li><a href="../ja502114/index.html">動機のゲーム。パート1</a></li>
<li><a href="../ja502116/index.html">PVS-Studioバージョン7.07機能の概要</a></li>
<li><a href="../ja502118/index.html">システムレベルでの設計。パート3：System ComposerとMathWorksツールチェーンのリンク</a></li>
<li><a href="../ja502120/index.html">生産設備のリモート監視と診断</a></li>
<li><a href="../ja502124/index.html">ウクライナの2019ベンチャー結果</a></li>
<li><a href="../ja502126/index.html">英語プログラマの履歴書を改善する方法</a></li>
<li><a href="../ja502132/index.html">頭痛のないOpenVZ 6コンテナーをKVMサーバーに転送する方法</a></li>
<li><a href="../ja502134/index.html">コードの主観的に美しい決定を恐れるほど-あなたはロボットではありません</a></li>
<li><a href="../ja502136/index.html">Apache Igniteでのデータ圧縮。ズベルバンクエクスペリエンス</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>