<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤔 😛 👨🏿‍🏭 Linux用PVS-Studio C＃を使用した単一行コードまたはNethermind検証 👻 🤱 🤽🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="この記事は、Linux用のPVS-Studio C＃ベータテストと、Rider用のプラグインのリリースに特化しています。そのような素晴らしい理由から、これらのツールを使用して、Nethermind製品のソースコードをチェックしました。この記事では、興味深いエラーと時々面白いエラーを見ていきます。
 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Linux用PVS-Studio C＃を使用した単一行コードまたはNethermind検証</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/504320/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b64/5fc/72d/b645fc72ddcded21612bdc5e9fac2c78.png" alt="写真1"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事は、Linux用のPVS-Studio C＃ベータテストと、Rider用のプラグインのリリースに特化しています。</font><font style="vertical-align: inherit;">そのような素晴らしい理由から、これらのツールを使用して、Nethermind製品のソースコードをチェックしました。この記事では、興味深いエラーと時々面白いエラーを見ていきます。</font></font><br>
<a name="habracut"></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nethermind</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、Linux、Windows、MacO用の.NET Core Ethereumの高速クライアントです。</font><font style="vertical-align: inherit;">EthereumまたはdAppsプライベートネットワークをセットアップするときに、プロジェクトで使用できます。</font><font style="vertical-align: inherit;">Nethermindは</font><font style="vertical-align: inherit;">GitHubにある</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オープンソース</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">プロジェクトは2017年に設立され、常に進化しています。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前書き</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
肉体労働は好きですか？たとえば、プログラムコードのエラーを見つけるなどです。そうですね、あなたが書いたサイトやプロジェクト全体を読んで分析し、いくつかのトリッキーなバグを探すのはかなり退屈です。さて、プロジェクトが小さい場合は5,000行としましょう。ただし、そのサイズがすでに10万行または100万行を超えている場合はどうでしょうか。さらに、それはさまざまなプログラマーによって書かれたもので、非常にわかりやすい形式ではない場合もあります。この場合はどうしますか？この厄介な間違いがどこにあるのかを理解するために、これらの無限の線をすべて実現するために、どこか、どこか過小評価されている時間と100％の時間、本当に眠る必要がありますか？あなたがこれをやりたいとは思いません。それで、どうすればよいのでしょうか、多分これを自動化する現代的な手段があるのでしょうか？</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/34f/9eb/338/34f9eb3387d61eb4ebfa67f0dbccbef7.png" alt="図3"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、静的コードアナライザーのようなツールが登場します。</font><font style="vertical-align: inherit;">静的アナライザーは、プログラムのソースコードの欠陥を検出するためのツールです。</font><font style="vertical-align: inherit;">手動検証に対するこのツールの利点は次のとおりです。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エラーの場所を探すのにほとんど時間を費やしません（少なくとも、失敗したコピーと貼り付けを目で探すよりは間違いなく高速です）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">しばらく検索した後に休息が必要になる人とは異なり、疲れません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">人が気付かないかもしれない多くのエラーパターンを知っています。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データフロー分析、シンボリック実行、パターンマッチングなどのテクノロジーを使用します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定期的かついつでも分析することができます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、静的コードアナライザーを使用しても、コードレビューの置き換えやキャンセルは行われません。</font><font style="vertical-align: inherit;">しかし、コードレビューはより生産的で便利になっています。</font><font style="vertical-align: inherit;">タイプミスを探すためにコードを読むのに疲れるのではなく、知識の伝達に集中して、高レベルのエラーを見つけることができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それについてもっと読むことに興味があるなら</font><font style="vertical-align: inherit;">、PVS-Studioで使用され</font><font style="vertical-align: inherit;">ている</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">テクノロジー</font></a><font style="vertical-align: inherit;">に関する記事と同様に</font><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次の記事</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">もお勧めし</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux / macOS用PVS-Studio C＃</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在、C＃アナライザーを.NET Coreに移植しており、IDEライダー用のプラグインも積極的に開発しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
興味がある場合は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、このページの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フォーム</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">に</font></a><font style="vertical-align: inherit;">記入して、ベータテストに登録でき</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">インストール手順と、アナライザーを使用するためのライセンスがメールで送信されます（ご心配なく、とても簡単です）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、PVS-StudioプラグインでのRiderの外観です。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/rp/p6/f_/rpp6f_9oohudg2ov2jt-hdu0yg0.png" alt="写真4"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">少し憤慨</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ネザーマインドのソースコードを読むのが非常に困難だった場所もあるので、300〜500文字の行はごく普通です。</font><font style="vertical-align: inherit;">はい、1行にフォーマットしないすべてのコードです。</font><font style="vertical-align: inherit;">たとえば、これらの行には、いくつかの三項演算子と論理演算子が含まれていますが、そこには何もありません。</font><font style="vertical-align: inherit;">一般的に、トロンのゲームの最後のシーズンからの楽しみ。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スコープを理解するために少し説明します。</font><font style="vertical-align: inherit;">長さが約82センチのUltraWideモニターを持っています。</font><font style="vertical-align: inherit;">全画面表示でIDEを開くと、約340文字に収まります。</font><font style="vertical-align: inherit;">つまり、私が話している線は適合しません。</font><font style="vertical-align: inherit;">外観を確認したい場合は、GitHubのファイルへのリンクを残しました：</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例1</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogBlockAuthorNicely</span>(<span class="hljs-params">Block block, ISyncPeer syncPeer</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">string</span> authorString = (block.Author == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : <span class="hljs-string">"sealed by "</span> +<font></font>
(KnownAddresses.GoerliValidators.ContainsKey(block.Author) ?<font></font>
KnownAddresses.GoerliValidators[block.Author] : block.Author?.ToString())) ??<font></font>
(block.Beneficiary == <span class="hljs-literal">null</span> ? <span class="hljs-keyword">string</span>.Empty : <span class="hljs-string">"mined by "</span> +<font></font>
(KnownAddresses.KnownMiners.ContainsKey(block.Beneficiary) ?<font></font>
KnownAddresses.KnownMiners[block.Beneficiary] : block.Beneficiary?.ToString()));<font></font>
    <span class="hljs-keyword">if</span> (_logger.IsInfo)<font></font>
    {<font></font>
        <span class="hljs-keyword">if</span> (_logger.IsInfo) _logger.Info(<span class="hljs-string">$"Discovered a new block
<span class="hljs-subst">{<span class="hljs-keyword">string</span>.Empty.PadLeft(<span class="hljs-number">9</span> - block.Number.ToString().Length, <span class="hljs-string">'
'</span>)}</span><span class="hljs-subst">{block.ToString(Block.Format.HashNumberAndTx)}</span> <span class="hljs-subst">{authorString}</span>, sent by
<span class="hljs-subst">{syncPeer:s}</span>"</span>);<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
→ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルリンク</font></font></a><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例2</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">BuildTransitions</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    ...<font></font>
    releaseSpec.IsEip1283Enabled = (_chainSpec.Parameters.Eip1283Transition ??<font></font>
<span class="hljs-keyword">long</span>.MaxValue) &lt;= releaseStartBlock &amp;&amp;<font></font>
((_chainSpec.Parameters.Eip1283DisableTransition ?? <span class="hljs-keyword">long</span>.MaxValue) <font></font>
&gt; releaseStartBlock || (_chainSpec.Parameters.Eip1283ReenableTransition ??<font></font>
<span class="hljs-keyword">long</span>.MaxValue) &lt;= releaseStartBlock);           <font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
→ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルにリンク</font></font></a><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> 
<span class="hljs-title">Will_not_reject_block_with_bad_total_diff_but_will_reset_diff_to_null</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    ...<font></font>
    _syncServer = <span class="hljs-keyword">new</span> SyncServer(<span class="hljs-keyword">new</span> StateDb(), <span class="hljs-keyword">new</span> StateDb(), localBlockTree,<font></font>
NullReceiptStorage.Instance, <span class="hljs-keyword">new</span> BlockValidator(Always.Valid, <span class="hljs-keyword">new</span><font></font>
HeaderValidator(localBlockTree, Always.Valid, MainnetSpecProvider.Instance,<font></font>
LimboLogs.Instance), Always.Valid, MainnetSpecProvider.Instance, <font></font>
LimboLogs.Instance), Always.Valid, _peerPool, StaticSelector.Full, <font></font>
<span class="hljs-keyword">new</span> SyncConfig(), LimboLogs.Instance);<font></font>
    ...     <font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
→ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルへのリンク</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
このようなセクションでエラーが発生したと想像してください。それを探すのは楽しいですか？</font><font style="vertical-align: inherit;">そうではないと私は確信しており、そのように書くことは不可能であることを誰もが理解しています。</font><font style="vertical-align: inherit;">ちなみに、このプロジェクトでエラーが発生した同様の場所があります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">検証結果</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0が嫌いな状態</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件1</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> ReceiptsMessage <span class="hljs-title">Deserialize</span>(<span class="hljs-params"><span class="hljs-keyword">byte</span>[] bytes</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (bytes.Length == <span class="hljs-number">0</span> &amp;&amp; bytes[<span class="hljs-number">0</span>] == Rlp.OfEmptySequence[<span class="hljs-number">0</span>])
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ReceiptsMessage(<span class="hljs-literal">null</span>);<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio警告：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3106</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">おそらくインデックスが範囲外です。</font><font style="vertical-align: inherit;">「0」インデックスは「バイト」境界を超えています。</font><font style="vertical-align: inherit;">Nethermind.Network ReceiptsMessageSerializer.cs 50 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エラーに気付くために、配列内の要素の数が0の場合を考えてください。次に、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bytes.Length == 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件</font><font style="vertical-align: inherit;">がtrueになり、配列要素にアクセスするとき</font><i><font style="vertical-align: inherit;">にタイプ0のindexOutOfRangeException</font></i><font style="vertical-align: inherit;">が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スローされ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
配列が空であるか、0要素が特定の値に等しい場合、このメソッドをすぐに終了したいのですが、誤って「||」を混同しているようです </font><font style="vertical-align: inherit;">「&amp;&amp;」で。</font><font style="vertical-align: inherit;">この問題を次のように修正することを提案します。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> ReceiptsMessage <span class="hljs-title">Deserialize</span>(<span class="hljs-params"><span class="hljs-keyword">byte</span>[] bytes</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (bytes.Length == <span class="hljs-number">0</span> || bytes[<span class="hljs-number">0</span>] == Rlp.OfEmptySequence[<span class="hljs-number">0</span>])
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ReceiptsMessage(<span class="hljs-literal">null</span>);<font></font>
    ...<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件2</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DiscoverAll</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    ...<font></font>
    Type? GetStepType(Type[] typesInGroup)<font></font>
    {<font></font>
        Type? GetStepTypeRecursive(Type? contextType)<font></font>
        {<font></font>
            ...<font></font>
        }<font></font>
        ...<font></font>
        <span class="hljs-keyword">return</span> typesInGroup.Length == <span class="hljs-number">0</span> ? typesInGroup[<span class="hljs-number">0</span>] :<font></font>
               GetStepTypeRecursive(_context.GetType());<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio警告：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3106</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">おそらくインデックスが範囲外です。</font><font style="vertical-align: inherit;">'0'インデックスは 'typesInGroup'の範囲を超えています。</font><font style="vertical-align: inherit;">Nethermind.Runner EthereumStepsManager.cs 70 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記と同様の状況が発生します。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typesInGroup</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の要素数が</font><font style="vertical-align: inherit;">0の場合、0要素にアクセスすると、タイプ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IndexOutOfRangeExceptionの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例外が</font><i><font style="vertical-align: inherit;">スロー</font></i><font style="vertical-align: inherit;">さ</font><i><font style="vertical-align: inherit;">れ</font></i><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場合のみ、私は開発者が何を望んでいたのか理解できません。</font><font style="vertical-align: inherit;">ほとんどの場合、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typesInGroup [0]の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代わりに</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を書き込む必要があり</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エラーまたは未完了の最適化？</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DeleteBlocks</span>(<span class="hljs-params">Keccak deletePointer</span>)</span><font></font>
{<font></font>
   ...<font></font>
   <span class="hljs-keyword">if</span> (currentLevel.BlockInfos.Length == <span class="hljs-number">1</span>)<font></font>
   {<font></font>
      shouldRemoveLevel = <span class="hljs-literal">true</span>;<font></font>
   }<font></font>
   <span class="hljs-keyword">else</span><font></font>
   {<font></font>
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; currentLevel.BlockInfos.Length; i++)<font></font>
      {<font></font>
         <span class="hljs-keyword">if</span> (currentLevel.BlockInfos[<span class="hljs-number">0</span>].BlockHash == currentHash) <span class="hljs-comment">// &lt;=</span><font></font>
         {<font></font>
            currentLevel.BlockInfos = currentLevel.BlockInfos<font></font>
                                      .Where(bi =&gt; bi.BlockHash != currentHash)<font></font>
                                      .ToArray();<font></font>
            <span class="hljs-keyword">break</span>;<font></font>
         }<font></font>
      }<font></font>
   }<font></font>
   ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio警告：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3102</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ループ内の定数インデックスによる 'currentLevel.BlockInfos'オブジェクトの要素への不審なアクセス。 Nethermind.Blockchain BlockTree.cs 895 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一見すると、エラーが明白である-ループを図って</font><font style="vertical-align: inherit;">反復処理</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentLevel.BlockInfosの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要素を</font><font style="vertical-align: inherit;">、しかし、アクセスするとき</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentLevel.BlockInfosを[i]は、彼らが</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">書いた</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[0] currentLevel.BlockInfosを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">0に固定</font><font style="vertical-align: inherit;">してミッションが完了しました。しかし、急がないでください、それを理解しましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Length </font></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> null要素の</font><i><font style="vertical-align: inherit;">BlockHashに</font></i><font style="vertical-align: inherit;">アクセス</font><i><font style="vertical-align: inherit;">し</font></i><font style="vertical-align: inherit;">ます。それが</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentHash</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と等しい場合</font><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentLevel.BlockInfos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">から、</font><font style="vertical-align: inherit;">等しくないすべての要素</font><font style="vertical-align: inherit;">を取得し</font><i><font style="vertical-align: inherit;">ます</font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentHash</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font><i><font style="vertical-align: inherit;">それに</font></i><font style="vertical-align: inherit;">書き込み、ループを終了します。</font><font style="vertical-align: inherit;">サイクルが不必要であることがわかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以前は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">linq</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用して変更/最適化することを決定したアルゴリズムがあったと思います</font><font style="vertical-align: inherit;">が、何かがうまくいきませんでした。</font><font style="vertical-align: inherit;">ここで、条件がfalseの場合、意味のない繰り返しが発生します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ちなみに、これを書いた開発者が</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インクリメンタル分析</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モードを使用すると、</font><font style="vertical-align: inherit;">何かが間違っていて、すべてがすぐに修正されることに気づきました。</font><font style="vertical-align: inherit;">現時点では、次のようにコードを書き直します。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DeleteBlocks</span>(<span class="hljs-params">Keccak deletePointer</span>)</span><font></font>
{<font></font>
    ...<font></font>
    <span class="hljs-keyword">if</span> (currentLevel.BlockInfos.Length == <span class="hljs-number">1</span>)<font></font>
    {<font></font>
        shouldRemoveLevel = <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
        currentLevel.BlockInfos = currentLevel.BlockInfos<font></font>
                                  .Where(bi =&gt; bi.BlockHash != currentHash)<font></font>
                                  .ToArray();<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null参照の逆参照</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">逆参照1</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Sign</span>(<span class="hljs-params">Transaction tx, <span class="hljs-keyword">int</span> chainId</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (_logger.IsDebug)<font></font>
        _logger?.Debug(<span class="hljs-string">$"Signing transaction: <span class="hljs-subst">{tx.Value}</span> to <span class="hljs-subst">{tx.To}</span>"</span>);<font></font>
    IBasicWallet.Sign(<span class="hljs-keyword">this</span>, tx, chainId);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio警告：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nullに対して検証される前に、「_ logger」オブジェクトが使用されました。チェック行：118、118。Nethermind.Wallet DevKeyStoreWallet.cs 118 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
間違ったシーケンスのエラー。最初に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_logger.IsDebug</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に対するアピールがあり、</font><font style="vertical-align: inherit;">その後のみ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_logger</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null </font></font></i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">かどうかチェックさ</font></i><font style="vertical-align: inherit;">れ</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。したがって、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_logger</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nullの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合</font><font style="vertical-align: inherit;">、タイプ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceExceptionの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例外が発生し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">逆参照2</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">BuildNodeInfo</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    _nodeInfo = <span class="hljs-keyword">new</span> NodeInfo();<font></font>
    _nodeInfo.Name = ClientVersion.Description;<font></font>
    _nodeInfo.Enode = _enode.Info;                           <span class="hljs-comment">// &lt;=</span>
    <span class="hljs-keyword">byte</span>[] publicKeyBytes = _enode?.PublicKey?.Bytes;        <span class="hljs-comment">// &lt;=</span>
    _nodeInfo.Id = (publicKeyBytes == <span class="hljs-literal">null</span> ? Keccak.Zero :<font></font>
                   Keccak.Compute(publicKeyBytes)).ToString(<span class="hljs-literal">false</span>);<font></font>
    _nodeInfo.Ip = _enode?.HostIp?.ToString();<font></font>
    _nodeInfo.ListenAddress = <span class="hljs-string">$"<span class="hljs-subst">{_enode.HostIp}</span>:<span class="hljs-subst">{_enode.Port}</span>"</span>;<font></font>
    _nodeInfo.Ports.Discovery = _networkConfig.DiscoveryPort;<font></font>
    _nodeInfo.Ports.Listener = _networkConfig.P2PPort;<font></font>
    UpdateEthProtocolInfo();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio警告：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nullに対して検証される前に '_enode'オブジェクトが使用されました。</font><font style="vertical-align: inherit;">チェック行：55、56。Nethermind.JsonRpc AdminModule.cs 55 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エラーは上記とまったく同じですが、今回は犯人が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_enode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
nullを確認するのを忘れた場合は、プログラムがクラッシュしたときにのみこれを覚えておいてください。</font><font style="vertical-align: inherit;">アナライザーはこれを思い出させ、すべてがうまくいきます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちのお気に入りのコピーペースト</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事例1</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Equals</span>(<span class="hljs-params"><span class="hljs-keyword">ref</span> UInt256 a, <span class="hljs-keyword">ref</span> UInt256 b</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">return</span> a.s0 == b.s0 &amp;&amp; a.s1 == b.s1 &amp;&amp; a.s2 == b.s2 &amp;&amp; a.s2 == b.s2;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio警告：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3001</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「&amp;&amp;」演算子の左側と右側に同じサブ式「a.s2 == b.s2」があります。</font><font style="vertical-align: inherit;">Nethermind.Dirichlet.Numerics UInt256.cs 1154 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、同じ条件が2回チェックされます。</font></font><br>
<br>
<pre><code class="cs hljs">a.s2 == b.s2</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パラメータ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">にはフィールド</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s3</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がある</font><font style="vertical-align: inherit;">ので、</font><font style="vertical-align: inherit;">コピーするときに</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s3</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に変更するのを忘れただけだと思い</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パラメータは、コードの作成者が予想するよりも頻繁に等しくなることがわかります。同時に、一部の開発者はこれを行わないと考え、まったく異なる場所で間違いを探し始め、多くのエネルギーと神経を費やしています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ちなみに、比較関数のエラーは一般的に古典的です。どうやら、プログラマーは、そのような関数を単純であると考えて、書くことに非常にさりげなくかつ無関心に関係しています。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">証明</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。これを知って、今は注意してください:)！</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事例2</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;ApiResponse&gt; 
<span class="hljs-title">PublishBlockAsync</span>(<span class="hljs-params">SignedBeaconBlock signedBlock,
                  CancellationToken cancellationToken</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">bool</span> acceptedLocally = <span class="hljs-literal">false</span>;<font></font>
    ...<font></font>
    <span class="hljs-keyword">if</span> (acceptedLocally)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ApiResponse(StatusCode.Success);<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ApiResponse(StatusCode.Success);<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio警告：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3004</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「then」ステートメントは「else」ステートメントと同等です。 Nethermind.BeaconNode BeaconNodeFacade.cs 177 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
の任意の値の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">acceptedLocallyの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数は、</font><font style="vertical-align: inherit;">本方法は、それを返します。それが間違いかどうかを言うのは難しい。プログラマーが行をコピーして、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StatusCode.Success</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を別のもの</font><font style="vertical-align: inherit;">に変更するのを忘れたとする</font><font style="vertical-align: inherit;">と、これは本当の間違いです。さらに、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StatusCode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">には</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InternalError</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InvalidRequestがあり</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。しかし、コードのリファクタリングはおそらく責任があるため、とにかく、</font><i><font style="vertical-align: inherit;">acceptedLocallyの</font></i><font style="vertical-align: inherit;">値は気にしません</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この場合、コンディションはあなたが座ってそれが間違いかどうかを考えさせる場所になります。</font><font style="vertical-align: inherit;">したがって、いずれにしても、このケースは非常に不愉快です。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事例3</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">TearDown</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    ...<font></font>
    <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> testResult <span class="hljs-keyword">in</span> _results)<font></font>
    {<font></font>
         <span class="hljs-keyword">string</span> message = <span class="hljs-string">$"<span class="hljs-subst">{testResult.Order}</span>. <span class="hljs-subst">{testResult.Name}</span> has "</span> 
               + <span class="hljs-string">$"<span class="hljs-subst">{(testResult.Passed ? <span class="hljs-string">"passed [+]"</span> : <span class="hljs-string">"failed [-]"</span>)}</span>"</span>;
         <span class="hljs-keyword">if</span> (testResult.Passed)<font></font>
         {<font></font>
               TestContext.WriteLine(message);<font></font>
         }<font></font>
         <span class="hljs-keyword">else</span><font></font>
         {<font></font>
               TestContext.WriteLine(message);<font></font>
         }<font></font>
     }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio警告：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3004</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「then」ステートメントは「else」ステートメントと同等です。</font><font style="vertical-align: inherit;">Nethermind.Overseer.Test TestBuilder.cs 46 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
繰り返しになりますが、最終的には同じものを取得するため、検証は</font><font style="vertical-align: inherit;">不要</font><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">繰り返しますが、私たちは座って苦しみながら考えていますが、開発者はここに何を書きたかったのでしょうか。</font><font style="vertical-align: inherit;">静的分析を使用して、あいまいなコードをすぐに修正することで回避できた時間の無駄。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事例4</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Setup</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (_decoderBuffer.ReadableBytes &gt; <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">"decoder buffer"</span>);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (_decoderBuffer.ReadableBytes &gt; <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">"decoder buffer"</span>);<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio警告：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3021</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同一の条件式を持つ2つの「if」ステートメントがあります。最初の「if」ステートメントには、メソッドの戻り値が含まれています。つまり、2番目の「if」ステートメントは無意味ですNethermind.Network.Benchmark InFlowBenchmarks.cs 55 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もう一度</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ctrl + Vを押す</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">だけ</font><font style="vertical-align: inherit;">です。過剰なチェックを削除し、すべて正常です。ここで他の条件が重要である</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、論理演算子Iを使用</font><i><font style="vertical-align: inherit;">すれば</font></i><font style="vertical-align: inherit;">誰もが1つに書き込むと確信してい</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ケース5</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogBlockAuthorNicely</span>(<span class="hljs-params">Block block, ISyncPeer syncPeer</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (_logger.IsInfo)<font></font>
    {<font></font>
        <span class="hljs-keyword">if</span> (_logger.IsInfo)<font></font>
        {<font></font>
            ...<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio警告：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3030</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定期チェック。</font><font style="vertical-align: inherit;">「_logger.IsInfo」条件は、242行目ですでに確認されています。Nethermind.SynchronizationSyncServer.cs 244 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4番目のケースと同じ方法で、追加のチェックが実行されます。</font><font style="vertical-align: inherit;">ただし、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_loggerに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は1つのプロパティだけでなく、たとえば、 ' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bool IsError {get; </font><font style="vertical-align: inherit;">}</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '。</font><font style="vertical-align: inherit;">したがって、コードはおそらく次のようになります。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogBlockAuthorNicely</span>(<span class="hljs-params">Block block, ISyncPeer syncPeer</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (_logger.IsInfo)<font></font>
    {<font></font>
        <span class="hljs-keyword">if</span> (!_logger.IsError) <span class="hljs-comment">// &lt;=</span><font></font>
        {<font></font>
            ...<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まあ、またはコードのリファクタリングのすべての障害と1つのチェックだけはもはや必要ありません。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事例6</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> (missingParamsCount != <span class="hljs-number">0</span>)<font></font>
{<font></font>
    <span class="hljs-keyword">bool</span> incorrectParametersCount = missingParamsCount != <span class="hljs-number">0</span>; <span class="hljs-comment">// &lt;=</span>
    <span class="hljs-keyword">if</span> (missingParamsCount &gt; <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        ...<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">V3022</font></a><font style="vertical-align: inherit;">式 'missingParamsCount！= 0'は常にtrueです。</font><font style="vertical-align: inherit;">Nethermind.JsonRpc JsonRpcService.cs 127 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
条件をチェックし（missingParamsCount！= 0）、それがtrueの場合、再度計算し、結果を変数に割り当てます。</font><font style="vertical-align: inherit;">これが真実を書くためのかなり独自の方法であることに同意します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">紛らわしいチェック</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;<span class="hljs-keyword">long</span>&gt; 
<span class="hljs-title">DownloadHeaders</span>(<span class="hljs-params">PeerInfo bestPeer, 
                BlocksRequest blocksRequest, 
                CancellationToken cancellation</span>)</span><font></font>
{<font></font>
  ...<font></font>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; headers.Length; i++)<font></font>
  {<font></font>
    ...<font></font>
    BlockHeader currentHeader = headers[i];<font></font>
    ...<font></font>
    <span class="hljs-keyword">bool</span> isValid = i &gt; <span class="hljs-number">1</span> ? <font></font>
        _blockValidator.ValidateHeader(currentHeader, headers[i - <span class="hljs-number">1</span>], <span class="hljs-literal">false</span>):<font></font>
        _blockValidator.ValidateHeader(currentHeader, <span class="hljs-literal">false</span>);<font></font>
    ...<font></font>
    <span class="hljs-keyword">if</span> (HandleAddResult(bestPeer, <font></font>
                        currentHeader, <font></font>
                        i == <span class="hljs-number">0</span>,                              <span class="hljs-comment">// &lt;=</span><font></font>
                        _blockTree.Insert(currentHeader))) <font></font>
    {<font></font>
       headersSynced++;<font></font>
    }<font></font>
<font></font>
    ...<font></font>
  }<font></font>
  ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studioの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">V3022</font></a><font style="vertical-align: inherit;">式「i == 0」は常にfalseです。</font><font style="vertical-align: inherit;">Nethermind.Synchronization BlockDownloader.cs 192 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
順番に始めましょう。</font><font style="vertical-align: inherit;">初期化時には、変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値1 </font><i><font style="vertical-align: inherit;">が</font></i><font style="vertical-align: inherit;">割り当てられます。次に、変数は増分されるだけなので、値は常に関数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">falseに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">渡され</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HandleAddResultを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">見てみましょう</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">HandleAddResult</span>(<span class="hljs-params">PeerInfo peerInfo, 
                             BlockHeader block,
                             <span class="hljs-keyword">bool</span> isFirstInBatch, 
                             AddBlockResult addResult</span>)</span><font></font>
{<font></font>
    ...<font></font>
    <span class="hljs-keyword">if</span> (isFirstInBatch)<font></font>
    {<font></font>
        ...<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
        ...<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">isFirstInBatchに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注目してい</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このパラメーターの名前から判断すると、何かがパーティーの最初のものであるかどうかを判断します。</font><font style="vertical-align: inherit;">最初に。</font><font style="vertical-align: inherit;">上記をもう一度見て、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用して2つの呼び出しがあることを確認します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cs hljs">BlockHeader currentHeader = headers[i];<font></font>
_blockValidator.ValidateHeader(currentHeader, headers[i - <span class="hljs-number">1</span>], <span class="hljs-literal">false</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場合のカウントダウンが1から始まることを忘れないでください。2つのオプションがあることがわかります。「最初の」は、インデックス1の下の要素またはインデックス0の下の要素を意味します。ただし、いずれの場合でも、これ</font><font style="vertical-align: inherit;">は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に等しく</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
なり</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">関数呼び出しは次のようになります。</font></font><br>
<br>
<pre><code class="cs hljs">HandleAddResult(bestPeer, currentHeader, <font></font>
                i == <span class="hljs-number">1</span>, _blockTree.Insert(currentHeader))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
またはこのように：</font></font><br>
<br>
<pre><code class="cs hljs">HandleAddResult(bestPeer, currentHeader, <font></font>
                i - <span class="hljs-number">1</span> == <span class="hljs-number">0</span>, _blockTree.Insert(currentHeader))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、開発者が常に静的アナライザーを使用している場合、このコードを記述して警告が表示され、すぐに修正して人生を楽しむでしょう。 </font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">優先順位??</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状況1</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> MemorySize<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">int</span> unaligned = (Keccak == <span class="hljs-literal">null</span> ? MemorySizes.RefSize : <font></font>
        MemorySizes.RefSize + Keccak.MemorySize) <font></font>
        + (MemorySizes.RefSize + FullRlp?.Length <font></font>
                                 ?? MemorySizes.ArrayOverhead)   <span class="hljs-comment">// &lt;=</span><font></font>
        + (MemorySizes.RefSize + _rlpStream?.MemorySize <font></font>
                                 ?? MemorySizes.RefSize)         <span class="hljs-comment">// &lt;=</span><font></font>
        + MemorySizes.RefSize + (MemorySizes.ArrayOverhead + _data?.Length <font></font>
        * MemorySizes.RefSize ?? MemorySizes.ArrayOverhead) <font></font>
        + MemorySizes.SmallObjectOverhead + (Key?.MemorySize ?? <span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> MemorySizes.Align(unaligned);<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studioの警告： </font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3123たぶん「??」</font><font style="vertical-align: inherit;">演算子は、予期されたものとは異なる方法で動作します。</font><font style="vertical-align: inherit;">その優先順位は、左側にある他の演算子の優先順位よりも低くなっています。</font><font style="vertical-align: inherit;">Nethermind.Trie TrieNode.cs 43</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3123たぶん「??」</font><font style="vertical-align: inherit;">演算子は、予期されたものとは異なる方法で動作します。</font><font style="vertical-align: inherit;">その優先順位は、左側にある他の演算子の優先順位よりも低くなっています。</font><font style="vertical-align: inherit;">Nethermind.Trie TrieNode.cs 44</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザーは、「??」演算子の使用方法を確認し、問題が何であるかを理解するために、以下の状況を検討することをお勧めします。</font><font style="vertical-align: inherit;">ここでこの行を見てみましょう。</font></font><br>
<br>
<pre><code class="cs hljs">(MemorySizes.RefSize + FullRlp?.Length ?? MemorySizes.ArrayOverhead)</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySizes.RefSize</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySizes.ArrayOverhead</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は定数です。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MemorySizes</span><font></font>
{<font></font>
    ...<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> RefSize = <span class="hljs-number">8</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> ArrayOverhead = <span class="hljs-number">20</span>;<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、わかりやすくするために、値を置き換えて文字列を書き換えることを提案します。</font></font><br>
<br>
<pre><code class="cs hljs">(<span class="hljs-number">8</span> + FullRlp?.Length ?? <span class="hljs-number">20</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FullRlp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nullで</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ある</font><font style="vertical-align: inherit;">とし</font><i><font style="vertical-align: inherit;">ます。</font></i><font style="vertical-align: inherit;">そうすると、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（8 + null）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はnullになります</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次に、我々は式（取得</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヌル?? 20</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 20が返されます）、</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それはその提供、ということが判明し</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FullRlpが</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ある</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヌル</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">から値</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySizes.ArrayOverheadが</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常に返されます</font><font style="vertical-align: inherit;">関わらずに保存されているものの</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySizes.RefSizeを。</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下の行のフラグメントも同様です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし問題は、開発者がこの動作を望んでいたのかということです。次の行を見てみましょう：</font></font><br>
<br>
<pre><code class="cs hljs">MemorySizes.RefSize + (MemorySizes.ArrayOverhead <font></font>
    + _data?.Length * MemorySizes.RefSize ?? MemorySizes.ArrayOverhead) </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、上記のセクションと同様に、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySizes.RefSizeが</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">式に追加されていますが</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
、最初の「+」演算子の後に括弧</font><font style="vertical-align: inherit;">がある</font><font style="vertical-align: inherit;">ことに注意してください。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySizes.RefSize</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に式</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">追加する必要があること</font><font style="vertical-align: inherit;">が</font><i><font style="vertical-align: inherit;">わかりました</font></i><font style="vertical-align: inherit;">。それが</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nullの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合は</font><font style="vertical-align: inherit;">、別の式を追加します。</font><font style="vertical-align: inherit;">したがって、コードは次のようになります。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> MemorySize<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">int</span> unaligned = (Keccak == <span class="hljs-literal">null</span> ? MemorySizes.RefSize : <font></font>
       MemorySizes.RefSize + Keccak.MemorySize) <font></font>
       + (MemorySizes.RefSize + (FullRlp?.Length <font></font>
                                 ?? MemorySizes.ArrayOverhead))    <span class="hljs-comment">// &lt;=</span><font></font>
       + (MemorySizes.RefSize + (_rlpStream?.MemorySize <font></font>
                                 ?? MemorySizes.RefSize))          <span class="hljs-comment">// &lt;=</span><font></font>
       + MemorySizes.RefSize + (MemorySizes.ArrayOverhead + _data?.Length <font></font>
       * MemorySizes.RefSize ?? MemorySizes.ArrayOverhead) <font></font>
       + MemorySizes.SmallObjectOverhead + (Key?.MemorySize ?? <span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> MemorySizes.Align(unaligned);<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
繰り返しますが、これはあくまでも前提ですが、開発者が別の動作を望む場合は、明示的にこれを示す必要があります。</font></font><br>
<br>
<pre><code class="cs hljs">((MemorySizes.RefSize + FullRlp?.Length) ?? MemorySizes.ArrayOverhead)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、このコードを読む人は、ここで何が起こっているのか、そしてプログラマーが何を望んでいるのかを長い間掘り下げる必要はないでしょう。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状況2</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task&lt;JsonRpcResponse&gt; 
<span class="hljs-title">ExecuteAsync</span>(<span class="hljs-params">JsonRpcRequest request, 
             <span class="hljs-keyword">string</span> methodName,
             (MethodInfo Info, <span class="hljs-keyword">bool</span> ReadOnly</span>) method)</span><font></font>
{<font></font>
    <span class="hljs-keyword">var</span> expectedParameters = method.Info.GetParameters();
    <span class="hljs-keyword">var</span> providedParameters = request.Params;<font></font>
    ...<font></font>
    <span class="hljs-keyword">int</span> missingParamsCount = expectedParameters.Length <font></font>
            - (providedParameters?.Length ?? <span class="hljs-number">0</span>) <font></font>
            + providedParameters?.Count(<span class="hljs-keyword">string</span>.IsNullOrWhiteSpace) ?? <span class="hljs-number">0</span>; <span class="hljs-comment">// &lt;=</span>
    <span class="hljs-keyword">if</span> (missingParamsCount != <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        ...<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio警告：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3123</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">おそらく '??' </font><font style="vertical-align: inherit;">演算子は、予期されたものとは異なる方法で動作します。</font><font style="vertical-align: inherit;">その優先順位は、左側にある他の演算子の優先順位よりも低くなっています。</font><font style="vertical-align: inherit;">Nethermind.JsonRpc JsonRpcService.cs 123 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、操作の優先順位は「??」なので、前回同様、状況を検討します。</font><font style="vertical-align: inherit;">ここでこの行を見てみましょう。</font></font><br>
<br>
<pre><code class="cs hljs">expectedParameters.Length <font></font>
            - (providedParameters?.Length ?? <span class="hljs-number">0</span>) <font></font>
            + providedParameters?.Count(<span class="hljs-keyword">string</span>.IsNullOrWhiteSpace) ?? <span class="hljs-number">0</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
仮定し</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">providedParametersが</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ある</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヌル</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして明確にするため、すぐに関連するすべて置き換える、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">providedParameters</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヌルを、</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして</font><font style="vertical-align: inherit;">ランダムな値に置き換え</font><font style="vertical-align: inherit;">代わりの</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">expectedParameters.Lengthを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-number">100</span> - (<span class="hljs-literal">null</span> ?? <span class="hljs-number">0</span>) + <span class="hljs-literal">null</span> ?? <span class="hljs-number">0</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、2つの同様のチェックがあることにすぐに気づきます。1つの場合にのみブラケットがあり、もう1つのケースにあります。この例を実行してみましょう。最初に（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null ?? 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）が0を返し、次に100から0を減算して100を取得します。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-number">100</span> + <span class="hljs-literal">null</span> ?? <span class="hljs-number">0</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、最初に「</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null ?? 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」を</font><font style="vertical-align: inherit;">実行</font><font style="vertical-align: inherit;">して最後に（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100 + 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）を取得するのではなく、完全に異なります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初にそれが実行され（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100 + null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nullが</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">取得され</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。次に、（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null ?? 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）を</font><font style="vertical-align: inherit;">チェックし</font><i><font style="vertical-align: inherit;">ます。</font></i><font style="vertical-align: inherit;">これにより、missingParamsCount変数の値は0になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の条件は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">missingParamsCount</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font><font style="vertical-align: inherit;">ゼロに</font><i><font style="vertical-align: inherit;">等しい</font></i><font style="vertical-align: inherit;">ことなので、</font><font style="vertical-align: inherit;">これが開発者が求めている動作であると想定できます。そして、括弧を付けて、自分の考えを明確に表現してみませんか？一般に、このチェックは、0が返されることがある理由の誤解が原因である可能性があり、これは松葉杖にすぎません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
繰り返しになりますが、これは行っていなかったかもしれませんが、コードを書くときに</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">増分分析</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モードを使用してください</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結論として、スタティックアナライザーはあなたの友人であり、あなたが間違いをするのを待っている邪悪な監督ではないことをお伝えできたことを願っています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、アナライザーを1回使用するか、ほとんど使用しないことで、もちろんエラーが見つかり、そのいくつかはすぐに修正されることもありますが、頭を痛める必要があるものもあります。</font><font style="vertical-align: inherit;">したがって、常に静的アナライザーを使用する必要があります。</font><font style="vertical-align: inherit;">次に、さらに多くのエラーを見つけて、プログラムコードが作成された瞬間にそれらを修正し、実行しようとしていることを正確に理解します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
単純な真実は、誰もが間違いを犯すことであり、それは正常なことです。</font><font style="vertical-align: inherit;">私たちはみな間違いから学びますが、気づき理解することができたものからのみです。</font><font style="vertical-align: inherit;">したがって、たとえばPVS-Studioなどの最新のツールを使用して、これらのエラーを検索してください。</font><font style="vertical-align: inherit;">ご清聴ありがとうございました。</font></font><br>
<br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a></p><div style="text-align:center;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/eb2/f9c/3bb/eb2f9c3bb5f32f39239298d36431961c.png"></a></div><p></p><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事を英語を話す視聴者と共有したい場合は、翻訳へのリンクを使用してください：Nikolay Mironov。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux用PVS-Studio C＃を使用した1行のコードまたはNethermindのチェック</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja504308/index.html">Nginxで直接プログラミング</a></li>
<li><a href="../ja504310/index.html">データの二分法：データとサービスとの関係を再考する</a></li>
<li><a href="../ja504312/index.html">ロシアのプログラムとGPLの統一登録。私の5セント</a></li>
<li><a href="../ja504314/index.html">HTTPリクエストを介したDockerクライアントなしのDocker PullおよびDocker Pushコマンドの実装</a></li>
<li><a href="../ja504318/index.html">初心者向けに無料の反復開発ワークショップを実施します</a></li>
<li><a href="../ja504322/index.html">LCDスクリーンをブレッドボードLPCXpresso55S69に接続します</a></li>
<li><a href="../ja504324/index.html">Zabbix 5.0の新機能</a></li>
<li><a href="../ja504326/index.html">エフゲニー・ディキ：「ローカルでは、南極大陸はほとんど汚れていませんが、ここでは地球の汚染が非常に目立ちます」</a></li>
<li><a href="../ja504328/index.html">2019年モスクワ市下院での電子投票レッスン</a></li>
<li><a href="../ja504332/index.html">役立つ投稿：最も関連性の高いすべてのコース、放送、技術ストリーム</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>