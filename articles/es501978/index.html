<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😆 🧑🏽‍🤝‍🧑🏼 🤟 ¿Cómo funciona el histograma de Prometeo? 🖐️ 👨🏽‍🤝‍👨🏻 👨🏼‍🚒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Se preparó una traducción del artículo antes del comienzo del curso "Monitoreo y registro: Zabbix, Prometheus, ELK" .
 
 
 
 Anteriormente miramos un ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>¿Cómo funciona el histograma de Prometeo?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/501978/"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se preparó una traducción del artículo antes del comienzo del curso </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Monitoreo y registro: Zabbix, Prometheus, ELK"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></b></i><br>
<br>
<img src="https://habrastorage.org/webt/bb/b2/rl/bbb2rlroxgbryy_noc1mg9urkos.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anteriormente miramos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un mostrador</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un medidor</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un resumen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ahora hablemos sobre cómo funciona el histograma en Prometeo.</font></font><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El histograma tiene algunas similitudes con el resumen. </font><font style="vertical-align: inherit;">Un histograma es una combinación de varios contadores. </font><font style="vertical-align: inherit;">Al igual que las métricas de resumen, las métricas de histograma se usan para rastrear indicadores dimensionales de eventos, a menudo su duración, utilizando el método </font></font><code>observe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Las herramientas de cronometraje son generalmente las mismas que los boletines. </font><font style="vertical-align: inherit;">En lo que difieren es en el procesamiento de cuantiles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El siguiente es un ejemplo de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un formato de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> etiqueta de Prometheus </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">para la exposición</font></a></font><code>handler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="xml hljs"># HELP prometheus_http_request_duration_seconds Histogram of latencies for HTTP requests.<font></font>
# TYPE prometheus_http_request_duration_seconds histogram<font></font>
prometheus_http_request_duration_seconds_bucket{handler="/",le="0.1"} 25547<font></font>
prometheus_http_request_duration_seconds_bucket{handler="/",le="0.2"} 26688<font></font>
prometheus_http_request_duration_seconds_bucket{handler="/",le="0.4"} 27760<font></font>
prometheus_http_request_duration_seconds_bucket{handler="/",le="1"} 28641<font></font>
prometheus_http_request_duration_seconds_bucket{handler="/",le="3"} 28782<font></font>
prometheus_http_request_duration_seconds_bucket{handler="/",le="8"} 28844<font></font>
prometheus_http_request_duration_seconds_bucket{handler="/",le="20"} 28855<font></font>
prometheus_http_request_duration_seconds_bucket{handler="/",le="60"} 28860<font></font>
prometheus_http_request_duration_seconds_bucket{handler="/",le="120"} 28860<font></font>
prometheus_http_request_duration_seconds_bucket{handler="/",le="+Inf"} 28860<font></font>
prometheus_http_request_duration_seconds_sum{handler="/"} 1863.80491025699<font></font>
prometheus_http_request_duration_seconds_count{handler="/"} 28860</code></pre><br>
<code>_sum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>_count</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">funcionan exactamente de la misma manera que para el resumen, y se pueden usar para obtener el tiempo de ejecución promedio en los últimos cinco minutos:</font></font><br>
<br>
<pre><code class="xml hljs"> rate(prometheus_http_request_duration_seconds_sum[5m]<font></font>
/<font></font>
  rate(prometheus_http_request_duration_seconds_count[5m])</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sin embargo, hay casos muy raros en los que está </font></font><code>_sum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ausente, por ejemplo, en algunas métricas del exportador MySQLd. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una parte notable del histograma son las series de tiempo </font></font><code>_bucket</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que en realidad son la parte del histograma de la métrica. Más específicamente, estos son contadores que forman un histograma acumulativo. </font></font><code>le</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">denotar menos o igual a. Por lo tanto, 26688 solicitudes tomaron menos o igual a 200 ms, 27760 solicitudes tomaron menos o igual a 400 ms, y hubo 28860 solicitudes en total. Los valores en el depósito serán monotónicamente no decrecientes, y el </font></font><code>+Inf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">depósito tendrá el mayor valor. </font></font><code>+Inf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el depósito siempre debe estar presente y coincidir con el valor </font></font><code>_count</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para calcular, por ejemplo, un cuantil de 0.9 (el percentil 90), debe usar:</font></font><br>
<br>
<pre><code class="xml hljs">histogram_quantile(0.9, <font></font>
  rate(prometheus_http_request_duration_seconds_bucket[5m])<font></font>
)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una gran ventaja de los histogramas sobre los resúmenes es que puede agregar depósitos antes de calcular un cuantil, teniendo cuidado de no perder la etiqueta </font></font><code>le</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="xml hljs">histogram_quantile(0.9, <font></font>
  sum without (handler)(<font></font>
    rate(prometheus_http_request_duration_seconds_bucket[5m])<font></font>
  )<font></font>
)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Además de la agregación, los histogramas son más baratos para el cliente, ya que los contadores se incrementan rápidamente. </font><font style="vertical-align: inherit;">Entonces, ¿por qué no usar histogramas siempre? </font><font style="vertical-align: inherit;">Hay una </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">respuesta larga</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pero la versión corta es que con los histogramas tienes que preseleccionar tu bucket, y los costos se mueven del cliente a Prometheus debido a la cantidad de elementos del bucket. Diez cubos de forma predeterminada cubren un servicio web típico con un retraso que varía de milisegundos a un segundo, y en algunos casos es posible que deba cambiar esto. Aquí, por ejemplo, se redefinieron para realizar un mejor seguimiento de las consultas de PromQL, que por defecto tienen un tiempo de espera de dos minutos. Tener más de una docena de cubos dará resultados más precisos, pero también puede producir muchas series de tiempo. Especialmente en combinación con otras etiquetas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando se utiliza un sistema de monitoreo en tiempo real como Prometheus, el objetivo debe ser proporcionar un valor analítico suficiente para tomar decisiones de ingeniería basadas en él. Por ejemplo, saber que la demora del percentil 90 ha aumentado en 50 ms es más importante que saber si ahora es 562 ms o 563 ms, y por lo general diez cubos son suficientes para esto. Si necesita una respuesta exacta, siempre puede calcularla más tarde a partir de sus registros. Si hay demasiados cubos, se pueden descartar durante el procesamiento de datos, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">como se mostró anteriormente</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . En casos más extremos, puede ignorar por completo la serie de </font></font><code>_bucket</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sy confiar en el promedio de </font></font><code>_sum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>_count</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conclusión, los histogramas permiten el cálculo agregado de cuantiles, aunque se debe tener en cuenta el número de elementos. </font><font style="vertical-align: inherit;">Recuerde que un resumen sin cuantiles es una opción más barata si no necesita un histograma.</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Más sobre el curso</font></font></a><br>
<br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es501960/index.html">Escala de búsqueda. Elasticsearch Sus ventajas y requisitos básicos para la instalación.</a></li>
<li><a href="../es501964/index.html">¿Para qué sirven las computadoras industriales?</a></li>
<li><a href="../es501968/index.html">Plantilla arquitectónica MVI en Kotlin Multiplataforma, Parte 1</a></li>
<li><a href="../es501970/index.html">¿Qué necesitas para crear una buena mazmorra en RPG?</a></li>
<li><a href="../es501976/index.html">Cómo aprender a probar software</a></li>
<li><a href="../es501980/index.html">La historia de un proyecto o cómo creé un PBX de 7 años basado en Asterisk y Php</a></li>
<li><a href="../es501982/index.html">Cómo transferir un sombreador de un motor de juego a Substance Painter</a></li>
<li><a href="../es501984/index.html">¿Qué ver en cuarentena? Una selección de materiales de Technostream (parte 4)</a></li>
<li><a href="../es501986/index.html">Secretos del increíble éxito de Apple AirPods</a></li>
<li><a href="../es501988/index.html">¿Cómo se visualiza la pantalla del mensaje VK?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>