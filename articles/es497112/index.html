<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>   Actualizaci贸n del proceso de CI / CD: despliegue de pulpo   锔</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La tercera parte del art铆culo trata sobre la actualizaci贸n de los procesos de CI / CD. 
 
 En esta etapa, tenemos (al menos deber铆amos tener) una com...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Actualizaci贸n del proceso de CI / CD: despliegue de pulpo</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/497112/"><img src="https://habrastorage.org/webt/ll/fr/wq/llfrwqyrix6tk6l50b5sk86rqtm.png" alt="imagen" align="left" width="300"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La tercera parte del art铆culo trata sobre la actualizaci贸n de los procesos de CI / CD.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En esta etapa, tenemos (al menos deber铆amos tener) una comprensi贸n de c贸mo funcionar谩 CI, lo que tenemos en la entrada, c贸mo obtener el resultado y qu茅 se debe hacer para que la salida de la construcci贸n se convierta en un m贸dulo de proyecto completo y comience. Adem谩s de un pulpo establecido (preferiblemente LTS). En la 煤ltima parte, se consider贸 el proceso de configuraci贸n de teamcity: todo lo que sucede desde el momento en que el c贸digo ingresa al repositorio y hasta que se puede desempaquetar el archivo listo, y en teor铆a, deber铆a funcionar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recuerdo la tabla de contenido: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 1: qu茅 es, por qu茅 no es as铆, planificaci贸n, una peque帽a fiesta.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Yo llamar铆a a esta parte casi t茅cnica. </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 2: teamcity. </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 3: despliegue de pulpo.</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parte 4: detr谩s de escena. </font><font style="vertical-align: inherit;">Momentos desagradables, planes para el futuro, posiblemente preguntas frecuentes. </font><font style="vertical-align: inherit;">Lo m谩s probable es que tambi茅n se le pueda llamar casi t茅cnico.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pulpo: general</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la entrada, tenemos el c贸digo, en la salida, los artefactos de ensamblaje, todo est谩 claro aqu铆. </font><font style="vertical-align: inherit;">Pero el resultado para cada m贸dulo consta de dos partes: un paquete central (el resultado de la compilaci贸n misma) y un paquete individual (configuraciones y bibliotecas 煤nicas). </font><font style="vertical-align: inherit;">Entonces, para que un m贸dulo en particular funcione, necesitamos algo como lo siguiente:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una instancia en IIS que tiene su propio grupo y que "se ve" en la ra铆z del documento. </font><font style="vertical-align: inherit;">Se asigna un grupo separado para cada m贸dulo.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Archivos del paquete principal en la ra铆z del documento.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Archivos de paquetes individuales en la ra铆z del documento.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es aconsejable hacer una copia de seguridad del contenido anterior de la ra铆z del documento frente a todo esto. </font><font style="vertical-align: inherit;">Nosotros, por supuesto, confiamos en nosotros mismos, pero las personas se dividen en dos tipos: los que no respaldan y los que </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ya lo</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hacen.&nbsp;</font></font></li>
<li>  ( )       ( ).    ,     ,   .</li>
<li>   ,    ,    .</li>
<li>   ,   .</li>
<li>    ()    .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No tanto, pero no lo suficiente. </font><font style="vertical-align: inherit;">No hay problemas con el paso 1. </font><font style="vertical-align: inherit;">Octopus tiene una plantilla Deploy to IIS, tiene todo lo que necesita. </font><font style="vertical-align: inherit;">En los pasos 2 y 3 nos detendremos con m谩s detalle a continuaci贸n. </font><font style="vertical-align: inherit;">Para el paso 4, una variable solicitada es suficiente, que pasaremos de teamcity. </font><font style="vertical-align: inherit;">El paso 5 es un script de PowerShell. </font><font style="vertical-align: inherit;">Tambi茅n rotar谩 las copias de seguridad. </font><font style="vertical-align: inherit;">驴Por qu茅 necesitamos almacenarlos todos? Los viejos se pueden eliminar. </font><font style="vertical-align: inherit;">El paso 6 tambi茅n es PowerShell. </font><font style="vertical-align: inherit;">Paso 7: la holgura finalizada: plantilla de notificaci贸n detallada. </font><font style="vertical-align: inherit;">Paso 8: nuevamente PowerShell. </font><font style="vertical-align: inherit;">Parece un plan, por lo que lo implementaremos.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inquilinos</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un poco m谩s de detalles sobre los pasos 2 y 3. Supongo que el lector est谩 familiarizado con el despliegue de pulpo. Si no, hay maravillosos (y 煤nicos) art铆culos en el centro. Pueden dar una comprensi贸n b谩sica. Aqu铆 est谩n: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uno</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">segundo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Por lo tanto, tenemos pesta帽as de proyectos, infraestructura, inquilinos, bibliotecas, tareas y configuraciones actuales. Necesario - inquilinos. La traducci贸n literal de la palabra inquilino es inquilino. En este contexto, muy probablemente se refer铆a al cliente, el cliente. Oktopus nos dice que los inquilinos le permiten implementar diferentes instancias de un proyecto a la vez para muchos clientes (inquilinos). Esta es la p谩gina con su lista.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gf/u-/xr/gfu-xrcwm5ehwz023dggr3e-vhs.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este caso, los inquilinos se usan de manera un poco diferente. Cada inquilino representa a un cliente individual. Para el inquilino existe la oportunidad de agregar proyectos que se lanzar谩n cuando se implemente. En consecuencia, habr谩 un proyecto central y un proyecto individual. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay dos etiquetas para cada inquilino: TenantRole: com煤n para todos, lo que indica que un m贸dulo de un tipo espec铆fico (n煤cleo) se implementa en todos los inquilinos con esta etiqueta, y ModName es una etiqueta que coincide con el nombre del m贸dulo (individual).&nbsp; </font></font><br>
<br>
<img src="https://habrastorage.org/webt/k5/iu/0f/k5iu0fknzckzncis11o2y0xmkd4.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El 煤ltimo pulpo se recibe de timcity como par谩metro, identificando as铆 el m贸dulo que se </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">implementa</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> actualmente ( </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">Deploy.Env y Deploy.2</font></a><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como puede ver en la pantalla, al implementar un m贸dulo para una organizaci贸n espec铆fica, el proyecto central comenzar谩 primero ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">despliegue.2 paso de teamcity</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), luego un proyecto individual ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pasos deploy.3 y deploy.4 teamcity</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Cada inquilino tiene acceso a las variables de todos los proyectos que est谩n incluidos en 茅l, as铆 como a las variables del inquilino en s铆 (recopiladas en un conjunto de variables y que contienen la etiqueta ModName). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sk/zs/3c/skzs3cxhjryge9jcrvu8alp2skg.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&nbsp;El inquilino para la implementaci贸n se selecciona en el equipo de la siguiente manera:&nbsp;</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">variable env.tenantRoleTag: contiene TenantRole (nombre de etiqueta de inquilino en pulpo) y su valor real;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.modName: el valor de la etiqueta ModName en octopus.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Variables</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las variables son una parte importante del proyecto y deben estructurarse correctamente. </font><font style="vertical-align: inherit;">En este proyecto, las variables de pulpo se dividen en tres tipos: comunes para todos los proyectos (recopilados en el conjunto de la Biblioteca "Entorno"), individuales para cada proyecto (configurados directamente en el proyecto) y variables directamente de los inquilinos (tambi茅n un conjunto de biblioteca). </font><font style="vertical-align: inherit;">En el Medio Ambiente, como ya se mencion贸, todo lo com煤n para todos los proyectos, en particular:&nbsp;</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rutas base a la ra铆z del documento (por ejemplo, C: \ inetpub \);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">URL base (por ejemplo, para todos los m贸dulos, el dominio com煤n es organization.com);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">acceso a bases de datos (necesarias para organizar copias de seguridad);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">etc.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una gran ventaja es que en el pulpo para cada entorno puede haber un valor variable. La separaci贸n puede ser cualquier cosa. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/59/qx/ag/59qxag_xyk4vlnmqwxgc9tphyuu.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por ejemplo, las l铆neas 3, 6 y 7 en la pantalla. La l铆nea 3 es un caso com煤n. Todo lo que debe implementarse en el entorno de producci贸n llega aqu铆. Las l铆neas 6 y 7 describen casos bastante espec铆ficos, por ejemplo: el entorno de producci贸n con el rol "Sitio web de la empresa" (l铆nea 6) y el entorno de producci贸n con la etiqueta de inquilino "orgznizationX". Esto es necesario para identificar los servidores en los que se obtendr谩 el paquete, porque para la organizaci贸n X, por ejemplo, se asigna un servidor separado.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las variables para el proyecto incluyen todo lo dem谩s. </font><font style="vertical-align: inherit;">Algo que no es com煤n y difiere para diferentes entornos, por ejemplo, el nombre de dominio completo del m贸dulo. </font><font style="vertical-align: inherit;">En general, se compila como # {Tenant.ModName}. # {BaseModuleDomain}, sin embargo, puede ser diferente en algunos casos. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ne/19/cx/ne19cx7wbn5t0k8rctfcc53-ocq.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&nbsp;Tal caso se presenta en la imagen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Canales</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todav铆a vale la pena hablar sobre los canales. </font><font style="vertical-align: inherit;">Breve y r谩pidamente: los canales le permiten configurar la l贸gica de implementaci贸n. </font><font style="vertical-align: inherit;">Muy sencillo, esto se describe en la documentaci贸n oficial, en particular </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu铆</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu铆</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Por ejemplo, un lanzamiento con solo la etiqueta estable puede ingresar al canal de producci贸n, etc. </font><font style="vertical-align: inherit;">Hay 4 canales en el proyecto que coinciden con los entornos (desarrollo, prueba, puesta en escena, producci贸n). </font><font style="vertical-align: inherit;">Los lanzamientos caen en ellos de acuerdo con las etiquetas de prelanzamiento. </font><font style="vertical-align: inherit;">Se indica en el formato de n煤mero de compilaci贸n teamcity ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Build.Configuraci贸n general</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de la parte sobre teamcity). </font><font style="vertical-align: inherit;">Desde teamcity, el canal se transfiere en el paso </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deploy.2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> al campo adicional de argumentos de la l铆nea de comando (par谩metro --channel).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Patrones</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si a煤n no ha apreciado todas las ventajas de usar plantillas al leer un art铆culo sobre teamcity, ahora es el momento. Es aconsejable crear plantillas de pasos personalizados que sean lo suficientemente comunes, ya que si es necesario realizar ediciones, tendr谩 que recordar en qu茅 lugares se aplica este paso, haga clic en cada lugar similar y realice las ediciones tantas veces como los use para este paso. En este proyecto, se crearon plantillas para verificar el estado del sitio y enviar una lista de dominios a teamcity. Considere brevemente el proceso de creaci贸n de una plantilla. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay un script de PowerShell que debe ejecutarse cada vez que se despliega cualquier m贸dulo.</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$url</span> = <span class="hljs-string">"<span class="hljs-variable">$scheme</span>"</span> + <span class="hljs-string">"://"</span> + <span class="hljs-string">"<span class="hljs-variable">$domain</span>"</span>
<span class="hljs-built_in">Write-Host</span> <span class="hljs-string">"Requesting '<span class="hljs-variable">$url</span>'"</span>
[<span class="hljs-type">Net.ServicePointManager</span>]::SecurityProtocol = [<span class="hljs-type">Net.SecurityProtocolType</span>]::Tls12
<span class="hljs-variable">$request</span> = [<span class="hljs-type">System.Net.WebRequest</span>]::Create(<span class="hljs-variable">$url</span>)
<span class="hljs-variable">$request</span>.Timeout = <span class="hljs-variable">$timeout</span>
<span class="hljs-variable">$response</span> = <span class="hljs-variable">$request</span>.GetResponse()
<span class="hljs-variable">$response</span>.Close()
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El script acepta el esquema de entrada, el dominio y el tiempo de espera despu茅s del cual creemos que el sitio no est谩 operativo. </font><font style="vertical-align: inherit;">Puede crear una plantilla en Biblioteca - Plantillas de pasos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ingrese un nombre, elija un logotipo. </font><font style="vertical-align: inherit;">A continuaci贸n, configure los par谩metros de entrada y sus valores predeterminados. </font><font style="vertical-align: inherit;">El valor predeterminado tambi茅n puede ser el valor de la variable especificada (el valor de la variable # {HostName} es el valor predeterminado del par谩metro de entrada # {Domain}). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sm/1b/hd/sm1bhd7tlanxkhokj5ykkwndnqy.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci贸n, modificamos un poco el script y lo agregamos como un paso para la ejecuci贸n: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/an/ae/jo/anaejohklygki3oeyvzdf9wzwf8.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listo. </font><font style="vertical-align: inherit;">En la salida, obtenemos una plantilla de pasos con la que es agradable trabajar, y tambi茅n, en ausencia de nuestro trabajo, los colegas podr谩n descubrir los valores de campo sin leer los scripts oscuros.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zn/wh/cb/znwhcbju96vpkpnojnkahezaink.png" alt="imagen"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pulpo: detalles del proceso</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos los proyectos se dividen en grupos, la descripci贸n se llevar谩 a cabo en el ejemplo del grupo M贸dulos. </font><font style="vertical-align: inherit;">Contiene los siguientes proyectos:&nbsp;</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n煤cleo;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proyectos de m贸dulos individuales.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comencemos con el proyecto central. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu铆 est谩 la p谩gina de resumen: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/h1/ej/l8/h1ejl8qvrwpp86te_6pls3nkkwi.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu铆 puede ver claramente qu茅 versiones del kernel obtuvieron. </font><font style="vertical-align: inherit;">Pido disculpas por la confusi贸n en los n煤meros de versi贸n, ahora estamos cambiando a versiones vinculadas a la etiqueta git, y en todas partes, excepto en producci贸n, ya se utilizan nuevas versiones. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como puede ver, para algunos inquilinos no hay entornos definidos. </font><font style="vertical-align: inherit;">O a煤n no se han creado o no se han previsto.&nbsp;</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Proceso de implementaci贸n central</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la etapa de entrega del kernel, tambi茅n se realizan parte de las operaciones de servicio, a saber, la copia de seguridad de la base de datos (si es necesario), la copia de seguridad de la versi贸n anterior de los archivos, la rotaci贸n de copias de seguridad y la implementaci贸n del kernel.&nbsp;</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mq/xe/jn/mqxejndhfnxbgb80o5bvfery-ls.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Paso 1: copia de seguridad de la base de datos. </font><font style="vertical-align: inherit;">Es opcional y se basa en el valor del par谩metro variable que se pasa de teamcity en el paso </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementar.2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> al campo adicional de argumentos de la l铆nea de comando. </font><font style="vertical-align: inherit;">De forma predeterminada, esta variable se establece en falso, ya que la copia de seguridad de la base de datos debe hacerse solo a pedido, y no constantemente. </font><font style="vertical-align: inherit;">En la ciudad del equipo, comenzar cambiando este par谩metro se ve as铆 (debe hacer clic en los puntos suspensivos al lado del bot贸n de ejecuci贸n): </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ru/48/s3/ru48s3ycp-wc53-ikai6vjwzqy0.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
en Octopus, se ve as铆: a&nbsp; </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ec/ua/xo/ecuaxoycij2hzotqmux4sjjrcmw.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
continuaci贸n, no hay nada inusual. </font><font style="vertical-align: inherit;">Una copia de respaldo de los archivos en zip (por plantilla), rotaci贸n de respaldo (el script ser谩 un poco m谩s bajo) y una implementaci贸n del n煤cleo por plantilla.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A qu茅 debe prestar atenci贸n:&nbsp;</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">todos los par谩metros importantes est谩n establecidos por variables, esto le permite cambiar r谩pidamente su valor en un lugar sin profundizar en la configuraci贸n del proceso;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el nombre del grupo de IIS coincide con el nombre de la instancia y el nombre del dominio del servicio (por conveniencia);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en el paso de despliegue IIS, se instala Fusionar con enlaces existentes, en lugar de reemplazar. </font><font style="vertical-align: inherit;">Dado que, adem谩s del servicio, todav铆a tenemos un mont贸n de dominios de clientes en cada instancia;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La limpieza de la ra铆z del documento (marca de verificaci贸n purgar este directorio antes de la instalaci贸n) falla. </font><font style="vertical-align: inherit;">Los archivos nuevos reemplazan a los viejos a medida que los copia. </font><font style="vertical-align: inherit;">Esto se hace para que el sitio no se "bloquee" durante la implementaci贸n. </font><font style="vertical-align: inherit;">La demora en cargar la p谩gina es mucho mejor que la pantalla de la muerte.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Script de rotaci贸n de respaldo:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$days</span> = <span class="hljs-variable">$OctopusParameters</span>[<span class="hljs-string">"DaysStoreBackups"</span>]
<span class="hljs-variable">$limit</span> = (<span class="hljs-built_in">Get-Date</span>).AddDays(-<span class="hljs-variable">$days</span>)
<span class="hljs-variable">$pathDb</span> = <span class="hljs-variable">$OctopusParameters</span>[<span class="hljs-string">"DbBackupDir"</span>]
<span class="hljs-variable">$pathFiles</span> = <span class="hljs-variable">$OctopusParameters</span>[<span class="hljs-string">"FilesBackupDir"</span>] + <span class="hljs-string">'\'</span> + <span class="hljs-variable">$OctopusParameters</span>[<span class="hljs-string">"HostName"</span>]<font></font>
<font></font>
<span class="hljs-comment"># Delete files older than the $limit.</span>
<span class="hljs-built_in">Get-ChildItem</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$pathDb</span> <span class="hljs-literal">-Recurse</span> <span class="hljs-literal">-Force</span> | <span class="hljs-built_in">Where-Object</span> { !<span class="hljs-variable">$_</span>.PSIsContainer <span class="hljs-operator">-and</span> <span class="hljs-variable">$_</span>.CreationTime <span class="hljs-operator">-lt</span> <span class="hljs-variable">$limit</span> } | <span class="hljs-built_in">Remove-Item</span> <span class="hljs-literal">-Force</span>
<span class="hljs-comment"># Delete any empty directories left behind after deleting the old files.</span>
<span class="hljs-built_in">Get-ChildItem</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$pathDb</span> <span class="hljs-literal">-Recurse</span> <span class="hljs-literal">-Force</span> | <span class="hljs-built_in">Where-Object</span> { <span class="hljs-variable">$_</span>.PSIsContainer <span class="hljs-operator">-and</span> (<span class="hljs-built_in">Get-ChildItem</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$_</span>.FullName <span class="hljs-literal">-Recurse</span> <span class="hljs-literal">-Force</span> | <span class="hljs-built_in">Where-Object</span> { !<span class="hljs-variable">$_</span>.PSIsContainer }) <span class="hljs-operator">-eq</span> <span class="hljs-variable">$null</span> } | <span class="hljs-built_in">Remove-Item</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-Recurse</span><font></font>
<font></font>
<span class="hljs-comment"># Delete files older than the $limit.</span>
<span class="hljs-built_in">Get-ChildItem</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$pathFiles</span> <span class="hljs-literal">-Recurse</span> <span class="hljs-literal">-Force</span> | <span class="hljs-built_in">Where-Object</span> { !<span class="hljs-variable">$_</span>.PSIsContainer <span class="hljs-operator">-and</span> <span class="hljs-variable">$_</span>.CreationTime <span class="hljs-operator">-lt</span> <span class="hljs-variable">$limit</span> } | <span class="hljs-built_in">Remove-Item</span> <span class="hljs-literal">-Force</span>
<span class="hljs-comment"># Delete any empty directories left behind after deleting the old files.</span>
<span class="hljs-built_in">Get-ChildItem</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$pathFiles</span> <span class="hljs-literal">-Recurse</span> <span class="hljs-literal">-Force</span> | <span class="hljs-built_in">Where-Object</span> { <span class="hljs-variable">$_</span>.PSIsContainer <span class="hljs-operator">-and</span> (<span class="hljs-built_in">Get-ChildItem</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$_</span>.FullName <span class="hljs-literal">-Recurse</span> <span class="hljs-literal">-Force</span> | <span class="hljs-built_in">Where-Object</span> { !<span class="hljs-variable">$_</span>.PSIsContainer }) <span class="hljs-operator">-eq</span> <span class="hljs-variable">$null</span> } | <span class="hljs-built_in">Remove-Item</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-Recurse</span>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El proceso de implementaci贸n de un paquete individual</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la etapa de entrega de un paquete de m贸dulo individual, se despliegan las configuraciones y las bibliotecas 煤nicas, se localizan y / o renombran los archivos, se solicita el sitio (primero, los sitios en .net se cargan por primera vez durante mucho tiempo, este paso le permite realizar este procedimiento de inmediato, y en segundo lugar, le permite comprender si hay alg煤n error al cargar el sitio). </font><font style="vertical-align: inherit;">Tambi茅n se env铆a una notificaci贸n a slack, y una lista real de todos los dominios que pertenecen a este m贸dulo se transfiere a teamcity.&nbsp;</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zh/vk/pr/zhvkprmelbx8edaxft0imsokmja.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De lo importante:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En el paso de implementaci贸n, la ra铆z del documento no se limpia (el nuevo paquete principal ya est谩 all铆);</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Paso 3, el gui贸n. </font><font style="vertical-align: inherit;">Fue un poco m谩s alto en la descripci贸n de las plantillas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Paso 5. Tambi茅n se asocia con el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deploy.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> paso </font><font style="vertical-align: inherit;">en TeamCity. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En pulpo, se ve as铆:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$baseDomain</span> = <span class="hljs-variable">$OctopusParameters</span>[<span class="hljs-string">"HostName"</span>]
<span class="hljs-variable">$domains</span> = (<span class="hljs-built_in">Get-WebBinding</span> <span class="hljs-variable">$baseDomain</span>).bindingInformation | %{ <span class="hljs-variable">$_</span>.Split(<span class="hljs-string">':'</span>)[<span class="hljs-number">2</span>] } | <span class="hljs-built_in">Sort-Object</span> | <span class="hljs-built_in">Get-Unique</span>
<span class="hljs-built_in">Write-Host</span> <span class="hljs-string">"##teamcity[setParameter name='AllInstanceDomains' value='<span class="hljs-variable">$domains</span>']"</span>
<span class="hljs-built_in">Write-Host</span> <span class="hljs-string">"##teamcity[setParameter name='ServiceDomain' value='<span class="hljs-variable">$baseDomain</span>']"</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La sintaxis </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">## teamcity ... le</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> permite establecer el par谩metro de compilaci贸n en teamcity. </font><font style="vertical-align: inherit;">En realidad, en este, este paso se ve as铆:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Write-Host</span> <span class="hljs-string">"All domains on instance %ServiceDomain% :"</span>
<span class="hljs-variable">$domains</span> = <span class="hljs-string">"%AllInstanceDomains%"</span>
<span class="hljs-variable">$domains</span> = <span class="hljs-variable">$</span>(<span class="hljs-variable">$domains</span>.Split(<span class="hljs-string">" "</span>) | <span class="hljs-built_in">ForEach-Object</span> {<span class="hljs-string">"http://<span class="hljs-variable">$_</span>"</span>} | <span class="hljs-built_in">Out-String</span>)
<span class="hljs-built_in">Write-Host</span> <span class="hljs-variable">$domains</span>
<span class="hljs-built_in">Write-Host</span> <span class="hljs-string">"Service domain: http://%ServiceDomain%"</span>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pulpo: resultados</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo el proceso de construcci贸n es el siguiente:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el c贸digo se recopila de una rama espec铆fica (correspondiente al entorno);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El resultado del ensamblaje (artefactos) se entrega al pulpo y consta de dos partes: el n煤cleo y un paquete de m贸dulo individual. </font><font style="vertical-align: inherit;">Esto permite un uso eficiente del espacio en disco y ahorra tiempo de entrega general de actualizaciones.&nbsp;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cada paquete tiene una versi贸n que consta de un n煤mero y una etiqueta de prelanzamiento que define el canal y el entorno en el que se realizar谩 este lanzamiento.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Octopus, por entrada, crea una versi贸n y entrega paquetes a los servidores apropiados, guiados por los datos de la organizaci贸n (etiquetas de inquilino), canales (etiqueta de prelanzamiento) e instrucciones adicionales (copia de seguridad opcional de la base de datos), y tambi茅n realiza una verificaci贸n elemental del rendimiento del m贸dulo.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eso es algo as铆. </font><font style="vertical-align: inherit;">Lo m谩s probable es que haya otro art铆culo casi t茅cnico, por as铆 decirlo, detr谩s de escena. </font><font style="vertical-align: inherit;">Incluir谩 todo lo que no ingres贸 aqu铆: algunos detalles, lo que se convirti贸 en nuevo en el proceso de trabajo y lo que puede tener que enfrentar para aquellos que deciden sobre esto, correcciones y actualizaciones en el proyecto, tal vez preguntas / respuestas frecuentes. </font><font style="vertical-align: inherit;">Gracias por la atenci贸n.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es497098/index.html">C贸mo hicimos el primer piloto autom谩tico para una cosechadora de an谩lisis de video en el mundo</a></li>
<li><a href="../es497100/index.html">Lanza Jupyter en 贸rbita LXD</a></li>
<li><a href="../es497106/index.html">Simulador de red tutorial ns-3. Cap铆tulos 1.2</a></li>
<li><a href="../es497108/index.html">Fighting Covid-2019: llega el gran turno</a></li>
<li><a href="../es497110/index.html">驴Necesito actuaci贸n de voz para videoclips sobre juegos?</a></li>
<li><a href="../es497114/index.html">Es hora de vertedero</a></li>
<li><a href="../es497116/index.html">Los camiones no tripulados de Starsky Robotics llegan a su fin</a></li>
<li><a href="../es497118/index.html">[Pron贸stico] 驴Terminar谩n todos los camiones no tripulados o solo Starsky Robotics?</a></li>
<li><a href="../es497126/index.html">T茅cnicas de puntuaci贸n y priorizaci贸n de pedidos acumulados</a></li>
<li><a href="../es497132/index.html">#SaveFirst Initiative para apoyar proyectos socialmente importantes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>