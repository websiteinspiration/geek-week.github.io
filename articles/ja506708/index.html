<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘§ğŸ¾ ğŸ‘©ğŸ»â€ğŸ¤ ğŸ® VPN / Mikrotik 2è¦ç´ èªè¨¼-ã‚·ãƒ³ãƒ—ãƒ«ã§ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ« â³ ğŸ·ï¸ ğŸ¤¬</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ã“ã‚“ã«ã¡ã¯ï¼
 
 ã“ã®è¨˜äº‹ã‚’æ›¸ããŸã‚ã«ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¨˜äº‹ã®åŒæ§˜ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’èª­ã‚€ã‚ˆã†ã«ä¿ƒã•ã‚Œã¾ã—ãŸnkusnetsovã€‚ãƒ“ãƒ¥ãƒ¼ã®æ•°ã¯ã€ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãŒã“ã®ãƒˆãƒ”ãƒƒã‚¯ã«èˆˆå‘³ã‚’æŒã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚
 
 ã—ãŸãŒã£ã¦ã€ç§ã¯ä»¥å‰ã«ç§ãŒå®Ÿè£…ã—ãŸç‹¬è‡ªã®ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚ãªãŸã¨å…±æœ‰ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚
 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>VPN / Mikrotik 2è¦ç´ èªè¨¼-ã‚·ãƒ³ãƒ—ãƒ«ã§ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/506708/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã‚“ã«ã¡ã¯ï¼</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã®è¨˜äº‹ã‚’æ›¸ããŸã‚</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã«ã€</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">è¨˜äº‹ã®åŒæ§˜ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„</font></a><font style="vertical-align: inherit;">ã‚’èª­ã‚€ã‚ˆã†ã«ä¿ƒã•ã‚Œã¾ã—ãŸ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nkusnetsov</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ãƒ“ãƒ¥ãƒ¼ã®æ•°ã¯ã€ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãŒã“ã®ãƒˆãƒ”ãƒƒã‚¯ã«èˆˆå‘³ã‚’æŒã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã—ãŸãŒã£ã¦ã€ç§ã¯ä»¥å‰ã«ç§ãŒå®Ÿè£…ã—ãŸç‹¬è‡ªã®ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚ãªãŸã¨å…±æœ‰ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½ãƒ¬ãƒ™ãƒ«ã®ã‚¨ãƒ³ãƒˆãƒªã¨ã‚³ãƒ¼ãƒ‰ã®ã‚·ãƒ³ãƒ—ãƒ«ã•ï¼ˆä»–ã®å¾“æ¥­å“¡ã«ã‚ˆã‚‹ç†è§£/ãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å˜ç´”ãªROSã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯è² è·ã‚’ä½œæˆã›ãšã€hAP Liteã§ã‚‚æ©Ÿèƒ½ã—ã¾ã™</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£-è² è·ã¾ãŸã¯åœ°ç†çš„ãªåˆ†æ•£ã‚’è»½æ¸›ã™ã‚‹ãŸã‚ã«å¤šæ•°ã®VPNã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã‚’æ¥ç¶šã™ã‚‹æ©Ÿèƒ½</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikrotik CHRã‚’VPNã‚µãƒ¼ãƒãƒ¼ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹æ©Ÿèƒ½</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€Œ1xNã€-è² è·ã®å¢—åŠ ã«ä¼´ã†æ‹¡å¼µã®å¯èƒ½æ€§ãŒã‚ã‚‹ç„¡åˆ¶é™ã®æ•°ã®ãƒ«ãƒ¼ã‚¿ãƒ¼ç”¨ã®1ã¤ã®SMSã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ¥ã®ãƒ«ãƒ¼ã‚¿ãƒ¼ã‚’ã€Œç‰¹å®šã®ã€ãƒ¢ãƒ‡ãƒ ã«ãƒã‚¤ãƒ³ãƒ‰ã™ã‚‹æ©Ÿèƒ½ï¼ˆä½•ã®ãŸã‚ã«ï¼Ÿ-è©³ç´°ã¯å¾Œã»ã©ï¼‰</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒªãƒ¢ãƒ¼ãƒˆã‚µãƒ¼ãƒãƒ¼ã§1ã¤ã®phpã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ã™ã‚‹</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPNæ¥ç¶šã‚’é–‹å§‹ã—ãŸãƒ‡ãƒã‚¤ã‚¹ã€SMSã‹ã‚‰ã®ãƒªãƒ³ã‚¯ã«ã‚ˆã‚‹èªè¨¼ã¯é–¢ä¿‚ã‚ã‚Šã¾ã›ã‚“</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚µãƒ¼ãƒãƒ¼ã«å¾“æ¥­å“¡ã®æ‰¿èªã‚’è¨˜éŒ²ã™ã‚‹æ©Ÿèƒ½</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¤‡æ•°ã®ãƒ¢ãƒ‡ãƒ ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«SMSã‚’é€ä¿¡ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒˆãƒˆãƒ¬ãƒ©ãƒ³ã‚¹ã‚’å‘ä¸Šã•ã›ã€ã‚·ã‚¹ãƒ†ãƒ ã®è² è·ã‚’è»½æ¸›ã—ã¾ã™</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPD 1.0-PHPã‚³ãƒ¼ãƒ‰ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ã“ã‚Œã«ã¯ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¸ã®ã™ã¹ã¦ã®è¦æ±‚ã®ãƒ­ã‚®ãƒ³ã‚°ã¨ã€è¤‡æ•°ã®ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯è¤‡æ•°ã®ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã‚’ä»‹ã—ã¦ãƒ©ãƒ³ãƒ€ãƒ ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹ã“ã¨ãŒå«ã¾ã‚Œã¾ã™ã€‚</font></font><br>
<br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å•é¡Œã¨è§£æ±ºç­–ã®èª¬æ˜</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¿ã‚¹ã‚¯1</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã®ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã®é–‹ç™ºãƒ—ãƒ­ã‚»ã‚¹ã§ã¯ã€USBãƒ¢ãƒ‡ãƒ ã®æ•°ã‚’æœ€å°é™ã«æŠ‘ãˆã‚‹ã‚ˆã†ã«ã‚¿ã‚¹ã‚¯ã‚’è¨­å®šã—ã¾ã—ãŸ-æ‰€æœ‰ã‚³ã‚¹ãƒˆã‚’å‰Šæ¸›ã—ã€ç®¡ç†ã‚’ç°¡ç•¥åŒ–ã—ã€ãƒ¢ãƒ‡ãƒ ã‚’1ã‹æ‰€ã«ãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚ºã—ã¦ã€ã‚·ã‚¹ãƒ†ãƒ ã®ä¿å®ˆæ€§ã‚’å‘ä¸Šã•ã›ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã€Œä¿¡é ¼ã§ãã‚‹ãƒãƒ£ãƒãƒ«ã€ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸ1å°ã®ãƒ«ãƒ¼ã‚¿ãƒ¼ã‚’åŸºæœ¬çš„ãªSMSã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒæ±ºå®šã•ã‚Œã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ç§ãŒçŸ¥ã‚‰ãªã‹ã£ãŸå”¯ä¸€ã®ã“ã¨ã¯ã€ã‚·ã‚¹ãƒ†ãƒ ã®è² è·ã€ãƒ¢ãƒ‡ãƒ ãŒå¯¾å¿œã—ã€ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼ãŒãã‚Œã‚’ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹ã‹ã©ã†ã‹ã§ã—ãŸã€‚</font><font style="vertical-align: inherit;">ã—ãŸãŒã£ã¦ã€ç§ã¯ã„ãã¤ã‹ã®ãƒ¢ãƒ‡ãƒ ã‚’æ¥ç¶šã—ã€ã‚·ã‚¹ãƒ†ãƒ ã‚’ã•ã‚‰ã«ã‚°ãƒ«ãƒ¼ãƒ—ã«åˆ†å‰²ã™ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ã•ã‚‰ã«ã€è¿½åŠ ã®ãƒ¢ãƒ‡ãƒ ã‚’å˜ç´”ãªUSBãƒãƒ–ã‚’ä»‹ã—ã¦ãƒ™ãƒ¼ã‚¹ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã«æ¥ç¶šã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãŸã ã—ã€å®Œå…¨ã«æ©Ÿèƒ½ã™ã‚‹ã«ã¯ã€ãƒ«ãƒ¼ã‚¿ãƒ¼ã®æ•°ã«é–¢ä¿‚ãªãã€æœ€å°é™ã®æ©Ÿèƒ½ã§1ã¤ã®ãƒ¢ãƒ‡ãƒ ãŒå¿…è¦ã§ã™ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¿ã‚¹ã‚¯2</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ«ãƒ¼ã‚¿ãƒ¼ã®è¨­ç½®ã‚¨ãƒªã‚¢ã§ãƒ­ãƒ¼ã‚«ãƒ«SIMã‚«ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¾‹ï¼šã‚«ã‚¶ãƒ•ã‚¹ã‚¿ãƒ³ã«è¤‡æ•°ã®åº—èˆ—ãŒã‚ã‚‹åºƒã„æ”¯åº—ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã€‚</font><font style="vertical-align: inherit;">ãƒ­ã‚·ã‚¢é€£é‚¦ã‹ã‚‰ã®SMSãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€ä¿¡ã¯éå¸¸ã«è²»ç”¨ãŒã‹ã‹ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚Šã€ã‚«ã‚¶ãƒ•ã‚¹ã‚¿ãƒ³ã®å¾“æ¥­å“¡ã¯å¸‚å†…ç•ªå·ã‹ã‚‰SMSã‚’å—ä¿¡ã§ãã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã—ã‹ã—ã€åçœã®éç¨‹ã§ã€è§£æ±ºç­–ã¯ã™ã§ã«ã‚¿ã‚¹ã‚¯1ã§è¦‹ã¤ã‹ã‚Šå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¿ã‚¹ã‚¯3</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‰¿èªæ¸ˆã¿ãƒ‡ãƒã‚¤ã‚¹ã«ç‰©ç†çš„ã«ã„ã‚‹å¿…è¦ãŒãªã„ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒã‚¤ã‚¹ã‹ã‚‰ã®æ‰¿èªã®ãƒˆãƒ³ãƒãƒ«ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç›®æ¨™ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒˆãƒ³ãƒãƒ«ã ã‘ã§ãªãã€VPNæ¥ç¶šï¼ˆMikrotik-&gt; Mikrotikã€Server-&gt; Mikrotikãªã©ï¼‰ã‚‚æ‰¿èªã™ã‚‹æ©Ÿèƒ½ã§ã™ã€‚ã“ã®å ´åˆã€ã“ã‚Œã‚‰ã®ãƒˆãƒ³ãƒãƒ«ã‚’æ‹…å½“ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€SMSãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰ã®ãƒªãƒ³ã‚¯ã‚’ãŸã©ã‚‹ã ã‘ã§æ¸ˆã¿ã¾ã™ã€‚ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸã„ãƒˆãƒ³ãƒãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã®ã‚ˆã†ã«èªè¨¼ã‚’è¡Œã†å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å¤–éƒ¨ãƒªã‚½ãƒ¼ã‚¹ï¼ˆã©ã“ã‹ã‚‰ã§ã‚‚ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚µãƒ¼ãƒãƒ¼ï¼‰ã«è»¢é€ã—ã€èªè¨¼ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒªã‚¹ãƒˆã‚’ãƒãƒ¼ã‚¯ã—ã€ãã®å¾Œãƒ­ãƒƒã‚¯ã‚’è§£é™¤ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã®å•é¡Œã®è§£æ±ºç­–ã¯ã€RouterOS APIï¼ˆã¾ãŸã¯SSHï¼‰ã®ä½¿ç”¨ã‚’ã™ã§ã«æ˜ç¢ºã«æš—ç¤ºã—ã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">APIãŒæœ€ã‚‚ç°¡å˜ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ã—ã¦å‹ã¡ã¾ã—ãŸã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ­ã‚¸ãƒƒã‚¯</font></font></h2><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯äº‹å‰ã«è¿½åŠ ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPNã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã¯ãã®IPã‚’ã‚¢ãƒ‰ãƒ¬ã‚¹å¾…æ©Ÿãƒªã‚¹ãƒˆã«å…¥ã‚Œã€ã‚µãƒ¼ãƒãƒ¼ã«POSTè¦æ±‚ã‚’é€ä¿¡ã—ã¾ã™</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚µãƒ¼ãƒãƒ¼ã¯ãƒ‡ãƒ¼ã‚¿ã‚’å—ä¿¡ã—ã€ç¢ºèªã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã€èªè¨¼ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¦ã€ãƒ•ã‚©ãƒ¼ãƒ ã®é€£çµ¡å…ˆç•ªå·ã«SMSã‚’é€ä¿¡ã—ã¾ã™ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ä»»æ„ã®ãƒ‡ãƒã‚¤ã‚¹ã‹ã‚‰ãƒªãƒ³ã‚¯ã‚’ãŸã©ã‚Šã¾ã™</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚µãƒ¼ãƒãƒ¼ã¯ãƒ«ãƒ¼ã‚¿ãƒ¼ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã€ã‚³ãƒ¡ãƒ³ãƒˆã«èªè¨¼ã‚³ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã‚‹ã‚¨ãƒ³ãƒˆãƒªã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒªã‚¹ãƒˆã«å­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã£ãŸå ´åˆã€ãã‚Œã‚’å‰Šé™¤ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æˆåŠŸã—ãŸãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»–ã®ã™ã¹ã¦ã®ã‚±ãƒ¼ã‚¹ã§ã¯ã€ä½•ã‹ãŒãƒ†ã‚¹ãƒˆã«åˆæ ¼ã—ãªã„å ´åˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼ã‚’å—ã‘å–ã‚Šã¾ã™ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¨ã‚³ãƒ¼ãƒ‰</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¬¡ã«ã€æ¦‚å¿µçš„ãªéƒ¨åˆ†ã‹ã‚‰Mikrotikã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã€ã‚³ãƒ¼ãƒ‰ã¨ãã®èª¬æ˜ã«ç§»ã‚Šã¾ã—ã‚‡ã†</font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èª¬æ˜ï¼šã“ã‚Œã‚‰ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¨phpã‚³ãƒ¼ãƒ‰ã¯ã€ã‚ã‚‰ã‚†ã‚‹ã‚¿ã‚¤ãƒ—ã®VPNã‚µãƒ¼ãƒãƒ¼ã§æ©Ÿèƒ½ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚µãƒ¼ãƒãƒ¼ã®ç¨®é¡ï¼ˆPPP / L2TP / SSTPï¼‰ã‚’é¸æŠã—ã€ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒˆãƒ³ãƒãƒ«ã‚’è¨­å®šã—ã¾ã™ã€‚ã€Œå¥½ã¿ã«å¿œã˜ã¦ã€é¸æŠã—ã¾ã™ãŒã€ã‚¯ã‚¤ãƒƒã‚¯ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®ä¸€èˆ¬çš„ãªä¾‹ã‚’ç¤ºã—ã¾ã™ã€‚</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikrotikã«è¿½åŠ ï¼š</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«</font></font></h4><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¨±å¯ã•ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹ã®ãƒªã‚¹ãƒˆã‚’å¿…ãšä½œæˆã—ã¦ãã ã•ã„ã€‚ãã®ä¸­ã«ã¯ã€ç‹¬è‡ªã®MTã‚¢ãƒ‰ãƒ¬ã‚¹ã€ãƒ‘ãƒ–ãƒªãƒƒã‚¯DNSã€èªè¨¼ãŒè¡Œã‚ã‚Œã‚‹ã‚µãƒ¼ãƒãƒ¼ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒã‚ã‚Šã¾ã™ã€‚</font></font></b>
                        <div class="spoiler_text"><pre><code class="plaintext hljs">/ip firewall address-list<font></font>
add address=10.10.0.1 list=Allow-list<font></font>
add address=8.8.8.8 list=Allow-list<font></font>
add address=synome.ru list=Allow-list</code></pre><br>
</div>
                    </div><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¾…æ©Ÿãƒªã‚¹ãƒˆã‹ã‚‰è¨±å¯ã•ã‚Œã¦ã„ãªã„ãƒ›ã‚¹ãƒˆã¸ã®VPNãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹ãƒ«ãƒ¼ãƒ«ã‚’è¿½åŠ ã™ã‚‹</font></font></b>
                        <div class="spoiler_text"><pre><code class="plaintext hljs">/ip firewall raw<font></font>
add action=drop chain=prerouting dst-address-list=!Allow-list src-address-list=VPN-blocked disabled=no</code></pre><br>
</div>
                    </div><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PPPãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚¢ã‚¤ãƒ‰ãƒ«æ¥ç¶šã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’è¨­å®šã—ãŸãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">æ™‚é–“ã¯ã€æ¬¡ã®On Upã‚¹ã‚¯ãƒªãƒ—ãƒˆã§æŒ‡å®šã—ãŸæ™‚é–“ã‚ˆã‚Šã‚‚çŸ­ãã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã‚Œä»¥å¤–ã®å ´åˆã¯ã€èªè¨¼ãŒè¡Œã‚ã‚Œã¦ã„ãªã„å ´åˆã€ãƒªã‚¹ãƒˆã‚’ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒªã‚¹ãƒˆã‹ã‚‰å‰Šé™¤ã—ãŸå¾Œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãã®å·®ï¼ˆã‚¢ã‚¤ãƒ‰ãƒ«ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ-ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒªã‚¹ãƒˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼‰ã«ç­‰ã—ã„æ™‚é–“ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’è¿½åŠ </font></font></b>
                        <div class="spoiler_text"><pre><code class="plaintext hljs">/ppp profile<font></font>
add dns-server=10.10.0.1 idle-timeout=59m local-address=10.10.1.1 name=2F-VPN use-compression=no use-encryption=no use-mpls=no</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¬¡ã«ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®æœ€å¾Œã®ã‚¿ãƒ–ã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¾ã™ã€‚</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸Šã«</font></font></b>
                        <div class="spoiler_text"><pre><code class="plaintext hljs">:global ruid "#ROUTERLOGIN#";<font></font>
:global pass "#ROUTER_PASSWORD#";<font></font>
:local userip [/ppp active get [find name=$user] address];<font></font>
# if phone number stored in comment<font></font>
#:local userphone [/ppp secret get [find name=$user] comment];<font></font>
# if phone number = username<font></font>
:local userphone $user;<font></font>
<font></font>
:local authkey [/tool fetch http-method=post http-data="ruid=$ruid&amp;pass=$pass&amp;tel=$userphone" url="https://yourwebsite.ru/" mode=https as-value output=user];<font></font>
<font></font>
/ip firewall address-list remove [find address=$userip];<font></font>
/ip firewall address-list add address=$userip list=VPN-blocked timeout=1h comment=($authkey-&gt;"data");<font></font>
<font></font>
:log info message="User connect:";<font></font>
:log info message=$userphone;<font></font>
:log info message=$userip;<font></font>
:log info message=($authkey-&gt;"data");</code></pre><br>
</div>
                    </div><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ€ã‚¦ãƒ³</font></font></b>
                        <div class="spoiler_text"><pre><code class="plaintext hljs">:local userip [/ppp secret get [find name=$user] remote-address];<font></font>
/ip firewall address-list remove [find address=$userip];<font></font>
:log info message="User disconnect:";<font></font>
:log info message=$user;<font></font>
:log info message=$userip;</code></pre><br>
</div>
                    </div><br>
<i> <br>
<br>
 :         ,     .        (      )   ip-.  POST-        .  ip-  address-list VPN-blocked       -  1     .    .<br>
<br>
 :  ip- ,    address-list  .    .</i><br>
<br>
<h4>PPP Secrets</h4><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"> </b>
                        <div class="spoiler_text"><pre><code class="plaintext hljs">/ppp secret<font></font>
add comment="70001112233" name=70001112233 password=testuser profile=2F-VPN remote-address=10.10.1.100</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é›»è©±ç•ªå·ã¯åå‰ã§ç›´æ¥æŒ‡å®šã§ãã¾ã™ãŒã€ï¼ˆè¤‡æ•°ã®ãƒˆãƒ³ãƒãƒ«ã®æ‰¿èªã®ãŸã‚ã«ï¼‰è¤‡æ•°ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«1ã¤ã®ç•ªå·ã‚’æŒ‡å®šã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹å ´åˆã¯ã€ã‚³ãƒ¡ãƒ³ãƒˆã«ç•ªå·ã‚’ç¤ºã—ã¾ã™ãŒã€On Upã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã¯ã€è¡Œã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¤‰æ›´ï¼ˆ2ç•ªç›®ã‚’é–‹ãã€4ç•ªç›®ã‚’é–‰ã˜ã‚‹ï¼‰</font></font></b>
                        <div class="spoiler_text"><pre><code class="plaintext hljs"># if phone number stored in comment<font></font>
:local userphone [/ppp secret get [find name=$user] comment];<font></font>
# if phone number = username<font></font>
#:local userphone $user;</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ€ã‚‚é‡è¦ãªã®ã¯ã€PPTPã‚µãƒ¼ãƒãƒ¼ã¾ãŸã¯L2TPã‚µãƒ¼ãƒãƒ¼ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã“ã¨ã§ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã‚Œã§Mikrotikã§ä½œæ¥­ã¯å®Œäº†ã§ã™ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PHPãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»¥ä¸‹ã¯ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚</font><font style="vertical-align: inherit;">å½¼ã¯ååˆ†è©³ç´°ã«ã‚³ãƒ¡ãƒ³ãƒˆã—ãŸã®ã§ã€ç§ã¯ä½™åˆ†ãªãƒ†ã‚­ã‚¹ãƒˆã‚’æ›¸ãã¾ã›ã‚“ã€‚</font><font style="vertical-align: inherit;">æœ€ã‚‚é‡è¦ãªã“ã¨ã¯ã€$ hostã¨$ ruid_dataã®ãƒ‡ãƒ¼ã‚¿ã‚’ç‹¬è‡ªã®ã‚‚ã®ã«ç½®ãæ›ãˆã‚‹ã“ã¨ã§ã™ã€‚</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">index.php</font></font></b>
                        <div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-comment">// ------------------------------------------------------------------------------</span>
<span class="hljs-comment">//   Copyright () 2020</span>
<span class="hljs-comment">//  Author: Dmitri Agababaev, d.agababaev@duncat.net</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">//  Copyright by authors for used RouterOS PHP API class in the source code files</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">//  Redistributions and use of source code, with or without modification, are</span>
<span class="hljs-comment">//  permitted that retain the above copyright notice</span>
<span class="hljs-comment">// ------------------------------------------------------------------------------</span><font></font>
<font></font>
<span class="hljs-keyword">require_once</span>(<span class="hljs-string">'routeros_api.class.php'</span>);<font></font>
<font></font>
<span class="hljs-comment">// -------------------------</span>
<span class="hljs-comment">//   </span>
<span class="hljs-comment">// BASE SETTINGS</span>
<span class="hljs-comment">// -------------------------</span><font></font>
<font></font>
$uselog = <span class="hljs-literal">true</span>; <span class="hljs-comment">// //  ? | Use log? true | false</span>
$log_path = <span class="hljs-string">'mt2Fvpn.log'</span>; <span class="hljs-comment">//     | Log file path</span>
$host = <span class="hljs-string">'https://yourwebsite.com/'</span>; <span class="hljs-comment">//       | Full address that this script awalible</span><font></font>
<font></font>
<span class="hljs-comment">//    /VPN- | ROUTERS DATA ARRAY USED AS VPN-SERVERS</span>
$ruid_data = <span class="hljs-keyword">array</span>(
    <span class="hljs-comment">//   md5,  ip-,    , , SMS-     SMS</span>
    <span class="hljs-comment">// password in md5, global ip-address, mikrotik login, password, SMS-gateway-key will be use to send sms</span>
    <span class="hljs-string">'#ROUTERLOGIN#'</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-string">'mdpass'</span> =&gt; <span class="hljs-string">'#ROUTER_MD5_PASSWORD#'</span>,
                          <span class="hljs-string">'ip'</span> =&gt; <span class="hljs-string">'XXX.XXX.X.X'</span>,
                          <span class="hljs-string">'login'</span> =&gt; <span class="hljs-string">'#ROSAPI_LOGIN#'</span>,
                          <span class="hljs-string">'password'</span> =&gt; <span class="hljs-string">'#PASSWORD#'</span>,
                          <span class="hljs-string">'smsgw'</span> =&gt; <span class="hljs-keyword">array</span>(
                                           <span class="hljs-comment">//    SMS     (   )</span>
                                           <span class="hljs-comment">// If you want send SMS randomly from any SMS-gateways, add one here (low modem load)</span>
                                           <span class="hljs-number">0</span> =&gt; <span class="hljs-string">'SMS_gw1'</span>)<font></font>
                          )<font></font>
    );<font></font>
<font></font>
<span class="hljs-comment">//       SMS- | ROUTERS DATA ARRAY WILL BE USED TO SEND AUTHERIZATION SMS</span>
$SMS_gateway = <span class="hljs-keyword">array</span>(
    <span class="hljs-comment">// ip-  (        ), , ,  USB-,  USB-</span>
    <span class="hljs-comment">// ip-address (global or local if used in one local network with server), login, password, USB-modem port, USB-modem channel</span>
    <span class="hljs-string">'SMS_gw1'</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-string">'ip'</span> =&gt; <span class="hljs-string">'XXX.XXX.X.X'</span>, <span class="hljs-string">'login'</span> =&gt; <span class="hljs-string">'#ROSAPI_LOGIN#'</span>, <span class="hljs-string">'password'</span> =&gt; <span class="hljs-string">'#PASSWORD#'</span>, <span class="hljs-string">'port'</span> =&gt; <span class="hljs-string">'#USB_PORT#'</span>, <span class="hljs-string">'channel'</span> =&gt; <span class="hljs-string">'#USB_CHANNEL#'</span>)<font></font>
    );<font></font>
<font></font>
<font></font>
<span class="hljs-comment">// -------------------------</span>
<span class="hljs-comment">//   </span>
<span class="hljs-comment">// INPUT DATA CHECK</span>
<span class="hljs-comment">// -------------------------</span>
<span class="hljs-keyword">if</span> (!$_REQUEST) <span class="hljs-keyword">die</span>(<span class="hljs-string">'Request error'</span>); <span class="hljs-comment">//    â€“  | if request free - reset</span>
<span class="hljs-keyword">if</span> (!$_REQUEST[<span class="hljs-string">'ruid'</span>]) <span class="hljs-keyword">die</span>(<span class="hljs-string">'Request error'</span>); <span class="hljs-comment">//    ruid -  | if ruid not isset â€“ reset</span>
<span class="hljs-keyword">if</span> (!array_key_exists($_REQUEST[<span class="hljs-string">'ruid'</span>], $ruid_data)) <span class="hljs-keyword">die</span>(<span class="hljs-string">'Request error'</span>); <span class="hljs-comment">//     â€“  | if router does not exist â€“ reset</span>
<span class="hljs-keyword">if</span> ($_REQUEST[<span class="hljs-string">'auth'</span>]) autorize(); <span class="hljs-comment">//    ,        | if auth request allow without password</span>
<span class="hljs-keyword">if</span> (!ruid_auth()) <span class="hljs-keyword">die</span>(<span class="hljs-string">'Request error'</span>); <span class="hljs-comment">//      SMS | check ruid password</span>
<span class="hljs-keyword">if</span> ($_REQUEST[<span class="hljs-string">'tel'</span>]) send_authcode(); <span class="hljs-comment">//    ,  SMS | if phone number isset â€“ sending SMS</span><font></font>
<font></font>
<span class="hljs-comment">//          </span>
<span class="hljs-comment">// CHECK FOR ROUTER (ruid) IS IN ALLOWED LIST</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ruid_auth</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">global</span> $ruid_data;
  <span class="hljs-keyword">if</span> (!$_REQUEST[<span class="hljs-string">'pass'</span>]) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">//     â€“  | if password not set - reset</span>
  <span class="hljs-comment">//  md5-  | check password md5-hash</span>
  <span class="hljs-keyword">if</span> (md5($_REQUEST[<span class="hljs-string">'pass'</span>]) == $ruid_data[$_REQUEST[<span class="hljs-string">'ruid'</span>]][<span class="hljs-string">'mdpass'</span>]) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// ---------------------------------------------------------</span>
<span class="hljs-comment">//        ROS API</span>
<span class="hljs-comment">// SEND AUTHERIZATION SMS VIA ROS API FUNCTION</span>
<span class="hljs-comment">// ---------------------------------------------------------</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">send_authcode</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">global</span> $ruid_data;
  <span class="hljs-keyword">global</span> $host;<font></font>
<font></font>
  <span class="hljs-comment">//    | Get random SMS-gateway</span>
  $sms_gw = $ruid_data[$_REQUEST[<span class="hljs-string">'ruid'</span>]][<span class="hljs-string">'smsgw'</span>][array_rand($ruid_data[$_REQUEST[<span class="hljs-string">'ruid'</span>]][<span class="hljs-string">'smsgw'</span>], <span class="hljs-number">1</span>)]; <span class="hljs-comment">//  sms-</span>
  <span class="hljs-comment">//         | Generate auth-code and add to REQUEST array</span>
  $_REQUEST[<span class="hljs-string">'authcode'</span>] = substr(str_shuffle(<span class="hljs-string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNPQRSTUVWXYZ123456789'</span>), <span class="hljs-number">0</span>, <span class="hljs-number">5</span>);
  <span class="hljs-comment">//   | connect class</span>
  $API = <span class="hljs-keyword">new</span> RouterosAPI();
  <span class="hljs-comment">//     â€“  eng  </span>
  <span class="hljs-comment">// Create message that will be sent to user</span>
  $message = <span class="hljs-string">'To autorize user '</span>.$_REQUEST[<span class="hljs-string">'tel'</span>].<span class="hljs-string">' connection open â€“ '</span>.$host.<span class="hljs-string">'?ruid='</span>.$_REQUEST[<span class="hljs-string">'ruid'</span>].<span class="hljs-string">'&amp;auth='</span>.$auth_code;
  <span class="hljs-comment">//    SMS | if connected successfully - sending message</span>
  <span class="hljs-keyword">if</span> ($API-&gt;connect($SMS_gateway[$sms_gw][<span class="hljs-string">'ip'</span>], $SMS_gateway[$sms_gw][<span class="hljs-string">'login'</span>], $SMS_gateway[$sms_gw][<span class="hljs-string">'password'</span>])) {
      <span class="hljs-comment">//   SMS | SMS send command</span>
      $ARRAY = $API-&gt;comm(<span class="hljs-string">"/tool/sms/send"</span>, <span class="hljs-keyword">array</span>(
      <span class="hljs-string">"port"</span>=&gt;$SMS_gateway[$sms_gw][<span class="hljs-string">'port'</span>],
      <span class="hljs-string">"channel"</span>=&gt;$SMS_gateway[$sms_gw][<span class="hljs-string">'channel'</span>],
      <span class="hljs-string">"phone-number"</span>=&gt;$_REQUEST[<span class="hljs-string">'tel'</span>],
      <span class="hljs-string">"message"</span>=&gt;<span class="hljs-string">"To autorize user "</span>.$_REQUEST[<span class="hljs-string">'tel'</span>].<span class="hljs-string">" connection open â€“ "</span>.$host.<span class="hljs-string">"?ruid="</span>.$_REQUEST[<span class="hljs-string">'ruid'</span>].<span class="hljs-string">"&amp;auth="</span>.$_REQUEST[<span class="hljs-string">'authcode'</span>],));
      <span class="hljs-comment">//        ,     usb   </span>
      <span class="hljs-comment">// Checking if send failed and error message return, will make usb power-reset to restart modem</span>
      <span class="hljs-keyword">if</span>($ARRAY[<span class="hljs-string">'!trap'</span>]) {<font></font>
        $API-&gt;comm(<span class="hljs-string">"/system/routerboard/usb/power-reset"</span>);
        <span class="hljs-comment">//   | save log</span>
        <span class="hljs-comment">//       | Add error to array and save all array to log</span>
        $_REQUEST[<span class="hljs-string">'ERROR'</span>] = $ARRAY[<span class="hljs-string">'!trap'</span>][<span class="hljs-number">0</span>][<span class="hljs-string">'message'</span>];<font></font>
        writelog(<span class="hljs-string">'MODEM ERROR'</span>);
        <span class="hljs-keyword">die</span>(<span class="hljs-string">'Stop with error: '</span>.$ARRAY[<span class="hljs-string">'!trap'</span>][<span class="hljs-number">0</span>][<span class="hljs-string">'message'</span>].<span class="hljs-string">' Making power reset of usb-port'</span>);}<font></font>
  }<font></font>
<font></font>
  $API-&gt;disconnect();<font></font>
  <span class="hljs-comment">//   | save log</span>
  writelog(<span class="hljs-string">'SEND AUTH CODE'</span>);
  <span class="hljs-keyword">die</span>($_REQUEST[<span class="hljs-string">'authcode'</span>]);<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-comment">// --------------------------------------------------------------------</span>
<span class="hljs-comment">//    ROS API â€“   ADDRESS-LIST</span>
<span class="hljs-comment">// AUTHERIZATION USING ROS API FUNCTION â€“ DELETE LIST FROM ADDRESS-LIST</span>
<span class="hljs-comment">// --------------------------------------------------------------------</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">autorize</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">global</span> $ruid_data;
  <span class="hljs-comment">//   | connect class</span>
  $API = <span class="hljs-keyword">new</span> RouterosAPI();
  <span class="hljs-keyword">if</span> ($API-&gt;connect($ruid_data[$_REQUEST[<span class="hljs-string">'ruid'</span>]][<span class="hljs-string">'ip'</span>], $ruid_data[$_REQUEST[<span class="hljs-string">'ruid'</span>]][<span class="hljs-string">'login'</span>], $ruid_data[$_REQUEST[<span class="hljs-string">'ruid'</span>]][<span class="hljs-string">'password'</span>])) {
    <span class="hljs-comment">//     | if connected successfully - sending command</span>
    $API-&gt;write(<span class="hljs-string">'/ip/firewall/address-list/print'</span>, <span class="hljs-literal">false</span>);<font></font>
    $API-&gt;write(<span class="hljs-string">'?comment='</span>.$_REQUEST[<span class="hljs-string">'auth'</span>], <span class="hljs-literal">false</span>);<font></font>
    $API-&gt;write(<span class="hljs-string">'=.proplist=.id'</span>);
    <span class="hljs-comment">//   | get response</span><font></font>
    $ARRAYS = $API-&gt;read();<font></font>
    <span class="hljs-comment">//      - - </span>
    <span class="hljs-comment">// IF NO RECORD IN FIREWALL ADDRESS_LIST â€“ RESET</span>
    <span class="hljs-keyword">if</span> (!$ARRAYS[<span class="hljs-number">0</span>]) <span class="hljs-keyword">die</span>(<span class="hljs-string">'Request error'</span>);
    <span class="hljs-comment">//   | delete firewall address-list</span>
    $API-&gt;write(<span class="hljs-string">'/ip/firewall/address-list/remove'</span>, <span class="hljs-literal">false</span>);<font></font>
    $API-&gt;write(<span class="hljs-string">'=.id='</span> . $ARRAYS[<span class="hljs-number">0</span>][<span class="hljs-string">'.id'</span>]);<font></font>
    $READ = $API-&gt;read();<font></font>
  }<font></font>
  $API-&gt;disconnect();<font></font>
  <span class="hljs-comment">//   | save log</span>
  writelog(<span class="hljs-string">'AUTHERIZATION'</span>);<font></font>
<font></font>
  <span class="hljs-comment">//     </span>
  <span class="hljs-comment">// SHOW SUCCESS PAGE TO USER</span>
  <span class="hljs-keyword">die</span>(<span class="hljs-string">'
      &lt;!DOCTYPE html&gt;
      &lt;html lang="ru"&gt;
      &lt;meta http-equiv="Content-Type" content="charset=utf-8" /&gt;
      &lt;body style="font-family: Verdana, Arial, Helvetica, sans-serif; background-color: #282c34; color: #fff; height: 100vh; display: flex;"&gt;
        &lt;div style="margin: auto; max-width: 50%;"&gt;
          &lt;p style="font-size: 24pt; font-weight: bold; margin: -300px 0 50px;"&gt;
            VPN-   ,   
          &lt;/p&gt;
          &lt;p style="font-size: 14pt; color: #aaa;"&gt;
                     &lt;br/&gt;
          &lt;/p&gt;
        &lt;/div&gt;
      &lt;/body&gt;
      &lt;/html&gt;
    '</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// ------------------------</span>
<span class="hljs-comment">//   </span>
<span class="hljs-comment">// SAVE LOG FUNCTION</span>
<span class="hljs-comment">// ------------------------</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">writelog</span>(<span class="hljs-params">$type</span>) </span>{
  <span class="hljs-keyword">global</span> $uselog;
  <span class="hljs-keyword">global</span> $log_path;
  <span class="hljs-comment">//  $uselog == false â€“ </span>
  <span class="hljs-keyword">if</span> (!$uselog) <span class="hljs-keyword">return</span>;
  <span class="hljs-comment">//   | save log</span>
  $fp = fopen($log_path, <span class="hljs-string">'a'</span>);<font></font>
  fputs($fp, <span class="hljs-string">"\n\nDate = "</span> . date(<span class="hljs-string">"Y-m-d H:i:s"</span>).<span class="hljs-string">"\n"</span>);<font></font>
  fputs($fp, $type.<span class="hljs-string">"\n"</span>);<font></font>
  fputs($fp, print_r($_REQUEST, <span class="hljs-literal">true</span>));<font></font>
  fclose($fp);<font></font>
}<font></font>
<font></font>
<span class="hljs-meta">?&gt;</span>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚³ãƒ¼ãƒ‰ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹RouterOS APIã‚¯ãƒ©ã‚¹PHPã¯ã€</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã§</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">å–å¾—</font></a><font style="vertical-align: inherit;">ã§ãã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¸…è´ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ç§ã¯ã©ã‚“ãªã‚³ãƒ¡ãƒ³ãƒˆã§ã‚‚å–œã‚“ã§ã„ã¾ã™ã€‚</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja506698/index.html">ã€æµ·ä¸Šãƒ­ãƒ¼ãƒ³ãƒã€ã®ãƒ¬ã‚¯ã‚¤ã‚¨ãƒ </a></li>
<li><a href="../ja506700/index.html">PlayMarketã§ã®ãã®å¾Œã®å±•é–‹ã§Androidã®GitHubã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ§‹æˆã—ã¾ã™</a></li>
<li><a href="../ja506702/index.html">Backblaze Q1 2020ã«ã‚ˆã‚‹æœ€ã‚‚ä¿¡é ¼æ€§ã®é«˜ã„HDD</a></li>
<li><a href="../ja506704/index.html">2020å¹´ã«PHPã§è¨˜è¿°ã™ã‚‹ç†ç”± Holivarimã¯ä»Šé€±æœ¨æ›œæ—¥ã«YouTubeã§ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªãƒãƒƒãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã§ã™</a></li>
<li><a href="../ja506706/index.html">å¤§é‡ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†ã™ã‚‹ã¨ãã®æœ€æ–°ã®Javaã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã€ãƒ‘ãƒ¼ãƒˆ1</a></li>
<li><a href="../ja506710/index.html">Zimbra Collaboration Suite Open-Source Editionã§è¤‡æ•°ã®ã‚¢ãƒ‰ãƒ¬ã‚¹å¸³ã‚’ç®¡ç†ã™ã‚‹</a></li>
<li><a href="../ja506716/index.html">ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ç·šå½¢ãƒªã‚¹ãƒˆï¼šè¦ç´ ã®å­˜åœ¨å•é¡Œã€ç”Ÿç”£æ€§ã®å‘ä¸Šã€ãŠã‚ˆã³STLé–¢ä¿‚</a></li>
<li><a href="../ja506726/index.html">ã‚·ã‚¹ãƒ†ãƒ ã§ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç™»éŒ²ã¨æ‰¿èªã«Rutokenãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã‚’ä½¿ç”¨ã—ãŸçµŒé¨“ï¼ˆãƒ‘ãƒ¼ãƒˆ2ï¼‰</a></li>
<li><a href="../ja506730/index.html">Snortã¾ãŸã¯Suricataã€‚ãƒ‘ãƒ¼ãƒˆ1ï¼šä¼æ¥­ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä¿è­·ã™ã‚‹ãŸã‚ã®ç„¡æ–™ã®IDS / IPSã‚’é¸æŠã™ã‚‹</a></li>
<li><a href="../ja506732/index.html">UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çµ„ç¹”å…¨ä½“ã§ã®å†åˆ©ç”¨</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>