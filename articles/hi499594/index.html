<!doctype html>
<html class="no-js" lang="hi">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯЪБ тЬЛЁЯП╝ ЁЯд╖ЁЯП╗ HAProxy рдореЗрдВ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рдЖрд╡реГрддреНрддрд┐ рдХреЛ рдХреИрд╕реЗ рд╕реАрдорд┐рдд рдХрд░реЗрдВ: рдЪрд░рдг-рджрд░-рдЪрд░рдг рдирд┐рд░реНрджреЗрд╢ ЁЯСБя╕П ЁЯзХ ЁЯСиЁЯП┐тАНЁЯН│</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рд▓реЗрдЦрдХ рдмрддрд╛рддрд╛ рд╣реИ рдХрд┐ рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рдЖрдИрдкреА-рдкрддреЛрдВ рдХреЗ рд╕рд╛рде HAProxy рдХреНрд╡реЗрд░реА рдЧрддрд┐ рд╕реАрдорд╛ (рджрд░ рд╕реАрдорд┐рдд) рдореЗрдВ рдХреИрд╕реЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рдП ред Mail.ru рдХреНрд▓рд╛рдЙрдб рд╕реЙрд▓реНрдпреВрд╢рдВрд╕ рдЯреАрдо рдиреЗ рдЙрдирдХреЗ рд▓реЗрдЦ рдХрд╛ рдЕ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>HAProxy рдореЗрдВ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рдЖрд╡реГрддреНрддрд┐ рдХреЛ рдХреИрд╕реЗ рд╕реАрдорд┐рдд рдХрд░реЗрдВ: рдЪрд░рдг-рджрд░-рдЪрд░рдг рдирд┐рд░реНрджреЗрд╢</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/499594/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/000/ebc/00e/000ebc00ecfca624add0621c731f2405.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд▓реЗрдЦрдХ рдмрддрд╛рддрд╛ рд╣реИ рдХрд┐ </font><font style="vertical-align: inherit;">рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рдЖрдИрдкреА-рдкрддреЛрдВ рдХреЗ рд╕рд╛рде </font><font style="vertical-align: inherit;">HAProxy </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрд╡реЗрд░реА рдЧрддрд┐ рд╕реАрдорд╛</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (рджрд░ рд╕реАрдорд┐рдд) </font><font style="vertical-align: inherit;">рдореЗрдВ рдХреИрд╕реЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рдП </font><font style="vertical-align: inherit;">ред </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mail.ru рдХреНрд▓рд╛рдЙрдб рд╕реЙрд▓реНрдпреВрд╢рдВрд╕</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЯреАрдо рдиреЗ </font><font style="vertical-align: inherit;">рдЙрдирдХреЗ рд▓реЗрдЦ рдХрд╛ рдЕрдиреБрд╡рд╛рдж рдХрд┐рдпрд╛ - рд╣рдореЗрдВ рдЙрдореНрдореАрдж рд╣реИ рдХрд┐ рдЗрд╕рдХреЗ рд╕рд╛рде рдЖрдкрдХреЛ рдЙрд╕ рдкрд░ рдЙрддрдирд╛ рд╕рдордп рдФрд░ рдкреНрд░рдпрд╛рд╕ рдирд╣реАрдВ рдХрд░рдирд╛ рдкрдбрд╝реЗрдЧрд╛ рдЬрд┐рддрдирд╛ рдХрд┐ рдЖрдкрдХреЛ рдЗрд╕реЗ рдЦрд░реНрдЪ рдХрд░рдирд╛ рдерд╛ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рддрдереНрдп рдпрд╣ рд╣реИ рдХрд┐ рдпрд╣ DoS рдХреЗ рд╣рдорд▓реЛрдВ рд╕реЗ рд╕рд░реНрд╡рд░ рдХреЛ рдмрдЪрд╛рдиреЗ рдХреЗ рд╕рдмрд╕реЗ рд▓реЛрдХрдкреНрд░рд┐рдп рддрд░реАрдХреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рд╕реНрдкрд╖реНрдЯ рдирд┐рд░реНрджреЗрд╢ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдореБрд╢реНрдХрд┐рд▓ рд╣реИ рдХрд┐ рдЗрд╕реЗ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдХреИрд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛рдПред рдкрд░реАрдХреНрд╖рдг рдФрд░ рддреНрд░реБрдЯрд┐ рд╕реЗ, рд▓реЗрдЦрдХ рдиреЗ рдЖрдИрдкреА рдкрддреЗ рдХреА рдПрдХ рд╕реВрдЪреА рдкрд░ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рдЖрд╡реГрддреНрддрд┐ рдХреЛ рд╕реАрдорд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рд╛рдкреНрд░реЛрд╕реА рдХреЛ рдордЬрдмреВрд░ рдХрд┐рдпрд╛, рдЬреЛ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕рдордп рдореЗрдВ рдЕрдкрдбреЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HAProxy рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рд╕реА рдкреВрд░реНрд╡ рдЬреНрдЮрд╛рди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рд╕рднреА рдЖрд╡рд╢реНрдпрдХ рдХрджрдо рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рд╣реИрдВред</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЦреБрд▓рд╛ рд╕реНрд░реЛрдд рдФрд░ рдореБрдлреНрдд HAProxy рдПрдХ рдЕрддреНрдпрдзрд┐рдХ рд╕реБрд▓рдн рд▓реЛрдб рдмреИрд▓реЗрдВрд╕рд░ рдФрд░ рдкреНрд░реЙрдХреНрд╕реА рд╕рд░реНрд╡рд░ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рд╛рд▓ рдХреЗ рд╡рд░реНрд╖реЛрдВ рдореЗрдВ, рдпрд╣ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрд╣реБрдд рд▓реЛрдХрдкреНрд░рд┐рдп</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣реЛ рдЧрдпрд╛ рд╣реИ </font><font style="vertical-align: inherit;">рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдиреНрдпреВрдирддрдо рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЗ рд╕рд╛рде рдЙрдЪреНрдЪ рдкреНрд░рджрд░реНрд╢рди рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╡реИрдХрд▓реНрдкрд┐рдХ рдХрд╛рд░реНрдпрдХреНрд░рдореЛрдВ рдХреЗ рд╡рд┐рдкрд░реАрдд, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HAProxy рд╕рд╛рдореБрджрд╛рдпрд┐рдХ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рдВрд╕реНрдХрд░рдг рдХрд╛ рдЧреИрд░-рд▓рд╛рднрдХрд╛рд░реА рд╕рдВрд╕реНрдХрд░рдг </font><font style="vertical-align: inherit;">рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд▓реЛрдб рд╕рдВрддреБрд▓рди рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╕реБрд╡рд┐рдзрд╛рдПрдБ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рдХрд╛рд░реНрдпрдХреНрд░рдо рдкрд╣рд▓реА рдмрд╛рд░ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдХрдард┐рди рд╣реИред </font><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдБрдХрд┐, рдЙрд╕рдХреЗ рдкрд╛рд╕ рдмрд╣реБрдд рд╣реА рд╕реВрдХреНрд╖реНрдо рдФрд░ рд╡рд┐рд╕реНрддреГрдд рддрдХрдиреАрдХреА </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджрд╕реНрддрд╛рд╡реЗрдЬ рд╣реИрдВ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред </font><font style="vertical-align: inherit;">рд▓реЗрдЦрдХ рдХрд╛ рдХрд╣рдирд╛ рд╣реИ рдХрд┐ рдпрд╣ рд╕рднреА рдЦреБрд▓реЗ рд╕реНрд░реЛрдд рдХрд╛рд░реНрдпрдХреНрд░рдореЛрдВ рдХреЗ рдмреАрдЪ рд╕рдмрд╕реЗ рд╡рд┐рд╕реНрддреГрдд рджрд╕реНрддрд╛рд╡реЗрдЬ рд╣реИ рдЬреЛ рдЙрдиреНрд╣реЛрдВрдиреЗ рдХрднреА рднреА рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рд╣реИред </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рддреЛ, рдпрд╣рд╛рдВ рдПрдХ рдЪрд░рдг-рджрд░-рдЪрд░рдг рдорд╛рд░реНрдЧрджрд░реНрд╢рд┐рдХрд╛ рд╣реИред</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рд▓реЛрдб рдмреИрд▓реЗрдВрд╕рд░ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдирд╛</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕рдордп рдмрдЪрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдФрд░ рдмреБрдирд┐рдпрд╛рджреА рдврд╛рдВрдЪреЗ рдХреА рд╕реНрдерд╛рдкрдирд╛ рд╕реЗ рд╡рд┐рдЪрд▓рд┐рдд рди рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдбреЙрдХрд░</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдбреЙрдХрд░ рдХрдВрдкреЛрдЬрд╝</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЫрд╡рд┐рдпреЛрдВ рдХреЛ рд▓реЗрдВ </font><font style="vertical-align: inherit;">рдФрд░ рдЬрд▓реНрджреА рд╕реЗ рдореБрдЦреНрдп рдШрдЯрдХреЛрдВ рдХреЛ рд▓реЙрдиреНрдЪ рдХрд░реЗрдВред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкрд╣рд▓рд╛ рдХрд╛рдо рдХрдИ рдЕрдкрд╛рдЪреЗ рдмреИрдХрдПрдВрдб рд╕рд░реНрд╡рд░ рдХреЗ рд╕рд╛рде HAProxy рд▓реЛрдб рдмреИрд▓реЗрдВрд╕рд░ рдХреЗ рдХрд╛рдо рдХреЗ рдЙрджрд╛рд╣рд░рдг рдХреЛ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИред</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рднрдВрдбрд╛рд░ рдХрд╛ рдХреНрд▓реЛрди</font></font></h4><br>
<pre><code class="bash hljs">$ git <span class="hljs-built_in">clone</span> git@github.com:stargazer/haproxy-ratelimiter.git<font></font>
$ <span class="hljs-built_in">cd</span> haproxy-ratelimiter</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЖрдк </font><font style="vertical-align: inherit;">рд╕реНрдерд╛рдкрдирд╛ рдорд╛рдкрджрдВрдбреЛрдВ </font><font style="vertical-align: inherit;">рдкрд░ </font></font><code>Dockerfile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдЙрд╕рдХреЗ </font></font><code>docker-compose.yml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рде </font><font style="vertical-align: inherit;">рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред рдЙрдирдХреА рдЪрд░реНрдЪрд╛ рдЗрд╕ рд▓реЗрдЦ рдХреЗ рджрд╛рдпрд░реЗ рд╕реЗ рдкрд░реЗ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕ рддрдереНрдп рдкрд░ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЙрдиреНрд╣реЛрдВрдиреЗ </font></font><code>loadbalancer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреЛ рдмреИрдХрдПрдВрдб рд╕рд░реНрд╡рд░реЛрдВ рдХреЗ рд╕рд╛рде </font><font style="vertical-align: inherit;">рдХрд╛рдо рдХрд░рдиреЗ рд╡рд╛рд▓реЗ HAProxy рдЙрджрд╛рд╣рд░рдг </font></font><code>api01</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдмрдирд╛рдпрд╛ рд╣реИ </font></font><code>api02</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред HAProxy рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рд╢реБрд░реВ рдореЗрдВ рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ </font></font><code>haproxy-basic.cfg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдФрд░ рдлрд┐рд░ рд╕реНрд╡рд┐рдЪ рдХрд░реЗрдВрдЧреЗ </font></font><code>haproxy-ratelimiting.cfg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕рд╛рджрдЧреА рдХреЗ рд▓рд┐рдП, рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдХреЛ </font></font><code>haproxy-basic.cfg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирдВрдЧреЗ рдиреНрдпреВрдирддрдо рддрдХ рдШрдЯрд╛ </font><font style="vertical-align: inherit;">рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ </font><font style="vertical-align: inherit;">рдФрд░ рдЕрддрд┐рд░рд┐рдХреНрдд рдХреЛ рдордВрдЬреВрд░реА рджреЗ рджреА рдЧрдИ рд╣реИред рдЖрдЗрдП рдЗрд╕реЗ рджреЗрдЦреЗрдВ:</font></font><br>
<br>
<pre><code class="plaintext hljs">defaults<font></font>
mode http<font></font>
timeout connect 5000ms<font></font>
timeout client 50000ms<font></font>
timeout server 50000ms<font></font>
<font></font>
frontend proxy<font></font>
bind *:80<font></font>
<font></font>
use_backend api<font></font>
<font></font>
backend api<font></font>
balance roundrobin<font></font>
<font></font>
server api01 api01:80<font></font>
server api02 api02:80</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рдЦрдВрдб </font></font><code>frontend proxy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреЛрд░реНрдЯ 80 рдкрд░ рд╕реБрдирдиреЗ рдХреЗ рд▓рд┐рдП HAProxy рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИ рдФрд░ </font></font><code>api</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреИрдХрдПрдВрдб рдкрд░ </font><font style="vertical-align: inherit;">рд╕рд░реНрд╡рд░ рдкреВрд▓ рдореЗрдВ рд╕рднреА рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдЕрдЧреНрд░реЗрд╖рд┐рдд рдХрд░рддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╢реНрд░реЗрдгреА </font></font><code>backend api</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдкреВрд▓ рдмреИрдХреЗрдВрдб </font></font><code>api</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреЛ рдмреИрдХрдПрдВрдб рд╕рд░реНрд╡рд░ рдХреЗ рд╕рд╛рде </font></font><code>api01</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font></font><code>api02</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдЗрд╕реА рдкрддреЗред </font><font style="vertical-align: inherit;">рдкреНрд░рддреНрдпреЗрдХ рдЖрдиреЗ рд╡рд╛рд▓реЗ рдЕрдиреБрд░реЛрдз рдХреЛ рд╕рд░реНрд╡рд┐рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд░реНрд╡рд░ рдХреЛ рд▓реЛрдб рдмреИрд▓реЗрдВрд╕рд┐рдВрдЧ рдПрд▓реНрдЧреЛрд░рд┐рджрдо рджреНрд╡рд╛рд░рд╛ рдЪреБрдирд╛ рдЬрд╛рддрд╛ </font></font><code>roundrobin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реИ, рдЕрд░реНрдерд╛рддреН, рджреЛ рдЙрдкрд▓рдмреНрдз рд╕рд░реНрд╡рд░реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдмрджрд▓реЗ рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪрд▓реЛ рд╣рдорд╛рд░реЗ рддреАрдиреЛрдВ рдХрдВрдЯреЗрдирд░реЛрдВ рдХреЛ рд▓реЙрдиреНрдЪ рдХрд░рддреЗ рд╣реИрдВ</font></font></h4><br>
<pre><code class="bash hljs">$ sudo docker-compose up</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рдХрдВрдЯреЗрдирд░ рд╣реИ </font></font><code>loadbalancer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬреЛ рджреЛ рдмреИрдХрдПрдВрдб </font></font><code>api01</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font><font style="vertical-align: inherit;">рд╕рд░реНрд╡рд░ рдХреЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рдХрд░рддрд╛ рд╣реИ </font></font><code>api02</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрджрд┐ рд╣рдо рдкрддрд╛ рдмрд╛рд░ рдореЗрдВ рджрд░реНрдЬ рдХрд░рддреЗ рд╣реИрдВ рддреЛ рд╣рдореЗрдВ рдЙрдирдореЗрдВ рд╕реЗ рдПрдХ рдХрд╛ рдЬрд╡рд╛рдм рдорд┐рд▓реЗрдЧрд╛ </font></font><code>http://localhost/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкреГрд╖реНрда рдХреЛ рдХрдИ рдмрд╛рд░ рддрд╛рдЬрд╝рд╛ рдХрд░рдирд╛ рдФрд░ рд▓реЙрдЧ рджреЗрдЦрдирд╛ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ </font></font><code>docker-compose</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">api01_1 | </font><font style="vertical-align: inherit;">192.168.192.3 - - [08 / рдЬрдирд╡рд░реА / 2019: 11: 38: 09 +0000] "GET / HTTP / 1.1" 200 45</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
api02_1 | </font><font style="vertical-align: inherit;">192.168.192.3 - - [08 / рдЬрдирд╡рд░реА / 2019: 11: 38: 10 +0000] "GET / HTTP / 1.1" 304 -</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
api01_1 | </font><font style="vertical-align: inherit;">192.168.192.3 - - [08 / рдЬрдирд╡рд░реА / 2019: 11: 38: 10 +0000] "GET / HTTP / 1.1" 304 -</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
api02_1 | </font><font style="vertical-align: inherit;">192.168.192.3 - - [08 / рдЬрдирд╡рд░реА / 2019: 11: 38: 11 +0000] "GET / HTTP / 1.1" 304 -</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
api01_1 | </font><font style="vertical-align: inherit;">192.168.192.3 - - [08 / рдЬрдирд╡рд░реА / 2019: 11: 38: 11 +0000] "GET / HTTP / 1.1" 304 -</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
api02_1 | </font><font style="vertical-align: inherit;">192.168.192.3 - - [08 / рдЬрдирд╡рд░реА / 2019: 11: 38: 11 +0000] "GET / HTTP / 1.1" 304 -</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рджреЛ рд╕рд░реНрд╡рд░ </font></font><code>api</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрджрд▓реЗ рдореЗрдВ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд░рддреЗ рд╣реИрдВред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдмрд╣реБрдд рд╣реА рд╕рд░рд▓ рднрд╛рд░ рд╕рдВрддреБрд▓рди рд╡рд┐рдиреНрдпрд╛рд╕ рдХреЗ рд╕рд╛рде рдПрдХ HAProxy рдЙрджрд╛рд╣рд░рдг рд╣реИ, рдФрд░ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдХреБрдЫ рд╡рд┐рдЪрд╛рд░ рд╣реИ рдХрд┐ рдпрд╣ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдкрд░ рдПрдХ рд╕реАрдорд╛ рдЬреЛрдбрд╝реЗрдВ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд▓реЛрдб рдмреИрд▓реЗрдВрд╕рд░ рдХреЗ рд▓рд┐рдП рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдкрд░ рдПрдХ рд╕реАрдорд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ HAProxy рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдХрдВрдЯреЗрдирд░ </font></font><code>loadbalancer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ </font></font><code>haproxy-ratelimiter.cfg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдХреЛ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╕ Dockerfile рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВред</font></font><br>
<br>
<pre><code class="plaintext hljs">FROM haproxy:1.7<font></font>
COPY haproxy-ratelimiter.cfg /usr/local/etc/haproxy/haproxy.cfg</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реАрдорд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдирд╛</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕рднреА рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдкрдВрдЬреАрдХреГрдд рд╣реИрдВ </font></font><code>haproxy-ratelimiter.cfg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЖрдЗрдпреЗ рдЗрд╕рдХрд╛ рдзреНрдпрд╛рдирдкреВрд░реНрд╡рдХ рдЕрдзреНрдпрдпрди рдХрд░реЗрдВред</font></font><br>
<br>
<pre><code class="plaintext hljs">defaults<font></font>
mode http<font></font>
timeout connect 5000ms<font></font>
timeout client 50000ms<font></font>
timeout server 50000ms<font></font>
<font></font>
frontend proxy<font></font>
bind *:80<font></font>
<font></font>
# ACL function declarations<font></font>
acl is_abuse src_http_req_rate(Abuse) ge 10<font></font>
acl inc_abuse_cnt src_inc_gpc0(Abuse) gt 0<font></font>
acl abuse_cnt src_get_gpc0(Abuse) gt 0<font></font>
<font></font>
# Rules<font></font>
tcp-request connection track-sc0 src table Abuse<font></font>
tcp-request connection reject if abuse_cnt<font></font>
http-request deny if abuse_cnt<font></font>
http-request deny if is_abuse inc_abuse_cnt<font></font>
<font></font>
use_backend api<font></font>
backend api<font></font>
balance roundrobin<font></font>
<font></font>
server api01 api01:80<font></font>
server api02 api02:80<font></font>
<font></font>
backend Abuse<font></font>
stick-table type ip size 100K expire 30m store gpc0,http_req_rate(10s)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HAProxy рдирд┐рдореНрди-рд╕реНрддрд░ рдХреА рдкреНрд░рд╛рдердорд┐рдХрддрд╛рдУрдВ рдХрд╛ рдПрдХ рд╕реЗрдЯ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдЕрдзрд┐рдХ рд▓рдЪреАрд▓рд╛рдкрди рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░ рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЗ рдорд╛рдорд▓реЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдХрд╛рдЙрдВрдЯрд░ рдЕрдХреНрд╕рд░ рд╕реАрдкреАрдпреВ рдореЗрдВ рд╕рдВрдЪрд┐рдд рд░рдЬрд┐рд╕реНрдЯрд░ (рдпреЛрдЬрдХ) рдХреА рдпрд╛рдж рджрд┐рд▓рд╛рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╡реЗ рдордзреНрдпрд╡рд░реНрддреА рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддреЗ рд╣реИрдВ, рдЗрдирдкреБрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╢рдмреНрджрд╛рд░реНрде рд▓реЗрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЕрдВрдд рдореЗрдВ рд╡реЗ рдХреЗрд╡рд▓ рд╕рдВрдЦреНрдпрд╛рдПрдВ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╕рдм рдХреБрдЫ рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рд╕рдордЭрдиреЗ рдХреЗ рд▓рд┐рдП, рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдХреЗ рдмрд╣реБрдд рдЕрдВрдд рд╕реЗ рд╢реБрд░реВ рдХрд░рдирд╛ рд╕рдордЭ рдореЗрдВ рдЖрддрд╛ рд╣реИред</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрд╛рд▓рд┐рдХрд╛ </font></font><code>Abuse</code></h4><br>
<pre><code class="plaintext hljs">backend Abuse<font></font>
stick-table type ip size 100K expire 30m store gpc0,http_req_rate(10s)</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣рд╛рдВ рд╣рдордиреЗ рдПрдХ рдбрдореА рдмреИрдХрдПрдВрдб </font></font><code>Abuse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">("рджреБрд░реБрдкрдпреЛрдЧ") рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдХрд╛рд▓реНрдкрдирд┐рдХ, рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреЗрд╡рд▓ рд╕реНрдЯрд┐рдХ-рдЯреЗрдмрд▓ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рдмрд╛рдХреА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдирд╛рдо рд╕реЗ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ </font></font><code>Abuse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╕реНрдЯрд┐рдХ-рдЯреЗрдмрд▓ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдореЛрд░реА рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдПрдХ рдЯреЗрдмрд▓ рд╣реИ, рдЬрд╣рд╛рдВ рдкреНрд░рддреНрдпреЗрдХ рд░рд┐рдХреЙрд░реНрдб рдХреЗ рд▓рд┐рдП рдЖрдк рдЬреАрд╡рдирдХрд╛рд▓ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рдорд╛рд░реА рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ рд╣реИрдВ:</font></font><br>
<br>
<ul>
<li><code>type ip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдХреБрдВрдЬреА рдХреЗ рд░реВрдк рдореЗрдВ рдЖрдИрдкреА рдкрддреЗ рджреНрд╡рд╛рд░рд╛ рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рд╕рд╣реЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдПрдХ рд╣реА рдЖрдИрдкреА рдкрддреЗ рд╕реЗ рдЕрдиреБрд░реЛрдз рдПрдХ рд╣реА рд░рд┐рдХреЙрд░реНрдб рдХреЛ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░реЗрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЕрдирд┐рд╡рд╛рд░реНрдп рд░реВрдк рд╕реЗ, рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╣рдо рдЖрдИрдкреА рдкрддреЗ рдФрд░ рд╕рдВрдмрдВрдзрд┐рдд рдбреЗрдЯрд╛ рдкрд░ рдирдЬрд╝рд░ рд░рдЦ рд░рд╣реЗ рд╣реИрдВред</font></font><br>
</li>
<li><code>size 100K</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдЕрдзрд┐рдХрддрдо 100 рд╣рдЬрд╛рд░ рд░рд┐рдХреЙрд░реНрдб рд╣реИрдВред</font></font><br>
</li>
<li><code>expire 30m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: рд░рд┐рдХреЙрд░реНрдб рдкреНрд░рддрд┐рдзрд╛рд░рдг рдЕрд╡рдзрд┐ 30 рдорд┐рдирдЯ рдХреА рдирд┐рд╖реНрдХреНрд░рд┐рдпрддрд╛ рд╣реИред</font></font><br>
</li>
<li><code>store gpc0,http_req_rate(10s)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><code>gpc0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдВрддрд┐рдо 10 рд╕реЗрдХрдВрдб рдХреЗ рд▓рд┐рдП </font><font style="vertical-align: inherit;">рдХрд╛рдЙрдВрдЯрд░ </font><font style="vertical-align: inherit;">рдФрд░ рдЖрдИрдкреА рдкрддреЗ рдХреЗ рдЕрдиреБрд░реЛрдз рдХреА рд╕рдВрдЦреНрдпрд╛ </font><font style="vertical-align: inherit;">рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рд╕рдВрдЧреНрд░рд╣реАрдд рдХреА рдЬрд╛рддреА рд╣реИ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреА рдорджрдж рд╕реЗ </font></font><code>gpc0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЯреНрд░реИрдХ рдХрд░реЗрдВрдЧреЗ рдХрд┐ рдЖрдИрдкреА рдПрдбреНрд░реЗрд╕ рдХрд┐рддрдиреА рдмрд╛рд░ рдЧрд╛рд▓рд┐рдпреЛрдВ рдореЗрдВ рджреЗрдЦрд╛ рдЧрдпрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдПрдХ рд╕рдХрд╛рд░рд╛рддреНрдордХ рдХрд╛рдЙрдВрдЯрд░ рд╡реИрд▓реНрдпреВ рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЖрдИрдкреА рдкрддрд╛ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╕рдВрджрд┐рдЧреНрдз рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд┐рд╣реНрдирд┐рдд рд╣реИред </font><font style="vertical-align: inherit;">рдЪрд▓реЛ рдЗрд╕ рдХрд╛рдЙрдВрдЯрд░ рдХреЛ рдмреБрд▓рд╛рдУ </font></font><code>abuse indicator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рддрд╛рд▓рд┐рдХрд╛ </font></font><code>Abuse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдкрдХреЛ рдпрд╣ рдЯреНрд░реИрдХ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдЖрдИрдкреА рдкрддреЗ рдХреЛ рд╕рдВрджрд┐рдЧреНрдз рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд┐рд╣реНрдирд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рд╕рд╛рде рд╣реА рдЗрд╕ рдкрддреЗ рд╕реЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рд╡рд░реНрддрдорд╛рди рдЖрд╡реГрддреНрддрд┐ред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЕрднрд┐рд▓реЗрдЦреЛрдВ рдХрд╛ рдЗрддрд┐рд╣рд╛рд╕ рд╣реИ, рд╕рд╛рде рд╣реА рд╕рд╛рде рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕рдордп рдХреА рдЬрд╛рдирдХрд╛рд░реА рднреА рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдм рд╣рдо рдЕрдиреБрднрд╛рдЧ рдкрд░ рдЪрд▓рддреЗ рд╣реИрдВ </font></font><code>frontend proxy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рд╡рд╣рд╛рдВ рдХреНрдпрд╛ рдирдпрд╛ рд╣реИред</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрд╕реАрдПрд▓ рдХрд╛рд░реНрдп рдФрд░ рдирд┐рдпрдо</font></font></h4><br>
<pre><code class="plaintext hljs">frontend proxy<font></font>
bind *:80<font></font>
<font></font>
# ACL function declarations<font></font>
acl is_abuse src_http_req_rate(Abuse) ge 10<font></font>
acl inc_abuse_cnt src_inc_gpc0(Abuse) gt 0<font></font>
acl abuse_cnt src_get_gpc0(Abuse) gt 0<font></font>
<font></font>
# Rules<font></font>
tcp-request connection track-sc0 src table Abuse<font></font>
tcp-request connection reject if abuse_cnt<font></font>
http-request deny if abuse_cnt<font></font>
http-request deny if is_abuse inc_abuse_cnt<font></font>
<font></font>
use_backend api</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдПрдХреНрд╕реЗрд╕ рдХрдВрдЯреНрд░реЛрд▓ рд▓рд┐рд╕реНрдЯ (ACL) рдлрд╝рдВрдХреНрд╢рди рдШреЛрд╖рдгрд╛рдПрдБ рд╣реЛрддреА рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдХреЗрд╡рд▓ рдирд┐рдпрдо рдХреЗ рд╕реЗрдЯ рд╣реЛрдиреЗ рдкрд░ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЖрдЗрдП рд╕рднреА рддреАрди рдПрд╕реАрдПрд▓ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпреЛрдВ рдкрд░ рдПрдХ рдХрд░реАрдм рд╕реЗ рдирдЬрд╝рд░ рдбрд╛рд▓реЗрдВред </font><font style="vertical-align: inherit;">рдзреНрдпрд╛рди рд░рдЦреЗрдВ рдХрд┐ рд╡реЗ рд╕рднреА рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдПрдХ рддрд╛рд▓рд┐рдХрд╛ рдХрд╛ рд╕рдВрджрд░реНрдн рджреЗрддреЗ рд╣реИрдВ рдЬреЛ рдПрдХ </font></font><code>Abuse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрддреЗ рдХреЗ рд░реВрдк рдореЗрдВ рдЖрдИрдкреА рдкрддреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдкреНрд░рддреНрдпреЗрдХ рдлрд╝рдВрдХреНрд╢рди рдЕрдиреБрд░реЛрдз рдЖрдИрдкреА рдкрддреЗ рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрддрд╛ рд╣реИ:</font></font><br>
<br>
<ul>
<li><code>acl is_abuse src_http_req_rate(Abuse) ge 10</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: рдлрд╝рдВрдХреНрд╢рди </font></font><code>is_abuse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд╛рдкрд╕ рдЖрддрд╛ рд╣реИ </font></font><code>True</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рд╡рд░реНрддрдорд╛рди рдЕрдиреБрд░реЛрдз рдЖрд╡реГрддреНрддрд┐ рджрд╕ рд╕реЗ рдЕрдзрд┐рдХ рдпрд╛ рдЙрд╕рдХреЗ рдмрд░рд╛рдмрд░ рд╣реИред</font></font><br>
</li>
<li><code>acl inc_abuse_cnt src_inc_gpc0(Abuse) gt 0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">рд╡реЗрддрди рд╡реГрджреНрдзрд┐ </font><font style="vertical-align: inherit;">рд╢реВрдиреНрдп рд╕реЗ рдЕрдзрд┐рдХ рд╣реЛрдиреЗ рдкрд░ </font><font style="vertical-align: inherit;">рдлрд╝рдВрдХреНрд╢рди </font></font><code>inc_abuse_cnt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд╛рдкрд╕ рдЖ </font><font style="vertical-align: inherit;">рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдореВрд▓реНрдп </font><font style="vertical-align: inherit;">рд╢реВрдиреНрдп рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдлрд╝рдВрдХреНрд╢рди рд╣рдореЗрд╢рд╛ рд░рд┐рдЯрд░реНрди рдХрд░рддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рджреВрд╕рд░реЗ рд╢рдмреНрджреЛрдВ рдореЗрдВ, рдпрд╣ рдореВрд▓реНрдп рдмрдврд╝рд╛рддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">, рдЕрдирд┐рд╡рд╛рд░реНрдп рд░реВрдк рд╕реЗ рдЗрд╕ рдЖрдИрдкреА рдкрддреЗ рд╕реЗ рджреБрд░реБрдкрдпреЛрдЧ рдХрд╛ рд╕рдВрдХреЗрдд рд╣реИред</font></font><code>True</code><font style="vertical-align: inherit;"></font><code>gpc0</code><font style="vertical-align: inherit;"></font><code>gpc0</code><font style="vertical-align: inherit;"></font><code>True</code><font style="vertical-align: inherit;"></font><code>abuse indicator</code><font style="vertical-align: inherit;"></font><br>
</li>
<li><code>acl abuse_cnt src_get_gpc0(Abuse) gt 0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">рдпрджрд┐ рдорд╛рди </font><font style="vertical-align: inherit;">рд╢реВрдиреНрдп рд╕реЗ рдЕрдзрд┐рдХ </font><font style="vertical-align: inherit;">рд╣реИ, рддреЛ </font><font style="vertical-align: inherit;">рдлрд╝рдВрдХреНрд╢рди </font></font><code>abuse_cnt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓реМрдЯрддрд╛ </font><font style="vertical-align: inherit;">рд╣реИред </font><font style="vertical-align: inherit;">рджреВрд╕рд░реЗ рд╢рдмреНрджреЛрдВ рдореЗрдВ, рд╡рд╣ рдХрд╣рддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдпрд╣ рдЖрдИрдкреА рдкрддрд╛ рдкрд╣рд▓реЗ рд╣реА рдЧрд╛рд▓рд┐рдпреЛрдВ рдореЗрдВ рджреЗрдЦрд╛ рдЧрдпрд╛ рд╣реИред</font></font><code>True</code><font style="vertical-align: inherit;"></font><code>gpc0</code><font style="vertical-align: inherit;"></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЬреИрд╕рд╛ рдХрд┐ рдкрд╣рд▓реЗ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, ACL рдХреЗрд╡рд▓ рдШреЛрд╖рдгрд╛рдПрдБ рд╣реИрдВ, рдЕрд░реНрдерд╛рддреН рдлрд╝рдВрдХреНрд╢рди рдШреЛрд╖рдгрд╛рдПрдБ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╡реЗ рдЖрдиреЗ рд╡рд╛рд▓реЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдкрд░ рд▓рд╛рдЧреВ рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВ рдЬрдм рддрдХ рдХрд┐ рдХреБрдЫ рдирд┐рдпрдо рдЯреНрд░рд┐рдЧрд░ рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рдПрдХ рд╣реА рдЦрдВрдб рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдирд┐рдпрдореЛрдВ рдХреЛ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдордЭ рдореЗрдВ рдЖрддрд╛ рд╣реИ </font></font><code>frontend</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдирд┐рдпрдо рдЖрдиреЗ рд╡рд╛рд▓реЗ рдкреНрд░рддреНрдпреЗрдХ рдЕрдиреБрд░реЛрдз рдкрд░ рдПрдХ-рдПрдХ рдХрд░рдХреЗ рд▓рд╛рдЧреВ рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рдПрд╕реАрдПрд▓ рд╕реЗ рдЙрди рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдЪрд▓рд╛рддреЗ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рд╣рдордиреЗ рдЕрднреА рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЖрдЗрдП рджреЗрдЦреЗрдВ рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рдирд┐рдпрдо рдХреНрдпрд╛ рдХрд░рддрд╛ рд╣реИ:</font></font><br>
<br>
<ul>
<li><code>tcp-request connection track-sc0 src table Abuse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдПрдХ рдХреНрд╡реЗрд░реА рдЬреЛрдбрд╝рддрд╛ рд╣реИ </font></font><code>Abuse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рдХреБрдВрдЬреА рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдЖрдИрдкреА рдкрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдирд┐рдпрдо рдЖрдИрдкреА рдкрддреЗ рдХреА рд╕реВрдЪреА рдореЗрдВ рдЬреЛрдбрд╝рддрд╛ рд╣реИред</font></font><br>
</li>
<li><code>tcp-request connection reject if abuse_cnt</code>:   TCP-,  IP-    ,     abuse.  ,   TCP-   IP-.<br>
</li>
<li><code>http-request deny if abuse_cnt</code>:  ,  IP-    .        IP-,      abuse.<br>
</li>
<li><code>http-request deny if is_abuse inc_abuse_cnt</code>:  ,  <code>is_abuse</code>  <code>inc_abuse_cnt</code>   <code>True</code>.  ,    ,    IP-        ,    IP-    .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ, рд╣рдо рджреЛ рдкреНрд░рдХрд╛рд░ рдХреЗ рдЪреЗрдХ рдкреЗрд╢ рдХрд░рддреЗ рд╣реИрдВ: рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕рдордп рдореЗрдВ рдФрд░ рдХреНрд╡реЗрд░реА рдЗрддрд┐рд╣рд╛рд╕ рд╕реЗ рдмреНрд▓реИрдХрд▓рд┐рд╕реНрдЯ рдореЗрдВред </font><font style="vertical-align: inherit;">рджреВрд╕рд░рд╛ рдирд┐рдпрдо рд╕рднреА рдирдП рдЯреАрд╕реАрдкреА рдХрдиреЗрдХреНрд╢рди рдХреЛ рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд░ рджреЗрддрд╛ рд╣реИ рдпрджрд┐ рдЖрдИрдкреА рдкрддреЗ рдХреЛ рдЧрд╛рд▓рд┐рдпреЛрдВ рдореЗрдВ рджреЗрдЦрд╛ рдЧрдпрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рддреАрд╕рд░рд╛ рдирд┐рдпрдо рдЗрд╕ рд╕реВрдЪреА рд╕реЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рд╡рд░реНрддрдорд╛рди рдЖрд╡реГрддреНрддрд┐ рдХреА рдкрд░рд╡рд╛рд╣ рдХрд┐рдП рдмрд┐рдирд╛, рдХрд╛рд▓реА рд╕реВрдЪреА рд╕реЗ рдПрдХ рдЖрдИрдкреА рдкрддреЗ рдХреЗ рд▓рд┐рдП HTTP рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рд╕реЗрд╡рд╛ рдХреЛ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЪреМрдерд╛ рдирд┐рдпрдо рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдПрдХ рдЖрдИрдкреА рдкрддреЗ рд╕реЗ HTTP рдЕрдиреБрд░реЛрдз рдЙрд╕реА рдХреНрд╖рдг рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрдм рддрдХ рдХрд┐ рдЕрдиреБрд░реЛрдз рдЖрд╡реГрддреНрддрд┐ рдХреЗ рд▓рд┐рдП рд╕реАрдорд╛ рдХреЛ рдкрд╛рд░ рдХрд░ рд▓рд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛред </font><font style="vertical-align: inherit;">рдЗрд╕ рдкреНрд░рдХрд╛рд░, рджреВрд╕рд░рд╛ рдирд┐рдпрдо рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рдирдП рдЯреАрд╕реАрдкреА рдХрдиреЗрдХреНрд╢рдиреЛрдВ рдкрд░ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рддреАрд╕рд░рд╛ рдФрд░ рдЪреМрдерд╛ - рдкрд╣рд▓реЗ рд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рдХрдиреЗрдХреНрд╢рдиреЛрдВ рдкрд░, рдкрд╣рд▓рд╛ рдПрдХ рдРрддрд┐рд╣рд╛рд╕рд┐рдХ рдЪреЗрдХ рдФрд░ рджреВрд╕рд░рд╛ рдПрдХ рд░рд┐рдпрд▓-рдЯрд╛рдЗрдо рдЪреЗрдХред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪрд▓реЛ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдореЗрдВ рдлрд┐рд▓реНрдЯрд░ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЛ!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдм рд╣рдо рдЕрдкрдиреЗ рдХрдВрдЯреЗрдирд░реЛрдВ рдХреЛ рдлрд┐рд░ рд╕реЗ рдЗрдХрдЯреНрдард╛ рдФрд░ рд▓реЙрдиреНрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo docker-compose down<font></font>
$ sudo docker-compose build<font></font>
$ sudo docker-compose up</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд▓реЛрдб рдмреИрд▓реЗрдиреНрд╕рд░ рдХреЛ рджреЛ рдмреИрдХрдПрдВрдб рд╕рд░реНрд╡рд░ рд╕реЗ рдкрд╣рд▓реЗ рд╢реБрд░реВ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЪрд▓реЛ рд╣рдорд╛рд░реЗ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХреЛ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░рддреЗ рд╣реИрдВ </font></font><code>http://localhost/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрджрд┐ рд╣рдо рдкреГрд╖реНрда рдХреЛ рдПрдХ рджрд░реНрдЬрди рдмрд╛рд░ рдЬрд▓реНрджреА рддрд╛рдЬрд╝рд╛ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╣рдо рджрд╕-рд╕реЗрдХрдВрдб рдХреЗ рдЕрдВрддрд░рд╛рд▓ рдореЗрдВ рджрд╕ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рд╕реАрдорд╛ рдХреЛ рдкрд╛рд░ рдХрд░ рдЬрд╛рдПрдВрдЧреЗ - рдФрд░ рд╣рдорд╛рд░реЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </font><font style="vertical-align: inherit;">рдпрджрд┐ рд╣рдо рдкреГрд╖реНрда рдХреЛ рд░рд┐рдлреНрд░реЗрд╢ рдХрд░рдирд╛ рдЬрд╛рд░реА рд░рдЦрддреЗ рд╣реИрдВ, рддреЛ рдЯреАрд╕реАрдкреА рдХрдиреЗрдХреНрд╢рди рд╕реНрдерд╛рдкрд┐рдд рд╣реЛрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рд╣реА рдирдП рдЕрдиреБрд░реЛрдз рддреБрд░рдВрдд рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд░ рджрд┐рдП рдЬрд╛рдПрдВрдЧреЗред</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рд╢рди</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рддрд┐ рджрд╕ рд╕реЗрдХрдВрдб рдореЗрдВ рджрд╕ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рд╕реАрдорд╛ рдХреНрдпреЛрдВ рд╣реИ?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рддрд╛рд▓рд┐рдХрд╛ </font></font><code>Abuse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреА рд╣реИ </font></font><code>http_req_rate(10s)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЕрд░реНрдерд╛рдд, рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рдЖрд╡реГрддреНрддрд┐ рдХреЛ рджрд╕ рд╕реЗрдХрдВрдб рдХреА рд╡рд┐рдВрдбреЛ рдореЗрдВ рдорд╛рдкрд╛ рдЬрд╛рддрд╛ рд╣реИред </font></font><code>is_abuse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрд╕реАрдПрд▓ рд╕реЗ </font><font style="vertical-align: inherit;">рдПрдХ рдлрд╝рдВрдХреНрд╢рди </font></font><code>True</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдЕрдВрддрд░рд╛рд▓ рдХреЗ рднреАрддрд░ the10 рдХреЗ рдЕрдиреБрд░реЛрдз рджрд░ рдкрд░ </font><font style="vertical-align: inherit;">рд▓реМрдЯрддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕ рдкреНрд░рдХрд╛рд░, рджреБрд░реБрдкрдпреЛрдЧ рдХреЛ рджрд╕ рд╕реЗрдХрдВрдб рдореЗрдВ рджрд╕ рдпрд╛ рдЕрдзрд┐рдХ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рдЖрд╡реГрддреНрддрд┐ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╣рдордиреЗ рд▓рд┐рдорд┐рдЯрд░ рдХреЗ рд╕рдВрдЪрд╛рд▓рди рдХреА рдЬрд╛рдВрдЪ рдХрд░рдирд╛ рдЖрд╕рд╛рди рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдХрдо рд╕реАрдорд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХрд╛ рдирд┐рд░реНрдгрдп рд▓рд┐рдпрд╛ред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Http-request рдФрд░ tcp-request рдХрдиреЗрдХреНрд╢рди рдирд┐рдпрдореЛрдВ рдореЗрдВ рдХреНрдпрд╛ рдЕрдВрддрд░ рд╣реИ?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕реЗ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=https://cbonte.github.io/haproxy-dconv/1.7/configuration.html&amp;usg=ALkJrhi78YjZjyO4klRJ7Y221kX56Rn8nA#4.2-"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рд▓реЗрдЦрди</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<blockquote><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http-request: http-request рд╕реНрдЯреЗрдЯрдореЗрдВрдЯ рдиреЗрдЯрд╡рд░реНрдХ рд▓реЗрдпрд░ 7 [OSI рдореЙрдбрд▓] рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рдирд┐рдпрдореЛрдВ рдХреЗ рдПрдХ рд╕реЗрдЯ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИ</font></font></i></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕реЗ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рд▓реЗрдЦрди</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<blockquote><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯреАрд╕реАрдкреА-рдЕрдиреБрд░реЛрдз рдХрдиреЗрдХреНрд╢рди: рдиреЗрдЯрд╡рд░реНрдХ рдкрд░рдд 4 рдкрд░ рдПрдХ рд╢рд░реНрдд рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЖрдиреЗ рд╡рд╛рд▓реЗ рдХрдиреЗрдХреНрд╢рди рдкрд░ рдПрдХ рдХреНрд░рд┐рдпрд╛ рдХрд░рдирд╛</font></font></i></blockquote><br>
<h3>  HTTP-,        TCP-?</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХрд▓реНрдкрдирд╛ рдХреАрдЬрд┐рдП рдХрд┐ рд╕рд░реНрд╡рд░ рд╕реЗ HTTP рдЕрдиреБрд░реЛрдз рдПрдХ рд╣реА рдЖрдИрдкреА рдкрддреЗ рд╕реЗ рдХрдИ рдЯреАрд╕реАрдкреА рдХрдиреЗрдХреНрд╢рди рднреЗрдЬрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">HTTP рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рдЖрд╡реГрддреНрддрд┐ рдЬрд▓реНрджреА рд╕реЗ рдереНрд░реЗрд╕рд╣реЛрд▓реНрдб рд╕реЗ рдЕрдзрд┐рдХ рд╣реЛ рдЬрд╛рдПрдЧреАред </font><font style="vertical-align: inherit;">рдпрд╣ рддрдм рд╣реИ рдХрд┐ рдЪреМрдерд╛ рдирд┐рдпрдо рд▓рд╛рдЧреВ рд╣реЛрддрд╛ рд╣реИ, рдЬреЛ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдЫреЛрдбрд╝ рджреЗрддрд╛ рд╣реИ рдФрд░ рдЖрдИрдкреА рдкрддреЗ рдХреЛ рдмреНрд▓реИрдХрд▓рд┐рд╕реНрдЯ рдХрд░ рджреЗрддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдм рдпрд╣ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдПрдХ рд╣реА рдЖрдИрдкреА рдкрддреЗ рд╕реЗ HTTP рдХрдиреЗрдХреНрд╢рди рдЦреБрд▓рд╛ рд░рд╣реЗ ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓рдЧрд╛рддрд╛рд░ HTTP рдХрдиреЗрдХреНрд╢рди</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рджреЗрдЦреЗрдВ </font><font style="vertical-align: inherit;">), рдФрд░ HTTP рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рдЖрд╡реГрддреНрддрд┐ рдереНрд░реЗрд╕рд╣реЛрд▓реНрдб рдорд╛рди рд╕реЗ рдиреАрдЪреЗ рдЪрд▓реА рдЧрдИ рд╣реИред </font><font style="vertical-align: inherit;">рддреАрд╕рд░рд╛ рдирд┐рдпрдо рдЧрд╛рд░рдВрдЯреА HTTP рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рд░реЛрдХрдирд╛ рдЬрд╛рд░реА рд░рдЦрддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ </font></font><code>abuse indicator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рдЖрдИрдкреА рдкрд░ рдЪрд╛рд▓реВ </font><font style="vertical-align: inherit;">рд╣реЛрддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдм рдорд╛рди рд▓реАрдЬрд┐рдП рдХрд┐ рдХреБрдЫ рдорд┐рдирдЯреЛрдВ рдХреЗ рдмрд╛рдж рд╡рд╣реА рдЖрдИрдкреА рдЯреАрд╕реАрдкреА рдХрдиреЗрдХреНрд╢рди рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЙрдиреНрд╣реЗрдВ рддреБрд░рдВрдд рд╣рдЯрд╛ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рджреВрд╕рд░рд╛ рдирд┐рдпрдо рд▓рд╛рдЧреВ рд╣реЛрддрд╛ рд╣реИ: рдпрд╣ рд▓реЗрдмрд▓ рдХрд┐рдП рдЧрдП рдЖрдИрдкреА рдкрддреЗ рдХреЛ рджреЗрдЦрддрд╛ рд╣реИ рдФрд░ рддреБрд░рдВрдд рдХрдиреЗрдХреНрд╢рди рдХреЛ рдЫреЛрдбрд╝ рджреЗрддрд╛ рд╣реИред</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд┐рд╖реНрдХрд░реНрд╖</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, HAProxy рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рдЧрддрд┐ рдХреА рд╕реАрдорд╛ рдХреЛ рд╕рдордЭрдирд╛ рдореБрд╢реНрдХрд┐рд▓ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╕рдм рдХреБрдЫ рд╕рд╣реА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдХрд╛рдлреА "рдирд┐рдореНрди-рд╕реНрддрд░реАрдп" рд╕реЛрдЪ рдФрд░ рдХрдИ рдЧреИрд░-рд╕рд╣рдЬ рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕ рднрд╛рдЧ рдореЗрдВ рдкреНрд░рд▓реЗрдЦрди рд╢рд╛рдпрдж рдмрд╣реБрдд рддрдХрдиреАрдХреА рд╣реИ рдФрд░ рдХрд┐рд╕реА рднреА рдореВрд▓ рдЙрджрд╛рд╣рд░рдг рдХреА рдЕрдиреБрдкрд╕реНрдерд┐рддрд┐ рд╕реЗ рдЧреНрд░рд╕реНрдд рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рдЖрд╢рд╛ рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣ рдорд╛рд░реНрдЧрджрд░реНрд╢рд┐рдХрд╛ рдХрдорд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдмрдиреЗрдЧреА рдФрд░ рд╣рд░ рдЙрд╕ рд╡реНрдпрдХреНрддрд┐ рдХреЛ рджрд┐рд╢рд╛ рджрд┐рдЦрд╛рдПрдЧреА рдЬреЛ рдЗрд╕ рд░рд╛рд╕реНрддреЗ рдХреЛ рдЕрдкрдирд╛рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реИред </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдХреНрдпрд╛ рдкрдврд╝реЗрдВ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mail.ru Cloud Solutions рдХреЗ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдореЗрдВ рджреЛрд╖-рд╕рд╣рд┐рд╖реНрдгреБ рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ рдХреИрд╕реЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рдХреА рдЬрд╛рддреА рд╣реИ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢реАрд░реНрд╖ 10 рдХреБрдмреЗрд░рдиреЗрдЯ рдЯреНрд░рд┐рдХреНрд╕ рдФрд░ рдЯрд┐рдкреНрд╕</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдбрд┐рдЬрд┐рдЯрд▓ рдкрд░рд┐рд╡рд░реНрддрди рдкрд░ рд╣рдорд╛рд░рд╛ рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рдЪреИрдирд▓</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред</font></font></li>
</ol></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi499582/index.html">Node.js рдореЗрдВ рдкреНрд░реАрдбреЗрдЯрд░-рдкреНрд░реА рдореЙрдбрд▓</a></li>
<li><a href="../hi499584/index.html">рдФрджреНрдпреЛрдЧрд┐рдХ рд╕реНрдкрд░реНрд╢ рдореЙрдирд┐рдЯрд░ FPM-215W</a></li>
<li><a href="../hi499586/index.html">рдореЛрдмрд╛рдЗрд▓ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдиреЗрд╡рд┐рдЧреЗрд╢рди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХреИрд╕реЗ рд╕реЛрдЪреЗрдВ</a></li>
<li><a href="../hi499588/index.html">JWT рдХреЗ рд╕рд╛рде .NET рдХреЛрд░ gRpc рдореЗрдВ рдкреНрд░рдорд╛рдгреАрдХрд░рдг</a></li>
<li><a href="../hi499592/index.html">AI: рдХрд▓ рдХреА рджреБрдирд┐рдпрд╛ рдореЗрдВ рд▓рд╛рдЧреВ рд╣реЛ рд░рд╣рд╛ рд╣реИ</a></li>
<li><a href="../hi499598/index.html">рдФрд░ рд╣рдо рдЙрддреНрддрд░ рдЪрд▓реЗ рдЬрд╛рдпреЗрдВрдЧреЗ! рдХреНрдпрд╛ рдореМрд╕рдо рдХреА рд╡рдЬрд╣ рд╕реЗ рдбрд╛рдЯрд╛ рд╕реЗрдВрдЯрд░реЛрдВ рдХреА рдХреВрд▓рд┐рдВрдЧ рдкрд░ рдмрдЪрдд рд╕рдВрднрд╡ рд╣реЛрдЧреА?</a></li>
<li><a href="../hi499600/index.html">рдХреИрд╕реЗ рдПрдХ рд╕рд╛рде рдХрд╛рдо рдХрд░рдирд╛ рд╣реИ, рдЕрд▓рдЧ рдХрд╛рдо рдХрд░рдирд╛</a></li>
<li><a href="../hi499602/index.html">рдПрдХ рд╕рдореНрдореЗрд▓рди рдСрдирд▓рд╛рдЗрди рд╕реНрдерд╛рдирд╛рдВрддрд░рдг: рдЗрдирд░рд╕реЛрд░реНрд╕ рдХреЙрдордиреНрд╕ рд╕рдорд┐рдЯ рдЕрдиреБрднрд╡</a></li>
<li><a href="../hi499604/index.html">рдПрдХ рдЫреЛрдЯреЗ рд╕реЗ рд╡реНрдпрд╡рд╕рд╛рдп рдореЗрдВ рдпреВрдкреАрдПрд╕ рдЦрд░реАрджрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдирд┐рд░реНрджреЗрд╢рдХ рдХреЛ рд╕рдордЭрд╛рдиреЗ рдХреЗ рд▓рд┐рдП 4 рддрд░реНрдХ</a></li>
<li><a href="../hi499606/index.html">рд╡реАрдбрд┐рдпреЛ рдХреЙрдиреНрдлреНрд░реЗрдВрд╕рд┐рдВрдЧ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░: рд╕реНрдХрд╛рдЗрдк, рд╣реИрдВрдЧрдЖрдЙрдЯ рдФрд░ рдЬрд╝реВрдо рд╣рд╛рдл-рдмреНрд▓рдб</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>