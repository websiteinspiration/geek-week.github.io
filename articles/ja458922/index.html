<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏼‍🔬 🏧 👩🏻‍🎓 ESXiからKVM / LXDに移行し、気を失うことのないようにする方法 😎 ✒️ ➡️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Maxnet Systems社は長い間、ハイパーバイザーとしてバージョン5.0以降の無料バージョンのVMware-ESXiを使用していました。 vSphereの有料バージョンはライセンスモデルを怖がらせましたが、無料バージョンには有料バージョンでは利用できない多くの欠点がありましたが、それに耐えるこ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ESXiからKVM / LXDに移行し、気を失うことのないようにする方法</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/458922/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maxnet Systems社は長い間、ハイパーバイザーとしてバージョン5.0以降の無料バージョンのVMware-ESXiを使用していました。 vSphereの有料バージョンはライセンスモデルを怖がらせましたが、無料バージョンには有料バージョンでは利用できない多くの欠点がありましたが、それに耐えることができました。しかし、ESXiの新しいバージョンでは、新しいWebインターフェイスが古いインターフェイスとの連携を拒否し、RAIDアレイの監視が生命の兆候を示さなくなったとき、同社はより普遍的でオープンなソリューションを探すことを決定しました。同社はすでにLXC-Linux Containersに良い経験と良い印象を持っています。したがって、夢のハイパーバイザーはハイブリッドであり、異なる負荷に対してKVMとLXDを組み合わせることが明らかになりました-LXCの進化的な継続。 KVMに関する情報を探す際、同社は誤解、熊手、有害な慣行に直面しました。しかし、テストと時間はすべてをその場所に置きます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/s-/vc/6s/s-vc6shq5cfia5bjjcuhixbgukq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESXiからKVMへの移行に対処し、レーキホイールに穴をあけないようにする方法について、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lev Nikolaev</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マニアック</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）-高負荷システムの管理者および開発者、情報技術トレーナー。</font><font style="vertical-align: inherit;">ネットワーク、リポジトリ、コンテナ、KVM、LXD、LXC、プロビジョニング、便利な仮想マシンについて話しましょう。</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロローグ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すぐに主要な考えの概要を説明し、それからそれらをより詳細に分析します。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通信網。</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インターフェイスの速度は1 Gb /秒を超えませんが、ブリッジで十分です。あなたがもっと搾りたいと思ったらすぐに-それはあなたを制限します。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リポジトリ。</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">共有ネットワークストレージを作成します。ネットワーク内で10ギガビット/秒を使用する準備ができていない場合でも、1ギガビット/秒で125 MB /秒のストレージが提供されます。多くの負荷の場合、これで十分であり、仮想マシンの移行は基本的な問題になります。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンテナーまたはKVM？</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">長所、短所、落とし穴。コンテナに配置するのが最適なロードのタイプと、KVMに残すのが最適なロード</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LXDまたはLXC</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。 LXDはLXCですか？または別のバージョン？またはアドオン？これは何についてですか？神話を払拭し、LXDとLXCの違いを理解しましょう。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">便利なプロビジョニング</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">同じイメージを取得するか、毎回システムを最初からインストールする方が便利ですか？</font><font style="vertical-align: inherit;">毎回それを迅速かつ正確に行う方法は？</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">便利な仮想マシン。</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブートローダー、パーティション、LVMについては怖い話があります。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">その他</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">多くの小さな質問：ESXiからKVMに仮想マシンをすばやくドラッグする方法、適切に移行する方法、ディスクを適切に仮想化する方法</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/HqsxBkxGxqg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移転の理由</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESXiからKVM / LXDに移動するというクレイジーなアイデアはどこで得ましたか？ ESXiは、中小企業の間で人気があります。これは優れた安価なハイパーバイザーです。しかし、ニュアンスがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちはバージョン5.0から始めました-便利なことに、すべてがうまくいきます！次のバージョン5.5もです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バージョン6.0以降、これはさらに困難になっています。 ESXiでは、Windowsのユーティリティが必要になる前に、バージョン6.5からのみ、Webインターフェースがすぐに解放されませんでした。これに我慢。 OS Xを実行している人がParallelsを購入し、このユーティリティをインストールします。これはよく知られている痛みです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
監視は定期的に点滅します。サーバーコンソールで管理サービスを再起動する必要がありました-その後、CIMハートビートが再び表示されました。彼はいつも脱落したわけではなかったので、私たちは耐えました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESXi 6.5バージョン-ゴミ、無駄、残虐行為。ひどいハイパーバイザー。そしてそれが理由です。</font></font><br>
<br>
<ul>
<li><strong>Angular        Web-.</strong>        —  !</li>
<li><strong>      RAID-</strong> ,   .   ,    6.5 —  .</li>
<li><strong>      Intel</strong>.    Intel  ESXi  .    ESXi      . VMware  Intel         .  ,       .</li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESXi内の移行はありません</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">移行が一時停止、コピー、および開始の手順と見なされない限り。</font><font style="vertical-align: inherit;">車を一時停止し、すぐにコピーして別の場所から開始します。</font><font style="vertical-align: inherit;">しかし、これをマイグレーションと呼ぶことはできません-それにもかかわらず、単純なものがあります。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これをすべて見て、ESXi 6.5で移動するというクレイジーなアイデアを得ました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウィッシュリスト</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、私たちがこれから行う理想的な未来のためのウィッシュリストを書きました。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSHの下からの管理</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、およびWebなどのオプション。</font><font style="vertical-align: inherit;">Webインターフェースは素晴らしいですが、iPhoneを使った出張でESXi Webインターフェースにアクセスして何かを行うのは不便で困難です。</font><font style="vertical-align: inherit;">したがって、すべてを管理する唯一の方法はSSHであり、他に方法はありません。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows仮想化。</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">時々顧客は奇妙なことを求め、私たちの使命はそれらを助けることです。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常に最新のドライバとネットワークカードを構成する機能</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">十分な欲求ですが、純粋なESXiでは実現されません。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスタリングではなく、ライブマイグレーション</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">私たちは、遅延、ダウンタイム、または不便を感じることなく、あるハイパーバイザーから別のハイパーバイザーにマシンをドラッグする機能を求めています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ウィッシュリストの準備が整い、難しい検索が始まりました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">選択の小麦粉</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
市場は、さまざまなソースを持つKVMまたはLXCを中心に展開しています。</font><font style="vertical-align: inherit;">時々、Kubernetesはどこか上にあり、すべてが晴れ、太陽と楽園であるように見え、下位レベルにはMorlocks-KVM、Xenまたは</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その</font><font style="vertical-align: inherit;">ようなものがあります... </font><font style="vertical-align: inherit;">たとえば、Proxmox VEはDebianであり、Ubuntuのカーネルによってプルされました。</font><font style="vertical-align: inherit;">奇妙に見えますが、それは本番環境に持ち込みますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
下の隣人はAlt Linuxです。</font><font style="vertical-align: inherit;">彼らは美しい解決策を思いつきました：彼らはProxmox VEをパッケージとしてまとめました。</font><font style="vertical-align: inherit;">パッケージを1つのコマンドに入れるだけです。</font><font style="vertical-align: inherit;">これは便利ですが、Alt Linuxを本番環境に導入するわけではないため、私たちには適していませんでした。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KVMを取る</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最終的に、KVMを選択しました。</font><font style="vertical-align: inherit;">たとえばXenはコミュニティのため、彼らはそれを採用しませんでした。KVMにはそれ以上の機能があります。</font><font style="vertical-align: inherit;">私たちはいつも私たちの質問に対する答えを見つけるだろうと思われました。</font><font style="vertical-align: inherit;">コミュニティのサイズはその品質に影響を与えないことを後で知りました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初は、ベアメタルマシンを使用し、使用しているUbuntuを追加し、上からKVM / LXDをロールすると予想していました。</font><font style="vertical-align: inherit;">コンテナーを実行する機能を期待しました。</font><font style="vertical-align: inherit;">Ubuntuはよく知られたシステムであり、ブート/リカバリの問題を解決するという点で驚くことはありません。</font><font style="vertical-align: inherit;">ハイパーバイザーが起動しない場合、どこでキックするかはわかっています。</font><font style="vertical-align: inherit;">すべてが明確で便利です。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KVMクラッシュコース</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あなたがESXiの世界から来ているなら、あなたは多くの興味深いものを見つけるでしょう。 QEMU、KVM、およびlibvirtの3つの単語を学びます。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QEMU</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、仮想化されたOSの要望を通常のプロセスの課題に変換します。ほとんどどこでもうまく機能しますが、ゆっくりです。 QEMU自体は、他の多くのデバイスを仮想化するスタンドアロン製品です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらにシーンには、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QEMU-KVMが</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">たくさんあり</font><font style="vertical-align: inherit;">ます。これはQEMUのLinuxカーネルモジュールです。すべての命令の仮想化はコストがかかるため</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、少数の命令のみ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><strong><font style="vertical-align: inherit;">変換</font></strong><font style="vertical-align: inherit;">するKVMカーネルモジュールが</font><strong><font style="vertical-align: inherit;">あります</font></strong><font style="vertical-align: inherit;">。その結果、一般セットからの命令の数パーセントしか処理されないため、これは大幅に高速になります。これが仮想化のすべてのコストです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
QEMUしかない場合、バインドなしで仮想マシンを起動すると、次のようになります。</font></font><br>
<br>
<pre><code class="plaintext hljs">$ qemu &lt; &gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ネットワークを説明するパラメータで、デバイスをブロックします。</font><font style="vertical-align: inherit;">すべてが素晴らしいですが、不便です。</font><font style="vertical-align: inherit;">したがって、libvirtがあります。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">libvirtの目標は、すべてのハイパーバイザーのための単一のツールになることです</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">KVMやLXDなど、何でも使用できます。</font><font style="vertical-align: inherit;">libvirtの構文を学ぶことだけが残っているように見えますが、実際には理論よりもうまく機能しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これら3つの単語は、KVMで最初の仮想マシンを起動するために必要なすべてです。</font><font style="vertical-align: inherit;">しかし、ここでもニュアンスがあります... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
libvirtには、仮想マシンやその他の設定が保存される構成があります。</font><font style="vertical-align: inherit;">構成はxmlファイルに保存されます-スタイリッシュでファッショナブル、90年代のストレート。</font><font style="vertical-align: inherit;">必要に応じて手動で編集できますが、便利なコマンドがある場合はその理由を説明します。</font><font style="vertical-align: inherit;">また、xmlファイルへの変更が素晴らしいバージョンになっていることも便利です。</font><strong><font style="vertical-align: inherit;">etckeeper</font></strong><font style="vertical-align: inherit;">を使用し</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-ディレクトリのバージョン管理など </font><font style="vertical-align: inherit;">etckeeperは既に使用可能であり、ハイタイムです。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LXCクラッシュコース</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LXCとLXDについては多くの誤解があります。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LXCは、ネームスペースを使用する最新のカーネルの機能です。これは、LXCが元々あったコアではないように見せかけるためです。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの名前空間は、コンテナーごとにいくつでも作成できます。</font><font style="vertical-align: inherit;">正式にはコアは1つですが、同じコアのように動作します。</font><font style="vertical-align: inherit;">LXCではコンテナを実行できますが、提供されるのは基本的なツールのみです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ubuntuの背後にあり、積極的にコンテナを前進させているCanonicalは、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">libvirtに類似したLXD</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をリリースしました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これはコンテナの実行を容易にするバインディングですが、内部にはまだLXCがあります。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LXDは、LXCに基づくコンテナーハイパーバイザーです。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
企業はLXDで統治します。</font><font style="vertical-align: inherit;">LXDは設定をデータベース内のディレクトリに保存します</font></font><code>/var/lib/lxd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">そこで、LXDはSQliteの構成でその構成を維持します。</font><font style="vertical-align: inherit;">コピーしても意味がありませんが、コンテナー構成の作成に使用したコマンドを書き留めることができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのようなアンロードはありませんが、ほとんどの変更はチームによって自動化されています。</font><font style="vertical-align: inherit;">これはDockerファイルの類似物であり、手動でのみ制御できます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">製造</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
誰もがこれに乗り出したときに遭遇したこと。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通信網</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
KVMのネットワークについて、インターネット上でどれだけ地獄のようなゴミや騒ぎが起こっているのでしょう。</font><font style="vertical-align: inherit;">材料の90％はブリッジを使用すると言っています。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブリッジの使用をやめてください！</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼の何が問題なのですか？</font><font style="vertical-align: inherit;">最近、コンテナで狂気が起こっていると感じています。DockerをDockerの上に置いて、Dockerを見ながらDockerでDockerを実行できるようにしています。</font><font style="vertical-align: inherit;">ほとんどの人は橋が何をしているかを理解していません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ネットワークコントローラーを</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">無差別モードにして</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、どれがどれかわからないため、すべてのトラフィックを受信します。</font><font style="vertical-align: inherit;">その結果、すべてのブリッジトラフィックは、素晴らしく高速なネットワークLinuxスタックを通過し、大量のコピーが発生します。</font><font style="vertical-align: inherit;">結局、すべてが遅くて悪いです。</font><font style="vertical-align: inherit;">したがって、本番環境ではブリッジを使用しないでください。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SR-IOV</font></font></h3><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SR-IOVは、ネットワークカード内で仮想化する機能</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">ネットワークカード自体が仮想マシンに自身の一部を割り当てることができるため、ハードウェアによるサポートが必要です。</font><font style="vertical-align: inherit;">これが移行を妨げるものです。</font><font style="vertical-align: inherit;">SR-IOVがない場所に仮想マシンを移行するのは大変です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SR-IOVは、移行の一部としてすべてのハイパーバイザーによってサポートされる場合に使用する必要があります。</font><font style="vertical-align: inherit;">そうでない場合は、macvtapが最適です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Macvtap</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、ネットワークカードがSR-IOVをサポートしていない人向けです。</font><font style="vertical-align: inherit;">これは軽量バージョンのブリッジです。1つのネットワークカードで異なるMACアドレスがハングし、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユニキャストフィルタリングが使用され</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。ネットワークカードはすべてを受け入れるわけではありませんが、厳密にはMACアドレスのリストに従っています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
より流血な詳細は、マキタトシアキ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">素晴らしい講演</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">、Virtual Switching TechnologiesとLinux Bridgeにあり</font></a><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">彼は痛みと苦しみでいっぱいです。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KVMでネットワークを構築する方法に関する資料の90％は役に立たない。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
誰かが橋が素晴らしいと言ったら、もうその人と話をしないでください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
macvtapでは、</font><font style="vertical-align: inherit;">コピー数が少ないため</font><font style="vertical-align: inherit;">、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPUは約30％を節約し</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">ただし、プロミスキャスモードには独自のニュアンスがあります。</font><font style="vertical-align: inherit;">ホストから、ハイパーバイザー自体からゲストマシンのネットワークインターフェイスに接続することはできません。</font><font style="vertical-align: inherit;">これについては、トシアキの報告が詳しい。</font><font style="vertical-align: inherit;">しかし、要するに-それは機能しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ハイパーバイザー自体はめったにSSHを使用しないため。</font><font style="vertical-align: inherit;">そこで、Winコンソールなどのコンソールを起動する方が便利です。</font><font style="vertical-align: inherit;">インターフェース上のトラフィックを「監視」することが可能です。TCP経由で接続することはできませんが、ハイパーバイザー上のトラフィックは表示されます。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">速度が1ギガビットを超える場合-macvtapを選択します。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インターフェース速度が最大で1ギガビット/秒程度の場合、ブリッジも使用できます。</font><font style="vertical-align: inherit;">しかし、10 Gbのネットワークカードがあり、なんとかしてそれを処分したい場合は、macvtapだけが残ります。</font><font style="vertical-align: inherit;">他のオプションはありません。</font><font style="vertical-align: inherit;">SR-IOVを除く。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></h3><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これは、ハイパーバイザー自体にネットワーク構成を保存するための優れた方法</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。私たちの場合、これはUbuntuですが、他のシステムではsystemdが機能します。</font><font style="vertical-align: inherit;">以前は全員が保管する</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイル</font></font><code>/etc/network/interfaces</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がありました。毎回1つのファイルを編集するのは不便です。systemd-networkdを使用すると、構成を小さなファイルの分散に分割できます。これは、どのバージョン管理システムでも機能するので便利です。Gitに送信され、いつどのような変更が行われたかがわかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちのネットワーカーが発見した欠陥があります。ハイパーバイザーに新しいVLANを追加する必要がある場合は、私が行って構成します。次に、「systemctl restart systemd-networkd」と言います。現時点では、私は元気ですが、このマシンからのBGPセッションが発生すると、それらは切断されます。私たちのネットワーカーはこれを承認しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ハイパーバイザーの場合、問題は何も起こりません。</font><font style="vertical-align: inherit;">Systemd-networkdは境界ボーダー、BGPが昇格したサーバー、およびハイパーバイザーには適していません-優れています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Systemd-networkdは最終段階にはほど遠く、決して完了することはありません。</font><font style="vertical-align: inherit;">しかし、これは1つの巨大なファイルを編集するよりも便利です。</font><font style="vertical-align: inherit;">Ubuntu 18.04のsystemd-networkdに代わるものはNetplanです。</font><font style="vertical-align: inherit;">これは、ネットワークを構成してレーキを踏む「クールな」方法です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネットワークデバイス</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ハイパーバイザーにKVMとLXDをインストールした後、最初に表示されるのは2つのブリッジです。</font><font style="vertical-align: inherit;">1つは自分でKVMを作成し、もう1つはLXDです。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LXDとKVMは、ネットワークを展開しようとしています。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それでもブリッジが必要な場合-テストマシンまたはプレイのために、デフォルトでオンになっているブリッジを強制終了し、必要なブリッジを作成します。</font><font style="vertical-align: inherit;">KVMまたはLXDはそれをひどく行います-dnsmasqを滑らせれば、恐怖が始まります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ストレージ</font></font></h3><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">どの実装が好きかは関係ありません-共有ストレージを使用してください。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、仮想マシンのiSCSI。</font><font style="vertical-align: inherit;">「障害点」を取り除くことはできませんが、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ストレージを1か所で統合</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">できます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは新しい興味深い機会を開きます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを行うには、データセンター内に少なくとも10 Gb /秒のインターフェースが必要です。</font><font style="vertical-align: inherit;">しかし、1 Gbit / sしかない場合でも、心配する必要はありません。</font><font style="vertical-align: inherit;">これは約125 MB /秒です。高いディスク負荷を必要としないハイパーバイザーには非常に適しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
KVMはストレージを移行およびドラッグできます。</font><font style="vertical-align: inherit;">しかし、たとえば、ワークロードモードでは、仮想マシンを数テラバイトに転送するのは面倒です。</font><font style="vertical-align: inherit;">共有ストレージを使用した移行の場合、基本的なRAMで十分です。</font><font style="vertical-align: inherit;">これ</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">により、移行時間が短縮されます</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結局、LXDかKVMか？</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初は、カーネルがホストシステムと一致するすべての仮想マシンで、LXDを使用すると想定していました。</font><font style="vertical-align: inherit;">そして、別のコアを取る必要がある場合-KVMを使用します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際には、計画は成功しませんでした。</font><font style="vertical-align: inherit;">その理由を理解するには、LXDをよく見てください。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lxd</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
主な利点は、コアメモリの節約です。カーネルは同じであり、新しいコンテナーを起動するとき、カーネルは同じです。これで、長所は終わり、短所は始まりました。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rootfsを使用するブロックデバイスをマウントする必要があります。</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">思ったより難しいです。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移行は実際にはありません</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。それは、そして私たちの同胞が見た素晴らしい悲観的な楽器criuに基づいています。私はそれらを誇りに思っていますが、単純なケースではcriuは機能しません。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zabbix-agentがコンテナ内で異常な動作をし</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。コンテナー内で実行すると、コンテナーからではなく、ホストシステムからの一連のデータが表示されます。これまでのところ、何もできません。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ハイパーバイザー上のプロセスのリストを見るとき、特定のプロセスがどのコンテナーから成長しているかを素早く理解することは不可能です。</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">名前空間の種類、場所、場所を把握するには時間がかかります。</font><font style="vertical-align: inherit;">負荷がどこかで通常よりジャンプした場合、すぐに理解できません。</font><font style="vertical-align: inherit;">これが主な問題です-応答機能の制限。</font><font style="vertical-align: inherit;">ケースごとにミニ調査が行われます。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LXDの唯一の利点は、コアメモリの節約とオーバーヘッドの削減です。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、KVMのカーネル共有メモリはすでにメモリを節約しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これまでのところ、本格的なプロダクションとLXDを導入する理由はないと思います。</font><font style="vertical-align: inherit;">この分野でのCanonicalの最善の努力にもかかわらず、LXDの生産はソリューションよりも多くの問題をもたらします。</font><font style="vertical-align: inherit;">近い将来、状況は変わらないでしょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、LXDが悪だとは言えません。</font><font style="vertical-align: inherit;">彼はいいですが、限られたケースでは、後でそれについて話します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クリュー</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Criuは悲観的なユーティリティです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
空のコンテナを作成します。DHCPクライアントとともに届き、「Suspend！」と伝えます。</font><font style="vertical-align: inherit;">DHCPクライアントがあるため、エラーが発生します。「ホラー、ホラー！</font><font style="vertical-align: inherit;">それは、「生」の記号が付いたソケットを開きます-なんと悪夢です！」</font><font style="vertical-align: inherit;">これまで以上に悪い。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンテナーからの印象：移行なし、Criuは1回おきに動作します。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I問題がないようにCriuをどうするかLXDチームからの推薦は、「のような」：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リポジトリから新鮮なバージョンを持っていこう！</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、リポジトリに実行しないように、どういうわけかそれをパッケージから入れることができますか？</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">調査結果</font></font></h3><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LXDは、CI / CDインフラストラクチャを作成する場合に最適です。</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LVM-Logical Volume Managerを取得し、そこからスナップショットを作成し、その上でコンテナーを起動します。</font><font style="vertical-align: inherit;">すべてがうまくいきます！</font><font style="vertical-align: inherit;">すぐに、新しいクリーンコンテナーが作成されます。これは、シェフのテストとローリング用に構成されています-積極的に使用しています。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LXDは深刻な生産には弱い</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">LXDがうまく機能しない場合、本番環境でLXDをどうするかわかりません。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KVMとKVMのみを選択してください！</font></font></strong><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マイグレーション</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これについて簡単に説明します。</font><font style="vertical-align: inherit;">私たちにとって、移行は私たちが好きな素晴らしい新しい世界であることがわかりました。</font><font style="vertical-align: inherit;">すべてがシンプルです。移行チームと2つの重要なオプションがあります。</font></font><br>
<br>
<pre><code class="plaintext hljs">virsh migrate &lt;vm&gt; qemu+ssh://&lt;hypervisor&gt;/system --undefinesource -persistent</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Googleで「KVM移行」と入力して最初の資料を開くと、移行のコマンドが表示されますが、最後の2つのキーはありません。それらが重要であるという言及は表示されません：「このコマンドを実行するだけです！」コマンドを実行します-そして、それは本当に移行しますが、どうやって？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要な移行オプション。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">undefinesource-移行元のハイパーバイザーから仮想マシンを削除します。</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そのような移行後に再起動すると、残したハイパーバイザーがこのマシンを再起動します。あなたは驚くでしょうが、これは正常です。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2番目のパラメーターなし-永続的-を移動したハイパーバイザーでは、これは永続的な移行とは見なされません。</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再起動後、ハイパーバイザーは何も記憶しません。</font></font><br>
<br>
<pre><code class="plaintext hljs">- virsh dominfo &lt;vm&gt; | grep persistent</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このパラメーターがない場合、仮想マシンは水上で円になります。</font><font style="vertical-align: inherit;">最初のパラメーターが2番目のパラメーターなしで指定されている場合、何が起こるかを推測します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
KVMにはそのような瞬間がたくさんあります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネットワーク：彼らは常に橋についてあなたに話します-それは悪夢です！</font><font style="vertical-align: inherit;">あなたは読んで考える-どのように？！</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移住：この壁に頭をぶつけない限り、彼らは何もわかりにくいことは言いません。</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">どこから始めますか？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開始するには遅すぎます-私は他のことについて話しています。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロビジョニング：デプロイ方法</font></font></h3><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">標準のインストールオプションに満足している場合は、preseedメカニズムが最適です。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESXiでは、virt-installを使用しました。</font><font style="vertical-align: inherit;">これは、仮想マシンを展開する通常の方法です。</font><font style="vertical-align: inherit;">Debian / Ubuntuのイメージを記述したpreseedファイルを作成すると便利です。</font><font style="vertical-align: inherit;">ISO配布キットとプレシードファイルをフィードして、新しいマシンを起動します。</font><font style="vertical-align: inherit;">その後、車は転がります。</font><font style="vertical-align: inherit;">あなたはSSH経由でそれに接続し、それをシェフにフックし、クッキーをロールします-それだけです、製品に急いでください！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、virt-installが十分にある場合、悪いニュースがあります。</font><font style="vertical-align: inherit;">これは、何か他のことをしたい段階に達していないことを意味します。</font><font style="vertical-align: inherit;">来て、virt-installでは不十分であることに気付きました。</font><font style="vertical-align: inherit;">クローンを作成して仮想マシンを起動する「ゴールデンイメージ」に到達しました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして、どのように仮想マシンを配置するのですか？</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
なぜこのイメージに到達したのか、なぜプロビジョニングが重要なのか？なぜなら、コミュニティには仮想マシンと通常のマシンとの間に大きな違いがあるという理解が弱いためです。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仮想マシンは複雑なブートプロセスとスマートブートローダーを必要としません</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。ツールの完全なセットを備えたマシンに仮想マシンのディスクを接続する方が、リカバリモードで終了するよりもはるかに簡単です。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仮想マシンには、デバイスのシンプルさが必要</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。仮想ディスクにパーティションが必要なのはなぜですか？ LVMではなく仮想ディスクを使用してパーティションを配置するのはなぜですか？</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仮想マシンには最大の拡張性が必要</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">通常、仮想マシンは成長します。</font><font style="vertical-align: inherit;">これは「クールな」プロセスです。MBRのパーティションを増やします。</font><font style="vertical-align: inherit;">あなたはそれを削除し、その瞬間に額から汗を拭き取り、「今書いてはいけない、書いてはいけない！」と考えます。</font><font style="vertical-align: inherit;">-新しいパラメータで再作成します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LVM @ Lilo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、LVM @ liloに来ました。これは、単一のファイルから構成できるブートローダーです。 GRUB構成を編集する場合は、テンプレートエンジンを制御し、巨大なboot.cfgを構築する特別なファイルを編集します。次に、Liloを使用して、1つのファイルだけを編集します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パーティションレスLVMは、システムを完璧かつ簡単にします。問題は、GRUBがMBRまたはGPTなしでは生きられず、フリーズしていることです。 「GRUBはここに落ち着きます」と彼に言いますが、パーティションがないため、彼は落ち着きません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LVMを使用すると、迅速に拡張してバックアップを作成できます。標準的な対話：</font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-皆さん、仮想バックアップをどのように作成しますか？</font></font></em><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-...ブロックデバイスを取得してコピーします。</font></font></em><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-元に戻そうとしましたか？</font></font></em><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-まあ、いいえ、すべてがうまくいきます！</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
仮想マシンのブロックデバイスはいつでも舐めることができますが、ファイルシステムがある場合、そこへの記録には3つの移動が必要です。この手順はアトミックではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
内部から仮想マシンのスナップショットを作成している場合は、ファイルシステムと通信して、目的の一貫性のある状態にすることができます。</font><font style="vertical-align: inherit;">しかし、これはすべてに適しているわけではありません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンテナを構築するには？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンテナを開始して作成するために、テンプレートの通常のツールがあります。</font><font style="vertical-align: inherit;">LXDはUbuntu 16.04または18.04テンプレートを提供します。</font><font style="vertical-align: inherit;">しかし、高度な戦闘機であり、通常のテンプレートが不要で、独自にカスタマイズできる独自のカスタムrootfsが必要な場合は、LXDでコンテナを最初から作成する方法という疑問が生じます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンテナを一から</font></font></h3><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rootfsを準備しています</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">Debootstrapはこれに役立ちます。必要なパッケージと不要なパッケージを説明し、インストールします。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定のrootfsからコンテナーを作成することをLXDに説明します</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ただし、最初に、短いコマンドで空のコンテナを作成します。</font></font><br>
<br>
<pre><code class="plaintext hljs">curl --unix-socket /var/lib/lxd/unix.socket -X POST -d '{"name": "my-container", "source": {"type": "none"}}' lxd/1.0/containers</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
自動化することもできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
思慮深い読者は言うでしょう-rootfsは私のコンテナはどこですか？</font><font style="vertical-align: inherit;">どこのどこに表示されていますか？</font><font style="vertical-align: inherit;">しかし、それだけではありませんでした。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rootfsのコンテナをマウントします</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">彼が住んでいます。</font><font style="vertical-align: inherit;">次に、rootfsコンテナがここに存在することを示します。</font></font><br>
<br>
<pre><code class="plaintext hljs">lxc config set my-container raw.lxc "lxc.rootfs=/containers/my-container/rootfs"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これも自動化されています。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンテナ寿命</font></font></h3><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンテナには独自のカーネルがない</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ため、それをロードする方が簡単です</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> systemd、init、fly！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LVMの操作に通常のツールを使用しない場合、ほとんどの場合、コンテナーを起動するには、ハイパーバイザーにコンテナーrootfsをマウントする必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
autofsについての記事をときどき見つけます。</font><font style="vertical-align: inherit;">そうしないでください。</font><font style="vertical-align: inherit;">Systemdには機能するautomountユニットがありますが、autofsは機能しません。</font><font style="vertical-align: inherit;">したがって、systemd automountユニットを使用できますが、autofsを使用する価値はありません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">調査結果</font></font></h2><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移行を伴うKVMが好き</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。 LXDでは、これはまだ先の方法ではありませんが、インフラストラクチャのテストと構築のために、本番環境の負荷がない場所で使用します。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KVMのパフォーマンスが気に入っています</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。上から見て、この仮想マシンに関連するプロセスを見て、誰が何をしているかを理解する方が身近です。これは、コンテナで奇妙なユーティリティのセットを使用して、水中のノックの種類を調べるよりも優れています。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移行を喜んでいます。</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これは主に共有ストレージが原因です。ディスクをドラッグして移行した場合、それほど満足できません。</font></font><br>
<br>
<blockquote>   ,   ,      ,   ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">DevOpsConf</a>.             ,  .<br>
<br>
    Call for Papers       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a> .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">telegram-</a>         DevOpsConf 2019       .</blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja458912/index.html">imapsyncを使用してZimbraに移行する</a></li>
<li><a href="../ja458914/index.html">Unityでゲームを作成するために知っておくべきこと（必要ではない）</a></li>
<li><a href="../ja458916/index.html">Reactの内部で。実装を一から作成する</a></li>
<li><a href="../ja458918/index.html">ハイパーカジュアルゲームのデザインから学べること</a></li>
<li><a href="../ja458920/index.html">DevOpsファンのための会議</a></li>
<li><a href="../ja458924/index.html">事故はあなたが学ぶのに役立ちます</a></li>
<li><a href="../ja458926/index.html">悲劇は一人では来ない</a></li>
<li><a href="../ja458928/index.html">XLNetとBERT</a></li>
<li><a href="../ja458930/index.html">Permの学生がData Mining Cup 2019国際データ分析選手権の決勝に進出した方法</a></li>
<li><a href="../ja458932/index.html">ヨタ-またはすべてを見つける方法</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>