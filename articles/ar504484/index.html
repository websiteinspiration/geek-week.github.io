<!doctype html>
<html class="no-js" lang="ar">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ป ๐ผ ๐คฉ IPSec ุณุจุญุงูู ูุชุนุงูู ๐ด๓ง๓ข๓ฅ๓ฎ๓ง๓ฟ ๐จ๐พโ๐ณ ๐ก</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุณุงุก ุงูุฎูุฑ ูุง ุงุตุฏูุงุก. ููุณ ุณุฑุงู ุฃู ุงููุซูุฑ ููุง ูุฏูู ูุฑุฉ ูุงุญุฏุฉ ุนูู ุงูุฃูู ุ ูููู ูุงู ุนููู ุฃู ูุชุนุงูู ูุน ุงูุญุงุฌุฉ ุฅูู ุชูููู VPN. ูููู ูุงุฑุฆูุง ูุดุทูุง ูุญุจุฑ ุ ูุงุญุธ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>IPSec ุณุจุญุงูู ูุชุนุงูู</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/504484/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุณุงุก ุงูุฎูุฑ ูุง ุงุตุฏูุงุก. </font><font style="vertical-align: inherit;">ููุณ ุณุฑุงู ุฃู ุงููุซูุฑ ููุง ูุฏูู ูุฑุฉ ูุงุญุฏุฉ ุนูู ุงูุฃูู ุ ูููู ูุงู ุนููู ุฃู ูุชุนุงูู ูุน ุงูุญุงุฌุฉ ุฅูู ุชูููู VPN. </font><font style="vertical-align: inherit;">ูููู ูุงุฑุฆูุง ูุดุทูุง ูุญุจุฑ ุ ูุงุญุธุช ุฃูู ุนูู ุงูุฑุบู ูู ููุฑุฉ ุงูููุงูุงุช ุญูู IPSec ุ ุฅูุง ุฃูู ุจุงููุณุจุฉ ูููุซูุฑูู ูุง ูุฒุงู ูุจุฏู ุดูุฆูุง ูุนูุฏูุง ููุญููุงู. </font><font style="vertical-align: inherit;">ูู ูุฐู ุงูููุงูุฉ ุณุฃุญุงูู ุชุจุฏูุฏ ูุฐู ุงูุฃุณุงุทูุฑ ุจุงุณุชุฎุฏุงู ุงูุชูููู ุงูุฎุงุต ุจู ุงูุฐู ูุนูู ุจุดูู ูุงูู ููุซุงู. </font><font style="vertical-align: inherit;">ูู ุฃุฑุจุนุฉ ุฃูุซูุฉ ุ ุณูุณุชุนุฑุถ ุชูุงููุง ุชูููู ุญู Linux (Strongswan) ุงูุฃูุซุฑ ุดููุนูุง ุ ูู ููู ุจุณูุท ูุน ูุตุงุฏูุฉ ุฌุงูุจูุฉ ุจููุงุชูุญ PSK ุฅูู ุงุชุตุงู ูู ูุถูู ุฅูู ูุตุงุฏูุฉ ูุน ููุง ุงูุฌุงูุจูู ุจูุงุกู ุนูู ุดูุงุฏุงุช ูู Let's Encrypt. </font><font style="vertical-align: inherit;">ูุซูุฑ ููุฅุนุฌุงุจุ </font><font style="vertical-align: inherit;">ูุฑุญุจูุง ุจู ูู ุงููุท!</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฎูููุฉ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุงูุจุฏุงูุฉ ุ ุชู ุงูุชุฎุทูุท ูุดุจูุฉ VPN ููุท ูุชูุธูู ุงูููุงุฉ ุจูู ุฌูุงุฒ ุงูุชูุฌูู ุงููุตุบุฑ ูููุงูุฏูู ูุฎุงุฏู "ุฌุงูุจ ุงูุณุฑูุฑ" ุงูููุฒูู ุ ูุงูุฐู ูุนูู ูู ุงูููุช ููุณู ูุฌูุงุฒ ุชูุฌูู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุนุฏ ูุชุฑุฉ ูุตูุฑุฉ ุ ุชูุช ุฅุถุงูุฉ Keenetic ุฅูู ูุฐู ุงูุดุฑูุฉ ูู ุฌูุงุฒูู. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููู ุจูุฌุฑุฏ ุงูุจุฏุก ุ ุงุชุถุญ ุฃูู ูู ุงูุตุนุจ ุฅููุงูู ุ ูุณุฑุนุงู ูุง ุธูุฑุช ุงูููุงุชู ูุงูููุจููุชุฑ ุงููุญููู ุนูู ุงูุฑุณู ุงูุชุฎุทูุทู ุ ุงูุฐูู ุฃุฑุงุฏูุง ุงูุงุฎุชุจุงุก ูู ุงูุนูู ุงูุฅุนูุงููุฉ ุงููุงุถุญุฉ ูู MT_Free ูุดุจูุงุช WiFi ุบูุฑ ุงููุดูุฑุฉ ุงูุฃุฎุฑู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุซู ุฃุตุจุญ ILV ุงููุญุจูุจ ูู ุงูููุงูุฉ ุฃููู Banhammer ุ ุงูุฐู ููุน ุจุดูู ูุง ูุตุฏู ูู ุญุจ ุงูุชุฃุฑุฌุญ ุนููุง โโูู ุฌููุน ุงูุงุชุฌุงูุงุช ุ ููู ุฃุฌู ุชุญููุฏ ูููู ููุฌุฑุฏ ุงูุจุดุฑ ุ ูุงู ุนููู ุฃู </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฏุนู ูุทุงุน ุชูููููุฌูุง ุงููุนูููุงุช ุงูุฃุฌูุจู</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููุญุตูู ุนูู VPS ูู ุงูุฎุงุฑุฌ.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ููุงุทูุฉ ูุนููุฉ ุชุดุจู ุดุงุจููููุงู ุ ุชุชุฌูู ูู ูู ููุงู ูุน </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุดุจูุชูุง ูู ุฎูุงู</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุญุฒูุฉ ุ ูุฑุจูุง ุชุนุชูุฏ ุฃู "ูู ูุณุงุนุฏ ุงููุงุณ ุ ูุถูุน ุงูููุช. </font><font style="vertical-align: inherit;">ูุง ููููู ุฃู ุชุตุจุญ ูุดููุฑูุง ุจุงูุฃุนูุงู ุงูุตุงูุญุฉ "ุ ุฃุฑุฏุช ุฃู ุฃูู ูุธุฑุฉ ุฎุงุทูุฉ ุนูู ุญุฑูุฉ ูุฑูุฑ ุดุฎุต ุขุฎุฑ ูุฃุฎุฐูุง ุจุงูููู ุงูุฑุตุงุต. </font><font style="vertical-align: inherit;">ุณูููู ุนูููุง ุฃูุถูุง ุงูุฏูุงุน ุนู ุฃููุณูุง ุถุฏ ูุซู ูุฐุง ุงูุญุจ ุบูุฑ ุงููุฑุบูุจ ููู ูุงูุดุจูุฉ ุงูุงูุชุฑุงุถูุฉ ุงูุฎุงุตุฉ ูู ูุฐู ุงูุญุงูุฉ ุจุงูุถุจุท ุงูุชู ุทูุจูุง ุงูุทุจูุจ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุชูุฎูุต ููุฎุต ูุตูุฑ. </font><font style="vertical-align: inherit;">ูุงู ูู ุงูุถุฑูุฑู ุฅูุฌุงุฏ ุญู ููููู ุจุดูู ูุซุงูู ุฅุบูุงู ุงูุนุฏูุฏ ูู ุงูููุงู ูู ููุช ูุงุญุฏ:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุชุฑุงุจุท ุจูู ููุฌูุงุช Linux</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจูุงุก ููู ุจูู ููููุณ ูุงูุฃุณุฑุฉ ุงูุญุฑููุฉ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงููุญ ุญู ุงููุตูู ุฅูู ุงูููุงุฑุฏ ุงูููุฒููุฉ ูุงูุฅูุชุฑูุช ููุฃุฌูุฒุฉ ุงููุงุจูุฉ ููุงุฑุชุฏุงุก (ุงูููุงุชู ูุฃุฌูุฒุฉ ุงูููุจููุชุฑ ุงููุญูููุฉ) ูู ุงูุดุจูุงุช ุบูุฑ ุงูููุซูู ุจูุง</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฅูุดุงุก ููู ูุดูุฑ ุจุฃูุงู ุฅูู VPS ุงูุจุนูุฏ</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุง ุชูุณ ูุจุฏุฃ KISS ุงูุฑุงุฆุน - ุญุงูุธ ุนูู ุงูุจุณุงุทุฉ ุ ูุง ุบุจู. </font><font style="vertical-align: inherit;">ูููุง ุดุงุฑููุง ูู ููููุงุช ุฃูู ุ ุฃุตุจุญ ูู ุงูุฃุณูู ุชูููู ูู ูููุง - ูููุง ูุงูุช ุฃูุซุฑ ููุซูููุฉ.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุธุฑุฉ ุนุงูุฉ ุนูู ุงูุญููู ุงูููุฌูุฏุฉ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงุณุชุนุฑุถ ุจุฅูุฌุงุฒ ูุง ูู ุงูุขู: </font><font style="vertical-align: inherit;">
ุฌุฏ </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PPTP</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููููู ูู ุฌููุน ุงูุจุฑูุชููููุงุช. </font><font style="vertical-align: inherit;">ุชููู "ุงูุนูู ุงููุชุญูู ูุงูุนุณู ุงูุฒูุฒููู". </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L2TP</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ูู ูุณุชุฎุฏู ูุฐุง ุฃุญุฏ ุบูุฑ ูุฒูุฏ ูุงุญุฏุ </font><font style="vertical-align: inherit;">
ูุดุฑูุน </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wireguard</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุชุทูุฑ. </font><font style="vertical-align: inherit;">ุงูููุดูุฑ ุจูุดุงุท. </font><font style="vertical-align: inherit;">ูู ุงูุณูู ุฅูุดุงุก ููู ุจูู ุฒููุงุก ูููุง ุนููุงู IP ุซุงุจุช. </font><font style="vertical-align: inherit;">ูู ุญุงูุงุช ุฃุฎุฑู ุ ุชููู ุงูุนูุงุฒุงุช ูุงูุฏุฑุงุฌุงุช ุฐุงุช ุงูุนุฌูุงุช ุงููุฑุจุนุฉ ูุงูุดุฑูุท ุงูููุฑุจุงุฆู ุงูุฃุฒุฑู ุฏุงุฆููุง ุนูู ุงุณุชุนุฏุงุฏ ูููุณุงุนุฏุฉ ุ ูููู ูุฐุง ููุณ ุทุฑูููุง. </font><font style="vertical-align: inherit;">
ุฅูุฌุงุจูุงุช </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenVPN</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฏุนู ููุตุงุช ูุชุนุฏุฏุฉ - Windows ู Linux ู OpenWRT ููุดุชูุงุชู ุ Android</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชุดููุฑ ููู ูุฏุนู ุงูุดูุงุฏุฉ.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุฑููุฉ ุงูุชุฎุตูุต.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ูุงูุณูุจูุงุช:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงุนูู ุจุงููุงูู ูู ูุณุงุญุฉ ุงููุณุชุฎุฏู.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฏุนู ูุญุฏูุฏ ูู ุฃุฌูุฒุฉ ุงูุชูุฌูู ุงูููุฒููุฉ - krenenko-kosenko ุนูู Mikrotik (ุฏูู ุงูุงูุชูุงุต ูู ุงููุฒุงูุง ุงูุฃุฎุฑู ููุบุฏุฏ) ูุงูุทุจูุนู ูู OpenWRT.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุตุนูุจุงุช ูู ุฅุนุฏุงุฏ ุจุฑุงูุฌ ุงูุฃุฌูุฒุฉ ุงููุญูููุฉ: ุชุญุชุงุฌ ุฅูู ุชูุฒูู ุฃู ุฅูุดุงุก ุงููุซุจุช ุงูุฎุงุต ุจู ููุณุฎ ุงูุชููุฆุฉ ูู ููุงู ูุง.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฅุฐุง ูุงู ููุงู ุงูุนุฏูุฏ ูู ุงูุฃููุงู ุ ูุฅู ุงูุฑูุตุงุช ุชูุชุธุฑ ูุน ุชุญุฑูุฑ ูุญุฏุงุช systemd ุนูู ุงูุฎุงุฏู.</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenConnect (ุชุทุจูู ููุชูุญ ุงููุตุฏุฑ ูุจุฑูุชูููู Cisco Anyconnect)</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ูู ุญู ูุซูุฑ ููุงูุชูุงู ููุบุงูุฉ ุ ููู ููุฃุณู ูููู ูู ุงููุนูููุงุช. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุฅูุฌุงุจูุงุช:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุนุฏ ุงูุฏุนู ุงููุงุณุน ูุณุจููุง ููุนุฏูุฏ ูู ุงูุฃูุธูุฉ ุงูุฃุณุงุณูุฉ - Windows ู Android ู Mac ุงุณุชูุงุฏูุง ุฅูู ุชุทุจูู Cisco Anyconnect ุงูุฃุตูู ูู ุงููุชุฌุฑ - ุฎูุงุฑูุง ูุซุงูููุง ูุชูููุฑ ุงููุตูู ุฅูู ุงูุดุจูุฉ ุงูุฏุงุฎููุฉ ููุฃุฌูุฒุฉ ุงููุงุจูุฉ ููุงุฑุชุฏุงุก.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชุดููุฑ ููู ุ ุฏุนู ุงูุดูุงุฏุฉ ุ ุงุชุตุงู 2FA</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุจุฑูุชูููู ููุณู ูุงุฆู ุนูู TLS ุจุงููุงูู (ุนูู ุนูุณ OpenVPN ุ ุงูุฐู ูููู ุงูุชุดุงูู ุจุณูููุฉ ุนูู ุงููููุฐ 443). </font><font style="vertical-align: inherit;">ุจุงูุฅุถุงูุฉ ุฅูู TLS ุ ูุชู ุฃูุถูุง ุฏุนู DTLS - ุฎูุงู ุงูุฌูุณุฉ ุงููุญุฏุฏุฉ ุ ูููู ููุนููู ุงูุชุจุฏูู ุฅูู ุฅุฑุณุงู ุงูุจูุงูุงุช ุนุจุฑ UDP ูุงูุนูุณ ุตุญูุญ.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชุนุงูุด ููุชุงุฒ ุนูู ูููุฐ ูุงุญุฏ ููู ูู VPN ูุฎุงุฏู ููุจ ูุงูู ุจุงุณุชุฎุฏุงู sniproxy.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฅุนุฏุงุฏ ุณูู ููู ูู ุงูุฎุงุฏู ูุงูุนููุงุก.</font></font></li>
</ul> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุง ุฃูุถูุง ุ ูู ุชูู ุจุฏูู ุณูุจูุงุช:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงุนูู ุจุงููุงูู ูู ูุณุงุญุฉ ุงููุณุชุฎุฏู.</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅู TCP ุฃุนูู TCP ูู ููุฑุฉ ุณูุฆุฉ.</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุง ููุฌุฏ ุฏุนู ูู ูุนุฏุงุช ุงูุนููุงุก.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชุนููุฏ ุชุซุจูุช ุงูุฃููุงู ุจูู ููููุณูู: ูููู ูุธุฑููุง ูุนููููุง - ูู ุงูุฃูุถู ูุถุงุก ุจุนุถ ุงูููุช ุนูู ุดูุก ุฃูุซุฑ ูุงุฆุฏุฉ.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฅุฐุง ูุงู ููุงู ุงูุนุฏูุฏ ูู ุงูุฃููุงู ุ ูุฅู ุงูุฑูุตุงุช ูุน ุงูุนุฏูุฏ ูู ุงูุชููููุงุช ููุญุฏุงุช ุชุญุฑูุฑ ุงููุธุงู ุชูุชุธุฑ.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฏ ูุจุฏู ููุฃูู ุทุฑูู ูุณุฏูุฏ ุ ูููู ุจุนุฏ ุฅููุงุก ูุธุฑุฉ ูุงุญุตุฉ ููุถุงุก ุจุนุถ ุงูููุช ูู ุงูุฏุฑุงุณุฉ ุ ุฃุฏุฑูุช ุฃู IPSec ุงููุงุฆู ุนูู IKEv2 ูุงุฏุฑ ุนูู ุงุณุชุจุฏุงู ูู ุดูุก ุขุฎุฑ. </font><font style="vertical-align: inherit;">
ุฅูุฌุงุจูุงุช </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IKEv2 IPSEC</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุน ุธููุฑ IKEv2 ุ ุฃุตุจุญ ุชูููู ุงูุจุฑูุชูููู ููุณู ุฃุณูู ุ ููุงุฑูุฉ ุจุงูุฅุตุฏุงุฑ ุงูุณุงุจู ุ ูููู ุนูู ุญุณุงุจ ููุฏุงู ุงูุชูุงูู ุงูุนูุณู.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจูุถู ุงูุชูุญูุฏ ุงูููุงุณู ุ ูุชู ุชูููุฑ ุงูุนูู ูู ุฃู ููุงู ูุนูู ุฃู ุดูุก - ูููู ุงูุญูุงุธ ุนูู ุงููุงุฆูุฉ ุฅูู ุฃุฌู ุบูุฑ ูุณูู. </font><font style="vertical-align: inherit;">Linux ุ Mikrotik (ูู ุฃุญุฏุซ ุฅุตุฏุงุฑุงุช RouterOS) ุ OpenWRT ุ Android ุ iPhone. </font><font style="vertical-align: inherit;">ูุญุชูู Windows ุฃูุถูุง ุนูู ุฏุนู ุฃุตูู ุจุฏุกูุง ูู Windows 7.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณุฑุนุฉ ุนุงููุฉ: ูุนุงูุฌุฉ ุญุฑูุฉ ุงููุฑูุฑ ุจุงููุงูู ูู ูุณุงุญุฉ ุงูููุงุฉ. </font><font style="vertical-align: inherit;">ุฌุฒุก ูุณุงุญุฉ ุงููุณุชุฎุฏู ูุทููุจ ููุท ูุฅุนุฏุงุฏ ูุนููุงุช ุงูุงุชุตุงู ููุฑุงูุจุฉ ุตุญุฉ ุงูููุงุฉ.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงููุฏุฑุฉ ุนูู ุงุณุชุฎุฏุงู ุงูุนุฏูุฏ ูู ุทุฑู ุงููุตุงุฏูุฉ: ุจุงุณุชุฎุฏุงู ูู ูู PSK ูุงูุดูุงุฏุงุช ุ ููู ุฃู ูุฌููุนุฉ.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุนุฏูุฏ ูู ุฃูุถุงุน ุงูุชุดุบูู: ุงูููู ูุงูููู. </font><font style="vertical-align: inherit;">ููู ุชุฎุชูู ูููู ูุฑุงุกุชูุง ุจูุง ูู ุฐูู ุนูู ุญุจุฑู.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅุนุฏุงุฏุงุช ุบูุฑ ูุชุทูุจุฉ ููุนูุฏ ุงููุชูุณุทุฉ: ุฅุฐุง ูุงูุช ููุงู ูุดุงูู ูุงุฌูุฉ ุนู NAT ูู ุงูุฅุตุฏุงุฑ ุงูุฃูู ูู IKE ุ ูุฅู IKEv2 ูุญุชูู ุนูู ุขููุงุช ูุฏูุฌุฉ ููุชุบูุจ ุนูู NAT ูุงูุชุฌุฒุฆุฉ ุงูุฃุตููุฉ ูุฑุณุงุฆู IKE ุ ููุง ูุณูุญ ูู ุจุฅูุดุงุก ุงุชุตุงู ุนูู ุงููููุงุช ุจุงุณุชุฎุฏุงู ููุญูู MTU. </font><font style="vertical-align: inherit;">ูุงุณุชุดุฑุงูุง ูููุณุชูุจู ุ ุณุฃููู ุฃููู ูู ุฃูุงุฌู ูู ุงููุงูุน ุดุจูุฉ WiFi ุ ุญูุซ ูููู ููุนููู ุฅูุดุงุก ุงุชุตุงู.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุน ุฐูู ุ ูุฅู ุงูุณูุจูุงุช ุชุญุชูู ุฃูุถูุง ุนูู:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชุญุชุงุฌ ุฅูู ูุถุงุก ุจุนุถ ุงูููุช ูู ุงูุฏุฑุงุณุฉ ูููู ููููุฉ ุนูููุง.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุฒุฉ ูููู ุฃู ุชุฎูุท ูุจุชุฏุฆ: IPSec ุ ุนูู ุนูุณ ุญููู VPN ุงูุชูููุฏูุฉ ุ ูุง ุชูุดุฆ ูุงุฌูุงุช ุดุจูุฉ. </font><font style="vertical-align: inherit;">ูุชู ุชุนููู ุณูุงุณุงุช ูุนุงูุฌุฉ ุญุฑูุฉ ุงููุฑูุฑ ููุท ุ ููุชู ุญู ูู ุดูุก ุขุฎุฑ ุนู ุทุฑูู ุฌุฏุงุฑ ุงูุญูุงูุฉ.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุจู ูุชุงุจุนุฉ ุงูุฅุนุฏุงุฏ ุ ููุชุฑุถ ุฃู ุงููุงุฑุฆ ุจุงููุนู ุนูู ุฏุฑุงูุฉ ุจุงูููุงููู ูุงููุตุทูุญุงุช ุงูุฃุณุงุณูุฉ. </font><font style="vertical-align: inherit;">ููุณุงุนุฏุฉ ุงููุจุชุฏุฆูู ุ ููููู ุงูุชูุตูุฉ ุจููุงูุฉ ูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wikipedia</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ู Habr ููุณู ุ ูุงูุชู ุชุญุชูู ุจุงููุนู ุนูู ููุงูุงุช ูููุฏุฉ ููุซูุฑุฉ ููุงูุชูุงู ุญูู ูุฐุง ุงูููุถูุน.</font></font><br>
 <br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุดุฑูุน ูู ุงูุฅุนุฏุงุฏ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุนุฏ ุงูุจุช ูู ุงููุฑุงุฑ ุ ููุชูู ุฅูู ุงูุชูููู. </font><font style="vertical-align: inherit;">ูุญุชูู ูุฎุทุท ุงูุดุจูุฉ ูู ุญุงูุชู ุนูู ุงูุดูู ุงูุชุงูู (ุชูุช ุฅุฒุงูุชู ุชุญุช ุงูููุณุฏ)</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฑุณู ุชุฎุทูุทู ููุดุจูุฉ</font></font></b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/webt/g4/vc/ka/g4vckajqxwwmj1i0dalms3lipfm.png"></div>
                    </div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ipsecgw.example.com</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ุงูุฎุงุฏู ุงูุฑุฆูุณู ุงูุฐู ูุนุฏ ูุฑูุฒ ุงูุดุจูุฉ. IP ุงูุฎุงุฑุฌู 1.1.1.1. ุดุจูุฉ ุฏุงุฎููุฉ 10.0.0.0/23 ูุนููุงู ุขุฎุฑ 10.255.255.1/30 ูุฅุนุฏุงุฏ ุฌูุณุฉ BGP ุฎุงุตุฉ ูุน VPS ุ </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงูุง</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ููุฌู ููููุณ ูุจูู ุนูู ุดุจูุฉ ุตุบูุฑุฉ ุตุงูุชุฉ ูุซุจุชุฉ ูู ูุจู ุงููุงูุฏูู. ูุตุฏุฑ ISP ุนููุงู IP ุฏููุงูููู. ุงูุดุจูุฉ ุงูุฏุงุฎููุฉ 10.0.3.0/24 ุ </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">keenetic</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ููุฌู </font><b><font style="vertical-align: inherit;">ุญุฑูู</font></b><font style="vertical-align: inherit;"> ูุน ุชุซุจูุช IPSec. ูุตุฏุฑ ISP ุนููุงู IP ุฏููุงูููู. ุงูุดุจูุฉ ุงูุฏุงุฎููุฉ 10.0.4.0/24 ุ </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุญุงุฑุจู ุงูุทุฑู</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ุฃุฌูุฒุฉ ูุญูููุฉ ูุชุตูุฉ ูู ุดุจูุงุช ุบูุฑ ููุซููุฉ. ูุชู ุฅุตุฏุงุฑ ุงูุนูุงููู ููุนููุงุก ุจุดูู ุฏููุงูููู ุนูุฏ ุงูุงุชุตุงู ูู ุงูุชุฌูุน ุงูุฏุงุฎูู (10.1.1.0/24) ุ </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rkn.example.com</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- VPS ุฎุงุฑุฌ ูุทุงู ุงุฎุชุตุงุต ILV ูุญุชุฑู. </font><font style="vertical-align: inherit;">IP ุงูุฎุงุฑุฌู - 5.5.5.5 ุ ุงูุนููุงู ุงูุฏุงุฎูู 10.255.255.2/30 ูุฅุนุฏุงุฏ ุฌูุณุฉ BGP ุฎุงุตุฉ.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฎุทูุฉ ุงูุฃููู. </font><font style="vertical-align: inherit;">ูู ุงูุจุณูุท ุฅูู ุงููุนูุฏ: ุงูุฃููุงู ุจุงุณุชุฎุฏุงู ุงูููุงุชูุญ ุงููุดุชุฑูุฉ ูุณุจููุง (PSK)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููู ุจุชุซุจูุช ุงูุญุฒู ุงูุถุฑูุฑูุฉ ุนูู ูู ูู ุนูุจ Linux:</font></font><br>
<br>
<pre><code class="plaintext hljs">sudo yum install strongswan</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูู ููุง ุงููุถูููู ุ ุงูุชุญ ุงูููุงูุฐ 500 / UDP ู 4500 / UDP ูุงุณูุญ ุจูุฑูุฑ ุจุฑูุชูููู ESP. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุจุชุญุฑูุฑ ุงูููู /etc/strongswan/ipsec.secrects (ุนูู ุฌุงูุจ ุงููุถูู ipsecgw.example.com) ูุฃุถู ุงูุณุทุฑ ุงูุชุงูู:</font></font><br>
<br>
<pre><code class="plaintext hljs">mama@router.home.local: PSK "Very strong PSK"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูู ุงูุฌุงูุจ ุงูุซุงูู ุจุงููุซู:</font></font><br>
<br>
<pre><code class="plaintext hljs">root@root.mama.local: PSK "Very strong PSK"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ูุฐู ุงูุญุงูุฉ ุ ุงููุนุฑูู ูู ุนููุงู ุจุฑูุฏ ุฅููุชุฑููู ูููู. </font><font style="vertical-align: inherit;">ูููู ุงูุนุซูุฑ ุนูู ูุฒูุฏ ูู ุงููุนูููุงุช ูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููููู</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุฑุณูู </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุญูุธ ุงูุฃุณุฑุงุฑ ุ ูุงููุถู ูุฏูุง. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูู ูุถูู ipsecgw.example.com ุ ูู ุจุชุญุฑูุฑ ุงูููู /etc/strongswan/ipsec.conf:</font></font><br>
<br>
<pre><code class="cpp hljs">config setup <span class="hljs-comment">//   charon</span>
    charondebug = <span class="hljs-string">"dmn 0, mgr 0, ike 0, chd 0, job 0, cfg 0, knl 0, net 0, asn 0, enc 0, lib 0, esp 0, tls 0, tnc 0, imc 0, imv 0, pts 0"</span> <span class="hljs-comment">//  </span>
conn %<span class="hljs-keyword">default</span> <span class="hljs-comment">//    </span><font></font>
    reauth = yes<font></font>
    rekey = yes<font></font>
    keyingtries = %forever<font></font>
    keyexchange = ikev2 <span class="hljs-comment">//      - IKEv2</span><font></font>
    dpdaction = hold<font></font>
    dpddelay = <span class="hljs-number">5</span>s <span class="hljs-comment">// 5   DPD (Dead Peer Detection)   </span>
    mobike = yes <span class="hljs-comment">// Mobile IKE -     IP    </span>
conn mama <span class="hljs-comment">//  </span>
    left = %defaultroute <span class="hljs-comment">//Left -  .  %defaultroute       IKE- ,    default route</span>
    right = %any <span class="hljs-comment">//     IP-</span>
    authby = psk <span class="hljs-comment">//   -   </span>
    leftid = mama@router.home.local <span class="hljs-comment">// ID,   ipsec.secrets</span>
    rightid = root@router.mama.local <span class="hljs-comment">//ID  </span>
    leftsubnet = <span class="hljs-number">10.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>/<span class="hljs-number">23</span>,<span class="hljs-number">10.1</span><span class="hljs-number">.1</span><span class="hljs-number">.0</span>/<span class="hljs-number">24</span> 
    rightsubnet = <span class="hljs-number">10.0</span><span class="hljs-number">.3</span><span class="hljs-number">.0</span>/<span class="hljs-number">24</span><font></font>
    type = tunnel <font></font>
    ike = aes256-aes192-aes128-sha256-sha384-modp2048-modp3072-modp4096-modp8192,aes128gcm16-sha384-x25519!<font></font>
    esp = aes256-aes192-aes128-sha256-sha384-modp2048-modp3072-modp4096-modp8192,aes128gcm16-sha256-sha384-x25519! <font></font>
    <span class="hljs-keyword">auto</span> = add <span class="hljs-comment">//  charon        </span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุจุงููุซู ุ ูููู ุจุชุญุฑูุฑ ุงูุฃูุฑุงู ุนู ุจุนุฏ /etc/strongswan/ipsec.conf:</font></font><br>
<br>
<pre><code class="cpp hljs">config setup<font></font>
    charondebug = <span class="hljs-string">"dmn 0, mgr 0, ike 0, chd 0, job 0, cfg 0, knl 0, net 0, asn 0, enc 0, lib 0, esp 0, tls 0, tnc 0, imc 0, imv 0, pts 0"</span>
conn %<span class="hljs-keyword">default</span><font></font>
    reauth = yes<font></font>
    rekey = yes<font></font>
    keyingtries = %forever<font></font>
    keyexchange = ikev2<font></font>
    dpdaction = restart<font></font>
    dpddelay = <span class="hljs-number">5</span>s<font></font>
    mobike = yes<font></font>
conn mama<font></font>
    left = %defaultroute<font></font>
    right = ipsecgw.example.com<font></font>
    authby = psk<font></font>
    leftid = root@router.mama.local<font></font>
    rightid = mama@router.home.local<font></font>
    leftsubnet = <span class="hljs-number">10.0</span><span class="hljs-number">.3</span><span class="hljs-number">.0</span>/<span class="hljs-number">24</span>
    rightsubnet = <span class="hljs-number">10.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>/<span class="hljs-number">23</span>,<span class="hljs-number">10.1</span><span class="hljs-number">.1</span><span class="hljs-number">.0</span>/<span class="hljs-number">24</span><font></font>
    type = tunnel<font></font>
    ike = aes128gcm16-sha384-x25519!<font></font>
    esp = aes128gcm16-sha384-x25519!<font></font>
    <span class="hljs-keyword">auto</span> = route
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฅุฐุง ูุงุฑูุช ุงูุชููููุงุช ุ ููููู ุฃู ุชุฑู ุฃููุง ูุชุทุงุจูุฉ ุชูุฑูุจูุง ุ ููุท ูุชู ุชุจุงุฏู ุชุนุฑููุงุช ุงููุธุฑุงุก. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุชูุฌูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชููุงุฆู =</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชูุฌูู </font><font style="vertical-align: inherit;">ูุคุฏู charon ุฅูู ุชุนููู ูุฎ ูุญุฑูุฉ ุงููุฑูุฑ ุงูุชู ุชูุน ูู ุชูุฌููุงุช right / Rightsubnet (ูุญุฏุฏุงุช ุญุฑูุฉ ุงููุฑูุฑ). </font><font style="vertical-align: inherit;">ุณูุจุฏุฃ ุชูุณูู ูุนููุงุช ุงูููู ูุชุจุงุฏู ุงูููุงุชูุญ ููุฑ ุธููุฑ ุญุฑูุฉ ุงููุฑูุฑ ุงูุชู ุชูุน ุชุญุช ุงูุธุฑูู ุงููุญุฏุฏุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูู ุฎุงุฏู ipsecgw.example.com ูู ุฅุนุฏุงุฏุงุช ุฌุฏุงุฑ ุงูุญูุงูุฉ ุ ูุญุธุฑ ุงูุชููุฑ ูุดุจูุฉ 10.0.3.0/24. </font><font style="vertical-align: inherit;">ุงูุณูุงุญ ุจุฅุนุงุฏุฉ ุชูุฌูู ุงูุญุฒู ุจูู 10.0.0.0/23 ู 10.0.3.0/24 ูุงูุนูุณ. </font><font style="vertical-align: inherit;">ุนูู ุงููุถูู ุงูุจุนูุฏ ุ ูููู ุจุชูููุฐ ุฅุนุฏุงุฏุงุช ููุงุซูุฉ ุนู ุทุฑูู ุชุนุทูู ุงูุชููุฑ ูุดุจูุฉ 10.0.0.0/23 ูุฅุนุฏุงุฏ ุฅุนุงุฏุฉ ุงูุชูุฌูู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุนูุฏ ุชุดุบูู strongswan ุนูู ููุง ุงูุฎุงุฏููู ููุญุงูู ุชูููุฐ ุงูุฃูุฑ ping ุนูู ุงูุนูุฏุฉ ุงููุฑูุฒูุฉ:</font></font><br>
<br>
<pre><code class="cpp hljs">sudo systemctl restart strongswan<font></font>
ping <span class="hljs-number">10.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>
</code></pre><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุฃูุฏ ูู ุฃู ูู ุดูุก ูุนูู:</font></font></b>
                        <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function">sudo strongswan status
Security <span class="hljs-title">Associations</span> <span class="hljs-params">(<span class="hljs-number">1</span> up, <span class="hljs-number">0</span> connecting)</span>:
        mama[53]: ESTABLISHED 84 minutes ago, 1.1.1.1[mama@router.home.local]...2.2.2.2[root@router.mama.local]
        mama</span>{<span class="hljs-number">141</span>}:  INSTALLED, TUNNEL, reqid <span class="hljs-number">27</span>, ESP in UDP SPIs: c4eb45fe_i ca5ec6ca_o<font></font>
        mama{<span class="hljs-number">141</span>}:   <span class="hljs-number">10.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>/<span class="hljs-number">23</span> <span class="hljs-number">10.1</span><span class="hljs-number">.1</span><span class="hljs-number">.0</span>/<span class="hljs-number">24</span> === <span class="hljs-number">10.0</span><span class="hljs-number">.3</span><span class="hljs-number">.0</span>/<span class="hljs-number">24</span>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุณูููู ูู ุงููููุฏ ุฃูุถูุง ุงูุชุฃูุฏ ูู ุชุนููู ุงููุนููุฉ make_before_break ุนูู "ูุนู" ูู ููู /etc/strongswan/strongswan.d/charon.conf ูุฏู ุฌููุน ุงูุฃูุฑุงู. </font><font style="vertical-align: inherit;">ูู ูุฐู ุงูุญุงูุฉ ุ ูู ูุญุฐู ุจุฑูุงูุฌ charon ุงูุฐู ูุฎุฏู ุจุฑูุชูููู IKEv2 ุงูุชุฑุงู ุงูุฃูุงู ุงูุญุงูู ุฃุซูุงุก ุฅุฌุฑุงุก ุชุบููุฑ ุงูููุชุงุญ ุ ููููู ุณููุดุฆ ูุงุญุฏูุง ุฌุฏูุฏูุง ุฃููุงู.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฎุทูุฉ ุงูุซุงููุฉ </font><font style="vertical-align: inherit;">ุธููุฑ ุงูุญุฑููุฉ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุงูุช ุงูููุงุฌุฃุฉ ุงูุณุงุฑุฉ ูู IPSec VPN ุงููุฏูุฌ ูู ุงูุจุฑูุงูุฌ ุงูุซุงุจุช ุงูุฑุณูู Keenetic. </font><font style="vertical-align: inherit;">ูุชูุดูุทู ุ ูุง ุนููู ุณูู ุงูุงูุชูุงู ุฅูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅุนุฏุงุฏุงุช ููููุงุช KeeneticOS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุฅุถุงูุฉ ุญุฒูุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPSec VPN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฌูุฒ ุงูุฅุนุฏุงุฏุงุช ุนูู ุงูุนูุฏุฉ ุงููุฑูุฒูุฉ ููุฐุง: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชุญุฑูุฑ /etc/strongswan/ipsec.secrects ูุฅุถุงูุฉ PSK ูููุธูุฑ ุงูุฌุฏูุฏ:</font></font><br>
<br>
<pre><code class="plaintext hljs">keenetic@router.home.local: PSK "Keenetic+PSK"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชุญุฑูุฑ /etc/strongswan/ipsec.conf ูุฅุถุงูุฉ ุงุชุตุงู ุขุฎุฑ ุฅูู ุงูููุงูุฉ:</font></font><br>
<br>
<pre><code class="cpp hljs">conn keenetic<font></font>
    left = %defaultroute<font></font>
    right = %any<font></font>
    authby = psk<font></font>
    leftid = keenetic@router.home.local<font></font>
    rightid = root@router.keenetic.local<font></font>
    leftsubnet = <span class="hljs-number">10.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>/<span class="hljs-number">23</span>
    rightsubnet = <span class="hljs-number">10.0</span><span class="hljs-number">.4</span><span class="hljs-number">.0</span>/<span class="hljs-number">24</span><font></font>
    type = tunnel<font></font>
    ike = aes256-aes192-aes128-sha256-sha384-modp2048-modp3072-modp4096-modp8192,aes128gcm16-sha384-x25519!<font></font>
    esp = aes256-aes192-aes128-sha256-sha384-modp2048-modp3072-modp4096-modp8192,aes128gcm16-sha256-sha384-x25519!<font></font>
    <span class="hljs-keyword">auto</span> = add
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูู ุงูุฌุงูุจ ุงูุญุฑูู ุ ูุชู ุงูุชููุฆุฉ ูู WebUI ุนูู ุทูู ุงููุณุงุฑ: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฅูุชุฑูุช -&gt; ุงุชุตุงูุงุช -&gt; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงุชุตุงูุงุช ุฃุฎุฑู</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">ุฅูู ุจุณูุท ููุบุงูุฉ</font></font><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(3 ุตูุฑ)</font></font></b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/webt/0y/im/lp/0yimlpwidapstotzn9jqrs6f4za.png"><br>
<br>
<img src="https://habrastorage.org/webt/yi/xm/wv/yixmwvbj_fvsde_suu4_6wzooni.png"><br>
<br>
<img src="https://habrastorage.org/webt/fu/x-/6q/fux-6qh4mpc6nkz8ieu2egqpc54.png"><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฅุฐุง ููุช ุชุฎุทุท ูููุงุฏุฉ ูููุงุช ูุจูุฑุฉ ูู ุญุฑูุฉ ุงููุฑูุฑ ุนุจุฑ ุงูููู ุ ูููููู ูุญุงููุฉ ุชูููู ุชุณุฑูุน ุงูุฃุฌูุฒุฉ ุ ูุงูุฐู ุชุฏุนูู ุงูุนุฏูุฏ ูู ุงูููุงุฐุฌ. </font><font style="vertical-align: inherit;">ููููู ุจูุงุณุทุฉ ุฃูุฑ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃุฌูุฒุฉ ูุญุฑู ุงูุชุดููุฑ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู CLI. </font><font style="vertical-align: inherit;">ูุชุนุทูู ุนูููุงุช ุงูุชุดููุฑ ูุงูุชุฌุฒุฆุฉ ููุนุงูุฌุชูุง ุจุงุณุชุฎุฏุงู ุชุนูููุงุช ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ููุฃุบุฑุงุถ ุงูุนุงูุฉ - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุฑูุงูุฌ ูุญุฑู ุงูุชุดููุฑ</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ุจุนุฏ ุญูุธ ุงูุฅุนุฏุงุฏุงุช ุ ูููู ุจุงุณุชุนุงุฏุฉ ุงูููู ููุชุฑู Keenetic ูููุฑ ููุฏุฉ ูุตู ุฏูููุฉ. </font><font style="vertical-align: inherit;">ุซู ูุฑู ูู ุงููุญุทุฉ ุงุชุตุงู ูุงุฌุญ:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุดูุก ูุนูู:</font></font></b>
                        <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function">sudo strongswan status
Security <span class="hljs-title">Associations</span> <span class="hljs-params">(<span class="hljs-number">2</span> up, <span class="hljs-number">0</span> connecting)</span>:
    keenetic[57]: ESTABLISHED 39 minutes ago, 1.1.1.1[keenetic@router.home.local]...3.3.3.3[root@router.keenetic.local]
    keenetic</span>{<span class="hljs-number">146</span>}:  INSTALLED, TUNNEL, reqid <span class="hljs-number">29</span>, ESP SPIs: ca8f556e_i ca11848a_o<font></font>
    keenetic{<span class="hljs-number">146</span>}:   <span class="hljs-number">10.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>/<span class="hljs-number">23</span> === <span class="hljs-number">10.0</span><span class="hljs-number">.4</span><span class="hljs-number">.0</span>/<span class="hljs-number">24</span>
        mama[<span class="hljs-number">53</span>]: ESTABLISHED <span class="hljs-number">2</span> hours ago, <span class="hljs-number">1.1</span><span class="hljs-number">.1</span><span class="hljs-number">.1</span>[mama@router.home.local]..<span class="hljs-number">.2</span><span class="hljs-number">.2</span><span class="hljs-number">.2</span><span class="hljs-number">.2</span>[root@router.mama.local]<font></font>
        mama{<span class="hljs-number">145</span>}:  INSTALLED, TUNNEL, reqid <span class="hljs-number">27</span>, ESP in UDP SPIs: c5dc78db_i c7baafd2_o<font></font>
        mama{<span class="hljs-number">145</span>}:   <span class="hljs-number">10.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>/<span class="hljs-number">23</span> <span class="hljs-number">10.1</span><span class="hljs-number">.1</span><span class="hljs-number">.0</span>/<span class="hljs-number">24</span> === <span class="hljs-number">10.0</span><span class="hljs-number">.3</span><span class="hljs-number">.0</span>/<span class="hljs-number">24</span>
</code></pre><br>
</div>
                    </div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฎุทูุฉ ุงูุซุงูุซุฉ </font><font style="vertical-align: inherit;">ุญูุงูุฉ ุงูุฃุฌูุฒุฉ ุงููุญูููุฉ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุนุฏ ูุฑุงุกุฉ ูุฌููุนุฉ ูู ุงููุชูุจุงุช ููุฌููุนุฉ ูู ุงูููุงูุงุช ุ ุชูุฑุฑ ุงูุชููู ุนูุฏ ูุฌููุนุฉ ูู ุดูุงุฏุฉ ูุฌุงููุฉ ูู Let's Encrypt ููุตุงุฏูุฉ ุงูุฎุงุฏู ูุงูุชูููุถ ุงูููุงุณููู ุนู ุทุฑูู ุชุณุฌูู ุงูุฏุฎูู ููููุฉ ุงููุฑูุฑ ููุนููุงุก. </font><font style="vertical-align: inherit;">ูุจุงูุชุงูู ุ ูุชุฎูุต ูู ุงูุญุงุฌุฉ ุฅูู ุงูุญูุงุธ ุนูู ุงูุจููุฉ ุงูุชุญุชูุฉ ููููุงุชูุญ ุงูุนููููุฉ ุงูุฎุงุตุฉ ุจูุง ุ ููุฑุงูุจุฉ ุงูุชูุงุก ุตูุงุญูุฉ ุงูููุงุชูุญ ูุฅุฌุฑุงุก ุฅููุงุกุงุช ุบูุฑ ุถุฑูุฑูุฉ ูุน ุงูุฃุฌูุฒุฉ ุงููุญูููุฉ ุนู ุทุฑูู ุชุซุจูุช ุงูุดูุงุฏุงุช ุงููููุนุฉ ุฐุงุชููุง ูู ุงููุงุฆูุฉ ุงูููุซููุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุจุชุซุจูุช ุงูุญุฒู ุงูููููุฏุฉ:</font></font><br>
<br>
<pre><code class="plaintext hljs">sudo yum install epel-release<font></font>
sudo yum install certbot</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุญุตู ุนูู ุงูุดูุงุฏุฉ ุงููุณุชููุฉ (ูุง ุชูุณ ุฃู ุชูุชุญ 80 / tcp ูู ุฅุนุฏุงุฏุงุช iptables ุฃููุงู):</font></font><br>
<br>
<pre><code class="plaintext hljs">sudo certbot certonly --standalone -d ipsecgw.example.com</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุนุฏ ุงูุชูุงุก ุณูุฑุชุจูุช ูู ุนูููุง ุ ูุฌุจ ุฃู ูุนูู ุณุชุฑููุฌุณูุงู ูุฑุคูุฉ ุดูุงุฏุชูุง:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงูุฏููู /etc/strongswan/ipsec.d/cacerts ุฃูุดุฆ ุฑุงุจุทูู ุฑูุฒููู: ุฃุญุฏููุง ุฅูู ุงููุชุฌุฑ ุงูุฌุฐุฑู ููุดูุงุฏุงุช ุงูููุซูู ุจูุง ูู / etc / pki / tls / certs ุ </font><font style="vertical-align: inherit;">ูุซุงููุฉ ุจุงุณู ca.pem ุชุดูุฑ ุฅูู /etc/letsencrypt/live/ipsecgw.example.com/chain.pem</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชู ุฃูุถูุง ุฅูุดุงุก ุงุฑุชุจุงุทูู ุฑูุฒููู ูู ุฏููู /etc/strongswan/ipsec.d/certs: ูุดูุฑ ุงูุฃูู ุ ุงูุฐู ูุญูู ุงุณู Certificate.pem ุ ุฅูู ุงูููู /etc/letsencrypt/live/ipsecgw.example.com/cert.pem. </font><font style="vertical-align: inherit;">ูุงูุซุงูู ุ ูุฏุนู fullchain.pem ุ ููุฑุชุจุท ุจู /etc/letsencrypt/live/ipsecgw.example.com/fullchain.pem</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงูุฏููู /etc/strongswan/ipsec.d/private ุ ุถุน ุงูุฑุงุจุท ุงูุฑูุฒู key.pem ุงูุฐู ูุดูุฑ ุฅูู ุงูููุชุงุญ ุงูุฎุงุต ุงูุฐู ุชู ุฅูุดุงุคู ุจูุงุณุทุฉ certbot ูุงููููู ุนูู ุงููุณุงุฑ /etc/letsencrypt/live/ipsecgw.example.com/privkey.pem</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฃุถู ุงููุตุงุฏูุฉ ุนุจุฑ RSA ุฅูู ipsec.secrets ููุฌููุนุฉ ูู ุชุณุฌููุงุช ุงูุฏุฎูู / ูููุงุช ุงููุฑูุฑ ูููุณุชุฎุฏููู ุงูุฌุฏุฏ:</font></font><br>
<br>
<pre><code class="plaintext hljs">ipsecgw.example.com     : RSA key.pem<font></font>
username phone          : EAP "Q1rkz*qt"<font></font>
username notebook       : EAP "Zr!s1LBz"<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุนูุฏ ุชุดุบูู Strongswan ูุนูุฏ ุงุณุชุฏุนุงุก ููุงุฆู sudo strongswan ูุฌุจ ุฃู ูุฑู ูุนูููุงุช ุงูุดูุงุฏุฉ:</font></font><br>
<br>
<pre><code class="plaintext hljs">List of X.509 End Entity Certificates<font></font>
<font></font>
  subject:  "CN=ipsecgw.example.com"<font></font>
  issuer:   "C=US, O=Let's Encrypt, CN=Let's Encrypt Authority X3"<font></font>
  validity:  not before May 23 19:36:52 2020, ok<font></font>
             not after  Aug 21 19:36:52 2020, ok (expires in 87 days)<font></font>
  serial:    04:c7:70:9c:a8:ce:57:cc:bf:6f:cb:fb:d3:a9:cf:06:b0:a8<font></font>
  altNames:  ipsecgw.example.com<font></font>
  flags:     serverAuth clientAuth<font></font>
  OCSP URIs: http://ocsp.int-x3.letsencrypt.org<font></font>
  certificatePolicies:<font></font>
             2.23.140.1.2.1<font></font>
             1.3.6.1.4.1.44947.1.1.1<font></font>
             CPS: http://cps.letsencrypt.org<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุซู ูุตู ุงูุงุชุตุงู ุงูุฌุฏูุฏ ูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ipsec.conf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cpp hljs">conn remote-access<font></font>
    dpddelay = <span class="hljs-number">30</span>s <span class="hljs-comment">//   DPD ,     </span><font></font>
    left = %defaultroute<font></font>
    leftid = <span class="hljs-string">"CN=ipsecgw.example.com"</span>
    leftcert = fullchain.pem <span class="hljs-comment">//         </span><font></font>
    leftsendcert = always<font></font>
    leftsubnet = <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>/<span class="hljs-number">0</span> <span class="hljs-comment">//      </span><font></font>
    right = %any<font></font>
    rightid = %any<font></font>
    rightauth = eap-mschapv2 <span class="hljs-comment">// ,  EAP-MSCHAP2</span><font></font>
    rightsendcert = never<font></font>
    eap_identity = %identity <font></font>
    rightsourceip = <span class="hljs-number">10.1</span><span class="hljs-number">.1</span><span class="hljs-number">.0</span>/<span class="hljs-number">24</span> <span class="hljs-comment">//Strongswan       </span>
    rightdns = <span class="hljs-number">10.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>,<span class="hljs-number">10.0</span><span class="hljs-number">.0</span><span class="hljs-number">.3</span> <span class="hljs-comment">//   DNS</span><font></font>
    type = tunnel<font></font>
    ike = aes256-aes192-aes128-sha256-sha384-modp2048-modp3072-modp4096-modp8192,aes128gcm16-sha384-x25519!<font></font>
    esp = aes256-aes192-aes128-sha256-sha384-modp2048-modp3072-modp4096-modp8192,aes128gcm16-sha256-sha384-x25519!<font></font>
    <span class="hljs-keyword">auto</span> = add <span class="hljs-comment">//      </span>
    dpdaction = restart <span class="hljs-comment">// ,      DPD</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุง ุชูุณ ุชุญุฑูุฑ ุงูููู / etc / sysconfig / certbot ููุฅุดุงุฑุฉ ุฅูู ุฃููุง ุณูููู ุฃูุถูุง ุจุชุญุฏูุซ ุงูุดูุงุฏุฉ ุนูู ุฃููุง ูุงุฆูุฉ ุจุฐุงุชูุง ุ ูุน ุฅุถุงูุฉ CERTBOT_ARGS = "- ูุณุชูู" ุฅูููุง. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฃูุถูุง ุ ูุง ุชูุณ ุชุดุบูู ูููุช certbot-ุชุฌุฏูุฏ.timer ูุชุนููู ุงูุฎุทุงู ูุฅุนุงุฏุฉ ุชุดุบูู Strongswan ูู ุญุงูุฉ ุฅุตุฏุงุฑ ุดูุงุฏุฉ ุฌุฏูุฏุฉ. </font><font style="vertical-align: inherit;">ููููุงู ุจุฐูู ุ ุฅูุง ุฃู ุชุถุน ูุต bash ุจุณูุทูุง ูู / etc / allowencrypt / ุชุฌุฏูุฏ ุงูุชุฌุฏูุฏ / ุงููุดุฑ / ุ ุฃู ูู ุจุชุญุฑูุฑ ููู / etc / sysconfig / certbot ูุฑุฉ ุฃุฎุฑู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุนูุฏ ุชุดุบูู Strongswan ุ ููููู ุจุชุดุบูู ุงูุชููุฑ ูุดุจูุฉ 10.1.1.0/24 ูู iptables ููุณุชูุฑ ูู ุชูููู ุงูุฃุฌูุฒุฉ ุงููุญูููุฉ.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฐูุฑู ุงููุธูุฑ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุจุชุซุจูุช ุชุทุจูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Strongswan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู Google Play </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฃุทูููุง ูุฎูู ุฌุฏูุฏ</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูููู ุงูุดุฎุตู</font></font></b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/webt/qg/il/ly/qgilly6_cm-2-7jdlo8gtrkyqum.png"><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุญู ูุญูุธ ุงูููู ุงูุดุฎุตู ุ ููุชุตู ุ ูุจุนุฏ ุซุงููุฉ ุ ูุง ุฏุงุนู ููููู ุจุดุฃู ูุฏุฑุฉ ุดุฎุต ูุง ุนูู ุงูุชุฌุณุณ ุนูููุง.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุญู ููุญุต:</font></font></b>
                        <div class="spoiler_text"><pre><code class="plaintext hljs">sudo strongswan statusall<font></font>
Security Associations (3 up, 0 connecting):<font></font>
remote-access[109]: ESTABLISHED 2 seconds ago, 1.1.1.1[CN=ipsecgw.example.com]...4.4.4.4[phone]<font></font>
remote-access{269}:  INSTALLED, TUNNEL, reqid 55, ESP in UDP SPIs: c706edd1_i e5c12f1d_o<font></font>
remote-access{269}:   0.0.0.0/0 ::/0 === 10.1.1.1/32<font></font>
        mama[101]: ESTABLISHED 34 minutes ago, 1.1.1.1[mama@router.home.local]...2.2.2.2[root@router.mama.local]<font></font>
        mama{265}:  INSTALLED, TUNNEL, reqid 53, ESP in UDP SPIs: c8c83342_i c51309db_o<font></font>
        mama{265}:   10.0.0.0/23 10.1.1.0/24 === 10.0.3.0/24<font></font>
    keenetic[99]: ESTABLISHED 36 minutes ago, 1.1.1.1[keenetic@router.home.local]...3.3.3.3[root@router.keenetic.local]<font></font>
    keenetic{263}:  INSTALLED, TUNNEL, reqid 52, ESP SPIs: c3308f33_i c929d6f1_o<font></font>
    keenetic{263}:   10.0.0.0/23 === 10.0.4.0/24</code></pre><br>
</div>
                    </div><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุดุจุงุจูู</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุฌุฆุช Windows ูู ุงูุฅุตุฏุงุฑุงุช ุงูุญุงููุฉ ุณุงุฑุฉ. </font><font style="vertical-align: inherit;">ุชุชู ุฌููุน ุฅุนุฏุงุฏุงุช VPN ุงูุฌุฏูุฏุฉ ุนู ุทุฑูู ุงุณุชุฏุนุงุก cmdlets PowerShell cmdlets:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Add-VpnConnection</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">"IKEv2"</span> <span class="hljs-literal">-ServerAddress</span> ipsecgw.example.com <span class="hljs-literal">-TunnelType</span> <span class="hljs-string">"IKEv2"</span>
<span class="hljs-built_in">Set-VpnConnectionIPsecConfiguration</span> <span class="hljs-literal">-ConnectionName</span> <span class="hljs-string">"IKEv2"</span> <span class="hljs-literal">-AuthenticationTransformConstants</span> SHA256128 <span class="hljs-literal">-CipherTransformConstants</span> AES128 <span class="hljs-literal">-EncryptionMethod</span> AES128 <span class="hljs-literal">-IntegrityCheckMethod</span> SHA256 <span class="hljs-literal">-PfsGroup</span> PFS2048 <span class="hljs-literal">-DHGroup</span> Group14 <span class="hljs-literal">-PassThru</span> <span class="hljs-literal">-Force</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููุงู ุดูุก ุขุฎุฑ ุ ุฅุฐุง ุชู ุชูููู Strongswan ูุฅุตุฏุงุฑ ุนูุงููู IPv6 ููุนููุงุก (ูุนู ุ ููููู ุงูููุงู ุจุฐูู ุฃูุถูุง):</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Add-VpnConnectionRoute</span> <span class="hljs-literal">-ConnectionName</span> <span class="hljs-string">"IKEv2"</span> <span class="hljs-literal">-DestinationPrefix</span> <span class="hljs-string">"2000::/3"</span></code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฌุฒุก ุงูุฑุงุจุน ุ ุงูููุงุฆู. </font><font style="vertical-align: inherit;">ูุทุนูุง ูุงูุฐุฉ ุฅูู ุฃูุฑูุจุง</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุนุฏ ุฃู ุฑุฃูุช ุจุฐุฑุฉ ุงููุฒูุฏ "ุชู ุญุธุฑ ุงููููุน ุจูุฑุงุฑ ุงููุนุจ ุงูุฃูุณุฑ ูููุงุฆุจ ุงูุฎุงูุณ ูููุฏุนู ุงูุนุงู ููุฑูุฉ ุชุฑูุฏููู ููุฒููู ูู ููุงุทุนุฉ ุจูุบูุฒุงุจููุช" ุ ุธูุฑ VPS ุตุบูุฑ ุบูุฑ ูุงุถุญ (ูุน ุงุณู ุงููุฌุงู ุงูุฐู ูุจุฏู ุฌูุฏูุง rkn.example.com) ุนูู ุจุนุฏ ุฃูู ูููููุชุฑ ูู ุงููุฑูุฏ ุงูุชู ุชุฑุบุจ ูู ุงูุชูููุญ ุจุญุงุฌุฒ ููุญุฌุจ ูุญุฌุจ ุดุจูุงุช ุงูุญุฌู. / 16 ูุฑุฉ. ููุงู ุงูุบุฒู ุนูู VPS ุงูุตุบูุฑ ูุฐุง ุฅูุดุงุกูุง ุฑุงุฆุนูุง ูุฒููุงุก ูู NIC.CZ ูุณูู BIRD. ุชููู ุทุงุฆุฑ ุงูุฅุตุฏุงุฑ ุงูุฃูู ุจุงุณุชูุฑุงุฑ ูู ุญุงูุฉ ูู ุงูุฐุนุฑ ูู ูุดุงุท ุงููุฑูุฏ ุจุงููุฑุงูุงุช ุ ุงูุฐูู ุญุธุฑูุง ูุง ููุฑุจ ูู 4 ูช ูู ุงูุฅูุชุฑูุช ูู ุฐุฑูุฉ ูุดุงุท ุงููุฎุงุถ ุ ุชุงุฑููู ุงูุชูููุฑ ุงูุนููู ุฃุซูุงุก ุฅุนุงุฏุฉ ุงูุชูููู ุ ูุฐูู ุชู ุชุญุฏูุซู ุฅูู ุงูุฅุตุฏุงุฑ 2.0.7. ุฅุฐุง ูุงู ุงููุฑุงุก ููุชููู ุ ูุณุฃูุดุฑ ููุงููุง ุนู ุงูุงูุชูุงู ูู BIRD ุฅูู BIRD2 ุ ูุงูุฐู ุชุบูุฑ ููู ุชูุณูู ุงูุชูููู ุจุดูู ูุจูุฑ ุููู ุงูุฅุตุฏุงุฑ ุงูุฌุฏูุฏ ุฃุตุจุญ ุฃุณุฑุน ุจูุซูุฑ ููุง ุชูุฌุฏ ูุดุงูู ูู ุฅุนุงุฏุฉ ุงูุชุดููู ุจุนุฏุฏ ูุจูุฑ ูู ุงููุณุงุฑุงุช. ูุจูุง ุฃููุง ูุณุชุฎุฏู ุจุฑูุชูููู ุงูุชูุฌูู ุงูุฏููุงูููู ุ ููุฌุจ ุฃู ุชููู ููุงู ูุงุฌูุฉ ุดุจูุฉ ุชุญุชุงุฌ ูู ุฎูุงููุง ุฅูู ุชูุฌูู ุญุฑูุฉ ุงููุฑูุฑ. ุจุดูู ุงูุชุฑุงุถู ุ ูุง ูููู IPSec ุจุฅูุดุงุก ูุงุฌูุงุช ุ ูููู ูุธุฑูุง ููุฑููุชู ุ ูููููุง ุงุณุชุฎุฏุงู ุฃููุงู GRE ุงูููุงุณูููุฉ ุ ูุงูุชู ุณูุญูููุง ูู ุงููุณุชูุจู. ูููุงูุฃุฉ ุ ุณูููู ูุถููู ipsecgw.example.com ู rkn.example.com ุจูุตุงุฏูุฉ ุจุนุถููุง ุงูุจุนุถ ุจุงุณุชุฎุฏุงู ุดูุงุฏุงุช ุงูุชุฌุฏูุฏ ุงูุฐุงุชู Lets Encrypt. ูุง ููุฌุฏ PSK ุ ููุท ุงูุดูุงุฏุงุช ุ ุงููุชุดุฏุฏูู ููุท ุ ููุณ ููุงู ุงููุซูุฑ ูู ุงูุฃูุงู.ุจุดูู ุงูุชุฑุงุถู ุ ูุง ูููู IPSec ุจุฅูุดุงุก ูุงุฌูุงุช ุ ูููู ูุธุฑูุง ููุฑููุชู ุ ูููููุง ุงุณุชุฎุฏุงู ุฃููุงู GRE ุงูููุงุณูููุฉ ุ ูุงูุชู ุณูุญูููุง ูู ุงููุณุชูุจู. ูููุงูุฃุฉ ุ ุณูููู ูุถููู ipsecgw.example.com ู rkn.example.com ุจูุตุงุฏูุฉ ุจุนุถููุง ุงูุจุนุถ ุจุงุณุชุฎุฏุงู ุดูุงุฏุงุช ุงูุชุฌุฏูุฏ ุงูุฐุงุชู Lets Encrypt. ูุง ููุฌุฏ PSK ุ ููุท ุงูุดูุงุฏุงุช ุ ุงููุชุดุฏุฏูู ููุท ุ ููุณ ููุงู ุงููุซูุฑ ูู ุงูุฃูุงู.ุจุดูู ุงูุชุฑุงุถู ุ ูุง ูููู IPSec ุจุฅูุดุงุก ูุงุฌูุงุช ุ ูููู ูุธุฑูุง ููุฑููุชู ุ ูููููุง ุงุณุชุฎุฏุงู ุฃููุงู GRE ุงูููุงุณูููุฉ ุ ูุงูุชู ุณูุญูููุง ูู ุงููุณุชูุจู. ูููุงูุฃุฉ ุ ุณูููู ูุถููู ipsecgw.example.com ู rkn.example.com ุจูุตุงุฏูุฉ ุจุนุถููุง ุงูุจุนุถ ุจุงุณุชุฎุฏุงู ุดูุงุฏุงุช ุงูุชุฌุฏูุฏ ุงูุฐุงุชู Lets Encrypt. ูุง ููุฌุฏ PSK ุ ููุท ุงูุดูุงุฏุงุช ุ ุงููุชุดุฏุฏูู ููุท ุ ููุณ ููุงู ุงููุซูุฑ ูู ุงูุฃูุงู.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุนุชูุฏ ุฃู VPS ุฌุงูุฒ ุ ููุฏ ุชู ุชุซุจูุช Strongswan ู Certbot ุจุงููุนู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูู ูุถูู ipsecgw.example.com (ุนููุงู IP ุงูุฎุงุต ุจู ูู 1.1.1.1) ุ ูุตู ูุงุฌูุฉ gif0 ุงูุฌุฏูุฏุฉ:</font></font><br>
<pre><code class="plaintext hljs">sudo vi /etc/sysconfig/network-scripts/ifcfg-gif0<font></font>
DEVICE="gif0"<font></font>
MY_OUTER_IPADDR="1.1.1.1"<font></font>
PEER_OUTER_IPADDR="5.5.5.5"<font></font>
MY_INNER_IPADDR="10.255.255.1/30"<font></font>
PEER_INNER_IPADDR="10.255.255.2/30"<font></font>
TYPE="GRE"<font></font>
TTL="64"<font></font>
MTU="1442"<font></font>
ONBOOT="yes"<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุนููุณุฉ ุนูู ุงููุถูู vps.example.com (ุนููุงู IP ูู 5.5.5.5):</font></font><br>
<br>
<pre><code class="plaintext hljs">sudo vi /etc/sysconfig/network-scripts/ifcfg-gif0<font></font>
DEVICE="gif0"<font></font>
MY_OUTER_IPADDR="5.5.5.5"<font></font>
PEER_OUTER_IPADDR="1.1.1.1"<font></font>
MY_INNER_IPADDR="10.255.255.2/30"<font></font>
PEER_INNER_IPADDR="10.255.255.1/30"<font></font>
TYPE="GRE"<font></font>
TTL="64"<font></font>
MTU="1442"<font></font>
ONBOOT="yes"<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฑูุน ุงููุงุฌูุงุช ุ ูููู ูุธุฑูุง ูุฃู iptables ูุง ูุญุชูู ุนูู ูุงุนุฏุฉ ุชุณูุญ ุจุจุฑูุชูููู GRE ุ ููู ุชูุชูู ุญุฑูุฉ ุงููุฑูุฑ (ููู ูุง ูุญุชุงุฌ ุฅููู ุ ูุธุฑูุง ูุนุฏู ูุฌูุฏ ุญูุงูุฉ ุฏุงุฎู GRE ุถุฏ ุงููุนุฌุจูู ูู ุฃู ููุน ูู "ุงูุญุฒู" ุงูุชุดุฑูุนูุฉ).</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุทุจุฎ VPS</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฃููุงู ุ ูุญุตู ุนูู ุดูุงุฏุฉ ุฃุฎุฑู ูุงุณู ุงููุทุงู rkn.example.com. </font><font style="vertical-align: inherit;">ูู ุจุฅูุดุงุก ุฑูุงุจุท ุฑูุฒูุฉ ูู /etc/strongswan/ipsec.d ููุง ูู ููุถุญ ูู ุงููุณู ุงูุณุงุจู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุจุชุนุฏูู ipsec.secrets ุจุฅุถุงูุฉ ุณุทุฑ ูุงุญุฏ ุฅูููุง:</font></font><br>
<br>
<pre><code class="plaintext hljs">rkn.example.com     : RSA key.pem</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชุญุฑูุฑ ipsec.conf:</font></font><br>
<br>
<pre><code class="cpp hljs">config setup<font></font>
    charondebug = <span class="hljs-string">"dmn 0, mgr 0, ike 0, chd 0, job 0, cfg 0, knl 0, net 0, asn 0, enc 0, lib 0, esp 0, tls 0, tnc 0, imc 0, imv 0, pts 0"</span><font></font>
    strictcrlpolicy = yes<font></font>
conn %<span class="hljs-keyword">default</span><font></font>
    reauth = yes<font></font>
    rekey = yes<font></font>
    keyingtries = %forever<font></font>
    keyexchange = ikev2<font></font>
    dpdaction = restart<font></font>
    dpddelay = <span class="hljs-number">5</span>s<font></font>
    mobike = yes<font></font>
conn rkn<font></font>
    left = %defaultroute<font></font>
    right = ipsecgw.example.com<font></font>
    authby = pubkey<font></font>
    leftcert = fullchain.pem<font></font>
    leftsendcert = always<font></font>
    leftauth = pubkey<font></font>
    rightauth = pubkey<font></font>
    leftid = <span class="hljs-string">"CN=rkn.example.com"</span>
    rightid = <span class="hljs-string">"CN=ipsecgw.example.com"</span><font></font>
    rightrsasigkey = /etc/strongswan/ipsec.d/certs/ipsecgw.example.com.pem<font></font>
    leftsubnet = %dynamic<font></font>
    rightsubnet = %dynamic<font></font>
    type = transport<font></font>
    ike = aes256gcm16-sha384-x25519!<font></font>
    esp = aes256gcm16-sha384-x25519!<font></font>
    <span class="hljs-keyword">auto</span> = route</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูู ุฌุงูุจ ุงููุถูู ุ ุชูุช ุฅุถุงูุฉ ipsecgw.example.com ุฃูุถูุง ุฅูู ipsec.conf ูู ูุณู ุงูุฅุนุฏุงุฏ ุงููุนููุฉ ุงูุตุงุฑูุฉ = ูุนู ุ ูุงูุชู ุชุชุถูู ูุญุต CRL ุงูุตุงุฑู. </font><font style="vertical-align: inherit;">ููุตู ุงุชุตุงู ุขุฎุฑ:</font></font><br>
<br>
<pre><code class="cpp hljs">conn rkn<font></font>
    left = %defaultroute<font></font>
    right = rkn.example.com<font></font>
    leftcert = fullchain.pem<font></font>
    leftsendcert = always<font></font>
    leftauth = pubkey<font></font>
    rightauth = pubkey<font></font>
    rightrsasigkey = /etc/strongswan/ipsec.d/certs/rkn.exapmle.com.pem<font></font>
    leftid = <span class="hljs-string">"CN=ipsecgw.example.com"</span>
    rightid = <span class="hljs-string">"CN=rkn.example.com"</span><font></font>
    leftsubnet = %dynamic<font></font>
    rightsubnet = %dynamic<font></font>
    type = transport<font></font>
    ike = aes256gcm16-sha384-x25519!<font></font>
    esp = aes256gcm16-sha384-x25519!<font></font>
    <span class="hljs-keyword">auto</span> = route<font></font>
    dpdaction = restart<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุชู ุนูุณ Conf Confs ุชูุฑูุจูุง. </font><font style="vertical-align: inherit;">ูููู ูููุงุฑุฆ ุงูููุธ ุจุงููุนู ุงูุงูุชุจุงู ุฅูู ููุทุชูู:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">left / Rightsubnet =ูช dynamic - ููุฌู Strongswan ุฅูู ุชุทุจูู ุงูุณูุงุณุงุช ุนูู ุฌููุน ุฃููุงุน ุงูุฒูุงุฑุงุช ุจูู ุฃูุฑุงููู</font></font></li>
<li>      rightrsasigkey.     IKE SA     IKE AUTH ERROR  ,  Strongswan         RSA-  .        openssl.     (ipsecgw  RKN)  sudo /usr/bin/openssl rsa -in /etc/letsencrypt/live/ipsecgw.example.com/privkey.pem -pubout &gt; ~/ipsecgw.example.com.pem  sudo /usr/bin/openssl rsa -in /etc/letsencrypt/live/rkn.example.com/privkey.pem -pubout &gt; ~/rkn.example.com.pem,     scp       ,   </li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุง ุชูุณู ุชูููู ุดูุงุฏุงุช ุฌุฏุงุฑ ุงูุญูุงูุฉ ูุงูุชุฌุฏูุฏ ุงูุชููุงุฆู. </font><font style="vertical-align: inherit;">ุจุนุฏ ุฅุนุงุฏุฉ ุชุดุบูู Strongswan ุนูู ููุง ุงูุฎุงุฏููู ุ ุงุจุฏุฃ ุชูููุฐ ุงูุฃูุฑ ping ุนูู ุงูุฌุงูุจ ุงูุจุนูุฏ ูู ููู GRE ูุดุงูุฏ ุงุชุตุงู ูุงุฌุญ. </font><font style="vertical-align: inherit;">ุนูู VPS (rkn):</font></font><br>
<br>
<pre><code class="plaintext hljs">sudo strongswan status<font></font>
Routed Connections:<font></font>
         rkn{1}:  ROUTED, TRANSPORT, reqid 1<font></font>
         rkn{1}:   5.5.5.5/32 === 1.1.1.1/32<font></font>
Security Associations (1 up, 0 connecting):<font></font>
         rkn[33]: ESTABLISHED 79 minutes ago, 5.5.5.5[CN=rkn.example.com]...1.1.1.1[CN=ipsecgw.example.com]<font></font>
         rkn{83}:  INSTALLED, TRANSPORT, reqid 1, ESP SPIs: cb4bc3bb_i c4c35a5a_o<font></font>
         rkn{83}:   5.5.5.5/32 === 1.1.1.1/32</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุนูู ุงูุฌุงูุจ ุงููุถูู ipsecgw </font></font><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุญุช ุงูููุณุฏ</font></font></b>
                        <div class="spoiler_text"><pre><code class="plaintext hljs">Routed Connections:<font></font>
         rkn{1}:  ROUTED, TRANSPORT, reqid 1<font></font>
         rkn{1}:   1.1.1.1/32 === 5.5.5.5/32<font></font>
Security Associations (4 up, 0 connecting):<font></font>
remote-access[10]: ESTABLISHED 5 seconds ago, 1.1.1.1[CN=ipsecgw.example.com]...4.4.4.4[phone]<font></font>
remote-access{12}:  INSTALLED, TUNNEL, reqid 7, ESP in UDP SPIs: c7a31be1_i a231904e_o<font></font>
remote-access{12}:   0.0.0.0/0 === 10.1.1.1/32<font></font>
    keenetic[8]: ESTABLISHED 22 minutes ago, 1.1.1.1[keenetic@router.home.local]...3.3.3.3[root@router.keenetic.local]<font></font>
    keenetic{11}:  INSTALLED, TUNNEL, reqid 6, ESP SPIs: cfc1b329_i c01e1b6e_o<font></font>
    keenetic{11}:   10.0.0.0/23 === 10.0.4.0/24<font></font>
        mama[4]: ESTABLISHED 83 minutes ago, 1.1.1.1[mama@router.home.local]...2.2.2.2[root@router.mama.local]<font></font>
        mama{8}:  INSTALLED, TUNNEL, reqid 3, ESP in UDP SPIs: c4a5451a_i ca67c223_o<font></font>
        mama{8}:   10.0.0.0/23 10.1.1.0/24 === 10.0.3.0/24<font></font>
         rkn[3]: ESTABLISHED 83 minutes ago, 1.1.1.1[CN=ipsecgw.example.com]...5.5.5.5[CN=rkn.example.com]<font></font>
         rkn{7}:  INSTALLED, TRANSPORT, reqid 1, ESP SPIs: c4c35a5a_i cb4bc3bb_o<font></font>
         rkn{7}:   1.1.1.1/32 === 5.5.5.5/32<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุชู ุชุซุจูุช ุงูููู ุ ุชุฐูุจ ุงูุฃุตูุงุช ุ ูู tcpdump ุ ูู ุงููุงุถุญ ุฃู ESP ููุชูู ููุท ุจูู ุงููุถูููู. </font><font style="vertical-align: inherit;">ูุจุฏู ูู ุงููููู ุฃู ููุฑุญ. </font><font style="vertical-align: inherit;">ูููู ูุง ููููู ุงูุงุณุชุฑุฎุงุก ุฏูู ุงูุชุญูู ูู ูู ุดูุก ุญุชู ุงูููุงูุฉ. </font><font style="vertical-align: inherit;">ูุญู ูุญุงูู ุฅุนุงุฏุฉ ุฅุตุฏุงุฑ ุดูุงุฏุฉ VPS ู ...</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุทุงู ุ ูู ุดูุก ููุณูุฑ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุจุฏุฃ ูู ููู ูุฅูุฌุงุฏ ููุฒุฉ ุบูุฑ ุณุงุฑุฉ ูู Let's Encrypt ุ ููู ุฌูููุฉ ูู ูู ุดูุก ุขุฎุฑ - ูุน ุฃู ุฅุนุงุฏุฉ ุฅุตุฏุงุฑ ููุดูุงุฏุฉ ุ ูุชุบูุฑ ุงูููุชุงุญ ุงูุฎุงุต ุงููุฑุชุจุท ุจูุง ุฃูุถูุง. ุงูููุชุงุญ ุงูุฎุงุต ุชุบูุฑ - ูุงูุฌูููุฑ ุชุบูุฑ. ูููููุฉ ุงูุฃููู ุ ูุฅู ุงููุถุน ููุฆูุณ ููู ุจุงููุณุจุฉ ููุง: ุญุชู ุฅุฐุง ุชูููุง ูู ุงุณุชุฎุฑุงุฌ ุงูููุชุงุญ ุงูุนุงู ุจุณูููุฉ ุฃุซูุงุก ุฅุนุงุฏุฉ ุฅุตุฏุงุฑ ุงูุดูุงุฏุฉ ุจุงุณุชุฎุฏุงู ุงูุฎุทุงู ูู ุณูุฑุชุจูุช ูุชูุฑูุฑู ุฅูู ุงูุฌุงูุจ ุงูุจุนูุฏ ุนุจุฑ SSH ุ ูููุณ ูู ุงููุงุถุญ ููููุฉ ุฌุนู Strongswan ุงูุจุนูุฏ ูุนูุฏ ูุฑุงุกุชู. ูููู ุงููุณุงุนุฏุฉ ุฃุชุช ูู ุญูุซ ูู ููุชุธุฑูุง - ูุณุชุทูุน systemd ูุฑุงูุจุฉ ุงูุชุบููุฑุงุช ูู ูุธุงู ุงููููุงุช ูุชุดุบูู ุงูุฎุฏูุงุช ุงููุฑุชุจุทุฉ ุจุงูุญุฏุซ. ุณูู ูุณุชููุฏ ูู ูุฐุง.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุณููุดุฆ ูุณุชุฎุฏู ุฎุฏูุฉ Keywatcher ุนูู ูู ูุถูู ูู ุงูุญููู ุงูุฃูุซุฑ ุชูููุฏูุง ุ ูููุดุฆ ููุงุชูุญ SSH ููู ูููู ุ ููููู ุจุชุจุงุฏููุง ุจูู ุงููุถูููู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูู ูุถูู ipsecgw.example.com ุ ุฃูุดุฆ ุฏููู / opt / ipsec-pubkey ุงูุฐู ูุถุน ููู ุณูุฑูุจุชููู.</font></font><br>
<br>
<pre><code class="bash hljs">sudo vi /opt/ipsec-pubkey/pubkey-copy.sh</code></pre><br>
<pre><code class="bash hljs"><span class="hljs-meta">#!/bin/sh</span>
<span class="hljs-keyword">if</span> [ ! -f /home/keywatcher/ipsecgw.example.com.pem ]; <span class="hljs-keyword">then</span>
  /usr/bin/openssl rsa -<span class="hljs-keyword">in</span> /etc/letsencrypt/live/ipsecgw.example.com/privkey.pem -pubout &gt; /home/keywatcher/ipsecgw.example.com.pem;<font></font>
  /usr/bin/chown keywatcher:keywatcher /home/keywatcher/ipsecgw.example.com.pem;<font></font>
  /usr/bin/chmod 0600 /home/keywatcher/ipsecgw.example.com.pem;<font></font>
  sudo -u keywatcher /usr/bin/scp /home/keywatcher/ipsecgw.example.com.pem rkn.example.com:/home/keywatcher/ipsecgw.example.com.pem;<font></font>
  status=$?;<font></font>
  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$status</span> -eq 0 ]; <span class="hljs-keyword">then</span><font></font>
    rm -f /home/keywatcher/ipsecgw.example.com.pem;<font></font>
    logger <span class="hljs-string">"Public key ipsecgw.example.com.pem has been successfully uploaded to remote host"</span>;
  <span class="hljs-keyword">else</span>
    logger <span class="hljs-string">"Public key ipsecgw.example.com.pem has not been uploaded to remote host due to error"</span>;
  <span class="hljs-keyword">fi</span>
  <span class="hljs-keyword">else</span>
    logger <span class="hljs-string">"Public key ipsecgw.example.com.pem already exist on /home/keywatcher directory, something went wrong"</span>;
<span class="hljs-keyword">fi</span>
<span class="hljs-built_in">exit</span> 0</code></pre><br>
<pre><code class="bash hljs">sudo vi /opt/ipsec-pubkey/key-updater.sh</code></pre><br>
<pre><code class="bash hljs"><span class="hljs-meta">#!/bin/sh</span><font></font>
/usr/bin/cp /home/keywatcher/rkn.example.com.pem /etc/strongswan/ipsec.d/certs/rkn.example.com.pem<font></font>
/usr/bin/chown root:root /etc/strongswan/ipsec.d/certs/rkn.example.com.pem<font></font>
/usr/bin/chmod 0600 /etc/strongswan/ipsec.d/certs/rkn.example.com.pem<font></font>
logger <span class="hljs-string">"Public key of server rkn.example.com has been updated, restarting strongswan daemon to re-read it"</span><font></font>
/usr/bin/systemctl restart strongswan<font></font>
<span class="hljs-built_in">exit</span> 0
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูู VPS (ุงููุถูู rkn.example.com) ุ ูููู ุจุงููุซู ุจุฅูุดุงุก ุฏููู ุจููุณ ุงูุงุณู ุ ุญูุซ ูููู ุฃูุถูุง ุจุฅูุดุงุก ูุตูุต ูุดุงุจูุฉ ุ ูุน ุชุบููุฑ ุงุณู ุงูููุชุงุญ ููุท. </font><font style="vertical-align: inherit;">ููุฏ ุ ุญุชู ูุง ุชุดูุด ุงููุงุฏุฉ ุ ุชุญุช</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูููุณุฏ</font></font></b>
                        <div class="spoiler_text">sudo vi /opt/ipsec-pubkey/pubkey-copy.sh<br>
<pre><code class="bash hljs"><span class="hljs-meta">#!/bin/sh</span>
<span class="hljs-keyword">if</span> [ ! -f /home/keywatcher/rkn.example.com.pem ]; <span class="hljs-keyword">then</span>
  /usr/bin/openssl rsa -<span class="hljs-keyword">in</span> /etc/letsencrypt/live/rkn.example.com/privkey.pem -pubout &gt; /home/keywatcher/rkn.example.com.pem;<font></font>
  /usr/bin/chown keywatcher:keywatcher /home/keywatcher/rkn.example.com.pem;<font></font>
  /usr/bin/chmod 0600 /home/keywatcher/rkn.example.com.pem;<font></font>
  sudo -u keywatcher /usr/bin/scp /home/keywatcher/rkn.example.com.pem ipsecgw.example.com:/home/keywatcher/rkn.example.com.pem;<font></font>
  status=$?;<font></font>
  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$status</span> -eq 0 ]; <span class="hljs-keyword">then</span><font></font>
    rm -f /home/keywatcher/rkn.example.com.pem;<font></font>
    logger <span class="hljs-string">"Public key rkn.example.com.pem has been successfully uploaded to remote host"</span>;
  <span class="hljs-keyword">else</span>
    logger <span class="hljs-string">"Public key rkn.example.com.pem has not been uploaded to remote host"</span>;
  <span class="hljs-keyword">fi</span>
  <span class="hljs-keyword">else</span>
    logger <span class="hljs-string">"Public key rkn.example.com.pem already exist on /home/keywatcher directory, something went wrong"</span>;
<span class="hljs-keyword">fi</span>
<span class="hljs-built_in">exit</span> 0
</code></pre><br>
<pre><code class="bash hljs">sudo vi /opt/ipsec-pubkey/key-updater.sh</code></pre><br>
<pre><code class="bash hljs">
<span class="hljs-meta">#!/bin/bash</span><font></font>
/usr/bin/cp /home/keywatcher/ipsecgw.example.com.pem /etc/strongswan/ipsec.d/certs/ipsecgw.example.com.pem;<font></font>
/usr/bin/chown root:root /etc/strongswan/ipsec.d/certs/ipsecgw.example.com.pem<font></font>
/usr/bin/chmod 0600 /etc/strongswan/ipsec.d/certs/ipsecgw.example.com.pem<font></font>
logger <span class="hljs-string">"Public key of server ipsecgw.example.com has been updated, restarting connection"</span><font></font>
/usr/bin/systemctl restart strongswan<font></font>
<span class="hljs-built_in">exit</span> 0
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุทููุจ ุงูุจุฑูุงูุฌ ุงููุตู pubkey-copy.sh ูุงุณุชุฎุฑุงุฌ ุงูุฌุฒุก ุงูุนุงู ูู ุงูููุชุงุญ ููุณุฎู ุฅูู ุงููุถูู ุงูุจุนูุฏ ุนูุฏ ุฅุตุฏุงุฑ ุดูุงุฏุฉ ุฌุฏูุฏุฉ. </font><font style="vertical-align: inherit;">ููููุงู ุจุฐูู ุ ูู / etc / letencrypt / ุชุฌุฏูุฏ ุงูุชุฌุฏูุฏุงุช / ูุดุฑ ุงูุฏููู ุนูู ููุง ุงูุฎุงุฏููู ุ ูู ุจุฅูุดุงุก ูุต ูุตุบุฑ ุขุฎุฑ:</font></font><br>
<br>
<pre><code class="bash hljs">
<span class="hljs-meta">#!/bin/sh</span><font></font>
/opt/ipsec-pubkey/pubkey-copy.sh &gt; /dev/null 2&gt;&amp;1<font></font>
/usr/bin/systemctl restart strongswan<font></font>
<span class="hljs-built_in">exit</span> 0</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุชู ุญู ูุตู ุงููุดููุฉ ุ ูุฅุนุงุฏุฉ ุฅุตุฏุงุฑ ุงูุดูุงุฏุงุช ุ ูุงุณุชุฎุฑุงุฌ ุงูููุงุชูุญ ุงูุนุงูุฉ ููุณุฎูุง ุจูู ุงูุฎูุงุฏู ุ ููุฏ ุญุงู ุงูููุช ููุธุงู systemd ูุน ูุญุฏุงุช ุงููุณุงุฑ ุงูุฎุงุตุฉ ุจู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูู ุฎุงุฏู ipsecgw.example.com ูู ุฏููู / etc / systemd / system ุ ุฃูุดุฆ ููู keyupdater.path</font></font><br>
<br>
<pre><code class="plaintext hljs">[Unit]<font></font>
Wants=strongswan.service<font></font>
[Path]<font></font>
PathChanged=/home/keywatcher/rkn.example.com.pem<font></font>
[Install]<font></font>
WantedBy=multi-user.target</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุจุงููุซู ุนูู ูุถูู VPS:</font></font><br>
<br>
<pre><code class="bash hljs">[Unit]<font></font>
Wants=strongswan.service<font></font>
[Path]<font></font>
PathChanged=/home/keywatcher/ipsecgw.example.com.pem<font></font>
[Install]<font></font>
WantedBy=multi-user.target</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฃุฎูุฑูุง ุ ุนูู ูู ุฎุงุฏู ูููู ุจุฅูุดุงุก ุฎุฏูุฉ ูุฑุชุจุทุฉ ุจูุฐู ุงููุญุฏุฉ ุ ูุงูุชู ุณูุชู ุฅุทูุงููุง ุนูุฏ ุชุญูู ุงูุดุฑุท (PathChanged) - ุชุบููุฑ ุงูููู ูุฅุบูุงูู ุจุนุฏ ุงูุชุณุฌูู. </font><font style="vertical-align: inherit;">ูููู ุจุฅูุดุงุก ุงููููุงุช /etc/systemd/system/keyupdater.service ูููุชุจ:</font></font><br>
<br>
<pre><code class="plaintext hljs">[Unit]<font></font>
Description= Starts the IPSec key updating script<font></font>
Documentation= man:systemd.service<font></font>
[Service]<font></font>
Type=oneshot<font></font>
ExecStart=/opt/ipsec-pubkey/key-updater.sh<font></font>
[Install]<font></font>
WantedBy=multi-user.target</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุง ุชูุณู ุฅุนุงุฏุฉ ูุฑุงุกุฉ ุชููููุงุช systemd ูุน sudo systemctl daemon-reload ูุชุนููู ุงูุชุดุบูู ุงูุชููุงุฆู ููุญุฏุงุช ุงููุณุงุฑ ุนุจุฑ sudo systemctl ุชูููู keyupdater.path &amp;&amp; sudo systemctl start keyupdater. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจูุฌุฑุฏ ุฃู ููุชุจ ุงููุถูู ุงูุจุนูุฏ ุงูููู ุงูุฐู ูุญุชูู ุนูู ุงูููุชุงุญ ุงูุนุงู ุฅูู ุงูุฏููู ุงูุฑุฆูุณู ููุณุชุฎุฏู ูุฑุงูุจ ุงูููุงุชูุญ ููุชู ุฅุบูุงู ูุงุตู ุงูููู ุ ุณูููู systemd ุชููุงุฆููุง ุจุชุดุบูู ุงูุฎุฏูุฉ ุงูููุงุจูุฉ ุ ูุงูุชู ุณุชูุณุฎ ุงูููุชุงุญ ุฅูู ุงููููุน ุงููุทููุจ ูุฅุนุงุฏุฉ ุชุดุบูู Strongswan. </font><font style="vertical-align: inherit;">ุณูุชู ุชุซุจูุช ุงูููู ุจุงุณุชุฎุฏุงู ุงูููุชุงุญ ุงูุนุงู ุงูุตุญูุญ ููุฌุงูุจ ุงูุซุงูู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููููู ุงูุฒููุฑ ูุงูุงุณุชูุชุงุน ุจุงููุชูุฌุฉ.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุฏูุง ูู ุงูุงุณุชูุชุงุฌ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุง ุฑุฃููุง ููุชู </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฌุญูู</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฃูู ุจุฑูุชูููู ุงูุฅูุชุฑูุช ููุณ ููุง ูุฎููุฉ ููุง ุฑุณููุง. </font><font style="vertical-align: inherit;">ูู ูุง ุชู ูุตูู ูู ุชูููู ูุงูู ุงูุชุดุบูู ููุฏ ุงูุงุณุชุฎุฏุงู ุญุงูููุง. </font><font style="vertical-align: inherit;">ุญุชู ุจุฏูู ุงููุซูุฑ ูู ุงููุนุฑูุฉ ุ ููููู ุชูููู VPN ูุญูุงูุฉ ุจูุงูุงุชู ุจุดูู ููุซูู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุงูุทุจุน ุ ุธูุช ูุญุธุงุช ุฅุนุฏุงุฏ iptables ุฎุงุฑุฌ ูุทุงู ุงูููุงูุฉ ุ ูููู ุชุจูู ุฃู ุงูููุงูุฉ ููุณูุง ูุงูุช ุถุฎูุฉ ุจุงููุนู ุ ููุฏ ูุชุจ ุงููุซูุฑ ุนู iptables. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุงู ููุงุท ูู ุงูููุงูุฉ ูููู ุชุญุณูููุง ุ ุณูุงุก ุฑูุถ ุฅุนุงุฏุฉ ุชุดุบูู ุจุฑูุงูุฌ Strongswan ุ ูุฅุนุงุฏุฉ ูุฑุงุกุฉ ุงูุชููููุงุช ูุงูุดูุงุฏุงุช ุ ูููู ูู ุฃุณุชุทุน ุชุญููู ุฐูู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุน ุฐูู ุ ูู ุชูู ุนูููุงุช ุฅุนุงุฏุฉ ุชุดุบูู ุงูุจุฑูุงูุฌ ุงูุฎูู ูุฎููุฉ: ููุฏ ูุงุญุฏ ุฃู ุงุซููู ูู ุงูุฃุตูุงุช ุจูู ุงููุธุฑุงุก ุ ูุงุณุชุนุงุฏุฉ ุนููุงุก ุงูุฌููุงู ุงูุงุชุตุงู ุจุฃููุณูู.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุขูู ุฃู ูุฏูุน ุงูุฒููุงุก ูู ุงูุชุนูููุงุช ุฅูู ุงูุญู ุงูุตุญูุญ.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar504464/index.html">ููู ุชูุตููุง ุฅูู TableAdapter ูุชุจุณูุท ุงูุนูู ูุน UITableView</a></li>
<li><a href="../ar504468/index.html">ุฃุฏุงุก Raspberry Pi: ุฃุถู ZRAM ูุบููุฑ ูุนููุงุช kernel</a></li>
<li><a href="../ar504472/index.html">ุฃูุถู ุฃุฏูุงุช ุงููุทูุฑ ุงููุฌุงููุฉ</a></li>
<li><a href="../ar504480/index.html">ููู ุชุฌุฏ ูุณูููุง ูููู ูุนู ูุฑุจุญูุง ููุนููุ</a></li>
<li><a href="../ar504482/index.html">ุงุณุฃููุง: ุณุชุฌูุจ DIT ุนูู ุงูุฃุณุฆูุฉ</a></li>
<li><a href="../ar504486/index.html">ุงูุนูููุฉ: ุฅูุดุงุก Vue 3</a></li>
<li><a href="../ar504488/index.html">ูุง ูู ุงูุตูุงุนุงุช ูุงูุชูููุงุช ุงูุชู ุณุชุจุฏุฃ ูู ุงูุชุทูุฑ ุจุณุฑุนุฉ ุจุนุฏ ุญู ูุดููุฉ COVID-19</a></li>
<li><a href="../ar504490/index.html">ููุฎุต ุฃุญุฏุงุซ ููููู ุฃูู ูุงูู</a></li>
<li><a href="../ar504492/index.html">ุงุถุบุท ุงูุฒุฑ: ูุธุฑูุฉ ูููุงุฑุณุฉ ุงูุชุตููุช ุงูุฅููุชุฑููู - ูุงุฆุฏุฉ ูุณุชุฏูุฑุฉ ูู 30 ูุงูู</a></li>
<li><a href="../ar504502/index.html">ุงูุญูุงุฉ ุงููุตูุฑุฉ ูุงูุบุฑูุจุฉ ูุฃูู ุฑูุจูุช ุตุฏูู ูู ุงูุนุงูู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>