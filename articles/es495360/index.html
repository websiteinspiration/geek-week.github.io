<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üî≥ üë®üèª‚Äçüé® üêÉ C√≥mo automatizamos la portabilidad de productos de C # a C ++ üëåüèΩ üîâ üéè</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola Habr En esta publicaci√≥n, hablar√© sobre c√≥mo logramos organizar un lanzamiento mensual de bibliotecas para el lenguaje C ++, cuyo c√≥digo fuente s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>C√≥mo automatizamos la portabilidad de productos de C # a C ++</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495360/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hola Habr </font><font style="vertical-align: inherit;">En esta publicaci√≥n, hablar√© sobre c√≥mo logramos organizar un lanzamiento mensual de bibliotecas para el lenguaje C ++, cuyo c√≥digo fuente se desarrolla en C #. </font><font style="vertical-align: inherit;">No se trata de C ++ administrado, o incluso de crear un puente entre C ++ no administrado y el entorno CLR: se trata de automatizar la generaci√≥n de c√≥digo C ++ que repite la API y la funcionalidad del c√≥digo C # original.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Escribimos la infraestructura necesaria para traducir c√≥digo entre idiomas y emular las funciones de la biblioteca .Net nosotros mismos, resolviendo as√≠ un problema que generalmente se considera acad√©mico. Esto nos permiti√≥ comenzar a lanzar versiones mensuales de productos pre-Donets para el lenguaje C ++ tambi√©n, obteniendo el c√≥digo para cada versi√≥n de la versi√≥n correspondiente del c√≥digo C #. Al mismo tiempo, las pruebas que cubrieron el c√≥digo original se transfieren junto con √©l y le permiten controlar el rendimiento de la soluci√≥n resultante junto con pruebas especialmente escritas en C ++.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este art√≠culo describir√© brevemente la historia de nuestro proyecto y las tecnolog√≠as utilizadas en √©l. </font><font style="vertical-align: inherit;">Me referir√© a los temas de justificaci√≥n econ√≥mica solo de pasada, ya que el aspecto t√©cnico es mucho m√°s interesante para m√≠. </font><font style="vertical-align: inherit;">En los siguientes art√≠culos de la serie, planeo hacer hincapi√© en temas como la generaci√≥n de c√≥digo y la administraci√≥n de memoria, as√≠ como en algunos otros, si la comunidad tiene preguntas relevantes.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antecedentes</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inicialmente, nuestra empresa particip√≥ en el lanzamiento de bibliotecas para la plataforma .Net. </font><font style="vertical-align: inherit;">Estas bibliotecas proporcionan principalmente API para trabajar con algunos formatos de archivo (documentos, tablas, diapositivas, gr√°ficos) y protocolos (correo electr√≥nico), ocupando un cierto nicho en el mercado para tales soluciones. </font><font style="vertical-align: inherit;">Todo el desarrollo se realiz√≥ en C #.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A finales de la d√©cada de 2000, la compa√±√≠a decidi√≥ ingresar a un nuevo mercado para s√≠ misma, comenzando a lanzar productos similares para Java. El desarrollo desde cero obviamente requerir√≠a una inversi√≥n de recursos comparable al desarrollo inicial de todos los productos afectados. La opci√≥n de envolver el c√≥digo de Donnet en una capa que traduce llamadas y datos de Java a .Net y viceversa tambi√©n fue rechazada por algunas razones. En cambio, se plante√≥ la pregunta de si es posible de alguna manera migrar completamente el c√≥digo existente a la nueva plataforma. Esto fue a√∫n m√°s relevante ya que no se trataba de una promoci√≥n √∫nica, sino de un lanzamiento mensual de nuevos lanzamientos de cada producto, sincronizados entre dos idiomas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se decidi√≥ dividir la decisi√≥n en dos partes. </font><font style="vertical-align: inherit;">El primero, el llamado Porter, convertir√≠a la sintaxis del c√≥digo fuente de C # a Java, reemplazando simult√°neamente los tipos y m√©todos .Net con sus hom√≥logos de las bibliotecas de Java. </font><font style="vertical-align: inherit;">El segundo, la Biblioteca, emular√≠a el trabajo de aquellas partes de la biblioteca .Net para las que es dif√≠cil o imposible establecer una correspondencia directa con Java, atrayendo componentes de terceros disponibles para esto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A favor de la viabilidad principal de dicho plan, habl√≥ lo siguiente:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ideol√≥gicamente, los lenguajes C # y Java son bastante similares, al menos, con la estructura de tipos y la organizaci√≥n del trabajo con memoria;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se trataba de portar bibliotecas, no hab√≠a necesidad de portar la GUI;</font></font></li>
<li>  ,  , -    ,        System.Net  System.Drawing;</li>
<li>   ,        .Net ( Framework,   Standard   Xamarin),          .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entrar√© en detalles, ya que merecen un art√≠culo separado (y no uno). </font><font style="vertical-align: inherit;">Solo puedo decir que pasaron unos dos a√±os desde el inicio del desarrollo hasta el lanzamiento del primer producto Java, y desde entonces el lanzamiento de los productos Java se ha convertido en una pr√°ctica habitual de la compa√±√≠a. </font><font style="vertical-align: inherit;">Durante el desarrollo del proyecto, el portero ha evolucionado de una simple utilidad que convierte el texto de acuerdo con las reglas establecidas, a un generador de c√≥digo complejo que funciona con la representaci√≥n AST del c√≥digo fuente. </font><font style="vertical-align: inherit;">La biblioteca tambi√©n est√° cubierta de c√≥digo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El √©xito de la direcci√≥n de Java determin√≥ el deseo de la compa√±√≠a de expandirse a√∫n m√°s en nuevos mercados para s√≠ misma, y ‚Äã‚Äãen 2013 se plante√≥ la pregunta sobre el lanzamiento de productos para el lenguaje C ++ en un escenario similar.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formulaci√≥n del problema</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para garantizar el lanzamiento de versiones positivas de los productos, era necesario crear un marco que le permitiera obtener c√≥digo C ++ a partir de c√≥digo C # arbitrario, compilarlo, verificarlo y entreg√°rselo al cliente. Se trataba de bibliotecas con vol√∫menes que van desde varios cientos de miles hasta varios millones de l√≠neas (excluyendo dependencias).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al mismo tiempo, se tuvo en cuenta la experiencia con el portero de Java: inicialmente, cuando era solo una herramienta simple para convertir sintaxis, surgi√≥ la pr√°ctica de finalizar manualmente el c√≥digo portado. En el corto plazo, enfocado en el lanzamiento r√°pido de productos, esto fue relevante, ya que permiti√≥ acelerar el proceso de desarrollo, sin embargo, a largo plazo, esto aument√≥ significativamente los costos de preparaci√≥n de cada versi√≥n para el lanzamiento debido a la necesidad de corregir cada error de traducci√≥n cada vez que ocurre.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por supuesto, esta complejidad era manejable, al menos transfiriendo solo parches al c√≥digo Java resultante, que se calculan como la diferencia entre la salida del portero para las pr√≥ximas dos revisiones del c√≥digo C #. Este enfoque hizo posible corregir cada l√≠nea portada solo una vez y en el futuro usar el c√≥digo ya desarrollado donde no se realizaron cambios. Sin embargo, al desarrollar un portador positivo, el objetivo era deshacerse de la etapa de arreglar el c√≥digo portado, en lugar de arreglar el marco en s√≠. Por lo tanto, cada error de traducci√≥n arbitrariamente raro se corregir√° una vez, en el c√≥digo del portero, y esta correcci√≥n se aplicar√° a todas las versiones futuras de todos los productos portados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s del propio portero, tambi√©n se requer√≠a desarrollar una biblioteca en C ++ que resolviera los siguientes problemas:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Emulaci√≥n del entorno .Net en la medida en que sea necesario que el c√≥digo portado funcione;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adaptar el c√≥digo C # portado a las realidades de C ++ (estructura de tipo, administraci√≥n de memoria, otro c√≥digo de servicio);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suavizar las diferencias entre "C # reescrito" y el propio C ++, para que sea m√°s f√°cil para los programadores no familiarizados con los paradigmas .Net usar el c√≥digo portado.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por razones obvias, no se intent√≥ asignar directamente los tipos .Net a los tipos de la biblioteca est√°ndar. </font><font style="vertical-align: inherit;">En cambio, se decidi√≥ utilizar siempre los tipos de su biblioteca como reemplazo de los tipos Donnet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muchos lectores preguntar√°n de inmediato por qu√© no usaron implementaciones existentes como </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mono</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Hab√≠a razones para eso.</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al atraer una biblioteca tan terminada, ser√≠a posible satisfacer solo el primer requisito, pero no el segundo y no el tercero.</font></font></li>
<li> Mono   C# ,  ,   ,       .</li>
<li>      (API,  ,   ,   C++,   )   ,     .</li>
<li>    ,    .Net,                  .  ,           ,      .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Te√≥ricamente, dicha biblioteca podr√≠a traducirse a C ++ completamente usando un puerto, sin embargo, esto requerir√≠a un portero completamente funcional al comienzo del desarrollo, ya que sin una biblioteca del sistema, la depuraci√≥n de cualquier c√≥digo portado es imposible en principio. Adem√°s, la cuesti√≥n de optimizar el c√≥digo traducido de la biblioteca del sistema ser√≠a a√∫n m√°s aguda que para el c√≥digo de los productos portados, ya que las llamadas a la biblioteca del sistema tienden a convertirse en un cuello de botella. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, se decidi√≥ desarrollar la biblioteca como un conjunto de adaptadores que proporcionan acceso a funciones ya implementadas en bibliotecas de terceros, pero a trav√©s de una API similar a .Net (similar a Java). Esto reducir√≠a el trabajo y usar√≠a componentes C ++ ya listos y optimizados.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un requisito importante para el marco era que el c√≥digo portado ten√≠a que poder funcionar como parte de las aplicaciones del usuario (en lo que respecta a las bibliotecas). Esto significaba que el modelo de administraci√≥n de memoria deber√≠a haber quedado claro para los programadores de C ++, ya que no podemos forzar el c√≥digo arbitrario del cliente para que se ejecute en un entorno de recolecci√≥n de basura. Se eligi√≥ el uso de punteros inteligentes como modelo de compromiso. Sobre c√≥mo logramos asegurar tal transici√≥n (en particular, para resolver el problema de las referencias circulares), discutir√© en un art√≠culo separado.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otro requisito era la capacidad de portar no solo bibliotecas, sino tambi√©n pruebas para ellas. </font><font style="vertical-align: inherit;">La compa√±√≠a cuenta con una alta cultura de cobertura de prueba de sus productos, y la capacidad de ejecutar en C ++ las mismas pruebas que se escribieron para el c√≥digo original simplificar√≠a enormemente la b√∫squeda de problemas despu√©s de la traducci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los requisitos restantes (formato de lanzamiento, cobertura de prueba, tecnolog√≠a, etc.) se refer√≠an principalmente a los m√©todos de trabajo con el proyecto y en el proyecto. </font><font style="vertical-align: inherit;">No me detendr√© en ellos.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Historia</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de continuar, tengo que decir algunas palabras sobre la estructura de la empresa. La empresa trabaja de forma remota, todos los equipos en ella est√°n distribuidos. El desarrollo de un producto suele ser responsabilidad de un equipo, combinado en lenguaje (casi siempre) y geograf√≠a (principalmente). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El trabajo activo en el proyecto comenz√≥ en el oto√±o de 2013. Debido a la estructura distribuida de la empresa, y tambi√©n debido a algunas dudas sobre el √©xito del desarrollo, se lanzaron inmediatamente tres versiones del marco: dos de ellas sirvieron un producto cada una, la tercera cubri√≥ tres a la vez. Se supuso que esto detendr√≠a el desarrollo de soluciones menos efectivas y reasignar√≠a los recursos si fuera necesario.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el futuro, cuatro equipos m√°s se unieron al trabajo en el marco "com√∫n", dos de los cuales reconsideraron su decisi√≥n y se negaron a lanzar productos para C ++. A principios de 2017, se tom√≥ la decisi√≥n de detener el desarrollo de una de las soluciones "individuales" y transferir el equipo correspondiente para trabajar con un marco "com√∫n". El desarrollo detenido asumi√≥ el uso del </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Boehm GC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> como un medio de administraci√≥n de memoria y conten√≠a una implementaci√≥n mucho m√°s rica de algunas partes de la biblioteca del sistema, que luego se transfiri√≥ a la soluci√≥n "general".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, dos desarrollos llegaron a la l√≠nea de meta, es decir, al lanzamiento de productos portados, uno "individual" y otro "colectivo". Los primeros lanzamientos basados ‚Äã‚Äãen nuestro marco ("com√∫n") ocurrieron en febrero de 2018. Posteriormente, los lanzamientos de los seis equipos que usan esta soluci√≥n se hicieron mensuales, y el marco en s√≠ se lanz√≥ como un producto separado de la compa√±√≠a. Incluso se plante√≥ la cuesti√≥n de hacerlo de c√≥digo abierto, pero esta discusi√≥n a√∫n no se ha desarrollado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El equipo, que continu√≥ trabajando de forma independiente en un marco similar, tambi√©n lanz√≥ su primer lanzamiento de C ++ en 2018.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los primeros lanzamientos conten√≠an versiones truncadas de los productos originales, lo que permiti√≥ retrasar el trabajo de transmitir partes sin importancia tanto como sea posible. </font><font style="vertical-align: inherit;">En versiones posteriores, se ha producido una adici√≥n de funcionalidad por partes (y est√° ocurriendo).</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Organizaci√≥n del trabajo en el proyecto.</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La organizaci√≥n del trabajo conjunto en el proyecto por parte de varios equipos logr√≥ experimentar cambios significativos. Inicialmente, se decidi√≥ que un gran equipo "central" ser√≠a responsable del desarrollo, el soporte y la reparaci√≥n del marco, mientras que los peque√±os equipos de "producto" involucrados en el lanzamiento de productos finales en C ++ ser√≠an los principales responsables de tratar de portar su c√≥digo y comentarios (informaci√≥n sobre errores de portado, compilaci√≥n y ejecuci√≥n). Tal esquema, sin embargo, result√≥ ser improductivo, ya que el equipo central estaba sobrecargado con las solicitudes de todos los equipos de "productos", y no pudieron continuar hasta que se resolvieron los problemas que encontraron.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por razones que son en gran medida independientes del estado de este desarrollo particular, se decidi√≥ disolver el equipo "central" y transferir a las personas a equipos de "producto", que ahora eran responsables de fijar el marco a sus necesidades. En este caso, cada equipo tomar√≠a una decisi√≥n sobre si utilizar√≠a su base com√∫n o generar√≠a su propia bifurcaci√≥n del proyecto. Tal declaraci√≥n de la pregunta era relevante para el marco de Java, cuyo c√≥digo era estable en ese momento, pero se requer√≠a una consolidaci√≥n de los esfuerzos para llenar la biblioteca de C ++ lo antes posible, de modo que los equipos a√∫n trabajaran juntos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta forma de trabajo tambi√©n ten√≠a sus inconvenientes, por lo que en el futuro se llev√≥ a cabo otra reforma. El equipo "central" fue restaurado, aunque en una composici√≥n m√°s peque√±a, pero con diferentes funciones: ahora no era responsable del desarrollo real del proyecto, sino de la organizaci√≥n del trabajo conjunto sobre el mismo. Esto incluy√≥ soporte para el entorno de CI, organizaci√≥n de pr√°cticas de solicitud de fusi√≥n, reuniones peri√≥dicas con participantes en el desarrollo, documentaci√≥n de respaldo, pruebas de cobertura, ayuda con soluciones arquitect√≥nicas y resoluci√≥n de problemas, etc. Adem√°s, el equipo asumi√≥ el trabajo para eliminar la deuda t√©cnica y otras √°reas intensivas en recursos. En este modo, el desarrollo contin√∫a hasta nuestros d√≠as.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, el proyecto fue iniciado por los esfuerzos de varios (aproximadamente cinco) desarrolladores y en el mejor de los casos contaba con unas veinte personas. Entre diez y quince personas responsables del desarrollo y soporte del marco y el lanzamiento de seis productos portados pueden considerarse un valor estable en los √∫ltimos a√±os. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El autor de estas l√≠neas se uni√≥ a la compa√±√≠a a mediados de 2016, comenzando a trabajar en uno de los equipos que transmit√≠an su c√≥digo utilizando una soluci√≥n "com√∫n". En el invierno del mismo a√±o, cuando se decidi√≥ recrear el equipo "central", me mud√© al puesto de l√≠der de su equipo. Por lo tanto, mi experiencia en el proyecto hoy es de m√°s de tres a√±os y medio.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La autonom√≠a de los equipos responsables del lanzamiento de los productos portados ha llevado al hecho de que en algunos casos result√≥ m√°s f√°cil para los desarrolladores complementar al portero con modos operativos que comprometer la forma en que deber√≠a comportarse de manera predeterminada. </font><font style="vertical-align: inherit;">Esto explica m√°s de lo que cabr√≠a esperar, la cantidad de opciones disponibles al configurar el portero.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tecnolog√≠as</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es hora de hablar sobre las tecnolog√≠as utilizadas en el proyecto. Porter es una aplicaci√≥n de consola escrita en C #, porque de esta forma es m√°s f√°cil incrustar en scripts que realizan tareas como "pruebas de compilaci√≥n de puerto-ejecuci√≥n". Adem√°s, hay un componente GUI que le permite alcanzar los mismos objetivos haciendo clic en los botones. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La antigua biblioteca </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NRefactory</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es responsable de analizar el c√≥digo y resolver la sem√°ntica </font><font style="vertical-align: inherit;">. Desafortunadamente, en el momento en que comenz√≥ el proyecto, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Roslyn</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a√∫n no estaba disponible, aunque la migraci√≥n a √©l, por supuesto, est√° en nuestros planes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Porter usa pasarelas de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">madera AST</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para recopilar informaci√≥n y generar c√≥digo de salida de C ++. Cuando se genera el c√≥digo C ++, la representaci√≥n AST no se crea y todo el c√≥digo se guarda como texto sin formato. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En muchos casos, el portero necesita informaci√≥n adicional para un ajuste fino. Dicha informaci√≥n se le transmite en forma de opciones y atributos. Las opciones se aplican a todo el proyecto de inmediato y le permiten establecer, por ejemplo, los nombres de los miembros de macro de exportaci√≥n de clases o las definiciones de preprocesador de C # utilizadas en el an√°lisis de c√≥digo. Los atributos se cuelgan en tipos y entidades y determinan el procesamiento espec√≠fico para ellos (por ejemplo, la necesidad de generar palabras clave "const" o "mutable" para los miembros de la clase o excluirlos de la portabilidad).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las clases y estructuras de C # se traducen a clases de C ++, sus miembros y el c√≥digo ejecutable se traducen a los equivalentes m√°s cercanos. Los tipos y m√©todos gen√©ricos se asignan a plantillas de C ++. Los enlaces de C # se traducen en punteros inteligentes (fuertes o d√©biles) definidos en la Biblioteca. Se discutir√°n m√°s detalles sobre los principios del portero en un art√≠culo separado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, el ensamblaje original de C # se convierte en un proyecto de C ++, que en lugar de las bibliotecas .Net depende de nuestra biblioteca compartida. Esto se muestra en el siguiente diagrama: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/of/d1/s-/ofd1s-pimst_5rrcxzz8t-fh0nq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cmake se usa para construir la biblioteca y los proyectos portados. Los compiladores VS 2017 y 2019 (Windows), GCC y Clang (Linux) son actualmente compatibles.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como se mencion√≥ anteriormente, la mayor√≠a de nuestras implementaciones .Net son capas delgadas de bibliotecas de terceros que hacen la mayor parte del trabajo. </font><font style="vertical-align: inherit;">Incluye:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Skia</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : para trabajar con gr√°ficos;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Botan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : para admitir funciones de cifrado;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UCI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : para trabajar con cadenas, codificaciones y culturas;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Libxml2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : para trabajar con XML;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PCRE2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : para trabajar con expresiones regulares;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zlib</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : para implementar funciones de compresi√≥n;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Impulso</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - para varios prop√≥sitos;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Varias otras bibliotecas.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tanto el portero como la biblioteca est√°n cubiertos en numerosas pruebas. </font><font style="vertical-align: inherit;">Las pruebas de biblioteca usan el marco gtest. </font><font style="vertical-align: inherit;">Las pruebas de Porter se escriben principalmente en NUnit / xUnit y se dividen en varias categor√≠as, certificando que:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la salida del portero en estos archivos de entrada coincide con el objetivo;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la salida de los programas portados despu√©s de la compilaci√≥n y el lanzamiento coincide con el objetivo;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las pruebas de NUnit de los proyectos de entrada se convierten con √©xito en pruebas de gtest en proyectos portados y pasan;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La API de proyectos portados funciona correctamente en C ++;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El impacto de las opciones y atributos individuales en el proceso de traducci√≥n es el esperado.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usamos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitLab</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para almacenar el c√≥digo fuente </font><font style="vertical-align: inherit;">. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jenkins fue</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> elegido como el entorno de CI </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Los productos portados est√°n disponibles como paquetes Nuget y como archivos de descarga.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Problemas</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mientras trabaj√°bamos en el proyecto, tuvimos que enfrentar muchos problemas. </font><font style="vertical-align: inherit;">Algunos de ellos se esperaban, mientras que otros ya aparec√≠an en el proceso. </font><font style="vertical-align: inherit;">Enumeramos brevemente los principales.</font></font><br>
<br>
<ol>
<li><b>     .Net  C++.</b><br>
  ,   C++    Object,       RTTI.           .Net   STL.</li>
<li><b>   .</b><br>
       ,          ,    . ,  C#     ,   C++ ‚Äî .</li>
<li><b>  .</b><br>
   ‚Äî   .          ,   .   ,            .</li>
<li><b>    .</b><br>
 C++   ,        ,        .</li>
<li><b>    C#.</b><br>
 C#    ,      C++.    ,     :<br>
<br>
<ul>
<li>   ,    ;</li>
<li>   ,       (,       yeild);</li>
<li>,      (,            ,       ,        C#);</li>
<li>,   C++ (,  C#        foreground-).</li>
</ul></li>
<li><b>  .</b><br>
,        .Net  ,          .</li>
<li><b>   .</b><br>
- ,     ,        ¬´¬ª ,     .  ,  ,  ,     ,     using,             -.                 .   ,             .</li>
<li><b> .</b><br>
         ,    ,   ,  ,   ,    /     -          .</li>
<li><b>    .</b><br>
     .       ,           .    ,       ,      ,     .</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dificultades con la protecci√≥n de la propiedad intelectual. </font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si el c√≥digo C # se ofusca con bastante facilidad por las soluciones en caja, entonces en C ++ debe hacer esfuerzos adicionales, ya que muchos miembros de la clase no se pueden eliminar de los archivos de encabezado sin consecuencias. </font><font style="vertical-align: inherit;">La traducci√≥n de clases y m√©todos gen√©ricos en plantillas tambi√©n crea vulnerabilidades al exponer algoritmos.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A pesar de esto, el proyecto es muy interesante desde un punto de vista t√©cnico. </font><font style="vertical-align: inherit;">Trabajar en √©l te permite aprender mucho y aprender mucho. </font><font style="vertical-align: inherit;">La naturaleza acad√©mica de la tarea tambi√©n contribuye a esto.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resumen</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como parte del proyecto, pudimos implementar un sistema que resuelve un problema acad√©mico interesante en aras de su aplicaci√≥n pr√°ctica directa. Organizamos un n√∫mero mensual de bibliotecas de la empresa en un idioma para el que no estaban destinadas originalmente. Result√≥ que la mayor√≠a de los problemas son completamente solucionables, y la soluci√≥n resultante es confiable y pr√°ctica. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pronto se planea publicar dos art√≠culos m√°s. Uno de ellos describir√° en detalle, con ejemplos, c√≥mo funciona un portero y c√≥mo se muestran las construcciones de C # en C ++. En otro discurso, hablaremos sobre c√≥mo logramos garantizar la compatibilidad de los modelos de memoria de dos idiomas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tratar√© de responder las preguntas en los comentarios. </font><font style="vertical-align: inherit;">Si los lectores muestran inter√©s en otros aspectos de nuestro desarrollo y las respuestas comienzan a ir m√°s all√° de la correspondencia en los comentarios, consideraremos la posibilidad de publicar nuevos art√≠culos.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es495344/index.html">Unif√≠quelo: c√≥mo Lamoda hace que sus servicios Go sean consistentes</a></li>
<li><a href="../es495346/index.html">De error a alerta con acciones</a></li>
<li><a href="../es495350/index.html">Servidor web de inicio o su propio proveedor de alojamiento</a></li>
<li><a href="../es495354/index.html">¬øC√≥mo lanzar productos continuamente en 20 idiomas y no morir?</a></li>
<li><a href="../es495356/index.html">Implementaci√≥n del algoritmo de consenso RAFT para almacenamiento distribuido de KV en Java</a></li>
<li><a href="../es495362/index.html">Autoaislamiento y programa: c√≥mo no volverse loco en casa y pasar el tiempo de manera √∫til</a></li>
<li><a href="../es495364/index.html">API Style Guide, o no hagas que los usuarios piensen</a></li>
<li><a href="../es495366/index.html">16 tipos de programadores o desarrolladores no son los mismos robots</a></li>
<li><a href="../es495370/index.html">Lo p√∫blico es malo</a></li>
<li><a href="../es495374/index.html">Plaf√≥n decorativo General Lumino 02</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>