<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèáüèΩ üôáüèæ üôÄ Work with the Chinese chip ADC Hx711 ‚òëÔ∏è üëÅÔ∏è ü•õ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The reason for writing this post is the desire to deal with the module 24 bit delta sigma ADC converter based on the Hx711 chip. The converter itself ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Work with the Chinese chip ADC Hx711</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487066/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The reason for writing this post is the desire to deal with the module 24 bit delta sigma ADC converter based on the Hx711 chip. </font><font style="vertical-align: inherit;">The converter itself is assembled in the form of a ready-made module according to the switching circuit recommended by the manufacturer (????). </font><font style="vertical-align: inherit;">There are also comments on the operation of this module on this website in Andrey Gerasimenko‚Äôs blog </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúADC 711 from 3.3V- do not believe the Chinese documentation and not only ...‚Äù</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To test this module, a circuit based on the ATmega16 microcontroller, the ADC module, the BC1602 two-line LCD, on the basis of the HD44780 controller, four buttons was assembled. As the development environment, we used the Code Vision AVR program, version 1.25.9 professional, AVR Studio 4, Version 4.09.0.338, the AVR JTAG USB programmer, which allows not only programming the crystal, but also tracking step by step, if necessary, the program execution in the microcontroller, almost in real time.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dn/yi/hh/dnyihhcg8d2ckj5tzu68ae5f_cg.jpeg"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A Chinese-made load cell with a maximum weight limit of 40 kg was chosen as the signal source for the ADC. and standard sensor insertion unit. It should be noted that the use of "native" integration units allows you to get all postulated output data from a single point strain gauge, model CZL A6. So, strain gauges of type Single Point, when using the size specified in the technical specifications of the platform for the location of the weighed load, are designed so that the imbalance signal of the strain gage does not depend on the position of the load on the platform. It is the MECHANICAL properties of the sensor body: geometric dimensions, the location of glued strain gauge films, especially the ‚Äúbone‚Äù cutout in the middle of the sensor body, the size of the platform affecting the torque applied to the sensor body determines this independence.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/k1/jp/zw/k1jpzwxmwwbmdko-l2o7tj_bfbc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Well, the last source is "GOST 29329-92. Scales for static weighing. General technical requirements. ‚Äù This GOST defines the properties of weight measuring instruments. It is also important to work with the EXCEL office program. I am using EXCEL 2003 XP3. This allows you to quickly process the results using ready-made methods. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I hope all the information necessary to repeat my experiments is given fully. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now the program itself that I use to work with the module. The program is focused on CHECK, and hardly directly, i.e. without changes, it can be applied for some applied needs. Although, as they say, "depending on where to apply."</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The program itself is a block structure. It consists of 4 routines and the fifth main main. The first subroutine: ReadCount, reads data from the ADC module and generates them into the Count variable. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CreatInput, generates an input array of conversion data from 32 values. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CreatOutput, generates an output array of ADC conversion data by organizing a moving average with a window size of 16 data. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Keys, a simple program for responding to keystrokes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So that is all. The variables are basically all global, especially since mega resources allowed.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/md/z4/xz/mdz4xz4rpghbubo4yfc4luas2y4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The main program starts by creating the CreatInput input array, then the input data is filtered using the moving average method. The selection of this filter is based on the following. When the program is running, the data on the display changes its value in a fairly large range. I have taken the values ‚Äã‚Äãof the ADC at zero effort on the platform and tabulated. The values ‚Äã‚Äãwere obtained by using the JATAG USB debugger in the AVR Studio environment. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8w/x7/ne/8wx7ne82a80fp4ofgryytwhza7s.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the Excel file ‚ÄúData Acquisition‚Äù, on the ‚ÄúMoving Average‚Äù tab, the result of filtering the fluctuating input data InputBuff (oscillation span 436 units) with an averaging window of 3.12.16 intervals is shown. The result is shown in A37-A40 cells. From which it is seen that the most effective, in this case, is a moving average with a window of 16 samples.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Built graphs show this clearly. </font><font style="vertical-align: inherit;">The data is taken from a working controller, stopped at the moment of transition to the data display procedure. </font><font style="vertical-align: inherit;">Illustrative examples of such data capture are shown in the pictures. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/li/d2/5s/lid25s7vqelzw_hlumiy2uol9qa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No methods of data filtering, through the use of various digital filters, could in any way ‚Äútame‚Äù the input fluctuations. </font><font style="vertical-align: inherit;">If you look at the graph of the input data, then the Gaussian distribution here does not even ‚Äúsmell‚Äù. </font><font style="vertical-align: inherit;">As confirmed by the user Nikopol_86 in the blog "... do not believe the Chinese documentation"</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nikopol_86 5 February 2019 at 09:27 0</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To be honest, he has enough noise at all ratios. I did some research on the density distribution of the ADC codes issued with input circuits shorted, and so there is a spread of up to 1000 1_5V and nifiga is not a normal distribution law, which suggests that either the board wiring is in trouble, or with the ADC, or all taken together . I also noticed that he also does not have temperature stabilization, and the claimed operating temperature range does not correspond to reality. If only because when you connect a 5 kg strain gauge to the ADC, changing the temperature in the room by 1 degree will take readings by 2 grams, and if you warm the microcircuit with your finger, the readings will fly up to 5-7 grams. In general, I made conclusions for myself that only a cat food dispenser can be made on this device,where accuracy in one tram stop will be more than enough. And alas, normal solutions are not cheap, because you have to use high-quality ADCs from AO or T1.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As you can see, the conclusions were confirmed. True, the same is true: </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jushabrauser February 4, 2019 at 12:52 p.m.</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
With a signal-to-noise ratio &lt;1, this will never help. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Even with a bridge circuit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Therefore, under normal conditions (without special mathematics and / or circuitry) at least 8 low-order bits give out nonsense (most likely). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
24 honest Chinese bits for 350 rubles? Do not tell my slippers. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the iron itself is "lying" - what can you do about it? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here, even a third-order nonlinear filter will not help, because the source data is not a cake. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It was from this place that I wanted to see what this module is capable of as part of the scales. Searching the network for problems with the jitter of the last bits of the ADC, led to the forum </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kazus.ru/forums/showthread.php?t=105320&amp;page=4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Here's a whole discussion about stabilizing readings. However, none of the proposed mathematical methods ‚Äúcalmed‚Äù the input data that I receive. From the ‚Äúhardware‚Äù itself, to stabilize the readings, it was introduced: the connection of digital and analog ground, as well as the short circuit of input B to the ground. We used full shielding and powering the module from a 6v battery (followed by a stabilizer 7805) separately from the controller circuits. There is no result, the input data is swinging ...</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, the ‚Äúclean‚Äù 24th category cannot be obtained and the reason here seems to me to be a poor-quality m / circuit. So you need to trim the resulting conversion range. For this, in the ReadCount program, a line was introduced with dividing data by 100. 100 is a little less than 2 to 8 degrees. T.O. AD conversion comes in 16 bits. However, even such a limitation did not make the testimony reliable. And the reason here is the strain gauge properties.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, after applying the calibration process (linking the value of the ADC and the weight on the platform), the weight is displayed in grams. He displays 500 grams as the number 500, one kg as 1000. The division price is 1 gram. Those. we get with 40 kg sensor 40,000 divisions. According to the technical data for the load cell, we can get from the sensor only 3,000 divisions (symbol C3 in the name of the sensor). So the price of division should be (40000/3000) = 13.3 grams. However, according to GOST 29329, weight metrology does not operate with the number 3. Digits should be used: </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1.3 The value of the calibration division value (e), scale division price (d) and reading resolution (dd) in mass units should be selected from the following: 1X10a; 2X10a; 5X10a, where a is a positive, negative integer or zero.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
T.O. the division price for this sensor, guaranteed by the manufacturer 10 grams. That is, the output format should be 0.0x kg. where x = 1,2,3, ... .0. Let's try to make the division price of 5 grams. The relevant programmatic actions are listed. After such a restriction, we ‚Äútake‚Äù from the sensor 40,000 / 5 = 8,000 divisions, which is 2.6 times more than the permissible. After these assumptions, the resulting scales work quite steadily.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The above remark on the applied load cell and its ‚Äúresolution‚Äù do not allow us to conclusively state that this module cannot produce a 24-bit conversion. However, I have tested this sensor for operation with a resolution of 1 gram, on another device, with a different AD converter. On this device, the operation of the sensor and the conversion can be considered satisfactory, because the weight fluctuation was not more than 3 grams. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What does not allow the use of this ADC in commerce?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Well, the first and most important thing is the dependence of the measurement on temperature. Second, using the division and multiplication operations built into ATMEGA, especially for 8 bits, it is difficult to calibrate the scales over the entire weight range under these conditions. It should be borne in mind that the program does not react in any way to the sensor overload.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
How to overcome these inconveniences. First, enter the temperature sensor and adjust the weight reading from the temperature value. Which is pretty complicated. ‚ÄúCheaper‚Äù is to introduce the calibration option, for different loads and depending on the error caused by the temperature, calibrate the weight used in the work. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The second is harder. Replace the procedure of multiplication and division by tabular and shear operations. I think this is the best way to use this module in practice of building weights. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To complete the description of the requirements for creating a program for scales, it is necessary to use the "Program of metrological (certification) calibration of scales" attached to each balance. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Creation of scales based on m / s Hx711 is possible subject to all metrological requirements for the scales. </font><font style="vertical-align: inherit;">The introduction of corrections for the temperature dependence of the conversion must be provided for in a separate procedure. </font><font style="vertical-align: inherit;">Using a module with a resolution of more than 16 bits requires a separate approach and control.</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en487056/index.html">Is it dangerous to keep RDP open on the Internet?</a></li>
<li><a href="../en487058/index.html">"Hadoop. ZooKeeper ‚Äùfrom the Mail.Ru Group Technostream series‚Äú Distributed Processing of Large Data in Hadoop ‚Äù</a></li>
<li><a href="../en487060/index.html">Using Google Chrome? So Google collects your data through X-client-data</a></li>
<li><a href="../en487062/index.html">CBS allowed Linux users to watch Star Trek, thanks to her for that</a></li>
<li><a href="../en487064/index.html">My second year as an independent developer</a></li>
<li><a href="../en487068/index.html">APEC Business Card: An Alternative to a Business Visa to China and Other Countries</a></li>
<li><a href="../en487072/index.html">I want to get married</a></li>
<li><a href="../en487074/index.html">How ABLYY NLP Technologies Learn to Monitor News and Manage Risks</a></li>
<li><a href="../en487076/index.html">Google / Yandex Ads Not Showing: 15 Reasons</a></li>
<li><a href="../en487078/index.html">–ö–∞–∫ –º—ã –ø—Ä–∏—É—á–∏–ª–∏ –∫–æ–ª–ª–µ–≥ –±—Ä–∞—Ç—å –≤–µ—â–∏ –±–µ–∑ —Å–ø—Ä–æ—Å–∞</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>