<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚óΩÔ∏è üíÉ üèáüèª Scaling a high-load network with Nutanix: features and challenges with a personal case üí∏ üë®üèæ‚ÄçüöÄ üêô</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Due to the fact that millions of people are sitting at home, Internet traffic has skyrocketed. Fears have been voiced more than once that an excessive...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Scaling a high-load network with Nutanix: features and challenges with a personal case</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/502150/"><img src="https://habrastorage.org/getpro/habr/post_images/10b/fc4/b85/10bfc4b8539a9236458834b4520fcb10.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Due to the fact that millions of people are sitting at home, Internet traffic has skyrocketed. Fears have been voiced more than once that an excessive load on the network can lead to blackout - national, within a country, or even global. Fortunately, this problem is still being dealt with, but there are other, less obvious difficulties. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What kind? Now many online trading or delivery companies do not have time to process the skyrocketing number of orders, they are losing customers, money and reputation, including because their IT infrastructure was not ready for a multiple increase in data processing volumes. This could be avoided by quickly scaling the IT infrastructure. This can be done using the Hyper-converged infrastructure (HCI). This article is dedicated to her.</font></font><br>
<a name="habracut"></a><br>
<h3>     ?</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We, Platbox, have been processing customer payments (banks, payment systems) for about seven years. We process about 100 million transactions per year. This is acquiring, payments via SMS, shares of different companies, etc. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Over time, the number of merchants whose payments we process is growing, and the load on the network is increasing. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The problem of scaling arose from the first day of the company's existence. The load is growing - we are buying servers, scale the network, solving the problem. Then the number of transactions grows again, resources are gradually exhausted, the cycle repeats. Now the network consists of a whole zoo of equipment, ranging from servers from SuperMicro to Dell. This diversity complicates network maintenance and increases the number of routine operations during maintenance.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The increase in the number of equipment is also a cost. </font><font style="vertical-align: inherit;">We have rental racks in data centers. </font><font style="vertical-align: inherit;">We pay for rent of physical space, for electricity consumed by servers, etc. </font><font style="vertical-align: inherit;">The more servers, the more you have to pay, everything is simple. </font><font style="vertical-align: inherit;">In addition, we decided to expand our place on SDH, as well as increase the computing power of the servers. </font><font style="vertical-align: inherit;">The question arose - to continue to scale what is already there, acting in the conditions of the classical three-level architecture or to introduce something new. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
About six months ago, they decided to look for another solution that would solve the problems described above. </font><font style="vertical-align: inherit;">There were several options, we chose the optimal one - use a hyperconverged infrastructure instead of the traditional one.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What is hyperconverged infrastructure (HCI)?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here you need a little digression into the history of IT. Once the data was processed on mainframes - large powerful computers, then they were replaced by cheaper and more flexible ‚Äústandard architecture servers‚Äù, the concept of 3-Tier architecture arose, and, as a result, dividing the data center into a separate storage subsystem (SAN) , processing subsystem (servers) and data transmission subsystem (network part of the data center). As IT evolved, new ways to store and process data and solve user problems arose. HCI is the "infrastructure for the" cloud "era" in IT, the rejection of 3-Tier architecture in favor of, for example, microservice.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
From a practical point of view, in a classic converged infrastructure, a server, a storage system, network equipment, and a virtualization tool are separate elements. Hyperconverged infrastructure integrates them, as well as all the components of the familiar data center into a single system. Sometimes HCI includes additional components, for example, backup software, snapshot capabilities, data deduplication functionality, intermediate compression, and optimization of the computer network.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If a converged infrastructure is primarily hardware-based, and a software-defined data center is often adapted to any hardware, these two possibilities are combined in a hyper-converged infrastructure. It also improves operational reliability, performance, and data security. In general, HCI should be seen as a round of evolution in IT infrastructure. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After evaluating the pros and cons, we decided to try hyperconvergence, contacted Nutanix, got the platform for the test, which was successful. For the test, we got a hyper-convergent platform, consisting of six nodes, but two-unit. We save electricity, rack space, no need to buy an endless server. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5 benefits of hyper-converged infrastructure</font></font></b><br>
<br>
<img src="https://idc-cema.com/dwn/SF_261661/hyperconverged_infrastructure_web_banner_1920x780.jpg" alt="image"><br>
<br>
<ol>
<li>    IT- ‚Äì       HCI,        IT-¬´¬ª,        . </li>
<li>  ;</li>
<li>  .         .  ,      .  ,          .  Nutanix     ,      . </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The risk of unavailability of services in case of failure of one or several of the components due to unification, data backup and hardware is reduced. </font><font style="vertical-align: inherit;">If the equipment suddenly ‚Äúfalls‚Äù in one data center, the reserve immediately starts in another.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The open source code of the product facilitates a security audit, and the built-in STIG (Security Technical Implementation Guide or set of recommendations for protecting IT systems) provides high security code execution and resistance to the impact of attackers on the IT system.</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How did we choose a vendor</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We looked at several suppliers of hyperconverged systems. </font><font style="vertical-align: inherit;">Among them are Cisco Hyperflex, SimpliVity, HPE Hyper Converged, Fujitsu PRIMERGY CX and Nutanix. </font><font style="vertical-align: inherit;">Then the following selection criteria were formulated:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reliability and safety of data inside;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compliance with security requirements PCI DSS 3.2.1;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Speed ‚Äã‚Äãof work;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenance and technical support;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The flexibility to scale the infrastructure at the speed that the company needs.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result, we stopped at Nutanix, since it was with this company that, in fact, the HCI market began in 2012. </font><font style="vertical-align: inherit;">It offers the most stable product with flexibility and the greatest capabilities, for example:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A wide selection of platforms (HPE, Dell, Fujitsu, Cisco);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Availability of a free version of Community Edition;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The freedom to choose a hypervisor (including free - AHV). </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A small "growth quantum" (in fact, it is one server), which already gives the business everything that it can and gives the largest: reliability, security and new technologies. </font><font style="vertical-align: inherit;">All the functionality of Nutanix, which today is used by the business level, for example, VTB or Societe Generale group, is also available for the most entry-level solutions.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition, specialists with experience working with the Nutanix platform have appeared in our technical team. </font><font style="vertical-align: inherit;">Thanks to them, we knew how the system would behave in critical situations, which is incredibly important for us, as for a fintech company. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another factor that has influenced Nutanix‚Äôs choice is the availability of a transition tool such as Nutanix Move. </font><font style="vertical-align: inherit;">It allows you to translate machines with minimal downtime. </font><font style="vertical-align: inherit;">So, for example, if there are VMware and Nutanix machines, then Move acts as a kind of bridge. </font><font style="vertical-align: inherit;">He takes the machine from VMWare, clones it, deploys it to Nutanix based on snapshots, extinguishes it in VMWare and launches it in nutanix. </font><font style="vertical-align: inherit;">All this in literally seconds.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The transition process to Nutanix</font></font></h3><br>
<img src="https://habrastorage.org/getpro/habr/post_images/7e5/78d/938/7e578d938c83ade5f3aaadc1820606a0.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The main requirement when moving was not to violate the stability of the system, so it was necessary to switch to a new platform very carefully. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Therefore, it all started with testing the trial platform Nutanix, which was already mentioned above. We started a series of tests by deploying a test environment. We used processing, which is not on production, and, so to speak, ‚Äúshot‚Äù it from Yandex-gun. We checked the load, utilized enough resources for our purposes, realized that it worked perfectly, and where optimization was needed.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HCI usually coexists with the classic infrastructure, without requiring immediate abandonment of the familiar data center. </font><font style="vertical-align: inherit;">Migration to HCI can be gradual, extended, and smooth as much as the company needs. </font><font style="vertical-align: inherit;">For example, if virtualization and a hypervisor are already used in the company's data center, the transition to the HCI environment is a gradual migration of virtual machines from old servers to new ones: from ‚Äúclassic‚Äù servers to HCI servers. </font><font style="vertical-align: inherit;">This is just our case. </font><font style="vertical-align: inherit;">We will need to transfer virtual machines to another virtual environment. </font><font style="vertical-align: inherit;">Where possible, automatic migration using Nutanix Move will be involved, some services are described as infrastructure as code (IaC). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All this can be divided into several stages:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Writing RoadMap.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Launching a new infrastructure. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Translation of services according to RoadMap.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The implementation of these stages takes about 2 months. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Difficulties and problems of transition</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Problems, of course, were. The main difficulty is that the processing at the time of the migration of services still have to be suspended. But we worked on this point when we took the Nutanix platform for testing. We built a plan for the purchase of equipment and migration of services at the testing stage. The strict implementation of the approved plan is the key to the success of service migration.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In some companies, in our experience, the difficulties of moving to a hyper-converged infrastructure are more likely not of a technical nature, but of an organizational or ‚Äúbudget‚Äù one. </font><font style="vertical-align: inherit;">For example, if a data center is working, and there are no new tasks for it, if a lot of expensive equipment was bought relatively recently for the development of a "classic" infrastructure, it will be very difficult to come up with an idea (and argue its management or investors) that this must be abandoned and money spent again - already at HCI. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Positive Results of Switching to HCI </font></font></b><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/dec/93b/87b/dec93b87bf3120f7dcfed6b256d46dde.jpg" alt="image"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The quality of sleep for operating professionals has improved significantly. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Why? </font><font style="vertical-align: inherit;">It's simple - distributed storage improves storage reliability and data availability. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Optimized business processes and employees:</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">one admin instead of 3; </font></font></li>
<li>   IT-,                  ;</li>
<li>           . </li>
<li>    .</li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reduced iron costs.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> About how and why, it was said above. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simplified the scaling of data center costs.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In the classical approach, it can be very difficult to develop an infrastructure that is ready to grow tenfold without the need to change it in whole or in part. In the case of HCI, you can start with a very small solution, gradually investing more in infrastructure. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There is an opportunity to redistribute costs from capital costs to operational</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which is now going to IT all over the world. This requires a different way to plan costs, otherwise look at familiar things, learn new things, but this is where the industry is going today.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To understand how simple it is, we‚Äôll give you one case. </font><font style="vertical-align: inherit;">So, during the charity marathon, we had a very strong network load - much higher than the calculated one. </font><font style="vertical-align: inherit;">The miscalculation arose because the load was calculated from the statistics of previous marathons. </font><font style="vertical-align: inherit;">We did not take into account that more people will take part in the new one, the reason is quarantine and self-isolation. </font><font style="vertical-align: inherit;">If the problem had arisen with the existing infrastructure, the consequences would have been very negative, including the disconnection of services. </font><font style="vertical-align: inherit;">Now we took Nutanix, thanks to which we were able to increase the cluster exactly twice. </font><font style="vertical-align: inherit;">The system ‚Äúdigested‚Äù the load. </font><font style="vertical-align: inherit;">And all this could be done in just 15 minutes and a few mouse clicks.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A bit about the prospects for technology and the choice of HCI </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Should everyone switch to HCI? No, of course not. Basically, hyper-converged infrastructure is suitable for those companies that have large-scale networks, a high load on them and enough funds for the transition. If a startup has several servers, then you can not change anything. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But if the company has a whole server iron zoo, a poorly optimized network and a high level of costs for iron and its maintenance, then HCI is definitely there. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Well, the following can be said about the future of HCI. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Firstly</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, HCI is distributed in the world and in Russia to the extent that IT is ready to accept and use new ideas. Many developing companies are looking for new opportunities for development and growth, especially in the context of shrinking IT budgets. Companies of traditional and conservative businesses are likely to come to HCI later, active, young, developing and using new technologies - earlier. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Secondly</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , more and more companies will enter the HCI market, technology will become more widespread and affordable. Already, all the top manufacturers of servers and storage systems have proposals in the field of HCI, and this has happened literally in the last year or two. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thirdly</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, the idea of ‚Äã‚Äã‚Äúcloudiness‚Äù will continue to develop, including in the form of a ‚Äúhybrid cloud‚Äù, when part of the infrastructure will be located in its ‚Äúown‚Äù data center, and part will be rented as needs arise. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An example is the same online stores and delivery services. In the event of a multiple jump in traffic, they could scale in a few minutes by renting capacities from a cloud operator, and not ‚Äúhang‚Äù all day, losing customers and their money. And then, after the decline in demand and the reassurance of the market, scale the infrastructure back without sacrificing security, performance, or spending money on the purchase of your equipment. Perhaps in the future, the ‚Äúcloud‚Äù and ‚Äúyour data center‚Äù will be linked seamlessly. At least all the technologies for this already exist. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fourth</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, automation systems for managing IT infrastructure will begin to develop actively, including using AI, virtualization of the network infrastructure of the data center.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en502132/index.html">How to transfer OpenVZ 6 container to KVM server without headache</a></li>
<li><a href="../en502134/index.html">Enough to be afraid of subjectively beautiful decisions in the code - you are not robots</a></li>
<li><a href="../en502136/index.html">Data compression in Apache Ignite. Sberbank Experience</a></li>
<li><a href="../en502146/index.html">Online roundtable "I want to gamedev"</a></li>
<li><a href="../en502148/index.html">Using third-party components in storage using Qsan as an example</a></li>
<li><a href="../en502154/index.html">Writing Autotests Effectively - Subcutaneous tests</a></li>
<li><a href="../en502156/index.html">Rambler v. NGINX Case: Criminal Risks of Digitalization Roundtable May 16</a></li>
<li><a href="../en502158/index.html">How to organize testing in order to accelerate and stabilize product releases. Part 2</a></li>
<li><a href="../en502160/index.html">Custom mobile app development is inexpensive: reality or illusion</a></li>
<li><a href="../en502166/index.html">Ghosts Windows 3.1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>