<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö∂üèø üë©üèΩ‚Äç‚öïÔ∏è üè≠ Uma introdu√ß√£o ao TLS para Patrik Patrick (Parte 1) ü§¥üèæ üåö üôåüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Como voc√™ j√° deve saber, este √© Patrick. Ele √© uma estrela do mar, o que significa que √© poss√≠vel, sem insult√°-lo, dizer que suas m√£os est√£o crescendo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Uma introdu√ß√£o ao TLS para Patrik Patrick (Parte 1)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/plesk/blog/502604/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como voc√™ j√° deve saber, este √© Patrick. Ele √© uma estrela do mar, o que significa que √© poss√≠vel, sem insult√°-lo, dizer que suas m√£os est√£o crescendo de um s√≥ lugar. Patrick tamb√©m √© muito pr√°tico e imediatamente esquece tudo o que ele n√£o precisa - mas se ele precisar de algo, ele quer saber (porque ele precisa!). Spoiler: aqui Patrick est√° tentando fazer um TLS Handshake. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/di/aa/64/diaa64cwcj8dktjvcv-4ba6wtbg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este artigo foi escrito para Patrick e pessoas como ele. Ela nasceu de uma apresenta√ß√£o mostrada pela primeira vez no Plesk TechTalk educacional interno, onde os funcion√°rios, de forma acess√≠vel, compartilham informa√ß√µes entre si sobre tecnologias, processos e solu√ß√µes interessantes. Portanto, as imagens deste artigo ter√£o a apar√™ncia de slides :) O autor do texto original do relat√≥rio √© o gerente do programa, Plesk </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ruslan Kosolapov</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Normalmente, todo o material TLS cobre algum aspecto pequeno, mas n√£o o quadro geral. </font><font style="vertical-align: inherit;">Isso n√£o √© muito pr√°tico e Patrick tem uma dor de cabe√ßa com isso. </font><font style="vertical-align: inherit;">Tudo ser√° diferente aqui: brevemente, aplic√°vel "na vida cotidiana" e o mais exaustivamente poss√≠vel.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que √© TLS e por que √© para Patrick</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TLS (Transport Layer Security) √© um protocolo de prote√ß√£o de camada de transporte. √â necess√°rio para que ningu√©m possa "ouvi-lo" e descobrir algumas informa√ß√µes importantes (na maioria das vezes senhas, se falarmos sobre trabalhar na rede). E tamb√©m para se protegerem de falsifica√ß√£o e modifica√ß√£o de tr√°fego durante a transmiss√£o. √â nessas duas coisas que reside o objetivo do TLS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para maior clareza, vamos considerar o handshake TLS como uma chamada para Patrick Bob Esponja. Durante uma chamada, algu√©m pode escutar a conversa (ao lado de Patrick ou ligando no meio da linha), e geralmente o Bob Esponja pode n√£o estar do outro lado - todos esses problemas s√£o relevantes. E para resolv√™-los, Patrick quer usar o TLS. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em resumo, o aperto de m√£o de n√≠vel superior √© assim: </font></font></b><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Patrick:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Eu quero usar o TLS, as vers√µes cifradas s√£o assim.</font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bob Esponja:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ok, vamos usar vers√µes cifradas como essas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois disso, Bob Esponja envia o certificado, Patrick verifica, diz que est√° tudo bem, a chave da sess√£o est√° pronta (na verdade existem dois deles, mas isso n√£o importa). Por que usar uma chave de sess√£o em vez de criptografia assim√©trica - porque √© mais r√°pida. Depois disso, eles come√ßam a falar um idioma incompreens√≠vel para descriptografar. Assim, tudo est√° protegido. </font></font><br>
<img src="https://habrastorage.org/webt/na/xj/yu/naxjyufzfjvlcazi16qsmlf5muq.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo parece ser simples. Como ele funciona no hardware n√£o √© t√£o importante para n√≥s. Mas se voc√™ come√ßar a pensar - e Patrick come√ßa a pensar! - isso levanta a quest√£o de como geralmente concordamos que usaremos o TLS? Afinal, uma vez que n√£o havia TLS, havia apenas protocolos comuns - SMTP, HTTP. Como dizer o que √© necess√°rio no TLS? E aqui em nossa ind√∫stria tudo est√° como sempre - h√° muitas maneiras!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inicialmente, eles queriam usar uma porta espec√≠fica, o que implicaria o uso de TLS nela. </font><font style="vertical-align: inherit;">Quais s√£o as desvantagens disso? </font><font style="vertical-align: inherit;">E por que ent√£o o m√©todo expl√≠cito (expl√≠cito) para iniciar uma sess√£o TLS apareceu? </font><font style="vertical-align: inherit;">Existem v√°rias raz√µes:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ precisa de muitas portas - e as portas s√£o uma coisa que voc√™ n√£o deseja gastar. </font><font style="vertical-align: inherit;">Como quanto mais existem, mais dif√≠cil √© configurar o firewall.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O servidor pode ignorar isso - ele se conectou √† porta 443 e n√£o h√° TLS l√°, apenas HTTP sem HTTPS.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Antes de a conex√£o ser estabelecida, n√£o √© poss√≠vel descobrir se o servidor TLS √© suportado ou n√£o.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo isso levou ao surgimento de um m√©todo expl√≠cito - quando nos conectamos a uma porta regular e, em seguida, atualizamos nossa sess√£o para TLS. </font><font style="vertical-align: inherit;">Para servi√ßos diferentes, o protocolo possui comandos diferentes, por exemplo, para SMTP, existe um comando separado no n√≠vel do protocolo SMTP - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STARTTLS</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">O HTTP tamb√©m tem uma piada, chamada </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Upgrade: TLS / 1.0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">No n√≠vel do protocolo, √© mais f√°cil entender se um servidor TLS √© suportado ou n√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos nos aprofundar um pouco mais nos diferentes tipos de conex√µes e em como as coisas est√£o com o TLS para elas.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conectar: ‚Äã‚ÄãHTTP</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo seria f√°cil se, como sempre, n√£o houvesse nuances. No caso do HTTP, os crescentes requisitos de seguran√ßa fornecem uma evolu√ß√£o constante do processo de trabalho com o TLS. No in√≠cio, houve um redirecionamento para HTTPS, e isso foi feito simplesmente no cabe√ßalho. Isso deixou uma brecha para vulnerabilidades, ent√£o o Google criou o HSTS (HTTP Strict Transport Security). Este √© um cabe√ßalho na resposta HTTP que informa ao navegador: ‚Äúlembre-se de que, quando voc√™ chegar a esse dom√≠nio, v√° diretamente para HTTPS, mesmo que a pessoa tenha lhe dito para acessar HTTP‚Äù. Assim, n√£o h√° redirecionamento e tudo acontece muito mais seguro. Al√©m disso, o Google tem outra iniciativa - voc√™ pode deixar uma solicita√ß√£o para que seu site seja adicionado √† lista do Google Chrome "Sempre use HTTPS", independentemente de qualquer cabe√ßalho. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resumidamente:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O HSTS resolve o redirecionamento das vulnerabilidades HTTP para HTTPS, ent√£o quase todos os navegadores oferecem suporte ao HSTS, o que √© bom.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connect: exotic (novas vers√µes do HTTP e n√£o apenas)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No HTTP / 2, as coisas s√£o boas com o TLS: ele sempre √© usado (como os navegadores s√£o criados agora). </font><font style="vertical-align: inherit;">Al√©m disso, o TLS no HTTP / 2 deve ser novo - ou seja, ter a vers√£o 1.2+. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Provavelmente, muito em breve o Google vender√° o amplo uso do HTTP / 3, agora ele √© adotado pelo padr√£o da IANA. </font><font style="vertical-align: inherit;">A hist√≥ria de sua apar√™ncia e desenvolvimento √© bastante confusa; </font><font style="vertical-align: inherit;">A principal coisa a lembrar Patrick:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O HTTP / 3 √© sempre o TLS 1.3+.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O HTTP / 3 √© baseado no QUIC - √© um protocolo sobre UDP, que, segundo o Google, √© melhor que o TCP. </font><font style="vertical-align: inherit;">Na verdade, antes que o nome HTTP / 3 fosse finalmente aprovado, o protocolo era chamado HTTP-over-QUIC.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainda existe um protocolo SCTP interessante, usado principalmente em telecomunica√ß√µes. </font><font style="vertical-align: inherit;">Acima dele, TLS e DTLS s√£o usados ‚Äã‚Äã(esse √© o TLS para UDP). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resumidamente:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> em 2 anos, o QUIC (ou seja, HTTP / 3) ser√° usado em qualquer lugar, mas agora j√° deve haver HTTP / 2 em todos os lugares, mas, na realidade, n√£o est√° em todo lugar.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connect: Mail</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muitos clientes acreditam que deve haver TLS na porta 587, mas tamb√©m h√° nuances aqui: algu√©m espera o TLS por padr√£o e algu√©m espera uma solicita√ß√£o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STARTTLS</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> expl√≠cita </font><font style="vertical-align: inherit;">do cliente. Por isso, v√°rias combina√ß√µes de servidor e cliente de email √†s vezes causam efeitos indesejados. Por exemplo, um cliente entra na porta 587, esperando que haja TLS, enquanto o servidor aguarda o cliente solicitar explicitamente </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STARTTLS</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . N√£o tendo recebido nada, o cliente volta para a porta 25. O resultado √© uma troca silenciosa para uma conex√£o SMTP n√£o segura. Ao testar e desenvolver, vale a pena lembrar sobre esses efeitos das combina√ß√µes cliente-servidor. O Autodiscaver possui v√°rias op√ß√µes para especificar o TLS: como deve ser, o que √© esperado e o que fazer. Muitos clientes de email entendem essas coisas. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resumidamente:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> com o suporte a TLS em servidores e clientes de correio, tudo est√° bem em geral, mas em casos especiais, pode haver problemas e as extens√µes TLS n√£o s√£o muito bem suportadas.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conectar: ‚Äã‚ÄãFTP</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pouco pode ser dito aqui. </font><font style="vertical-align: inherit;">O principal problema √© o SNI (√© quando dom√≠nios diferentes est√£o no mesmo IP). </font><font style="vertical-align: inherit;">No n√≠vel do FTP, o nome do dom√≠nio n√£o √© transferido. </font><font style="vertical-align: inherit;">Em uma vers√£o expl√≠cita, n√£o pode funcionar, porque n√£o h√° onde escrev√™-lo. </font><font style="vertical-align: inherit;">Existem v√°rias op√ß√µes de solu√ß√£o - algumas oferecem, outras, uma solu√ß√£o geral ainda n√£o foi adotada, n√£o existe um padr√£o. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resumidamente: existe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> algum tipo de suporte TLS para FTP (FTPS, SFTP - um an√°logo do FTP implementado atrav√©s do SSH), mas alguns aspectos n√£o s√£o abordados devido √†s limita√ß√µes t√©cnicas do pr√≥prio FTP.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TLS Handshake</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o, agora sabemos como iniciar a comunica√ß√£o usando o TLS em diferentes conex√µes, e Patrick conseguiu comunicar seu desejo ao Bob Esponja. </font><font style="vertical-align: inherit;">Depois que eles concordam em usar o TLS, o TLS Handshake √© produzido. </font><font style="vertical-align: inherit;">Seu resultado deve ser um acordo entre o cliente e o servidor sobre como eles criptografam tudo. </font><font style="vertical-align: inherit;">Al√©m disso, o cliente deve garantir que o servidor seja o necess√°rio. </font><font style="vertical-align: inherit;">√Äs vezes, o servidor tamb√©m verifica o cliente (mas com muito menos frequ√™ncia).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cifras e vers√µes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como j√° mencionado, o primeiro passo √© escolher qual vers√£o do TLS e quais cifras ser√£o usadas para criptografia. </font><font style="vertical-align: inherit;">Normalmente, a cifra fica assim: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7j/bc/ne/7jbcnel13ieehyi6h6ibu9gi7r4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O conjunto de cifras est√° no registro da IANA e no protocolo TLS, na forma bin√°ria, √© apenas seu ID. </font><font style="vertical-align: inherit;">Como voc√™ pode ver na figura, aqui n√£o √© apenas (e n√£o apenas) a cifra, mas tamb√©m o modo de opera√ß√£o e outros detalhes necess√°rios para o handshake TLS. </font><font style="vertical-align: inherit;">Patrick n√£o precisa entrar em detalhes. </font><font style="vertical-align: inherit;">Tudo o que √© importante nesta fase √© lembrar que essas cartas s√£o boas (e as demais s√£o ruins):</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DHE</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ECDhe</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> AES128</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> AES256</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> RSA</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ecdsa</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cbc</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Gcm</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SHA256</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SHA383</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CHACHA20</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> POLY1308</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imagem para lembrar boas cifras: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/5o/oz/us/5oozuswdmgo1dmropfliew8ee3w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se for dif√≠cil lembrar, existem bons servi√ßos que podem lhe informar, por exemplo, um servi√ßo do Mozilla </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssl-config.mozilla.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/im/06/g0/im06g0jqgsdkw3kbie0c3lzfjcq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode ver imediatamente onde e como ele √© suportado - √© isso que os caras da Mozilla est√£o tentando seguir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um detalhe interessante: o cliente transfere as cifras em ordem de prioridade, de acordo com suas prefer√™ncias, mas o servidor fica com a decis√£o - seleciona a cifra que parece ser a melhor da lista de clientes suportados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ambos os lados tamb√©m indicam a vers√£o m√°xima suportada do protocolo - nesse caso, Patrick √© mais avan√ßado que Bob Esponja.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Certificado de verdade</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Juntamente com a resposta "Vamos fazer assim", o servidor envia seu certificado ou certificados - pode haver muitos deles. </font></font><br>
<img src="https://habrastorage.org/webt/ay/9m/p-/ay9mp-c7akdltxlnomatwwq1zdq.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que √© um certificado? Esse √© um relacionamento de informa√ß√µes (assunto) - geralmente √© o nome de um dom√≠nio ou organiza√ß√£o - e uma chave p√∫blica (chave p√∫blica). Ou seja, o certificado diz: ‚ÄúCara, minha chave p√∫blica √© assim. Agora, com a ajuda dele, concordaremos com as chaves da sess√£o. ‚Äù Al√©m disso, com sua ajuda, voc√™ pode verificar a assinatura de certificados ou outra coisa. Ou seja, em princ√≠pio, seria poss√≠vel usar n√£o certificados, mas registros onde esse relacionamento √© indicado. De fato, as etapas nessa dire√ß√£o continuam, porque o mecanismo da Autoridade de Certifica√ß√£o √© considerado n√£o muito bom, simplesmente n√£o h√° mais nada.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, o certificado √© a estrutura de 'Subject: Public key' mais a assinatura desse ishyuer (o emissor em translitera√ß√£o para o russo parece p√©ssimo, mas o sin√¥nimo mais pr√≥ximo aqui n√£o est√° muito pr√≥ximo do "emissor") em que este certificado foi emitido. Ish√ºyer tamb√©m tem um certificado e a conex√£o de algu√©m com alguma coisa. Voc√™ pode verificar a exatid√£o do certificado, pegando a chave p√∫blica do ishyuere e verificando a assinatura. Como resultado, nada pode ser falsificado aqui. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos revisar o certificado e ver quais problemas ele pode ter. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/14/gt/ox/14gtoxx4czgwthkckj2vjyjfnbi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em primeiro lugar, o n√∫mero de s√©rie implica exclusividade apenas dentro dos limites do ishyuere, embora alguns softwares considerem que ele √© √∫nico em todo o universo. Felizmente, mais frequentemente do que n√£o, √© verdadeiramente completamente √∫nico.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O certificado tamb√©m indica quais algoritmos s√£o usados ‚Äã‚Äãpara criptografia e assinatura: RSA ou ECDSA - ou seja, qual criptografia usar para trabalhar com essa chave p√∫blica. A principal diferen√ßa entre o RSA e o ECDSA √© que o princ√≠pio matem√°tico do ECDSA √© baseado em curvas el√≠pticas, e o RSA √© simplesmente n√∫meros naturais, por isso √© mais lento e s√£o usados ‚Äã‚Äãbits de chaves grandes (3-4.000) para evitar que sejam quebrados . E para ECDSA, uma chave de 300 bits √© suficiente e funciona mais rapidamente. Portanto, muitos est√£o mudando para o ECDSA - o aperto de m√£o em si √© pesado e eu quero reduzi-lo. A ECDSA pode ser solicitada ao emitir um certificado e, se o prospector o apoiar, ele far√° isso por voc√™. Mas a assinatura do certificado depende da chave privada que o ishuiur possui atualmente e n√£o da solicita√ß√£o da ECDSA ou da RSA.Portanto, os navegadores podem mostrar que um est√° na assinatura e o outro na chave p√∫blica, e n√£o √© necess√°rio ter medo se a assinatura n√£o for ECDSA.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como obter um certificado?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em resumo - assim: </font></font><br>
<img src="https://habrastorage.org/webt/th/7f/f1/th7ff1g-1g54v0t-_genzf3rc3u.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Patrick diz √† Autoridade de certifica√ß√£o: Eu preciso de um certificado. </font><font style="vertical-align: inherit;">Essa pessoa (ou organiza√ß√£o) verifica se √© Patrick. </font><font style="vertical-align: inherit;">Os cheques podem ser muito diferentes. </font><font style="vertical-align: inherit;">Obviamente, Patrick como cliente pode n√£o ter um certificado, mas se o servidor n√£o tiver um certificado, n√£o haver√° TLS. </font><font style="vertical-align: inherit;">√â verificado se tudo est√° indicado corretamente no pedido de certificado, se Patrick realmente √© o propriet√°rio do assunto para o qual est√° solicitando um certificado. </font><font style="vertical-align: inherit;">Isso √© feito por centros superiores da Autoridade Certificadora - pessoas condicionais em quem todos acreditam. </font><font style="vertical-align: inherit;">Para emitir um certificado, √© necess√°rio elaborar um CSR (solicita√ß√£o de assinatura de certificado, uma solicita√ß√£o de certificado).</font></font><br>
<br>
<img src="https://habrastorage.org/webt/z1/mi/dk/z1midktpy8soeqqaz_xah-w0sn8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa tamb√©m √© uma estrutura, dif√≠cil de trabalhar, porque existem poucos servi√ßos que permitem definir, especificar, verificar e ver tudo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No total, geramos um par de chave p√∫blica: chave privada, mas damos apenas o p√∫blico e ocultamos o privado. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em seguida, geramos uma solicita√ß√£o de assinatura de certificado e a assinamos com nossa chave privada. </font><font style="vertical-align: inherit;">Enviamos tudo isso para a autoridade de certifica√ß√£o e ela inicia a verifica√ß√£o. </font><font style="vertical-align: inherit;">Pode ser diferente, para certificados especialmente legais, existem procedimentos complicados especiais, mas vamos nos concentrar no caso geral.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CAA RR</font></font></h2><br>
<img src="https://habrastorage.org/webt/pg/rh/lw/pgrhlwwd8la4_perxzg4zawlyjy.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existe um problema que pessoas que todos acreditam que √†s vezes n√£o s√£o muito boas. Uma das raz√µes pelas quais a Symantec se tornou parte do DigiCert √© porque (a Symantec) emitiu certificados sem perguntar aos propriet√°rios do dom√≠nio. Voc√™ n√£o pode fazer isso, foi um insulto a todos, mas principalmente √† pr√≥pria Symantec, porque voc√™ teve que vender seus neg√≥cios. Para tornar o servidor menos dependente de camaradas inescrupulosos, existe o registro CAA RR - um registro no DNS, onde diz quem o propriet√°rio permite emitir certificados para seu dom√≠nio. Esse recurso tamb√©m est√° no Plesk, √© pouco usado at√© o momento, aproximadamente como o DNSSec, mas mesmo assim. Todas as autoridades de certifica√ß√£o concordaram em verificar esta entrada e, se disser que essa autoridade de certifica√ß√£o n√£o pode ser emitida, dir√°: "voc√™ n√£o passou na valida√ß√£o, est√° escrito no CAA RR,que n√£o posso escrever um certificado para voc√™ "- e n√£o vou escrever. Se n√£o houver entrada, voc√™ poder√°. Agora, o Google est√° adotando a iniciativa para que os clientes verifiquem o certificado que receberam em conformidade com os registros CAA RR. O debate ainda est√° em andamento.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, o CAA RR a partir do momento em que expandimos o suporte no Plesk, indicando m√©todos de valida√ß√£o (ou seja, voc√™ tamb√©m pode indicar aqui por qual m√©todo voc√™ valida que esse dom√≠nio √© seu) e o URI da conta (Identificador Uniforme de Recursos). </font><font style="vertical-align: inherit;">Popular entre os usu√°rios O Plesk Let's Encrypt j√° suporta tudo isso (muito bem!). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo isso funciona para qualquer tipo de certificado e, como falaremos sobre as diferen√ßas mais tarde, √© hora de falar sobre os tipos com mais detalhes.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tipos de certificado</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° tr√™s deles:</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valida√ß√£o de dom√≠nio</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O assunto √© um dom√≠nio, ou seja, aqui s√≥ o verificamos. </font><font style="vertical-align: inherit;">Anteriormente, quando n√£o havia validadores autom√°ticos, a valida√ß√£o era realizada principalmente por e-mail atrav√©s do servi√ßo Whois. </font><font style="vertical-align: inherit;">Este foi considerado um motivo suficiente para acreditar que voc√™ √© o propriet√°rio deste dom√≠nio. </font><font style="vertical-align: inherit;">Ent√£o eles pensaram em checar o DNS - eles escreveram para voc√™ por e-mail: ‚Äúe adicionam esse e aquele registro ao DNS‚Äù. </font><font style="vertical-align: inherit;">Mais tarde, m√©todos autom√°ticos apareceram (falaremos um pouco mais sobre o ACME).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valida√ß√£o da organiza√ß√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No campo "assunto", al√©m do nome do dom√≠nio, o nome da organiza√ß√£o tamb√©m √© indicado. </font><font style="vertical-align: inherit;">A verifica√ß√£o consiste em validar se o dom√≠nio pertence a esta organiza√ß√£o e se a pessoa que veio para o certificado trabalha l√°. </font><font style="vertical-align: inherit;">Como isso √© feito: eles procuram organiza√ß√µes nos registros, ligam, pedem que algo seja feito (o telefone estava correto, a pessoa certa atendeu, o que significa que provavelmente tudo est√° bem).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valida√ß√£o estendida</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O mesmo que OV, apenas mais frio. Tudo √© muito regulamentado aqui - um documento de 40 p√°ginas no esp√≠rito de "no par√°grafo 5.6.8 deve ser o seguinte: ...", etc. Muitas coisas s√£o verificadas - o pa√≠s, o departamento (se indicado no aplicativo) e, √†s vezes, uma pessoa especial sai para ver com os olhos. Qual √© a diferen√ßa pr√°tica? Quase todos os navegadores deixaram de distinguir entre OV e DV, e isso √© ruim, porque nesse caso o nome da organiza√ß√£o n√£o √© exibido. Como resultado, ningu√©m se preocupa em criar um dom√≠nio aliepxress.ru, desenhe a mesma p√°gina e roube cart√µes de cr√©dito. E ser√° absolutamente leg√≠timo criar um dom√≠nio desse tipo e obter um certificado DV nele.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exemplo com EV - o nome da organiza√ß√£o √© vis√≠vel aqui; portanto, se algu√©m roubar algo, o usu√°rio saber√° que era a corpora√ß√£o Valve Corp, e registrar a corpora√ß√£o √© um pouco mais dif√≠cil que o dom√≠nio (mais verifica√ß√µes). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6p/kp/kc/6pkpkccn848gjwl1osfx_yc0gjy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, tudo vai at√© o ponto em que o VE deixar√° de ser diferente; em dispositivos m√≥veis, ele n√£o √© mais vis√≠vel e voc√™ precisa pressionar um bot√£o separado, e tamb√©m no Safari. </font><font style="vertical-align: inherit;">O Google Chrome ainda est√° em espera (UPD - n√£o mais! Eu tive que criar uma tela do IE). </font><font style="vertical-align: inherit;">A argumenta√ß√£o daqueles que n√£o mostram: ‚Äúse voc√™ est√° preocupado, clique e olhe‚Äù, mas ningu√©m pressiona naturalmente.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obtendo um certificado: automa√ß√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora vamos falar sobre o recebimento automatizado de certificados DV. </font><font style="vertical-align: inherit;">Para maior clareza, vamos ver como o nosso Let's Encrypt favorito faz. </font><font style="vertical-align: inherit;">Ele geralmente tem boa documenta√ß√£o, se algu√©m estiver interessado, e at√© mesmo em russo.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ACME</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O ACME (ambiente de gerenciamento autom√°tico de certificados) √© um protocolo projetado para automatizar e padronizar o processo de obten√ß√£o de um certificado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como a ACME prova que voc√™ √© propriet√°rio de um dom√≠nio? </font><font style="vertical-align: inherit;">Voc√™ diz: Quero um certificado e indique o tipo de valida√ß√£o autom√°tica - por exemplo, ACME HTTP-01. </font><font style="vertical-align: inherit;">O Let's Encrypt pede para voc√™ colocar os dados em um arquivo e, se voc√™ puder colocar os arquivos no seu dom√≠nio (e o Let's Encrypt puder busc√°-los a partir da√≠ via HTTP), provavelmente voc√™ √© o propriet√°rio. </font><font style="vertical-align: inherit;">Agora, essa abordagem √© criticada, inclusive do Google, porque n√£o protege contra phishing. </font><font style="vertical-align: inherit;">Ou seja, com a valida√ß√£o manual, √© prov√°vel que o dom√≠nio aliepxress.ru suscite suspeitas, mas o Let's Let Criptografar at√© agora n√£o sabe como (ou pode, mas muito).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desafio de DNS</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m do ACME, tamb√©m h√° um desafio de DNS. </font><font style="vertical-align: inherit;">Por exemplo, eles dizem a voc√™: insira um registro txt na sua zona DNS, coloque os dados nele. </font><font style="vertical-align: inherit;">Existem outras maneiras, mas n√£o comuns, e uma foi cancelada por completo, porque se mostrou vulner√°vel. </font><font style="vertical-align: inherit;">O que temos no Plesk: certificados curinga (que podem ser emitidos apenas pelo desafio do DNS) n√£o funcionam para muitas pessoas, porque muitas vezes o Plesk n√£o gerencia zonas e extens√µes DNS do dom√≠nio. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos criptografar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√£o pode automatizar a cria√ß√£o de um registro na zona DNS .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais duas palavras sobre Let's Encrypt</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um aspecto importante ao trabalhar com os certificados Let's Encrypt √© o limite. </font><font style="vertical-align: inherit;">Em caso de d√∫vida (ou suspeita de que foram alcan√ßados), √© melhor seguir o link: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">letsencrypt.org/docs/rate-limits</font></font></a><br>
<img src="https://habrastorage.org/webt/c0/lx/5g/c0lx5gabymsjx5fzdqfvn1lk-ku.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Äs vezes, eles s√£o atualizados. </font><font style="vertical-align: inherit;">Existem limites n√£o √≥bvios que as pessoas esquecem: na maioria das vezes, a julgar pelos pedidos de suporte, eles enfrentam um limite de 100 nomes de dom√≠nio no certificado. </font><font style="vertical-align: inherit;">O Let's Encrypt tamb√©m possui um servidor intermedi√°rio e h√° mais limites, mas esses certificados s√£o considerados n√£o confi√°veis ‚Äã‚Äãe, para o navegador, s√£o semelhantes aos autoassinados. </font><font style="vertical-align: inherit;">Na pr√°tica, com um limite de 100 nomes, eles raramente chegam at√© n√≥s (apesar do fato de os sites no Plesk terem um total de 1.300.000 certificados Let's Encrypt). </font><font style="vertical-align: inherit;">A mediana, de acordo com nossas estat√≠sticas, √© de 20 nomes por certificado. </font><font style="vertical-align: inherit;">Portanto, se algo n√£o funcionar, veja - talvez o limite seja atingido. </font><font style="vertical-align: inherit;">Vamos criptografar possui um bom relat√≥rio de erros, e geralmente voc√™ pode entender o que aconteceu.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qual √© o pr√≥ximo?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, depois que o certificado √© recebido, o servidor transmite os dados da chave da sess√£o - √© isso que ser√° usado para criptografia. </font><font style="vertical-align: inherit;">Se o servidor considerar que √© necess√°rio autenticar o cliente (por exemplo, o acesso √© aberto apenas para um certo c√≠rculo de pessoas), ele poder√° perguntar: o cliente, quem √© voc√™? </font><font style="vertical-align: inherit;">E ent√£o o cliente precisar√° enviar seu certificado. </font><font style="vertical-align: inherit;">Depois de receber a mensagem </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerHelloDone, o</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cliente percebe que √© hora de verificar os certificados e trabalhar com as chaves. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo sobre o que falamos, antes do TLS 1.3 passar por um canal aberto, e qualquer um pode ver todas essas coisas. </font><font style="vertical-align: inherit;">Existem v√°rios ataques interessantes que voc√™ pode ler sobre si mesmo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na segunda </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s√©rie</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do artigo, aprenderemos como o cliente verifica o certificado.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt502588/index.html">A incr√≠vel hist√≥ria do PowerPoint</a></li>
<li><a href="../pt502592/index.html">Neomorfismo usando SwiftUI. Parte 1</a></li>
<li><a href="../pt502594/index.html">7 raz√µes pelas quais os projetos da web n√£o terminam e como lidar com isso</a></li>
<li><a href="../pt502596/index.html">Cursos educacionais em quarentena gratuitos: design</a></li>
<li><a href="../pt502598/index.html">Semana 21 de Seguran√ßa: Vulnerabilidade no Servi√ßo de Impress√£o do Windows</a></li>
<li><a href="../pt502608/index.html">Como come√ßamos o mercado de aplicativos no servi√ßo SaaS</a></li>
<li><a href="../pt502614/index.html">Melhores pr√°ticas do Kubernetes. Definindo consultas e limites de recursos</a></li>
<li><a href="../pt502620/index.html">Contabilidade de dinheiro</a></li>
<li><a href="../pt502624/index.html">Como eles funcionam no Facebook? Valores e contrata√ß√£o em uma empresa</a></li>
<li><a href="../pt502626/index.html">Capturas de tela autom√°ticas do iOS usando o XCTestplan e o Xcode 11</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>