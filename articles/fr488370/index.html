<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëåüèø üéÄ üë©üèæ‚Äçü§ù‚Äçüë©üèΩ TDD pour microcontr√¥leurs. Partie 2: Comment les espions se d√©barrassent des d√©pendances üò∑ üóûÔ∏è üõ∂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TDD pour microcontr√¥leurs. Partie 1: Premier vol 
 TDD pour microcontr√¥leurs. Partie 2: Comment les espions se d√©barrassent des d√©pendances 
 TDD pour...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>TDD pour microcontr√¥leurs. Partie 2: Comment les espions se d√©barrassent des d√©pendances</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ntc-vulkan/blog/488370/"><blockquote><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TDD pour microcontr√¥leurs. </font><font style="vertical-align: inherit;">Partie 1: Premier vol </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TDD pour microcontr√¥leurs. </font><font style="vertical-align: inherit;">Partie 2: Comment les espions se d√©barrassent des d√©pendances </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TDD pour les microcontr√¥leurs. </font><font style="vertical-align: inherit;">Partie 3: courir sur du fer</font></font></a></blockquote><br>
<img src="https://habrastorage.org/webt/p1/k-/mc/p1k-mctbmhox1gyfp0fklpao-eu.png"><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  </a>        TDD   ( ‚Äì )      STM32.   :</p><br>
<ol>
<li>    .</li>
<li> IDE     .</li>
<li> -   .</li>
<li>      .</li>
</ol><br>
<p>   ,     TDD     -        .                 .      -       TDD    .  ‚Äì  .</p><a name="habracut"></a><br>
<h4 id="test-list">-</h4><br>
<p> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  </a>: </p><br>
<p><em>1.    <strong>read</strong>  ,      -.</em><br>
<em>2.    <strong>write</strong></em> <em>       -.</em><br>
<em>3.    <strong>erase</strong></em> <em>     .</em><br>
<em>4.    <strong>help</strong></em> <em>   .</em><br>
<em>5.   <strong></strong>     .</em> </p><br>
<p>        CppUTest.</p><br>
<h4 id="celi-proekta"> </h4><br>
<p>  ‚Äì        : ,       -   UART-.     UART-      ASCII.         - .          -:        .</p><br>
<p>   ‚Äì      TDD    .      ,          (     ).        .</p><br>
<h4 id="test-dlya-komandy-help">   <em>help</em></h4><br>
<p>    ‚Äì  ‚Ññ 4   <strong>help</strong>.   <strong>help</strong>           UART-. </p><br>
<p>             UART: </p><br>
<ol>
<li>   .</li>
<li> .</li>
<li>   . </li>
</ol><br>
<p>P.S.      .</p><br>
<p>  , -             :    <code>Configurator</code>. </p><br>
<p>         <code>Serial</code>,             (   ‚Äì <em>STM32F103C8T6</em>).         ,        <code>SerialSpy</code>.</p><br>
<p>    <strong>help</strong>:</p><br>
<pre><code class="cpp hljs">TEST(Configurator, ShouldHandleHelpCommand)<font></font>
{<font></font>
   <span class="hljs-comment">// Arrange ‚Äì         UART</span>
   <span class="hljs-keyword">char</span> helpCommand[] = <span class="hljs-string">"help\r\n"</span>;<font></font>
   LONGS_EQUAL(OK, SerialSpy_SetReceiveBuffer(serial, helpCommand, <span class="hljs-keyword">sizeof</span>(helpCommand)));<font></font>
<font></font>
   <span class="hljs-comment">// Act ‚Äì   </span><font></font>
   Status status = Configurator_Handler(configurator);<font></font>
<font></font>
   <span class="hljs-comment">// Assert ‚Äì   </span><font></font>
   LONGS_EQUAL(OK, status);<font></font>
   <span class="hljs-comment">//  ,      UART</span>
   <span class="hljs-keyword">char</span> * sendBufferPtr = <span class="hljs-literal">NULL</span>;<font></font>
   LONGS_EQUAL(OK, SerialSpy_GetSendBuffer(serial, &amp;sendBufferPtr));<font></font>
   STRCMP_EQUAL(HELP_OUTPUT, sendBufferPtr);<font></font>
}</code></pre><br>
<p> : </p><br>
<ul>
<li>  <em>Arrange</em>       UART    <code>SerialSpy</code>,    <code>SerialSpy_SetReceiveBuffer</code>; </li>
<li>  <em>Act</em>   <code>Configurator_Handler</code>,       ,      UART.         UART; </li>
<li>  <em>Assert</em>     .            <code>SerialSpy_GetSendBuffer</code>,      <code>STRCMP_EQUAL</code>   <code>HELP_OUTPUT</code>     . </li>
</ul><br>
<p> ,     : <code>SerialSpy_SetReceiveBuffer</code>, <code>Configurator_Handler</code>  <code>SerialSpy_GetSendBuffer</code>.     <em>test fails</em>       ().   <code>Configurator_Handler</code>    <code>Configurator</code>     . </p><br>
<p> <code>SerialSpy_SetReceiveBuffer</code>  <code>SerialSpy_GetSendBuffer</code>     ,            .     ,         ,    ,          . </p><br>
<p>  <code>SerialSpy</code>,       <code>Configurator</code>   <code>Serial</code>.   <code>SerialSpy.h</code>   ,   <code>SerialSpy.c</code> ‚Äì   .  ,  ,        .    <code>SerialSpy</code>    :</p><br>
<p>‚Ä¢<code>receiveBuffer</code>       UART;<br>
‚Ä¢<code>sendBuffer</code>       UART.</p><br>
<p>           <code>Configurator_Handler</code>:        ,     .        :</p><br>
<p>‚Ä¢ <code>SerialSpy_SetReceiveBuffer</code>    ;<br>
‚Ä¢ <code>SerialSpy_GetSendBuffer</code>       ,    . </p><br>
<div class="spoiler"><b class="spoiler_title">  Configurator_Handler  SerialSpy</b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-comment">// Common.h</span>
<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">enum</span><font></font>
{<font></font>
    OK = <span class="hljs-number">0</span>,<font></font>
    FAIL = <span class="hljs-number">-1</span>,<font></font>
    INVALID_PARAMETERS = <span class="hljs-number">-4</span>,<font></font>
    OUT_OF_BOUNDS = <span class="hljs-number">-13</span>,<font></font>
} Status;<font></font>
<font></font>
<span class="hljs-comment">// Configurator.h</span>
<span class="hljs-function">Status <span class="hljs-title">Configurator_Handler</span><span class="hljs-params">(Configurator * self)</span></span>;<font></font>
<font></font>
<span class="hljs-comment">// Configurator.c</span>
<span class="hljs-function">Status <span class="hljs-title">Configurator_Handler</span><span class="hljs-params">(Configurator * self)</span>
</span>{<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// SerialSpy.h</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"Common.h"</span></span><font></font>
<font></font>
<span class="hljs-function">Status <span class="hljs-title">SerialSpy_SetReceiveBuffer</span><span class="hljs-params">(Serial * self, <span class="hljs-keyword">char</span> * data, <span class="hljs-keyword">uint32_t</span> len)</span></span>;
<span class="hljs-function">Status <span class="hljs-title">SerialSpy_GetSendBuffer</span><span class="hljs-params">(Serial * self, <span class="hljs-keyword">char</span> ** bufferPtr)</span></span>;<font></font>
<font></font>
<span class="hljs-comment">//SerialSpy.c</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"SerialSpy.h"</span></span><font></font>
<font></font>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SerialStruct</span>
{</span>
    <span class="hljs-keyword">char</span> receiveBuffer[SERIAL_RECEIVE_BUFFER_SIZE];
    <span class="hljs-keyword">char</span> sendBuffer[SERIAL_SEND_BUFFER_SIZE];<font></font>
} SerialStruct;<font></font>
<font></font>
<span class="hljs-function">Serial * <span class="hljs-title">Serial_Create</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{<font></font>
    Serial * self = (Serial*)<span class="hljs-built_in">calloc</span>(<span class="hljs-number">1</span>, <span class="hljs-keyword">sizeof</span>(SerialStruct));
    <span class="hljs-keyword">return</span> self;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Serial_Destroy</span><span class="hljs-params">(Serial * self)</span>
</span>{
    <span class="hljs-keyword">if</span> (self == <span class="hljs-literal">NULL</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span>;<font></font>
    }<font></font>
    <span class="hljs-built_in">free</span>(self);<font></font>
    self = <span class="hljs-literal">NULL</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function">Status <span class="hljs-title">SerialSpy_SetReceiveBuffer</span><span class="hljs-params">(Serial * self, <span class="hljs-keyword">char</span> * data, <span class="hljs-keyword">uint32_t</span> len)</span>
</span>{
    <span class="hljs-keyword">if</span> (self == <span class="hljs-literal">NULL</span> || data == <span class="hljs-literal">NULL</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> INVALID_PARAMETERS;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> (len &gt; SERIAL_RECEIVE_BUFFER_SIZE)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> OUT_OF_BOUNDS;<font></font>
    }<font></font>
    <span class="hljs-built_in">memcpy</span>(self-&gt;receiveBuffer, data, len);
    <span class="hljs-keyword">return</span> OK;<font></font>
}<font></font>
<font></font>
<span class="hljs-function">Status <span class="hljs-title">SerialSpy_GetSendBuffer</span><span class="hljs-params">(Serial * self, <span class="hljs-keyword">char</span> ** bufferPtr)</span>
</span>{
    <span class="hljs-keyword">if</span> (self == <span class="hljs-literal">NULL</span> || bufferPtr == <span class="hljs-literal">NULL</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> INVALID_PARAMETERS;<font></font>
    }<font></font>
    *bufferPtr = self-&gt;sendBuffer;<font></font>
    <span class="hljs-keyword">return</span> OK;<font></font>
}<font></font>
</code></pre></div></div><br>
<p> ,  <code>SerialSpy</code>    UART.      TDD  unit-         .       .       <code>Configurator</code>           STM32.      ,       -,     ¬´¬ª  Visual Studio   . </p><br>
<h4 id="iz-test-fails-v-test-passes"> test-fails  test-passes</h4><br>
<p>   <em>test-passes</em>     <code>Configurator_Handler</code>.                  UART <code>Serial_ReceiveCommand</code>          .   <em>help</em>  ,      <code>help</code>,         <code>Serial_SendResponse</code>.</p><br>
<p>    <code>Configurator</code>  UART    <code>Serial</code>,        Serial,    <code>Configurator_Create</code> ‚Äì  <code>Serial*</code>.      <code>setup()</code>  <code>teardown()</code>     . </p><br>
<div class="spoiler"><b class="spoiler_title">     help</b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-comment">// Configurator.h</span>
<span class="hljs-comment">//    `help`     `Serial`</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"Serial.h"</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> HELP_OUTPUT \
<span class="hljs-meta-string">"Command list:\r\n \
    - help\r\n \
    - read:  &lt;flash_address_in_hex&gt;\r\n \
    - write: &lt;flash_address_in_hex&gt; &lt;data_to_write&gt;\r\n \
    - erase: &lt;flash_page_number_to_erase&gt;\r\n&gt;"</span></span><font></font>
<font></font>
<span class="hljs-function">Configurator * <span class="hljs-title">Configurator_Create</span><span class="hljs-params">(Serial * serial)</span></span>;<font></font>
<font></font>
<span class="hljs-comment">// Configurator.c</span>
<span class="hljs-comment">//       UART  Serial  Configurator</span>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ConfiguratorStruct</span>
{</span>
    <span class="hljs-keyword">char</span> command[SERIAL_RECEIVE_BUFFER_SIZE];<font></font>
    Serial * serial;<font></font>
} ConfiguratorStruct;<font></font>
<font></font>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> helpCommand[] = <span class="hljs-string">"help"</span>;<font></font>
<font></font>
<span class="hljs-comment">//   Serial   (    )</span>
<span class="hljs-function">Configurator * <span class="hljs-title">Configurator_Create</span><span class="hljs-params">(Serial * serial)</span>
</span>{
    <span class="hljs-keyword">if</span> (serial == <span class="hljs-literal">NULL</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<font></font>
    }<font></font>
    Configurator * self = (Configurator*)<span class="hljs-built_in">calloc</span>(<span class="hljs-number">1</span>, <span class="hljs-keyword">sizeof</span>(ConfiguratorStruct));
    <span class="hljs-keyword">if</span> (self == <span class="hljs-literal">NULL</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<font></font>
    }<font></font>
    self-&gt;serial = serial;<font></font>
    <span class="hljs-keyword">return</span> self;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//    Configurator_Handler</span>
<span class="hljs-function">Status <span class="hljs-title">Configurator_Handler</span><span class="hljs-params">(Configurator * self)</span>
</span>{
    <span class="hljs-keyword">if</span> (self == <span class="hljs-literal">NULL</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> INVALID_PARAMETERS;<font></font>
    }<font></font>
    <span class="hljs-comment">//      UART</span><font></font>
    Status status = Serial_ReceiveCommand(self-&gt;serial, self-&gt;command);<font></font>
    <span class="hljs-keyword">if</span> (status != OK)<font></font>
    {<font></font>
        <span class="hljs-comment">//    UART   NO_DATA</span>
        <span class="hljs-keyword">return</span> status;<font></font>
    }<font></font>
    <span class="hljs-comment">//   </span>
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strstr</span>(self-&gt;command, helpCommand) == <span class="hljs-literal">NULL</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> UNSUPPORTED;<font></font>
    }<font></font>
    Status status = Serial_SendResponse(self-&gt;serial, HELP_OUTPUT);<font></font>
    <span class="hljs-keyword">return</span> status;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// ConfiguratorTests.cpp</span><font></font>
TEST_GROUP(Configurator)<font></font>
{<font></font>
    Configurator * configurator = <span class="hljs-literal">NULL</span>;<font></font>
    Serial * serial = <span class="hljs-literal">NULL</span>;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
    </span>{<font></font>
        serial = Serial_Create();<font></font>
        configurator = Configurator_Create(serial);<font></font>
    }<font></font>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">teardown</span><span class="hljs-params">()</span>
    </span>{<font></font>
        Configurator_Destroy(configurator);<font></font>
    }<font></font>
};  </code></pre></div></div><br>
<p>            <code>Serial</code>, . .     <code>Configurator_Handler</code>.     <code>SerialSpy</code>,          .  <code>SerialSpy.c</code>   <code>Serial.c</code>           ‚Äì <code>Serial.h</code>:</p><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> once</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"Common.h"</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SERIAL_RECEIVE_BUFFER_SIZE   32   <span class="hljs-comment">//    </span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SERIAL_SEND_BUFFER_SIZE     256   <span class="hljs-comment">//     </span></span><font></font>
<font></font>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SerialStruct</span> <span class="hljs-title">Serial</span>;</span><font></font>
<font></font>
<span class="hljs-function">Serial * <span class="hljs-title">Serial_Create</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Serial_Destroy</span><span class="hljs-params">(Serial * self)</span></span>;<font></font>
<font></font>
<span class="hljs-comment">//       UART</span>
<span class="hljs-comment">//  self ‚Äì     Serial</span>
<span class="hljs-comment">//  commandPtr ‚Äì   ,       </span>
<span class="hljs-comment">//  :</span>
<span class="hljs-comment">//  OK ‚Äì       </span>
<span class="hljs-comment">//  NO_DATA ‚Äì      </span>
 <span class="hljs-function">Status <span class="hljs-title">Serial_ReceiveCommand</span><span class="hljs-params">(Serial * self, <span class="hljs-keyword">char</span> * commandPtr)</span></span>;<font></font>
<font></font>
<span class="hljs-comment">//    UART</span>
<span class="hljs-comment">//  self ‚Äì     Serial</span>
<span class="hljs-comment">//  responsePtr ‚Äì     </span>
<span class="hljs-comment">//  :</span>
<span class="hljs-comment">//  OK ‚Äì    ,  ‚Äì FAIL</span>
<span class="hljs-function">Status <span class="hljs-title">Serial_SendResponse</span><span class="hljs-params">(Serial * self, <span class="hljs-keyword">char</span> * responsePtr)</span></span>;<font></font>
<font></font>
<span class="hljs-comment">//    UART</span>
<span class="hljs-comment">//  self ‚Äì     Serial</span>
<span class="hljs-comment">//  :</span>
<span class="hljs-comment">//  OK ‚Äì    ,  ‚Äì FAIL</span>
<span class="hljs-function">Status <span class="hljs-title">Serial_Clear</span><span class="hljs-params">(Serial * self)</span></span>;
</code></pre><br>
<p>   <code>Serial.h</code>   <em>ProductionCodeLib</em>.   <em>Tests</em>   <code>SerialSpy.c</code>      <code>Serial_ReceiveCommand</code>  <code>Serial_SendResponse</code>,      UART       . </p><br>
<div class="spoiler"><b class="spoiler_title">  /  SerialSpy.c</b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-comment">// ... some code</span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">IsEndOfString</span><span class="hljs-params">(<span class="hljs-keyword">char</span> * buffer)</span>
</span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; SERIAL_RECEIVE_BUFFER_SIZE; i++)<font></font>
    {<font></font>
        <span class="hljs-keyword">if</span> (buffer[i] == <span class="hljs-string">'\n'</span>)<font></font>
        {<font></font>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
        }<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function">Status <span class="hljs-title">Serial_ReceiveCommand</span><span class="hljs-params">(Serial * self, <span class="hljs-keyword">char</span> * commandPtr)</span>
</span>{
    <span class="hljs-keyword">if</span> (self == <span class="hljs-literal">NULL</span> || commandPtr == <span class="hljs-literal">NULL</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> INVALID_PARAMETERS;<font></font>
    }<font></font>
    <span class="hljs-comment">//       UART</span>
    <span class="hljs-keyword">uint32_t</span> commandLen = <span class="hljs-built_in">strlen</span>(self-&gt;receiveBuffer);
    <span class="hljs-keyword">if</span> (commandLen == <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> NO_DATA;<font></font>
    }<font></font>
    <span class="hljs-comment">//      `\n`</span>
    <span class="hljs-keyword">bool</span> isEndOfString = IsEndOfString(self-&gt;receiveBuffer);
    <span class="hljs-keyword">if</span> (isEndOfString == <span class="hljs-literal">false</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> NO_DATA;<font></font>
    }<font></font>
    <span class="hljs-comment">//        `\n`       UART</span>
    <span class="hljs-built_in">strncpy</span>(commandPtr, self-&gt;receiveBuffer, commandLen);<font></font>
    self-&gt;receiveBuffer[SERIAL_RECEIVE_BUFFER_SIZE ‚Äì <span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">return</span> OK;<font></font>
}<font></font>
<font></font>
<span class="hljs-function">Status <span class="hljs-title">Serial_SendResponse</span><span class="hljs-params">(Serial * self, <span class="hljs-keyword">char</span> * responsePtr)</span>
</span>{
    <span class="hljs-keyword">if</span> (self == <span class="hljs-literal">NULL</span> || responsePtr == <span class="hljs-literal">NULL</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> INVALID_PARAMETERS;<font></font>
    }<font></font>
    <span class="hljs-comment">//     </span>
    <span class="hljs-keyword">uint32_t</span> responseLen = <span class="hljs-built_in">strlen</span>(responsePtr);
    <span class="hljs-keyword">if</span> (responseLen &gt; SERIAL_SEND_BUFFER_SIZE)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> OUT_OF_BOUNDS;<font></font>
    }<font></font>
    <span class="hljs-comment">//      </span>
    <span class="hljs-built_in">strncpy</span>(self-&gt;sendBuffer, responsePtr, responseLen);<font></font>
    self-&gt;sendBuffer[SERIAL_SEND_BUFFER_SIZE ‚Äì <span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">return</span> OK;<font></font>
}<font></font>
<span class="hljs-comment">// ... some code</span></code></pre></div></div><br>
<p>     /  <code>SerialSpy.c</code>     .     UART     :</p><br>
<ul>
<li>  ‚Äì         <code>strncpy</code>;</li>
<li>  ‚Äì       <code>strlen</code>      ( <code>\n</code>).         <code>strncpy</code>    ,    . </li>
</ul><br>
<p>       :</p><br>
<pre><code class="plaintext hljs">..<font></font>
OK (2 tests, 2 ran, 5 checks, 0 ignored, 0 filtered out, 0 ms)</code></pre><br>
<p>  <strong>help</strong> ,    .     <em>test-passes</em>.    <em>refactor</em>.</p><br>
<h4 id="faza-refactor"> refactor</h4><br>
<p>     ,     .     , :   ,      .      :             . </p><br>
<p>    ,     ,      .     - ¬´¬ª,    .         ,              . </p><br>
<p>        <code>Configurator_Handler</code>   <code>static</code>  <code>HandleCommand</code>.     :          (       <code>help</code>). </p><br>
<div class="spoiler"><b class="spoiler_title">     </b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-comment">// Configurator.c</span>
<span class="hljs-function"><span class="hljs-keyword">static</span> Status <span class="hljs-title">HandleHelpCommand</span><span class="hljs-params">(Configurator * self)</span>
</span>{
    <span class="hljs-keyword">if</span> (self == <span class="hljs-literal">NULL</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> INVALID_PARAMETERS;<font></font>
    }<font></font>
    Status status = Serial_SendResponse(self-&gt;serial, HELP_OUTPUT);<font></font>
    <span class="hljs-keyword">return</span> status;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> Status <span class="hljs-title">HandleCommand</span><span class="hljs-params">(Configurator * self)</span>
</span>{
    <span class="hljs-keyword">if</span> (self == <span class="hljs-literal">NULL</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> INVALID_PARAMETERS;<font></font>
    }<font></font>
    <span class="hljs-comment">//   help</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strstr</span>(self-&gt;command, helpCommand) != <span class="hljs-literal">NULL</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> HandleHelpCommand(self);<font></font>
    }<font></font>
    <span class="hljs-comment">//   </span>
    <span class="hljs-keyword">return</span> UNSUPPORTED;<font></font>
}<font></font>
<font></font>
<span class="hljs-function">Status <span class="hljs-title">Configurator_Handler</span><span class="hljs-params">(Configurator * self)</span>
</span>{
    <span class="hljs-keyword">if</span> (self == <span class="hljs-literal">NULL</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> INVALID_PARAMETERS;<font></font>
    }<font></font>
    <span class="hljs-comment">//      UART</span><font></font>
    Status status = Serial_ReceiveCommand(self-&gt;serial, self-&gt;command);<font></font>
    <span class="hljs-keyword">if</span> (status != OK)<font></font>
    {<font></font>
        <span class="hljs-comment">//    UART   NO_DATA</span>
        <span class="hljs-keyword">return</span> status;<font></font>
    }<font></font>
    <span class="hljs-comment">//   </span><font></font>
    status = HandleCommand(self);<font></font>
    <span class="hljs-keyword">if</span>(status != OK)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> status;<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> status;<font></font>
}  <font></font>
</code></pre></div></div><br>
<p>      <em>refactor</em>,       <em>fails-passes-refactor</em>. </p><br>
<p>   <code>Configurator_Handler</code>    :</p><br>
<p>‚Ä¢ <code>read</code> ‚Äì  -;<br>
‚Ä¢ <code>write</code> ‚Äì  -;<br>
‚Ä¢ <code>erase</code> ‚Äì  -. </p><br>
<p>     ,    ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><em>gitlab</em></a>. </p><br>
<p>             -.</p><br>
<h4 id="test-dlya-komandy-zapisi-vo-flesh-pamyat">     -</h4><br>
<p>         <code>FlashSpy</code>     <code>Configurator</code>     .       <strong>write</strong>  :</p><br>
<p><code>write: &lt;flash_address_in_hex&gt; &lt;data_to_write&gt;\r\n</code></p><br>
<p>    <strong>write</strong>:</p><br>
<pre><code class="cpp hljs">TEST(Configurator, ShouldHandleWriteFlashCommand)<font></font>
{<font></font>
    <span class="hljs-comment">// Arrange</span>
    <span class="hljs-comment">//      write</span>
    <span class="hljs-keyword">uint32_t</span> expectedFlashData = <span class="hljs-number">0x11223344</span>;
    <span class="hljs-comment">//         UART</span>
    <span class="hljs-keyword">char</span> writeFlashCommand[] = <span class="hljs-string">"write: 0x10000 0x11223344\r\n"</span>;<font></font>
    LONGS_EQUAL(OK, SerialSpy_SetReceiveBuffer(serial, writeFlashCommand, <span class="hljs-keyword">sizeof</span>(writeFlashCommand)));<font></font>
<font></font>
    <span class="hljs-comment">// Act</span><font></font>
    Status status = Configurator_Handler(configurator);<font></font>
<font></font>
    <span class="hljs-comment">// Assert</span>
    <span class="hljs-comment">//  </span><font></font>
    LONGS_EQUAL(OK, status);<font></font>
    <span class="hljs-comment">//  ,   -</span>
    <span class="hljs-keyword">uint32_t</span> * flashPtr = <span class="hljs-literal">NULL</span>;<font></font>
    LONGS_EQUAL(OK, FlashSpy_GetFlashPtr(&amp;flashPtr, <span class="hljs-number">0x10000</span>));<font></font>
    LONGS_EQUAL(expectedFlashData, *flashPtr);<font></font>
}</code></pre><br>
<p>       4 . ,      - .        <code>Flash.h</code>:</p><br>
<pre><code class="cpp hljs"><span class="hljs-comment">// Flash.h</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> once</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"Common.h"</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FLASH_PAGE_COUNT    0x80</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FLASH_PAGE_SIZE     0x400</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FLASH_SIZE          FLASH_PAGE_COUNT * FLASH_PAGE_SIZE   <span class="hljs-comment">// 128 Kb</span></span><font></font>
<font></font>
<span class="hljs-function">Status <span class="hljs-title">Flash_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;
<span class="hljs-function">Status <span class="hljs-title">Flash_DeInit</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<font></font>
<font></font>
<span class="hljs-function">Status <span class="hljs-title">Flash_Write</span><span class="hljs-params">(<span class="hljs-keyword">uint32_t</span> address, <span class="hljs-keyword">uint32_t</span> data)</span></span>;
<span class="hljs-function">Status <span class="hljs-title">Flash_Read</span><span class="hljs-params">(<span class="hljs-keyword">uint32_t</span> address, <span class="hljs-keyword">uint32_t</span> * dataPtr)</span></span>;
<span class="hljs-function">Status <span class="hljs-title">Flash_Erase</span><span class="hljs-params">(<span class="hljs-keyword">uint8_t</span> pageNumber)</span></span>;</code></pre><br>
<p>          <code>Flash.h</code>  <code>FlashSpy.c</code>  : -      <code>uint8_t flash[FLASH_SIZE]</code>,  <code>FLASH_SIZE</code>       .      -        <code>FLASH_SIZE</code>,       <code>Flash_Read</code>,    <code>Flash_Write</code>      <code>Flash_Erase</code>.</p><br>
<p>  <code>FlashSpy.c</code>   <em>Tests</em>        <code>FlashSpy_GetFlashPtr</code>         <code>address</code> .         . </p><br>
<p>         , , ,    -   <em>FlashSpy.c</em>.         <code>flashMemory</code> (    -   STM32F103C8):</p><br>
<ul>
<li><code>Flash_Read</code>      32 ,       <code>flashMemory</code>. </li>
<li><code>Flash_Write</code>      32      <code>flashMemory</code>. </li>
<li><code>Flash_Erase</code>    <code>flashMemory</code>      STM32F103C8  0xFF   <code>memset</code>. </li>
</ul><br>
<p>       -   <code>Configurator</code>. </p><br>
<div class="spoiler"><b class="spoiler_title">  , ,      `FlashSpy`</b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-comment">// FlashSpy.h</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> once</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"Flash.h"</span></span>
<span class="hljs-function">Status <span class="hljs-title">FlashSpy_GetFlashPtr</span><span class="hljs-params">(<span class="hljs-keyword">uint32_t</span> ** flashMemoryPtr, <span class="hljs-keyword">uint32_t</span> address)</span></span>;<font></font>
<font></font>
<span class="hljs-comment">// FlashSpy.c</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">uint8_t</span> * flashMemory = <span class="hljs-literal">NULL</span>;<font></font>
<font></font>
<span class="hljs-comment">// -</span>
<span class="hljs-function">Status <span class="hljs-title">FlashSpy_GetFlashPtr</span><span class="hljs-params">(<span class="hljs-keyword">uint32_t</span> ** flashMemoryPtr, <span class="hljs-keyword">uint32_t</span> address)</span>
</span>{
    <span class="hljs-keyword">if</span> (flashMemory == <span class="hljs-literal">NULL</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> WRONG_CONDITION;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> (flashMemoryPtr == <span class="hljs-literal">NULL</span> || address &gt;= FLASH_SIZE)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> INVALID_PARAMETERS;<font></font>
    }<font></font>
    *flashMemoryPtr = (<span class="hljs-keyword">uint32_t</span>*)&amp;flashMemory[address];
    <span class="hljs-keyword">return</span> OK;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//     </span>
<span class="hljs-function">Status <span class="hljs-title">Flash_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{<font></font>
    flashMemory = (<span class="hljs-keyword">uint8_t</span>*)<span class="hljs-built_in">malloc</span>(FLASH_SIZE);
    <span class="hljs-keyword">if</span> (flashMemory == <span class="hljs-literal">NULL</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> FAIL;<font></font>
    }<font></font>
    <span class="hljs-comment">// ,  -   (   0b1)</span>
    <span class="hljs-built_in">memset</span>(flashMemory, <span class="hljs-number">0xFF</span>, FLASH_SIZE);
    <span class="hljs-keyword">return</span> OK;<font></font>
}<font></font>
<font></font>
<span class="hljs-function">Status <span class="hljs-title">Flash_DeInit</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{
    <span class="hljs-keyword">if</span> (flashMemory == <span class="hljs-literal">NULL</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> OK;<font></font>
    }<font></font>
    <span class="hljs-built_in">free</span>(flashMemory);<font></font>
    flashMemory = <span class="hljs-literal">NULL</span>;
    <span class="hljs-keyword">return</span> OK;<font></font>
}<font></font>
<font></font>
<span class="hljs-function">Status <span class="hljs-title">Flash_Write</span><span class="hljs-params">(<span class="hljs-keyword">uint32_t</span> address, <span class="hljs-keyword">uint32_t</span> data)</span>
</span>{
    <span class="hljs-keyword">if</span> (flashMemory == <span class="hljs-literal">NULL</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> WRONG_CONDITION;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> (address &gt;= FLASH_SIZE)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> INVALID_PARAMETERS;<font></font>
    }<font></font>
    <span class="hljs-comment">//   :  0b1  0b0,      Flash_Erase</span>
    *(<span class="hljs-keyword">uint32_t</span>*)(flashMemory + address) &amp;= data;
    <span class="hljs-keyword">return</span> OK;<font></font>
}<font></font>
<font></font>
<span class="hljs-function">Status <span class="hljs-title">Flash_Read</span><span class="hljs-params">(<span class="hljs-keyword">uint32_t</span> address, <span class="hljs-keyword">uint32_t</span> * dataPtr)</span>
</span>{
    <span class="hljs-keyword">if</span> (flashMemory == <span class="hljs-literal">NULL</span> || dataPtr == <span class="hljs-literal">NULL</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> WRONG_CONDITION;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> (address &gt;= FLASH_SIZE)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> INVALID_PARAMETERS;<font></font>
    }<font></font>
    *dataPtr = *(<span class="hljs-keyword">uint32_t</span>*)(flashMemory + address);
    <span class="hljs-keyword">return</span> OK;<font></font>
}<font></font>
<font></font>
<span class="hljs-function">Status <span class="hljs-title">Flash_Erase</span><span class="hljs-params">(<span class="hljs-keyword">uint8_t</span> pageNumber)</span>
</span>{
    <span class="hljs-keyword">if</span> (flashMemory == <span class="hljs-literal">NULL</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> WRONG_CONDITION;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> (pageNumber &gt;= FLASH_PAGE_COUNT)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> INVALID_PARAMETERS;<font></font>
    }<font></font>
    <span class="hljs-keyword">uint32_t</span> offset = pageNumber * FLASH_PAGE_SIZE;
    <span class="hljs-built_in">memset</span>(flashMemory + offset, <span class="hljs-number">0xFF</span>, FLASH_PAGE_SIZE);
    <span class="hljs-keyword">return</span> OK;<font></font>
}</code></pre></div></div><br>
<p>  <code>Flash_Write</code>        ¬´¬ª,            - (       0b1). </p><br>
<p>  <em></em>  <em></em> -    <code>setup()</code>  <code>teardown()</code>   <em>ConfiguratorTests.cpp</em>.</p><br>
<div class="spoiler"><b class="spoiler_title">    Flash  </b><div class="spoiler_text"><pre><code class="cpp hljs">TEST_GROUP(Configurator)<font></font>
{<font></font>
    Configurator * configurator = <span class="hljs-literal">NULL</span>;<font></font>
    Serial * serial = <span class="hljs-literal">NULL</span>;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
    </span>{<font></font>
        serial = Serial_Create();<font></font>
        configurator = Configurator_Create(serial);<font></font>
        Flash_Init();<font></font>
    }<font></font>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">teardown</span><span class="hljs-params">()</span>
    </span>{<font></font>
        Configurator_Destroy(configurator);<font></font>
        Flash_DeInit();<font></font>
    }<font></font>
};</code></pre></div></div><br>
<p>        <code>UNSUPPORTED</code>, . .  <code>Configurator_Handler</code>    <strong>write</strong>.    <em>test fails</em>. </p><br>
<pre><code class="plaintext hljs">d:\exampletdd\tests\tests\configuratortests.cpp(66): error: Failure in TEST(Configurator, ShouldHandleWriteFlashCommand)<font></font>
          expected &lt; 0 0x00000000&gt;<font></font>
          but was  &lt;-9 0xfffffff7&gt;<font></font>
...<font></font>
Errors (1 failures, 3 tests, 3 ran, 8 checks, 0 ignored, 0 filtered out, 5 ms)</code></pre><br>
<p>    <em>test-passes</em>    <strong>write</strong>  <em>Configurator.c</em>.    <em>HandleWriteCommand</em>:</p><br>
<ul>
<li>  ,       32   ;</li>
<li>  (     -); </li>
<li>    -    <code>Flash_Write</code>;</li>
<li>          <code>Serial_SendResponse</code>.</li>
</ul><br>
<div class="spoiler"><b class="spoiler_title">  </b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-comment">// Configurator.c</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"Flash.h"</span></span>
<span class="hljs-comment">// ... some code</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LEN_MIN_ARG         sizeof(<span class="hljs-meta-string">"0x0"</span>)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LEN_WRITE_COMMAND   sizeof(writeCommand) + LEN_MIN_ARG + LEN_MIN_ARG</span>
<span class="hljs-comment">// ... some code</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> writeCommand[] = <span class="hljs-string">"write:"</span>;
<span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> writeResponse[] = <span class="hljs-string">"Written successfully\r\n&gt;"</span>;
<span class="hljs-comment">// ... some code</span>
<span class="hljs-function"><span class="hljs-keyword">static</span> Status <span class="hljs-title">HandleWriteCommand</span><span class="hljs-params">(Configurator * self)</span>
</span>{
    <span class="hljs-keyword">if</span> (self == <span class="hljs-literal">NULL</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> INVALID_PARAMETERS;<font></font>
    }<font></font>
    <span class="hljs-comment">//    </span>
    <span class="hljs-keyword">uint32_t</span> commandLen = <span class="hljs-built_in">strlen</span>(self-&gt;command);
    <span class="hljs-keyword">if</span> (commandLen &lt; LEN_WRITE_COMMAND)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> INVALID_PARAMETERS;<font></font>
    }<font></font>
    <span class="hljs-comment">//   -</span>
    <span class="hljs-keyword">char</span> * flashAddressPtr = self-&gt;command + <span class="hljs-keyword">sizeof</span>(writeCommand);
    <span class="hljs-keyword">uint32_t</span> flashAddress = strtol(flashAddressPtr, (<span class="hljs-keyword">char</span>**)<span class="hljs-literal">NULL</span>, <span class="hljs-number">16</span>);
    <span class="hljs-keyword">if</span> (flashAddress &gt; FLASH_SIZE)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> INVALID_PARAMETERS;<font></font>
    }<font></font>
    <span class="hljs-comment">//      -</span>
    <span class="hljs-keyword">char</span> * dataAddressPtr = <span class="hljs-built_in">strchr</span>(self-&gt;command + <span class="hljs-keyword">sizeof</span>(writeCommand), <span class="hljs-string">' '</span>);
    <span class="hljs-keyword">uint32_t</span> data = strtol(dataAddressPtr, (<span class="hljs-keyword">char</span>**)<span class="hljs-literal">NULL</span>, <span class="hljs-number">16</span>);
    <span class="hljs-comment">//   -</span><font></font>
    Status status = Flash_Write(flashAddress, data);<font></font>
    <span class="hljs-keyword">if</span> (status != OK)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> status;<font></font>
    }<font></font>
    <span class="hljs-comment">//      UART</span>
    status = Serial_SendResponse(self-&gt;serial, (<span class="hljs-keyword">char</span>*)writeResponse);
    <span class="hljs-keyword">return</span> status;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> Status <span class="hljs-title">HandleCommand</span><span class="hljs-params">(Configurator * self)</span>
</span>{
    <span class="hljs-keyword">if</span> (self == <span class="hljs-literal">NULL</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> INVALID_PARAMETERS;<font></font>
    }<font></font>
    <span class="hljs-comment">//  help</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strstr</span>(self-&gt;command, helpCommand) != <span class="hljs-literal">NULL</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> HandleHelpCommand(self);<font></font>
    }<font></font>
    <span class="hljs-comment">//  write</span>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strstr</span>(self-&gt;command, writeCommand) != <span class="hljs-literal">NULL</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> HandleWriteCommand(self);<font></font>
    }<font></font>
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">return</span> UNSUPPORTED;<font></font>
}</code></pre></div></div><br>
<p>        <em>test-passes</em>. </p><br>
<pre><code class="plaintext hljs">...<font></font>
OK (3 tests, 3 ran, 9 checks, 0 ignored, 0 filtered out, 0 ms)</code></pre><br>
<p>     <em>refactoring</em>,     .    <em></em>  <em></em> -  . </p><br>
<h4 id="vyvody"></h4><br>
<p> ,    -  .    5    - (     ).            . </p><br>
<div class="spoiler"><b class="spoiler_title">  </b><div class="spoiler_text"><img src="https://habrastorage.org/webt/it/ww/d5/itwwd5kpe0yxqfyskhdyns5uomo.png"></div></div><br>
<p>   TDD       -    .        .         ,    ,         .</p><br>
<p>   <code>Configurator</code>      <code>SerialSpy</code>  <code>FlashSpy</code>     UART   -.<br>
         -  ,             .        . </p><br>
<p>        , . .      ,            <code>Serial.h</code>  <code>Flash.h</code>. </p><br>
<p>,   ,      . ,     unit-    <code>ShouldHandleWriteFlashCommand</code>     .        ,       -  .           . </p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  </a>    <code>Serial.c</code>  <code>Flash.c</code>  STM32F103C8,     ,    ,   .     ¬´¬ª    , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">   </a>. </p><br>
<div class="spoiler"><b class="spoiler_title"> </b><div class="spoiler_text"><p><strong></strong></p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">TDD  .  1:  </a> </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">TDD  .  3:   </a></li>
<li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitLab</a> </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CppUTest</a> </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Visual Studio</a> </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">STM32CubeMX</a> </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Atollic TrueStudio</a> </li>
</ul><br>
<p><strong></strong> </p><br>
<ul>
<li>Test Driven Development for Embedded C, James Grenning </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">STM32F103C8 Programming manual</a> </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">STM32F103C8 Reference manual</a></li>
</ul></div></div><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/6d/ts/lv/6dtslv2uikkshhl7tmsi7fgjp0y.png"> </a> </p><br>
<p><em>Raccoon Security ‚Äì     ¬´¬ª     , , ,       .</em></p><cut></cut></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr488356/index.html">Formation √† l'Universit√© technique maritime de Saint-P√©tersbourg pour les produits Dassault Syst√®mes</a></li>
<li><a href="../fr488360/index.html">Mythes du Big Data et culture num√©rique</a></li>
<li><a href="../fr488362/index.html">Classification multi-tagu√©e</a></li>
<li><a href="../fr488366/index.html">Et encore une fois sur ¬´Informations de fuseau horaire incorrectes pour les fuseaux horaires russes¬ª [bogue .Net, ID: 693286]</a></li>
<li><a href="../fr488368/index.html">Ce que j'ai appris en travaillant sur mon premier projet √† grande √©chelle</a></li>
<li><a href="../fr488374/index.html">T√©l√©gramme + 1C + Webhooks + Apache + Certificat auto-sign√©</a></li>
<li><a href="../fr488376/index.html">Quand le principe "au diable tout, prenez-le et faites-le!" ne fonctionne pas: notes du procrastinateur</a></li>
<li><a href="../fr488378/index.html">En bref sur la d√©nomination dans JS</a></li>
<li><a href="../fr488380/index.html">Le d√©but le plus simple de la STM gr√¢ce √† ¬´un seul endroit¬ª</a></li>
<li><a href="../fr488382/index.html">J'ajoute un d√©lai de 3 √† 25 secondes aux sites que je visite</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>