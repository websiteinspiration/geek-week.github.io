<!doctype html>
<html class="no-js" lang="ar">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📼 🛠️ 👉 لماذا يهاجر Discord من الذهاب إلى الصدأ ⬆️ 💇🏿 💖</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="أصبحت Rust لغة من الدرجة الأولى في مجموعة واسعة من المجالات. نحن في Discord نستخدمه بنجاح على كل من الخادم والعميل. على سبيل المثال ، على جانب العميل ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>لماذا يهاجر Discord من الذهاب إلى الصدأ</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487116/"><img src="https://habrastorage.org/getpro/habr/post_images/84a/0f1/d61/84a0f1d6126d5fd59b9c708f19c84692.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
أصبحت Rust لغة من الدرجة الأولى في مجموعة واسعة من المجالات. </font><font style="vertical-align: inherit;">نحن في Discord نستخدمه بنجاح على كل من الخادم والعميل. </font><font style="vertical-align: inherit;">على سبيل المثال ، على جانب العميل في خط أنابيب ترميز الفيديو لـ Go Live ، وعلى جانب الخادم </font><font style="vertical-align: inherit;">لوظائف </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elixir NIF</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (الوظائف المنفذة الأصلية). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لقد قمنا مؤخرًا بتحسين أداء خدمة واحدة ، وإعادة كتابتها من Go إلى Rust. </font><font style="vertical-align: inherit;">تشرح هذه المقالة لماذا كان من المنطقي بالنسبة لنا إعادة كتابة الخدمة وكيف قمنا بها ومدى تحسين الإنتاجية.</font></font><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">قراءة خدمة تتبع الدولة (اقرأ الولايات)</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
تم بناء شركتنا حول منتج واحد ، لذلك دعونا نبدأ ببعض السياق ، ما نقلناه بالضبط من Go to Rust. هذه خدمة قراءة الولايات. مهمتها الوحيدة هي تتبع القنوات والرسائل التي تقرأها. يتم الوصول إلى "حالات القراءة" في كل مرة تتصل فيها ببرنامج Discord ، وفي كل مرة ترسل فيها رسالة ، وفي كل مرة تقرأ فيها الرسالة. باختصار ، تتم قراءة الحالات بشكل مستمر وهي على "مسار ساخن". نريد أن نتأكد من أن Discord سريع دائمًا ، لذا يجب أن يكون فحص الحالة سريعًا.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لم يستوف تنفيذ الخدمة على Go جميع المتطلبات. </font><font style="vertical-align: inherit;">في معظم الأحيان ، كان يعمل بسرعة ، ولكن كل بضع دقائق كانت هناك تأخيرات قوية ، ملحوظة للمستخدمين. </font><font style="vertical-align: inherit;">بعد فحص الموقف ، قررنا أن التأخيرات كانت بسبب السمات الرئيسية لـ Go: نموذج الذاكرة ومجمع القمامة (GC).</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">لماذا Go لا تلبي أهداف الأداء لدينا</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لتوضيح سبب عدم تلبية Go لأهداف الأداء لدينا ، نحتاج أولاً إلى مناقشة هياكل البيانات ، والقياس ، وأنماط الوصول ، وبنية الخدمة. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لتخزين معلومات الحالة ، نستخدم بنية بيانات تسمى: قراءة الحالة. هناك المليارات منهم في Discord: حالة واحدة لكل مستخدم لكل قناة. تحتوي كل ولاية على عدة عدادات ، والتي يجب تحديثها ذريًا وغالبًا ما يتم إعادة تعيينها إلى الصفر. على سبيل المثال ، أحد العدادات هو الرقم </font></font><code>@mention</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">في القناة. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لتحديث العداد الذري بسرعة ، يحتوي كل خادم قراءة حالات على ذاكرة التخزين المؤقت الأقل استخدامًا (LRU). تحتوي كل ذاكرة تخزين مؤقت على ملايين المستخدمين وعشرات الملايين من الدول. يتم تحديث ذاكرة التخزين المؤقت مئات الآلاف من المرات في الثانية.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
من أجل الأمان ، تتم مزامنة ذاكرة التخزين المؤقت مع مجموعة قاعدة بيانات كاساندرا. </font><font style="vertical-align: inherit;">عندما يتم دفع مفتاح من ذاكرة التخزين المؤقت ، نقوم بإدخال حالات هذا المستخدم في قاعدة البيانات. </font><font style="vertical-align: inherit;">في المستقبل ، نخطط لتحديث قاعدة البيانات في غضون 30 ثانية مع كل حالة تحديث. </font><font style="vertical-align: inherit;">هذا هو عشرات الآلاف من السجلات في قاعدة البيانات كل ثانية. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
يوضح الرسم البياني أدناه وقت الاستجابة وتحميل وحدة المعالجة المركزية في الفاصل الزمني الذروة لخدمة Go </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sup></a><a name="1_1"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">يمكن ملاحظة أن التأخير والانفجارات في الحمل على وحدة المعالجة المركزية تحدث كل دقيقتين تقريبًا.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/90d/37b/89f/90d37b89f25eab54420107e63c086c44.png"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">إذن من أين يأتي نمو التأخيرات كل دقيقتين؟</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في Go ، لا يتم تحرير الذاكرة على الفور عند دفع أحد المفاتيح من ذاكرة التخزين المؤقت. بدلاً من ذلك ، يعمل جامع القمامة بشكل دوري ويبحث عن أجزاء غير مستخدمة من الذاكرة. هذا عمل كثير يمكن أن يبطئ البرنامج. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
من المحتمل جدًا أن يكون التباطؤ الدوري لخدمتنا مرتبطًا بجمع القمامة. لكننا كتبنا كود Go فعال للغاية بأقل قدر من تخصيص الذاكرة. لا يجب ترك الكثير من القمامة. ما المشكلة؟ </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
أثناء البحث في شفرة مصدر Go ، علمنا أن Go تبدأ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">في</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> جمع القمامة </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">على الأقل كل دقيقتين</font></a><font style="vertical-align: inherit;"> . بغض النظر عن حجم الكومة ، إذا لم يبدأ GC لمدة دقيقتين ، فإن Go سيجبره على البدء.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
قررنا أنه إذا قمت بتشغيل GC في كثير من الأحيان ، يمكنك تجنب هذه القمم بتأخيرات كبيرة ، لذلك قمنا بتعيين نقطة نهاية في الخدمة لتغيير قيمة </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GC المئوية</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> على الطاير </font><font style="vertical-align: inherit;">. لسوء الحظ ، لم يؤثر تكوين GC نسبة مئوية على أي شيء. كيف يمكن حصول هذا؟ اتضح أن GC لم تكن ترغب في البدء في كثير من الأحيان ، لأننا لم نخصص ذاكرة كافية في كثير من الأحيان.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
بدأنا في الحفر أكثر. اتضح أن مثل هذه التأخيرات الكبيرة لا تحدث بسبب الكم الهائل من الذاكرة المحررة ، ولكن لأن جامع القمامة يقوم بمسح ذاكرة التخزين المؤقت LRU بالكامل لفحص كل الذاكرة. ثم قررنا أنه إذا قللنا ذاكرة التخزين المؤقت LRU ، فسوف ينخفض ​​حجم المسح. لذلك ، أضفنا معلمة أخرى إلى الخدمة لتغيير حجم ذاكرة التخزين المؤقت LRU ، وقمنا بتغيير البنية ، مما أدى إلى تقسيم LRU إلى العديد من ذاكرة التخزين المؤقت المنفصلة على كل خادم. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
وهكذا حدث. مع مخابئ أصغر ، يتم تقليل تأخيرات الذروة. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لسوء الحظ ، أدى الحل الوسط مع انخفاض ذاكرة التخزين المؤقت لـ LRU إلى رفع النسبة المئوية الـ 99 (أي أن متوسط ​​القيمة لعينة من 99٪ من التأخيرات زادت ، باستثناء الذروة). وذلك لأن تقليل ذاكرة التخزين المؤقت يقلل من احتمالية أن تكون حالة القراءة للمستخدم في ذاكرة التخزين المؤقت. إذا لم يكن هنا ، فيجب علينا اللجوء إلى قاعدة البيانات.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
بعد كمية كبيرة من اختبار الحمل على أحجام ذاكرة التخزين المؤقت المختلفة ، وجدنا نوعًا ما إعدادًا مقبولاً. </font><font style="vertical-align: inherit;">على الرغم من أنه ليس مثاليًا ، إلا أنه كان حلًا مرضيًا ، لذلك تركنا الخدمة لفترة طويلة للعمل بهذه الطريقة. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في الوقت نفسه ، قمنا بتطبيق Rust بنجاح كبير في أنظمة Discord الأخرى ، ونتيجة لذلك اتخذنا قرارًا جماعيًا لكتابة أطر ومكتبات للخدمات الجديدة فقط في Rust. </font><font style="vertical-align: inherit;">وبدا أن هذه الخدمة مرشحة رائعة للنقل إلى روست: إنها صغيرة ومستقلة ، وكنا نأمل أن يقوم رست بإصلاح هذه الثورات بالتأخير ويجعل الخدمة في نهاية المطاف أكثر متعة للمستخدمين </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup></a><a name="2_2"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">إدارة الذاكرة في الصدأ</font></font></h1><br>
<blockquote><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الصدأ سريع وفعال بشكل لا يصدق مع الذاكرة: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">في حالة عدم وجود بيئة وقت التشغيل ومجمع القمامة ،</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> فهو مناسب للخدمات عالية الأداء والتطبيقات المدمجة ويتكامل بسهولة مع اللغات الأخرى. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></sup></a><a name="3_3"></a></i></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
الصدأ ليس لديه جامع قمامة ، لذلك قررنا أنه لن يكون هناك مثل هذا التأخير ، مثل Go. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في إدارة الذاكرة ، يستخدم نهجًا فريدًا إلى حد ما مع فكرة "امتلاك" الذاكرة. </font><font style="vertical-align: inherit;">باختصار ، يتتبع رست من له الحق في القراءة من الذاكرة والكتابة إليها. </font><font style="vertical-align: inherit;">يعرف متى يستخدم البرنامج الذاكرة ، ويفرج عنها فور عدم الحاجة إلى الذاكرة. </font><font style="vertical-align: inherit;">يفرض الصدأ قواعد الذاكرة في وقت الترجمة ، مما يلغي فعليًا إمكانية حدوث أخطاء في الذاكرة في وقت التشغيل. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></sup></a><a name="4_4"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">لا تحتاج إلى تتبع الذاكرة يدويًا. </font><font style="vertical-align: inherit;">المترجم سيهتم بهذا. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
وبالتالي ، في إصدار Rust ، عند استبعاد حالة القراءة من ذاكرة التخزين المؤقت LRU ، يتم تحرير الذاكرة على الفور. </font><font style="vertical-align: inherit;">هذه الذاكرة لا تجلس ولا تنتظر جامع القمامة. </font><font style="vertical-align: inherit;">يعرف الصدأ أنه لم يعد قيد الاستخدام ويطلقه على الفور. </font><font style="vertical-align: inherit;">لا توجد عملية في وقت التشغيل لمسح الذاكرة التي يجب تحريرها.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الصدأ غير المتزامن</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ولكن كانت هناك مشكلة واحدة في النظام البيئي الصدأ. في وقت تنفيذ خدمتنا ، لم تكن هناك وظائف غير متزامنة لائقة في الفرع المستقر من الصدأ. لخدمة شبكة ، البرمجة غير المتزامنة أمر لا بد منه. طور المجتمع العديد من المكتبات ، ولكن مع اتصال غير تافه ورسائل خطأ غبية جدًا. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لحسن الحظ ، عمل فريق Rust بجد لتبسيط البرمجة غير المتزامنة ، وكان متاحًا بالفعل على القناة غير المستقرة (Nightly).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لم يكن ديسكورد خائفا من تعلم تقنيات جديدة واعدة. على سبيل المثال ، كنا من أوائل مستخدمي Elixir و React و React Native و Scylla. إذا كانت بعض التكنولوجيا تبدو واعدة وتعطينا ميزة ، فنحن مستعدون لمواجهة الصعوبة الحتمية في التنفيذ وعدم استقرار الأدوات المتقدمة. هذا أحد الأسباب التي تجعلنا نصل بسرعة إلى جمهور من 250 مليون مستخدم مع أقل من 50 مبرمجًا في الولاية. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
إن إدخال وظائف جديدة غير متزامنة من قناة Rust غير المستقرة هو مثال آخر على رغبتنا في تبني تقنية جديدة واعدة. قرر الفريق الهندسي تنفيذ الوظائف اللازمة دون انتظار دعمهم في النسخة المستقرة. بالتعاون مع ممثلين آخرين للمجتمع ، تغلبنا على جميع المشاكل التي نشأت ، </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">والصدأ غير المتزامن</font></a><font style="vertical-align: inherit;"> الآن</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">حافظت في فرع مستقر. </font><font style="vertical-align: inherit;">لقد نجح سعرنا.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">التنفيذ واختبار الإجهاد والانطلاق</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
مجرد إعادة كتابة الكود كان سهلا. بدأنا ببث تقريبي ، ثم قللناه إلى الأماكن التي كان لها معنى. على سبيل المثال ، لدى Rust نظام نوع ممتاز مع دعم مكثف للأدوية (للعمل مع البيانات من أي نوع) ، لذلك قمنا برمي كود Go بهدوء ، والذي عوض عن نقص الأدوية الجنيسة. بالإضافة إلى ذلك ، يأخذ نموذج ذاكرة الصدأ في الاعتبار أمان الذاكرة في خيوط مختلفة ، لذلك قمنا بالتخلص من الغوروتينات الواقية. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
أظهر اختبار الحمل على الفور نتيجة ممتازة. تبين أن أداء الخدمة على Rust مرتفع مثل أداء إصدار Go ، </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ولكن بدون هذه الاندفاعات من التأخير المتزايد</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
عادةً ، لم نقم عمليًا بتحسين إصدار Rust. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ولكن حتى مع أبسط التحسينات ، تمكنت Rust من التفوق على نسخة Go المضبوطة بعناية.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">هذا دليل بليغ على مدى سهولة كتابة برامج Rust فعالة مقارنة بالتعمق في Go. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لكننا لم نرضِ الأداء البسيط الراهن. </font><font style="vertical-align: inherit;">بعد القليل من التنميط والتحسين ، </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">تجاوزنا Go من جميع النواحي</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">التأخير ووحدة المعالجة المركزية والذاكرة - أصبح كل شيء أفضل في إصدار Rust. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
تضمنت تحسينات أداء الصدأ:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">التبديل إلى BTreeMap بدلاً من HashMap في ذاكرة التخزين المؤقت LRU لتحسين استخدام الذاكرة.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">استبدال مكتبة المقاييس الأصلية بإصدار يدعم التوافق الحديث Rust.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">إنقاص عدد النسخ في الذاكرة.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
راضيا ، قررنا نشر الخدمة. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
سار الإطلاق بسلاسة كبيرة ، حيث أجرينا اختبارات الضغط. </font><font style="vertical-align: inherit;">قمنا بتوصيل الخدمة بعقدة اختبار واحدة ، واكتشفنا العديد من الحالات الحدودية وقمنا بإصلاحها. </font><font style="vertical-align: inherit;">بعد فترة وجيزة ، قاموا بتدوير إصدار جديد إلى مجموعة الخوادم بأكملها. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
النتائج موضحة أدناه. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
الرسم البياني الأرجواني هو Go ، والرسم البياني الأزرق Rust.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><img src="https://habrastorage.org/webt/yb/-v/mi/yb-vmise0bioz33f8yfrockjr_0.png"></a><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">زيادة حجم ذاكرة التخزين المؤقت</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
عندما نجحت الخدمة لعدة أيام ، قررنا زيادة ذاكرة التخزين المؤقت LRU مرة أخرى. </font><font style="vertical-align: inherit;">كما ذكر أعلاه ، في إصدار Go ، لا يمكن القيام بذلك ، لأن الوقت لجمع القمامة زاد. </font><font style="vertical-align: inherit;">نظرًا لأننا لم نعد نقوم بجمع القمامة ، يمكنك زيادة عدد ذاكرة التخزين المؤقت على زيادة أكبر في الأداء. </font><font style="vertical-align: inherit;">لذا ، قمنا بزيادة الذاكرة على الخوادم ، وتحسين هيكل البيانات لاستخدام أقل للذاكرة (للمتعة) وزيادة حجم ذاكرة التخزين المؤقت إلى 8 ملايين حالة قراءة. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
النتائج أدناه تتحدث عن نفسها. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">لاحظ أن متوسط ​​الوقت يقاس الآن بالميكروثانية ، </font></font><code>@mention</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ويقاس </font><font style="vertical-align: inherit;">الحد الأقصى للتأخير </font><font style="vertical-align: inherit;">بالمللي ثانية.</font></font></b><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/93f/55a/500/93f55a500413c691a4e711e4c90ceada.png"></div><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">تطوير النظام البيئي</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
أخيرًا ، لدى رست نظامًا بيئيًا رائعًا ينمو بسرعة. </font><font style="vertical-align: inherit;">على سبيل المثال ، هناك إصدار جديد من وقت التشغيل غير المتزامن الذي نستخدمه مؤخرًا هو Tokio 0.2. </font><font style="vertical-align: inherit;">قمنا بتحديث ، وبدون أي جهد من جانبنا ، قللنا تلقائيًا الحمل على وحدة المعالجة المركزية. </font><font style="vertical-align: inherit;">في الرسم البياني أدناه ، يمكنك أن ترى كيف انخفض الحمل منذ حوالي 16 يناير.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e5f/128/490/e5f12849036cfea0b9e9246a1e321ed0.png"></div><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">افكار اخيرة</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
يستخدم Discord حاليًا Rust في العديد من أجزاء مجموعة البرامج: لـ GameSDK ، والتقاط وترميز الفيديو في Go Live ، و </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elixir NIF</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ، والعديد من خدمات الواجهة الخلفية ، وغيرها الكثير. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
عند بدء مشروع جديد أو مكون برنامج ، فإننا نفكر بالتأكيد في استخدام Rust. بالطبع ، فقط عندما يكون ذلك منطقيًا. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
بالإضافة إلى الأداء ، يوفر Rust للمطورين العديد من المزايا الأخرى. على سبيل المثال ، يعمل نوع الأمان ومدقق الاقتراض (مدقق الاقتراض) على تبسيط إعادة الهيكلة بشكل كبير أثناء تغيير متطلبات المنتج أو إدخال ميزات لغوية جديدة. النظام البيئي والأدوات ممتازة وتتطور بسرعة. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
حقيقة ممتعة: يستخدم فريق Rust أيضًا Discord للتنسيق. هناك حتى مفيدة للغاية</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">خادم المجتمع الصدأ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ، حيث نتحادث أحيانًا.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><div style="text-align:center;"><img src="https://habrastorage.org/webt/br/pc/l_/brpcl_fl4bwj8fcmaeodxotfw5s.png"></div></a><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الحواشي</font></font></h4><br>
<font color="gray"><ol>
<li><a name="1"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الرسوم البيانية المأخوذة من Go الإصدار 1.9.2. </font><font style="vertical-align: inherit;">لقد جربنا الإصدارات 1.8 و 1.9 و 1.10 دون أي تحسينات. </font><font style="vertical-align: inherit;">اكتمل الترحيل الأولي من Go to Rust في مايو 2019. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[لكي ترجع]</font></font></a><br>
</li>
<li><a name="2"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">للتوضيح ، لا نوصي بإعادة كتابة كل شيء في Rust بدون سبب. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[لكي ترجع]</font></font></a><br>
</li>
<li><a name="3"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">اقتبس من الموقع الرسمي. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[لكي ترجع]</font></font></a><br>
</li>
<li><a name="4"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">بالطبع ، حتى تستخدم </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">غير آمنة</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[لكي ترجع]</font></font></a></li>
</ol></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar487100/index.html">هياكل بيانات غير قابلة للتغيير</a></li>
<li><a href="../ar487106/index.html">فحص محلل PVS-Studio RunUO</a></li>
<li><a href="../ar487108/index.html">الملف الشخصي للاعب المحمول: MyTracker Research</a></li>
<li><a href="../ar487110/index.html">Slurm SRE. تجربة كاملة مع خبراء من Booking.com و Google.com</a></li>
<li><a href="../ar487112/index.html">حافة الجنون: الدائرة الأساسية</a></li>
<li><a href="../ar487118/index.html">Loki - جمع السجلات باستخدام نهج بروميثيوس</a></li>
<li><a href="../ar487120/index.html">كيفية توزيع القطط الصغيرة</a></li>
<li><a href="../ar487122/index.html">جوجل دليل جافا سكريبت نمط الترجمة</a></li>
<li><a href="../ar487124/index.html">مقابلة مع Borey Yangel حول القيادة الذاتية لـ Yandex وقصة إنشاء Alice</a></li>
<li><a href="../ar487126/index.html">كيف تستخدم فرق تطوير الشركات GitLab و Mattermost ChatOps لتسريع التطوير</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>