<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙍🏼 👨🏻‍🏭 👦 パイソン主義者のためのマクロ。Yandexレポート 🎑 🏫 ☢️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Python構文を拡張して必要な機能を追加するにはどうすればよいですか？昨年のPyConでこのトピックを理解しようとしました。レポートから、pytest、macropy、patternsライブラリがどのように配置されているか、そしてそれらがどのようにして興味深い結果を達成しているのかを知ることができ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>パイソン主義者のためのマクロ。Yandexレポート</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/495294/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python構文を拡張して必要な機能を追加するにはどうすればよいですか？</font><font style="vertical-align: inherit;">昨年のPyConでこのトピックを理解しようとしました。</font><font style="vertical-align: inherit;">レポートから、pytest、macropy、patternsライブラリがどのように配置されているか、そしてそれらがどのようにして興味深い結果を達成しているのかを知ることができます。</font><font style="vertical-align: inherit;">最後に、Python上で実行されるLispのような言語であるHyLangでマクロを使用したコード生成の例があります。</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/IMkvg45Vw70" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- こんにちは、みんな。</font><font style="vertical-align: inherit;">まず、PyConの主催者に感謝します。</font><font style="vertical-align: inherit;">私はYandexの開発者です。</font><font style="vertical-align: inherit;">このレポートは、仕事に関するものではなく、実験的なものに関するものです。</font><font style="vertical-align: inherit;">おそらく彼らはあなたの1人をPythonであなたが以前知らなかったクールなことをすることができるという考えに導くでしょう、この方向では考えていませんでした。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マクロが何であるかを知らない人のための少し：これは、言語のいくつかの式がより複雑なコードに展開されるときのコード生成のそのような方法です。</font><font style="vertical-align: inherit;">あなたのための良いものは何ですか？</font><font style="vertical-align: inherit;">あなたにとって、マクロレコードは簡潔であり、それはいくつかの抽象化を表現しますが、それはあなたのために内部で多くの仕事をします、そしてあなたはあなたの手ですべてのコードを書く必要はありません。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pytest</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ほとんどの場合、pytestテストフレームワークに出くわしました。多くの場合、ここではほぼ確実に使用しています。気づいたことがあるかどうかはわかりませんが、内部では魔法をかけています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/al/o6/qv/alo6qvpzofmabtejvqqojenx31a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、このような単純なテストがあります。 pytestなしで実行すると、AssertionErrorがスローされます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ih/an/ck/ihanckzzqzelb5o87nfx9olt2vw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残念ながら、私の例は少し縮退しており、lenが3つの要素のリストから取得されていることがすぐにわかります。しかし、いくつかの関数が呼び出された場合、そのようなAssertionErrorから関数が返すことは決してわかりません。彼女は百と等しくない何かだけを返しました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cu/ko/sa/cukosarqifegg5uvzo14xneczkc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、これをpytestで実行すると、追加のデバッグ情報が表示されます。彼はそれをどのようにして行うのですか？</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6h/g9/vr/6hg9vr5nedvvkvzxlsupjqor71a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この魔法は非常に簡単に機能します。 Pytestは、テストを含むモジュールが読み込まれたときに起動する独自の特別なフックを作成します。その後、pytestはこのPythonファイルを個別に解析し、解析の結果、その中間表現が取得されます。これはASTツリーと呼ばれます。 ASTツリーは、Pythonコードをその場で変更できるようにする基本的な概念です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのようなツリーを受け取った後、pytestはassertと呼ばれるすべての式を探す変換をツリーに課します。彼はそれらを特定の方法で変更し、結果の新しいASTツリーをコンパイルし、テストを含むモジュールを取得します。このモジュールは通常のPython仮想マシンで実行されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/t3/fj/x-/t3fjx-trld3abinbaqxioiizptg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、pytestに変換されていない元のASTツリーの外観です。</font><font style="vertical-align: inherit;">強調表示された赤い領域がアサートです。</font><font style="vertical-align: inherit;">よく見ると、その左側と右側の部分、リスト自体が表示されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pytestがこれを変換して新しい年を生成すると、ツリーは次のようになります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yv/xh/qb/yvxhqbjsokha_vdwfn9-ksm0isi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pytestが生成した約100行のコードがあります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cu/fc/zi/cufczioilng0zfzx05nbrtwgl8g.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このASTツリーをPythonに戻すと、次のようになります。</font><font style="vertical-align: inherit;">ここで赤く強調表示されている領域は、pytestが式の左部分と右部分を計算し、エラーメッセージを生成し、このエラーメッセージで問題が発生した場合にAssertionErrorを発生させる場所です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パターンマッチング</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのようなことで他に何ができますか？任意のPythonコードを変換できます。そして、PyPIで偶然見つけた素晴らしいライブラリーが1つあります。そこで掘り下げるのは興味深いことです。彼女はパターンマッチングを行います。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3k/yb/eq/3kybeqrilpfpqnvj4bmeon62ibm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おそらく、このコードは誰かに馴染みのあるものでしょう。彼は階乗を再帰的に検討します。パターンマッチングを使用してどのように記録できるかを見てみましょう。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xy/cv/as/xycvassi6jwpp9getvm4sy4bbmm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを行うには、関数にデコレータを掛けます。注意：本体の内部では、機能の動作が異なります。これらの各ifは、パターンマッチングのルールであり、関数への入力である式を解析し、何らかの形で変換します。さらに、結果が明示的に返されることすらありません。パターンライブラリは、関数本体を変換するときに、まずそれが含まれている場合にのみそれが含まれていることを確認し、次に結果の暗黙的な戻り値を追加して、言語のセマンティクスを変更します。つまり、彼女は新しいDSLを作成しますが、その動作は少し異なります。これのおかげで、宣言的にいくつかのことを書き留めることができます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3k/yb/eq/3kybeqrilpfpqnvj4bmeon62ibm.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前の関数は、3行で記述されているかのようです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xy/cv/as/xycvassi6jwpp9getvm4sy4bbmm.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/pj/fm/ux/pjfmuxf4zsl_zpppzidv9oirkim.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、残りの行は、たとえば、値のリストから階乗を読み取る、または任意の関数を介してそれを渡すことを可能にする追加の機能を追加します。 </font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変換を自分で書く方法は？</font><font style="vertical-align: inherit;">マクロピー！</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今、あなたはおそらく疑問に思っていますが、どうやって自分で適用できますか？ pytestのように行うのは面倒なので、手動でファイルを解析し、変換が必要なコードを探します。 pytestでは、これは1000行以上の別のモジュールによって行われます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを自分で行わないようにするために、何人かの賢い人がすでにmacropyと呼ばれるモジュールを考案しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このバージョンのモジュールは、2番目と3番目の両方のPython用です。彼らは2回目のPythonの時にそれを書き戻しました。次に、Pythonで何ができるかを理解するために冗談を言いました。ライブラリにはさまざまな例が含まれています。それらを見てみましょう、彼らはあなたにこのテクニックで何ができるかについてのアイデアを与えます。彼らがチュートリアルで説明した最初のクールなものは、3番目のように2番目のPythonのフォーマット文字列を実装するマクロです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/er/3h/vv/er3hvvz7g-0edq1spxz5bukrk3q.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
赤で強調表示されている式は、マクロ呼び出しの構文にすぎません。文字Sはマクロの名前で、角かっこ内はマクロが変換する式です。その結果、変数はここで置き換えられます。これは2番目のPythonでは機能しますが、3番目はそのようなマクロでは不要です。したがって、たとえば、標準のフォーマット文字列よりも複雑なセマンティクスを実装し、より楽しいことを行う独自のマクロを作成できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jw/bf/hx/jwbfhxtuxzzrbjd-vvu3rhdsok8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マクロが展開され、これがモジュールのロード時に発生すると、単純にそのコードに変換されます。プレースホルダーがフォーマット文字列に挿入され、置換手順がそれに適用されます。さらにPythonはすでに標準的な方法でこれをすべてコンパイルしています。実行時には、マクロ展開は発生しません。これらはすべて、モジュールのロード時に発生します。したがって、そのような場合には、モジュールのロード時に発生する最適化や計算を行って、より最適なバイトコードを生成することもできます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/2i/gz/9t/2igz9tsitqjebyuxpln51mhknra.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目の例も興味深いものです。これはラムダを書くための省略表記です。マクロfは一連の引数を取り、代わりに関数を返します。マクロ名「f」で始まる各式、角括弧、そして絶対にすべての式がラムダに変換されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/l5/vq/ym/l5vqym-i-69vtjohomf2nsxfsj0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の意見では、これは特に関数型のコードを開発して記述し、MapReduceを使用するのが好きな人にとってもクールです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0j/fx/xc/0jfxxcdmblyze8e4bcxqrqrgaoy.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、もう1つのおなじみの例です。この関数は階乗を考慮し、コードは赤で強調表示されます。彼女が呼ばれるとどうなりますか？</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ov/gj/v0/ovgjv0vqgcbzx0wxy5q-kuvozzg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スタック制限に達し、醜いRecursionErrorが発生するため、Pythonでエラーがスローされます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wi/zz/1h/wizz1haarmzw9is0q0k3n_r6mji.jpeg" width="600"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どうすればこれを修正できますか？ macropyを使用すると、問題の修正は非常に簡単です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wc/ej/-n/wcej-na40treik2p0hkdp1jfbns.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あなたはデコレータをぶら下げます、それは関数の本体を取り、それを何らかの魔法の方法で変換します。関数自体を変更する必要はありません。macropyがすべてを行います。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xc/c8/ld/xcc8ldcmcykmbaxjceek4xsgrka.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、関数はそれ自体を非常に通常の結果に戻し、地下まで遠くまで行きます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ek/uq/mi/ekuqmigu-x5hhmdyyy8q04wob5c.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どのようにMacropyはそれをしますか？</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fz/1r/5f/fz1r5ff8_v-egywcvufzvw-zsec.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、関数自体へのすべての呼び出しを、TCOデコレーターによってループで呼び出される特別なTailCallオブジェクトに置き換えます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dg/25/5b/dg255bb2t_mzo9ku4ucwq-uz31o.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
回路はこんな感じです。ループのデコレータは、TailCallではなく通常の結果を返すまで関数を呼び出します。そして、彼女が戻ってきたら、それを返します。そして、それだけです。これらのクールなことはマクロで行うことができます！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Macropyには他の例も含まれています。興味のある方は是非行ってみてください。デバッグに役立つものがあるとしましょう。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wd/hg/rq/wdhgrqonz6lfdcicgdynvnfipfs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別のクールなことについてお話します。 1つの例は、このクエリマクロです。彼は何をしているの？その中に、通常のPythonコードを記述します。このコードは、この式を実行した通常の結果として使用できます。しかし内部では、macropyがこのコードを変換し、それをAlchemy SQLクエリ言語コードにします。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ag/qb/jk/agqbjkyzfbun_tbdnjxww5lutms.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼はあなたのためにそれを書き直し、この恐ろしい表現にします。手で書き直すと短くなります。やったよ。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/4k/ts/5w/4kts5wogftqmpcceukufkib56be.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これが元の表現です。マクロを展開すると、次のようになります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/du/i0/uv/dui0uvfpouzuuioj2tmirtfyg5c.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おそらく誰かがPythonに似たコードを書くことに興味があり、開発者にDSL SQL Alchemyでクエリを書くよう強制するのではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同様に、Python（純粋なSQL、JavaScript）から何でも生成し、ファイルの横のどこかに保存して、フロントエンドで使用できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kk/s3/j3/kks3j3s2wwep0vejhof8-3fw-oq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、独自のマクロを作成する方法を見てみましょう。 macropyを使用すると、非常に簡単です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マクロは、入力でASTツリーを受け取り、それを何らかの形で変換して、新しいツリーを返す関数です。以下は、AssertionErrorエラーが発生した理由を理解できるように、ソース式を含むassert呼び出しに説明を追加するマクロの例です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、内部のreplace_assert関数がヘルパーです。彼女はあなたのために木を再帰的に降下します。 replace_assert内で、サブツリー要素が渡されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3u/qn/wa/3uqnwavrca79l0wumgmnfxfcm58.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これにより、そのタイプを内部チェックできますか？それがAssert呼び出しである場合は、それを使って何かを行います。ここでは、左部分と右部分を取り、それらからエラーメッセージを作成し、すべてをmsg属性に書き込む簡単な合成例を示します。これは、返される必要があるメッセージです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rf/re/hn/rfrehnypphthxdzqbjwehtj3fas.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/va/ak/jm/vaakjmq4tpgqjwttqmi8nepgtym.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/x7/hq/cs/x7hqcswjuj59uhp5thatiojofja.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを使用する場合は、with context managerを使用してそのようなマクロをコードのブロックにアタッチし、context manager内に入るすべてのコードがこの変換を通過します。エラーメッセージがlen式（[1、2、3]）から形成されたAssertionErrorに追加されたことが以下に示されています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yo/zo/zc/yozozclanvtdlinutuvnl58puve.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、この方法には1つの制限があり、個人的に悲しくなります。</font><font style="vertical-align: inherit;">その言語で機能する新しいデザインを作成するための実験として試みました。</font><font style="vertical-align: inherit;">たとえば、一部の人々はスイッチまたは条件付き構文を好まない場合を除きます。</font><font style="vertical-align: inherit;">しかし残念ながら、これは不可能です。ソースコードがすでに読み取られてトークンに分解されている場合は、ASTツリーで動作するmacropyおよびその他のツールが使用されます。</font><font style="vertical-align: inherit;">コードはPythonパーサーによって読み取られ、その文法はインタープリターで修正されます。</font><font style="vertical-align: inherit;">これを変更するには、Pythonを再コンパイルする必要があります。</font><font style="vertical-align: inherit;">もちろん、これを行うことはできますが、これはすでにPythonのフォークであり、PyPIでレイアウトできるライブラリではありません。</font><font style="vertical-align: inherit;">したがって、このような構造をmacropyを使用して作成することは不可能です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HyLang</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
幸いなことに、私は長い間、Pythonだけでなく、他のさまざまな言語にも興味を持っていました。多くの人が嫌う構文がありますが、よりシンプルで柔軟です。これらはs式です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
幸いなことに、HyLangと呼ばれるPythonアドインがあります。このことは、Clojureを多少連想させるものであり、ClojureのみがJVM上で実行され、HyLangはPython仮想マシン上で実行されます。つまり、コードを記述するための新しい構文を提供します。ただし、同時に、作成するすべてのコードは既存のPythonライブラリと完全に互換性があり、Pythonライブラリから使用できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/54/sc/rr/54scrrucaeden67utnbyx3jva0i.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
こんな感じです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qo/vr/w7/qovrw7a-mivofegxjhx61jtlky0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
左側がPythonで書かれた部分、右側がHyLangです。そして、両方の下からバイトコードが結果です。これはまったく同じで、構文のみが変更されていることに気づいたでしょう。 HyLangのS式。多くの人はこれを好みません。 「括弧」の反対者は、そのような構文が言語の構造に均一性を与えるため、そのような構文が言語に大きな力を与えることを理解していません。また、統一性により、マクロを使用して任意のデザインを実装できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、各式内の最初の要素が常に何らかのアクションであるために実現されます。そして彼の議論は続く。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、すべてのコードはネストされた式で構成されており、変換しやすく、そこでマクロを開くことができます。これにより、コードの中で言語の標準機能と区別がつかないように、HyLangですべての構成を作成できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/o5/-u/rw/o5-urwww9tzewkt4ufq7krycxj8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
簡単なマクロがHyLangでどのように機能するかを見てみましょう。 macropyを使用してAssertで行ったのと同じことを行うには、このコードだけが必要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちのHyLangマクロは、コードである入力を受け取ります。さらに、マクロはこのコードの任意の部分を簡単に使用して、新しいコードを作成できます。マクロと関数の主な違い：式は値ではなく入力です。マクロを（is（= 1 2））と呼ぶと、Falseではなく式（= 1 2）を受け取ります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/uc/5b/az/uc5bazq37xtwjlsbaf54_kpe8zu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、問題が発生したことを示すエラーメッセージを生成できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hn/a9/cm/hna9cmzwxvf87k5e4i0py87cs84.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、新しいコードを返します。このバックティックとチルドの構文は、次のようなものを意味します。逆引用は言う：この式をそのまま受け取り、そのまま返す。そしてチルダは言う：ここで変数の値を置き換えます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pi/qn/en/piqnenjm28v8jm0i-hfsdx3ib18.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、これを記述すると、展開時のマクロによって新しい式が返され、追加のエラーメッセージが表示されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HyLangはクールなものです。</font><font style="vertical-align: inherit;">確かに、使用しませんが。</font><font style="vertical-align: inherit;">多分私達は決してしません。</font><font style="vertical-align: inherit;">これらの項目はすべて実験的なものです。</font><font style="vertical-align: inherit;">Pythonでは、これまで考えたこともなかったかもしれないことをいくつか実行できるという感覚で、ここを離れてほしい。</font><font style="vertical-align: inherit;">そして、おそらくそれらのいくつかは、あなたの進行中の仕事で実用的なアプリケーションを見つけるでしょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これですべてです。</font><font style="vertical-align: inherit;">あなたはリンクを見ることができます：</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パターン</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MacroPy</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HyLang</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本OnLisp-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マクロの機能の高度な研究のため。</font><font style="vertical-align: inherit;">これは特に興味がある人のためのものです。</font><font style="vertical-align: inherit;">確かに、本は完全にPythonに基づいているのではなく、Common Lispに基づいています。</font><font style="vertical-align: inherit;">しかし、より深い研究のために、これはさらに興味深いでしょう。</font></font></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja495278/index.html">データベース、カード、チェックリスト、またはなぜビジネスナレッジマネージャー</a></li>
<li><a href="../ja495280/index.html">Max Patrol SIEM。情報セキュリティイベント管理システムの概要</a></li>
<li><a href="../ja495282/index.html">XSD、JAXB、Spring Frameworkを使用したXML検証</a></li>
<li><a href="../ja495290/index.html">Zephyrオペレーティングシステムのコード品質の調査</a></li>
<li><a href="../ja495292/index.html">InterSystems IRIS 2020.1リリース</a></li>
<li><a href="../ja495296/index.html">フォレンジック、SQLインジェクション、長引く猫：オンラインステージNeoQUEST-2020のタスクNo. 3の分析</a></li>
<li><a href="../ja495298/index.html">モンテカルロClojureオプションの評価</a></li>
<li><a href="../ja495302/index.html">オンラインストアで4か月の売上を2.5倍に増やす方法-SEOプロモーションの事例</a></li>
<li><a href="../ja495304/index.html">リプログラミングによるヒト細胞の若返り</a></li>
<li><a href="../ja495308/index.html">キープアライブに向かう途中のレーキ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>