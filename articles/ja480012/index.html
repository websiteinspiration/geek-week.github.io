<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏾‍🚒 🧘🏻 🌓 Clang形式はプログラムを遅くします ⚗️ 🧙🏾 🤶🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="今日は、toupper関数のさまざまな実装のパフォーマンスを測定します。これは、火曜日に行われるためです。
 
 実際、私はtoupper関数は気にしていません。最近別の投稿を書いたばかりで、何らかの共通のプロットコアが必要でした。toupperは、ベンチマークの非常に興味深い無害な候補のようです。...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Clang形式はプログラムを遅くします</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/480012/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">今日は、toupper関数のさまざまな実装のパフォーマンスを測定します。これは、火曜日に行われるためです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、私は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toupper</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数は気にしていません。</font><font style="vertical-align: inherit;">最近別の投稿を書いたばかりで、何らかの共通のプロットコアが必要でした</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。toupper</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、ベンチマークの非常に興味深い無害な候補のようです。私をわきまえさせない、できるだけ単純なものを選択しようとしましたが、たまたまこのテストで奇妙な問題に遭遇しました。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この投稿は小さくなります。オリジナルのより包括的な記事、おそらくより興味深いトピックが間もなく期待されます。私と一緒に結果を再現したい場合は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、githubで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソースコード</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">を取得でき</font></a><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toupper</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数の3つの実装を検討します</font><font style="vertical-align: inherit;">。これは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">型の要素で構成される配列の大文字を変換します</font><font style="vertical-align: inherit;">。つまり、配列を引数として取り、すべての小文字が大文字になるようにその要素を直接変更します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の実装では</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C標準ライブラリ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">のtoupper</font></a><font style="vertical-align: inherit;"> [1] </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">関数を</font></a><font style="vertical-align: inherit;">呼び出し</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">て</font></a><font style="vertical-align: inherit;">、Cスタイルのループを実行するだけです。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">toupper_rawloop</span><span class="hljs-params">(<span class="hljs-keyword">char</span>* buf, <span class="hljs-keyword">size_t</span> size)</span> </span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; size; i++) {<font></font>
    buf[i] = <span class="hljs-built_in">toupper</span>(buf[i]);<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目の実装では</font><font style="vertical-align: inherit;">、rawサイクルを</font><i><font style="vertical-align: inherit;">std :: transformに</font></i><font style="vertical-align: inherit;">置き換えるという</font><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">よりモダンな</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アプローチ</font><font style="vertical-align: inherit;">を使用し</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">toupper_transform</span><span class="hljs-params">(<span class="hljs-keyword">char</span>* buf, <span class="hljs-keyword">size_t</span> size)</span> </span>{
  <span class="hljs-built_in">std</span>::transform(buf, buf + size, buf, ::<span class="hljs-built_in">toupper</span>);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、3番目の実装では、ASCII文字を処理する特別なアルゴリズムを使用します。</font><font style="vertical-align: inherit;">文字が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a-z</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の範囲に</font><i><font style="vertical-align: inherit;">ある</font></i><font style="vertical-align: inherit;">かどうかをチェック</font><font style="vertical-align: inherit;">し、成功した場合は同じ文字を大文字に置き換えて、文字コード[2]から32を減算します。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">toupper_branch</span><span class="hljs-params">(<span class="hljs-keyword">char</span>* buf, <span class="hljs-keyword">size_t</span> size)</span> </span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; size; i++) {
    <span class="hljs-keyword">char</span> c = buf[i];
    <span class="hljs-keyword">if</span> (c &gt;= <span class="hljs-string">'a'</span> &amp;&amp; c &lt;= <span class="hljs-string">'z'</span>) {<font></font>
      buf[i] = c - <span class="hljs-number">32</span>;<font></font>
    }<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
簡単そうに見えますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、デフォルト設定でgcc 5.5コンパイラにSkylake i7-6700HQプロセッサを搭載した私のラップトップでのこれらの実装の速度を測定します。</font><font style="vertical-align: inherit;">結果は散布図の形で示されます[3]：</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/ec/ps/uf/ecpsuf8lfb6dcp2empyh6vqbkco.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すぐに、タスクに関係のない3つの質問に対処します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、分岐アルゴリズムのグラフ（緑で表示）を見てください。入力データのサイズによって大きく異なります。他の2つのグラフはほぼフラットのままです。これは実際には単なるテストアーティファクトです。入力ASCII文字はランダムに選択されます[4]。したがって、3番目の実装の場合の決定的な要因は、分岐予測アルゴリズムの動作です。少量のデータでは、反復が実行されるときに要素のシーケンスを完全に記憶するため、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">このノートに示すように</font></a><font style="vertical-align: inherit;">、ミスの数は少なく、速度は高速です。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。データシーケンスのサイズが大きくなるにつれ、予測アルゴリズムが覚えることはますます少なくなり、最終的に各大文字でミスし始め（1文字あたり0.27ミス）、グラフは平準化されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、左上にある緑色のスポットのグループに注意してください。これは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toupper_branch</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分岐を</font><i><font style="vertical-align: inherit;">使用</font></i><font style="vertical-align: inherit;">するバリアントの非常に遅い速度に対応しています</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/b6/kj/by/b6kjbygj9inzadobigp0txj3vxu.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは孤立したアーティファクトではありません。そのようなスポットはいくつかの打ち上げ中に現れました。同時に、これらのデータサイズでのみアルゴリズムをテストする場合、それらを再現することはできません。すべてのサイズでテストが実行された場合にのみポップアップ表示されます。ただし、この場合、常に表示されるとは限りません。特に掘り下げたわけではありませんが、これは、分岐予測アルゴリズムでの名前またはエイリアスの競合が原因であるか、4 kBメモリの物理ページを仮想にマッピングするとき（仮想アドレス空間のランダム化はオフになっていますが）にあると考えられます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3 </font><i><font style="vertical-align: inherit;">番目に</font></i><font style="vertical-align: inherit;">、</font><i><font style="vertical-align: inherit;">toupper_rawloop</font></i><font style="vertical-align: inherit;">の実装</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（青色で表示）グラフ上では、2つの別々の線のように見えます。1つはシンボルあたり2小節のマークの少し上、もう1つはシンボルあたり1.5小節のレベルです。これらの2行はすべてのテスターに​​表示されました。より高速なオプションは、サイクルあたり1.57文字の速度で、ダウンロードポートで実際に遅くなります。ポート2および3でのデータの読み取りは、サイクルあたり1.54マイクロオペレーションの速度で行われるため、98％のビジー状態になります。 「政権」が遅い理由を特定できなかった。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私がこの問題を扱っていたとき、速い「体制」は突然姿を消し、遅いものだけが残りました。おそらく、プロセッサが私がしようとしていることを理解し、矛盾を取り除くためにマイクロコードの更新を密かにダウンロードしましたが、私は（まだ）証拠があります-グラフ付きのベクトル画像。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、この例で何に興味がありますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、興味深いのは、rawサイクルを使用したバージョンが</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">std ::変換を使用</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">したバージョンよりも3〜4倍高速であることです</font><font style="vertical-align: inherit;">。1文字あたり1.5〜2サイクル、1文字あたり数サイクルで7です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここの問題は何ですか？標準のアルゴリズムで失敗しましたか？ん</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のstd ::変換は、</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任意の欠陥を持っていますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あんまり。より正確には、まったくそうではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
関数が</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">異なるファイルで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンパイルされる</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">と</font></a><font style="vertical-align: inherit;">、そのような結果が現れることがわかり</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。それらを同じファイルに入れると、それらのパフォーマンスも同様に低くなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いいえ、アラインメントはそれとは関係ありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、それだけではありません。「生」サイクルの高速バージョンを別のファイルにコンパイルすると、</font><i><font style="vertical-align: inherit;">&lt;algorithm&gt;</font></i><font style="vertical-align: inherit;">ヘッダーファイルを接続するだけで速度が低下します。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">はい、そうです。このファイルを接続するだけです。このファイルは使用されず、最終的なオブジェクトファイルにコードが生成されません。「生の」サイクルの速度は3〜4倍低下します。</font><font style="vertical-align: inherit;">逆に、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">std ::変換</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の実装は</font><font style="vertical-align: inherit;">、</font><i><font style="vertical-align: inherit;">&lt;algorithm&gt;</font></i><font style="vertical-align: inherit;">ファイルから</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">std ::変換の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実装をコピーして貼り付ける</font><font style="vertical-align: inherit;">が、このファイルを含めない</font><font style="vertical-align: inherit;">場合、制限まで加速され</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">
Weirdnessesが終わらない（これ以上があるだろう、私は約束しません）：を含む</font><i><font style="vertical-align: inherit;">&lt;アルゴリズム&gt;</font></i><font style="vertical-align: inherit;">ファイルを</font><font style="vertical-align: inherit;">常に説明した効果にはつながりません。</font><i><font style="vertical-align: inherit;">&lt;algorithm&gt;が</font></i><i><font style="vertical-align: inherit;">&lt;ctype.h&gt;</font></i><font style="vertical-align: inherit;">より前に接続されている</font><font style="vertical-align: inherit;">場合は速度低下が発生し</font><font style="vertical-align: inherit;">ますが、それらを交換すると、no：</font><b><font style="vertical-align: inherit;">遅いコード：</font></b></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;algorithm&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ctype.h&gt;</span></span></code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クイックコード：</font></font></b><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ctype.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;algorithm&gt;</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、この異常は（別のプロジェクトでは）clang-formatが含まれているヘッダーファイルを自動的にソートし、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;algorithm&gt;</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をリストの先頭に</font><font style="vertical-align: inherit;">配置したときに発生しました</font><font style="vertical-align: inherit;">（そのため、記事のクリックベイトヘッダー）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当然、遅かれ早かれアセンブラーのリストに突入する必要がありました。</font><font style="vertical-align: inherit;">私たちはこの不快な瞬間を遅らせません。</font><font style="vertical-align: inherit;">関数</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高速</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バージョン</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">と低速</font></a><font style="vertical-align: inherit;">バージョン[5] </font><font style="vertical-align: inherit;">を以下</font><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">示します</font><font style="vertical-align: inherit;">。小さなループには注釈が付いています。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;algorithm&gt;が最初に接続されます。</font></font></b><br>
<br>
<pre><code class="cpp hljs">toupper_rawloop(<span class="hljs-keyword">char</span>*, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>):<font></font>
    push  rbp<font></font>
    push  rbx<font></font>
    lea   rbp, [rdi+rsi]<font></font>
    sub   rsp, <span class="hljs-number">8</span><font></font>
    test  rsi, rsi<font></font>
    je   .L1<font></font>
    mov   rbx, rdi<font></font>
.L5:<font></font>
    movsx  edi, BYTE PTR [rbx] ;  <span class="hljs-keyword">char</span>-  *buf<font></font>
    add   rbx, <span class="hljs-number">1</span>               ; buf++<font></font>
    call  <span class="hljs-built_in">toupper</span>              ;  <span class="hljs-built_in">toupper</span>(c)<font></font>
    mov   BYTE PTR [rbx<span class="hljs-number">-1</span>], al ;    buf[<span class="hljs-number">-1</span>]<font></font>
    cmp   rbp, rbx             ;  buf == buf_end<font></font>
    jne   .L5                  ;<font></font>
.L1:<font></font>
    add   rsp, <span class="hljs-number">8</span><font></font>
    pop   rbx<font></font>
    pop   rbp<font></font>
    ret</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;algorithm&gt;は2番目に接続されます：</font></font></b><br>
<br>
<pre><code class="cpp hljs">toupper_rawloop(<span class="hljs-keyword">char</span>*, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>):<font></font>
    test  rsi, rsi<font></font>
    je   .L7<font></font>
    push  rbp<font></font>
    push  rbx<font></font>
    mov   rbp, rsi<font></font>
    mov   rbx, rdi<font></font>
    sub   rsp, <span class="hljs-number">8</span><font></font>
    call  __ctype_toupper_loc<font></font>
    lea   rsi, [rbx+rbp]<font></font>
    mov   rdi, rbx<font></font>
.L4:<font></font>
    ;  <span class="hljs-keyword">char</span>-  buf<font></font>
    movsx  rcx, BYTE PTR [rdi]    <font></font>
    ;      <span class="hljs-built_in">toupper</span><font></font>
    ; (   __ctype_toupper_loc)<font></font>
    mov   rdx, QWORD PTR [rax]    <font></font>
    ; buf++<font></font>
    add   rdi, <span class="hljs-number">1</span>           
    ;   <span class="hljs-built_in">toupper</span>  ,<font></font>
    ;      <font></font>
    mov   edx, DWORD PTR [rdx+rcx*<span class="hljs-number">4</span>] <font></font>
    mov   BYTE PTR [rdi<span class="hljs-number">-1</span>], dl    ;  <font></font>
    cmp   rsi, rdi                ;  buf == end_buf<font></font>
    jne   .L4                     ;<font></font>
<font></font>
    add   rsp, <span class="hljs-number">8</span><font></font>
    pop   rbx<font></font>
    pop   rbp<font></font>
.L7:<font></font>
    rep ret</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
主な違いは、遅いバージョンではtoupper関数がループで呼び出されるだけであり、速いバージョンでは関数呼び出しが完全に存在せず、対応表[6]での検索しか行われないことです。関数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">std :: toupper</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の本体は</font><font style="vertical-align: inherit;">、呼び出しの場所で置き換えられます。</font><font style="vertical-align: inherit;">glibcライブラリの</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ソースコード</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
を見る</font><font style="vertical-align: inherit;">と、</font><i><font style="vertical-align: inherit;">toupper</font></i><font style="vertical-align: inherit;">関数の実装がそこにあり</font><font style="vertical-align: inherit;">ます。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cpp hljs">__extern_inline <span class="hljs-keyword">int</span>
<span class="hljs-comment">// __NTH –  , ,     </span>
__NTH (<span class="hljs-built_in">toupper</span> (<span class="hljs-keyword">int</span> __c)) <font></font>
{<font></font>
 <span class="hljs-keyword">return</span> __c &gt;= <span class="hljs-number">-128</span> &amp;&amp;<font></font>
        __c &lt; <span class="hljs-number">256</span> ? <font></font>
       (*__ctype_toupper_loc ())[__c] : __c;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toupperは</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、最初にchar文字のサイズが1バイトに収まることを確認</font><font style="vertical-align: inherit;">する</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">externインライン</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数</font><font style="vertical-align: inherit;">として定義されており</font><font style="vertical-align: inherit;">[7]、次に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">__ctype_toupper_loc（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数によって返された対応表で文字を検索します</font><font style="vertical-align: inherit;">。この関数は、ローカルストリームポインター（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const int **</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">型</font><font style="vertical-align: inherit;">）を</font><font style="vertical-align: inherit;">返します。これは、</font><font style="vertical-align: inherit;">対応表を指し、そこから、シンボルの要求に応じて、大文字のバージョンが返されます[8]。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、リストで何が起こっているのかが明確になりました。アルゴリズムの高速バージョンでは、コンパイラは、本体代入</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TOUPPERの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">機能を</font><font style="vertical-align: inherit;">、それだけにコールを代用することができない</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">__ctype_toupper_loc（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数</font><font style="vertical-align: inherit;">[9]。ただし、この呼び出しは次のように宣言されています</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">__attribute __（（const））</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、つまり、戻り値は引数にのみ依存します（ここにはありません）。コンパイラーは、この関数が毎回同じ値を返すことを知っているため、その呼び出しをループから外します。ループ自体では、対応表へのアクセス、新しい値のバッファーへの書き込み、およびループ制御に関連する読み取り操作はわずかしかありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
低速バージョンでは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toupper（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼び出し</font><font style="vertical-align: inherit;">はループの本体に残ります。ループ自体は1つのコマンドで短くなっていますが、もちろん、今でも</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toupper</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数内のすべてのコードを実行する必要があります</font><font style="vertical-align: inherit;">。私のシステムでは、次のようになります。</font></font><br>
<br>
<pre><code class="cpp hljs"> lea  edx,[rdi+<span class="hljs-number">0x80</span>]                  ; edx = rdi + <span class="hljs-number">0x80</span><font></font>
 movsxd rax,edi                       ;    c<font></font>
 cmp  edx,<span class="hljs-number">0x17f</span>    ; ,  c     <span class="hljs-number">-128</span>  <span class="hljs-number">255</span>
 ja   <span class="hljs-number">2</span>a           ;  ,  <font></font>
 mov  rdx,QWORD PTR [rip+<span class="hljs-number">0x395f30</span>]    ;   <font></font>
                                      ;  <font></font>
mov  rdx,QWORD PTR fs:[rdx]           ;     <font></font>
                                      ;    <font></font>
 mov  rdx,QWORD PTR [rdx]             ;    <font></font>
                                      ;   <font></font>
 mov  rdx,QWORD PTR [rdx+<span class="hljs-number">0x48</span>]        ;     <span class="hljs-built_in">toupper</span>
 mov  eax,DWORD PTR [rdx+rax*<span class="hljs-number">4</span>+<span class="hljs-number">0x200</span>] ;  c  
<span class="hljs-number">2</span>a:<font></font>
 ret</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは組み込みではない呼び出しであるため、プログラムはより多くの作業を行います。メモリーにアクセスする少なくとも5つの連続した操作（いわゆる</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポインターの追跡</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font><i><font style="vertical-align: inherit;">ポインター追跡</font></i><font style="vertical-align: inherit;">）があります。クイックバージョンでは、残りの2つだけがループから除外されるため、残りは2つだけです。関数を呼び出してから終了するまでの遅延は約25サイクルであり、約7サイクルが出てきます。これは、プロセッサーが呼び出しを並列化できたことを意味します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これはなぜですか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インクルードファイルの長いチェーンでは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;algorithm&gt;</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">などのC ++ヘッダーファイル</font><font style="vertical-align: inherit;">に、次の行を含む</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;bits / os_defines.h&gt;</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイル</font><font style="vertical-align: inherit;">が含まれます。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//      isanum  .  </span>
<span class="hljs-comment">//   .</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __NO_CTYPE 1</span></code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;ctype.h&gt;</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ファイルが最終的に接続されると</font><font style="vertical-align: inherit;">、このディレクティブのために、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toupperが</font></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extern inline</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">として定義されて</font><font style="vertical-align: inherit;">いるコードを</font><font style="vertical-align: inherit;">含めることができません。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> !defined __NO_CTYPE</span>
<span class="hljs-meta"># <span class="hljs-meta-keyword">ifdef</span> __isctype_f</span><font></font>
__isctype_f (alnum)<font></font>
<span class="hljs-comment">//  ..  ..</span><font></font>
__isctype_f (xdigit)<font></font>
<span class="hljs-meta"># <span class="hljs-meta-keyword">elif</span> defined __isctype</span>
<span class="hljs-meta"># <span class="hljs-meta-keyword">define</span> isalnum(c) __isctype((c), _ISalnum)</span>
<span class="hljs-meta"># <span class="hljs-meta-keyword">define</span> isalpha(c) __isctype((c), _ISalpha)</span>
<span class="hljs-comment">//  ..  ..</span>
<span class="hljs-meta"># <span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
<span class="hljs-comment">//     </span>
<span class="hljs-meta"># <span class="hljs-meta-keyword">ifdef</span> __USE_EXTERN_INLINES</span>
__extern_inline <span class="hljs-keyword">int</span>
__NTH (<span class="hljs-built_in">tolower</span> (<span class="hljs-keyword">int</span> __c))<font></font>
{<font></font>
 <span class="hljs-keyword">return</span> __c &gt;= <span class="hljs-number">-128</span> &amp;&amp; __c &lt; <span class="hljs-number">256</span> ? (*__ctype_tolower_loc ())[__c] : __c;<font></font>
}<font></font>
<font></font>
__extern_inline <span class="hljs-keyword">int</span>
__NTH (<span class="hljs-built_in">toupper</span> (<span class="hljs-keyword">int</span> __c))<font></font>
{<font></font>
 <span class="hljs-keyword">return</span> __c &gt;= <span class="hljs-number">-128</span> &amp;&amp; __c &lt; <span class="hljs-number">256</span> ? (*__ctype_toupper_loc ())[__c] : __c;<font></font>
}<font></font>
<span class="hljs-meta"># <span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
<span class="hljs-comment">//   tolower    </span>
<span class="hljs-meta"># <span class="hljs-meta-keyword">if</span> __GNUC__ &gt;= 2 &amp;&amp; defined __OPTIMIZE__ &amp;&amp; !defined __cplusplus</span>
<span class="hljs-meta"># <span class="hljs-meta-keyword">define</span> tolower(c) __tobody (c, tolower, *__ctype_tolower_loc (), (c))</span>
<span class="hljs-meta"># <span class="hljs-meta-keyword">define</span> toupper(c) __tobody (c, toupper, *__ctype_toupper_loc (), (c))</span>
<span class="hljs-meta"># <span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">/* Optimizing gcc */</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">/* Not __NO_CTYPE. */</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接続時にすることをしてくださいは、ノート</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;のctype.h&gt;</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のC ++版</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のtoupperがされて</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、最大-マクロとして定義されたことがない</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">にextern </font></font></i> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インライン</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マクロの定義はにより保護されているので- </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">！__cplusplusチェック定義され</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、したがって、有効になりません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般に、</font><font style="vertical-align: inherit;">この場合の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">__NO_CTYPE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extern inline</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">として宣言され</font><font style="vertical-align: inherit;">た</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tolower</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数</font><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toupper</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数の本体を</font><font style="vertical-align: inherit;">除外する</font><font style="vertical-align: inherit;">必要があるかどうかは確かではありません</font><font style="vertical-align: inherit;">が、これが実際に行われることであり、サイクルの速度が大幅に低下します。結論として、</font><i><font style="vertical-align: inherit;">&lt;ctype.h&gt;の</font></i><font style="vertical-align: inherit;">代わりに</font><i><font style="vertical-align: inherit;">&lt; </font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cctype&gt;</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を含めると、</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（つまり、C ++は、関数を</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">std ::名前空間に</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置するCヘッダーファイルのバージョンです</font><font style="vertical-align: inherit;">）。この場合、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;cctype&gt;</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">には最終的に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;bits / os_defines.h&gt;が</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">含まれる</font><font style="vertical-align: inherit;">ため、コードの動作は遅く</font><i><font style="vertical-align: inherit;">なります。</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それだけ重要ですか？うーん、ダメ。</font><i><font style="vertical-align: inherit;">トッパー</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
機能</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、さまざまな言語の文字を使用する本格的な作業には適していないため、ASCII文字のみを処理する必要がある場合は、独自の高速実装を作成できます。テキストの深刻な作業が必要な場合は、UTF-8を使用し、地域設定をサポートするためになんらかのICUを使用するか、UnicodeサポートがC ++で表示されるまで待つ必要があります（待機するのに時間がかかる場合があります）。 。したがって、「clang形式は4倍のパフォーマンス低下を引き起こす可能性があります」という文は、クリックベイトヘッダーとしてのみ適しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この影響はlibcのすべてのバージョンで見られますか？はい、ほとんどすべてですが、ここでもそれほど単純ではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記の結果は、gcc 5.5とglibc 2.23で正確に当てはまります。これらのバージョンを使用したためですが、新しいバージョンで何か新しいことが起こっています（glibc 2.27以降）。そこで、</font><i><font style="vertical-align: inherit;">&lt;ctype.h </font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt;の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前</font><font style="vertical-align: inherit;">に</font><i><font style="vertical-align: inherit;">&lt;algorithm&gt;を</font></i><font style="vertical-align: inherit;">オンにして</font><font style="vertical-align: inherit;">も同じ効果が得られますが、</font><i><font style="vertical-align: inherit;">&lt;stdlib.h&gt;</font></i><font style="vertical-align: inherit;"> [10] </font><font style="vertical-align: inherit;">でも問題が発生します</font><font style="vertical-align: inherit;">。</font><i><font style="vertical-align: inherit;">&lt;ctype.h&gt;の</font></i><font style="vertical-align: inherit;">前にオンにすると</font><font style="vertical-align: inherit;">、パフォーマンスも低下しますが、以前のバージョンで観察されました。明らかに、新しいバージョンでは、</font><i><font style="vertical-align: inherit;">&lt;stdlib.h&gt;</font></i><font style="vertical-align: inherit;">ファイル</font><font style="vertical-align: inherit;">には</font><i><font style="vertical-align: inherit;">__NO_CTYPE</font></i><font style="vertical-align: inherit;">定義も含まれて</font><i><font style="vertical-align: inherit;">い</font></i><font style="vertical-align: inherit;">ます</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">少なくとも、今はソートのためにclang形式のせいにすることはできません-ここでそれは問題を解決するのに役立つだけです（接続されたファイルのリストに他の問題のファイルがない場合）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はlibc</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">バグレポート</font></a><font style="vertical-align: inherit;">を投稿し</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">た</font></a><font style="vertical-align: inherit;">ので、このバグは修正される可能性がありますが、ヘッダーファイルが接続されている順序に関連するエラーがさらに困惑することは間違いありません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コメント</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サイトにコメントシステムはありませんが、私はそれに取り組んでいます（つまり、静的なサイトにコメントを付けるのは難しいと定期的に非難します）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それまでの間、この記事は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hacker News</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Webサイト</font><font style="vertical-align: inherit;">または</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lobste.rsで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">議論できます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">謝辞</font></font></h2><br><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">std :: toupper</font></i><font style="vertical-align: inherit;">を</font><i><font style="vertical-align: inherit;">std :: transform</font></i><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">するためにラムダ関数を使用する必要がないこと</font><font style="vertical-align: inherit;">
を</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指摘した</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hacker Newsのufoユーザー</font><font style="vertical-align: inherit;">、および</font><font style="vertical-align: inherit;">ラムダ関数がまだ必要である</font><font style="vertical-align: inherit;">と</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">説明</font></a><font style="vertical-align: inherit;">した</font><font style="vertical-align: inherit;">Jonathan Mullerに</font><font style="vertical-align: inherit;">感謝し</font><font style="vertical-align: inherit;">ます。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はい、</font><i><font style="vertical-align: inherit;">&lt;ctype.h&gt;</font></i><font style="vertical-align: inherit;">ヘッダーファイル</font><font style="vertical-align: inherit;">の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toupper（3）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数</font><font style="vertical-align: inherit;">は、次の</font><font style="vertical-align: inherit;">ように、ほとんどの非ASCII文字の処理に</font><font style="vertical-align: inherit;">は</font><font style="vertical-align: inherit;">適していません。</font><font style="vertical-align: inherit;">は1バイトを超える文字を処理できませんが、ASCII文字の文字列のみを渡すため、このタスクに適しています。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font></li>
<li>  ASCII         –   32    ,   ,              32. ,     ,     –   ASCII,        5-  (, <i>c&amp;0b11011111</i>),       ,            .     ,   ,    ,        <i>char</i>.</li>
<li>        «»   .  ,    ,     x     (  ),    y –   (   – <i>  ,   </i>).       ,        x    :      10     .</li>
<li> ,        [32, 127],         27% .</li>
<li>      «»        <i>&lt;algorithm&gt;</i>  <i>&lt;ctype.h&gt;</i>.        –   ,    . ,   <i>std::transform</i>      ,    <i>&lt;algorithm&gt;</i>,     ,     ,    .</li>
<li>     ,   ,           (<i>mov rdx, QWORD PTR [rax]</i>)  .          ,                  .  ,  ,     ,          <i>char</i>,           <i>[rax]</i> ..   .     ,  <i>__restrict__</i>   .      ,     <i>toupper </i>      , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  </a> –     .</li>
<li>       ,     ,    <i>char </i>     <i>[-128, 255]</i>.    ,  API  <i>toupper©</i>    <i>int</i>,   <i>char</i>,          <i>int</i>,          <i>char</i>,         .</li>
<li>,  ,   <i>std::toupper</i>      :     (  ,   ),        . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">↵</a></li>
<li>         :      .</li>
<li>        <i>stdlib.h</i> (  <i>&lt;algorithm&gt;</i>,     ) –  ,      C     C++    ,     .   <i>stdlib.h</i>    <i>size_t</i>.</li>
</ol><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この記事は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Performance Matters</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Webサイトで最初に公開されました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">翻訳された記事は、著者の許可を得てここに掲載されています。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja479998/index.html">ワーム、ネズミ、そしてフリーランサーによるトルコのトリック</a></li>
<li><a href="../ja480000/index.html">TCP経由のサーバーWebRTCチャネル品質インジケーター</a></li>
<li><a href="../ja480002/index.html">DevOpsDays Moscowのレビュー：6つのレポートからの洞察</a></li>
<li><a href="../ja480008/index.html">Yuri Rogachev：「私はM-1をやるようになりました」</a></li>
<li><a href="../ja480010/index.html">忘れた上位3つのHTML要素</a></li>
<li><a href="../ja480016/index.html">ロシアのSMB企業の39％が標的型サイバー攻撃に遭遇</a></li>
<li><a href="../ja480018/index.html">Pythonでのモバイルアプリ開発。KivyMDライブラリ</a></li>
<li><a href="../ja480020/index.html">phpとdockerの例を含むTwelve-Factorアプリの方法論に基づくアプリケーション開発とBlue-Greenデプロイメント</a></li>
<li><a href="../ja480022/index.html">Pythonのインスタンス化</a></li>
<li><a href="../ja480024/index.html">ペリウィンクル：単一命令プロセッサ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>