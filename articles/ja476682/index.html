<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>✨ 🀄️ 🤴 Phaserでサッパーを作成し、HTML5開発者テストタスクを実行する方法 🐍 🎯 👸🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="こんにちは、親愛なる同僚たち！
 
 私の名前はアレクサンダーです。私はHTML5ゲームの開発者です。
 
 私が履歴書を送った会社の1つで、テストタスクを完了するように依頼されました。私は同意し、1日後、結果としてTOR HTML5に従って開発されたゲームを送信しました。
 
 
 
 私はゲーム...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Phaserでサッパーを作成し、HTML5開発者テストタスクを実行する方法</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/476682/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こんにちは、親愛なる同僚たち！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の名前はアレクサンダーです。私はHTML5ゲームの開発者です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私が履歴書を送った会社の1つで、テストタスクを完了するように依頼されました。私は同意し、1日後、結果としてTOR HTML5に従って開発されたゲームを送信しました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/4t/ng/dn/4tngdnvlxq3izqrpk2nykww2dvs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はゲームプログラミングのトレーニングを行っているため、コードをより効率的に使用するために、完成したプロジェクトに関するトレーニング記事を書くことは有益だと判断しました。そして、完了したテストは肯定的な評価を受け、インタビューへの招待につながったので、おそらく私の決定は存在する権利を有し、おそらく将来的に誰かを助けるでしょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では、開発者のHTML5の位置に関する平均テストタスクを正常に完了するのに十分な作業量についてのアイデアを提供します。</font><font style="vertical-align: inherit;">この資料は、Phaserフレームワークについて知りたい人にとっても興味深いかもしれません。</font><font style="vertical-align: inherit;">また、すでにPhaserを使用しており、JSで作成している場合は、TypeScriptでプロジェクトを開発する方法をご覧ください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
だから、猫の下にはたくさんのTypeScriptコードがあります！</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前書き</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題について簡単に説明します。 </font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">古典的なサッパーであるシンプルなHTML5ゲームを開発します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主なツールとして、フェイザー3、typescript、webpackを使用します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゲームはデスクトップ用に設計され、ブラウザーで実行されます。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最終プロジェクトへのリンクを提供します。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デモとソースへのリンク</font></font></b><div class="spoiler_text"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> -</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">   GitHub</a><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、誰かが突然ゲームのルールを忘れた場合、サッパーのメカニズムを思い出してください。</font><font style="vertical-align: inherit;">しかし、これはまれなケースなので、ルールはネタバレの下に置かれます:)</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サッパールール</font></font></b><div class="spoiler_text">    ,    .        .      . <br>
<br>
       ,  .      ,    .<br>
<br>
     ,     ,   ,          .      ,    .<br>
<br>
          .     ,       ,      .              ,  ,   .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、直接マニュアル自体に行きます。</font><font style="vertical-align: inherit;">すべての資料は小さなステップに分かれており、各ステップは特定のタスクの実装を短時間で説明しています。</font><font style="vertical-align: inherit;">したがって、小さな目標を段階的に実行して、最終的に完全なゲームを作成します。</font><font style="vertical-align: inherit;">特定の手順にすばやく進む場合は、目次を使用してください。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目次</font></font></b><div class="spoiler_text"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">1. </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">1.1  </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">1.2  </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">1.3  </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">1.4  </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">2.  </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">2.1  </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">2.2  </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">2.3   </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">2.4    </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">2.5  </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">2.6     </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">3.  </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">3.1  </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">3.2  </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">3.3  </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">3.4     </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">3.5  </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">3.6   FieldView</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">3.7   .</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">3.8  </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">3.9  </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">4.   </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">4.1     </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">4.2.     </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">4.4   </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">4.5  GameSceneView</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">5. </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">5.1   </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">5.2   </a><br>
</div></div><br>
<a name="section-1"></a><h2><font color="#008080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.準備</font></font></font></h2><br>
<a name="section-1-1"></a><h3><font color="#008080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1プロジェクトテンプレート</font></font></font></h3><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デフォルトのフェイザープロジェクトテンプレートを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ダウンロードし</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これはフレームワークの作者からの推奨テンプレートであり、次のディレクトリ構造を提供します。</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">index.html </font></font></td>
<td colspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゲームを起動するHTMLページ</font></font></td>
</tr>
<tr>
<td rowspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウェブパック/</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base.js</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テスト環境の構成を構築する</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prod.js</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本番用の構成を構築する</font></font></td>
</tr>
<tr>
<td rowspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">src /</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">資産/</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゲームアセット（スプライト、サウンド、フォント）</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">index.js</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エントリーポイント</font></font></td>
</tr>
</tbody></table></div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このプロジェクトで</font></font><code>index.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、</font><font style="vertical-align: inherit;">現在の</font><font style="vertical-align: inherit;">ファイルは必要ないため、削除します。</font><font style="vertical-align: inherit;">次に、ディレクトリ</font></font><code>/src/scripts/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">作成し、</font><font style="vertical-align: inherit;">その中に空のファイルを置きます</font></font><code>index.ts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">すべてのスクリプトをこのフォルダーに追加します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロダクション用のプロジェクトを</font></font><code>dist</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビルドすると</font><font style="vertical-align: inherit;">、</font><font style="vertical-align: inherit;">リリースビルドが配置される</font><font style="vertical-align: inherit;">ルートにディレクトリが作成</font><font style="vertical-align: inherit;">されることにも注意してください。</font></font><br>
<br>
<a name="section-1-2"></a><h3><font color="#008080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.2ビルド構成</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
組立にはwebpackを使用します。</font><font style="vertical-align: inherit;">テンプレートはもともとJavaScriptを使用するために準備されており、TypeScriptで記述しているため、コレクターの構成に小さな変更を加える必要があります。</font><font style="vertical-align: inherit;">プロジェクトをビルドするときのエントリポイントを示す</font><font style="vertical-align: inherit;">キーと、</font><font style="vertical-align: inherit;">TSスクリプトをビルドするためのルールを記述する</font><font style="vertical-align: inherit;">構成</font><font style="vertical-align: inherit;">を</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイルに追加し</font></font><code>webpack/base.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font></font><code>entry</code><font style="vertical-align: inherit;"></font><code>ts-loader</code><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// webpack/base.js</span>
<span class="hljs-comment">//...</span>
<span class="hljs-built_in">module</span>.exports = {
  <span class="hljs-attr">entry</span>: <span class="hljs-string">'./src/scripts/index.ts'</span>,
  <span class="hljs-comment">// ...</span>
  <span class="hljs-attr">resolve</span>: {
    <span class="hljs-attr">extensions</span>: [ <span class="hljs-string">'.ts'</span>, <span class="hljs-string">'.tsx'</span>, <span class="hljs-string">'.js'</span> ]<font></font>
  },<font></font>
  <span class="hljs-attr">module</span>: {
    <span class="hljs-attr">rules</span>: [{
            <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.tsx?$/</span>,<font></font>
            use: <span class="hljs-string">'ts-loader'</span>,
            <span class="hljs-attr">exclude</span>: <span class="hljs-regexp">/node_modules/</span><font></font>
      },<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、プロジェクトルートにtsconfig.jsonファイルを作成する必要があります。</font><font style="vertical-align: inherit;">私にとっては、次のコンテンツがあります。</font></font><br>
<br>
<pre><code class="javascript hljs">{
    <span class="hljs-string">"compilerOptions"</span>: {
      <span class="hljs-string">"module"</span>: <span class="hljs-string">"commonjs"</span>,
      <span class="hljs-string">"lib"</span>: [ <span class="hljs-string">"dom"</span>, <span class="hljs-string">"es5"</span>, <span class="hljs-string">"es6"</span>, <span class="hljs-string">"es2015"</span>, <span class="hljs-string">"es2017"</span>, <span class="hljs-string">"es2015.promise"</span> ],
      <span class="hljs-string">"target"</span>: <span class="hljs-string">"es5"</span>,
      <span class="hljs-string">"skipLibCheck"</span>: <span class="hljs-literal">true</span><font></font>
    },<font></font>
    <span class="hljs-string">"exclude"</span>: [<span class="hljs-string">"node_modules"</span>, <span class="hljs-string">"dist"</span>]<font></font>
}</code></pre><br>
<a name="section-1-3"></a><h3><font color="#008080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.3モジュールのインストール</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
package.jsonからすべての依存関係をインストールし、typescriptおよびts-loaderモジュールをそれらに追加します。</font></font><br>
<br>
<pre><code class="plaintext hljs">npm i<font></font>
npm i typescript --save-dev<font></font>
npm i ts-loader --save-dev<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これでプロジェクトは開発を開始する準備ができました。</font><font style="vertical-align: inherit;">自由に</font></font><code>scripts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使えるのは、ファイル</font><font style="vertical-align: inherit;">内のプロパティ</font><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">すでに定義されている2つのコマンド</font><font style="vertical-align: inherit;">です</font></font><code>package.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デバッグ用のプロジェクトをビルドし、ローカルサーバーを介してブラウザーで開く</font></font><br>
<br>
<pre><code class="plaintext hljs">npm start</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">販売用のビルドを実行し、リリースビルドをdist /フォルダーに配置します</font></font><br>
<br>
<pre><code class="plaintext hljs">npm run build</code></pre></li>
</ol><br>
<a name="section-1-4"></a><h3><font color="#008080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.4アセットの準備</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このゲームのためのすべての資産は、正直からダウンロードされ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenGameArt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（バージョン61x61）と呼ばれるライセンスの友好持っ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィール無料でご利用に</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パックのページは慎重に）を教えてくれる、。</font><font style="vertical-align: inherit;">ちなみに、記事に記載されているコードは同じライセンスを持っています！</font><font style="vertical-align: inherit;">;）</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ダウンロードしたセットから時計の画像を削除し、残りのファイルの名前を変更して、使用に便利なフレーム名を取得しました。</font><font style="vertical-align: inherit;">下の画面に名前と対応するファイルのリストが表示されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのスプライトから、フォーマットアトラス</font></font><code>Phaser JSONArray</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プログラム</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TexturePacker</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（frishnoyバージョンはまだ受け取っていないので十分な作業です）を作成</font></font><code>spritesheet.png</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">し</font></font><code>spritesheet.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font><font style="vertical-align: inherit;">生成さ</font><font style="vertical-align: inherit;">れ</font><font style="vertical-align: inherit;">たファイル</font><font style="vertical-align: inherit;">と</font><font style="vertical-align: inherit;">ファイルをプロジェクトディレクトリに配置し</font></font><code>src/assets/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ms/ki/z9/mskiz9zmuidbxk8hhcbksfmny4k.png"><br>
<br>
<a name="section-2"></a><h2><font color="#008080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.シーンを作成する</font></font></font></h2><br>
<a name="section-2-1"></a><h3><font color="#008080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1エントリーポイント</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開発は、webpack構成で記述されたエントリポイントを作成することから始まります。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// src/scripts/index.ts</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> Phaser <span class="hljs-keyword">from</span> <span class="hljs-string">"phaser"</span>;<font></font>
<font></font>
<span class="hljs-keyword">new</span> Phaser.Game({
    <span class="hljs-attr">type</span>: Phaser.AUTO,
    <span class="hljs-attr">parent</span>: <span class="hljs-string">"minesweeper"</span>,
    <span class="hljs-attr">width</span>: <span class="hljs-built_in">window</span>.innerWidth,
    <span class="hljs-attr">height</span>: <span class="hljs-built_in">window</span>.innerHeight,
    <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">"#F0FFFF"</span>,
    <span class="hljs-attr">scene</span>: []<font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今回のゲームはデスクトップ用に設計されており、画面全体に表示されるため、</font></font><code>width</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font><font style="vertical-align: inherit;">フィールドにはブラウザの幅と高さ全体を大胆に使用しています</font></font><code>height</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フィールド</font></font><code>scene</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は現在空の配列であり、修正します！</font></font><br>
<br>
<a name="section-2-2"></a><h3><font color="#008080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2開始シーン</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイルの最初のシーンのクラスを作成します</font></font><code>src/scripts/scenes/StartScene.ts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StartScene</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Phaser</span>.<span class="hljs-title">Scene</span> </span>{
   <span class="hljs-keyword">constructor</span>() {
       <span class="hljs-keyword">super</span>(<span class="hljs-string">'Start'</span>);<font></font>
   }<font></font>
 <font></font>
   public preload(): <span class="hljs-keyword">void</span> {<font></font>
   }<font></font>
 <font></font>
   public create(): <span class="hljs-keyword">void</span> {<font></font>
   }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有効な継承のため</font></font><code>Phaser.Scene</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に、親クラスのコンストラクターにパラメーターとしてシーン名を渡します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このシーンは、リソースのプリロードとスタート画面の機能を組み合わせて、ユーザーをゲームに招待します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通常、私のプロジェクトでは、プレーヤーは最初のシーンに到達する前に、次の順序で2つのシーンを通過します。</font></font><br>
<br>
<pre><code class="plaintext hljs">Boot =&gt; Preload =&gt; Start
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、この場合、ゲームは非常にシンプルで、アセットが少ないため、プリロードを別のシーンに移す必要はなく、さらに最初の個別のブートローダーを実行する理由もありません</font></font><code>Boot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メソッド内のすべてのアセットをロードします</font></font><code>preload</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">作成したアトラスを将来的に使用できるようにするには、2つのステップを実行する必要があります。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">両方</font></font><code>png</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font></font><code>json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用して</font><font style="vertical-align: inherit;">、</font><font style="vertical-align: inherit;">アトラスファイルを</font><font style="vertical-align: inherit;">取得し</font><font style="vertical-align: inherit;">ます</font></font><code>require</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// StartScene.ts</span>
<span class="hljs-keyword">const</span> spritesheetPng = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./../../assets/spritesheet.png"</span>);
<span class="hljs-keyword">const</span> spritesheetJson = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./../../assets/spritesheet.json"</span>);
<span class="hljs-comment">// ...</span>
</code></pre><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それらを</font></font><code>preload</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">start scene </font><font style="vertical-align: inherit;">メソッドにロードします</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// StartScene.ts</span>
<span class="hljs-comment">// ...</span>
public preload(): <span class="hljs-keyword">void</span> {
    <span class="hljs-keyword">this</span>.load.atlas(<span class="hljs-string">"spritesheet"</span>, spritesheetPng, spritesheetJson);<font></font>
}<font></font>
<span class="hljs-comment">// ...</span>
</code></pre><br>
</li>
</ol><br>
<a name="section-2-3"></a><h3><font color="#008080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.3開始シーンのテキスト</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初のシーンでは、やることが2つ残っています。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゲームの開始方法をプレイヤーに伝える</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プレイヤーの主導でゲームを開始する</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初のポイントを満たすために、最初にシーンファイルの最初に2つの列挙を作成して、テキストとそのスタイルを記述します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// StartScene.js</span><font></font>
enum Texts {<font></font>
    Title = <span class="hljs-string">'Minesweeper HTML5'</span>,<font></font>
    Message = <span class="hljs-string">'Click anywhere to start'</span><font></font>
}<font></font>
<font></font>
enum Styles {<font></font>
    Color = <span class="hljs-string">'#008080'</span>,<font></font>
    Font = <span class="hljs-string">'Arial'</span><font></font>
}<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、メソッドでオブジェクトとして両方のテキストを作成します</font></font><code>create</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">の</font></font><code>create</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">scenes </font><font style="vertical-align: inherit;">メソッド</font><font style="vertical-align: inherit;">は</font><font style="vertical-align: inherit;">、メソッド</font><font style="vertical-align: inherit;">内の</font></font><code>Phaser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてのリソースを読み込んだ後にのみ呼び出されるため、これは</font></font><code>preload</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完全に適しています。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// StartScene.js</span>
<span class="hljs-comment">//...</span>
public create(): <span class="hljs-keyword">void</span> {
    <span class="hljs-keyword">this</span>.add.text(
        <span class="hljs-keyword">this</span>.cameras.main.centerX,
        <span class="hljs-keyword">this</span>.cameras.main.centerY - <span class="hljs-number">100</span>,<font></font>
        Texts.Title,<font></font>
        {<span class="hljs-attr">font</span>: <span class="hljs-string">`52px <span class="hljs-subst">${Styles.Font}</span>`</span>, <span class="hljs-attr">fill</span>: Styles.Color})<font></font>
    .setOrigin(<span class="hljs-number">0.5</span>);<font></font>
<font></font>
    <span class="hljs-keyword">this</span>.add.text(
        <span class="hljs-keyword">this</span>.cameras.main.centerX,
        <span class="hljs-keyword">this</span>.cameras.main.centerY + <span class="hljs-number">100</span>,<font></font>
        Texts.Message,<font></font>
        {<span class="hljs-attr">font</span>: <span class="hljs-string">`28px <span class="hljs-subst">${Styles.Font}</span>`</span>, <span class="hljs-attr">fill</span>: Styles.Color})<font></font>
    .setOrigin(<span class="hljs-number">0.5</span>);<font></font>
}<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別の大規模なプロジェクトでは、テキストとスタイルをjsonロケールファイルまたは個別の構成に取り込むことができますが、現在は2行しかないため、この手順は冗長であり、この場合、生活を複雑にしないことをお勧めします。シーンファイルの冒頭のリストに限定します。</font></font><br>
<br>
<a name="section-2-4"></a><h3><font color="#008080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.4ゲームレベルへの移行</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
先に進む前にこのシーンで最後にすることは、マウスクリックイベントを追跡してプレーヤーをゲームに起動することです。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// StartScene.js</span>
<span class="hljs-comment">//...</span>
public create(): <span class="hljs-keyword">void</span> {
    <span class="hljs-comment">//...</span>
    <span class="hljs-keyword">this</span>.input.once(<span class="hljs-string">'pointerdown'</span>, () =&gt; {
        <span class="hljs-keyword">this</span>.scene.start(<span class="hljs-string">'Game'</span>);<font></font>
    });<font></font>
}<font></font>
<span class="hljs-comment">//...</span></code></pre><br>
<a name="section-2-5"></a><h3><font color="#008080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.5レベルのシーン</font></font></font></h3><br><font style="vertical-align: inherit;"></font><code>"Game"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドに渡さ</font><font style="vertical-align: inherit;">
れたパラメーター</font><font style="vertical-align: inherit;">から</font><font style="vertical-align: inherit;">判断すると、</font></font><code>this.scene.start</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メインのゲームロジックを処理する2番目のシーンを作成するときが来たと既に推測しています。</font><font style="vertical-align: inherit;">ファイルを作成します</font></font><code>src/scripts/scenes/GameScene.ts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GameScene</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Phaser</span>.<span class="hljs-title">Scene</span> </span>{
    <span class="hljs-keyword">constructor</span>() {
        <span class="hljs-keyword">super</span>(<span class="hljs-string">'Game'</span>);<font></font>
    }<font></font>
<font></font>
    public create(): <span class="hljs-keyword">void</span> {<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このシーンで</font></font><code>preload</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、</font><font style="vertical-align: inherit;">メソッド</font><font style="vertical-align: inherit;">は必要ありません。</font><font style="vertical-align: inherit;">前のシーンで必要なリソースをすべてロードしました。</font></font><br>
<br>
<a name="section-2-6"></a><h3><font color="#008080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.6エントリーポイントでのシーンの設定</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
両方のシーンが作成されたので、それらをエントリーポイントに追加します</font></font><br>
<code>src/scripts/index.ts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">//...</span>
<span class="hljs-keyword">import</span> { StartScene } <span class="hljs-keyword">from</span> <span class="hljs-string">"./scenes/StartScene"</span>;
<span class="hljs-keyword">import</span> { GameScene } <span class="hljs-keyword">from</span> <span class="hljs-string">"./scenes/GameScene"</span>;
<span class="hljs-comment">//...</span>
<span class="hljs-keyword">new</span> Phaser.Game({
    <span class="hljs-comment">// ...</span>
    <span class="hljs-attr">scene</span>: [StartScene, GameScene]<font></font>
});<font></font>
</code></pre><br>
<a name="section-3"></a><h2><font color="#008080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.ゲームオブジェクト</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、クラス</font></font><code>GameScene</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はゲームレベルのロジックを実装します。</font><font style="vertical-align: inherit;">そして、私たちはサッパーのゲームレベルに何を期待しますか？</font><font style="vertical-align: inherit;">視覚的には、閉じたセルのある競技場が表示されることを期待しています。</font><font style="vertical-align: inherit;">フィールドがテーブルであることはわかっています。つまり、フィールドには行と列がいくつかあり、その中に爆弾が快適に配置されます。</font><font style="vertical-align: inherit;">したがって、競技場を説明する別のエンティティを作成するのに十分な情報があります。</font></font><br>
<br>
<a name="section-3-1"></a><h3><font color="#008080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1ゲームボード</font></font></font></h3><br><font style="vertical-align: inherit;"></font><code>src/scripts/models/Board.ts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスを配置</font><font style="vertical-align: inherit;">
するファイル</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">作成します</font></font><code>Board</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { Field } <span class="hljs-keyword">from</span> <span class="hljs-string">"./Field"</span>;<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Board</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Phaser</span>.<span class="hljs-title">Events</span>.<span class="hljs-title">EventEmitter</span> </span>{<font></font>
    private _scene: Phaser.Scene = <span class="hljs-literal">null</span>;<font></font>
    private _rows: number = <span class="hljs-number">0</span>;<font></font>
    private _cols: number = <span class="hljs-number">0</span>;<font></font>
    private _bombs: number = <span class="hljs-number">0</span>;<font></font>
    private _fields: Field[] = [];<font></font>
<font></font>
    <span class="hljs-keyword">constructor</span>(scene: Phaser.Scene, rows: number, cols: number, bombs: number) {
        <span class="hljs-keyword">super</span>();
        <span class="hljs-keyword">this</span>._scene = scene;
        <span class="hljs-keyword">this</span>._rows = rows;
        <span class="hljs-keyword">this</span>._cols = cols;
        <span class="hljs-keyword">this</span>._bombs = bombs;
        <span class="hljs-keyword">this</span>._fields = [];<font></font>
    }<font></font>
<font></font>
    public <span class="hljs-keyword">get</span> <span class="hljs-title">cols</span>(): <span class="hljs-title">number</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._cols;<font></font>
    }<font></font>
    <font></font>
    public <span class="hljs-keyword">get</span> <span class="hljs-title">rows</span>(): <span class="hljs-title">number</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._rows;<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
イベントを登録して呼び出すためのインターフェイスにアクセスするために、クラスをPhaser.Events.EventEmitterの後継クラスにします。これは、将来必要になります。</font><font style="vertical-align: inherit;">クラスオブジェクト</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
の</font></font><code>_fields</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配列は</font><font style="vertical-align: inherit;">プライベートプロパティに</font><font style="vertical-align: inherit;">格納さ</font><font style="vertical-align: inherit;">れます</font></font><code>Field</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。このモデルは後で実装します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは、民間の数値プロパティを取得</font></font><code>_rows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">し、</font></font><code>_cols</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">競技場の行数と列数を指定します。私たちは、読書のための公共ゲッターを作成</font></font><code>_rows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">して</font></font><code>_cols</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フィールド</font></font><code>_bombs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、レベルのために生成する必要がある爆弾の数を教えてくれます。パラメータ</font></font><code>_scene</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で、ゲームシーンのオブジェクトへのリンクを渡し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">このオブジェクトで</font></font><code>GameScene</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスのインスタンスを作成します</font></font><code>Board</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらにビューに送信するためにのみシーンオブジェクトをモデルに転送し、ビューを表示するためにのみ使用することに注意してください。実際には、フェイザーはシーンオブジェクトを直接使用してスプライトをレンダリングするため、将来開発するスプライトのプレハブを作成するときに、現在のシーンへのリンクを提供する必要があります。また、表示エンジンとしてさらに使用するためにのみリンクをシーンに転送することに同意し、モデルとビューでシーンのカスタムメソッドを直接呼び出さないことに同意します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ボードを作成するためのインターフェイスを決定したら、レベルシーンで初期化してクラスを完成させることをお勧めします</font></font><code>GameScene</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="javascript hljs"> <span class="hljs-comment">// GameScene.ts</span>
<span class="hljs-keyword">import</span> { Board } <span class="hljs-keyword">from</span> <span class="hljs-string">"../models/Board"</span>;<font></font>
<font></font>
<span class="hljs-keyword">const</span> Rows = <span class="hljs-number">8</span>;
<span class="hljs-keyword">const</span> Cols = <span class="hljs-number">8</span>;
<span class="hljs-keyword">const</span> Bombs = <span class="hljs-number">8</span>;<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GameScene</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Phaser</span>.<span class="hljs-title">Scene</span> </span>{<font></font>
    private _board: Board = <span class="hljs-literal">null</span>;
    <span class="hljs-comment">//... </span>
    public create(): <span class="hljs-keyword">void</span> {
        <span class="hljs-keyword">this</span>._board = <span class="hljs-keyword">new</span> Board(<span class="hljs-keyword">this</span>, Rows, Cols, Bombs);<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
シーンファイルの先頭でボードパラメーターを定数に取り、</font></font><code>Board</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このクラスのインスタンスを作成するとき</font><font style="vertical-align: inherit;">にコンストラクター</font><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">渡します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<a name="section-3-2"></a><h3><font color="#008080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2セルモデル</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ボードは、画面に表示するセルで構成されています。</font><font style="vertical-align: inherit;">各セルは、行と列によって決定される対応する位置に配置する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
セルも個別のエンティティとして区別されます。</font></font><code>src/scripts/models/Field.ts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セルを記述するクラスを配置</font><font style="vertical-align: inherit;">するファイル</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">作成します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { Board } <span class="hljs-keyword">from</span> <span class="hljs-string">"./Board"</span>;<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Field</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Phaser</span>.<span class="hljs-title">Events</span>.<span class="hljs-title">EventEmitter</span> </span>{<font></font>
    private _scene: Phaser.Scene = <span class="hljs-literal">null</span>;<font></font>
    private _board: Board = <span class="hljs-literal">null</span>;<font></font>
    private _row: number = <span class="hljs-number">0</span>;<font></font>
    private _col: number = <span class="hljs-number">0</span>;<font></font>
<font></font>
    <span class="hljs-keyword">constructor</span>(scene: Phaser.Scene, board: Board, row: number, col: number) {
        <span class="hljs-keyword">super</span>();
        <span class="hljs-keyword">this</span>._init(scene, board, row, col);<font></font>
    }<font></font>
<font></font>
    public <span class="hljs-keyword">get</span> <span class="hljs-title">col</span>(): <span class="hljs-title">number</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._col;<font></font>
    }<font></font>
<font></font>
    public <span class="hljs-keyword">get</span> <span class="hljs-title">row</span>(): <span class="hljs-title">number</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._row;<font></font>
    }<font></font>
<font></font>
    public <span class="hljs-keyword">get</span> <span class="hljs-title">board</span>(): <span class="hljs-title">Board</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._board;<font></font>
    }<font></font>
<font></font>
    private _init(scene: Phaser.Scene, <span class="hljs-attr">board</span>: Board, <span class="hljs-attr">row</span>: number, <span class="hljs-attr">col</span>: number): <span class="hljs-keyword">void</span> {
        <span class="hljs-keyword">this</span>._scene = scene;
        <span class="hljs-keyword">this</span>._board = board;
        <span class="hljs-keyword">this</span>._row = row;
        <span class="hljs-keyword">this</span>._col = col;<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各セルには、セルが配置されている行と列のメトリックが必要です。</font><font style="vertical-align: inherit;">パラメータを設定</font></font><code>_board</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">し、</font></font><code>_scene</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オブジェクトのリファレンスボードやシーンを設定します。</font><font style="vertical-align: inherit;">私たちは、フィールドを読み取るためのゲッターを実装し</font></font><code>_row</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>_col</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして</font></font><code>_board</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<a name="section-3-3"></a><h3><font color="#008080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.3セルビュー</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
抽象セルが作成され、それを視覚化したいと思います。</font><font style="vertical-align: inherit;">画面にセルを表示するには、そのビューを作成する必要があります。</font><font style="vertical-align: inherit;">ファイル</font></font><code>src/scripts/views/FieldView.ts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">作成し、</font><font style="vertical-align: inherit;">その中にビュークラスを配置します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { Field } <span class="hljs-keyword">from</span> <span class="hljs-string">"../models/Field"</span>;<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FieldView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Phaser</span>.<span class="hljs-title">GameObjects</span>.<span class="hljs-title">Sprite</span> </span>{<font></font>
    private _model: Field = <span class="hljs-literal">null</span>;<font></font>
<font></font>
    <span class="hljs-keyword">constructor</span>(scene: Phaser.Scene, model: Field) {
        <span class="hljs-keyword">super</span>(scene, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">'spritesheet'</span>, <span class="hljs-string">'closed'</span>);
        <span class="hljs-keyword">this</span>._model = model;
        <span class="hljs-keyword">this</span>._init();
        <span class="hljs-keyword">this</span>._create();<font></font>
    }<font></font>
<font></font>
    private _init(): <span class="hljs-keyword">void</span> {<font></font>
    }<font></font>
<font></font>
    private _create(): <span class="hljs-keyword">void</span> {<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このクラスを相続人にしたことに注意してください</font></font><code>Phaser.GameObjects.Sprite</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">フェイザー用語では、このクラスはスプライトプレハブになりました。</font><font style="vertical-align: inherit;">つまり、スプライトのゲームオブジェクトの機能を受け取りました。これは、独自のメソッドでさらに拡張します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このクラスのコンストラクタを見てみましょう。</font><font style="vertical-align: inherit;">ここでは、まず、次のパラメーターセットを使用して親クラスのコンストラクターを呼び出す必要があります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シーンオブジェクトへのリンク（セクション3.1で警告：フェイザーでは、スプライトをレンダリングするために現在のシーンにリンクする必要があります）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">座標</font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キャンバス</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アトラスを使用できる文字列キー。これは、</font></font><code>preload</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シーン</font><font style="vertical-align: inherit;">の</font><font style="vertical-align: inherit;">開始</font><font style="vertical-align: inherit;">メソッドでロードしました</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スプライトを表示するために選択するこのアトラスのフレーム文字列キー</font></font></li>
</ul><br><font style="vertical-align: inherit;"></font><code>Field</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プライベートプロパティで</font><font style="vertical-align: inherit;">
モデル（つまり、クラスのインスタンス）への参照を設定し</font><font style="vertical-align: inherit;">ます</font></font><code>_model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、2つの現在空のメソッド</font></font><code>_init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">慎重に開始しました</font></font><code>_create</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が、少し後で実装します。</font></font><br>
<br>
<a name="section-3-4"></a><h3><font color="#008080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4ビュークラスでスプライトを作成する</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、ビューは作成されましたが、スプライトを描画する方法がまだわかりません。</font><font style="vertical-align: inherit;">必要なフレームを持つスプライトをキャンバスに配置するには、独自のプライベートメソッドを変更する必要があります</font></font><code>_create</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// FieldView.js</span>
<span class="hljs-comment">//...</span>
private _create(): <span class="hljs-keyword">void</span> {
    <span class="hljs-keyword">this</span>.scene.add.existing(<span class="hljs-keyword">this</span>); <span class="hljs-comment">//     </span>
    <span class="hljs-keyword">this</span>.setOrigin(<span class="hljs-number">0.5</span>); <span class="hljs-comment">//  pivot point   </span><font></font>
}<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br>
<a name="section-3-5"></a><h3><font color="#008080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.5スプライトの配置</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現時点では、作成されたすべてのスプライトは、キャンバスの座標（0、0）に配置されます。</font><font style="vertical-align: inherit;">また、各セルをボード上の対応する位置に配置する必要があります。</font><font style="vertical-align: inherit;">つまり、このセルの行と列に対応する場所です。</font><font style="vertical-align: inherit;">これを行うには、クラスの各インスタンスの座標を計算するためのコードを記述する必要があります</font></font><code>FieldView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">プレイフィールド上のセルの最終座標を担当</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
するクラスにプロパティを追加</font></font><code>_position</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// FieldView.ts</span>
<span class="hljs-comment">//...</span>
interface Vec2 {<span class="hljs-attr">x</span>: number, <span class="hljs-attr">y</span>: number};<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FieldView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Phaser</span>.<span class="hljs-title">GameObjects</span>.<span class="hljs-title">Sprite</span> </span>{<font></font>
    private _position: Vec2 = {<span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>};
    <span class="hljs-comment">//...</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
画面の中心を基準にしてボードとその中のセルを整列させたいので、画面</font></font><code>_offset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の左端と上端に対するこの特定のセルのオフセットを示す</font><font style="vertical-align: inherit;">プロパティも必要</font><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">プライベートゲッターを使用して追加します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// FieldView.ts</span>
<span class="hljs-comment">//...</span>
    private <span class="hljs-keyword">get</span> <span class="hljs-title">_offset</span>(): <span class="hljs-title">Vec2</span> {
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">x</span>: (<span class="hljs-keyword">this</span>.scene.cameras.main.width - <span class="hljs-keyword">this</span>._model.board.cols * <span class="hljs-keyword">this</span>.width) / <span class="hljs-number">2</span>,
            <span class="hljs-attr">y</span>: (<span class="hljs-keyword">this</span>.scene.cameras.main.height - <span class="hljs-keyword">this</span>._model.board.rows * <span class="hljs-keyword">this</span>.height) / <span class="hljs-number">2</span><font></font>
        };<font></font>
    }<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、我々は：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で画面全体の幅を取得しました</font></font><code>this._scene.cameras.main.width</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">単一のセルの幅にセルの数を掛けて、ボードの合計幅を受け取りました：</font></font><code>this._board.cols * this.width</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">画面の幅からボードの幅を取り除いて、ボード上ではなく、画面上の場所を得ました。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結果の数値を2で割ると、ボードの左と右のインデント値がわかります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このインデントの値で各セルをシフトすることにより、ボード全体が軸に沿って整列することを保証します</font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
垂直変位を取得するために、まったく同じようなアクションを実行します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メソッドに必要なコードを追加するために残ります</font></font><code>_init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// FieldView.ts</span>
<span class="hljs-comment">// ...</span>
private _init(): <span class="hljs-keyword">void</span> {
    <span class="hljs-keyword">const</span> offset = <span class="hljs-keyword">this</span>._offset;
    <span class="hljs-keyword">this</span>.x = <span class="hljs-keyword">this</span>._position.x = offset.x + <span class="hljs-keyword">this</span>.width * <span class="hljs-keyword">this</span>._model.col + <span class="hljs-keyword">this</span>.width / <span class="hljs-number">2</span>;
    <span class="hljs-keyword">this</span>.y = <span class="hljs-keyword">this</span>._position.y = offset.y + <span class="hljs-keyword">this</span>.height * <span class="hljs-keyword">this</span>._model.row + <span class="hljs-keyword">this</span>.height / <span class="hljs-number">2</span>;<font></font>
}<font></font>
<span class="hljs-comment">// ...</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロパティは</font></font><code>this.x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>this.y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>this.width</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして</font></font><code>this.height</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここで-それは、親クラスのプロパティを継承しています</font></font><code>Phaser.GameObjects.Sprite</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">プロパティ</font></font><code>this.x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">変更する</font><font style="vertical-align: inherit;">と</font></font><code>this.y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、キャンバス上でスプライトが正しく配置されます。</font></font><br>
<br>
<a name="section-3-6"></a><h3><font color="#008080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.6 FieldViewインスタンスの作成</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスにビューを作成します</font></font><code>Field</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// Field.ts</span>
<span class="hljs-comment">// ...</span>
private _view: FieldView = <span class="hljs-literal">null</span>;<font></font>
<font></font>
public <span class="hljs-keyword">get</span> <span class="hljs-title">view</span>(): <span class="hljs-title">FieldView</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._view;<font></font>
}<font></font>
<font></font>
private _init(scene: Phaser.Scene, <span class="hljs-attr">board</span>: Board, <span class="hljs-attr">row</span>: number, <span class="hljs-attr">col</span>: number): <span class="hljs-keyword">void</span> {
    <span class="hljs-comment">//...</span>
    <span class="hljs-keyword">this</span>._view = <span class="hljs-keyword">new</span> FieldView(<span class="hljs-keyword">this</span>._scene, <span class="hljs-keyword">this</span>);<font></font>
}<font></font>
<span class="hljs-comment">// ...</span>
</code></pre><br>
<a name="section-3-7"></a><h3><font color="#008080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.7掲示板フィールド。</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスに戻りましょう</font></font><code>Board</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。これは基本的にクラスオブジェクトのコレクションで</font></font><code>Field</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あり、セルの作成に従事します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別のメソッドでボードを作成するためのコードを取り出し</font></font><code>_create</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、コンストラクターからこのメソッドを呼び出します。</font><font style="vertical-align: inherit;">このメソッド</font></font><code>_create</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ではセルを作成するだけでなく、別のメソッドでセルを作成するためのコードを取り出します</font></font><code>_createFields</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// Board.ts</span>
<span class="hljs-keyword">constructor</span>(scene: Phaser.Scene, rows: number, cols: number, bombs: number) {
    <span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">this</span>._create();<font></font>
}<font></font>
<font></font>
private _create(): <span class="hljs-keyword">void</span> {
    <span class="hljs-keyword">this</span>._createFields();<font></font>
}<font></font>
<font></font>
private _createFields(): <span class="hljs-keyword">void</span> {<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このメソッドでは、ネストされたループに必要な数のセルを作成します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// Board.ts</span>
<span class="hljs-comment">// ...</span>
private _createFields(): <span class="hljs-keyword">void</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> row = <span class="hljs-number">0</span>; row &lt; <span class="hljs-keyword">this</span>._rows; row++) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> col = <span class="hljs-number">0</span>; col &lt; <span class="hljs-keyword">this</span>._cols; col++) {
            <span class="hljs-keyword">this</span>._fields.push(<span class="hljs-keyword">new</span> Field(<span class="hljs-keyword">this</span>._scene, <span class="hljs-keyword">this</span>, row, col));<font></font>
        }<font></font>
    }<font></font>
}<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コマンドでデバッグするためのアセンブリを実行するのは初めてです </font></font><br>
<br>
<pre><code class="plaintext hljs">npm start</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
画面の中央に、8行に64セルが表示されることが予想されることを確認してください。</font></font><br>
<br>
<a name="section-3-8"></a><h3><font color="#008080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.8爆弾を作る</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以前、</font></font><code>_create</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラス</font><font style="vertical-align: inherit;">メソッド</font></font><code>Board</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ではフィールドを作成するだけではない</font><font style="vertical-align: inherit;">ことを報告しました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ほかに何か？</font><font style="vertical-align: inherit;">爆弾が作成され、作成されたセルが隣接する爆弾の数の値に設定されます。</font><font style="vertical-align: inherit;">爆弾そのものから始めましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N個の爆弾をボード上のランダムなセルに配置する必要があります。</font><font style="vertical-align: inherit;">近似アルゴリズムで爆弾を作成するプロセスについて説明します。</font></font><br>
<br>
<pre><code class="plaintext hljs">    <font></font>
     <font></font>
      <font></font>
       <font></font>
           <font></font>
          <font></font>
</code></pre><br><font style="vertical-align: inherit;"></font><code>this._fields</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールド</font></font><code>this._bombs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">示されている数の爆弾を作成している限り</font><font style="vertical-align: inherit;">
、ループの各反復でランダムなプロパティボックスを取得します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">受け取ったセルが空の場合は、その中に爆弾を設置し、生成に必要な爆弾のカウンターを更新します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
乱数を生成するには、静的メソッドを使用します</font></font><code>Phaser.Math.Between</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// Board.ts</span>
<span class="hljs-comment">//...</span>
private _createBombs(): <span class="hljs-keyword">void</span> {
    <span class="hljs-keyword">let</span> count = <span class="hljs-keyword">this</span>._bombs; <span class="hljs-comment">//     </span><font></font>
<font></font>
    <span class="hljs-keyword">while</span> (count &gt; <span class="hljs-number">0</span>) { <span class="hljs-comment">//      </span>
        <span class="hljs-keyword">let</span> field = <span class="hljs-keyword">this</span>._fields[Phaser.Math.Between(<span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>._fields.length - <span class="hljs-number">1</span>)]; <span class="hljs-comment">//   </span><font></font>
<font></font>
        <span class="hljs-keyword">if</span> (field.empty) { <span class="hljs-comment">//    </span>
            field.setBomb(); <span class="hljs-comment">//    </span>
            --count; <span class="hljs-comment">//   </span><font></font>
        }<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイル</font><font style="vertical-align: inherit;">のメソッドの最後に</font></font><code>Board.ts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼び出し</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">記述する</font><font style="vertical-align: inherit;">ことを忘れないでください。</font><font style="vertical-align: inherit;">
すでにお気づきのとおり、このコードが正しく機能するためには、クラスに</font><font style="vertical-align: inherit;">ゲッター</font><font style="vertical-align: inherit;">とメソッドを</font><font style="vertical-align: inherit;">追加</font><font style="vertical-align: inherit;">してクラスを改良する必要があります</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">セルの内容を制御する</font><font style="vertical-align: inherit;">
クラスに</font><font style="vertical-align: inherit;">プライベートフィールド</font><font style="vertical-align: inherit;">を追加し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">以下の契約に同意します。</font></font><code>this._createBombs();</code><font style="vertical-align: inherit;"></font><code>_create</code><br>
<br><font style="vertical-align: inherit;"></font><code>Field</code><font style="vertical-align: inherit;"></font><code>empty</code><font style="vertical-align: inherit;"></font><code>setBomb</code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><code>Field</code><font style="vertical-align: inherit;"></font><code>_value</code><font style="vertical-align: inherit;"></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><code>_value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> === 0 </font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セルは空であり、その中に地雷や値はありません</font></font></td>
</tr>
<tr>
<td><code>_value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> === -1 </font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セルに地雷があります</font></font></td>
</tr>
<tr>
<td><code>_value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &gt; 0 </font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セル内は、現在のセルの隣にある地雷の数です</font></font></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのルールに従って、</font></font><code>Field</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロパティを操作</font><font style="vertical-align: inherit;">するクラス内の</font><font style="vertical-align: inherit;">メソッド</font><font style="vertical-align: inherit;">を開発</font><font style="vertical-align: inherit;">します</font></font><code>_value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// Field.ts</span>
<span class="hljs-comment">// ...</span>
private _value: number = <span class="hljs-number">0</span>;
<span class="hljs-comment">// ...</span>
public <span class="hljs-keyword">get</span> <span class="hljs-title">value</span>(): <span class="hljs-title">number</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._value;<font></font>
}<font></font>
<font></font>
public <span class="hljs-keyword">set</span> <span class="hljs-title">value</span>(<span class="hljs-params">value</span>) {
    <span class="hljs-keyword">this</span>._value = value;<font></font>
}<font></font>
<font></font>
public <span class="hljs-keyword">get</span> <span class="hljs-title">empty</span>(): <span class="hljs-title">boolean</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._value === <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
public <span class="hljs-keyword">get</span> <span class="hljs-title">mined</span>(): <span class="hljs-title">boolean</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._value === <span class="hljs-number">-1</span>;<font></font>
}<font></font>
<font></font>
public <span class="hljs-keyword">get</span> <span class="hljs-title">filled</span>(): <span class="hljs-title">boolean</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._value &gt; <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
public setBomb(): <span class="hljs-keyword">void</span> {
    <span class="hljs-keyword">this</span>._value = <span class="hljs-number">-1</span>;<font></font>
}<font></font>
<span class="hljs-comment">// ...</span>
</code></pre><br>
<a name="section-3-9"></a><h3><font color="#008080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.9設定値</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
爆弾が配置され、それを必要とするすべてのセルに数値を設定するためのすべてのデータが揃いました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サッパーのルールによれば、セルにはこのセルの隣にある爆弾の数に対応する番号が必要です。</font><font style="vertical-align: inherit;">このルールに基づいて、対応する疑似コードを記述します。</font></font><br>
<br>
<pre><code class="plaintext hljs">    <font></font>
        <font></font>
           <font></font>
                <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスで</font></font><code>Board</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、新しいメソッドを作成し、指定された疑似コードを実際のコードに変換します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// Board.ts</span>
<span class="hljs-comment">//...</span><font></font>
private _createValues() {<font></font>
    <span class="hljs-comment">//     </span>
    <span class="hljs-keyword">this</span>._fields.forEach(<span class="hljs-function"><span class="hljs-params">field</span> =&gt;</span> {
        <span class="hljs-comment">//     </span>
        <span class="hljs-keyword">if</span> (field.mined) {
            <span class="hljs-comment">//    </span>
            field.getClosestFields().forEach(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
                <span class="hljs-comment">//     </span>
                <span class="hljs-keyword">if</span> (item.value &gt;= <span class="hljs-number">0</span>) {<font></font>
                    ++item.value;<font></font>
                }<font></font>
            });<font></font>
        }<font></font>
    });<font></font>
}<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちが使用するどのインターフェースが実装されていないか見てみましょう。</font></font><code>getClosestFields</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">隣接するセルを取得する</font><font style="vertical-align: inherit;">メソッドを追加する必要があり</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
隣接するセルを識別する方法は？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、端にない、つまり極端な行にも極端な列にもないボードのセルを考えます。</font><font style="vertical-align: inherit;">このようなセルには、隣接するセルの最大数があります。上部に1つ、下部に1つ、左側に3つ、右側に3つ（対角線上のセルを含む）です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このように、各隣接セル指標の</font></font><code>_row</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>_col</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちは事前に違いパラメータに指定できること以上1.これによって違いはありません</font></font><code>_row</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">し、</font></font><code>_col</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">現在のフィールドを。</font><font style="vertical-align: inherit;">ファイルの先頭にあるクラスの説明に定数を追加します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// Field.ts</span>
<span class="hljs-keyword">const</span> Positions = [<font></font>
    {<span class="hljs-attr">row</span> : <span class="hljs-number">0</span>, <span class="hljs-attr">col</span> : <span class="hljs-number">1</span>}, <span class="hljs-comment">// </span>
    {<span class="hljs-attr">row</span> : <span class="hljs-number">0</span>, <span class="hljs-attr">col</span> : <span class="hljs-number">-1</span>}, <span class="hljs-comment">// </span>
    {<span class="hljs-attr">row</span> : <span class="hljs-number">1</span>, <span class="hljs-attr">col</span> : <span class="hljs-number">0</span>}, <span class="hljs-comment">// </span>
    {<span class="hljs-attr">row</span> : <span class="hljs-number">1</span>, <span class="hljs-attr">col</span> : <span class="hljs-number">1</span>}, <span class="hljs-comment">//  </span>
    {<span class="hljs-attr">row</span> : <span class="hljs-number">1</span>, <span class="hljs-attr">col</span> : <span class="hljs-number">-1</span>}, <span class="hljs-comment">//  </span>
    {<span class="hljs-attr">row</span> : <span class="hljs-number">-1</span>, <span class="hljs-attr">col</span> : <span class="hljs-number">0</span>}, <span class="hljs-comment">// </span>
    {<span class="hljs-attr">row</span> : <span class="hljs-number">-1</span>, <span class="hljs-attr">col</span> : <span class="hljs-number">1</span>}, <span class="hljs-comment">//  </span>
    {<span class="hljs-attr">row</span> : <span class="hljs-number">-1</span>, <span class="hljs-attr">col</span> : <span class="hljs-number">-1</span>} <span class="hljs-comment">//  </span><font></font>
];<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、不足しているメソッドを追加します。この配列をループします。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// Field.ts</span>
<span class="hljs-comment">//...</span><font></font>
public getClosestFields(): Field[] {<font></font>
    <span class="hljs-keyword">let</span> results = [];<font></font>
<font></font>
    <span class="hljs-comment">//     </span>
    Positions.forEach(<span class="hljs-function"><span class="hljs-params">position</span> =&gt;</span> {
        <span class="hljs-comment">//     </span>
        <span class="hljs-keyword">let</span> field = <span class="hljs-keyword">this</span>._board.getField(<span class="hljs-keyword">this</span>._row + position.row, <span class="hljs-keyword">this</span>._col + position.col);<font></font>
<font></font>
        <span class="hljs-comment">//      </span>
        <span class="hljs-keyword">if</span> (field) {
            <span class="hljs-comment">//    </span><font></font>
            results.push(field);<font></font>
        }<font></font>
    });<font></font>
<font></font>
    <span class="hljs-keyword">return</span> results;<font></font>
};<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br><font style="vertical-align: inherit;"></font><code>field</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ボード上のすべてのセルに8つの隣接セルがあるわけではないため、各反復で</font><font style="vertical-align: inherit;">
変数を確認することを忘れないでください</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">たとえば、左上のセルには、その左に隣接セルはありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メソッドを実装</font><font style="vertical-align: inherit;">し、クラスの</font></font><code>getField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッド</font></font><code>_create</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">必要なすべての呼び出しを追加する</font><font style="vertical-align: inherit;">ことは残り</font><font style="vertical-align: inherit;">ます</font></font><code>Board</code><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// Board.ts</span>
<span class="hljs-comment">//...</span>
public getField(row: number, <span class="hljs-attr">col</span>: number): Field {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._fields.find(<span class="hljs-function"><span class="hljs-params">field</span> =&gt;</span> field.row === row &amp;&amp; field.col === col);<font></font>
}<font></font>
<span class="hljs-comment">//...</span>
private _create(): <span class="hljs-keyword">void</span> {
    <span class="hljs-keyword">this</span>._createFields();
    <span class="hljs-keyword">this</span>._createBombs();
    <span class="hljs-keyword">this</span>._createValues(); <font></font>
}<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br>
<a name="section-4"></a><h2><font color="#008080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.入力イベ​​ントの処理</font></font></font></h2><br>
<a name="section-4-1"></a><h3><font color="#008080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.1マウスクリックイベントの追跡</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現時点では、ボードは完全に初期化されており、爆弾があり、数字のセルがありますが、現在すべて閉じられており、それらを開く方法はありません。</font><font style="vertical-align: inherit;">これを修正し、マウスの左ボタンをクリックしてセルを開くことを実装します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、このクリックを追跡する必要があります。</font><font style="vertical-align: inherit;">クラスで</font></font><code>FieldView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>_create</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次のコード</font><font style="vertical-align: inherit;">をメソッドの最後に追加し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// FielView.ts</span>
<span class="hljs-comment">//...</span>
private _create(): <span class="hljs-keyword">void</span> {
    <span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">this</span>.setInteractive();<font></font>
}<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フェイザーでは、オブジェクトを名前空間からさまざまなイベントにサブスクライブできます</font></font><code>Phaser.GameObjects</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。特に、クリックイベント（</font></font><code>pointerdown</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）、スプライト自体のプレハブ、つまり</font></font><code>FieldView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">から継承され</font><font style="vertical-align: inherit;">たクラスのオブジェクトを</font><font style="vertical-align: inherit;">サブスクライブします</font></font><code>Phaser.GameObjects.Sprite</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、これを行う前に、スプライトが潜在的にインタラクティブであること、つまり、一般的にユーザー入力をリッスンする必要があることを明示する必要があります。</font></font><code>setInteractive</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上記の例で行ったように、スプライト自体にパラメーターなしで</font><font style="vertical-align: inherit;">メソッド</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">呼び出すことにより、これを行う必要があり</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スプライトがインタラクティブになっ</font></font><code>Board</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">たので、新しいモデルオブジェクトが作成された場所</font><font style="vertical-align: inherit;">のクラス</font></font><code>Field</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、つまりメソッドに</font><font style="vertical-align: inherit;">戻り</font></font><code>_createFields</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ビューの入力イベントのコールバックを登録します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// Board.ts</span>
<span class="hljs-comment">//...</span>
private _createFields(): <span class="hljs-keyword">void</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> row = <span class="hljs-number">0</span>; row &lt; <span class="hljs-keyword">this</span>._rows; row++) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> col = <span class="hljs-number">0</span>; col &lt; <span class="hljs-keyword">this</span>._cols; col++) {
            <span class="hljs-keyword">const</span> field = <span class="hljs-keyword">new</span> Field(<span class="hljs-keyword">this</span>._scene, <span class="hljs-keyword">this</span>, row, col)<font></font>
            field.view.on(<span class="hljs-string">'pointerdown'</span>, <span class="hljs-keyword">this</span>._onFieldClick.bind(<span class="hljs-keyword">this</span>, field));
            <span class="hljs-keyword">this</span>._fields.push(field);<font></font>
        }<font></font>
    }<font></font>
}<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スプライトをクリックしてメソッドを実行すること</font></font><code>_onFieldClick</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を確認したら、それを実装する必要があります。ただし、クリック処理のロジックはクラスから削除します</font></font><code>Board</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。入力に応じてモデルを処理し、それに応じて別のコントローラーでデータを変更するほうがよいと考えられています。類似性はゲームシーンのクラスです</font></font><code>GameScene</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。したがって、クラス</font></font><code>Board</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">からシーン自体に</font><font style="vertical-align: inherit;">クリックイベントをさらに転送する必要があります</font><font style="vertical-align: inherit;">。したがって、次のようにします。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// Board.ts</span>
<span class="hljs-comment">//...</span>
private _onFieldClick(field: Field, <span class="hljs-attr">pointer</span>: Phaser.Input.Pointer): <span class="hljs-keyword">void</span> {
    <span class="hljs-keyword">if</span> (pointer.leftButtonDown()) {
        <span class="hljs-keyword">this</span>.emit(<span class="hljs-string">`left-click`</span>, field);<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pointer.rightButtonDown()) {
        <span class="hljs-keyword">this</span>.emit(<span class="hljs-string">`right-click`</span>, field);<font></font>
    }<font></font>
}<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、クリックイベントをそのまま転送するだけでなく、クリックの種類も指定します。</font><font style="vertical-align: inherit;">これは、シーンクラスで各オプションを異なる方法で処理するときに将来的に役立ちます。</font><font style="vertical-align: inherit;">もちろん、クリックイベントをそのまま送信することも可能ですが、シーンコードを簡略化して、イベント自体に関するロジックの一部をクラスに残し</font></font><code>Field</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さて、ゲームシーンのクラスに戻って、</font><font style="vertical-align: inherit;">セルのクリックのイベントを追跡</font></font><code>GameScene</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">する</font></font><code>_create</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コード</font><font style="vertical-align: inherit;">をメソッドの最後に追加し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// Board.ts</span>
<span class="hljs-comment">//...</span>
<span class="hljs-keyword">import</span> { Field } <span class="hljs-keyword">from</span> <span class="hljs-string">"../models/Field"</span>;
<span class="hljs-comment">//...</span>
public create(): <span class="hljs-keyword">void</span> {
    <span class="hljs-keyword">this</span>._board = <span class="hljs-keyword">new</span> Board(<span class="hljs-keyword">this</span>, Rows, Cols, Bombs);
    <span class="hljs-keyword">this</span>._board.on(<span class="hljs-string">'left-click'</span>, <span class="hljs-keyword">this</span>._onFieldClickLeft, <span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">this</span>._board.on(<span class="hljs-string">'right-click'</span>, <span class="hljs-keyword">this</span>._onFieldClickRight, <span class="hljs-keyword">this</span>);<font></font>
}<font></font>
<font></font>
private _onFieldClickLeft(field: Field): <span class="hljs-keyword">void</span> {<font></font>
}<font></font>
<font></font>
private _onFieldClickRight(field: Field): <span class="hljs-keyword">void</span> {<font></font>
}<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br>
<a name="section-4-2"></a><h3><font color="#008080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.2。</font><font style="vertical-align: inherit;">左クリック処理</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マウスクリックイベントの処理を実装します。</font><font style="vertical-align: inherit;">そして、セルを開くことから始めます。</font><font style="vertical-align: inherit;">セルは、左ボタンを押すことによって開かれるはずです。</font><font style="vertical-align: inherit;">プログラミングを開始する前に、満たす必要がある条件を説明しましょう。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">閉じたセルをクリックすると、開く必要があります</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オープンセルに地雷がある場合-ゲームは失われます</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オープンセルに地雷または値がない場合、隣接するセルには地雷がありません。その場合、隣接するすべてのセルを開き、値がオープンセルに表示されるまでそれを続ける必要があります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">開いているセルをクリックすると、すべてのフラグが正しく設定されているかどうかを確認し、正しく設定されている場合は、勝利してゲームを終了します</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして今、必要な機能の理解を簡単にするために、上記のロジックを疑似コードに変換します。</font></font><br>
<br>
<pre><code class="plaintext hljs">  <font></font>
        <font></font>
         <font></font>
            <font></font>
          <font></font>
             <font></font>
  <font></font>
         <font></font>
         <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、何をプログラムする必要があるかを理解できました。</font><font style="vertical-align: inherit;">メソッドを実装します</font></font><code>_onFieldClickLeft</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// GameScene.ts</span>
<span class="hljs-comment">//...</span>
private _onFieldClickLeft(field: Field): <span class="hljs-keyword">void</span> {
    <span class="hljs-keyword">if</span> (field.closed) { <span class="hljs-comment">//   </span>
        field.open(); <span class="hljs-comment">//  </span><font></font>
<font></font>
        <span class="hljs-keyword">if</span> (field.mined) { <span class="hljs-comment">//   </span>
            field.exploded = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">this</span>._onGameOver(<span class="hljs-literal">false</span>); <span class="hljs-comment">//  </span>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (field.empty) { <span class="hljs-comment">//   </span>
            <span class="hljs-keyword">this</span>._board.openClosestFields(field); <span class="hljs-comment">//  </span><font></font>
        }<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (field.opened) { <span class="hljs-comment">//   </span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._board.completed) { <span class="hljs-comment">//      </span>
            <span class="hljs-keyword">this</span>._onGameOver(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span><font></font>
        }<font></font>
    }<font></font>
}<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、いつものように、クラスを完成</font><font style="vertical-align: inherit;">させ、ハンドラーで呼び出す</font><font style="vertical-align: inherit;">クラス</font><font style="vertical-align: inherit;">内のメソッド</font></font><code>Field</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font></font><code>Board</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実装します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
列挙型</font></font><code>States</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">セルの3つの可能な状態を示し</font><font style="vertical-align: inherit;">、フィールド</font></font><code>_state</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">追加し、</font><font style="vertical-align: inherit;">可能な各状態に対してゲッターを実装します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// Field.ts</span><font></font>
enum States {<font></font>
   Closed = <span class="hljs-string">'closed'</span>,<font></font>
   Opened = <span class="hljs-string">'opened'</span>,<font></font>
   Marked = <span class="hljs-string">'flag'</span><font></font>
};<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Field</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Phaser</span>.<span class="hljs-title">Events</span>.<span class="hljs-title">EventEmitter</span> </span>{<font></font>
    private _state: string = States.Closed;<font></font>
    <span class="hljs-comment">//...</span>
    public <span class="hljs-keyword">get</span> <span class="hljs-title">marked</span>(): <span class="hljs-title">boolean</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._state === States.Marked;<font></font>
    }<font></font>
<font></font>
    public <span class="hljs-keyword">get</span> <span class="hljs-title">closed</span>(): <span class="hljs-title">boolean</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._state === States.Closed;<font></font>
    }<font></font>
<font></font>
    public <span class="hljs-keyword">get</span> <span class="hljs-title">opened</span>(): <span class="hljs-title">boolean</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._state === States.Opened;<font></font>
    }<font></font>
 <span class="hljs-comment">//...</span>
 </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
セルが閉じているかどうかを示す</font></font><code>open</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状態が得られたので、状態を変更</font><font style="vertical-align: inherit;">するメソッド</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">追加でき</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// Field.ts</span>
<span class="hljs-comment">//...</span>
public open(): <span class="hljs-keyword">void</span> {
    <span class="hljs-keyword">this</span>._setState(States.Opened);<font></font>
}<font></font>
<font></font>
private _setState(state: string): <span class="hljs-keyword">void</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._state !== state) {
        <span class="hljs-keyword">this</span>._state = state;
        <span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'change'</span>);<font></font>
    }<font></font>
}<font></font>
<span class="hljs-comment">//...</span>
 </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
モデルの状態が変化するたびに、これを報告するイベントがトリガーされます。</font><font style="vertical-align: inherit;">したがって、</font></font><code>_setState</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状態変更のロジック全体を実装する</font><font style="vertical-align: inherit;">プライベートメソッド</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">追加し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">このメソッドは、モデルのすべてのパブリックメソッドで呼び出され、状態を変更する必要があります。</font><font style="vertical-align: inherit;">爆破されたFieldオブジェクトを正確に明示する</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ブールフラグ</font></font><code>_exploded</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">追加し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// Field.ts</span>
private _exploded: boolean = <span class="hljs-literal">false</span>;
<span class="hljs-comment">//...</span>
public <span class="hljs-keyword">set</span> <span class="hljs-title">exploded</span>(<span class="hljs-params">exploded: boolean</span>) {
    <span class="hljs-keyword">this</span>._exploded = exploded;
    <span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'change'</span>);<font></font>
}<font></font>
public <span class="hljs-keyword">get</span> <span class="hljs-title">exploded</span>(): <span class="hljs-title">boolean</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._exploded;<font></font>
}<font></font>
<span class="hljs-comment">//...</span>
 </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次にクラス</font></font><code>Board</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">開き、</font><font style="vertical-align: inherit;">その中にメソッドを実装します</font></font><code>openClosestFields</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このメソッドは再帰的であり、そのタスクは、パラメーターで受け入れられたセルに関連するすべての空の隣接フィールドを開くことです。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アルゴリズムは次のようになります。</font></font><br>
<br>
<pre><code class="plaintext hljs"> :<font></font>
       <font></font>
          <font></font>
             <font></font>
              <font></font>
                   <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今回は、このメソッドの完全な実装に必要なすべてのインターフェースがすでにあります。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// Board.ts</span>
<span class="hljs-comment">//...</span>
public openClosestFields(field: Field): <span class="hljs-keyword">void</span> {<font></font>
    field.getClosestFields().forEach(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {<span class="hljs-comment">//    </span>
        <span class="hljs-keyword">if</span> (item.closed) {<span class="hljs-comment">//   </span>
            item.open();<span class="hljs-comment">//  </span><font></font>
<font></font>
            <span class="hljs-keyword">if</span> (item.empty) {<span class="hljs-comment">//   </span>
                <span class="hljs-keyword">this</span>.openClosestFields(item);<span class="hljs-comment">//    </span><font></font>
            }<font></font>
        }<font></font>
    });<font></font>
}<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ボード上のフラグの正しい配置を示す</font><font style="vertical-align: inherit;">
ゲッター</font></font><code>completed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をクラス</font></font><code>Board</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">追加</font><font style="vertical-align: inherit;">します。</font><font style="vertical-align: inherit;">ボードが正常にクリアされたかどうかをどのように判断できますか？</font><font style="vertical-align: inherit;">正しくマークされたフィールドの数は、ボード上の爆弾の総数と等しくなければなりません。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// Board.ts</span>
<span class="hljs-comment">//...</span>
public <span class="hljs-keyword">get</span> <span class="hljs-title">completed</span>(): <span class="hljs-title">boolean</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._fields.filter(<span class="hljs-function"><span class="hljs-params">field</span> =&gt;</span> field.completed).length === <span class="hljs-keyword">this</span>._bombs;<font></font>
}<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このメソッド</font><font style="vertical-align: inherit;">は、フィールドマークの有効性を示す</font></font><code>_fields</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">getter </font></font><code>completed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">配列をフィルタリングし</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">フィルターされた配列（正しくマークされたフィールドのみが含まれ、ゲッターが</font></font><code>completed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">既にクラスを</font><font style="vertical-align: inherit;">担当</font><font style="vertical-align: inherit;">している</font></font><code>Field</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）の長さがフィールド値</font></font><code>_bombs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（つまり、ボード上の爆弾の数</font><font style="vertical-align: inherit;">）と等しい場合</font><font style="vertical-align: inherit;">、を返し</font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。つまり、ゲームが勝ったと見なします。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、レベルの最後に行う必要がある1回の呼び出しでボード全体を開く機会を気にしません。</font><font style="vertical-align: inherit;">また、この機能をクラスに追加します</font></font><code>Board</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// Board.ts</span>
<span class="hljs-comment">//...</span>
public open(): <span class="hljs-keyword">void</span> {
    <span class="hljs-keyword">this</span>._fields.forEach(<span class="hljs-function"><span class="hljs-params">field</span> =&gt;</span> field.open());<font></font>
}<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br><font style="vertical-align: inherit;"></font><code>completed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラス自体に</font><font style="vertical-align: inherit;">
ゲッターを追加することは残り</font><font style="vertical-align: inherit;">ます</font></font><code>Field</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">どの場合、フィールドは正常にクリアされたと見なされますか？</font><font style="vertical-align: inherit;">採掘され、フラグが付けられている場合。</font><font style="vertical-align: inherit;">両方の必要なゲッターがすでに存在しており、このメソッドを追加できます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// Field.ts</span>
<span class="hljs-comment">//...</span>
public <span class="hljs-keyword">get</span> <span class="hljs-title">completed</span>(): <span class="hljs-title">boolean</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.marked &amp;&amp; <span class="hljs-keyword">this</span>.mined;<font></font>
}<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マウスの左クリックの処理を完了するために、</font></font><code>_onGameOver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ボードイベントの追跡を無効にし、プレーヤーにボード全体を表示する</font><font style="vertical-align: inherit;">メソッドを作成します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">後で、パラメーターに基づくステータス完了レポートのレンダリングコードも追加します</font></font><code>status</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// GameScene.ts</span>
<span class="hljs-comment">//...</span><font></font>
private _onGameOver(status: boolean) {<font></font>
    <span class="hljs-keyword">this</span>._board.off(<span class="hljs-string">'left-click'</span>, <span class="hljs-keyword">this</span>._onFieldClickLeft, <span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">this</span>._board.off(<span class="hljs-string">'right-click'</span>, <span class="hljs-keyword">this</span>._onFieldClickRight, <span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">this</span>._board.open();<font></font>
}<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br>
<a name="section-4-3"></a><h3><font color="#008080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.3フィールド表示</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
右クリックの処理を開始する前に、新しく開いたセルを再描画する方法を学びます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスの前半で、</font><font style="vertical-align: inherit;">モデルの状態が変化したときに</font><font style="vertical-align: inherit;">イベントを発生</font></font><code>Field</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">させるメソッドを開発しました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これを使用し、クラスで</font><font style="vertical-align: inherit;">このイベント</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">トレースします。</font></font><code>_setState</code><font style="vertical-align: inherit;"></font><code>change</code><font style="vertical-align: inherit;"></font><code>FieldView</code><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// FieldView.ts</span>
<span class="hljs-comment">//...</span>
private _init(): <span class="hljs-keyword">void</span> {
    <span class="hljs-comment">//...</span>
    <span class="hljs-keyword">this</span>._model.on(<span class="hljs-string">'change'</span>, <span class="hljs-keyword">this</span>._onStateChange, <span class="hljs-keyword">this</span>);<font></font>
}<font></font>
private _onStateChange(): <span class="hljs-keyword">void</span> {
    <span class="hljs-keyword">this</span>._render();<font></font>
}<font></font>
private _render(): <span class="hljs-keyword">void</span> {
    <span class="hljs-keyword">this</span>.setFrame(<span class="hljs-keyword">this</span>._frameName);<font></font>
}<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
具体的には、中間メソッドを</font></font><code>_onStateChange</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モデル変更イベントのコールバックにしました。</font><font style="vertical-align: inherit;">将来的には、実行する必要があるかどうかを理解するために、モデルがどのように変更されたかを確認する必要があります</font></font><code>_render</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
セルの現在のスプライトを新しい状態で表示するには、そのフレームを変更する必要があります。</font><font style="vertical-align: inherit;">アトラスをアセットとしてロードしたので</font></font><code>setFrame</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、現在のフレームを新しいフレームに変更するために</font><font style="vertical-align: inherit;">メソッド</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">呼び出すことができます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フレームを1行で取得するために、</font></font><code>_frameName</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実装が必要な</font><font style="vertical-align: inherit;">getterを巧みに使用しました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">最初に、セルフレームが取り得るすべての可能な値について説明します。</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フレーム</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状態</font></font></td>
</tr>
<tr>
<td><code>closed</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールドは閉鎖されています</font></font><br>
</td>
</tr>
<tr>
<td><code>flag</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フラグ付きフィールド</font></font><br>
</td>
</tr>
<tr>
<td><code>empty</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールドは開いていて、採掘されていないか、値が入力されていません</font></font><br>
</td>
</tr>
<tr>
<td><code>exploded</code><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールドは開いていて、採掘され、爆破されています</font></font><br>
</td>
</tr>
<tr>
<td><code>mined</code><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールドは開いていて、採掘されましたが、爆破されていません</font></font><br>
</td>
</tr>
<tr>
<td><code>1...9</code><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールドが開いていて、このフィールドの横にある爆弾の数を示す1から9までの値を表示します</font></font><br>
</td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちはすべての状態の説明を得て、モデルのすべてのメソッドをすでに持っているので、これらの状態を取得できます。</font><font style="vertical-align: inherit;">ファイルの最初に小さな設定を取得しましょう：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// FieldView.ts</span>
<span class="hljs-keyword">const</span> States = {
    <span class="hljs-string">'closed'</span>: <span class="hljs-function"><span class="hljs-params">field</span> =&gt;</span> field.closed,
    <span class="hljs-string">'flag'</span>: <span class="hljs-function"><span class="hljs-params">field</span> =&gt;</span> field.marked,
    <span class="hljs-string">'empty'</span>: <span class="hljs-function"><span class="hljs-params">field</span> =&gt;</span> field.opened &amp;&amp; !field.mined &amp;&amp; !field.filled,
    <span class="hljs-string">'exploded'</span>: <span class="hljs-function"><span class="hljs-params">field</span> =&gt;</span> field.opened &amp;&amp; field.mined &amp;&amp; field.exploded,
    <span class="hljs-string">'mined'</span>: <span class="hljs-function"><span class="hljs-params">field</span> =&gt;</span> field.opened &amp;&amp; field.mined &amp;&amp; !field.exploded<font></font>
}<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このオブジェクトのキーはフレームの値であり、これらのキーの値はブール値の結果を返すコールバックです。</font><font style="vertical-align: inherit;">この構成に基づいて、目的のフレーム（つまり、構成からのキー）を取得する方法を開発できます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// FieldView.ts</span>
<span class="hljs-comment">//...</span>
private <span class="hljs-keyword">get</span> <span class="hljs-title">_frameName</span>(): <span class="hljs-title">string</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> States) {
        <span class="hljs-keyword">if</span> (States[key](<span class="hljs-keyword">this</span>._model)) {
            <span class="hljs-keyword">return</span> key;<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._model.value.toString();<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、ループ内の単純な列挙により、configオブジェクトのすべてのキーを調べ、各コールバックを順番に呼び出します。</font><font style="vertical-align: inherit;">最初に私たちを返す関数</font><font style="vertical-align: inherit;">は、現在の反復での</font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キー</font></font><code>key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がモデルの現在の状態の正しいフレームである</font><font style="vertical-align: inherit;">ことを</font><font style="vertical-align: inherit;">示します</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
適切なキーがない場合は、デフォルトの状態では、値</font></font><code>_value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">オープンフィールドを検討します</font></font><code>States</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは、configでこの状態を</font><font style="vertical-align: inherit;">設定していない</font><font style="vertical-align: inherit;">ため</font><font style="vertical-align: inherit;">です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、ボードフィールドの左クリックを完全にテストし、セルがどのように開いて、開いた後に何が表示されるかを確認できます。</font></font><br>
<br>
<a name="section-4-4"></a><h3><font color="#008080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4右クリック処理</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
左クリックハンドラーを作成する場合と同様に、最初に期待される機能を明確に定義します。</font><font style="vertical-align: inherit;">マウスの右ボタンをクリックして、選択したセルをフラグでマークする必要があります。</font><font style="vertical-align: inherit;">しかし、特定の条件があります。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フラグを設定できるのは、現在マークされていない閉じたフィールドだけです。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールドがチェックされている場合、もう一度右クリックすると、フィールドからフラグが削除されます</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フラグを設定/削除する場合、レベルで使用可能なフラグの数を更新し、現在の数でテキストを表示する必要があります</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの条件を疑似コードに変換すると、次のコメント行が得られます。</font></font><br>
<br>
<pre><code class="plaintext hljs">      <font></font>
         <font></font>
      <font></font>
       <font></font>
        <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、まだ開発されていなくても、このアルゴリズムを必要なメソッドの呼び出しに変換できます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// GameScene.ts</span>
private _flags: number = <span class="hljs-number">0</span>;
<span class="hljs-comment">//...</span>
private _onFieldClickRight(field: Field): <span class="hljs-keyword">void</span> {
    <span class="hljs-keyword">if</span> (field.closed &amp;&amp; <span class="hljs-keyword">this</span>._flags &gt; <span class="hljs-number">0</span>) { <span class="hljs-comment">//       </span>
        field.addFlag(); <span class="hljs-comment">//    </span>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (field.marked) { <span class="hljs-comment">//    </span>
        field.removeFlag(); <span class="hljs-comment">//  </span><font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">this</span>._flags = Bombs - <span class="hljs-keyword">this</span>._board.countMarked;<font></font>
}<font></font>
<span class="hljs-comment">//...</span>
public create(): <span class="hljs-keyword">void</span> {
    <span class="hljs-keyword">this</span>._flags = Bombs;
    <span class="hljs-comment">//...</span><font></font>
}<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは</font></font><code>_flags</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ゲームの開始時に単一のフラグが設定されていないため、ゲームの開始時にボード上の爆弾の数に等しい</font><font style="vertical-align: inherit;">新しいフィールドも開始しました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">この場合、フラグはボードに追加またはボードから削除されるため、このフィールドは右クリックするたびに強制的に更新されます。</font><font style="vertical-align: inherit;">クラスに</font></font><code>Board</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゲッター</font><font style="vertical-align: inherit;">を追加し</font></font><code>countMarked</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// Board.ts</span>
<span class="hljs-comment">//...</span>
public <span class="hljs-keyword">get</span> <span class="hljs-title">countMarked</span>(): <span class="hljs-title">number</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._fields.filter(<span class="hljs-function"><span class="hljs-params">field</span> =&gt;</span> field.marked).length;<font></font>
}<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フラグの設定と削除はモデルの状態の変化な</font></font><code>Field</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ので、メソッドと同様に、これらのメソッドを対応するクラスに実装します</font></font><code>open</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// Field.ts</span>
<span class="hljs-comment">//...</span>
public addFlag(): <span class="hljs-keyword">void</span> {
    <span class="hljs-keyword">this</span>._setState(States.Marked);<font></font>
}<font></font>
<font></font>
public removeFlag(): <span class="hljs-keyword">void</span> {
    <span class="hljs-keyword">this</span>._setState(States.Closed);<font></font>
}<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はそれがあることを思い出してみよう</font></font><code>_setState</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">イベントトリガーする</font></font><code>change</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビューで追跡され、したがって、スプライトが再描画自動的今回モデルチェンジとなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開発した機能をテストすると、マウスの右ボタンをクリックするたびにコンテキストメニューが開くことがわかります。</font><font style="vertical-align: inherit;">この動作を無効にするコードをゲームシーンのコンストラクターに追加します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// GameScene.ts</span>
<span class="hljs-comment">//...</span>
<span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">super</span>(<span class="hljs-string">'Game'</span>);
    <span class="hljs-comment">//       </span>
    <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">"canvas"</span>).oncontextmenu = <span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> e.preventDefault();<font></font>
}<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br>
<a name="section-4-5"></a><h3><font color="#008080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.5 GameSceneViewオブジェクト</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ゲームシーンにUIを表示するために、クラスを作成してに</font></font><code>GameSceneView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置し</font></font><code>src/scripts/views/GameSceneView.ts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場合、私たちは作成</font></font><code>FieldView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">とは</font><font style="vertical-align: inherit;">異なる方法で行動し、</font><font style="vertical-align: inherit;">このクラスをプレハブおよび相続人にすることはしません</font></font><code>GameObjects</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場合、シーンビューから次の要素を出力する必要があります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フラグの数のテキスト</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">終了ボタン</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゲーム完了ステータスメッセージ（勝ち/負け）</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UIの各要素をクラスの個別のフィールドにし</font></font><code>GameSceneView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スタブを用意します。</font></font><br>
<br>
<pre><code class="javascript hljs">enum Styles {<font></font>
    Color = <span class="hljs-string">'#008080'</span>,<font></font>
    Font = <span class="hljs-string">'Arial'</span><font></font>
}<font></font>
<font></font>
enum Texts {<font></font>
    Flags = <span class="hljs-string">'FLAGS: '</span>,<font></font>
    Exit = <span class="hljs-string">'EXIT'</span>,<font></font>
    Success = <span class="hljs-string">'YOU WIN!'</span>,<font></font>
    Failure = <span class="hljs-string">'YOU LOOSE'</span><font></font>
};<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GameSceneView</span> </span>{<font></font>
    private _scene: Phaser.Scene = <span class="hljs-literal">null</span>;<font></font>
    private _style: {<span class="hljs-attr">font</span>: string, <span class="hljs-attr">fill</span>: string};<font></font>
<font></font>
    <span class="hljs-keyword">constructor</span>(scene: Phaser.Scene) {
        <span class="hljs-keyword">this</span>._scene = scene;
        <span class="hljs-keyword">this</span>._style = {<span class="hljs-attr">font</span>: <span class="hljs-string">`28px <span class="hljs-subst">${Styles.Font}</span>`</span>, <span class="hljs-attr">fill</span>: Styles.Color};
        <span class="hljs-keyword">this</span>._create();<font></font>
    }<font></font>
<font></font>
    private _create(): <span class="hljs-keyword">void</span> {<font></font>
    }<font></font>
<font></font>
    public render() {<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フラグの数を含むテキストを追加します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// GameSceneView.ts</span>
<span class="hljs-comment">//...</span>
private _txtFlags: Phaser.GameObjects.Text = <span class="hljs-literal">null</span>;
<span class="hljs-comment">//...</span>
private _createTxtFlags(): <span class="hljs-keyword">void</span> {
    <span class="hljs-keyword">this</span>._txtFlags = <span class="hljs-keyword">this</span>._scene.add.text(
        <span class="hljs-number">50</span>,
        <span class="hljs-number">50</span>,<font></font>
        Texts.Flags,<font></font>
        <span class="hljs-keyword">this</span>._style<font></font>
    ).setOrigin(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>);<font></font>
}<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコードは、必要なテキストを上と左から50pxインデントした位置に配置し、指定したスタイルに設定します。</font><font style="vertical-align: inherit;">さらに、このメソッド</font></font><code>setOrigin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はテキストのピボットポイントを座標（0、1）に設定します。</font><font style="vertical-align: inherit;">これは、テキストが左端に揃うことを意味します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ステータスメッセージを追加します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// GameSceneView.ts</span>
<span class="hljs-comment">//...</span>
private _txtStatus: Phaser.GameObjects.Text = <span class="hljs-literal">null</span>;
<span class="hljs-comment">//...</span>
private _createTxtStatus(): <span class="hljs-keyword">void</span> {
    <span class="hljs-keyword">this</span>._txtStatus = <span class="hljs-keyword">this</span>._scene.add.text(
        <span class="hljs-keyword">this</span>._scene.cameras.main.centerX,
        <span class="hljs-number">50</span>,<font></font>
        Texts.Success,<font></font>
        <span class="hljs-keyword">this</span>._style<font></font>
    ).setOrigin(<span class="hljs-number">0.5</span>, <span class="hljs-number">1</span>);<font></font>
<font></font>
    <span class="hljs-keyword">this</span>._txtStatus.visible = <span class="hljs-literal">false</span>;<font></font>
}<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ステータステキストを画面の中央に配置</font></font><code>setOrigin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">し、x座標のパラメーター0.5を</font><font style="vertical-align: inherit;">呼び出し</font><font style="vertical-align: inherit;">て</font><font style="vertical-align: inherit;">、行の中央に揃え</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">さらに、ゲームの完了時にのみ表示するため、デフォルトでは、このテキストは非表示にする必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
終了ボタンを作成します。これは本質的にテキストオブジェクトでもあります。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// GameSceneView.ts</span>
<span class="hljs-comment">//...</span>
private _btnExit: Phaser.GameObjects.Text = <span class="hljs-literal">null</span>;
<span class="hljs-comment">//...</span>
private _createBtnExit(): <span class="hljs-keyword">void</span> {
    <span class="hljs-keyword">this</span>._btnExit = <span class="hljs-keyword">this</span>._scene.add.text(
        <span class="hljs-keyword">this</span>._scene.cameras.main.width - <span class="hljs-number">50</span>,
        <span class="hljs-number">50</span>,<font></font>
        Texts.Exit,<font></font>
        <span class="hljs-keyword">this</span>._style<font></font>
    ).setOrigin(<span class="hljs-number">1</span>);<font></font>
<font></font>
    <span class="hljs-keyword">this</span>._btnExit.setInteractive();
    <span class="hljs-keyword">this</span>._btnExit.once(<span class="hljs-string">'pointerdown'</span>, () =&gt; {
        <span class="hljs-keyword">this</span>._scene.scene.start(<span class="hljs-string">'Start'</span>);<font></font>
    });<font></font>
}<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ボタンを画面の右上隅に配置し、もう一度ボタンを使用して</font></font><code>setOrigin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、テキストを右端に揃えます。</font><font style="vertical-align: inherit;">ボタンをインタラクティブにし、クリックイベントにコールバックを追加します。これにより、プレーヤーが開始シーンに送信されます。</font><font style="vertical-align: inherit;">したがって、私たちはプレイヤーにいつでもレベルを終了する機会を与えます。</font><font style="vertical-align: inherit;">UIのすべての要素を正しく更新</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
するメソッドを開発し、</font></font><code>render</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作成されたすべてのメソッドへの呼び出しを追加する必要があります</font></font><code>_create</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// GameSceneView.ts</span>
<span class="hljs-comment">//...</span>
private _create(): <span class="hljs-keyword">void</span> {
    <span class="hljs-keyword">this</span>._createTxtFlags();
    <span class="hljs-keyword">this</span>._createTxtStatus();
    <span class="hljs-keyword">this</span>._createBtnExit();<font></font>
}<font></font>
public render(data: {flags?: number, status?: boolean}) {<font></font>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> data.flags !== <span class="hljs-string">'undefined'</span>) {
        <span class="hljs-keyword">this</span>._txtFlags.text = Texts.Flags + data.flags.toString();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> data.status !== <span class="hljs-string">'undefined'</span>) {
        <span class="hljs-keyword">this</span>._txtStatus.text = data.status ? Texts.Success : Texts.Failure;
        <span class="hljs-keyword">this</span>._txtStatus.visible = <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
}<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パラメータで渡されたプロパティに応じて、UIを更新し、必要な変更を表示します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GameSceneクラスのゲームシーンに表現を作成し、_renderメソッドの呼び出しを必要な場所に書き込みます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// GameScene.ts</span>
<span class="hljs-comment">//...</span>
<span class="hljs-keyword">import</span> { GameSceneView } <span class="hljs-keyword">from</span> <span class="hljs-string">"../views/GameSceneView"</span>;
<span class="hljs-comment">//...</span>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GameScene</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Phaser</span>.<span class="hljs-title">Scene</span> </span>{<font></font>
    private _view: GameSceneView = <span class="hljs-literal">null</span>;
    <span class="hljs-comment">//...</span><font></font>
    private _onGameOver(status: boolean) {<font></font>
        <span class="hljs-comment">//...</span>
        <span class="hljs-keyword">this</span>._view.render({status});<font></font>
    }<font></font>
    <span class="hljs-comment">//...</span>
    private _onFieldClickRight(field: Field): <span class="hljs-keyword">void</span> {
        <span class="hljs-comment">//...</span>
        <span class="hljs-keyword">this</span>._flags = Bombs - <span class="hljs-keyword">this</span>._board.countMarked;
        <span class="hljs-keyword">this</span>._view.render({<span class="hljs-attr">flags</span>: <span class="hljs-keyword">this</span>._flags});<font></font>
    }<font></font>
    <span class="hljs-comment">//...</span>
    public create(): <span class="hljs-keyword">void</span> {
        <span class="hljs-comment">//...</span>
        <span class="hljs-keyword">this</span>._view = <span class="hljs-keyword">new</span> GameSceneView(<span class="hljs-keyword">this</span>);
        <span class="hljs-keyword">this</span>._view.render({<span class="hljs-attr">flags</span>: <span class="hljs-keyword">this</span>._flags});<font></font>
    }<font></font>
<span class="hljs-comment">//...</span><font></font>
}<font></font>
</code></pre><br>
<a name="section-5"></a><h2><font color="#008080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.アニメーション</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アニメーションがなければ、私たちのゲームと同じくらい簡単にゲームを作成するのはどのようなファンですか？</font><font style="vertical-align: inherit;">さらに、フェイザーの研究を始めたので、アニメーションの最も基本的な機能を理解し、双子の機能を検討してみましょう。</font><font style="vertical-align: inherit;">ツインはフレームワーク自体に実装されており、サードパーティのライブラリは必要ありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ゲームに2つのアニメーションを追加します。最初にボードをセルで埋め、開口部でセルを反転します。</font><font style="vertical-align: inherit;">これらの最初のものから始めましょう。</font></font><br>
<br>
<a name="section-5-1"></a><h3><font color="#008080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1ボード塗りつぶしのアニメーション</font></font></font></h3><br>
<img src="https://habrastorage.org/webt/7r/uu/1v/7ruu1vtppaw26sp-fapxbahgm9q.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ボードのすべてのセルが画面の左上端から配置されることを確認します。</font><font style="vertical-align: inherit;">ゲームレベルを開始するとき、すべてのセルを画面の左上隅を超えてシフトする必要があり、各セルについて、対応する座標への動きのアニメーションを開始します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラス</font></font><code>FiledView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で、メソッドの最後に</font></font><code>_create</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼び出し</font><font style="vertical-align: inherit;">を追加し</font><font style="vertical-align: inherit;">ます</font></font><code>_animateShow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// FieldView.ts</span>
<span class="hljs-comment">//...</span>
private _create(): <span class="hljs-keyword">void</span> {
    <span class="hljs-comment">//...</span>
    <span class="hljs-keyword">this</span>._animateShow();<font></font>
}<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
B必要な新しいメソッドを実装します。</font><font style="vertical-align: inherit;">その中で、上記で合意したように、2つのことを実行する必要があります。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セルを左上隅の後ろに移動して、画面に表示されないようにします</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正しい遅延で目的の座標にツイン移動を開始します</font></font></li>
</ol><br>
<pre><code class="javascript hljs"><span class="hljs-comment">// FieldView.ts</span>
<span class="hljs-comment">//...</span>
private _animateShow(): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt; {
    <span class="hljs-keyword">this</span>.x = -<span class="hljs-keyword">this</span>.width;
    <span class="hljs-keyword">this</span>.y = -<span class="hljs-keyword">this</span>.height;
    <span class="hljs-keyword">const</span> delay = <span class="hljs-keyword">this</span>._model.row * <span class="hljs-number">50</span> + <span class="hljs-keyword">this</span>._model.col * <span class="hljs-number">10</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._moveTo(<span class="hljs-keyword">this</span>._position, delay);<font></font>
}<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
キャンバスの左上隅に座標（0、0）があるため、セルを幅と高さの負の値に等しい座標に設定すると、セルは左上隅の後ろに配置され、画面から非表示になります。</font><font style="vertical-align: inherit;">これで、最初のタスクが完了しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メソッドを呼び出すことにより、2番目の目標を達成し</font></font><code>_moveTo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// FieldView.ts</span>
<span class="hljs-comment">//...</span>
private _moveTo(position: Vec2, <span class="hljs-attr">delay</span>: number): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> {
        <span class="hljs-keyword">this</span>.scene.tweens.add({
            <span class="hljs-attr">targets</span>: <span class="hljs-keyword">this</span>,
            <span class="hljs-attr">x</span>: position.x,
            <span class="hljs-attr">y</span>: position.y,
            <span class="hljs-attr">duration</span>: <span class="hljs-number">600</span>,
            <span class="hljs-attr">ease</span>: <span class="hljs-string">'Elastic'</span>,
            <span class="hljs-attr">easeParams</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>],<font></font>
            delay,<font></font>
            <span class="hljs-attr">onComplete</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<font></font>
                resolve();<font></font>
            }<font></font>
        });<font></font>
    });<font></font>
}<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アニメーションを作成するには、シーンプロパティを使用します</font></font><code>tweens</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">彼のメソッドで</font></font><code>add</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、設定を含む構成オブジェクトを渡します。</font></font><br>
<br>
<ul>
<li> <code>targets</code>         ,      .      <code>this</code>   ,      .</li>
<li>        .</li>
<li> <code>duration</code>    ,    — 600.</li>
<li> <code>ease</code>  <code>easeParams</code>  easing .</li>
<li>  delay     ,             .    ,     .           .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最後に、プロパティ</font></font><code>onComplete</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">にコールバックを配置します。これは、トゥイーンアクションの終了時に呼び出されます。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今後ツインがさまざまなアニメーションを美しくドッキングできるように、ツインをプロミスでラップすることは合理的です。そのため、コールバック</font></font><code>resolve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">では、アニメーションの正常な実行を示す</font><font style="vertical-align: inherit;">関数呼び出し</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">配置します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<a name="section-5-2"></a><h3><font color="#008080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2セルフリップアニメーション</font></font></font></h3><br>
<img src="https://habrastorage.org/webt/uc/d-/yw/ucd-yw-nq6a4veixb-npp0mdyqy.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
セルを開いたときにその逆転の効果を再現できたら素晴らしいですね。</font><font style="vertical-align: inherit;">どうすればこれを達成できますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在、セルを開くに</font></font><code>_render</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、ビューで</font><font style="vertical-align: inherit;">メソッドが呼び出さ</font><font style="vertical-align: inherit;">れた</font><font style="vertical-align: inherit;">ときにフレームを変更</font><font style="vertical-align: inherit;">します。</font><font style="vertical-align: inherit;">このメソッドでモデルの状態を確認すると、セルが開いているかどうかがわかります。</font><font style="vertical-align: inherit;">セルが開いている場合は、新しい反転フレームをすぐに表示するのではなく、アニメーションを開始します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// FieldView.ts</span>
<span class="hljs-comment">//...</span>
private _onStateChange(): <span class="hljs-keyword">void</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._model.opened) {
        <span class="hljs-keyword">this</span>._animateFlip();<font></font>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">this</span>._render();<font></font>
    }<font></font>
}<font></font>
<span class="hljs-comment">//...</span>
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
目的の効果を得るには、プロパティを介してスプライトの変換を使用します</font></font><code>scale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">時間の経過とともに軸</font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">沿ってスプライト</font><font style="vertical-align: inherit;">をゼロ</font><font style="vertical-align: inherit;">にスケーリングする</font><font style="vertical-align: inherit;">と、最終的には縮小し、左側と右側が接続されます。</font><font style="vertical-align: inherit;">逆もまた同様ですが、スプライトを軸に沿って</font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゼロからフル幅に</font><font style="vertical-align: inherit;">スケーリングする</font><font style="vertical-align: inherit;">と、フルサイズに拡大されます。</font><font style="vertical-align: inherit;">このロジックをメソッドに実装し</font></font><code>_animateFlip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// FieldView.ts</span>
<span class="hljs-comment">//...</span>
private _animateFlip(): <span class="hljs-keyword">void</span> {
    <span class="hljs-keyword">this</span>._scaleXTo(<span class="hljs-number">0</span>).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-keyword">this</span>._render();
        <span class="hljs-keyword">this</span>._scaleXTo(<span class="hljs-number">1</span>);<font></font>
    })<font></font>
}<font></font>
<span class="hljs-comment">//...</span>
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メソッドとの類推により、以下を</font></font><code>_moveTo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実装します</font></font><code>_scaleTo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// FieldView.ts</span>
<span class="hljs-comment">//...</span>
private _scaleXTo(scaleX: number): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> {
        <span class="hljs-keyword">this</span>.scene.tweens.add({
            <span class="hljs-attr">targets</span>: <span class="hljs-keyword">this</span>,<font></font>
            scaleX,<font></font>
            <span class="hljs-attr">ease</span>: <span class="hljs-string">'Elastic.easeInOut'</span>,
            <span class="hljs-attr">easeParams</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>],
            <span class="hljs-attr">duration</span>: <span class="hljs-number">150</span>,
            <span class="hljs-attr">onComplete</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<font></font>
                resolve()<font></font>
            }<font></font>
        });<font></font>
    });<font></font>
}<font></font>
<span class="hljs-comment">//...</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このメソッドでは、パラメーターとして、スケールの値を取得します。これを使用して、スプライトのサイズを両方向に変更し、2番目のパラメーターとしてアニメーション構成オブジェクトに渡します。</font><font style="vertical-align: inherit;">他のすべての構成パラメーターは、前のアニメーションから既におなじみです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、テストのためにプロジェクトを開始し、デバッグ後、ゲームが完了し、テストタスクが完了したと見なします。</font><font style="vertical-align: inherit;">:)私</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
はこの瞬間に私と一緒に着いたことをみんな</font><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">心から感謝します！</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同僚、記事で紹介されている資料があなたにとって有用であり、あなたがこれらまたはそれらの説明されているアプローチをあなた自身のプロジェクトで使用できるなら、私はとても幸せです。この記事と、フェイザープログラミング、または一般的なgamedevでの作業の両方で、いつでも私に質問を投げかけることができます。私はコミュニケーションを歓迎し、新しい友達を作り、経験を交換していきます！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして今、あなたに質問があります。私はゲーム開発に関するビデオチュートリアルを作成しているので、これらの小さなゲームを自然に数十個集めました。各ゲームは独自の方法でフレームワークを開きます。たとえば、このゲームでは双子のトピックに触れましたが、物理、タイルマップ、スパインなど、他にも多くの機能があります。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この点に関して、問題は、この記事が好きでしたか、そうであれば、この記事のような記事を読み続けたいと思いますが、他の小さな古典的なゲームについてですか？</font><font style="vertical-align: inherit;">答えが「はい」の場合は、ビデオチュートリアルの資料をテキスト形式に喜んで翻訳し、他のゲーム用に新しいマニュアルを今後も公開していきます。</font><font style="vertical-align: inherit;">対応する調査を持参します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご清聴ありがとうございました！</font><font style="vertical-align: inherit;">フィードバックをお待ちしております。またお会いしましょう！</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja476670/index.html">ジオメトリックコアC3D上のCADの概要-2</a></li>
<li><a href="../ja476674/index.html">慣れるためのReportPortalの迅速な導入</a></li>
<li><a href="../ja476676/index.html">JavaScript用の48のオープンソースリソース（2019）</a></li>
<li><a href="../ja476678/index.html">Apple Combineを使用したリモート非同期フェッチ用のAPI</a></li>
<li><a href="../ja476680/index.html">ロドフの継続的な生産計画システムは、ソビエト1961リーン/ MRPです。離陸、日没、新生</a></li>
<li><a href="../ja476686/index.html">Raspberry CM3 +に基づくIoTゲートウェイの開発</a></li>
<li><a href="../ja476688/index.html">OTUSからの新しいコース。「IOS開発者。上級コースV 2.0»</a></li>
<li><a href="../ja476692/index.html">コンテンツマーケティングの原則</a></li>
<li><a href="../ja476694/index.html">Farida Roslovets氏とエレクトロニークRPA企業のディレクターによるビジネスロボット化について</a></li>
<li><a href="../ja476696/index.html">フルスタックReactアプリケーションを作成してデプロイする方法</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>