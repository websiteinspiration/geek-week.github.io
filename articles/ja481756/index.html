<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>âœ‹ğŸ¿ ğŸ‘©â€ğŸ’» ğŸ’« DDoSã‚’é©åˆ‡ãªç›®çš„ã§æ•´ç†ã™ã‚‹æ–¹æ³•ã¯ï¼Ÿ ğŸ½ ğŸ¼ ğŸ‘©ğŸ¼â€ğŸ’»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æ–°ã—ã„ã‚µãƒ¼ãƒ“ã‚¹ã‚’ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹å‰ã«ã€ãã‚ŒãŒç§ãŸã¡ã®æœŸå¾…ã«æ²¿ã£ã¦æ©Ÿèƒ½ã—ã€åŒæ™‚ã«ä½•äººã®é¡§å®¢ãŒãã‚Œã‚’ä½¿ç”¨ã™ã‚‹ã‹ã«é–¢ä¿‚ãªãåˆ©ç”¨ã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãŠãã¨ã‚ˆã„ã§ã—ã‚‡ã†ã€‚
 

ã¾ãŸã€åˆ†æ•£å‹DoSæ”»æ’ƒãŒçµ„ç¹”ã•ã‚ŒãŸå ´åˆã€ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ã¯ã©ã®ã‚ˆã†ã«åå¿œã—ã¾ã™ã‹ï¼Ÿãƒªã‚½ãƒ¼ã‚¹ã¯æ½œåœ¨çš„ãªæ”»æ’ƒè€…ã‹ã‚‰ä¿è­·ã•ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ
 

 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>DDoSã‚’é©åˆ‡ãªç›®çš„ã§æ•´ç†ã™ã‚‹æ–¹æ³•ã¯ï¼Ÿ</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ntc-vulkan/blog/481756/"><p><img src="https://habrastorage.org/webt/qa/gk/up/qagkupe_y5cx7thbrqpj4aynn1y.png" alt="ç”»åƒ"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–°ã—ã„ã‚µãƒ¼ãƒ“ã‚¹ã‚’ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹å‰ã«ã€ãã‚ŒãŒç§ãŸã¡ã®æœŸå¾…ã«æ²¿ã£ã¦æ©Ÿèƒ½ã—ã€åŒæ™‚ã«ä½•äººã®é¡§å®¢ãŒãã‚Œã‚’ä½¿ç”¨ã™ã‚‹ã‹ã«é–¢ä¿‚ãªãåˆ©ç”¨ã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãŠãã¨ã‚ˆã„ã§ã—ã‚‡ã†ã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ãŸã€åˆ†æ•£å‹DoSæ”»æ’ƒãŒçµ„ç¹”ã•ã‚ŒãŸå ´åˆã€ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ã¯ã©ã®ã‚ˆã†ã«åå¿œã—ã¾ã™ã‹ï¼Ÿ</font><font style="vertical-align: inherit;">ãƒªã‚½ãƒ¼ã‚¹ã¯æ½œåœ¨çš„ãªæ”»æ’ƒè€…ã‹ã‚‰ä¿è­·ã•ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ</font></font></p><br>
<p>        ,     ,  DDoS-,        .</p><br>
<p>           DNS-  HTTP-. </p><a name="habracut"></a><br>
<h1></h1><br>
<p>           ,     ,          .       ,         - .     :    ,    ,      .</p><br>
<p>     (-    ,  , ,   ,    )         ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Amazon Web Services</a> (AWS).   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a> ,  AWS    ,    ,     .</p><br>
<h1>  </h1> <br>
<p> ,      ,   ,   :</p><br>
<pre><code class="plaintext hljs">Customer ID:<font></font>
   Customer Name:<font></font>
   Email Address:<font></font>
   AWS Account ID load test will be performed from:<font></font>
   Does the customer have an NDA?<font></font>
<font></font>
Target Data<font></font>
<font></font>
   EC2 Resources:<font></font>
   Cloudfront Distribution:<font></font>
   API Gateway / Lambda ID:<font></font>
   ELB Names:<font></font>
   Non-AWS Target:<font></font>
   Region (please list all regions in scope for testing):<font></font>
<font></font>
Source Data:<font></font>
<font></font>
   IP Addresses:<font></font>
   Source Account ID:<font></font>
   Regions involved:<font></font>
<font></font>
Testing Parameters:<font></font>
<font></font>
   How much traffic do you plan to generate by region during testing?<font></font>
   What is your expected peak load from source by region? (i.e. xx Gbps)<font></font>
   What is your expected peak load at destination? (i.e. xx Gbps)<font></font>
   Are you testing traffic outbound from EC2, inbound into EC2, or both?<font></font>
   Are you testing traffic outbound (egress) from EC2, inbound (ingress) into EC2, or both:<font></font>
   Egress. What is your expected peak load from source by region? (i.e. xx Gbps)<font></font>
   Ingress. What is your expected peak load from source by region? (i.e. xx Gbps)<font></font>
<font></font>
   Start Date:<font></font>
   End Date:<font></font>
   Finite testing details including timeline of testing:<font></font>
   Summary of Test:<font></font>
   Testing Timelines by phase including rps, pps, and Gbps:<font></font>
   Peak bandwidth for each source IP:<font></font>
   Tools Used for each phase of test:<font></font>
   Types of testing to be performed for each phase of the request:<font></font>
   What criteria/metrics will you monitor to ensure the success of this test?<font></font>
   Who is performing the Load Test? (Please provide contact details):<font></font>
   Does the tester have an NDA?<font></font>
<font></font>
Testing Security<font></font>
<font></font>
   Do you have a way to monitor the data traffic for the duration of the test to verify <font></font>
bandwidth limits do not exceed approved rates?<font></font>
   Do you have a way to immediately stop the traffic if we/you discover any issue?<font></font>
   2 Emergency contact names and phone numbers:</code></pre><br>
<p>  :</p><br>
<ol>
<li><p>  ,   Â«Â».      ? ,     (  ,   ,   )     .</p><br>
</li>
<li><p>  ,       .    ,          .      645 /c. ,    ,     ,    .</p><br>
</li>
<li><p> ,      ,          .   ,       .      ,  ,              .         ,      - . </p><br>
</li>
<li><p>       ,     ,              .</p><br>
</li>
</ol><br>
<p> ,       - ,         ,      .</p><br>
<p>       ,   .</p><br>
<h1> </h1><br>
<p>        .   ,        :</p><br>
<p>â€¢  ;</p><br>
<p>â€¢   ;</p><br>
<p>â€¢     ; </p><br>
<p>â€¢   ; </p><br>
<p>â€¢  IP-;</p><br>
<p>â€¢  .</p><br>
<h2>  </h2><br>
<h3>  </h3><br>
<p>  AWS-,         .    ,   .     :   ,   ,  CPU ( ,       -),        .   ,       <code>t3.small</code>,       . </p><br>
<p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>.       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>.</p><br>
<h3>   </h3><br>
<p>    ,      .   ,  Amazon         .     ,    ,    ,        .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Support</a>,    Service limit increase.      : -     ,   ,   , - ,     ,  N .    ,      .</p><br>
<h3> </h3><br>
<p>    ,      .      ,     ,   ,  ,    (    Actions,     ,       Image Create Image).</p><br>
<p>        ,             .</p><br>
<p>      <code>/etc/sysctl.conf</code>: </p><br>
<p>â€¢            FIN_WAIT:</p><br>
<pre><code class="plaintext hljs">net.ipv4.ip_local_port_range = 1024-65535 ( : 32768-61000)<font></font>
net.ipv4.tcp_fin_timeout = 10 ( : 60)</code></pre><br>
<p>       ,       IP.</p><br>
<p>    (61 000â€“32 768)  28 233 .    â€“ 64 500.</p><br>
<p>Fin_timeout   ,          FIN_WAIT.</p><br>
<p>    ,      (61 000â€“32 768) / 60 = 470   .</p><br>
<p> port_range   fin_timeout,           . </p><br>
<p>â€¢       TIME_WAIT,   :</p><br>
<pre><code class="plaintext hljs">net.ipv4.tcp_tw_reuse = 1 </code></pre><br>
<p>   (   )     Â«Â»   .</p><br>
<p>   TIME_WAIT    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>. </p><br>
<p>â€¢   tcp_timestamps     <code>tcp_tw_reuse</code>:</p><br>
<pre><code class="plaintext hljs">net.ipv4.tcp_timestamps = 1 â€“   `tcp_timestamps`     tcp_tw_reuse </code></pre><br>
<p>â€¢  : </p><br>
<pre><code class="plaintext hljs">net.ipv4.tcp_max_tw_buckets = 720000 â€“       TIME_WAIT<font></font>
net.ipv4.tcp_keepalive_time = 600 â€“  - keepalive-<font></font>
net.ipv4.tcp_keepalive_probes = 3 â€“   keepalive-<font></font>
net.ipv4.tcp_keepalive_intvl = 10 â€“     keepalive-<font></font>
net.ipv4.tcp_window_scaling = 1 â€“   TCP-<font></font>
net.ipv4.tcp_mem = 8192 131072 196304 â€“     TCP- <font></font>
net.ipv4.udp_mem = 8192 131072 196304 â€“     udp-<font></font>
net.ipv4.tcp_slow_start_after_idle=0 â€“  Slow-Start Restart<font></font>
net.core.wmem_default = 31457280 â€“         <font></font>
net.core.wmem_max = 33554432 â€“         <font></font>
net.core.somaxconn = 65535 â€“       <font></font>
net.core.netdev_max_backlog = 65535 â€“         <font></font>
vm.swappiness = 30 â€“   <font></font>
vm.dirty_ratio = 50 â€“     50 % <font></font>
vm.pagecache = 90 â€“    </code></pre><br>
<h3>  </h3><br>
<p><strong>1.   DNS</strong></p><br>
<p>     â€“   DNS-.  DNS-      ,       DNS      .     DNS-     DNS-.        DNS-      . </p><br>
<p>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">DNSPerf</a>.</p><br>
<p>DNSPerf â€“  ,       DNS-.       authoritative DNS-,         . </p><br>
<p>    authoritative DNS-,    â€“ example.com. </p><br>
<p> DNSPerf      <code>dns_queries.txt</code> ( ANY        DNS-):</p><br>
<pre><code class="plaintext hljs">#dns_queries.txt<font></font>
<font></font>
example.com ANY<font></font>
www.example.com ANY<font></font>
test.example.com ANY<font></font>
static.example.com ANY<font></font>
example.com <font></font>
www.example.com <font></font>
test.example.com MX</code></pre><br>
<p>  :</p><br>
<pre><code class="plaintext hljs">dnsperf -s TARGET_IP -d dns_queries.txt -c 100 -n 100 <font></font>
-s =  IP-<font></font>
-d =      .   â€“ stdin <font></font>
-c =   .         <font></font>
-n =  Â«Â»   .</code></pre><br>
<p><strong>2.   ICMP</strong></p><br>
<p>         ICMP-.              ping-request,   DDoS-   ping-.   ,   <code>ping-to-death</code>,          ICMP.         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">hping3</a>,     ,   ,    .</p><br>
<p>  :</p><br>
<pre><code class="plaintext hljs">hping3 -i u1000 -d 1500 -c 100000 -1 TARGET_IP<font></font>
<font></font>
-i u100 =     (uX for X microseconds)<font></font>
-d 1500 =   <font></font>
-c 1000000 =    <font></font>
-1 =  ICMP</code></pre><br>
<p><strong>3.   HTTP</strong></p><br>
<p>       â€“  HTTP(S)-.          HTTP-  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">siege</a>. Siege â€“       ,     -. </p><br>
<p>  DNSPerf, siege          (   c   ),       .   ,         . </p><br>
<p>  :</p><br>
<pre><code class="plaintext hljs">siege -b -c 100 -f test_urls.txt <font></font>
<font></font>
-b =   ( benchmark)<font></font>
-c =   .         <font></font>
-f =   </code></pre><br>
<p>  <code>test_urls.txt</code>:</p><br>
<pre><code class="plaintext hljs">http://example.com/site/login POST login=username&amp;password=test<font></font>
http://example.com/site/client POST useragent=Mozilla&amp;version=123&amp;date=24May<font></font>
http://example.com/site/order POST user=username&amp;company=ooo&amp;phone=812345678</code></pre><br>
<p> ,      POST-,                .</p><br>
<p>        IP,   Amazon    .   src_IP     ,         .</p><br>
<p>      â€“      , â€“    Amazon   DDoS  .   -        ,    Â«Â»    ,    ,    .</p><br>
<h3>   </h3><br>
<p>     bash- (dns.sh, ping.sh, http.sh),    ,     (test_urls.txt, valid_dns_queries.txt).</p><br>
<p>      AWS- (      ),         :</p><br>
<pre><code class="plaintext hljs">ssh instance-amazon 'sudo &lt;stress-script&gt;.sh start &lt;params&gt; &amp;&gt;&gt;stress.log &amp;'</code></pre><br>
<p>  stress-script.sh    ,  params â€”  .   stress.log      .         : dns.log, ping.log, http.log.</p><br>
<p>  <code>dns.sh</code>:</p><br>
<pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-keyword">if</span> [[ ! <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> =~ ^(start|stop|status)$ ]]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"nothing to do: need argument for stop,start or status"</span>
    <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span><font></font>
<font></font>
<span class="hljs-keyword">if</span> [[ <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> = <span class="hljs-string">"start"</span> ]]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">shift</span>
    dnsperf <span class="hljs-variable">$@</span> 
<span class="hljs-keyword">fi</span><font></font>
<font></font>
<span class="hljs-keyword">if</span> [[ <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> = <span class="hljs-string">"stop"</span> ]]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">kill</span> $(pidof dnsperf)
<span class="hljs-keyword">fi</span><font></font>
<font></font>
<span class="hljs-keyword">if</span> [[ <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> = <span class="hljs-string">"status"</span> ]]; <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">if</span> [[ ! <span class="hljs-string">"<span class="hljs-subst">$(pidof dnsperf)</span>"</span> = <span class="hljs-string">""</span> ]]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"dnperf is running with PID <span class="hljs-subst">$(pidof dnsperf)</span>"</span><font></font>
        ps aux | grep dnsperf<font></font>
    <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"dnsperf is not running"</span>
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">fi</span></code></pre><br>
<p>   ,      ,     (/ ).</p><br>
<p>     ICMP-  HTTP-,   hping3  siege      .</p><br>
<p> :</p><br>
<pre><code class="plaintext hljs">ssh instance-amazon 'sudo dns.sh start -s TARGET_IP -d valid_dns_queries.txt -c 1 -n 100 &amp;&gt;&gt;dns.log &amp;'<font></font>
ssh instance-amazon 'sudo ping.sh start -i u1000 -d 1500 -c 100000 -1 TARGET_IP &amp;&gt;&gt;ping.log &amp;'<font></font>
ssh instance-amazon 'sudo http.sh start -b -c 100 -f test_urls.txt &amp;&gt;&gt; http.log &amp;'</code></pre><br>
<h3> </h3><br>
<p>           .        iptables.    ,    ,     AWS-:</p><br>
<pre><code class="plaintext hljs">#iptables.sh<font></font>
<font></font>
sudo iptables -N TRAFFIC_OUT<font></font>
sudo iptables -A TRAFFIC_OUT -p tcp<font></font>
sudo iptables -A TRAFFIC_OUT -p udp<font></font>
sudo iptables -A TRAFFIC_OUT -p icmp<font></font>
sudo iptables -A OUTPUT -j TRAFFIC_OUT<font></font>
sudo iptables-save</code></pre><br>
<p>    TRAFFIC_OUT        : tcp, udp, icmp.</p><br>
<p>  OUTPUT     TRAFFIC_OUT.</p><br>
<p>     :</p><br>
<pre><code class="plaintext hljs"># iptables -L TRAFFIC_OUT -v -n -x | tail -n 3 | awk '{print $2/1024/1024,"Mb\t\t\t",$3}â€™ : <font></font>
 2.2 Mb       tcp<font></font>
 4.4 Mb      udp<font></font>
 3.2 Mb      icmp</code></pre><br>
<p>    .     monitoring.service      <code>/etc/systemd/system</code>  :</p><br>
<pre><code class="plaintext hljs"># /etc/systemd/system/monitoring.service<font></font>
<font></font>
[Unit]<font></font>
After=network.target<font></font>
[Service]<font></font>
ExecStart=/usr/local/bin/monitoring.sh<font></font>
[Install]<font></font>
WantedBy=default.target</code></pre><br>
<p>     :</p><br>
<pre><code class="plaintext hljs">systemctl enable monitoring.service<font></font>
systemctl start monitoring.service</code></pre><br>
<h2> </h2><br>
<p>    ( )  . </p><br>
<p>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">AWS CLI</a> â€“    .</p><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Secret Key</a> (Access keys (access key ID and secret access key))   .</p><br>
<p>         .</p><br>
<p>   AWS   ,           ,    . </p><br>
<p>     ,     (,    ami-ID,    ),   :</p><br>
<ul>
<li> SSH-     AWS:</li>
</ul><br>
<pre><code class="bash hljs">yes n |ssh-keygen -q -t rsa -f <span class="hljs-variable">$KEYNAME</span> -m pem -N <span class="hljs-string">""</span> &gt; /dev/null<font></font>
chmod 400 <span class="hljs-variable">$KEYNAME</span>
aws ec2 import-key-pair --region <span class="hljs-variable">$REGION</span> --key-name <span class="hljs-variable">$KEYNAME</span> --public-key-material file:///$(<span class="hljs-built_in">pwd</span>)/<span class="hljs-variable">$KEYNAME</span>.pub</code></pre><br>
<ul>
<li> security-group,       SSH.     SSH-  :</li>
</ul><br>
<pre><code class="bash hljs">SECURITY=<span class="hljs-string">"ssh-group"</span>
aws ec2 create-security-group --region <span class="hljs-variable">$REGION</span> --group-name <span class="hljs-variable">$SECURITY</span> --description <span class="hljs-string">"Just ssh. Nothing more"</span>
IP_RANGE=<span class="hljs-string">"0.0.0.0/24"</span>
aws ec2 authorize-security-group-ingress --region <span class="hljs-variable">$REGION</span>  --group-name <span class="hljs-variable">$SECURITY</span> --protocol tcp --port 22 --cidr <span class="hljs-variable">$IP_RANGE</span></code></pre><br>
<ul>
<li>       security-group   ID .  ,  ,   :</li>
</ul><br>
<pre><code class="bash hljs">IMG=<span class="hljs-string">'ami-0d0eaed20348a3389'</span><font></font>
NUM=1<font></font>
aws ec2 run-instances --region <span class="hljs-variable">$REGION</span> --image-id <span class="hljs-variable">$IMG</span> --count <span class="hljs-variable">$NUM</span> --instance-type t2.micro --key-name <span class="hljs-variable">$KEYNAME</span> --security-groups default <span class="hljs-variable">$SECURITY</span> &gt; instances.json</code></pre><br>
<ul>
<li>,   .   - :       (instances.json),       ,     (,     IP-).     (    ).</li>
</ul><br>
<p>    SSH,    IP-.    ,   .     PublicDnsName  PublicIpAddress.</p><br>
<pre><code class="bash hljs">aws ec2 describe-instances --region</code></pre><br>
<p>  SSH-,  SSH-,  :</p><br>
<pre><code class="plaintext hljs">ssh -I $KEYNAME -oStrictHostKeyChecking=no ubuntuâ€™'+ins_dns echoâ€˜'Oâ€™'</code></pre><br>
<p>SSH-          ,          .</p><br>
<p> ,      ,     ,  IP-,      .  IP-         .</p><br>
<p>AWS   IP-  ,   .    IP       (   !).</p><br>
<p>       ,     . Stop â€“  , terminate â€“      .</p><br>
<p>           ID :    ,  ,     :</p><br>
<pre><code class="bash hljs">aws cloudwatch get-metric-statistics --region REGION --namespace AWS/EC2 \<font></font>
        --statistics Sum --metric-name NetworkIn <font></font>
        --start-time <span class="hljs-variable">$STARTTIME</span> --end-time <span class="hljs-variable">$FINISHTIME</span>
        --period <span class="hljs-variable">$PERIOD</span> --dimensions Name=InstanceId,Value=<span class="hljs-variable">$INCTANCEID</span></code></pre><br>
<h1>  </h1><br>
<p>     ,    ,   .</p><br>
<p>    Â«Â»-,      (53  80   ). </p><br>
<p>   Python,     :</p><br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">http</span>(<span class="hljs-params">url</span>):</span>
    cmd = [<span class="hljs-string">'curl'</span>, <span class="hljs-string">'-w'</span>, <span class="hljs-string">'"%{time_total}"'</span>, <span class="hljs-string">'-o'</span>, <span class="hljs-string">'/dev/null'</span>, <span class="hljs-string">'-s'</span>, url]<font></font>
    result = check_output(cmd).decode(<span class="hljs-string">'utf-8'</span>)<font></font>
    result = float(json.loads(result))<font></font>
    <span class="hljs-keyword">return</span> result * <span class="hljs-number">1000000</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dns</span>(<span class="hljs-params">ip, domain</span>):</span>
    cmd = [<span class="hljs-string">'dig'</span>, <span class="hljs-string">'any'</span>, <span class="hljs-string">'@'</span>+ip, domain ]<font></font>
    result = check_output(cmd).decode(<span class="hljs-string">'utf-8'</span>)<font></font>
    result = int(result.split(<span class="hljs-string">'Query time:'</span>)[<span class="hljs-number">1</span>].split(<span class="hljs-string">'msec'</span>)[<span class="hljs-number">0</span>])
    <span class="hljs-keyword">return</span> result</code></pre><br>
<p>    -,            . </p><br>
<p>       Â«Â»-,       .             ,   .</p><br>
<p>   ,      ,       ,       ,    . </p><br>
<h1> </h1><br>
<p>    ,    , â€”    . </p><br>
<p>Amazon     ,   ,      .       .        (     ,      )     ( ).     99 %    .</p><br>
<p>           [  ]       . </p><br>
<p>         Amazon,      .     .        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>. </p><br>
<p>        , ,     DNS-    10 /c. </p><br>
<p> ,       t3.small,   ,   500 /c    .     â€“ 0,0224 $  ,   â€“ 0,01093 $  1 .        20 .</p><br>
<p>     ,      ,       60 .</p><br>
<p>    :</p><br>
<pre><code class="plaintext hljs">60  * (   ) + 60  * 0,5 /c * (  ) =       60 .<font></font>
<font></font>
1 * (    ) + 2 * (    ) + ... + 20 * (    ) =   </code></pre><br>
<p>,       10 /c  DNS- â€“  70 $. ,    ,        .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>.  ,   â€“    ,     . </p><br>
<p>      .          . </p><cut></cut></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja481746/index.html">CLIã§ã®ç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã€‚WSL / Windowsã‚¿ãƒ¼ãƒŸãƒŠãƒ«</a></li>
<li><a href="../ja481748/index.html">ã‚¢ãƒ«ãƒ¡ãƒ‹ã‚¢ã®ç¦åˆ©åšç”Ÿãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼šä¿é™ºã¨ç´¹ä»‹ãƒœãƒ¼ãƒŠã‚¹ã‹ã‚‰ãƒãƒƒã‚µãƒ¼ã‚¸ã¨ãƒ­ãƒ¼ãƒ³ã¾ã§</a></li>
<li><a href="../ja481750/index.html">ã‚¿ã‚¹ã‚¯ç•ªå·3ã€‚ãƒ‡ãƒ¼ã‚¿å¤‰æ›ã¨ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</a></li>
<li><a href="../ja481752/index.html">è¨€èªèª¿æŸ»çµæœ</a></li>
<li><a href="../ja481754/index.html">ç§ãƒœãƒƒãƒˆã¨ç§ã®åƒæšé€šã—</a></li>
<li><a href="../ja481758/index.html">å»ºè¨­ã€ä¾›çµ¦ãŠã‚ˆã³ISSã¸ã®è¨ªå•ã®çµ±è¨ˆ</a></li>
<li><a href="../ja481762/index.html">ã‚¯ãƒªã‚¹ãƒã‚¹ãƒ„ãƒªãƒ¼ã®ä¸‹ã®ã‚­ãƒƒãƒãƒ³ã®æ–¹ç¨‹å¼</a></li>
<li><a href="../ja481764/index.html">ã‚°ãƒªãƒ¼ãƒ³ã‚¨ãƒãƒ«ã‚®ãƒ¼ã«å›°é›£ãªæœªæ¥ãŒã‚ã‚‹ã®ã¯ãªãœã§ã™ã‹ï¼Ÿ</a></li>
<li><a href="../ja481768/index.html">1Cã§WebKitã‚’æ‰±ã„ã¾ã™ã€‚ãŸã¨ãˆã°ã€UT 11.4ã®ãƒãƒãƒ¼ã‚¸ãƒ•ã‚©ãƒ¼ãƒ ã¸ã®TinyMCEã®çµ±åˆã§ã™ã€‚</a></li>
<li><a href="../ja481770/index.html">ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®ãƒ‘ã‚¤ã‚ªãƒ‹ã‚¢ã§ã‚ã‚‹ãƒˆãƒ‹ãƒ¼ãƒ–ãƒ©ãƒƒã‚«ãƒ¼ãŒ94æ­³ã§äº¡ããªã‚‹</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>