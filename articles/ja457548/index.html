<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸŒ ğŸ¡ ğŸ˜¼ TMS320F28027ã§ã®å¤šç›¸PWMä¿¡å·ã®ç”Ÿæˆ ğŸ‘¨â€ğŸ‘¨â€ğŸ‘§ ğŸ¤µğŸ¿ ğŸ––ğŸ¾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æ˜” é ãé›¢ã‚ŒãŸéŠ€æ²³ã§Texas Instrumentsã®å°‚é–€ã®Piccoloã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã«é–¢ã™ã‚‹çŸ­ã„è¨˜äº‹ã‚’æ›¸ãã¾ã—ãŸã€‚ã“ã‚Œã¯ã€é›»åŠ›ã‚³ãƒ³ãƒãƒ¼ã‚¿ãƒ¼ã¨é›»æ°—ãƒ‰ãƒ©ã‚¤ãƒ–ã‚’åˆ¶å¾¡ã™ã‚‹ã‚ˆã†ã«è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã¯å¤šãã®ã‚¿ã‚¹ã‚¯ã§éå¸¸ã«å¼·åŠ›ãªé–‹ç™ºãƒ„ãƒ¼ãƒ«ã§ã‚ã‚Šã€ç§ã¯ãã‚Œã‚‰ã«ã¤ã„ã¦ä½•ã‹ä»–ã®ã‚‚ã®ã‚’æ›¸ããŸã‹...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>TMS320F28027ã§ã®å¤šç›¸PWMä¿¡å·ã®ç”Ÿæˆ</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457548/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜” </font></font><del><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é ãé›¢ã‚ŒãŸéŠ€æ²³ã§</font></font></del><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Texas Instrumentsã®å°‚é–€ã®Piccoloã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã«é–¢ã™ã‚‹</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çŸ­ã„è¨˜äº‹</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚’æ›¸ãã¾ã—ãŸ</font><font style="vertical-align: inherit;">ã€‚ã“ã‚Œã¯ã€é›»åŠ›ã‚³ãƒ³ãƒãƒ¼ã‚¿ãƒ¼ã¨é›»æ°—ãƒ‰ãƒ©ã‚¤ãƒ–ã‚’åˆ¶å¾¡ã™ã‚‹ã‚ˆã†ã«è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã‚Œã‚‰ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã¯å¤šãã®ã‚¿ã‚¹ã‚¯ã§éå¸¸ã«å¼·åŠ›ãªé–‹ç™ºãƒ„ãƒ¼ãƒ«ã§ã‚ã‚Šã€ç§ã¯ãã‚Œã‚‰ã«ã¤ã„ã¦ä½•ã‹ä»–ã®ã‚‚ã®ã‚’æ›¸ããŸã‹ã£ãŸã§ã™...ã‚·ãƒ³ãƒ—ãƒ«ã§ä¾¿åˆ©ã§ã™ã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€è¿‘ã€ãƒ¢ãƒ¼ã‚¿ãƒ¼åˆ¶å¾¡ç”¨ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’é–‹ç™ºã™ã‚‹ã“ã¨ã«å›°æƒ‘ã—ã€ãã‚Œã«å¿œã˜ã¦è¨˜äº‹ã®ãƒˆãƒ”ãƒƒã‚¯ãŒå½¢æˆã•ã‚Œã¾ã—ãŸã€‚ä»Šæ—¥ã¯ã€ãƒ¢ãƒ¼ã‚¿ãƒ¼åˆ¶å¾¡ç”¨ã®ä¸‰ç›¸PWMã‚’å½¢æˆã™ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã«ã¤ã„ã¦è©±ã—ã€TMS320F28ã¨STM32F334ã€STM32G484ã€XMC4200ãªã©ã®ãã®ä»–ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã¨ã®æœ‰ç›Šãªé•ã„ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚ </font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¹ã‚¿ãƒ³ãƒ‰ã¨ã—ã¦ã€ç§ã¯é–‹ç™ºä¸­ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ä½¿ç”¨ã—ã¾ã™ãŒã€ã‚ã‚ã€ç§ã¯é‰„ã®éƒ¨åˆ†ã«ã¤ã„ã¦è©³ã—ãè©±ã™ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚</font><font style="vertical-align: inherit;">ç¢ºã‹ã«ã€ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãŒTMS320F28027 + DRV8353RSRGZTãƒãƒ³ãƒ‰ãƒ«ã«åŸºã¥ã„ã¦ã„ã‚‹ã¨è¨€ãˆã°ã€ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚·ãƒ¼ãƒˆã‚’è¦‹ã¦ã€ä¸€èˆ¬çš„ãªå›è·¯ã®æ¦‚å¿µã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™+ã“ã®çŸ³ã®ãƒ‡ãƒãƒƒã‚°ãŒã‚ã‚Šã€ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ãƒ‡ã‚¶ã‚¤ãƒ³ãŒé–‹ã„ã¦ã„ã¾ã™ã€‚</font></font></p><br>
<p><img src="https://habrastorage.org/webt/bu/ps/ur/bupsur6y9nfobnpa53zqjrfodmo.jpeg" alt="BLDCãƒ‰ãƒ©ã‚¤ãƒãƒ¼"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŸå‰‡ã¨ã—ã¦ã€åŒã˜ã‚¿ã‚¤ãƒ—ã®å›è·¯ã§ã€æ­£å¼¦æ³¢å‡ºåŠ›ãŒã™ã§ã«å¿…è¦ãªé›»åœ§ãƒ¬ãƒ™ãƒ«ã¨é€šå¸¸ã®ä¸‰ç›¸ã‚’ã€Œæ¶ˆè²»ã€ã™ã‚‹BLDCãƒ¢ãƒ¼ã‚¿ãƒ¼ã‚’åˆ¶å¾¡ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚</font><font style="vertical-align: inherit;">ä¸¡æ–¹ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤ºã—ã¾ã™ </font><font style="vertical-align: inherit;">ã‚µã‚¤ãƒ³ã¸ã®ãƒ‘ã‚¹ã¯ã€é›»åœ§ãƒ¬ãƒ™ãƒ«ã®å½¢æˆã«ã‚ã‚Šã¾ã™ã€‚</font></font></p><br>
<p><img src="https://habrastorage.org/webt/qf/rd/ck/qfrdck6y4rcvirbws9o6zbzrfea.png" alt="ã‚ªã‚·ãƒ­ã‚°ãƒ©ãƒ ç•ªå·1"></p><a name="habracut"></a><br>
<h1 id="nemnogo-o-zheleze"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é‰„ã«ã¤ã„ã¦å°‘ã—</font></font></h1><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã®é›»æºéƒ¨åˆ†ã¯ã€æ€æƒ³çš„ã«3ã¤ã®ãƒãƒ¼ãƒ•ãƒ–ãƒªãƒƒã‚¸ã‚³ãƒ³ãƒãƒ¼ã‚¿ãƒ¼ã§æ§‹æˆã•ã‚Œã¾ã™ã€‚ã™ã¹ã¦ã®ãƒ˜ãƒªã‚³ãƒ—ã‚¿ãƒ¼ã®BLDCã‚¨ãƒ³ã‚¸ãƒ³ã‚’åˆ¶å¾¡ã™ã‚‹ãŸã‚ã®ã™ã¹ã¦ã®ã‚·ãƒ£ã‚¹ãƒˆãƒ‹ãƒƒã‚¯ã¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã¯ã€åŒæ§˜ã®æ–¹æ³•ã§ä½œæˆã•ã‚Œã¾ã™ã€‚</font></font></p><br>
<p><img src="https://habrastorage.org/webt/fm/kd/3t/fmkd3tequjgg3gapytg5bvupwfw.png" alt="ä¸‰ç›¸ãƒ–ãƒªãƒƒã‚¸"></p><br>
<p>  â€”     , ..      .         li-ion     18650.   DRV8353RSRGZT     3-  ,                  ,  dc/dc,     70...80        SPI. ,          .</p><br>
<p>          , ,    ,   SPI    dc/dc   .           ""     .      ,              2  .      â€”   :</p><br>
<p><img src="https://habrastorage.org/webt/hh/ud/hh/hhudhh5jk3tpwowsivbvjjar66e.jpeg" alt="ç†±ç”»åƒè£…ç½®"></p><br>
<p>       2- .        .      5 (     )        -  .    ,     ,  5     . </p><br>
<ul>
<li><strong> â„–1</strong><br>
     ,            â€”    dc/dc,     15...50   3.3   , ,    .         LM5008  LM5017         60  3.3      100-150 ,      â€”      65-70%   300 !   ,       3.3,    ,      10-12-15.   12 100       ,     88%. <strong> </strong> â€”  dc/dc   15...50  12,    12   3.3    dc/dc. </li>
</ul><br>
<br>
<ul>
<li><strong> â„–2</strong><br>
            .   ,      QFN      "",     GND      (via)          .        dc/dc    ,    ,   ("")     GND   ,               GND.   ,     ~0.5  ,         ,     . <strong> </strong> â€”          (Bottom Layer)    :</li>
</ul><br>
<p><img src="https://habrastorage.org/webt/xj/hr/0g/xjhr0galowhdsrtub50fwouwj_s.png" alt="ãƒ—ãƒªãƒ³ãƒˆå›è·¯åŸºæ¿"></p><br>
<p>         :   dc/dc  12-3.3        GND       +     .           +82  +43 <sup>o</sup>C:</p><br>
<p><img src="https://habrastorage.org/webt/_p/t9/qf/_pt9qfhtiicqqdj-kuo_ssg2zsm.png" alt="ã‚µãƒ¼ãƒ¢ã‚°ãƒ©ãƒ "></p><br>
<p>             ,                 ,  .     ,        .       <strong>DRV8353</strong>.</p><br>
<h1 id="realizaciya-apparatnogo-sdviga-faz-na-120suposup">     120<sup>o</sup></h1><br>
<p>    ,      ,    120<sup>o</sup>  .        120<sup>o</sup>?    ,        1/3 .        <em>2Ï€</em>,        2Ï€/3,    4Ï€/3.          . ,   60        50 ,       0  1200 (60 000 000  / 50 000  = 1200).    3    120<sup>o</sup>   1-   ,  2-      +400,  3-      +800.</p><br>
<p>      cortex,              .       ST, NXP           .     TI   TMS320F28xxx,        !        ,  ,       .            stm     ,         " ",    -       .       ?    ,   ,   .      ,            .</p><br>
<p>        3-    dead time   .   .     : EPWM1A + EPWM1B, EPWM2A + EPWM2B  EPWM4A + EPWM4B.          . </p><br>
<ul>
<li><strong> 1</strong><br>
   GPIO    <em>GPAMUX</em>    PWM      ,          .1    .     ,     .    ,           <em>EALLOW</em>         <em>EDIS</em>.</li>
</ul><br>
<pre><code class="cpp hljs">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">InitGPIOforPWM</span> <span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
<font></font>
    EALLOW;<font></font>
<font></font>
    GpioCtrlRegs.GPAPUD.bit.GPIO0 = <span class="hljs-number">1</span>;    <span class="hljs-comment">// Disable pull-up on GPIO0 (EPWM1A)</span>
    GpioCtrlRegs.GPAPUD.bit.GPIO1 = <span class="hljs-number">1</span>;    <span class="hljs-comment">// Disable pull-up on GPIO1 (EPWM1B)</span><font></font>
<font></font>
    GpioCtrlRegs.GPAMUX1.bit.GPIO0 = <span class="hljs-number">1</span>;   <span class="hljs-comment">// Configure GPIO0 as EPWM1A</span>
    GpioCtrlRegs.GPAMUX1.bit.GPIO1 = <span class="hljs-number">1</span>;   <span class="hljs-comment">// Configure GPIO1 as EPWM1B</span><font></font>
<font></font>
    GpioCtrlRegs.GPAPUD.bit.GPIO2 = <span class="hljs-number">1</span>;    <span class="hljs-comment">// Disable pull-up on GPIO2 (EPWM2A)</span>
    GpioCtrlRegs.GPAPUD.bit.GPIO3 = <span class="hljs-number">1</span>;    <span class="hljs-comment">// Disable pull-up on GPIO3 (EPWM2B)</span><font></font>
<font></font>
    GpioCtrlRegs.GPAMUX1.bit.GPIO2 = <span class="hljs-number">1</span>;   <span class="hljs-comment">// Configure GPIO2 as EPWM2A</span>
    GpioCtrlRegs.GPAMUX1.bit.GPIO3 = <span class="hljs-number">1</span>;   <span class="hljs-comment">// Configure GPIO3 as EPWM2B</span><font></font>
<font></font>
    GpioCtrlRegs.GPAPUD.bit.GPIO6 = <span class="hljs-number">1</span>;    <span class="hljs-comment">// Disable pull-up on GPIO6 (EPWM4A)</span>
    GpioCtrlRegs.GPAPUD.bit.GPIO7 = <span class="hljs-number">1</span>;    <span class="hljs-comment">// Disable pull-up on GPIO7 (EPWM4B)</span><font></font>
<font></font>
    GpioCtrlRegs.GPAMUX1.bit.GPIO6 = <span class="hljs-number">1</span>;   <span class="hljs-comment">// Configure GPIO6 as EPWM4A</span>
    GpioCtrlRegs.GPAMUX1.bit.GPIO7 = <span class="hljs-number">1</span>;   <span class="hljs-comment">// Configure GPIO7 as EPWM4B</span><font></font>
<font></font>
    EDIS;<font></font>
}</code></pre><br>
<ul>
<li><strong> 2</strong><br>
   .    50     120<sup>o</sup>.       PWM,       HRPWM,   .   PWM   ,   60 ,    PLL       TMS320,   ,             .</li>
</ul><br>
<pre><code class="cpp hljs">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">InitPWM</span> <span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
<font></font>
    <span class="hljs-comment">// EPWM Module 1 config</span>
    EPwm1Regs.TBPRD = <span class="hljs-number">600</span>; <span class="hljs-comment">// Set priod</span>
    EPwm1Regs.TBPHS.half.TBPHS = <span class="hljs-number">0</span>; <span class="hljs-comment">// Set phase</span>
    EPwm1Regs.TBCTL.bit.CTRMODE = TB_COUNT_UPDOWN; <span class="hljs-comment">// Symmetrical mode</span>
    EPwm1Regs.TBCTL.bit.PHSEN = TB_DISABLE; <span class="hljs-comment">// Master enable</span><font></font>
    EPwm1Regs.TBCTL.bit.PRDLD = TB_SHADOW;<font></font>
    EPwm1Regs.TBCTL.bit.SYNCOSEL = TB_CTR_ZERO; <span class="hljs-comment">// Sync down-stream module</span><font></font>
    EPwm1Regs.CMPCTL.bit.SHDWAMODE = CC_SHADOW;<font></font>
    EPwm1Regs.CMPCTL.bit.SHDWBMODE = CC_SHADOW;<font></font>
    EPwm1Regs.CMPCTL.bit.LOADAMODE = CC_CTR_ZERO; <font></font>
    EPwm1Regs.CMPCTL.bit.LOADBMODE = CC_CTR_ZERO; <font></font>
    EPwm1Regs.AQCTLA.bit.CAU = AQ_SET;<font></font>
    EPwm1Regs.AQCTLA.bit.CAD = AQ_CLEAR;<font></font>
    EPwm1Regs.DBCTL.bit.OUT_MODE = DB_FULL_ENABLE; <span class="hljs-comment">// enable dead-time module</span>
    EPwm1Regs.DBCTL.bit.POLSEL = DB_ACTV_HIC; <span class="hljs-comment">// Active Hi complementary</span>
    EPwm1Regs.DBFED = <span class="hljs-number">20</span>; <span class="hljs-comment">// dead-time on 20 tick</span>
    EPwm1Regs.DBRED = <span class="hljs-number">20</span>; <span class="hljs-comment">// dead-time off 20 tick</span><font></font>
<font></font>
    <span class="hljs-comment">// EPWM Module 2 config</span>
    EPwm2Regs.TBPRD = <span class="hljs-number">600</span>; <font></font>
    EPwm2Regs.TBPHS.half.TBPHS = <span class="hljs-number">400</span>; <span class="hljs-comment">// Set phase = 400/1200 * 360 = 120 deg</span><font></font>
    EPwm2Regs.TBCTL.bit.CTRMODE = TB_COUNT_UPDOWN; <font></font>
    EPwm2Regs.TBCTL.bit.PHSEN = TB_ENABLE; <span class="hljs-comment">// Slave enable</span>
    EPwm2Regs.TBCTL.bit.PHSDIR = TB_DOWN; <span class="hljs-comment">// Count DOWN on sync (=120 deg)</span><font></font>
    EPwm2Regs.TBCTL.bit.PRDLD = TB_SHADOW;<font></font>
    EPwm2Regs.TBCTL.bit.SYNCOSEL = TB_SYNC_IN; <span class="hljs-comment">// sync flow-through</span><font></font>
    EPwm2Regs.CMPCTL.bit.SHDWAMODE = CC_SHADOW;<font></font>
    EPwm2Regs.CMPCTL.bit.SHDWBMODE = CC_SHADOW;<font></font>
    EPwm2Regs.CMPCTL.bit.LOADAMODE = CC_CTR_ZERO; <font></font>
    EPwm2Regs.CMPCTL.bit.LOADBMODE = CC_CTR_ZERO; <font></font>
    EPwm2Regs.AQCTLA.bit.CAU = AQ_SET; <font></font>
    EPwm2Regs.AQCTLA.bit.CAD = AQ_CLEAR;<font></font>
    EPwm2Regs.DBCTL.bit.OUT_MODE = DB_FULL_ENABLE; <font></font>
    EPwm2Regs.DBCTL.bit.POLSEL = DB_ACTV_HIC; <font></font>
    EPwm2Regs.DBFED = <span class="hljs-number">20</span>; <font></font>
    EPwm2Regs.DBRED = <span class="hljs-number">20</span>;<font></font>
<font></font>
    <span class="hljs-comment">// EPWM Module 4 config</span>
    EPwm4Regs.TBPRD = <span class="hljs-number">600</span>; <font></font>
    EPwm4Regs.TBPHS.half.TBPHS = <span class="hljs-number">400</span>; <font></font>
    EPwm4Regs.TBCTL.bit.CTRMODE = TB_COUNT_UPDOWN; <font></font>
    EPwm4Regs.TBCTL.bit.PHSEN = TB_ENABLE; <font></font>
    EPwm4Regs.TBCTL.bit.PHSDIR = TB_UP; <font></font>
    EPwm4Regs.TBCTL.bit.PRDLD = TB_SHADOW;<font></font>
    EPwm4Regs.TBCTL.bit.SYNCOSEL = TB_SYNC_IN; <font></font>
    EPwm4Regs.CMPCTL.bit.SHDWAMODE = CC_SHADOW;<font></font>
    EPwm4Regs.CMPCTL.bit.SHDWBMODE = CC_SHADOW;<font></font>
    EPwm4Regs.CMPCTL.bit.LOADAMODE = CC_CTR_ZERO; <font></font>
    EPwm4Regs.CMPCTL.bit.LOADBMODE = CC_CTR_ZERO; <font></font>
    EPwm4Regs.AQCTLA.bit.CAU = AQ_SET; <font></font>
    EPwm4Regs.AQCTLA.bit.CAD = AQ_CLEAR;<font></font>
    EPwm4Regs.DBCTL.bit.OUT_MODE = DB_FULL_ENABLE; <font></font>
    EPwm4Regs.DBCTL.bit.POLSEL = DB_ACTV_HIC; <font></font>
    EPwm4Regs.DBFED = <span class="hljs-number">20</span>; <font></font>
    EPwm4Regs.DBRED = <span class="hljs-number">20</span>; <font></font>
<font></font>
}</code></pre><br>
<p>  â€¦   <em>TBPRD</em>  ,  " / 2", ..     ,    600    -  50     .   <em>TBPHS</em>       ,    400  600,   2Ï€/3.   ,  1-    ,      0,  2-     400,    3-      800,  800  600 -  â€¦      1- ,   ,   2-.   ,   3-   400    2Ï€/3   2  3,    2-  ,    1  3  "2Ï€/3 + 2Ï€/3 = 4Ï€/3"        .</p><br>
<p>       â€”  ,  EPWM1     <em>PHSEN</em>   master (),  EPWM2  EPWM4   slave ().      <em>SYNCOSEL</em>  "" ,       . EPWM1     ,     ,  EPWM2  EPWM4       :    EPWM2  EPWM1,   EPWM4  EPWM2.</p><br>
<p>        dead-time.    <em>POLSEL</em>    ,        ()    . 1.  <em>OUT_MODE</em>   dead-time       .    <em>DBFED</em>  <em>DBRED</em>      . </p><br>
<ul>
<li><strong> 3</strong><br>
      (duty)      <em>CMPA</em>    .</li>
</ul><br>
<pre><code class="cpp hljs">    EPwm1Regs.CMPA.half.CMPA = <span class="hljs-number">300</span>; <span class="hljs-comment">// duty for output EPWM1A</span>
    EPwm2Regs.CMPA.half.CMPA = <span class="hljs-number">300</span>; <span class="hljs-comment">// duty for output EPWM2A</span>
    EPwm4Regs.CMPA.half.CMPA = <span class="hljs-number">300</span>; <span class="hljs-comment">// duty for output EPWM4A</span></code></pre><br>
<p><img src="https://habrastorage.org/webt/sl/wy/6b/slwy6b5zoivfrdpbzlf9vpbsmms.png" alt="ä¸‰ç›¸PWM"></p><br>
<p>!      .   â€”   EPWM1,   .    EPWM2     2Ï€/3 (  400 )   ,       400 .     3 ,      120<sup>o</sup>.</p><br>
<p>           ,        dead-time   :</p><br>
<p><img src="https://habrastorage.org/webt/cd/aj/k7/cdajk7vfo9vs5d1yzvbuvtggy00.png" alt="ã‚ªã‚·ãƒ­ã‚°ãƒ©ãƒ ç•ªå·2"></p><br>
<p>      .    <em>1 / 60 000 000  = 16,6 </em>     20 ,      <em>20 </em> 16,6  = 332 ,*      . </p><br>
<p>    ,    ,  .    â€”  dc/dc ,    <strong>interleaved dc/dc converter</strong>.     ,       ,    ,     .   TMS320F28027   4-              .</p><br>
<h1 id="generiruem-trehfaznoe-peremennoe-napryazhenie">   </h1><br>
<p>          0  VCC,  .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>,           "" ,       .        ,     ,      (duty)     " ". </p><br>
<p>   .        50         . ,       50 ,     "",       ,    ,     .     TMS320F28027,       ,   .     ,    ,      TMU  FPU, , TMS320F280049,      . </p><br>
<p>    (duty)     ,     .    20  (1/50 = 20 )        20,     0,02  / 20 = 0,001  = 1             .      <em>CPU0</em>   : </p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">InitTimer0ForGenerator</span> <span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
<font></font>
    EALLOW;<font></font>
    PieVectTable.TINT0 = &amp;cpu_timer0_isr;<font></font>
    EDIS;<font></font>
<font></font>
    InitCpuTimers();<font></font>
    ConfigCpuTimer(&amp;CpuTimer0, <span class="hljs-number">60</span>, <span class="hljs-number">1000</span>);<font></font>
<font></font>
    CpuTimer0Regs.TCR.bit.TIE = <span class="hljs-number">1</span>;<font></font>
    CpuTimer0Regs.TCR.bit.TSS = <span class="hljs-number">0</span>;<font></font>
<font></font>
    IER |= M_INT1;<font></font>
<font></font>
    PieCtrlRegs.PIEIER1.bit.INTx7 = <span class="hljs-number">1</span>;  <span class="hljs-comment">// Enable TINT0 in the PIE: Group 1 interrupt 7</span><font></font>
<font></font>
    EINT;   <span class="hljs-comment">// Enable Global interrupt INTM</span>
    ERTM;   <span class="hljs-comment">// Enable Global real-time interrupt DBGM</span><font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function">__interrupt <span class="hljs-keyword">void</span> <span class="hljs-title">cpu_timer0_isr</span> <span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
<font></font>
   CpuTimer0.InterruptCount++;<font></font>
<font></font>
    <span class="hljs-comment">/*
    *   -  . ...
    */</span><font></font>
<font></font>
   PieCtrlRegs.PIEACK.all = PIEACK_GROUP1;  <span class="hljs-comment">// Acknowledge this interrupt to receive more interrupts from group 1</span><font></font>
<font></font>
}</code></pre><br>
<p> <em>InitCpuTimers</em>  <em>ConfigCpuTimer</em> ,     ,       (60 )      (1000  = 1 ),    1 ,      .             ,    . </p><br>
<p>   ""  ,        .  â€¦     <strong><em>y = sin(x)</em></strong>     :</p><br>
<p><img src="https://habrastorage.org/webt/hi/bx/ey/hibxeyajv_h7l7t-mqkbkfrq6-s.png" alt="y =ç½ªï¼ˆxï¼‰"></p><br>
<p>        -1  1,     0  1, ..      0,    ( 1)   +VCC.  "" -1...+1    ,   .      .      ,     0  +2,      +1.     2  -!          <strong><em>y = (sin(x)/2):</em></strong></p><br>
<p><img src="https://habrastorage.org/webt/t_/n0/iw/t_n0iw1fym8aboggaxk1my7r4um.png" alt="y =ï¼ˆç½ªï¼ˆxï¼‰/ 2ï¼‰"></p><br>
<p>!      -0.5  +0.5,     1.  ,        ,        0.5,             <strong><em>y = 0.5 + (sin(x)/2)</em></strong>      :</p><br>
<p><img src="https://habrastorage.org/webt/df/vu/ez/dfvuez1lks2uhg0cp3tkhie9cdq.png" alt="y = 0.5 +ï¼ˆsinï¼ˆxï¼‰/ 2ï¼‰"></p><br>
<p>     :     0  1,   .  <strong><em>y = 0.5 + (sin(x)/2)</em></strong>  1- ,     ,    2  3.    <em>x</em>  2Ï€/3  4Ï€/3        <strong><em>y = 0.5 + (sin(x-2Ï€/3)/2)</em></strong>  <strong><em>y = 0.5 + (sin(x-4Ï€/3)/2).</em></strong>  3       :</p><br>
<p><img src="https://habrastorage.org/webt/hj/kp/n9/hjkpn93-37r_rclbrevchhdzf_m.png" alt="3æ®µéš"></p><br>
<p>!    ,      ,        . , 2.0943  2Ï€/3,  4,1866  4Ï€/3,            .     3 :</p><br>
<ul>
<li>  â€” <strong><em>y = 0.5 + (sin(x)/2)</em></strong></li>
<li>  â€” <strong><em>y = 0.5 + (sin(x-2Ï€/3)/2)</em></strong></li>
<li>  â€” <strong><em>y = 0.5 + (sin(x-4Ï€/3)/2)</em></strong></li>
</ul><br>
<p>       ,       .     ,   "",   ,        0  +15 (VCC)   .   ,      20,   1     20 . </p><br>
<p>  ,    <em>x</em>.    <em>2Ï€</em>,       <em>2Ï€/20</em>.      20 ,       ,    .        <strong><em>sin(2Ï€ * (1/20),</em></strong>    <strong><em>sin (2Ï€ * (2/20)),</em></strong>    *<strong>sin (2Ï€ <em> (3/20))</em></strong>   ,     <em>20/20</em>,             .       :</p><br>
<ul>
<li>  â€” <strong><em>y = 0.5 + (sin(2Ï€ * (n/N))/2)</em></strong></li>
<li>  â€” <strong><em>y = 0.5 + (sin(2Ï€ * (n/N)-2Ï€/3)/2)</em></strong></li>
<li>  â€” <strong><em>y = 0.5 + (sin(2Ï€ * (n/N)-4Ï€/3)/2)</em></strong></li>
</ul><br>
<p>,           .  <strong>n</strong> â€”  , <strong>N</strong> â€”   (20).        0  1,         .        , .. duty   0  600 (  ),  0  0,  1  600.           ,       <em>CMPA</em>:</p><br>
<ul>
<li>  â€” <strong><em>duty1 = A <em> (0.5 + (sin(2Ï€ </em> (n/N))/2))</em></strong></li>
<li>  â€” <strong><em>duty2 = A <em> (0.5 + (sin(2Ï€ </em> (n/N)-2Ï€/3)/2))</em></strong></li>
<li>  â€” <strong><em>duty4 = A <em> (0.5 + (sin(2Ï€ </em> (n/N)-4Ï€/3)/2))</em></strong></li>
</ul><br>
<p> <strong></strong> â€”    ,   600, <strong>n</strong> â€”  , <strong>N</strong> â€”   (20).  <strong><em>duty1, duty2, duty4</em></strong> â€”       (duty),    <em>CMPA.</em>             :</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">float</span> activeStep = <span class="hljs-number">0.0</span>;
<span class="hljs-keyword">float</span> amplitude = <span class="hljs-number">600.0</span>;
<span class="hljs-keyword">float</span> allStep = <span class="hljs-number">20.0</span>;<font></font>
<font></font>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> pi = <span class="hljs-number">3.1415</span>;                    <span class="hljs-comment">// Ï€</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> piTwo = <span class="hljs-number">6.2831</span>;                 <span class="hljs-comment">// 2Ï€</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> phaseShifted120deg = <span class="hljs-number">2.0943</span>;    <span class="hljs-comment">// 2Ï€/3</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> phaseShifted240deg = <span class="hljs-number">4.1866</span>;    <span class="hljs-comment">// 4Ï€/3</span><font></font>
<font></font>
<span class="hljs-function">__interrupt <span class="hljs-keyword">void</span> <span class="hljs-title">cpu_timer0_isr</span> <span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
<font></font>
   <span class="hljs-keyword">if</span> (activeStep &gt;= allStep) {activeStep = <span class="hljs-number">0</span>;}<font></font>
<font></font>
   activeStep++;<font></font>
<font></font>
   EPwm1Regs.CMPA.half.CMPA = ((<span class="hljs-keyword">uint16_t</span>)(amplitude * (<span class="hljs-number">0.5</span> + (sinf(piTwo * (activeStep / allStep)) / <span class="hljs-number">2</span>))));<font></font>
   EPwm2Regs.CMPA.half.CMPA = ((<span class="hljs-keyword">uint16_t</span>)(amplitude * (<span class="hljs-number">0.5</span> + (sinf(piTwo * (activeStep / allStep) - phaseShifted120deg) / <span class="hljs-number">2</span>))));<font></font>
   EPwm4Regs.CMPA.half.CMPA = ((<span class="hljs-keyword">uint16_t</span>)(amplitude * (<span class="hljs-number">0.5</span> + (sinf(piTwo * (activeStep / allStep) - phaseShifted240deg) / <span class="hljs-number">2</span>))));<font></font>
<font></font>
   PieCtrlRegs.PIEACK.all = PIEACK_GROUP1;  <span class="hljs-comment">// Acknowledge this interrupt to receive more interrupts from group 1</span><font></font>
<font></font>
}<font></font>
</code></pre><br>
<p>   ,           .        <em>activeStep</em>,      ,    0  20   . ,       20   20    .       <em>2Ï€/3</em>  <em>4Ï€/3</em>    ,    . </p><br>
<p>  ,        .       , ,  200.    .             .       <em>amplitude</em>       . </p><br>
<p>        :</p><br>
<p><img src="https://habrastorage.org/webt/qf/rd/ck/qfrdck6y4rcvirbws9o6zbzrfea.png" alt="ã‚ªã‚·ãƒ­ã‚°ãƒ©ãƒ ç•ªå·1"></p><br>
<p>   <em>Y</em> ,      .      ,    : <strong>  ,   .</strong></p><br>
<p><img src="https://habrastorage.org/webt/wh/4d/du/wh4dduwnbyshscey7rlmzs6s1mw.png" alt="ã‚ªã‚·ãƒ­ã‚°ãƒ©ãƒ ç•ªå·3"></p><br>
<h1 id="zaklyuchenie"></h1><br>
<p>          ,     ,    TMS320F28.     ,       ,      ,     ,     .</p><br>
<p>          .    :</p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">    Code Composer Studio</a></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja457534/index.html">èªå®šãƒãƒ¼ã‚¸ãƒ§ãƒ³-ç§ãŸã¡ãŒé¸æŠã—ãŸãƒ¬ãƒ¼ã‚­</a></li>
<li><a href="../ja457538/index.html">ä¸­æ–­ã•ã‚ŒãŸYandex.Cloudä»®æƒ³ãƒã‚·ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã€å¤§è¦æ¨¡ãªå•é¡Œã‚’è§£æ±ºã™ã‚‹æ–¹æ³•</a></li>
<li><a href="../ja457540/index.html">Intel Optane DC Persistent Memoryã€1å¹´å¾Œ</a></li>
<li><a href="../ja457542/index.html">æš—å·åŒ–ã‚’ãƒãƒƒã‚­ãƒ³ã‚°ã—ã¦ä¿è­·ã™ã‚‹LUKS</a></li>
<li><a href="../ja457546/index.html">ãƒ‡ãƒ¢æ—¥ï¼šãªãœã“ã‚ŒãŒã™ã¹ã¦ã§ã‚ã‚Šã€ãã‚Œã‚’è¡Œã†æ–¹æ³•UPD + Broadcast</a></li>
<li><a href="../ja457550/index.html">ãƒ‡ã‚¸ã‚¿ãƒ«æ¥­ç•Œã‚’ä¿è­·ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‚‚ã®</a></li>
<li><a href="../ja457552/index.html">ã‚¶ãƒ•ã‚¡ã‚µãƒ‡ã‚£ã®ã‚¯ãƒ©ã‚¤ãƒãƒ¼ã€‚ãƒ©ãƒ•ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼ã‚¿ãƒ¯ãƒ¼ã®ãƒ—ãƒ­ãƒãƒ«ãƒ—ã®ä»•çµ„ã¿</a></li>
<li><a href="../ja457558/index.html">EvilParcelã®è„†å¼±æ€§åˆ†æ</a></li>
<li><a href="../ja457560/index.html">ãƒˆãƒ¼ã‚¯ãƒ³åŒ–ã•ã‚ŒãŸæ ªå¼ï¼šIPOã«è¡Œãå‰ã«ã‚²ãƒƒãƒˆã‚¤ãƒ³ãƒ™ã‚¹ã‚¿ãƒ¼ã«ãªã‚‹æ–¹æ³•</a></li>
<li><a href="../ja457562/index.html">Ivideon Counter 3Dï¼šèª°ãŒã€ã©ã®ã‚ˆã†ã«ã€ãã—ã¦ãªãœè¨ªå•è€…ã‚’ã‚«ã‚¦ãƒ³ãƒˆã™ã‚‹ã‹</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>