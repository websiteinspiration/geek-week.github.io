<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌎 🍡 😼 TMS320F28027での多相PWM信号の生成 👨‍👨‍👧 🤵🏿 🖖🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="昔 遠く離れた銀河でTexas Instrumentsの専門のPiccoloコントローラーに関する短い記事を書きました。これは、電力コンバーターと電気ドライブを制御するように設計されています。これらのコントローラーは多くのタスクで非常に強力な開発ツールであり、私はそれらについて何か他のものを書きたか...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>TMS320F28027での多相PWM信号の生成</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457548/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">昔 </font></font><del><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">遠く離れた銀河で</font></font></del><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Texas Instrumentsの専門のPiccoloコントローラーに関する</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">短い記事</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を書きました</font><font style="vertical-align: inherit;">。これは、電力コンバーターと電気ドライブを制御するように設計されています。</font><font style="vertical-align: inherit;">これらのコントローラーは多くのタスクで非常に強力な開発ツールであり、私はそれらについて何か他のものを書きたかったです...シンプルで便利です。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最近、モーター制御用のコントローラーを開発することに困惑し、それに応じて記事のトピックが形成されました。今日は、モーター制御用の三相PWMを形成するプロセスについて話し、TMS320F28とSTM32F334、STM32G484、XMC4200などのその他のコントローラーとの有益な違いについて説明します。 </font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スタンドとして、私は開発中のコントローラーを使用しますが、ああ、私は鉄の部分について詳しく話すことはできません。</font><font style="vertical-align: inherit;">確かに、コントローラーがTMS320F28027 + DRV8353RSRGZTバンドルに基づいていると言えば、ドライバーデータシートを見て、一般的な回路の概念を見ることができます+この石のデバッグがあり、リファレンスデザインが開いています。</font></font></p><br>
<p><img src="https://habrastorage.org/webt/bu/ps/ur/bupsur6y9nfobnpa53zqjrfodmo.jpeg" alt="BLDCドライバー"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">原則として、同じタイプの回路で、正弦波出力がすでに必要な電圧レベルと通常の三相を「消費」するBLDCモーターを制御することが可能です。</font><font style="vertical-align: inherit;">両方のオプションを表示します </font><font style="vertical-align: inherit;">サインへのパスは、電圧レベルの形成にあります。</font></font></p><br>
<p><img src="https://habrastorage.org/webt/qf/rd/ck/qfrdck6y4rcvirbws9o6zbzrfea.png" alt="オシログラム番号1"></p><a name="habracut"></a><br>
<h1 id="nemnogo-o-zheleze"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">鉄について少し</font></font></h1><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドライバーの電源部分は、思想的に3つのハーフブリッジコンバーターで構成されます。すべてのヘリコプターのBLDCエンジンを制御するためのすべてのシャストニックとコントローラーは、同様の方法で作成されます。</font></font></p><br>
<p><img src="https://habrastorage.org/webt/fm/kd/3t/fmkd3tequjgg3gapytg5bvupwfw.png" alt="三相ブリッジ"></p><br>
<p>  —     , ..      .         li-ion     18650.   DRV8353RSRGZT     3-  ,                  ,  dc/dc,     70...80        SPI. ,          .</p><br>
<p>          , ,    ,   SPI    dc/dc   .           ""     .      ,              2  .      —   :</p><br>
<p><img src="https://habrastorage.org/webt/hh/ud/hh/hhudhh5jk3tpwowsivbvjjar66e.jpeg" alt="熱画像装置"></p><br>
<p>       2- .        .      5 (     )        -  .    ,     ,  5     . </p><br>
<ul>
<li><strong> №1</strong><br>
     ,            —    dc/dc,     15...50   3.3   , ,    .         LM5008  LM5017         60  3.3      100-150 ,      —      65-70%   300 !   ,       3.3,    ,      10-12-15.   12 100       ,     88%. <strong> </strong> —  dc/dc   15...50  12,    12   3.3    dc/dc. </li>
</ul><br>
<br>
<ul>
<li><strong> №2</strong><br>
            .   ,      QFN      "",     GND      (via)          .        dc/dc    ,    ,   ("")     GND   ,               GND.   ,     ~0.5  ,         ,     . <strong> </strong> —          (Bottom Layer)    :</li>
</ul><br>
<p><img src="https://habrastorage.org/webt/xj/hr/0g/xjhr0galowhdsrtub50fwouwj_s.png" alt="プリント回路基板"></p><br>
<p>         :   dc/dc  12-3.3        GND       +     .           +82  +43 <sup>o</sup>C:</p><br>
<p><img src="https://habrastorage.org/webt/_p/t9/qf/_pt9qfhtiicqqdj-kuo_ssg2zsm.png" alt="サーモグラム"></p><br>
<p>             ,                 ,  .     ,        .       <strong>DRV8353</strong>.</p><br>
<h1 id="realizaciya-apparatnogo-sdviga-faz-na-120suposup">     120<sup>o</sup></h1><br>
<p>    ,      ,    120<sup>o</sup>  .        120<sup>o</sup>?    ,        1/3 .        <em>2π</em>,        2π/3,    4π/3.          . ,   60        50 ,       0  1200 (60 000 000  / 50 000  = 1200).    3    120<sup>o</sup>   1-   ,  2-      +400,  3-      +800.</p><br>
<p>      cortex,              .       ST, NXP           .     TI   TMS320F28xxx,        !        ,  ,       .            stm     ,         " ",    -       .       ?    ,   ,   .      ,            .</p><br>
<p>        3-    dead time   .   .     : EPWM1A + EPWM1B, EPWM2A + EPWM2B  EPWM4A + EPWM4B.          . </p><br>
<ul>
<li><strong> 1</strong><br>
   GPIO    <em>GPAMUX</em>    PWM      ,          .1    .     ,     .    ,           <em>EALLOW</em>         <em>EDIS</em>.</li>
</ul><br>
<pre><code class="cpp hljs">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">InitGPIOforPWM</span> <span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
<font></font>
    EALLOW;<font></font>
<font></font>
    GpioCtrlRegs.GPAPUD.bit.GPIO0 = <span class="hljs-number">1</span>;    <span class="hljs-comment">// Disable pull-up on GPIO0 (EPWM1A)</span>
    GpioCtrlRegs.GPAPUD.bit.GPIO1 = <span class="hljs-number">1</span>;    <span class="hljs-comment">// Disable pull-up on GPIO1 (EPWM1B)</span><font></font>
<font></font>
    GpioCtrlRegs.GPAMUX1.bit.GPIO0 = <span class="hljs-number">1</span>;   <span class="hljs-comment">// Configure GPIO0 as EPWM1A</span>
    GpioCtrlRegs.GPAMUX1.bit.GPIO1 = <span class="hljs-number">1</span>;   <span class="hljs-comment">// Configure GPIO1 as EPWM1B</span><font></font>
<font></font>
    GpioCtrlRegs.GPAPUD.bit.GPIO2 = <span class="hljs-number">1</span>;    <span class="hljs-comment">// Disable pull-up on GPIO2 (EPWM2A)</span>
    GpioCtrlRegs.GPAPUD.bit.GPIO3 = <span class="hljs-number">1</span>;    <span class="hljs-comment">// Disable pull-up on GPIO3 (EPWM2B)</span><font></font>
<font></font>
    GpioCtrlRegs.GPAMUX1.bit.GPIO2 = <span class="hljs-number">1</span>;   <span class="hljs-comment">// Configure GPIO2 as EPWM2A</span>
    GpioCtrlRegs.GPAMUX1.bit.GPIO3 = <span class="hljs-number">1</span>;   <span class="hljs-comment">// Configure GPIO3 as EPWM2B</span><font></font>
<font></font>
    GpioCtrlRegs.GPAPUD.bit.GPIO6 = <span class="hljs-number">1</span>;    <span class="hljs-comment">// Disable pull-up on GPIO6 (EPWM4A)</span>
    GpioCtrlRegs.GPAPUD.bit.GPIO7 = <span class="hljs-number">1</span>;    <span class="hljs-comment">// Disable pull-up on GPIO7 (EPWM4B)</span><font></font>
<font></font>
    GpioCtrlRegs.GPAMUX1.bit.GPIO6 = <span class="hljs-number">1</span>;   <span class="hljs-comment">// Configure GPIO6 as EPWM4A</span>
    GpioCtrlRegs.GPAMUX1.bit.GPIO7 = <span class="hljs-number">1</span>;   <span class="hljs-comment">// Configure GPIO7 as EPWM4B</span><font></font>
<font></font>
    EDIS;<font></font>
}</code></pre><br>
<ul>
<li><strong> 2</strong><br>
   .    50     120<sup>o</sup>.       PWM,       HRPWM,   .   PWM   ,   60 ,    PLL       TMS320,   ,             .</li>
</ul><br>
<pre><code class="cpp hljs">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">InitPWM</span> <span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
<font></font>
    <span class="hljs-comment">// EPWM Module 1 config</span>
    EPwm1Regs.TBPRD = <span class="hljs-number">600</span>; <span class="hljs-comment">// Set priod</span>
    EPwm1Regs.TBPHS.half.TBPHS = <span class="hljs-number">0</span>; <span class="hljs-comment">// Set phase</span>
    EPwm1Regs.TBCTL.bit.CTRMODE = TB_COUNT_UPDOWN; <span class="hljs-comment">// Symmetrical mode</span>
    EPwm1Regs.TBCTL.bit.PHSEN = TB_DISABLE; <span class="hljs-comment">// Master enable</span><font></font>
    EPwm1Regs.TBCTL.bit.PRDLD = TB_SHADOW;<font></font>
    EPwm1Regs.TBCTL.bit.SYNCOSEL = TB_CTR_ZERO; <span class="hljs-comment">// Sync down-stream module</span><font></font>
    EPwm1Regs.CMPCTL.bit.SHDWAMODE = CC_SHADOW;<font></font>
    EPwm1Regs.CMPCTL.bit.SHDWBMODE = CC_SHADOW;<font></font>
    EPwm1Regs.CMPCTL.bit.LOADAMODE = CC_CTR_ZERO; <font></font>
    EPwm1Regs.CMPCTL.bit.LOADBMODE = CC_CTR_ZERO; <font></font>
    EPwm1Regs.AQCTLA.bit.CAU = AQ_SET;<font></font>
    EPwm1Regs.AQCTLA.bit.CAD = AQ_CLEAR;<font></font>
    EPwm1Regs.DBCTL.bit.OUT_MODE = DB_FULL_ENABLE; <span class="hljs-comment">// enable dead-time module</span>
    EPwm1Regs.DBCTL.bit.POLSEL = DB_ACTV_HIC; <span class="hljs-comment">// Active Hi complementary</span>
    EPwm1Regs.DBFED = <span class="hljs-number">20</span>; <span class="hljs-comment">// dead-time on 20 tick</span>
    EPwm1Regs.DBRED = <span class="hljs-number">20</span>; <span class="hljs-comment">// dead-time off 20 tick</span><font></font>
<font></font>
    <span class="hljs-comment">// EPWM Module 2 config</span>
    EPwm2Regs.TBPRD = <span class="hljs-number">600</span>; <font></font>
    EPwm2Regs.TBPHS.half.TBPHS = <span class="hljs-number">400</span>; <span class="hljs-comment">// Set phase = 400/1200 * 360 = 120 deg</span><font></font>
    EPwm2Regs.TBCTL.bit.CTRMODE = TB_COUNT_UPDOWN; <font></font>
    EPwm2Regs.TBCTL.bit.PHSEN = TB_ENABLE; <span class="hljs-comment">// Slave enable</span>
    EPwm2Regs.TBCTL.bit.PHSDIR = TB_DOWN; <span class="hljs-comment">// Count DOWN on sync (=120 deg)</span><font></font>
    EPwm2Regs.TBCTL.bit.PRDLD = TB_SHADOW;<font></font>
    EPwm2Regs.TBCTL.bit.SYNCOSEL = TB_SYNC_IN; <span class="hljs-comment">// sync flow-through</span><font></font>
    EPwm2Regs.CMPCTL.bit.SHDWAMODE = CC_SHADOW;<font></font>
    EPwm2Regs.CMPCTL.bit.SHDWBMODE = CC_SHADOW;<font></font>
    EPwm2Regs.CMPCTL.bit.LOADAMODE = CC_CTR_ZERO; <font></font>
    EPwm2Regs.CMPCTL.bit.LOADBMODE = CC_CTR_ZERO; <font></font>
    EPwm2Regs.AQCTLA.bit.CAU = AQ_SET; <font></font>
    EPwm2Regs.AQCTLA.bit.CAD = AQ_CLEAR;<font></font>
    EPwm2Regs.DBCTL.bit.OUT_MODE = DB_FULL_ENABLE; <font></font>
    EPwm2Regs.DBCTL.bit.POLSEL = DB_ACTV_HIC; <font></font>
    EPwm2Regs.DBFED = <span class="hljs-number">20</span>; <font></font>
    EPwm2Regs.DBRED = <span class="hljs-number">20</span>;<font></font>
<font></font>
    <span class="hljs-comment">// EPWM Module 4 config</span>
    EPwm4Regs.TBPRD = <span class="hljs-number">600</span>; <font></font>
    EPwm4Regs.TBPHS.half.TBPHS = <span class="hljs-number">400</span>; <font></font>
    EPwm4Regs.TBCTL.bit.CTRMODE = TB_COUNT_UPDOWN; <font></font>
    EPwm4Regs.TBCTL.bit.PHSEN = TB_ENABLE; <font></font>
    EPwm4Regs.TBCTL.bit.PHSDIR = TB_UP; <font></font>
    EPwm4Regs.TBCTL.bit.PRDLD = TB_SHADOW;<font></font>
    EPwm4Regs.TBCTL.bit.SYNCOSEL = TB_SYNC_IN; <font></font>
    EPwm4Regs.CMPCTL.bit.SHDWAMODE = CC_SHADOW;<font></font>
    EPwm4Regs.CMPCTL.bit.SHDWBMODE = CC_SHADOW;<font></font>
    EPwm4Regs.CMPCTL.bit.LOADAMODE = CC_CTR_ZERO; <font></font>
    EPwm4Regs.CMPCTL.bit.LOADBMODE = CC_CTR_ZERO; <font></font>
    EPwm4Regs.AQCTLA.bit.CAU = AQ_SET; <font></font>
    EPwm4Regs.AQCTLA.bit.CAD = AQ_CLEAR;<font></font>
    EPwm4Regs.DBCTL.bit.OUT_MODE = DB_FULL_ENABLE; <font></font>
    EPwm4Regs.DBCTL.bit.POLSEL = DB_ACTV_HIC; <font></font>
    EPwm4Regs.DBFED = <span class="hljs-number">20</span>; <font></font>
    EPwm4Regs.DBRED = <span class="hljs-number">20</span>; <font></font>
<font></font>
}</code></pre><br>
<p>  …   <em>TBPRD</em>  ,  " / 2", ..     ,    600    -  50     .   <em>TBPHS</em>       ,    400  600,   2π/3.   ,  1-    ,      0,  2-     400,    3-      800,  800  600 -  …      1- ,   ,   2-.   ,   3-   400    2π/3   2  3,    2-  ,    1  3  "2π/3 + 2π/3 = 4π/3"        .</p><br>
<p>       —  ,  EPWM1     <em>PHSEN</em>   master (),  EPWM2  EPWM4   slave ().      <em>SYNCOSEL</em>  "" ,       . EPWM1     ,     ,  EPWM2  EPWM4       :    EPWM2  EPWM1,   EPWM4  EPWM2.</p><br>
<p>        dead-time.    <em>POLSEL</em>    ,        ()    . 1.  <em>OUT_MODE</em>   dead-time       .    <em>DBFED</em>  <em>DBRED</em>      . </p><br>
<ul>
<li><strong> 3</strong><br>
      (duty)      <em>CMPA</em>    .</li>
</ul><br>
<pre><code class="cpp hljs">    EPwm1Regs.CMPA.half.CMPA = <span class="hljs-number">300</span>; <span class="hljs-comment">// duty for output EPWM1A</span>
    EPwm2Regs.CMPA.half.CMPA = <span class="hljs-number">300</span>; <span class="hljs-comment">// duty for output EPWM2A</span>
    EPwm4Regs.CMPA.half.CMPA = <span class="hljs-number">300</span>; <span class="hljs-comment">// duty for output EPWM4A</span></code></pre><br>
<p><img src="https://habrastorage.org/webt/sl/wy/6b/slwy6b5zoivfrdpbzlf9vpbsmms.png" alt="三相PWM"></p><br>
<p>!      .   —   EPWM1,   .    EPWM2     2π/3 (  400 )   ,       400 .     3 ,      120<sup>o</sup>.</p><br>
<p>           ,        dead-time   :</p><br>
<p><img src="https://habrastorage.org/webt/cd/aj/k7/cdajk7vfo9vs5d1yzvbuvtggy00.png" alt="オシログラム番号2"></p><br>
<p>      .    <em>1 / 60 000 000  = 16,6 </em>     20 ,      <em>20 </em> 16,6  = 332 ,*      . </p><br>
<p>    ,    ,  .    —  dc/dc ,    <strong>interleaved dc/dc converter</strong>.     ,       ,    ,     .   TMS320F28027   4-              .</p><br>
<h1 id="generiruem-trehfaznoe-peremennoe-napryazhenie">   </h1><br>
<p>          0  VCC,  .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>,           "" ,       .        ,     ,      (duty)     " ". </p><br>
<p>   .        50         . ,       50 ,     "",       ,    ,     .     TMS320F28027,       ,   .     ,    ,      TMU  FPU, , TMS320F280049,      . </p><br>
<p>    (duty)     ,     .    20  (1/50 = 20 )        20,     0,02  / 20 = 0,001  = 1             .      <em>CPU0</em>   : </p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">InitTimer0ForGenerator</span> <span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
<font></font>
    EALLOW;<font></font>
    PieVectTable.TINT0 = &amp;cpu_timer0_isr;<font></font>
    EDIS;<font></font>
<font></font>
    InitCpuTimers();<font></font>
    ConfigCpuTimer(&amp;CpuTimer0, <span class="hljs-number">60</span>, <span class="hljs-number">1000</span>);<font></font>
<font></font>
    CpuTimer0Regs.TCR.bit.TIE = <span class="hljs-number">1</span>;<font></font>
    CpuTimer0Regs.TCR.bit.TSS = <span class="hljs-number">0</span>;<font></font>
<font></font>
    IER |= M_INT1;<font></font>
<font></font>
    PieCtrlRegs.PIEIER1.bit.INTx7 = <span class="hljs-number">1</span>;  <span class="hljs-comment">// Enable TINT0 in the PIE: Group 1 interrupt 7</span><font></font>
<font></font>
    EINT;   <span class="hljs-comment">// Enable Global interrupt INTM</span>
    ERTM;   <span class="hljs-comment">// Enable Global real-time interrupt DBGM</span><font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function">__interrupt <span class="hljs-keyword">void</span> <span class="hljs-title">cpu_timer0_isr</span> <span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
<font></font>
   CpuTimer0.InterruptCount++;<font></font>
<font></font>
    <span class="hljs-comment">/*
    *   -  . ...
    */</span><font></font>
<font></font>
   PieCtrlRegs.PIEACK.all = PIEACK_GROUP1;  <span class="hljs-comment">// Acknowledge this interrupt to receive more interrupts from group 1</span><font></font>
<font></font>
}</code></pre><br>
<p> <em>InitCpuTimers</em>  <em>ConfigCpuTimer</em> ,     ,       (60 )      (1000  = 1 ),    1 ,      .             ,    . </p><br>
<p>   ""  ,        .  …     <strong><em>y = sin(x)</em></strong>     :</p><br>
<p><img src="https://habrastorage.org/webt/hi/bx/ey/hibxeyajv_h7l7t-mqkbkfrq6-s.png" alt="y =罪（x）"></p><br>
<p>        -1  1,     0  1, ..      0,    ( 1)   +VCC.  "" -1...+1    ,   .      .      ,     0  +2,      +1.     2  -!          <strong><em>y = (sin(x)/2):</em></strong></p><br>
<p><img src="https://habrastorage.org/webt/t_/n0/iw/t_n0iw1fym8aboggaxk1my7r4um.png" alt="y =（罪（x）/ 2）"></p><br>
<p>!      -0.5  +0.5,     1.  ,        ,        0.5,             <strong><em>y = 0.5 + (sin(x)/2)</em></strong>      :</p><br>
<p><img src="https://habrastorage.org/webt/df/vu/ez/dfvuez1lks2uhg0cp3tkhie9cdq.png" alt="y = 0.5 +（sin（x）/ 2）"></p><br>
<p>     :     0  1,   .  <strong><em>y = 0.5 + (sin(x)/2)</em></strong>  1- ,     ,    2  3.    <em>x</em>  2π/3  4π/3        <strong><em>y = 0.5 + (sin(x-2π/3)/2)</em></strong>  <strong><em>y = 0.5 + (sin(x-4π/3)/2).</em></strong>  3       :</p><br>
<p><img src="https://habrastorage.org/webt/hj/kp/n9/hjkpn93-37r_rclbrevchhdzf_m.png" alt="3段階"></p><br>
<p>!    ,      ,        . , 2.0943  2π/3,  4,1866  4π/3,            .     3 :</p><br>
<ul>
<li>  — <strong><em>y = 0.5 + (sin(x)/2)</em></strong></li>
<li>  — <strong><em>y = 0.5 + (sin(x-2π/3)/2)</em></strong></li>
<li>  — <strong><em>y = 0.5 + (sin(x-4π/3)/2)</em></strong></li>
</ul><br>
<p>       ,       .     ,   "",   ,        0  +15 (VCC)   .   ,      20,   1     20 . </p><br>
<p>  ,    <em>x</em>.    <em>2π</em>,       <em>2π/20</em>.      20 ,       ,    .        <strong><em>sin(2π * (1/20),</em></strong>    <strong><em>sin (2π * (2/20)),</em></strong>    *<strong>sin (2π <em> (3/20))</em></strong>   ,     <em>20/20</em>,             .       :</p><br>
<ul>
<li>  — <strong><em>y = 0.5 + (sin(2π * (n/N))/2)</em></strong></li>
<li>  — <strong><em>y = 0.5 + (sin(2π * (n/N)-2π/3)/2)</em></strong></li>
<li>  — <strong><em>y = 0.5 + (sin(2π * (n/N)-4π/3)/2)</em></strong></li>
</ul><br>
<p>,           .  <strong>n</strong> —  , <strong>N</strong> —   (20).        0  1,         .        , .. duty   0  600 (  ),  0  0,  1  600.           ,       <em>CMPA</em>:</p><br>
<ul>
<li>  — <strong><em>duty1 = A <em> (0.5 + (sin(2π </em> (n/N))/2))</em></strong></li>
<li>  — <strong><em>duty2 = A <em> (0.5 + (sin(2π </em> (n/N)-2π/3)/2))</em></strong></li>
<li>  — <strong><em>duty4 = A <em> (0.5 + (sin(2π </em> (n/N)-4π/3)/2))</em></strong></li>
</ul><br>
<p> <strong></strong> —    ,   600, <strong>n</strong> —  , <strong>N</strong> —   (20).  <strong><em>duty1, duty2, duty4</em></strong> —       (duty),    <em>CMPA.</em>             :</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">float</span> activeStep = <span class="hljs-number">0.0</span>;
<span class="hljs-keyword">float</span> amplitude = <span class="hljs-number">600.0</span>;
<span class="hljs-keyword">float</span> allStep = <span class="hljs-number">20.0</span>;<font></font>
<font></font>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> pi = <span class="hljs-number">3.1415</span>;                    <span class="hljs-comment">// π</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> piTwo = <span class="hljs-number">6.2831</span>;                 <span class="hljs-comment">// 2π</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> phaseShifted120deg = <span class="hljs-number">2.0943</span>;    <span class="hljs-comment">// 2π/3</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> phaseShifted240deg = <span class="hljs-number">4.1866</span>;    <span class="hljs-comment">// 4π/3</span><font></font>
<font></font>
<span class="hljs-function">__interrupt <span class="hljs-keyword">void</span> <span class="hljs-title">cpu_timer0_isr</span> <span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
<font></font>
   <span class="hljs-keyword">if</span> (activeStep &gt;= allStep) {activeStep = <span class="hljs-number">0</span>;}<font></font>
<font></font>
   activeStep++;<font></font>
<font></font>
   EPwm1Regs.CMPA.half.CMPA = ((<span class="hljs-keyword">uint16_t</span>)(amplitude * (<span class="hljs-number">0.5</span> + (sinf(piTwo * (activeStep / allStep)) / <span class="hljs-number">2</span>))));<font></font>
   EPwm2Regs.CMPA.half.CMPA = ((<span class="hljs-keyword">uint16_t</span>)(amplitude * (<span class="hljs-number">0.5</span> + (sinf(piTwo * (activeStep / allStep) - phaseShifted120deg) / <span class="hljs-number">2</span>))));<font></font>
   EPwm4Regs.CMPA.half.CMPA = ((<span class="hljs-keyword">uint16_t</span>)(amplitude * (<span class="hljs-number">0.5</span> + (sinf(piTwo * (activeStep / allStep) - phaseShifted240deg) / <span class="hljs-number">2</span>))));<font></font>
<font></font>
   PieCtrlRegs.PIEACK.all = PIEACK_GROUP1;  <span class="hljs-comment">// Acknowledge this interrupt to receive more interrupts from group 1</span><font></font>
<font></font>
}<font></font>
</code></pre><br>
<p>   ,           .        <em>activeStep</em>,      ,    0  20   . ,       20   20    .       <em>2π/3</em>  <em>4π/3</em>    ,    . </p><br>
<p>  ,        .       , ,  200.    .             .       <em>amplitude</em>       . </p><br>
<p>        :</p><br>
<p><img src="https://habrastorage.org/webt/qf/rd/ck/qfrdck6y4rcvirbws9o6zbzrfea.png" alt="オシログラム番号1"></p><br>
<p>   <em>Y</em> ,      .      ,    : <strong>  ,   .</strong></p><br>
<p><img src="https://habrastorage.org/webt/wh/4d/du/wh4dduwnbyshscey7rlmzs6s1mw.png" alt="オシログラム番号3"></p><br>
<h1 id="zaklyuchenie"></h1><br>
<p>          ,     ,    TMS320F28.     ,       ,      ,     ,     .</p><br>
<p>          .    :</p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">    Code Composer Studio</a></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja457534/index.html">認定バージョン-私たちが選択したレーキ</a></li>
<li><a href="../ja457538/index.html">中断されたYandex.Cloud仮想マシンを使用して、大規模な問題を解決する方法</a></li>
<li><a href="../ja457540/index.html">Intel Optane DC Persistent Memory、1年後</a></li>
<li><a href="../ja457542/index.html">暗号化をハッキングして保護するLUKS</a></li>
<li><a href="../ja457546/index.html">デモ日：なぜこれがすべてであり、それを行う方法UPD + Broadcast</a></li>
<li><a href="../ja457550/index.html">デジタル業界を保護する必要があるもの</a></li>
<li><a href="../ja457552/index.html">ザファサディのクライマー。ラフタセンタータワーのプロマルプの仕組み</a></li>
<li><a href="../ja457558/index.html">EvilParcelの脆弱性分析</a></li>
<li><a href="../ja457560/index.html">トークン化された株式：IPOに行く前にゲットインベスターになる方法</a></li>
<li><a href="../ja457562/index.html">Ivideon Counter 3D：誰が、どのように、そしてなぜ訪問者をカウントするか</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>