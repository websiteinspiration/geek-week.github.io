<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📋 🤾🏻 🌝 Evaluasi Metrik Muat Server Terpadu 👨🏻‍✈️ 👸🏿 🌿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bekerja di salah satu bank terbesar di negara ini, saya harus berurusan dengan tugas mengevaluasi efisiensi penggunaan sumber daya sekitar 16 ribu ser...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Evaluasi Metrik Muat Server Terpadu</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/498360/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bekerja di salah satu bank terbesar di negara ini, saya harus berurusan dengan tugas mengevaluasi efisiensi penggunaan sumber daya sekitar 16 ribu server. </font><font style="vertical-align: inherit;">Tugas ini dirumuskan dengan sangat sederhana - perlu mengembangkan metodologi untuk mengevaluasi metrik beban server untuk suatu periode. </font><font style="vertical-align: inherit;">Idealnya, beban server per periode harus diperkirakan menggunakan satu atau beberapa (tidak lebih dari 8) angka.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beberapa kata tentang fitur menggunakan server virtual</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Organisasi besar (terutama bank) memiliki kebun binatang beraneka ragam aplikasi warisan yang digunakan pada server yang berbeda menggunakan berbagai teknologi virtualisasi. Cloud pribadi adalah teknologi yang menjanjikan, tetapi pada kenyataannya, organisasi besar akan lama menggunakan berbagai platform virtualisasi untuk menyebarkan berbagai aplikasi.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai platform virtualisasi berkembang, ada saatnya ketika tidak ada seorang pun di perusahaan dapat memahami seberapa efisien sumber daya yang digunakan. Bahkan alat pemantauan yang paling canggih tidak memberikan jawaban untuk pertanyaan ini karena berbagai skenario penggunaan server. Misalnya, departemen mungkin memiliki server laporan yang akan dimuat sepenuhnya hanya untuk jangka waktu terbatas. Katakan 3-4 jam di akhir bulan. Dalam skenario kehidupan nyata, tidak ada yang mengalokasikan sumber daya dinamis untuk server tersebut - ini sulit secara teknis dan organisasi. Sumber daya dialokasikan secara khusus untuk beban server periodik maksimum, meskipun jarang terjadi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai ringkasan, dalam organisasi besar, sumber daya pertanian virtual dihabiskan dengan sangat tidak efisien.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di bawah ini saya mengusulkan metodologi yang dengannya Anda dapat dengan mudah membenarkan peningkatan dan penurunan sumber daya yang dialokasikan ke server virtual, terlepas dari skenario.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metodologi</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menilai beban sumber daya, perlu untuk mengumpulkan statistik berbagai penghitung, untuk menilai beban sumber daya, berbagai metrik akan digunakan. Secara konvensional, penghitung dapat dibagi menjadi 2 jenis (sesuai dengan tingkat perubahan): "cepat" dan "lambat". Contoh penghitung "cepat" yang bagus adalah penghitung beban prosesor (% CPU). Contoh penghitung lambat adalah persentase ruang hard disk kosong (% FreeSpace). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Evaluasi penghitung lambat terdiri dari penghitungan nilai ekstrim (minimum atau maksimum) metrik untuk periode tersebut. Pendekatan ini memungkinkan (misalnya, ketika menilai ruang bebas disk) untuk memperkirakan sumber daya gratis dan, jika perlu, mengalokasikan volume tambahan atau mengurangi yang sekarang.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk penghitung cepat, pendekatan yang berbeda digunakan. Kerugian menggunakan metrik integral sederhana (rata-rata, maksimum, minimum, dan median) untuk menilai dinamika penghitung tersebut dijelaskan dengan baik di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Kerugian umum termasuk kurangnya informasi tentang peningkatan beban (sedang dan puncak). Jika kita mengambil nilai maksimum untuk periode tersebut sebagai metrik integral, maka keberadaan pencilan (misalnya, pemuatan instan CPU hingga 100% saat program dimulai) tidak akan memberikan informasi yang objektif. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">artikel itu</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diusulkan untuk menggunakan 0,9 kuantil untuk memperkirakan metrik cepat (ini adalah nilai yang menunjukkan tingkat di bawah mana nilai yang diamati dalam 90% dari sampel terletak). Dengan beban server yang seragam menurut metrik ini, kami dapat memperkirakan secara memadai rata-rata beban prosesor. Tetapi pendekatan ini memiliki kelemahan yang sama - kurangnya informasi tentang peningkatan beban (sedang dan puncak). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di bawah ini, sebagai ilustrasi, grafik mingguan dan harian dari penghitung% CPU. Nilai counter maksimum pada grafik adalah 100%.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ym/al/xi/ymalxitgoyqlsthnyhs0cjttbie.png"><br>
<br>
<img src="https://habrastorage.org/webt/wj/xk/aj/wjxkajy2y3enm93easqblqnl-x8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Grafik menunjukkan bahwa selama periode yang ditunjukkan ada ledakan beban, yang berlangsung sekitar 3 jam. Untuk penghitung ini, berbagai metrik dihitung untuk minggu itu. Gambar 2 menunjukkan bahwa median (garis hijau, nilai 5%), rata-rata (kuning, nilai 12%) dan 0,9 kuantil (merah, nilai 27%) menyaring perubahan beban dan informasi tentang itu hilang. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai pengembangan dari gagasan kuantil, saya ingin mengusulkan gagasan kuantil geser. Ini adalah analog dari </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">moving average.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tetapi quantile 0,9 digunakan sebagai fungsi jendela. </font><font style="vertical-align: inherit;">Selain itu, kami akan menggunakan 2 kuantil geser untuk memperkirakan tingkat penghitung - cepat dengan periode pendek (1 jam) dan lambat dengan periode panjang (24 jam). </font><font style="vertical-align: inherit;">Kuantil cepat akan menyaring emisi instan dan memberikan informasi beban puncak. </font><font style="vertical-align: inherit;">Kuantil lambat akan memungkinkan Anda memperkirakan beban rata-rata. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang dapat Anda lihat dari grafik, kuantil bergerak 0,9 adalah karakteristik dinamis (coklat - cepat, ungu - lambat). </font><font style="vertical-align: inherit;">Untuk mempermudah, mengevaluasi status penghitung sebagai metrik disarankan untuk digunakan:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nilai kuantil maksimum dengan periode 1 jam, yang menunjukkan beban server kontinu maksimum untuk periode tersebut,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nilai kuantil rata-rata dengan periode 24 jam, yang menunjukkan beban server rata-rata untuk periode tersebut.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada grafik, nilai maksimum kuantil cepat adalah garis hitam 85%, nilai rata-rata kuantil lambat adalah garis merah muda 30%. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, ketika menganalisis beban sumber daya server (menurut penghitung% CPU), jika kita mengambil rata-rata untuk bulan tersebut (12%) sebagai metrik, kita dapat membuat keputusan yang salah untuk mengurangi sumber daya yang dialokasikan. </font><font style="vertical-align: inherit;">Metrik kuantil ganda cepat / lambat bergerak (85 dan 30%) menunjukkan bahwa ada cukup sumber daya yang dialokasikan, tetapi tidak ada surplus.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Keputusan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Implementasi penilaian efisiensi penggunaan sumber daya telah didekomposisi menjadi 3 tugas:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pengumpulan data </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pengembangan metodologi penilaian </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">implementasi metodologi dalam arsitektur saat ini </font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di atas, saya memeriksa tugas 2 dari implementasi ini, di bawah ini kita akan berbicara sedikit tentang tugas ketiga. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Data dikumpulkan di database ClickHouse. Kolom DBMS ini sangat ideal untuk menyimpan data deret waktu. Ini dibahas secara rinci di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ClickHouse Meetup</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pada 5 September 2019. Perbandingan ClickHouse dengan DBMS time-series lainnya dapat ditemukan di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai hasil dari pengumpulan data, kami membentuk beberapa tabel di mana data disusun baris demi baris (nilai setiap penghitung ditulis dalam baris terpisah). Dan, tentu saja, ada masalah dengan data mentah.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Masalah pertama adalah ketidakmerataan interval antara entri penghitung. Misalnya, jika periode perekaman penghitung standar adalah 5 menit, kadang-kadang ada kesenjangan dan catatan berikutnya lebih dari 5 menit (hingga 20 menit) dari yang sebelumnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Masalah kedua adalah bahwa kadang-kadang data penghitung datang 2 kali atau lebih (dengan nilai yang berbeda) dengan cap waktu yang sama. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan masalah ketiga - ClickHouse tidak memiliki fungsi jendela. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mengatasi masalah pertama, Anda dapat menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ASOF JOIN</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Idenya cukup sederhana - untuk setiap penghitung dari setiap server untuk membuat tabel secara merata dengan interval waktu yang diisi secara merata. Menggunakan ASOF BERGABUNG memungkinkan mengisi nilai-nilai dalam tabel baru dengan nilai-nilai terdekat dari tabel data mentah (opsi mengisi mirip dengan ffill dan bfill dapat dikonfigurasi). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solusi untuk masalah kedua adalah agregasi dengan pilihan nilai maksimum pada waktu tertentu.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mengatasi masalah ketiga, beberapa solusi dipertimbangkan. </font><font style="vertical-align: inherit;">Pertama, skrip Python ditolak karena kinerja yang tidak memadai. </font><font style="vertical-align: inherit;">Solusi kedua - menyalin data mentah ke database MSSQL, menghitung metrik, dan menyalin kembali - tampaknya terlalu rumit untuk diterapkan. </font><font style="vertical-align: inherit;">MSSQL juga memiliki fungsi jendela, tetapi tidak ada fungsi agregat yang diperlukan. </font><font style="vertical-align: inherit;">Orang mungkin bingung dan menulis fungsi SQL CLR Anda sendiri. </font><font style="vertical-align: inherit;">Tetapi opsi ini ditolak karena kompleksitas yang berlebihan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solusi yang berfungsi bisa berupa skrip SQL untuk ClickHouse. </font><font style="vertical-align: inherit;">Contoh skrip ini diberikan di bawah ini. </font><font style="vertical-align: inherit;">Untuk kesederhanaan, saya hanya menghitung penghitungan cepat untuk penghitung tunggal untuk beberapa server. </font><font style="vertical-align: inherit;">Solusinya tidak terlihat sangat sederhana dan tidak terlalu nyaman, tetapi berhasil.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Akibatnya, laporan pengujian dibuat di PowerBI untuk menunjukkan metodologi. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kg/qk/t9/kgqkt92tcilmz8h9gqieermwz3w.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/c_/m5/tk/c_m5tk-r1ehlvrdhh_dbsj3rzie.jpeg"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kesimpulan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai kesimpulan, saya ingin berspekulasi tentang pengembangan solusi. </font><font style="vertical-align: inherit;">Jika Anda melihat solusi dari sudut pandang gudang data, Anda dapat melihat bahwa dengan cara ini tugas membuat gudang data (Data Warehouse) dari lapisan data mentah (Staging Area) diselesaikan. </font><font style="vertical-align: inherit;">Anda dapat membahas arsitekturnya, tetapi untuk ClickHouse sebagai basis data kolom, normalisasi tidak penting (atau bahkan mungkin berbahaya). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pengembangan lebih lanjut dari repositori terlihat dalam pembuatan tabel agregat (hari \ minggu \ bulan) dengan masa hidup yang berbeda (TTL). </font><font style="vertical-align: inherit;">Ini akan menghindari pembengkakan penyimpanan yang berlebihan. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Langkah selanjutnya mungkin menggunakan data untuk analitik prediktif. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode dan data untuk pengujian diposting di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id498346/index.html">GoLand 2020.1 - Dukungan yang ditingkatkan untuk Modul Go, banyak penyelesaian otomatis, dan banyak lagi</a></li>
<li><a href="../id498350/index.html">Bahan terbaik untuk wawancara kerja dan pencarian kerja</a></li>
<li><a href="../id498352/index.html">SHISHUA: generator nomor acak semu tercepat di dunia</a></li>
<li><a href="../id498354/index.html">Cara menerjemahkan "Wishlist" menjadi "perangkat keras", atau semi-mobile semi-ideal semi-mobile</a></li>
<li><a href="../id498358/index.html">Pelajari bahasa Prancis atau cara mendapatkan adaptor universal dari pemindai diagnostik PSA</a></li>
<li><a href="../id498362/index.html">Kingston mempertahankan kepemimpinan dalam pengiriman SSD: bagaimana kita melakukannya?</a></li>
<li><a href="../id498366/index.html">Algoritma apa yang diterapkan pengembang Yandex setiap hari</a></li>
<li><a href="../id498368/index.html">Kisah satu saklar</a></li>
<li><a href="../id498370/index.html">SAP UI5 dan Confirmation Windows: Lagi Tentang Konteks</a></li>
<li><a href="../id498372/index.html">Tutorial jaringan simulator ns-3. Bab 5</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>