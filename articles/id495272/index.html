<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⚜️ 🤹🏻 ⏏️ Emulator SNES hanya berjarak beberapa piksel dari kesempurnaan absolut 🆑 👩🏻 🛁</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kami sangat dekat untuk membuat emulator yang dapat dengan sempurna menciptakan kembali semua fungsi perangkat keras dan perangkat lunak SNES yang seb...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Emulator SNES hanya berjarak beberapa piksel dari kesempurnaan absolut</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495272/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/44b/f3b/e14/44bf3be14304180044d2e7deb216f07d.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami sangat dekat untuk membuat emulator yang dapat dengan sempurna menciptakan kembali semua fungsi perangkat keras dan perangkat lunak SNES yang sebenarnya. </font></font></i><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selama 15 tahun terakhir,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sebagai coder untuk emulator </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bsnes,</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> saya mencoba untuk menyempurnakan emulasi Super Nintendo, tetapi sekarang kita dihadapkan dengan masalah terakhir: pengaturan waktu yang akurat dari siklus clock prosesor video SNES. </font><font style="vertical-align: inherit;">Untuk mencapai tahap akhir ketepatan emulasi ini, bantuan seluruh komunitas diperlukan, dan saya berharap atas dukungan Anda. </font><font style="vertical-align: inherit;">Tapi pertama-tama, saya akan memberi tahu Anda apa yang telah kami capai.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kondisi saat ini</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat ini, situasi dengan emulasi SNES sangat baik. Terlepas dari periferal yang tidak biasa yang menahan persaingan (misalnya, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">klub golf dengan sensor cahaya</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">simulator sepeda,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan modem dial-up, yang </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">digunakan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> di Jepang </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">untuk taruhan pacuan kuda di</font></a><font style="vertical-align: inherit;"> Jepang), semua game SNES resmi berlisensi sepenuhnya dapat dimainkan, dan tidak ada permainan yang memiliki masalah nyata. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Emulasi SNES menjadi sangat tepat sehingga saya bahkan harus membagi emulator menjadi dua versi: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">higan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang mengupayakan akurasi dan konsistensi mutlak dengan dokumentasi perangkat keras, dan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bsnes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang mengupayakan kecepatan, kemampuan luas, dan kemudahan penggunaan.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Baru-baru ini, di bidang persaingan SNES, banyak prestasi menarik telah diterima, termasuk:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Emulasi tingkat rendah dari semua coprocessor SNES</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dukungan untuk mode HD 7</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penghapusan rem</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dukungan layar lebar</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MSU1 untuk CD-audio dan FMV</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eksekusi awal untuk mengurangi penundaan</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kontrol kecepatan data dinamis untuk sinkronisasi audio dan video yang sempurna</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
… dan banyak lagi! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, apakah sudah selesai? Apakah semua orang bekerja dengan baik, selamat tinggal, dan terima kasih untuk ikannya? Ya tidak cukup. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hari ini, kami telah mencapai keakuratan pada level beat dari hampir semua komponen SNES. Satu-satunya pengecualian adalah PPU (unit pemrosesan gambar, modul pemrosesan gambar) yang digunakan untuk menghasilkan bingkai video yang dikirimkan ke layar. Kita </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sebagian besar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tahu bagaimana PPU bekerja, tetapi untuk beberapa fungsi kita harus menggunakan dugaan, yang mengarah pada akurasi yang tidak sempurna. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada skala umum, masalah yang tersisa cukup kecil. Jika Anda tidak mengupayakan idealitas persaingan sempurna untuk kecintaan pada seni, maka saya tidak dapat meyakinkan Anda tentang perlunya meningkatkan emulasi PPU lebih lanjut. Seperti dalam bidang apa pun, semakin dekat kita dengan yang ideal, semakin rendah pengembaliannya.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tapi saya bisa mengatakan mengapa hal ini penting untuk </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">saya</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : ini adalah karya seluruh hidup saya, dan saya tidak ingin saya untuk mengatakan bahwa aku </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">begitu</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dekat dengan penyelesaian tanpa mengambil langkah terakhir. </font><font style="vertical-align: inherit;">Saya menua dan saya tidak abadi. </font><font style="vertical-align: inherit;">Saya ingin bagian terakhir dari teka-teki diselesaikan, sehingga, setelah pensiun, saya yakin bahwa warisan SNES dapat diandalkan dan sepenuhnya dipertahankan berkat emulasi. </font><font style="vertical-align: inherit;">Saya ingin mengatakan bahwa masalahnya sudah </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">terpecahkan</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda masih tertarik kemudian lanjutkan membaca untuk berkenalan dengan latar belakang masalah dan solusi yang ditawarkan oleh saya.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pemodelan Arsitektur SNES</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita mulai dengan mendaftar komponen yang membentuk SNES:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c3c/f4f/e25/c3cf4fe250fbbed2b897e46ef58628bd.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diagram sistem Super NES. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Panah menunjukkan arah di mana berbagai prosesor SNES dapat bertukar data satu sama lain, dan garis putus-putus menunjukkan koneksi ke chip memori. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yang paling penting bagi kami sekarang adalah memperhatikan bahwa output video dan suara ditransmisikan langsung dari PPU dan DSP. </font><font style="vertical-align: inherit;">Ini berarti bahwa mereka bertindak sebagai "kotak hitam", dan kita tidak bisa melihat apa yang terjadi di dalamnya. </font><font style="vertical-align: inherit;">Nanti itu akan menjadi penting bagi kita.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ketepatan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bayangkan bahwa kita mengemulasi perintah CPU “multiply”, yang mengambil dua register (variabel), mengalikannya, menerima hasilnya dan beberapa flag yang mengindikasikan keadaan hasil (misalnya, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">overflow</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kita dapat menulis sebuah program yang mengalikan nilai yang mungkin dari 0 hingga 255 sebagai faktor dan pengganda. Kemudian kita dapat memperoleh hasil penggandaan angka dan bendera. Jadi, kita mendapatkan dua tabel dari 65.536 elemen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan menganalisis tabel ini, kita dapat secara akurat menentukan bagaimana dan di mana hasil perhitungan CPU diatur dengan cara tertentu. Kemudian kita dapat memodifikasi emulator sehingga saat menjalankan tes yang sama kita mendapatkan tabel yang sama persis pada waktu yang sama.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang katakanlah bahwa CPU dapat melakukan penggandaan 16-bit x 16-bit. Saat menguji setiap nilai yang mungkin, 4 miliar hasil akan dihasilkan, yang hampir tidak mungkin diuji dalam jumlah waktu yang wajar. Jika CPU memiliki multiplikasi 32 bit x 32 bit, maka dalam praktiknya tidak akan mungkin untuk menguji semua kombinasi nilai input sebelum kematian termal Semesta (setidaknya pada tingkat teknologi saat ini). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam kasus seperti itu, kami bertindak lebih selektif dalam pengujian dan mencoba menentukan kapan bendera dapat benar-benar berubah, kapan hasilnya mungkin meluap, dan sebagainya. Kalau tidak, kita harus menjalankan tes yang tidak akan pernah berakhir.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perkalian adalah operasi yang agak sepele, tetapi prinsip yang sama dapat diperluas ke seluruh proses rekayasa terbalik, termasuk operasi yang lebih kompleks, misalnya, transmisi data melalui DMA (akses memori langsung) selama pengembalian horizontal balok. </font><font style="vertical-align: inherit;">Kami membuat tes yang mencoba untuk menentukan apa yang terjadi dalam kasus batas, dan kemudian memeriksa apakah persaingan kami berperilaku identik dengan perilaku SNES nyata.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Generator Sinyal dan Ketukan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SNES memiliki dua generator sinyal (osilator): osilator kristal yang beroperasi pada frekuensi sekitar 21 MHz (mengendalikan modul CPU dan PPU), dan resonator keramik yang beroperasi pada frekuensi sekitar 24 MHz, yang mengontrol SMP dan DSP. </font><font style="vertical-align: inherit;">Dalam coprocessors cartridge, kadang-kadang osilator kristal 21 MHz digunakan, dan kadang-kadang generator sinyal sendiri bekerja dengan frekuensi lain.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/97d/ecb/bc1/97decbbc1161fcf170f063d2fd42795d.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menciptakan papan sirkuit Super Famicom ini dalam kode lebih sulit daripada kedengarannya.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Jam adalah elemen dasar dari pengaturan waktu sistem apa pun, dan SNES dirancang untuk melakukan berbagai tugas dengan frekuensi dan interval waktu tertentu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda membayangkan jam 100 hertz, ini akan menjadi perangkat dengan keluaran biner yang beralih ke kondisi logis sinyal yang tinggi (misalnya, +5 V), dan kemudian ke status sinyal yang rendah (0 V, atau arde) 100 kali per detik. Artinya, setiap detik tegangan pada output akan berfluktuasi 200 kali: meningkat 100 kali dan 100 kali menurunkan bagian depan sinyal clock.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Siklus jam biasanya dianggap sebagai transisi penuh, yaitu siklus 100 Hz akan menghasilkan 100 siklus clock per detik. </font><font style="vertical-align: inherit;">Beberapa sistem memerlukan perbedaan antara naik dan turunnya tepi, dan bagi mereka kami memecah siklus menjadi setengah-siklus untuk menunjukkan setiap fase (tinggi atau rendah) dari sinyal clock. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tugas paling penting dari sebuah emulator yang akurat adalah menyelesaikan tugas dengan cara yang persis sama dan pada waktu yang sama persis seperti pada peralatan nyata. </font><font style="vertical-align: inherit;">Namun, tidak terlalu penting </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bagaimana</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tugas dilakukan. </font><font style="vertical-align: inherit;">Satu-satunya hal yang penting adalah bahwa emulator, menerima sinyal input yang sama, menghasilkan sinyal output yang sama dalam waktu yang sama seperti pada perangkat keras nyata.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pengaturan waktu</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terkadang operasi membutuhkan waktu. Ambil contoh perkalian dalam SNES CPU. Alih-alih berhenti dan menunggu perkalian selesai, SNES CPU menghitung hasil perkalian satu per satu di latar belakang selama delapan siklus clock opcode CPU. Ini berpotensi memungkinkan kode untuk melakukan tugas-tugas lain sambil menunggu perkalian selesai. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kemungkinan besar, perangkat lunak komersial apa pun akan menunggu selama delapan siklus ini, karena jika Anda mencoba membaca hasilnya sebelum siap, kami akan mendapatkan hasil yang diselesaikan sebagian. Namun, sebelum SNES, emulator memberikan hasil yang benar secara </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instan</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tanpa menunggu siklus clock tambahan ini.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika penggemar konsol mulai membuat dan menguji perangkat lunak yang ditulis sendiri dalam emulator, perbedaan ini mulai menyebabkan masalah tertentu. Sebagai bagian dari peranti lunak, misalnya, banyak peretas ROM </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dunia Super Mario</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pertama </font><font style="vertical-align: inherit;">, bekerja dengan benar hanya di emulator lama ini, tetapi tidak pada peranti keras SNES yang asli. Ini terjadi karena mereka dikembangkan dengan mempertimbangkan instan (tidak dapat diandalkan dari sudut pandang peralatan nyata) untuk memperoleh hasil perkalian. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam proses meningkatkan emulator, kompatibilitas perangkat lunak lama rusak, dan karena itu kami harus menambahkan opsi kompatibilitas ke emulator baru agar tidak kehilangan program ini. Ya, tidak peduli seberapa nyata kedengarannya, tetapi hari ini emulator harus meniru emulator lainnya!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kemudahan penundaan multiplikasi dalam CPU ini terletak pada kenyataan bahwa hal itu sangat dapat diprediksi: siklus perhitungan delapan jam dimulai segera setelah permintaan operasi penggandaan. </font><font style="vertical-align: inherit;">Dengan menulis kode yang membaca hasil setelah setiap siklus, kami dapat memverifikasi bahwa SNES CPU menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">algoritma Booth</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk perkalian </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sinkronisasi Jam</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Operasi lain tidak mudah dimodelkan karena dijalankan secara tidak serempak di latar belakang. Salah satu kasus tersebut adalah pembaruan DRAM dari prosesor SNES pusat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selama rendering setiap baris raster, seluruh SNES CPU pada tahap tertentu menghentikan operasinya untuk waktu yang singkat sementara isi chip RAM diperbarui. Ini diperlukan karena untuk mengurangi biaya dalam SNES, RAM dinamis (daripada statis) digunakan sebagai memori utama CPU. Untuk menyimpan konten RAM dinamis, itu harus diperbarui secara berkala.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d61/cb1/ab9/d61cb1ab914186314069b09f88218fcf.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Untuk membuat emulator yang benar-benar sempurna tidak cukup untuk memastikan pemutaran ketiga setengah ribu game SNES. Juga diperlukan untuk mencapai simulasi masing-masing fungsi sistem dengan akurasi kebijaksanaan yang sempurna.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Faktor kunci dalam analisis ketepatan waktu operasi ini adalah kemungkinan menggunakan penghitung PPU horizontal dan vertikal. Penghitung ini melakukan peningkatan dan direset setelah setiap perjalanan balok horisontal dan vertikal terbalik. Namun, akurasinya hanya seperempat dari frekuensi generator sinyal CPU SNES; dengan kata lain, penghitung horizontal bertambah setiap empat siklus jam.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Membaca beberapa kali nilai dari penghitung, saya dapat menentukan seperempat dari siklus jam penghitung mana yang selaras. Menggabungkan pengetahuan ini dengan fungsi-fungsi yang dibuat khusus yang dapat mengambil langkah menuju jumlah siklus clock yang tepat yang ditunjukkan oleh pengguna, saya dapat dengan sempurna mencocokkan CPU SNES dengan posisi tepat dari siklus clock yang saya butuhkan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berkat lintasan berulang dari banyak siklus clock, saya dapat menentukan kapan operasi tertentu benar-benar terjadi (misalnya, memperbarui DRAM, mentransmisikan HDMA, interupsi polling, dll.). Setelah itu, saya bisa membuat ulang semua ini dalam persaingan. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chip SMP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konsol SNES juga memiliki timer sendiri, dan reverse engineering yang berhasil juga dilakukan untuk prosesor ini. </font><font style="vertical-align: inherit;">Saya dapat mencurahkan seluruh artikel hanya untuk register SMP TEST, yang memungkinkan programmer untuk mengontrol pembagi frekuensi SMP dan pengatur waktunya, belum lagi hal-hal buruk lainnya. </font><font style="vertical-align: inherit;">Sudah cukup untuk mengatakan bahwa itu bukan proses yang mudah dan cepat, tetapi pada akhirnya kami menang.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami mengumpulkan coprocessor</font></font></h3><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1ce/8ec/80c/1ce8ec80c157a980c0222eb7462679e9.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chip SuperFX hanyalah salah satu dari banyak coprocessor kartrid yang dapat ditangani oleh emulator SNES.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ada sejumlah besar prosesor SNES yang digunakan di dalam berbagai kartrid permainan yang juga harus kami jinak. Dari masing-masing CPU </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">serba</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> guna seperti </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">SuperFX</font></a><font style="vertical-align: inherit;"> dan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SA-1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , prosesor sinyal digital seperti DSP-1 dan Cx4 hingga akselerator dekompresi seperti S-DD1 dan SPC7110, atau jam real-time Sharp dan Epson, dan banyak lagi ...</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini berarti bahwa emulator SNES harus mengatasi instruksi SuperFX dan cache pixel; dengan skema resolusi konflik memori bus SA-1 (memungkinkan SNES dan SA-1 CPU menggunakan ROM dan chip RAM yang sama secara bersamaan); dengan firmware terintegrasi DSP-1 dan Cx4; dengan encoders aritmatika berbasis prediksi S-DD1 dan SPC7110; serta dengan kasus garis batas BCD (desimal berkode biner) di generator waktu nyata. Perlahan tapi pasti, menggunakan semua teknik untuk menentukan kebenaran dan timing yang dijelaskan di atas, kami berhasil belajar bagaimana meniru semua chip ini dengan hampir sempurna. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Butuh banyak upaya dan ribuan dolar untuk menghapus penutup chip dan menghapus firmware dari prosesor sinyal digital yang digunakan dalam gim yang berbeda. Dalam satu kasus, emulasi NEC uPD772x diizinkan</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gunakan kode dari higan untuk menyimpan suara almarhum Stephen Hawking! </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam kasus lain, kami perlu merekayasa balik seluruh rangkaian instruksi untuk arsitektur Hitachi HG51B, karena tidak ada yang pernah menerbitkan dokumentasi untuk arsitektur ini. </font><font style="vertical-align: inherit;">Dalam kasus lain, ternyata satu game ( </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hayazashi Nidan Morita Shougi 2</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) memiliki CPU ARM6 32-bit yang kuat dengan frekuensi 21 MHz, yang mempercepat game shogi Jepang! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menyelamatkan semua prosesor SNES ternyata merupakan proses jangka panjang, penuh kesulitan dan kejutan.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pemrosesan sinyal digital</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chip Sony S-DSP (Digital Signal Processor), yang tidak boleh disamakan dengan coprocessor cartridge DSP-1, menghasilkan suara SNES yang unik. Dalam chip ini, delapan saluran audio dengan encoding ADPCM 4-bit terhubung, yang memastikan terciptanya sinyal stereo 16-bit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dari luar, dan dari diagram sistem yang disajikan di atas, pada awalnya tampak bahwa DSP adalah "kotak hitam": kami menyesuaikan saluran suara dan parameter mixer, setelah itu chip menghasilkan suara yang dikirim ke speaker.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tapi satu fungsi penting memungkinkan pengembang di bawah nama panggilan blargg untuk melakukan rekayasa balik lengkap dari chip ini: itu adalah buffer gema. </font><font style="vertical-align: inherit;">SNES DSP memiliki fungsi yang menggabungkan output dari sampel sebelumnya untuk membuat efek gema. </font><font style="vertical-align: inherit;">Ini terjadi di bagian paling akhir dari proses pembuatan suara (selain dari bendera penghalang suara yang terakhir, yang dapat digunakan untuk mematikan seluruh keluaran suara.) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan menulis kode dengan waktu yang tepat dari langkah-langkah dan melacak gema yang dihasilkan, kami dapat menentukan urutan operasi yang dilakukan oleh DSP untuk menghasilkan dari setiap sampel dan menciptakan suara yang sempurna dan ketepatan mengalahkan.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menyimpan PPU</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semua ini membawa kami ke bagian terakhir dari skema arsitektur SNES: chip PPU-1 dan PPU-2. </font><font style="vertical-align: inherit;">Berkat John McMaster, kami memiliki pemindaian chip S-PPU1 (revisi 1) dan S-PPU2 (revisi 3) dengan peningkatan dua kali lipat.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/678/641/68e/67864168e9f383375b8e081ffff1606f.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pemindaian dua kali lipat kristal PPU SNES pertama ...</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fad/524/a23/fad524a235729831ae880c3edf1bb4b8.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... dan PPU kedua.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Kedua pemindaian kristal memberi tahu kami bahwa chip jelas bukan CPU untuk keperluan umum, juga bukan arsitektur khusus yang mengeksekusi kode operasi dari ROM internal dari program firmware. Ini adalah sirkuit logis terpisah dengan logika kode-keras yang menerima sinyal masuk dari register dan memori yang berbeda, dan membuat sinyal video ke monitor satu garis raster pada satu waktu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PPU tetap menjadi hambatan terakhir untuk meniru SNES karena, tidak seperti semua komponen yang dijelaskan di atas, PPU </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sebenarnya</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah kotak hitam. Kami dapat mengonfigurasinya ke keadaan apa pun, tetapi SNES CPU tidak dapat secara langsung memantau apa yang mereka hasilkan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika kita menggunakan contoh sebelumnya dengan perkalian sebagai analogi, bayangkan Anda meminta hasilnya 3 * 7, tetapi alih-alih jawaban biner, Anda mendapatkan gambar analog fuzzy dari angka "21" di layar. Siapa pun yang menjalankan perangkat lunak Anda akan dapat </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">melihat</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 21, tetapi Anda tidak dapat menulis program pengujian untuk secara otomatis memeriksa apakah dia melihat jawaban yang benar. Verifikasi manual seseorang atas hasil semacam itu tidak dapat ditingkatkan ke lebih dari beberapa ribu tes, dan jutaan akan diminta untuk memaksimalkan perilaku PPU. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya tahu apa yang Anda pikirkan: "Tetapi apakah lebih mudah menggunakan kartu tangkap, melakukan pemrosesan gambar, kira-kira membandingkannya dengan gambar pada layar digital emulator, dan melakukan tes berdasarkan ini?"</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ya, itu mungkin! </font><font style="vertical-align: inherit;">Apalagi jika tes ini untuk memeriksa dua angka besar yang menempati seluruh layar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi bagaimana jika pengujian memiliki banyak nuansa, dan kami mencoba mengenali perbedaan warna setengah-nada dari satu piksel? </font><font style="vertical-align: inherit;">Bagaimana jika kita ingin menjalankan sejuta tes secara berurutan, dan kita tidak selalu tahu apa yang akan kita hasilkan, tetapi masih ingin membandingkan hasilnya dengan output persaingan kita? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tidak ada yang mengalahkan kenyamanan dan akurasi dengan data digital - aliran bit yang akurat yang hanya bisa cocok atau tidak cocok. </font><font style="vertical-align: inherit;">Sifat analog dari sinyal CRT tidak dapat memberi kita ini.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengapa ini penting?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan pengecualian satu game ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Patroli Serangan Udara</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), semua perangkat lunak SNES resmi berlisensi (seharusnya) berdasarkan string raster. Game-game ini tidak mencoba untuk mengubah keadaan rendering PPU di tengah garis raster yang diberikan saat ini (trik seperti itu oleh programmer disebut "efek raster"). Ini berarti bahwa waktu pelaksanaan sebagian besar permainan tidak harus akurat; jika Anda punya waktu untuk garis raster penuh berikutnya, maka semuanya beres. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tapi ini penting untuk satu game tunggal.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/349/c75/08c/349c7508c9724e946a687c60881e77fc.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3a4/7ee/5b2/3a47ee5b2b9ceacabcf2c4f1c34a1fe3.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/77e/149/23c/77e14923ce342dc49287fa908aea5b93.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rangkaian gambar ini menunjukkan efek persaingan yang kompleks yang digunakan dalam pesan "Keberuntungan" </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Patroli Serangan Udara</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Pada gambar di atas, Anda melihat teks frame-by-frame "Good Luck" dari </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Air Strike Patrol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Gim ini mengimplementasikannya dengan mengubah posisi menggulirkan layer 3 (BG3) secara vertikal. Namun, tampilan dasbor di sebelah kiri (di mana Anda dapat melihat bahwa pemain memiliki 39 rudal) juga berada di lapisan latar belakang yang sama.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gim berhasil melakukan pemisahan ini dengan mengubah posisi gulir BG3 di setiap baris raster setelah merender dasbor kiri, tetapi sebelum teks "Keberuntungan" mulai ditampilkan. Ini dapat dilakukan karena di luar dasbor dan teks, BG3 transparan dan tidak ada yang menarik di antara kedua titik ini, terlepas dari nilai register pengguliran vertikal. Perilaku ini menunjukkan kepada kita bahwa register pengguliran </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dapat</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diubah pada setiap tahap rendering.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/880/658/047/8806580479dcbbaf6671fc971c12ba8b.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bayangan kecil di bawah pesawat ini menyebabkan banyak sakit kepala bagi pengembang emulator yang terobsesi dengan presisi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gambar di atas menunjukkan bayangan pesawat yang terkenal. Efek ini diberikan dengan mengubah register kecerahan layar dengan riak pendek di atas lima garis raster. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selama permainan, Anda dapat melihat bahwa bayangan ini agak kacau. Pada gambar di atas, tampilannya agak mirip huruf "c," tetapi bentuknya di setiap garis raster berubah panjang dan titik awal dengan masing-masing bingkai. Para pengembang </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Patroli Serangan Udara</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hanya secara kasar menguraikan di mana bayangan akan muncul, dan menyelesaikan masalah ini secara langsung. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam kebanyakan kasus</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ini berfungsi.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Emulasi yang benar dari perilaku semacam itu membutuhkan pengaturan waktu yang sempurna, yang benar-benar </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sangat</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sulit </font><font style="vertical-align: inherit;">diperoleh dalam emulator </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1c5/b7f/fa2/1c5b7ffa2601b6480209321b60a131a1.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pada layar jeda </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Patroli Udara</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , efek raster digunakan yang tidak sengaja digunakan dalam game SNES lainnya.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Sekarang mari kita bicara tentang layar jeda. Menghidupkan BG3 sambil menggambar perbatasan kuning-hitam di sebelah kiri dan mematikannya lagi selama perbatasan yang sama di sebelah kanan untuk menggambar garis abu-abu di layar. Dia juga secara bergantian melalui frame mengganti garis raster di mana garis abu-abu ini ditampilkan untuk menciptakan efek jitter overlay. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda memperbesar gambar yang ditiru yang ditunjukkan di atas, Anda akan melihat bahwa selama sepasang garis raster di sudut kiri garis abu-abu ini ada beberapa piksel yang hilang. Itu terjadi karena emulasi PPU saya 100% tidak sempurna dalam siklus clock. Dalam hal ini, itu menyebabkan efek mengaktifkan BG3 sedikit lebih lambat dari yang seharusnya.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya dapat dengan mudah mengubah timing sehingga </font><font style="vertical-align: inherit;">gambar </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ini ditampilkan</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dengan benar. Tetapi perubahan seperti itu kemungkinan akan berdampak buruk pada </font><font style="vertical-align: inherit;">game </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lain</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> yang mengubah register tampilan PPU di tengah garis raster. Meskipun </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Air Strike Patrol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah satu-satunya game yang melakukan ini dengan sengaja, setidaknya ada selusin game di mana hal ini terjadi secara kebetulan (mungkin IRQ menembak mereka terlalu cepat atau lambat). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kadang-kadang ini menyebabkan kerusakan nyata pada gambar, yang tidak diperhatikan selama pengembangan (misalnya, di </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Balap Throttle Penuh</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">selama transisi antara toko dan game). Kadang-kadang perekaman dilakukan ketika layar dinyatakan transparan, dan karenanya tidak menyebabkan anomali visual (misalnya, seperti dalam kasus menampilkan status HP di </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dai Kaijuu Monogatari II</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .) Tetapi bahkan kasus perbatasan "tak terlihat" seperti itu dapat menyebabkan masalah dalam rendering garis raster yang kurang akurat. yang digunakan dalam emulator paling produktif. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekalipun Anda mengabaikan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Patroli Serangan Udara</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , semua efek raster acak (tetapi valid) ini dalam perangkat lunak SNES tidak memungkinkan Anda untuk mendesain renderer PPU yang menghasilkan seluruh garis raster secara fungsional dengan akurasi jam sempurna.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam kasus bsnes selama bertahun-tahun coba-coba, kami telah membuat daftar game semacam itu dengan "efek raster". </font><font style="vertical-align: inherit;">Kami juga menciptakan posisi rendering individual yang memungkinkan rendering lebih cepat berdasarkan garis raster untuk menampilkan semua game ini dengan benar (kecuali untuk </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Patroli Serangan Udara</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tentu saja). </font><font style="vertical-align: inherit;">Tetapi pada dasarnya, ini adalah sekelompok peretasan yang tidak menyenangkan bagi kami, yang dirancang untuk permainan tertentu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya juga memiliki penyaji PPU berbasis jam yang tidak memerlukan semua peretasan ini, tetapi dari waktu ke waktu itu menghasilkan perbedaan kecil (satu hingga empat piksel) dengan perenderan peralatan ini, seperti pada tangkapan layar di atas </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Patroli Serangan Udara</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Register Latch Internal</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alasan untuk semua kesalahan kecil ini adalah karena ketepatan waktu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Katakanlah SNES membuat </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mode 7</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> yang </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">terkenal</font></a><font style="vertical-align: inherit;"> , yang merupakan transformasi tekstur affine dengan perubahan parameter di setiap baris raster. </font><font style="vertical-align: inherit;">Untuk menentukan piksel layar, Anda perlu melakukan perhitungan serupa:</font></font><br>
<br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">px = a * klip (hoffset - hcenter) + b * klip (voffset - vcenter) +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
b * y + (hcenter &lt;&lt; 8)</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
py = c * klip (hoffset - hcenter) + d * klip (voffset - vcenter) +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
d * y + (vcenter &lt;&lt; 8)</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SNES nyata tidak akan dapat menyelesaikan semua enam perkalian ini cukup cepat untuk setiap piksel yang diberikan dalam bingkai. </font><font style="vertical-align: inherit;">Tetapi tidak ada dari nilai-nilai ini yang berubah untuk setiap piksel (atau, setidaknya, tidak boleh berubah), jadi kita hanya perlu menghitung px dan py satu kali di awal setiap baris raster. </font><font style="vertical-align: inherit;">Artinya, PPU cache hasil statis dalam kait, yang pada dasarnya adalah salinan register PPU. </font><font style="vertical-align: inherit;">Di masa depan, mereka dapat diubah, atau tetap tidak berubah. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kemudian koordinat x, y ditransformasikan oleh mode 7 sebagai berikut:</font></font><br>
<br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ox = (px + a * x) &gt;&gt; 8</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
oy = (py + c * x) &gt;&gt; 8</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meskipun x bervariasi untuk setiap piksel, kami tahu bahwa kenaikan dilakukan oleh satu setiap kali. Berkat penyimpanan drive internal, kita cukup menambahkan nilai konstan a dan c ke ox dan oy untuk setiap piksel, daripada melakukan dua perkalian untuk setiap piksel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kemudian muncul pertanyaan di hadapan kita: di posisi manakah dari siklus clock apakah PPU membaca nilai a dan c dari register PPU eksternal yang diakses CPU? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika kami mengambilnya terlalu cepat, maka ini dapat merusak beberapa game. Jika kita terlambat, itu bisa merusak game lain. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cara termudah adalah dengan menunggu laporan bug dan menyesuaikan posisi ini untuk memperbaiki masalah di setiap game tertentu. Tetapi dalam kasus ini, kita tidak akan pernah menemukan </font><font style="vertical-align: inherit;">posisi yang </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tepat</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , hanya perkiraan mereka.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan setiap kali kami mengubah salah satu variabel ini, tidak realistis bagi kami untuk menguji ulang ketiga setengah ribu game dari perpustakaan SNES untuk mendeteksi penurunan yang dapat dilakukan oleh perubahan yang kami lakukan.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Keluar dari wajan ke dalam api</font></font></h3><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c0a/741/b84/c0a741b84071dd0252021ae422277c1a.jpg"></div> <br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interpretasi artistik dari proses menghilangkan kesalahan emulasi.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Metodologi pengujian yang serupa, "kami hanya akan membuat game yang kami tertarik bekerja dengan biaya berapa pun" menyebabkan fenomena, yang saya sebut emulasi "dari api, tetapi ke api". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada awal pengembangan emulasi SNES, ketika masalah muncul dalam game, maka </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">setiap</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> koreksi dalam game ini yang memungkinkannya untuk bekerja diterima dan ditambahkan ke emulator. Perbaikan ini tentu merusak beberapa gim lainnya. Dan kemudian mereka memperbaiki </font><font style="vertical-align: inherit;">game </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ini</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , setelah yang ketiga pecah. Memperbaiki game ketiga kembali mematahkan yang pertama. Ini berlangsung selama bertahun-tahun.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kesalahannya di sini adalah bahwa pengembang mencoba untuk memperhitungkan hanya satu variabel pada satu waktu. Misalkan kita memiliki permainan, dan agar bisa berfungsi, peristiwa harus terjadi antara ukuran 20 dan 120. Kami tidak tahu ukuran pasti, jadi pilih saja 70, tepatnya di tengah. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kemudian kami mendapatkan laporan bug di game lain, dan menentukan bahwa agar </font><font style="vertical-align: inherit;">game </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ini</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> berfungsi </font><font style="vertical-align: inherit;">, nilai ukurannya harus antara 10 dan 60. Jadi sekarang kami ubah ke 40, yang berfungsi untuk kedua game. Kedengarannya logis! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tapi kemudian </font><font style="vertical-align: inherit;">game </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ketiga</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> muncul </font><font style="vertical-align: inherit;">, di mana acara tersebut harus bekerja antara ukuran 80 dan 160! Sekarang kami tidak dapat membuat ketiga game bekerja secara bersamaan dengan nilai yang sama.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini memaksa pengembang emulator untuk membuat retasan untuk game tertentu. </font><font style="vertical-align: inherit;">Coders tidak ingin merilis emulator di mana Anda tidak dapat menjalankan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mario</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zelda</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> atau </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metroid</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Oleh karena itu, untuk kasus umum, clock cycle 40 digunakan, tetapi saat memuat </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metroid,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kami memaksakan nilai pengaturan waktunya menjadi 100. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagaimana ini mungkin, mengapa dua game membutuhkan nilai yang berbeda? </font><font style="vertical-align: inherit;">Ini terjadi karena tidak hanya satu variabel yang terlibat di sini. </font><font style="vertical-align: inherit;">Waktu yang sebelumnya Anda gunakan untuk memicu acara lain dapat mempengaruhi nilai waktu yang diperlukan untuk </font><font style="vertical-align: inherit;">acara </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">berikutnya</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bayangkan ini dalam bentuk ekspresi aljabar sederhana:</font></font><br>
<br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2x + y = 120</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda dapat menyelesaikannya dengan mengambil x = 10, y = 100. Atau x = 20, y = 80. Atau x = 30, y = 60. Jika kami hanya memikirkan nilai x, yang memungkinkan Anda menjalankan satu set game secara bersamaan, maka kami kehilangan fakta bahwa sebenarnya masalahnya mungkin salah y! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Versi pertama emulator untuk meningkatkan kompatibilitas cukup mendefinisikan kembali nilai x tergantung pada game yang sedang berjalan. Peretasan gim individual seperti itu tetap ada, bahkan jika nilai x yang benar, satu kali ditemukan. Jadi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> masalah </font><font style="vertical-align: inherit;">tidak akan pernah terpecahkan!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Namun, dalam kasus SNES, tidak satu atau dua variabel yang terlibat secara bersamaan. PPU konsol SNES sendiri memiliki 52 register eksternal, yaitu sekitar 130 parameter. Dalam proses render garis raster tunggal, semua 130 parameter ini dan sejumlah register internal dan kait yang tidak diketahui terlibat. Ini terlalu banyak informasi bagi seseorang di luar untuk dapat mewujudkan keadaan penuh PPU pada titik waktu tertentu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aspek emulasi ini tidak jelas bagi yang belum tahu, tetapi sangat adil: </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">akurasi</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tidak sama dengan </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kompatibilitas</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Kami dapat membuat emulator dengan akurasi 99 persen, mampu menjalankan 10% game. </font><font style="vertical-align: inherit;">Dan Anda dapat menulis emulator 80% akurat yang menjalankan 98% game. </font><font style="vertical-align: inherit;">Terkadang implementasi yang benar dalam jangka pendek merusak game-game populer. </font><font style="vertical-align: inherit;">Ini adalah pengorbanan yang diperlukan jika Anda mencoba untuk mencapai akurasi 100% </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kompatibilitas 100%.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menyelesaikan masalah</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kita sampai pada tahap emulasi PPU saat ini berkat penalaran deduktif dan hasil di dunia nyata. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kita tahu bahwa dua PPU memiliki akses ke dua chip VRAM. </font><font style="vertical-align: inherit;">Kita tahu bahwa mereka dapat membaca dari setiap chip sejumlah byte data yang diketahui per baris raster. </font><font style="vertical-align: inherit;">Kami tahu detail kasar tentang bagaimana masing-masing mode video SNES bekerja. </font><font style="vertical-align: inherit;">Dan berdasarkan ini, kita dapat menguraikan pola umum tentang bagaimana arsitektur mungkin terlihat. </font><font style="vertical-align: inherit;">Misalnya, berikut adalah contoh singkat tentang bagaimana tiga mode video SNES pertama dapat bekerja:</font></font><br>
<br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if (io.bgMode == 0) {</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg4.fetchNameTable ();</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg3.fetchNameTable ();</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg2.fetchNameTable ();</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg1.fetchNameTable ();</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg4.fetchCharacter (0);</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg3.fetchCharacter (0);</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg2.fetchCharacter (0);</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg1.fetchCharacter (0);</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
if (io.bgMode == 1) {</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg3.fetchNameTable ();</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg2.fetchNameTable ();</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg1.fetchNameTable ();</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg3.fetchCharacter (0);</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg2.fetchCharacter (0);</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg2.fetchCharacter (1);</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg1.fetchCharacter (0);</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg1.fetchCharacter (1);</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
if (io.bgMode == 2) {</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg2.fetchNameTable ();</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg1.fetchNameTable ();</font></font><font></font>
<font></font>
bg3.fetchOffset(0);<font></font>
<font></font>
bg3.fetchOffset(8);<font></font>
<font></font>
bg2.fetchCharacter(0);<font></font>
<font></font>
bg2.fetchCharacter(1);<font></font>
<font></font>
bg1.fetchCharacter(0);<font></font>
<font></font>
bg1.fetchCharacter(1);<font></font>
<font></font>
}</pre></blockquote><br>
<h3>   </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PPU mengungkapkan kepada pengamat pihak ketiga hanya sebagian kecil dari negaranya: flag blanking horizontal / vertikal, jumlah pixel horizontal dan vertikal, dan flag tile overlay dalam interval untuk sprite. Ini tidak terlalu banyak, tapi saya ulangi - setiap elemen kecil dari negara yang dapat diakses oleh pengamat membantu kita. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VRAM (RAM video, memori video) dari chip PPU selama rendering tertutup untuk SNES CPU, bahkan untuk membaca. Tetapi ternyata, OAM (memori sprite) dan CGRAM (memori palet) terbuka. Kuncinya adalah bahwa pada saat ini, PPU mengontrol bus alamat. Oleh karena itu, membaca OAM dan CGRAM selama rendering layar, saya dapat mengamati apa yang PPU dapatkan dari dua blok memori ini pada saat yang kritis.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini bukan semua bagian dari teka-teki, tetapi cukup bagi saya untuk dapat menerapkan pola yang benar-benar benar untuk mendapatkan sprite. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menggunakan pola akses untuk OAM dan CGRAM, bendera PPU terbuka, pengamatan umum (mis. Tebakan) dari laporan kesalahan untuk game yang berbeda, dan penalaran deduktif, kami dapat membuat render PPU berbasis jam yang </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hampir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dapat dengan sempurna </font><font style="vertical-align: inherit;">meluncurkan semua game yang dirilis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi situasinya masih genting: jika seseorang mulai membuat game homebrew menggunakan waktu kutu dan efek raster yang akurat, maka semua emulator modern kita tidak akan mampu menangani ini. Termasuk implementasi perangkat lunak dan perangkat keras berdasarkan FPGA. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya harus mengatakan dengan jelas: hari ini </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">semuanya</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mereka hanya mengetahui urutan operasi internal dan perilaku snap di chip PPU dari konsol SNES. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tidak ada yang</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tahu bagaimana meniru mereka dengan sempurna. </font><font style="vertical-align: inherit;">Setidaknya untuk sekarang.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solusi yang memungkinkan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa yang akan kita lakukan dengan ini? </font><font style="vertical-align: inherit;">Bagaimana menentukan urutan operasi yang tepat dalam PPU jika, dari sudut pandang SNES CPU, ini adalah "kotak hitam"? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya melihat empat opsi yang memungkinkan: penganalisa logika, output video digital dalam mode uji, bangun dan melepas penutup dari chip.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analisis logika</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda melihat pindaian kristal PPU yang ditunjukkan di atas, Anda akan melihat area hitam di tepi chip. Ini adalah platform yang menghubungkan ke kontak chip. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pin ini menyimpan status chip PPU selama setiap siklus clock. Di sini Anda dapat menemukan alamat saat ini di mana chip mengakses chip memori video, nilai-nilai data yang ditransfer dari satu PPU ke yang kedua, dan banyak lagi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Informasi ini tidak tersedia untuk kode yang berjalan pada SNES CPU, tetapi memberikan pengamatan berharga tentang urutan internal operasi PPU.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2c8/157/c0d/2c8157c0df8caaebd7e24f620bf2c60f.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menghubungkan PPU konsol Super NES ke penganalisis logika yang sama bisa menjadi kunci ke kotak hitam. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Masalah kritis dari penganalisa logika adalah mereka tidak terlalu nyaman untuk dikelola: jika Anda mencoba mengambil sampel data langsung dari sistem kerja, kami akan mendapatkan aliran hasil yang agak sulit untuk diuraikan. </font><font style="vertical-align: inherit;">Anda akan mengalami masalah yang sama jika Anda mencoba untuk menganalisis output RGB analog dari sistem: untuk menangkap data ini, Anda harus secara manual melakukan masing-masing tes. </font><font style="vertical-align: inherit;">Sistem seperti itu tidak terlalu baik untuk membuat tes regresi otomatis yang dapat direproduksi.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Output video digital dalam mode uji</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Baru-baru ini, melalui pemindaian irisan kristal dengan perbesaran 20x, mode uji rahasia telah ditemukan dalam chip PPU konsol SNES. Jika Anda membuat modifikasi perangkat keras kecil, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">maka PPU akan mulai mengeluarkan sinyal RGB digital 15-bit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini hampir yang kita butuhkan! Namun, mode ini memiliki masalah, karena mode terkenal 7 tidak dapat menampilkan gambar yang benar di dalamnya. Tampaknya fungsi ini belum sepenuhnya selesai.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selain itu, untuk menerapkan metode ini, modifikasi manual konsol SNES dan mekanisme yang sesuai untuk menangkap dan menganalisis output dalam mode uji masih diperlukan. </font><font style="vertical-align: inherit;">Namun demikian, tidak seperti solusi dengan menangkap sinyal RGB analog, sinyal digital seperti itu dapat mengalami pengujian otomatis, yang memungkinkan kita untuk dengan cepat menyelesaikan sejumlah besar pekerjaan pada rekayasa balik PPU.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terbangun</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mengingat bahwa PPU bersifat statis, kami dapat menghapus chip PPU dari konsol SNES yang berfungsi dan menghubungkannya ke papan prototyping atau papan sirkuit yang dibuat khusus bersama dengan dua chip VRAM. </font><font style="vertical-align: inherit;">Setelah itu, Anda dapat menempatkan mikrokontroler antara PPU dan antarmuka USB, dan menghubungkan antarmuka ke PC, yang memungkinkan encoder untuk memprogram semua register memori video eksternal dan PPU. </font><font style="vertical-align: inherit;">Selain itu, encoder akan dapat secara manual mengontrol siklus clock PPU dan membaca sinyal yang dihasilkan pada konektor I / O, register dan dalam memori PPU di setiap siklus clock.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan memodifikasi emulator perangkat lunak sehingga menghasilkan nilai internal yang sama dari konektor I / O, kita dapat langsung membandingkan perangkat keras nyata dengan emulasi, bahkan secara real time. </font><font style="vertical-align: inherit;">Namun, ini akan menjadi kerja yang sangat sulit karena kami belum dapat melihat operasi PPU internal.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penghapusan penutup</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terakhir, solusi paling ekstrem adalah mempelajari kristal lebih lanjut dengan melepas penutup chip. </font><font style="vertical-align: inherit;">Kami sudah memiliki pemindaian kristal dengan pembesaran 20x, tetapi resolusi mereka tidak cukup untuk menganalisis dan membuat ulang rangkaian logika individu, seperti yang dilakukan dalam </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proyek Visual 6502</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Jika kita bisa mendapatkan pindaian kristal kedua PPU dengan perbesaran 100x, maka kita bisa memulai kerja keras menyusun sirkuit PPU dan mengubahnya menjadi tabel koneksi atau kode VHDL. </font><font style="vertical-align: inherit;">Kemudian mereka dapat digunakan langsung dalam FPGA, serta porting ke C ++ atau bahasa pemrograman lain, yang berlaku untuk membuat emulator perangkat lunak.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Salah satu spesialis yang telah melakukan ini sebelumnya memberi saya perkiraan kasar: akan butuh sekitar 600 jam untuk memetakan kedua PPU. </font><font style="vertical-align: inherit;">Tugas ini jauh lebih tinggi daripada tingkat "Mari kita mengumpulkan uang dengan menggalang dana dan membayar seseorang", dan idealnya jatuh ke dalam kategori "Mari kita berharap bahwa seseorang yang sangat berbakat dengan serangkaian keterampilan yang unik ingin membantu kita secara sukarela." </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentu saja, ini tidak berarti bahwa saya tidak akan senang memberi imbalan finansial kepada seseorang atas bantuan mereka, saya dapat membayar untuk rincian yang diperlukan dan bekerja.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minta bantuan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk meringkas: Saya melangkah sejauh mungkin dalam proyek emulator SNES saya, dan saya perlu bantuan untuk menyelesaikan tugas akhir ini. </font><font style="vertical-align: inherit;">Jika Anda telah membaca sampai akhir, maka Anda mungkin ingin membantu! </font><font style="vertical-align: inherit;">Dukungan apa pun, termasuk partisipasi dalam </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proyek bsnes di GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , atau dokumentasi penelitian apa pun tentang cara kerja internal chip PPU, akan terbukti sangat berharga bagi kami! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terima kasih telah membaca dan atas dukungan Anda! </font><font style="vertical-align: inherit;">Merupakan suatu kehormatan bagi saya selama lima belas tahun untuk menjadi anggota komunitas emulasi SNES.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id495256/index.html">Tentang port dan enkripsi di server mail</a></li>
<li><a href="../id495258/index.html">Bagaimana Zoom menjadi perusahaan terpenting di era coronavirus</a></li>
<li><a href="../id495262/index.html">Praktik peningkatan versi PostgreSQL. Andrey Salnikov</a></li>
<li><a href="../id495266/index.html">E-learning Renaissance. Mengapa 2020 akan menunjukkan semua keunggulan pembelajaran jarak jauh</a></li>
<li><a href="../id495268/index.html">Kasus UI / UX: otomatisasi parkir bandara</a></li>
<li><a href="../id495274/index.html">Cara memperbaiki kebocoran rute</a></li>
<li><a href="../id495276/index.html">Dan tunjukkan, atau Bagaimana kami melewati audit Keberlanjutan Operasional di Uptime Institute</a></li>
<li><a href="../id495278/index.html">Database, kartu, daftar periksa, atau Mengapa manajer pengetahuan bisnis</a></li>
<li><a href="../id495280/index.html">Max Patrol SIEM. Keamanan Informasi Ikhtisar Sistem Manajemen Kejadian</a></li>
<li><a href="../id495282/index.html">Validasi XML menggunakan XSD, JAXB, dan Spring Framework</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>