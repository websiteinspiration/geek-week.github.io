<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👴🏼 👨‍🚀 🤺 データベースをリモート接続で使用できるようにする 👩🏻‍🌾 🎅🏾 👧🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="まず、データベースに接続するアプリケーションを作成する必要がある場合があります。これは、手とスキルの不足により、バックエンドの開発を特に掘り下げてフロントエンドに集中しないようにするために行われます。私のソリューションが安全であるとは思いませんが、それは機能します。
 
 私はホスティングにお金を払...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>データベースをリモート接続で使用できるようにする</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461503/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">まず、データベースに接続するアプリケーションを作成する必要がある場合があります。</font><font style="vertical-align: inherit;">これは、手とスキルの不足により、バックエンドの開発を特に掘り下げてフロントエンドに集中しないようにするために行われます。</font><font style="vertical-align: inherit;">私のソリューションが安全であるとは思いませんが、それは機能します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はホスティングにお金を払うのが好きではないので、私は仕事でネットワークを使用しました、そこに白いIPがあります。</font><font style="vertical-align: inherit;">ここにその構造があります：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/uq/mk/6p/uqmk6plxi-kwn_kcow5frbi7ndk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は複数のコンピュータにもっと正確に192.168.1.2（別名192.168.0.2）にアクセスできます。Linuxがそこにあり、Windowsでは192.168.0.3にアクセスできます。</font><font style="vertical-align: inherit;">一般的に、私のアプリケーションでは、mysqlを選択し、Linuxの内容を調べました。</font><font style="vertical-align: inherit;">それはすでにそこにインストールされていましたが、誰もパスワードを知りませんでした。</font><font style="vertical-align: inherit;">誰も彼を必要としないことを知って、私はそれを削除して再インストールしようとしました。</font><font style="vertical-align: inherit;">メモリが足りなかったため、このエラーを修正するにはモニターとキーボードをマウスで接続する必要があったため、このビジネスを中止することにしました。</font><font style="vertical-align: inherit;">さらに、Windowsマシンの方がはるかに強力であり、それに加えて、私自身も自宅のラップトップに搭載しています。</font><font style="vertical-align: inherit;">原則として、インストール自体については説明しません。それに関するマニュアルやビデオがたくさんあります。</font><font style="vertical-align: inherit;">mysqlをWindowsマシンにインストールしたので、ラップトップからワークステーションにテーブルをバックアップすることにしました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは次のように行われます（私の場合）：</font></font><br>
<br>
<pre><code class="bash hljs">mysqldump -uroot -p your_base &gt; dump_file.sql
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、新しいデータベースでデータベースを作成し、「新しい」マシンにバックアップを復元します。</font></font><br>
<br>
<pre><code class="bash hljs">mysql -h localhost -u root -p
</code></pre><br>
<pre><code class="sql hljs"><span class="hljs-keyword">create</span> <span class="hljs-keyword">database</span> your_base;
<span class="hljs-keyword">use</span> your_base;
</code></pre><br>
<pre><code class="bash hljs">mysql -uroot -p your_base &lt; dump_file.sql
</code></pre><br>
<pre><code class="sql hljs"><span class="hljs-keyword">show</span> <span class="hljs-keyword">tables</span>;
</code></pre><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バックアップファイルは新しいマシンに配置する必要があります。ユーティリティディレクトリにない場合は、そのフルパスを指定する必要があります。</font><font style="vertical-align: inherit;">（私はgithubにバックアップをアップロードし、それを新しいマシンにクローンしました）。</font><font style="vertical-align: inherit;">テーブル自体の作成方法を追加しますが、スクリーンショットは保存しなかったので、2〜3年の学生であっても難しくないと思います。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのテーブルを復元したら、データベースへのリモートアクセスにアクセスできるようにします。</font><font style="vertical-align: inherit;">一般に、そのようなコマンドは成功に至りませんでした（選択するための読み取りアクセス許可のみを発行しました）</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> <span class="hljs-string">'client'</span>@<span class="hljs-string">'%'</span> <span class="hljs-keyword">IDENTIFIED</span> <span class="hljs-keyword">by</span> <span class="hljs-string">'client'</span>;
<span class="hljs-keyword">grant</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">on</span> your_base . * <span class="hljs-keyword">to</span> <span class="hljs-string">'client'</span>@<span class="hljs-string">'%'</span>;
<span class="hljs-keyword">flush</span> <span class="hljs-keyword">privileges</span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もっと正確に言えば、私はチームとしかデータベースに接続できませんでした。</font></font><br>
<br>
<pre><code class="bash hljs">mysql -h localhost -u client -pclient
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、これはできませんでした</font></font><br>
<br>
<pre><code class="sql hljs">mysql -h 192.168.0.3 -u client -pclient
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それは私には合わず、このアドレス経由で、またルートから接続できませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysqlワークベンチプログラムは設定を支援し、localhostを％に変更して機能しますが、クライアントはそれを支援しませんでした。これで、コンソールまたは任意のアドレスのコードからデータベースに接続できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jk/ys/cs/jkyscs1lcvbpljzkxh14oqwkiiu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、ホームネットワークまたはエンタープライズネットワークを作成し、Windowsファイアウォールをオフにする必要があります。そうしないと、このマシンにpingを実行することもできません（データベースに接続しているわけではありません）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
半分の作業が完了したら、自宅からデータベースに接続できるようにする必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ネットワーク図からわかるように、192.168.0.3から192.168.1.1（ルーター）にインターネットにアクセスする必要があります。逆の方向に進みましょう。 192.168.1.1から192.168.1.2へのルートを次のように構成してみましょう</font></font><br>
<br>
<img src="https://habrastorage.org/5d/37/4d/5d374de1038ee757922449.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。一般的には、写真は表示されません。手で書きます。</font></font><br>
<br>
<pre><code class="bash hljs">route add 192.168.0.0 mask 255.255.255.0 gateway 192.168.1.2
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは1つのサブネットでのみ実行できます。つまり、アドレス192.168.0.2または192.168.0.3にすぐに転送することはできません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、ルーターが192.168.0.0/24サブネットの場所を認識できるようにするために必要です（ネットワークの基本を理解しておくと便利です）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、ポート転送3306（デフォルトのmysqlポート（インストール中に変更しなかった場合））をアドレス192.168.1.2に追加します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/es/av/3b/esav3bmwqprghssdh6oeslgo4ik.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを行うのが最も難しいのは、それをLinuxマシンに転送することです（その上に2つのネットワークカード192.168.1.2があります（enp3s1インターフェイス））。と192.168.0.2（enp3s0インターフェース）を使用して、ネットワークカードが192.168.1.2から192.168.0.2に転送し、次にMySqlを使用してWindowsマシンに転送する方法を認識します。</font></font><br>
<br>
<pre><code class="bash hljs">sudo iptables -A FORWARD -i enp3s1 -o enp3s0 -p tcp --syn --dport 3306 -m conntrack --ctstate NEW -j ACCEPT<font></font>
sudo iptables -A FORWARD -i enp3s1 -o enp3s0 -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT<font></font>
sudo iptables -A FORWARD -i enp3s0 -o enp3s1 -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT<font></font>
sudo iptables -t nat -A PREROUTING -i enp3s1 -p tcp --dport 3306 -j DNAT --to-destination 192.168.0.3<font></font>
sudo iptables -t nat -A POSTROUTING -o enp3s0 -p tcp --dport 3306 -d 192.168.0.3 -j SNAT --to-source 192.168.1.2<font></font>
            <font></font>
sudo service iptables-persistent save<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それら。</font><font style="vertical-align: inherit;">最初の行は最初の接続を受け入れることを意味し、2番目と3番目は両側でパケットを開始できます。4番目と5番目は宛先アドレスと送信元を置き換えることを意味します。</font><font style="vertical-align: inherit;">ほら、mysql経由で自宅から接続できます。</font><font style="vertical-align: inherit;">そして最後に、これを行う私のC ++コード：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//DataBaseConnection.cpp</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"DataBaseConnection.h"</span></span><font></font>
<font></font>
DataBaseConnection::DataBaseConnection()<font></font>
{<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">DataBaseConnection::Connect</span><span class="hljs-params">()</span>
</span>{
	<span class="hljs-comment">//   </span>
	conn = mysql_init(<span class="hljs-literal">NULL</span>);
	<span class="hljs-keyword">if</span> (conn == <span class="hljs-literal">NULL</span>)<font></font>
	{<font></font>
		<span class="hljs-comment">//     –    </span>
		<span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Error: can'tcreate MySQL-descriptor\n"</span>);
		<span class="hljs-comment">//exit(1); //   </span><font></font>
	}<font></font>
	<span class="hljs-comment">//   </span>
	<span class="hljs-keyword">if</span> (!mysql_real_connect(conn, <span class="hljs-string">"192.168.0.3"</span>, <span class="hljs-string">"root"</span>, <span class="hljs-string">"password"</span>, <span class="hljs-string">"your_base"</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>))<font></font>
	{<font></font>
		<span class="hljs-comment">//        </span>
		<span class="hljs-comment">//      </span>
		<span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Error: can't connect to database: %s\n"</span>, mysql_error(conn));<font></font>
	}<font></font>
	<span class="hljs-keyword">else</span><font></font>
	{<font></font>
		<span class="hljs-comment">//       - "Success!"</span>
		<span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stdout</span>, <span class="hljs-string">"Success!\n"</span>);<font></font>
	}<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt; <span class="hljs-title">DataBaseConnection::Query</span><span class="hljs-params">()</span>
</span>{<font></font>
	vectordrum.clear();<font></font>
	<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> query = <span class="hljs-string">"SELECT * FROM drum where id=0"</span>;
	<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> * q = query.c_str();<font></font>
	qstate = mysql_query(conn, q);<font></font>
	<span class="hljs-keyword">if</span> (!qstate)<font></font>
	{<font></font>
		res = mysql_store_result(conn);<font></font>
		<span class="hljs-keyword">while</span> (row = mysql_fetch_row(res))<font></font>
		{<font></font>
			<span class="hljs-comment">//printf("ID: %s,Position: %s, Image: %s\n", row[0], row[1], row[2]);</span>
			vectordrum.push_back(row[<span class="hljs-number">2</span>]);<font></font>
		}<font></font>
	}<font></font>
	<span class="hljs-keyword">else</span><font></font>
	{<font></font>
		<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Query failed:"</span> &lt;&lt; mysql_error(conn) &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;<font></font>
	}<font></font>
	<span class="hljs-keyword">return</span> vectordrum;<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">DataBaseConnection::Close</span><span class="hljs-params">()</span>
</span>{
	<span class="hljs-comment">//      </span><font></font>
	mysql_close(conn);<font></font>
}<font></font>
DataBaseConnection::~DataBaseConnection()<font></font>
{<font></font>
	vectordrum.clear();<font></font>
}<font></font>
<span class="hljs-comment">//DataBaseConnection.h</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> once</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;mysql.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;vector&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> comment(lib,<span class="hljs-meta-string">"mysqlcppconn.lib"</span>)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> comment(lib,<span class="hljs-meta-string">"libmysql.lib"</span>)</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DataBaseConnection</span>
{</span>
<span class="hljs-keyword">public</span>:<font></font>
	DataBaseConnection();<font></font>
	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Connect</span><span class="hljs-params">()</span></span>;
	<span class="hljs-function"><span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt; <span class="hljs-title">Query</span><span class="hljs-params">()</span></span>;
	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Close</span><span class="hljs-params">()</span></span>;<font></font>
	~DataBaseConnection();<font></font>
	MYSQL *conn;<font></font>
	MYSQL_ROW row;<font></font>
	MYSQL_RES *res;<font></font>
	<span class="hljs-keyword">int</span> qstate;
	<span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt; vectordrum;<font></font>
};<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、このプログラムを誰にでも安全にドロップでき、ローカルで動作するようにプログラムを書き直す必要はありません。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja461487/index.html">ミニCTFテスト</a></li>
<li><a href="../ja461493/index.html">Django 3.0は非同期になります</a></li>
<li><a href="../ja461497/index.html">Linuxでの最新のテキストレンダリング：パート1</a></li>
<li><a href="../ja461499/index.html">2019年にゲームを翻訳する言語</a></li>
<li><a href="../ja461501/index.html">なぜ米国で大規模なIT企業の仕事を調査しているのか</a></li>
<li><a href="../ja461505/index.html">あなたがプロになるのを妨げる初心者JavaScript開発者の8つのバグ</a></li>
<li><a href="../ja461507/index.html">なぜGazprom NeftコーポレートアクセラレータStartupDriveを発売することにしたのですか？</a></li>
<li><a href="../ja461509/index.html">旅行アシスタント：ガジェットとアクセサリーのセレクション</a></li>
<li><a href="../ja461511/index.html">Python依存関係管理：アプローチの比較</a></li>
<li><a href="../ja461519/index.html">﻿CおよびC ++に最適なコピーアンドペーストアルゴリズム。Haiku OSレシピコレクション</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>