<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåØ üìè ü§úüèº Mikhail Salosin. Meetup Golang. Utiliser Go dans le backend de l'application Watch + üë∞üèº üïé üöõ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mikhail Salosin (ci-apr√®s - MS): - Bonjour √† tous! Mon nom est Michael. Je travaille en tant que d√©veloppeur backend chez MC2 Software, et je parlerai...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Mikhail Salosin. Meetup Golang. Utiliser Go dans le backend de l'application Watch +</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/490750/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Salosin (ci-apr√®s - MS):</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Bonjour √† tous! </font><font style="vertical-align: inherit;">Mon nom est Michael. </font><font style="vertical-align: inherit;">Je travaille en tant que d√©veloppeur backend chez MC2 Software, et je parlerai de l'utilisation de Go dans le backend de l'application mobile Watch +. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tf/pc/yj/tfpcyjrufa8t1o-_ilgh2iqqb1w.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Est-ce que quelqu'un pr√©sente comme le hockey? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/td/g7/l_/tdg7l_zyrrg7vw1shoc3fdxywda.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, cette application est faite pour vous. </font><font style="vertical-align: inherit;">C'est pour Android et iOS, utilis√© pour regarder les √©missions de divers √©v√©nements sportifs en ligne et dans des enregistrements. </font><font style="vertical-align: inherit;">Dans l'application, il existe √©galement diverses statistiques, diffusions de texte, tableaux de conf√©rences, tournois et autres informations utiles pour les fans. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ps/cn/fa/pscnfash29d-yqq6ldluvigihoq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans l'application, il y a aussi des moments vid√©o, c'est-√†-dire que vous pouvez voir les moments aigus des matchs (buts, combats, fusillades, etc.). </font><font style="vertical-align: inherit;">Si vous ne voulez pas regarder la totalit√© de l'√©mission, vous ne pouvez regarder que les plus int√©ressantes.</font></font><a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qu'est-ce qui a √©t√© utilis√© dans le d√©veloppement?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le corps principal a √©t√© √©crit en Go. L'API avec laquelle les clients mobiles ont communiqu√© a √©t√© √©crite en Go. En outre, un service a √©t√© √©crit sur Go pour envoyer des notifications push au mobile. Nous avons √©galement d√ª √©crire notre propre ORM, dont nous pourrions un jour parler. Et bien, quelques petits services sont √©crits sur Go: redimensionnement et chargement d'images pour les √©diteurs ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons utilis√© Postgres (PostgreSQL) comme base de donn√©es. L'interface pour les √©diteurs a √©t√© √©crite en Ruby on Rails √† l'aide de la gemme ActiveAdmin. L'importation de statistiques √† partir du fournisseur de statistiques est √©galement √©crite sur Ruby.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour les tests de l'API syst√®me, nous avons utilis√© le Python unittest (Python). </font><font style="vertical-align: inherit;">Memcached est utilis√© pour limiter les demandes de paiement API, Chef pour contr√¥ler la configuration, Zabbix pour collecter et surveiller les statistiques internes du syst√®me. </font><font style="vertical-align: inherit;">Graylog2 - pour la collecte des journaux, Slate est une documentation API pour les clients.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/n5/v_/tc/n5v_tcwffefrpa-fxomv5jc_moc.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S√©lection du protocole</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le premier probl√®me que nous avons rencontr√©: nous avons d√ª choisir un protocole d'interaction du backend avec les clients mobiles, bas√© sur les points suivants ...</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'exigence la plus importante: les donn√©es sur les clients doivent √™tre mises √† jour en temps r√©el. </font><font style="vertical-align: inherit;">Autrement dit, tous ceux qui regardent actuellement la diffusion devraient recevoir des mises √† jour presque instantan√©ment.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par souci de simplicit√©, nous avons accept√© que les donn√©es synchronis√©es avec les clients ne soient pas supprim√©es, mais masqu√©es √† l'aide d'indicateurs sp√©ciaux.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toutes sortes de demandes rares (comme les statistiques, les files d'attente, les statistiques d'√©quipe) sont re√ßues par les demandes GET ordinaires.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De plus, le syst√®me √©tait cens√© r√©sister calmement √† 100 000 utilisateurs en m√™me temps.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur cette base, nous avions deux options de protocole:</font></font><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Websockets. </font><font style="vertical-align: inherit;">Mais nous n'avions pas besoin de canaux du client vers le serveur. </font><font style="vertical-align: inherit;">Nous avions seulement besoin d'envoyer des mises √† jour du serveur au client, donc un socket web est une option redondante.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les √©v√©nements envoy√©s par le serveur (SSE) se sont parfaitement d√©roul√©s! </font><font style="vertical-align: inherit;">C'est assez simple et satisfait fondamentalement tout ce dont nous avons besoin.</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âv√©nements envoy√©s par le serveur</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quelques mots sur le fonctionnement de cette chose ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Elle fonctionne en plus de la connexion http. </font><font style="vertical-align: inherit;">Le client envoie une demande, le serveur r√©pond avec Content-Type: texte / flux d'√©v√©nements et ne ferme pas la connexion avec le client, mais continue d'√©crire des donn√©es sur la connexion: les </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0s/qp/5j/0sqp5jdkevts9970rrbpwa0bm9i.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
donn√©es peuvent √™tre envoy√©es dans un format convenu avec les clients. </font><font style="vertical-align: inherit;">Dans notre cas, nous avons envoy√© ce formulaire: dans le champ d'√©v√©nement, le nom de la structure modifi√©e (personne, joueur) a √©t√© envoy√©, et dans le champ de donn√©es - JSON avec de nouveaux champs modifi√©s pour le joueur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, comment fonctionne l'interaction elle-m√™me.</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tout d'abord, le client d√©termine quand la derni√®re synchronisation a √©t√© effectu√©e avec le service: il regarde sa base de donn√©es locale et d√©termine la date de la derni√®re modification enregistr√©e √† partir de celle-ci.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il envoie une demande avec cette date.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En r√©ponse, nous lui envoyons toutes les mises √† jour intervenues √† cette date.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apr√®s cela, il se connecte √† la cha√Æne en direct et ne ferme pas tant qu'il n'a pas besoin de ces mises √† jour:</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/_v/t9/t1/_vt9t1r7nq_--sskm6vc_-0qydw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous lui envoyons une liste de changements: si quelqu'un marque un but - nous changeons le score du match, se blesse - √©galement envoy√© en temps r√©el. </font><font style="vertical-align: inherit;">Ainsi, dans le flux d'√©v√©nements du match, les clients re√ßoivent instantan√©ment les donn√©es pertinentes. </font><font style="vertical-align: inherit;">P√©riodiquement, pour que le client comprenne que le serveur n'est pas mort, que rien ne lui est arriv√©, nous envoyons un horodatage toutes les 15 secondes - pour qu'il sache que tout est en ordre et qu'il n'est pas n√©cessaire de se reconnecter.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment la connexion en direct est-elle desservie?</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tout d'abord, nous cr√©ons un canal dans lequel viendront les mises √† jour avec un tampon.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apr√®s cela, nous nous abonnons √† cette cha√Æne pour recevoir des mises √† jour.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©finissez l'en-t√™te correct pour que le client sache que tout va bien.</font></font></li>
<li>  ping.    timestamp .</li>
<li>         ,     .       timestamp,  ,       .</li>
</ul><br>
<img src="https://habrastorage.org/webt/rf/hl/s9/rfhls98e0zi4dogfbjpptkb-feg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le premier probl√®me que nous avons rencontr√© √©tait le suivant: pour chaque connexion ouverte avec le client, nous avons cr√©√© une minuterie qui a coch√© une fois toutes les 15 secondes - il s'av√®re que nous avions 6 000 connexions avec une machine (avec un serveur API), 6 000 minuteries ont √©t√© cr√©√©es. </font><font style="vertical-align: inherit;">Cela a conduit au fait que la machine ne supportait pas la charge n√©cessaire. </font><font style="vertical-align: inherit;">Le probl√®me n'√©tait pas si √©vident pour nous, mais ils nous ont un peu aid√©s et nous l'avons √©limin√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, nous avons maintenant un ping provenant du m√™me canal d'o√π provient la mise √† jour. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cons√©quence, il n'y a qu'une seule minuterie qui √©met une fois toutes les 15 secondes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici quelques fonctions d'assistance - envoi de l'en-t√™te, du ping et de la structure elle-m√™me. </font><font style="vertical-align: inherit;">Autrement dit, le nom de la table (personne, match, saison) et les informations sur cet enregistrement sont transmis ici:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qu/g2/rh/qug2rhecowmxbnqmqz7zk5p-_7g.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©canisme d'envoi des mises √† jour</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, un peu sur la provenance des changements. </font><font style="vertical-align: inherit;">Nous avons plusieurs personnes, √©diteurs, qui regardent l'√©mission en temps r√©el. </font><font style="vertical-align: inherit;">Ils cr√©ent tous les √©v√©nements: quelqu'un a √©t√© supprim√©, quelqu'un a √©t√© bless√©, une sorte de remplacement ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec l'aide de CMS, les donn√©es sont entr√©es dans la base de donn√©es. </font><font style="vertical-align: inherit;">Apr√®s cela, la base de donn√©es utilisant le m√©canisme Listen / Notify en informe les serveurs API. </font><font style="vertical-align: inherit;">Les serveurs API envoient d√©j√† ces informations aux clients. </font><font style="vertical-align: inherit;">Ainsi, en fait, nous n'avons que quelques serveurs connect√©s √† la base de donn√©es et il n'y a pas de charge sp√©ciale sur la base de donn√©es, car le client n'interagit pas directement avec la base de donn√©es de quelque mani√®re que ce soit:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/az/wp/ei/azwpei0ysoe2uspec2ybfe9mdag.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PostgreSQL: √©couter / notifier</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le m√©canisme Listen / Notify de Postgres vous permet d'informer les abonn√©s des √©v√©nements que certains √©v√©nements ont chang√© - une sorte d'enregistrement a √©t√© cr√©√© dans la base de donn√©es. Pour ce faire, nous avons √©crit un d√©clencheur et une fonction simples: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hj/i_/ms/hji_msz1f-kwrtijbes4flcctr0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
lors de l'insertion ou de la modification d'un enregistrement, nous appelons la fonction de notification sur le canal data_updates, transf√©rons le nom de la table et l'identifiant de l'enregistrement qui a √©t√© modifi√© ou ins√©r√© l√†. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour toutes les tables qui doivent √™tre synchronis√©es avec le client, nous d√©finissons un d√©clencheur qui, apr√®s avoir modifi√© / mis √† jour l'enregistrement, appelle la fonction indiqu√©e sur la diapositive ci-dessous. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment l'API souscrit-elle √† ces modifications? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le m√©canisme Fanout est cr√©√© - il envoie des messages au client. Il recueille tous les canaux clients et envoie les mises √† jour qu'il a re√ßues via ces canaux:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kx/op/vl/kxopvlizual_4yyz48t79flo8w8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, la biblioth√®que pq standard, qui se connecte √† la base de donn√©es et dit qu'elle veut √©couter le canal (data_updates), v√©rifie que la connexion est ouverte et que tout va bien. </font><font style="vertical-align: inherit;">J'omet la v√©rification des erreurs pour √©conomiser de l'espace (ne pas v√©rifier lourd). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous d√©finissons le Ticker de mani√®re asynchrone, qui enverra un ping toutes les 15 secondes, et commencera √† √©couter la cha√Æne √† laquelle nous nous sommes abonn√©s. </font><font style="vertical-align: inherit;">Si nous avons un ping, nous publions ce ping. </font><font style="vertical-align: inherit;">Si nous avons re√ßu un enregistrement, nous publions cet enregistrement √† tous les abonn√©s de ce Fanout.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment fonctionne le fan-out?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En russe, cela se traduit par un ¬´s√©parateur¬ª. Nous avons un objet qui enregistre les abonn√©s qui souhaitent recevoir des mises √† jour. Et d√®s qu'une mise √† jour de cet objet arrive, il propage cette mise √† jour √† tous les abonn√©s qu'il poss√®de. Assez simple: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/je/tw/76/jetw76q3dzqifpq22yo9dc3j4ha.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
comment il est impl√©ment√© sur Go: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nz/gl/o8/nzglo8wnz5iwzrtjfc39zlqqxa8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
il y a une structure, il est synchronis√© √† l'aide de Mutex. Il a un champ qui enregistre l'√©tat de la connexion Fanout √† la base de donn√©es, c'est-√†-dire au moment o√π il √©coute et recevra les mises √† jour, ainsi qu'une liste de tous les canaux disponibles - carte, dont la cl√© est le canal et la structure sous forme de valeurs (en fait, il utilis√© en aucune fa√ßon).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deux m√©thodes - Connect√© et D√©connect√© - vous permettent de dire √† Fanout que nous avons une connexion √† la base, il est apparu et que la connexion √† la base est d√©connect√©e. Dans le second cas, vous devez d√©connecter tous les clients et leur dire qu'ils ne peuvent plus rien √©couter et qu'ils se reconnectent, car la connexion avec eux est ferm√©e. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe √©galement une m√©thode Subscribe qui ajoute un canal aux √©couteurs: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/i1/hu/rh/i1hurht2d0x5mmdikeem_gpmm3i.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
il existe une m√©thode Unsubscribe qui supprime un canal des √©couteurs si le client se d√©connecte, ainsi qu'une m√©thode Publish qui vous permet d'envoyer un message √† tous les abonn√©s. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Question:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Qu'est-ce qui est transmis par ce canal? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Un mod√®le est transmis qui a chang√© ou ping (essentiellement juste un nombre, un entier). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SP:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Vous pouvez envoyer n'importe quoi, publier n'importe quelle structure, cela se transforme simplement en JSON et c'est tout. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Nous recevons une notification de Postgres - il contient le nom et l'identifiant de la table. </font><font style="vertical-align: inherit;">Par le nom de la table que nous obtenons et l'identifiant nous obtenons l'enregistrement dont nous avons besoin, et d√©j√† cette structure est envoy√©e pour publication.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Infrastructure</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä quoi cela ressemble-t-il en termes d'infrastructure? Nous avons 7 serveurs de fer: l'un d'eux est enti√®rement d√©di√© √† la base, des ordinateurs virtuels tournent sur les six autres. Il y a 6 copies de l'API: chaque machine virtuelle avec l'API s'ex√©cute sur un serveur de fer distinct - c'est pour la fiabilit√©. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hu/2_/4e/hu2_4eyv8ko_you4ygxuowle6m4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons deux frontaux sur lesquels Keepalived est install√© pour am√©liorer l'accessibilit√©, de sorte que dans le cas o√π un frontend peut remplacer l'autre. Deux autres copies du CMS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe √©galement un importateur de statistiques. Il existe un esclave DB √† partir duquel des sauvegardes sont effectu√©es p√©riodiquement. Il y a Pigeon Pusher - l'application qui envoie des pushies aux clients, ainsi que des √©l√©ments d'infrastructure: Zabbix, Graylog2 et Chef.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, cette infrastructure est redondante, car 100 000 peuvent √™tre servis avec moins de serveurs. </font><font style="vertical-align: inherit;">Mais il y avait du fer - nous l'avons utilis√© (on nous a dit que c'√©tait possible - pourquoi pas).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avantages de Go</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir travaill√© sur cette application, ces avantages √©vidents de Go ont √©t√© r√©v√©l√©s.</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cool biblioth√®que http. </font><font style="vertical-align: inherit;">En l'utilisant, vous pouvez en cr√©er d√©j√† beaucoup hors de la bo√Æte.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De plus, les canaux qui nous ont permis de mettre en ≈ìuvre tr√®s facilement le m√©canisme d'envoi de notifications aux clients.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le merveilleux d√©tecteur Race nous a permis d'√©liminer plusieurs bugs critiques (staging-infrastructure). </font><font style="vertical-align: inherit;">Tout ce qui fonctionne sur la mise en sc√®ne est en cours d'ex√©cution, compil√© avec la touche Race; </font><font style="vertical-align: inherit;">et, par cons√©quent, nous pouvons voir quels probl√®mes potentiels nous avons sur l'infrastructure de transit.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minimalisme et simplicit√© du langage.</font></font></li>
</ul><br>
<br>
<img src="https://habrastorage.org/webt/eb/lc/mo/eblcmow1odoou6z22y2rady3n6k.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous recherchons des d√©veloppeurs! </font><font style="vertical-align: inherit;">Si quelqu'un veut - s'il vous pla√Æt.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Des questions</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Question du public (ci-apr√®s - B): - Il me semble que vous avez manqu√© un point important concernant le Fan-out. Je comprends bien que lorsque vous envoyez une r√©ponse √† un client, vous √™tes bloqu√© si le client ne veut pas lire? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Non, nous ne bloquons pas. Premi√®rement, nous avons tout derri√®re nginx, c'est-√†-dire qu'il n'y a aucun probl√®me avec les clients lents. Deuxi√®mement, le client a un canal avec un tampon - en fait, nous pouvons y mettre jusqu'√† cent mises √† jour ... Si nous ne pouvons pas √©crire sur le canal, il le supprime. Si nous voyons que le canal est bloqu√©, alors nous fermons simplement le canal, et c'est tout - le client se reconnectera en cas de probl√®me. Par cons√©quent, en principe, le blocage ne se produit pas ici. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Pourriez-vous envoyer imm√©diatement √† Listen / Notify un enregistrement, pas une table d'identification? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SP:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Listen / Notify a une limite de 8 000 octets par pr√©charge, qu'il envoie. En principe, il serait possible d'envoyer si nous avions affaire √† une petite quantit√© de donn√©es, mais il me semble que la mani√®re [comme nous le faisons] est simplement plus fiable. Les limitations sont dans Postgres m√™me. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Les clients re√ßoivent-ils des mises √† jour sur les correspondances qui ne les int√©ressent pas? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SP:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- En g√©n√©ral, oui. En r√®gle g√©n√©rale, il y a 2-3 matchs en parall√®le, puis tr√®s rarement. Si le client regarde quelque chose, il regarde g√©n√©ralement le match en cours. Ensuite, sur le client, il existe une base de donn√©es locale dans laquelle toutes ces mises √† jour s'additionnent, et m√™me sans connexion Internet, le client peut voir toutes les correspondances pass√©es pour lesquelles il a des mises √† jour. En fait, nous synchronisons notre base de donn√©es sur le serveur avec la base de donn√©es locale du client afin qu'elle puisse fonctionner hors ligne. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Pourquoi avez-vous fait votre ORM? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alexey (l'un des d√©veloppeurs de ¬´Watch +¬ª):</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- A cette √©poque (c'√©tait il y a un an) ORM √©tait moins que maintenant, alors qu'il y en a pas mal. De la majorit√© des ORM existants, ce que je n'aime pas le plus, c'est que la plupart d'entre eux fonctionnent sur des interfaces vides. Autrement dit, les m√©thodes que dans ces ORM sont pr√™tes √† prendre n'importe quoi: structure, pointeur de structure, nombre, quelque chose de non pertinent du tout ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notre ORM g√©n√®re des structures bas√©es sur le mod√®le de donn√©es. Lui-m√™me. Et donc, toutes les m√©thodes sont concr√®tes, n'utilisent pas la r√©flexion, etc. Ils acceptent les structures et s'attendent √† utiliser les structures qui viennent. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Combien de personnes ont particip√©? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Au stade initial, deux personnes ont particip√©. Quelque part en juin, nous avons commenc√©, en ao√ªt la partie principale √©tait pr√™te (premi√®re version). En septembre, il y a eu une lib√©ration. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Ä:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Lorsque vous d√©crivez SSE, vous n'utilisez pas de d√©lai d'expiration. Pourquoi donc? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Pour √™tre honn√™te, SSE est toujours un protocole html5: la norme SSE est con√ßue pour communiquer avec les navigateurs, si je comprends bien. Il a des fonctionnalit√©s suppl√©mentaires pour que les navigateurs puissent se reconnecter (et ainsi de suite), mais nous n'en avons pas besoin, car nous avions des clients qui pouvaient impl√©menter n'importe quelle logique pour se connecter et recevoir des informations. Nous n'avons probablement pas fait d'ESS, mais quelque chose de similaire √† SSE. Ce n'est pas le protocole lui-m√™me. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce n'√©tait pas n√©cessaire. Autant que je sache, les clients ont impl√©ment√© le m√©canisme de connexion √† partir de z√©ro. En principe, ils s'en fichaient. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Quels utilitaires suppl√©mentaires avez-vous utilis√©s? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SP:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Les plus actifs, nous avons utilis√© govet et golint, afin que le style soit unifi√©, ainsi que gofmt. Ils n‚Äôont rien utilis√© d‚Äôautre. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Avec quoi avez-vous d√©bogu√©? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Dans l'ensemble, le d√©bogage a √©t√© effectu√© √† l'aide de tests. Pas de d√©bogueur, GOP que nous n'avons pas utilis√©. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Pouvez-vous retourner la diapositive o√π la fonction de publication est impl√©ment√©e? Les noms de variables √† une seule lettre ne vous d√©rangent pas? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Non. Ils ont une port√©e assez "√©troite". Ils ne sont utilis√©s nulle part ailleurs (sauf ici) (sauf pour l'int√©rieur de cette classe), et il est tr√®s compact - il ne prend que 7 lignes. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - D'une certaine mani√®re, ce n'est toujours pas intuitif ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Non, non, c'est un vrai code! Ce n'est pas une question de style. C'est juste une classe utilitaire, tr√®s petite - il n'y a que 3 champs √† l'int√©rieur de la classe ... </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yx/vb/a8/yxvba8lbupf_3aw2halepbbmlce.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Dans l'ensemble, toutes les donn√©es synchronis√©es avec les clients (matchs saisonniers, joueurs) ne changent pas. En gros, si nous allons pratiquer un autre type de sport dans lequel il sera n√©cessaire de changer de match, nous ne consid√©rerons que tout dans la nouvelle version du client, et les anciennes versions du client seront interdites. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Existe-t-il des packages tiers pour la gestion des d√©pendances? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Nous avons utilis√© go dep. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Il y avait quelque chose √† propos de la vid√©o dans le sujet du rapport, mais rien √† propos de la vid√©o dans le rapport. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Non, je n'ai rien dans le sujet sur la vid√©o. Il s'appelle ¬´Look +¬ª - c'est le nom de l'application. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Ä:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Vous avez dit que vous diffusiez en continu vers des clients? .. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Nous n'avons pas fait de streaming vid√©o. </font><font style="vertical-align: inherit;">Cela a √©t√© enti√®rement fait par Megaphone. </font><font style="vertical-align: inherit;">Oui, je n'ai pas dit que l'application est un m√©gaphone. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Go - pour envoyer toutes les donn√©es - par score, par √©v√©nements de match, statistiques ... Go - c'est tout le backend de l'application. </font><font style="vertical-align: inherit;">Le client doit trouver quelque part quel lien utiliser pour le joueur afin que l'utilisateur puisse regarder le match. </font><font style="vertical-align: inherit;">Nous avons des liens vers des vid√©os et des flux qui sont pr√©par√©s.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/Kq0cWRBd1MU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un peu de publicit√© :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Merci de rester avec nous. Aimez-vous nos articles? Vous voulez voir des mat√©riaux plus int√©ressants? Soutenez-nous en passant une commande ou en recommandant √† vos amis </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des VPS bas√©s sur le cloud pour les d√©veloppeurs √† partir de 4,99 $</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , un </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">analogue unique de serveurs d'entr√©e de gamme que nous avons invent√©s pour vous: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toute la v√©rit√© sur les VPS (KVM) E5-2697 v3 (6 c≈ìurs) 10 Go DDR4 480 Go SSD 1 Gbit / s √† partir de 19 $ ou comment diviser le serveur?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (les options sont disponibles avec RAID1 et RAID10, jusqu'√† 24 c≈ìurs et jusqu'√† 40 Go de DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2 fois moins cher au centre de donn√©es Equinix Tier IV √† Amsterdam?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nous avons seulement </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV √† partir de 199 $</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aux Pays-Bas!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - √† partir de 99 $! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En savoir plus sur la</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cr√©ation d'un b√¢timent d'infrastructure. </font><font style="vertical-align: inherit;">classe c utilisant des serveurs Dell R730xd E5-2650 v4 co√ªtant 9 000 euros pour un sou?</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr490738/index.html">Principe de substitution de Lisk</a></li>
<li><a href="../fr490740/index.html">Les d√©fauts *** ne sont pas seulement de la randomisation</a></li>
<li><a href="../fr490742/index.html">Une nouvelle √®re en robotique a commenc√©</a></li>
<li><a href="../fr490746/index.html">√âvaluation dans Yandex.Taxi: un court article sur un sujet s√©rieux</a></li>
<li><a href="../fr490748/index.html">La t√¢che du d√©veloppeur ou comment nous avons num√©ris√© des scanners manuels sans fournisseur</a></li>
<li><a href="../fr490754/index.html">√âditeur de code de code Visual Studio. Le guide le plus d√©taill√© pour configurer et installer des plugins pour les d√©butants</a></li>
<li><a href="../fr490756/index.html">D√©ployer Jenkins comme code</a></li>
<li><a href="../fr490758/index.html">Les math√©maticiens ont prouv√© la loi universelle de la turbulence</a></li>
<li><a href="../fr490760/index.html">Recherche visuelle Ray Casting (RCVS). Algorithme simple et rapide pour trouver des mod√®les 3D similaires en g√©om√©trie</a></li>
<li><a href="../fr490762/index.html">Comment pr√©voir les billets d'avion?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>