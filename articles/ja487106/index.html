<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏾‍🔬 😒 👜 PVS-StudioアナライザーのRunUOチェック 🤾🏽 🧚🏻 🧚🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="この記事は、PVS-Studioスタティックアナライザーを使用してRunUOプロジェクトをチェックすることを目的としています。RunUOは、かつて多くのMMORPGファンの心をつかんだゲーム、ウルティマオンライン用のサーバーソフトウェアエミュレーターです。
 
 前書き
 RunUOは、MMORPG...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>PVS-StudioアナライザーのRunUOチェック</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/487106/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/pk/vz/nb/pkvznbl6d22oijuluuu2xfoztcs.png" alt="写真1"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事は、PVS-Studioスタティックアナライザーを使用してRunUOプロジェクトをチェックすることを目的としています。</font><font style="vertical-align: inherit;">RunUOは、かつて多くのMMORPGファンの心をつかんだゲーム、ウルティマオンライン用のサーバーソフトウェアエミュレーターです。</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前書き</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RunUO</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、MMORPG Ultima Online用のサーバーソフトウェアエミュレーターです。このプロジェクトの目標は、EA Gamesの公式サーバーと競合できる安定したソフトウェアを作成することです。 RunUOは2002年に作成されましたが、関連性が失われることはなく、現在でも積極的に使用されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロジェクト検証の目的は、静的分析のトピックを普及させることです。ゲーム（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）、ライブラリ（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）、メッセンジャー（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）、ブラウザ（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）など</font><font style="vertical-align: inherit;">、</font><font style="vertical-align: inherit;">さまざまなプロジェクトをチェックし</font><font style="vertical-align: inherit;">ます（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例）</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）多様な聴衆の注意を引く。これらの記事では、開発で静的分析を使用することの重要性に注意を向けようとしています。静的分析により、コードの信頼性と安全性が向上します。また、定期的に使用することで、早い段階でエラーを見つけて排除することができます。これにより</font><font style="vertical-align: inherit;">、アナライザーが検出できるエラーを探すために</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50時間</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を費やす必要がないため、開発者の時間と労力を節約</font><font style="vertical-align: inherit;">できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、オープンソースコミュニティの支援も行っています。</font><font style="vertical-align: inherit;">エラーが発見された記事を通じて、私たちはオープンソースの開発に貢献しています。</font><font style="vertical-align: inherit;">ただし、記事ではすべての警告を分析するわけではありません。</font><font style="vertical-align: inherit;">一部の警告は、私たちが記事に入るには退屈すぎるように思われ、いくつかは誤検知であることが判明しました。</font><font style="vertical-align: inherit;">したがって、</font><font style="vertical-align: inherit;">オープンソースプロジェクトの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">無料ライセンス</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を提供する準備ができています</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">さらに、プロジェクトの開発者はどの問題が最も重要であるかについてさらに認識しているため、この記事に退屈に思われたことは、テストされているプロジェクトの開発者にとって非常に興味深いように思えるかもしれません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アナライザーレポートを調べるときに注意を引いたコード</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3010関数 'Intern'の戻り値を利用する必要があります。</font><font style="vertical-align: inherit;">BasePaintedMask.cs 49</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">string</span> <span class="hljs-title">Intern</span>(<span class="hljs-params"> <span class="hljs-keyword">string</span> str </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( str == <span class="hljs-literal">null</span> )
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( str.Length == <span class="hljs-number">0</span> )
    <span class="hljs-keyword">return</span> String.Empty;<font></font>
<font></font>
  <span class="hljs-keyword">return</span> String.Intern( str );<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">BasePaintedMask</span>(<span class="hljs-params"> <span class="hljs-keyword">string</span> staffer, <span class="hljs-keyword">int</span> itemid </span>)
                            : <span class="hljs-title">base</span>(<span class="hljs-params"> itemid + Utility.Random( <span class="hljs-number">2</span> </span>) )</span><font></font>
{<font></font>
  m_Staffer = staffer;<font></font>
<font></font>
  Utility.Intern( m_Staffer );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アナライザーが示すよう</font><font style="vertical-align: inherit;">
に、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intern（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドの戻り値は</font><font style="vertical-align: inherit;">考慮されません。</font><font style="vertical-align: inherit;">おそらくこれはバグまたは冗長なコードです。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3017パターンが検出されました：（アイテムはBasePotionです）|| </font><font style="vertical-align: inherit;">（（アイテムはBasePotion）&amp;&amp; ...）</font><font style="vertical-align: inherit;">式が過剰であるか、論理エラーが含まれています。</font><font style="vertical-align: inherit;">Cleanup.cs 137</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">IsBuggable</span>(<span class="hljs-params"> Item item </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( item <span class="hljs-keyword">is</span> Fists )
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> ( item <span class="hljs-keyword">is</span> ICommodity || item <span class="hljs-keyword">is</span> Multis.BaseBoat<font></font>
    || item <span class="hljs-keyword">is</span> Fish || item <span class="hljs-keyword">is</span> BigFish<font></font>
    || item <span class="hljs-keyword">is</span> BasePotion || item <span class="hljs-keyword">is</span> Food || item <span class="hljs-keyword">is</span> CookableFood<font></font>
    || item <span class="hljs-keyword">is</span> SpecialFishingNet || item <span class="hljs-keyword">is</span> BaseMagicFish<font></font>
    || item <span class="hljs-keyword">is</span> Shoes || item <span class="hljs-keyword">is</span> Sandals<font></font>
    || item <span class="hljs-keyword">is</span> Boots || item <span class="hljs-keyword">is</span> ThighBoots<font></font>
    || item <span class="hljs-keyword">is</span> TreasureMap || item <span class="hljs-keyword">is</span> MessageInABottle<font></font>
    || item <span class="hljs-keyword">is</span> BaseArmor || item <span class="hljs-keyword">is</span> BaseWeapon<font></font>
    || item <span class="hljs-keyword">is</span> BaseClothing<font></font>
    || ( item <span class="hljs-keyword">is</span> BaseJewel &amp;&amp; Core.AOS )<font></font>
    || ( item <span class="hljs-keyword">is</span> BasePotion &amp;&amp; Core.ML )<font></font>
  {<font></font>
    ....<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
簡略化できる部分式があります。</font><font style="vertical-align: inherit;">より明確になるように書き留めます。</font></font><br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> (item <span class="hljs-keyword">is</span> BasePotion || ( item <span class="hljs-keyword">is</span> BasePotion &amp;&amp; Core.ML ))</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Core.MLにもかかわらず</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
、</font><i><font style="vertical-align: inherit;">itemがBasePotion = to true</font></i><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">あるとすると、</font><font style="vertical-align: inherit;">条件はtrueになり</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">場合は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アイテムがBasePotionがある= falseに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">し、条件が再び値に関係なく、偽である</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Core.ML</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このようなコードはほとんどの場合単純に冗長ですが、プログラマーがミスを犯し、2番目の部分式に間違った変数を書き込んだ場合、状況が悪化します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3031過剰チェックは簡略化できます。</font><font style="vertical-align: inherit;">'||' </font><font style="vertical-align: inherit;">演算子は、反対の式「bPlayerOnly」と「！bPlayerOnly」で囲まれています。</font><font style="vertical-align: inherit;">BaseCreature.cs 3005</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">double</span> <span class="hljs-title">GetFightModeRanking</span>(<span class="hljs-params"> Mobile m,
                                           FightMode acqType,
                                           <span class="hljs-keyword">bool</span> bPlayerOnly </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( ( bPlayerOnly &amp;&amp; m.Player ) ||  !bPlayerOnly )<font></font>
  {<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコードは冗長であるか誤っています。</font><font style="vertical-align: inherit;">彼の問題は '||'の両側にある </font><font style="vertical-align: inherit;">部分表現の意味が異なります。</font><font style="vertical-align: inherit;">このようにカットすると：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> ( m.Player || !bPlayerOnly )</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、何も変更されません。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3001 '||'の左側と右側に同一の部分式 'deed is SmallBrickHouseDeed'があります </font><font style="vertical-align: inherit;">オペレーター。</font><font style="vertical-align: inherit;">RealEstateBroker.cs 132</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">ComputePriceFor</span>(<span class="hljs-params"> HouseDeed deed </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">int</span> price = <span class="hljs-number">0</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> ( deed <span class="hljs-keyword">is</span> SmallBrickHouseDeed ||    <span class="hljs-comment">// &lt;=</span>
       deed <span class="hljs-keyword">is</span> StonePlasterHouseDeed ||<font></font>
       deed <span class="hljs-keyword">is</span> FieldStoneHouseDeed ||<font></font>
       deed <span class="hljs-keyword">is</span> SmallBrickHouseDeed ||    <span class="hljs-comment">// &lt;=</span>
       deed <span class="hljs-keyword">is</span> WoodHouseDeed ||<font></font>
       deed <span class="hljs-keyword">is</span> WoodPlasterHouseDeed ||<font></font>
       deed <span class="hljs-keyword">is</span> ThatchedRoofCottageDeed )<font></font>
      ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで何かを説明したり、次の問題や間違ったコード、冗長なコードを説明したりする価値はないと思います。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3067 'else'ブロックが忘れられたかコメントアウトされ、プログラムの操作ロジックが変更された可能性があります。</font><font style="vertical-align: inherit;">BaseHouse.cs 1558</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SetLockdown</span>(<span class="hljs-params"> Item i, <span class="hljs-keyword">bool</span> locked, <span class="hljs-keyword">bool</span> checkContains </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( m_LockDowns == <span class="hljs-literal">null</span> )
    <span class="hljs-keyword">return</span>;<font></font>
<font></font>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">region</span> Mondain's Legacy</span>
  <span class="hljs-keyword">if</span> ( i <span class="hljs-keyword">is</span> BaseAddonContainer )<font></font>
    i.Movable = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">else</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">endregion</span></span><font></font>
<font></font>
  i.Movable = !locked;<font></font>
  i.IsLockedDown = locked;<font></font>
<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
かなりまれな警告です。</font><font style="vertical-align: inherit;">アナライザーは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃endregion</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ディレクティブの後に疑わしいコードのフォーマットを検出しました</font><i><font style="vertical-align: inherit;">。</font></i><font style="vertical-align: inherit;">コードを読まない場合、それは行のように見えます</font></font><br>
<br>
<pre><code class="cs hljs">i.Movable = !locked;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関係なく、どの場合でも実行されます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">おそらくここでは中括弧が忘れられていました...一般的に、開発者はこのコードをチェックする必要があります。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3043コードの操作ロジックはそのフォーマットに対応していません。</font><font style="vertical-align: inherit;">ステートメントは右にインデントされていますが、常に実行されます。</font><font style="vertical-align: inherit;">中括弧が欠落している可能性があります。</font><font style="vertical-align: inherit;">Earthquake.cs 57</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnCast</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( Core.AOS )<font></font>
  {<font></font>
    damage = m.Hits / <span class="hljs-number">2</span>;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> ( !m.Player )<font></font>
      damage = Math.Max( Math.Min( damage, <span class="hljs-number">100</span> ), <span class="hljs-number">15</span> );<font></font>
      damage += Utility.RandomMinMax( <span class="hljs-number">0</span>, <span class="hljs-number">15</span> );            <span class="hljs-comment">// &lt;=</span><font></font>
<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span><font></font>
  {<font></font>
    ....<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコードでは中括弧が欠落している可能性があります。</font><font style="vertical-align: inherit;">この結論は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if（！M.Player）の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本体にあるコードの奇妙なフォーマットに起因する可能性があります</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3083イベント 'ServerStarted'の安全でない呼び出し、NullReferenceExceptionが発生する可能性があります。</font><font style="vertical-align: inherit;">イベントを呼び出す前に、ローカル変数にイベントを割り当てることを検討してください。</font><font style="vertical-align: inherit;">EventSink.cs 921</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">InvokeServerStarted</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( ServerStarted != <span class="hljs-literal">null</span> )<font></font>
    ServerStarted();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このメソッドは</font><font style="vertical-align: inherit;">、アナライザーが示す</font><font style="vertical-align: inherit;">ように、潜在的に安全でない</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RefreshStarted</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">イベント</font><i><font style="vertical-align: inherit;">ハンドラーの</font></i><font style="vertical-align: inherit;">呼び出しを使用し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
なぜ危険なのですか？この状況を想像してみてください。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerStarted</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">イベントの</font><font style="vertical-align: inherit;">サブスクライバーは1つだけです。また、nullを確認</font><font style="vertical-align: inherit;">してから別のスレッドで</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerStarted（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">イベントハンドラーを直接呼び出すまでの間に</font><font style="vertical-align: inherit;">、このイベントからサブスクリプションが解除されました。これは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をスローし</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この状況を防ぐ最も簡単な方法は、「?.」演算子を使用して安全なイベントコールを提供することです。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">InvokeServerStarted</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  ServerStarted?.Invoke();<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3054安全でない可能性のあるダブルチェックロック。これを回避するには、揮発性変数または同期プリミティブを使用します。 Item.cs 1624</font></font><br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> Packet m_RemovePacket;<font></font>
....<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">object</span> _rpl = <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>();
<span class="hljs-keyword">public</span> Packet RemovePacket<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (m_RemovePacket == <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
      <span class="hljs-keyword">lock</span> (_rpl)<font></font>
      {<font></font>
        <span class="hljs-keyword">if</span> (m_RemovePacket == <span class="hljs-literal">null</span>)<font></font>
        {<font></font>
          m_RemovePacket = <span class="hljs-keyword">new</span> RemoveItem(<span class="hljs-keyword">this</span>);<font></font>
          m_RemovePacket.SetStatic();<font></font>
        }<font></font>
      }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> m_RemovePacket;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザーの警告は、ダブルチェックロックパターンの安全でない使用に関連しています。上記のコードからわかるように、生成パターン-Lonersを実装するためにダブルチェックロックが適用されました。</font><i><font style="vertical-align: inherit;">RemovePacket</font></i><font style="vertical-align: inherit;">プロパティ</font><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">アクセスし</font><font style="vertical-align: inherit;">て</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Packet</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスのインスタンスを取得しようとする</font><font style="vertical-align: inherit;">と、ゲッターは</font><i><font style="vertical-align: inherit;">m_RemovePacket</font></i><font style="vertical-align: inherit;">フィールド</font><font style="vertical-align: inherit;">がゼロに等しい</font><font style="vertical-align: inherit;">かどうかを確認</font><font style="vertical-align: inherit;">します。チェックに合格すると</font><font style="vertical-align: inherit;">、</font><i><font style="vertical-align: inherit;">m_RemovePacket</font></i><font style="vertical-align: inherit;">フィールドが</font><i><font style="vertical-align: inherit;">初期化さ</font></i><font style="vertical-align: inherit;">れる</font><i><font style="vertical-align: inherit;">ロック</font></i><font style="vertical-align: inherit;">ステートメントの本文に入り</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。メインスレッドが</font><font style="vertical-align: inherit;">コンストラクターを介して</font><i><font style="vertical-align: inherit;">m_RemovePacket</font></i><font style="vertical-align: inherit;">変数</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">既に初期化し</font><font style="vertical-align: inherit;">ているが、まだメソッドを呼び出していない</font><font style="vertical-align: inherit;">ときに、興味深い状況が発生します。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SetStatic（）。</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">理論的に</font><font style="vertical-align: inherit;">は、非常に不便な瞬間</font><font style="vertical-align: inherit;">に別のスレッドが</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロパティにアクセスできます</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がゼロに等しいか</font><i><font style="vertical-align: inherit;">どうか</font></i><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">チェックして</font><font style="vertical-align: inherit;">も失敗することはなくなり、呼び出し元のスレッドは、不完全に使用できるオブジェクトへのリンクを受け取ります。この問題を解決するには、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lock</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステートメントの本文に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Packet</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスの中間変数を作成</font><font style="vertical-align: inherit;">し、コンストラクター呼び出しと</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SetStatic（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッド</font><i><font style="vertical-align: inherit;">で</font></i><font style="vertical-align: inherit;">初期化して</font><font style="vertical-align: inherit;">から、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数に割り当てます</font><font style="vertical-align: inherit;">。この場合、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lock</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステートメントの本文は次の</font><font style="vertical-align: inherit;">ようになります。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">lock</span> (_rpl)<font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (m_RemovePacket == <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    Packet instance = <span class="hljs-keyword">new</span> RemoveItem(<span class="hljs-keyword">this</span>);<font></font>
    instance.SetStatic();<font></font>
    m_RemovePacket = instance;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題は修正されたようで、コードは期待どおりに動作します。しかし、これはそうではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もう1つのポイントがあります。アナライザーは、単に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">volatile</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キーワードを使用することを提案するだけではありません</font><font style="vertical-align: inherit;">。プログラムのリリースバージョンでは、コンパイラーは最適化を実行し、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SetStatic（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドへの呼び出しの行を並べ替えて</font><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インスタンス</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数</font><font style="vertical-align: inherit;">を</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールドに</font><font style="vertical-align: inherit;">割り当てる</font><font style="vertical-align: inherit;">ことが</font><i><font style="vertical-align: inherit;">でき</font></i><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">（コンパイラーの観点から、プログラムのセマンティクスには違反しません）。そして再び、開始した同じポイントに戻ります-初期化されていない変数</font><i><font style="vertical-align: inherit;">m_RemovePacket</font></i><font style="vertical-align: inherit;">を取得する可能性</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。この並べ替えがいつ発生するか、またそれが発生するかどうかを正確に述べることは不可能です。CLRのバージョン、使用するプロセッサのアーキテクチャなどの影響を受ける可能性があります。それでも、このようなシナリオから保護する価値はあります。解決策の1つ（ただし、最も生産的ではありません）は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">volatile</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キーワードを使用すること</font><font style="vertical-align: inherit;">です。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">volatile修飾子</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用</font><font style="vertical-align: inherit;">して宣言される変数は</font><font style="vertical-align: inherit;">、コンパイラーによる最適化中に置換の対象にはなりません。最終的に修正されたコードは次のようになります。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> Packet m_RemovePacket;<font></font>
....<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">object</span> _rpl = <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>();
<span class="hljs-keyword">public</span> Packet RemovePacket<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (m_RemovePacket == <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
      <span class="hljs-keyword">lock</span> (_rpl)<font></font>
      {<font></font>
        <span class="hljs-keyword">if</span> (m_RemovePacket == <span class="hljs-literal">null</span>)<font></font>
        {<font></font>
          Packet instance = <span class="hljs-keyword">new</span> RemoveItem(<span class="hljs-keyword">this</span>);<font></font>
          instance.SetStatic();<font></font>
          m_RemovePacket = instance;<font></font>
        }<font></font>
      }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> m_RemovePacket;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">揮発性</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールドへのアクセスのオーバーヘッドが原因で</font><font style="vertical-align: inherit;">
、</font><i><font style="vertical-align: inherit;">揮発性</font></i><font style="vertical-align: inherit;">フィールドの</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">が望ましくない場合があります。このトピックについては詳しく説明しません。検討中の例では、アトミックフィールドレコードは（プロパティが最初にアクセスされたときに）1回だけ必要であることに注意してください。ただし、フィールドを</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">volatile</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">として宣言</font><font style="vertical-align: inherit;">すると、コンパイラはアトミックな読み取りと書き込みを実行します。パフォーマンスの点で最適ではない可能性があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">揮発性</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールドの</font><font style="vertical-align: inherit;">宣言による追加のオーバーヘッドを回避するためにこのアナライザー警告を修正する別のアプローチ</font><font style="vertical-align: inherit;">は</font><font style="vertical-align: inherit;">、</font><i><font style="vertical-align: inherit;">m_RemovePacket</font></i><font style="vertical-align: inherit;">フィールドをバッキングするために</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy &lt;T&gt;タイプ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用する</font><font style="vertical-align: inherit;">こと</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ダブルチェックロックの代わりに。</font><font style="vertical-align: inherit;">この場合、ゲッターの本体は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy &lt;T&gt;</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インスタンスのコンストラクターに渡される初期化メソッドで置き換えることができます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> Lazy&lt;Packet&gt; m_RemovePacket = <span class="hljs-keyword">new</span> Lazy&lt;Packet&gt;(() =&gt;<font></font>
  {<font></font>
    Packet instance = <span class="hljs-keyword">new</span> RemoveItem(<span class="hljs-keyword">this</span>);<font></font>
    instance.SetStatic();<font></font>
    <span class="hljs-keyword">return</span> instance;<font></font>
  }, LazyThreadSafetyMode.ExecutionAndPublication);<font></font>
<font></font>
....<font></font>
<span class="hljs-keyword">public</span> Packet RemovePacket<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">return</span> m_RemovePacket.Value;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
初期化子メソッドは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タイプに初めてアクセスするときに1回呼び出さ</font><font style="vertical-align: inherit;">れ、同時に複数のスレッドからプロパティにアクセスする場合のストリーミングセキュリティは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy &lt;T&gt;タイプ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">によって保証され</font><font style="vertical-align: inherit;">ます（スレッドセーフモードは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンストラクターの2番目のパラメーターによって制御されます</font><font style="vertical-align: inherit;">）。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3131式 'targeted'は、タイプ 'IAxe'との互換性がチェックされますが、 'Item'タイプにキャストされます。</font><font style="vertical-align: inherit;">HarvestTarget.cs 61</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnTarget</span>(<span class="hljs-params"> Mobile <span class="hljs-keyword">from</span>, <span class="hljs-keyword">object</span> targeted </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( m_System <span class="hljs-keyword">is</span> Lumberjacking &amp;&amp;<font></font>
            targeted <span class="hljs-keyword">is</span> IAxe &amp;&amp; m_Tool <span class="hljs-keyword">is</span> BaseAxe )<font></font>
  {<font></font>
    IAxe obj = (IAxe)targeted;<font></font>
    Item item = (Item)targeted;<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アナライザーが報告するように、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ターゲット</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
変数</font><font style="vertical-align: inherit;">はタイプ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IAxe</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に属している</font><font style="vertical-align: inherit;">かどうかが確認さ</font><font style="vertical-align: inherit;">れましたが、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アイテム</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">属している</font><font style="vertical-align: inherit;">かどうかは確認さ</font><font style="vertical-align: inherit;">れてい</font><font style="vertical-align: inherit;">ません。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3070初期化されていない変数「ゼロ」が「m_LastMobile」変数を初期化するときに使用されます。 Serial.cs 29</font></font><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> Serial : IComparable, IComparable&lt;Serial&gt;<font></font>
{<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> m_Serial;<font></font>
<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Serial m_LastMobile = Zero;                <span class="hljs-comment">// &lt;=</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Serial m_LastItem = <span class="hljs-number">0x40000000</span>;<font></font>
<font></font>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Serial LastMobile { .... }
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Serial LastItem { .... }<font></font>
<font></font>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> Serial MinusOne = <span class="hljs-keyword">new</span> Serial( <span class="hljs-number">-1</span> );
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> Serial Zero = <span class="hljs-keyword">new</span> Serial( <span class="hljs-number">0</span> );     <span class="hljs-comment">// &lt;=</span><font></font>
  ....<font></font>
  <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">Serial</span>(<span class="hljs-params"> <span class="hljs-keyword">int</span> serial </span>)</span><font></font>
  {<font></font>
    m_Serial = serial;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのため、ここで間違いはありませんが、これを書くのはあまり良くありません。</font><font style="vertical-align: inherit;">初期化されていない</font><i><font style="vertical-align: inherit;">Zeroの</font></i><font style="vertical-align: inherit;">値</font><font style="vertical-align: inherit;">に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_LastMobileを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">割り当てるため</font><font style="vertical-align: inherit;">、デフォルトのコンストラクター</font><i><font style="vertical-align: inherit;">Serial（）</font></i><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">構造が作成され、</font><i><font style="vertical-align: inherit;">m_Serial = 0が</font></i><font style="vertical-align: inherit;">初期化されます</font><font style="vertical-align: inherit;">。そして、これは</font><i><font style="vertical-align: inherit;">新しいSerial（0）</font></i><font style="vertical-align: inherit;">を呼び出すことと同じ</font><font style="vertical-align: inherit;">です。実際、開発者は、</font><i><font style="vertical-align: inherit;">serial</font></i><font style="vertical-align: inherit;">が</font><i><font style="vertical-align: inherit;">0</font></i><font style="vertical-align: inherit;">である</font><font style="vertical-align: inherit;">ことを</font><font style="vertical-align: inherit;">幸運</font><font style="vertical-align: inherit;">に思っています。他の値があった場合、エラーが発生します。</font><b><font style="vertical-align: inherit;">PVS-Studio警告：</font></b><font style="vertical-align: inherit;"> V3063評価される場合、条件式の一部は常にtrueです：m_Serial &lt;= 0x7FFFFFFF。 Serial.cs 83</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> IsItem<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">return</span> ( m_Serial &gt;= <span class="hljs-number">0x40000000</span> &amp;&amp; m_Serial &lt;= <span class="hljs-number">0x7FFFFFFF</span> );<font></font>
  }<font></font>
}</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x7FFFFFFF</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Int32に</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">含めることができる最大値です</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">したがって、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_Serial</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数の値がどのようなものであっ</font><font style="vertical-align: inherit;">ても、いずれの場合も</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x7FFFFFFF</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下になり</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3004「then」ステートメントは「else」ステートメントと同等です。</font><font style="vertical-align: inherit;">Serialization.cs 1571</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteDeltaTime</span>(<span class="hljs-params"> DateTime <span class="hljs-keyword">value</span> </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">try</span> <font></font>
  { <font></font>
    d = <span class="hljs-keyword">new</span> TimeSpan( ticks-now ); <font></font>
  }<font></font>
  <span class="hljs-keyword">catch</span> <font></font>
  {<font></font>
    <span class="hljs-keyword">if</span>( ticks &lt; now ) <font></font>
      d = TimeSpan.MaxValue; <font></font>
    <span class="hljs-keyword">else</span> <font></font>
      d = TimeSpan.MaxValue;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザーは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ifステートメントの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> trueブランチとfalseブランチが</font><font style="vertical-align: inherit;">完全に一致</font><font style="vertical-align: inherit;">する疑わしいコードについて警告し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">おそらく、ブランチの1つに</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TimeSpan.MinValue</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が必要</font><i><font style="vertical-align: inherit;">です。</font></i><font style="vertical-align: inherit;">同じコードがいくつかの場所で見つかりました：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V3004 'then'ステートメントは 'else'ステートメントと同等です。</font><font style="vertical-align: inherit;">Item.cs 2103</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Serialize</span>(<span class="hljs-params"> GenericWriter writer </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <font></font>
  <span class="hljs-keyword">if</span>( ticks &lt; now ) <font></font>
    d = TimeSpan.MaxValue; <font></font>
  <span class="hljs-keyword">else</span> <font></font>
    d = TimeSpan.MaxValue;<font></font>
  <font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V3004「then」ステートメントは「else」ステートメントと同等です。</font><font style="vertical-align: inherit;">Serialization.cs 383</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteDeltaTime</span>(<span class="hljs-params"> DateTime <span class="hljs-keyword">value</span> </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <font></font>
  <span class="hljs-keyword">if</span>( ticks &lt; now ) <font></font>
    d = TimeSpan.MaxValue; <font></font>
  <span class="hljs-keyword">else</span> <font></font>
    d = TimeSpan.MaxValue;<font></font>
  <font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
理由として「これ」を使用しました。とりわけ、コピーアンドペーストなしでは実行できなかった可能性が非常に高く、これらのコードフラグメントは非常に苦痛に見えます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告PVS-Studio：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3051過剰な型キャスト。</font><font style="vertical-align: inherit;">オブジェクトは既に「アイテム」タイプです。</font><font style="vertical-align: inherit;">Mobile.cs 11237</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> Item Talisman<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">return</span> FindItemOnLayer( Layer.Talisman ) <span class="hljs-keyword">as</span> Item;<font></font>
  }<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> Item <span class="hljs-title">FindItemOnLayer</span>(<span class="hljs-params"> Layer layer </span>)</span><font></font>
{<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このアナライザの警告は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">演算子を過度に使用した場合に取得できます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">コードのこのセクションにはエラーはありませんが、オブジェクトを独自の型にキャストしても意味がありません。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告</font><b><font style="vertical-align: inherit;">：</font></b><font style="vertical-align: inherit;"> V3148「toSet」の潜在的な「null」値を値型にキャストすると、NullReferenceExceptionが発生する可能性があります。</font><font style="vertical-align: inherit;">Properties.cs 502</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">string</span> <span class="hljs-title">ConstructFromString</span>(<span class="hljs-params"> .... </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">object</span> toSet;
  <span class="hljs-keyword">bool</span> isSerial = IsSerial( type );<font></font>
<font></font>
  <span class="hljs-keyword">if</span> ( isSerial ) <span class="hljs-comment">// mutate into int32</span>
    type = m_NumericTypes[<span class="hljs-number">4</span>];<font></font>
<font></font>
  ....<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">value</span> == <span class="hljs-literal">null</span> )<font></font>
  {<font></font>
    toSet = <span class="hljs-literal">null</span>;<font></font>
  }<font></font>
  ....<font></font>
<font></font>
  <span class="hljs-keyword">if</span> ( isSerial ) <span class="hljs-comment">// mutate back</span><font></font>
    toSet = (Serial)((Int32)toSet);<font></font>
<font></font>
  constructed = toSet;<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコードセクションで</font><font style="vertical-align: inherit;">は</font><font style="vertical-align: inherit;">、変数の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nullの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合に注目し</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">その後、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toSet</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数</font><font style="vertical-align: inherit;">も</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nullになります</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">さらに、変数が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">isSerial == trueの場合</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toSet</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Int32</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><i><font style="vertical-align: inherit;">キャストさ</font></i><font style="vertical-align: inherit;">れ</font><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NREになり</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコードを修正するには、たとえば、デフォルトで0を追加します。</font></font><br>
<br>
<pre><code class="cs hljs">toSet = (Serial)((Int32)(toSet ?? <span class="hljs-number">0</span>));</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3031過剰なチェックは簡略化できます。</font><font style="vertical-align: inherit;">'||' </font><font style="vertical-align: inherit;">演算子は、反対の式「pack == null」と「pack！= null」で囲まれています。</font><font style="vertical-align: inherit;">BODBuyGump.cs 64</font></font><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnResponse</span>(<span class="hljs-params">Server.Network.NetState sender, RelayInfo info</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> ( (pack == <span class="hljs-literal">null</span>) ||<font></font>
       ((pack != <span class="hljs-literal">null</span>) &amp;&amp;<font></font>
        (!pack.CheckHold(<font></font>
                m_From,<font></font>
                item,<font></font>
                <span class="hljs-literal">true</span>,
                <span class="hljs-literal">true</span>,
                <span class="hljs-number">0</span>,<font></font>
                item.PileWeight + item.TotalWeight)) ) )<font></font>
  {<font></font>
    pv.SayTo(m_From, <span class="hljs-number">503204</span>);<font></font>
    m_From.SendGump(<span class="hljs-keyword">new</span> BOBGump(m_From, m_Book, m_Page, <span class="hljs-literal">null</span>));<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザーが報告するように、このコードは簡略化できます。 </font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> ((pack == <span class="hljs-literal">null</span>) || ((pack != <span class="hljs-literal">null</span>) &amp;&amp; (!pack.CheckHold(....))))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
演算子 '||'の左側と右側 </font><font style="vertical-align: inherit;">意味が逆の表現があります。</font><font style="vertical-align: inherit;">ここでは、check </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pack！= Null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は冗長です。これより前は、反対の条件</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pack == nullが</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チェックされ</font><font style="vertical-align: inherit;">、これらの式は演算子 '||'で区切られているためです。</font><font style="vertical-align: inherit;">この行は次のように短縮できます。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> (pack == <span class="hljs-literal">null</span> || !pack.CheckHold(....))</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3080ヌル逆参照の可能性があります。</font><font style="vertical-align: inherit;">「勝者」を調べることを検討してください。</font><font style="vertical-align: inherit;">CTF.cs 1302</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Finish_Callback</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  ....<font></font>
  CTFTeamInfo winner = ( teams.Count &gt; <span class="hljs-number">0</span> ? teams[<span class="hljs-number">0</span>] : <span class="hljs-literal">null</span> );<font></font>
<font></font>
  .... <font></font>
<font></font>
  m_Context.Finish( m_Context.Participants[winner.TeamID] <span class="hljs-keyword">as</span> Participant );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">teams.Count</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0である</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
とし</font><i><font style="vertical-align: inherit;">ましょ</font></i><font style="vertical-align: inherit;">う</font><font style="vertical-align: inherit;">。その後、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">勝者= null。</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さらに、コードでは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">winner.TeamID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロパティは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をチェックせず</font><font style="vertical-align: inherit;">にアクセスされるため、null参照によるアクセスになります。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3041式は「int」型から「double」型に暗黙的にキャストされました。小数部の損失を回避するために、明示的な型キャストを利用することを検討してください。例：double A =（double）（X）/ Y;。 StormsEye.cs 87</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Gain</span>(<span class="hljs-params"> Mobile <span class="hljs-keyword">from</span>, Skill skill </span>)</span> <font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">from</span>.Player &amp;&amp; <font></font>
     ( skills.Total / skills.Cap ) &gt;= Utility.RandomDouble())<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコードは、変数分割の操作含ま</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">skills.Total</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">skills.Cap</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">型のもので、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INTを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、その結果が、次に、暗黙的型に変換された</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">二重</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析レポートとして、。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3085ネストされたタイプの 'typeofObject'フィールドの名前があいまいです。外側の型には、同じ名前の静的フィールドが含まれています。 PropsGump.cs 744</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Type typeofObject = <span class="hljs-keyword">typeof</span>( <span class="hljs-keyword">object</span> );<font></font>
....<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title">GroupComparer</span> : <span class="hljs-title">IComparer</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Type typeofObject = <span class="hljs-keyword">typeof</span>( Object );<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typeofObject</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、ネストされたクラスのこのコードセクションで作成されました</font><font style="vertical-align: inherit;">。その問題は、外部クラスに同じ名前の変数があり、これが原因でエラーが発生する可能性があることです。不注意によるそのようなエラーの可能性を減らすために、これを許可しないことをお勧めします。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3140プロパティアクセサーは異なるバッキングフィールドを使用しています。 WallBanner.cs 77</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> m_IsRewardItem;<font></font>
<font></font>
[<span class="hljs-meta">CommandProperty( AccessLevel.GameMaster )</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> IsRewardItem<font></font>
{<font></font>
  <span class="hljs-keyword">get</span>{ <span class="hljs-keyword">return</span> m_IsRewardItem; }
  <span class="hljs-keyword">set</span>{ m_IsRewardItem = <span class="hljs-keyword">value</span>; InvalidateProperties(); }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> m_East;<font></font>
<font></font>
[<span class="hljs-meta">CommandProperty( AccessLevel.GameMaster )</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> East<font></font>
{<font></font>
  <span class="hljs-keyword">get</span>{ <span class="hljs-keyword">return</span> m_East; }
  <span class="hljs-keyword">set</span>{ m_IsRewardItem = <span class="hljs-keyword">value</span>; InvalidateProperties(); }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、ここにコピーペーストのために発生した間違いがあります。</font><i><font style="vertical-align: inherit;">East</font></i><font style="vertical-align: inherit;">プロパティ</font><font style="vertical-align: inherit;">の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アクセスメソッドは、</font><i><font style="vertical-align: inherit;">m_IsRewardItem</font></i><font style="vertical-align: inherit;">ではなく</font><i><font style="vertical-align: inherit;">m_Eastに</font></i><font style="vertical-align: inherit;">値を割り当てること</font><i><font style="vertical-align: inherit;">でした</font></i><font style="vertical-align: inherit;">。</font><b><font style="vertical-align: inherit;">PVS-Studio</font></b><font style="vertical-align: inherit;"> 
警告</font><b><font style="vertical-align: inherit;">：</font></b><font style="vertical-align: inherit;"> V3012「？：」演算子は、その条件式に関係なく、常に1つの同じ値0xe7fを返します。 TreasureChestLevel2.cs 52 </font><font style="vertical-align: inherit;">
V3012「？：」演算子は、その条件式に関係なく、常に1つの同じ値0xe77を返します。 TreasureChestLevel2.cs 57</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b> <br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SetChestAppearance</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">bool</span> UseFirstItemId = Utility.RandomBool();<font></font>
<font></font>
  <span class="hljs-keyword">switch</span>( Utility.RandomList( <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span> ) )<font></font>
  {<font></font>
    ....<font></font>
    <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:<span class="hljs-comment">// Keg</span>
      <span class="hljs-keyword">this</span>.ItemID = ( UseFirstItemId ? <span class="hljs-number">0xe7f</span> : <span class="hljs-number">0xe7f</span> );
      <span class="hljs-keyword">this</span>.GumpID = <span class="hljs-number">0x3e</span>;
      <span class="hljs-keyword">break</span>;<font></font>
<font></font>
    <span class="hljs-keyword">case</span> <span class="hljs-number">7</span>:<span class="hljs-comment">// Barrel</span>
      <span class="hljs-keyword">this</span>.ItemID = ( UseFirstItemId ? <span class="hljs-number">0xe77</span> : <span class="hljs-number">0xe77</span> );
      <span class="hljs-keyword">this</span>.GumpID = <span class="hljs-number">0x3e</span>;
      <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ある種の選択の幻想:) </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UseFirstItemId</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の値に関係なく</font><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this.ItemID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font><font style="vertical-align: inherit;">最初のケースでは</font><i><font style="vertical-align: inherit;">0xe7f</font></i><font style="vertical-align: inherit;">、2番目の</font><font style="vertical-align: inherit;">ケースでは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xe77の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いずれかになります</font><font style="vertical-align: inherit;">。</font><b><font style="vertical-align: inherit;">警告PVS-Studio：</font></b><font style="vertical-align: inherit;"> V3066「OnSwing」メソッドに渡される引数の順序が誤っている可能性があります：「defender」と「attacker」。</font><font style="vertical-align: inherit;">BaseWeapon.cs 1188</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">int</span> <span class="hljs-title">AbsorbDamageAOS</span>(<span class="hljs-params"> Mobile attacker,
                                    Mobile defender,
                                    <span class="hljs-keyword">int</span> damage </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> ( weapon != <span class="hljs-literal">null</span> )<font></font>
  {<font></font>
    defender.FixedParticles(<span class="hljs-number">0x3779</span>,
                            <span class="hljs-number">1</span>,
                            <span class="hljs-number">15</span>,
                            <span class="hljs-number">0x158B</span>,
                            <span class="hljs-number">0x0</span>,
                            <span class="hljs-number">0x3</span>,<font></font>
                            EffectLayer.Waist);<font></font>
    weapon.OnSwing( defender, attacker );<font></font>
  }<font></font>
  ....<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> TimeSpan <span class="hljs-title">OnSwing</span>(<span class="hljs-params"> Mobile attacker, Mobile defender </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">return</span> OnSwing( attacker, defender, <span class="hljs-number">1.0</span> );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OnSwing（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
メソッドに</font><font style="vertical-align: inherit;">引数が逆の順序で渡さ</font><font style="vertical-align: inherit;">れたことがアナライザーに疑わしいよう</font><font style="vertical-align: inherit;">でした。</font><font style="vertical-align: inherit;">おそらくこれはエラーが原因です。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3092範囲の交差は条件式内で可能です。</font><font style="vertical-align: inherit;">例：if（A&gt; 0 &amp;&amp; A &lt;5）{...} else if（A&gt; 3 &amp;&amp; A &lt;9）{...}。</font><font style="vertical-align: inherit;">HouseFoundation.cs 1883</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">IsFixture</span>(<span class="hljs-params"> <span class="hljs-keyword">int</span> itemID </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( itemID &gt;= <span class="hljs-number">0x319C</span> &amp;&amp; itemID &lt; <span class="hljs-number">0x31B0</span> ) 
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  <span class="hljs-comment">// ML doors</span>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( itemID == <span class="hljs-number">0x2D46</span> ||<font></font>
           itemID == <span class="hljs-number">0x2D48</span> ||<font></font>
           itemID == <span class="hljs-number">0x2FE2</span> ||<font></font>
           itemID == <span class="hljs-number">0x2FE4</span> )
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( itemID &gt;= <span class="hljs-number">0x2D63</span> &amp;&amp; itemID &lt; <span class="hljs-number">0x2D70</span> )
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( itemID &gt;= <span class="hljs-number">0x319C</span> &amp;&amp; itemID &lt; <span class="hljs-number">0x31AF</span> ) 
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
条件下でテストされた範囲は交差します。</font><font style="vertical-align: inherit;">これはアナライザーにとって疑わしいように見えました。</font><font style="vertical-align: inherit;">このコードが正しく機能しても、修正する価値はあります。</font><font style="vertical-align: inherit;">我々は最後のボディを書き換えるために必要な状況を想像し</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">た場合に</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件が真の場合メソッドが返す、そのように</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虚偽を</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itemIDが</font></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x319C</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と等しい</font><font style="vertical-align: inherit;">場合</font><font style="vertical-align: inherit;">でも、メソッドは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trueを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返し</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これにより、エラーを検索する時間が失われます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RunUOはずっと前に作成され、多くの作業が行われましたが、このプロジェクトの例を使用すると、履歴のあるプロジェクトで静的分析を使用する利点を確認できます。</font><font style="vertical-align: inherit;">543.4万行のプロジェクトコードのアナライザーは、約500の警告（</font><font style="vertical-align: inherit;">低</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レベル</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は含まない）を</font><font style="vertical-align: inherit;">発行</font><font style="vertical-align: inherit;">しましたが、それらのほとんどは、統一性のために記事には表示されませんでした。</font><font style="vertical-align: inherit;">分析の結果をより詳しく知るために、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オープンソースプロジェクトに</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><u><font style="vertical-align: inherit;">無料のライセンスを</font></u></a><font style="vertical-align: inherit;">使用することをお勧めし</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><u><font style="vertical-align: inherit;">ます</font></u></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/c78/30f/70c/c7830f70c5577c3d6704f254d7cad6a3.png" align="left"></a></p><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事を英語を話す視聴者と共有したい場合は、翻訳へのリンクを使用してください：Ekaterina Nikiforova。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-StudioアナライザーによるRunUOチェック</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja487092/index.html">ERPシステム実装プロジェクトの一部としてのビジネスプロセスのモデリング</a></li>
<li><a href="../ja487094/index.html">Kafkaから受け取った再処理イベント</a></li>
<li><a href="../ja487096/index.html">切れ端。ドキュメンテーションでの作業プロセスを簡単にする方法</a></li>
<li><a href="../ja487098/index.html">アリで描く：アリのコロニー最適化アルゴリズムを使用した手続き型画像</a></li>
<li><a href="../ja487100/index.html">最先端の不変のデータ構造</a></li>
<li><a href="../ja487108/index.html">モバイルゲーマープロフィール：MyTracker Research</a></li>
<li><a href="../ja487110/index.html">Slurm SRE。Booking.comとGoogle.comの専門家による完全な実験</a></li>
<li><a href="../ja487112/index.html">Edge of Madness：The Basic Circle</a></li>
<li><a href="../ja487116/index.html">DiscordがGo to Rustから移行する理由</a></li>
<li><a href="../ja487118/index.html">Loki-Prometheusアプローチを使用したログの収集</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>