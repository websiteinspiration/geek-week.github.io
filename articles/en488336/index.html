<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ûø üî≤ üôé Tips for Using the Wave Function Collapse Algorithm üî∏ üçá üöµ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, I have experimented a lot with procedural constraint-based generation. In particular, with the Wave Function Collapse algorithm (WFC, wave f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Tips for Using the Wave Function Collapse Algorithm</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488336/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f2f/556/757/f2f556757da50dae74a44909dca1e76d.png" alt="image"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recently, I have experimented a lot with procedural constraint-based generation. In particular, with the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wave Function Collapse</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> algorithm </font><font style="vertical-align: inherit;">(WFC, wave function collapse). I even wrote my own </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">open source library</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unity asset</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WFC is a very flexible algorithm, especially with the improvements I developed. But at the same time, I found it difficult to create </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">practical</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> levels applicable to computer games </font><font style="vertical-align: inherit;">with its help </font><font style="vertical-align: inherit;">. The main difficulty is that the WFC does not have any global structure. All he does is make the output generation look locally similar to the input, for example, by looking at individual small rectangles of the output.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this article I will tell you what I learned and what will be able to raise generators based on restrictions to a new level.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The basics</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It‚Äôs hard to use WFC if you don‚Äôt know how it works. This is a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">constraint-based</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> procedural generation algorithm </font><font style="vertical-align: inherit;">that has been given much attention recently. In fact, it has practically nothing to do with the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">concept of quantum physics</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in whose honor it was named. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WFC is easy to configure - you just give the algorithm an example card, after which it generates new cards that </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">look</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> like the original card due to the repeated use of its small fragments. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It has two types - with a neighboring arrangement or with an overlay of elements. It can be done in 2D or 3D, and even on grids of </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hexagons</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uneven</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">grids. </font><font style="vertical-align: inherit;">Most of my tips apply regardless of how you use the algorithm. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I suggest you play with </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this demo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to get an idea about the algorithm, and read </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this introduction</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">translation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> on Habr√©] if you are interested in technical details.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tileset design</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The WFC algorithm is tile-based. </font><font style="vertical-align: inherit;">In this sense, its quality depends on the tiles that you transfer to it for work. </font><font style="vertical-align: inherit;">I am not an artist, so I can help little in drawing beautiful tilesets (although you can </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">see here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), but a good tileset also requires technical knowledge.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Marching cubes</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Marching cubes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is an algorithm that selects which tiles to set depending on whether each vertex of the tile is full or empty. </font><font style="vertical-align: inherit;">Here is the list of tiles used for 2D.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/404/214/092/404214092cf2f31e96b3b6f2a267c622.svg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you build tiles so that the black and white corners always match, then the red lines will always connect correctly. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here we don‚Äôt need an understanding of the whole algorithm, but it should be noted that the idea of ‚Äã‚Äãdesigning tiles with only their behavior in the corners is a very powerful technique. </font><font style="vertical-align: inherit;">It is used in many of the best tilesets, as it ensures that tiles always connect well.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This technique is especially powerful for WFC. </font><font style="vertical-align: inherit;">It happened, because if you miss a few tiles, WFC it will not matter. </font><font style="vertical-align: inherit;">He will circumvent this problem and will never create configurations that require missing tiles. </font><font style="vertical-align: inherit;">This is very convenient for 3D, since there are dozens of potential tiles, and some of them are required only in very difficult situations. </font><font style="vertical-align: inherit;">See the ‚ÄúFoundation‚Äù section below, in which I use this trick even more widely. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Knowing </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">other tile patterns</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> may also be helpful </font><font style="vertical-align: inherit;">, but Marching Cubes is the best.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The rooms</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sometimes it‚Äôs easiest to work with simple tilesets. </font><font style="vertical-align: inherit;">This combination of 4 tiles (one tile is empty) easily generates square rooms.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dd0/bbb/376/dd0bbb3765876baac62417e760149058.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e76/245/14b/e7624514b5103da9afa5e4be2fce86c3.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The size of rooms can easily be changed by changing the weight of each tile. </font><font style="vertical-align: inherit;">After adding the door and corridor tiles, you can create the diversity that is characteristic of people‚Äôs floor plans.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foundation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When working with WFC, it‚Äôs interesting to experiment with tilesets. </font><font style="vertical-align: inherit;">If you simply put a tile, WFC seeks to squeeze the most out of the remaining space. </font><font style="vertical-align: inherit;">Sometimes this leads to radically different results, as can be seen in the image of Maxim Gumin:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a4f/980/7b9/a4f9807b976fa295e85b9ae0d36d3918.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We can use this behavior to stimulate WFC to generate many recognizable structures. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here's an example of a castle (inspired by </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@greentecq</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br>
<br>
<div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-0" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="1183359478734958593"></twitter-widget>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In it, I used the following tileset:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c0b/852/df1/c0b852df1c18974c8114d48d3b7f3290.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
These tiles have an important property - all the tiles at the base have a width no less than at the top. </font><font style="vertical-align: inherit;">This means that it is not possible to build these tiles in an unsupported manner. </font><font style="vertical-align: inherit;">The WFC immediately responds to this and creates buildings with a good foundation.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fractal Split Approximation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Studying the topic of stimulating certain behaviors by choosing the appropriate tileset, I found that if the tileset consists of straight roads and branches, but without corners, then you can get a good approximation of the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recursive splitting</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (without the ‚Äúrecursive‚Äù part). </font><font style="vertical-align: inherit;">This is pretty good for grid levels.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Big tiles</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can add WFC to support tiles that are several times larger than a regular tile. For example, this is supported in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my Tessera addon</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Large tiles can be used in various ways. Since they extend beyond the boundaries of the grid, you can use them to add smoother and wider curves than is usually possible when snapping to the grid. They are also great for elements from a large number of tiles, or simply to mask that the generation is based on tiles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here's an example to learn from </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Oscar Stalberg</font></a><font style="vertical-align: inherit;"> from the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bad North</font></font></a> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> game </font><font style="vertical-align: inherit;">. Oscar demonstrates how he used large tiles to add smoothly curving coasts, large houses, and cliff variability.</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-1" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="1131228226901172226"></twitter-widget>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Limitations</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At its core, WFC is a constraint based algorithm. </font><font style="vertical-align: inherit;">This means that he seeks to generate levels that correspond to a specific set of criteria. </font><font style="vertical-align: inherit;">In pure WFC, there is only one criterion - that the levels look locally like a sample input. </font><font style="vertical-align: inherit;">Below, I‚Äôll talk about WFC enhancements to add new types of restrictions.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fixed tiles</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is very easy to fix individual tiles before generating a level in WFC. </font><font style="vertical-align: inherit;">Later they seamlessly integrate with the generated level.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1f0/df3/619/1f0df3619f947a7a71e72b389bc38e15.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Before generation</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/93f/2c2/5be/93f2c25be4b716f62fa16b0b67c36a5b.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After Generation</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
This technique can be used in many different ways. </font><font style="vertical-align: inherit;">Here are some ideas:</font></font><br>
<br>
<ul>
<li>      </li>
<li>  - ,   WFC    .</li>
<li>    ,    </li>
<li> /    WFC   </li>
</ul><br>
<br>
<h3> </h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Limitation paths</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Path constraint) - this is my own contribution to the WFC. This is an extremely powerful technique, but a complete article will most likely require a separate article. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This restriction </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">globally</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> scans all generated output, and forcibly indicates that a path must pass between the marked tiles. Or in other words, it tells a subset of tiles to form a single </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">component of the graph</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Due to its global nature, it complements the usual WFC behavior, which takes into account only local tiles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I found out that adding this restriction strongly affects the appearance of the generated level. Without it, WFC often generates several divided rooms or areas that look unrealistic and not created by humans.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b88/353/c19/b88353c19a3ebc27db979150a3c30af2.png"></div><br>
<i>   </i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a91/928/346/a919283460b31c6c8b901609d9490ede.png"></div><br>
<i>   .       .</i><br>
<br>
<h3>   </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another situation where path limitation is appropriate is ... drawing paths. By default, path restriction only ensures </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that there is a</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> route between tiles. It does not guarantee that the path will be as simple as possible. Therefore, in the case of rivers and roads, he often draws T-shaped joints in optional places. The trick is to either simply remove all the tiles of the T-joints, or give them a very low weight, so that they are selected only in case of emergency. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I love using fixed tiles to fix the endpoints of a path. Because of this, the path restriction is required to insert tiles that make the rest of the path connect.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aa0/448/f77/aa0448f778179d53dd4b9236fc33aa17.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The paths generated by fixing all four corners as the end points of the paths</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
If you want to experiment with paths, then I have a small javascript demo that is laid out </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diversity</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alternative Tiles</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is very easy to add tile options to the WFC algorithm. </font><font style="vertical-align: inherit;">Just add the tiles to the list of possible tiles, making it have the same connections as the tile that it replaces. </font><font style="vertical-align: inherit;">Or it can be done at the post-processing stage, as is usually done in other styles of procedural generation.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3d7/b6c/43a/3d7b6c43a0be6522b6a2eac5d85dbd69.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Two wall tiles, one of them with a window. </font><font style="vertical-align: inherit;">They are completely interchangeable and simply add variability to the design.</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tile variability by level</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you put a lot of effort into creating a tile set design, you will notice that the randomness of WFC begins to harm him. </font><font style="vertical-align: inherit;">It uses the entire tileset, that is, you can get a level with mixed lava, snow and desert. </font><font style="vertical-align: inherit;">Often this looks completely illogical. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can restore integrity in a simple way: decide in advance which </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">biome the</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> level will belong to, and then disable all tiles that are not suitable for this biome. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bad North</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (again) is an excellent example of this. </font><font style="vertical-align: inherit;">In some levels, rocks are completely forbidden, in others there is a lot of vegetation, in the third ruins and cemeteries are added. </font><font style="vertical-align: inherit;">This gives each level a unique style without the need for a significant change in the generation style.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f2f/556/757/f2f556757da50dae74a44909dca1e76d.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Only about 10% of the islands have elements of caves, visible in the upper right corner.</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Variability of tiles within the map</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mixing tilesets can go even further. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you use WFC to generate a large card, then it starts to look very uniform. </font><font style="vertical-align: inherit;">This is another consequence of the fact that the algorithm is a solver of </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">local</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> constraints. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The best solution to this problem I saw in the game </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caves of Qud</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">In the developers' story about the generation ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), they say that they split the map into different areas, and then start WFC with separate parameters for the subsets of the map. </font><font style="vertical-align: inherit;">This means that on the map there may be an area of ‚Äã‚Äãruins and an area of ‚Äã‚Äãa city in which completely different templates and tiles are used.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1b9/45f/762/1b945f762795751a1e66eaa0712110ab.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Example from </font></font><em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Math for Game Developers: Tile-Based Map Generation using Wave Function Collapse in 'Caves of Qud'</font></font></a></em><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The WFC algorithm, like all constraint-based generation techniques, has the principle of being </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">careful with your desires</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">It is easy to customize and get beautiful looking results, but it can be very difficult to implement the specific details that are needed for your game. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I hope the techniques presented by me will help you tame this monster, but in the end, it is best to create a game design based on the strengths of procedural generation, and not try to force it to create too much for you. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I recommend you play </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bad North</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caves of Qud</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Both games are great examples of using WFC in real conditions, and the developers have well thought out the optimal use of the algorithm in their games.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en488322/index.html">Gestures</a></li>
<li><a href="../en488324/index.html">Console ghost. Panasonic M2</a></li>
<li><a href="../en488326/index.html">Love or dismissal</a></li>
<li><a href="../en488330/index.html">English with George Karlin: we analyze the ingenious stand-up about phraseological units</a></li>
<li><a href="../en488332/index.html">Zero, one, two, Freddy will pick you up</a></li>
<li><a href="../en488338/index.html">Google Internships: Zurich, London, and Silicon Valley</a></li>
<li><a href="../en488340/index.html">Profession: Backend Developer</a></li>
<li><a href="../en488342/index.html">Random Forest, the method of principal components and optimization of hyperparameters: an example of solving the classification problem in Python</a></li>
<li><a href="../en488346/index.html">Installing or-tools with SCIP and GLPK in a Python 3.7 virtual environment on Linux</a></li>
<li><a href="../en488348/index.html">Webinar ‚ÄúTen Top Agile Challenges and Ways to Overcome Them in an Hour‚Äù February 17 at 20:00 Moscow time</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>