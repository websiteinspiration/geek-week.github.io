<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💆 ℹ️ 💻 Erstellen von Python-Bindungen für C / C ++ - Bibliotheken mit SIP. Teil 2 ⚜️ 🗓️ 😄</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Im ersten Teil des Artikels haben wir die Grundlagen der Arbeit mit dem SIP-Dienstprogramm zum Erstellen von Python-Bindungen für in C und C ++ geschr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Erstellen von Python-Bindungen für C / C ++ - Bibliotheken mit SIP. Teil 2</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495636/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ersten Teil des</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Artikels haben wir die Grundlagen der Arbeit mit dem SIP-Dienstprogramm zum Erstellen von Python-Bindungen für in C und C ++ geschriebene Bibliotheken untersucht. </font><font style="vertical-align: inherit;">Wir haben uns die Basisdateien angesehen, die Sie für die Arbeit mit SIP erstellen müssen, und haben uns mit Direktiven und Anmerkungen befasst. </font><font style="vertical-align: inherit;">Bisher haben wir die Bindung für eine in C geschriebene einfache Bibliothek durchgeführt. In diesem Teil werden wir herausfinden, wie die Bindung für eine C ++ - Bibliothek durchgeführt wird, die Klassen enthält. </font><font style="vertical-align: inherit;">Am Beispiel dieser Bibliothek werden wir sehen, welche Techniken bei der Arbeit mit einer objektorientierten Bibliothek nützlich sein können, und gleichzeitig werden wir uns mit neuen Anweisungen und Anmerkungen für uns befassen.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alle Beispiele für den Artikel finden Sie im Github-Repository unter: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/Jenyay/sip-examples</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstellen einer Bindung für eine Bibliothek in C ++</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das folgende Beispiel, das wir betrachten werden, befindet sich im Ordner </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_cpp_01</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erstellen Sie zunächst eine Bibliothek, für die wir die Bindung durchführen. </font><font style="vertical-align: inherit;">Die Bibliothek befindet sich weiterhin im Ordner </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und enthält eine Klasse - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Die Header-Datei </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo.h</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mit der Deklaration dieser Klasse lautet wie folgt:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> FOO_LIB</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FOO_LIB</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Foo</span> {</span>
    <span class="hljs-keyword">private</span>:
        <span class="hljs-keyword">int</span> _int_val;
        <span class="hljs-keyword">char</span>* _string_val;
    <span class="hljs-keyword">public</span>:<font></font>
        Foo(<span class="hljs-keyword">int</span> int_val, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* string_val);
        <span class="hljs-keyword">virtual</span> ~Foo();<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_int_val</span><span class="hljs-params">(<span class="hljs-keyword">int</span> val)</span></span>;
        <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">get_int_val</span><span class="hljs-params">()</span></span>;<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_string_val</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* val)</span></span>;
        <span class="hljs-function"><span class="hljs-keyword">char</span>* <span class="hljs-title">get_string_val</span><span class="hljs-params">()</span></span>;<font></font>
};<font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist eine einfache Klasse mit zwei Gettern und Setzern, die Werte vom Typ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> setzt und zurückgibt </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Die Implementierung der Klasse ist wie folgt:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"foo.h"</span></span><font></font>
<font></font>
Foo::Foo(<span class="hljs-keyword">int</span> int_val, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* string_val): _int_val(int_val) {<font></font>
    _string_val = <span class="hljs-literal">nullptr</span>;<font></font>
    set_string_val(string_val);<font></font>
}<font></font>
<font></font>
Foo::~Foo(){<font></font>
    <span class="hljs-keyword">delete</span>[] _string_val;<font></font>
    _string_val = <span class="hljs-literal">nullptr</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Foo::set_int_val</span><span class="hljs-params">(<span class="hljs-keyword">int</span> val)</span> </span>{<font></font>
    _int_val = val;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Foo::get_int_val</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> _int_val;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Foo::set_string_val</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* val)</span> </span>{
    <span class="hljs-keyword">if</span> (_string_val != <span class="hljs-literal">nullptr</span>) {
        <span class="hljs-keyword">delete</span>[] _string_val;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">auto</span> count = <span class="hljs-built_in">strlen</span>(val) + <span class="hljs-number">1</span>;<font></font>
    _string_val = <span class="hljs-keyword">new</span> <span class="hljs-keyword">char</span>[count];
    <span class="hljs-built_in">strcpy</span>(_string_val, val);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">char</span>* <span class="hljs-title">Foo::get_string_val</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> _string_val;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Funktionalität der Bibliothek zu testen, </font><font style="vertical-align: inherit;">enthält der </font><font style="vertical-align: inherit;">Ordner </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auch die Datei </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main.cpp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mit der Klasse </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"foo.h"</span></span><font></font>
<font></font>
<span class="hljs-keyword">using</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span>;
<span class="hljs-keyword">using</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>* argv[])</span> </span>{
    <span class="hljs-keyword">auto</span> foo = Foo(<span class="hljs-number">10</span>, <span class="hljs-string">"Hello"</span>);
    <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"int_val: "</span> &lt;&lt; foo.get_int_val() &lt;&lt; <span class="hljs-built_in">endl</span>;
    <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"string_val: "</span> &lt;&lt; foo.get_string_val() &lt;&lt; <span class="hljs-built_in">endl</span>;<font></font>
<font></font>
    foo.set_int_val(<span class="hljs-number">0</span>);<font></font>
    foo.set_string_val(<span class="hljs-string">"Hello world!"</span>);<font></font>
<font></font>
    <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"int_val: "</span> &lt;&lt; foo.get_int_val() &lt;&lt; <span class="hljs-built_in">endl</span>;
    <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"string_val: "</span> &lt;&lt; foo.get_string_val() &lt;&lt; <span class="hljs-built_in">endl</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verwenden Sie </font><font style="vertical-align: inherit;">
zum Erstellen der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bibliothek </font><font style="vertical-align: inherit;">das folgende </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Makefile</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="plaintext hljs">CC=g++<font></font>
CFLAGS=-c -fPIC<font></font>
DIR_OUT=bin<font></font>
<font></font>
all: main<font></font>
<font></font>
main: main.o libfoo.a<font></font>
    $(CC) $(DIR_OUT)/main.o -L$(DIR_OUT) -lfoo -o $(DIR_OUT)/main<font></font>
<font></font>
main.o: makedir main.cpp<font></font>
    $(CC) $(CFLAGS) main.cpp -o $(DIR_OUT)/main.o<font></font>
<font></font>
libfoo.a: makedir foo.cpp<font></font>
    $(CC) $(CFLAGS) foo.cpp -o $(DIR_OUT)/foo.o<font></font>
    ar rcs $(DIR_OUT)/libfoo.a $(DIR_OUT)/foo.o<font></font>
<font></font>
makedir:<font></font>
    mkdir -p $(DIR_OUT)<font></font>
<font></font>
clean:<font></font>
    rm -rf $(DIR_OUT)/*<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Unterschied zum </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Makefile</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in den vorherigen Beispielen besteht neben der Änderung des Compilers von </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gcc</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g ++ darin</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dass eine weitere Option </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-fPIC</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zum Kompilieren hinzugefügt wurde </font><font style="vertical-align: inherit;">, die den Compiler </font><i><font style="vertical-align: inherit;">anweist</font></i><font style="vertical-align: inherit;"> , den Code auf eine bestimmte Weise in die Bibliothek zu stellen (den sogenannten "positionsunabhängigen Code"). Da es in diesem Artikel nicht um Compiler geht, werden wir nicht genauer untersuchen, was dieser Parameter bewirkt und warum er benötigt wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beginnen wir mit der Bindung für diese Bibliothek. Die Dateien </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sind </font><i><font style="vertical-align: inherit;">gegenüber</font></i><font style="vertical-align: inherit;"> den vorherigen Beispielen </font><i><font style="vertical-align: inherit;">nahezu unverändert</font></i><font style="vertical-align: inherit;"> . So sieht die Datei </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> jetzt aus </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">[build-system]<font></font>
requires = ["sip &gt;=5, &lt;6"]<font></font>
build-backend = "sipbuild.api"<font></font>
<font></font>
[tool.sip.metadata]<font></font>
name = "pyfoocpp"<font></font>
version = "0.1"<font></font>
license = "MIT"<font></font>
<font></font>
[tool.sip.bindings.pyfoocpp]<font></font>
headers = ["foo.h"]<font></font>
libraries = ["foo"]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt werden unsere in C ++ geschriebenen Beispiele in das Python-Paket </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoocpp gepackt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dies ist möglicherweise die einzige erkennbare Änderung in dieser Datei. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Datei </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bleibt dieselbe wie im Beispiel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_04</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> subprocess<font></font>
<font></font>
<span class="hljs-keyword">from</span> sipbuild <span class="hljs-keyword">import</span> Project<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FooProject</span>(<span class="hljs-params">Project</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_build_foo</span>(<span class="hljs-params">self</span>):</span>
        cwd = os.path.abspath(<span class="hljs-string">'foo'</span>)<font></font>
        subprocess.run([<span class="hljs-string">'make'</span>], cwd=cwd, capture_output=<span class="hljs-literal">True</span>, check=<span class="hljs-literal">True</span>)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build</span>(<span class="hljs-params">self</span>):</span><font></font>
        self._build_foo()<font></font>
        super().build()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_sdist</span>(<span class="hljs-params">self, sdist_directory</span>):</span><font></font>
        self._build_foo()<font></font>
        <span class="hljs-keyword">return</span> super().build_sdist(sdist_directory)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_wheel</span>(<span class="hljs-params">self, wheel_directory</span>):</span><font></font>
        self._build_foo()<font></font>
        <span class="hljs-keyword">return</span> super().build_wheel(wheel_directory)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">install</span>(<span class="hljs-params">self</span>):</span><font></font>
        self._build_foo()<font></font>
        super().install()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und hier werden </font><font style="vertical-align: inherit;">wir die </font><font style="vertical-align: inherit;">Datei </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoocpp.sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> genauer betrachten. Ich möchte Sie daran erinnern, dass diese Datei die Schnittstelle für das zukünftige Python-Modul beschreibt: Was sollte sie enthalten, wie sollte die Klassenschnittstelle aussehen usw. Die .sip-Datei ist nicht erforderlich, um die Bibliotheks-Header-Datei zu wiederholen, obwohl sie viele Gemeinsamkeiten haben. Innerhalb dieser Klasse können neue Methoden hinzugefügt werden, die nicht in der ursprünglichen Klasse enthalten waren. Jene. Die in der .sip-Datei beschriebene Schnittstelle kann Bibliotheksklassen bei Bedarf an die in Python akzeptierten Prinzipien anpassen. In der Datei </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoocpp.sip sehen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wir neue Anweisungen für uns. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lassen Sie uns zunächst sehen, was diese Datei enthält:</font></font><br>
<br>
<pre><code class="cpp hljs">%Module(name=foocpp, language=<span class="hljs-string">"C++"</span>)<font></font>
%DefaultEncoding <span class="hljs-string">"UTF-8"</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Foo</span> {</span><font></font>
    %TypeHeaderCode<font></font>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;foo.h&gt;</span></span><font></font>
    %End<font></font>
<font></font>
    <span class="hljs-keyword">public</span>:<font></font>
        Foo(<span class="hljs-keyword">int</span>, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*);<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_int_val</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span></span>;
        <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">get_int_val</span><span class="hljs-params">()</span></span>;<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_string_val</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*)</span></span>;
        <span class="hljs-function"><span class="hljs-keyword">char</span>* <span class="hljs-title">get_string_val</span><span class="hljs-params">()</span></span>;<font></font>
};<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die ersten Zeilen sollten uns bereits aus den vorhergehenden Beispielen klar sein. In der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Module-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Direktive geben </font><font style="vertical-align: inherit;">wir den Namen des Python-Moduls an, das erstellt werden soll ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dh</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> um dieses Modul zu verwenden, müssen wir die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Befehle </font></font></i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">import foocpp</font></i><font style="vertical-align: inherit;"> oder </font><i><font style="vertical-align: inherit;">from foocpp import ... verwenden</font></i><font style="vertical-align: inherit;"> . In derselben Direktive geben wir an, dass wir jetzt die Sprache haben - C ++. Die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Direktive% DefaultEncoding</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> legt die Codierung fest, mit der die Python-Zeichenfolge in die Typen </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const char</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> konvertiert wird </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anschließend folgt die Schnittstellendeklaration der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foo-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Klasse </font><font style="vertical-align: inherit;">. Unmittelbar nach der Deklaration der </font><i><font style="vertical-align: inherit;">Foo-</font></i><font style="vertical-align: inherit;"> Klasse</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Direktive </font><i><font style="vertical-align: inherit;">% TypeHeaderCode</font></i><font style="vertical-align: inherit;"> , die mit der Direktive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% End</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> endet, </font><font style="vertical-align: inherit;">wird immer noch nicht verwendet </font><font style="vertical-align: inherit;">. Die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Direktive% TypeHeaderCode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> muss Code enthalten, der die Schnittstelle der C ++ - Klasse deklariert, für die der Wrapper erstellt wird. In dieser Anweisung reicht es in der Regel aus, die Header-Datei in die Klassendeklaration aufzunehmen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Danach werden die Klassenmethoden aufgelistet, die in die Methoden der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foo-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Klasse </font><font style="vertical-align: inherit;">für die Python-Sprache </font><font style="vertical-align: inherit;">konvertiert werden </font><font style="vertical-align: inherit;">. Es ist wichtig zu beachten, dass wir zu diesem Zeitpunkt nur öffentliche Methoden deklarieren, auf die über die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foo-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Klasse </font><font style="vertical-align: inherit;">in Python zugegriffen werden kann (da es in Python keine privaten und geschützten Mitglieder gibt). Da wir am </font><i><font style="vertical-align: inherit;">Anfang die</font></i><font style="vertical-align: inherit;"> Direktive </font><i><font style="vertical-align: inherit;">% DefaultEncoding</font></i><font style="vertical-align: inherit;"> verwendet haben</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In Methoden, die Argumente vom Typ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> annehmen </font><font style="vertical-align: inherit;">, können Sie die Annotation </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encoding</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nicht verwenden </font><font style="vertical-align: inherit;">, um die Codierung für die Konvertierung dieser Parameter in Python-Zeichenfolgen anzugeben und umgekehrt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt müssen wir nur noch das </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoocpp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Python-Paket kompilieren </font><font style="vertical-align: inherit;">und testen. </font><font style="vertical-align: inherit;">Bevor wir jedoch ein vollwertiges Radpaket zusammenstellen, verwenden wir den </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Befehl sip-build</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und sehen, welche Quelldateien SIP für die spätere Kompilierung erstellt, und versuchen, darin etwas zu finden, das der Klasse ähnelt, die in Python-Code erstellt wird. </font><font style="vertical-align: inherit;">Dazu muss der obige </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Befehl sip-build</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> im Ordner </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_cpp_01 aufgerufen werden</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Infolgedessen wird der </font><i><font style="vertical-align: inherit;">Build-</font></i><font style="vertical-align: inherit;"> Ordner erstellt.</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mit folgenden Inhalten:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bauen</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
└── foocpp</font></font><font></font>
    ├── apiversions.c<font></font>
    ├── array.c<font></font>
    ├── array.h<font></font>
    ├── bool.cpp<font></font>
    ├── build<font></font>
    │&nbsp;&nbsp; └── temp.linux-x86_64-3.8<font></font>
    │&nbsp;&nbsp;     ├── apiversions.o<font></font>
    │&nbsp;&nbsp;     ├── array.o<font></font>
    │&nbsp;&nbsp;     ├── bool.o<font></font>
    │&nbsp;&nbsp;     ├── descriptors.o<font></font>
    │&nbsp;&nbsp;     ├── int_convertors.o<font></font>
    │&nbsp;&nbsp;     ├── objmap.o<font></font>
    │&nbsp;&nbsp;     ├── qtlib.o<font></font>
    │&nbsp;&nbsp;     ├── sipfoocppcmodule.o<font></font>
    │&nbsp;&nbsp;     ├── sipfoocppFoo.o<font></font>
    │&nbsp;&nbsp;     ├── siplib.o<font></font>
    │&nbsp;&nbsp;     ├── threads.o<font></font>
    │&nbsp;&nbsp;     └── voidptr.o<font></font>
    ├── descriptors.c<font></font>
    ├── foocpp.cpython-38-x86_64-linux-gnu.so<font></font>
    ├── int_convertors.c<font></font>
    ├── objmap.c<font></font>
    ├── qtlib.c<font></font>
    ├── sipAPIfoocpp.h<font></font>
    ├── sipfoocppcmodule.cpp<font></font>
    ├── sipfoocppFoo.cpp<font></font>
    ├── sip.h<font></font>
    ├── sipint.h<font></font>
    ├── siplib.c<font></font>
    ├── threads.c<font></font>
    └── voidptr.c<font></font>
</pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Betrachten </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> als zusätzliche Aufgabe die Datei </font><i><font style="vertical-align: inherit;">sipfoocppFoo.cpp</font></i><font style="vertical-align: inherit;"> sorgfältig </font><font style="vertical-align: inherit;">(wir werden sie in diesem Artikel nicht im Detail behandeln):</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">/*
 * Interface wrapper code.
 *
 * Generated by SIP 5.1.1
 */</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"sipAPIfoocpp.h"</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">line</span> 6 <span class="hljs-meta-string">"/home/jenyay/temp/2/pyfoocpp.sip"</span></span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;foo.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">line</span> 12 <span class="hljs-meta-string">"/home/jenyay/temp/2/build/foocpp/sipfoocppFoo.cpp"</span></span><font></font>
<font></font>
PyDoc_STRVAR(doc_Foo_set_int_val, <span class="hljs-string">"set_int_val(self, int)"</span>);<font></font>
<font></font>
<span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> {<span class="hljs-function"><span class="hljs-keyword">static</span> PyObject *<span class="hljs-title">meth_Foo_set_int_val</span><span class="hljs-params">(PyObject *, PyObject *)</span></span>;}
<span class="hljs-function"><span class="hljs-keyword">static</span> PyObject *<span class="hljs-title">meth_Foo_set_int_val</span><span class="hljs-params">(PyObject *sipSelf, PyObject *sipArgs)</span>
</span>{<font></font>
    PyObject *sipParseErr = SIP_NULLPTR;<font></font>
<font></font>
    {<font></font>
        <span class="hljs-keyword">int</span> a0;<font></font>
         ::Foo *sipCpp;<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (sipParseArgs(&amp;sipParseErr, sipArgs, <span class="hljs-string">"Bi"</span>, &amp;sipSelf, sipType_Foo, &amp;sipCpp, &amp;a0))<font></font>
        {<font></font>
            sipCpp-&gt;set_int_val(a0);<font></font>
<font></font>
            Py_INCREF(Py_None);<font></font>
            <span class="hljs-keyword">return</span> Py_None;<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">/* Raise an exception if the arguments couldn't be parsed. */</span><font></font>
    sipNoMethod(sipParseErr, sipName_Foo, sipName_set_int_val, doc_Foo_set_int_val);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> SIP_NULLPTR;<font></font>
}<font></font>
<font></font>
PyDoc_STRVAR(doc_Foo_get_int_val, <span class="hljs-string">"get_int_val(self) -&gt; int"</span>);<font></font>
<font></font>
<span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> {<span class="hljs-function"><span class="hljs-keyword">static</span> PyObject *<span class="hljs-title">meth_Foo_get_int_val</span><span class="hljs-params">(PyObject *, PyObject *)</span></span>;}
<span class="hljs-function"><span class="hljs-keyword">static</span> PyObject *<span class="hljs-title">meth_Foo_get_int_val</span><span class="hljs-params">(PyObject *sipSelf, PyObject *sipArgs)</span>
</span>{<font></font>
    PyObject *sipParseErr = SIP_NULLPTR;<font></font>
<font></font>
    {<font></font>
         ::Foo *sipCpp;<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (sipParseArgs(&amp;sipParseErr, sipArgs, <span class="hljs-string">"B"</span>, &amp;sipSelf, sipType_Foo, &amp;sipCpp))<font></font>
        {<font></font>
            <span class="hljs-keyword">int</span> sipRes;<font></font>
<font></font>
            sipRes = sipCpp-&gt;get_int_val();<font></font>
<font></font>
            <span class="hljs-keyword">return</span> PyLong_FromLong(sipRes);<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">/* Raise an exception if the arguments couldn't be parsed. */</span><font></font>
    sipNoMethod(sipParseErr, sipName_Foo, sipName_get_int_val, doc_Foo_get_int_val);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> SIP_NULLPTR;<font></font>
}<font></font>
<font></font>
PyDoc_STRVAR(doc_Foo_set_string_val, <span class="hljs-string">"set_string_val(self, str)"</span>);<font></font>
<font></font>
<span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> {<span class="hljs-function"><span class="hljs-keyword">static</span> PyObject *<span class="hljs-title">meth_Foo_set_string_val</span><span class="hljs-params">(PyObject *, PyObject *)</span></span>;}
<span class="hljs-function"><span class="hljs-keyword">static</span> PyObject *<span class="hljs-title">meth_Foo_set_string_val</span><span class="hljs-params">(PyObject *sipSelf, PyObject *sipArgs)</span>
</span>{<font></font>
    PyObject *sipParseErr = SIP_NULLPTR;<font></font>
<font></font>
    {<font></font>
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* a0;<font></font>
        PyObject *a0Keep;<font></font>
         ::Foo *sipCpp;<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (sipParseArgs(&amp;sipParseErr, sipArgs, <span class="hljs-string">"BA8"</span>, &amp;sipSelf, sipType_Foo, &amp;sipCpp, &amp;a0Keep, &amp;a0))<font></font>
        {<font></font>
            sipCpp-&gt;set_string_val(a0);<font></font>
            Py_DECREF(a0Keep);<font></font>
<font></font>
            Py_INCREF(Py_None);<font></font>
            <span class="hljs-keyword">return</span> Py_None;<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">/* Raise an exception if the arguments couldn't be parsed. */</span><font></font>
    sipNoMethod(sipParseErr, sipName_Foo, sipName_set_string_val, doc_Foo_set_string_val);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> SIP_NULLPTR;<font></font>
}<font></font>
<font></font>
PyDoc_STRVAR(doc_Foo_get_string_val, <span class="hljs-string">"get_string_val(self) -&gt; str"</span>);<font></font>
<font></font>
<span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> {<span class="hljs-function"><span class="hljs-keyword">static</span> PyObject *<span class="hljs-title">meth_Foo_get_string_val</span><span class="hljs-params">(PyObject *, PyObject *)</span></span>;}
<span class="hljs-function"><span class="hljs-keyword">static</span> PyObject *<span class="hljs-title">meth_Foo_get_string_val</span><span class="hljs-params">(PyObject *sipSelf, PyObject *sipArgs)</span>
</span>{<font></font>
    PyObject *sipParseErr = SIP_NULLPTR;<font></font>
<font></font>
    {<font></font>
         ::Foo *sipCpp;<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (sipParseArgs(&amp;sipParseErr, sipArgs, <span class="hljs-string">"B"</span>, &amp;sipSelf, sipType_Foo, &amp;sipCpp))<font></font>
        {<font></font>
            <span class="hljs-keyword">char</span>*sipRes;<font></font>
<font></font>
            sipRes = sipCpp-&gt;get_string_val();<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (sipRes == SIP_NULLPTR)<font></font>
            {<font></font>
                Py_INCREF(Py_None);<font></font>
                <span class="hljs-keyword">return</span> Py_None;<font></font>
            }<font></font>
<font></font>
            <span class="hljs-keyword">return</span> PyUnicode_FromString(sipRes);<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">/* Raise an exception if the arguments couldn't be parsed. */</span><font></font>
    sipNoMethod(sipParseErr, sipName_Foo, sipName_get_string_val, doc_Foo_get_string_val);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> SIP_NULLPTR;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/* Call the instance's destructor. */</span>
<span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> {<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">release_Foo</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *, <span class="hljs-keyword">int</span>)</span></span>;}
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">release_Foo</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *sipCppV, <span class="hljs-keyword">int</span>)</span>
</span>{
    <span class="hljs-keyword">delete</span> <span class="hljs-keyword">reinterpret_cast</span>&lt; ::Foo *&gt;(sipCppV);<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> {<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">dealloc_Foo</span><span class="hljs-params">(sipSimpleWrapper *)</span></span>;}
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">dealloc_Foo</span><span class="hljs-params">(sipSimpleWrapper *sipSelf)</span>
</span>{
    <span class="hljs-keyword">if</span> (sipIsOwnedByPython(sipSelf))<font></font>
    {<font></font>
        release_Foo(sipGetAddress(sipSelf), <span class="hljs-number">0</span>);<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> {<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> *<span class="hljs-title">init_type_Foo</span><span class="hljs-params">(sipSimpleWrapper *, PyObject *, 
                 PyObject *, PyObject **, PyObject **, PyObject **)</span></span>;}
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> *<span class="hljs-title">init_type_Foo</span><span class="hljs-params">(sipSimpleWrapper *, PyObject *sipArgs, PyObject *sipKwds,
                                   PyObject **sipUnused, PyObject **, PyObject **sipParseErr)</span>
</span>{<font></font>
     ::Foo *sipCpp = SIP_NULLPTR;<font></font>
<font></font>
    {<font></font>
        <span class="hljs-keyword">int</span> a0;
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* a1;<font></font>
        PyObject *a1Keep;<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (sipParseKwdArgs(sipParseErr, sipArgs, sipKwds, SIP_NULLPTR, sipUnused, <span class="hljs-string">"iA8"</span>, &amp;a0, &amp;a1Keep, &amp;a1))<font></font>
        {<font></font>
            sipCpp = <span class="hljs-keyword">new</span>  ::Foo(a0,a1);<font></font>
            Py_DECREF(a1Keep);<font></font>
<font></font>
            <span class="hljs-keyword">return</span> sipCpp;<font></font>
        }<font></font>
    }<font></font>
<font></font>
    {<font></font>
        <span class="hljs-keyword">const</span>  ::Foo* a0;<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (sipParseKwdArgs(sipParseErr, sipArgs, sipKwds, SIP_NULLPTR, sipUnused, <span class="hljs-string">"J9"</span>, sipType_Foo, &amp;a0))<font></font>
        {<font></font>
            sipCpp = <span class="hljs-keyword">new</span>  ::Foo(*a0);<font></font>
<font></font>
            <span class="hljs-keyword">return</span> sipCpp;<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> SIP_NULLPTR;<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">static</span> PyMethodDef methods_Foo[] = {<font></font>
    {sipName_get_int_val, meth_Foo_get_int_val, METH_VARARGS, doc_Foo_get_int_val},<font></font>
    {sipName_get_string_val, meth_Foo_get_string_val, METH_VARARGS, doc_Foo_get_string_val},<font></font>
    {sipName_set_int_val, meth_Foo_set_int_val, METH_VARARGS, doc_Foo_set_int_val},<font></font>
    {sipName_set_string_val, meth_Foo_set_string_val, METH_VARARGS, doc_Foo_set_string_val}<font></font>
};<font></font>
<font></font>
PyDoc_STRVAR(doc_Foo, <span class="hljs-string">"\1Foo(int, str)\n"</span>
<span class="hljs-string">"Foo(Foo)"</span>);<font></font>
<font></font>
sipClassTypeDef sipTypeDef_foocpp_Foo = {<font></font>
    {<font></font>
        <span class="hljs-number">-1</span>,<font></font>
        SIP_NULLPTR,<font></font>
        SIP_NULLPTR,<font></font>
        SIP_TYPE_CLASS,<font></font>
        sipNameNr_Foo,<font></font>
        SIP_NULLPTR,<font></font>
        SIP_NULLPTR<font></font>
    },<font></font>
    {<font></font>
        sipNameNr_Foo,<font></font>
        {<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>},
        <span class="hljs-number">4</span>, methods_Foo,
        <span class="hljs-number">0</span>, SIP_NULLPTR,
        <span class="hljs-number">0</span>, SIP_NULLPTR,<font></font>
        {SIP_NULLPTR, SIP_NULLPTR, SIP_NULLPTR, SIP_NULLPTR, SIP_NULLPTR,<font></font>
         SIP_NULLPTR, SIP_NULLPTR, SIP_NULLPTR, SIP_NULLPTR, SIP_NULLPTR},<font></font>
    },<font></font>
    doc_Foo,<font></font>
    <span class="hljs-number">-1</span>,
    <span class="hljs-number">-1</span>,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    init_type_Foo,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    dealloc_Foo,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    release_Foo,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR<font></font>
};<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erstellen Sie nun das Paket mit dem Befehl </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-whe</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Wenn nach Ausführung dieses Befehls alles gut geht, wird eine </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoocpp-0.1-cp38-cp38-manylinux1_x86_64.whl-Datei</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oder mit einem ähnlichen Namen </font><font style="vertical-align: inherit;">erstellt </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Installieren Sie es mit dem </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Befehl pip install --user pyfoocpp-0.1-cp38-cp38-manylinux1_x86_64.whl</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und führen Sie den Python-Interpreter aus, um </font><i><font style="vertical-align: inherit;">Folgendes</font></i><font style="vertical-align: inherit;"> zu überprüfen:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> foocpp <span class="hljs-keyword">import</span> Foo
<span class="hljs-meta">&gt;&gt;&gt; </span>x = Foo(<span class="hljs-number">10</span>, <span class="hljs-string">'Hello'</span>)<font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>x.get_int_val()
<span class="hljs-number">10</span><font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>x.get_string_val()
<span class="hljs-string">'Hello'</span><font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>x.set_int_val(<span class="hljs-number">50</span>)
<span class="hljs-meta">&gt;&gt;&gt; </span>x.set_string_val(<span class="hljs-string">''</span>)<font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>x.get_int_val()
<span class="hljs-number">50</span><font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>x.get_string_val()
<span class="hljs-string">''</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Funktioniert! </font><font style="vertical-align: inherit;">Daher haben wir gerade ein Python-Modul mit einer Bindung für eine Klasse in C ++ erstellt. </font><font style="vertical-align: inherit;">Weiter werden wir Schönheit in diese Klasse bringen und verschiedene Annehmlichkeiten hinzufügen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eigenschaften hinzufügen</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit SIP erstellte Klassen müssen die C ++ - Klassenschnittstelle nicht genau wiederholen. In unserer </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foo-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Klasse </font><font style="vertical-align: inherit;">gibt es beispielsweise zwei Getter und zwei Setter, die eindeutig zu einer Eigenschaft kombiniert werden können, um die Klasse „Python“ zu machen. Das Hinzufügen von Eigenschaften mit sip ist einfach genug, wie ein Beispiel im Ordner </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_cpp_02 zeigt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieses Beispiel ähnelt dem vorherigen, der Hauptunterschied liegt in der Datei </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoocpp.sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , die jetzt folgendermaßen aussieht:</font></font><br>
<br>
<pre><code class="cpp hljs">%Module(name=foocpp, language=<span class="hljs-string">"C++"</span>)<font></font>
%DefaultEncoding <span class="hljs-string">"UTF-8"</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Foo</span> {</span><font></font>
    %TypeHeaderCode<font></font>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;foo.h&gt;</span></span><font></font>
    %End<font></font>
<font></font>
    <span class="hljs-keyword">public</span>:<font></font>
        Foo(<span class="hljs-keyword">int</span>, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*);<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_int_val</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span></span>;
        <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">get_int_val</span><span class="hljs-params">()</span></span>;<font></font>
        %Property(name=int_val, get=get_int_val, <span class="hljs-built_in">set</span>=set_int_val)<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_string_val</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*)</span></span>;
        <span class="hljs-function"><span class="hljs-keyword">char</span>* <span class="hljs-title">get_string_val</span><span class="hljs-params">()</span></span>;<font></font>
        %Property(name=string_val, get=get_string_val, <span class="hljs-built_in">set</span>=set_string_val)<font></font>
};<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie sehen können, ist alles ganz einfach. Zum Hinzufügen einer Eigenschaft ist die Direktive </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Property</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vorgesehen </font><font style="vertical-align: inherit;">, für die zwei Parameter erforderlich sind: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">name</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , um den Namen der Eigenschaft </font><font style="vertical-align: inherit;">anzugeben </font><font style="vertical-align: inherit;">, und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , um eine Methode anzugeben, die einen Wert zurückgibt (getter). Möglicherweise gibt es keinen Setter, aber wenn der Eigenschaft auch Werte zugewiesen werden müssen, wird die Setter-Methode als Wert des </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Set-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Parameters angegeben </font><font style="vertical-align: inherit;">. In unserem Beispiel werden Eigenschaften auf relativ einfache Weise erstellt, da es bereits Funktionen gibt, die als Getter und Setter fungieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir können das Paket nur mit dem Befehl </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-Wheel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sammeln </font><font style="vertical-align: inherit;">und installieren. Danach überprüfen wir die Funktion der Eigenschaften im Python-Interpreter-Befehlsmodus:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> foocpp <span class="hljs-keyword">import</span> Foo
<span class="hljs-meta">&gt;&gt;&gt; </span>x = Foo(<span class="hljs-number">10</span>, <span class="hljs-string">"Hello"</span>)
<span class="hljs-meta">&gt;&gt;&gt; </span>x.int_val
<span class="hljs-number">10</span><font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>x.string_val
<span class="hljs-string">'Hello'</span><font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>x.int_val = <span class="hljs-number">50</span>
<span class="hljs-meta">&gt;&gt;&gt; </span>x.string_val = <span class="hljs-string">''</span><font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>x.get_int_val()
<span class="hljs-number">50</span><font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>x.get_string_val()
<span class="hljs-string">''</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie am Beispiel der Verwendung der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foo-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Klasse sehen können </font><font style="vertical-align: inherit;">, </font><i><font style="vertical-align: inherit;">funktionieren die Eigenschaften </font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int_val</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">string_val</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sowohl zum Lesen als auch zum Schreiben.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dokumentationszeilen hinzufügen</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden unsere </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foo-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Klasse weiter verbessern </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Das folgende Beispiel im Ordner </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_cpp_03</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zeigt, wie Sie Dokumentationszeilen (docstring) zu verschiedenen Elementen einer Klasse hinzufügen. </font><font style="vertical-align: inherit;">Dieses Beispiel basiert auf dem vorherigen und die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hauptänderung</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> betrifft die Datei </font><i><font style="vertical-align: inherit;">pyfoocpp.sip</font></i><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Hier sind die Inhalte:</font></font><br>
<br>
<pre><code class="cpp hljs">%Module(name=foocpp, language=<span class="hljs-string">"C++"</span>)<font></font>
%DefaultEncoding <span class="hljs-string">"UTF-8"</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Foo</span> {</span><font></font>
%Docstring<font></font>
Class example from C++ library<font></font>
%End<font></font>
<font></font>
    %TypeHeaderCode<font></font>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;foo.h&gt;</span></span><font></font>
    %End<font></font>
<font></font>
    <span class="hljs-keyword">public</span>:<font></font>
        Foo(<span class="hljs-keyword">int</span>, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*);<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_int_val</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span></span>;<font></font>
        %Docstring(format=<span class="hljs-string">"deindented"</span>, signature=<span class="hljs-string">"prepended"</span>)<font></font>
            Set integer value<font></font>
        %<span class="hljs-function">End

        <span class="hljs-keyword">int</span> <span class="hljs-title">get_int_val</span><span class="hljs-params">()</span></span>;<font></font>
        %Docstring(format=<span class="hljs-string">"deindented"</span>, signature=<span class="hljs-string">"prepended"</span>)<font></font>
            Return integer value<font></font>
        %End<font></font>
<font></font>
        %Property(name=int_val, get=get_int_val, <span class="hljs-built_in">set</span>=set_int_val)<font></font>
        {<font></font>
            %Docstring <span class="hljs-string">"deindented"</span>
                The property <span class="hljs-keyword">for</span> integer value<font></font>
            %End<font></font>
        };<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_string_val</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*)</span></span>;<font></font>
        %Docstring(format=<span class="hljs-string">"deindented"</span>, signature=<span class="hljs-string">"appended"</span>)<font></font>
            Set <span class="hljs-built_in">string</span> value<font></font>
        %<span class="hljs-function">End

        <span class="hljs-keyword">char</span>* <span class="hljs-title">get_string_val</span><span class="hljs-params">()</span></span>;<font></font>
        %Docstring(format=<span class="hljs-string">"deindented"</span>, signature=<span class="hljs-string">"appended"</span>)<font></font>
            Return <span class="hljs-built_in">string</span> value<font></font>
        %End<font></font>
<font></font>
        %Property(name=string_val, get=get_string_val, <span class="hljs-built_in">set</span>=set_string_val)<font></font>
        {<font></font>
            %Docstring <span class="hljs-string">"deindented"</span>
                The property <span class="hljs-keyword">for</span> <span class="hljs-built_in">string</span> value<font></font>
            %End<font></font>
        };<font></font>
};<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie bereits verstanden haben, müssen Sie zum Hinzufügen von Dokumentationszeilen zu einem Element der Klasse die Direktive </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Docstring verwenden</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dieses Beispiel zeigt verschiedene Möglichkeiten zur Verwendung dieser Direktive. Um dieses Beispiel besser zu verstehen, kompilieren </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> das </font><i><font style="vertical-align: inherit;">pyfoocpp-</font></i><font style="vertical-align: inherit;"> Paket sofort </font><font style="vertical-align: inherit;">mit dem Befehl </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip- </font></font></i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">whe</font></i><font style="vertical-align: inherit;"> , installieren es und behandeln, welche Parameter dieser Direktive sich auf was </font><i><font style="vertical-align: inherit;">auswirken</font></i><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">unter </font><font style="vertical-align: inherit;">Berücksichtigung der resultierenden Dokumentationszeilen im Python-Befehlsmodus. Ich </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">möchte</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sie daran erinnern, dass Dokumentationszeilen als Mitglieder der </font><i><font style="vertical-align: inherit;">__doc__-</font></i><font style="vertical-align: inherit;"> Objekte </font><font style="vertical-align: inherit;">gespeichert sind, </font><font style="vertical-align: inherit;">zu denen diese Zeilen gehören. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die erste Dokumentationszeile </font><i><font style="vertical-align: inherit;">bezieht</font></i><font style="vertical-align: inherit;"> sich auf die </font><i><font style="vertical-align: inherit;">Foo-</font></i><font style="vertical-align: inherit;"> Klasse.</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Wie Sie sehen können, befinden sich alle Dokumentationszeilen zwischen den </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anweisungen% Docstring</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% End</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . In den Zeilen 5 bis 7 dieses Beispiels werden keine zusätzlichen Parameter der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Docstring-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Direktive verwendet </font><font style="vertical-align: inherit;">, sodass die Dokumentationszeile </font><i><font style="vertical-align: inherit;">unverändert</font></i><font style="vertical-align: inherit;"> in die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foo-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Klasse geschrieben </font><font style="vertical-align: inherit;">wird. Aus diesem Grund gibt es in den Zeilen 5 bis 7 keine Einrückungen, da sonst auch Einrückungen vor der Dokumentationszeile in Foo .__ doc__ fallen würden. Wir werden sicherstellen, dass die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foo-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Klasse </font><font style="vertical-align: inherit;">wirklich die von uns eingeführte Dokumentationszeile enthält:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> foocpp <span class="hljs-keyword">import</span> Foo
<span class="hljs-meta">&gt;&gt;&gt; </span>Foo.__doc__
<span class="hljs-string">'Class example from C++ library'</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die folgende </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Docstring-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Direktive </font><font style="vertical-align: inherit;">in den Zeilen 17-19 verwendet zwei Parameter gleichzeitig. Der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formatparameter</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kann einen von zwei Werten annehmen: "raw" oder "deindented". Im ersten Fall werden die Dokumentationszeilen beim Schreiben gespeichert, und im zweiten Fall werden die anfänglichen Leerzeichen (jedoch keine Tabulatoren) gelöscht. Der Standardwert für den Fall, dass der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formatparameter</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nicht angegeben wird, kann mit der Direktive </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% DefaultDocstringFormat festgelegt werden</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (wir werden ihn etwas später betrachten). Wenn er nicht angegeben wird, wird angenommen, dass </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">format = "raw" ist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zusätzlich zu den angegebenen Dokumentationszeilen fügt SIP den Dokumentationszeilen eine Beschreibung seiner Signatur hinzu (welche Arten von Variablen werden an der Eingabe erwartet und welche Art die Funktion zurückgibt). Der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Signaturparameter</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gibt an, wo eine solche Signatur abgelegt werden soll: vor der angegebenen Dokumentationszeile ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Signatur = "vorangestellt"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), danach ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Signatur = "angehängt"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) oder nicht die Signatur hinzufügen ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Signatur = "verworfen"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In unserem Beispiel wird der Parameter </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">signatur = "vorangestellt"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> für die </font><i><font style="vertical-align: inherit;">Funktionen </font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_int_val</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set_int_val</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sowie die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Signatur = "angehängt"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> für die </font><i><font style="vertical-align: inherit;">Funktionen </font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_string_val</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set_string_val festgelegt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Der Parameter </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">format = "deindented"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wurde ebenfalls hinzugefügt </font><font style="vertical-align: inherit;">, um Leerzeichen am Anfang der Dokumentationszeile zu entfernen. Lassen Sie uns überprüfen, wie diese Parameter in Python funktionieren:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-meta">&gt;&gt;&gt; </span>Foo.get_int_val.__doc__
<span class="hljs-string">'get_int_val(self) -&gt; int\nReturn integer value'</span><font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>Foo.set_int_val.__doc__
<span class="hljs-string">'set_int_val(self, int)\nSet integer value'</span><font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>Foo.get_string_val.__doc__
<span class="hljs-string">'Return string value\nget_string_val(self) -&gt; str'</span><font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>Foo.set_string_val.__doc__
<span class="hljs-string">'Set string value\nset_string_val(self, str)'</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie sehen können, können Sie mithilfe des </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Signaturparameters</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> der Direktive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Docstring</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> die Position der Funktionssignaturbeschreibung in der Dokumentationszeile ändern. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fügen Sie nun eine Dokumentationszeile zu den Eigenschaften hinzu. Beachten Sie, dass in diesem Fall die </font><font style="vertical-align: inherit;">Direktiven </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Docstring</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ... </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% End</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in Klammern nach der Direktive% Property stehen. Dieses Aufzeichnungsformat wird in der Dokumentation zur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Property-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Direktive beschrieben </font><font style="vertical-align: inherit;">. </font><i><font style="vertical-align: inherit;">Beachten Sie</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
auch, wie wir den Direktivenparameter </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Docstring</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> angeben </font><font style="vertical-align: inherit;">. Ein solches Format zum Schreiben von Anweisungen ist möglich, wenn wir nur den ersten Parameter der Anweisung festlegen (in diesem Fall den </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formatparameter</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">Daher werden in diesem Beispiel drei Methoden zur Verwendung von Direktiven gleichzeitig verwendet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Stellen Sie sicher, dass die Dokumentationszeile für die Eigenschaften festgelegt ist:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt;&gt;&gt; Foo.int_val.__doc__<font></font>
'The property for integer value'<font></font>
<font></font>
&gt;&gt;&gt; Foo.string_val.__doc__<font></font>
'The property for string value'<font></font>
<font></font>
&gt;&gt;&gt; help(Foo)<font></font>
Help on class Foo in module foocpp:<font></font>
<font></font>
class Foo(sip.wrapper)<font></font>
 |  Class example from C++ library<font></font>
 |  <font></font>
 |  Method resolution order:<font></font>
 |      Foo<font></font>
 |      sip.wrapper<font></font>
 |      sip.simplewrapper<font></font>
 |      builtins.object<font></font>
 |  <font></font>
 |  Methods defined here:<font></font>
 |  <font></font>
 |  get_int_val(...)<font></font>
 |      get_int_val(self) -&gt; int<font></font>
 |      Return integer value<font></font>
 |  <font></font>
 |  get_string_val(...)<font></font>
 |      Return string value<font></font>
 |      get_string_val(self) -&gt; str<font></font>
 |  <font></font>
 |  set_int_val(...)<font></font>
 |      set_int_val(self, int)<font></font>
 |      Set integer value<font></font>
 |  <font></font>
 |  set_string_val(...)<font></font>
 |      Set string value<font></font>
 |      set_string_val(self, str)<font></font>
...<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vereinfachen Sie dieses Beispiel, indem Sie die Standardwerte für die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Format-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Signaturparameter</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mithilfe der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anweisungen% DefaultDocstringFormat</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% DefaultDocstringSignature festlegen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Die Verwendung dieser Anweisungen wird im Beispiel aus dem Ordner </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_cpp_04 gezeigt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Die Datei </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoocpp.sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in diesem Beispiel enthält den folgenden Code:</font></font><br>
<br>
<pre><code class="cpp hljs">%Module(name=foocpp, language=<span class="hljs-string">"C++"</span>)<font></font>
%DefaultEncoding <span class="hljs-string">"UTF-8"</span>
%DefaultDocstringFormat <span class="hljs-string">"deindented"</span>
%DefaultDocstringSignature <span class="hljs-string">"prepended"</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Foo</span> {</span><font></font>
    %Docstring<font></font>
    Class example from C++ library<font></font>
    %End<font></font>
<font></font>
    %TypeHeaderCode<font></font>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;foo.h&gt;</span></span><font></font>
    %End<font></font>
<font></font>
    <span class="hljs-keyword">public</span>:<font></font>
        Foo(<span class="hljs-keyword">int</span>, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*);<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_int_val</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span></span>;<font></font>
        %Docstring<font></font>
            Set integer value<font></font>
        %<span class="hljs-function">End

        <span class="hljs-keyword">int</span> <span class="hljs-title">get_int_val</span><span class="hljs-params">()</span></span>;<font></font>
        %Docstring<font></font>
            Return integer value<font></font>
        %End<font></font>
<font></font>
        %Property(name=int_val, get=get_int_val, <span class="hljs-built_in">set</span>=set_int_val)<font></font>
        {<font></font>
            %Docstring<font></font>
                The property <span class="hljs-keyword">for</span> integer value<font></font>
            %End<font></font>
        };<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_string_val</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*)</span></span>;<font></font>
        %Docstring<font></font>
            Set <span class="hljs-built_in">string</span> value<font></font>
        %<span class="hljs-function">End

        <span class="hljs-keyword">char</span>* <span class="hljs-title">get_string_val</span><span class="hljs-params">()</span></span>;<font></font>
        %Docstring<font></font>
            Return <span class="hljs-built_in">string</span> value<font></font>
        %End<font></font>
<font></font>
        %Property(name=string_val, get=get_string_val, <span class="hljs-built_in">set</span>=set_string_val)<font></font>
        {<font></font>
            %Docstring<font></font>
                The property <span class="hljs-keyword">for</span> <span class="hljs-built_in">string</span> value<font></font>
            %End<font></font>
        };<font></font>
};<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Am Anfang der Datei wurden die Zeilen </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% DefaultDocstringFormat "deindented"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% DefaultDocstringSignature "prepended" hinzugefügt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , und dann wurden alle Parameter aus der Direktive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Docstring</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> entfernt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach dem Zusammenstellen und Installieren dieses Beispiels können wir sehen, wie die Beschreibung der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foo-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Klasse jetzt aussieht </font><font style="vertical-align: inherit;">, die im Befehl </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">help (Foo)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> angezeigt wird </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt;&gt;&gt; from foocpp import Foo<font></font>
&gt;&gt;&gt; help(Foo)<font></font>
<font></font>
class Foo(sip.wrapper)<font></font>
 |  Class example from C++ library<font></font>
 |  <font></font>
 |  Method resolution order:<font></font>
 |      Foo<font></font>
 |      sip.wrapper<font></font>
 |      sip.simplewrapper<font></font>
 |      builtins.object<font></font>
 |  <font></font>
 |  Methods defined here:<font></font>
 |  <font></font>
 |  get_int_val(...)<font></font>
 |      get_int_val(self) -&gt; int<font></font>
 |      Return integer value<font></font>
 |  <font></font>
 |  get_string_val(...)<font></font>
 |      get_string_val(self) -&gt; str<font></font>
 |      Return string value<font></font>
 |  <font></font>
 |  set_int_val(...)<font></font>
 |      set_int_val(self, int)<font></font>
 |      Set integer value<font></font>
 |  <font></font>
 |  set_string_val(...)<font></font>
 |      set_string_val(self, str)<font></font>
 |      Set string value<font></font>
...<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alles sieht ganz ordentlich und vom gleichen Typ aus.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Benennen Sie Klassen und Methoden um</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie bereits erwähnt, muss die von den Python-Bindungen bereitgestellte Schnittstelle nicht mit der von der C / C ++ - Bibliothek bereitgestellten Schnittstelle übereinstimmen. Wir haben den oben genannten Klassen Eigenschaften hinzugefügt und sehen uns nun eine weitere Technik an, die nützlich sein kann, wenn Konflikte zwischen Klassennamen oder Funktionen auftreten, z. B. wenn ein Funktionsname mit einem Python-Schlüsselwort übereinstimmt. Dazu können Sie Klassen, Funktionen, Ausnahmen und andere Entitäten umbenennen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zum Umbenennen einer Entität wird die Annotation </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyName verwendet</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , deren Wert einem neuen Entitätsnamen zugewiesen werden muss. Die Arbeit mit der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyName-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Annotation </font><i><font style="vertical-align: inherit;">wird</font></i><font style="vertical-align: inherit;"> im Beispiel aus dem Ordner </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_cpp_05 gezeigt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dieses Beispiel basiert auf dem vorherigen Beispiel.</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_cpp_04</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und unterscheidet sich davon durch die Datei </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoocpp.sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , deren Inhalt nun folgendermaßen aussieht:</font></font><br>
<br>
<pre><code class="cpp hljs">%Module(name=foocpp, language=<span class="hljs-string">"C++"</span>)<font></font>
%DefaultEncoding <span class="hljs-string">"UTF-8"</span>
%DefaultDocstringFormat <span class="hljs-string">"deindented"</span>
%DefaultDocstringSignature <span class="hljs-string">"prepended"</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Foo</span> /<span class="hljs-title">PyName</span>=<span class="hljs-title">Bar</span>/ {</span><font></font>
    %Docstring<font></font>
    Class example from C++ library<font></font>
    %End<font></font>
<font></font>
    %TypeHeaderCode<font></font>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;foo.h&gt;</span></span><font></font>
    %End<font></font>
<font></font>
    <span class="hljs-keyword">public</span>:<font></font>
        Foo(<span class="hljs-keyword">int</span>, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*);<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_int_val</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span> /PyName</span>=set_integer_value/;<font></font>
        %Docstring<font></font>
            Set integer value<font></font>
        %<span class="hljs-function">End

        <span class="hljs-keyword">int</span> <span class="hljs-title">get_int_val</span><span class="hljs-params">()</span> /PyName</span>=get_integer_value/;<font></font>
        %Docstring<font></font>
            Return integer value<font></font>
        %End<font></font>
<font></font>
        %Property(name=int_val, get=get_integer_value, <span class="hljs-built_in">set</span>=set_integer_value)<font></font>
        {<font></font>
            %Docstring<font></font>
                The property <span class="hljs-keyword">for</span> integer value<font></font>
            %End<font></font>
        };<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_string_val</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*)</span> /PyName</span>=set_string_value/;<font></font>
        %Docstring<font></font>
            Set <span class="hljs-built_in">string</span> value<font></font>
        %<span class="hljs-function">End

        <span class="hljs-keyword">char</span>* <span class="hljs-title">get_string_val</span><span class="hljs-params">()</span> /PyName</span>=get_string_value/;<font></font>
        %Docstring<font></font>
            Return <span class="hljs-built_in">string</span> value<font></font>
        %End<font></font>
<font></font>
        %Property(name=string_val, get=get_string_value, <span class="hljs-built_in">set</span>=set_string_value)<font></font>
        {<font></font>
            %Docstring<font></font>
                The property <span class="hljs-keyword">for</span> <span class="hljs-built_in">string</span> value<font></font>
            %End<font></font>
        };<font></font>
};<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Beispiel haben wir die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foo-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Klasse in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bar-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Klasse umbenannt </font><font style="vertical-align: inherit;">und allen Methoden mithilfe der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyName-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Annotation andere Namen zugewiesen </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ich denke, dass hier alles ganz einfach und klar ist. Das einzige, worauf man achten sollte, ist die Schaffung von Immobilien. </font><font style="vertical-align: inherit;">In der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Property-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Direktive müssen </font><font style="vertical-align: inherit;">die Parameter </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> die Namen der Methoden angeben, wie sie in der Python-Klasse aufgerufen werden, und nicht die Namen, nach denen sie ursprünglich im C ++ - Code aufgerufen wurden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kompilieren Sie das Beispiel, installieren Sie es und sehen Sie, wie diese Klasse in Python aussehen wird:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt;&gt;&gt; from foocpp import Bar<font></font>
&gt;&gt;&gt; help(Bar)<font></font>
<font></font>
Help on class Bar in module foocpp:<font></font>
<font></font>
class Bar(sip.wrapper)<font></font>
 |  Class example from C++ library<font></font>
 |  <font></font>
 |  Method resolution order:<font></font>
 |      Bar<font></font>
 |      sip.wrapper<font></font>
 |      sip.simplewrapper<font></font>
 |      builtins.object<font></font>
 |  <font></font>
 |  Methods defined here:<font></font>
 |  <font></font>
 |  get_integer_value(...)<font></font>
 |      get_integer_value(self) -&gt; int<font></font>
 |      Return integer value<font></font>
 |  <font></font>
 |  get_string_value(...)<font></font>
 |      get_string_value(self) -&gt; str<font></font>
 |      Return string value<font></font>
 |  <font></font>
 |  set_integer_value(...)<font></font>
 |      set_integer_value(self, int)<font></font>
 |      Set integer value<font></font>
 |  <font></font>
 |  set_string_value(...)<font></font>
 |      set_string_value(self, str)<font></font>
 |      Set string value<font></font>
 |  <font></font>
 |  ----------------------------------------------------------------------<font></font>
 |  Data descriptors defined here:<font></font>
 |  <font></font>
 |  __weakref__<font></font>
 |      list of weak references to the object (if defined)<font></font>
 |  <font></font>
 |  int_val<font></font>
 |      The property for integer value<font></font>
 |  <font></font>
 |  string_val<font></font>
 |      The property for string value<font></font>
 |  <font></font>
 |  ----------------------------------------------------------------------<font></font>
...<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es funktionierte! </font><font style="vertical-align: inherit;">Wir haben es geschafft, die Klasse selbst und ihre Methoden umzubenennen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Manchmal verwenden Bibliotheken die Vereinbarung, dass die Namen aller Klassen mit einem Präfix beginnen, z. B. mit dem Buchstaben „Q“ in Qt oder „wx“ in wxWidgets. </font><font style="vertical-align: inherit;">Wenn Sie in Ihrer Python-Bindung alle Klassen umbenennen und solche Präfixe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entfernen möchten</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , können Sie die Anweisung </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% AutoPyName verwenden</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , um die </font><i><font style="vertical-align: inherit;">PyName-</font></i><font style="vertical-align: inherit;"> Annotation nicht </font><font style="vertical-align: inherit;">für jede Klasse </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">festzulegen</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Wir werden diese Direktive in diesem Artikel nicht berücksichtigen. Wir werden nur sagen, dass sich die Direktive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% AutoPyName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> innerhalb der Direktive </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Module befinden sollte,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und uns auf ein Beispiel aus der Dokumentation beschränken:</font></font><br>
<br>
<pre><code class="plaintext hljs">%Module PyQt5.QtCore<font></font>
{<font></font>
    %AutoPyName(remove_leading="Q")<font></font>
}<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Typkonvertierung hinzufügen</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiel mit der Klasse std :: wstring</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bisher haben wir uns Funktionen und Klassen angesehen, die mit einfachen Typen wie </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char * gearbeitet haben</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Für diese Typen hat SIP automatisch einen Konverter zu und von Python-Klassen erstellt. Im folgenden Beispiel, das sich im Ordner </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_cpp_06 befindet</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , wird der Fall betrachtet, </font><font style="vertical-align: inherit;">in dem </font><i><font style="vertical-align: inherit;">Klassenmethoden</font></i><font style="vertical-align: inherit;"> komplexere Objekte akzeptieren und zurückgeben, z. B. Zeichenfolgen aus STL. Um das Beispiel zu vereinfachen und die Konvertierung von Bytes in Unicode und umgekehrt nicht zu erschweren, wird in diesem Beispiel die Zeichenfolgenklasse </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">std :: wstring</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> verwendet </font><font style="vertical-align: inherit;">. In diesem Beispiel soll gezeigt werden, wie Sie die Regeln für die Konvertierung von C ++ - Klassen in und aus Python-Klassen manuell festlegen können. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Beispiel ändern wir die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foo-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Klasse </font><font style="vertical-align: inherit;">aus der </font><i><font style="vertical-align: inherit;">Foo-</font></i><font style="vertical-align: inherit;"> Bibliothek</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Jetzt sieht die Klassendefinition folgendermaßen aus (Datei </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo.h</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> FOO_LIB</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FOO_LIB</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string&gt;</span></span><font></font>
<font></font>
<span class="hljs-keyword">using</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">wstring</span>;<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Foo</span> {</span>
    <span class="hljs-keyword">private</span>:
        <span class="hljs-keyword">int</span> _int_val;
        <span class="hljs-built_in">wstring</span> _string_val;
    <span class="hljs-keyword">public</span>:<font></font>
        Foo(<span class="hljs-keyword">int</span> int_val, <span class="hljs-built_in">wstring</span> string_val);<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_int_val</span><span class="hljs-params">(<span class="hljs-keyword">int</span> val)</span></span>;
        <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">get_int_val</span><span class="hljs-params">()</span></span>;<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_string_val</span><span class="hljs-params">(<span class="hljs-built_in">wstring</span> val)</span></span>;
        <span class="hljs-function"><span class="hljs-built_in">wstring</span> <span class="hljs-title">get_string_val</span><span class="hljs-params">()</span></span>;<font></font>
};<font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Implementierung der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foo-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Klasse </font><font style="vertical-align: inherit;">in der Datei </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo.cpp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string&gt;</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"foo.h"</span></span><font></font>
<font></font>
<span class="hljs-keyword">using</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">wstring</span>;<font></font>
<font></font>
Foo::Foo(<span class="hljs-keyword">int</span> int_val, <span class="hljs-built_in">wstring</span> string_val):<font></font>
    _int_val(int_val), _string_val(string_val) {}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Foo::set_int_val</span><span class="hljs-params">(<span class="hljs-keyword">int</span> val)</span> </span>{<font></font>
    _int_val = val;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Foo::get_int_val</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> _int_val;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Foo::set_string_val</span><span class="hljs-params">(<span class="hljs-built_in">wstring</span> val)</span> </span>{<font></font>
    _string_val = val;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-built_in">wstring</span> <span class="hljs-title">Foo::get_string_val</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> _string_val;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und die Datei </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main.cpp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zum Überprüfen der Funktionalität der Bibliothek:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"foo.h"</span></span><font></font>
<font></font>
<span class="hljs-keyword">using</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span>;
<span class="hljs-keyword">using</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>* argv[])</span> </span>{
    <span class="hljs-keyword">auto</span> foo = Foo(<span class="hljs-number">10</span>, <span class="hljs-string">L"Hello"</span>);
    <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">L"int_val: "</span> &lt;&lt; foo.get_int_val() &lt;&lt; <span class="hljs-built_in">endl</span>;
    <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">L"string_val: "</span> &lt;&lt; foo.get_string_val().c_str() &lt;&lt; <span class="hljs-built_in">endl</span>;<font></font>
<font></font>
    foo.set_int_val(<span class="hljs-number">0</span>);<font></font>
    foo.set_string_val(<span class="hljs-string">L"Hello world!"</span>);<font></font>
<font></font>
    <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">L"int_val: "</span> &lt;&lt; foo.get_int_val() &lt;&lt; <span class="hljs-built_in">endl</span>;
    <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">L"string_val: "</span> &lt;&lt; foo.get_string_val().c_str() &lt;&lt; <span class="hljs-built_in">endl</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dateien </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo.h</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo.cpp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main.cpp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nach wie vor befinden sich </font><font style="vertical-align: inherit;">in den </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ordner </font><font style="vertical-align: inherit;">. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Erstellungsprozess für </font><i><font style="vertical-align: inherit;">Makefile</font></i><font style="vertical-align: inherit;"> und Bibliothek hat sich nicht geändert. </font><font style="vertical-align: inherit;">Es gibt auch keine wesentlichen Änderungen an den Dateien </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Datei </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoocpp.sip ist jedoch</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> merklich komplizierter geworden:</font></font><br>
<br>
<pre><code class="cpp hljs">%Module(name=foocpp, language=<span class="hljs-string">"C++"</span>)<font></font>
%DefaultEncoding <span class="hljs-string">"UTF-8"</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Foo</span> {</span><font></font>
    %TypeHeaderCode<font></font>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;foo.h&gt;</span></span><font></font>
    %End<font></font>
<font></font>
    <span class="hljs-keyword">public</span>:<font></font>
        Foo(<span class="hljs-keyword">int</span>, <span class="hljs-built_in">std</span>::<span class="hljs-built_in">wstring</span>);<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_int_val</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span></span>;
        <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">get_int_val</span><span class="hljs-params">()</span></span>;<font></font>
        %Property(name=int_val, get=get_int_val, <span class="hljs-built_in">set</span>=set_int_val)<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_string_val</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">wstring</span>)</span></span>;
        <span class="hljs-function"><span class="hljs-built_in">std</span>::<span class="hljs-built_in">wstring</span> <span class="hljs-title">get_string_val</span><span class="hljs-params">()</span></span>;<font></font>
        %Property(name=string_val, get=get_string_val, <span class="hljs-built_in">set</span>=set_string_val)<font></font>
};<font></font>
<font></font>
%MappedType <span class="hljs-built_in">std</span>::<span class="hljs-built_in">wstring</span><font></font>
{<font></font>
%TypeHeaderCode<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string&gt;</span></span><font></font>
%End<font></font>
<font></font>
%ConvertFromTypeCode<font></font>
    <span class="hljs-comment">// Convert an std::wstring to a Python (Unicode) string</span><font></font>
    PyObject* newstring;<font></font>
    newstring = PyUnicode_FromWideChar(sipCpp-&gt;data(), <span class="hljs-number">-1</span>);
    <span class="hljs-keyword">return</span> newstring;<font></font>
%End<font></font>
<font></font>
%ConvertToTypeCode<font></font>
    <span class="hljs-comment">// Convert a Python (Unicode) string to an std::wstring</span>
    <span class="hljs-keyword">if</span> (sipIsErr == <span class="hljs-literal">NULL</span>) {
        <span class="hljs-keyword">return</span> PyUnicode_Check(sipPy);<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> (PyUnicode_Check(sipPy)) {<font></font>
        *sipCppPtr = <span class="hljs-keyword">new</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">wstring</span>(PyUnicode_AS_UNICODE(sipPy));
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
%End<font></font>
};<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zur Veranschaulichung </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">werden in der</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Datei </font><i><font style="vertical-align: inherit;">pyfoocpp.sip keine</font></i><font style="vertical-align: inherit;"> Dokumentationszeilen hinzugefügt. Wenn wir </font><font style="vertical-align: inherit;">nur die Deklaration der </font><i><font style="vertical-align: inherit;">Foo-</font></i><font style="vertical-align: inherit;"> Klasse </font><font style="vertical-align: inherit;">in der Datei </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoocpp.sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ohne die nachfolgende Direktive </font><i><font style="vertical-align: inherit;">% MappedType belassen</font></i><font style="vertical-align: inherit;"> würden, würden wir während des Erstellungsprozesses den folgenden Fehler erhalten:</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="plaintext hljs">$ sip-wheel<font></font>
<font></font>
These bindings will be built: pyfoocpp.<font></font>
Generating the pyfoocpp bindings...<font></font>
sip-wheel: std::wstring is undefined<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir müssen explizit beschreiben, wie ein Objekt vom Typ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">std :: wstring</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in ein Python-Objekt konvertiert wird, und auch die inverse Transformation beschreiben. Um die Konvertierung zu beschreiben, müssen wir in der C-Sprache auf einem relativ niedrigen Niveau arbeiten und die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python / C-API verwenden</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Da die Python / C-API ein großes Thema ist, das nur einen separaten Artikel, aber ein Buch verdient, werden in diesem Abschnitt nur die Funktionen betrachtet, die im Beispiel verwendet werden, ohne zu sehr ins Detail zu gehen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um Konvertierungen von C ++ - Objekten nach Python zu deklarieren und umgekehrt, ist die Direktive </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% MappedType vorgesehen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , in der sich drei weitere Direktiven befinden können: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% TypeHeaderCode</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% ConvertToTypeCode</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% ConvertFromTypeCode</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Nach dem </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% MappedType-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ausdruck müssen </font><font style="vertical-align: inherit;">Sie den Typ angeben, für den Konverter erstellt werden. </font><font style="vertical-align: inherit;">In unserem Fall beginnt die Direktive mit dem Ausdruck </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% MappedType std :: wstring</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Wir haben die </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Direktive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% TypeHeaderCode bereits</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> im Abschnitt </font><i><font style="vertical-align: inherit;">Erstellen </font></i></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einer Bindung für eine Bibliothek in C ++</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erfüllt </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ich möchte Sie daran erinnern, dass diese Direktive die verwendeten Typen deklarieren oder die Header-Dateien enthalten soll, in denen sie deklariert sind. </font><font style="vertical-align: inherit;">In diesem Beispiel </font><font style="vertical-align: inherit;">wird die Header - </font><font style="vertical-align: inherit;">Datei </font><i><font style="vertical-align: inherit;">String</font></i><font style="vertical-align: inherit;"> , wo die Klasse </font><i><font style="vertical-align: inherit;">std :: string wird</font></i><font style="vertical-align: inherit;"> deklariert, wird </font><font style="vertical-align: inherit;">verbunden </font><font style="vertical-align: inherit;">innerhalb der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% TypeHeaderCode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Richtlinie </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">
Jetzt müssen wir die Transformationen beschreiben</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% ConvertFromTypeCode. </font><font style="vertical-align: inherit;">Konvertieren von C ++ - Objekten in Python</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir beginnen mit der Konvertierung von </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">std :: wstring-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Objekten in die </font><font style="vertical-align: inherit;">Python- </font><font style="vertical-align: inherit;">Klasse </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">str</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Diese Konvertierung im Beispiel lautet wie folgt:</font></font><br>
<br>
<pre><code class="cpp hljs">%ConvertFromTypeCode
    <span class="hljs-comment">// Convert an std::wstring to a Python (Unicode) string</span><font></font>
    PyObject* newstring;<font></font>
    newstring = PyUnicode_FromWideChar(sipCpp-&gt;data(), <span class="hljs-number">-1</span>);
    <span class="hljs-keyword">return</span> newstring;<font></font>
%End<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In dieser Direktive befindet sich die Variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sipCpp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ein Zeiger auf ein Objekt aus C ++ - Code, mit dem wir ein Python-Objekt erstellen und das erstellte Objekt mithilfe der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">return-Anweisung</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aus der Direktive </font><i><font style="vertical-align: inherit;">zurückgeben müssen</font></i><font style="vertical-align: inherit;"> . In diesem Fall ist die Variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sipCpp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vom Typ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">std :: wstring *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Verwenden </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Sie</font></a><font style="vertical-align: inherit;"> zum Erstellen der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">str-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Klasse </font><font style="vertical-align: inherit;">die Funktion </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyUnicode_FromWideChar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aus der Python / C-API. Diese Funktion akzeptiert ein Array (Zeiger) vom Typ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const wchar_t * w</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> als ersten Parameter </font><font style="vertical-align: inherit;">und die Größe dieses Arrays als zweiten Parameter. Wenn Sie den Wert -1 als zweiten Parameter übergeben, </font><font style="vertical-align: inherit;">berechnet die </font><font style="vertical-align: inherit;">Funktion </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyUnicode_FromWideChar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> selbst die Länge mithilfe der Funktion</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wcslen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die bekommen </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wchar_t *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Array, </font><font style="vertical-align: inherit;">verwendet , um </font><font style="vertical-align: inherit;">die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daten</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Methode </font><font style="vertical-align: inherit;">aus dem </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">std :: wstring</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Klasse </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Funktion </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyUnicode_FromWideChar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gibt im </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fehlerfall</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> einen Zeiger auf </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">PyObject</font></a><font style="vertical-align: inherit;"> oder </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NULL</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zurück. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyObject</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist ein beliebiges Python-Objekt. In diesem Fall handelt es sich um die Klasse </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">str</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">In der Python / C-API erfolgt die Arbeit mit Objekten normalerweise über </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyObject * -Zeiger.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In diesem Fall geben </font><font style="vertical-align: inherit;">wir den </font><i><font style="vertical-align: inherit;">PyObject * -Zeiger</font></i><font style="vertical-align: inherit;"> aus der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% ConvertFromTypeCode-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Direktive zurück </font><font style="vertical-align: inherit;">.</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% ConvertToTypeCode. </font><font style="vertical-align: inherit;">Konvertieren Sie Python-Objekte in C ++</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die inverse Konvertierung von einem Python-Objekt (im Wesentlichen von </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyObject *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) in die Klasse </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">std :: wstring</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wird </font><font style="vertical-align: inherit;">in der Direktive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% ConvertToTypeCode beschrieben</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Im Beispiel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_cpp_06</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lautet </font><i><font style="vertical-align: inherit;">die</font></i><font style="vertical-align: inherit;"> Konvertierung wie folgt:</font></font><br>
<br>
<pre><code class="cpp hljs">%ConvertToTypeCode
    <span class="hljs-comment">// Convert a Python (Unicode) string to an std::wstring</span>
    <span class="hljs-keyword">if</span> (sipIsErr == <span class="hljs-literal">NULL</span>) {
        <span class="hljs-keyword">return</span> PyUnicode_Check(sipPy);<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> (PyUnicode_Check(sipPy)) {<font></font>
        *sipCppPtr = <span class="hljs-keyword">new</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">wstring</span>(PyUnicode_AS_UNICODE(sipPy));
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
%End<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Code der Direktive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% ConvertToTypeCode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sieht komplizierter aus, da er während des Konvertierungsprozesses für verschiedene Zwecke mehrmals aufgerufen wird. Innerhalb der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% ConvertToTypeCode-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Direktive </font><font style="vertical-align: inherit;">erstellt SIP mehrere Variablen, die wir verwenden können (oder sollten). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine dieser Variablen, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyObject * sipPy,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist ein Python-Objekt, das Sie in diesem Fall benötigen, um eine Instanz der Klasse </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">std :: wstring</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zu erstellen </font><font style="vertical-align: inherit;">. Das Ergebnis muss in eine andere Variable geschrieben werden - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sipCppPtr</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist ein Doppelzeiger auf das erstellte Objekt, d. H. In unserem Fall ist diese Variable vom Typ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">std :: wstring **</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein weiterer </font><i><font style="vertical-align: inherit;">% ConvertToTypeCode,</font></i><font style="vertical-align: inherit;"> der innerhalb der Direktive erstellt wurde</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Variable ist </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int * sipIsErr</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Wenn der Wert dieser Variablen </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NULL ist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , wird die Direktive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% ConvertToTypeCode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nur aufgerufen, um zu überprüfen, ob eine Typkonvertierung möglich ist. In diesem Fall sind wir nicht verpflichtet, die Transformation durchzuführen, sondern müssen nur prüfen, ob dies grundsätzlich möglich ist. Wenn möglich, muss die Direktive einen Wert ungleich Null zurückgeben. Wenn keine Konvertierung möglich ist, müssen sie 0 zurückgeben. Wenn dieser Zeiger nicht </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NULL ist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , müssen Sie die Konvertierung durchführen. Wenn während der Konvertierung ein Fehler auftritt, kann der ganzzahlige Fehlercode gespeichert werden in diese Variable (vorausgesetzt, diese Variable ist ein Zeiger auf </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Beispiel wird </font><font style="vertical-align: inherit;">das </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">PyUnicode_Check-</font></a><font style="vertical-align: inherit;"> Makro </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">verwendet</font></a><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">um zu überprüfen, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ob sipPy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eine Unicode-Zeichenfolge (Klasse </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">str</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) ist. Dabei </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wird</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ein Argument vom Typ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyObject * verwendet,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wenn das übergebene Argument eine Unicode-Zeichenfolge oder eine davon abgeleitete Klasse ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Konvertierung in ein C ++ - Objekt erfolgt mit der Zeichenfolge </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* sipCppPtr = new std :: wstring (PyUnicode_AS_UNICODE (sipPy));</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Hier wird das Makro </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyUnicode_AS_UNICODE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> von der Python / C-API </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">aufgerufen</font></a><font style="vertical-align: inherit;"> , die ein Array vom Typ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Py_UNICODE * zurückgibt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , das </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wchar_t * entspricht</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dieses Array wird an den Konstruktor der Klasse </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">std :: wstring übergeben</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Wie oben erwähnt, wird das Ergebnis in der Variablen </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sipCppPtr</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gespeichert </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Moment ist die Anweisung </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyUnicode_AS_UNICODE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> veraltet und es wird empfohlen, andere Makros zu verwenden. Dieses Makro wird jedoch verwendet, um das Beispiel zu vereinfachen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn die Konvertierung erfolgreich war, sollte die Direktive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% ConvertToTypeCode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> einen Wert ungleich Null (in diesem Fall 1) und im Fehlerfall 0 zurückgeben.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Prüfen </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben die Konvertierung des Typs </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">std :: wstring</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">str beschrieben</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und umgekehrt. Jetzt können wir sicherstellen, dass das Paket erfolgreich erstellt wurde und die Bindung </font><i><font style="vertical-align: inherit;">ordnungsgemäß</font></i><font style="vertical-align: inherit;"> funktioniert. </font><font style="vertical-align: inherit;">Rufen Sie zum Erstellen </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-whe auf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , installieren Sie das Paket mit pip und überprüfen Sie die Funktionsfähigkeit im Python-Befehlsmodus:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> foocpp <span class="hljs-keyword">import</span> Foo
<span class="hljs-meta">&gt;&gt;&gt; </span>x = Foo(<span class="hljs-number">10</span>, <span class="hljs-string">'Hello'</span>)<font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>x.string_val
<span class="hljs-string">'Hello'</span><font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>x.string_val = <span class="hljs-string">''</span>
<span class="hljs-meta">&gt;&gt;&gt; </span>x.string_val
<span class="hljs-string">''</span><font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>x.get_string_val()
<span class="hljs-string">''</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie sehen können, funktioniert alles, es gibt auch keine Probleme mit der russischen Sprache, d. H. </font><font style="vertical-align: inherit;">Unicode-String-Konvertierungen wurden korrekt ausgeführt.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Artikel haben wir die Grundlagen der Verwendung von SIP zum Erstellen von Python-Bindungen für in C und C ++ geschriebene Bibliotheken behandelt. </font><font style="vertical-align: inherit;">Zuerst (im </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ersten Teil</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) haben wir eine einfache Bibliothek in C erstellt und die Dateien herausgefunden, die für die Arbeit mit SIP erstellt werden müssen. </font><font style="vertical-align: inherit;">Die Datei </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> enthält Informationen zum Paket (Name, Versionsnummer, Lizenz und Pfade zu Header- und Objektdateien). </font><font style="vertical-align: inherit;">Mit der Datei </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> können </font><font style="vertical-align: inherit;">Sie den Prozess des Erstellens des Python-Pakets beeinflussen, z. B. mit dem Erstellen der C / C ++ - Bibliothek beginnen oder dem Benutzer erlauben, den Speicherort der Header- und Objektdateien der Bibliothek anzugeben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der </font><i><font style="vertical-align: inherit;">* .sip-</font></i><font style="vertical-align: inherit;"> Datei</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">beschreibt die Schnittstelle des Python-Moduls und listet die Funktionen und Klassen auf, die im Modul enthalten sein werden. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anweisungen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und Anmerkungen werden verwendet </font><font style="vertical-align: inherit;">, um die Schnittstelle in der </font><i><font style="vertical-align: inherit;">* .sip-</font></i><font style="vertical-align: inherit;"> Datei zu beschreiben </font><font style="vertical-align: inherit;">. Die Python-Klassenschnittstelle muss nicht mit der C ++ - Klassenschnittstelle übereinstimmen. Sie können beispielsweise Klassen mithilfe der Direktive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Property</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Eigenschaften hinzufügen </font><font style="vertical-align: inherit;">, Entitäten mithilfe der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anweisung / PyName /</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> annotation umbenennen </font><font style="vertical-align: inherit;">und Dokumentationszeilen mithilfe der Direktive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Docstring hinzufügen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Elementartypen wie </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usw. SIP konvertiert automatisch in ähnliche Python-Klassen. Wenn Sie jedoch eine komplexere Konvertierung durchführen müssen, müssen Sie diese </font><font style="vertical-align: inherit;">mithilfe der Python / C-API </font><font style="vertical-align: inherit;">selbst in der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% MappedType-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Direktive </font><i><font style="vertical-align: inherit;">programmieren</font></i><font style="vertical-align: inherit;"> . Die Konvertierung von der Python-Klasse in C ++ muss in der verschachtelten Direktive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% ConvertToTypeCode erfolgen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Das Konvertieren von einem C ++ - Typ in eine Python-Klasse muss in der verschachtelten Direktive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% ConvertFromTypeCode erfolgen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Einige Anweisungen wie </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% DefaultEncoding</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% DefaultDocstringFormat</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% DefaultDocstringSignature</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sind Hilfsanweisungen und ermöglichen das </font><i><font style="vertical-align: inherit;">Festlegen von</font></i><font style="vertical-align: inherit;"> Standardwerten für Fälle, in denen einige Anmerkungsparameter nicht explizit festgelegt werden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Artikel haben wir nur die grundlegenden und einfachsten Anweisungen und Anmerkungen untersucht, aber viele davon wurden ignoriert. </font><font style="vertical-align: inherit;">Beispielsweise gibt es Anweisungen zum Verwalten von GIL, zum Erstellen neuer Python-Ausnahmen, zum manuellen Verwalten von Speicher- und Garbage Collectors, zum Optimieren von Klassen für verschiedene Betriebssysteme und viele andere, die beim Erstellen von Bindungen komplexer C / C ++ - Bibliotheken hilfreich sein können. </font><font style="vertical-align: inherit;">Wir haben auch das Problem der Erstellung von Paketen für verschiedene Betriebssysteme umgangen und uns darauf beschränkt, unter Linux mit gcc / g ++ - Compilern zu erstellen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verweise</font></font></h2><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der erste Teil des Artikels</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiele für diesen Artikel</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SIP-Homepage</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dokumentation für SIP</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python / C-API-Dokumentation</font></font></a></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de495618/index.html">Quarantäne führt zu Verlusten. Wie lebe ich ohne Quarantäne?</a></li>
<li><a href="../de495620/index.html">Montierte einen Videokonferenz-Harvester bei Jabra Panacast, Vor- und Nachteile für Büro und Zuhause</a></li>
<li><a href="../de495622/index.html">Flugzeuge mit digitaler Doppelklimaanlage (SLE)</a></li>
<li><a href="../de495624/index.html">Warum die Xbox Series X der Hauptkauf von 2020 sein wird</a></li>
<li><a href="../de495634/index.html">Jeder tut es: Warum Mitarbeiter die Hauptbedrohung für die Informationssicherheit von Unternehmen darstellen und wie damit umzugehen ist</a></li>
<li><a href="../de495638/index.html">Komma in Englisch: 5 Regeln und Top 3 Fehler</a></li>
<li><a href="../de495642/index.html">Sammeln Sie Fehler in den Kopierfunktionen</a></li>
<li><a href="../de495644/index.html">TS Total Sight. Tool zur Ereigniserfassung, Vorfallanalyse und Automatisierung von Bedrohungsreaktionen</a></li>
<li><a href="../de495646/index.html">Was für stressfreie Podcasts am Wochenende zu hören sind</a></li>
<li><a href="../de495658/index.html">Wo Sie Audio für maschinelles Lernen erhalten: Eine Auswahl offener Bibliotheken, die unter Creative Commons lizenziert sind</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>