<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏽‍⚕️ 📆 🍑 Yandex：大人のスマートホーム 🎙️ 🎟️ 🕌</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="最近、Yandexはスマートホームシステムを発売しました。私たちは安価なWi-Fiデバイスを購入するために提供されています：コンセントのアダプター、電球、IRリモコン。興味深いのは、「スマート」デバイスの開発者が「スマートホーム」スキルを作成する機会があることです。これにより、デバイスをYandex...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Yandex：大人のスマートホーム</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/465537/"><img src="https://habrastorage.org/webt/rs/l_/lm/rsl_lmpzna0pj3o9ahxzsawpsn0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最近、Yandexはスマートホームシステムを発売しました。私たちは安価なWi-Fiデバイスを購入するために提供されています：コンセントのアダプター、電球、IRリモコン。興味深いのは、「スマート」デバイスの開発者が「スマートホーム」スキルを作成する機会があることです。これにより、デバイスをYandexシステムに接続し、Aliceを介して音声を管理できます。ますます新しいブランドがスキルリストに表示されます。アリスはロシアのスピーチを完全に理解しているため、ロシア市場の音声アシスタントの中で誰もが認めるリーダーとなっています。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、すべてがそれほどスムーズではありません...</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初のマイナス：基本的に、提案されたシステムはすべて「曇り」です。パフォーマンスはメーカーのサーバーとの接続の品質に直接依存するため、信頼性は疑わしい場合があります。また、インターネットをオフにすると、デバイスは完全に「カボチャ」になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目のマイナス：スクリプトシステム。スマートホームの重要な部分はスクリプトです。そして、ここではそれらは非常に原始的です：「フレーズがそのようなものである」場合、「デバイスはそのようなものです。」を有効にします。私のスマートホームでは、これは少なすぎました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
短所はそこで終わりませんが、残りはシステムの未熟さに関連している可能性が高くなります。 Yandex開発チームは、さまざまな機能と編集するバグを積極的に追加し続けています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ドキュメンテーションを検討した後、Yandex UDスキルを作成し、スマートホームコントローラーをそれに接続することにしました。</font><font style="vertical-align: inherit;">これにより、クラウドサーバーに依存せず、コントローラーにローカルでスクリプトを実装し、同時にアリスを介して音声でシステムを制御できます。</font><font style="vertical-align: inherit;">このために、Node.jsでプラグイン「yandex2mqtt」を作成しました。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">理論のビット</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -アリス、ライトをつけて。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このフレーズの後、魔法が起こり、ライトが点灯します。しかし、舞台裏には何がありますか？すべてがどのように機能するかを見てみましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yandexステーションは、おなじみのコマンドを聞いて、コントローラーのアドレスを事前に指定したYandexサーバーにデータを送信します。サーバーは情報を処理し、Postリクエストの形式でコントローラーにリダイレクトします。コントローラーでは、中間API（この場合、これはyandex2mqttプラグインです）が要求を処理し、MQTTトピックにリダイレクトします。次に、スクリプトはNode-Redプログラムで処理されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Node-Redは次に何をするかを決定します。スクリプトによって提供されている場合、対応するトピックMQTTのライトをオンにするコマンドを送信します。 wb-mqtt-serialドライバーは、リレーを切り替えるリレーモジュールにModbusコマンドを送信して応答します。そして最後に、ライトが点灯します！はい、パスは近くありませんが、ユーザーの2番目のパスの数分の1です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
yandex2mqttプラグインを詳しく見てみましょう。 Yandexがスキルを機能させるために最初に必要とするのは、YandexアプリケーションでアカウントをバンドルするためのoAuthサービスです。 Yandexは、oAuthサービスから認証トークンを受信すると、デバイスのリストを要求します。 yandex2mqttプラグインは、json形式のすべてのプロパティを持つデバイスのリストで応答します。次に、それらは（いわゆるクエーサーで）制御可能なデバイスのリストに表示されます。ここで、リストからデバイスをオンにするようにアリスに指示すると、Yandexは、オンにするデバイスのデータを含むPostリクエストをコントローラーに送信します。応答として、プラグインは包含を確認し、同じ状態のプラグインの設定で指定されたmqttトピックに新しい状態を書き込みます。デバイスがYandexなしでステータスを変更した場合、プラグインはmqttトピックで新しいデータを表示し、クエーサーでデバイス自体に入った場合にのみ、ステータスが要求されたときにYandexに送信されます。その他の場合、Yandexはステータスをポーリングしません。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、Yandex UDデバイスのいくつかのプロパティについて説明します。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デバイスタイプ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「クエーサー」での正しい表示と、アリスによるコマンドのより正確な定義のために、Yandexは異なるタイプのデバイスをデバイスに割り当てることを提案しています。</font><font style="vertical-align: inherit;">合計タイプ10：</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devices.types.light-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ランプ、シャンデリア、電球など。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devices.types.socket-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンセント</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devices.types.switch-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スイッチ</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devices.types.thermostat-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーモスタット</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devices.types.thermostat.ac-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エアコン</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devices.types.media_device-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メディアデバイス</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devices.types.media_device.tv</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -TV</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devices.types.cooking-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キッチン家電</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devices.types.cooking.kettle-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メーカー</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devices.types.other-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前の段落に適合しなかったその他すべて。</font></font></li>
</ul><br>
<h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">能力</font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各デバイスには、少なくとも1つの</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">機能</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">も必要</font><font style="vertical-align: inherit;">です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yandex UDには、合計5種類のスキルがあります。</font><font style="vertical-align: inherit;">各スキルには異なる機能</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（インスタンス）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">があり、一部のスキルにはそのような機能がいくつかあり、デバイスを構成するときに柔軟性が追加されます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">機能：</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
1. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devices.capabilities.on_off-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オンとオフを</font><b><font style="vertical-align: inherit;">切り替え</font></b><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インスタンス：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オン</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devices.capabilities.color_setting-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">色の管理。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インスタンス：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RGB</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HSV</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> temperature_k</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devices.capabilities.mode-モードを切り替えます。</font></font></b><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インスタンス：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーモスタット</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファン回転速度</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devices.capabilities.range-範囲制御。</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インスタンス：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">輝度</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">温度</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ボリューム</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チャネル</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devices.capabilities.toggle-ミュート。</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インスタンス：</font></font><br>
 <br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ミュート</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デバイスのすべてのプロパティの適切な組み合わせにより、アリスはスマートホームを管理するためのすべてのコマンドを問題なく理解します。</font><font style="vertical-align: inherit;">もちろん、ここではスキルを組み合わせるのにいくつかの困難があります。</font><font style="vertical-align: inherit;">ドキュメントには、どのスキルを組み合わせることができ、どのスキルを組み合わせることができないかは明確に示されていません。</font><font style="vertical-align: inherit;">しかし、「科学的な突っ込み方法」がこれを支援します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、たとえば、エアコンには4つのスキルが含まれていることがわかりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デバイスタイプ：</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devices.types.thermostat.ac</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
スキルのタイプ：</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devices.capabilities.on_off</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
インスタンス：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オン</font></font></li>
</ul><br>
 <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devices.capabilities.range</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
インスタンス：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">温度</font></font></li>
</ul><br>
 <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devices.capabilities.mode</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
インスタンス：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーモスタット</font></font></li>
</ul><br>
 <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devices.capabilities.mode</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
インスタンス：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファン回転速度</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残りのプロパティについては説明しません。すべてが非常に単純です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを機能させるには、次のものが必要です。</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コントローラ</font></font></b></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任意のドメイン</font></font></b></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSL証明書</font></font></b></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Node.js</font></font></b></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex2mqttプラグイン</font></font></b></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MQTTブローカー</font></font></b></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ノードレッド</font></font></b></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コントローラ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の「スマート」アパートメントはWiren Board 6によって制御されていますが、Node.jsとNode-Redをプルする他のLinuxコントローラーを使用できます。</font><font style="vertical-align: inherit;">たとえば、Raspberry piまたはPC。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドメイン</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、白いIPアドレスとドメインを購入することが望ましいですが、これは必須ではありません。</font><font style="vertical-align: inherit;">DDNSを使用できます-たとえば、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.noip.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここではすべてが簡単です。登録し、無料のホスト名を作成し、IPアドレスを入力します。</font><font style="vertical-align: inherit;">一部のルーターには、noip.comデータを入力できる特別なDDNS設定があります。</font><font style="vertical-align: inherit;">ルーターは、変更されると自動的にIPアドレスを送信します。</font><font style="vertical-align: inherit;">ルータにそのような設定がない場合は、コントローラにnoipプログラムをインストールして、自動実行に追加できます。</font><font style="vertical-align: inherit;">このプログラムは、特別なDDNS設定を持つルーターとまったく同じことを行います-noip.comデータベースのIPアドレスを更新するため、</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべての要求をコントローラーにリダイレクトする静的アドレスがあります。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポート443および80</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在、家庭のほとんどすべての人がルーターを持っています。</font><font style="vertical-align: inherit;">その明白な機能に加えて、それはまた、外部からの不要なゲストからのローカルネットワークへの障壁でもあります。</font><font style="vertical-align: inherit;">ただし、場合によっては、外部から内部ネットワークにアクセスする必要があります。</font><font style="vertical-align: inherit;">ルーターメーカーはこれを提供し、NAT（ネットワークアドレス変換）機能を追加しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ルーターの設定はメーカーごとに異なりますので、塗装は致しません。</font><font style="vertical-align: inherit;">これを行う方法については、ルーターの説明をお読みください。</font><font style="vertical-align: inherit;">Googleキーワード：ポート転送、ポートマッピング、NAT。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
yandex2mqtt（多分私は443を選択しました）とポート80（SSL証明書を取得するためにのみ必要です。証明書を受け取った後、ポート80を閉じることができます）にアクセスするには、ポートを転送する必要があります。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSL証明書</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すぐにすべてのドットを「および」の上に置きます。自己署名証明書は機能しません。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ほとんどのドメインレジストラー（たとえば、reg.ru）は、メインドメイン（www.yourdomain.ru）用の無料のSSL証明書を顧客に提供します。 Alice専用のドメインを購入した場合は、提供されたSSL証明書を使用できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
独自のドメインがない場合、またはAliceに割り当てられた別のサブドメイン（alice.yourdomain.ruなど）がある場合は、このサブドメインまたはDDNSサービスによって提供されるアドレスの証明書を取得する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを行うには、letsencrypt.orgからSSL証明書を取得するための無料サービスを使用することをお勧めします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
証明書を取得するには、certbotプログラムをインストールして実行し、要求するすべてのデータを指定する必要があります。</font><font style="vertical-align: inherit;">同時に、ポート80は自由で外部からアクセスできる必要があります。letsencryptからの指示を注意深く検討することをお勧めします。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">certbotをインストールして構成する</font></font></b><div class="spoiler_text"><pre><code class="bash hljs">apt-get update<font></font>
apt-get install certbot</code></pre><br>
<br>
  watchdog  nginx.<br>
<br>
<pre><code class="bash hljs">service watchdog stop<font></font>
service nginx stop</code></pre><br>
 80   .<br>
<br>
  certbot:<br>
<br>
<pre><code class="bash hljs">certbot certonly --standalone</code></pre><br>
      <br>
<br>
1.  e-mail.      enter<br>
<br>
<img src="https://habrastorage.org/webt/mn/gf/si/mngfsiaatuo6txsrtc6wyyz4v_o.png"><br>
<br>
2.     .     ,   “A”,   Agree,   .<br>
<br>
<img src="https://habrastorage.org/webt/y8/zz/to/y8zztosybjouwmncxuawmbq-55c.png"><br>
<br>
3.          .  N. <br>
<br>
<img src="https://habrastorage.org/webt/pn/y_/yw/pny_ywp5pjfj7gupd09m3hnbmg4.png"><br>
<br>
4.   ,      (  ,     noip ).      .  http://   . <br>
<br>
<img src="https://habrastorage.org/webt/mt/bj/py/mtbjpyenb63jqv3gvtd_oyh9qze.png"><br>
<br>
    ,   :<br>
<br>
<img src="https://habrastorage.org/webt/ug/7c/kf/ug7ckfuvos8bkgfgzvaepqvu48s.png"><br>
<br>
,   .      ,      yandex2mqtt.    80    ,    . <br>
<br>
  watchdog  nginx.<br>
<br>
<pre><code class="bash hljs">service nginx start<font></font>
service watchdog start</code></pre><br>
  letsencrypt   <b>3</b> . <b>  .</b><br>
<br>
</div></div><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Node.jsとyandex2mqttプラグイン</font></font></h4><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">取り付け</font></font></b><div class="spoiler_text">  node.js<br>
<br>
<pre><code class="bash hljs">curl -sL https://deb.nodesource.com/setup_10.x | bash -</code></pre><br>
      <br>
<br>
<pre><code class="bash hljs">apt-get install -y nodejs git make g++ gcc build-essential</code></pre><br>
     yandex2mqtt  . <br>
<br>
<pre><code class="bash hljs">git <span class="hljs-built_in">clone</span> https://github.com/munrexio/yandex2mqtt.git /mnt/data/root/yandex2mqtt</code></pre><br>
 .<br>
<br>
<pre><code class="bash hljs">chown -R root:root /mnt/data/root/yandex2mqtt</code></pre><br>
  .<br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> /mnt/data/root/yandex2mqtt</code></pre><br>
 .<br>
<br>
<pre><code class="bash hljs">npm install</code></pre><br>
 .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自動スタート</font></font></b><div class="spoiler_text"><b>C  systemd:</b><br>
<br>
   <b>/etc/systemd/system/</b>        <b>yandex2mqtt.service</b>.    :<br>
<br>
<pre><code class="bash hljs">[Unit]<font></font>
Description=yandex2mqtt<font></font>
After=network.target<font></font>
<font></font>
[Service]<font></font>
ExecStart=/usr/bin/npm start<font></font>
WorkingDirectory=/mnt/data/root/yandex2mqtt<font></font>
StandardOutput=inherit<font></font>
StandardError=inherit<font></font>
Restart=always<font></font>
User=root<font></font>
<font></font>
[Install]<font></font>
WantedBy=multi-user.target</code></pre><br>
      . <br>
<br>
      :<br>
<br>
<pre><code class="bash hljs">systemctl <span class="hljs-built_in">enable</span> yandex2mqtt.service</code></pre><br>
<br>
      <br>
<br>
<pre><code class="bash hljs">service yandex2mqtt start<font></font>
service yandex2mqtt stop<font></font>
service yandex2mqtt restart</code></pre><br>
</div></div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">設定：</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
必要なすべてのプラグイン設定は、ファイル</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/mnt/data/root/yandex2mqtt/config.jsにあり</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ます。パラメーターに従ってこのファイルを編集します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SSL証明書は</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フルチェーンである</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要があります</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
設定後、次のコマンドでyandex2mqttを実行します：</font></font><br>
<br>
<pre><code class="bash hljs">service yandex2mqtt start</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ブリッジをセットアップして開始したら、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このサイトで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">証明書を確認することをお勧めします</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aliceへのアクセスに使用するドメインを入力してください。</font><font style="vertical-align: inherit;">適切に動作させるには、証明書がすべてのチェックに合格する必要があります。</font><font style="vertical-align: inherit;">そうでなければ、何も機能しません。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スキルヤンデックスUD</font></font></h4><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スキル作成</font></font></b><div class="spoiler_text">1.    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">dialogs.yandex.ru/developer</a><br>
2.    .<br>
3.  “ ”<br>
4.   “ ”<br>
5.   :<br>
<br>
<ul>
<li><b></b> —  .</li>
<li><b>Endpoint URL</b> —   <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">/provider</a> </b>,   <b>“</b>”   noip   ,    ssl-.</li>
</ul><br>
<img src="https://habrastorage.org/webt/6w/sn/oc/6wsnoczljzsap2fdrldsgi47qr8.png" width="400"><br>
 <br>
<ul>
<li><b></b> — <b> “   ” (!      )</b></li>
<li><b>  Email </b> —   . </li>
<li><b></b> —  </li>
<li><b></b> —  . </li>
</ul><br>
<img src="https://habrastorage.org/webt/70/7q/pv/707qpvhwz4bp8-g7anzd6yocavw.png" width="400"><br>
<br>
6.  :<br>
<br>
<img src="https://habrastorage.org/webt/z4/vg/ep/z4vgep4de2sngw6byx34eo5s5te.png" width="400"><br>
<br>
 “ ”<br>
<ul>
<li>   — <b>   config.js / clients</b> :</li>
</ul><br>
1. <b> </b> — clientId<br>
<br>
2. <b> </b> — clientSecret<br>
<br>
<ul>
<li><b>URL </b> — <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">/dialog/authorize</a> </li>
<li><b>URL   </b> — <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">/oauth/token</a></li>
<li><b>URL   </b> — <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">/oauth/token</a></li>
</ul><br>
<img src="https://habrastorage.org/webt/im/pg/zi/impgzifephas4rycqhvyll0_7uq.png" width="400"><br>
<br>
7.  <br>
<br>
<img src="https://habrastorage.org/webt/fj/ud/xy/fjudxydpqb3mwv5ksihpr277j2u.png" width="400"><br>
<br>
8.  “ ”<br>
<br>
<img src="https://habrastorage.org/webt/a2/ah/ji/a2ahjiezupvml9wo3a1pboif3pc.png"><br>
<br>
9.  “”<br>
<br>
<img src="https://habrastorage.org/webt/7a/jv/83/7ajv8394tns4icumhxj1qqp-eea.png"><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex UDにデバイスを追加します。</font></font></b><div class="spoiler_text">1.      <br>
<br>
<img src="https://habrastorage.org/webt/ki/fk/t6/kifkt6ims4epu1zm2hsa2z3bef0.jpeg" width="230"><br>
<br>
2.    / <br>
<br>
<img src="https://habrastorage.org/webt/up/ec/ee/upeceeae_jjtrocticjinlinxmq.jpeg" width="230"><br>
<br>
3.  “ ”<br>
<br>
<img src="https://habrastorage.org/webt/-c/yn/k3/-cynk3sjwga2frnsung0wp8mtre.jpeg" width="230"><br>
<br>
4.   <br>
<br>
<img src="https://habrastorage.org/webt/ew/4h/jd/ew4hjdahl4eunc4kvygka1eftrs.jpeg" width="230"><br>
<br>
5.  “ ”<br>
<br>
<img src="https://habrastorage.org/webt/ov/k7/hk/ovk7hkqe6oe0j7jvkw6eghcnycy.jpeg" width="230"><br>
<br>
6.   <br>
<br>
<i>     (   config.js   users)</i><br>
<br>
<img src="https://habrastorage.org/webt/ly/lr/gw/lylrgwlzw5wcuy1c4wov6ez-2fm.jpeg" width="230"><br>
<br>
7.  “”. <br>
<br>
<img src="https://habrastorage.org/webt/y2/pu/tn/y2putnokvnlac9h4tuypa1sny9y.jpeg" width="230"><br>
<br>
8.  “  ”<br>
<br>
<img src="https://habrastorage.org/webt/cq/qd/gw/cqqdgwhp-zhmq5_ax3zbgohgrt4.jpeg" width="230"><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、追加されたデバイスを管理するコマンドをアリスに与えることができます。</font><font style="vertical-align: inherit;">対応するチームがmqttが示すトピックに参加します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのトピックにいくつかのアクションをバインドすることは残っています。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ノードレッド</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
自動化システムにはNode-Redが選ばれました。</font><font style="vertical-align: inherit;">これは優れたビジュアルプログラミングツールです。</font><font style="vertical-align: inherit;">インストールと設定の手順は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここにあります</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スマートホームをセットアップして自動化するプロセスは、記事全体、または2つまでドラッグします。</font><font style="vertical-align: inherit;">そして、そのような記事はすでにたくさんあります。</font><font style="vertical-align: inherit;">代わりに-プラグインを使用した小さな例、電球の音声をオンにする方法。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
便宜上、WebインターフェイスのWiren Board 6コントローラーに仮想デバイスを作成します。</font><font style="vertical-align: inherit;">入力する必要が</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ある</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wb-rules</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ルールエンジン</font></font><br>
<br>
<b><pre><code class="javascript hljs">defineVirtualDevice(<span class="hljs-string">"yandex"</span>, {
    <span class="hljs-attr">title</span>: <span class="hljs-string">"yandex controls"</span>,
    <span class="hljs-attr">cells</span>: {
        <span class="hljs-attr">light1</span>: {
            <span class="hljs-attr">type</span>: <span class="hljs-string">"switch"</span>,
            <span class="hljs-attr">value</span>: <span class="hljs-literal">false</span><font></font>
        },<font></font>
    }<font></font>
});</code></pre><br>
</b><br>
<img src="https://habrastorage.org/webt/3t/mn/qh/3tmnqhsdi1vnkdd_wr4ucnsvusc.jpeg"><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
仮想」デバイスのMQTTトピックを</font><b><font style="vertical-align: inherit;">config.js</font></b><font style="vertical-align: inherit;">に</font><b><font style="vertical-align: inherit;">書き込み、</font></b><font style="vertical-align: inherit;">「軽量」デバイスの「オン」スキルのタイプを示します。</font></font><br>
<br>
<pre><code class="json hljs"> devices: [
    <span class="hljs-comment">//_______________   ______________//</span><font></font>
{<font></font>
            name: '',<font></font>
            room: '',<font></font>
            type: 'devices.types.light',<font></font>
            mqtt: [<font></font>
                 {<font></font>
                    type: 'on',<font></font>
                    set: '/devices/yandex/controls/light1/on', <span class="hljs-comment">//  </span>
                    stat: '/devices/yandex/controls/light1'     <span class="hljs-comment">//  </span><font></font>
                },<font></font>
            ],<font></font>
            capabilities: [<font></font>
                {<font></font>
                    type: 'devices.capabilities.on_off',<font></font>
                    retrievable: <span class="hljs-literal">true</span>,<font></font>
                    state: {<font></font>
                        instance: 'on',<font></font>
                        value: <span class="hljs-literal">true</span><font></font>
                    }<font></font>
                },<font></font>
            ]<font></font>
        },<font></font>
    <span class="hljs-comment">//_______________   _______________//    </span><font></font>
    ]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、「アリス、ライトをオン/オフにする」というフレーズで、仮想デバイスが切り替わります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
指示に従ってインストールされたNode-Redに移動しましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wiren Board 6での作業を便利にするために、追加の「ノード」</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node-red-contrib-wirenboardを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用することもできます</font><font style="vertical-align: inherit;">。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">WBE2R-R-ZIGBEE</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
拡張モジュールがコントローラー</font><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">インストールされている</font><font style="vertical-align: inherit;">ため、ZigBeeプロトコルを使用してTRODFRYシリーズのIKeevskayaスマートランプに接続できます。</font><font style="vertical-align: inherit;">
今ではそれは小さいです。 Node-Redワークスペースにいくつかのブロックを投入し、それらを「文字列」で接続して、Deployをクリックします。</font><font style="vertical-align: inherit;">
ikeevsky電球はzigbee2mqttプラグインを介して接続されているため、mqttでは、電球トピックを制御するためにjsonを送信する必要があります。これを行うには、WB仮想デバイスとmqtt電球トピックの間に単純な関数を挿入します。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/webt/ev/p8/zn/evp8zn84umdssgxcecq9rmosgm8.jpeg"><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/webt/y1/e6/9h/y1e69hfghaemcayotpvugppiqz8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「デプロイ」をクリックします。</font><font style="vertical-align: inherit;">チェックします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アリス、光をつけろ！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そこで、今日はアリスを自動化システムに接続する方法を学びました。</font><font style="vertical-align: inherit;">おそらく、場合によっては複雑すぎて、通常のWi-Fi電球を購入する方が簡単であり、それで十分です。</font><font style="vertical-align: inherit;">しかし、自分で本当にスマートな家を建てようと計画しているのであれば、簡単な方法ではここではできません。</font><font style="vertical-align: inherit;">しかし、それは価値があるかどうか、誰もが自分で決めるでしょう。</font><font style="vertical-align: inherit;">ご清聴ありがとうございました！</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja465521/index.html">Fly-fly-petal ...、またはUXデザイナーがInstagramで彼の製品を宣伝した方法についての物語</a></li>
<li><a href="../ja465525/index.html">Oracle BI EE 12cに関するモバイルレポート-1、2、3。Oracle BI EE 12c CADコースの方法論</a></li>
<li><a href="../ja465527/index.html">RFC 4357からRFC 8645への長い道のり、または暗号化キーの管理方法</a></li>
<li><a href="../ja465531/index.html">深さが不明確なネストされたリストのアンパック</a></li>
<li><a href="../ja465535/index.html">誰がIPv6を実装し、その開発を妨げているもの</a></li>
<li><a href="../ja465539/index.html">766 km-LoRaWANの新記録</a></li>
<li><a href="../ja465541/index.html">エンタープライズからSMBへ：SaaSモデルを使用した収益化により、中小企業向けの企業ソリューションの適応に関する経験を共有します</a></li>
<li><a href="../ja465545/index.html">州のさまざまな側面：Facebookが米国議会でどのように揚げられたのか、テレグラムはFSBと戦った</a></li>
<li><a href="../ja465547/index.html">SQLガイド：クエリをより適切に記述する方法（パート1）</a></li>
<li><a href="../ja465551/index.html">9月のITイベントダイジェスト（パート1）</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>