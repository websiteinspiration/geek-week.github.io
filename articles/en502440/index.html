<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë¥üèø üõÄüèæ üë† Building Applications with Mediapipe ‚öóÔ∏è üë©üèø‚Äçüî¨ üíå</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today, many services use neural network models in their work. However, due to the low performance of client devices, in most cases, calculations are p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Building Applications with Mediapipe</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/502440/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Today, many services use neural network models in their work. </font><font style="vertical-align: inherit;">However, due to the low performance of client devices, in most cases, calculations are performed on the server. </font><font style="vertical-align: inherit;">However, the performance of smartphones is growing every year and now it is possible to launch small models on client devices. </font><font style="vertical-align: inherit;">The question arises: how to do this? </font><font style="vertical-align: inherit;">In addition to running the model, you need to pre-process and post-process the data. </font><font style="vertical-align: inherit;">In addition, there are at least two platforms where this needs to be implemented: android and iOS. </font><font style="vertical-align: inherit;">Mediapipe is a framework for launching pipelines (data preprocessing, inference of a model, as well as post-processing of model results) of machine learning, which allows solving the problems described above and simplifying the writing of cross-platform code to run models.</font></font></p><br>
<p><img src="https://habrastorage.org/webt/-3/w1/pt/-3w1ptqhyfhsq9auhazius2apgc.png"></p><a name="habracut"></a><br>
<h1 id="soderzhanie"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Content</font></font></h1><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bazel Build System Overview</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mediapipe Framework</font></font><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What is a Mediapipe. </font><font style="vertical-align: inherit;">What it consists of and why it is needed</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HelloWorld application on Mediapipe</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Running a model using Mediapipe</font></font></li>
</ol></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Creating an Application Using Mediapipe</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></li>
</ol><br>
<h1 id="obzor-sistemy-sborki-bazel"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bazel Build System Overview</font></font></h1><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mediapipe uses Bazel for assembly. </font><font style="vertical-align: inherit;">This was the first time I came across this build system, so in parallel with Mediapipe I figured it out with Bazel, collecting information from various sources and stepping on a rake. </font><font style="vertical-align: inherit;">Therefore, before telling about Mediapipe itself, I would like to give a small introduction on the Bazel assembly system, which is used to build Mediapipe and projects based on it. </font><font style="vertical-align: inherit;">Bazel is a build system from Google, a revised version of their internal Blaze build system, shared. </font><font style="vertical-align: inherit;">Bazel allows you to combine different languages ‚Äã‚Äãand frameworks in one project with a simple command:</font></font></p><br>
<pre><code class="plaintext hljs">bazel build TARGET</code></pre><br>
<p>   ,          ?    ,    Bazel-.       WORKSPACE,      .    ,    .  ,     A,    B,      WORKSPACE     A,    B. -  WORKSPACE   ,          Mediapipe.  Bazel    ,         ,     ,         ,     ,    .       WORKSPACE:</p><br>
<pre><code class="python hljs"><span class="hljs-comment">#      </span>
load(<span class="hljs-string">"@bazel_tools//tools/build_defs/repo:http.bzl"</span>, <span class="hljs-string">"http_archive"</span>)<font></font>
<font></font>
<span class="hljs-comment">#        c++</span><font></font>
http_archive(<font></font>
    name = <span class="hljs-string">"rules_cc"</span>,<font></font>
    strip_prefix = <span class="hljs-string">"rules_cc-master"</span>,<font></font>
    urls = [<span class="hljs-string">"https://github.com/bazelbuild/rules_cc/archive/master.zip"</span>],<font></font>
)<font></font>
<font></font>
<span class="hljs-comment">#   googletest</span><font></font>
http_archive(<font></font>
    name = <span class="hljs-string">"com_google_googletest"</span>,<font></font>
    strip_prefix = <span class="hljs-string">"googletest-master"</span>,<font></font>
    urls = [<span class="hljs-string">"https://github.com/google/googletest/archive/master.zip"</span>],<font></font>
)</code></pre><br>
<p>    (bazel rule).     ‚Äî    Starlark.    Bazel      ,          ,    . ,        http_archive   ,     http_archive      C++    googletest.</p><br>
<p>  WORKSPACE  Bazel      BUILD. BUILD   ,    ,        .    BUILD    C++    :</p><br>
<pre><code class="python hljs">cc_binary(<font></font>
    name=<span class="hljs-string">"HelloWorld"</span>,<font></font>
    srcs=[<span class="hljs-string">"main.cpp"</span>],<font></font>
    copts=[<span class="hljs-string">"-Wall"</span>, <span class="hljs-string">"-Wpedantic"</span>, <span class="hljs-string">"-Werror"</span>]<font></font>
)</code></pre><br>
<p>     ,    ,      WORKSPACE   http_archive.    Bazel-       main.cpp. </p><br>
<ul>
<li>./WORKSPACE</li>
<li>./Source/BUILD</li>
<li>./Source/main.cpp</li>
</ul><br>
<p>      </p><br>
<pre><code class="plaintext hljs">bazel build //Source:HelloWorld</code></pre><br>
<p> Source ‚Äî , HelloWorld ‚Äî   .</p><br>
<p>  cmake,  ( )    ./bazel-bin.</p><br>
<p>            ,      ,      .      Bazel   (libraries). </p><br>
<pre><code class="python hljs">cc_library(<font></font>
    name = <span class="hljs-string">"lib"</span>,<font></font>
    hdrs = [<span class="hljs-string">"utils.h"</span>],<font></font>
    srcs = [<span class="hljs-string">"utils.cpp"</span>],<font></font>
    visibility = [<font></font>
        <span class="hljs-string">"//visibility:public"</span>,<font></font>
    ],<font></font>
)<font></font>
<font></font>
cc_binary(<font></font>
    name=<span class="hljs-string">"HelloWorld"</span>,<font></font>
    srcs=[<span class="hljs-string">"main.cpp"</span>],<font></font>
    deps=[<span class="hljs-string">":lib"</span>],<font></font>
    copts=[<span class="hljs-string">"-Wall"</span>, <span class="hljs-string">"-Wpedantic"</span>, <span class="hljs-string">"-Werror"</span>]<font></font>
)</code></pre><br>
<p>      BUILD ,         .        ,   //   </p><br>
<pre><code class="plaintext hljs">@some_repository//Module:lib</code></pre><br>
<p>Bazel    ,    .  http_archive,      git_repository, local_repository  .</p><br>
<h1 id="obzor-mediapipe"> Mediapipe</h1><br>
<h2 id="chto-takoe-mediapipe">  Mediapipe</h2><br>
<p>Mediapipe ‚Äî       .      ,      (    ):</p><br>
<ol>
<li>  (Calculators) ‚Äî      ().               .     C++ ,   CalculatorBase:<br>
<ul>
<li><code>static Status GetContract(CalculatorContract*);</code> ‚Äî  ,      ,         .</li>
<li><code>Status Open(CalculatorContext*);</code> ‚Äî     . , ,    ,   .</li>
<li><code>Status Process(CalculatorContext*);</code> ‚Äî   .</li>
<li><code>Status Close(CalculatorContext*);</code> ‚Äî  .</li>
</ul></li>
<li>  (Streams)    .         .    ,  (input)   (output).     ,          ,         ,   .</li>
<li> (Packet) ‚Äî  ,      .         ‚Äî    ,  ,        ,     protobuf.      timestamp ‚Äî  ,   .   ,  ,    ,  ,      .</li>
</ol><br>
<p>    protobuf.</p><br>
<p>Mediapipe         ,          .        Linux, WSL, MacOS, Android, iOS.  Mediapipe      TensorFlow  TFLite .       ,            ,       .</p><br>
<p>   ,   Mediapipe.      ,     .         Mediapipe,         ,    -  .</p><br>
<h2 id="helloworld-prilozhenie-na-mediapipe">HelloWorld   Mediapipe</h2><br>
<p>      ,    ,   N  ,   .</p><br>
<p><img src="https://habrastorage.org/webt/sy/az/n4/syazn4cpt08dhakmyfh9i2vh2og.png"></p><br>
<p>     .pbtxt ,       main.cpp.</p><br>
<pre><code class="plaintext hljs">‚îú‚îÄ‚îÄ hello-world<font></font>
‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ BUILD<font></font>
‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ graph.pbtxt<font></font>
‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ main.cpp<font></font>
‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ RepeatNTimesCalculator.cpp<font></font>
‚îÇ&nbsp;&nbsp; ‚îî‚îÄ‚îÄ RepeatNTimesCalculator.proto<font></font>
‚îî‚îÄ‚îÄ WORKSPACE</code></pre><br>
<p>    :</p><br>
<pre><code class="plaintext hljs">input_stream: "in"<font></font>
output_stream: "out"<font></font>
<font></font>
node {<font></font>
    calculator: "RepeatNTimesCalculator"<font></font>
    input_stream: "in"<font></font>
    output_stream: "OUTPUT_TAG:out"<font></font>
    node_options: {<font></font>
        [type.googleapis.com/mediapipe_demonstration.RepeatNTimesCalculatoOptions] {<font></font>
            n: 3<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br>
<p> RepeatNTimesCalculator   .     GetContract,         , Open,        ,    Process,      .</p><br>
<pre><code class="plaintext hljs">class RepeatNTimesCalculator : public mediapipe::CalculatorBase {<font></font>
public:<font></font>
    static mediapipe::Status GetContract(mediapipe::CalculatorContract* cc) {<font></font>
        //        ,  <font></font>
        cc-&gt;Inputs().Get("", 0).Set&lt;std::string&gt;();<font></font>
        //       OUTPUT_TAG,     <font></font>
        cc-&gt;Outputs().Get("OUTPUT_TAG", 0).Set&lt;std::string&gt;();<font></font>
        return mediapipe::OkStatus();<font></font>
    }<font></font>
<font></font>
    mediapipe::Status Open(mediapipe::CalculatorContext* cc) final {<font></font>
        //   ,    <font></font>
        const auto&amp; options = cc-&gt;Options&lt;mediapipe_demonstration::RepeatNTimesCalculatoOptions&gt;();<font></font>
        // n -      <font></font>
        n_ = options.n();<font></font>
        return mediapipe::OkStatus();<font></font>
    }<font></font>
<font></font>
    mediapipe::Status Process(mediapipe::CalculatorContext* cc) final {<font></font>
        //     <font></font>
        //           <font></font>
        //       std::string<font></font>
        auto txt = cc-&gt;Inputs().Index(0).Value().Get&lt;std::string&gt;();<font></font>
<font></font>
        for (int i = 0; i &lt; n_; ++i) {<font></font>
            //      <font></font>
            auto packet = mediapipe::MakePacket&lt;std::string&gt;(txt).At(cc-&gt;InputTimestamp() + i);<font></font>
            //       OUTPUT_TAG   0<font></font>
            cc-&gt;Outputs().Get("OUTPUT_TAG", 0).AddPacket(packet);<font></font>
        }<font></font>
<font></font>
        return mediapipe::OkStatus();<font></font>
    }<font></font>
private:<font></font>
    int n_;<font></font>
};<font></font>
//    <font></font>
REGISTER_CALCULATOR(RepeatNTimesCalculator);</code></pre><br>
<p>    .cpp ,    ,     <code>REGISTER_CALCULATOR</code>.</p><br>
<p>       proto-   .     RepeatNTimesCalculatoOptions,     ,        .</p><br>
<pre><code class="plaintext hljs">syntax = "proto2";<font></font>
package mediapipe_demonstration;<font></font>
import "mediapipe/framework/calculator_options.proto";<font></font>
message RepeatNTimesCalculatoOptions {<font></font>
  extend mediapipe.CalculatorOptions {<font></font>
    optional RepeatNTimesCalculatoOptions ext = 350607623;<font></font>
  }<font></font>
  required int32 n = 2;<font></font>
}</code></pre><br>
<p>       :</p><br>
<pre><code class="plaintext hljs">mediapipe::Status RunGraph() {<font></font>
    //    <font></font>
    std::ifstream file("./hello-world/graph.pbtxt");<font></font>
    std::string graph_file_content;<font></font>
    graph_file_content.assign(<font></font>
        std::istreambuf_iterator&lt;char&gt;(file), <font></font>
        std::istreambuf_iterator&lt;char&gt;());<font></font>
    mediapipe::CalculatorGraphConfig config = <font></font>
        mediapipe::ParseTextProtoOrDie&lt;mediapipe::CalculatorGraphConfig&gt;(graph_file_content);<font></font>
    //  <font></font>
    mediapipe::CalculatorGraph graph;<font></font>
    MP_RETURN_IF_ERROR(graph.Initialize(config));<font></font>
    //    <font></font>
    ASSIGN_OR_RETURN(mediapipe::OutputStreamPoller poller, graph.AddOutputStreamPoller("out"));<font></font>
    //  <font></font>
    MP_RETURN_IF_ERROR(graph.StartRun({}));<font></font>
    //        <font></font>
    auto input_packet = mediapipe::MakePacket&lt;std::string&gt;("Hello!").At(mediapipe::Timestamp(0));<font></font>
    MP_RETURN_IF_ERROR(graph.AddPacketToInputStream("in", input_packet));<font></font>
    MP_RETURN_IF_ERROR(graph.CloseInputStream("in"));<font></font>
    //    <font></font>
    mediapipe::Packet packet;<font></font>
    while (poller.Next(&amp;packet)) {<font></font>
        std::cout &lt;&lt; packet.Get&lt;std::string&gt;() &lt;&lt; std::endl;<font></font>
    }<font></font>
    return graph.WaitUntilDone();<font></font>
}</code></pre><br>
<p>,    ,   BUILD         ,      .</p><br>
<pre><code class="python hljs">load(<span class="hljs-string">"@mediapipe_repository//mediapipe/framework/port:build_config.bzl"</span>, <span class="hljs-string">"mediapipe_cc_proto_library"</span>)
<span class="hljs-comment">#     </span><font></font>
proto_library(<font></font>
    name = <span class="hljs-string">"repeat_n_times_calculator_proto"</span>,<font></font>
    srcs = [<span class="hljs-string">"RepeatNTimesCalculator.proto"</span>],<font></font>
    visibility = [<span class="hljs-string">"//visibility:public"</span>],<font></font>
    deps = [<font></font>
        <span class="hljs-string">"@mediapipe_repository//mediapipe/framework:calculator_proto"</span>,<font></font>
    ],<font></font>
)<font></font>
<span class="hljs-comment">#     </span><font></font>
mediapipe_cc_proto_library(<font></font>
    name = <span class="hljs-string">"repeat_n_times_calculator_cc_proto"</span>,<font></font>
    srcs = [<span class="hljs-string">"RepeatNTimesCalculator.proto"</span>],<font></font>
    cc_deps = [<font></font>
        <span class="hljs-string">"@mediapipe_repository//mediapipe/framework:calculator_cc_proto"</span>,<font></font>
    ],<font></font>
    visibility = [<span class="hljs-string">"//visibility:public"</span>],<font></font>
    deps = [<span class="hljs-string">":repeat_n_times_calculator_proto"</span>],<font></font>
)<font></font>
<span class="hljs-comment">#   .  ,    </span><font></font>
cc_library(<font></font>
    name = <span class="hljs-string">"repeat_n_times_calculator"</span>,<font></font>
    srcs = [<span class="hljs-string">"RepeatNTimesCalculator.cpp"</span>],<font></font>
    visibility = [<font></font>
        <span class="hljs-string">"//visibility:public"</span>,<font></font>
    ],<font></font>
    deps = [<font></font>
        <span class="hljs-string">":repeat_n_times_calculator_cc_proto"</span>,
        <span class="hljs-string">"@mediapipe_repository//mediapipe/framework:calculator_framework"</span>,
        <span class="hljs-string">"@mediapipe_repository//mediapipe/framework/port:status"</span>,<font></font>
    ],<font></font>
    alwayslink = <span class="hljs-number">1</span>,<font></font>
)<font></font>
<span class="hljs-comment">#    ,    .</span><font></font>
cc_binary(<font></font>
    name = <span class="hljs-string">"HelloMediapipe"</span>,<font></font>
    srcs = [<span class="hljs-string">"main.cpp"</span>],<font></font>
    deps = [<font></font>
        <span class="hljs-string">"repeat_n_times_calculator"</span>,
        <span class="hljs-string">"@mediapipe_repository//mediapipe/framework/port:logging"</span>,
        <span class="hljs-string">"@mediapipe_repository//mediapipe/framework/port:parse_text_proto"</span>,
        <span class="hljs-string">"@mediapipe_repository//mediapipe/framework/port:status"</span>,<font></font>
    ],<font></font>
)</code></pre><br>
<p>  :</p><br>
<pre><code class="plaintext hljs">$ bazel-2.0.0 build --define MEDIAPIPE_DISABLE_GPU=1 //hello-world:HelloMediapipe<font></font>
...<font></font>
INFO: Build completed successfully, 4 total actions<font></font>
$ ./bazel-bin/hello-world/HelloMediapipe<font></font>
Hello!<font></font>
Hello!<font></font>
Hello!</code></pre><br>
<p>      Mediapipe,       ML .</p><br>
<h2 id="zapusk-modeli-s-pomoschyu-mediapipe">    Mediapipe</h2><br>
<p> ,    Mediapipe  tflite    .         .       ,   ImageNet1k.     ,     ,   .     ,      .</p><br>
<pre><code class="plaintext hljs">‚îú‚îÄ‚îÄ inference<font></font>
‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ android/src/main/java/com/com/mediapipe_demonstration/inference<font></font>
‚îÇ&nbsp;&nbsp; ‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ AndroidManifest.xml<font></font>
‚îÇ&nbsp;&nbsp; ‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ BUILD<font></font>
‚îÇ&nbsp;&nbsp; ‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ MainActivity.kt<font></font>
‚îÇ&nbsp;&nbsp; ‚îÇ&nbsp;&nbsp; ‚îî‚îÄ‚îÄ res<font></font>
‚îÇ&nbsp;&nbsp; ‚îÇ&nbsp;&nbsp;     ‚îî‚îÄ‚îÄ ...<font></font>
‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ BUILD<font></font>
‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ desktop<font></font>
‚îÇ&nbsp;&nbsp; ‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ BUILD<font></font>
‚îÇ&nbsp;&nbsp; ‚îÇ&nbsp;&nbsp; ‚îî‚îÄ‚îÄ main.cpp<font></font>
‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ graph.pbtxt<font></font>
‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ img.jpg<font></font>
‚îÇ&nbsp;&nbsp; ‚îî‚îÄ‚îÄ mobilenetv2_imagenet.tflite<font></font>
‚îî‚îÄ‚îÄ WORKSPACE</code></pre><br>
<p>   :</p><br>
<p><img src="https://habrastorage.org/webt/cp/wx/px/cpwxpxposjmuaclo7krrpg9keca.png"></p><br>
<pre><code class="plaintext hljs">input_stream: "in"<font></font>
output_stream: "out"<font></font>
node: {<font></font>
  calculator: "ImageTransformationCalculator"<font></font>
  input_stream: "IMAGE:in"<font></font>
  output_stream: "IMAGE:transformed_input"<font></font>
  node_options: {<font></font>
    [type.googleapis.com/mediapipe.ImageTransformationCalculatorOptions] {<font></font>
      output_width: 224<font></font>
      output_height: 224<font></font>
    }<font></font>
  }<font></font>
}<font></font>
node {<font></font>
  calculator: "TfLiteConverterCalculator"<font></font>
  input_stream: "IMAGE:transformed_input"<font></font>
  output_stream: "TENSORS:image_tensor"<font></font>
  node_options: {<font></font>
      [type.googleapis.com/mediapipe.TfLiteConverterCalculatorOptions] {<font></font>
        zero_center: false<font></font>
      }<font></font>
  }<font></font>
}<font></font>
node {<font></font>
  calculator: "TfLiteInferenceCalculator"<font></font>
  input_stream: "TENSORS:image_tensor"<font></font>
  output_stream: "TENSORS:prediction_tensor"<font></font>
  node_options: {<font></font>
    [type.googleapis.com/mediapipe.TfLiteInferenceCalculatorOptions] {<font></font>
      model_path: "inference/mobilenetv2_imagenet.tflite"<font></font>
    }<font></font>
  }<font></font>
}<font></font>
node {<font></font>
  calculator: "TfLiteTensorsToFloatsCalculator"<font></font>
  input_stream: "TENSORS:prediction_tensor"<font></font>
  output_stream: "FLOATS:out"<font></font>
}</code></pre><br>
<p>  4 : </p><br>
<ol>
<li>     224x224.</li>
<li>   [-1, 1] (  zero_center: false,      [0, 1]),        ImageFrame (   Mediapipe,       ,  )  <code>TfLiteTensor</code> ( <code>std::vector&lt;TfLiteTensor&gt;</code>  1).     TfLiteTensor    (  <code>GetContract</code>),    .</li>
<li> .</li>
<li>   <code>TfLiteTensor</code>    <code>std::vector&lt;float&gt;</code>.         .</li>
</ol><br>
<p>        ,        .</p><br>
<p>        .        .   ,  ,          .</p><br>
<pre><code class="plaintext hljs">//  <font></font>
auto img_mat = cv::imread("./inference/img.jpg");<font></font>
//    <font></font>
auto input_frame = std::make_unique&lt;mediapipe::ImageFrame&gt;(<font></font>
    mediapipe::ImageFormat::SRGB, img_mat.cols, img_mat.rows,<font></font>
    mediapipe::ImageFrame::kDefaultAlignmentBoundary);<font></font>
cv::Mat input_frame_mat = mediapipe::formats::MatView(input_frame.get());<font></font>
img_mat.copyTo(input_frame_mat);<font></font>
auto frame = mediapipe::Adopt(input_frame.release()).At(mediapipe::Timestamp(0));<font></font>
//    <font></font>
MP_RETURN_IF_ERROR(graph.AddPacketToInputStream("in", frame));<font></font>
MP_RETURN_IF_ERROR(graph.CloseInputStream("in"));<font></font>
//       <font></font>
mediapipe::Packet packet;<font></font>
while (poller.Next(&amp;packet)) {<font></font>
    auto predictions = packet.Get&lt;std::vector&lt;float&gt;&gt;();<font></font>
    int idx = std::max_element(predictions.begin(), predictions.end()) - predictions.begin();<font></font>
    std::cout &lt;&lt; idx &lt;&lt; std::endl;<font></font>
}</code></pre><br>
<p>     ,    :</p><br>
<p><img src="https://habrastorage.org/webt/-u/-a/ab/-u-aabosvfnav_j-9nkyf5boaxs.jpeg"></p><br>
<pre><code class="plaintext hljs">$ bazel-2.0.0 build --define MEDIAPIPE_DISABLE_GPU=1 //inference/desktop:Inference<font></font>
...<font></font>
INFO: Build completed successfully, 3 total actions<font></font>
$ ./bazel-bin/inference/desktop/Inference<font></font>
INFO: Initialized TensorFlow Lite runtime.<font></font>
151</code></pre><br>
<p>151   ImageNet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"></a> "Chihuahua".</p><br>
<p>      .    Activity,    ( onCreate)    ,    Mediapipe.        protobuf-.    ,         .     onActivityResult,      .       Mediapipe    - ( ).</p><br>
<pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> : <span class="hljs-type">AppCompatActivity</span></span>() {
    <span class="hljs-keyword">val</span> PICK_IMAGE = <span class="hljs-number">1</span>
    <span class="hljs-keyword">var</span> mpGraph: Graph? = <span class="hljs-literal">null</span>
    <span class="hljs-keyword">var</span> timestamp = <span class="hljs-number">0L</span>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        <span class="hljs-keyword">this</span>.setContentView(R.layout.activity_main)
        <span class="hljs-keyword">val</span> outputTv = findViewById&lt;TextView&gt;(R.id.outputTv)
        <span class="hljs-keyword">val</span> button = findViewById&lt;Button&gt;(R.id.selectButton)<font></font>
        AndroidAssetUtil.initializeNativeAssetManager(<span class="hljs-keyword">this</span>)
        <span class="hljs-comment">//    </span>
        <span class="hljs-comment">//        </span>
        <span class="hljs-keyword">val</span> graph = Graph()<font></font>
        assets.<span class="hljs-keyword">open</span>(<span class="hljs-string">"mobile_binary_graph.binarypb"</span>).use {
            <span class="hljs-keyword">val</span> graphBytes = it.readBytes()<font></font>
            graph.loadBinaryGraph(graphBytes)<font></font>
        }<font></font>
        <span class="hljs-comment">//    </span>
        graph.addPacketCallback(<span class="hljs-string">"out"</span>) {
            <span class="hljs-keyword">val</span> res = PacketGetter.getFloat32Vector(it)
            <span class="hljs-keyword">val</span> label = res.indices.maxBy { i -&gt; res[i] } ?: -<span class="hljs-number">1</span>
            <span class="hljs-keyword">this</span><span class="hljs-symbol">@MainActivity</span>.runOnUiThread {<font></font>
                outputTv.text = label.toString()<font></font>
            }<font></font>
        }<font></font>
        graph.startRunningGraph()<font></font>
        <span class="hljs-comment">//      </span><font></font>
        button.setOnClickListener {<font></font>
            <span class="hljs-keyword">val</span> intent = Intent()<font></font>
            intent.type = <span class="hljs-string">"image/*"</span><font></font>
            intent.action = Intent.ACTION_GET_CONTENT<font></font>
            startActivityForResult(Intent.createChooser(intent, <span class="hljs-string">"Select Picture"</span>), PICK_IMAGE)<font></font>
        }<font></font>
        mpGraph = graph<font></font>
    }<font></font>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onActivityResult</span><span class="hljs-params">(requestCode: <span class="hljs-type">Int</span>, resultCode: <span class="hljs-type">Int</span>, <span class="hljs-keyword">data</span>: <span class="hljs-type">Intent</span>?)</span></span> {
        <span class="hljs-keyword">if</span> (requestCode == PICK_IMAGE) {
            <span class="hljs-comment">//        </span>
            <span class="hljs-keyword">val</span> outputTv = findViewById&lt;TextView&gt;(R.id.outputTv)
            <span class="hljs-keyword">val</span> imageView = findViewById&lt;ImageView&gt;(R.id.imageView)
            <span class="hljs-keyword">val</span> uri = <span class="hljs-keyword">data</span>?.<span class="hljs-keyword">data</span>!!
            <span class="hljs-comment">//    </span>
            <span class="hljs-keyword">val</span> graph = mpGraph!!
            <span class="hljs-keyword">val</span> creator = AndroidPacketCreator(graph)
            <span class="hljs-keyword">val</span> stream = contentResolver.openInputStream(uri)
            <span class="hljs-keyword">val</span> bitmap = BitmapFactory.decodeStream(stream)<font></font>
            imageView.setImageBitmap(bitmap)<font></font>
            <span class="hljs-keyword">val</span> packet = creator.createRgbImageFrame(bitmap)<font></font>
            graph.addPacketToInputStream(<span class="hljs-string">"in"</span>, packet, timestamp)<font></font>
        }<font></font>
    }<font></font>
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-keyword">init</span> {
            <span class="hljs-comment">//   mediapipe </span>
            System.loadLibrary(<span class="hljs-string">"mediapipe_jni"</span>)<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br>
<p>        :</p><br>
<pre><code class="plaintext hljs">$ bazel-2.0.0 mobile-install --start_app -c opt --config=android_arm64 //inference/android/src/main/java/com/mediapipe_demonstration/inference:Inference</code></pre><br>
<p>        ,     :</p><br>
<p><img src="https://habrastorage.org/webt/pi/1j/ig/pi1jigqzx9lubi0wm_8vkek__bg.jpeg"></p><br>
<p>  ,      .</p><br>
<p>      ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">github</a></p><br>
<p>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"> Mediapipe</a></p><br>
<h1 id="sozdanie-prilozheniya-s-pomoschyu-mediapipe">    Mediapipe</h1><br>
<p>    .      .  ,         .  ,             .   ,         .     :</p><br>
<ul>
<li>    ,  GPU,   ;</li>
<li>    .</li>
</ul><br>
<p>  ,      Mediapipe.       ,             ,         ,   .      .    :             ,      .</p><br>
<p>        Mediapipe,   .         ,   ImageNet1k,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">Stanford Cars Dataset</a>.           .   :</p><br>
<p><img src="https://habrastorage.org/webt/tj/bl/8c/tjbl8c6wnla14qvhdydtbfhq5y4.jpeg"></p><br>
<p>        logit-   NLL loss.  ""        mean pool. </p><br>
<p>     Android ,   Mediapipe, Mediapipe ,       .</p><br>
<pre><code class="plaintext hljs">.<font></font>
‚îú‚îÄ‚îÄ Android/src/main/java/com/kshmax/objectrecognition<font></font>
‚îÇ&nbsp;&nbsp; ‚îî‚îÄ‚îÄ objectrecognition<font></font>
‚îÇ&nbsp;&nbsp;     ‚îú‚îÄ‚îÄ AndroidManifest.xml<font></font>
‚îÇ&nbsp;&nbsp;     ‚îú‚îÄ‚îÄ BUILD<font></font>
‚îÇ&nbsp;&nbsp;     ‚îú‚îÄ‚îÄ MainActivity.kt<font></font>
‚îÇ&nbsp;&nbsp;     ‚îú‚îÄ‚îÄ Models.kt<font></font>
‚îÇ&nbsp;&nbsp;     ‚îú‚îÄ‚îÄ ObjectDetectionFrameProcessor.java<font></font>
‚îÇ&nbsp;&nbsp;     ‚îî‚îÄ‚îÄ res<font></font>
‚îÇ&nbsp;&nbsp;         ‚îî‚îÄ‚îÄ ...<font></font>
‚îú‚îÄ‚îÄ Calculators<font></font>
‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ BoundaryBoxCropCalculator.cpp<font></font>
‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ BUILD<font></font>
‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ ClickLocation.proto<font></font>
‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ DetectionFilterCalculator.cpp<font></font>
‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ DetectionFilterCalculator.proto<font></font>
‚îú‚îÄ‚îÄ Graphs<font></font>
‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ BUILD<font></font>
‚îÇ&nbsp;&nbsp; ‚îî‚îÄ‚îÄ ObjectRecognitionGraph.pbtxt<font></font>
‚îú‚îÄ‚îÄ Models<font></font>
‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ BUILD<font></font>
‚îÇ&nbsp;&nbsp; ‚îî‚îÄ‚îÄ car_vectorizer.tflite<font></font>
‚îú‚îÄ‚îÄ Server<font></font>
‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ labels.npy<font></font>
‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ server.py<font></font>
‚îÇ&nbsp;&nbsp; ‚îî‚îÄ‚îÄ vectors.npy<font></font>
‚îî‚îÄ‚îÄ WORKSPACE</code></pre><br>
<p>Mediapipe      :</p><br>
<p><img src="https://habrastorage.org/webt/pc/p3/ar/pcp3arazcizw42lnwzvvubhipe4.jpeg"></p><br>
<p>       ,       .</p><br>
<p>   ,   .    ,    ,    .      :       ,    .     FlowLimiter   .             . AnnotationOverlay     ,      .          . </p><br>
<p>     DetectionFilter,           ,        .      DetectionFilter,      ,      ,        .</p><br>
<p> Process  DetectionFilter   :</p><br>
<pre><code class="plaintext hljs">mediapipe::Status DetectionFilterCalculator::Process(mediapipe::CalculatorContext *cc) {<font></font>
    const auto&amp; input_detections = cc-&gt;Inputs().Get("", 0).Get&lt;std::vector&lt;::mediapipe::Detection&gt;&gt;();<font></font>
    std::vector&lt;::mediapipe::Detection&gt; output_detections;<font></font>
    for (const auto&amp; input_detection : input_detections) {<font></font>
        bool next_detection = false;<font></font>
<font></font>
        for (int pass_id : pass_ids_) {<font></font>
            for (int label_id : input_detection.label_id()) {<font></font>
                if (pass_id == label_id) {<font></font>
                    output_detections.push_back(input_detection);<font></font>
                    next_detection = true;<font></font>
                    break;<font></font>
                }<font></font>
            }<font></font>
            if (next_detection) {<font></font>
                break;<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
    auto out_packet = mediapipe::MakePacket&lt;std::vector&lt;mediapipe::Detection&gt;&gt;(output_detections).At(cc-&gt;InputTimestamp());<font></font>
    cc-&gt;Outputs().Get("", 0).AddPacket(out_packet);<font></font>
<font></font>
    return mediapipe::OkStatus();<font></font>
}</code></pre><br>
<p>DetectionFilterCalculator     :</p><br>
<pre><code class="plaintext hljs">node {<font></font>
    calculator: "DetectionFilterCalculator"<font></font>
    input_stream: "filtered_detections"<font></font>
    output_stream: "car_detections"<font></font>
    node_options: {<font></font>
        [type.googleapis.com/objectrecognition.DetectionFilterCalculatorOptions] {<font></font>
            pass_id: 3<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br>
<p>       .      ,    ,    .</p><br>
<p><img src="https://habrastorage.org/webt/j_/em/jg/j_emjgyxr_vcj30h7jb-6ergoz8.jpeg"></p><br>
<p>         ScreenTap,     BoundaryBoxCrop.  ,    ScreenTap    FlowLimiter,  ,       ,       .    ,      ,  ,     ,           .          FrameProcessor,            ObjectDetectionFrameProcessor.</p><br>
<p>       ScreenTap      ,     ,        ,            " ".                 .        ,   ,     ,      (,    ,      [0, 1]).</p><br>
<p>BoundaryBoxCrop   ,         .    ,   DetectionFilter   ,  FlowLimiter   ,    GPU  CPU.   ,  ,      ,       .</p><br>
<pre><code class="plaintext hljs">mediapipe::Status BoundaryBoxCropCalculator::Process(mediapipe::CalculatorContext *cc) {<font></font>
    auto&amp; detections_packet = cc-&gt;Inputs().Get("DETECTION", 0);<font></font>
    auto&amp; frames_packet = cc-&gt;Inputs().Get("IMAGE", 0);<font></font>
    auto&amp; click_packet = cc-&gt;Inputs().Get("CLICK", 0);<font></font>
<font></font>
    if (detections_packet.IsEmpty()<font></font>
        || frames_packet.IsEmpty()<font></font>
        || click_packet.IsEmpty()) {<font></font>
        return mediapipe::OkStatus();<font></font>
    }<font></font>
<font></font>
    const std::vector&lt;mediapipe::Detection&gt;&amp; detections =<font></font>
            detections_packet.Get&lt;std::vector&lt;mediapipe::Detection&gt;&gt;();<font></font>
    const mediapipe::ImageFrame&amp; image_frame = frames_packet.Get&lt;mediapipe::ImageFrame&gt;();<font></font>
<font></font>
    // Java    protobuf  ,     .<font></font>
    auto click_location_str = click_packet.Get&lt;std::string&gt;();<font></font>
    objectrecognition::ClickLocation click_location;<font></font>
    click_location.ParseFromString(click_location_str);<font></font>
    //   ,    <font></font>
    if (click_location.x() == -1 || click_location.y() == -1) {<font></font>
        return mediapipe::OkStatus();<font></font>
    }<font></font>
<font></font>
    //      <font></font>
    absl::optional&lt;mediapipe::Detection&gt; detection = FindOverlappedDetection(click_location, detections);<font></font>
<font></font>
    if (detection.has_value()) {<font></font>
        //     ,     <font></font>
        std::unique_ptr&lt;mediapipe::ImageFrame&gt; cropped_image = CropImage(image_frame, detection.value());<font></font>
        cc-&gt;Outputs().Get("", 0).Add(cropped_image.release(), cc-&gt;InputTimestamp());<font></font>
    }<font></font>
<font></font>
    return mediapipe::OkStatus();<font></font>
}<font></font>
<font></font>
absl::optional&lt;mediapipe::Detection&gt; BoundaryBoxCropCalculator::FindOverlappedDetection(<font></font>
        const objectrecognition::ClickLocation&amp; click_location,<font></font>
        const std::vector&lt;mediapipe::Detection&gt;&amp; detections) {<font></font>
    for (const auto&amp; input_detection : detections) {<font></font>
        const auto&amp; b_box = input_detection.location_data().relative_bounding_box();<font></font>
<font></font>
        if (b_box.xmin() &lt; click_location.x() &amp;&amp; click_location.x() &lt; (b_box.xmin() + b_box.width())<font></font>
            &amp;&amp; b_box.ymin() &lt; click_location.y() &amp;&amp; click_location.y() &lt; (b_box.ymin() + b_box.height())) {<font></font>
            return input_detection;<font></font>
        }<font></font>
    }<font></font>
<font></font>
    return absl::nullopt;<font></font>
}<font></font>
<font></font>
std::unique_ptr&lt;mediapipe::ImageFrame&gt; BoundaryBoxCropCalculator::CropImage(<font></font>
        const mediapipe::ImageFrame&amp; image_frame,<font></font>
        const mediapipe::Detection&amp; detection) {<font></font>
    const uint8* pixel_data = image_frame.PixelData();<font></font>
    const auto&amp; b_box = detection.location_data().relative_bounding_box();<font></font>
<font></font>
    int height = static_cast&lt;int&gt;(b_box.height() * static_cast&lt;float&gt;(image_frame.Height()));<font></font>
    int width = static_cast&lt;int&gt;(b_box.width() * static_cast&lt;float&gt;(image_frame.Width()));<font></font>
    int xmin = static_cast&lt;int&gt;(b_box.xmin() * static_cast&lt;float&gt;(image_frame.Width()));<font></font>
    int ymin = static_cast&lt;int&gt;(b_box.ymin() * static_cast&lt;float&gt;(image_frame.Height()));<font></font>
<font></font>
    if (xmin &lt; 0) {<font></font>
        width += xmin;<font></font>
        xmin = 0;<font></font>
    }<font></font>
    if (ymin &lt; 0) {<font></font>
        height += ymin;<font></font>
        ymin = 0;<font></font>
    }<font></font>
    if (width &gt; image_frame.Width()) {<font></font>
        width = image_frame.Width();<font></font>
    }<font></font>
    if (height &gt; image_frame.Height()) {<font></font>
        height = image_frame.Height();<font></font>
    }<font></font>
<font></font>
    std::vector&lt;uint8_t&gt; pixels;<font></font>
    pixels.reserve(height * width * image_frame.NumberOfChannels());<font></font>
    for (int y = ymin; y &lt; ymin + height; ++y) {<font></font>
        int row_offset = y * image_frame.WidthStep();<font></font>
        for (int x = xmin; x &lt; xmin + width; ++x) {<font></font>
            for (int ch = 0; ch &lt; image_frame.NumberOfChannels(); ++ch) {<font></font>
                pixels.push_back(pixel_data[row_offset + x * image_frame.NumberOfChannels() + ch]);<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
<font></font>
    std::unique_ptr&lt;mediapipe::ImageFrame&gt; cropped_image = std::make_unique&lt;mediapipe::ImageFrame&gt;();<font></font>
    cropped_image-&gt;CopyPixelData(image_frame.Format(), width, height, pixels.data(),<font></font>
            mediapipe::ImageFrame::kDefaultAlignmentBoundary);<font></font>
<font></font>
    return cropped_image;<font></font>
}<font></font>
</code></pre><br>
<p>             .     TfLiteTensor           .</p><br>
<p> (Java )  ,    HTTP  .      ,           ""         .     ,       (   ).</p><br>
<p>,    ‚Äî     .      :</p><br>
<p><img src="https://habrastorage.org/webt/9d/2n/4y/9d2n4ytlfc4ltafnyqsaeq1vwzu.gif"></p><br>
<p>    .      (    camry  hummer),    ford focus  , ..    -,        (Hyundai SantaFe).</p><br>
<p>    4 ,     ,      .</p><br>
<p><img src="https://habrastorage.org/webt/e6/uh/ls/e6uhlstnhjhb4_dr-lewfyaz7os.jpeg"></p><br>
<p>,    ,        ,    ,        .          ,     ,       .</p><br>
<h1 id="zaklyuchenie"></h1><br>
<p>     ,          Mediapipe,     ,   ,  ,   .     real-time          .      UX,   ,      .            proof-of-concept,       :</p><br>
<ul>
<li>          CPU,     ,    ,   GPU.    GPU         CPU  GPU;</li>
<li>         ,    .         ;</li>
<li>  ;</li>
<li>             ;</li>
<li>     .         ANN (Approximate Nearest Neighbors).</li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en502424/index.html">Stop importing whole JavaScript packages</a></li>
<li><a href="../en502428/index.html">Syntactic Goodies Julia</a></li>
<li><a href="../en502432/index.html">The digest of fresh materials from the world of the front-end for the last week No. 415 (May 11-17, 2020)</a></li>
<li><a href="../en502436/index.html">CI TeamCity - Automation of build processes of Android and UI testing</a></li>
<li><a href="../en502438/index.html">Material Python. Custom cards with OpenGL effects</a></li>
<li><a href="../en502442/index.html">PHP Digest No. 180 (May 4 - 18, 2020)</a></li>
<li><a href="../en502448/index.html">IBM Weekly Seminars - May 2020</a></li>
<li><a href="../en502450/index.html">Moderation of comments 2. And yet, can we trust users? (continued)</a></li>
<li><a href="../en502454/index.html">MVVM and selection of elements in the adapter - LiveData</a></li>
<li><a href="../en502460/index.html">What to expect at the startup arena of Ukraine in 2020?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>