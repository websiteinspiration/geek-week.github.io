<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë∑üèº üö¥üèª üôÖüèæ Captures d'√©cran iOS automatiques √† l'aide de XCTestplan et Xcode 11 ‚ùÑÔ∏è üë©‚Äçüë©‚Äçüëß‚Äçüë¶ üßïüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Raiffeisenbank poss√®de plusieurs applications mobiles qui devraient fonctionner sur une grande vari√©t√© d'appareils et de syst√®mes d'exploitation, nous...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Captures d'√©cran iOS automatiques √† l'aide de XCTestplan et Xcode 11</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/raiffeisenbank/blog/502626/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raiffeisenbank poss√®de plusieurs applications mobiles qui devraient fonctionner sur une grande vari√©t√© d'appareils et de syst√®mes d'exploitation, nous essayons donc d'automatiser les processus de routine lors des tests. Cet article nous a sembl√© utile et nous avons d√©cid√© de le traduire. </font></font></i><font style="vertical-align: inherit;"><font color="grey"><font style="vertical-align: inherit;">foto source: unsplash.com</font></font><font style="vertical-align: inherit;"> 
Si votre application est multilingue, universelle et con√ßue pour diff√©rents appareils, vous pouvez passer beaucoup de temps √† cr√©er des captures d'√©cran pour chaque configuration. Imaginez que vous avez quatre langues, la prise en charge de l'iPad et de l'iPhone et que vous devez enregistrer 4 √©crans chacun - ce sont 32 captures d'√©cran. Le processus doit √™tre automatis√© afin de ne pas perdre de temps √† chaque mise √† jour des interfaces.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/zh/ny/9i/zhny9ihqeamema_yinthkbx9cgg.png"></a><br>
<font color="grey"><font style="vertical-align: inherit;"></font></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'outil XCTestPlan, apparu dans Xcode 11, nous permet de cr√©er plusieurs configurations pour les tests. </font><font style="vertical-align: inherit;">De nos jours, les configurations sont le plus souvent utilis√©es pour d√©terminer le d√©roulement des tests, y compris le choix de la langue pour l'application. </font><font style="vertical-align: inherit;">Dans cet article, vous apprendrez √† utiliser XCTestPlan pour automatiser les captures d'√©cran.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lancer XCTestplan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Configurons une cible UITests distincte pour automatiser la cr√©ation de captures d'√©cran, ce qui est particuli√®rement utile si vous ne pr√©voyez pas d'ex√©cuter vos principaux tests avec ces configurations. Pour cr√©er une nouvelle cible, s√©lectionnez </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fichier -&gt; Nouveau -&gt; Cible</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et cr√©ez un nouvel ensemble de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tests d'interface utilisateur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Apr√®s cela, vous devez ajouter un nouveau </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XCTestplan √†</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cette cible. Pour ce faire, vous pouvez utiliser le menu </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Produit -&gt; Plan de test -&gt; Nouveau plan de test</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ou dans l' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©diteur de sch√©ma,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> s√©lectionnez </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Convertir pour utiliser les plans de test</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Si vous faites cela via le menu, vous devez vous assurer que la nouvelle cible est dans l'onglet `Test`.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puisque nous voulons configurer uniquement les param√®tres de langue, nous pouvons laisser les param√®tres partag√©s inchang√©s et simplement ajouter une nouvelle configuration pour chaque langue que nous prenons en charge. </font><font style="vertical-align: inherit;">Voici √† quoi ressemblent les param√®tres d'une application prenant en charge l'anglais, l'allemand et le fran√ßais: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/e73/6c7/f4b/e736c7f4b030915e123f137711f1a73f.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
c'est toute la configuration et le lancement n√©cessaires de XCTestplan.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Capture d'√©cran Automation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vos tests d'interface utilisateur cr√©ant des captures d'√©cran ne diff√©reront pratiquement pas de vos tests habituels, sauf qu'ils cr√©eront des pi√®ces jointes. Vous pouvez √©galement ajouter des v√©rifications XCTAssert afin que les tests √©chouent en cas de probl√®me. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un autre point important: vous devrez peut-√™tre </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">attendre ForExpectations</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> au cas o√π votre interface utilisateur ne serait pas pr√™te au moment de la capture d'√©cran </font><font style="vertical-align: inherit;">( </font><b><font style="vertical-align: inherit;">afficher</font></b><font style="vertical-align: inherit;"> / masquer le clavier, terminer l'animation). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici un exemple avec toutes les m√©thodes d'assistance:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">testScreenshots</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">let</span> app = <span class="hljs-type">XCUIApplication</span>()
    <span class="hljs-keyword">let</span> searchButton = app.buttons[<span class="hljs-string">"search"</span>]<font></font>
    searchButton.tap()<font></font>
    <font></font>
    <span class="hljs-keyword">let</span> keyboard = app.keyboards.firstMatch<font></font>
    waitForExistence(of: keyboard)<font></font>
    app.typeText(<span class="hljs-string">"Cupertino"</span>)<font></font>
    add(takePromoShot(name: <span class="hljs-string">"Search"</span>))<font></font>
    <font></font>
    <span class="hljs-keyword">let</span> firstResult = app.cells.firstMatch<font></font>
    firstResult.tap()<font></font>
    waitForDisappearance(of: keyboard)<font></font>
    add(takePromoShot(name: <span class="hljs-string">"Result"</span>))<font></font>
}<font></font>
</code></pre><br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">waitForExistence</span><span class="hljs-params">(of element: XCUIElement)</span></span> {
    <span class="hljs-keyword">let</span> predicate = <span class="hljs-type">NSPredicate</span>(format: <span class="hljs-string">"exists == TRUE"</span>)<font></font>
    expectation(<span class="hljs-keyword">for</span>: predicate, evaluatedWith: element, handler: <span class="hljs-literal">nil</span>)<font></font>
    waitForExpectations(timeout: <span class="hljs-number">5.0</span>, handler: <span class="hljs-literal">nil</span>)<font></font>
}<font></font>
</code></pre><br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">waitForDisappearance</span><span class="hljs-params">(of element: XCUIElement)</span></span> {
    <span class="hljs-keyword">let</span> predicate = <span class="hljs-type">NSPredicate</span>(format: <span class="hljs-string">"exists == FALSE"</span>)<font></font>
    expectation(<span class="hljs-keyword">for</span>: predicate, evaluatedWith: element, handler: <span class="hljs-literal">nil</span>)<font></font>
    waitForExpectations(timeout: <span class="hljs-number">5.0</span>, handler: <span class="hljs-literal">nil</span>)<font></font>
}<font></font>
</code></pre><br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">takePromoShot</span><span class="hljs-params">(name: String)</span></span> -&gt; <span class="hljs-type">XCTAttachment</span> {
    <span class="hljs-keyword">let</span> lang = <span class="hljs-type">Locale</span>.preferredLanguages[<span class="hljs-number">0</span>]
    <span class="hljs-keyword">let</span> screenshot = <span class="hljs-type">XCUIScreen</span>.main.screenshot()
    <span class="hljs-keyword">let</span> attachment = <span class="hljs-type">XCTAttachment</span>(screenshot: screenshot)<font></font>
    attachment.lifetime = .keepAlways<font></font>
    attachment.name = <span class="hljs-string">"\(lang)-\(name)"</span>
    <span class="hljs-keyword">return</span> attachment<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Faites attention √† la derni√®re fonctionnalit√©. </font><font style="vertical-align: inherit;">Il prend le nom de l'instantan√©, ajoute l'identifiant de langue, prend une capture d'√©cran et renvoie un XCTAttachment avec la valeur du param√®tre </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.keepAlways</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ceci est important car par d√©faut, les captures d'√©cran prises lors des tests sont supprim√©es si les tests r√©ussissent. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lifiteme est</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> un param√®tre important car il garantit que la capture d'√©cran est enregistr√©e une fois le test termin√©. </font><font style="vertical-align: inherit;">Pendant les tests d'interface utilisateur, des captures d'√©cran sont constamment prises. </font><font style="vertical-align: inherit;">Ils sont tr√®s utiles lorsque vous devez d√©terminer pourquoi et quand le test a √©chou√©; </font><font style="vertical-align: inherit;">mais par d√©faut, les captures d'√©cran seront supprim√©es si les tests ont r√©ussi. </font><font style="vertical-align: inherit;">Ainsi, lorsque </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">testScreenshots ()</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> r√©ussit, vous n'aurez que les captures d'√©cran n√©cessaires.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Barre d'√©tat habituelle</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La plupart des d√©veloppeurs pr√©f√®rent voir sur leurs captures d'√©cran une barre d'√©tat avec le bon moment, un signal r√©seau complet et d'autres d√©tails. </font><font style="vertical-align: inherit;">Dans Xcode 11, cela est encore plus facile. </font><font style="vertical-align: inherit;">Il existe un utilitaire </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xcrun simctl status_bar</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui vous permet de sp√©cifier ces param√®tres. </font><font style="vertical-align: inherit;">Cela peut √™tre ajout√© en tant que </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">phase de construction</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="bash hljs">xcrun simctl status_bar booted override --time 9:41 --operatorName <span class="hljs-string">' '</span> --cellularMode active --cellularBar 4 --wifiBars 3 --batteryState charged</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s cette commande, la barre d'√©tat aura la m√™me apparence que dans les documents marketing d'Apple. </font><font style="vertical-align: inherit;">Malheureusement, l'√©quipe ne fonctionnera pas sur un v√©ritable appareil, uniquement dans un simulateur. </font><font style="vertical-align: inherit;">Il convient √©galement de noter que le simulateur que vous utilisez doit √™tre en cours d'ex√©cution avant de commencer les tests pour collecter des captures d'√©cran.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Collecte des captures d'√©cran r√©sultantes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous pouvons maintenant ex√©cuter nos tests d'interface utilisateur. </font><font style="vertical-align: inherit;">Quand ils passeront, nous verrons les r√©sultats dans </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Report Navigator</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans Xcode. </font><font style="vertical-align: inherit;">Il y aura √©galement des tests contenant des proc√©dures regroup√©es par configurations de langage. </font><font style="vertical-align: inherit;">Les proc√©dures qui ont des pi√®ces jointes sont marqu√©es avec un trombone. </font><font style="vertical-align: inherit;">Les images elles-m√™mes peuvent √™tre ouvertes dans </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QuickLook</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/4c8/412/fce/4c8412fce1f89e4da3cc3ceddc79d858.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La collecte s√©par√©e de toutes les images r√©sultantes peut prendre beaucoup de temps, surtout si votre application prend en charge plusieurs langues. </font><font style="vertical-align: inherit;">Malheureusement, ces pi√®ces jointes n'apparaissent pas au format png ou jpg parmi les r√©sultats du test (un autre changement dans Xcode 11). </font><font style="vertical-align: inherit;">Mais vous pouvez analyser les r√©sultats du test et trouver le JSON qui pointe vers les vraies pi√®ces jointes et les recueille. </font><font style="vertical-align: inherit;">Cela peut √™tre fait </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√† l'aide de l'utilitaire xcparse.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Il est install√© √† l'aide de Homebrew et lanc√© par la commande:</font></font><br>
<br>
<pre><code class="bash hljs">xcparse screenshots /path/to/Test.xcresult /path/to/outputDirectory</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Des indicateurs suppl√©mentaires regrouperont les fichiers par p√©riph√©rique, syst√®me d'exploitation ou configuration. </font><font style="vertical-align: inherit;">Les noms de nos fichiers contiennent un identifiant de langue, vous pouvez donc simplement les trier par nom.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'approche d√©crite nous a d√©j√† permis de gagner suffisamment de temps, en particulier dans les situations o√π il √©tait n√©cessaire de prendre en charge l'appareil avec une nouvelle r√©solution ou l'interface a √©t√© consid√©rablement mise √† jour. </font><font style="vertical-align: inherit;">Lors de la WWDC20, j'aimerais voir le choix des appareils dans le cadre de la configuration XCTestplan, mais pour l'instant, vous devez choisir manuellement ou utiliser un script qui recueille les captures d'√©cran n√©cessaires dans l'AppStore.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr502604/index.html">Une introduction √† TLS pour Patrik Patrick (Partie 1)</a></li>
<li><a href="../fr502608/index.html">Comment nous avons lanc√© le march√© des applications dans le service SaaS</a></li>
<li><a href="../fr502614/index.html">Meilleures pratiques Kubernetes. D√©finition de requ√™tes et de limites de ressources</a></li>
<li><a href="../fr502620/index.html">Comptabilit√© mon√©taire</a></li>
<li><a href="../fr502624/index.html">Comment fonctionnent-ils sur Facebook? Valeurs et embauche dans une entreprise</a></li>
<li><a href="../fr502628/index.html">Le mythe du web s√©mantique</a></li>
<li><a href="../fr502630/index.html">Le courrier que vous avez supprim√© il y a quelques ann√©es peut toujours √™tre stock√© sur votre smartphone</a></li>
<li><a href="../fr502634/index.html">T√©l√©m√©decine. Trois startups technologiques. Le produit est un, mais des destins diff√©rents</a></li>
<li><a href="../fr502636/index.html">Business et cyberpunk: m√©langer, maintenir, utiliser</a></li>
<li><a href="../fr502638/index.html">Comment d√©velopper un blog sur Instagram en 2020: analyse du cas de Sasha Mitroshina</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>