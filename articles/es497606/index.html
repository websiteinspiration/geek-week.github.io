<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîÑ üêû üóùÔ∏è Sistema de riego autom√°tico de jardines para Home Assistant, ESP8266 y MiFlora ‚úãüèΩ üåßÔ∏è üçò</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hace alg√∫n tiempo, mi familia ten√≠a una casa con un peque√±o jard√≠n en un lugar muy c√°lido y √°rido, y enfrentamos el problema del riego regular. 
 
 Qu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Sistema de riego autom√°tico de jardines para Home Assistant, ESP8266 y MiFlora</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/497606/"><img src="https://habrastorage.org/webt/87/-y/wi/87-ywilifgui1kkhe06izsbt7ag.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hace alg√∫n tiempo, mi familia ten√≠a una casa con un peque√±o jard√≠n en un lugar muy c√°lido y √°rido, y enfrentamos el problema del riego regular. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quer√≠a que el sistema de riego fuera autom√°tico, mientras que al elegirlo ten√≠a que tener en cuenta las siguientes condiciones:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> agua muy cara que debe ahorrarse de todas las formas disponibles </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diferentes plantas en el jard√≠n para requisitos de humedad, desde suculentas hasta amantes de la humedad</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La necesidad de un riego totalmente aut√≥nomo durante la ausencia de personas en la casa, preferiblemente con la posibilidad de control remoto </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> clima √°rido que no perdona los errores de riego</font></font></li>
</ul> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de evaluar las soluciones listas para usar que se encontraron en las redes locales de bricolaje y en Amazon y leer las rese√±as sobre su confiabilidad (generalmente no la m√°s alta), decidimos intentar hacer algo por nuestra cuenta. </font></font><br>
<a name="habracut"></a><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descargo de responsabilidad: el autor no es un especialista en TI y no pretende ser un conocimiento profesional del tema. </font><font style="vertical-align: inherit;">El nivel de ejecuci√≥n del proyecto es un pasatiempo. </font><font style="vertical-align: inherit;">El autor es muy consciente del nivel de sus conocimientos en programaci√≥n y electr√≥nica y apreciar√° enormemente las sugerencias para mejorar y optimizar las soluciones utilizadas.</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diagrama de circuito</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El jard√≠n se dividi√≥ en 4 zonas de riego, cada una de ellas est√° equipada con un sensor individual de humedad del suelo y se puede regar seg√∫n un horario individual y una cantidad diferente de agua. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el suelo, se colocan tuber√≠as PND de riego por goteo con perforaci√≥n, que se conectan a las tuber√≠as que convergen en la unidad de recolecci√≥n de agua y se conectan a trav√©s de las v√°lvulas electromagn√©ticas al suministro de agua. </font><font style="vertical-align: inherit;">Las v√°lvulas est√°n controladas por rel√©s conectados al ESP8266 (Sonoff 4Ch). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El riego se lleva a cabo por temporizadores, por la noche, para aumentar la cantidad de agua que se absorbe en el suelo y no ser√° evaporada por el sol. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el horario de riego programado, se verifica el cumplimiento de varias condiciones:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> humedad del suelo por debajo de un valor predeterminado </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no hay precipitaciones previstas en una cantidad lo suficientemente grande para los pr√≥ximos 2 d√≠as </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no se supera el l√≠mite de agua para riego establecido para esta l√≠nea</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Equipo usado</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raspberry Pie</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> con HassIO instalado (ya ten√≠a) </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP32 DevKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , un firmware ESPHome, que act√∫a como una puerta de enlace bluetooth para MiFlora y recibe datos de sensores de humedad con cable. </font><font style="vertical-align: inherit;">Ubicado en el jard√≠n </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sensores de humedad con cable </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sensor capacitivo de humedad del suelo v1.2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que mide la humedad en las zonas de riego m√°s cercanas al sitio de instalaci√≥n de ESP32 Los </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sensores</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MiFlora </font><b><font style="vertical-align: inherit;">est√°n</font></b><font style="vertical-align: inherit;"> conectados al ESP32 a trav√©s de BLE, que miden la humedad en zonas de riego remotas. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SONOFF 4Ch</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , cosido con ESPHome, se encuentra en la unidad de entrada de agua, donde vienen las tuber√≠as de todas las zonas de riego </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 V√°lvulas solenoides normalmente cerradas para 220V</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ubicado en el soporte de agua y conectado al Sonoff 4Ch. Abra el suministro de agua para riego. Se eligi√≥ un modelo normalmente cerrado para minimizar la probabilidad de ‚Äúinundaci√≥n‚Äù en caso de falla de los sistemas el√©ctricos y electr√≥nicos, y para minimizar el n√∫mero de salidas de rel√© requeridas. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> medidor de </font><b><font style="vertical-align: inherit;">agua pulsada</font></b><font style="vertical-align: inherit;"> en la entrada del sistema de riego en la unidad de toma de agua y conectado al Sonoff 4ch. Se le permite transferir completamente los datos de flujo de agua a Home Asssistant e implementar la funcionalidad de riego con una cantidad determinada. Result√≥ ser muy exitoso que en esta versi√≥n de sonoff los contactos para el firmware ya estaban soldados e incluso hab√≠a un GPIO02 libre: se colg√≥ un contador de pulsos.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ec/zz/d9/eczzd9zfq4drf8katpm4ofyn0b4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parece un colector con v√°lvulas instaladas y un medidor de agua. </font><font style="vertical-align: inherit;">El controlador (sonoff 4Ch) no entr√≥ en el marco, se instal√≥ a una distancia de medio metro en el escudo IP65</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuraci√≥n de ESPHome y Home Assistant</font></font></h3><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sonoff 4ch</font></font></b><div class="spoiler_text"> ESPHome    ,     :<br>
<br>
<pre><code class="xml hljs">switch:<font></font>
  - platform: gpio<font></font>
    name: "   1"<font></font>
    pin: GPIO12<font></font>
    id: sw1<font></font>
    icon: mdi:water<font></font>
  - platform: gpio<font></font>
    name: "   2"<font></font>
    pin: GPIO5<font></font>
    id: sw2<font></font>
    icon: mdi:water<font></font>
  - platform: gpio<font></font>
    name: "   3"<font></font>
    pin: GPIO4<font></font>
    id: sw3<font></font>
    icon: mdi:water<font></font>
  - platform: gpio<font></font>
    name: "   4"<font></font>
    pin: GPIO15<font></font>
    id: sw4<font></font>
    icon: mdi:water<font></font>
binary_sensor:<font></font>
  - platform: gpio<font></font>
    name: "WaterCounter"<font></font>
    id: button<font></font>
    pin:<font></font>
      number: GPIO2<font></font>
      mode: INPUT_PULLUP<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sensor capacitivo de humedad del suelo v1.2</font></font></b><div class="spoiler_text">   ESPHome:<br>
<br>
<pre><code class="xml hljs">sensor:<font></font>
  - platform: adc<font></font>
    pin: GPIO34<font></font>
    filters:<font></font>
      - lambda: |-<font></font>
          if (x &gt; 3.22) {<font></font>
            return 0;<font></font>
          } else if (x <span class="hljs-tag">&lt; <span class="hljs-attr">1.65</span>) {
            <span class="hljs-attr">return</span> <span class="hljs-attr">100</span>;
          } <span class="hljs-attr">else</span> {
            <span class="hljs-attr">return</span> (<span class="hljs-attr">3.22-x</span>) / (<span class="hljs-attr">3.22-1.65</span>) * <span class="hljs-attr">100.0</span>;
          }
    <span class="hljs-attr">name:</span> "   <span class="hljs-attr">1</span>  "
    <span class="hljs-attr">update_interval:</span> <span class="hljs-attr">60s</span>
    <span class="hljs-attr">attenuation:</span> <span class="hljs-attr">11db</span>
    <span class="hljs-attr">unit_of_measurement:</span> "%"
    <span class="hljs-attr">accuracy_decimals:</span> <span class="hljs-attr">0</span>
    <span class="hljs-attr">icon:</span> <span class="hljs-attr">mdi:water-percent</span>
</span></code></pre><br>
       (ADC)  <br>
  ,        (   3.22 )     (1,65 ).      log'   ESPHome  HassIO            .<br>
<br>
<img src="https://habrastorage.org/webt/sb/tf/b4/sbtfb4ckgxx7kltxe6kk8a5q0r4.png"><br>
<br>
  ESP32  Home Assistant    ,         <br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Medidor de agua de pulso</font></font></b><div class="spoiler_text">   ¬´¬ª,          (   ).       ‚Äî      ,   ,        (  ‚Äî  3   10 ). <br>
,      GND    GPIO      .<br>
<br>
  ESPHome   : <br>
<br>
<pre><code class="xml hljs">binary_sensor:<font></font>
  - platform: gpio<font></font>
    name: "WaterCounter"<font></font>
    id: counter<font></font>
    pin:<font></font>
      number: GPIO2<font></font>
      mode: INPUT_PULLUP<font></font>
</code></pre><br>
 Home Assistant   :<br>
<br>
     (counter),       <br>
          (,   ¬´¬ª  ).      ‚Äî  counter,              ESPHome,   sensor,          counter (       ).<br>
<br>
           2      ‚Äî    ,    ¬´¬ª.       ,   ,                      . <br>
<br>
<div class="spoiler"><b class="spoiler_title">    ( automations.yaml   )</b><div class="spoiler_text"><pre><code class="xml hljs">- alias:     <font></font>
  trigger:<font></font>
  - entity_id: binary_sensor.watercounter<font></font>
    platform: state<font></font>
    from: 'on'<font></font>
    to: 'off'<font></font>
  action:<font></font>
  - data:<font></font>
      entity_id:<font></font>
      - counter.my_water_counter<font></font>
    service: counter.increment<font></font>
- alias:    1 <font></font>
  trigger:<font></font>
  - entity_id: binary_sensor.watercounter<font></font>
    platform: state<font></font>
    from: 'on'<font></font>
    to: 'off'<font></font>
  condition:<font></font>
    - condition: state<font></font>
      entity_id: switch.sistema_poliva_liniia_1<font></font>
      state: 'on'<font></font>
  action:<font></font>
  - data:<font></font>
      entity_id:<font></font>
      - counter.my_water_line1, counter.my_water_line1t<font></font>
    service: counter.increment    <font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title">  configuration.yaml    +      </b><div class="spoiler_text"><pre><code class="xml hljs"><font></font>
sensor:<font></font>
  - platform: template<font></font>
    sensors:<font></font>
      water_counter:    <font></font>
        unit_of_measurement: 'M3'<font></font>
        value_template: "{{ (states('counter.my_water_counter')| float)/1000 }}"    <font></font>
counter:<font></font>
  my_water_counter:<font></font>
    initial: 2.667<font></font>
    step: 10<font></font>
  my_water_line1:<font></font>
    name: " 1     ()"<font></font>
    initial: 0<font></font>
    step: 10<font></font>
  my_water_line1t:<font></font>
    name: " 1   ()"<font></font>
    initial: 0<font></font>
    step: 10<font></font>
</code></pre><br>
</div></div><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sensor MiFlora</font></font></b><div class="spoiler_text"> MiFlora   ESPHome   ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">esphome.io</a> <br>
 Home Assistant          ‚Äî , ,   ¬´¬ª .   ‚Äî     ,        .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sensor de lluvia virtual</font></font></b><div class="spoiler_text">   ‚Äî          .            ,   . <br>
<br>
       darksky.  ,          Apple        ¬´ ¬ª. API  , ,   ,      ,   HA     .      darksky, ,          .<br>
<br>
  2        :<br>
<br>
<div class="spoiler"><b class="spoiler_title">  configuration.yaml  sensors.yaml   </b><div class="spoiler_text"><pre><code class="xml hljs"><font></font>
sensor:<font></font>
  - platform: darksky<font></font>
    api_key: xxxx_your_API_key_xxxx<font></font>
    forecast:<font></font>
      - 1<font></font>
      - 2<font></font>
    monitored_conditions:<font></font>
      - precip_intensity<font></font>
</code></pre><br>
   HA   : sensor.dark_sky_precip_intensity_1d  sensor.dark_sky_precip_intensity_2d,              .<br>
</div></div><br>
       template-sensor:<br>
<br>
<div class="spoiler"><b class="spoiler_title">  configuration.yaml  sensors.yaml    </b><div class="spoiler_text"><pre><code class="xml hljs"><font></font>
sensor:<font></font>
  - platform: template<font></font>
    sensors:<font></font>
       rain2days:    <font></font>
        unit_of_measurement: 'mm'<font></font>
        value_template: "{{ (((states('sensor.dark_sky_precip_intensity_2d')| float)+(states('sensor.dark_sky_precip_intensity_1d')| float))*24)| round(3) }}"    <font></font>
</code></pre><br>
 HA  sensor.rain2days          2 . <br>
  ,   Darksky         ,              <br>
</div></div><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de recopilar todos los datos, puede proceder directamente al riego. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As√≠ es como miro una parte de la interfaz desde una de las zonas del Asistente de inicio: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pf/l6/ut/pfl6ut8aoieytcg0kxlk-mjslcu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
aqu√≠ puede establecer la cantidad de agua para riego (con un control deslizante) y ver los valores de los principales sensores y contadores. </font><font style="vertical-align: inherit;">Le di la interfaz para una de las l√≠neas, para el resto todo es igual, solo en l√≠neas con sensores de datos cableados es un poco menos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la interfaz, puede observar un detalle "superfluo": el sensor auxiliar "Se ha alcanzado la norma". </font><font style="vertical-align: inherit;">Ten√≠a que ser introducido, porque </font><font style="vertical-align: inherit;">No pude obtener la condici√≥n: plantilla para trabajar para detener la automatizaci√≥n cuando se alcanz√≥ la norma para la cantidad de agua, y como resultado, la automatizaci√≥n solo verifica el valor de este sensor. </font><font style="vertical-align: inherit;">Estoy seguro de que esta parte de la automatizaci√≥n puede hacerse m√°s simple y elegante, pero mi nivel no fue suficiente para esto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n se muestra el c√≥digo para el sensor de plantilla "muleta" resultante:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sensor de suficiencia de riego (dentro de configuration.yaml o un archivo separado)</font></font></b><div class="spoiler_text"><pre><code class="xml hljs">  - platform: template<font></font>
    sensors:<font></font>
      line4_status:<font></font>
        friendly_name: " 4 -  "<font></font>
        value_template: &gt;-<font></font>
          {% if states('counter.my_water_line4t')|float &gt; states('input_number.slider4')|float %}<font></font>
            yes<font></font>
          {% elif states('counter.my_water_line4t')|float == states('input_number.slider4')|float  %}<font></font>
            yes<font></font>
          {% else %}<font></font>
            no<font></font>
          {% endif %}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La automatizaci√≥n para comenzar a regar finalmente se ve as√≠:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comience a regar (dentro de automatations.yaml o un archivo separado)</font></font></b><div class="spoiler_text"><pre><code class="xml hljs">- alias:   4   23.01<font></font>
  trigger:<font></font>
    platform: time<font></font>
    at: "23:01:00"<font></font>
  condition:<font></font>
   condition: and<font></font>
   conditions:<font></font>
#    <font></font>
    - condition: numeric_state<font></font>
      entity_id: sensor.rainfor2days<font></font>
      below: 5<font></font>
#      <font></font>
    - condition: numeric_state<font></font>
      entity_id: sensor.miflora_1_moisture<font></font>
      below: 50<font></font>
# ,       <font></font>
    - condition: state<font></font>
      entity_id: 'sensor.line4_status'<font></font>
      state: 'no'<font></font>
  action:<font></font>
   - service: switch.turn_on<font></font>
     entity_id: switch.sistema_poliva_liniia_4<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El riego comienza tarde en la noche, con cada l√≠nea comenzando en su propio intervalo de tiempo. </font><font style="vertical-align: inherit;">La separaci√≥n por hora de inicio le permite usar un medidor de agua de entrada para obtener datos en 4 l√≠neas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al inicio, se verifican tres condiciones:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øNo se ha excedido el l√≠mite de la cantidad de agua para hoy (si, por ejemplo, se activ√≥ el riego manual)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øLa humedad supera el 50% (seg√∫n las observaciones en nuestras condiciones, el suelo reci√©n derramado tiene un contenido de humedad de no m√°s del 60%)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no se esperan precipitaciones mayores de 5 mm en los pr√≥ximos dos d√≠as.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La siguiente automatizaci√≥n es deshabilitar el riego:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deshabilitar el riego (dentro de automatations.yaml o un archivo separado)</font></font></b><div class="spoiler_text"><pre><code class="xml hljs">- alias:   4 <font></font>
  trigger:<font></font>
#      <font></font>
  - entity_id: sensor.line4_status<font></font>
    platform: state<font></font>
    to: 'yes'<font></font>
    for: <font></font>
      seconds: 5    <font></font>
#   <font></font>
  - platform: time<font></font>
    at: "23:59:00"<font></font>
#     <font></font>
  - platform: numeric_state<font></font>
    entity_id: sensor.miflora_1_moisture<font></font>
    above: 65<font></font>
#       <font></font>
  - platform: state<font></font>
    entity_id: switch.sistema_poliva_liniia_4<font></font>
    to: 'on'<font></font>
    for: <font></font>
      minutes: 60<font></font>
  action:<font></font>
   - service: switch.turn_off<font></font>
     entity_id: switch.sistema_poliva_liniia_4<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la automatizaci√≥n, se utilizaron hasta 4 variantes de disparadores, pero en la mayor√≠a de los casos funciona de acuerdo con el primero: un sensor de "muleta", que controla el exceso del l√≠mite por la cantidad de agua. </font><font style="vertical-align: inherit;">El resto de los desencadenantes se realizan en gran medida por razones de seguridad. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bueno, la √∫ltima automatizaci√≥n relacionada con el problema es restablecer el contador diario</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Poner a cero el contador diario (dentro de automatations.yaml o un archivo separado)</font></font></b><div class="spoiler_text"><pre><code class="xml hljs"><font></font>
- alias:    4 <font></font>
  trigger:<font></font>
  - platform: time<font></font>
    at: "00:00:01"<font></font>
  action:<font></font>
  - service: counter.reset<font></font>
    entity_id: counter.my_water_line4t<font></font>
</code></pre><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Proyecto economico</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los costos para la parte de control del sistema de riego fueron los siguientes: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(Raspberry PIE con HassIO a bordo y un enrutador WiFi con un revestimiento en el jard√≠n ya estaban antes del inicio del proyecto, no los tengo en cuenta) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V√°lvula solenoide UNIPUMP BCX-15 1/2 "(normalmente cerrada) 4 * 20 euros </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sonoff 4CH 17 euros </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Medidor de pulso Pulsar 8 euros </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESP32 DevKitC 3.5 euros </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sensor capacitivo de humedad del suelo v1.2 2 * 0.67 euros </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sensores MiFlora 2 * 16 euros Protectores </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
, colector, cables, accesorios, todos juntos alrededor de 50 euros </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TOTAL: alrededor de 190 euros</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El tiempo dedicado a configurar los sensores y MK es de aproximadamente 3 a 4 pm durante varias horas, pero la mayor parte del tiempo se dedic√≥ a "inventar bicicletas" e inventar "muletas", en general, no hay mucho trabajo. </font><font style="vertical-align: inherit;">El montaje f√≠sico del sistema tom√≥ alrededor de 2 tardes. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En general, se espera un ahorro de agua de alrededor del 20-50% en comparaci√≥n con el sistema de temporizador "tonto" y, a precios locales del agua, el sistema deber√≠a pagar en una o dos temporadas.</font></font><br>
 <br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deficiencias y planes de revisi√≥n</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado del proyecto, se revelaron algunos matices y oportunidades para una mejora adicional. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En particular, reemplazar√≠a las v√°lvulas solenoides de 220V con un modelo de 24V; este voltaje es est√°ndar para los sistemas de riego. En este caso, tendr√≠a que agregar un transformador de 24 V al sistema y cambiar el Sonoff 4Ch a algo con un contacto seco (por ejemplo, Sonoff 4CH Pro o algo autoensamblado). Las v√°lvulas en s√≠ son m√°s baratas (a partir de 8 euros) y reducen la probabilidad de descarga el√©ctrica. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n result√≥ que para trabajar con tuber√≠as de pl√°stico, la presi√≥n del suministro de agua es demasiado alta y los accesorios pueden tener fugas durante el ciclo de riego. En mi caso, esto no es cr√≠tico, todos los accesorios est√°n ubicados por encima del √°rea de riego, pero en el buen sentido es necesario agregar un reductor en la entrada para disminuir la presi√≥n.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estaba a√∫n m√°s molesto por la imposibilidad de contabilizar la cantidad de agua para riego en vol√∫menes inferiores a 10 litros; este volumen es la cantidad m√≠nima medible para dicho medidor. </font><font style="vertical-align: inherit;">Este problema puede resolverse desmontando el mostrador e intercambiando las ruedas, pero hasta entonces las manos no lo han alcanzado.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es497588/index.html">Spring Security: un ejemplo de aplicaci√≥n web de autorizaci√≥n OAuth2 a trav√©s de BitBucket</a></li>
<li><a href="../es497590/index.html">Nos ocupamos del algoritmo de colapso de la funci√≥n de onda</a></li>
<li><a href="../es497594/index.html">Almacenamiento externo de datos: desde la √©poca de IBM 1311 hasta la actualidad. Parte 1</a></li>
<li><a href="../es497596/index.html">Larga vida a PHP</a></li>
<li><a href="../es497602/index.html">¬øTe consideras un firmante? A quien estas bromeando</a></li>
<li><a href="../es497608/index.html">C√≥mo los sistemas de an√°lisis de tr√°fico detectan t√°cticas de piratas inform√°ticos por MITER ATT & CK, Parte 5</a></li>
<li><a href="../es497612/index.html">La historia de c√≥mo la mano invisible del mercado me transfiri√≥ a un lugar remoto</a></li>
<li><a href="../es497614/index.html">Experimentos de pensamiento, paradojas y l√≠mites de la l√≥gica // Estamos condenados # 2</a></li>
<li><a href="../es497616/index.html">Entrevista con Alexander Makarov (Yii) sobre Opensource, conferencias y Yii</a></li>
<li><a href="../es497618/index.html">Implementaci√≥n del concepto de acceso remoto altamente seguro</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>