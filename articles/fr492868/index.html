<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèæ‚Äçüé§ ü§üüèæ üåÉ Optimisation des cha√Ænes dans ClickHouse. Rapport Yandex üï¥Ô∏è üê∑ üèá</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le moteur de base de donn√©es analytique ClickHouse traite de nombreuses lignes diff√©rentes, consommant des ressources. Pour acc√©l√©rer le syst√®me, de n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Optimisation des cha√Ænes dans ClickHouse. Rapport Yandex</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/492868/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le moteur de base de donn√©es analytique ClickHouse traite de nombreuses lignes diff√©rentes, consommant des ressources. </font><font style="vertical-align: inherit;">Pour acc√©l√©rer le syst√®me, de nouvelles optimisations sont constamment ajout√©es. </font><font style="vertical-align: inherit;">Le d√©veloppeur de ClickHouse Nikolay Kochetov parle du type de donn√©es de cha√Æne, y compris le nouveau type, LowCardinality, et explique comment acc√©l√©rer le travail avec les cha√Ænes.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/rqf-ILRgBdY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Tout d'abord, voyons comment vous pouvez stocker des cha√Ænes. </font></font><br>
<a name="habracut"></a><br>
<img src="https://habrastorage.org/webt/ch/9s/zs/ch9szsqfnkkvpmjjxoo0lmpacno.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons des types de donn√©es de cha√Æne. </font><font style="vertical-align: inherit;">La cha√Æne fonctionne bien par d√©faut, elle devrait √™tre utilis√©e presque toujours. </font><font style="vertical-align: inherit;">Il a une petite surcharge - 9 octets par ligne. </font><font style="vertical-align: inherit;">Si nous voulons que la taille de la ligne soit fixe et connue √† l'avance, il est pr√©f√©rable d'utiliser FixedString. </font><font style="vertical-align: inherit;">Dans celui-ci, vous pouvez d√©finir le nombre d'octets dont nous avons besoin, il est pratique pour les donn√©es telles que les adresses IP ou les fonctions de hachage. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rd/lx/mo/rdlxmobm0ch5l88ab74sszn_fps.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien s√ªr, quelque chose ralentit parfois. </font><font style="vertical-align: inherit;">Supposons que vous effectuez une requ√™te sur une table. </font><font style="vertical-align: inherit;">ClickHouse lit une quantit√© assez importante de donn√©es, disons, √† une vitesse de 100 Go / s, avec peu de lignes en cours de traitement. </font><font style="vertical-align: inherit;">Nous avons deux tableaux qui stockent presque les m√™mes donn√©es. </font><font style="vertical-align: inherit;">ClickHouse lit les donn√©es de la deuxi√®me table √† une vitesse plus √©lev√©e, mais elle lit trois fois moins de lignes par seconde.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nd/tz/6l/ndtz6l6-1pwaycgcoxhslfj2hcm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si nous regardons la taille des donn√©es compress√©es, elle sera presque √©gale. En fait, les m√™mes donn√©es sont √©crites dans les tableaux - le premier milliard de nombres - seulement dans la premi√®re colonne sont-elles √©crites sous la forme UInt64, et dans la deuxi√®me colonne dans String. Pour cette raison, la deuxi√®me requ√™te lit les donn√©es du disque plus longtemps et les d√©compresse. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/i8/a2/vf/i8a2vfterxcfto5foypz6tig3zy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici un autre exemple. Supposons qu'il existe un ensemble de lignes pr√©d√©termin√©, il est limit√© √† une constante de 1000 ou 10 000 et ne change presque jamais. Dans ce cas, le type de donn√©es Enum nous convient, dans ClickHouse il y en a deux - Enum8 et Enum16. En raison du stockage dans Enum, nous traitons rapidement les demandes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ClickHouse a des acc√©l√©rations pour GROUP BY, IN, DISTINCT et des optimisations pour certaines fonctions, par exemple, pour la comparaison avec une cha√Æne constante. Bien s√ªr, les nombres de la cha√Æne ne sont pas convertis, mais, au contraire, la cha√Æne constante est convertie en la valeur Enum. Apr√®s cela, tout est rapidement compar√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais il y a aussi des inconv√©nients. M√™me si nous connaissons l'ensemble exact de lignes, il doit parfois √™tre renouvel√©. Une nouvelle ligne est arriv√©e - nous devons faire ALTER. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/b0/ay/sz/b0ayszedkf252ktki2xizo2fxfm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER pour Enum dans ClickHouse est impl√©ment√© de mani√®re optimale. Nous n'√©crase pas les donn√©es sur le disque, mais ALTER peut ralentir en raison du fait que les structures Enum sont stock√©es dans le sch√©ma de la table elle-m√™me. Par cons√©quent, nous devons attendre les demandes de lecture de la table, par exemple.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La question est, peut-on faire mieux? Peut-√™tre oui. Vous pouvez enregistrer la structure Enum non pas dans le sch√©ma de table, mais dans ZooKeeper. Cependant, des probl√®mes de synchronisation peuvent survenir. Par exemple, une r√©plique a re√ßu des donn√©es, l'autre non, et si elle a un ancien Enum, alors quelque chose va se casser. (Dans ClickHouse, nous avons presque termin√© les demandes ALTER non bloquantes. Lorsque nous les aurons compl√®tement termin√©es, nous n'aurons pas √† attendre les demandes de lecture.) </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yf/rc/vj/yfrcvjamitxxi5taditsaouvrl4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour ne pas jouer avec ALTER Enum, vous pouvez utiliser des dictionnaires ClickHouse externes. Permettez-moi de vous rappeler qu'il s'agit d'une structure de donn√©es de valeur-cl√© √† l'int√©rieur de ClickHouse, avec laquelle vous pouvez obtenir des donn√©es √† partir de sources externes, par exemple, √† partir de tables MySQL.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le dictionnaire ClickHouse, nous stockons de nombreuses lignes diff√©rentes, et dans le tableau leurs identifiants sous forme de nombres. Si nous devons obtenir une cha√Æne, nous appelons la fonction dictGet et travaillons avec. Apr√®s cela, nous ne devrions pas faire ALTER. Pour ajouter quelque chose √† Enum, nous l'ins√©rons dans la m√™me table MySQL. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais il y a d'autres probl√®mes. Tout d'abord, la syntaxe maladroite. Si nous voulons obtenir une cha√Æne, nous devons appeler dictGet. Deuxi√®mement, le manque de quelques optimisations. La comparaison avec la cha√Æne constante pour les dictionnaires n'est pas non plus rapide. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il peut encore y avoir des probl√®mes avec la mise √† jour. Supposons que nous ayons demand√© une ligne dans le dictionnaire de cache, mais qu'elle ne soit pas entr√©e dans le cache. Ensuite, nous devons attendre que les donn√©es soient charg√©es √† partir d'une source externe.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/em/4z/ii/em4ziibqzsukh-mvfu2o8dpncv0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un inconv√©nient commun des deux m√©thodes est que nous stockons toutes les cl√©s au m√™me endroit et les synchronisons. </font><font style="vertical-align: inherit;">Alors pourquoi ne pas stocker les dictionnaires localement? </font><font style="vertical-align: inherit;">Pas de synchronisation - pas de probl√®me. </font><font style="vertical-align: inherit;">Vous pouvez stocker le dictionnaire localement dans un morceau sur le disque. </font><font style="vertical-align: inherit;">Autrement dit, nous avons ins√©r√©, enregistr√© un dictionnaire. </font><font style="vertical-align: inherit;">Si nous travaillons avec des donn√©es en m√©moire, nous pouvons √©crire un dictionnaire soit dans un bloc de donn√©es, soit dans un morceau de colonne, soit dans un cache pour acc√©l√©rer les calculs.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encodage de cha√Ænes de vocabulaire </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous sommes donc arriv√©s √† la cr√©ation d'un nouveau type de donn√©es dans ClickHouse - LowCardinality. Il s'agit d'un format de stockage des donn√©es: comment elles sont √©crites sur le disque et comment elles sont lues, comment elles sont pr√©sent√©es en m√©moire et le sch√©ma de leur traitement. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/se/5h/5e/se5h5er0yccult4fjfamsksw4rk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a deux colonnes sur la diapositive. √Ä droite, les cha√Ænes sont stock√©es de mani√®re standard dans le type String. On peut voir qu'il s'agit d'une sorte de mod√®le de t√©l√©phone mobile. √Ä gauche, il y a exactement la m√™me colonne, uniquement dans le type LowCardinality. Il se compose d'un dictionnaire avec de nombreuses lignes diff√©rentes (lignes de la colonne de droite) et d'une liste de positions (num√©ros de ligne). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En utilisant ces deux structures, vous pouvez restaurer la colonne d'origine. Il existe √©galement un index inverse invers√© - une table de hachage qui vous aide √† trouver la position dans le dictionnaire par ligne. Il est n√©cessaire d'acc√©l√©rer certaines requ√™tes. Par exemple, si nous voulons comparer, recherchez une ligne dans notre colonne ou fusionnez-les.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LowCardinality est un type de donn√©es param√©trique. Il peut s'agir d'un nombre, ou de quelque chose qui est stock√© sous forme de nombre, ou d'une cha√Æne, ou Nullable √† partir d'eux. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/et/r4/h9/etr4h9fjutj5sf6ffxqjmf04xpu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La particularit√© de LowCardinality est qu'elle peut √™tre enregistr√©e pour certaines fonctions. Un exemple de demande est pr√©sent√© sur la diapositive. Dans la premi√®re ligne, j'ai cr√©√© une colonne de type LowCardinality from String, nomm√©e S. Puis j'ai demand√© son nom - ClickHouse a dit que c'√©tait LowCardinality from String. D'accord. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La troisi√®me ligne est presque la m√™me, seulement nous avons appel√© la fonction de longueur. Dans ClickHouse, la fonction de longueur renvoie le type de donn√©es UInt64. Mais nous avons obtenu LowCardinality de UInt64. √Ä quoi √ßa sert?</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6h/hs/0x/6hhs0xgy2-hnsc8tputwp8ukqqu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les noms des t√©l√©phones portables ont √©t√© stock√©s dans le dictionnaire, nous avons appliqu√© la fonction de longueur. Maintenant, nous avons un dictionnaire similaire, compos√© uniquement de nombres, ce sont les longueurs de cha√Ænes. La colonne avec les positions n'a pas chang√©. En cons√©quence, nous avons trait√© moins de donn√©es, enregistr√©es sur le temps de demande. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il peut y avoir d'autres optimisations, comme l'ajout d'un cache simple. Lors du calcul de la valeur d'une fonction, vous pouvez vous en souvenir et la rendre identique, ne pas recalculer.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'optimisation de GROUP BY peut √©galement √™tre effectu√©e, car notre colonne avec le dictionnaire est d√©j√† partiellement agr√©g√©e - nous pouvons calculer rapidement la valeur des fonctions de hachage et trouver approximativement le compartiment o√π placer la ligne suivante. Vous pouvez √©galement sp√©cialiser certaines fonctions d'agr√©gation, par exemple uniq, car vous ne pouvez lui envoyer qu'un dictionnaire et laisser les positions intactes - de cette fa√ßon, tout fonctionnera plus rapidement. Les deux premi√®res optimisations que nous avons d√©j√† ajout√©es √† ClickHouse.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kc/6u/v4/kc6uv48b2vbsmki20ckwvvbc990.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais que se passe-t-il si nous cr√©ons une colonne avec notre type de donn√©es et y ins√©rons de nombreuses lignes diff√©rentes incorrectes? Notre m√©moire est-elle pleine? Non, il existe deux param√®tres sp√©ciaux pour cela dans ClickHouse. Le premier est low_cardinality_max_dictionary_size. Il s'agit de la taille maximale d'un dictionnaire qui peut √™tre √©crit sur le disque. L'insertion se produit comme suit: lorsque nous ins√©rons les donn√©es, un flux de lignes nous parvient, √† partir de celles-ci, nous formons un grand dictionnaire g√©n√©ral. Si le dictionnaire devient plus grand que la valeur du param√®tre, nous √©crivons le dictionnaire actuel sur le disque et le reste des lignes quelque part sur le c√¥t√©, √† c√¥t√© des index. Par cons√©quent, nous ne recompterons jamais un grand dictionnaire et n'obtiendrons aucun probl√®me de m√©moire.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le deuxi√®me param√®tre est appel√© low_cardinality_use_single_dictionary_for_part. Imaginez que dans le sch√©ma pr√©c√©dent, lorsque nous avons ins√©r√© les donn√©es, notre dictionnaire √©tait plein et nous l'avons √©crit sur le disque. La question se pose, pourquoi ne pas former maintenant un autre exactement le m√™me dictionnaire? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quand il d√©borde, nous l'√©crirons √† nouveau sur le disque et commencerons √† en former un troisi√®me. Ce param√®tre d√©sactive simplement cette fonctionnalit√© par d√©faut.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, de nombreux dictionnaires peuvent √™tre utiles si nous voulons ins√©rer un ensemble de lignes, mais des ¬´ordures¬ª ins√©r√©es accidentellement. Disons que nous avons d'abord ins√©r√© les mauvaises lignes, puis nous avons ins√©r√© les bonnes. Ensuite, le dictionnaire sera divis√© en plusieurs petits dictionnaires. Certains d'entre eux seront avec des ordures, mais ces derniers seront avec de bonnes lignes. Et si nous lisons, disons, seulement le dernier culot, alors tout fonctionnera aussi rapidement. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jc/jx/jb/jcjxjbo7vmgmexmzxryscvj0lhu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avant de parler des avantages de LowCardinality, je dirai tout de suite qu'il est peu probable que nous r√©alisions une r√©duction des donn√©es sur le disque (bien que cela puisse arriver), car ClickHouse compresse les donn√©es. Il existe une option par d√©faut - LZ4. Vous pouvez √©galement effectuer une compression √† l'aide de ZSTD. Mais les deux algorithmes impl√©mentent d√©j√† la compression du dictionnaire, donc notre dictionnaire ClickHouse externe n'aidera pas beaucoup.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afin de ne pas √™tre infond√©, j'ai pris des donn√©es de la m√©trique - String, LowCardinality (String) et Enum - et les ai enregistr√©es dans diff√©rents types de donn√©es. </font><font style="vertical-align: inherit;">Il s'est av√©r√© trois colonnes, o√π un milliard de lignes sont √©crites. </font><font style="vertical-align: inherit;">La premi√®re colonne, CodePage, a un total de 62 valeurs. </font><font style="vertical-align: inherit;">Et vous pouvez voir que dans LowCardinality (String), ils les ont mieux press√©s. </font><font style="vertical-align: inherit;">La cha√Æne est un peu pire, mais cela est probablement d√ª au fait que les cha√Ænes sont courtes, nous stockons leurs longueurs, elles prennent beaucoup d'espace et ne compressent pas bien. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous prenez PhoneModel, il y en a plus de 48 000 et il n'y a presque aucune diff√©rence entre String et LowCardinality (String). </font><font style="vertical-align: inherit;">Pour l'URL, nous avons √©galement √©conomis√© seulement 2 Go - je pense que vous ne devriez pas vous fier √† cela.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estimation de la vitesse de travail</font></font></h3> <br>
<img src="https://habrastorage.org/webt/3q/v7/ar/3qv7aronmenayqfhdjait6xo3tw.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lien de la diapositive</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Maintenant, √©valuons la vitesse de travail. Pour l'√©valuer, j'ai utilis√© un ensemble de donn√©es d√©crivant les trajets en taxi √† New York. Il</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est disponible</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur GitHub. Il compte un peu plus d'un milliard de voyages. Il indique l'emplacement, les heures de d√©but et de fin du voyage, le mode de paiement, le nombre de passagers et m√™me le type de taxi - vert, jaune et Uber.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/2o/9n/qb/2o9nqbsb7dodtnoimgnnl66lhlg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai fait la premi√®re demande assez simple - j'ai demand√© o√π les taxis sont le plus souvent command√©s. Pour ce faire, vous devez prendre l'emplacement d'o√π vous avez command√©, faire GROUP BY dessus et calculer la fonction de comptage. Ici ClickHouse donne quelque chose.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/te/uy/kz/teuykz6_ucr7tuklbfsnobntncc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour mesurer la vitesse de traitement des requ√™tes, j'ai cr√©√© trois tables avec les m√™mes donn√©es, mais j'ai utilis√© trois types de donn√©es diff√©rents pour notre emplacement de d√©part - String, LowCardinality et Enum. LowCardinality et Enum sont cinq fois plus rapides que String. Enum est plus rapide car il fonctionne avec des nombres. LowCardinality - car l'optimisation GROUP BY est impl√©ment√©e. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pl/mx/qr/plmxqrgggpwl4xp2quqggej847k.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Compliquons la demande - demandez o√π se trouve le parc le plus populaire de New York. Encore une fois, nous mesurerons cela en fonction de l'endroit o√π le taxi est le plus souvent command√©, mais en m√™me temps, nous filtrerons uniquement les endroits o√π il y a le mot ¬´parc¬ª. Ajoutez √©galement une fonction similaire.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0u/iq/bz/0uiqbzwkh280_wuzn8bccqg2lhi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous regardons l'heure - nous voyons qu'Enum a soudainement commenc√© √† ralentir. Et cela fonctionne encore plus lentement que le type de donn√©es String standard. En effet, la fonction similaire n'est pas du tout optimis√©e pour Enum. Nous devons convertir nos lignes d'Enum en lignes r√©guli√®res - nous faisons plus de travail. LowCardinality (String) n'est √©galement pas optimis√© par d√©faut, mais comme il fonctionne sur le dictionnaire, la requ√™te est donc plus rapide que String. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a un probl√®me plus global avec Enum. Si nous voulons l'optimiser, nous devons le faire √† chaque endroit du code. Supposons que nous ayons √©crit une nouvelle fonction - vous devez absolument trouver des optimisations pour Enum. Et dans LowCardinality, tout est optimis√© par d√©faut.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_j/oc/eq/_joceq5ioy66p6gjatm1l5f2rqy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Regardons la derni√®re requ√™te, plus artificielle. </font><font style="vertical-align: inherit;">Nous calculerons simplement la fonction de hachage √† partir de notre emplacement. </font><font style="vertical-align: inherit;">La fonction de hachage est une requ√™te assez lente, elle prend beaucoup de temps, donc tout ralentira trois fois. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dn/06/x9/dn06x9ujvdxgdpmjcus8qzlccbg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LowCardinality est encore plus rapide, bien qu'il n'y ait pas de filtrage. </font><font style="vertical-align: inherit;">Cela est d√ª au fait que nos fonctions ne fonctionnent que sur le dictionnaire. </font><font style="vertical-align: inherit;">La fonction de calcul de hachage a un argument - elle peut traiter moins de donn√©es et peut √©galement renvoyer LowCardinality. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/63/yt/qz/63ytqzwuufiatce0y8wdy4whn5s.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notre plan global est d'atteindre une vitesse qui n'est pas inf√©rieure √† celle de String dans tous les cas, et de sauver l'acc√©l√©ration. </font><font style="vertical-align: inherit;">Et peut-√™tre que nous remplacerons un jour String par LowCardinality, vous mettrez √† jour ClickHouse, et tout fonctionnera pour vous un peu plus rapidement.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr492850/index.html">Tout le monde ne veut pas passer au travail √† distance</a></li>
<li><a href="../fr492856/index.html">Covid19, Votre soci√©t√© et vous √™tes du point de vue de la Data Science. Article traduit par Jeremy Howard et Rachel Thomas (fast.ai)</a></li>
<li><a href="../fr492862/index.html">15 meilleurs conseils d'optimisation des performances Oracle APEX pour les d√©veloppeurs</a></li>
<li><a href="../fr492864/index.html">Puis-je pirater un navire?</a></li>
<li><a href="../fr492866/index.html">Le livre "Machine Learning sans mots"</a></li>
<li><a href="../fr492872/index.html">Comment organiser l'acc√®s √† distance et ne pas souffrir de pirates</a></li>
<li><a href="../fr492874/index.html">Optimisation du rendu pour mobile</a></li>
<li><a href="../fr492878/index.html">Pantoufles geek: √† la recherche de positif dans les fermetures de bureaux temporaires</a></li>
<li><a href="../fr492880/index.html">Que devrions-nous construire une maison intelligente?</a></li>
<li><a href="../fr492884/index.html">Recevoir des messages des diffusions YouTube + autorisation google en PHP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>