<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤟🏽 ⛴️ 🆓 「こんにちは、Checkmarx！」Checkmarx SASTのリクエストを作成し、クールな脆弱性を見つける方法 ♂️ 🎋 👈🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="こんにちは、ハブル！
 
 この記事では、Checkmarx SASTでクエリを作成した経験についてお話したいと思います。
 
 このアナライザーを初めて知ったとき、弱い暗号化/ハッシュアルゴリズムと偽陽性のヒープを検索することに加えて、何も返さないという印象を受けるかもしれません。しかし、適切な構...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>「こんにちは、Checkmarx！」Checkmarx SASTのリクエストを作成し、クールな脆弱性を見つける方法</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dins/blog/477742/"><img src="https://habrastorage.org/webt/sh/ll/ln/shlllnc6iduoendolw26rabdugk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
こんにちは、ハブル！</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では、Checkmarx SASTでクエリを作成した経験についてお話したいと思います。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このアナライザーを初めて知ったとき、弱い暗号化/ハッシュアルゴリズムと偽陽性のヒープを検索することに加えて、何も返さないという印象を受けるかもしれません。</font><font style="vertical-align: inherit;">しかし、適切な構成で、それは深刻なバグを探すことができる超強力なツールです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Checkmarx SASTクエリ言語の複雑さを理解し、SQLインジェクションと安全でない直接オブジェクト参照を検索する2つのクエリを記述します。</font></font><br>
<a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前書き</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Checkmarxのガイドや記事を長時間検索したところ、公式のドキュメント以外に、十分な有用な情報がないことがわかりました。そして公式文書は、すべてが非常に明確で理解しやすくなっているとは言っていません。たとえば、ベストプラクティス、オーバーライドクエリを正しく整理する方法、「ダミーの」クエリを作成する方法などが見つかりませんでした。はい、CMxクエリ言語関数に関するドキュメントがありますが、これらの関数を1つのクエリに結合する方法は次のとおりです。ドキュメントは書かれていません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おそらく、Checkmarxコミュニティからの記事やガイドが不足していることは、ツールのコストが高く、その結果、対象読者が少ないことに関連しています。あるいは、ほんの数人の人が細かい調整に悩んで、そのままソリューションをそのまま使用するかもしれません。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の経験では、実際のバグを検索するよりも、顧客のさまざまな要件に関連する手続きに準拠するためにSASTが使用されていることがわかりました。このアプローチでは、結果として、せいぜい、比較的自動的に「脆弱性」の数が少なくなり、自動的に「悪用不可能」と呼ばれるようになります（99.9％のケースにあるため）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Checkmarx自体がクエリを更新して、すぐに最良の結果が得られるようにしていることに注意してください。</font><font style="vertical-align: inherit;">ただし、CMxクエリ言語のクエリは、「一般的なケース」に合わせて調整されています。</font><font style="vertical-align: inherit;">トークンの最初の検索は名前に基づいています。</font><font style="vertical-align: inherit;">たとえば、CMx SASTは、データベースへのすべてのクエリが* createQuery *または* createSQLQuery *のようになると想定しています。</font><font style="vertical-align: inherit;">ただし、内部開発を使用してデータベースを操作し、データベースをクエリするメソッドが別の方法（たとえば、* driveMyQuery *）で呼び出された場合、すべてのSQLメソッドはスキップされます。</font><font style="vertical-align: inherit;">たとえば、お客様はSQL DBにカスタムORMを使用しています。</font><font style="vertical-align: inherit;">この場合、すぐに使えるCMxクエリはすべてのSQLインジェクションをスキップしました。</font></font><br>
 <br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">略語と定義</font></font></h4><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMx</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -Checkmarx SAST。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMxQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -Checkmarx SASTクエリ言語</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トークン</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -特定の値を持つ文字列は、字句アナライザー（トークン化とも呼ばれる）の結果です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テストアプリケーション</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
記事を書くために、小さなテスト・アプリケーションであるJavaコードをスケッチしました。</font><font style="vertical-align: inherit;">このコードは、実際のシステムの小さな部分のおおよそのコピーです。</font><font style="vertical-align: inherit;">一般に、テストアプリケーションのコードは他のHTTPバックエンドコードとそれほど違いはありません。</font><font style="vertical-align: inherit;">テストアプリケーションコードの主要なセクションがスクリーンショットに表示されます。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テストアプリケーションの構造は次のとおりです。</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">着信HTTPリクエストを処理するための</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebRouter</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
クラス</font><i><font style="vertical-align: inherit;">。URL</font></i><font style="vertical-align: inherit;">を処理するための4つのメソッドがあります。</font></font><br>
<ul>
<li><i>/getTransaction</i> –    <i>id </i>     , <i>id </i>  ,     <i>getTransactionInfo(transactionId)</i> =&gt; <i>getTransactionInfo(transactoinId)</i> –   transactionId  SQL  (   SQL );</li>
<li><i>/getSecureTransaction</i> –    <i>id </i>     , <i>id </i>  ,    <i>getTransactionInfoSecured()</i> =&gt; <i>getTransactionInfoSecured(transactoinId)</i> –    <i>transactionId </i>  Long,      SQL  (     );</li>
<li><i>/getSettings</i> —    <i>userId </i> <i>mailboxId </i>–    .    <i>mailboxid </i> ;</li>
<li><i>/getSecureSettings</i> —     <i>userId </i> <i>mailboxId </i>   .    <i>mailboxid </i> . </li>
</ul><br>
<br>
<h2>CMx:      </h2><br>
<h3>   </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クエリ開発は、別のプログラムCxAuditorで実行されます。 CxAuditorでは、クエリを書き込むすべてのコードをスキャンする（ローカルプロジェクトを作成する）必要があります。その後、新しいクエリを記述して実行できます。大きなコードベースでは、プライマリスキャンに数時間、ギガバイトのメモリが必要になる場合があります。その後、各リクエストは十分に速く実行されません。これは、開発にはまったく不適切です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、プロジェクトから小さなファイルのセットを取り出し、理想的には、要求を書き込んでいるタイプの前にコードにバグが見つかった場合（またはバグを手動でそこに置く場合）、このファイルのセットのみをスキャンできます。</font><font style="vertical-align: inherit;">プロジェクトのファイル構造を監視する必要はありません。</font><font style="vertical-align: inherit;">つまり、JavaパッケージAとBがあり、パッケージBのクラスがパッケージAのクラスとメソッドを使用している場合、これらすべてを1つのディレクトリに配置でき、CMxはファイル間の関係を理解し​​、ファイル間の呼び出しチェーンを正しく構築します（まあ、またはほぼエラーはプロジェクトのファイル構造とはほとんど関係ありませんが、常に正しいです。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本的な定義</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cxlist</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CMxの主なデータ型。</font><font style="vertical-align: inherit;">ほとんどすべてのCMxQL関数の結果はCxListになり</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは、特定のプロパティを持つ多くの要素です。</font><font style="vertical-align: inherit;">以下では、開発に最も役立つプロパティについて検討します。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結果</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CMxQLには、組み込みの変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">resultがあり</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">クエリ全体を実行した後</font><font style="vertical-align: inherit;">の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結果</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数を含むセットが</font><i><font style="vertical-align: inherit;">結果</font></i><font style="vertical-align: inherit;">として表示されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、クエリの最後の操作は文字列</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">result = WHATEVER</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">する必要があります。</font><font style="vertical-align: inherit;">次に例を示します。</font></font><br>
<pre><code class="actionscript hljs">result = All.FindByName(<span class="hljs-string">"anyname"</span>);</code></pre> <br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フローとコード要素</font></font></h4> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
戻り値のタイプによるほとんどのCMxQL関数は、「コード要素」を返す関数とFlowを返す関数の2つに分けられます。</font><font style="vertical-align: inherit;">どちらの場合も、結果は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CxList</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">ただし、フローとコード要素ではコンテンツが少し異なります。</font></font><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コード要素</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -トークン-たとえば、変数、メソッド呼び出し、割り当てなど。;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フロー</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -指定されたトークン間の関係。</font></font></li>
</ul><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべておよび「サブ」すべて</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各CMxQL関数は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべての</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セット</font><font style="vertical-align: inherit;">（スキャンされたコード全体のすべてのトークンが含まれ、既に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結果の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例を見ました</font><font style="vertical-align: inherit;">）または</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CxList</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セット</font><font style="vertical-align: inherit;">で</font><i><font style="vertical-align: inherit;">実行できます。CxList</font></i><font style="vertical-align: inherit;">セット</font><font style="vertical-align: inherit;">は、クエリなどのクエリのいくつかの操作の結果として取得されます。</font></font><br>
<pre><code class="actionscript hljs">CxList newList = CxList.New(); </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
空のセットを作成します。これを</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドを使用して要素で埋め</font><font style="vertical-align: inherit;">、新しいセットの要素で既に検索できます。</font></font><br>
 <pre><code class="actionscript hljs">CxList newFind = newList.FindByName(<span class="hljs-string">"narrowedScope"</span>);</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">見つかったアイテムのプロパティ </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CxListセットの各要素には、いくつかのプロパティがあります。</font><font style="vertical-align: inherit;">クエリを作成するための結果を分析する場合、最も役立つのは次のとおりです。</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SourceFile-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この要素を含むファイルの名前。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソース行</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -トークン付きの行番号。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソース名</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -トークンの名前。</font><font style="vertical-align: inherit;">トークンと同等、つまり変数がvar1と呼ばれる場合、Source Name = var1;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソースタイプ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -トークンのタイプ。</font><font style="vertical-align: inherit;">たとえば、文字列の場合はStringLiteralになり、メソッドが呼び出された場合はMethodInvokeExprなどになります。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">宛先ファイル</font></font></b></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">宛先ライン;</font></font></b></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">宛先名;</font></font></b></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">宛先タイプ。</font></font></b></li>
</ul><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果セットの要素がフローの場合、ソースと宛先は異なります。結果がコード要素の場合、ソースと宛先は一致します。</font></font><br>
 <br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クエリの作成を開始する</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのCMxQL関数は、いくつかのタイプに分類できます。</font><font style="vertical-align: inherit;">ここで、私の意見では、CMxQLドキュメントの主な欠点に注意することができます。ドックのすべての機能はアルファベット順に説明されていますが、機能に従ってアルファベット順に構成する方がはるかに便利です。</font></font><br>
<br>
<ul>
<li>  —   CMxQL    <b>FindBy*</b>  <b>GetBy*</b>;</li>
<li>    – , , ,   ,  . .;</li>
<li>  —     <b>*InfluencedBy*</b> <b>*InfluencingOn*</b>.</li>
</ul><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クエリの基本原則は、これらのタイプの関数を交互に使用することです。まず、検索機能を使用して、特定のプロパティで関心のあるトークンのみを選択します。セットの演算を使用して、異なるトークンプロパティを持つ異なるセットを1つに結合したり、その逆を行ったりして、一方から他方を減算することができます。次に、分析関数を使用してコードフローを構築し、潜在的な脆弱性がエントリポイントのパラメーターに依存するかどうかを理解しようとします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
検索を開始する場所、一般的には検索パス全体の選択は、特定のコード、より正確には「テキスト」にも依存します。場合によっては、エントリポイントからユーザークエリを検索すると便利です。「エンド」から、または途中からでも検索する方が便利な場合もあります。それはすべて特定のコードに依存し、各リポジトリに個別にアプローチする必要があります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例：検索SQLインジェクション</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
大括弧で囲まれた検索プランは、セット（クエリ内の変数）の名前を示しています。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例外の定義-検索スコープからすぐにスローできるトークン（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exclusionList</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">消毒/セキュリティチェックの場所を決定する（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">消毒</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データベースでクエリを実行してすべての低レベルの場所を検索します（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">runSuperSecureSQLQuery</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼び出されたメソッドのすべてのパラメーターを検索します</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">runSuperSecureSQLQuery</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">runSSSQParams</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データベース内のクエリ実行の場所のエントリポイント（親メソッドとそのパラメーター）を</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">見つけ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます（</font><i><font style="vertical-align: inherit;">entryPointsParameters</font></i><font style="vertical-align: inherit;">）;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">依存関係を検索</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">runSSSQParamsの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメータ</font><font style="vertical-align: inherit;">の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エントリポイントを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全くありません唯一のそれらの場所ながら、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の消毒</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">入力</font><i><font style="vertical-align: inherit;">サニタイズが</font></i><font style="vertical-align: inherit;">。</font></font></li>
</ol><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、SQLクエリを使用して低レベルのメソッドが取得されます。SQLクエリのパラメーターは次のとおりです。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドのパラメーターに依存します。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメータは文字列として受け入れられます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメータはリクエストに連結されます。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、これらのパラメーターを制御できるかどうかは確認しません。</font><font style="vertical-align: inherit;">変数をクエリにマッピングするメカニズムがあり、数値の数値型へのキャストがあり、文字列の連結は常に危険であると考えられています。</font><font style="vertical-align: inherit;">現在、ラインを制御できない場合でも、新しいリリースで表示される可能性があります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQLi：ステップ1.例外の定義</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例外として、トークンの名前が必要な名前と一致する可能性があるクラスまたはファイルを追加する必要があります。これらのトークンは無効なエントリにつながります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、データベースにアクセスするメソッドは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">runSuperSecureSQLquery</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と呼ばれ</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">内部</font><font style="vertical-align: inherit;">の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">runSuperSecureSQLquery</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッド</font><font style="vertical-align: inherit;">は安全に実装され</font><font style="vertical-align: inherit;">ていると想定してい</font><font style="vertical-align: inherit;">ます。そして、私たちの仕事は、メソッド自体を使用することが安全ではない場所を見つけることです。 SQLインジェクションの場合、ユーザーが制御するパラメーターの連結の場所は安全な場所ではありません。安全-パラメータをORM構造にマッピングする場所。たとえば、数値パラメータの場合、これは対応する型へのキャストです。 「より深い」</font><i><font style="vertical-align: inherit;">runにある</font></i><font style="vertical-align: inherit;">すべてのコード</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、スキャンする必要がないため、無駄な検索を回避するためにスキャンを除外することをお勧めします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このような例外を検索するには、CMxQL関数を使用すると便利です。</font></font><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FindByFileName（）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -特定のファイル内のすべてのトークンのセットを検索します。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetByClass（）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -指定された名前を持つクラス内のすべてのトークンのセットを検索します。</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テストアプリケーションの場合、この例外は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Session</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスです。このクラス</font><font style="vertical-align: inherit;">には、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">runSuperSecureSQLquery</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドの実装が含まれています</font><font style="vertical-align: inherit;">。</font><i><font style="vertical-align: inherit;">セッション</font></i></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
クラスのコードを除外するリクエストの例</font><font style="vertical-align: inherit;">（</font><i><font style="vertical-align: inherit;">GetByClass（）</font></i><font style="vertical-align: inherit;">メソッド</font><i><font style="vertical-align: inherit;">は</font></i><font style="vertical-align: inherit;">、入力に渡されたトークンの</font><i><font style="vertical-align: inherit;">どれ</font></i><font style="vertical-align: inherit;">がCMxタイプ</font><i><font style="vertical-align: inherit;">ClassDecl</font></i><font style="vertical-align: inherit;">である</font><font style="vertical-align: inherit;">か</font><i><font style="vertical-align: inherit;">を</font></i><font style="vertical-align: inherit;">チェックし</font><font style="vertical-align: inherit;">、このクラスの多くのトークンを発行します）</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="java hljs">CxList exclusionList = All.GetByClass(All.FindByName(<span class="hljs-string">"*Session*"</span>));<font></font>
result = exclusionList;</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
または、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Session.java</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイル全体にコードをスローする方法もあります</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="java hljs">CxList exclusionList = All.FindByFileName(<span class="hljs-string">"*Session.java"</span>);<font></font>
result = exclusionList;</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイル名にはパス全体が含まれるため、名前の前のアスタリスクは重要です。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、次のステップで検索範囲から差し引くことができる多くのトークンができました。</font><i><font style="vertical-align: inherit;">Session</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
クラス内でトークンを検索した結果</font><font style="vertical-align: inherit;">：</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/webt/x3/gz/vx/x3gzvxxumbbu-th01llyjbymkoo.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQLi：ステップ2.サニタイズ場所の決定</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テストアプリケーションには2つのAPIメソッドがあります（テストアプリケーションの簡単な説明を参照してください）。 2つのAPIメソッドの違いは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">getTransactionInfo（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がtransactionIdパラメーターをSQLクエリに連結し、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">getTransactionInfoSecured（）が</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初にtransactionIdをLongに</font><i><font style="vertical-align: inherit;">変換して</font></i><font style="vertical-align: inherit;">から、それを文字列として渡すことです。脆弱性（パラメーターの連結）は両方の方法に組み込まれています。しかし、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">getTransactionInfoSecured（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">Longにキャストしたおかげ</font><font style="vertical-align: inherit;">で、最後のメソッドはインジェクションに対して脆弱ではありません。インジェクション（文字列）を渡そうとすると、Java例外が発生するためです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この例では、Longへのキャストを衛生施設と見なします。これらのトークンを見つけるには：</font></font><br>
<br>
<pre><code class="java hljs">CxList sanitization = All.FindByName(<span class="hljs-string">"*Long*"</span>);<font></font>
result = sanitization;</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果の例：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hb/ms/vx/hbmsvxmjwynfncf96eyclx2ey8y.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
YPタイプ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Long</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のトークンと</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値を</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Long</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タイプに内部的に</font><i><font style="vertical-align: inherit;">変換するgetValueAsLong</font></i><font style="vertical-align: inherit;">メソッド</font><font style="vertical-align: inherit;">は、結果に入りました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">結果を注意深く検討して、不必要なものがないことを確認する必要があります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQLi：ステップ3.データベースでクエリを実行してすべての低レベルの場所を見つける</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のクエリは、runSuperSecureSQLQueryトークン（データベースへのアクセスに使用される）を使用してすべての場所を検索します。</font></font><br>
<br>
<pre><code class="actionscript hljs">result = All.FindByName(<span class="hljs-string">"*runSuperSecureSQLQuery*"</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
runSuperSecureSQLQueryトークン名による検索結果：</font></font><br>
<img src="https://habrastorage.org/webt/qm/bh/ci/qmbhci6ucl_wx3sb_9zqfkkpim8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、このメソッドが呼び出される場所（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Billing</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラス</font><font style="vertical-align: inherit;">）では、メソッド呼び出しトークン（タイプ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MethodInvokeExpr</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">のみが見つかり</font><font style="vertical-align: inherit;">、メソッド宣言場所（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Session</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラス</font><font style="vertical-align: inherit;">）では、すべてのトークンが見つかります-変​​数。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メソッド呼び出しトークンのみを除外します。</font></font><br>
<br>
<pre><code class="java hljs">CxList runSuperSecureSQLQuery = All.FindByName(<span class="hljs-string">"*runSuperSecureSQLQuery*"</span>).FindByType(typeof(MethodInvokeExpr));<font></font>
result = runSuperSecureSQLQuery;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果：</font></font><br>
<img src="https://habrastorage.org/webt/or/82/dw/or82dwxfoze-fcbko2b2mljfyus.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、7か所が取得されました。そのうち4か所は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">runSuperSecureSQLQuery（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッド</font><font style="vertical-align: inherit;">（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Billing</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">User</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラス</font><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">への望ましい呼び出し</font><font style="vertical-align: inherit;">です。 2- </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Session</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラス内のrunSuperSecureSQLQuery（）内部メソッドの呼び出し。</font><font style="vertical-align: inherit;">もう1つは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">add</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドで</font><font style="vertical-align: inherit;">、CMxQL検索の一種です。リストにあるとは期待していなかったとしましょう=）</font><font style="vertical-align: inherit;">手順1で見つけ</font><font style="vertical-align: inherit;">た</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Session</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスのトークン</font><font style="vertical-align: inherit;">は興味深いものではないため、結果から単純に減算します。</font></font><br>
<br>
<pre><code class="java hljs">CxList runSuperSecureSQLQuery = All.FindByName(<span class="hljs-string">"*runSuperSecureSQLQuery*"</span>).FindByType(typeof(MethodInvokeExpr));<font></font>
result = runSuperSecureSQLQuery - exclusionList;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
必要なメソッドの呼び出しの有効なリストを取得します</font><font style="vertical-align: inherit;">。前のリクエスト</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sh/c8/ix/shc8ixcpk9wrkmdv_vzqfz5wj80.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FindByType（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typeof（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数</font><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">注意して</font><i><font style="vertical-align: inherit;">ください</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">CMxタイプ、つまり</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CxList</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロパティ「ソースタイプ」で</font><font style="vertical-align: inherit;">検索する場合は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typeof（ソースタイプ）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">データ型で検索したい場合は、文字列としてパラメータを渡す必要があります。</font><font style="vertical-align: inherit;">例えば：</font></font><br>
<br>
<pre><code class="java hljs">result  = All.FindByType(<span class="hljs-string">"String"</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
タイプStringのすべてのJavaトークンを検索します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQLi：ステップ4.メソッドと呼ばれるrunSuperSecureSQLQueryのすべてのパラメーターを見つける</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メソッドパラメータを検索するには、CMxQL関数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetParameters（）を使用し</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="actionscript hljs">CxList runSSSQParams = All.GetParameters(runSuperSecureSQLQuery);<font></font>
result = runSSSQParams;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/s4/4h/id/s44hidweor1j61xs1dkwbewrpja.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQLi：ステップ5.データベース内のクエリ実行場所のエントリポイントを見つける</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを行うには、最初に親メソッドの名前を</font><font style="vertical-align: inherit;">取得します。その</font><font style="vertical-align: inherit;">中には、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">runSuperSecureSQLQuery</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データベースへの呼び出しがあり</font><font style="vertical-align: inherit;">、次にそのパラメーターを取得します。</font><font style="vertical-align: inherit;">親トークンを検索するには、CMxQL関数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetAncOfType（）を使用し</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="actionscript hljs">CxList entryPoints = runSuperSecureSQLQuery.GetAncOfType(<span class="hljs-keyword">typeof</span>(MethodDecl));<font></font>
result = entryPoints;</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このクエリでは、runSuperSecureSQLQueryセットに対して、MethodDeclタイプのすべての親トークンを返します。これは、コールスタック内の前のメソッドです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/we/8w/7u/we8w7ucxjxvtgzerknbgjxir8fa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetParameters（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用して、メソッドパラメータを検索します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="actionscript hljs">CxList entryPointsParameters = All.GetParameters(entryPoints).FindByType(<span class="hljs-string">"String"</span>);</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クエリは</font><font style="vertical-align: inherit;">、Java型Stringを持つ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entryPointsの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サブセットのパラメーターを返します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7y/mw/tf/7ymwtfxg94oxlwggez3zhpfvcko.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQLi：ステップ6. runPointSQParamsパラメーターのentryPointsParametersへの依存関係を検索しますが、サニタイズ入力がない場所のみを検索します</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このステップでは、分析関数を使用します。</font><font style="vertical-align: inherit;">以下の関数は、フローコードの分析に使用されます。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に影響を受けた （）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluencedByAndNotSanitized（）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluencingOn（）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluencingOnAndNotSanitized（）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NotInfluencedBy（）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NotInfluencingOn（）</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">親</font><i><font style="vertical-align: inherit;">entryPointsParameters</font></i><font style="vertical-align: inherit;">メソッドのパラメーターで</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">runSSSQParams</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
要求</font><i><font style="vertical-align: inherit;">パラメーター</font></i><font style="vertical-align: inherit;">のフロー依存関係を見つけて、</font><i><font style="vertical-align: inherit;">サニテーション</font></i><font style="vertical-align: inherit;">トークンを除外するには：</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="java hljs">CxList dataInflOnTable = runSSSQParams.InfluencedByAndNotSanitized(entryPointsParameters, sanitization);</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、</font><font style="vertical-align: inherit;">内部</font><font style="vertical-align: inherit;">の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* AndNotSanitized</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数</font><font style="vertical-align: inherit;">が何らかの魔法を実行するか</font><font style="vertical-align: inherit;">どうかは</font><i><font style="vertical-align: inherit;">わかり</font></i><font style="vertical-align: inherit;">ません。メソッドが結果から</font><i><font style="vertical-align: inherit;">無害</font></i><font style="vertical-align: inherit;">化</font><font style="vertical-align: inherit;">されたセットを単に差し引くように見えます。</font><font style="vertical-align: inherit;">つまり、次の場合：</font></font><br>
<br>
<pre><code class="java hljs">CxList dataInflOnTable = runSSSQParams.InfluencedBy(entryPointsParameters) - sanitization;</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同じことがわかります。</font><font style="vertical-align: inherit;">まだ違いがあるのに、たぶん選択肢が見つからなかったのかもしれませんが。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クエリの結果は、適切に構成されたFlow：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ru/hs/2d/ruhs2dlh7alil7njbzsf2jke9qw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Got Flowによって潜在的なSQLインジェクションを使用して提供されます。</font><font style="vertical-align: inherit;">スクリーンショットからわかるように、Checkmarxは3 Flowを返しました。</font><font style="vertical-align: inherit;">スクリーンショットのフローは最も短く、1つのファイルと1つのメソッドで開始および終了します。</font><font style="vertical-align: inherit;">次のフローはすでにSessionクラスに残っています。</font><font style="vertical-align: inherit;">ソース/宛先に注意してください。</font><font style="vertical-align: inherit;">最後の1つは、Sessionクラスの別のメソッドです。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セッション</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内のフロー</font><font style="vertical-align: inherit;">は次のようになり</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mv/o7/uu/mvo7uuu6wp_dq-ggltm8lb5m5p0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ます。1つのフローを選択するには、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReduceFlow</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッド</font><i><font style="vertical-align: inherit;">（CxList.ReduceFlowType flowType）を使用します</font></i><font style="vertical-align: inherit;">。ここで、flowTypeは次のいずれかです。</font></font><br>
<br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CxList.ReduceFlowType.ReduceBigFlow-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最短のフローを選択</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CxList.ReduceFlowType.ReduceSmallFlow-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最長のフローを選択します</font></font></li>
</ul><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQLi：SQLインジェクションを見つけるための最終クエリ</font></font></h3><br>
<pre><code class="java hljs"><span class="hljs-comment">// 1.  </span>
CxList exclusionList = All.GetByClass(All.FindByName(<span class="hljs-string">"*Session*"</span>));
<span class="hljs-comment">// 2.   </span>
CxList sanitization = All.FindByName(<span class="hljs-string">"*Long*"</span>);<font></font>
<font></font>
<span class="hljs-comment">// 3.    runSuperSecureSQLQuery()</span>
CxList runSuperSecureSQLQuery = All.FindByName(<span class="hljs-string">"*runSuperSecureSQLQuery*"</span>).FindByType(typeof(MethodInvokeExpr));<font></font>
runSuperSecureSQLQuery -= exclusionList;<font></font>
<font></font>
<span class="hljs-comment">// 4.     runSuperSecureSQLQuery()</span><font></font>
CxList runSSSQParams = All.GetParameters(runSuperSecureSQLQuery);<font></font>
<font></font>
<span class="hljs-comment">// 5.   ,     runSuperSecureSQLQuery()	</span><font></font>
CxList entryPoints = runSuperSecureSQLQuery.GetAncOfType(typeof(MethodDecl));<font></font>
CxList entryPointsParameters = All.GetParameters(entryPoints).FindByType(<span class="hljs-string">"String"</span>);<font></font>
<font></font>
<span class="hljs-comment">// 6.       (runSuperSecureSQLQuery)    </span><font></font>
CxList dataInflOnTable = runSSSQParams.InfluencedByAndNotSanitized(entryPointsParameters, sanitization);<font></font>
<font></font>
<span class="hljs-comment">// 7.  </span>
result = dataInflOnTable.ReduceFlow(CxList.ReduceFlowType.ReduceBigFlow);</code></pre><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例2：安全でない直接オブジェクト参照の検索</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このリクエストでは、オブジェクトの所有者を確認せずに、オブジェクトの操作が発生するすべての場所を検索します。</font><font style="vertical-align: inherit;">この場合、mailboxidのHTTPパラメーターの異なる名前を使用でき（これはレガシーであると想定しています）、検証自体がさまざまな段階で発生する可能性があります：HTTPエントリAPIポイントのどこか、データベースへのリクエストの前のどこか中間メソッドで。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
検索プラン</font></font><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例外を定義します（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exclusionList</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">承認チェックの場所を特定します（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">idorSanitizer</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）;</font></font></li>
<li>   –    HTTP- (<i>webRemoteMethods</i>);</li>
<li>        HTTP- <i>mailboxid </i>(<i>mailboxidInit</i>);</li>
<li>    webRemoteMethods   middleware     (<i>middlewareMethods</i>);</li>
<li> middleware-,    mailboxid (<i>apiPotentialIDOR</i>);</li>
<li>     middleware(<i>middlewareDecl</i>);</li>
<li>   <i>apiPotentialIDOR </i>    <i>middlewareDecl</i>,       <i>mailboxid</i>.</li>
</ol><br>
<br>
<h3>IDOR:  1.  </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場合、特定のファイル内のすべてのトークンを除外します。</font></font><br>
<br>
<pre><code class="actionscript hljs">CxList exclusionList = All.FindByFileName(<span class="hljs-string">"*WebMethodContext.java"</span>);<font></font>
result = exclusionList;</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebMethodContext.javaに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">getMailboxId</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">や</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">getUserId</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">などのメソッドの実装と</font><font style="vertical-align: inherit;">、文字列「mailboxid」が含まれています。</font><font style="vertical-align: inherit;">トークンの名前は脆弱性を検索するために必要な名前と一致するため、このファイルは誤った結果を発行します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IDOR：ステップ2.許可チェックを見つける</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テストアプリケーションでは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">validateMailbox（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドを使用して、要求されたオブジェクトがユーザーに属しているかどうかを判断します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="actionscript hljs">CxList idorSanitizer = All.FindByName(<span class="hljs-string">"*validateMailbox*"</span>);<font></font>
result = idorSanitizer;<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/a7/jx/3e/a7jx3eqcxzb5pwgzze9yuqbysos.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IDOR：ステップ3.カスタムHTTP APIリクエストのエントリポイントを見つける</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 HTTPリクエストハンドラーには、簡単に見つけられるようにする特別な注釈があります。</font><font style="vertical-align: inherit;">私の場合、これは「WebRemote」です。CMxQL関数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FindByCustomAttribute（）を</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用して、注釈を検索し</font><font style="vertical-align: inherit;">ます。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FindByCustomAttribute（） </font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font><font style="vertical-align: inherit;">トークン親の検索機能</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetAncOfType（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注釈の下でメソッドを返します。</font></font><br>
<br>
<pre><code class="java hljs">
CxList webRemoteMethods = All.FindByCustomAttribute(<span class="hljs-string">"WebRemote"</span>)<font></font>
      .GetAncOfType(typeof(MethodDecl));<font></font>
result = webRemoteMethods;</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リクエスト結果：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rc/xt/q_/rcxtq_rfostgwmdtmwrfyg-9ly4.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IDOR：ステップ4.メールボックスIDパラメータのHTTP抽出場所を見つけるエントリポイントトークンのみ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HTTPメールボックスIDパラメータの処理に関連するトークンを見つけるには：</font></font><br>
<br>
<pre><code class="java hljs">CxList getMailboxId = All.FindByName(<span class="hljs-string">"\"mailboxId\""</span>) <font></font>
+ All.FindByName(<span class="hljs-string">"\"mid\""</span>) <font></font>
+ All.FindByName(<span class="hljs-string">"\"boxid\""</span>);<font></font>
result = getMailboxId;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3つの異なる行を含む3つのセットを追加しました。凡例によると、システムの異なる部分では、HTTPパラメータの名前が異なる場合があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クエリは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mailboxid / mid / boxidが</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（二重引用符で</font><i><font style="vertical-align: inherit;">囲ま</font></i><font style="vertical-align: inherit;">れた）文字列として書き込まれている</font><font style="vertical-align: inherit;">すべての場所を検索します</font><font style="vertical-align: inherit;">。しかし、このクエリは多くの検索結果を返します、tk。このような文字列は、HTTPパラメータが抽出される場所だけでなく、このセットで作業を続けると、膨大な数の誤った結果が得られます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、エントリポイントのトークン（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">webRemoteMethods</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">のみを検索し</font><font style="vertical-align: inherit;">ます。すべての子トークンを見つけるには、CMBQL関数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetByAncs（）を使用し</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="java hljs">result = All.GetByAncs(webRemoteMethods);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リクエストは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebRemoteと</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注釈されたメソッドに属するすべてのトークンを返します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">すでにこの段階で、オブジェクトの所有者がチェックされるメソッドのトークンをフィルタリングできます。</font><font style="vertical-align: inherit;">したがって、</font><font style="vertical-align: inherit;">オブジェクトの所有者のセキュリティチェックがない</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebRemote</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドの</font><font style="vertical-align: inherit;">子トークンのみを選択するように、前のクエリを書き換えて子トークンを検索し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">これを行うには、次の条件でループを使用します。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-comment">//         </span><font></font>
CxList entry_point_tokens = All.NewCxList();<font></font>
<span class="hljs-comment">//      webRemoteMethods</span><font></font>
foreach (CxList method in webRemoteMethods) {<font></font>
	<span class="hljs-comment">//       </span><font></font>
	CxList method_tokens = All.GetByAncs(method);<font></font>
	<span class="hljs-comment">// ,       ,    owner</span>
	<span class="hljs-keyword">if</span> (method_tokens.FindByName(idorSanitizer).Count &gt; <span class="hljs-number">0</span>) {
	<span class="hljs-comment">//  ,     , ,    </span>
	} <span class="hljs-keyword">else</span> { 
	<span class="hljs-comment">//  ,        </span><font></font>
		entry_point_tokens.Add(method_tokens);<font></font>
	}<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、HTTP </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メールボックスID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメータを使用して、より正確な選択を行うことができます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="java hljs">CxList getMailboxHTTPParams = entry_point_tokens.FindByName(<span class="hljs-string">"\"mailboxid\""</span>) <font></font>
+ entry_point_tokens.FindByName(<span class="hljs-string">"\"mid\""</span>) <font></font>
+ entry_point_tokens.FindByName(<span class="hljs-string">"\"boxid\""</span>);<font></font>
result = getMailboxHTTPParams;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、HTTPパラメーターが取得される場所ではなく、最終的にHTTPパラメーターの値が割り当てられる変数に関心があります。</font><font style="vertical-align: inherit;">変数のトークンによってフローを正確に検索する方が信頼性が高いためです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CMxQL関数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FindByInitialization（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、指定されたトークンに対して変数が初期化される場所を検索します。</font></font><br>
<br>
<pre><code class="java hljs"><font></font>
CxList mailboxidInit = entry_point_tokens.FindByInitialization(getMailboxHTTPParams);<font></font>
result = mailboxidInit;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cp/e7/5q/cpe75qru5pcwzikvaona3h7w67c.png"><br>
 <br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IDOR：ステップ5. webRemoteMethodsからミドルウェアメソッドへのすべての呼び出しとこれらの呼び出しのパラメーターを見つける</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ミドルウェアとは、HTTP APIリクエストの処理メソッドよりも深い、つまりユーザーリクエストのエントリポイントよりも深いコードを意味します。</font><font style="vertical-align: inherit;">たとえば、上のスクリーンショットの場合、これらは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">User</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスのメソッドであり、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">user.getSettings（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">user.getSecureSettings（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">への呼び出し</font><font style="vertical-align: inherit;">です。</font></font><br>
<br>
<pre><code class="java hljs">CxList middlewareMethods = All.FindByShortName(<span class="hljs-string">"user"</span>).GetRightmostMember();<font></font>
CxList middlewareMethodsParams = entry_point_tokens.GetParameters(middlewareMethods);<font></font>
result = middlewareMethodsParams;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初に、userという名前のすべてのトークンを選択し、次に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetRightmostMember（）を</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用して</font><font style="vertical-align: inherit;">、ミドルウェアの呼び出しトークン</font><i><font style="vertical-align: inherit;">を</font></i><font style="vertical-align: inherit;">選択します。</font><font style="vertical-align: inherit;">メソッド呼び出しのチェーンの</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetRightmostMember（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、右端の呼び出しを返します。</font><font style="vertical-align: inherit;">次に、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetParameters（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用して、見つかったメソッドのパラメーターを導出します</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8b/mm/2a/8bmm2ad7zg-xwponufdxuocn-t0.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IDOR：ステップ6.メールボックスIDに依存するミドルウェアメソッドを見つける</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フロー分析では</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* InfluencedBy *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* InfluncingOn *メソッドを使用し</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">それらの違いは名前で明らかです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例えば：</font></font><br>
<br>
<pre><code class="java hljs">All.InfluencedBy(getMailboxHTTPParams) </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
セットAllを通過し、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">getMailboxHTTPParamsに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">依存するすべてのトークンを見つけます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同じことを別の方法で書くこともできます：</font></font><br>
<br>
<pre><code class="java hljs">getMailboxHTTPParams.InfluencingOn(All)</code></pre><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mailboxidInitに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
依存するトークンを検索するには</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="java hljs">CxList apiPotentialIDOR = entry_point_tokens.InfluencedByAndNotSanitized(mailboxidInit, idorSanitizer);<font></font>
result = apiPotentialIDOR;<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xl/wa/rq/xlwarqf4bvr96xchztinpiua7h4.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IDOR：ステップ7.ミドルウェアメソッドを定義するすべての場所を見つける</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユーザーのリクエストが処理される場所で使用できるすべての中間メソッドの定義を見つけましょう。</font><font style="vertical-align: inherit;">これを行うには、共通のプロパティを強調表示します。たとえば、そのようなすべてのメソッドでは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Request（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オブジェクトの作成があります。オブジェクトの作成には、CMxタイプの</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ObjectCreateExprが</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あり</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="java hljs">CxList requests = (All - exclusionList).FindByType(typeof(ObjectCreateExpr)).FindByName(<span class="hljs-string">"*Request*"</span>);<font></font>
CxList middlewareDecl = requests.GetAncOfType(typeof(MethodDecl));<font></font>
result = middlewareDecl;</code></pre><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（すべて</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -exclusionList </font><i><font style="vertical-align: inherit;">）</font></i><font style="vertical-align: inherit;"> -このセットの減算を実行し、結果から目的のCMxQL関数を呼び出すことができます。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リクエストに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リクエスト</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の名前</font><font style="vertical-align: inherit;">とオブジェクトの作成に対応するタイプの</font><font style="vertical-align: inherit;">すべてのトークンが含まれ</font><font style="vertical-align: inherit;">ています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、おなじみの</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetAncOfType（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用して</font><font style="vertical-align: inherit;">、タイプ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MethodDeclの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">親トークンを見つけます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pp/ie/21/ppie21nmruhnqfekmune0fa5ytu.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IDOR：ステップ8.すべてのapiPotentialIDORを実行し、mailboxidオブジェクトの所有者の検証がないミドルウェアデスクのみを選択します。</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リクエストの最後の部分では、エントリポイントメソッドから直接呼び出されるミドルウェアメソッドを決定し、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mailboxidが誰に</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属し</font><i><font style="vertical-align: inherit;">て</font></i><font style="vertical-align: inherit;">いるかはチェックしません</font><font style="vertical-align: inherit;">。次に、フローを組み合わせて、結果のより便利な分析を行います。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まだ使用していない新しい関数：</font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetCxListByPath（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -この関数は、フローを反復するために必要です。この関数を使用しない場合、CMxはコード要素内のフローを圧縮します（最初のフローノード内）</font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">連結*（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -いくつかを組み合わせるために必要な多数の関数1つの</font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FindByParameters（）に</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フローし</font><font style="vertical-align: inherit;">ます-特定のトークンパラメータ</font><i><font style="vertical-align: inherit;">GetName（）</font></i><font style="vertical-align: inherit;">によってメソッドを検索します</font></font><br>
<i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-トークンの名前を含む文字列を返します。CxListに複数の要素がある場合は、最初の要素を返します。</font><font style="vertical-align: inherit;">このメソッドは、セットの要素を反復する場合にのみ使用されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リクエストの最後の部分：</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-comment">//   </span><font></font>
CxList vulns = All.NewCxList();<font></font>
<span class="hljs-comment">//   Flow  apiPotentialIDOR</span><font></font>
foreach(CxList cxFlow in apiPotentialIDOR.GetCxListByPath()) {<font></font>
  <span class="hljs-comment">//    Flow</span><font></font>
  CxList endNode = cxFlow.GetStartAndEndNodes(CxList.GetStartEndNodesType.EndNodesOnly);<font></font>
  <span class="hljs-comment">//       flow (mailboxid)</span><font></font>
  CxList method_call = entry_point_tokens.FindByParameters(endNode);<font></font>
  <span class="hljs-comment">//    </span><font></font>
  CxList method_decl = middlewareDecl.FindByShortName(method_call.GetName());<font></font>
<font></font>
  <span class="hljs-comment">//    </span>
  <span class="hljs-keyword">if</span> (method_decl.Count &gt; <span class="hljs-number">0</span>) {	
    <span class="hljs-comment">//      </span><font></font>
    CxList _all = (All - exclusionList).GetByAncs(method_decl);<font></font>
    <span class="hljs-comment">//      </span>
    <span class="hljs-keyword">if</span> (_all.FindByName(idorSanitizer).Count &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-comment">//  ,      </span>
      cxLog.WriteDebugMessage(<span class="hljs-string">"find sanitized in method: "</span> + method_call.GetName());
    <span class="hljs-comment">//  ,   Flow     vulns</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">//     Flow      </span><font></font>
      vulns.Add(cxFlow.ConcatenatePath(method_call).ConcatenatePath(method_decl));<font></font>
      cxLog.WriteDebugMessage(<span class="hljs-string">"find NOT sanitized in method: "</span> + method_call.GetName());<font></font>
    }<font></font>
  }<font></font>
}</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_z/qs/rj/_zqsrju8bqoni7u0ksolmokizhe.png"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CocatenatePath</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用して、すべての場所を分析するときにコード内を移動するのに便利でした。</font><font style="vertical-align: inherit;">このメソッドは、1つのコード要素をフローに添付します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IDOR：IDORの最終検索</font></font></h3><br>
<pre><code class="java hljs">
<span class="hljs-comment">// 1.   </span>
CxList exclusionList = All.FindByFileName(<span class="hljs-string">"*WebMethodContext.java"</span>);
<span class="hljs-comment">// 2.     </span>
CxList idorSanitizer = All.FindByName(<span class="hljs-string">"*validateMailbox*"</span>);
<span class="hljs-comment">// 3.    –    HTTP  </span>
CxList webRemoteMethods = All.FindByCustomAttribute(<span class="hljs-string">"WebRemote"</span>).GetAncOfType(typeof(MethodDecl));<font></font>
<font></font>
<span class="hljs-comment">// 4.         HTTP  mailboxid </span>
<span class="hljs-comment">//    </span><font></font>
CxList entry_point_tokens = All.NewCxList();<font></font>
foreach (CxList method in webRemoteMethods) {<font></font>
CxList method_tokens = All.GetByAncs(method);<font></font>
<span class="hljs-keyword">if</span> (method_tokens.FindByName(idorSanitizer).Count &gt; <span class="hljs-number">0</span>) {<font></font>
} <span class="hljs-keyword">else</span> { <font></font>
  entry_point_tokens.Add(method_tokens);<font></font>
}<font></font>
}<font></font>
<span class="hljs-comment">//    HTTP    - </span>
CxList getMailboxHTTPParams = entry_point_tokens.FindByName(<span class="hljs-string">"\"mailboxId\""</span>) <font></font>
  + entry_point_tokens.FindByName(<span class="hljs-string">"\"mid\""</span>) <font></font>
  + entry_point_tokens.FindByName(<span class="hljs-string">"\"boxid\""</span>);<font></font>
CxList mailboxidInit = entry_point_tokens.FindByInitialization(getMailboxHTTPParams);<font></font>
<font></font>
<span class="hljs-comment">// 5.      middleware     </span>
CxList middlewareMethods = All.FindByShortName(<span class="hljs-string">"user"</span>).GetRightmostMember();<font></font>
CxList middlewareMethodsParams = entry_point_tokens.GetParameters(middlewareMethods);<font></font>
<span class="hljs-comment">// 6.  middleware ,     mailboxid </span><font></font>
CxList apiPotentialIDOR = entry_point_tokens.InfluencedByAndNotSanitized(mailboxidInit, idorSanitizer);<font></font>
<font></font>
<span class="hljs-comment">// 7.      middleware     </span>
CxList requests = (All - exclusionList).FindByType(typeof(ObjectCreateExpr)).FindByName(<span class="hljs-string">"*Request*"</span>);<font></font>
CxList middlewareDecl = requests.GetAncOfType(typeof(MethodDecl));<font></font>
<font></font>
<span class="hljs-comment">// 8.    apiPotentialIDOR     middlewareDecl,     </span><font></font>
CxList vulns = All.NewCxList();<font></font>
foreach(CxList cxFlow in apiPotentialIDOR.GetCxListByPath()) {<font></font>
  CxList endNode = cxFlow.GetStartAndEndNodes(CxList.GetStartEndNodesType.EndNodesOnly);<font></font>
  CxList method_call = entry_point_tokens.FindByParameters(endNode);<font></font>
  CxList method_decl = middlewareDecl.FindByShortName(method_call.GetName());<font></font>
	<font></font>
  <span class="hljs-keyword">if</span> (method_decl.Count &gt; <span class="hljs-number">0</span>) {	<font></font>
    CxList _all = (All - exclusionList).GetByAncs(method_decl);<font></font>
		<font></font>
    <span class="hljs-keyword">if</span> (_all.FindByName(idorSanitizer).Count &gt; <span class="hljs-number">0</span>) {<font></font>
      cxLog.WriteDebugMessage(<span class="hljs-string">"find sanitized in method: "</span> + method_call.GetName());<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      vulns.Add(cxFlow.ConcatenatePath(method_call).ConcatenatePath(method_decl));<font></font>
      cxLog.WriteDebugMessage(<span class="hljs-string">"find NOT sanitized in method: "</span> + method_call.GetName());<font></font>
    }<font></font>
  }<font></font>
}<font></font>
<font></font>
result = vulns;<font></font>
</code></pre><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Checkmarxは、コードをトークンに簡単に解析し、そのタイプを判別します。</font><font style="vertical-align: inherit;">また、静的アナライザーはトークンを簡単に検索します。たとえば、現在のトークンの親トークンを見つけ、変数の初期化を見つけ、メソッドのパラメーターを見つけます。</font><font style="vertical-align: inherit;">フローは構築とほぼ同じです（ただし、失敗することもあります）。</font><font style="vertical-align: inherit;">これらすべてにより、コードの構造が事前定義されておらず、自分でコードを「カスタマイズ」する必要があるという違いを除いて、他のデータベースと同様にコードを操作することができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
誤検知の量を大幅に減らすには、以下に注意する必要があります。</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクト設定に例外を追加して、不要なファイルとディレクトリ（たとえば、テストのあるディレクトリ）を除外します。</font></font></li>
<li>    ,    (  ). ,     «Privacy Violation»,   ,         ,    Web UI.    , ..       UI    .       TLS        XSS     .</li>
<li> -    ,           (,   ). ,   XXE  ,   , -    ,   . </li>
<li>  false positive,   ,           CMxQL   FindBy/GetBy.         ,     (        SQL). </li>
<li>  false positives,    ,      ,   ,       ,   CMx,      . ,       LDAP ,      .       c LDAP-   ,   ,      .</li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このハウツーが、Checkmarxでクエリを書き始めたばかりの人にとって「Hello World」として役立つことを願っています。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja477732/index.html">水中ナビゲーションシステムの誤った指分類</a></li>
<li><a href="../ja477734/index.html">写真アプリでUICollectionViewLayoutを理解する</a></li>
<li><a href="../ja477736/index.html">テスターの道：「ハンドブレーキ」から自動化まで</a></li>
<li><a href="../ja477738/index.html">iKassa、または「デジタルキャッシャー」の手入れ方法</a></li>
<li><a href="../ja477740/index.html">そして、あなたの目でこの望遠鏡をどこに見るのですか？</a></li>
<li><a href="../ja477744/index.html">なぜ専門家は時々悪いアプリケーションを作成するのですか？</a></li>
<li><a href="../ja477746/index.html">収益化デザイナー：彼は誰で、どのようにしてひとつになるか</a></li>
<li><a href="../ja477752/index.html">バックエンドユナイテッド＃5：Shawarma-マイクロサービス、分散システム、Kafka</a></li>
<li><a href="../ja477754/index.html">micro：bitとArduinoを比較してください。そして、マイクロを取得する方法：あなたが英語の学生でない場合、ビットは無料です？</a></li>
<li><a href="../ja477756/index.html">2つの銀行CRMシステムをどのように結婚させたか</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>