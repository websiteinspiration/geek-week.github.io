<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé© üÄÑÔ∏è üé± The solar-powered home server worked for 15 months: uptime 95.26% üë®üèø‚Äçü§ù‚Äçüë®üèæ üë®üèª‚Äçüé§ ü§õüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The first prototype solar server with a charge controller. Photo: solar.lowtechmagazine.com
 
 In September 2018, an enthusiast from Low-tech Magazine...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>The solar-powered home server worked for 15 months: uptime 95.26%</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dcmiran/blog/486378/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/eh/th/2d/ehth2dv7ykrf9lj6lrozxqzmdei.jpeg"></a><br>
<i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The first prototype solar server with a charge controller. </font><font style="vertical-align: inherit;">Photo: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">solar.lowtechmagazine.com</font></font></a></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
In September 2018, an enthusiast from Low-tech Magazine</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> launched a ‚Äúlow-tech‚Äù web server project</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">The goal was to reduce power consumption so that a single solar panel was enough for the home self-hosted server. </font><font style="vertical-align: inherit;">This is not easy, because the site should work 24 hours a day. </font><font style="vertical-align: inherit;">Let's see what happened in the end. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can go to the server</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> solar.lowtechmagazine.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, check current power consumption and battery level. </font><font style="vertical-align: inherit;">The site is optimized for the minimum number of requests from the page and the minimum traffic, so it must withstand the jump in traffic from Habr. </font><font style="vertical-align: inherit;">According to the developer‚Äôs calculations, the energy consumption per unique visitor is 0.021 Wh.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Shortly before dawn, on January 31, 2020, he had 42% of the battery remaining. </font><font style="vertical-align: inherit;">Dawn in Barcelona at 8:04 local time, after which the current should go from the solar panel.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/um/dt/c5/umdtc5ymatrymminfcex-rt8k-y.png"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What for?</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ten years ago, experts </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">predicted</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> that the development of the Internet contributes to the ‚Äúdematerialization‚Äù of society, universal digitalization - and, as a result, a decrease in overall energy consumption. They were mistaken. In fact, the Internet itself has demanded </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">huge amounts of energy</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and these volumes continue to grow. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IT companies have launched initiatives to switch to alternative power supplies, but this is now impossible. All data centers consume three times more energy than all the world's solar and wind installations. Even worse, the production and regular replacement of solar panels and windmills </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">also requires energy</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">therefore, abandoning the fossil toplif (oil, gas, uranium) today is simply impossible. But these reserves will not be enough for a long time, so we will inevitably have to think about how to live on renewable sources. Including the operation of computer infrastructure, including web servers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Low-tech Magazine </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">considers the problem of</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> inflating web pages too fast. From 2010 to 2018, the average page size increased </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from 0.45 MB to 1.7 MB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and for mobile sites - from 0.15 MB to 1.6 MB, according to a conservative estimate. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Increased traffic </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ahead of progress in energy efficiency</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(the energy required to transfer 1 megabyte of information), which causes a constant increase in energy consumption of the Internet. </font><font style="vertical-align: inherit;">Heavier and heavier sites not only increase the load on the network infrastructure, but also shorten the ‚Äúlife cycle‚Äù of computers and smartphones, which often have to be thrown away and made new, which is also a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">very energy-intensive process</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And of course, increasing the load is created by the lifestyle itself: people spend almost all the time on the Internet and rely heavily on various web services. </font><font style="vertical-align: inherit;">It is already difficult to imagine a modern society without a cloud IT infrastructure (social networks, instant messengers, mail, etc.)</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Server and website configuration</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> described in detail the hardware configuration and software stack web server. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Olimex Olinuxino A20 Lime 2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Single </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">Board Computer is</font></a><font style="vertical-align: inherit;"> selected for its low power consumption and useful additional features such as the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AXP209</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> power management </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">chip</font></a><font style="vertical-align: inherit;"> . It allows you to request statistics on the current voltage and current strength from the board and from the battery. The chip automatically switches the power between the battery and the DC connector, where current flows from the solar panel. Thus, uninterrupted power supply to the server with battery support is possible. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/cca/d9c/9b5/ccad9c9b5fc2e6fc310922253ed1c37a.png"><br>
<i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Olimex Olinuxino A20 Lime 2</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Initially, a lithium-polymer battery with a capacity of 6600 mAh (about 24 Wh) was chosen as the battery, then they put an acid-lead battery at 84.4 Wh. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The operating system boots from the SD card. </font><font style="vertical-align: inherit;">Although the OS takes up no more than 1 GB and a static website is about 30 MB, there was no economic reason to buy a card smaller than Class 10 16 GB. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The server connects to the Network through a 100-megabyte home connection in Barcelona and a standard consumer router. </font><font style="vertical-align: inherit;">A static IP address is reserved for it. </font><font style="vertical-align: inherit;">Almost everyone can raise such a site in their apartment, you need to slightly change the firewall setting for port forwarding to local IP:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Port 80 to 80 for HTTP</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Port 443 to 443 for HTTPS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Port 22 to 22 for SSH</font></font></pre><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Armbian Stretch</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
operating system </font><font style="vertical-align: inherit;">based on the Debian distribution and the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SUNXI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kernel </font><font style="vertical-align: inherit;">, which is designed for single-board cards with AllWinner chips. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/603/eea/b83/603eeab833004b93a0258646f7623716.png"><br>
<i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A 50-watt solar panel for a web server and a 10-watt panel for lighting a living room in the author‚Äôs apartment.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
A static site is generated by the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pelican</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> system </font><font style="vertical-align: inherit;">(Python website generator). Static sites load faster and do not create a load on the CPU, so they are much more efficient than dynamically generated pages from the point of energy consumption. See the source code for the theme </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A very important point is image compression, because without this optimization it is almost impossible to make web pages less than 1 megabyte. For optimization, it was decided to convert the photos to grayscale images. For example, here's a photo of a female telephone operator on a switch in the last century, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">253 KB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hp/l3/lk/hpl3lkomognem_svsjd42i7bmty.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But the optimized grayscale image of </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">36.5 KB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in </font><font style="vertical-align: inherit;">size </font><font style="vertical-align: inherit;">with three colors (black, white, gray). Due to the optical illusion, the viewer seems to have more than three colors. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/ba6/cc2/5ec/ba6cc25ec6f908ba504405983f264072.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Halftone photographs were chosen not only for size optimization (the solution is rather dubious), but also for aesthetic reasons. This old image processing technique has certain stylistic features, so the site has turned out in a way a unique design.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
623 illustrations on the Low-tech Magazine website after optimization decreased in size from 194.2 MB to 21.3 MB, that is, 89%. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All old articles were converted to Markdown for ease of writing new articles, as well as for ease of backup through </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">git</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . All scripts and trackers, as well as logos, were removed from the site. The default font is used in the client browser. As a ‚Äúlogo‚Äù - the name of the magazine in capital letters with a left arrow: LOW ‚Üê TECH MAGAZINE. Only 16 bytes instead of a picture. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In case of downtime, the possibility of ‚Äúoffline reading‚Äù is organized: texts and pictures are exported to the RSS feed. Caching of 100% content, including HTML, is included.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another optimization is the inclusion of HTTP2 settings in nginx, which slightly reduces traffic and shortens page loading time, compared to HTTP / 1.1. </font><font style="vertical-align: inherit;">The table compares the results for five different pages.</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">FP | </font><font style="vertical-align: inherit;">WE | </font><font style="vertical-align: inherit;">Hs | </font><font style="vertical-align: inherit;">Fw | </font><font style="vertical-align: inherit;">CW |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| ---------- | ------- | ------- | ------- | ------- | ------ - |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">HTTP / 1.1 | </font><font style="vertical-align: inherit;">1.46s | </font><font style="vertical-align: inherit;">1.87s | </font><font style="vertical-align: inherit;">1.54s | </font><font style="vertical-align: inherit;">1.86s | </font><font style="vertical-align: inherit;">1.89s |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">HTTP2 | </font><font style="vertical-align: inherit;">1.30s | </font><font style="vertical-align: inherit;">1.49s | </font><font style="vertical-align: inherit;">1.54s | </font><font style="vertical-align: inherit;">1.79s | </font><font style="vertical-align: inherit;">1.55s |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Images | </font><font style="vertical-align: inherit;">9 | </font><font style="vertical-align: inherit;">21 | </font><font style="vertical-align: inherit;">11 | </font><font style="vertical-align: inherit;">19 | </font><font style="vertical-align: inherit;">23 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">savings | </font><font style="vertical-align: inherit;">11% | </font><font style="vertical-align: inherit;">21% | </font><font style="vertical-align: inherit;">0% | </font><font style="vertical-align: inherit;">4% | </font><font style="vertical-align: inherit;">18% |</font></font></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Full nginx configuration:</font></font><br>
<br>
<pre><code class="nginx hljs">root@solarserver:/var/log/nginx<span class="hljs-comment"># cat /etc/nginx/sites-enabled/solar.lowtechmagazine.com</span><font></font>
<font></font>
<span class="hljs-comment"># Expires map</span>
<span class="hljs-attribute">map</span> <span class="hljs-variable">$sent_http_content_type</span> <span class="hljs-variable">$expires</span> {
<span class="hljs-attribute">default</span> <span class="hljs-literal">off</span>;<font></font>
text/<span class="hljs-attribute">html</span> <span class="hljs-number">7d</span>;<font></font>
text/<span class="hljs-attribute">css</span> max;<font></font>
application/<span class="hljs-attribute">javascript</span> max;<font></font>
~image/ max;<font></font>
}<font></font>
<font></font>
<span class="hljs-section">server</span> {
<span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;
<span class="hljs-attribute">server_name</span> solar.lowtechmagazine.com;<font></font>
<font></font>
<span class="hljs-attribute">location</span> / {
<span class="hljs-attribute">return</span> <span class="hljs-number">301</span> https://<span class="hljs-variable">$server_name</span><span class="hljs-variable">$request_uri</span>;<font></font>
}<font></font>
}<font></font>
<font></font>
server{<font></font>
<span class="hljs-attribute">listen</span> <span class="hljs-number">443</span> ssl http2;
<span class="hljs-attribute">server_name</span> solar.lowtechmagazine.com;<font></font>
<font></font>
<span class="hljs-attribute">charset</span> UTF-<span class="hljs-number">8</span>; <span class="hljs-comment">#improve page speed by sending the charset with the first response.</span><font></font>
<font></font>
<span class="hljs-attribute">location</span> / {
<span class="hljs-attribute">root</span> /var/www/html/;
<span class="hljs-attribute">index</span> index.html;
<span class="hljs-attribute">autoindex</span> <span class="hljs-literal">off</span>;<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-comment">#Caching (save html pages for 7 days, rest as long as possible, no caching on frontpage)</span>
<span class="hljs-attribute">expires</span> <span class="hljs-variable">$expires</span>;<font></font>
<font></font>
<span class="hljs-attribute">location</span> <span class="hljs-variable">@index</span> {
<span class="hljs-attribute">add_header</span> Last-Modified <span class="hljs-variable">$date_gmt</span>;
<span class="hljs-attribute">add_header</span> Cache-Control <span class="hljs-string">'no-cache, no-store'</span>;
<span class="hljs-attribute">etag</span> <span class="hljs-literal">off</span>;
<span class="hljs-attribute">expires</span> <span class="hljs-literal">off</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">#error_page 404 /404.html;</span><font></font>
<font></font>
<span class="hljs-comment"># redirect server error pages to the static page /50x.html</span>
<span class="hljs-comment">#error_page 500 502 503 504 /50x.html;</span>
<span class="hljs-comment">#location = /50x.html {</span>
<span class="hljs-comment"># root /var/www/;</span>
<span class="hljs-comment">#}</span><font></font>
<font></font>
<span class="hljs-comment">#Compression</span><font></font>
<font></font>
<span class="hljs-attribute">gzip</span> <span class="hljs-literal">on</span>;
<span class="hljs-attribute">gzip_disable</span> <span class="hljs-string">"msie6"</span>;
<span class="hljs-attribute">gzip_vary</span> <span class="hljs-literal">on</span>;
<span class="hljs-attribute">gzip_comp_level</span> <span class="hljs-number">6</span>;
<span class="hljs-attribute">gzip_buffers</span> <span class="hljs-number">16</span> <span class="hljs-number">8k</span>;
<span class="hljs-attribute">gzip_http_version</span> <span class="hljs-number">1</span>.<span class="hljs-number">1</span>;
<span class="hljs-attribute">gzip_types</span> text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;<font></font>
<font></font>
<font></font>
<span class="hljs-comment">#Caching (save html page for 7 days, rest as long as possible)</span>
<span class="hljs-attribute">expires</span> <span class="hljs-variable">$expires</span>;<font></font>
<font></font>
<span class="hljs-comment"># Logs</span>
<span class="hljs-attribute">access_log</span> /var/log/nginx/solar.lowtechmagazine.com_ssl.access.log;
<span class="hljs-attribute">error_log</span> /var/log/nginx/solar.lowtechmagazine.com_ssl.<span class="hljs-literal">error</span>.log;<font></font>
<font></font>
<span class="hljs-comment"># SSL Settings:</span>
<span class="hljs-attribute">ssl_certificate</span> /etc/letsencrypt/live/solar.lowtechmagazine.com/fullchain.pem;
<span class="hljs-attribute">ssl_certificate_key</span> /etc/letsencrypt/live/solar.lowtechmagazine.com/privkey.pem;<font></font>
<font></font>
<span class="hljs-comment"># Improve HTTPS performance with session resumption</span>
<span class="hljs-attribute">ssl_session_cache</span> shared:SSL:<span class="hljs-number">10m</span>;
<span class="hljs-attribute">ssl_session_timeout</span> <span class="hljs-number">5m</span>;<font></font>
<font></font>
<span class="hljs-comment"># Enable server-side protection against BEAST attacks</span>
<span class="hljs-attribute">ssl_prefer_server_ciphers</span> <span class="hljs-literal">on</span>;
<span class="hljs-attribute">ssl_ciphers</span> ECDH+AESGCM:ECDH+AES256:ECDH+AES128:DH+3DES:!ADH:!AECDH:!MD5;<font></font>
<font></font>
<span class="hljs-comment"># Disable SSLv3</span>
<span class="hljs-attribute">ssl_protocols</span> TLSv1 TLSv1.<span class="hljs-number">1</span> TLSv1.<span class="hljs-number">2</span>;<font></font>
<font></font>
<span class="hljs-comment"># Lower the buffer size to increase TTFB</span>
<span class="hljs-attribute">ssl_buffer_size</span> <span class="hljs-number">4k</span>;<font></font>
<font></font>
<span class="hljs-comment"># Diffie-Hellman parameter for DHE ciphersuites</span>
<span class="hljs-comment"># $ sudo openssl dhparam -out /etc/ssl/certs/dhparam.pem 4096</span>
<span class="hljs-attribute">ssl_dhparam</span> /etc/ssl/certs/dhparam.pem;<font></font>
<font></font>
<span class="hljs-comment"># Enable HSTS (https://developer.mozilla.org/en-US/docs/Security/HTTP_Strict_Transport_Security)</span>
<span class="hljs-attribute">add_header</span> Strict-Transport-Security <span class="hljs-string">"max-age=63072000; includeSubdomains"</span>;<font></font>
<font></font>
<span class="hljs-comment"># Enable OCSP stapling (http://blog.mozilla.org/security/2013/07/29/ocsp-stapling-in-firefox)</span>
<span class="hljs-attribute">ssl_stapling</span> <span class="hljs-literal">on</span>;
<span class="hljs-attribute">ssl_stapling_verify</span> <span class="hljs-literal">on</span>;
<span class="hljs-attribute">ssl_trusted_certificate</span> /etc/letsencrypt/live/solar.lowtechmagazine.com/fullchain.pem;
<span class="hljs-attribute">resolver</span> <span class="hljs-number">87.98.175.85</span> <span class="hljs-number">193.183.98.66</span> valid=<span class="hljs-number">300s</span>;
<span class="hljs-attribute">resolver_timeout</span> <span class="hljs-number">5s</span>;<font></font>
}</code></pre><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Results of 15 months of work</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For the period from December 12, 2018 to November 28, 2019, the server showed an </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uptime of 95.26%</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . This means that due to bad weather, the downtime for the year was 399 hours. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But if you do not take into account the last two months, the uptime is 98.2%, and the downtime is only 152 hours, the developers write. Uptime has fallen to 80% over the past two months, when power consumption increased due to software updates. Every night the site was down for several hours.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
According to statistics, for the year (from December 3, 2018 to November 24, 2019), the server‚Äôs power consumption was 9.53 kWh. Significant losses were recorded in the photovoltaic system due to voltage conversion and battery discharge. The solar controller showed an annual consumption of 18.10 kWh, which means a system efficiency of about 50%. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/441/110/3a1/4411103a1f1e5471afafe13fe10dc66c.jpg"><br>
<i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simplified scheme. It does not show a voltage converter from 12 to 5 volts and a battery ampere hour meter.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
During the study period, 865,000 unique visitors visited the site. Including all energy losses in the solar installation, the energy consumption per unique visitor was 0.021 Wh. Thus, one kilowatt-hour of generated solar energy is enough to serve almost 50,000 unique visitors.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
During the experiment, solar panels of different sizes were tested. The table shows the calculations for how long batteries of different capacities are charged when using solar panels of different sizes. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ck/vw/qv/ckvwqvclfxmgjpw8kcpqm8wojmu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The average power consumption of the web server during the first year, including all energy losses, was 1.97 watts. The calculation shows that to maintain a website at night on the shortest night of the year (8 hours 50 minutes, June 21), you need 17.40 watts-hour of storage power, and on the longest night (14 hours 49 minutes, December 21) , 19 Wh</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_c/el/qi/_celqiqryiici5sqzanuis4gobc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since lead-acid batteries should not be discharged below half the capacity, the server needs a 60 Wh battery to survive the longest night under optimal daylight conditions (2 √ó 29.19 Wh). </font><font style="vertical-align: inherit;">For most of the year, the system worked with a 86.4 Wh / h battery and a 50-watt solar panel, then the aforementioned uptime of 95-98% was achieved.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uptime 100%</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For uptime, 100% requires an increase in battery capacity. To compensate for one day of very bad weather (without significant power generation), you need 47.28 watts-hours (24 hours √ó 1.97 watts) of storage. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
From December 1, 2019 to January 12, 2020, a 168-watt battery was installed in the system, which has a practical storage capacity of 84 watts-hours. This storage is enough to maintain the site for two nights and one day. The configuration was tested in the darkest period of the year, but the weather was relatively good - and during this period, the uptime was 100%.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But in order to guarantee an uptime of 100% for several years, it is necessary to foresee the worst case scenario, when bad weather persists for several days. The calculation shows: in order to maintain the site online for four days with low or zero energy generation, you will need a lead-acid battery with a capacity of 440 watts-hours, that is, the size of a car battery. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In practice, in good weather, a 48 Wh lead-acid battery will support the server during the night from March to September. A 24 Wh battery will keep the server for a maximum of 6 hours, that is, it will shut down every night, although at different times, depending on the month.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By and large, some sites do not have to work at night, when the number of visitors is minimal, according to the guys from Low-tech Magazine. For example, if it is a regional city publication, where visitors from other time zones do not go, but only local residents. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That is, for sites with different traffic and different uptime, batteries of different capacities and solar panels of different sizes are needed. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nr/4w/ad/nr4wad7udwyrcx3wtawthytkzjy.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/is/fg/bc/isfgbcit1chetwg-8fe_ymodglq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The author calculates how much energy is required to </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">produce</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> the solar panels themselves (realized energy) and how much is obtained if you divide this amount by the expected service life of 10 years.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0e/aa/i4/0eaai4fbjyx-j0jm4szb6uxy8t8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thus, it is possible to calculate an analogue of fossil fuels, which is spent on the production and operation of panels. </font><font style="vertical-align: inherit;">At Low-tech Magazine it turned out that in the first year of operation, their system (50 W panel, 86.4 Wh battery) ‚Äúgenerated‚Äù about 9 kg of emissions or the equivalent of burning 3 liters of gasoline: about the same as a passenger car for 50 km of progress. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/a0/kb/qn/a0kbqn9ctp-qa99mgs9sdznp7sq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the server is powered not from solar panels, but from the general power grid, then the equivalent of emissions seems to be six times lower: 1.54 kg (the share of alternative energy and nuclear power plants is high in Spanish energy). </font><font style="vertical-align: inherit;">But this is not a completely correct comparison, the author writes, because it takes into account the implemented energy of the solar infrastructure, but does not take this indicator into account for the total energy network, that is, the costs of its construction and support.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Further improvements</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Over the past time, a number of optimizations have been carried out that have reduced server power consumption. For example, at some point, the developer noticed that 6.63 TB out of the total 11.15 TB traffic generated by one incorrect implementation of the RSS feed, which pulls content every few minutes. After fixing this bug, the server‚Äôs power consumption (excluding energy losses) decreased from 1.14 watts to about 0.95 watts. The gain may seem small, but the difference of 0.19 watts means 4.56 watts-hours per day, which corresponds to more than 2.5 hours of battery life.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the first year, efficiency was only 50%. Losses were observed when charging and discharging the battery (22%), as well as when converting voltage from 12 V (solar photovoltaic system) to 5 V (USB), where losses are up to 28%. The developer admits that he does not have an optimal voltage converter (controller without built-in USB), so you can optimize this moment or switch to a 5V solar installation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To increase the efficiency of energy storage, lead-acid batteries can be replaced with more expensive lithium-ion batteries, which have less charge / discharge loss (&lt;10%). Now the designer is considering a compact </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">system for storing electricity in the form of compressed air</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(CAES), which has a ten-year service life, which means less carbon footprint. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/0e6/bf0/fe7/0e6bf0fe70967f6ecb67ae11b3b1eaab.jpg"><br>
<i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compact energy accumulator in compressed air, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">source</font></font></a></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
We are considering installing an additional wind turbine (it can be </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">made of wood</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) and installing a solar tracker to turn the panels to the sun. The tracker allows you to increase electricity generation by 30%. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/d_/ua/ya/d_uayatij5brhpt1wnilp1pqnti.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another way to increase the efficiency of the system is to scale it. Raise more websites on the server and run more servers. Then the energy consumption per each site will decrease. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kq/zt/46/kqzt46ilxzjajy0calw5n3k7r00.jpeg"><br>
<i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solar hosting company. Illustration: Diego Marmolejo</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you cover the entire balcony of the apartment with solar panels and open a solar web hosting company, then the costs for each client will be significantly lower than for a single website: economies of scale. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In general, this experiment demonstrates that, under certain limitations, computer infrastructure may well work on renewable energy sources. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Theoretically, such a server can even do without a battery if you mirror it in other parts of the world. </font><font style="vertical-align: inherit;">For example, put mirrors in New Zealand and Chile. </font><font style="vertical-align: inherit;">There, solar panels will work when it is night in Barcelona.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/en486378/">https://habr.com/ru/post/en486378/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en486360/index.html">How to migrate from mocha to jest in 15 easy steps - and why</a></li>
<li><a href="../en486362/index.html">How I did not become a product manager after training at Product Univercity Moreynis and Chernyak</a></li>
<li><a href="../en486368/index.html">~ SMAK ~ - programmable controllers for smart homesteads using the asyncio library on MicroPython</a></li>
<li><a href="../en486372/index.html">Czech programmers wrote a site worth 16 million euros for free? Truth?</a></li>
<li><a href="../en486376/index.html">How level designers use architecture theory to create game levels</a></li>
<li><a href="../en486380/index.html">What a Product Manager Should Actually Do</a></li>
<li><a href="../en486382/index.html">Seals and Scrum</a></li>
<li><a href="../en486388/index.html">MyVPN Open Source Nonprofit Project Overview</a></li>
<li><a href="../en486390/index.html">Wright In The Shadows</a></li>
<li><a href="../en486392/index.html">A brief comparison of the SDS architecture or finding a suitable storage platform (GlusterVsCephVsVirtuozzoStorage)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>