<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèûÔ∏è üêë üóúÔ∏è Bereiten Sie unser Produkt mit Laravel-Warteschlangen skalierbar vor üå† üöó ‚úä</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Eine √úbersetzung des Artikels wurde speziell f√ºr Studenten des Kurses ‚ÄûFramework Laravel‚Äú erstellt .
 
 
 
 Hallo, ich bin Valerio, ein Softwareentwic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Bereiten Sie unser Produkt mit Laravel-Warteschlangen skalierbar vor</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/499508/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eine √úbersetzung des Artikels wurde speziell f√ºr Studenten des Kurses </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄûFramework Laravel‚Äú erstellt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></i></b><br>
<br>
<img src="https://habrastorage.org/webt/ei/7u/aq/ei7uaq5c5omdkojxhmurjggkqw4.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hallo, ich bin Valerio, ein Softwareentwickler aus Italien. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieses Handbuch richtet sich an alle PHP-Entwickler, die bereits Online-Anwendungen mit echten Benutzern haben, aber kein tieferes Verst√§ndnis daf√ºr haben, wie die Skalierbarkeit in ihrem System mithilfe von Laravel-Warteschlangen implementiert (oder erheblich verbessert) werden kann. Ich habe Laravel zum ersten Mal Ende 2013 zu Beginn der 5. Version des Frameworks kennengelernt. Damals war ich noch kein Entwickler, der an ernsthaften Projekten beteiligt war, und einer der Aspekte moderner Frameworks, insbesondere in Laravel, der mir am unverst√§ndlichsten erschien, waren Warteschlangen.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als ich die Dokumentation las, vermutete ich das Potenzial, aber ohne echte Entwicklungserfahrung blieb dies alles nur auf der Ebene der Theorien in meinem Kopf. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Heute bin ich der Sch√∂pfer </font></font><code>Inspector.dev</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- das </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Echtzeit-Dashboard</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , das jede Stunde Tausende von Aufgaben ausf√ºhrt, und ich verstehe diese Architektur viel besser als zuvor. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ey/rx/qu/eyrxquvk3yrmu5kldbmpuit5riu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Artikel werde ich Ihnen erkl√§ren, wie ich Warteschlangen und Aufgaben entdeckt habe und welche Konfigurationen mir geholfen haben, gro√üe Datenmengen in Echtzeit zu verarbeiten und gleichzeitig Serverressourcen zu sparen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einf√ºhrung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn eine PHP-Anwendung eine eingehende http-Anfrage empf√§ngt, wird unser Code Schritt f√ºr Schritt nacheinander ausgef√ºhrt, bis die Anfrage abgeschlossen ist und eine Antwort an den Client (z. B. den Browser des Benutzers) zur√ºckgegeben wird. Dieses synchrone Verhalten ist wirklich intuitiv, vorhersehbar und leicht zu verstehen. Ich sende eine http-Anfrage an den Endpunkt, die Anwendung extrahiert Daten aus der Datenbank, konvertiert sie in das entsprechende Format, f√ºhrt einige zus√§tzliche Aufgaben aus und sendet sie zur√ºck. Alles geschieht linear. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aufgaben und Warteschlangen f√ºhren ein asynchrones Verhalten ein, das diesen Zeilenfluss verletzt. Deshalb kamen mir diese Funktionen zun√§chst etwas seltsam vor.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Manchmal kann eine eingehende http-Anforderung jedoch einen Zyklus zeitaufw√§ndiger Aufgaben ausl√∂sen, z. B. das Senden von E-Mail-Benachrichtigungen an alle Teammitglieder. </font><font style="vertical-align: inherit;">Dies kann das Senden von sechs oder zehn E-Mails bedeuten, was vier oder f√ºnf Sekunden dauern kann. </font><font style="vertical-align: inherit;">Daher muss der Benutzer jedes Mal, wenn er auf die entsprechende Schaltfl√§che klickt, f√ºnf Sekunden warten, bevor er die Anwendung weiter verwenden kann. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je mehr die Anwendung w√§chst, desto schlimmer wird dieses Problem.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was ist eine Aufgabe?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein Job ist eine Klasse, die die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Handle-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Methode implementiert </font><font style="vertical-align: inherit;">, die die Logik enth√§lt, die asynchron ausgef√ºhrt werden soll.</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">Queue</span>\<span class="hljs-title">ShouldQueue</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Foundation</span>\<span class="hljs-title">Bus</span>\<span class="hljs-title">Dispatchable</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Queue</span>\<span class="hljs-title">InteractsWithQueue</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Bus</span>\<span class="hljs-title">Queueable</span>;<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CallExternalAPI</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ShouldQueue</span>
</span>{
    <span class="hljs-keyword">use</span> <span class="hljs-title">Dispatchable</span>,
        <span class="hljs-title">InteractsWithQueue</span>,
        <span class="hljs-title">Queueable</span>;<font></font>
        <font></font>
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@var</span> string
     */</span>
    <span class="hljs-keyword">protected</span> $url;<font></font>
<font></font>
    <span class="hljs-comment">/**
     *    .
     *
     * <span class="hljs-doctag">@param</span> array $Data
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">$url</span>)
    </span>{
        <span class="hljs-keyword">$this</span>-&gt;url = $url;<font></font>
    }<font></font>
    <font></font>
<font></font>
    <span class="hljs-comment">/**
     *  ,   .
     *
     * <span class="hljs-doctag">@return</span> void
     * <span class="hljs-doctag">@throws</span> \Throwable
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle</span>(<span class="hljs-params"></span>)
    </span>{<font></font>
        file_get_contents(<span class="hljs-keyword">$this</span>-&gt;url);<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie oben erw√§hnt, besteht der Hauptgrund f√ºr das Abschlie√üen eines Codeteils in Job darin, eine zeitaufw√§ndige Aufgabe auszuf√ºhren, ohne den Benutzer zu zwingen, auf den Abschluss zu warten.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was verstehen wir unter ‚Äûm√ºhsamen Aufgaben‚Äú?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist eine nat√ºrliche Frage. </font><font style="vertical-align: inherit;">Das Senden von E-Mails ist das h√§ufigste Beispiel f√ºr Artikel, die sich mit Warteschlangen befassen. Ich m√∂chte Ihnen jedoch die tats√§chlichen Erfahrungen mit meinen Aufgaben erl√§utern. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als Product Owner ist es mir sehr wichtig, die Reiseinformationen der Benutzer mit unseren Marketing- und Kundensupport-Tools zu synchronisieren. </font><font style="vertical-align: inherit;">Basierend auf Benutzeraktionen aktualisieren wir Benutzerinformationen in verschiedenen externen Softwareprogrammen √ºber API (oder externe http-Aufrufe) f√ºr Service- und Marketingzwecke.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Einer der am h√§ufigsten verwendeten Endpunkte in meiner Anwendung kann vor Abschluss 10 E-Mails senden und 3 http-Anrufe an externe Dienste t√§tigen. </font><font style="vertical-align: inherit;">Kein Benutzer wird so lange warten - h√∂chstwahrscheinlich h√∂ren alle einfach auf, meine Anwendung zu verwenden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dank der Warteschlangen kann ich alle diese Aufgaben in den zugewiesenen Klassen kapseln, die f√ºr die Ausf√ºhrung ihrer Arbeit erforderlichen Informationen an den Konstruktor √ºbertragen und planen, dass sie zu einem sp√§teren Zeitpunkt im Hintergrund abgeschlossen werden, damit mein Controller die Antwort sofort zur√ºckgeben kann.</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProjectController</span> 
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">store</span>(<span class="hljs-params">Request $request</span>)
    </span>{<font></font>
        $project = Project::create($request-&gt;all());<font></font>
        <font></font>
        <span class="hljs-comment">//  NotifyMembers, TagUserActive, NotifyToProveSource </span>
        <span class="hljs-comment">//   ,     </span>
        Notification::queue(<span class="hljs-keyword">new</span> NotifyMembers($project-&gt;owners));
        <span class="hljs-keyword">$this</span>-&gt;dispatch(<span class="hljs-keyword">new</span> TagUserAsActive($project-&gt;owners));
        <span class="hljs-keyword">$this</span>-&gt;dispatch(<span class="hljs-keyword">new</span> NotifyToProveSource($project-&gt;owners));<font></font>
        <font></font>
        <span class="hljs-keyword">return</span> $project;<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich muss nicht auf den Abschluss all dieser Prozesse warten, bevor ich die Antwort zur√ºckschicke. </font><font style="vertical-align: inherit;">Im Gegenteil, die Wartezeit entspricht der Zeit, die erforderlich ist, um sie in der Warteschlange zu ver√∂ffentlichen. </font><font style="vertical-align: inherit;">Und das bedeutet den Unterschied zwischen 10 Sekunden und 10 Millisekunden !!!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wer f√ºhrt diese Aufgaben aus, nachdem er sie an die Warteschlange gesendet hat?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist die klassische </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Publisher / Consumer-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Architektur </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Wir haben unsere Aufgaben bereits in der Warteschlange des Controllers ver√∂ffentlicht. Jetzt werden wir verstehen, wie die Warteschlange verwendet wird, und schlie√ülich werden die Aufgaben ausgef√ºhrt. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pi/va/vr/pivavrbjasagc40trhmqpesyc2u.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Warteschlange zu verwenden, m√ºssen wir einen der beliebtesten Handwerkerbefehle ausf√ºhren:</font></font><br>
<br>
<pre><code class="php hljs">php artisan queue:work</code></pre><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In der Dokumentation hei√üt es: </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Laravel enth√§lt einen Warteschlangenarbeiter, der neue Aufgaben verarbeitet, wenn sie in die Warteschlange gestellt werden.</font></font></i></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gro√üartig! </font><font style="vertical-align: inherit;">Laravel bietet eine vorgefertigte Schnittstelle f√ºr Warteschlangenaufgaben und einen gebrauchsfertigen Befehl zum Abrufen von Aufgaben aus der Warteschlange und zum Ausf√ºhren ihres Codes im Hintergrund.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supervisor-Rolle</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Am Anfang war es eine andere ‚Äûseltsame Sache‚Äú. Ich denke, es ist normal, neue Dinge zu entdecken. Nach dieser Schulungsphase schreibe ich diese Artikel, um meine F√§higkeiten zu organisieren und gleichzeitig anderen Entwicklern zu helfen, ihr Wissen zu erweitern. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn die Aufgabe beim Ausl√∂sen einer Ausnahme fehlschl√§gt, beendet das Team </font></font><code>queue:work</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seine Arbeit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Damit ein Prozess </font></font><code>queue:work</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kontinuierlich ausgef√ºhrt werden kann (was Ihre Warteschlangen beansprucht), m√ºssen Sie einen Prozessmonitor wie Supervisor verwenden, um sicherzustellen, dass der Befehl auch dann </font></font><code>queue:work</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nicht nicht mehr funktioniert, wenn die Task eine Ausnahme ausl√∂st. </font><font style="vertical-align: inherit;">Supervisor </font><font style="vertical-align: inherit;">startet den Befehl nach dem Absturz neu und startet wieder von der n√§chsten Aufgabe, die ausl√∂sende Ausnahme beiseite legen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aufgaben werden im Hintergrund auf Ihrem Server ausgef√ºhrt und sind nicht mehr von der HTTP-Anforderung abh√§ngig. </font><font style="vertical-align: inherit;">Dies f√ºhrt einige √Ñnderungen ein, die ich bei der Implementierung des Task-Codes ber√ºcksichtigen musste. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier sind die wichtigsten, auf die ich achten werde:</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie kann ich feststellen, dass der Aufgabencode nicht funktioniert?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie im Hintergrund ausgef√ºhrt werden, k√∂nnen Sie nicht sofort feststellen, dass Ihre Aufgabe Fehler verursacht. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie erhalten kein sofortiges Feedback mehr, z. B. wenn Sie eine http-Anfrage von Ihrem Browser aus stellen. </font><font style="vertical-align: inherit;">Wenn die Aufgabe fehlschl√§gt, wird sie still ausgef√ºhrt und niemand wird es bemerken. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erw√§gen Sie die Integration eines Echtzeit-√úberwachungstools wie des </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inspektors,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> um jeden Fehler aufzudecken.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie haben keine http-Anfrage</font></font></h3><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es gibt keine HTTP-Anforderung mehr. </font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ihr Code wird von cli ausgef√ºhrt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie Abfrageparameter ben√∂tigen, um Ihre Aufgaben abzuschlie√üen, m√ºssen Sie diese zur sp√§teren Verwendung zur Laufzeit an den Aufgabenkonstruktor √ºbergeben:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-comment">//   </span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TagUserJob</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ShouldQueue</span>
</span>{
    <span class="hljs-keyword">public</span> $data;<font></font>
    <font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> $data</span>)
    </span>{
        <span class="hljs-keyword">$this</span>-&gt;data = $data;<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//       </span><font></font>
<font></font>
<span class="hljs-keyword">$this</span>-&gt;dispatch(<span class="hljs-keyword">new</span> TagUserJob($request-&gt;all()));</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie wissen nicht, wer sich angemeldet hat</font></font></h3><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es gibt keine Sitzung mehr</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Auf die gleiche Weise kennen Sie die Identit√§t des angemeldeten Benutzers nicht. Wenn Sie also Informationen √ºber den Benutzer ben√∂tigen, um die Aufgabe abzuschlie√üen, m√ºssen Sie das Benutzerobjekt an den Aufgabenkonstruktor √ºbergeben:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TagUserJob</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ShouldQueue</span>
</span>{
    <span class="hljs-keyword">public</span> $user;<font></font>
    <font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">User $user</span>)
    </span>{
        <span class="hljs-keyword">$this</span>-&gt;user= $user;<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//       </span>
<span class="hljs-keyword">$this</span>-&gt;dispatch(<span class="hljs-keyword">new</span> TagUserJob($request-&gt;user()));</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verstehen, wie man skaliert</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Leider reicht dies in vielen F√§llen nicht aus. </font><font style="vertical-align: inherit;">Die Verwendung einer Leitung und eines Verbrauchers kann bald unbrauchbar werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Warteschlangen sind FIFO-Puffer ("first in, first out"). </font><font style="vertical-align: inherit;">Wenn Sie viele Aufgaben geplant haben, m√∂glicherweise sogar verschiedene Arten, m√ºssen diese warten, bis andere ihre Aufgaben erledigt haben, bevor sie sie erledigen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt zwei M√∂glichkeiten zur Skalierung: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mehrere Konsumenten pro Warteschlange.</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/id/uu/0j/iduu0jzihjoqnm95edxdox7swim.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Somit werden jeweils f√ºnf Aufgaben aus der Warteschlange entfernt, wodurch die Verarbeitung der Warteschlange beschleunigt wird. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spezialwarteschlangen</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Sie k√∂nnen auch spezifische Warteschlangen f√ºr jeden Aufgabentyp erstellen, der mit einem dedizierten Consumer f√ºr jede Warteschlange gestartet werden soll.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3r/0i/gv/3r0igvjwxthteiiqrx7p8exouz8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Somit wird jede Warteschlange unabh√§ngig verarbeitet, ohne auf die Ausf√ºhrung anderer Arten von Aufgaben zu warten.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Horizont</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Laravel Horizon ist ein Warteschlangenmanager, mit dem Sie die volle Kontrolle dar√ºber haben, wie viele Warteschlangen Sie einrichten m√∂chten, und die M√∂glichkeit haben, Verbraucher zu organisieren. So k√∂nnen Entwickler diese beiden Strategien kombinieren und diejenige implementieren, die Ihren Skalierbarkeitsanforderungen entspricht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Start erfolgt √ºber den </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PHP Artisan Horizon</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> anstelle der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PHP Artisan Queue: Work</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dieser Befehl durchsucht Ihre Konfigurationsdatei </font></font><code>horizon.php</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und startet je nach Konfiguration eine Reihe von Warteschlangenarbeitern:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-string">'production'</span> =&gt; [
    <span class="hljs-string">'supervisor-1'</span> =&gt; [
        <span class="hljs-string">'connection'</span> =&gt; <span class="hljs-string">"redis"</span>,
        <span class="hljs-string">'queue'</span> =&gt; [<span class="hljs-string">'adveritisement'</span>, <span class="hljs-string">'logs'</span>, <span class="hljs-string">'phones'</span>],
        <span class="hljs-string">'processes'</span> =&gt; <span class="hljs-number">9</span>,
        <span class="hljs-string">'tries'</span> =&gt; <span class="hljs-number">3</span>,
        <span class="hljs-string">'balance'</span> =&gt; <span class="hljs-string">'simple'</span>, <span class="hljs-comment">//   simple, auto  null</span><font></font>
<font></font>
    ]<font></font>
]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im obigen Beispiel startet Horizon drei Warteschlangen mit drei Prozessen, die zur Verarbeitung jeder Warteschlange zugewiesen sind. </font><font style="vertical-align: inherit;">Wie in der Laravel-Dokumentation erw√§hnt, erm√∂glicht der codegesteuerte Ansatz von Horizon, dass meine Konfiguration in einem Versionskontrollsystem verbleibt, in dem mein Team zusammenarbeiten kann. </font><font style="vertical-align: inherit;">Dies ist die perfekte L√∂sung mit einem CI-Tool. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lesen Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diesen wunderbaren Artikel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , um die Bedeutung von Konfigurationsparametern im Detail herauszufinden </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meine eigene Konfiguration</font></font></h3><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-string">'production'</span> =&gt; [
    <span class="hljs-string">'supervisor-1'</span> =&gt; [
        <span class="hljs-string">'connection'</span> =&gt; <span class="hljs-string">'redis'</span>,
        <span class="hljs-string">'queue'</span> =&gt; [<span class="hljs-string">'default'</span>, <span class="hljs-string">'ingest'</span>, <span class="hljs-string">'notifications'</span>],
        <span class="hljs-string">'balance'</span> =&gt; <span class="hljs-string">'auto'</span>,
        <span class="hljs-string">'processes'</span> =&gt; <span class="hljs-number">15</span>,
        <span class="hljs-string">'tries'</span> =&gt; <span class="hljs-number">3</span>,<font></font>
    ],<font></font>
]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Inspektor verwendet haupts√§chlich drei Warteschlangen:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aufnahme f√ºr Prozesse zur Analyse von Daten aus externen Anwendungen;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Benachrichtigungen werden verwendet, um Benachrichtigungen sofort zu planen, wenn beim Empfang von Daten ein Fehler festgestellt wird.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Standardeinstellung wird f√ºr andere Aufgaben verwendet, die ich nicht mit </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aufnahme-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Benachrichtigungsprozessen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mischen m√∂chte </font><font style="vertical-align: inherit;">.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durch die Verwendung von </font></font><code>balance=auto</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Horizon versteht er, dass die maximale Anzahl aktivierter Prozesse 15 betr√§gt, die je nach Laden der Warteschlangen dynamisch verteilt werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn die Warteschlangen leer sind, unterst√ºtzt Horizon einen aktiven Prozess f√ºr jede Warteschlange, sodass der Verbraucher die Warteschlange sofort verarbeiten kann, wenn eine Aufgabe geplant ist.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schlussbemerkungen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die gleichzeitige Ausf√ºhrung im Hintergrund kann viele andere unvorhersehbare Fehler verursachen, z. B. MySQL "Lock Timeed Out" und viele andere Designprobleme. </font><font style="vertical-align: inherit;">Lesen Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mehr </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich hoffe, dieser Artikel hat Ihnen geholfen, Warteschlangen und Aufgaben sicherer zu verwenden. </font><font style="vertical-align: inherit;">Wenn Sie mehr √ºber uns erfahren m√∂chten, besuchen Sie unsere Website unter </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.inspector.dev. </font></font></a><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zuvor hier ver√∂ffentlicht </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.inspector.dev/what-worked-for-me-using-laravel-queues-from-the-basics-to -Horizont</font></font></a></i><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Steigen Sie in den Kurs ein und erhalten Sie einen Rabatt.</font></font><br>
</a><br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de499490/index.html">Zuf√§llige Algorithmen</a></li>
<li><a href="../de499492/index.html">Kann ein Entwickler im Silicon Valley Million√§r werden? Personalingenieur beim Parsen in Lyft</a></li>
<li><a href="../de499502/index.html">Warum OceanStor Dorado V6 der schnellste und zuverl√§ssigste Speicher ist</a></li>
<li><a href="../de499504/index.html">Apple & Google Bluetooth-Kontaktverfolgungsprotokoll</a></li>
<li><a href="../de499506/index.html">St√ºndliche Zahlung f√ºr das Ergebnis oder Gehalt?</a></li>
<li><a href="../de499512/index.html">AHK im Minimum. Bindemittel</a></li>
<li><a href="../de499516/index.html">Beginn des Beta-Tests des Plugins f√ºr Rider und PVS-Studio C # f√ºr Linux / macOS</a></li>
<li><a href="../de499518/index.html">Videokonferenzen sind jetzt ein Markt und neue Technologien. Longrid, Teil eins</a></li>
<li><a href="../de499522/index.html">Alle Innovationen von Windows 10 2004 (20H1)</a></li>
<li><a href="../de499524/index.html">Quarkus: Anwendungs-Upgrades anhand des Beispiels helloworld von JBoss EAP Quickstart</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>