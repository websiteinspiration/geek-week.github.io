<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶è üë©üèº‚Äçü§ù‚Äçüë®üèª üõÄüèæ Seguran√ßa e DBMS: o que voc√™ precisa lembrar ao escolher as ferramentas de prote√ß√£o üêò ü•ò üìú</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Meu nome √© Denis Rozhkov, sou o chefe de desenvolvimento de software da Gazinformservice, na equipe de produtos Jatoba . A legisla√ß√£o e os regulamento...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Seguran√ßa e DBMS: o que voc√™ precisa lembrar ao escolher as ferramentas de prote√ß√£o</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/500708/"><h1><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1e1/315/3ed/1e13153edc98d4ac4b2de6858a7ea48c.png"></div></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meu nome √© Denis Rozhkov, sou o chefe de desenvolvimento de software da Gazinformservice, na </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">equipe de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> produtos </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">Jatoba</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">A legisla√ß√£o e os regulamentos corporativos imp√µem certos requisitos para a seguran√ßa do armazenamento de dados. </font><font style="vertical-align: inherit;">Ningu√©m deseja que terceiros obtenham acesso a informa√ß√µes confidenciais; portanto, os seguintes problemas s√£o importantes para qualquer projeto: identifica√ß√£o e autentica√ß√£o, gerenciamento de acesso a dados, garantia da integridade das informa√ß√µes no sistema, registro de eventos de seguran√ßa. </font><font style="vertical-align: inherit;">Portanto, quero falar sobre alguns pontos interessantes sobre a seguran√ßa do DBMS.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este artigo foi </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">escrito</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> por </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">@Databases Meetup,</font></a><font style="vertical-align: inherit;"> hospedado por </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mail.ru Cloud Solutions</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Se voc√™ n√£o quiser ler, poder√° ver:</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/n-54j9FHaMU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O artigo ter√° tr√™s partes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como proteger conex√µes.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que √© uma auditoria de a√ß√µes e como registrar o que est√° acontecendo por parte do banco de dados e a conex√£o com ele.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como proteger os dados no pr√≥prio banco de dados e quais tecnologias existem para isso.</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a7d/19f/d89/a7d19fd894a9ea6e3f0ff7a0ad42db36.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os tr√™s componentes da seguran√ßa do DBMS: prote√ß√£o de conex√£o, auditoria de atividades e prote√ß√£o de dados</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prote√ß√£o de conex√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode se conectar ao banco de dados direta ou indiretamente por meio de aplicativos da web. </font><font style="vertical-align: inherit;">Como regra, o usu√°rio do lado da empresa, ou seja, a pessoa que trabalha com o DBMS, n√£o interage diretamente com ele. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de falar sobre a prote√ß√£o de conex√µes, voc√™ precisa responder a perguntas importantes que dependem de como as medidas de seguran√ßa ser√£o constru√≠das:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se um usu√°rio comercial √© equivalente a um usu√°rio DBMS;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O acesso aos dados do DBMS √© fornecido apenas por meio da API que voc√™ controla ou h√° acesso diretamente √†s tabelas;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se o DBMS est√° alocado em um segmento protegido separado, quem interage com ele e como;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se pool / proxy e middleware s√£o usados, o que pode alterar as informa√ß√µes sobre como a conex√£o √© constru√≠da e quem usa o banco de dados.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora vamos ver quais ferramentas podem ser usadas para proteger conex√µes:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Use solu√ß√µes de classe de firewall de banco de dados. </font><font style="vertical-align: inherit;">Uma camada adicional de prote√ß√£o, pelo menos, aumentar√° a transpar√™ncia do que est√° acontecendo no DBMS, no m√°ximo - voc√™ pode fornecer prote√ß√£o adicional aos dados.</font></font></li>
<li>  .     ,    .    ‚Äî      -,    ,   .    ,  ,      .<br>
<br>
       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a>,    MS SQL Vulnerability Assessmen   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a>.&nbsp;</li>
<li>    .   ,   ,       ,         , ,    .      .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configure o SSL, se voc√™ n√£o tiver uma separa√ß√£o de rede do DBMS dos usu√°rios finais, ele n√£o estar√° em uma VLAN separada. </font><font style="vertical-align: inherit;">Nesses casos, √© necess√°rio proteger o canal entre o consumidor e o pr√≥prio DBMS. </font><font style="vertical-align: inherit;">As ferramentas de prote√ß√£o est√£o entre o c√≥digo aberto.</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como isso afetar√° o desempenho do DBMS?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vejamos um exemplo do PostgreSQL, como o SSL afeta a carga da CPU, aumentando os tempos e diminuindo o TPS, se houver muitos recursos, se voc√™ o habilitar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Carregamos o PostgreSQL usando o pgbench - √© um programa simples para executar testes de desempenho. </font><font style="vertical-align: inherit;">Ele executa repetidamente uma sequ√™ncia de comandos, possivelmente em sess√µes paralelas de banco de dados, e calcula a velocidade m√©dia da transa√ß√£o. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teste 1 sem SSL e usando SSL</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - uma conex√£o √© estabelecida com cada transa√ß√£o:</font></font><br>
<br>
<pre><code class="plaintext hljs">pgbench.exe --connect -c 10 -t 5000 "host=192.168.220.129 dbname=taskdb user=postgres sslmode=require&nbsp;<font></font>
sslrootcert=rootCA.crt sslcert=client.crt sslkey=client.key"</code></pre><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vs</font></font></strong><br>
<br>
<pre><code class="plaintext hljs">pgbench.exe --connect -c 10 -t 5000 "host=192.168.220.129 dbname=taskdb user=postgres"</code></pre><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teste 2 sem SSL e usando SSL</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - todas as transa√ß√µes s√£o executadas em uma conex√£o:</font></font><br>
<br>
<pre><code class="plaintext hljs">pgbench.exe -c 10 -t 5000 "host=192.168.220.129 dbname=taskdb user=postgres sslmode=require<font></font>
sslrootcert=rootCA.crt sslcert=client.crt sslkey=client.key"</code></pre><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vs</font></font></strong><br>
<br>
<pre><code class="plaintext hljs">pgbench.exe -c 10 -t 5000 "host=192.168.220.129 dbname=taskdb user=postgres"</code></pre><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outras configura√ß√µes</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="plaintext hljs">scaling factor: 1<font></font>
query mode: simple<font></font>
number of clients: 10<font></font>
number of threads: 1<font></font>
number of transactions per client: 5000<font></font>
number of transactions actually processed: 50000/50000</code></pre><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resultados do teste</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td>&nbsp;</td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SEM SSL</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSL</font></font></strong></td>
</tr>
<tr>
<td colspan="3"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A conex√£o √© estabelecida em cada transa√ß√£o</font></font></strong></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√©dia de lat√™ncia</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">171.915 ms</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">187.695 ms</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tps, incluindo conex√µes que estabelecem</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">58.168112</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">53.278062</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tps excluindo conex√µes que estabelecem</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">64.084546</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">58.725846</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">28%</font></font></td>
</tr>
<tr>
<td colspan="3"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todas as transa√ß√µes s√£o realizadas em uma conex√£o.</font></font></strong></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√©dia de lat√™ncia</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6,722 ms</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.342 ms</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tps incluindo conex√µes que estabelecem</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1587.657278</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1576.792883</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tps excluindo conex√µes que estabelecem</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1588.380574</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1577.694766</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21%</font></font></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em cargas leves, o efeito do SSL √© compar√°vel ao erro de medi√ß√£o. Se a quantidade de dados transferidos for muito grande, a situa√ß√£o poder√° ser diferente. Se estabelecermos uma conex√£o para cada transa√ß√£o (isso √© raro, geralmente a conex√£o √© compartilhada entre usu√°rios), voc√™ tem um grande n√∫mero de conex√µes / desconex√µes, o efeito pode ser um pouco mais. Ou seja, pode haver riscos para a degrada√ß√£o do desempenho, no entanto, a diferen√ßa n√£o √© t√£o grande que n√£o use prote√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Observe que h√° uma grande diferen√ßa ao comparar os modos de opera√ß√£o: na mesma sess√£o, voc√™ trabalha ou √© diferente. Isso √© compreens√≠vel: os recursos s√£o gastos na cria√ß√£o de cada conex√£o.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tivemos um caso quando conectamos o Zabbix no modo de confian√ßa, ou seja, n√£o verificamos o md5, n√£o havia necessidade de autentica√ß√£o. Em seguida, o cliente pediu para ativar o modo de autentica√ß√£o md5. Isso deu uma grande carga na CPU, o desempenho diminuiu. Eles come√ßaram a procurar maneiras de otimizar. Uma das solu√ß√µes poss√≠veis para o problema √© implementar uma restri√ß√£o de rede, criar VLANs separadas para o DBMS, adicionar configura√ß√µes para que fique claro quem est√° se conectando de onde e remover a autentica√ß√£o.Voc√™ tamb√©m pode otimizar as configura√ß√µes de autentica√ß√£o para reduzir os custos de habilitar a autentica√ß√£o, mas em geral, usando v√°rios m√©todos a autentica√ß√£o afeta o desempenho e exige que esses fatores sejam considerados ao projetar o poder de computa√ß√£o dos servidores (hardware) para um DBMS.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Conclus√£o: em v√°rias solu√ß√µes, at√© pequenas nuances de autentica√ß√£o podem afetar muito o projeto e √© ruim quando fica claro apenas quando implementado em um produto.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Auditoria de a√ß√µes</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma auditoria pode ser n√£o apenas um DBMS. </font><font style="vertical-align: inherit;">Auditoria √© o recebimento de informa√ß√µes sobre o que est√° acontecendo em diferentes segmentos. </font><font style="vertical-align: inherit;">Pode ser um firewall de banco de dados e o sistema operacional no qual o DBMS √© constru√≠do. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nos DBMSs comerciais de n√≠vel empresarial com auditoria, tudo est√° bem, em c√≥digo aberto - nem sempre. </font><font style="vertical-align: inherit;">Aqui est√° o que o PostgreSQL possui:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">log padr√£o - log embutido;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extensions: pgaudit - se voc√™ n√£o tiver um registro padr√£o suficiente, poder√° usar configura√ß√µes separadas que resolvam alguns dos problemas.</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al√©m do relat√≥rio no v√≠deo:</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
‚ÄúO registro b√°sico de operadores pode ser fornecido com o recurso de registro padr√£o com log_statement = all. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso √© aceit√°vel para monitoramento e outros usos, mas n√£o fornece o n√≠vel de detalhe normalmente necess√°rio para uma auditoria. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o basta ter uma lista de todas as opera√ß√µes executadas com o banco de dados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tamb√©m deve ser poss√≠vel encontrar declara√ß√µes espec√≠ficas que sejam do interesse do auditor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A ferramenta de registro padr√£o mostra o que o usu√°rio solicitou, enquanto o pgAudit se concentra nos detalhes do que aconteceu quando o banco de dados fez a solicita√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, o auditor pode querer garantir que uma tabela espec√≠fica tenha sido criada em uma janela de manuten√ß√£o documentada.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pode parecer uma tarefa simples para auditoria b√°sica e grep, mas e se voc√™ encontrar algo parecido com este exemplo (intencionalmente confuso): </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DO $$ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
BEGIN </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 EXECUTE 'CREATE TABLE import' || 'ant_table (id INT)'; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
END $$; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O log padr√£o fornece o seguinte: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LOG: instru√ß√£o: DO $$ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
BEGIN </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 EXECUTE 'CREATE TABLE import' || 'ant_table (id INT)'; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
END $$; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parece que a procura de uma tabela de interesse pode exigir algum conhecimento de c√≥digo nos casos em que as tabelas s√£o criadas dinamicamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso n√£o √© o ideal, pois seria prefer√≠vel pesquisar apenas pelo nome da tabela. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â aqui que o pgAudit ser√° √∫til. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para a mesma entrada, ela produzir√° esta sa√≠da no log:</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AUDITORIA: SESS√ÉO, 33.1, FUNCTION, DO ,,, ‚ÄúDO $$ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
COME√áA A </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 EXECUTAR 'CREATE TABLE import' || </font><font style="vertical-align: inherit;">'ant_table (id INT)'; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
END $$; " </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AUDIT: SESSION, 33,2, DDL, CREATE TABLE, TABLE, public.important_table, CREATE TABLE important_table (id INT) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o apenas o bloco DO est√° registrado, mas tamb√©m o texto completo CREATE TABLE com o tipo de operador, tipo de objeto e nome completo, facilitando a pesquisa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
na conduta da revista de operadores SELECT e DML pgAudit pode ser configurada para registrar uma entrada separada para cada relacionamento, que √© referenciado na instru√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o √© necess√°rio analisar para localizar todas as instru√ß√µes relacionadas a uma tabela espec√≠fica ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) " .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como isso afetar√° o desempenho do DBMS?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos executar os testes com a auditoria completa ativada e ver o que acontece com o desempenho do PostgreSQL. </font><font style="vertical-align: inherit;">Ativamos o log m√°ximo do banco de dados em todos os aspectos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quase n√£o mudamos nada no arquivo de configura√ß√£o, desde o importante - ative o modo debug5 para obter o m√°ximo de informa√ß√µes. </font></font><br>
<br>
<font color="red"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">postgresql.conf</font></font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">log_destination = 'stderr' </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
logging_collector = on </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
log_truncate_on_rotation = on </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
log_rotation_age = 1d </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
log_rotation_size = 10MB </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
log_min_messages = </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debug5</font></font></strong><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
log_min_error_statement = </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debug5</font></font></strong><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
log_min_duration_statement = 0 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
debug_print_parse =</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debug_print_rewritten = em </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
debug_print_plan = em </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
debug_pretty_print = em </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
log_checkpoints = em </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
log_connections = em </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
log_disconnections = em </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
log_duration = em </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
log_hostname = em </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
log_lock_waits = em </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
log_replication_commands = em </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
log_temp_files = 0 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
log_timezone =</font></font></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No DBMS do PostgreSQL com os par√¢metros 1 CPU, 2,8 GHz, 2 GB de RAM, 40 GB de disco r√≠gido, realizamos tr√™s testes de carga usando os seguintes comandos:</font></font><br>
<br>
<pre><code class="plaintext hljs">$ pgbench -p 3389 -U postgres -i -s 150 benchmark<font></font>
$ pgbench -p 3389 -U postgres -c 50 -j 2 -P 60 -T 600 benchmark<font></font>
$ pgbench -p 3389 -U postgres -c 150 -j 2 -P 60 -T 600 benchmark</code></pre><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resultado dos testes:</font></font></strong><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sem registro</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Com registro</font></font></strong></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tempo total de preenchimento do banco de dados</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">43,74 seg</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">53,23 seg</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RAM</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">40%</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">72%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">91%</font></font></td>
</tr>
<tr>
<td colspan="3"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teste 1 (50 conex√µes)</font></font></strong></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√∫mero de transa√ß√µes em 10 minutos</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">74169</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32445</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transa√ß√£o / s</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">123</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">54</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Atraso m√©dio</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">405 ms</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">925 ms</font></font></td>
</tr>
<tr>
<td colspan="3"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teste 2 (150 conex√µes a 100 poss√≠veis)</font></font></strong></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√∫mero de transa√ß√µes em 10 minutos</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">81727</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">31429</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transa√ß√£o / s</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">136</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">52</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Atraso m√©dio</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">550 ms</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1432 ms</font></font></td>
</tr>
<tr>
<td colspan="3"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sobre tamanhos</font></font></strong></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tamanho do banco de dados</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2251 MB</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2262 MB</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tamanho do log do banco de dados</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 Mb</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4587 Mb</font></font></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Conclus√£o: uma auditoria completa n√£o √© muito boa. </font><font style="vertical-align: inherit;">Os dados da auditoria sair√£o em volume, como os dados no pr√≥prio banco de dados, ou at√© mais. </font><font style="vertical-align: inherit;">A quantidade de log que √© gerada ao trabalhar com o DBMS √© um problema comum no produto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Examinamos outros par√¢metros:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A velocidade n√£o muda muito: sem registro - 43,74 segundos, com registro - 53,23 seg.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O desempenho na RAM e na CPU diminuir√°, pois voc√™ precisar√° criar um arquivo com a auditoria. </font><font style="vertical-align: inherit;">Tamb√©m √© percept√≠vel no produtivo.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com um aumento no n√∫mero de conex√µes, √© claro, o desempenho se deteriorar√° levemente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nas empresas com auditoria, √© ainda mais dif√≠cil:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h√° muitos dados;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a auditoria √© necess√°ria n√£o apenas por meio do syslog no SIEM, mas tamb√©m dos arquivos: de repente algo acontece com o syslog, o arquivo no qual os dados s√£o salvos deve estar pr√≥ximo ao banco de dados;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a auditoria requer uma prateleira separada, para n√£o afundar nos discos de E / S, pois ocupa muito espa√ßo;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">acontece que os funcion√°rios de SI precisam de GOSTs em todos os lugares, eles exigem identifica√ß√£o de convidados.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Restri√ß√£o de acesso a dados</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vejamos as tecnologias usadas para proteger os dados e acess√°-los no DBMS comercial e no c√≥digo aberto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que pode ser usado como um todo:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Criptografia e ofusca√ß√£o de procedimentos e fun√ß√µes (quebra autom√°tica) - ou seja, ferramentas e utilit√°rios separados que tornam o c√≥digo ileg√≠vel do c√≥digo leg√≠vel. </font><font style="vertical-align: inherit;">√â verdade que n√£o pode ser alterado nem refatorado. </font><font style="vertical-align: inherit;">Essa abordagem √†s vezes √© necess√°ria pelo menos no lado do DBMS - a l√≥gica das restri√ß√µes de licenciamento ou a l√≥gica de autoriza√ß√£o √© criptografada precisamente no n√≠vel do procedimento e da fun√ß√£o.</font></font></li>
<li>     (RLS) ‚Äî       ,      ,   - -     .</li>
<li>   (Masking) ‚Äî          ,   ,    -    .  ,        .</li>
<li>  Security DBA/Application DBA/DBA ‚Äî , ,      ,        database-  application-.  open source   ,     .  ,        .</li>
<li>       .   ,    ,         .</li>
<li>     ‚Äî    .</li>
<li>End-to-end encryption   ‚Äî  client-side       .</li>
<li> . ,   ‚Äî    ,     .</li>
</ol><br>
<h3>     ?</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vejamos um exemplo de criptografia de coluna no PostgreSQL. </font><font style="vertical-align: inherit;">Existe um m√≥dulo pgcrypto, que permite armazenar campos selecionados em formato criptografado. </font><font style="vertical-align: inherit;">Isso √© √∫til quando apenas alguns dados s√£o valiosos. </font><font style="vertical-align: inherit;">Para ler os campos criptografados, o cliente passa a chave de descriptografia, o servidor descriptografa os dados e os emite para o cliente. </font><font style="vertical-align: inherit;">Sem uma chave com seus dados, ningu√©m pode fazer nada. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos testar com pgcrypto</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Crie uma tabela com dados criptografados e dados regulares. </font><font style="vertical-align: inherit;">Abaixo est√° o comando para criar tabelas; na primeira linha, um comando √∫til est√° criando a pr√≥pria extens√£o com o registro do DBMS:</font></font><br>
<br>
<pre><code class="plaintext hljs">CREATE EXTENSION pgcrypto;<font></font>
CREATE TABLE t1 (id integer, text1 text, text2 text);<font></font>
CREATE TABLE t2 (id integer, text1 bytea, text2 bytea);<font></font>
INSERT INTO t1 (id, text1, text2)<font></font>
VALUES (generate_series(1,10000000), generate_series(1,10000000)::text, generate_series(1,10000000)::text);<font></font>
INSERT INTO t2 (id, text1, text2) VALUES (<font></font>
generate_series(1,10000000),<font></font>
encrypt(cast(generate_series(1,10000000) AS text)::bytea, 'key'::bytea, 'bf'),<font></font>
encrypt(cast(generate_series(1,10000000) AS text)::bytea, 'key'::bytea, 'bf'));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, tentaremos fazer amostragem de dados de cada tabela e examinar os tempos de execu√ß√£o. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sele√ß√£o da tabela sem fun√ß√£o de criptografia</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="plaintext hljs">psql -c "\timing" -c "select * from t1 limit 1000;" "host=192.168.220.129 dbname=taskdb<font></font>
user=postgres sslmode=disable" &gt; 1.txt</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O cron√¥metro est√° ativado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&nbsp;&nbsp;id | </font><font style="vertical-align: inherit;">texto1 | </font><font style="vertical-align: inherit;">text2 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
------ + ------- + ------- </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 1 | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">1 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 2 </font><font style="vertical-align: inherit;">2 </font><font style="vertical-align: inherit;">2 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 3 | </font><font style="vertical-align: inherit;">3 </font><font style="vertical-align: inherit;">3 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
997 | </font><font style="vertical-align: inherit;">997 </font><font style="vertical-align: inherit;">997 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
998 </font><font style="vertical-align: inherit;">998 </font><font style="vertical-align: inherit;">998.999 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">999 </font><font style="vertical-align: inherit;">999 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1000 | </font><font style="vertical-align: inherit;">1000 </font><font style="vertical-align: inherit;">1000 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(1000 linhas) </font></font><br>
<br>
<font color="red"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tempo: 1.386 ms </font></font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amostragem de uma tabela com fun√ß√£o de criptografia:</font></font></strong><br>
<br>
<pre><code class="plaintext hljs">psql -c "\timing" -c "select id, decrypt(text1, 'key'::bytea, 'bf'),<font></font>
decrypt(text2, 'key'::bytea, 'bf') from t2 limit 1000;"<font></font>
"host=192.168.220.129 dbname=taskdb user=postgres sslmode=disable" &gt; 2.txt</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O cron√¥metro est√° ativado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&nbsp;&nbsp;id | </font><font style="vertical-align: inherit;">descriptografar | </font><font style="vertical-align: inherit;">descriptografar </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
----- + -------------- + ------------ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 1 | </font><font style="vertical-align: inherit;">\ x31 | </font><font style="vertical-align: inherit;">\ x31 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 2 | </font><font style="vertical-align: inherit;">\ x32 | </font><font style="vertical-align: inherit;">\ x32 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 3 | </font><font style="vertical-align: inherit;">\ x33 | </font><font style="vertical-align: inherit;">\ x33 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
999 | </font><font style="vertical-align: inherit;">\ x393939 | </font><font style="vertical-align: inherit;">\ x393939 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1000 | </font><font style="vertical-align: inherit;">\ x31303030 | </font><font style="vertical-align: inherit;">\ x31303030 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(1000 linhas) </font></font><br>
<br>
<font color="red"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tempo: 50,203 ms </font></font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resultados do teste</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td>&nbsp;</td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sem criptografia</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pgcrypto (descriptografar)</font></font></strong></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Busca de 1000 linhas</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.386 ms</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50.203 ms</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quinze%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">35%</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RAM</font></font></td>
<td>&nbsp;</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ 5%</font></font></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A criptografia tem um grande impacto no desempenho. </font><font style="vertical-align: inherit;">Pode-se observar que o tempo aumentou, pois as opera√ß√µes de descriptografar dados criptografados (e a descriptografia geralmente ainda est√£o encapsuladas em sua l√≥gica) requerem recursos significativos. </font><font style="vertical-align: inherit;">Ou seja, a id√©ia de criptografar todas as colunas que cont√™m algum tipo de dados √© repleta de desempenho reduzido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, a criptografia n√£o √© uma bala de prata que resolve todos os problemas. </font><font style="vertical-align: inherit;">Os dados descriptografados e a chave de descriptografia no processo de descriptografia e transfer√™ncia de dados est√£o localizados no servidor. </font><font style="vertical-align: inherit;">Portanto, as chaves podem ser interceptadas por quem tem acesso total ao servidor de banco de dados, por exemplo, um administrador do sistema.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando a coluna inteira para todos os usu√°rios tem uma chave (mesmo que n√£o seja para todos, mas para um conjunto limitado de clientes), isso nem sempre √© bom e correto. </font><font style="vertical-align: inherit;">√â por isso que eles come√ßaram a criptografar de ponta a ponta; no DBMS, come√ßaram a considerar op√ß√µes para criptografar dados do cliente e do servidor, os mesmos reposit√≥rios de cofre de chaves que apareceram - produtos separados que fornecem gerenciamento de chaves no DBMS.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a97/d2d/cb2/a97d2dcb29c95253ff37b99f2bf1be40.png"></div><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um exemplo dessa criptografia no MongoDB</font></font></i></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recursos de seguran√ßa em DBMS comercial e de c√≥digo aberto</font></font></h2><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fun√ß√µes</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um tipo</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pol√≠tica de senha</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Auditar</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protegendo o c√≥digo-fonte para procedimentos e fun√ß√µes</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RLS</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Criptografia</font></font></strong></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Or√°culo</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comercial</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Msql</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comercial</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+</font></font></td>
</tr>
<tr>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jatob√°</font></font></strong></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comercial</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extens√µes</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PostgreSQL</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Livre</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extens√µes</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extens√µes</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extens√µes</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mongodb</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Livre</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dispon√≠vel apenas no MongoDB Enterprise</font></font></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A tabela est√° longe de estar completa, mas a situa√ß√£o √© a seguinte: em produtos comerciais, os problemas de seguran√ßa foram resolvidos por um longo tempo, em c√≥digo aberto, como regra, alguns complementos s√£o usados ‚Äã‚Äãpara seguran√ßa, muitas fun√ß√µes n√£o s√£o suficientes, √†s vezes voc√™ precisa adicionar algo. Por exemplo, pol√≠ticas de senha - no PostgreSQL existem muitas extens√µes diferentes ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) que implementam pol√≠ticas de senha, mas, na minha opini√£o, nenhuma cobre todas as necessidades do segmento corporativo dom√©stico. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que fazer se n√£o for necess√°rio em lugar algum</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ? Por exemplo, quero usar um DBMS espec√≠fico, no qual n√£o h√° fun√ß√µes que o cliente exija.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, voc√™ pode usar solu√ß√µes de terceiros que funcionam com diferentes DBMSs, por exemplo, ‚ÄúCrypto DB‚Äù ou ‚ÄúGarda DB‚Äù. Se estamos falando de solu√ß√µes do segmento dom√©stico, eles sabem melhor sobre GOSTs do que em c√≥digo aberto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A segunda op√ß√£o √© escrever o que voc√™ precisa, implementar acesso e criptografia de dados no aplicativo no n√≠vel do procedimento. √â verdade que, com o GOST, ser√° mais dif√≠cil. Mas, em geral - voc√™ pode ocultar os dados conforme necess√°rio, coloc√°-los no DBMS, obt√™-los e descriptograf√°-los como deveriam, diretamente no n√≠vel do aplicativo. Ao mesmo tempo, pense imediatamente em como voc√™ proteger√° esses algoritmos no aplicativo. Em nossa opini√£o, isso deve ser feito no n√≠vel do DBMS, porque funcionar√° mais rapidamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa palestra foi feita pela primeira vez no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@Databases Meetup</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pelo Mail.ru Cloud Solutions. Assista ao </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://www.youtube.com/redirect%3Fq%3D"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v√≠deo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">outras apari√ß√µes e inscreva-se nos an√∫ncios de eventos do Telegram </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Around Kubernetes no Mail.ru Group</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que mais se pode ler sobre o t√≥pico</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais do que Ceph: MCS Block Cloud Storage</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como escolher um banco de dados para o projeto, para n√£o selecionar novamente</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ol></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt500696/index.html">Como os t√™nis est√£o tentando se adaptar ao p√© feminino</a></li>
<li><a href="../pt500698/index.html">Evgeny Katyshev: ‚ÄúO OpenStreetMap n√£o √© adequado para nenhuma informa√ß√£o‚Äù</a></li>
<li><a href="../pt500700/index.html">Suporte para TLS1.3 e expans√£o de sua conta pessoal: o que foi feito no primeiro trimestre de 2020</a></li>
<li><a href="../pt500704/index.html">Unic√≥rnios (Airbnb, Uber, Lyft, Careem) demitem milhares de funcion√°rios em meio a problemas durante a pandemia de coronav√≠rus</a></li>
<li><a href="../pt500706/index.html">Atualizando o MySQL (Percona Server) de 5,7 para 8,0</a></li>
<li><a href="../pt500712/index.html">Coronav√≠rus digital - uma combina√ß√£o de ransomware e infostealer</a></li>
<li><a href="../pt500718/index.html">EPAM no modo remoto: como funciona</a></li>
<li><a href="../pt500720/index.html">Novos padr√µes de seguran√ßa da informa√ß√£o: dificultam a vida dos invasores</a></li>
<li><a href="../pt500722/index.html">‚ÄúAsse at√© ficar pronto‚Äù: quem salva grava√ß√µes raras de uma maneira t√£o incomum</a></li>
<li><a href="../pt500724/index.html">Como as autoridades financeiras dos EUA limitam o impacto negativo do jogo no decl√≠nio</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>