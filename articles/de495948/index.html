<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏽‍🏭 ㊗️ 🚔 Rost eingebettet. Entwicklung für Cortex-M3-Prozessoren mit der Debug-Karte STM32F103C8T6 (Black Pill) 👩‍👩‍👧‍👧 👩🏼‍🤝‍👨🏻 🚿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo! Ich möchte Ihnen das Rust Embedded- Projekt vorstellen . Damit können wir die Programmiersprache Rust für die Entwicklung eingebetteter Plattfo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Rost eingebettet. Entwicklung für Cortex-M3-Prozessoren mit der Debug-Karte STM32F103C8T6 (Black Pill)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495948/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hallo! </font><font style="vertical-align: inherit;">Ich möchte Ihnen das </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rust Embedded-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Projekt vorstellen </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Damit können wir die Programmiersprache Rust für die Entwicklung eingebetteter Plattformen (Embedded Linux / RTOS / Bare Metal) verwenden. </font></font><br>
<img src="https://habrastorage.org/webt/sh/5h/se/sh5hsergasrx_filqfoqh-yrbyu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Artikel werden die Komponenten betrachtet, die erforderlich sind, um mit der Entwicklung von Cortex-M3-Mikroprozessoren zu beginnen. </font><font style="vertical-align: inherit;">Danach schreiben wir ein einfaches Beispiel - das Blinken der eingebauten LED.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dazu benötigen wir ein erschwingliches und billiges chinesisches Debug-Board STM32F103C8T6 oder Black Pill (aufgrund der schwarzen Farbe und der geringen Größe). </font><font style="vertical-align: inherit;">Es gibt auch eine Version des Boards in blau - Blue Pill. </font><font style="vertical-align: inherit;">Ich empfehle es nicht, da ich gehört habe, dass es den falschen Widerstand hat, was Probleme bei der Verwendung des USB-Anschlusses verursacht. </font><font style="vertical-align: inherit;">Sein zweiter Unterschied zu Black Pill in der Anordnung der Stifte (Schlussfolgerungen). </font><font style="vertical-align: inherit;">Aber dazu später mehr. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir benötigen auch einen Programmierer für STM32-Debug-Boards. </font><font style="vertical-align: inherit;">In diesem Artikel verwenden wir den billigen und erschwinglichen chinesischen ST-Link V2-Programmierer.</font></font><br>
<img src="https://habrastorage.org/webt/cb/rg/eu/cbrgeuyxins21rilbd3ayspihrg.jpeg"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rust Compiler Version</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um zu beginnen, müssen Sie sicherstellen, dass Ihre Compilerversion 1.31 oder neuer ist. </font><font style="vertical-align: inherit;">Sie können Ihre Compilerversion überprüfen, indem Sie den folgenden Befehl eingeben:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; rustc --version</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Komponenteninstallation</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt können wir mit der Installation der erforderlichen Komponenten beginnen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GNU Arm Embedded Toolchain</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir brauchen einen Debugger für ARM-Chips - arm-none-eabi-gdb. </font><font style="vertical-align: inherit;">Starten Sie das Installationsprogramm und befolgen Sie die Anweisungen. </font><font style="vertical-align: inherit;">Stellen Sie am Ende der Installation sicher, dass die Option " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pfad zur Umgebungsvariablen hinzufügen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font><font style="vertical-align: inherit;">aktiviert ist </font><font style="vertical-align: inherit;">. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Download-Link</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nach der Installation können Sie überprüfen, ob alles in Ordnung ist, indem Sie in der Befehlszeile Folgendes eingeben:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; arm-none-eabi-gdb -v</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn alles in Ordnung ist, sehen Sie die Version der installierten Komponente.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ST-Link-Treiber</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fahren wir mit der Installation des Treibers für den ST-Link-Programmierer fort. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Befolgen Sie die Anweisungen des Installationsprogramms und stellen Sie sicher, dass Sie die richtige </font><font style="vertical-align: inherit;">Version des Treibers </font><font style="vertical-align: inherit;">( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">64-Bit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oder </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32-Bit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font><font style="vertical-align: inherit;">installieren </font><font style="vertical-align: inherit;">, abhängig von der Bittiefe Ihres Betriebssystems. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link zum Download</font></font></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ST-Link-Tools</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der nächste Schritt ist die Installation der für die Firmware erforderlichen Tools - ST-Link Tools. </font><font style="vertical-align: inherit;">Laden Sie das Archiv herunter und entpacken Sie es an einen beliebigen Ort. Außerdem müssen Sie den Pfad zum Unterordner </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bin</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stlink-1.3.0 \ bin</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) in der Umgebungsvariablen " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PATH</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font><font style="vertical-align: inherit;">angeben </font><font style="vertical-align: inherit;">. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link zum Download</font></font></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fracht-Binutils</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Installieren Sie abschließend das Paket Cargo-Binutils. Dies erfolgt über zwei Befehle in der Konsole.</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; cargo install cargo-binutils<font></font>
&gt; rustup component add llvm-tools-preview</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Damit ist die Installation der Komponenten abgeschlossen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Projekt erstellen und einrichten</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um fortzufahren, müssen wir ein neues Projekt mit dem Namen " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stm32f103c8t6</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font><b><font style="vertical-align: inherit;">erstellen</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ich möchte Sie daran erinnern, dass dies durch den Befehl erfolgt:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; cargo new stm32f103c8t6</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Projektabhängigkeiten und Optimierung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verbinden Sie die erforderlichen Bibliotheken in der Datei </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cargo.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="json hljs">[package]<font></font>
name = <span class="hljs-string">"stm32f103c8t6"</span>
version = <span class="hljs-string">"0.1.0"</span>
authors = [<span class="hljs-string">"Nick"</span>]<font></font>
edition = <span class="hljs-string">"2018"</span><font></font>
<font></font>
#      Cortex-M3<font></font>
[dependencies]<font></font>
cortex-m = <span class="hljs-string">"*"</span>
cortex-m-rt = <span class="hljs-string">"*"</span>
cortex-m-semihosting = <span class="hljs-string">"*"</span>
panic-halt = <span class="hljs-string">"*"</span>
nb = <span class="hljs-string">"0.1.2"</span>
embedded-hal = <span class="hljs-string">"0.2.3"</span><font></font>
<font></font>
#       stm32f1<font></font>
[dependencies.stm32f1xx-hal]<font></font>
version = <span class="hljs-string">"0.5.2"</span>
features = [<span class="hljs-string">"stm32f100"</span>, <span class="hljs-string">"rt"</span>]<font></font>
<font></font>
#   `cargo fix`!<font></font>
[[bin]]<font></font>
name = <span class="hljs-string">"stm32f103c8t6"</span>
test = <span class="hljs-literal">false</span>
bench = <span class="hljs-literal">false</span><font></font>
<font></font>
#   <font></font>
[profile.release]<font></font>
codegen-units = <span class="hljs-number">1</span> #  <font></font>
debug = <span class="hljs-literal">true</span> #  ,     Flash <font></font>
lto = <span class="hljs-literal">true</span> #  </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie können auch sehen, dass am Ende der Datei die Codeoptimierung aktiviert wurde. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für die cortex-m-rt-Bibliothek müssen wir eine Datei im Stammverzeichnis des Projekts </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erstellen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Sie muss " </font><i><font style="vertical-align: inherit;">memory.x</font></i><font style="vertical-align: inherit;"> " </font><i><font style="vertical-align: inherit;">heißen</font></i><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Es zeigt an, wie viel Speicher unser Gerät hat und welche Adresse:</font></font><br>
<br>
<pre><code class="json hljs">MEMORY<font></font>
{<font></font>
 FLASH : ORIGIN = <span class="hljs-number">0x08000000</span>, LENGTH = 64K<font></font>
 RAM : ORIGIN = <span class="hljs-number">0x20000000</span>, LENGTH = 20K<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Festlegen der Zielplattform und der Standardkompilierungsziele</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Zielplattform für den Compiler muss festgelegt werden. Dies erfolgt über den folgenden Befehl:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; rustup target add thumbv7m-none-eabi</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erstellen Sie anschließend den Ordner " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.cargo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " im Stammverzeichnis und die Datei " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">config</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font><font style="vertical-align: inherit;">darin </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Inhalt der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konfigurationsdatei</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="json hljs">[target.thumbv7m-none-eabi]<font></font>
<font></font>
[target.'cfg(all(target_arch = <span class="hljs-string">"arm"</span>, target_os = <span class="hljs-string">"none"</span>))']<font></font>
<font></font>
rustflags = [<span class="hljs-string">"-C"</span>, <span class="hljs-string">"link-arg=-Tlink.x"</span>]<font></font>
<font></font>
[build]<font></font>
target = <span class="hljs-string">"thumbv7m-none-eabi"</span>  # Cortex-M3</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Darin haben wir das Standard-Kompilierungsziel identifiziert. Dadurch können wir unseren Code </font><font style="vertical-align: inherit;">mit einem einfachen und vertrauten Befehl </font><font style="vertical-align: inherit;">in eine ARM </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.elf-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Datei </font><font style="vertical-align: inherit;">kompilieren </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; cargo build --release</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiel</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Betrachten Sie das einfachste Beispiel, um sicherzustellen, dass es funktioniert - das Blinken einer LED. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Inhalt der Datei </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main.rs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="rust hljs"><span class="hljs-meta">#![deny(unsafe_code)]</span>
<span class="hljs-meta">#![no_std]</span>
<span class="hljs-meta">#![no_main]</span><font></font>
<font></font>
<span class="hljs-keyword">use</span> panic_halt <span class="hljs-keyword">as</span> _;<font></font>
<font></font>
<span class="hljs-keyword">use</span> nb::block;<font></font>
<font></font>
<span class="hljs-keyword">use</span> stm32f1xx_hal::{<font></font>
    prelude::*,<font></font>
    pac,<font></font>
    timer::Timer,<font></font>
};<font></font>
<span class="hljs-keyword">use</span> cortex_m_rt::entry;
<span class="hljs-keyword">use</span> embedded_hal::digital::v2::OutputPin;<font></font>
<font></font>
<span class="hljs-comment">//   .</span>
<span class="hljs-meta">#[entry]</span>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() -&gt; ! {<font></font>
    <font></font>
    <span class="hljs-comment">//     </span>
    <span class="hljs-keyword">let</span> cp = cortex_m::Peripherals::take().unwrap();
    <span class="hljs-keyword">let</span> dp = pac::Peripherals::take().unwrap();
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> flash = dp.FLASH.constrain();
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> rcc = dp.RCC.constrain();<font></font>
<font></font>
    <span class="hljs-keyword">let</span> clocks = rcc.cfgr.freeze(&amp;<span class="hljs-keyword">mut</span> flash.acr);
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> gpiob = dp.GPIOB.split(&amp;<span class="hljs-keyword">mut</span> rcc.apb2);<font></font>
<font></font>
    <span class="hljs-comment">//   b12   .</span>
    <span class="hljs-comment">//  "crh"      .</span>
    <span class="hljs-comment">//   0-7,    "crl".</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> led = gpiob.pb12.into_push_pull_output(&amp;<span class="hljs-keyword">mut</span> gpiob.crh);
    <span class="hljs-comment">//        .</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> timer = Timer::syst(cp.SYST, &amp;clocks)<font></font>
    .start_count_down(<span class="hljs-number">1</span>.hz());<font></font>
<font></font>
    <span class="hljs-comment">//     </span>
    <span class="hljs-comment">//    .</span>
    <span class="hljs-keyword">loop</span> {<font></font>
        block!(timer.wait()).unwrap();<font></font>
        led.set_high().unwrap();<font></font>
        block!(timer.wait()).unwrap();<font></font>
        led.set_low().unwrap();<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der ersten Zeile </font></font><code>#![deny(unsafe_code)]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entfernen wir </font><font style="vertical-align: inherit;">mit dem Attribut </font><font style="vertical-align: inherit;">- die Möglichkeit, unsicheren Code zu verwenden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der zweiten Zeile haben wir das Attribut platziert </font></font><code>#![no_std]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, es ist erforderlich, da wir eine Anwendung für Bare Iron erstellen und die Standardbibliothek ein Betriebssystem benötigt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als nächstes folgt ein Attribut </font></font><code>#![no_main]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, das dem Compiler mitteilt, dass wir die Standardstandardfunktion mit dem Argumentvektor und dem Rückgabetyp nicht verwenden. Dies ist nicht sinnvoll, da wir kein Betriebssystem oder keine andere Laufzeit haben, die die Funktion aufruft und den Rückgabewert verarbeitet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach den Attributen fügen wir die erforderlichen Module in den Bereich ein. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Darauf folgt eine Funktion, in unserem Fall aus Gewohnheit, die wir sie nannten -</font></font><code>main()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Dies ist der Einstiegspunkt in das Programm, er wird durch das Attribut bestimmt </font></font><code>#[entry]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Innerhalb der Hauptfunktion erstellen wir ein Handle für ein Peripherieobjekt, das alle Peripheriegeräte „besitzt“. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Danach können wir den Pin, der für die in die Platine eingebaute LED verantwortlich ist, auf den Ausgang setzen. Da es sich in meinem Fall um eine </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Black Pill-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Karte handelt </font><font style="vertical-align: inherit;">, ist die LED darin mit Pin </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B12 verbunden</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Wenn Sie eine </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blue Pill-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Karte haben </font><font style="vertical-align: inherit;">, ist Pin </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C13</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> für die eingebaute LED verantwortlich </font><font style="vertical-align: inherit;">. Daher setzen wir Pin </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B12</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> als Push-Pull-Ausgang und weisen ihn einer Variablen zu </font></font><code>led</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt können wir die Auslösezeit für das Aktualisierungsereignis für den Systemzeitgeber festlegen und in einer Variablen speichern</font></font><code>timer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In unserem Beispiel beträgt diese Zeit eine Sekunde. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dann können wir in einer Endlosschleife die Logik unseres Programms beschreiben. </font><font style="vertical-align: inherit;">Es ist sehr einfach, zunächst </font></font><code>timer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">die Ausführung des Programms zu blockieren, bis die darin angegebene Zeit abgelaufen ist. </font><font style="vertical-align: inherit;">Der nächste Schritt besteht darin, den Pin der eingebauten LED auf </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">High zu setzen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , damit sie aufleuchtet. </font><font style="vertical-align: inherit;">Danach wird die Programmausführung erneut für eine Sekunde von demselben Timer blockiert. </font><font style="vertical-align: inherit;">Und der Pin der LED ist auf </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">niedrig gesetzt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , daher geht er aus. </font><font style="vertical-align: inherit;">Ferner wird das Programm zyklisch wiederholt.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zusammenstellung</font></font></h2><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nachdem</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
wir den Programmcode und die Logik herausgefunden haben, können wir ihn </font><font style="vertical-align: inherit;">mit dem folgenden Befehl </font><font style="vertical-align: inherit;">in eine </font><i><font style="vertical-align: inherit;">.elf-</font></i><font style="vertical-align: inherit;"> Datei </font><font style="vertical-align: inherit;">kompilieren </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; cargo build --release</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieses Format enthält nicht nur Binärcode, sondern auch einige Header und mehr. </font><font style="vertical-align: inherit;">Dies ist nützlich, wenn die Datei von einer anderen Software wie dem Betriebssystem oder dem Bootloader gestartet wird. </font><i><font style="vertical-align: inherit;">Um</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
das Programm auf Bare Metal </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auszuführen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">benötigen wir jedoch keine </font><i><font style="vertical-align: inherit;">.elf-</font></i><font style="vertical-align: inherit;"> Datei </font><font style="vertical-align: inherit;">, sondern eine </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.bin-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Datei </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Eine </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.bin-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Datei </font><font style="vertical-align: inherit;">ist ein Software-Image, das byteweise in den Speicher des Mikrocontrollers geschrieben werden kann. </font><font style="vertical-align: inherit;">Die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.elf-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Datei </font><font style="vertical-align: inherit;">kann </font><font style="vertical-align: inherit;">mit dem folgenden Befehl </font><font style="vertical-align: inherit;">in eine </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.bin-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Datei konvertiert werden </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; cargo objcopy --bin stm32f103c8t6 --target thumbv7m-none-eabi --release -- -O binary stm32f103c8t6.bin</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt ist unsere Binärdatei bereit für die Firmware.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verbindung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden die Karte mit dem ST-Link V2-Programmierer flashen. Dazu müssen Sie es zuerst an die Karte anschließen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf dem Programmiergehäuse befindet sich eine Stiftanordnung des Steckers. Sie müssen auf die Aussparung im Anschluss achten. Sie wird auch im Diagramm angezeigt, damit Sie verstehen, wie die Verbindung hergestellt wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verbinden Sie die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3,3 V-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GND-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pins des Programmiergeräts mit den entsprechenden Pins auf der Platine. Ping- </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SWDIO-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Verbindung zum Pin </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des DIO</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und Pin- </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SWCLK</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zum Pin </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des CLK</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem wir die Karte an den Programmierer angeschlossen haben, können wir den ST-Link an den Computer anschließen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beachtung!</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trennen Sie vor dem Anschließen alle anderen Stromquellen von der Karte, falls vorhanden, da dies sonst die Karte oder den Computer beschädigen kann. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt können wir die Verbindung überprüfen:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; st-info --descr</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der Konsole sollte die Zeile " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F1 Gerät mittlerer Dichte</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font><b><font style="vertical-align: inherit;">angezeigt werden</font></b><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Firmware</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Optional können Sie vor dem Flashen den Speicher der Karte löschen, wenn etwas darauf geschrieben ist:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; st-flash erase</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Endlich können wir die Firmware starten: </font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; st-flash write stm32f1.bin 0x8000000</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn alles richtig gemacht wurde, sollte eine blinkende LED angezeigt werden. </font><font style="vertical-align: inherit;">Herzliche Glückwünsche!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Karte zu flashen, müssen Sie diesen Befehlssatz verwenden, der nacheinander eingegeben wird:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; cargo build --release<font></font>
&gt; cargo objcopy --bin stm32f103c8t6 --target thumbv7m-none-eabi --release -- -O binary stm32f103c8t6.bin<font></font>
&gt; st-flash erase<font></font>
&gt; st-flash write stm32f1.bin 0x8000000</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um unser Leben zu vereinfachen, können wir </font><font style="vertical-align: inherit;">mit diesen Befehlen </font><font style="vertical-align: inherit;">eine </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.bat-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Datei </font><font style="vertical-align: inherit;">erstellen </font><font style="vertical-align: inherit;">und von der Konsole aus ausführen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vom Autor</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie an diesen Anleitungen interessiert sind, begrüßen Sie auf meinem </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">YouTube-Kanal</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Außerdem habe ich kürzlich einen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telegrammkanal</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gestartet </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">,</font></a><font style="vertical-align: inherit;"> in dem ich verschiedene Übersetzungen von Handbüchern und Büchern, Nachrichten, Humor und anderen Dingen im Zusammenhang mit der Programmiersprache Rust veröffentliche. </font><font style="vertical-align: inherit;">Dort finden Sie Links zu mehreren Chatrooms, um Ihre Fragen zu stellen und Hilfe zu erhalten, Ihre Projekte einzureichen oder einfach mit Gleichgesinnten zu chatten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vielen Dank für Ihre Aufmerksamkeit!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de495934/index.html">DataGovernance zu Hause</a></li>
<li><a href="../de495938/index.html">Eine Auswahl von Artikeln zum maschinellen Lernen: Fälle, Leitfäden und Studien für März 2020</a></li>
<li><a href="../de495942/index.html">Sparen Sie Zeit, Nerven und Arbeitsstunden</a></li>
<li><a href="../de495944/index.html">Aktualisiert TOP50 (Bewertung von CIS-Supercomputern): Dynamik und Trends</a></li>
<li><a href="../de495946/index.html">Norbert Wiener: der abgelenkte Vater der Kybernetik</a></li>
<li><a href="../de495954/index.html">Wie arbeitet Cisco seit 20 Jahren im Fernzugriffsmodus und ohne Perimeter?</a></li>
<li><a href="../de495956/index.html">Muss schnell los. Optimieren von IMAP-E-Mail-Inhaltsanforderungen</a></li>
<li><a href="../de495960/index.html">Nur AH-ny Wi-Fi. Oder wie wir ein Wi-Fi 6 (AX) -Netzwerk in einer Bildungseinrichtung aufgebaut haben</a></li>
<li><a href="../de495962/index.html">Udalenka: Wie sie in X5 vorhatten, auf ein entferntes Arbeitsformat umzusteigen</a></li>
<li><a href="../de495966/index.html">Absurder Code oder "wie man nicht schreibt"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>