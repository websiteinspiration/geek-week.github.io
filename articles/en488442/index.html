<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìé üë®üèº‚Äçüî¨ üíáüèΩ Modern code for making HTTP requests in Swift 5 using Combine and using them in SwiftUI. Part 1 üå≠ üëµüèø üõçÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Querying HTTPis one of the most important skills you need to get when developing iOSapplications. In earlier versions Swift(up to version 5), regardle...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Modern code for making HTTP requests in Swift 5 using Combine and using them in SwiftUI. Part 1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488442/"><img src="https://habrastorage.org/webt/uk/tq/y4/uktqy4xvl1cqefjbmvzdzydqj-g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Querying </font></font><code>HTTP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is one of the most important skills you need to get when developing </font></font><code>iOS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">applications. In earlier versions </font></font><code>Swift</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(up to version 5), regardless of whether you generated these requests ‚Äúfrom scratch‚Äù or using the well-known </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alamofire</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> framework </font><font style="vertical-align: inherit;">, you ended up with complex and confusing </font></font><code>callback </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">type&nbsp; </font><font style="vertical-align: inherit;">code </font></font><code>completionHandler: @escaping(Result&lt;T, APIError&gt;) -&gt; Void</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The appearance in </font></font><code>Swift 5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the new framework of the functional reactive programming </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in conjunction with the existing </font></font><code>URLSession</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and </font></font><code>Codable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">provides you with all the tools necessary for independent writing very compact code to fetch data from the Internet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this article, in accordance with the concept, </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we will create ‚Äúpublishers‚Äù</font></font><code>Publisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to select data from the Internet, which we can easily ‚Äúsubscribe to‚Äù in the future and use when designing </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">both with&nbsp; </font></font><code>UIKit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and with help&nbsp; </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As&nbsp; </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">it looks more concise and more effectively, because the action of "publishers"&nbsp; </font></font><code>Publisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is not limited to just sample data, and extends further up to the user interface control ( </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). The fact is that </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data separation is&nbsp; </font></font><code>View </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">carried out using </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classes with </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">properties, the changes of which are&nbsp; </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AUTOMATICALLY monitored and completely redrawn </font></font><code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In these&nbsp; </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classes, you can very simply put a certain business logic of the application, if some of these</font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;properties are the result of synchronous and / or asynchronous transformation other </font></font><code>@Published </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;properties which can be directly changed such "active" elements of the user interface ( </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) as text boxes </font></font><code>TextField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Picker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Stepper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Toggle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">etc.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To make it clear what is at stake, I will give specific examples. Now many services such as </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &nbsp;and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hacker News</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> offer </font><font style="vertical-align: inherit;">news aggregators to&nbsp; </font><font style="vertical-align: inherit;">offer users to choose different sets of articles depending on what interests them. In the case of the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> news&nbsp; </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">aggregator,</font></a><font style="vertical-align: inherit;"> it can be the latest news, or news in some category - ‚Äúsport‚Äù, ‚Äúhealth‚Äù, ‚Äúscience‚Äù, ‚Äútechnology‚Äù, ‚Äúbusiness‚Äù, or news from a specific information source ‚ÄúCNN‚Äù , ABC news, Bloomberg, etc. The user usually ‚Äúexpresses‚Äù his desires for services in the form </font></font><code>Endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that form the necessary one for him </font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, using the framework&nbsp; </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, you can</font></font><code>ObservableObject </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classes using a very compact code (in most cases no more than 10-12 lines) once to form a synchronous and / or asynchronous dependence of the list of articles on&nbsp; </font></font><code>Endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the form of a "subscription" of "passive" </font></font><code>@Published </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">properties to "active" </font></font><code>@Published </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">properties. This ‚Äúsubscription‚Äù will be valid throughout the entire ‚Äúlife cycle‚Äù of the </font></font><code>ObservableObject </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">class </font><font style="vertical-align: inherit;">instance&nbsp; </font><font style="vertical-align: inherit;">. And then in </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;you will give the user the opportunity to manage only the ‚Äúactive‚Äù </font></font><code>@Published </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">properties in the form </font></font><code>Endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, that is, WHAT he wants to see: whether it will be articles with the latest news or articles in the ‚Äúhealth‚Äù section. The appearance of the articles themselves with the latest news or articles in the "health" section on yours </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;will be provided AUTOMATICALLY by these&nbsp; </font></font><code>ObservableObject </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classes and their "passive" @Published properties. In code</font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;you will never need to explicitly request a selection of articles, because </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classes that play a role are </font><font style="vertical-align: inherit;">responsible for their correct and synchronous display on the screen&nbsp; </font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I'll show you how this works with&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &nbsp;and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hacker News</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TMDb</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> movie </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">database</font></a><font style="vertical-align: inherit;"> in a series of articles. In all three cases, approximately the same use pattern will operate&nbsp; </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, because in applications of this kind you always have to create LISTS of films or articles, choose the ‚ÄúPICTURES‚Äù (images) that accompany them, SEARCH the databases for the needed films or articles using the search bar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When accessing such services, errors may occur, for example, due to the fact that you specified the wrong key </font></font><code>API-key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or exceeded the allowable number of requests or something else. You need to handle this kind of error, otherwise you run the risk of leaving the user completely at a loss with a blank screen. Therefore, you need to be able to not only select </font></font><code>&nbsp;Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;data from the Internet </font><font style="vertical-align: inherit;">using </font><font style="vertical-align: inherit;">, but also report errors that may occur during sampling, and control their appearance on the screen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äôll</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> start developing our strategy by developing an application that interacts with the </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">NewsAPI.org</font></a><font style="vertical-align: inherit;"> news&nbsp; </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">aggregator</font></a><font style="vertical-align: inherit;"> . I must say that in this application it </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will be used to a minimum extent without any frills and solely in order to show how </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with its "publishers"</font></font><code>Publisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and "subscription" are </font></font><code>Subscription</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">affected </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is recommended that you register on the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> website </font><font style="vertical-align: inherit;">and receive the key </font></font><code>API</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that is required to complete any requests to the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> service </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">You must place it in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.swift</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">in the structure </font></font><code>APIConstants</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The application code for this article is on </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">NewsAPI.org</font></a><font style="vertical-align: inherit;"> Service Data Model and API</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"></font></a></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> service&nbsp; </font><font style="vertical-align: inherit;">allows </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">you</font></a><font style="vertical-align: inherit;"> to select information about current news articles </font></font><code> [Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and their sources&nbsp; </font></font><code>[Source]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Our data model will be very simple, it is located in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Articles.swift</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file&nbsp; </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">import</span> Foundation<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">NewsResponse</span>: <span class="hljs-title">Codable</span> </span>{
    <span class="hljs-keyword">let</span> status: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> totalResults: <span class="hljs-type">Int?</span>
    <span class="hljs-keyword">let</span> articles: [<span class="hljs-type">Article</span>]<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Article</span>: <span class="hljs-title">Codable</span>, <span class="hljs-title">Identifiable</span> </span>{
    <span class="hljs-keyword">let</span> id = <span class="hljs-type">UUID</span>()
    <span class="hljs-keyword">let</span> title: <span class="hljs-type">String</span>
    <span class="hljs-keyword">let</span> description: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> author: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> urlToImage: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> publishedAt: <span class="hljs-type">Date?</span>
    <span class="hljs-keyword">let</span> source: <span class="hljs-type">Source</span><font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SourcesResponse</span>: <span class="hljs-title">Codable</span> </span>{
    <span class="hljs-keyword">let</span> status: <span class="hljs-type">String</span>
    <span class="hljs-keyword">let</span> sources: [<span class="hljs-type">Source</span>]<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Source</span>: <span class="hljs-title">Codable</span>,<span class="hljs-title">Identifiable</span> </span>{
    <span class="hljs-keyword">let</span> id: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> name: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> description: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> country: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> category: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> url: <span class="hljs-type">String?</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The article </font></font><code>Article</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will contain the identifier </font></font><code>id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, title </font></font><code> title</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, description </font></font><code>&nbsp;description</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, author </font></font><code>author</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, URL of the ‚Äúimage‚Äù </font></font><code>urlToImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, date of publication </font></font><code>publishedAt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and source of publication </font></font><code>source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Above the articles </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is an add </font></font><code>NewsResponse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-in in which we will be interested only in the property </font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which is an array of articles. The root structure </font></font><code>NewsResponse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and structure </font></font><code>&nbsp;Article</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">are </font></font><code>Codable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which will allow us to literally two lines of code decoding the </font></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data into the Model. The structure&nbsp; </font></font><code>Article</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;should also be </font></font><code>Identifiable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, if we want to make it easier for ourselves to display an array of articles </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as a list&nbsp; </font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;in </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Protocol </font></font><code>Identifiable </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requires the presence of a property</font></font><code>id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">which we will provide with an artificial unique identifier </font></font><code>UUID()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The information source&nbsp; </font></font><code>Source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will contain an identifier </font></font><code> id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, name </font></font><code> name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, description&nbsp; </font></font><code>description</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, country </font></font><code> country</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, publication source category </font></font><code>category</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, site URL </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Above the information sources&nbsp; </font></font><code>[Source] </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">there is an add&nbsp; </font></font><code>SourcesResponse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-in in which we will be interested only in a property </font></font><code>sources</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which is an array of information sources. The root structure </font></font><code>SourcesResponse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and structure&nbsp; </font></font><code>Source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">are </font></font><code>Codable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which will allow us to very easily decode the </font></font><code> JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data into a model. The structure&nbsp; </font></font><code>Source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;should also be </font></font><code>Identifiable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, if we want to facilitate the display of an array of information sources </font></font><code>&nbsp;[Source]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the form of a list </font></font><code>&nbsp;List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;in</font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">The protocol </font></font><code>Identifiable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requires the presence of the property </font></font><code>id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that we already have, so no additional effort will be required from us. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now consider what we need&nbsp; </font></font><code>API</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> service&nbsp; </font><font style="vertical-align: inherit;">and place it in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.swift</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file&nbsp; </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">The central part of ours </font></font><code>API</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;is a class </font></font><code>NewsAPI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that presents two methods for selecting data from the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> news&nbsp;&nbsp; </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">aggregator</font></a><font style="vertical-align: inherit;"> - articles&nbsp; </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and information sources </font></font><code>&nbsp;[Source]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<ul>
<li><code>fetchArticles (from endpoint: Endpoint) -&gt; AnyPublisher&lt;[Article], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp; - selection of articles&nbsp; </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">based on the parameter </font></font><code>endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><code>fetchSources (for country: String)&nbsp;-&gt; AnyPublisher&lt;[Source], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- A selection of sources of information </font></font><code>[Source]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for a particular country </font></font><code> country</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
These methods return not just an array of articles&nbsp; </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;or an array of information sources </font></font><code>&nbsp;[Source]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, but the corresponding "publishers" of the&nbsp; </font></font><code>Publisher </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">new framework </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Both publishers do not return any error - </font></font><code>Never</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and if a sampling or coding error still occurred, then an empty array of articles </font></font><code>[Article]()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;or information sources is&nbsp; </font><font style="vertical-align: inherit;">returned&nbsp; </font></font><code>[Source]()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">without any message why these arrays were empty.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Which articles or sources of information we want to select from the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> server </font><font style="vertical-align: inherit;">, we will indicate using the enumeration</font></font><code>enum Endpoint:</code><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">Endpoint</span> </span>{
    <span class="hljs-keyword">case</span> topHeadLines
    <span class="hljs-keyword">case</span> articlesFromCategory(<span class="hljs-number">_</span> category: <span class="hljs-type">String</span>)
    <span class="hljs-keyword">case</span> articlesFromSource(<span class="hljs-number">_</span> source: <span class="hljs-type">String</span>)
    <span class="hljs-keyword">case</span> search (searchFilter: <span class="hljs-type">String</span>)
    <span class="hljs-keyword">case</span> sources (country: <span class="hljs-type">String</span>)<font></font>
    <font></font>
    <span class="hljs-keyword">var</span> baseURL:<span class="hljs-type">URL</span> {<span class="hljs-type">URL</span>(string: <span class="hljs-string">"https://newsapi.org/v2/"</span>)!}<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">path</span><span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">String</span> {
        <span class="hljs-keyword">switch</span> <span class="hljs-keyword">self</span> {
        <span class="hljs-keyword">case</span> .topHeadLines, .articlesFromCategory:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"top-headlines"</span>
        <span class="hljs-keyword">case</span> .search,.articlesFromSource:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"everything"</span>
        <span class="hljs-keyword">case</span> .sources:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"sources"</span><font></font>
        }<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the latest news&nbsp; </font></font><code>.topHeadLines</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">news of a certain category (sports, healthy, science, business, technology)&nbsp; </font></font><code>.articlesFromCategory(_ category: String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">news from a specific source of information (CNN, ABC News, Fox News, etc.) </font></font><code>&nbsp;.articlesFromSource(_ source: String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">any news&nbsp; </font></font><code>.search (searchFilter: String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that meets a certain condition </font></font><code>searchFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sources of information </font></font><code>.sources (country:String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for a particular country </font></font><code>country</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To facilitate the initialization of the option we need, we will add an </font></font><code>Endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">initializer </font></font><code>init?</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to the </font><font style="vertical-align: inherit;">enumeration </font><font style="vertical-align: inherit;">for various lists of articles and information sources depending on the index </font></font><code>index&nbsp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and line </font></font><code> text</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which has different meanings for different enumeration options:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">init</span>? (index: <span class="hljs-type">Int</span>, text: <span class="hljs-type">String</span> = <span class="hljs-string">"sports"</span>) {
        <span class="hljs-keyword">switch</span> index {
        <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>: <span class="hljs-keyword">self</span> = .topHeadLines
        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <span class="hljs-keyword">self</span> = .search(searchFilter: text)
        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>: <span class="hljs-keyword">self</span> = .articlesFromCategory(text)
        <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>: <span class="hljs-keyword">self</span> = .articlesFromSource(text)
        <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>: <span class="hljs-keyword">self</span> = .sources (country: text)
        <span class="hljs-keyword">default</span>: <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><font></font>
        }<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's go back to the class </font></font><code> NewsAPI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;and consider in more detail the first method&nbsp; </font></font><code>fetchArticles (from endpoint: Endpoint)-&gt; AnyPublisher&lt;[Article], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which selects articles </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">based on the parameter </font></font><code>endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and does not return any error - </font></font><code>Never</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fetchArticles</span><span class="hljs-params">(from endpoint: Endpoint)</span></span> -&gt; <span class="hljs-type">AnyPublisher</span>&lt;[<span class="hljs-type">Article</span>], <span class="hljs-type">Never</span>&gt; {
        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> url = endpoint.absoluteURL <span class="hljs-keyword">else</span> {              <span class="hljs-comment">// 0</span>
                    <span class="hljs-keyword">return</span> <span class="hljs-type">Just</span>([<span class="hljs-type">Article</span>]()).eraseToAnyPublisher()<font></font>
        }<font></font>
           <span class="hljs-keyword">return</span>
            <span class="hljs-type">URLSession</span>.shared.dataTaskPublisher(<span class="hljs-keyword">for</span>:url)        <span class="hljs-comment">// 1</span>
            .<span class="hljs-built_in">map</span>{$<span class="hljs-number">0</span>.data}                                       <span class="hljs-comment">// 2</span>
            .decode(type: <span class="hljs-type">NewsResponse</span>.<span class="hljs-keyword">self</span>,                    <span class="hljs-comment">// 3</span>
                    decoder: <span class="hljs-type">APIConstants</span> .jsonDecoder)<font></font>
            .<span class="hljs-built_in">map</span>{$<span class="hljs-number">0</span>.articles}                                   <span class="hljs-comment">// 4</span>
            .replaceError(with: [])                             <span class="hljs-comment">// 5</span>
            .receive(on: <span class="hljs-type">RunLoop</span>.main)                          <span class="hljs-comment">// 6</span>
            .eraseToAnyPublisher()                              <span class="hljs-comment">// 7</span>
    }</code></pre><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">on the basis of the </font></font><code>endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;form </font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for the request the desired list of articles </font></font><code>endpoint.absoluteURL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, if this could not be done, then return an empty array of articles</font></font><code>[Article]()</code></li>
<li> ¬´¬ª <code>dataTaskPublisher(for:)</code>,     <code>Output </code>  <code>(data: Data, response: URLResponse)</code>, &nbsp; <code>Failure</code>&nbsp;-&nbsp;<code>URLError</code>,</li>
<li>  <code>map { }</code>       <code>(data: Data, response: URLResponse)</code>  &nbsp;<code>data</code>,&nbsp;</li>
<li> <code>JSON </code>&nbsp;<code>data</code>   ,   &nbsp;<code>NewsResponse</code>,    <code>articles:&nbsp;[Atricle]</code></li>
<li>  <code>map { }&nbsp;</code>        -&nbsp;<code>articles</code>,&nbsp;</li>
<li>  -        <code>[ ]</code>,</li>
<li>   <code>main </code>,          <code>UI</code>,</li>
<li>¬´¬ª  ¬´¬ª   <code>eraseToAnyPublisher()</code>    <code>AnyPublisher</code>.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The task of selecting information sources is assigned to the second method - </font></font><code>fetchSources (for country: String)&nbsp;-&gt; AnyPublisher&lt;[Source], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">which is an exact semantic copy of the first method, except that this time instead of articles </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we will choose information sources </font></font><code>[Source]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fetchSources</span><span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">AnyPublisher</span>&lt;[<span class="hljs-type">Source</span>], <span class="hljs-type">Never</span>&gt; {
        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> url = <span class="hljs-type">Endpoint</span>.sources.absoluteURL <span class="hljs-keyword">else</span> {      <span class="hljs-comment">// 0</span>
                       <span class="hljs-keyword">return</span> <span class="hljs-type">Just</span>([<span class="hljs-type">Source</span>]()).eraseToAnyPublisher()<font></font>
           }<font></font>
              <span class="hljs-keyword">return</span>
               <span class="hljs-type">URLSession</span>.shared.dataTaskPublisher(<span class="hljs-keyword">for</span>:url)      <span class="hljs-comment">// 1</span>
               .<span class="hljs-built_in">map</span>{$<span class="hljs-number">0</span>.data}                                     <span class="hljs-comment">// 2</span>
               .decode(type: <span class="hljs-type">SourcesResponse</span>.<span class="hljs-keyword">self</span>,               <span class="hljs-comment">// 3</span>
                       decoder: <span class="hljs-type">APIConstants</span> .jsonDecoder)<font></font>
               .<span class="hljs-built_in">map</span>{$<span class="hljs-number">0</span>.sources}                                  <span class="hljs-comment">// 4</span>
               .replaceError(with: [])                           <span class="hljs-comment">// 5</span>
               .receive(on: <span class="hljs-type">RunLoop</span>.main)                        <span class="hljs-comment">// 6</span>
               .eraseToAnyPublisher()                            <span class="hljs-comment">// 7</span>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It returns to us the ‚Äúpublisher‚Äù </font></font><code>AnyPublisher &lt;[Source], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with a value in the form of an array of information sources </font></font><code>[Source] </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and no error </font></font><code>&nbsp;Never</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;(in case of errors, an empty array of sources is returned&nbsp; </font></font><code>[ ]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will single out the common part of these two methods, arrange it as a </font></font><code>Generic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">function </font></font><code>fetch(_ url: URL) -&gt; AnyPublisher&lt;T, Error&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that returns the&nbsp; </font></font><code>Generic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äúpublisher‚Äù </font></font><code>AnyPublisher&lt;T, Error&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">based on </font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-comment">//     URL</span>
     <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fetch</span>&lt;T: Decodable&gt;<span class="hljs-params">(<span class="hljs-number">_</span> url: URL)</span></span> -&gt; <span class="hljs-type">AnyPublisher</span>&lt;<span class="hljs-type">T</span>, <span class="hljs-type">Error</span>&gt; {
                   <span class="hljs-type">URLSession</span>.shared.dataTaskPublisher(<span class="hljs-keyword">for</span>: url)             <span class="hljs-comment">// 1</span>
                    .<span class="hljs-built_in">map</span> { $<span class="hljs-number">0</span>.data}                                          <span class="hljs-comment">// 2</span>
                    .decode(type: <span class="hljs-type">T</span>.<span class="hljs-keyword">self</span>, decoder: <span class="hljs-type">APIConstants</span>.jsonDecoder) <span class="hljs-comment">// 3</span>
                    .receive(on: <span class="hljs-type">RunLoop</span>.main)                               <span class="hljs-comment">// 4</span>
                    .eraseToAnyPublisher()                                   <span class="hljs-comment">// 5</span>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This will simplify the previous two methods:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-comment">//   </span>
     <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fetchArticles</span><span class="hljs-params">(from endpoint: Endpoint)</span></span>
                                     -&gt; <span class="hljs-type">AnyPublisher</span>&lt;[<span class="hljs-type">Article</span>], <span class="hljs-type">Never</span>&gt; {
         <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> url = endpoint.absoluteURL <span class="hljs-keyword">else</span> {
                     <span class="hljs-keyword">return</span> <span class="hljs-type">Just</span>([<span class="hljs-type">Article</span>]()).eraseToAnyPublisher() <span class="hljs-comment">// 0</span><font></font>
         }<font></font>
         <span class="hljs-keyword">return</span> fetch(url)                                          <span class="hljs-comment">// 1</span>
             .<span class="hljs-built_in">map</span> { (response: <span class="hljs-type">NewsResponse</span>) -&gt; [<span class="hljs-type">Article</span>] <span class="hljs-keyword">in</span>        <span class="hljs-comment">// 2</span>
                             <span class="hljs-keyword">return</span> response.articles }<font></font>
                .replaceError(with: [<span class="hljs-type">Article</span>]())                    <span class="hljs-comment">// 3</span>
                .eraseToAnyPublisher()                              <span class="hljs-comment">// 4</span><font></font>
     }<font></font>
    <font></font>
    <span class="hljs-comment">//    </span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fetchSources</span><span class="hljs-params">(<span class="hljs-keyword">for</span> country: String)</span></span>
                                       -&gt; <span class="hljs-type">AnyPublisher</span>&lt;[<span class="hljs-type">Source</span>], <span class="hljs-type">Never</span>&gt; {
        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> url = <span class="hljs-type">Endpoint</span>.sources(country: country).absoluteURL
            <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">return</span> <span class="hljs-type">Just</span>([<span class="hljs-type">Source</span>]()).eraseToAnyPublisher() <span class="hljs-comment">// 0</span><font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> fetch(url)                                         <span class="hljs-comment">// 1</span>
            .<span class="hljs-built_in">map</span> { (response: <span class="hljs-type">SourcesResponse</span>) -&gt; [<span class="hljs-type">Source</span>] <span class="hljs-keyword">in</span>     <span class="hljs-comment">// 2</span><font></font>
                            response.sources }<font></font>
               .replaceError(with: [<span class="hljs-type">Source</span>]())                    <span class="hljs-comment">// 3</span>
               .eraseToAnyPublisher()                             <span class="hljs-comment">// 4</span>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The ‚Äúpublishers‚Äù thus obtained do not deliver anything until someone ‚Äúsubscribes‚Äù to them. </font><font style="vertical-align: inherit;">We can do this when designing </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Publishers" </font></font><code>Publisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as </font></font><code>View Model </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in </font></font><code> SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">List of articles.</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now a little about the logic of functioning </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;only abstraction of the ‚Äúexternal changes‚Äù to which they respond </font></font><code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is the ‚Äúpublishers‚Äù </font></font><code>Publisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ‚ÄúExternal changes‚Äù can be understood as a timer </font></font><code> Timer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, notification with </font></font><code>NotificationCenter </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or your Model object, which using the protocol </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">can be turned into an external single ‚Äúsource of truth‚Äù (source of truth).&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To ordinary "publishers" type </font></font><code>Timer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font></font><code>NotificationCenter</code> <code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reacts using the method </font></font><code>onReceive (_: perform:)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. An example of the use of the "publisher" </font></font><code>Timer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we will present later in the third article on the creation of an application for </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hacker News</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this article, we will focus on how to make our Model for&nbsp;</font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">external "source of truth" (source of truth). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's first look at how the </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">received "publishers" should function in a specific example of displaying various kinds of articles: </font></font><br>
<br>
<code>.topHeadLines</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- the latest news,&nbsp; </font></font><code>.articlesFromCategory(_ category: String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;- news for a specific category, </font></font><code>&nbsp;.articlesFromSource(_ source: String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;- news for a specific source of information, </font></font><code>.search (searchFilter: String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;- news selected by a certain condition. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zr/ua/uv/zruauv9msu2nulm2ksuflhtxusi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depending on which </font></font><code> Endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">user chooses, we need to update the list of articles </font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">selected from </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . To do this, we will create a very simple class </font></font><code>&nbsp;ArticlesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that implements a protocol </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;with three&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">properties:</font></font><br>
&nbsp;<br>
<img src="https://habrastorage.org/webt/ty/xj/cs/tyxjcsfctbxerl9oiyr6ljvda8c.png"><br>
<br>
<ul>
<li><code>@Published var indexEndpoint: Int</code> ‚Äî   <code>Endpoint</code> (    ¬´¬ª,        <code>View</code>),&nbsp;&nbsp;</li>
<li><code>@Published var searchString: String</code> ‚Äî  ,             &nbsp;&nbsp;(     ¬´¬ª,        <code>View</code>&nbsp;    <code>TextField</code>),</li>
<li><code>@Published var articles: [Article]</code>&nbsp;-    ( ¬´¬ª,          <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">NewsAPI.org</a>,  ¬´¬ª).</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As soon as we set&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;properties </font></font><code>indexEndpoint&nbsp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font></font><code> searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, we can begin to use them both as simple properties&nbsp; </font></font><code>indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;and&nbsp; </font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and as "publishers"&nbsp; </font></font><code>$indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and&nbsp; </font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In a class&nbsp; </font></font><code>ArticlesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, you can not only declare the properties of interest to us, but also prescribe the business logic of their interaction. For this purpose, when initializing an instance of a class&nbsp; </font></font><code>ArticlesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;in, </font></font><code>init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we can create a ‚Äúsubscription‚Äù that will act throughout the entire ‚Äúlife cycle‚Äù of the instance of the class&nbsp; </font></font><code>ArticlesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and reproduce the dependence of the list of articles </font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">on the index&nbsp; </font></font><code>indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;and the search string </font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To do this, </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we extend the chain of "publishers" </font></font><code>$indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;and </font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to output "publisher"</font></font><code>AnyPublisher&lt;[Article], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whose value is a list of articles&nbsp; </font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Then we ‚Äúsubscribe‚Äù to it using the operator </font></font><code>assign&nbsp;(to: \.articles, on: self)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and get the list of articles we need </font></font><code>articles </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as an ‚Äúoutput‚Äù&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;property that defines </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We must pull the chain NOT simply from the properties&nbsp; </font></font><code>indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, namely from the "publishers" </font></font><code> $indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">who participate in the creation </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with the help of </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and we will change them there using the user interface elements&nbsp; </font></font><code>Picker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>TextField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
How will we do this? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We already have a function in our arsenal </font></font><code>fetchArticles (from: Endpoint)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that is in the class&nbsp; </font></font><code>NewsAPI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and returns a "publisher" </font></font><code>AnyPublisher&lt;[Article], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, depending on the value</font></font><code>Endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and we can only somehow use the values ‚Äã‚Äãof the "publishers"&nbsp; </font></font><code>$indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and&nbsp; </font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to turn them into an argument to </font></font><code>endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this function.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First, combine the "publishers"&nbsp; </font></font><code>$indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;and&nbsp; </font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. To do this, the </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">operator exists </font></font><code>Publishers.CombineLatest </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ci/pg/wd/cipgwdfx2fxmlevrmkf8nnkc6u4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To create a new ‚Äúpublisher‚Äù based on the data received from the previous ‚Äúpublisher‚Äù </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;, the operator is used&nbsp; </font></font><code>flatMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ln/s7/ur/lns7urzc9l64o8mswhliuggsyp4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, we ‚Äúsubscribe‚Äù to this newly received ‚Äúpublisher‚Äù using a very simple ‚Äúsubscriber‚Äù&nbsp; </font></font><code>assign (to: \.articles, on: self)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and assign the received from ‚Äú publisher "value to the&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;array&nbsp; </font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/su/io/xi/suioxibgc3t31oewzgkbfaljina.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We just created an </font></font><code>init( )</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ASYNCHRONOUS" publisher "and" subscribed "to it, as a result of</font></font><code>AnyCancellable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúSubscription‚Äù and this is easy to verify if we keep our ‚Äúsubscription‚Äù in a constant </font></font><code>let subscription</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gw/ig/ml/gwigml-zqpprclh76lzfnjhvzda.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The main property of a </font></font><code>AnyCancellable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äúsubscription‚Äù is that as soon as it leaves its scope, the memory occupied by it is automatically freed. Therefore, as soon as it is </font></font><code>init( ) </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">completed, this ‚Äúsubscription‚Äù will be deleted </font></font><code>ARC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, without having time to assign the asynchronous information received with a time delay to the array </font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Asynchronous information simply has nowhere to "land", in its literal sense, "the earth has gone from under its feet." </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To save such a ‚Äúsubscription‚Äù, it is necessary to create a </font></font><code> init() </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">variable </font><font style="vertical-align: inherit;">BEYOND the initializer </font></font><code>var&nbsp;cancellableSet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that will save our&nbsp; </font></font><code>AnyCancellable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äúsubscription‚Äù in this variable throughout the entire ‚Äúlife cycle‚Äù of the class instance&nbsp;  </font></font><code>ArticlesViewMode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Therefore, we remove the constant </font></font><code>let subscription</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and remember our </font></font><code>AnyCancellable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äúsubscription‚Äù in the variable&nbsp; </font></font><code>cancellableSet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">using the operator </font></font><code>.store ( in: &amp;self.cancellableSet)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/my/gt/xw/mygtxwz7uhcurfyfnblva9irfku.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚ÄúSubscription‚Äù to the ASYNCHRONOUS ‚Äúpublisher‚Äù that we created in </font></font><code>init( )</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will be preserved throughout the entire ‚Äúlife cycle‚Äù of the class instance&nbsp; </font></font><code>ArticlesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We can arbitrarily change the meaning of ‚Äúpublishers‚Äù&nbsp; </font></font><code>$indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and / or&nbsp; </font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and always thanks to the created ‚Äúsubscription‚Äù we will have an array of articles corresponding to the values ‚Äã‚Äãof these two publishers&nbsp; </font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">without any additional effort. This&nbsp; </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">class is usually called&nbsp; </font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order to reduce the number of calls to the server when typing a search string </font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, we should not use the ‚Äúpublisher‚Äù of the search string itself&nbsp;</font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and its modified version </font></font><code>validString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kh/ir/2z/khir2z1rrmou-hks2rtfuq31bnm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now that we have </font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for our articles, </font><font style="vertical-align: inherit;">let's </font><font style="vertical-align: inherit;">start creating the user interface ( </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). In </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to synchronize </font></font><code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with the </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;Model, a </font></font><code>@ObservedObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">variable is </font><font style="vertical-align: inherit;">used </font><font style="vertical-align: inherit;">that refers to an instance of the class of this Model. It is this pair - the&nbsp; </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;class and the&nbsp; </font></font><code>@ObservedObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">variable that references the instance of this class - that control the change in the user interface ( </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) in&nbsp; </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We add to the structure an </font></font><code>ContentView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;instance of the class </font></font><code>ArticleViewModel </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the form of a variable </font></font><code>var articleViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and replace it </font></font><code>Text ("Hello, World!")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with a list of articles </font></font><code>ArticlesList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in which we place the articles&nbsp; </font></font><code>articlesViewModel.articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">obtained from our&nbsp;</font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. As a result, we get a list of articles for a fixed and default index&nbsp; </font></font><code>indexEndpoint = 0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, that is, for the </font></font><code>.topHeadLines</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;latest news: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/je/_f/j-/je_fj-0m2xews-ih7vptprkdpoy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Add an </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">element to </font><font style="vertical-align: inherit;">our screen&nbsp; </font><font style="vertical-align: inherit;">to control which set of articles we want to display. We will use the&nbsp; </font></font><code>Picker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">index change </font></font><code>$articlesViewModel.indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. The presence of a symbol is&nbsp; </font></font><code>$</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mandatory, as this means a change in the value supplied by the&nbsp; </font></font><code>@Published&nbsp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"publisher". The ‚Äúsubscription‚Äù to this ‚Äúpublisher‚Äù is triggered immediately, which we initiated on </font></font><code>init ()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, the ‚Äúoutput‚Äù&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äúpublisher‚Äù </font></font><code>&nbsp;articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;will change and we will see a different list of articles on the screen: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zx/sd/pp/zxsdppfkp5y0nuk-j99uhovvmu8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this way we can receive arrays of articles for all three options - ‚ÄútopHeadLines‚Äù, ‚Äúsearch "And" from category ":</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jm/yc/a_/jmyca_mvm0n2___cswvcamuuqqm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... but for a fixed and default search string </font></font><code>searchString = "sports"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(where it is required): </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zq/pi/tw/zqpitwdhh3fsnciz9p2scvn1sas.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, for the option,&nbsp; </font></font><code>"search"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;you must provide the user with a text field </font></font><code>SearchView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for entering the search string: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xk/d1/uu/xkd1uu0tmepthmsjlkzu--wlwse.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result, the user can search for any news by the typed search string: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/x4/ch/5a/x4ch5apliuwesqxjzeds58ab1t8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For the option,&nbsp; </font></font><code>"from category"&nbsp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">it is necessary to provide the user the opportunity to choose a category and we start with category </font></font><code>science</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2i/8e/3v/2i8e3vvly1r_ipfuflxwbtepglq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
as a result, the user can search for any news on the chosen category of news - </font></font><code>science</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code> health</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,&nbsp; </font></font><code>business</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>technology</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/p_/pn/li/p_pnli0chxenoalmms3ltch-iwo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
we can see how a very simple&nbsp; </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;model that has two user-controlled </font></font><code>@Published </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">features - </font></font><code>indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;and</font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- allows you to select a wide range of information from the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> website&nbsp; </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">List of sources of information</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's look at how the </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;‚Äúpublisher‚Äù of information sources received in the NewsAPI class will function </font></font><code>fetchSources (for country: String)&nbsp;-&gt; AnyPublisher&lt;[Source], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will get a list of sources of information for different countries: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hr/oh/le/hrohle3hq8pkyhnjf6frali7yao.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... and the ability to search for them by name: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kg/ea/ll/kgeallzwaxnkvekct18th7knkyo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... as well as detailed information about the selected source: its name, category, country, short description and link to the site:&nbsp; </font></font><br>
<br>
<img src="https://habrastorage.org/webt/k_/b7/9w/k_b79wirynz07feigtlhgdeyik4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you click on the link, we will go to the website of this source of information. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For all this to work, you need an extremely simple&nbsp; </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Model that has only two user-controlled </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">properties - </font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;and&nbsp; </font></font><code>country</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rs/id/4b/rsid4bb5xmkjdkwuptkmwvhi-yc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And again, we use the same scheme: when initializing an instance of a class of a </font></font><code>SourcesViewModel </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">class in</font></font><code> init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we create a ‚Äúsubscription‚Äù that will operate throughout the entire ‚Äúlife cycle‚Äù of the class instance </font></font><code>&nbsp;SourcesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and ensure that the list of information sources depends&nbsp; </font></font><code>sources</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">on the country&nbsp; </font></font><code>country</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and the search string </font></font><code>&nbsp;searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
With the help&nbsp; </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we pull the chain from the "publishers" </font></font><code>$searchString </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>$country</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to output "publisher" </font></font><code>AnyPublisher&lt;[Source], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, whose value is a list of information sources. We ‚Äúsubscribe‚Äù to it using the operator </font></font><code>assign&nbsp;(to: \.sources, on: self)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, we get the list of information sources we need&nbsp; </font></font><code>sources</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. and remember the received&nbsp; </font></font><code>AnyCancellable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"subscription" in a variable&nbsp; </font></font><code>cancellableSet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">using the operator </font></font><code>.store ( in: &amp;self.cancellableSet)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now that we have </font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for our sources of information, </font><font style="vertical-align: inherit;">let's </font><font style="vertical-align: inherit;">start creating </font></font><code> UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. B </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to sync </font></font><code> View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c</font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;The model uses a </font></font><code>@ObservedObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">variable that refers to an instance of the class of this Model. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Add the </font></font><code>ContentViewSources</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;class instance </font><font style="vertical-align: inherit;">to the structure&nbsp; </font></font><code>SourcesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the form of a variable </font></font><code>var sourcesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, remove&nbsp; </font></font><code>Text ("Hello, World!")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;and place your own </font></font><code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for each of the 3&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">properties </font></font><code>&nbsp;sourcesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;:</font></font><br>
<br>
&nbsp;<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">text box&nbsp; </font></font><code>SearchView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for the search bar&nbsp; </font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li>&nbsp;<code>Picker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;for the country </font></font><code>country</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">list of&nbsp; </font></font><code>SourcesList&nbsp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sources of information</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/td/tk/kn/tdtkknev57l3b5avb8y0uheu7fa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result, we get what we need </font></font><code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jw/gg/ly/jwgglycniqr2e-jhpifypfzx4m8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On this screen, we only manage the search string using the text field </font></font><code>SearchView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and the ‚Äúcountry‚Äù with&nbsp; </font></font><code>Picker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and the rest happens AUTOMATICALLY. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The list of sources of information </font></font><code>SourcesList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contains minimal information about each source - the name </font></font><code>source.name </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and a brief description </font></font><code>source.description</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sj/zi/1z/sjzi1zh-7leadeujwarkuka_ii8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... but allows you to get more detailed information about the selected source using the link </font></font><code>NavigationLink</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in which </font></font><code>destination</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we indicate&nbsp; </font></font><code>DetailSourceView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">which source data is the source of information&nbsp; </font></font><code>source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and the desired instance of the class </font></font><code>ArticlesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, allowing get a list of his articles </font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ix/j_/uh/ixj_uheqhclwopwidsihztunn5e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
See how elegantly we get the list of articles for the selected source of information source in the list of sources&nbsp; </font></font><code>SourcesList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Our old friend helps us - a class&nbsp; </font></font><code>ArticlesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for which we must set both ‚Äúinput‚Äù&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">properties:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">index&nbsp; </font></font><code>indexEndpoint = 3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, that is, an option&nbsp; </font></font><code>.articlesFromSource (_source:String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">corresponding to the selection of articles for a fixed source </font></font><code>source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">string&nbsp; </font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;as the source itself (or rather its identifier) </font></font><code>source.id&nbsp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/ia/xi/lr/iaxilr4rlcyippxuvkbd46kequ4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In general, if you look at the entire </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsApp</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> application </font><font style="vertical-align: inherit;">, you will not see anywhere that we explicitly request a selection of articles or information sources from the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> website&nbsp; </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">We only manage&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;data, but </font></font><code>View Model </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">does our job: selects the articles and sources of information we need.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Download image </font></font><code>UIImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for article </font></font><code>Article</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The model of the article&nbsp; </font></font><code>Article&nbsp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contains an </font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">image </font></font><code>urlToImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that </font><font style="vertical-align: inherit;">accompanies it&nbsp; </font><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/om/ny/fv/omnyfvhlcegrhltunqvjvyaq6l4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Based on this,&nbsp; </font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the future we must obtain the images themselves </font></font><code>UIImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;from the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> website&nbsp; </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We are already familiar with this task. </font><font style="vertical-align: inherit;">In the class </font></font><code>ImageLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, using the function, </font></font><code>fetchImage(for url: URL?) -&gt; AnyPublisher&lt;UIImage?, Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">create a ‚Äúpublisher‚Äù&nbsp;  </font></font><code>AnyPublisher&lt;UIImage?, Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with the image value&nbsp; </font></font><code>UIImage?</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;and no error&nbsp; </font></font><code>Never</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(in fact, if errors occur, then the image is returned </font></font><code> nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">You can ‚Äúsubscribe‚Äù to this ‚Äúpublisher‚Äù to receive images&nbsp; </font></font><code>UIImage?</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;when designing the user interface ( </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">The source data for the function </font></font><code>fetchImage(for url: URL?)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is&nbsp; </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which we have:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/do/a-/hg/doa-hg5idk0ukdghj0snu0-nubm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let us consider in detail how the formation is being carried out using the </font></font><code> Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äúpublisher‚Äù </font></font><code>AnyPublisher &lt;UIImage?, Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, if we know </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">equal </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, return </font></font><code>Just(nil)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">based on the </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">form of the "publisher" </font></font><code>dataTaskPublisher(for:)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, whose output value </font></font><code>Output</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is a tuple </font></font><code>(data: Data, response: URLResponse)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and an error </font></font><code>&nbsp;Failure</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-&nbsp; </font></font><code>URLError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we take </font><font style="vertical-align: inherit;">only data </font></font><code>map {}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from the tuple </font></font><code>(data: Data, response: URLResponse)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for further processing&nbsp; </font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and form </font></font><code>UIImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if the previous steps return error occurs </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we deliver the result to the </font></font><code>main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stream, as we assume further use in the design </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúErase‚Äù the TYPE of the ‚Äúpublisher‚Äù and return the copy </font></font><code>AnyPublisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You see that the code is quite compact and well readable, there aren't any </font></font><code>callbacks</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's start creating&nbsp; </font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;for the image </font></font><code>UIImage?</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">This is a class </font></font><code>ImageLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that implements the protocol </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, with two&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">properties:</font></font><br>
<br>
<ul>
<li><code>@Published url: URL?</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;are </font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">images</font></font></li>
<li><code>@Published var image: UIImage?</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;is the image itself from </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/li/o6/kr/lio6krhn0v1eyeiwg_cgpwcigia.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And again, when initializing an instance of the class,&nbsp; </font></font><code>ImageLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;we must stretch the chain from the input "publisher"&nbsp; </font></font><code>$url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;to the output "publisher" </font></font><code>AnyPublisher&lt;UIImage?, Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which we will </font><font style="vertical-align: inherit;">&nbsp;"subscribe" </font><font style="vertical-align: inherit;">to later and get the image we need </font></font><code>image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ba/gi/2s/bagi2swivajzz0pkgqzzsswudww.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We use the operator </font></font><code>&nbsp;flatMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and a very simple "subscriber"&nbsp; </font></font><code>assign (to: \image, on: self)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to assign it to the received from the "publisher "Values ‚Äã‚Äãto the property </font></font><code>@Published image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/eq/3k/4-/eq3k4-0pbruhk4qbcu8hmyinfmg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And again in the variable&nbsp; </font><font style="vertical-align: inherit;">" subscription "is </font></font><code>cancellableSet </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stored </font></font><code>AnyCancellable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">using the operator&nbsp; </font></font><code>store(in: &amp;self.cancellableSet)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The logic of this ‚Äúimage downloader‚Äù is that you download an image from something other than the one </font></font><code> nil URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">provided that it did not preload, that is</font></font><code>image == nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. If during the download process any error is detected, the image will be absent, that is, it </font></font><code>image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will remain equal </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we show the image with the help </font></font><code>ArticleImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that an instance of the </font></font><code>imageLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;class </font><font style="vertical-align: inherit;">uses for this </font></font><code>ImageLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. If his image image is not equal </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, then it is displayed using </font></font><code> Image (...)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, but if it is equal </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, then depending on what it is equal to </font></font><code>url </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, either nothing is shown </font></font><code>EmptyView()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, or a rectangle </font></font><code>Rectangle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with rotating text T is </font><font style="vertical-align: inherit;">displayed </font></font><code>ext("Loading...")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mh/nq/yi/mhnqyirurke0w6yibfxm86gap1i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This logic works just fine for the case when you know for sure that for&nbsp; </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, other than&nbsp; </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">you get an image </font></font><code>image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, as is the case with the movie database&nbsp;</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TMDb</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . With </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org, the</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> news aggregator&nbsp; </font><font style="vertical-align: inherit;">&nbsp; is different. The articles of some sources of information give a different one from the&nbsp; </font></font><code>nil&nbsp;URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">image, but access to it is closed, and we get a rectangle </font></font><code>Rectangle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with rotating text </font></font><code>Text("Loading...")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that will never be replaced: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sh/tq/lp/shtqlpz4wx-iobt19-wv9j2pb7w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this situation, if the </font></font><code>&nbsp;URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">image is different from&nbsp; </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, then the equality of the&nbsp; </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">image&nbsp; </font></font><code>image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">may mean that the image is loading , and the fact that an error occurred while loading and we will never get an image </font></font><code>image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. In order to distinguish between these two situations, we add </font><font style="vertical-align: inherit;">one more </font></font><code>ImageLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;to the two existing </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">properties </font><font style="vertical-align: inherit;">in the class&nbsp; </font><font style="vertical-align: inherit;">:&nbsp;</font></font><br>
<br>
<code>&nbsp;@Published var noData = false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;- this is a Boolean value with which we will denote the absence of image data due to an error during the selection: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kp/jc/sq/kpjcsqugrsfzyghmefnge0unscy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When creating a ‚Äúsubscription‚Äù, we </font></font><code> init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">catch all the errors </font></font><code> Error</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that occur when loading the image and accumulate their presence in the&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">property </font></font><code>self.noData = true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. If the download was successful, then we get the image </font></font><code>image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">
We create the </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚ÄúPublisher‚Äù&nbsp; </font></font><code>AnyPublisher&lt;UIImage?, Error&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;on the basis of the&nbsp; </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;function </font></font><code>fetchImageErr (for url: URL?)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7f/ek/jf/7fekjfrbihaieypuxaovub1-op8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We begin to create a method </font></font><code>fetchImageErr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">by initializing the ‚Äúpublisher‚Äù&nbsp; </font></font><code>Future</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which can be used to asynchronously obtain a single TYPE value </font></font><code>Result</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">using a closure. The closure has one parameter - </font></font><code>Promise</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">which is a function of TYPE&nbsp; </font></font><code>(Result&lt;Output, Failure&gt;) ‚Üí Void</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">We will turn the </font></font><br>
<br>
<img src="https://habrastorage.org/webt/iu/ch/_u/iuch_uvhdkz42-mfyuiuq3jiosg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
resulting </font></font><code>Future</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">into</font></font><code>AnyPublisher &lt;UIImage?, Error&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with the help of the ‚ÄúErase TYPE‚Äù operator </font></font><code>eraseToAnyPublisher()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, we will perform the following steps, taking into account all possible errors (we will not identify errors, it is simply important for us to know that there is an error): </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
0. check </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;and&nbsp; </font></font><code>noData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">on </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: if so, then return the error, if not, transfer </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">further by chain, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. create a "publisher" </font></font><code>dataTaskPublisher(for:)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whose input is - </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and the output value </font></font><code>Output</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is a tuple </font></font><code>(data: Data, response: URLResponse)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and an error&nbsp; </font></font><code>URLError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. analyze using the </font></font><code> tryMap { }</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;resulting tuple </font></font><code>(data: Data, response: URLResponse)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: if it </font></font><code>response.statusCode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is in the range </font></font><code>200...299</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, then for further processing we take only the data&nbsp; </font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Otherwise, we "throw out" an error (no matter what),</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. we will </font></font><code>map { }</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">convert the data </font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to </font></font><code>UIImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4. deliver the result to the </font></font><code>main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stream, since we assume that we will use it later in the design </font></font><code>UI</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ‚Äî we ‚Äúsubscribe‚Äù to the received ‚Äúpublisher‚Äù using </font></font><code>sink</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">its closures </font></font><code>receiveCompletion</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>receiveValue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - 5. if we </font></font><code>receiveCompletion</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;find an error </font><font style="vertical-align: inherit;">in the closure&nbsp; </font></font><code>error</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, we report using it </font></font><code>promise (.failure(error)))</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - 6. in the closure,&nbsp; </font></font><code>receiveValue </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we inform about the successful receipt of an array of articles using </font></font><code> promise (.success($0))</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7. we remember the received ‚Äúsubscription‚Äù in the variable&nbsp; </font></font><code>cancellableSet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to ensure its viability within the ‚Äúlifetime‚Äù of the class instance </font></font><code>ImageLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
8. we ‚Äúerase‚Äù the ‚Äúpublisher‚Äù TYPE and return the instance </font></font><code>AnyPublisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We return to </font></font><code>ArticleImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">where we will use the new&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">variable </font></font><code>noData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">If there is no image data, then we will not display anything, that is </font></font><code>EmptyView ()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3k/wr/v_/3kwrv_cecjy2f8jea3rgnnpkzri.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finally, we will pack all our possibilities of displaying data from the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> news </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">aggregator</font></a><font style="vertical-align: inherit;"> in </font></font><code>TabView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yq/xb/ra/yqxbraupq1d0tgeygy2lb05o4xo.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Display errors when fetching and decoding JSON data from the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> server&nbsp; </font><font style="vertical-align: inherit;">.</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When accessing the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> server,&nbsp; </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">errors</font></a><font style="vertical-align: inherit;"> can occur, for example, due to the fact that you specified the wrong key </font></font><code>API-key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or, having a developer‚Äôs tariff that costs nothing, exceeded the allowed number of requests or something else. At the same time, the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> server&nbsp; </font><font style="vertical-align: inherit;">&nbsp;provides you with the </font></font><code>HTTP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code and the corresponding message: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/_f/2n/zv/_f2nzv5bndlu8auo9cygjyk9fta.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is necessary to handle this kind of server error. Otherwise, the user of your application will fall into a situation when suddenly, for no reason, the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> server&nbsp; </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">will</font></a><font style="vertical-align: inherit;"> &nbsp;stop processing any requests, leaving the user completely at a loss with a blank screen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Until now, when selecting articles&nbsp; </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and sources of information&nbsp; </font></font><code>[Source]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from the </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">NewsAPI.org</font></a><font style="vertical-align: inherit;"> server&nbsp;</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;we ignored all errors, and in case of their appearance returned empty arrays </font></font><code>[Article]()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and&nbsp; </font><font style="vertical-align: inherit;">as a result&nbsp; </font></font><code>[Source]()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Getting started with error handling, let's </font></font><code>fetchArticles (from endpoint: Endpoint) -&gt; AnyPublisher&lt;[Article], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;create </font></font><code>NewsAPI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;another method </font><font style="vertical-align: inherit;">in the class </font><font style="vertical-align: inherit;">based on the existing </font><font style="vertical-align: inherit;">article selection&nbsp; </font><font style="vertical-align: inherit;">method </font></font><code>fetchArticlesErr (from endpoint: Endpoint) -&gt; AnyPublisher&lt;[Article], NewsError&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that will return not only an array of articles </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, but also a possible error&nbsp; </font></font><code>NewsError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fetchArticlesErr</span><span class="hljs-params">(from endpoint: Endpoint)</span></span> -&gt;
                            <span class="hljs-type">AnyPublisher</span>&lt;[<span class="hljs-type">Article</span>], <span class="hljs-type">NewsError</span>&gt; {<font></font>
<font></font>
. . . . . . . .<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This method, as well as the method </font></font><code>fetchArticles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, accepts </font></font><code>endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;and returns the ‚Äúpublisher‚Äù </font><font style="vertical-align: inherit;">at the input </font><font style="vertical-align: inherit;">with a value in the form of an array of articles </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, but instead of the absence of an error </font></font><code>Never</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, we may have an error defined by the enumeration </font></font><code>NewsError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/x9/es/ey/x9eseyq8jbapjkmgdoj7aggc6f0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We start creating a new method by initializing the ‚Äúpublisher‚Äù&nbsp; </font></font><code>Future</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which use to asynchronously obtain a single TYPE value </font></font><code>Result</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">using a closure. </font><font style="vertical-align: inherit;">The closure has one parameter - </font></font><code>Promise</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">which is a function of TYPE&nbsp; </font></font><code>(Result&lt;Output, Failure&gt;) -&gt; Void</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">We will turn the </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3w/bw/ct/3wbwctuso0qweiz3a8qk_h1aiom.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
received </font></font><code>Future</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">into the "publisher" we need&nbsp; </font></font><code>AnyPublisher &lt;[Article], NewsError&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">using the "TYPE Erase" operator </font></font><code>eraseToAnyPublisher()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Further in the new method, </font></font><code>fetchArticlesErr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we will repeat all the steps that we took in the method&nbsp;</font></font><code>fetchArticles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, but we will take into account all possible errors:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pb/xz/i0/pbxzi0rn5-cuandt3rtu74ofj8s.png"><br>
<br>
<ul>
<li>0.   endpoint&nbsp; <code>URL endpoint.absoluteURL </code>    , <code> url </code> <code>nil</code>:  <code>nil</code>,    <code>.urlError</code>,   ‚Äî  <code>url</code>   ,</li>
<li>1.  ¬´¬ª <code>dataTaskPublisher(for:)</code>,     ‚Äî <code>url</code>,    <code>Output</code>   <code>(data: Data, response: URLResponse)</code>  &nbsp;<code>URLError</code>,</li>
<li>2.    <code>tryMap { }</code>&nbsp;  <code>(data: Data, response: URLResponse)</code>:  <code>response.statusCode</code>    <code>200...299</code>,       &nbsp;<code>data</code>.    ¬´¬ª  <code>.responseError</code>,  &nbsp;&nbsp;<code>data</code>,    <code>String</code>,    ,</li>
<li>3. <code> JSON</code>    ,   &nbsp;<code>NewsResponse</code>,</li>
<li>4.    <code>main</code> ,         <code>UI</code></li>
<li>¬´¬ª   ¬´¬ª   <code>sink</code>    <code>receiveCompletion</code>  <code>receiveValue</code>,<br>
 <ul>
<li>5.&nbsp; &nbsp;&nbsp;<code>receiveCompletion</code>&nbsp;  <code>error</code>,       <code>promise (.failure(...)))</code>,</li>
<li> 6.&nbsp;&nbsp;&nbsp;<code>receiveValue</code>         <code>promise (.success($0.articles))</code>,</li>
</ul>&nbsp;</li>
<li>7.&nbsp;  ¬´¬ª  &nbsp;<code>var subscriptions</code>,       ¬´ ¬ª   <code>NewsAPI</code>,</li>
<li>8. ¬´¬ª  ¬´¬ª    <code>AnyPublisher</code>.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It should be noted that the "publisher"&nbsp; </font></font><code>dataTaskPublisher(for:)</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">differs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> from its prototype </font></font><code>dataTask</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in that in case of a server error when it is </font></font><code>response.statusCode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;NOT in the range </font></font><code>200...299</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, it still delivers the successful value in the form of a tuple </font></font><code>(data: Data, response: URLResponse)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and not an error in the form </font></font><code>(Error, URLResponse?)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. In this case, the real server error information is contained in </font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. The "publisher" </font></font><code>dataTaskPublisher(for:)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;delivers an error&nbsp; </font></font><code>URLError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if an error occurs on the client side (inability to contact the server, security system ban </font></font><code>ATS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, etc.). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If we want to display errors in </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, then we need the corresponding one </font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which we will call&nbsp; </font></font><code>ArticlesViewModelErr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/em/1o/qy/em1oqy5ob60o8xzmz_-kpdvzs4a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the class </font></font><code>&nbsp;ArticlesViewModelErr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that implements the protocol </font></font><code>ObservableObject </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, this time we have FOUR&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">properties:</font></font><br>
<br>
<ol>
<li><code>@Published var indexEndpoint: Int</code> ‚Äî   <code>Endpoint</code> (    ¬´¬ª,     <code> View</code>),&nbsp;</li>
<li><code>@Published var searchString: String</code> ‚Äî   ,    &nbsp;<code>Endpoint</code>:    ¬´¬ª ,       (      ¬´¬ª,        <code>View</code>),&nbsp;</li>
<li>&nbsp;<code>@Published var articles: [Article]</code>&nbsp;-    ( ¬´¬ª,        &nbsp;<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">NewsAPI.org&nbsp;</a>)</li>
<li>&nbsp;&nbsp;<code>@Published var articlesError: NewsError?</code>&nbsp;-  ,      &nbsp;    &nbsp;<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">NewsAPI.org&nbsp;</a>.</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When you initialize an instance of a class </font></font><code>ArticlesViewModelErr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, we must again extend a chain from input "publishers" </font></font><code>$indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to output "publisher"&nbsp; </font></font><code>AnyPublisher&lt;[Article],NewsError&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, to which we "signed" with the "Subscriber" </font></font><code>sink</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and we get a lot of articles </font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or error&nbsp; </font></font><code>articlesError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In our class, </font></font><code>NewsAPI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we have already constructed a function&nbsp; </font></font><code>fetchArticlesErr (from endpoint: Endpoint)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that returns a ‚Äúpublisher‚Äù&nbsp; </font></font><code>AnyPublisher&lt;[Article], NewsError&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, depending on the value </font></font><code>endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and we only need to somehow use the values ‚Äã‚Äãof the ‚Äúpublishers‚Äù&nbsp; </font></font><code>$indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and&nbsp; </font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to turn them into an argument to this function </font></font><code>endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To begin with, we will combine the "publishers"&nbsp; </font></font><code>$indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;and&nbsp; </font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. To do this, </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">there is an operator </font></font><code>Publishers.CombineLatest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5i/lz/zh/5ilzzh6h5_aity8uvzd6eladg7q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then we must set the error type TYPE "publisher" equal to the required&nbsp; </font></font><code>NewsError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/oe/85/tt/oe85tthmperdfzf6yqiy5fmy2b4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, we want to use the function&nbsp; </font></font><code>fetchArticlesErr (from endpoint: Endpoint) </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from our class </font></font><code>NewsAPI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. As usual, we will do this with the help of an operator&nbsp; </font></font><code>flatMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that creates a new ‚Äúpublisher‚Äù based on data received from the previous ‚Äúpublisher‚Äù: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bh/bu/kx/bhbukxfbhg2q9otl4rp-ksponec.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then we ‚Äúsubscribe‚Äù to this newly received ‚Äúpublisher‚Äù with the help of a ‚Äúsubscriber‚Äù </font></font><code>sink</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and use its closures </font></font><code>receiveCompletion</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>receiveValue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to receive from the ‚Äúpublisher‚Äù either the value of an array of articles&nbsp; </font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or errors </font></font><code>articlesError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cq/x8/iy/cqx8iyvnwanwmv1vselki10ytv4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Naturally, it is necessary to remember the resulting ‚Äúsubscription‚Äù in some external </font></font><code>init()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">variable </font></font><code>cancellableSet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Otherwise, we will not be able to get the value asynchronously</font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or an error </font></font><code>articlesError </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">after completion </font></font><code>init()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kh/wh/_a/khwh_ao98y7zy9cdpenc0nzvntq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order to reduce the number of calls to the server when typing a search string </font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, we should not use the ‚Äúpublisher‚Äù of the search bar itself&nbsp; </font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, but its modified version </font></font><code>validString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fl/op/ss/flopssp-pjixvbtesqabmpp1h2s.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚ÄúSubscribing‚Äù to the ASYNCHRONOUS ‚Äúpublisher‚Äù that we created in </font></font><code>init( )</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will be persist throughout the entire ‚Äúlife cycle‚Äù of the class instance&nbsp; </font></font><code>ArticlesViewModelErr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nt/iw/k4/ntiwk4eju6aneam-1wlymjqyu9a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We proceed to the correction of ours </font></font><code> UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in order to display possible data sampling errors on it. In </font></font><code>SwiftU</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I, in the existing structure, we&nbsp; </font></font><code>ContentVieArticles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &nbsp;use another, just obtained&nbsp; </font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, just adding the letters ‚ÄúErr‚Äù in the name. This is an instance of the class.&nbsp;&nbsp;</font></font><code>ArticlesViewModelErr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which ‚Äúcatches‚Äù the error of selecting and / or decoding article data from the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> server&nbsp; </font><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kw/vy/uv/kwvyuvbthb08tcalkcdpnucqfbq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And we also add the display of an emergency message&nbsp; </font></font><code>Alert</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;in case of an error. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For example, if the wrong API key is:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">APIConstants</span> </span>{
    <span class="hljs-comment">// News  API key url: https://newsapi.org</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> apiKey: <span class="hljs-type">String</span> = <span class="hljs-string">"API_KEY"</span> <font></font>
    <font></font>
   .  .  .  .  .  .  .  .  .  .  .  .  .<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... then we will get this message: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nb/ws/si/nbwssihj8ldlqqtcbti4tjwcv7o.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the limit of requests has been exhausted, then we will get this message: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cz/de/ux/czdeuxquiscc-6qklciy5a0w3jm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Returning to the method of selecting articles&nbsp; </font></font><code>[Article] </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with a possible error&nbsp; </font></font><code>NewsError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, we can simplify its code if we use a&nbsp; </font></font><code>Generic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;"publisher" </font></font><code>AnyPublisher&lt;T,NewsError&gt;,</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">which, based on the set,&nbsp; </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">receives </font></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">information </font><font style="vertical-align: inherit;">asynchronously </font><font style="vertical-align: inherit;">, places it directly in the </font></font><code>Codable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Model </font></font><code>T</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;and reports an error&nbsp; </font></font><code>NewsError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lc/v7/m9/lcv7m9fmdbq20ih5phivj7hl1go.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As we know, this code is very easy to use to obtain a specific ‚Äúpublisher‚Äù if the source data for </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is a </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">NewsAPI.org</font></a></font><code>Endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> news&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aggregator</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &nbsp;or country&nbsp;</font></font><code>country</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> information source, and the output requires various Models - for example, a list of articles or information sources:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ig/ff/4q/igff4qjqmxcxloixsshjbc36uxy.png"><br>
<br>
<img src="https://habrastorage.org/webt/bh/o_/7n/bho_7nbyxpl5yxth1ihweasjbec.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We learned how easy it is to fulfill </font></font><code>HTTP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requests with the help of </font></font><code> Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">its </font></font><code>URLSession</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äúpublisher‚Äù </font></font><code>dataTaskPublisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>Codable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. If you don‚Äôt need to track errors, you get a very simple </font></font><code> Generic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5-line code for the ‚Äúpublisher‚Äù </font></font><code>AnyPublisher&lt;T, Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which asynchronously receives </font></font><code>JSON </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">information and places it directly in the </font></font><code>Codable </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Model </font></font><code>T</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;based on the given&nbsp; </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2i/r_/6w/2ir_6wkuga1u9jcxsmqijle480e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This code is very easy to use to get a specific publisher, if the source data </font></font><code>url </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is, for example </font></font><code>Endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and the output requires various Models - for example, a set of articles or a list of sources of information. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you need to take into account errors, the code for the&nbsp; </font></font><code>Generic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"publisher" will be a little more complicated, but still it will be very simple code without any callbacks:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fi/4d/ep/fi4depxf-hbngki4p5y3ktunbny.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Using the technology of </font></font><code>HTTP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">query </font><font style="vertical-align: inherit;">execution </font><font style="vertical-align: inherit;">using </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, can you create a ‚Äúpublisher‚Äù </font></font><code>AnyPublisher&lt;UIImage?, Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that asynchronously selects data and receives an UIImage image? based on </font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Image </font></font><code>ImageLoade</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">downloaders r are cached in memory to avoid repeated asynchronous data retrieval.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All kinds of "publishers" obtained can very easily be "made to work" in ObservableObject classes, which use their @Published properties to control your UI designed using SwiftUI. These classes usually play the role of the View Model, since they have the so-called ‚Äúinput‚Äù @Published properties that correspond to the active UI elements (TextField, Stepper, Picker text boxes, Toggle radio buttons, etc.) and ‚Äúoutput‚Äù @Published properties , consisting mainly of passive UI elements (Text, Image, Image, Circle (), Rectangle (), etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This idea permeates the entire </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> news aggregator </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">application</font></a><font style="vertical-align: inherit;"> presented in this article. It turned out to be quite universal and was used when</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">developing an application for the </font></font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TMDb </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">movie </font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">database</font></a><font style="vertical-align: inherit;"> and the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hacker News</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> news aggregator&nbsp; </font><font style="vertical-align: inherit;">, which will be discussed in future articles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The application code for this article is on </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. I want to draw your attention to the fact that if you use the simulator for the application presented in this article, then know that </font></font><code>NavigationLink</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the simulator works with an error. You can use</font></font><code>NavigationLink</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">on the simulator only 1 time. </font><font style="vertical-align: inherit;">Those. </font><font style="vertical-align: inherit;">you used the link, went back, click on the same link - and nothing happens. </font><font style="vertical-align: inherit;">Until you use another link, the first will not work, but the second will become inaccessible. </font><font style="vertical-align: inherit;">But this is only observed on the simulator, on a real device everything works fine. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. Some sources of information still use </font></font><code>http</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instead </font></font><code>https</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for "pictures" of their articles. </font><font style="vertical-align: inherit;">If you definitely want to see these ‚Äúpictures‚Äù, but cannot control the source of their appearance, then you will have to configure the security system </font></font><code>ATS ( App Transport Security)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to receive these </font></font><code>http</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äúpictures‚Äù, but this, of course, is not a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">good idea</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">You can use </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">more secure options</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">References:</font></font></h4><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">    HTTP   Swift 5   Combine     SwiftUI.  1 .</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Modern Networking in Swift 5 with URLSession, Combine and Codable.</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">URLSession.DataTaskPublisher‚Äôs failure type</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Combine: Asynchronous Programming with Swift</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">¬´SwiftUI &amp; Combine:  ¬ª</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Introducing Combine ‚Äî WWDC 2019 ‚Äî Videos ‚Äî Apple Developer. session 722</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">(  722 ¬´  Combine¬ª   )</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Combine in Practice ‚Äî WWDC 2019 ‚Äî Videos ‚Äî Apple Developer. session 721</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">(  721 ¬´  Combine¬ª   )</a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en488428/index.html">How do we predict the future in Yandex search: from bug fixes to discovery queries</a></li>
<li><a href="../en488432/index.html">Snoop Project an incredible tool for Internet intelligence, which RuNet users have been waiting for so long - is available</a></li>
<li><a href="../en488436/index.html">Quickly create open-source chiptune music</a></li>
<li><a href="../en488438/index.html">The history of film audio formats: the German answer to compact cassettes - how was the fate of the development</a></li>
<li><a href="../en488440/index.html">Lords of DOOM: how two guys created a cult shooter and rocked the video game industry</a></li>
<li><a href="../en488446/index.html">Russian instrumentation: we turned your design on the fingers</a></li>
<li><a href="../en488448/index.html">Take a ride at ITMO University: our master classes, workshops, lectures and student competitions</a></li>
<li><a href="../en488450/index.html">How a new generation of online banking works</a></li>
<li><a href="../en488456/index.html">Project activities at universities and what benefits it provides</a></li>
<li><a href="../en488458/index.html">FunCode Backend Java / Kotlin Challenge: Winners Announced</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>