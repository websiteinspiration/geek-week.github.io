<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>↖️ 💜 👩🏾‍⚕️ Banners publicitários Rostelecom e como lidar com eles 👎 🤴🏿 🐈</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Muitos já sabem que a Rostelecom, com o apoio do Mail.ru, iniciou a implementação de seus banners publicitários em sites que não são protegidos pelo p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Banners publicitários Rostelecom e como lidar com eles</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/493402/"><img src="https://habrastorage.org/webt/tf/gs/ve/tfgsvevdniakse3ighqxm8mfdt4.jpeg" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muitos já sabem que a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rostelecom, com o apoio do Mail.ru, iniciou a implementação de seus banners publicitários em sites que não são protegidos pelo protocolo HTTPS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Você pode se proteger da aparência no site transferindo-o para HTTPS. </font><font style="vertical-align: inherit;">Mas e se você não tiver essa oportunidade ou consumir muito tempo para você? </font><font style="vertical-align: inherit;">Eu fiz minha pequena pesquisa e quero compartilhar uma maneira simples e eficaz de combater essa infecção.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Já havia investigações sobre esse assunto em Habré e eu confiei nelas:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Você não assiste anúncios durante o desenvolvimento? </font><font style="vertical-align: inherit;">Transtorno</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DPI: Deep Packet INJECTION, ou teoria da conspiração da conspiração entre RTK e MRG</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sabe-se que os banners são implementados substituindo o arquivo JavaScript original por um malicioso por meio de um redirecionamento. E ele já insere um banner na página do site e carrega o arquivo original. Portanto, ao verificar vírus, é impossível detectar imediatamente como a publicidade apareceu no site, porque os arquivos originais não são alterados e o redirecionamento é realizado em um determinado intervalo e é bastante difícil detectá-lo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para pesquisa, você precisa de um site que funcione via HTTP e contenha arquivos JS. Como exemplo, tomei o site do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Museu de Kirov</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Com alguma periodicidade, banners podem ser observados nele. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lh/fk/2f/lhfk2fknn2m77txskd39umbmoea.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu escrevi um </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">utilitário</font></a><font style="vertical-align: inherit;"> especial</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ela faz uma solicitação em um URL específico em intervalos regulares e compara o conteúdo recebido com o anterior. Se o conteúdo da resposta for diferente, ele será salvo para estudo. Ao analisar solicitações de um pequeno script </font></font><code>http://muzey43.ru/js/script-eye.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, verificou-se que o mesmo conteúdo sempre é retornado - não há redirecionamento. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jn/lg/1d/jnlg1dha5akq_goqg_b8m1udp5a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Então, como o banner aparece? No estudo do código fonte de um site foi descoberto outro arquivo JS que é baixado por HTTP, mas com um host diferente: </font></font><code>http://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ao analisar essa solicitação, observamos periodicamente o recebimento do conteúdo de um arquivo malicioso.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dv/ud/zn/dvudznxszrrg9y1m_snwkvbomna.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A captura de tela mostra que o conteúdo malicioso é baixado aproximadamente duas vezes por minuto, mas pode haver pequenas pausas no redirecionamento. O conteúdo do malware é alterado sempre que ofusca o código e contém um link para o script original. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Provavelmente, existe uma certa "lista branca" de hosts para os quais o redirecionamento de JS é proibido. Por exemplo, o site do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ministério da Cultura da região de Kirov</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Apesar de funcionar através do protocolo HTTP, os banners não aparecem nele. Mas no site dos Museus Kirov há um banner, embora não haja redirecionamento para seus scripts, mas através do redirecionamento de um script de outro host, um banner é incorporado nele. Para eliminar a vulnerabilidade nesse caso, provavelmente, basta solicitar o arquivo usando o protocolo HTTPS, ou seja, substitua o URL do script por</font></font><br>
<br>
<pre><code class="plaintext hljs">https://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas e se o seu site não estiver na "lista branca" e você precisar usar seus próprios scripts? Encontrei uma maneira fácil de evitar o redirecionamento de JS. É suficiente adicionar um parâmetro arbitrário ao URL do script: </font></font><code>https://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js?banner=off</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e o redirecionamento não será executado. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tt/zu/va/ttzuvamwqxv6uagryx6rljnm6k0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Provavelmente, isso é feito para que o redirecionamento não interfira na operação de sites JS dinâmicos complexos, ou os arquivos necessários sejam simplesmente identificados pela extensão </font></font><code>.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. De qualquer forma, basta adicionar parâmetros aleatórios e banners de publicidade da Rostelecom aos URLs dos scripts nas páginas do seu site. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como os comentários indicam corretamente, a solução mais apropriada para os proprietários de sites será a mudança para HTTPS, especialmente porque agora algumas empresas de hospedagem oferecem a instalação de um certificado gratuito diretamente do painel com um botão. </font><font style="vertical-align: inherit;">Afinal, amanhã o Rostelecom pode facilmente restringir o algoritmo de redirecionamento e a solução fornecida acima deixará de funcionar. </font><font style="vertical-align: inherit;">E apenas bloquear um redirecionamento por um filtro no cliente, como sugerem alguns, pode resolver o problema do cliente - não haverá banner, mas não haverá substituição do script que ele substituiu e a funcionalidade do site poderá sofrer.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt493392/index.html">Machine Learning em Kazan, ou como os especialistas em machine learning são treinados no Tartaristão</a></li>
<li><a href="../pt493394/index.html">Síndrome de Deus: a história de como o principal especialista em doenças infecciosas do coronavírus do território Stavropol se espalhou (a) *</a></li>
<li><a href="../pt493396/index.html">Resumo sobre métodos de previsão</a></li>
<li><a href="../pt493398/index.html">Traje</a></li>
<li><a href="../pt493400/index.html">Os japoneses encontraram uma maneira de marcar os neurônios nematóides</a></li>
<li><a href="../pt493404/index.html">Como encontrar um artista para desenvolver um site</a></li>
<li><a href="../pt493406/index.html">Como o subsistema de disco funciona no OpenNebula</a></li>
<li><a href="../pt493408/index.html">DJI Mavic mini helicóptero caiu como um pé de cabra</a></li>
<li><a href="../pt493412/index.html">Jogos com Wifi no ESP32</a></li>
<li><a href="../pt493416/index.html">IDA Pro e técnicas de engenharia reversa</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>