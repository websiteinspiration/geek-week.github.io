<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåï üë©üèæ‚Äçüç≥ üóΩ A la pregunta de Apophenia, Telegonia y Time Travel (y funciones con _ al principio) üì¨ üê± ‚úçüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En 1958, el neuropsic√≥logo alem√°n Klaus Konrad acu√±√≥ el t√©rmino "apofenia" (del lat√≠n apofeno: expresar el juicio, hacerlo expl√≠cito; el t√©rmino se re...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>A la pregunta de Apophenia, Telegonia y Time Travel (y funciones con _ al principio)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/505926/"><blockquote><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En 1958, el neuropsic√≥logo alem√°n Klaus Konrad acu√±√≥ el t√©rmino "apofenia" (del lat√≠n apofeno: expresar el juicio, hacerlo expl√≠cito; el t√©rmino se remonta a textos de revelaciones religiosas, donde significa conocimiento alcanzado fuera del proceso de cognici√≥n), lo que implica la propiedad de la psique, que consiste en la capacidad ver relaciones en hechos o datos sin sentido o aleatorios, y encontrar significado en coincidencias. La ilusi√≥n de una comunicaci√≥n significativa. Nuestro cerebro est√° constantemente buscando patrones, pero a menudo comete errores y existe un deseo irracional de ver patrones donde no existen. Un deseo peculiar de obedecer coincidencias y contingencias. Esto se llama apofenia. En estad√≠stica matem√°tica, este es un error est√°ndar del primer tipo. </font></font></i><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nepryakhin N. "Te estoy manipulando"</font></font></i></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øPor qu√© recuerdo este t√©rmino, especialmente en un recurso de TI? </font><font style="vertical-align: inherit;">Porque la b√∫squeda de relaciones entre hechos dispares durante la depuraci√≥n del programa es uno de los principales factores que determinan su √©xito. </font><font style="vertical-align: inherit;">Una serie de imprecisiones aleatorias en el trabajo, cada una de las cuales no muestra los motivos de su aparici√≥n y no afecta el funcionamiento del programa en su conjunto, puede parecer ca√≥tica. </font><font style="vertical-align: inherit;">Sin embargo, si intentas encontrar una relaci√≥n entre ellos, puedes resolver inmediatamente muchos problemas con una sola l√≠nea de c√≥digo ... O asegurarte de que la relaci√≥n no sea m√°s que un juego de la mente, un producto de la imaginaci√≥n del desarrollador.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cap√≠tulo 1. "Agente y coordinador"</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo comenz√≥ durante el desarrollo de un programa de agente que realiza una serie de tareas en un servidor remoto, recibiendo una lista de tareas a trav√©s de un mecanismo cliente-servidor. El agente levant√≥ el servidor en el puerto 34002, el coordinador local se conect√≥ a √©l, verificaron la autorizaci√≥n del otro y si todo sal√≠a bien, el agente realiz√≥ las acciones requeridas e inform√≥ al principio. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tr/mz/kl/trmzklssjskomt-sxqhxfdpbihq.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esquema simplificado del programa</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Un paso obvio por parte del agente fue crear su propio tenedor en el que ejecutar cualquier funci√≥n de la familia ejecutiva para reemplazar el proceso con el programa que se est√° iniciando. En este caso, el agente recibi√≥ el pedido del proceso, que permiti√≥ esperar su finalizaci√≥n o terminarlo por la fuerza. Sin embargo, todo sali√≥ bien, para que el coordinador recibiera un informe sobre el trabajo realizado, fue necesario devolver las conclusiones de stdout y stderr.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este problema se puede resolver mediante varios m√©todos: pase el proceso nuevo (dup2) FD para stdout y stderr, y luego l√©alos en el proceso padre; redirigir stderr a stdout y usar popen; anule los descriptores stdout y stderr como archivos y l√©alos cuando haya terminado. Elegimos el √∫ltimo m√©todo, ya que la lectura por el primer m√©todo requer√≠a c√≥digo adicional y sincronizaci√≥n (y si no lo lee constantemente, luego de alcanzar 2 MB, la grabaci√≥n se detendr√° cuando se agote el buffer de tuber√≠a), y en el segundo perdimos la distinci√≥n entre stdout y stderr. Por lo tanto, se eligi√≥ el m√©todo m√°s simple: cerrar stdout y stderr a un nuevo proceso, y luego abrir archivos a trav√©s de abrir donde queremos anular nuestra salida. De acuerdo con la documentaci√≥n para abrir, utiliza el √≠ndice FD m√≠nimo disponible, por lo que el c√≥digo ser√° simple y elegante:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">int</span> pid = fork();
<span class="hljs-keyword">switch</span> (pid) {
    <span class="hljs-keyword">case</span> <span class="hljs-number">-1</span> :
        <span class="hljs-keyword">return</span> BADFORK;
    <span class="hljs-keyword">case</span> <span class="hljs-number">0</span> :<font></font>
        close(<span class="hljs-built_in">stdout</span>);<font></font>
        close(<span class="hljs-built_in">stderr</span>);<font></font>
        open(fileout, O_CREAT | O_WRONLY, <span class="hljs-number">0777</span>);<font></font>
        open(fileerr, O_CREAT | O_WRONLY, <span class="hljs-number">0777</span>);<font></font>
        execve(arguments[<span class="hljs-number">0</span>], arguments, environ);
        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);
    <span class="hljs-keyword">default</span> :
        <span class="hljs-keyword">return</span> pid;<font></font>
}</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El c√≥digo simplificado se ve as√≠ (se elimin√≥ la comprobaci√≥n de errores para facilitar la lectura). </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El c√≥digo se lanz√≥, el resultado del comando se escribi√≥ correctamente en el archivo, se complet√≥ y estaba listo para trabajar en sistemas de "combate". </font><font style="vertical-align: inherit;">¬øO no? </font><font style="vertical-align: inherit;">En la etapa de prueba, apareci√≥ un peque√±o error, "demostrando" la posibilidad de viajar en el tiempo (o al menos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">telegraf√≠a</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cap√≠tulo 2. "Telegonia"</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La cuesti√≥n era esta: despu√©s de que se completara el programa, y ‚Äã‚Äãtambi√©n despu√©s de que el agente en s√≠ estuviera terminado, se encontr√≥ la siguiente l√≠nea en el archivo que deber√≠a contener la salida del programa que se est√° iniciando (al que redirigimos la salida est√°ndar del programa secundario):</font></font><br>
<br>
<pre><code class="plaintext hljs">[2020-06-05 16:58:49]      :34002</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°Espera un minuto! Pero esta es una l√≠nea de la salida del propio agente: ¬°el proceso padre que se llama fork ()! ¬°No solo eso, el agente muestra esta l√≠nea alg√∫n tiempo despu√©s de que finaliza el programa llamado! ¬øC√≥mo se puede escribir todo el resto del resultado del agente en stdout, y una de las l√≠neas puede entrar en un archivo, todo el trabajo del agente es leerlo despu√©s de que se complete waitpid? Tal vez un error al leer un archivo da una memoria maltratada?</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> _exec_readfile(struct frs_json * target, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> * filename) {<font></font>
    FILE * fp;<font></font>
    <span class="hljs-keyword">char</span> linebuff[VEN_PIPE_READ_SIZE + <span class="hljs-number">1</span>] = { <span class="hljs-number">0</span> };<font></font>
    fp = fopen(filename, <span class="hljs-string">"r"</span>);
    <span class="hljs-keyword">if</span> (!fp)<font></font>
        frs_err(<span class="hljs-string">" \"%s\"    "</span>, filename);
    <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">while</span>(fgets(linebuff, VEN_PIPE_READ_SIZE, fp))<font></font>
            frs_json_string(target, <span class="hljs-literal">NULL</span>, bxi_strtrimr(linebuff));<font></font>
    }<font></font>
    fclose(fp);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parece que no hay nada que pueda superar la memoria (frs_ * est√°n cubiertos por las pruebas). </font><font style="vertical-align: inherit;">Entonces, ¬øc√≥mo afecta esta fp a la salida del agente, que ocurre unos minutos despu√©s de que se ejecuta esta funci√≥n? </font><font style="vertical-align: inherit;">Naturalmente, alg√∫n tipo de telegraf√≠a: tocaron el archivo para leerlo, y despu√©s de 9 meses recibimos una l√≠nea del "primer socio". </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9g/pv/c7/9gpvc7fjwrn55pggacmexfxbohm.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mi FD fue tocado por una cebra</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Valgrind no encontr√≥ ning√∫n problema, lo que nos molest√≥ un poco. </font><font style="vertical-align: inherit;">Despu√©s de todo, sus analizadores omnipotentes no vieron un error de acceso a la memoria, solo pasaron mucho tiempo en vano en el an√°lisis. </font><font style="vertical-align: inherit;">¬øO no en vano? </font><font style="vertical-align: inherit;">Si no hay un error de acceso a la memoria, significa un error l√≥gico. </font><font style="vertical-align: inherit;">Pero, ¬øqu√© error l√≥gico podr√≠a conducir a tal efecto?</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cap√≠tulo 3. "Dos servidores"</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mientras tanto, se encontr√≥ un segundo error. </font><font style="vertical-align: inherit;">Durante el lanzamiento bajo la depuraci√≥n de QtCreator (lo usamos como un entorno de desarrollo, el proyecto C en s√≠) complet√≥ con √©xito todos los procesos relacionados con el programa y este error no apareci√≥. </font><font style="vertical-align: inherit;">Sin embargo, vali√≥ la pena intentar iniciar el programa directamente y luego finalizarlo (por m√©todos legales), ya que dej√≥ de comenzar por segunda vez.</font></font><br>
<br>
<pre><code class="plaintext hljs">^C[2020-06-05 16:58:46]    "Interrupt",   <font></font>
[2020-06-05 16:58:49]      :34002<font></font>
[2020-06-05 16:58:49]      :34002<font></font>
[2020-06-05 16:58:49]      :34002<font></font>
[2020-06-05 16:58:49]     <font></font>
[2020-06-05 16:58:50]      </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Era justo pensar en peque√±os gremlins que destruyen el mecanismo del programa desde adentro, rompiendo una parte del programa y luego la otra. </font><font style="vertical-align: inherit;">Pero el talento del programador sugiri√≥ que hab√≠a una relaci√≥n entre estos errores. </font><font style="vertical-align: inherit;">¬øC√∫al? </font><font style="vertical-align: inherit;">¬°Qui√©n sabe, pero por eso no es por nada! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Encontrar la causa del fallo de lanzamiento result√≥ ser f√°cil. </font><font style="vertical-align: inherit;">Fue suficiente mirar los registros del sistema del programa, en los que defin√≠a clara y claramente la raz√≥n:</font></font><br>
<br>
<pre><code class="plaintext hljs">[2020-06-06 14:40:12] frs_socket_bind  :34002   ("Address already in use" (98))<font></font>
[2020-06-06 14:40:12]      :34002<font></font>
[2020-06-06 14:40:12] ven_server_start     </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øC√≥mo ya se lanz√≥? </font><font style="vertical-align: inherit;">¬øQui√©n lanz√≥? </font><font style="vertical-align: inherit;">¬°Terminaste hace un minuto!</font></font><br>
<br>
<pre><code class="plaintext hljs">$ ps aux | grep vento<font></font>
alex     14144  0.0  0.0 156780  7212 pts/0    Sl+  14:39   0:00 ./vento</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Realmente lanzado. </font><font style="vertical-align: inherit;">¬øPero tal vez solo un accidente?</font></font><br>
<br>
<pre><code class="plaintext hljs">kill -9 14144</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y nuevamente, el programa se inicia, pero una vez que finaliza, el proceso que posee el puerto 34002 permanece:</font></font><br>
<br>
<pre><code class="plaintext hljs">$ lsof -i | grep 34002<font></font>
vento     14144 alex    3u  IPv4 12275384      0t0  TCP *:34002 (LISTEN)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øY qui√©n termina entonces? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considere la salida de lsof -i en tiempo de ejecuci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lanzamos:</font></font><br>
<br>
<pre><code class="plaintext hljs">$ lsof -i | grep 34002<font></font>
vento     151640 alex    3u  IPv4 12275384      0t0  TCP *:34002 (LISTEN)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
S√≠, un socket, un servidor </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, un Reich</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="plaintext hljs">$ lsof -i | grep 34002<font></font>
_Postman  25078 alex  104u  IPv4 12885232      0t0  TCP localhost:46154-&gt;localhost:34002 (ESTABLISHED)<font></font>
vento     27468 alex    3u  IPv4 12890254      0t0  TCP *:34002 (LISTEN)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ el cliente est√° conectado a √©l y establece alg√∫n comando ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero, ¬øqu√© es?</font></font><br>
<br>
<pre><code class="plaintext hljs">$ lsof -i | grep 34002<font></font>
_Postman  25078 alex  104u  IPv4 12885232      0t0  TCP localhost:46154-&gt;localhost:34002 (ESTABLISHED)<font></font>
vento     27468 alex    3u  IPv4 12890254      0t0  TCP *:34002 (LISTEN)<font></font>
vento     27506 alex    3u  IPv4 12890254      0t0  TCP *:34002 (LISTEN)<font></font>
vento     27506 alex    4u  IPv4 12890329      0t0  TCP localhost:34002-&gt;localhost:46154 (ESTABLISHED)</code></pre><br>
<img src="https://habrastorage.org/webt/wp/wq/62/wpwq62hwasqdflzz9bxomgjvebq.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dato curioso # 197766: tarde o temprano, una referencia a Star Wars deber√≠a aparecer ¬ø</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Dos puertos de servidor? </font><font style="vertical-align: inherit;">A pesar de que nuestro servidor no usa el indicador REUSEPORT.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cap√≠tulo 4. "CLOEXEC"</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hmm ... ¬øQuiz√°s falta el indicador CLOEXEC en la implementaci√≥n del servidor? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Echemos un vistazo m√°s de cerca a la bandera:</font></font><br>
<br>
<pre><code class="plaintext hljs">$man fork<font></font>
       *  The child process is created  with  a  single  thread‚Äîthe  one  that<font></font>
          called  fork().   The  entire virtual address space of the parent is<font></font>
          replicated in the child, including the states of mutexes,  condition<font></font>
          variables,  and other pthreads objects; the use of pthread_atfork(3)<font></font>
          may be helpful for dealing with problems that this can cause.<font></font>
<font></font>
       *  The child inherits copies of the parent's set of open file  descrip‚Äê<font></font>
          tors.   Each  file  descriptor  in the child refers to the same open<font></font>
          file description (see open(2)) as the corresponding file  descriptor<font></font>
          in  the parent.  This means that the two file descriptors share open<font></font>
          file status flags, file offset,  and  signal-driven  I/O  attributes<font></font>
          (see the description of F_SETOWN and F_SETSIG in fcntl(2)).<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Llamar a la funci√≥n fork () crear√° una copia del hilo actual del proceso y crear√° una copia de cada descriptor de proceso abierto (y dado que en sistemas UNIX [como] "todo es un archivo", los archivos de red se inclinar√°n junto con los descriptores de archivo)</font></font><br>
<br>
<pre><code class="plaintext hljs">$man exec<font></font>
       The exec() family of functions replaces the current process image with a new process image.  The functions described in<font></font>
       this manual page are front-ends for execve(2).  (See the manual page  for  execve(2)  for  further  details  about  the<font></font>
       replacement of the current process image.)</code></pre><br>
<pre><code class="plaintext hljs">$man execve<font></font>
       *  By  default,  file  descriptors  remain open across an execve().  File descriptors that are marked close-on-exec are<font></font>
          closed; see the description of FD_CLOEXEC in fcntl(2).  (If a file descriptor is closed, this will cause the release<font></font>
          of  all record locks obtained on the underlying file by this process.  See fcntl(2) for details.)  POSIX.1 says that<font></font>
          if file descriptors 0, 1, and 2 would otherwise be closed after a successful execve(), and the  process  would  gain<font></font>
          privilege because the set-user-ID or set-group_ID mode bit was set on the executed file, then the system may open an<font></font>
          unspecified file for each of these file descriptors.  As a general principle, no portable  program,  whether  privi‚Äê<font></font>
          leged or not, can assume that these three file descriptors will remain closed across an execve().</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si no queremos que el proceso llamado reciba una copia del descriptor, entonces debemos establecer el indicador FD_CLOEXEC / SOCK_CLOEXEC en √©l. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En general, ser√≠a l√≥gico si estuviera marcado con etiquetas que desea copiar, con el fin de fugas Debe evitarse en los archivos de la ra√≠z de acceso, pero la bandera apareci√≥ en POSIX-2001, as√≠ que ahora es nuestro patrimonio, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aunque</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , y la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pol√©mica</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></i><br>
<br>
<pre><code class="cpp hljs">server-&gt;socket = socket(AF_INET, SOCK_STREAM | SOCK_CLOEXEC, <span class="hljs-number">0</span>);</code></pre><br>
<pre><code class="cpp hljs">fcntl(client, F_SETFD, FD_CLOEXEC);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sin embargo, no, nuestras banderas est√°n configuradas como deber√≠an. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces que pasa? </font><font style="vertical-align: inherit;">¬øEl n√∫cleo ignora la bandera? </font><font style="vertical-align: inherit;">Alguien que lo deja? </font><font style="vertical-align: inherit;">Y lo m√°s importante, ¬øpor qu√©, despu√©s de completar la aplicaci√≥n, el proceso que ocupa el puerto permanece en el sistema? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Intentemos cerrar el servidor principal y conectarnos al proceso restante usando gdb:</font></font><br>
<br>
<pre><code class="plaintext hljs">$ sudo gdb -p 27506<font></font>
GNU gdb (Ubuntu 8.1-0ubuntu3.2) 8.1.0.20180409-git<font></font>
[...]<font></font>
Reading symbols from /lib/x86_64-linux-gnu/libgcc_s.so.1...(no debugging symbols found)...done.<font></font>
0x00007f503d50c9f3 in futex_wait_cancelable (private=[optimized out], expected=0, futex_word=0x55f485d383b8)<font></font>
    at ../sysdeps/unix/sysv/linux/futex-internal.h:88<font></font>
88	../sysdeps/unix/sysv/linux/futex-internal.h:     .<font></font>
(gdb) bt<font></font>
#0  0x00007f503d50c9f3 in futex_wait_cancelable (private=[optimized out], expected=0, futex_word=0x55f485d383b8)<font></font>
    at ../sysdeps/unix/sysv/linux/futex-internal.h:88<font></font>
#1  __pthread_cond_wait_common (abstime=0x0, mutex=0x55f485d38368, cond=0x55f485d38390) at pthread_cond_wait.c:502<font></font>
#2  __pthread_cond_wait (cond=0x55f485d38390, mutex=0x55f485d38368) at pthread_cond_wait.c:655<font></font>
#3  0x00007f503d948097 in _frs_signal_wait (signal=0x55f485d38340, filename=0x7f503d7315c8 "fen_server.c", fileline=298)<font></font>
    at ./projects/shared/libforseti/code/thread/frs_signal.c:250<font></font>
#4  0x00007f503d728044 in _server_wait (server=0x55f485d38270) at ./projects/shared/libfenrir/code/server/fen_server.c:298<font></font>
#5  0x00007f503d72822d in fen_server_free (server=0x55f485d38270) at ./projects/shared/libfenrir/code/server/fen_server.c:351</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Stop stop stop, que server_free? </font><font style="vertical-align: inherit;">¬øHemos completado el proceso incorrecto? </font><font style="vertical-align: inherit;">Despu√©s de todo, ¬°aqu√≠ deber√≠a estar el lanzamiento de la aplicaci√≥n echo! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øO no deber√≠a ser?</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cap√≠tulo 5. "Un personaje"</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enviamos el eco de cadena, pero debe poner la ruta completa a la aplicaci√≥n en exec, porque no la ejecutamos en el entorno de shell, a diferencia del mismo sistema. </font><font style="vertical-align: inherit;">Cambie a / bin / echo y observe que el problema se ha ido. </font><font style="vertical-align: inherit;">Pero luego resulta que cuando damos el comando que es incorrecto desde el punto de vista de exec, continuamos trabajando en el mismo proceso y no lo reemplazamos con una aplicaci√≥n en ejecuci√≥n, lo que significa que ...</font></font><br>
<br>
<pre><code class="cpp hljs">        execve(arguments[<span class="hljs-number">0</span>], arguments, environ);
        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pues s√≠, la salida est√° hecha. </font><font style="vertical-align: inherit;">Pero, ¬øc√≥mo hace esto que el servidor se apague?</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">/*! \brief   */</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> _free(<span class="hljs-keyword">void</span>) __attribute__((destructor));
<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> _free(<span class="hljs-keyword">void</span>) {<font></font>
    fen_server_free(g_server);<font></font>
    frs_inf(<span class="hljs-string">"   "</span>);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora todo cay√≥ en su lugar. </font><font style="vertical-align: inherit;">Estos dos errores realmente estaban interconectados, y ahora incluso puedes decir exactamente c√≥mo: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/g0/sk/-s/g0sk-sf74ratdovfkkoqny7ongu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bueno, queda por corregir el sistema que funciona incorrectamente. </font><font style="vertical-align: inherit;">Y lo haremos como en una broma sobre el maestro de televisi√≥n y un golpe con un martillo: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">agregue un s√≠mbolo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "_" a la palabra salir:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">int</span> pid = fork();
<span class="hljs-keyword">switch</span> (pid) {
    <span class="hljs-keyword">case</span> <span class="hljs-number">-1</span> :
        <span class="hljs-keyword">return</span> BADFORK;
    <span class="hljs-keyword">case</span> <span class="hljs-number">0</span> :<font></font>
        close(<span class="hljs-built_in">stdout</span>);<font></font>
        close(<span class="hljs-built_in">stderr</span>);<font></font>
        open(fileout, O_CREAT | O_WRONLY, <span class="hljs-number">0777</span>);<font></font>
        open(fileerr, O_CREAT | O_WRONLY, <span class="hljs-number">0777</span>);<font></font>
        execve(arguments[<span class="hljs-number">0</span>], arguments, environ);<font></font>
        _exit(EXIT_FAILURE);<font></font>
    <span class="hljs-keyword">default</span> :
        <span class="hljs-keyword">return</span> pid;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øQu√© est√° pasando ahora? </font><font style="vertical-align: inherit;">Nada especial, excepto que ahora el proceso de finalizaci√≥n terminar√° sin llamar a las funciones registradas a trav√©s de atexit. </font><font style="vertical-align: inherit;">En implementaciones anteriores de glibc, esta ser√° una llamada a la llamada al sistema _exit; en las m√°s nuevas, se llamar√° a exit_group para completar todos los hilos del programa m√°s correctamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bueno, ambos errores han sido derrotados, y usted dijo "apofenia", "solo se pregunta", "no hay conexi√≥n". </font><font style="vertical-align: inherit;">Ir√© a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mover la</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> caja al estante, de lo contrario la humanidad ya no volar√° al espacio.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es505898/index.html">Claude Shannon: Jack de todos los oficios, bromista y padre de la teor√≠a de la informaci√≥n.</a></li>
<li><a href="../es505900/index.html">Adicciones personales: 40 mm de tama√±o completo, sin cable, durante 72 horas por 8000 rublos</a></li>
<li><a href="../es505904/index.html">JUG Ru Group # 5 Semana de transmisi√≥n en l√≠nea</a></li>
<li><a href="../es505906/index.html">Tutorial Bandit de overthewire.org</a></li>
<li><a href="../es505918/index.html">Interfaz de tel√©fono Sony - Publicidad sin discapacidad</a></li>
<li><a href="../es505928/index.html">¬øPor qu√© la programaci√≥n funcional es tan complicada?</a></li>
<li><a href="../es505946/index.html">Almacenamiento de im√°genes con Django / Django REST</a></li>
<li><a href="../es505954/index.html">Alpine.js - eventos y almac√©n de datos global</a></li>
<li><a href="../fr486176/index.html">M√©mo de correspondance par e-mail d'entreprise</a></li>
<li><a href="../fr486178/index.html">FOSS News No. 1 - revue des nouvelles gratuites et open source du 27 janvier au 2 f√©vrier 2020</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>