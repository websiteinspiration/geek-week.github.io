<!doctype html>
<html class="no-js" lang="ar">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏠 💧 👾 كتاب "Terraform: البنية التحتية على مستوى الكود" 🕥 🌜 🔫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="مرحبا ، هابروجيتلي! الكتاب مخصص لكل شخص مسؤول عن الرمز المكتوب بالفعل. ينطبق هذا على مسؤولي النظام ، ومتخصصي العمليات ، والإصدار ، والمهندسين SR ، و D...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>كتاب "Terraform: البنية التحتية على مستوى الكود"</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/503858/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><img src="https://habrastorage.org/webt/el/eg/lp/eleglpt_bkgjd7cftgp1yrmg_gk.jpeg" align="left" alt="صورة"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">مرحبا ، هابروجيتلي! الكتاب مخصص لكل شخص مسؤول عن الرمز المكتوب بالفعل. ينطبق هذا على مسؤولي النظام ، ومتخصصي العمليات ، والإصدار ، والمهندسين SR ، و DevOps ، ومطوري البنية التحتية ، ومطوري الدورة الكاملة ، وقادة الفرق الهندسية ، والمديرين الفنيين. مهما كان موقفك ، إذا كنت مشتركًا في البنية التحتية ، ونشر التعليمات البرمجية ، وتكوين الخوادم ، وقياس التكتلات ، ونسخ البيانات احتياطيًا ، ومراقبة التطبيقات والرد على المكالمات في الساعة الثالثة صباحًا ، فهذا الكتاب لك.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
يشار إلى هذه المسؤوليات معًا عادةً باسم الأنشطة التشغيلية (أو إدارة النظام). </font><font style="vertical-align: inherit;">في السابق ، كان المطورين الذين يعرفون كيفية كتابة التعليمات البرمجية ولكنهم لم يفهموا إدارة النظام قد تم استيفائهم غالبًا ؛ </font><font style="vertical-align: inherit;">غالبًا ما صادف مسؤولو النظام دون القدرة على كتابة التعليمات البرمجية. </font><font style="vertical-align: inherit;">بمجرد أن كان هذا الفصل مقبولًا ، ولكن في العالم الحديث ، والذي لم يعد من الممكن تخيله بدون الحوسبة السحابية وحركة DevOps ، يحتاج أي مطور تقريبًا إلى مهارات إدارية ، ويجب أن يكون أي مسؤول نظام قادرًا على البرمجة.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لن تتعلم فقط كيفية إدارة البنية التحتية في شكل رمز باستخدام Terraform ، ولكن أيضًا ستتعلم كيف تتناسب مع المفهوم العام لـ DevOps. </font><font style="vertical-align: inherit;">إليك بعض الأسئلة التي يمكنك الإجابة عنها بقراءة هذا الكتاب.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">لماذا تستخدم IaC على الإطلاق؟</font></font></li>
<li>    , ,     ?</li>
<li>   Terraform, Chef, Ansible, Puppet, Salt, CloudFormation, Docker, Packer  Kubernetes?</li>
<li>   Terraform       ?</li>
<li>   Terraform,    ?</li>
<li>    Terraform,       ?</li>
<li>     Terraform?</li>
<li>  Terraform     ?</li>
<li>    Terraform   ?</li>
</ul><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">    </b>
                        <div class="spoiler_text">    2017 .   2019-         ,      !                 .  ,        .<br>
<br>
        ,  ,     ,    Terraform,    .<br>
<br>
<ul>
<li>   Terraform.    ,   Terraform  0.8.     Terraform   0.12.       ,     .  ,   !</li>
<li>   .           Terraform.    , ,    ,  ,    ,  ,  ,    .</li>
<li>  .      Terraform   .  , ,               — ,      .</li>
<li>   .  8      ,      Terraform    . ,  ,      ,          : ,      .</li>
<li>HCL2.  Terraform 0.12   HCL   HCL2.        (       ${…}!),   ,     ,   null, for_each  for,    .          HCL2,         5  6.</li>
<li>   .  Terraform 0.9    .        Terraform    .  Terraform 0.9     ,       ;     0.10      .       3.</li>
<li>    Terraform.  Terraform 0.10         (    AWS, GCP, Azure  . .).         ,         .          terraform init  ,       .       2  7.</li>
<li>   .  2016   Terraform        (AWS, GCP  Azure).      100,  ,  ,   1.               (,     Alicloud, Oracle Cloud Infrastructure, VMware vSphere  .),       ,     (GitHub, GitLab  BitBucket),   (MySQL, PostreSQL  InfluxDB),     ( DataDog, New Relic  Grafana),   Kubernetes, Helm, Heroku, Rundeck  Rightscale   .  ,       : ,   AWS     ,        ,   CloudFormation!</li>
<li>  Terraform.  2017   HashiCorp    Terraform (registry.terraform.io) —  ,         Terraform,  .  2018          .  Terraform 0.11        .       « »  . 153.</li>
<li>  .  Terraform 0.9    :         ,    ,   errored.tfstate.  Terraform 0.12    .    ,            ,     .</li>
<li>   .      ,     (.  «  »  . 144),  « »         (,  «  Terraform»  . 242),  plan    apply (.  «  »  . 64),     create_before_destroy,    count,           (.  «»  . 160),    ,   provider   .</li>
</ul></div>
                    </div><br>
<h3>.    Terraform</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(يتم إيلاء المزيد من الاهتمام لقضايا الاختبار التلقائي في الكتاب لاحقًا) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
يمتلئ عالم DevOps بمخاوف مختلفة: يخشى الجميع السماح للأشياء بالعمل أو فقدان البيانات أو الاختراق. عند إجراء أي تغيير ، تسأل نفسك دائمًا عن العواقب التي ستترتب عليها. هل ستتصرف في جميع البيئات؟ هل سيتسبب في انقطاع آخر؟ وإذا حدث ذلك ، فكم ستبقى في العمل هذه المرة لإصلاحه؟ مع نمو الشركة ، هناك المزيد على المحك ، مما يجعل عملية النشر أسوأ وتزيد من خطر الأخطاء. تحاول العديد من الشركات تقليل هذا الخطر من خلال عمليات نشر أقل تكرارًا ، ولكن نتيجة لذلك ، يصبح كل عملية نشر فردية أكبر وأكثر عرضة للأخطاء.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
إذا كنت تدير بنيتك الأساسية في شكل رمز ، فلديك طريقة أفضل لتقليل المخاطر: الاختبارات. </font><font style="vertical-align: inherit;">هدفهم هو منحك ثقة كافية لإجراء التغييرات. </font><font style="vertical-align: inherit;">الكلمة الأساسية هنا هي الثقة: لا يمكن لأي اختبارات أن تضمن عدم وجود أخطاء ، لذلك من المرجح أن تتعامل مع الاحتمالات. </font><font style="vertical-align: inherit;">إذا كان بإمكانك تصوير جميع عمليات البنية الأساسية والنشر الخاصة بك ككود ، يمكنك اختبار هذا الرمز في بيئة اختبار. </font><font style="vertical-align: inherit;">إذا نجحت ، فهناك احتمال كبير بأن يعمل الرمز نفسه في بيئة صناعية. </font><font style="vertical-align: inherit;">في عالم من الخوف وعدم اليقين ، فإن الاحتمالية العالية والثقة باهظة الثمن. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في هذا الفصل ، سنتناول عملية اختبار كود البنية التحتية ، اليدوية والتلقائية ، مع التركيز على الأخير. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الاختبارات اليدوية:</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">أساسيات الاختبار اليدوي ؛</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">تنظيف الموارد بعد الاختبارات.</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الاختبارات المؤتمتة:</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">اختبارات الوحدة</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">اختبارات التكامل ؛</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">اختبارات من طرف إلى طرف ؛</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">طرق الاختبار الأخرى.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الاختبارات اليدوية</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
عند التفكير في كيفية اختبار Terraform Code ، من المفيد رسم بعض أوجه التشابه مع رمز الاختبار المكتوب بلغات برمجة للأغراض العامة مثل Ruby. </font><font style="vertical-align: inherit;">تخيل أنك تكتب خادم ويب روبي بسيط في ملف web-server.rb:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebServer</span> &lt; <span class="hljs-title">WEBrick</span>::<span class="hljs-title">HTTPServlet</span>::<span class="hljs-title">AbstractServlet</span>
  <span class="hljs-title">def</span> <span class="hljs-title">do_GET</span>(<span class="hljs-title">request</span>, <span class="hljs-title">response</span>)
     <span class="hljs-title">case</span> <span class="hljs-title">request</span>.<span class="hljs-title">path</span>
     <span class="hljs-title">when</span> "/"
         <span class="hljs-title">response</span>.<span class="hljs-title">status</span> </span>= <span class="hljs-number">200</span>
         response[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-string">'text/plain'</span>
         response.body = <span class="hljs-string">'Hello, World'</span>
     <span class="hljs-keyword">else</span>
         response.status = <span class="hljs-number">404</span>
         response[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-string">'text/plain'</span>
         response.body = <span class="hljs-string">'Not Found'</span><font></font>
     end<font></font>
  end<font></font>
end</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
سيعيد هذا الرمز استجابة 200 OK مع نص Hello، World لعنوان URL /؛ </font><font style="vertical-align: inherit;">بالنسبة لأي عنوان آخر ، ستكون الإجابة 404. كيف يمكنك اختبار هذا الرمز يدويًا؟ </font><font style="vertical-align: inherit;">عادة ، يتم إضافة المزيد من التعليمات البرمجية لتشغيل خادم الويب محليًا:</font></font><br>
<br>
<pre><code class="java hljs">#   ,      <font></font>
#  ,       <font></font>
<span class="hljs-keyword">if</span> __FILE__ == $<span class="hljs-number">0</span>
  #      <span class="hljs-number">8000</span>
  server = WEBrick::HTTPServer.new :Port =&gt; <span class="hljs-number">8000</span>
  server.mount <span class="hljs-string">'/'</span>, WebServer<font></font>
<font></font>
  #    Ctrl+C<font></font>
  trap <span class="hljs-string">'INT'</span> <span class="hljs-keyword">do</span> server.shutdown end<font></font>
<font></font>
  #  <font></font>
  server.start<font></font>
end</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
إذا قمت بتشغيل هذا الملف في المحطة الطرفية ، فسيتم تحميل خادم الويب على المنفذ 8000:</font></font><br>
<br>
<pre><code class="java hljs">$ ruby web-server.rb<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick <span class="hljs-number">1.3</span><span class="hljs-number">.1</span>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO ruby <span class="hljs-number">2.3</span><span class="hljs-number">.7</span> (<span class="hljs-number">2018</span>-<span class="hljs-number">03</span>-<span class="hljs-number">28</span>) [universal.x86_64-darwin17]<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick::HTTPServer#start: pid=<span class="hljs-number">19767</span> port=<span class="hljs-number">8000</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
للتحقق من تشغيل هذا الخادم ، يمكنك استخدام المتصفح أو curl:</font></font><br>
<br>
<pre><code class="java hljs">$ curl localhost:<span class="hljs-number">8000</span>/<font></font>
Hello, World<font></font>
<font></font>
$ curl localhost:<span class="hljs-number">8000</span>/invalid-path<font></font>
Not Found</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
تخيل الآن أننا قمنا بتغيير هذا الرمز عن طريق إضافة نقطة إدخال / api إليها والتي ترجع 201 Created ونصًا بتنسيق JSON:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebServer</span> &lt; <span class="hljs-title">WEBrick</span>::<span class="hljs-title">HTTPServlet</span>::<span class="hljs-title">AbstractServlet</span>
  <span class="hljs-title">def</span> <span class="hljs-title">do_GET</span>(<span class="hljs-title">request</span>, <span class="hljs-title">response</span>)
     <span class="hljs-title">case</span> <span class="hljs-title">request</span>.<span class="hljs-title">path</span>
     <span class="hljs-title">when</span> "/"
         <span class="hljs-title">response</span>.<span class="hljs-title">status</span> </span>= <span class="hljs-number">200</span>
         response[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-string">'text/plain'</span>
         response.body = <span class="hljs-string">'Hello, World'</span>
     when <span class="hljs-string">"/api"</span>
         response.status = <span class="hljs-number">201</span>
         response[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-string">'application/json'</span>
         response.body = <span class="hljs-string">'{"foo":"bar"}'</span>
     <span class="hljs-keyword">else</span>
         response.status = <span class="hljs-number">404</span>
         response[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-string">'text/plain'</span>
         response.body = <span class="hljs-string">'Not Found'</span><font></font>
     end<font></font>
  end<font></font>
end</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لاختبار هذا الرمز المحدث يدويًا ، اضغط على Ctrl + C وأعد تشغيل خادم الويب عن طريق تشغيل البرنامج النصي مرة أخرى:</font></font><br>
<br>
<pre><code class="java hljs">$ ruby web-server.rb<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick <span class="hljs-number">1.3</span><span class="hljs-number">.1</span>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO ruby <span class="hljs-number">2.3</span><span class="hljs-number">.7</span> (<span class="hljs-number">2018</span>-<span class="hljs-number">03</span>-<span class="hljs-number">28</span>) [universal.x86_64-darwin17]<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick::HTTPServer#start: pid=<span class="hljs-number">19767</span> port=<span class="hljs-number">8000</span><font></font>
^C<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">15</span>:<span class="hljs-number">54</span>] INFO going to shutdown ...<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">15</span>:<span class="hljs-number">54</span>] INFO WEBrick::HTTPServer#start done.<font></font>
<font></font>
$ ruby web-server.rb<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick <span class="hljs-number">1.3</span><span class="hljs-number">.1</span>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO ruby <span class="hljs-number">2.3</span><span class="hljs-number">.7</span> (<span class="hljs-number">2018</span>-<span class="hljs-number">03</span>-<span class="hljs-number">28</span>) [universal.x86_64-darwin17]<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick::HTTPServer#start: pid=<span class="hljs-number">19767</span> port=<span class="hljs-number">8000</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
للتحقق من الإصدار الجديد ، يمكنك مرة أخرى استخدام الأمر curl:</font></font><br>
<br>
<pre><code class="java hljs">$ curl localhost:<span class="hljs-number">8000</span>/api<font></font>
{<span class="hljs-string">"foo"</span>:<span class="hljs-string">"bar"</span>}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">أساسيات الاختبار اليدوي</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
كيف سيبدو هذا النوع من الاختبارات اليدوية في Terraform؟ </font><font style="vertical-align: inherit;">على سبيل المثال ، من الفصول السابقة ، لا يزال لديك رمز لنشر ALB. </font><font style="vertical-align: inherit;">فيما يلي مقتطف من ملف الوحدات / الشبكات / الألبوم / main.tf:</font></font><br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_lb"</span> <span class="hljs-string">"example"</span> {<font></font>
   name                     = <span class="hljs-keyword">var</span>.alb_name<font></font>
   load_balancer_type = <span class="hljs-string">"application"</span>
   subnets                  = <span class="hljs-keyword">var</span>.subnet_ids<font></font>
   security_groups      = [aws_security_group.alb.id]<font></font>
}<font></font>
<font></font>
resource <span class="hljs-string">"aws_lb_listener"</span> <span class="hljs-string">"http"</span> {<font></font>
   load_balancer_arn = aws_lb.example.arn<font></font>
   port                      = local.http_port<font></font>
   protocol                = <span class="hljs-string">"HTTP"</span><font></font>
<font></font>
   #      <span class="hljs-number">404</span><font></font>
   default_action {<font></font>
      type = <span class="hljs-string">"fixed-response"</span><font></font>
<font></font>
      fixed_response {<font></font>
        content_type = <span class="hljs-string">"text/plain"</span>
        message_body = <span class="hljs-string">"404: page not found"</span>
        status_code = <span class="hljs-number">404</span><font></font>
      }<font></font>
    }<font></font>
}<font></font>
<font></font>
resource <span class="hljs-string">"aws_security_group"</span> <span class="hljs-string">"alb"</span> {<font></font>
   name = <span class="hljs-keyword">var</span>.alb_name<font></font>
}<font></font>
<font></font>
# (...)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
إذا قارنت هذه القائمة برمز روبي ، يمكنك أن ترى اختلافًا واحدًا واضحًا: AWS ALB ، والمجموعات المستهدفة ، والمستمعون ، ومجموعات الأمان ، ولا يمكن نشر أي موارد أخرى على جهاز الكمبيوتر الخاص بك. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
فيما يلي الاستنتاج الرئيسي حول الاختبار رقم 1: لا يمكن إجراء اختبار رمز Terraform محليًا. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لا ينطبق هذا فقط على Terraform ، ولكن أيضًا على معظم أدوات IaC. الطريقة العملية الوحيدة لإجراء الاختبار اليدوي في Terraform هي نشر الكود في بيئة حقيقية (أي في AWS). وبعبارة أخرى ، فإن إطلاق تطبيق terraform بشكل مستقل وتدمير أوامر terraform التي عملت عليها أثناء قراءة الكتاب هو اختبار يدوي في Terraform.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
هذا أحد الأسباب التي تجعل من المهم جدًا وجود أمثلة سهلة النشر في مجلد الأمثلة لكل وحدة (انظر الفصل 6). </font><font style="vertical-align: inherit;">لاختبار وحدة الألبوم ، أسهل طريقة هي استخدام رمز العرض التوضيحي الذي قمت بإنشائه في الأمثلة / الألبوم:</font></font><br>
<br>
<pre><code class="java hljs">provider <span class="hljs-string">"aws"</span> {<font></font>
   region = <span class="hljs-string">"us-east-2"</span><font></font>
<font></font>
   #     AWS  <span class="hljs-number">2</span>.x<font></font>
   version = <span class="hljs-string">"~&gt; 2.0"</span><font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">module</span> <span class="hljs-string">"alb"</span> {<font></font>
    source = <span class="hljs-string">"../../modules/networking/alb"</span><font></font>
<font></font>
    alb_name = <span class="hljs-string">"terraform-up-and-running"</span>
    subnet_ids = data.aws_subnet_ids.<span class="hljs-keyword">default</span>.ids<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لنشر هذا المثال ، تحتاج إلى تشغيل أمر تطبيق terraform ، كما فعلت بشكل متكرر:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function">$ terraform <span class="hljs-title">apply</span>

<span class="hljs-params">(...)</span>

Apply complete! Resources: 5 added, 0 changed, 0 destroyed.

Outputs:

alb_dns_name </span>= hello-world-stage-<span class="hljs-number">477699288</span>.us-east-<span class="hljs-number">2</span>.elb.amazonaws.com</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في نهاية النشر ، يمكنك استخدام أداة مثل curl ، على سبيل المثال ، للتأكد من أن ALB يُرجع 404 افتراضيًا:</font></font><br>
<br>
<pre><code class="java hljs">$ curl \<font></font>
   -s \<font></font>
   -o /dev/<span class="hljs-keyword">null</span> \<font></font>
   -w <span class="hljs-string">"%{http_code}"</span> \<font></font>
hello-world-stage-<span class="hljs-number">477699288</span>.us-east-<span class="hljs-number">2</span>.elb.amazonaws.com<font></font>
<font></font>
<span class="hljs-number">404</span></code></pre><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">فحص البنية التحتية</font></font><br>
<br>
      ,   HTTP, ,     ,   curl  HTTP-.        . ,        MySQL,       MySQL.      VPN-,      VPN.      ,      ,       SSH    - .    .   ,    ,      .       ,    .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
دعني أذكرك: ALB يُرجع 404 بسبب عدم وجود قواعد استماع أخرى في التكوين ، والإجراء الافتراضي في وحدة الألب يحتوي على استجابة 404:</font></font><br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_lb_listener"</span> <span class="hljs-string">"http"</span> {<font></font>
   load_balancer_arn = aws_lb.example.arn<font></font>
   port                      = local.http_port<font></font>
   protocol                = <span class="hljs-string">"HTTP"</span><font></font>
<font></font>
   #      <span class="hljs-number">404</span><font></font>
   default_action {<font></font>
      type = <span class="hljs-string">"fixed-response"</span><font></font>
<font></font>
      fixed_response {<font></font>
       content_type = <span class="hljs-string">"text/plain"</span>
       message_body = <span class="hljs-string">"404: page not found"</span>
       status_code = <span class="hljs-number">404</span><font></font>
      }<font></font>
   }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لذا ، فأنت تعرف بالفعل كيفية تشغيل واختبار الرمز الخاص بك. </font><font style="vertical-align: inherit;">الآن يمكنك البدء في إجراء التغييرات. </font><font style="vertical-align: inherit;">في كل مرة تقوم فيها بتغيير شيء ما (بحيث ، على سبيل المثال ، إرجاع الإجراء الافتراضي 401) ، تحتاج إلى استخدام الأمر terraform application لنشر الرمز الجديد:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function">$ terraform <span class="hljs-title">apply</span>

<span class="hljs-params">(...)</span>

Apply complete! Resources: 0 added, 1 changed, 0 destroyed.

Outputs:

alb_dns_name </span>= hello-world-stage-<span class="hljs-number">477699288</span>.us-east-<span class="hljs-number">2</span>.elb.amazonaws.com</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
للتحقق من الإصدار الجديد ، يمكنك إعادة تشغيل curl:</font></font><br>
<br>
<pre><code class="java hljs">$ curl \<font></font>
   -s \<font></font>
   -o /dev/<span class="hljs-keyword">null</span> \<font></font>
   -w <span class="hljs-string">"%{http_code}"</span> \<font></font>
   hello-world-stage-<span class="hljs-number">477699288</span>.us-east-<span class="hljs-number">2</span>.elb.amazonaws.com
<span class="hljs-number">401</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
عند الانتهاء ، قم بتشغيل الأمر terraform destruction لإزالة الموارد:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function">$ terraform <span class="hljs-title">destroy</span>

<span class="hljs-params">(...)</span>

Apply complete! Resources: 0 added, 0 changed, 5 destroyed.</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
بمعنى آخر ، عند العمل مع Terraform ، يحتاج كل مطور إلى عينات جيدة من التعليمات البرمجية للاختبار وبيئة تطوير حقيقية (مثل حساب AWS) ، والذي يعمل كمكافئ للكمبيوتر المحلي ويستخدم لإجراء الاختبارات. في عملية الاختبار اليدوي ، ستضطر على الأرجح إلى إنشاء وإزالة عدد كبير من مكونات البنية التحتية ، وقد يؤدي ذلك إلى العديد من الأخطاء. في هذا الصدد ، يجب عزل البيئة تمامًا عن البيئات الأكثر استقرارًا والمخصصة للاختبار النهائي ، وخاصة للتطبيقات الصناعية.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
بالنظر إلى ما سبق ، أوصي بشدة أن يقوم كل فريق تطوير بإعداد بيئة معزولة يمكنك من خلالها إنشاء وإزالة أي بنية أساسية دون عواقب. </font><font style="vertical-align: inherit;">لتقليل احتمالية حدوث تضارب بين المطورين المختلفين (تخيل أن مطورين يحاولان إنشاء موازن تحميل يحمل نفس الاسم) ، سيكون الحل المثالي هو إعطاء كل عضو في الفريق بيئة منفصلة ومعزولة تمامًا. </font><font style="vertical-align: inherit;">على سبيل المثال ، إذا كنت تستخدم Terraform مع AWS ، فيجب أن يكون لكل مطور حسابه الخاص حيث يمكنه اختبار كل ما يريده.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">تنظيف الموارد بعد الاختبارات</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
يعد وجود العديد من البيئات المعزولة أمرًا ضروريًا لتحقيق إنتاجية عالية للمطورين ، ولكن إذا لم تكن حذرًا ، يمكنك تجميع الكثير من الموارد الإضافية التي ستؤدي إلى فوضى في جميع بيئاتك وتكلفك مبلغًا إجماليًا. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
للحفاظ على التكاليف تحت السيطرة ، قم بتنظيف الوسائط المعزولة بانتظام. هذا هو </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الاستنتاج الرئيسي حول الاختبار رقم 2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
كحد أدنى ، يجب عليك إنشاء مثل هذه الثقافة في الفريق عندما يقوم المطورون ، بعد الاختبار ، بحذف كل شيء قاموا بنشره باستخدام أمر تدمير terraform. قد يكون من الممكن العثور على أدوات لتنظيف الموارد الزائدة أو القديمة التي يمكن تشغيلها على أساس منتظم (على سبيل المثال ، استخدام cron). فيما يلي بعض الأمثلة لبيئات النشر المختلفة.</font></font><br>
<br>
<ul>
<li>cloud-nuke (http://bit.ly/2OIgM9r).      ,         .        AWS ( Amazon EC2 Instances, ASG, ELB  . .).      (Google Cloud, Azure)   .    —    ,    . , cloud-nuke      cron,           .   ,   ,      ,      :<br>
<br>
<pre><code class="java hljs">$ cloud-nuke aws --older-than <span class="hljs-number">48</span>h</code></pre></li>
<li>Janitor Monkey (http://bit.ly/2M4GoLB).      ,   AWS  ,    (  —   ).    ,  ,    ,            .    Netflix Simian Army,      Chaos Monkey    .   ,    Simian Army    ,       : ,   Janitor Monkey   Swabbie (http://bit.ly/2OLrOLb).</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aws-nuke (http://bit.ly/2ZB8lOe). </font><font style="vertical-align: inherit;">هذه أداة مفتوحة المصدر لحذف جميع محتويات حساب AWS. </font><font style="vertical-align: inherit;">يتم تحديد الحسابات والموارد المراد حذفها في ملف التكوين بتنسيق YAML:</font></font><br>
<br>
<pre><code class="java hljs">#   <font></font>
regions:<font></font>
- us-east-<span class="hljs-number">2</span><font></font>
<font></font>
#    <font></font>
accounts:<font></font>
   <span class="hljs-string">"111111111111"</span>: {}<font></font>
<font></font>
#    <font></font>
resource-types:<font></font>
   targets:<font></font>
   - S3Object<font></font>
   - S3Bucket<font></font>
   - IAMRole</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
يبدأ Aws-nuke على النحو التالي:</font></font><br>
<br>
<pre><code class="java hljs">$ aws-nuke -<span class="hljs-number">5</span>c config.yml</code></pre></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الاختبارات المؤتمتة</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
مفهوم الاختبار التلقائي هو أن الاختبارات مكتوبة لاختبار سلوك الكود الحقيقي. </font><font style="vertical-align: inherit;">في الفصل 8 ، ستتعلم أنه باستخدام خادم CI ، يمكن تشغيل هذه الاختبارات بعد تنفيذ كل فرد. </font><font style="vertical-align: inherit;">إذا لم يكتمل التثبيت ، يمكن التراجع عنه أو تصحيحه على الفور. </font><font style="vertical-align: inherit;">وبالتالي ، سيتم تشغيل التعليمات البرمجية الخاصة بك دائمًا. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
هناك ثلاثة أنواع من الاختبارات الآلية.</font></font><br>
<br>
<ul>
<li> .       — .    ,             .   (,  , -    )   mock-.       (, mock-     ,  )    ,        .</li>
<li> .      .          ,          .      mock-: ,     ,     ,      ,   , ,  ,  mock-.</li>
<li> .      (, ,  ,  )       .          : , Selenium        .         - mock-,          (        ,  ).</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
كل نوع من أنواع الاختبارات له غرضه الخاص ، وبمساعدته يمكنك تحديد جميع أنواع الأخطاء ، لذلك يجب استخدامها معًا. اختبارات الوحدة سريعة وتسمح لك بالحصول على الفور على فكرة عن التغييرات التي تم إجراؤها والتحقق من مجموعة متنوعة من المجموعات. يمنحك هذا الثقة في أن المكونات الأولية للشفرة (وحدات فردية) تتصرف كما كنت تتوقع. ومع ذلك ، فإن حقيقة أن الوحدات تعمل بشكل صحيح بشكل منفصل لا يعني على الإطلاق أنها يمكن أن تعمل معًا ، لذلك ، للتأكد من أن المكونات الأولية الخاصة بك متوافقة ، هناك حاجة إلى اختبارات التكامل. من ناحية أخرى ، لا يضمن السلوك الصحيح لأجزاء مختلفة من النظام أن يعمل هذا النظام كما يجب أن يعمل بعد نشره في بيئة صناعية ، لذلك من خلال الاختبارات مطلوبة لاختبار التعليمات البرمجية الخاصة بك في ظروف قريبة من الظروف الحقيقية.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
»المزيد من المعلومات حول الكتاب يمكن الاطلاع على </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الموقع الإلكتروني للناشر</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
» </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">المحتويات</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
» </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">مقتطفات</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
لKhabrozhiteley 25٪ خصم القسيمة - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terraform</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
عند دفع النسخة الورقية من الكتاب، يتم إرسال الكتاب الالكتروني عن طريق البريد الإلكتروني.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar503842/index.html">بدلة الدماغ: تزامن الشبكات العصبية الاصطناعية والبيولوجية</a></li>
<li><a href="../ar503844/index.html">تسريع عرض MatTable في خطوات قليلة</a></li>
<li><a href="../ar503846/index.html">فلاش ، "ما إذا كان يموت مرة أخرى غير معروف ، ولكن الزهور تختفي ..."</a></li>
<li><a href="../ar503848/index.html">ندعوك إلى ندوات مجانية عبر الإنترنت حول طباعة SLS على Sinterit 26.05 وماسحات 3D Shining 28.05</a></li>
<li><a href="../ar503854/index.html">استخدم SIL إلى أقصى حد</a></li>
<li><a href="../de486176/index.html">Corporate Email Correspondence Memo</a></li>
<li><a href="../de486178/index.html">FOSS News Nr. 1 - Überprüfung der kostenlosen und Open Source-Nachrichten vom 27. Januar bis 2. Februar 2020</a></li>
<li><a href="../de486180/index.html">Tipps und Quellen zum Erstellen von Anwendungen ohne Server</a></li>
<li><a href="../de486184/index.html">So nutzen Sie die Suche effektiv</a></li>
<li><a href="../de486186/index.html">Katastrophale Wolke: Wie es funktioniert</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>