<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üóÇÔ∏è üßìüèæ ü§∑ Neues Odnoklassniki-Frontend: React in Java starten. Teil II üïå üßëüèΩ‚Äçü§ù‚ÄçüßëüèΩ ü•°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wir setzen die Geschichte fort, wie es uns in Odnoklassniki mithilfe von GraalVM gelungen ist, sich mit Java und JavaScript anzufreunden und auf ein r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Neues Odnoklassniki-Frontend: React in Java starten. Teil II</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/odnoklassniki/blog/486810/"><img src="https://habrastorage.org/webt/sz/_g/7x/sz_g7xhw5t9siczpovdjhzzsgru.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir setzen die Geschichte fort, wie es uns in Odnoklassniki mithilfe von </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GraalVM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gelungen ist, sich mit Java und JavaScript </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">anzufreunden</font></a><font style="vertical-align: inherit;"> und auf ein riesiges System mit viel Legacy-Code zu migrieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im zweiten Teil des Artikels werden wir ausf√ºhrlich √ºber den Start, die Zusammenstellung und die Integration von Anwendungen auf dem neuen Stack sprechen, auf die Besonderheiten ihrer Arbeit sowohl auf dem Client als auch auf dem Server eingehen sowie die auf unserem Weg aufgetretenen Schwierigkeiten er√∂rtern und L√∂sungen beschreiben, die ihnen bei der √úberwindung helfen . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie den </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">ersten Teil</font></a><font style="vertical-align: inherit;"> nicht gelesen haben</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich kann es nur empfehlen. </font><font style="vertical-align: inherit;">Daraus lernen Sie die Geschichte des Frontends in Odnoklassniki kennen und lernen seine historischen Merkmale kennen, gehen den Weg, um eine L√∂sung f√ºr die Probleme zu finden, die sich in unseren 13 Projektjahren angesammelt haben, und tauchen am Ende in die technischen Merkmale der Serverimplementierung der von uns getroffenen Entscheidung ein.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UI-Konfiguration</font></font></h2> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um den UI-Code zu schreiben, haben wir die fortschrittlichsten Tools ausgew√§hlt: Reagieren Sie mit MobX, CSS-Modulen, ESLint, TypeScript, Lerna. </font><font style="vertical-align: inherit;">All dies wird mit Webpack gesammelt.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ed/tp/gx/edtpgxyuy6rxy4nvalwn_dhhkva.jpeg"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anwendungsarchitektur</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie im vorherigen Teil dieses Artikels beschrieben, werden wir zur Realisierung einer schrittweisen Migration neue Komponenten in die Site in DOM-Elemente mit benutzerdefinierten Namen einf√ºgen, die im neuen UI-Stapel funktionieren, w√§hrend sie f√ºr den Rest der Site wie ein DOM-Element mit aussehen seine API. Der Inhalt dieser Elemente kann auf dem Server gerendert werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was ist es? Im Inneren befindet sich eine coole, modische, moderne MVC-Anwendung, die auf React ausgef√ºhrt wird und die Standard-DOM-API nach au√üen bereitstellt: Attribute, Methoden f√ºr dieses DOM-Element und Ereignisse.</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/fg/um/dw/fgumdwotb43klsvwwtlvx4x1bd4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um solche Komponenten zu betreiben, haben wir einen speziellen Mechanismus entwickelt. Was macht er? Zun√§chst wird die Anwendung gem√§√ü ihrer Beschreibung initialisiert. Zweitens bindet es die Komponente an den spezifischen DOM-Knoten, in dem sie startet. Es gibt auch zwei Engines (f√ºr den Client und f√ºr den Server), die diese Komponenten finden und rendern k√∂nnen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ln/dg/wz/lndgwzg5ggcfgsnnsfdnrdmue8u.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Warum wird das ben√∂tigt? Tatsache ist, dass, wenn die gesamte Site in React erstellt wird, normalerweise die Site-Komponente in das Stammelement der Seite gerendert wird und diese Komponente keine Rolle spielt, was sich au√üerhalb befindet, sondern nur, was sich innerhalb befindet.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In unserem Fall ist alles komplizierter: Eine Reihe von Anwendungen muss die M√∂glichkeit haben, unserer Seite auf der Website mitzuteilen, dass ich es bin und dass sich etwas an mir √§ndert. Beispielsweise muss der Kalender ein Ereignis ausl√∂sen, bei dem der Benutzer auf die Schaltfl√§che geklickt hat und das Datum ge√§ndert wurde, oder au√üerhalb m√ºssen Sie die M√∂glichkeit haben, innerhalb des Kalenders das Datum zu √§ndern. Zu diesem Zweck implementiert die Application Engine Fassaden in die Grundfunktionalit√§t der Anwendung. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie eine Komponente an einen Client liefern, muss die Engine des alten Standorts diese Komponente starten k√∂nnen. Zu diesem Zweck werden w√§hrend des Builds die f√ºr den Start erforderlichen Informationen gesammelt.</font></font><br>
<br>
<pre><code class="json hljs">{
    <span class="hljs-attr">"events-calendar"</span>: {
        <span class="hljs-attr">"bundleName"</span>: <span class="hljs-string">"events-calendar"</span>,
        <span class="hljs-attr">"js"</span>: <span class="hljs-string">"events-calendar-h4h5m.js"</span>,
        <span class="hljs-attr">"css"</span>: <span class="hljs-string">"events-calendar-h4h5m.css"</span><font></font>
    }<font></font>
}<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Den Attributen des Komponenten-Tags werden spezielle Markierungen hinzugef√ºgt, die besagen, dass es sich bei dieser Anwendung um einen neuen Typ handelt. Der Code kann einer bestimmten JS-Datei entnommen werden. </font><font style="vertical-align: inherit;">Gleichzeitig verf√ºgt es √ºber eigene Attribute, die zum Initialisieren dieser Komponente erforderlich sind: Sie bilden den Anfangszustand der Komponente im Gesch√§ft.</font></font><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">events-calendar</span>	<span class="hljs-attr">data-module</span>=<span class="hljs-string">"react-loader"</span>
			<span class="hljs-attr">data-bundle</span>=<span class="hljs-string">"events-calendar.js"</span>
			<span class="hljs-attr">date</span>=<span class="hljs-string">".."</span>
			<span class="hljs-attr">marks</span>=<span class="hljs-string">"[{..}]"</span>
			‚Ä¶
/&gt;</span>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr die Rehydratisierung wird nicht eine Umwandlung des Anwendungsstatus verwendet, sondern Attribute, mit denen Datenverkehr gespart werden kann. </font><font style="vertical-align: inherit;">Sie liegen in normalisierter Form vor und sind in der Regel kleiner als der von der Anwendung erstellte Speicher. </font><font style="vertical-align: inherit;">Gleichzeitig ist die Zeit zum Neuerstellen des Speichers aus den Attributen auf dem Client kurz, sodass sie normalerweise vernachl√§ssigt werden k√∂nnen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr den Kalender haben die Attribute beispielsweise nur ein hervorgehobenes Datum, und das Gesch√§ft verf√ºgt bereits √ºber eine Matrix mit vollst√§ndigen Informationen f√ºr den Monat. </font><font style="vertical-align: inherit;">Offensichtlich ist es sinnlos, es vom Server zu √ºbertragen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie f√ºhre ich den Code aus?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Konzept wurde an einfachen Funktionen getestet, die entweder eine Zeile f√ºr den Server angeben oder innerHTML f√ºr den Client schreiben. Aber in echtem Code gibt es Module und TypeScript. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt Standardl√∂sungen f√ºr den Client, z. B. das Sammeln von Code mit Webpack, das selbst alles mahlt und dem Client in Form eines B√ºndels von Bundles zur Verf√ºgung stellt. Und was tun f√ºr den Server bei Verwendung von GraalVM?</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/sr/f7/yn/srf7ynd8airmxgybkgu4wnpe82c.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Betrachten wir zwei Optionen. Die erste besteht darin, TypeScript in JavaScript einzugeben, wie dies bei Node.js der Fall ist. Diese Option funktioniert in unserer Konfiguration leider nicht, wenn JavaScript die Gastsprache in GraalVM ist. In diesem Fall verf√ºgt JavaScript weder √ºber ein modulares System noch √ºber Asynchronit√§t. Weil Modularit√§t und Arbeit mit Asynchronit√§t eine bestimmte Laufzeit bieten: NodeJS oder einen Browser. In unserem Fall verf√ºgt der Server √ºber JavaScript, das Code nur synchron ausf√ºhren kann.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die zweite Option: Sie k√∂nnen den Servercode einfach aus denselben Dateien ausf√ºhren, die f√ºr den Client erfasst wurden. Und diese Option funktioniert. Es gibt jedoch ein Problem, dass der Server andere Implementierungen f√ºr eine Reihe von Methoden ben√∂tigt. Beispielsweise wird die Funktion renderToString () auf dem Server aufgerufen, um die Komponente zu rendern, und ReactDOM.render () auf dem Client. Oder ein anderes Beispiel aus dem vorherigen Artikel: Um Texte und Einstellungen auf dem Server abzurufen, wird die von Java bereitgestellte Funktion aufgerufen und auf dem Client eine Implementierung in JS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als L√∂sung f√ºr dieses Problem k√∂nnen Sie Aliase aus Webpack verwenden. Mit ihnen k√∂nnen Sie zwei Implementierungen der von uns ben√∂tigten Klasse erstellen: f√ºr den Client und den Server. Geben Sie dann in den Konfigurationsdateien f√ºr Client und Server die entsprechende Implementierung an.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ca/rb/0o/carb0o0rvb1q0pw8eerxnsy4ova.jpeg"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zwei Konfigurationsdateien sind jedoch zwei Assemblys. </font><font style="vertical-align: inherit;">Jedes Mal ist es langwierig und schwierig, alles separat f√ºr den Server und den Client zu sammeln. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie m√ºssen eine solche Konfiguration erstellen, damit alles auf einmal erfasst wird.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Webpack-Konfiguration zum Ausf√ºhren von JS auf Server und Client</font></font></h2> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um eine L√∂sung f√ºr dieses Problem zu finden, sehen wir uns an, aus welchen Teilen das Projekt besteht: </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/zh/mi/e9/zhmie9o6zghd5vgeyd10pjonffq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erstens verf√ºgt das Projekt √ºber eine Laufzeit von Drittanbietern (Anbietern), die f√ºr den Client und den Server gleich ist. </font><font style="vertical-align: inherit;">Es √§ndert sich fast nie. </font><font style="vertical-align: inherit;">Dem Benutzer kann Rantime zur Verf√ºgung gestellt werden, und er wird auf dem Client zwischengespeichert, bis wir die Version der Bibliothek eines Drittanbieters aktualisieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zweitens gibt es unsere Laufzeit (Core), die den Start der Anwendung sicherstellt. </font><font style="vertical-align: inherit;">Es verf√ºgt √ºber Methoden mit unterschiedlichen Implementierungen f√ºr Client und Server. </font><font style="vertical-align: inherit;">Zum Beispiel das Abrufen von Lokalisierungstexten, Einstellungen usw. </font><font style="vertical-align: inherit;">Diese Laufzeit √§ndert sich ebenfalls selten.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Drittens gibt es einen Komponentencode. </font><font style="vertical-align: inherit;">Dies gilt sowohl f√ºr den Client als auch f√ºr den Server. Dadurch k√∂nnen Sie den Anwendungscode im Browser debuggen, ohne den Server √ºberhaupt zu starten. </font><font style="vertical-align: inherit;">Wenn auf dem Client ein Fehler aufgetreten ist, k√∂nnen Sie die Fehler in der Browserkonsole anzeigen, sich an alles erinnern und sicherstellen, dass beim Starten auf dem Server keine Fehler auftreten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Insgesamt werden drei Teile erhalten, die zusammengebaut werden m√ºssen. </font><font style="vertical-align: inherit;">Wir m√∂chten:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konfigurieren Sie die Baugruppe jedes Teils separat.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schreiben Sie die Abh√§ngigkeiten zwischen ihnen auf, damit nicht jedes Teil in das f√§llt, was sich im anderen befindet.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sammeln Sie alles in einem Durchgang.</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie kann man die Teile, aus denen die Baugruppe bestehen wird, separat beschreiben? </font><font style="vertical-align: inherit;">In Webpack gibt es eine Multikonfiguration: Sie verschenken einfach eine Reihe von Exporten der in jedem Teil enthaltenen Module.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-built_in">module</span>.exports = [{
  <span class="hljs-attr">entry</span>: <span class="hljs-string">'./vendors.js'</span>,<font></font>
}, {<font></font>
  <span class="hljs-attr">entry</span>: <span class="hljs-string">'./core.js'</span><font></font>
}, {<font></font>
 <span class="hljs-attr">entry</span>: <span class="hljs-string">'./app.js'</span><font></font>
}];<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alles w√§re in Ordnung, aber in jedem dieser Teile wird der Code der Module, von denen dieser Teil abh√§ngt, dupliziert: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ut/am/ax/utamaxl7z4op6x8iivfcmufn7ec.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gl√ºcklicherweise gibt es in den grundlegenden Webpack-Plugins </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DllPlugin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mit dem Sie eine Liste der darin enthaltenen Module f√ºr jedes zusammengebaute Teil erhalten k√∂nnen. F√ºr den Anbieter k√∂nnen Sie beispielsweise herausfinden, welche spezifischen Module in diesem Teil enthalten sind. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie ein anderes Teil erstellen, z. B. Kernbibliotheken, k√∂nnen wir sagen, dass diese vom Herstellerteil abh√§ngen. </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/nv/lu/el/nvluelzxzvy_5oofujylu4wmufk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
W√§hrend der Webpack-Assemblierung erkennt DllPlugin die Abh√§ngigkeit des Kerns von einer Bibliothek, die sich bereits im Hersteller befindet, und f√ºgt ihn nicht dem Kern hinzu, sondern f√ºgt einfach einen Link dazu hinzu.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dadurch werden drei Teile gleichzeitig zusammengesetzt und h√§ngen voneinander ab. </font><font style="vertical-align: inherit;">Wenn die erste Anwendung auf den Client heruntergeladen wird, werden die Laufzeit- und Kernbibliotheken im Browser-Cache gespeichert. </font><font style="vertical-align: inherit;">Und da Odnoklassniki eine Site ist, kommt es ziemlich selten vor, dass der Tab, mit dem der Benutzer "f√ºr immer" √∂ffnen kann, verdr√§ngt wird. </font><font style="vertical-align: inherit;">In den meisten F√§llen wird bei Versionen neuer Versionen der Site nur der Anwendungscode aktualisiert.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ressourcenlieferung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Betrachten Sie das Problem am Beispiel der Arbeit mit lokalisierten Texten, die in einer separaten Datenbank gespeichert sind. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie fr√ºher irgendwo auf dem Server Text in der Komponente ben√∂tigt haben, k√∂nnen Sie die Funktion aufrufen, um den Text abzurufen.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> pkg = l10n(<span class="hljs-string">'smiles'</span>);<font></font>
<font></font>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    : { pkg.getText('title') }
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Abrufen von Text auf dem Server ist nicht schwierig, da die Serveranwendung eine schnelle Anforderung an die Datenbank stellen oder sogar alle Texte im Speicher zwischenspeichern kann. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie erhalte ich Texte in Komponenten einer Reaktion, die auf einem Server in GraalVM gerendert werden? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie im ersten Teil des Artikels erl√§utert, k√∂nnen Sie im globalen Kontext dem globalen Objekt, auf das Sie √ºber JavaScript zugreifen m√∂chten, Methoden hinzuf√ºgen. </font><font style="vertical-align: inherit;">Es wurde beschlossen, eine Klasse mit allen Methoden f√ºr JavaScript verf√ºgbar zu machen.</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ServerMethods</span> </span>{<font></font>
    ‚Ä¶<font></font>
    <font></font>
    <span class="hljs-comment">/**
     *     
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getText</span><span class="hljs-params">(String pkg, String key)</span> </span>{<font></font>
        ‚Ä¶<font></font>
    }<font></font>
    <font></font>
    ‚Ä¶<font></font>
}<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºgen Sie dann eine Instanz dieser Klasse in den globalen JavaScript-Kontext ein:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">//     Java   </span>
js.putMember(<span class="hljs-string">"serverMethods"</span>, serverMethods);
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aus diesem Grund rufen wir aus JavaScript in der Serverimplementierung einfach die Funktion auf:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getText</span>(<span class="hljs-params">pkg: string, key: string</span>): <span class="hljs-title">string</span> </span>{
    <span class="hljs-keyword">return</span> global.serverMethods.getText(pkg, key);<font></font>
}<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tats√§chlich ist dies ein Funktionsaufruf in Java, der den angeforderten Text zur√ºckgibt. Direkte synchrone Interaktion und keine HTTP-Aufrufe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf dem Client dauert es leider sehr lange, √ºber HTTP zu gehen und f√ºr jeden Aufruf der Texteinf√ºgefunktion in den Komponenten Texte zu empfangen. Sie k√∂nnen alle Texte vorab auf den Client herunterladen, aber die Texte allein wiegen mehrere zehn Megabyte, und es gibt andere Arten von Ressourcen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lg/6e/ij/lg6eijxb_rvzshqiyih2gyuvy5a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Benutzer wird es leid sein zu warten, bis alles heruntergeladen ist, bevor er die Anwendung startet. Daher ist diese Methode nicht geeignet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich m√∂chte nur die Texte erhalten, die in einer bestimmten Anwendung ben√∂tigt werden. Unsere Texte sind in Pakete unterteilt. Daher k√∂nnen Sie die f√ºr die Anwendung erforderlichen Pakete sammeln und zusammen mit dem Bundle herunterladen. Wenn die Anwendung gestartet wird, befinden sich alle Texte bereits im Client-Cache.</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie finde ich heraus, welche Texte eine Bewerbung ben√∂tigt? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben eine Vereinbarung getroffen, dass Textpakete im Code durch Aufrufen der Funktion l10n () erhalten werden, in die der Paketname NUR in Form eines Zeichenfolgenliteral √ºbertragen wird:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> pkg = l10n(<span class="hljs-string">'smiles'</span>);<font></font>
<font></font>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    { pkg.getLMsg('title') }
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben ein Webpack-Plugin geschrieben, das durch Analyse des AST-Baums des Komponentencodes alle Aufrufe der Funktion l10n () findet und Paketnamen aus den Argumenten sammelt. </font><font style="vertical-align: inherit;">In √§hnlicher Weise sammelt das Plugin Informationen √ºber andere Arten von Ressourcen, die von der Anwendung ben√∂tigt werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei der Ausgabe nach dem Zusammenbau f√ºr jede Anwendung erhalten wir eine Konfiguration mit ihren Ressourcen:</font></font><br>
<br>
<pre><code class="json hljs">{
    <span class="hljs-attr">"events-calendar"</span>: {
       <span class="hljs-attr">"pkg"</span>:  [
           <span class="hljs-string">"calendar"</span>,
           <span class="hljs-string">"dates"</span><font></font>
       ],<font></font>
       <span class="hljs-attr">"cfg"</span>:  [
           <span class="hljs-string">"config1"</span>,
           <span class="hljs-string">"config2"</span><font></font>
       ],<font></font>
       <span class="hljs-attr">"bundleName"</span>:  <span class="hljs-string">"events-calendar"</span>,
       <span class="hljs-attr">"js"</span>:  <span class="hljs-string">"events-calendar.js"</span>,
       <span class="hljs-attr">"css"</span>:  <span class="hljs-string">"events-calendar.css"</span>,<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und nat√ºrlich d√ºrfen wir die Aktualisierung der Texte nicht vergessen. </font><font style="vertical-align: inherit;">Da auf dem Server alle Texte immer auf dem neuesten Stand sind und der Client einen separaten Cache-Aktualisierungsmechanismus ben√∂tigt, z. B. Watcher oder Push.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alter Code in neuem</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei einem reibungslosen √úbergang tritt das Problem auf, den alten Code in neuen Komponenten wiederzuverwenden, da es gro√üe und komplexe Komponenten gibt (z. B. einen Videoplayer), deren Umschreiben viel Zeit in Anspruch nimmt und die Sie jetzt im neuen Stapel verwenden m√ºssen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jz/pg/te/jzpgtesmq75odhrqyvbg2grbw9u.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was sind die Probleme?</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die alte Site und die neuen React-Apps haben v√∂llig unterschiedliche Lebenszyklen. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Sie den Code des alten Beispiels in die React-Anwendung einf√ºgen, wird dieser Code nicht gestartet, da React nicht wei√ü, wie er aktiviert werden soll. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aufgrund unterschiedlicher Lebenszyklen versuchen React und die alte Engine m√∂glicherweise gleichzeitig, den Inhalt des alten Codes zu √§ndern, was zu unangenehmen Nebenwirkungen f√ºhren kann. </font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um diese Probleme zu l√∂sen, wurde eine gemeinsame Basisklasse f√ºr Komponenten zugewiesen, die alten Code enthalten. </font><font style="vertical-align: inherit;">Die Klasse erm√∂glicht es Erben, die Lebenszyklen von React- und Old-Style-Anwendungen zu koordinieren.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OldCodeBase</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span>&lt;<span class="hljs-title">T</span>&gt; </span>{<font></font>
<font></font>
    <span class="hljs-attr">ref</span>: React.RefObject&lt;HTMLElement&gt; = React.createRef();<font></font>
<font></font>
    componentDidMount() {<font></font>
        <span class="hljs-comment">//       DOM</span>
        <span class="hljs-keyword">this</span>.props.activate(<span class="hljs-keyword">this</span>.ref.current!); <font></font>
    }<font></font>
<font></font>
    componentWillUnmount() {<font></font>
        <span class="hljs-comment">//       DOM</span>
        <span class="hljs-keyword">this</span>.props.deactivate(<span class="hljs-keyword">this</span>.ref.current!); <font></font>
    }<font></font>
<font></font>
    shouldComponentUpdate() {<font></font>
        <span class="hljs-comment">// React     , </span>
        <span class="hljs-comment">//   React-. </span>
        <span class="hljs-comment">//     .</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    render() {<font></font>
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{this.ref}</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><font></font>
        );<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit der Klasse k√∂nnen Sie entweder Codeteile erstellen, die auf die alte Weise funktionieren, oder sie zerst√∂ren, w√§hrend keine gleichzeitige Interaktion mit ihnen stattfindet. </font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºgen Sie alten Code auf dem Server ein</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der Praxis besteht ein Bedarf an Wrapper-Komponenten (z. B. Popups), deren Inhalt beliebig sein kann, einschlie√ülich solcher, die mit alten Technologien erstellt wurden. </font><font style="vertical-align: inherit;">Sie m√ºssen herausfinden, wie Sie Code in solche Komponenten auf dem Server einbetten k√∂nnen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In einem fr√ºheren Artikel haben wir √ºber die Verwendung von Attributen gesprochen, um Parameter an neue Komponenten auf dem Client und Server zu √ºbergeben.</font></font><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">cool-app</span> <span class="hljs-attr">users</span>=<span class="hljs-string">"[1,2,3]"</span> /&gt;</span>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und jetzt wollen wir dort noch ein St√ºck Markup einf√ºgen, was in der Bedeutung kein Attribut ist. </font><font style="vertical-align: inherit;">Zu diesem Zweck wurde beschlossen, ein System von Slots zu verwenden.</font></font><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">cool-app</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ui:part</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"old-code"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>old component<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ui:part</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">cool-app</span>&gt;</span>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie im obigen Beispiel sehen k√∂nnen, wird im Code der Cool-App-Komponente ein alter Code-Slot beschrieben, der alte Komponenten enth√§lt. </font><font style="vertical-align: inherit;">Dann wird innerhalb der Reaktionskomponente die Stelle angezeigt, an der Sie den Inhalt dieses Steckplatzes einf√ºgen m√∂chten:</font></font><br>
<br>
<pre><code class="javascript hljs">render() {
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">UiPart</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"old-code"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><font></font>
    );<font></font>
}<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Server-Engine rendert diese Reaktionskomponente und rahmt den Inhalt des Steckplatzes in das &lt;ui-part&gt; -Tag ein, wobei ihr das Attribut data-part-id = "old-code" zugewiesen wird. </font></font><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">cool-app</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">ui-part</span> <span class="hljs-attr">data-part-id</span>=<span class="hljs-string">"old-code"</span>&gt;</span><font></font>
            old code<font></font>
        <span class="hljs-tag">&lt;/<span class="hljs-name">ui-part</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">cool-app</span>&gt;</span>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn das Server-Rendering von JS in GraalVM nicht in das Timeout passte, greifen wir auf das Client-Rendering zur√ºck. </font><font style="vertical-align: inherit;">Zu diesem Zweck gibt die Engine auf dem Server nur Slots an und rahmt sie in das Vorlagen-Tag ein, damit der Browser nicht mit ihrem Code interagiert.</font></font><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">cool-app</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">ui-part</span> <span class="hljs-attr">data-part-id</span>=<span class="hljs-string">"old-code"</span>&gt;</span><font></font>
            old code<font></font>
        <span class="hljs-tag">&lt;/<span class="hljs-name">ui-part</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">cool-app</span>&gt;</span>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was passiert auf dem Client? </font><font style="vertical-align: inherit;">Die Client-Engine scannt einfach den Komponentencode, sammelt die &lt;ui-part&gt; -Tags, empf√§ngt ihren Inhalt als Zeichenfolgen und √ºbergibt sie zusammen mit den √ºbrigen Parametern an die Rendering-Funktion.</font></font><br>
 <br>
<pre><code class="javascript hljs"><span class="hljs-keyword">var</span> tagName = <span class="hljs-string">'cool-app'</span>;
<span class="hljs-keyword">var</span> reactComponent = components[tagName];<font></font>
reactComponent.render({<font></font>
       <span class="hljs-attr">tagName</span>: tagName,
       <span class="hljs-attr">attrs</span>: attrs,
       <span class="hljs-attr">parts</span>: parts,
       <span class="hljs-attr">node</span>: element<font></font>
});<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Code der Komponente, die die Steckpl√§tze an der gew√ºnschten Stelle einf√ºgt, lautet wie folgt: </font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UiPart</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">OldCodeBase</span>&lt;<span class="hljs-title">IProps</span>&gt; </span>{<font></font>
<font></font>
	render() {<font></font>
		<span class="hljs-keyword">const</span> id = <span class="hljs-keyword">this</span>.props.id;
		<span class="hljs-keyword">const</span> parts = <span class="hljs-keyword">this</span>.props.parts;<font></font>
<font></font>
		<span class="hljs-keyword">if</span> (!parts.hasOwnProperty(id)) {
			<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
		}<font></font>
<font></font>
		<span class="hljs-keyword">return</span> React.createElement(<span class="hljs-string">'ui-part'</span>, {
			<span class="hljs-string">'data-part-id'</span>: id,
			<span class="hljs-attr">ref</span>: <span class="hljs-keyword">this</span>.ref,
			<span class="hljs-attr">dangerouslySetInnerHTML</span>: { <span class="hljs-attr">__html</span>: parts[id] }<font></font>
		});<font></font>
	}<font></font>
}<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gleichzeitig wird es von der OldCodeBase-Klasse geerbt, wodurch die Probleme der Interaktion zwischen dem alten und dem neuen Stapel gel√∂st werden. </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/ge/cc/a3/gecca3dlxac9crp48u9pvoyc4vs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt k√∂nnen Sie ein Popup schreiben und es mit dem neuen Stapel oder einer Anforderung vom Server mit dem alten Ansatz f√ºllen. </font><font style="vertical-align: inherit;">In diesem Fall funktionieren die Komponenten ordnungsgem√§√ü. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf diese Weise k√∂nnen Sie Standortkomponenten schrittweise auf einen neuen Stapel migrieren. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Genau dies war eine der Hauptanforderungen f√ºr das neue Frontend.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zusammenfassung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alle fragen sich, wie schnell GraalVM funktioniert. </font><font style="vertical-align: inherit;">Die Entwickler von Odnoklassniki f√ºhrten verschiedene Tests mit React-Anwendungen durch. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine einfache Funktion, die nach dem Aufw√§rmen einen String zur√ºckgibt, dauert etwa 1 Mikrosekunde. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Komponenten (erneut nach dem Aufw√§rmen) - je nach Gr√∂√üe zwischen 0,5 und 6 Millisekunden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GraalVM beschleunigt langsamer als V8. </font><font style="vertical-align: inherit;">Aber f√ºr die Zeit des Aufw√§rmens wird die Situation dank des Fallbacks f√ºr das Client-Rendering gegl√§ttet. </font><font style="vertical-align: inherit;">Da es so viele Benutzer gibt, heizt sich die virtuelle Maschine schnell auf.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was hast du geschafft?</font></font></h3><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºhren Sie JavaScript auf dem Server in der Java-Welt von Classmates aus.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstellen Sie isomorphen Code f√ºr die Benutzeroberfl√§che.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verwenden Sie einen modernen Stack, den alle Front-End-Anbieter kennen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstellen Sie eine gemeinsame Plattform und einen einzigen Ansatz zum Schreiben der Benutzeroberfl√§che.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Starten Sie einen reibungslosen √úbergang, ohne den Vorgang zu verkomplizieren und das Server-Rendering nicht zu verlangsamen.</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir hoffen, dass die Erfahrungen von Odnoklassniki und Beispiele f√ºr Sie n√ºtzlich sind und Sie sie f√ºr Ihre Arbeit finden.</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de486798/index.html">Gibt es ein GameDev in Sachalin? Ende</a></li>
<li><a href="../de486800/index.html">Kassandra. Wie man nicht stirbt, wenn man nur Oracle kennt</a></li>
<li><a href="../de486802/index.html">Menschen treffen auf Empfehlungssysteme. Faktorisierung</a></li>
<li><a href="../de486804/index.html">Globale Gesundheitsinformatik: Cloud-Technologien</a></li>
<li><a href="../de486808/index.html">Elektronischer Schwangerschaftstest aus einer Apotheke: wie es funktioniert</a></li>
<li><a href="../de486814/index.html">Zabbix: Die Netzwerktopologie ist klar und automatisch</a></li>
<li><a href="../de486818/index.html">Portierung von Quake auf den iPod Classic</a></li>
<li><a href="../de486820/index.html">70 Fragen zum Javascript-Interview</a></li>
<li><a href="../de486822/index.html">[An den Docks] Flattern. Teil 4. F√ºr Webentwickler</a></li>
<li><a href="../de486824/index.html">Schlechter Rat bei der Arbeit mit ANTLR</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>