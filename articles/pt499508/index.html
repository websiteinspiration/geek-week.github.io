<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçö üõ£Ô∏è üëåüèΩ Preparando nosso produto para escalar com as filas do Laravel ü¶ì üë©üèº‚ÄçüöÄ üòÜ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Uma tradu√ß√£o do artigo foi preparada especialmente para os alunos do curso ‚ÄúFramework Laravel‚Äù .
 
 
 
 Ol√°, sou Valerio, um engenheiro de software da...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Preparando nosso produto para escalar com as filas do Laravel</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/499508/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma tradu√ß√£o do artigo foi preparada especialmente para os alunos do curso </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúFramework Laravel‚Äù</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></i></b><br>
<br>
<img src="https://habrastorage.org/webt/ei/7u/aq/ei7uaq5c5omdkojxhmurjggkqw4.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ol√°, sou Valerio, um engenheiro de software da It√°lia. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este guia √© destinado a todos os desenvolvedores de PHP que j√° possuem aplicativos on-line com usu√°rios reais, mas que n√£o t√™m um entendimento mais profundo de como implementar (ou melhorar significativamente) a escalabilidade em seu sistema usando filas do Laravel. Eu aprendi sobre o Laravel no final de 2013 no in√≠cio da 5¬™ vers√£o do framework. Naquele momento, eu ainda n√£o era desenvolvedor envolvido em projetos s√©rios, e um dos aspectos das estruturas modernas, especialmente no Laravel, que me pareceu o mais incompreens√≠vel, foram as filas.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao ler a documenta√ß√£o, imaginei o potencial, mas sem experi√™ncia real em desenvolvimento, tudo isso permaneceu apenas no n√≠vel das teorias em minha cabe√ßa. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hoje, eu sou o criador </font></font><code>Inspector.dev</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">painel em tempo real</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que realiza milhares de tarefas a cada hora, e eu entendo essa arquitetura muito melhor do que antes. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ey/rx/qu/eyrxquvk3yrmu5kldbmpuit5riu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neste artigo, mostrarei como descobri filas e tarefas e quais configura√ß√µes me ajudaram a processar grandes quantidades de dados em tempo real, economizando recursos do servidor.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introdu√ß√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando um aplicativo PHP recebe uma solicita√ß√£o http de entrada, nosso c√≥digo √© executado sequencialmente passo a passo at√© que a solicita√ß√£o seja conclu√≠da e uma resposta seja retornada ao cliente (por exemplo, o navegador do usu√°rio). Esse comportamento s√≠ncrono √© verdadeiramente intuitivo, previs√≠vel e f√°cil de entender. Enviei uma solicita√ß√£o http para o terminal, o aplicativo extrai dados do banco de dados, converte-os para o formato apropriado, executa algumas tarefas adicionais e as envia de volta. Tudo acontece linearmente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tarefas e filas apresentam comportamento ass√≠ncrono que viola esse fluxo de linha. √â por isso que esses recursos me pareceram um pouco estranhos no come√ßo.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas, √†s vezes, uma solicita√ß√£o http recebida pode desencadear um ciclo de tarefas demoradas, por exemplo, enviando notifica√ß√µes por email a todos os membros da equipe. </font><font style="vertical-align: inherit;">Isso pode significar o envio de seis ou dez e-mails, o que pode levar quatro ou cinco segundos. </font><font style="vertical-align: inherit;">Portanto, toda vez que o usu√°rio clica no bot√£o correspondente, ele precisa esperar cinco segundos antes de poder continuar usando o aplicativo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quanto mais o aplicativo cresce, pior esse problema se torna.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que √© uma tarefa?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um trabalho √© uma classe que implementa o m√©todo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">handle</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que cont√©m a l√≥gica que queremos executar de forma ass√≠ncrona.</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">Queue</span>\<span class="hljs-title">ShouldQueue</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Foundation</span>\<span class="hljs-title">Bus</span>\<span class="hljs-title">Dispatchable</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Queue</span>\<span class="hljs-title">InteractsWithQueue</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Bus</span>\<span class="hljs-title">Queueable</span>;<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CallExternalAPI</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ShouldQueue</span>
</span>{
    <span class="hljs-keyword">use</span> <span class="hljs-title">Dispatchable</span>,
        <span class="hljs-title">InteractsWithQueue</span>,
        <span class="hljs-title">Queueable</span>;<font></font>
        <font></font>
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@var</span> string
     */</span>
    <span class="hljs-keyword">protected</span> $url;<font></font>
<font></font>
    <span class="hljs-comment">/**
     *    .
     *
     * <span class="hljs-doctag">@param</span> array $Data
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">$url</span>)
    </span>{
        <span class="hljs-keyword">$this</span>-&gt;url = $url;<font></font>
    }<font></font>
    <font></font>
<font></font>
    <span class="hljs-comment">/**
     *  ,   .
     *
     * <span class="hljs-doctag">@return</span> void
     * <span class="hljs-doctag">@throws</span> \Throwable
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle</span>(<span class="hljs-params"></span>)
    </span>{<font></font>
        file_get_contents(<span class="hljs-keyword">$this</span>-&gt;url);<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como mencionado acima, o principal motivo para concluir um trecho de c√≥digo no Job √© concluir uma tarefa demorada, sem for√ßar o usu√°rio a aguardar a conclus√£o.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que queremos dizer com "tarefas trabalhosas"?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta √© uma pergunta natural. </font><font style="vertical-align: inherit;">O envio de e-mails √© o exemplo mais comum usado em artigos que falam sobre filas, mas quero falar sobre a experi√™ncia real do que eu precisava fazer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como propriet√°rio de um produto, √© muito importante para mim sincronizar as informa√ß√µes de viagem do usu√°rio com nossas ferramentas de marketing e suporte ao cliente. </font><font style="vertical-align: inherit;">Assim, com base nas a√ß√µes do usu√°rio, atualizamos as informa√ß√µes do usu√°rio em v√°rios softwares externos via API (ou chamadas http externas) para fins de servi√ßo e marketing.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um dos pontos de extremidade mais usados ‚Äã‚Äãno meu aplicativo pode enviar 10 e-mails e fazer 3 chamadas http para servi√ßos externos antes da conclus√£o. </font><font style="vertical-align: inherit;">Nenhum usu√°rio vai esperar tanto tempo - provavelmente, todos eles simplesmente param de usar meu aplicativo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gra√ßas √†s filas, posso encapsular todas essas tarefas nas classes alocadas, transferir as informa√ß√µes necess√°rias para a execu√ß√£o de seu trabalho para o construtor e agend√°-las para serem conclu√≠das em uma data posterior em segundo plano, para que meu controlador possa retornar imediatamente a resposta.</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProjectController</span> 
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">store</span>(<span class="hljs-params">Request $request</span>)
    </span>{<font></font>
        $project = Project::create($request-&gt;all());<font></font>
        <font></font>
        <span class="hljs-comment">//  NotifyMembers, TagUserActive, NotifyToProveSource </span>
        <span class="hljs-comment">//   ,     </span>
        Notification::queue(<span class="hljs-keyword">new</span> NotifyMembers($project-&gt;owners));
        <span class="hljs-keyword">$this</span>-&gt;dispatch(<span class="hljs-keyword">new</span> TagUserAsActive($project-&gt;owners));
        <span class="hljs-keyword">$this</span>-&gt;dispatch(<span class="hljs-keyword">new</span> NotifyToProveSource($project-&gt;owners));<font></font>
        <font></font>
        <span class="hljs-keyword">return</span> $project;<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o preciso aguardar a conclus√£o de todos esses processos antes de retornar a resposta; </font><font style="vertical-align: inherit;">pelo contr√°rio, a espera ser√° igual ao tempo necess√°rio para public√°-los na fila. </font><font style="vertical-align: inherit;">E isso significa a diferen√ßa entre 10 segundos e 10 milissegundos !!!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quem executa essas tarefas depois de envi√°-las para a fila?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa √© a arquitetura cl√°ssica de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">editor / consumidor</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">J√° publicamos nossas tarefas na fila do controlador, agora vamos entender como a fila √© usada e, finalmente, as tarefas s√£o executadas. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pi/va/vr/pivavrbjasagc40trhmqpesyc2u.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para usar a fila, precisamos executar um dos comandos artesanais mais populares:</font></font><br>
<br>
<pre><code class="php hljs">php artisan queue:work</code></pre><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como diz a documenta√ß√£o: O </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Laravel inclui um trabalhador de fila que processa novas tarefas quando est√£o na fila.</font></font></i></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√ìtimo! </font><font style="vertical-align: inherit;">O Laravel fornece uma interface pronta para tarefas de enfileiramento e um comando pronto para usar para recuperar tarefas da fila e executar seu c√≥digo em segundo plano.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fun√ß√£o de supervisor</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Foi outra "coisa estranha" no come√ßo. Eu acho que √© normal descobrir coisas novas. Ap√≥s essa etapa do treinamento, escrevo esses artigos para ajudar a organizar minhas habilidades e, ao mesmo tempo, ajudar outros desenvolvedores a expandir seus conhecimentos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se a tarefa falhar ao lan√ßar uma exce√ß√£o, a equipe </font></font><code>queue:work</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interromper√° seu trabalho. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para que um processo </font></font><code>queue:work</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seja executado continuamente (consumindo suas filas), voc√™ deve usar um monitor de processo como o Supervisor para garantir que o comando </font></font><code>queue:work</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√£o pare de funcionar, mesmo que a tarefa gere uma exce√ß√£o.O </font><font style="vertical-align: inherit;">supervisor </font><font style="vertical-align: inherit;">reinicia o comando ap√≥s o travamento, iniciando novamente da pr√≥xima tarefa, deixando de lado a exce√ß√£o lan√ßada.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As tarefas ser√£o executadas em segundo plano no servidor, n√£o mais dependentes da solicita√ß√£o HTTP. </font><font style="vertical-align: inherit;">Isso introduz algumas mudan√ßas que eu tive que considerar ao implementar o c√≥digo da tarefa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√£o os mais importantes aos quais prestarei aten√ß√£o:</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como posso descobrir que o c√≥digo da tarefa n√£o est√° funcionando?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao executar em segundo plano, voc√™ n√£o pode perceber imediatamente que sua tarefa est√° causando erros. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ n√£o ter√° mais coment√°rios imediatos, como ao fazer uma solicita√ß√£o http do navegador. </font><font style="vertical-align: inherit;">Se a tarefa falhar, ela ser√° executada silenciosamente e ningu√©m notar√°. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considere a possibilidade de integrar uma ferramenta de monitoramento em tempo real, como o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inspector,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para apresentar todas as falhas.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ n√£o tem uma solicita√ß√£o http</font></font></h3><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o h√° mais solicita√ß√£o HTTP. </font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seu c√≥digo ser√° executado a partir do CLI. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ precisar de par√¢metros de consulta para concluir suas tarefas, precisar√° pass√°-los ao construtor de tarefas para uso posterior em tempo de execu√ß√£o:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-comment">//   </span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TagUserJob</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ShouldQueue</span>
</span>{
    <span class="hljs-keyword">public</span> $data;<font></font>
    <font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> $data</span>)
    </span>{
        <span class="hljs-keyword">$this</span>-&gt;data = $data;<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//       </span><font></font>
<font></font>
<span class="hljs-keyword">$this</span>-&gt;dispatch(<span class="hljs-keyword">new</span> TagUserJob($request-&gt;all()));</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ n√£o sabe quem fez login</font></font></h3><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o h√° mais uma sess√£o</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Da mesma forma, voc√™ n√£o saber√° a identidade do usu√°rio que efetuou login, portanto, se precisar de informa√ß√µes sobre o usu√°rio para concluir a tarefa, ser√° necess√°rio passar o objeto de usu√°rio para o construtor de tarefas:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TagUserJob</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ShouldQueue</span>
</span>{
    <span class="hljs-keyword">public</span> $user;<font></font>
    <font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">User $user</span>)
    </span>{
        <span class="hljs-keyword">$this</span>-&gt;user= $user;<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//       </span>
<span class="hljs-keyword">$this</span>-&gt;dispatch(<span class="hljs-keyword">new</span> TagUserJob($request-&gt;user()));</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entenda como dimensionar</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infelizmente, em muitos casos, isso n√£o √© suficiente. </font><font style="vertical-align: inherit;">Usar uma linha e um consumidor pode se tornar in√∫til em breve. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Filas s√£o buffers FIFO ("primeiro a entrar, primeiro a sair"). </font><font style="vertical-align: inherit;">Se voc√™ planejou muitas tarefas, talvez at√© de tipos diferentes, elas precisam esperar que outras pessoas concluam suas tarefas antes de conclu√≠-las. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° duas maneiras de escalar: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V√°rios consumidores por fila.Portanto</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/id/uu/0j/iduu0jzihjoqnm95edxdox7swim.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
, cinco tarefas ser√£o removidas da fila por vez, acelerando o processamento da fila. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Filas de finalidade especial</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Voc√™ tamb√©m pode criar filas espec√≠ficas para cada tipo de tarefa a ser iniciada com um consumidor dedicado para cada fila.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3r/0i/gv/3r0igvjwxthteiiqrx7p8exouz8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim, cada fila ser√° processada independentemente, sem aguardar a conclus√£o de outros tipos de tarefas.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Horizonte</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Laravel Horizon √© um gerenciador de filas que fornece controle total sobre quantas filas voc√™ deseja configurar e a capacidade de organizar os consumidores, permitindo que os desenvolvedores combinem essas duas estrat√©gias e implementem a que melhor se adapta √†s suas necessidades de escalabilidade. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O lan√ßamento ocorre atrav√©s do </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">horizonte php artisan em</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vez da </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fila php artisan: work</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Este comando varre seu arquivo de configura√ß√£o </font></font><code>horizon.php</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e inicia uma s√©rie de trabalhadores da fila, dependendo da configura√ß√£o:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-string">'production'</span> =&gt; [
    <span class="hljs-string">'supervisor-1'</span> =&gt; [
        <span class="hljs-string">'connection'</span> =&gt; <span class="hljs-string">"redis"</span>,
        <span class="hljs-string">'queue'</span> =&gt; [<span class="hljs-string">'adveritisement'</span>, <span class="hljs-string">'logs'</span>, <span class="hljs-string">'phones'</span>],
        <span class="hljs-string">'processes'</span> =&gt; <span class="hljs-number">9</span>,
        <span class="hljs-string">'tries'</span> =&gt; <span class="hljs-number">3</span>,
        <span class="hljs-string">'balance'</span> =&gt; <span class="hljs-string">'simple'</span>, <span class="hljs-comment">//   simple, auto  null</span><font></font>
<font></font>
    ]<font></font>
]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No exemplo acima, o Horizon iniciar√° tr√™s filas com tr√™s processos atribu√≠dos para processar cada fila. </font><font style="vertical-align: inherit;">Conforme mencionado na documenta√ß√£o do Laravel, a abordagem orientada a c√≥digo do Horizon permite que minha configura√ß√£o permane√ßa em um sistema de controle de vers√£o em que minha equipe possa colaborar. </font><font style="vertical-align: inherit;">Esta √© a solu√ß√£o perfeita usando uma ferramenta de IC. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para descobrir o significado dos par√¢metros de configura√ß√£o em detalhes, leia </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">este maravilhoso artigo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minha pr√≥pria configura√ß√£o</font></font></h3><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-string">'production'</span> =&gt; [
    <span class="hljs-string">'supervisor-1'</span> =&gt; [
        <span class="hljs-string">'connection'</span> =&gt; <span class="hljs-string">'redis'</span>,
        <span class="hljs-string">'queue'</span> =&gt; [<span class="hljs-string">'default'</span>, <span class="hljs-string">'ingest'</span>, <span class="hljs-string">'notifications'</span>],
        <span class="hljs-string">'balance'</span> =&gt; <span class="hljs-string">'auto'</span>,
        <span class="hljs-string">'processes'</span> =&gt; <span class="hljs-number">15</span>,
        <span class="hljs-string">'tries'</span> =&gt; <span class="hljs-number">3</span>,<font></font>
    ],<font></font>
]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Inspector usa principalmente tr√™s filas:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ingerir processos para analisar dados de aplicativos externos;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as notifica√ß√µes s√£o usadas para agendar notifica√ß√µes imediatamente se um erro for detectado ao receber dados;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O padr√£o √© usado para outras tarefas que eu n√£o quero misturar com os </font><font style="vertical-align: inherit;">processos de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ingest√£o</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">notifica√ß√£o</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com o uso do </font></font><code>balance=auto</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Horizon, ele entende que o n√∫mero m√°ximo de processos ativados √© 15, que ser√£o distribu√≠dos dinamicamente, dependendo do carregamento das filas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se as filas estiverem vazias, o Horizon suportar√° um processo ativo para cada fila, o que permitir√° ao consumidor processar a fila imediatamente se uma tarefa estiver agendada.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Observa√ß√µes finais</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A execu√ß√£o simult√¢nea em segundo plano pode causar muitos outros erros imprevis√≠veis, como o MySQL "Tempo limite de bloqueio" e muitos outros problemas de design. </font><font style="vertical-align: inherit;">Leia mais </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Espero que este artigo tenha ajudado voc√™ a usar filas e tarefas com mais confian√ßa. </font><font style="vertical-align: inherit;">Se voc√™ quiser saber mais sobre n√≥s, visite nosso site em </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.inspector.dev. </font></font></a><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anteriormente publicado aqui </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.inspector.dev/what-worked-for-me-using-laravel-queues-from-the-basics-to -horizonte</font></font></a></i><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entre no curso e obtenha um desconto.</font></font><br>
</a><br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt499490/index.html">Algoritmos Aleat√≥rios</a></li>
<li><a href="../pt499492/index.html">√â poss√≠vel que um desenvolvedor no Vale do Sil√≠cio se torne um milion√°rio? Staff Engineer analisando na Lyft</a></li>
<li><a href="../pt499502/index.html">Por que o OceanStor Dorado V6 √© o armazenamento mais r√°pido e confi√°vel</a></li>
<li><a href="../pt499504/index.html">Protocolo de rastreamento de contatos Bluetooth da Apple e do Google</a></li>
<li><a href="../pt499506/index.html">Pagamento por hora, pelo resultado ou sal√°rio?</a></li>
<li><a href="../pt499512/index.html">AHK no m√≠nimo. Encadernador</a></li>
<li><a href="../pt499516/index.html">In√≠cio do teste beta do plug-in para Rider e PVS-Studio C # para Linux / macOS</a></li>
<li><a href="../pt499518/index.html">A videoconfer√™ncia agora √© um mercado e novas tecnologias. Longrid, parte um</a></li>
<li><a href="../pt499522/index.html">–í—Å–µ –Ω–æ–≤–æ–≤–≤–µ–¥–µ–Ω–∏—è Windows 10 2004 (20H1)</a></li>
<li><a href="../pt499524/index.html">Quarkus: atualiza√ß√µes de aplicativos com o helloworld do JBoss EAP Quickstart</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>