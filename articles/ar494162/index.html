<!doctype html>
<html class="no-js" lang="ar">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ ๐ ๐ฉ๐พโ๐จ ุงุณุชูุดุงู ุฃุฎุทุงุก Postgres ูุฅุตูุงุญูุง ุจุงุณุชุฎุฏุงู pgCenter. ุฃูููุณู ููุณููุณูู ๐จ ๐๐พ โ๏ธ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุฃูุชุฑุญ ุฃู ุชุชุนุฑู ุนูู ูู ุดูุฑุฉ ุชูุฑูุฑ ุจุฏุงูุฉ ุนุงู 2019 ูู ูุจู ุฃูููุณู ููุณููุณูู - "ุงุณุชูุดุงู ุฃุฎุทุงุก Postgres ุจุงุณุชุฎุฏุงู pgCenter"
 

ูู ููุช ูุขุฎุฑ ุ ุชูุดุฃ ุงููุดุงูู ุนูุฏ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ุงุณุชูุดุงู ุฃุฎุทุงุก Postgres ูุฅุตูุงุญูุง ุจุงุณุชุฎุฏุงู pgCenter. ุฃูููุณู ููุณููุณูู</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/494162/"><p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃูุชุฑุญ ุฃู ุชุชุนุฑู ุนูู ูู ุดูุฑุฉ ุชูุฑูุฑ ุจุฏุงูุฉ ุนุงู 2019 ูู ูุจู ุฃูููุณู ููุณููุณูู - "ุงุณุชูุดุงู ุฃุฎุทุงุก Postgres ุจุงุณุชุฎุฏุงู pgCenter"</font></font></strong></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ููุช ูุขุฎุฑ ุ ุชูุดุฃ ุงููุดุงูู ุนูุฏ ุงุณุชุฎุฏุงู Postgres ุ ููููุง ุชู ุงูุนุซูุฑ ุนูู ูุตุงุฏุฑ ุงููุดููุฉ ูุฅุตูุงุญูุง ุจุดูู ุฃุณุฑุน ุ ูุงู ุงููุณุชุฎุฏููู ุฃูุซุฑ ุงูุชูุงููุง. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pgCenter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุนุจุงุฑุฉ ุนู ูุฌููุนุฉ ูู ุฃุฏูุงุช CLI ุงููุณุงุนุฏุฉ ููู ุฃุฏุงุฉ ูุนุงูุฉ ูุชุญุฏูุฏ ุงููุดููุงุช ูุฅุตูุงุญูุง ููุง ูุงูุขู. </font><font style="vertical-align: inherit;">ูู ูุฐุง ุงูุชูุฑูุฑ ุ ุณุฃุฎุจุฑู ุจููููุฉ ุงุณุชุฎุฏุงู pgCenter ุจุดูู ูุนุงู ููุนุซูุฑ ุนูู ุงููุดุงูู ูุฅุตูุงุญูุง ุ ูู ุฃู ุงููุฌุงูุงุช ููุจุญุซ ูููููุฉ ุงูุงุณุชุฌุงุจุฉ ููุดุงูู ูุนููุฉ ุ ุนูู ูุฌู ุงูุฎุตูุต ุ ููู:</font></font></p><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุญูู ููุง ุฅุฐุง ูุงู ูู ุดูุก ุนูู ูุง ูุฑุงู ูุน Postgres ุ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุนุซูุฑ ุจุณุฑุนุฉ ุนูู ุงูุนููุงุก ุงูุณูุฆูู ูุงููุถุงุก ุนูููู ุ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุญุฏูุฏ ุงูุทูุจุงุช ุงูุซูููุฉ ุ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงูุญูู ุงููููุฏุฉ ุงูุฃุฎุฑู ูุน pgCenter.</font></font></li>
</ul><br>
<p><img src="https://habrastorage.org/webt/qn/a4/mf/qna4mfqgy2rzglomcwb7vqfzf6c.png"></p><a name="habracut"></a><br>
<p> ,    .     Data Egret.   .    ,             PostgreSQL.</p><br>
<p>   ,      pgCenter  ,            .</p><br>
<p><img src="https://habrastorage.org/webt/yr/w0/xq/yrw0xql9iojdv71lootxkstpnp4.png"></p><br>
<p>  .      .  Linux, , .   -      Postgres'.    Postgres     .     PostgreSQL DBA.       ,    Postgres  .             .</p><br>
<p><img src="https://habrastorage.org/webt/un/iq/hn/uniqhn3vizz01sw-ehwfqinuou4.png"></p><br>
<p>          .    : Slack, Telegram.      -     .        .</p><br>
<p><img src="https://habrastorage.org/webt/by/b_/v5/byb_v5zrziwqg7uynekxbgicm5g.png"></p><br>
<p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"></a>  ,    ,     Linix.    .  ,   Linux       .  ,       ,  .</p><br>
<p><img src="https://habrastorage.org/webt/dw/9v/fx/dw9vfxixzbtylmq8ngyde_m0tac.png"></p><br>
<p>      ,       Postgres.    Postgres.  -    Postgres'.     Postgres.      Postgres.</p><br>
<p><img src="https://habrastorage.org/webt/h6/yh/wi/h6yhwi0yvjcmfvtwcsp4lpd1-ew.png"></p><br>
<p> Postgres   .    Postgres         Postgres.  ,  Postgres      (views),        .</p><br>
<p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"></a>.       .     .        - .</p><br>
<p><img src="https://habrastorage.org/webt/qs/is/z5/qsisz5kh0nwff3fnhyuuedmi4ac.png"></p><br>
<p>     - ,     ,   ,  , ,  .   - .     : ยซ ?ยป, ยซ ?ยป  ยซ   ?ยป.      ,    .</p><br>
<p><img src="https://habrastorage.org/webt/hy/1d/js/hy1djsfn24oaxtvtoenwfutnae0.png"></p><br>
<p>      ,              ,     ,   ,      . -          <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">pgCenter</a>.</p><br>
<p>     .   ,     TOP- . </p><br>
<p> -   ,  C    . ..    .      Golang,      ,     .        .</p><br>
<p>Go       pgCenter   .               .     ,    ,  ,  targz, deb-  rpm-     . ..    - ,  make, GCC  Golang.     ,     ,            .</p><br>
<p><img src="https://habrastorage.org/webt/r_/ml/jv/r_mljvrlw4cy-on_0xjshhku_p8.png"></p><br>
<p>  pgCenter     ,   top-        (  ).</p><br>
<p><img src="https://habrastorage.org/webt/ec/zn/ll/ecznll_0zub4khs1n2jmokshn30.png"></p><br>
<p>      .      ,        .        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">wait_events</a>.    ,         -.</p><br>
<p><img src="https://habrastorage.org/webt/ky/ug/ln/kyuglnhkaayl8bu3h1fc08uzz48.png"></p><br>
<p>        PSQL.     Postgres,     PSQL        Postgres.  pgCenter  ,   ยซpgcenter topยป   postgres       -  (-,    ).</p><br>
<p><img src="https://habrastorage.org/webt/9q/h_/m_/9qh_m_wcabojkl4lpuxcksrp9ae.png"></p><br>
<p>   ,           -  ,   ,     ,       ,     PSQL,     ,   ,        .</p><br>
<p><img src="https://habrastorage.org/webt/1t/f9/bw/1tf9bw-l988uxgquo3_vxflodfu.png"></p><br>
<p>     ,    UNIX-, . . go' ,     pgCenter       ,    UNIX.</p><br>
<p><img src="https://habrastorage.org/webt/c1/6h/vm/c16hvmt1ulij9-dtagepnodbtxq.png"></p><br>
<p> ,       libpq.      , , pg_stat_statements      pgCenter    ,       .   .</p><br>
<p><img src="https://habrastorage.org/webt/7s/vg/kx/7svgkxnps7ythlgby1qopvdffmy.png"></p><br>
<p>       (pgcenter top).    ,   ,    .  ,   -   .  ,  ,    .       .   ,   pgCenter,   top-,    .</p><br>
<p><img src="https://habrastorage.org/webt/mx/xj/9y/mxxj9ydlc1chuzs0y6rkbtfop2w.png"></p><br>
<p>  โ  .       .</p><br>
<p><img src="https://habrastorage.org/webt/ty/ex/8x/tyex8xl56ktalumc-pddn1sigo4.png"></p><br>
<p>  โ   ,      Postgres.     -    ,  Postgres    .</p><br>
<p><img src="https://habrastorage.org/webt/66/ku/np/66kunpjqe9jcqa3kas1dhrbrghe.png"></p><br>
<p>   โ      (views).    stat-,    Postgres,       .</p><br>
<p><img src="https://habrastorage.org/webt/a7/sd/ar/a7sdarvtow0y-pcvvedv7ckkqjs.png"></p><br>
<p> ,    .   -,    .         . ,    ,    ,     ,  . .</p><br>
<p>   ,   .        (regexp).          . ,    ,    - :   .</p><br>
<p><img src="https://habrastorage.org/webt/pf/mw/vx/pfmwvxrsdgjc_12luq9vaebret8.png"></p><br>
<p>    ,                  pgCenter.     โ             - .</p><br>
<p><img src="https://habrastorage.org/webt/hj/or/qw/hjorqwuc5pn4khboewm2ou3cim0.png"></p><br>
<p>    ,    USE .     .    -   ,     .</p><br>
<p><img src="https://habrastorage.org/webt/as/ez/_h/asez_hivnpftponwarhsbp9dr5g.png"></p><br>
<p>      .       . ,      Top,        .    : ,   ..</p><br>
<p><img src="https://habrastorage.org/webt/lz/ic/el/lzicel6s5y1g6kwfam-lc9zkbig.png"></p><br>
<p>    ,           :      ,  ,  .</p><br>
<p><img src="https://habrastorage.org/webt/np/4l/vj/np4lvjczw7fxixq-2p1sdjjuuek.png"></p><br>
<p>, , swap.     swap,      ,        swap.           โ        .</p><br>
<p><img src="https://habrastorage.org/webt/6m/qd/g9/6mqdg9yw1ns3ap8_zzg97unyik4.png"></p><br>
<p>-  : ยซ    -  ?ยป.    .     ,     .</p><br>
<p><img src="https://habrastorage.org/webt/2n/1u/uk/2n1uukefmeisgx0ixat60is_hmc.png"></p><br>
<p>          ,      โ     -     Postgres.    uptime. , uptime  Postgres โ   ,      ,   .     ,      Postgres        .</p><br>
<p><img src="https://habrastorage.org/webt/yg/ie/60/ygie60a26gqjyhbolxqbl-1eip0.png"></p><br>
<p>       .   ,    Postgres,   .      ,    ,      . . .          .</p><br>
<p><img src="https://habrastorage.org/webt/vb/7s/7y/vb7s7yoxlu5dbg4e3lizbxjc6qm.png"></p><br>
<p>, , .  ,    ,   .      ,      . ,       .     -    .</p><br>
<p><img src="https://habrastorage.org/webt/-l/7c/kb/-l7ckbjhj4dsylg-a7x2qcabtok.png"></p><br>
<p>  ,   Postgres MVCC  .   MVCC .       ,     .            .</p><br>
<p><img src="https://habrastorage.org/webt/gh/j7/le/ghj7le7a-7l1u3ysgpq5wryj9lc.png"></p><br>
<p>             'd'.</p><br>
<p>  ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">pg_stat_database</a>       ,     ยซrollbacksยป.       ยซROLLBACKยป,           /.       (constraints),       . .      ,    . </p><br>
<p>   pg_stat_database       (conflicts)   (deadlocks).  ,    ,    ,    -   .</p><br>
<p><img src="https://habrastorage.org/webt/6n/wk/h2/6nwkh22oadmefjnbvfwleno31bo.png"></p><br>
<p>,   pgCenter.          ,        . -, : </p><br>
<ul>
<li><p>top</p><br>
</li>
<li><p>vmstat</p><br>
</li>
<li><p>iostat</p><br>
</li>
<li><p>nicstat</p><br>
</li>
<li><p>pg_stat_activity</p><br>
</li>
<li><p>pg_stat_statements</p><br>
</li>
</ul><br>
<p>     ,        . </p><br>
<p><img src="https://habrastorage.org/webt/wa/m4/ho/wam4hohz7mx6rv62czpzxzmymzm.png"></p><br>
<p>,      ,    -    .</p><br>
<p><img src="https://habrastorage.org/webt/i7/cs/bj/i7csbjggspmjmj6k7igcgk-g5n4.png"></p><br>
<p>   .      ,    ,     . . .  CPU usage โ 85 %.    ,       - .    ,      . ,   Postgres.      Postgres  ,          .</p><br>
<p><img src="https://habrastorage.org/webt/4i/q9/si/4iq9si3nflmq2gjob7ux81ns_bi.png"></p><br>
<p>      ,   ,    38  ,  - .       state:  waiting   idle_xact. Waiting   0, . .           .   ,    20 idle . ,        (xact_age)   โ       .   ,     .     โ 15 .   ,         .</p><br>
<p><img src="https://habrastorage.org/webt/bs/jm/zm/bsjmzmekxk9m89iyi-incu4pkli.png"></p><br>
<p>(:     pg_stat_statements.    pg_stat_statements   "x",    .   "shift + x"     pg_stat_statements_timings.    "pg_stat_statements not available on this database",     pg_stat_statements   postgres   postgres: <code>create extension pg_stat_statements;</code>)</p><br>
<p>    ,       () .   ,      .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">pg_stat_statements</a>.  contrib.      :   ,   .  contrib     ,     .  ,   -.        Postgres โ  pg_stat_statements.</p><br>
<p>,     .    ,      .    .    ,       CPU     pg_stat_statements.      โ       2   .   <code>SELECT COUNT (*) FROM "game_competition_events"</code>. . .     ,     ,      ,    ,     .  ,   - ,  ,       -.        ,    .</p><br>
<p>    .     total_time.   total_time     ,    ,     /:     . ,       ยซt_cpu_tยป.    .       .</p><br>
<p><img src="https://habrastorage.org/webt/rb/tx/tb/rbtxtb-h59duuj5rnzav8t_kueg.png"></p><br>
<p>   ,            .     ,       ,       ยซcpu_tยป, ,  , .   snapshot    ,   ,    .     .  <code>SELECT "courses_logs".* FROM course_logs</code>.   ,       5   .   ,    , , ,     . </p><br>
<p>      ยซcallsยป,    ,    .    . . .     .</p><br>
<p><img src="https://habrastorage.org/webt/be/vf/8_/bevf8_xi1tr4u8gthw1femyeqts.png"></p><br>
<p>    ,     .  Top        pg_stat_activity   pg_stat_statements.    pgCenter          . </p><br>
<p><img src="https://habrastorage.org/webt/lu/8u/wm/lu8uwmka4hdvnqe2ky2a5m46ave.png"></p><br>
<p>  โ    -.   ,        ,      ,   -.</p><br>
<p><img src="https://habrastorage.org/webt/5r/w4/86/5rw486zd8afdszdzbkvmjuvbwt8.png"></p><br>
<p>    .       ,          -   โ 27 %.     ,    -.</p><br>
<p><img src="https://habrastorage.org/webt/gp/lb/2v/gplb2vl2exzmefukpqvmqgpr0uc.png"></p><br>
<p>       ,      ยซbackground workerยป.   ,         .</p><br>
<p><img src="https://habrastorage.org/webt/vo/jl/cf/vojlcftweu-mwgx0gyzfvgsrz_w.png"></p><br>
<p>   ยซwait_eventยป.   ,       -. . .         .</p><br>
<p><img src="https://habrastorage.org/webt/yp/sq/qo/ypsqqopecjuawv5sybz6ueti4iq.png"></p><br>
<p>        -.     'B'    iostat.       .  ,      99 %.     โ     ,      NVME.        ,    latency.</p><br>
<p><img src="https://habrastorage.org/webt/f0/ty/vu/f0tyvuxnxpzfx0yjkujqtplvafu.png"></p><br>
<p>   latency,  latency        1 .    .</p><br>
<p> ,        .    ,   SSD  NVME-   -   ,      ,     latency.       latency,   ,          - .</p><br>
<p><img src="https://habrastorage.org/webt/e1/xe/ka/e1xekaqycwcpc248k_ak-xzcitc.png"></p><br>
<p>     ,      -.    pg_stat_statements      ,   -.   ยซt_read_tยป, . . ,        . </p><br>
<p>         .   ยซread_tยป.      ,          -,    .</p><br>
<p>     /     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">track_io_timing</a>.</p><br>
<p>            ,     ,     .  pgCenter      queryid.    .     ,    pg_stat_statements.   .      . . . pgCenter          .        queryid.  pgCenter  .</p><br>
<p><img src="https://habrastorage.org/webt/fp/3x/jj/fp3xjj2ninlijbpv5ftokqbud5s.png"></p><br>
<p>    :</p><br>
<ul>
<li><p>  โ  summary,       ,    pg_stat_statements.   ,    ,   -.</p><br>
</li>
<li><p>       ,   ,         summary.              .</p><br>
</li>
<li><p>, ,   . </p><br>
</li>
</ul><br>
<p>  ,    ,        .</p><br>
<p><img src="https://habrastorage.org/webt/ix/7o/56/ix7o56r1vbmc7b_ohgunxzowrxs.png"></p><br>
<p>  ,     ,    ,      top, iostat   pg_stat_activity, pg_stat_statements.      ,       .</p><br>
<p><img src="https://habrastorage.org/webt/cq/lu/8k/cqlu8k4bvwzoi6-evsgvw1lu-he.png"></p><br>
<p>   โ    ,    -.   Postgres     ,       .</p><br>
<p>:</p><br>
<ul>
<li><p>Checkpointer pocess.</p><br>
</li>
<li><p>WAL writer process.</p><br>
</li>
<li><p>Autovacuum workers.</p><br>
</li>
<li><p>Background workers.</p><br>
</li>
</ul><br>
<p>   pgCenter     ,     ,       . </p><br>
<p><img src="https://habrastorage.org/webt/jj/x7/ut/jjx7utmlxkdaeb7uh8vtyr4vnm4.png"></p><br>
<p>,        :  -    ,     .     ,   ,      .</p><br>
<p><img src="https://habrastorage.org/webt/bf/dt/ma/bfdtmaslqkiiiilzlluqvg2ocfu.png"></p><br>
<p>     ,     ,      .     - .</p><br>
<p><img src="https://habrastorage.org/webt/hh/uy/mn/hhuymnjtf6zjdpubpertpzphy5e.png"></p><br>
<p>     .</p><br>
<p><img src="https://habrastorage.org/webt/l4/a4/vv/l4a4vvjtnowhf8fl_w2vhynmoie.png"></p><br>
<p>        .    ,   ,    22      21      .    ,  -   .</p><br>
<p><img src="https://habrastorage.org/webt/i9/fs/a5/i9fsa52ag9kwg_5clfbyrswrsi8.png"></p><br>
<p>   wait_event  ,   ,         . . . -  - ,         ,      .</p><br>
<p><img src="https://habrastorage.org/webt/ae/l3/ye/ael3ye_vydpudqcrho-xmqljguu.png"></p><br>
<p>    ,       (idle in transaction).    ,   6 .        .</p><br>
<p><img src="https://habrastorage.org/webt/hh/pa/jy/hhpajyn-3_7ld00momu8b7k_gk0.png"></p><br>
<p>    ,   ,     10- ,       .    ,     ,  7    .          10- .</p><br>
<p><img src="https://habrastorage.org/webt/ag/zy/rt/agzyrtdg9-nrmhktrg3ub_fx5eu.png"></p><br>
<p>   wait_etype, wait_event  ,    ,   ,            (Client:Client Read).   , - ,     -  . , , -  ,      ,    .           ,    ,            .</p><br>
<p>   โ    .   : pg_cancel_backend  pg_terminate_backend.    ,      backend.  pgCenter    .         backend     pid,       .</p><br>
<p><img src="https://habrastorage.org/webt/py/ck/gj/pyckgjbcaf1rc5gtq1vjkxbjaiw.png"></p><br>
<p>       :</p><br>
<ul>
<li><p>Pg_stat_activity.</p><br>
</li>
<li><p>Pg_stat_statements.</p><br>
</li>
<li><p>Pg_cancel_backend ().</p><br>
</li>
<li><p>Pg_terminate_backend ().</p><br>
</li>
</ul><br>
<p><img src="https://habrastorage.org/webt/rt/ij/jm/rtijjm-xng842mjtnyemrf_o-dw.png"></p><br>
<p> ,    . ,  ,      . </p><br>
<p>      .         ,      .    - .     ,         ( ,   ,  ).  -  ,     ,       idle transaction    .             โ   .</p><br>
<p><img src="https://habrastorage.org/webt/sh/qw/rh/shqwrhk9o1v9zxcfi-vgobnb-fu.png"></p><br>
<p>  โ             .        ,        (deadlocks)      .</p><br>
<p><img src="https://habrastorage.org/webt/ff/tq/f6/fftqf6fvkjgpkhceg33r8p-ti9c.png"></p><br>
<p>.   ALTER TABLE,  , ,    .    . ,  ,   11-            .           Postgres,    .     ALTER            .</p><br>
<p><img src="https://habrastorage.org/webt/vq/lt/xs/vqltxssnw69vhtlzaieaygbd0hy.png"></p><br>
<p>   โ  CREATE INDEX  CONCURRENTLY,  -  ,   ,    .          .</p><br>
<p><img src="https://habrastorage.org/webt/-r/uz/hf/-ruzhfbfuydomh9gk_uiqq2rx24.png"></p><br>
<p>   , ..   ,   production   Postgres  ,            .</p><br>
<p><img src="https://habrastorage.org/webt/dd/yh/we/ddyhwentwfs65a09cmc195zpuoa.png"></p><br>
<p>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">pg_stat_replication</a>.   ,   Postgres,          .</p><br>
<p> pgCenter   pg_stat_replication.       ,  ,   .</p><br>
<p>      5 .       .</p><br>
<p><img src="https://habrastorage.org/webt/5h/dh/an/5hdhaneor7w8-wrzj7xs0_sbqgc.png"></p><br>
<p>    ,    ,       .    2 walreceiver, . .   2 .</p><br>
<p><img src="https://habrastorage.org/webt/0z/kt/jp/0zktjpvqmouvpu3tivmsgdas6eu.png"></p><br>
<p>   ,      ,         ,    .   , , -   .  , ,   โ     -       .</p><br>
<p>, pg_stat_replication   ,           .          1,5 GB.  replay_lag   โ 2 .      .        .       2- .             2 , . .    .</p><br>
<p><img src="https://habrastorage.org/webt/bf/cp/qx/bfcpqxfzhmcka2_przsngz6jhs0.png"></p><br>
<p>     ,   ,     2 pg_basebackup  1 pg_receivewal. Pg_basebackup โ         .     pg_stat_replication.  pg_receivewal โ  ,         . . . ,  ,   .   -  ,     .</p><br>
<p><img src="https://habrastorage.org/webt/29/q5/z0/29q5z0bsl59k_q3m7prh_a5m9pi.png"></p><br>
<p>    pg_stat_replication       .  .   ,      5 . : pending, write, flush, replay, total_lag. . .     . </p><br>
<p>Pending โ     ,   .        .</p><br>
<p>Write โ      ,      , . .     . </p><br>
<p>Flush โ       ,       .</p><br>
<p>Replay โ      .    .</p><br>
<p>Total_lag โ         .</p><br>
<p>,     ,    ,   - ,    . ,     ;   ,    ;      ,      ,     .</p><br>
<p><img src="https://habrastorage.org/webt/gf/8i/ij/gf8iijwr61pkhdylduyhqavz0ws.png"></p><br>
<p> ,     .   .     ,  ,    .</p><br>
<p><img src="https://habrastorage.org/webt/qu/dy/ag/qudyageigyjrprl7ob74vczyrio.png"></p><br>
<p>   โ     , . .    โ     ,    .       Postgres,    .     ,   -  .</p><br>
<p><img src="https://habrastorage.org/webt/2u/4d/x0/2u4dx0bujjdlddgtnm1e6rvjnyc.png"></p><br>
<p>      :</p><br>
<ul>
<li><p>pg_stat_replication.</p><br>
</li>
<li><p>pg_wal_lsn_diff().</p><br>
</li>
<li><p>pg_current_wal_lsn().</p><br>
</li>
<li><p>pg_last_commited_xact().</p><br>
</li>
</ul><br>
<p><img src="https://habrastorage.org/webt/lj/l-/lx/ljl-lx1ukvsvfnthbpzh5uyzb_k.png"></p><br>
<p>     ,        . </p><br>
<p><img src="https://habrastorage.org/webt/dz/uk/4i/dzuk4i7gn_b0evxafqlgowz-q0m.png"></p><br>
<p>,  top     .   โ   Seq Scan,  update, delete, insert,    .</p><br>
<p><img src="https://habrastorage.org/webt/nl/e7/ss/nle7ssgxr15rgjddnfjv0aiscdi.png"></p><br>
<p>  .    .            .</p><br>
<p><img src="https://habrastorage.org/webt/ac/4b/zu/ac4bzu9golpff9rger53zojeyse.png"></p><br>
<p>  .  ,      ,    .   ,      .</p><br>
<p><img src="https://habrastorage.org/webt/rq/j-/bu/rqj-buxh0ebqgbwgdchhnny8xly.png"></p><br>
<p>, , pg_stat_progress_vacuum   9.6. ,   ,    ,   ,   ,           .  pg_stat_progress_vacuum โ            .  ,     . , ,  ,    .     ,  .</p><br>
<p><img src="https://habrastorage.org/webt/l4/ze/ro/l4zeroomn-ai2mwdkzh-wzgpna4.png"></p><br>
<p>  ,     .   ,    , . .       postgresql.conf, -         reload.     , ,      .</p><br>
<p>     .    ,    ,          .       .        ,     .</p><br>
<p>    psql, . .          psql   ,      pgCenter.     - ,             pgCenter,     psql    .</p><br>
<p><img src="https://habrastorage.org/webt/pz/n8/do/pzn8doxswlxet4kbntn3dgwmrau.png"></p><br>
<p>top- โ   ,     pgCenter.   top    ,     pgCenter.  record  report.</p><br>
<p>  ,           .            .     report  ,  ,   Top.       โ    .</p><br>
<p><img src="https://habrastorage.org/webt/-n/en/ms/-nenmsxqwjmvaizdhqqvdpqj6nq.png"></p><br>
<p>     -.    - ,   record.               .         .</p><br>
<p><img src="https://habrastorage.org/webt/lu/e0/wb/lue0wborpecwc8rtmx_8zjftttm.png"></p><br>
<p>     wait_eventโ,       ,         .</p><br>
<p><img src="https://habrastorage.org/webt/fd/bk/mj/fdbkmj5xbm8irymj4ccrbi-dohq.png"></p><br>
<p>  : SELECT       .  ,   ,  ,  44 %   ,  -  ,    โ   -   ,    .</p><br>
<p><img src="https://habrastorage.org/webt/nj/fd/iz/njfdizke09pnj36updzdsxlpw6g.png"></p><br>
<p> :  VACUUM FULL.  ,     VACUUM FULL    IO   ,     12 %.     ,         ,           .</p><br>
<p></p><br>
<p><em>  !    .   .      .    , , pg_stat_statements,    query    .   -      -    ?</em></p><br>
<p> ,   .    ,     ,  , , -  ,     .  ,   ,  -  .     .  -          . . .   ,   ,  -.   ,     ,   .  ,    ,    . </p><br>
<p><em>      .    ,     rollbacks.     rollbacks,       rollbacks,    .</em> </p><br>
<p>,  , ,     pg_stat_database   .    rollbacks  . </p><br>
<p><em>   pg_stat_statements  rollbacks, .</em></p><br>
<p><em>,  .   .   `SELECT </em> FROM pg_stat_database JNOIN pg_stat_statements`    pg_stat_statements,    rollbacks   ,    .  .   ,             10-20 .</p><br>
<p><em>,   !     Postgres   ?</em></p><br>
<p>     9.0-9.1,    C .  - ,    ,  ,            ,   . Go  ,   9.4.    9.4  ,    SELECTโฆ where filter.    .    (9.3)  .                  .    ,     ,    .       , , ,  ,   .</p><br>
<p><em>,   !    ,     TOP.    .</em> </p><br>
<p> ,     ,    . ,   โ  .    less ( ),   โ   ,     .</p><br>
<p><em>     .      TOP    ?</em></p><br>
<p>.       , , ,   .    ,    . ,  .    ,  ,          . </p><br>
<p><em>  !       . ,   .  ,     85% CPU usage,  ,   .         pg_stat_statements.     .   ,   .</em> </p><br>
<p> .    CPU   .  โ t_all_t.          pg_stat_statements. ,    .       ,          .    t       . . .        ยซtยป.         . . .   ,       .</p><br>
<p><em> .     ,     pg_stat_statements,     ?</em></p><br>
<p>     pg_stat_statements       real time.</p><br>
<p><em>   ,   pg_stat_statements   ,   85 CPU usage โ  .</em> </p><br>
<p>,   .        ,   pg_stat_statements .   ,      ,        ,   10  ,     .      10   โ   ,   , ,  atop.   atop ?</p><br>
<p><em>, .      pg_stat_statements,  CPU,  ,   ,    pg_stat_statements.</em></p><br>
<p>    . , Grafana,                . . . pgCenter โ  ,      ,   ,  ,  .</p><br>
<p><em>     . pgCenter   atop     ,       Grafana?</em></p><br>
<p>  pgCenter report  pgCenter record, . .       . ,    ,      . . .,  ,   pgCenter report   , ,  pg_stat_database           sar .    .     atop,    .</p><br>
<p><em>,  !       ,  Postgres,  , ,   .   ,     .       ?   ?</em></p><br>
<p>   10 .    ยซ-fยป,    . ,    , ,  10      .  ,  pg_stat_activity  ,     .    .     ,  . , ,   50 .  ,      ,      1-2 %. . .    ,   ,    - 0,5-2 % . </p><br>
<p><em>     .  ,  - .</em></p><br>
<p>,   . ,      ,  0,04 %  . ,  ,   .   -    .</p><br>
<p><em>     .</em> </p><br>
<p>  ,     .</p><br>
<p><em>,   !    .   wait_event Running โ   ?</em></p><br>
<p>.</p><br>
<p><em>      CPU.</em></p><br>
<p>,  . . .   ,  wait_events   PID ,   ,  backend  -  ,    , - .     Running,   , . .     . </p><br>
<p><em>      CPU?</em></p><br>
<p>,    CPU, . .   - .   .</p><br>
<p><em>!   !    - , , Ubuntu?</em></p><br>
<p>     C,     . ,  ,    .     PDGD     Ubuntu.   Launchpad  ,    -   .   .     ,  .    Go    -, dev-.     .       ,  travis-ci    build,    build       . . .    Realeses,     .     wget,   ,    tarโ ,    .</p><br>
<p><em>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">Goreleaser</a>,    .    .</em></p><br>
<p>,   GO   .    ,    .   ,   SOLID.  ,   ,  Goreleaser ,   ,  ,   .  Cโ    ,    .      ,     Realeses.   !</p><br>
<p>Updated. Goreleaser  ,    !</p><br>
<p><em>,    queryid.    queryid.   ,          .     ?</em></p><br>
<p>, .      ,     -     .       ,  .      - .     .         .     ,         .      .      .   .      ,      ,   .</p><br>
<p><em>,   ,   queryid โ   .</em> </p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุนู ุ ููุฒ ุนุฑุถ ุงูุนููุฏ ูู ุงูุจุฏุงูุฉ ููุงู ูุฒุนุฌูุง. </font><font style="vertical-align: inherit;">ููุช ุจุฅุตูุงุญู ูู ูุฑุน dev ุ ููู ูุฐุง ููุณ ุจุนุฏ ูู ุงููุฑุน ุงูุฑุฆูุณู. </font><font style="vertical-align: inherit;">ูู ููุชุตู ูุจุฑุงูุฑ ุ ุฃุฑูุฏ ุฅุตุฏุงุฑ Profiler Event. </font><font style="vertical-align: inherit;">ูุณูููู ุนุฑุถ ุนููุฏ ุซุงุจุช ููุท.</font></font></p><br>
<p><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนุธูู.</font></font></em> </p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุนู ุ ููููู ุถุจุท ุงูุนุฑุถ ูู ุฎูุงู ุงูุฃุณูู.</font></font></p><br>
<p><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุดูุฑุง ูู ุงูููุณู!</font></font></em></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุดูุฑุง ุฌุฒููุง ูู!</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุฏูู:</font></font></p><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/eX0gq3Ql0lo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar494150/index.html">ClickHouse ูู ุฃููุชู: ููุงุกุงุช ุญูุฉ ูุน ุฃูููุณู ููููููุฏูู</a></li>
<li><a href="../ar494152/index.html">HoughNet: ุงุจุญุซ ุนู ููุงุท ุงูุชูุงุดู ุงููุตุญูุจุฉ ุจุฎูุงุฑุฒููุฉ ููุงุณูููุฉ</a></li>
<li><a href="../ar494154/index.html">ููู ูููุง ุจุชุณุฑูุน ุชุฑููุฒ ุงูููุฏูู ุซูุงูู ูุฑุงุช</a></li>
<li><a href="../ar494156/index.html">ููููุฉ ุงูุนูู ูู ุงูููุฒู - ุชุฌุฑุจุฉ ูุฒููุงุช ุจููุณู</a></li>
<li><a href="../ar494158/index.html">ููููุฉ ุงูุญูุงุธ ุนูู ุฌูุฏุฉ ุงูุนูู ูู ุงูุญุฌุฑ ุงูุตุญู</a></li>
<li><a href="../ar494164/index.html">ููููุฉ ุชุญุณูู ุฃุฏุงุก ุงููุฑู ุงูุฑุดููุฉ ูู ุฎูุงู ุงูุงุฎุชุจุงุฑ</a></li>
<li><a href="../ar494170/index.html">ุฃูู 3 ููุฒุงุช ูู Python ูุง ุชุนุฑููุง (ุฑุจูุง)</a></li>
<li><a href="../ar494176/index.html">ูุณุงู ุงูุดูุทุงู ุงูุฃุญูุฑ: ุงูุชูุงุตู ุงููููู ูู ุงูุธูุงู</a></li>
<li><a href="../ar494180/index.html">ุฃูุนุงุจ ุงูุณุญุงุจ: ุงุฎุชุจุงุฑ ุงูุฅุฌูุงุฏ 5 ุฎุฏูุงุช ูุนุจุฉ ุงูุณุญุงุจ ูุน ุงูุฅูุชุฑูุช ุงูุณูุฆ</a></li>
<li><a href="../ar494182/index.html">ููู ููุง ูุฎุทุฆูู ูุน monoliths ุ udalenka ุ ุงูุฅุฑุซ ุ ุงูุฑูุถ ูู REST API ูุงูุฎุทูุงุช ุนุจุฑ ุงูุฅูุชุฑูุช</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>