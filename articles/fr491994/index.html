<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üí∫ üíæ üñïüèæ Migration de Cocoapods vers Swift Package Manager üÜö üè• üöµüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cocoapods est consid√©r√© comme le gestionnaire de d√©pendances le plus populaire pour iOS. Au cours des derni√®res ann√©es, Apple a travaill√© au d√©veloppe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Migration de Cocoapods vers Swift Package Manager</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tinkoff/blog/491994/"><img src="https://habrastorage.org/webt/bv/n3/y-/bvn3y-5hsjuzzklwmjexygcmudm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cocoapods est consid√©r√© comme le gestionnaire de d√©pendances le plus populaire pour iOS. Au cours des derni√®res ann√©es, Apple a travaill√© au d√©veloppement de son gestionnaire de d√©pendance natif Swift Package Manager (SPM). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Initialement, son utilisation n'√©tait possible que pour les applications Swift ou terminaux c√¥t√© serveur. SPM a √©t√© ex√©cut√© et modifi√© sur de telles applications, la communaut√© s'est familiaris√©e avec son travail et l'√©quipe Apple a re√ßu des b√™ta-testeurs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec la sortie de Xcode 11, SPM a commenc√© √† entrer dans le monde du d√©veloppement pour iOS. Maintenant, c'est d√©j√† un outil √† part enti√®re qui peut √™tre utilis√©, mais jusqu'√† pr√©sent avec des limites.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la version actuelle, SPM ne prend pas en charge les ressources (nous attendons </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SE-0271</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Dans notre pays, chaque module est une d√©pendance atomique autosuffisante qui peut √™tre connect√©e au projet, donc des ressources sont n√©cessaires (localisation, actifs). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En attendant, nous pouvons pr√©parer la migration: pour comprendre √† quel point elle est difficile, si elle peut √™tre automatis√©e et quels probl√®mes vous pouvez rencontrer.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourquoi migrer de Cocoapods vers SPM?</font></font></h2><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nativit√© et int√©gration dans l'√©cosyst√®me. </font><font style="vertical-align: inherit;">D√©j√†, Xcode propose de cr√©er ou d'ajouter un package SPM.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contrairement aux Cocoapods, il n'est plus n√©cessaire d'avoir un espace de travail pour travailler sur un projet de d√©pendance.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apr√®s avoir ajout√© une nouvelle d√©pendance, vous n'avez pas besoin d'effectuer l'installation du pod et de reconstruire l'int√©gralit√© du projet.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il est pratique d'utiliser des d√©pendances locales: la structure des dossiers ne change pas, elle est reconstruite plus rapidement.</font></font></li>
<li>SPM     ,    Cocoapods,     Ruby        (   iOS-).</li>
<li>Cocoapods       Xcode   Swift.</li>
<li>    Example   : Xcode   Package.swift   .</li>
<li>       abstract_target: SPM            .</li>
<li>  blame  ,      .</li>
<li>     Ruby,    .</li>
</ul><br>
<h2>  ?</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si votre projet comporte de nombreuses d√©pendances, le processus de migration ne peut pas √™tre termin√© en une journ√©e. </font><font style="vertical-align: inherit;">Le nombre de d√©pendances dans le Podfile n'est pas √©gal au nombre total de d√©pendances, car une d√©pendance peut √™tre regroup√©e avec dix autres. </font><font style="vertical-align: inherit;">M√™me si vous n'avez pas beaucoup de d√©pendances, mais que vous d√©veloppez vos d√©pendances, il est possible, m√™me dans des r√©f√©rentiels priv√©s, de ne pas migrer rapidement. </font><font style="vertical-align: inherit;">Heureusement, SPM s'entend bien avec les Cocoapods et le processus de migration peut √™tre it√©r√©. </font><font style="vertical-align: inherit;">L'essentiel est de prendre en compte les nuances:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il ne doit pas y avoir d'intersection entre les d√©pendances SPM et Cocoapods.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La migration doit √™tre int√©gr√©e dans le processus de d√©veloppement des composants. </font><font style="vertical-align: inherit;">Si le composant est en d√©veloppement, une mise √† niveau de version doit √™tre effectu√©e pour les Cocoapods et SPM.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il ne devrait pas y avoir de difficult√©s pour l'√©quipe, ce qui signifie que vous devez impl√©menter l'installation de toutes les d√©pendances via une seule commande cli.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La migration doit √™tre int√©gr√©e au CD CI. </font><font style="vertical-align: inherit;">Le projet doit √™tre construit √† la fois localement et sur des agents CI, dans toutes les configurations.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O√π commencer?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, nous collectons une liste compl√®te de vos d√©pendances - elle est pr√©sent√©e dans Podfile.lock. </font><font style="vertical-align: inherit;">Vous pouvez utiliser des utilitaires tels que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SPMReady</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2k/ml/8b/2kml8biy2v0bye1qgxkgbvv-slm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous les regroupons par relation. </font><font style="vertical-align: inherit;">Par exemple, presque tous les composants d√©pendent de SMENetwork, ce qui signifie que nous ne pourrons pas les migrer vers SPM jusqu'√† ce que SMENetwork lui-m√™me migre. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous s√©lectionnons un module, dont la plupart des modules d√©pendent - SMENetwork. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enfin, acc√©dez au r√©f√©rentiel de ce module, archivez-le dans un dossier et cr√©ez un module √† la racine de ce dossier.</font></font><br>
<br>
<pre><code class="bash hljs">git <span class="hljs-built_in">clone</span> ssh://.../smenetwork.git Developer/SMENetwork
<span class="hljs-built_in">cd</span> Developer/SMENetwork<font></font>
swift package init<font></font>
Creating library package: SMENetwork<font></font>
Creating Package.swift<font></font>
Creating Sources/<font></font>
Creating Sources/SMENetwork/SMENetwork.swift<font></font>
Creating Tests/<font></font>
Creating Tests/LinuxMain.swift<font></font>
Creating Tests/SMENetworkTests/<font></font>
Creating Tests/SMENetworkTests/SMENetworkTests.swift<font></font>
Creating Tests/SMENetworkTests/XCTestManifests.swift<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, nous obtenons le fichier Package.swift principal et les dossiers Sources et Tests. Si vous les aviez d√©j√†, ils ne broyeront pas. Les fichiers SMENetwork.swift, SMENetworkTests.swift, XCTestManifests.swift, LinuxMain.swift ont √©t√© cr√©√©s pour l'exemple d'op√©ration de package, ils peuvent √™tre supprim√©s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le fichier Package.swift ressemble √† ceci: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nu/ki/ca/nukicadn2hkt0txc-pqh9in4fem.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons maintenant le fichier SMENetwork.podspec: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/ae3/4d9/1bb/ae34d91bba2729c274fa03e795b7c58a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir, les sources et les tests se trouvent dans d'autres dossiers. Transf√©rez les fichiers et testez le projet d'exemple Cocoapods. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/fab/06e/200/fab06e200853027dbbed119b9626a9be.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous ajoutons la plateforme de d√©veloppement √† Package.swift et transf√©rons les d√©pendances √† partir du fichier podspec ici. Nous nous assurons qu'ils prennent en charge SPM: v√©rifiez simplement qu'il existe un fichier Package.swift dans Github. S'il n'est pas l√† et qu'il n'y a m√™me pas de RP avec lui, nous ferons un PR et aiderons la communaut√© Open-Source.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nu/ki/ca/nukicadn2hkt0txc-pqh9in4fem.png"><br>
<br>
<img src="https://habrastorage.org/webt/og/uc/ib/ogucib-td8g2n5jye8gurzuma7e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour SPM, vous n'avez pas besoin de cr√©er un projet exemple: ouvrez simplement Package.swift dans Xcode et il t√©l√©chargera et connectera les d√©pendances, cr√©era les cibles selon nos sp√©cifications. </font><font style="vertical-align: inherit;">Nous ne pouvons que courir. </font></font><br>
 <br>
<img src="https://habrastorage.org/getpro/habr/post_images/012/61f/e9d/01261fe9dbbdca461e36c6a99a6c8c9f.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans notre cas, presque tout a fonctionn√© hors de la bo√Æte, √† l'exception d'un endroit o√π l'importation Foundation a oubli√©: les d√©veloppeurs iOS sont habitu√©s au fait que UIKit et Foundation sont facultatifs, car cela fonctionne sans eux. </font><font style="vertical-align: inherit;">Il est temps de d√©sapprendre cette habitude. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ld/0y/pr/ld0yprs9qp7knmi1bxof0xatys4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le package se compile, les tests se compilent, mais √©chouent. </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/sn/nk/zg/snnkzgcns9h_56rn3vomkkukawo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et l√†, nous rencontrons une limitation du manque de ressources dans Package, les tests sont bas√©s sur les moks qui se trouvent dans json, nous attendons </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SE-0271</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ...</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Total</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Passer des Cocoapods √† SPM est facile. </font><font style="vertical-align: inherit;">Les √©tapes sont claires, mais le flux est monotone et n√©cessite une automatisation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sans trop d'efforts, vous pouvez cr√©er un package √† partir du fichier .podspec et le valider dans le r√©f√©rentiel. </font><font style="vertical-align: inherit;">Et le plus important - vous pouvez vous d√©placer avec un projet, et l'autre restera sur Cocoapods. </font><font style="vertical-align: inherit;">S'il le veut, bien s√ªr.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr491984/index.html">Airport Automation chez HEL</a></li>
<li><a href="../fr491986/index.html">RemoteLoRa - Plus que ON / OFF</a></li>
<li><a href="../fr491988/index.html">Quoi de neuf dans Red Hat OpenShift 4.2 et 4.3?</a></li>
<li><a href="../fr491990/index.html">Travailler avec la puce chinoise ADC Hx711 (conclusion)</a></li>
<li><a href="../fr491992/index.html">D√©veloppement des analystes</a></li>
<li><a href="../fr491996/index.html">En savoir plus sur Coroutines en C ++</a></li>
<li><a href="../fr492000/index.html">Produit tr√®s premier. Burnout</a></li>
<li><a href="../fr492002/index.html">Ailes absorbant la lumi√®re: le secret des papillons super noirs</a></li>
<li><a href="../fr492004/index.html">Comment passer d'un programmeur √† un manager (¬´Je veux √™tre la ma√Ætresse de la mer¬ª)</a></li>
<li><a href="../fr492006/index.html">La puissance de PWA: un syst√®me de vid√©osurveillance avec un code JS de r√©seau neuronal de 300 lignes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>