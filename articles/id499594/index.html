<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏼‍🍳 💇🏽 👉 Cara membatasi frekuensi permintaan di HAProxy: petunjuk langkah demi langkah 📱 🧑🏿‍🤝‍🧑🏻 👩🏽‍⚖️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Penulis menjelaskan cara menerapkan dalam batas kecepatan kueri HAProxy (pembatasan tingkat) dengan alamat IP tertentu. Tim Mail.ru Cloud Solutions me...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Cara membatasi frekuensi permintaan di HAProxy: petunjuk langkah demi langkah</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/499594/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/000/ebc/00e/000ebc00ecfca624add0621c731f2405.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penulis menjelaskan cara menerapkan dalam </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">batas kecepatan kueri</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> HAProxy </font><font style="vertical-align: inherit;">(pembatasan tingkat) dengan alamat IP tertentu. Tim </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mail.ru Cloud Solutions</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> menerjemahkan artikelnya - kami berharap dengan itu Anda tidak perlu menghabiskan banyak waktu dan upaya karena Anda harus menghabiskannya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Faktanya adalah bahwa ini adalah salah satu metode paling populer untuk melindungi server dari serangan DoS, tetapi sulit untuk menemukan instruksi yang jelas di Internet bagaimana mengkonfigurasinya secara khusus. Dengan coba-coba, penulis memaksa HAProxy untuk membatasi frekuensi permintaan pada daftar alamat IP, yang diperbarui secara real time. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tidak diperlukan pengetahuan sebelumnya untuk mengkonfigurasi HAProxy, karena semua langkah yang diperlukan diuraikan di bawah ini.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Open source dan HAProxy gratis adalah penyeimbang beban dan server proxy yang sangat mudah diakses. </font><font style="vertical-align: inherit;">Dalam beberapa tahun terakhir, telah menjadi </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sangat populer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> karena memberikan kinerja tinggi dengan sumber daya minimum. </font><font style="vertical-align: inherit;">Tidak seperti program alternatif, versi nirlaba </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Edisi Komunitas HAProxy</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> menawarkan cukup fitur untuk penyeimbangan beban yang andal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Program ini pada awalnya cukup sulit untuk diketahui. </font><font style="vertical-align: inherit;">Namun, ia memiliki </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dokumentasi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> teknis yang sangat teliti dan terperinci </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Penulis mengatakan bahwa ini adalah dokumentasi paling rinci di antara semua program open source yang pernah ia gunakan. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, inilah panduan langkah demi langkah.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengkonfigurasi penyeimbang beban</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menghemat waktu dan tidak terganggu oleh pengaturan infrastruktur, ambil </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker Compose</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> images </font><font style="vertical-align: inherit;">dan segera luncurkan komponen utama. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tugas pertama adalah meningkatkan instance penyeimbang beban HAProxy dengan beberapa server backend Apache.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kloning repositori</font></font></h4><br>
<pre><code class="bash hljs">$ git <span class="hljs-built_in">clone</span> git@github.com:stargazer/haproxy-ratelimiter.git<font></font>
$ <span class="hljs-built_in">cd</span> haproxy-ratelimiter</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda dapat melihat </font></font><code>Dockerfile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan </font></font><code>docker-compose.yml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dengan parameter instalasi. Diskusi mereka berada di luar cakupan artikel ini, jadi mari kita memikirkan fakta bahwa mereka membuat instance HAProxy yang berfungsi yang disebut </font></font><code>loadbalancer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dua server backend </font></font><code>api01</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan </font></font><code>api02</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Untuk mengkonfigurasi HAProxy, kami awalnya akan menggunakan file </font></font><code>haproxy-basic.cfg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dan kemudian beralih ke </font></font><code>haproxy-ratelimiting.cfg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk kesederhanaan, file konfigurasi telah </font></font><code>haproxy-basic.cfg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dikurangi seminimal mungkin dan dibersihkan dari kelebihan. Mari kita melihatnya:</font></font><br>
<br>
<pre><code class="plaintext hljs">defaults<font></font>
mode http<font></font>
timeout connect 5000ms<font></font>
timeout client 50000ms<font></font>
timeout server 50000ms<font></font>
<font></font>
frontend proxy<font></font>
bind *:80<font></font>
<font></font>
use_backend api<font></font>
<font></font>
backend api<font></font>
balance roundrobin<font></font>
<font></font>
server api01 api01:80<font></font>
server api02 api02:80</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagian ini </font></font><code>frontend proxy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mengatur HAProxy untuk mendengarkan pada port 80 dan meneruskan semua permintaan ke kumpulan server </font></font><code>api</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">di backend. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CATEGORY </font></font><code>backend api</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menentukan kumpulan backend </font></font><code>api</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dengan dua server back-end </font></font><code>api01</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan </font></font><code>api02</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan alamat yang sesuai. </font><font style="vertical-align: inherit;">Server untuk melayani setiap permintaan yang masuk dipilih oleh algoritma load balancing </font></font><code>roundrobin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, yaitu, pada kenyataannya, dua server yang tersedia digunakan secara bergantian.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mari kita luncurkan ketiga kontainer kita</font></font></h4><br>
<pre><code class="bash hljs">$ sudo docker-compose up</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang kami memiliki wadah </font></font><code>loadbalancer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yang mengalihkan permintaan ke dua backend </font></font><code>api01</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan </font><font style="vertical-align: inherit;">server </font></font><code>api02</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Kami akan mendapat respons dari salah satu dari mereka jika kami memasukkan di bilah alamat </font></font><code>http://localhost/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sangat menarik untuk menyegarkan halaman beberapa kali dan melihat log </font></font><code>docker-compose</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">api01_1 | </font><font style="vertical-align: inherit;">192.168.192.3 - - [08 / Jan / 2019: 11: 38: 09 +0000] "DAPATKAN / HTTP / 1.1" 200 45</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
api02_1 | </font><font style="vertical-align: inherit;">192.168.192.3 - - [08 / Jan / 2019: 11: 38: 10 +0000] "DAPATKAN / HTTP / 1.1" 304 -</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
api01_1 | </font><font style="vertical-align: inherit;">192.168.192.3 - - [08 / Jan / 2019: 11: 38: 10 +0000] "DAPATKAN / HTTP / 1.1" 304 -</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
api02_1 | </font><font style="vertical-align: inherit;">192.168.192.3 - - [08 / Jan / 2019: 11: 38: 11 +0000] "DAPATKAN / HTTP / 1.1" 304 -</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
api01_1 | </font><font style="vertical-align: inherit;">192.168.192.3 - - [08 / Jan / 2019: 11: 38: 11 +0000] "DAPATKAN / HTTP / 1.1" 304 -</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
api02_1 | </font><font style="vertical-align: inherit;">192.168.192.3 - - [08 / Jan / 2019: 11: 38: 11 +0000] "DAPATKAN / HTTP / 1.1" 304 -</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang Anda lihat, dua server </font></font><code>api</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memproses permintaan secara bergantian. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami sekarang memiliki instance HAProxy dengan konfigurasi penyeimbangan beban yang sangat sederhana, dan kami memiliki beberapa gagasan tentang cara kerjanya.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tambahkan batas pada jumlah permintaan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menetapkan batas jumlah permintaan ke penyeimbang beban, Anda perlu memodifikasi file konfigurasi dalam instance HAProxy. </font><font style="vertical-align: inherit;">Pastikan bahwa wadah </font></font><code>loadbalancer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menggunakan file konfigurasi </font></font><code>haproxy-ratelimiter.cfg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cukup modifikasi Dockerfile untuk mengganti file konfigurasi.</font></font><br>
<br>
<pre><code class="plaintext hljs">FROM haproxy:1.7<font></font>
COPY haproxy-ratelimiter.cfg /usr/local/etc/haproxy/haproxy.cfg</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Batas pengaturan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semua pengaturan terdaftar dalam file konfigurasi </font></font><code>haproxy-ratelimiter.cfg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Mari kita pelajari dengan seksama.</font></font><br>
<br>
<pre><code class="plaintext hljs">defaults<font></font>
mode http<font></font>
timeout connect 5000ms<font></font>
timeout client 50000ms<font></font>
timeout server 50000ms<font></font>
<font></font>
frontend proxy<font></font>
bind *:80<font></font>
<font></font>
# ACL function declarations<font></font>
acl is_abuse src_http_req_rate(Abuse) ge 10<font></font>
acl inc_abuse_cnt src_inc_gpc0(Abuse) gt 0<font></font>
acl abuse_cnt src_get_gpc0(Abuse) gt 0<font></font>
<font></font>
# Rules<font></font>
tcp-request connection track-sc0 src table Abuse<font></font>
tcp-request connection reject if abuse_cnt<font></font>
http-request deny if abuse_cnt<font></font>
http-request deny if is_abuse inc_abuse_cnt<font></font>
<font></font>
use_backend api<font></font>
backend api<font></font>
balance roundrobin<font></font>
<font></font>
server api01 api01:80<font></font>
server api02 api02:80<font></font>
<font></font>
backend Abuse<font></font>
stick-table type ip size 100K expire 30m store gpc0,http_req_rate(10s)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HAProxy menawarkan serangkaian primitif tingkat rendah yang memberikan lebih banyak fleksibilitas dan cocok untuk berbagai kasus penggunaan. </font><font style="vertical-align: inherit;">Penghitungnya sering mengingatkan saya pada register akumulatif (adder) di CPU. </font><font style="vertical-align: inherit;">Mereka menyimpan hasil antara, mengambil semantik yang berbeda sebagai input, tetapi pada akhirnya mereka hanya angka. </font><font style="vertical-align: inherit;">Untuk memahami semuanya dengan baik, masuk akal untuk memulai dari bagian paling akhir dari file konfigurasi.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meja </font></font><code>Abuse</code></h4><br>
<pre><code class="plaintext hljs">backend Abuse<font></font>
stick-table type ip size 100K expire 30m store gpc0,http_req_rate(10s)</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini kami membuat backend dummy yang disebut </font></font><code>Abuse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">("penyalahgunaan"). </font><font style="vertical-align: inherit;">Fiktif, karena hanya digunakan untuk stick-table, yang konfigurasi selanjutnya dapat merujuk nama </font></font><code>Abuse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Stick-table adalah tabel yang disimpan dalam memori proses, di mana untuk setiap catatan Anda dapat menentukan masa pakai. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meja kami memiliki karakteristik sebagai berikut:</font></font><br>
<br>
<ul>
<li><code>type ip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: Permintaan disimpan dalam tabel dengan alamat IP sebagai kunci. </font><font style="vertical-align: inherit;">Dengan demikian, permintaan dari alamat IP yang sama akan merujuk pada catatan yang sama. </font><font style="vertical-align: inherit;">Pada dasarnya, ini berarti kami melacak alamat IP dan data terkait.</font></font><br>
</li>
<li><code>size 100K</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: Tabel ini berisi maksimal 100 ribu catatan.</font></font><br>
</li>
<li><code>expire 30m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: Periode penyimpanan catatan adalah 30 menit tidak aktif.</font></font><br>
</li>
<li><code>store gpc0,http_req_rate(10s)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: Penghitung </font></font><code>gpc0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan jumlah permintaan alamat IP selama 10 detik terakhir </font><font style="vertical-align: inherit;">disimpan dengan entri </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dengan bantuan, </font></font><code>gpc0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kami akan melacak berapa kali alamat IP diperhatikan dalam pelanggaran. </font><font style="vertical-align: inherit;">Faktanya, nilai penghitung positif berarti bahwa alamat IP sudah ditandai sebagai mencurigakan. </font><font style="vertical-align: inherit;">Mari kita sebut penghitung ini </font></font><code>abuse indicator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara umum, tabel ini </font></font><code>Abuse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memungkinkan Anda untuk melacak apakah alamat IP ditandai sebagai mencurigakan, serta frekuensi permintaan saat ini dari alamat ini. </font><font style="vertical-align: inherit;">Oleh karena itu, kami memiliki riwayat catatan, serta informasi waktu nyata. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang mari kita beralih ke bagian </font></font><code>frontend proxy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan melihat apa yang baru di sana.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fungsi dan Aturan ACL</font></font></h4><br>
<pre><code class="plaintext hljs">frontend proxy<font></font>
bind *:80<font></font>
<font></font>
# ACL function declarations<font></font>
acl is_abuse src_http_req_rate(Abuse) ge 10<font></font>
acl inc_abuse_cnt src_inc_gpc0(Abuse) gt 0<font></font>
acl abuse_cnt src_get_gpc0(Abuse) gt 0<font></font>
<font></font>
# Rules<font></font>
tcp-request connection track-sc0 src table Abuse<font></font>
tcp-request connection reject if abuse_cnt<font></font>
http-request deny if abuse_cnt<font></font>
http-request deny if is_abuse inc_abuse_cnt<font></font>
<font></font>
use_backend api</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daftar Kontrol Akses (ACL) adalah deklarasi fungsi yang dipanggil hanya ketika aturan ditetapkan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita lihat lebih dekat ketiga entri ACL. </font><font style="vertical-align: inherit;">Perlu diingat bahwa mereka semua secara eksplisit merujuk tabel </font></font><code>Abuse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yang menggunakan alamat IP sebagai kunci, sehingga setiap fungsi berlaku untuk permintaan alamat IP:</font></font><br>
<br>
<ul>
<li><code>acl is_abuse src_http_req_rate(Abuse) ge 10</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: Fungsi </font></font><code>is_abuse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kembali </font></font><code>True</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jika frekuensi permintaan saat ini lebih besar atau sama dengan sepuluh.</font></font><br>
</li>
<li><code>acl inc_abuse_cnt src_inc_gpc0(Abuse) gt 0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: Fungsi </font></font><code>inc_abuse_cnt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kembali </font></font><code>True</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jika nilai kenaikan </font></font><code>gpc0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lebih besar dari nol. </font><font style="vertical-align: inherit;">Karena nilai awal </font></font><code>gpc0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">adalah nol, fungsi ini selalu kembali </font></font><code>True</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dengan kata lain, itu meningkatkan nilai </font></font><code>abuse indicator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, pada dasarnya menandakan penyalahgunaan dari alamat IP ini.</font></font><br>
</li>
<li><code>acl abuse_cnt src_get_gpc0(Abuse) gt 0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: Fungsi </font></font><code>abuse_cnt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kembali </font></font><code>True</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jika nilainya </font></font><code>gpc0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lebih besar dari nol. </font><font style="vertical-align: inherit;">Dengan kata lain, dia mengatakan jika alamat IP ini telah ditemukan dalam pelanggaran.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang disebutkan sebelumnya, ACL hanyalah deklarasi, yaitu deklarasi fungsi. </font><font style="vertical-align: inherit;">Mereka tidak berlaku untuk permintaan masuk sampai beberapa aturan dipicu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Masuk akal untuk melihat aturan yang didefinisikan di bagian yang sama </font></font><code>frontend</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Aturan diterapkan untuk setiap permintaan yang masuk satu per satu - dan menjalankan fungsi dari ACL yang baru saja kita tetapkan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita lihat apa yang dilakukan masing-masing aturan:</font></font><br>
<br>
<ul>
<li><code>tcp-request connection track-sc0 src table Abuse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: Menambahkan kueri ke tabel </font></font><code>Abuse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Karena kuncinya adalah alamat IP dalam tabel, aturan ini menambah daftar alamat IP.</font></font><br>
</li>
<li><code>tcp-request connection reject if abuse_cnt</code>:   TCP-,  IP-    ,     abuse.  ,   TCP-   IP-.<br>
</li>
<li><code>http-request deny if abuse_cnt</code>:  ,  IP-    .        IP-,      abuse.<br>
</li>
<li><code>http-request deny if is_abuse inc_abuse_cnt</code>:  ,  <code>is_abuse</code>  <code>inc_abuse_cnt</code>   <code>True</code>.  ,    ,    IP-        ,    IP-    .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Intinya, kami memperkenalkan dua jenis cek: secara waktu nyata dan dalam daftar hitam dari riwayat kueri. </font><font style="vertical-align: inherit;">Aturan kedua menolak semua koneksi TCP baru jika alamat IP telah diketahui dalam penyalahgunaan. </font><font style="vertical-align: inherit;">Aturan ketiga melarang layanan permintaan HTTP untuk alamat IP dari daftar hitam, terlepas dari frekuensi permintaan saat ini dari alamat ini. </font><font style="vertical-align: inherit;">Aturan keempat memastikan bahwa permintaan HTTP dari alamat IP ditolak pada saat itu juga setelah ambang untuk frekuensi permintaan telah diatasi. </font><font style="vertical-align: inherit;">Dengan demikian, aturan kedua terutama bekerja pada koneksi TCP baru, yang ketiga dan keempat pada koneksi yang sudah mapan, yang pertama adalah pemeriksaan historis, dan yang kedua adalah pemeriksaan waktu-nyata.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mari kita coba filter dalam aksi!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang kita dapat merakit dan meluncurkan wadah kita lagi.</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo docker-compose down<font></font>
$ sudo docker-compose build<font></font>
$ sudo docker-compose up</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Load balancer harus dimulai sebelum dua server backend. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari arahkan browser kita ke </font></font><code>http://localhost/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Jika kami menyegarkan halaman dengan cepat selusin kali, kami akan melebihi ambang batas sepuluh permintaan dalam interval sepuluh detik - dan permintaan kami akan ditolak. </font><font style="vertical-align: inherit;">Jika kami terus menyegarkan halaman, permintaan baru akan segera ditolak - bahkan sebelum koneksi TCP dibuat.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pertanyaan</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengapa batas sepuluh permintaan per sepuluh detik?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tabel </font></font><code>Abuse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menentukan </font></font><code>http_req_rate(10s)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, yaitu, frekuensi permintaan diukur dalam jendela sepuluh detik. </font><font style="vertical-align: inherit;">Fungsi </font></font><code>is_abuse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dari ACL kembali </font></font><code>True</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pada tingkat permintaan ≥10 dalam interval yang ditentukan. </font><font style="vertical-align: inherit;">Dengan demikian, penyalahgunaan dianggap sebagai frekuensi permintaan sepuluh atau lebih permintaan dalam sepuluh detik. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada artikel ini, misalnya, kami memutuskan untuk menetapkan batas rendah agar lebih mudah untuk memeriksa operasi pembatas.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apa perbedaan antara aturan koneksi http-request dan tcp-request?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dari </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://cbonte.github.io/haproxy-dconv/1.7/configuration.html&amp;usg=ALkJrhhcI8-E0PjKOSl0sK_0DszxSEDMQw#4.2-"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dokumentasi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<blockquote><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http-request: pernyataan http-request mendefinisikan seperangkat aturan yang berlaku pada lapisan jaringan 7 [model OSI]</font></font></i></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dari </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dokumentasi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<blockquote><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">koneksi tcp-request: melakukan aksi pada koneksi yang masuk tergantung pada kondisi di lapisan jaringan 4</font></font></i></blockquote><br>
<h3>  HTTP-,        TCP-?</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bayangkan bahwa permintaan HTTP ke server mengirim beberapa koneksi TCP dari alamat IP yang sama. </font><font style="vertical-align: inherit;">Frekuensi permintaan HTTP akan dengan cepat melebihi ambang batas. </font><font style="vertical-align: inherit;">Saat itulah aturan keempat mulai berlaku, yang membuang permintaan dan memasukkan alamat IP ke daftar hitam. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang sangat mungkin bahwa koneksi HTTP dari alamat IP yang sama tetap terbuka (lihat </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">koneksi HTTP persisten</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), dan frekuensi permintaan HTTP telah turun di bawah nilai ambang batas. </font><font style="vertical-align: inherit;">Aturan ketiga menjamin terus memblokir permintaan HTTP, karena </font></font><code>abuse indicator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dipicu pada IP ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang anggaplah bahwa setelah beberapa menit IP yang sama mencoba untuk membuat koneksi TCP. </font><font style="vertical-align: inherit;">Mereka langsung dibuang, karena aturan kedua berlaku: ia melihat alamat IP berlabel dan segera menjatuhkan koneksi.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kesimpulan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada awalnya, mungkin sulit untuk memahami keterbatasan kecepatan pemrosesan permintaan menggunakan HAProxy. </font><font style="vertical-align: inherit;">Untuk melakukan semuanya dengan benar, Anda memerlukan pemikiran "tingkat rendah" dan sejumlah tindakan non-intuitif. </font><font style="vertical-align: inherit;">Dokumentasi dalam bagian ini mungkin terlalu teknis dan tidak memiliki contoh dasar. </font><font style="vertical-align: inherit;">Kami berharap bahwa panduan ini akan menebus kekurangan dan menunjukkan arah kepada semua orang yang ingin mengambil jalan ini. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apa lagi yang harus dibaca</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana arsitektur toleran-kesalahan diimplementasikan dalam platform Mail.ru Cloud Solutions</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10 Trik dan Tip Kubernet Teratas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saluran Telegram kami tentang transformasi digital</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ol></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id499582/index.html">Model Predator-Prey di Node.js</a></li>
<li><a href="../id499584/index.html">Monitor sentuh industri FPM-215W</a></li>
<li><a href="../id499586/index.html">Bagaimana memikirkan navigasi di aplikasi seluler</a></li>
<li><a href="../id499588/index.html">Otentikasi dalam .NET Core gRpc dengan JWT</a></li>
<li><a href="../id499592/index.html">AI: Melengkapi dunia besok</a></li>
<li><a href="../id499598/index.html">Dan kita akan pergi ke utara! Apakah mungkin untuk menghemat pendinginan pusat data karena cuaca?</a></li>
<li><a href="../id499600/index.html">Cara bekerja bersama, bekerja terpisah</a></li>
<li><a href="../id499602/index.html">Memindahkan Konferensi Online: Pengalaman InnerSource Commons Summit</a></li>
<li><a href="../id499604/index.html">4 argumen untuk meyakinkan seorang direktur untuk membeli UPS dalam bisnis kecil</a></li>
<li><a href="../id499606/index.html">Perangkat Lunak Konferensi Video: Skype, Hangouts, dan Zoom Half-Blood</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>