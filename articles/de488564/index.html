<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🈹 👵🏽 🌺 Ihr erstes neuronales Netzwerk auf einer Grafikverarbeitungseinheit (GPU). Ratgeber für Anfänger 👘 👨‍🎓 👩🏾‍🤝‍👩🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesem Artikel werde ich Ihnen erklären, wie Sie in 30 Minuten eine maschinelle Lernumgebung einrichten, ein neuronales Netzwerk für die Bilderkenn...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Ihr erstes neuronales Netzwerk auf einer Grafikverarbeitungseinheit (GPU). Ratgeber für Anfänger</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488564/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/wg/sv/g2/wgsvg24lytktztdczee_4rteb28.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Artikel werde ich Ihnen erklären, wie Sie in 30 Minuten eine maschinelle Lernumgebung einrichten, ein neuronales Netzwerk für die Bilderkennung erstellen und dann dasselbe Netzwerk auf einem Grafikprozessor (GPU) ausführen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Definieren wir zunächst, was ein neuronales Netzwerk ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In unserem Fall handelt es sich um ein mathematisches Modell sowie dessen Software- oder Hardware-Implementierung, das auf dem Prinzip der Organisation und Funktionsweise biologischer neuronaler Netze basiert - Netze von Nervenzellen eines lebenden Organismus. Dieses Konzept entstand bei der Untersuchung von Prozessen im Gehirn und bei dem Versuch, diese Prozesse zu simulieren.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neuronale Netze werden nicht im üblichen Sinne des Wortes programmiert, sondern trainiert. </font><font style="vertical-align: inherit;">Die Lernfähigkeit ist einer der Hauptvorteile neuronaler Netze gegenüber herkömmlichen Algorithmen. </font><font style="vertical-align: inherit;">Technisch gesehen besteht das Training darin, die Verbindungskoeffizienten zwischen Neuronen zu finden. </font><font style="vertical-align: inherit;">Während des Lernprozesses kann das neuronale Netzwerk komplexe Beziehungen zwischen Eingabe und Ausgabe identifizieren und eine Verallgemeinerung durchführen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unter dem Gesichtspunkt des maschinellen Lernens ist ein neuronales Netzwerk ein Sonderfall von Mustererkennungsverfahren, Diskriminanzanalyse, Clustering-Verfahren und anderen Verfahren.</font></font><br>
 <br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ausrüstung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lassen Sie uns zunächst die Ausrüstung behandeln. Wir benötigen einen Server, auf dem das Linux-Betriebssystem installiert ist. Geräte für den Betrieb von maschinellen Lernsystemen erfordern eine ausreichend leistungsfähige und folglich teure. Für diejenigen, die kein gutes Auto zur Hand haben, empfehle ich, auf das Angebot von Cloud-Anbietern zu achten. Der benötigte Server kann schnell gemietet werden und nur für die Nutzungsdauer bezahlen.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In Projekten, in denen neuronale Netze erstellt werden müssen, verwende ich die Server eines der russischen Cloud-Anbieter. </font><font style="vertical-align: inherit;">Das Unternehmen bietet Miet-Cloud-Server speziell für maschinelles Lernen mit leistungsstarken Tesla V100-Grafikprozessoren (GPUs) von NVIDIA an. </font><font style="vertical-align: inherit;">Kurz gesagt: Die Verwendung eines Servers mit einer GPU kann Dutzende Male effizienter (schnell) sein als ein Server mit ähnlichen Kosten, bei dem eine CPU für Berechnungen verwendet wird (ein bekannter Zentralprozessor). </font><font style="vertical-align: inherit;">Dies wird durch die Besonderheiten der GPU-Architektur erreicht, die Berechnungen schneller abwickelt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die unten beschriebenen Beispiele auszuführen, haben wir den folgenden Server mehrere Tage lang gekauft:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">150 GB SSD</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RAM 32 GB</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tesla V100 16 Gb Prozessor mit 4 Kernen</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ubuntu 18.04 wurde auf dem Computer installiert.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stellen Sie die Umgebung ein</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Installieren Sie nun auf dem Server alles, was Sie zum Arbeiten benötigen. </font><font style="vertical-align: inherit;">Da unser Artikel in erster Linie für Anfänger gedacht ist, werde ich darin auf einige Punkte eingehen, die für sie nützlich sein werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Über die Befehlszeile wird viel Arbeit beim Einrichten der Umgebung geleistet. </font><font style="vertical-align: inherit;">Die meisten Benutzer verwenden Windows als funktionierendes Betriebssystem. </font><font style="vertical-align: inherit;">Die Standardkonsole in diesem Betriebssystem lässt zu wünschen übrig. </font><font style="vertical-align: inherit;">Daher werden wir das praktische </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cmder /</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tool verwenden </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Laden Sie die Mini-Version herunter und führen Sie Cmder.exe aus. </font><font style="vertical-align: inherit;">Als Nächstes müssen Sie über SSH eine Verbindung zum Server herstellen:</font></font><br>
<br>
<pre><code class="bash hljs">ssh root@server-ip-or-hostname</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Geben Sie anstelle von Server-IP- oder Hostname die IP-Adresse oder den DNS-Namen Ihres Servers an. </font><font style="vertical-align: inherit;">Geben Sie als nächstes das Passwort ein und nach erfolgreicher Verbindung sollten wir so etwas bekommen.</font></font><br>
<br>
<pre><code class="bash hljs">Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-74-generic x86_64)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Hauptsprache für die Entwicklung von ML-Modellen ist Python. </font><font style="vertical-align: inherit;">Die beliebteste Plattform für die Verwendung unter Linux ist </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anaconda</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Installieren Sie es auf unserem Server. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir beginnen mit der Aktualisierung des lokalen Paketmanagers:</font></font><br>
<br>
<pre><code class="bash hljs">sudo apt-get update</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Installieren Sie curl (Befehlszeilenprogramm):</font></font><br>
<br>
<pre><code class="bash hljs">sudo apt-get install curl</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Laden Sie die neueste Version von Anaconda Distribution herunter:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> /tmp<font></font>
curl –O https://repo.anaconda.com/archive/Anaconda3-2019.10-Linux-x86_64.sh</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir starten die Installation:</font></font><br>
<br>
<pre><code class="bash hljs">bash Anaconda3-2019.10-Linux-x86_64.sh</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Während des Installationsvorgangs müssen Sie die Lizenzvereinbarung bestätigen. </font><font style="vertical-align: inherit;">Bei erfolgreicher Installation sollte Folgendes angezeigt werden:</font></font><br>
<br>
<pre><code class="bash hljs">Thank you <span class="hljs-keyword">for</span> installing Anaconda3!</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um ML-Modelle zu entwickeln, werden jetzt viele Frameworks erstellt. Wir arbeiten mit den beliebtesten: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyTorch</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tensorflow</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durch die Verwendung des Frameworks können Sie die Entwicklungsgeschwindigkeit erhöhen und vorgefertigte Tools für Standardaufgaben verwenden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Beispiel arbeiten wir mit PyTorch. </font><font style="vertical-align: inherit;">Es installieren:</font></font><br>
<br>
<pre><code class="bash hljs">conda install pytorch torchvision cudatoolkit=10.1 -c pytorch</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt müssen wir das Jupyter Notebook starten - ein beliebtes Entwicklungstool unter ML-Spezialisten. </font><font style="vertical-align: inherit;">Sie können Code schreiben und sofort die Ergebnisse seiner Ausführung sehen. </font><font style="vertical-align: inherit;">Jupyter Notebook ist Teil von Anaconda und bereits auf unserem Server installiert. </font><font style="vertical-align: inherit;">Sie müssen von unserem Desktop-System aus eine Verbindung herstellen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dazu führen wir zunächst Jupyter auf dem Server aus, indem wir Port 8080 angeben:</font></font><br>
<br>
<pre><code class="bash hljs">jupyter notebook --no-browser --port=8080 --allow-root</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Öffnen Sie anschließend eine weitere Registerkarte in unserer Cmder-Konsole (das Hauptmenü ist das Dialogfeld "Neue Konsole") und stellen Sie über Port 8080 eine Verbindung zum Server über SSH her:</font></font><br>
<br>
<pre><code class="plaintext hljs">ssh -L 8080:localhost:8080 root@server-ip-or-hostname</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie den ersten Befehl eingeben, werden uns Links zum Öffnen von Jupyter in unserem Browser angeboten:</font></font><br>
<br>
<pre><code class="bash hljs">To access the notebook, open this file <span class="hljs-keyword">in</span> a browser:<font></font>
        file:///root/.<span class="hljs-built_in">local</span>/share/jupyter/runtime/nbserver-18788-open.html<font></font>
    Or copy and paste one of these URLs:<font></font>
        http://localhost:8080/?token=cca0bd0b30857821194b9018a5394a4ed2322236f116d311<font></font>
     or http://127.0.0.1:8080/?token=cca0bd0b30857821194b9018a5394a4ed2322236f116d311<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verwenden Sie den Link für localhost: 8080. </font><font style="vertical-align: inherit;">Kopieren Sie den vollständigen Pfad und fügen Sie ihn in die Adressleiste des lokalen Browsers Ihres PCs ein. </font><font style="vertical-align: inherit;">Das Jupyter-Notizbuch wird geöffnet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erstellen wir einen neuen Laptop: Neu - Notebook - Python 3. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Überprüfen Sie den korrekten Betrieb aller von uns installierten Komponenten. </font><font style="vertical-align: inherit;">Wir führen ein PyTorch-Codebeispiel in Jupyter ein und starten die Ausführung (Schaltfläche Ausführen):</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> print_function
<span class="hljs-keyword">import</span> torch<font></font>
x = torch.rand(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>)<font></font>
print(x)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Ergebnis sollte ungefähr so ​​aussehen: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ps/o8/su/pso8sugii4txi_beqrbx13nsry8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie ein ähnliches Ergebnis haben, dann haben wir uns alle richtig eingerichtet und können beginnen, ein neuronales Netzwerk aufzubauen!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstellen Sie ein neuronales Netzwerk</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden ein neuronales Netzwerk für die Bilderkennung erstellen. </font><font style="vertical-align: inherit;">Wir nehmen diesen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leitfaden als</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Grundlage </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um das Netzwerk zu trainieren, verwenden wir den öffentlich verfügbaren CIFAR10-Datensatz. </font><font style="vertical-align: inherit;">Er hat Klassen: "Flugzeug", "Auto", "Vogel", "Katze", "Hirsch", "Hund", "Frosch", "Pferd", "Schiff", "LKW". </font><font style="vertical-align: inherit;">Bilder in CIFAR10 haben eine Größe von 3 × 32 × 32, d. H. 3-Kanal-Farbbilder von 32 × 32 Pixel.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/wg/sv/g2/wgsvg24lytktztdczee_4rteb28.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für die Arbeit verwenden wir das erstellte PyTorch-Paket für die Arbeit mit Bildern - Torchvision. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden die folgenden Schritte der Reihe nach ausführen:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Laden Sie Trainings- und Testdatensätze herunter und normalisieren Sie sie</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Definition des neuronalen Netzes</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Netzwerktraining zu Trainingsdaten</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Testen des Netzwerks mit Testdaten</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wiederholen Sie das GPU-Training und -Test</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der gesamte folgende Code wird im Jupyter-Notizbuch ausgeführt.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Laden Sie CIFAR10 herunter und normalisieren Sie es</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kopieren Sie den folgenden Code in Jupyter und führen Sie ihn aus:</font></font><br>
<br>
<pre><code class="python hljs">
<span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">import</span> torchvision
<span class="hljs-keyword">import</span> torchvision.transforms <span class="hljs-keyword">as</span> transforms<font></font>
<font></font>
transform = transforms.Compose(<font></font>
    [transforms.ToTensor(),<font></font>
     transforms.Normalize((<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>), (<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>))])<font></font>
<font></font>
trainset = torchvision.datasets.CIFAR10(root=<span class="hljs-string">'./data'</span>, train=<span class="hljs-literal">True</span>,<font></font>
                                        download=<span class="hljs-literal">True</span>, transform=transform)<font></font>
trainloader = torch.utils.data.DataLoader(trainset, batch_size=<span class="hljs-number">4</span>,<font></font>
                                          shuffle=<span class="hljs-literal">True</span>, num_workers=<span class="hljs-number">2</span>)<font></font>
<font></font>
testset = torchvision.datasets.CIFAR10(root=<span class="hljs-string">'./data'</span>, train=<span class="hljs-literal">False</span>,<font></font>
                                       download=<span class="hljs-literal">True</span>, transform=transform)<font></font>
testloader = torch.utils.data.DataLoader(testset, batch_size=<span class="hljs-number">4</span>,<font></font>
                                         shuffle=<span class="hljs-literal">False</span>, num_workers=<span class="hljs-number">2</span>)<font></font>
<font></font>
classes = (<span class="hljs-string">'plane'</span>, <span class="hljs-string">'car'</span>, <span class="hljs-string">'bird'</span>, <span class="hljs-string">'cat'</span>,
           <span class="hljs-string">'deer'</span>, <span class="hljs-string">'dog'</span>, <span class="hljs-string">'frog'</span>, <span class="hljs-string">'horse'</span>, <span class="hljs-string">'ship'</span>, <span class="hljs-string">'truck'</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Antwort sollte so lauten:</font></font><br>
<br>
<pre><code class="python hljs">Downloading https://www.cs.toronto.edu/~kriz/cifar<span class="hljs-number">-10</span>-python.tar.gz to ./data/cifar<span class="hljs-number">-10</span>-python.tar.gz<font></font>
Extracting ./data/cifar<span class="hljs-number">-10</span>-python.tar.gz to ./data<font></font>
Files already downloaded <span class="hljs-keyword">and</span> verified</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden verschiedene Trainingsbilder zur Überprüfung ableiten:</font></font><br>
<br>
<pre><code class="python hljs">
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<font></font>
<font></font>
<span class="hljs-comment"># functions to show an image</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">imshow</span>(<span class="hljs-params">img</span>):</span>
    img = img / <span class="hljs-number">2</span> + <span class="hljs-number">0.5</span>     <span class="hljs-comment"># unnormalize</span><font></font>
    npimg = img.numpy()<font></font>
    plt.imshow(np.transpose(npimg, (<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>)))<font></font>
    plt.show()<font></font>
<font></font>
<span class="hljs-comment"># get some random training images</span><font></font>
dataiter = iter(trainloader)<font></font>
images, labels = dataiter.next()<font></font>
<font></font>
<span class="hljs-comment"># show images</span><font></font>
imshow(torchvision.utils.make_grid(images))<font></font>
<span class="hljs-comment"># print labels</span>
print(<span class="hljs-string">' '</span>.join(<span class="hljs-string">'%5s'</span> % classes[labels[j]] <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(<span class="hljs-number">4</span>)))
</code></pre><br>
<img src="https://habrastorage.org/webt/yy/w4/xw/yyw4xwjhaa6kfy41fvnylvz6qdy.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Definition des neuronalen Netzes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lassen Sie uns zunächst untersuchen, wie ein neuronales Netzwerk zur Bilderkennung funktioniert. </font><font style="vertical-align: inherit;">Dies ist ein einfaches Direktverbindungsnetzwerk. </font><font style="vertical-align: inherit;">Es nimmt Eingaben auf, durchläuft sie nacheinander durch mehrere Ebenen und gibt schließlich die Ausgabe aus. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/t8/4m/yg/t84mygi1sjuzssoezguistupmeo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erstellen wir ein ähnliches Netzwerk in unserer Umgebung:</font></font><br>
<br>
<pre><code class="python hljs">
<span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn
<span class="hljs-keyword">import</span> torch.nn.functional <span class="hljs-keyword">as</span> F<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Net</span>(<span class="hljs-params">nn.Module</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><font></font>
        super(Net, self).__init__()<font></font>
        self.conv1 = nn.Conv2d(<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">5</span>)<font></font>
        self.pool = nn.MaxPool2d(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>)<font></font>
        self.conv2 = nn.Conv2d(<span class="hljs-number">6</span>, <span class="hljs-number">16</span>, <span class="hljs-number">5</span>)<font></font>
        self.fc1 = nn.Linear(<span class="hljs-number">16</span> * <span class="hljs-number">5</span> * <span class="hljs-number">5</span>, <span class="hljs-number">120</span>)<font></font>
        self.fc2 = nn.Linear(<span class="hljs-number">120</span>, <span class="hljs-number">84</span>)<font></font>
        self.fc3 = nn.Linear(<span class="hljs-number">84</span>, <span class="hljs-number">10</span>)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forward</span>(<span class="hljs-params">self, x</span>):</span><font></font>
        x = self.pool(F.relu(self.conv1(x)))<font></font>
        x = self.pool(F.relu(self.conv2(x)))<font></font>
        x = x.view(<span class="hljs-number">-1</span>, <span class="hljs-number">16</span> * <span class="hljs-number">5</span> * <span class="hljs-number">5</span>)<font></font>
        x = F.relu(self.fc1(x))<font></font>
        x = F.relu(self.fc2(x))<font></font>
        x = self.fc3(x)<font></font>
        <span class="hljs-keyword">return</span> x<font></font>
<font></font>
net = Net()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir definieren auch die Verlustfunktion und den Optimierer </font></font><br>
<br>
<pre><code class="python hljs">
<span class="hljs-keyword">import</span> torch.optim <span class="hljs-keyword">as</span> optim<font></font>
<font></font>
criterion = nn.CrossEntropyLoss()<font></font>
optimizer = optim.SGD(net.parameters(), lr=<span class="hljs-number">0.001</span>, momentum=<span class="hljs-number">0.9</span>)</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Netzwerktraining zu Trainingsdaten</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir beginnen unser neuronales Netzwerk zu trainieren. </font><font style="vertical-align: inherit;">Ich mache Sie darauf aufmerksam, dass Sie danach beim Ausführen dieses Codes eine Weile warten müssen, bis die Arbeit abgeschlossen ist. </font><font style="vertical-align: inherit;">Ich habe 5 Minuten gebraucht. </font><font style="vertical-align: inherit;">Vernetzung braucht Zeit.</font></font><br>
<br>
<pre><code class="python hljs"> <span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>):  <span class="hljs-comment"># loop over the dataset multiple times</span><font></font>
<font></font>
    running_loss = <span class="hljs-number">0.0</span>
    <span class="hljs-keyword">for</span> i, data <span class="hljs-keyword">in</span> enumerate(trainloader, <span class="hljs-number">0</span>):
        <span class="hljs-comment"># get the inputs; data is a list of [inputs, labels]</span><font></font>
        inputs, labels = data<font></font>
<font></font>
        <span class="hljs-comment"># zero the parameter gradients</span><font></font>
        optimizer.zero_grad()<font></font>
<font></font>
        <span class="hljs-comment"># forward + backward + optimize</span><font></font>
        outputs = net(inputs)<font></font>
        loss = criterion(outputs, labels)<font></font>
        loss.backward()<font></font>
        optimizer.step()<font></font>
<font></font>
        <span class="hljs-comment"># print statistics</span><font></font>
        running_loss += loss.item()<font></font>
        <span class="hljs-keyword">if</span> i % <span class="hljs-number">2000</span> == <span class="hljs-number">1999</span>:    <span class="hljs-comment"># print every 2000 mini-batches</span>
            print(<span class="hljs-string">'[%d, %5d] loss: %.3f'</span> %<font></font>
                  (epoch + <span class="hljs-number">1</span>, i + <span class="hljs-number">1</span>, running_loss / <span class="hljs-number">2000</span>))<font></font>
            running_loss = <span class="hljs-number">0.0</span><font></font>
<font></font>
print(<span class="hljs-string">'Finished Training'</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir erhalten folgendes Ergebnis: Wir </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sw/05/k2/sw05k2ewk-gu9fiyrv3xncxjaki.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
speichern unser trainiertes Modell:</font></font><br>
<br>
<pre><code class="python hljs">PATH = <span class="hljs-string">'./cifar_net.pth'</span>
torch.save(net.state_dict(), PATH)</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Testen des Netzwerks mit Testdaten</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben das Netzwerk anhand einer Reihe von Trainingsdaten trainiert. </font><font style="vertical-align: inherit;">Wir müssen jedoch überprüfen, ob das Netzwerk überhaupt etwas gelernt hat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden dies überprüfen, indem wir die Klassenbezeichnung vorhersagen, die das neuronale Netzwerk ausgibt, und auf Wahrheit prüfen. </font><font style="vertical-align: inherit;">Wenn die Prognose korrekt ist, fügen wir die Stichprobe der Liste der korrekten Prognosen hinzu. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lassen Sie uns das Bild aus der Testsuite zeigen:</font></font><br>
<br>
<pre><code class="python hljs">dataiter = iter(testloader)<font></font>
images, labels = dataiter.next()<font></font>
<font></font>
<span class="hljs-comment"># print images</span><font></font>
imshow(torchvision.utils.make_grid(images))<font></font>
print(<span class="hljs-string">'GroundTruth: '</span>, <span class="hljs-string">' '</span>.join(<span class="hljs-string">'%5s'</span> % classes[labels[j]] <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(<span class="hljs-number">4</span>)))</code></pre><br>
<img src="https://habrastorage.org/webt/hp/ph/zm/hpphzma6rus04gw-edxsowf1ifu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bitten Sie nun das neuronale Netz, uns zu sagen, was auf diesen Bildern zu sehen ist:</font></font><br>
<br>
<pre><code class="python hljs"><font></font>
net = Net()<font></font>
net.load_state_dict(torch.load(PATH))<font></font>
<font></font>
outputs = net(images)<font></font>
<font></font>
_, predicted = torch.max(outputs, <span class="hljs-number">1</span>)<font></font>
<font></font>
print(<span class="hljs-string">'Predicted: '</span>, <span class="hljs-string">' '</span>.join(<span class="hljs-string">'%5s'</span> % classes[predicted[j]]
                              <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(<span class="hljs-number">4</span>)))
</code></pre><br>
<img src="https://habrastorage.org/webt/j2/vp/uc/j2vpucdaps0fuci2yg38ip2fbdo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Ergebnisse scheinen ziemlich gut zu sein: Das Netzwerk hat drei der vier Bilder korrekt identifiziert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mal sehen, wie das Netzwerk im gesamten Datensatz funktioniert.</font></font><br>
<br>
<pre><code class="python hljs">
correct = <span class="hljs-number">0</span>
total = <span class="hljs-number">0</span>
<span class="hljs-keyword">with</span> torch.no_grad():
    <span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> testloader:<font></font>
        images, labels = data<font></font>
        outputs = net(images)<font></font>
        _, predicted = torch.max(outputs.data, <span class="hljs-number">1</span>)<font></font>
        total += labels.size(<span class="hljs-number">0</span>)<font></font>
        correct += (predicted == labels).sum().item()<font></font>
<font></font>
print(<span class="hljs-string">'Accuracy of the network on the 10000 test images: %d %%'</span> % (
    <span class="hljs-number">100</span> * correct / total))</code></pre><br>
<img src="https://habrastorage.org/webt/fy/i4/cn/fyi4cnkjgimshkhhbsva4udixhw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es sieht so aus, als ob das Netzwerk es weiß und funktioniert. </font><font style="vertical-align: inherit;">Wenn er Klassen zufällig definiert, beträgt die Genauigkeit 10%. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun wollen wir sehen, welche Klassen das Netzwerk besser definiert:</font></font><br>
<br>
<pre><code class="python hljs">class_correct = list(<span class="hljs-number">0.</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">10</span>))<font></font>
class_total = list(<span class="hljs-number">0.</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">10</span>))
<span class="hljs-keyword">with</span> torch.no_grad():
    <span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> testloader:<font></font>
        images, labels = data<font></font>
        outputs = net(images)<font></font>
        _, predicted = torch.max(outputs, <span class="hljs-number">1</span>)<font></font>
        c = (predicted == labels).squeeze()<font></font>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">4</span>):<font></font>
            label = labels[i]<font></font>
            class_correct[label] += c[i].item()<font></font>
            class_total[label] += <span class="hljs-number">1</span><font></font>
<font></font>
<font></font>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">10</span>):<font></font>
    print(<span class="hljs-string">'Accuracy of %5s : %2d %%'</span> % (<font></font>
        classes[i], <span class="hljs-number">100</span> * class_correct[i] / class_total[i]))</code></pre><br>
<img src="https://habrastorage.org/webt/l9/s9/qu/l9s9quxd-lzx2kh7wphxe9-2qzs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es scheint, dass das Netzwerk Autos und Schiffe am besten bestimmt: 71% Genauigkeit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Netzwerk funktioniert also. </font><font style="vertical-align: inherit;">Versuchen wir nun, seine Arbeit auf den Grafikprozessor (GPU) zu übertragen und zu sehen, was sich ändert.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GPU-Training für neuronale Netze</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zunächst erkläre ich kurz, was CUDA ist. </font><font style="vertical-align: inherit;">CUDA (Compute Unified Device Architecture) ist eine von NVIDIA entwickelte Parallel-Computing-Plattform für das allgemeine Computing auf GPUs. </font><font style="vertical-align: inherit;">Mit CUDA können Entwickler mithilfe der Funktionen von GPUs Computeranwendungen erheblich beschleunigen. </font><font style="vertical-align: inherit;">Auf unserem von uns gekauften Server ist diese Plattform bereits installiert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Definieren wir zunächst unsere GPU als das erste sichtbare Cuda-Gerät.</font></font><br>
<br>
<pre><code class="python hljs">device = torch . device ( <span class="hljs-string">"cuda:0"</span> <span class="hljs-keyword">if</span> torch . cuda . is_available () <span class="hljs-keyword">else</span> <span class="hljs-string">"cpu"</span> )
<span class="hljs-comment"># Assuming that we are on a CUDA machine, this should print a CUDA device:</span>
<span class="hljs-keyword">print</span> ( device )</code></pre><br>
<img src="https://habrastorage.org/webt/n2/2k/bf/n22kbfvilr6kn30eel6dfhaose4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Senden Sie das Netzwerk an die GPU:</font></font><br>
 <br>
<pre><code class="python hljs">net.to(device)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir müssen auch bei jedem Schritt Eingaben und Ziele an die GPU senden:</font></font><br>
<br>
<pre><code class="python hljs">inputs, labels = data[<span class="hljs-number">0</span>].to(device), data[<span class="hljs-number">1</span>].to(device)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Führen Sie das Netzwerk-Retraining bereits auf der GPU aus: </font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> torch.optim <span class="hljs-keyword">as</span> optim<font></font>
<font></font>
criterion = nn.CrossEntropyLoss()<font></font>
optimizer = optim.SGD(net.parameters(), lr=<span class="hljs-number">0.001</span>, momentum=<span class="hljs-number">0.9</span>)
<span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>):  <span class="hljs-comment"># loop over the dataset multiple times</span><font></font>
<font></font>
    running_loss = <span class="hljs-number">0.0</span>
    <span class="hljs-keyword">for</span> i, data <span class="hljs-keyword">in</span> enumerate(trainloader, <span class="hljs-number">0</span>):
        <span class="hljs-comment"># get the inputs; data is a list of [inputs, labels]</span>
    inputs, labels = data[<span class="hljs-number">0</span>].to(device), data[<span class="hljs-number">1</span>].to(device)<font></font>
<font></font>
        <span class="hljs-comment"># zero the parameter gradients</span><font></font>
        optimizer.zero_grad()<font></font>
<font></font>
        <span class="hljs-comment"># forward + backward + optimize</span><font></font>
        outputs = net(inputs)<font></font>
        loss = criterion(outputs, labels)<font></font>
        loss.backward()<font></font>
        optimizer.step()<font></font>
<font></font>
        <span class="hljs-comment"># print statistics</span><font></font>
        running_loss += loss.item()<font></font>
        <span class="hljs-keyword">if</span> i % <span class="hljs-number">2000</span> == <span class="hljs-number">1999</span>:    <span class="hljs-comment"># print every 2000 mini-batches</span>
            print(<span class="hljs-string">'[%d, %5d] loss: %.3f'</span> %<font></font>
                  (epoch + <span class="hljs-number">1</span>, i + <span class="hljs-number">1</span>, running_loss / <span class="hljs-number">2000</span>))<font></font>
            running_loss = <span class="hljs-number">0.0</span><font></font>
<font></font>
print(<span class="hljs-string">'Finished Training'</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieses Mal dauerte das Netzwerktraining etwa 3 Minuten. </font><font style="vertical-align: inherit;">Denken Sie daran, dass dieselbe Phase auf einem normalen Prozessor 5 Minuten dauerte. </font><font style="vertical-align: inherit;">Der Unterschied ist nicht signifikant, weil unser Netzwerk nicht so groß ist. </font><font style="vertical-align: inherit;">Wenn Sie große Arrays für das Training verwenden, erhöht sich der Unterschied zwischen der Geschwindigkeit der GPU und dem herkömmlichen Prozessor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das scheint alles zu sein. </font><font style="vertical-align: inherit;">Was wir geschafft haben:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir haben die GPU untersucht und den Server ausgewählt, auf dem sie installiert ist.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir haben eine Softwareumgebung zum Erstellen eines neuronalen Netzwerks eingerichtet.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir haben ein neuronales Netzwerk für die Bilderkennung erstellt und trainiert.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir haben das Training des Netzwerks mit der GPU wiederholt und eine Geschwindigkeitssteigerung erhalten.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gerne beantworte ich Fragen in den Kommentaren.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de488548/index.html">Experiment: Wie man lernt, populäre Texte auf Englisch zu erstellen (und warum die englischsprachigen Habristen so wenig lesen)</a></li>
<li><a href="../de488550/index.html">Wer will aus IT-Giganten Genossenschaften machen?</a></li>
<li><a href="../de488552/index.html">Apple FAS- und Kindersicherungsentwickler</a></li>
<li><a href="../de488558/index.html">Sicherstellung einer hohen Verfügbarkeit von Anwendungen mit Kafka Streams</a></li>
<li><a href="../de488560/index.html">Kostenloses Telegramm-Bot-Hosting auf der Google Cloud Platform</a></li>
<li><a href="../de488566/index.html">Wie ein QS-Techniker einen ganzen Tag gespart hat, indem er AutoTests in Visual Studio und Test IT verknüpft hat</a></li>
<li><a href="../de488568/index.html">Träumen neuronale Netze von elektrischem Geld?</a></li>
<li><a href="../de488570/index.html">Wie der US Secret Service Cyberpunk-Rollenspiel mit einem Lehrbuch für Hacker verwechselte</a></li>
<li><a href="../de488572/index.html">Unity Analyzer jetzt Open Source</a></li>
<li><a href="../de488574/index.html">Die Schüler schreiben einen Uart-Treiber für STM32F411</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>