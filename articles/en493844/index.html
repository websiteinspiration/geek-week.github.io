<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧑🏾‍🤝‍🧑🏽 🚜 🚩 Book “Databases. Reliability Engineering ⚗️ 😻 🎅</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, habrozhiteli! In the field of IT, a real revolution took place - they began to work with the infrastructure as with code. This process creates ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Book “Databases. Reliability Engineering</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/493844/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/w8/jj/ef/w8jjefhrq7lvulblnrwsyrgfzri.jpeg" align="left" alt="image"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hello, habrozhiteli! In the field of IT, a real revolution took place - they began to work with the infrastructure as with code. This process creates not only new problems, but also opportunities to ensure the uptime of databases. The authors have prepared this practical guide for anyone who wishes to join the community of modern database reliability engineers (DBRE).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this book: • storage requirements and risk management requirements. </font><font style="vertical-align: inherit;">• Creation and development of an architecture that provides transparent database support. </font><font style="vertical-align: inherit;">• streamlining the release management process. </font><font style="vertical-align: inherit;">• storage, indexing and replication of data. </font><font style="vertical-align: inherit;">• determining the characteristics of the data warehouse and selecting the best options for its use. </font><font style="vertical-align: inherit;">• research of architecture components and creation of architectures oriented to big data processing.</font></font><br>
<a name="habracut"></a><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Who is this book for?</font></font></b><div class="spoiler_text"> ,   ,      .   ,            .     ,     .      ,     ,       .               .<br>
<br>
 ,              Linux/Unix,   - /  .  ,         —       —              —  . ,   ,              .<br>
<br>
    ,     ,      ,       .     ,         ,        .<br>
<br>
, ,      .  ,   -     ,       .      ,      Excel,       .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Publication structure</font></font></b><div class="spoiler_text">       .          .     ,    ,      ,      .       :  , , ,      .  ,      .    !<br>
<br>
   ,       :          (DBRE),        (RE).     ,     .  DBR-        ,     ,     .<br>
<br>
   ,       .      .       ,       .    —    ,               .   ,       ,     ,       ,   ,   ,    ,      . .<br>
   ,   .<br>
<br>
 1        .     ,        —  ,    DBRE, — , ,      DBRE      .<br>
<br>
 2      .    ,      .     ,         , —      ,  .  ,           .<br>
  3        .                  .       .<br>
<br>
  4    .    .  ,    ,        .        ,    .<br>
<br>
  5  6        .       .      ,  ,   ,        ,    ,        .<br>
<br>
 7      . , ,     DBE.   — ,  .       ,         ,        ,    .<br>
<br>
  8    .  ,       ?           SQL?   — ,   .<br>
<br>
 9  .        .              .<br>
<br>
  10   ,    .  ,    ,           .    ,    .<br>
<br>
 11       .      ,          ,      .     ,        ,    ,     .<br>
<br>
  12         (),      ,  ,    .    ,     « » ()  ,      ,           .      —     .<br>
<br>
,   13         .   ,                  .<br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Backup &amp; Restore</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In chapters 5 and 6, we focused on designing and managing infrastructure. This means that you have a good idea of ​​how to create and deploy distributed infrastructures in which databases work, as well as manage them. We looked at methods for quickly adding new nodes to increase capacity or replace a failed node. Now it’s time to discuss the most important thing - backing up and restoring data.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's face it: everyone considers backing up and restoring boring and tedious activities. For most, these procedures are the epitome of routine. The team does not like to interact with junior engineers and external contractors and work with third-party tools. Before, we had to deal with just awful backup software. We sympathize with you, honestly.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nevertheless, this is one of the most significant processes in your work. Moving important data between nodes, data centers and transferring it to long-term archives is a constant movement of the most valuable asset of your business - information. We strongly recommend that you do not consider recovery and backup operations as second-class operations, but treat them as VIP operations. Everyone should not only understand the goals of data recovery, but also be familiar with the principles of this work and process monitoring. The DevOps philosophy assumes that everyone should be able to write code and implement it in a really working system. We invite each engineer to take part in critical data recovery processes at least once.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We create and store copies of data - backups and archives - as a means of meeting a specific need. They are needed for recovery. Sometimes recovery is a pleasant and leisurely affair, for example, when creating an environment for auditors or setting up an alternative environment. But most often it is required to quickly replace failed nodes or increase the capacity of existing clusters.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Today, in distributed environments, we are facing new challenges in data backup and recovery. </font><font style="vertical-align: inherit;">As before, most local data sets are distributed within reasonable limits, up to a few terabytes maximum. </font><font style="vertical-align: inherit;">The difference is that these local data sets are only part of a large distributed set. </font><font style="vertical-align: inherit;">Site recovery is a relatively controlled process, but maintaining state in a cluster is a more difficult task.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Basic principles</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We start by discussing the basic principles of data backup and recovery. </font><font style="vertical-align: inherit;">To an experienced database specialist or system engineer, some of them may seem elementary. </font><font style="vertical-align: inherit;">If so, you can easily scroll through several pages.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Physical or logical?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A physical backup of the database backs up the real files in which the data is stored. This means that the file formats typical of the database are supported, and usually there is a set of metadata in the database that determines what files are and what database structures are in them. If, when creating backup copies of files, you expect another database instance to be able to use them, then you will need to make a backup and save the metadata associated with it, on which this database relies, so that the backup is portable.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When creating a logical backup, the data is exported from the database to a format that theoretically can be transferred to any system. Usually metadata is also saved, but most likely it will be relevant for the moment when the backup was performed. An example is the export of all insert statements needed to populate an empty database when updating it. Another example is a JSON string. As a result, logical backups, as a rule, take a lot of time, because this is not a physical copy and write operation, but row-by-line data extraction. Similarly, recovery is accompanied by all the usual database overhead, such as locking and creating redo and undo logs.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A great example of this separation is the distinction between row-based replication and statement-based replication. </font><font style="vertical-align: inherit;">In many relational databases, agent-based replication means that after writing to the version control system, a journal of operators of the data manipulation language (DML, or insert, update, replace, delete) is added to them. </font><font style="vertical-align: inherit;">These statements are passed to the replicas in which they are played. </font><font style="vertical-align: inherit;">Another approach to replication is based on strings or Change Data Capture (CDC).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Autonomous or operational?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An offline (or cold) backup is one in which the database instance using the files is disabled. Thanks to this, you can quickly copy files without worrying about maintaining the state at the moment, while other processes read and write data. This is an ideal, but very rare condition.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
During an online (or hot) backup, you still copy all the files, but there is additional complexity associated with the need to obtain a consistent snapshot of the data, which must exist at that time during which the backup is performed. </font><font style="vertical-align: inherit;">In addition, if the current traffic accesses the database during the backup, you must be careful not to exceed the throughput of the I / O subsystem at the storage level. </font><font style="vertical-align: inherit;">Even limiting the load, you may find that the mechanisms used to maintain consistency introduce unreasonable delays in the application.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Full, incremental and differential</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Having a full backup, no matter what method it is created, means that the local data set is fully reserved. For small datasets, this is pretty common. For 10 TB, this can take an incredible amount of time.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Differential backups allow you to back up only data that has changed since the last full backup. But in practice, more data is usually backed up than just changed because the data is organized in the form of structures of a certain size - pages. The page size is, for example, 16 or 64 Kbytes, and the page contains many lines of data. Differential backups back up all pages on which data has been changed. Thus, with large page sizes, backups of a much larger size are obtained than if only modified data were stored there.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An incremental backup is similar to a differential one, except that the date of the last backup, incremental or full, will be used as the time point to which the changed data relates. </font><font style="vertical-align: inherit;">Thus, when restoring from an incremental backup, you may need to restore the last full backup, as well as one or more incremental backups, to get to the current point. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Knowing this, we will discuss several points that should be considered when choosing an effective backup and data recovery strategy.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Data Recovery Considerations</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When choosing an effective strategy for the first time, you should again consider your service quality targets (SLOs), which were discussed in Chapter 2. In particular, you need to consider the availability and reliability indicators. Whatever strategy you choose in the end, it should still include the ability to recover data within the predefined limits on uptime. And you will have to back up quickly to ensure compliance with your reliability specifications. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you back up every day and keep the transaction logs between backups in storage at the site level, you can easily lose these transactions until the next backup.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition, you need to consider how the data set functions within a holistic ecosystem. For example, your orders can be stored in a relational database, where everything is fixed in the form of transactions and, therefore, is easily restored in relation to other data stored in this database. However, after the order is formed, the workflow can be triggered by an event stored in the queue system or storage of the "key - value" type. These systems can ensure data integrity only occasionally or even briefly (to be ephemeral), referring, if necessary, to the relational database or using it for recovery. How to consider these workflows during recovery?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you are dealing with an environment where rapid development is underway, it may turn out that the data stored in the backup was written and used by one version of the application, and after restoring another one is executed. How will the application interact with outdated data? Well, if the data is versioned - then this can be taken into account, but you should be aware of this possibility and be prepared for such cases. Otherwise, the application may logically damage this data, which will lead to even greater problems in the future.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All these and many other nuances that cannot be predicted must be taken into account when planning data recovery. </font><font style="vertical-align: inherit;">As stated in chapter 3, it is impossible to prepare for any situation. </font><font style="vertical-align: inherit;">But it’s very important to try to do it. </font><font style="vertical-align: inherit;">Data recovery is one of the most important duties of an engineer to ensure database reliability. </font><font style="vertical-align: inherit;">Thus, your data recovery plan should be as broad as possible and take into account as many potential problems as possible.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recovery Scenarios</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Having taken all of the above into account, we will discuss the types of incidents and operations that may require data recovery so that all needs can be planned. First, you can divide all the scenarios into planned and unplanned. Considering data recovery only as a tool for resolving emergencies, you will limit the tools of your team only to emergency care and simulate accidents. Conversely, if data recovery is included in everyday activities, a higher degree of awareness and successful resolution of emergencies can be expected. In addition, we will have more data to determine if the recovery strategy supports our SLOs. With a few daily runs of the script, it will be easier to get a set of samples,which includes limit values ​​and which can be used quite confidently for planning.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scheduled Recovery Scenarios</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What daily tasks can restore processes integrate into? </font><font style="vertical-align: inherit;">Here is the list that we most often met on different sites:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the creation of new nodes and clusters in an industrial operation environment;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">creation of various environments;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performing extraction, transformation and loading (Extract, Transform and Load, ETL) and stages of the data processing technological process for sequentially placed storages;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performance testing.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When performing these operations, be sure to include the recovery process on the operational control stack. </font><font style="vertical-align: inherit;">Consider the following indicators.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Time. </font><font style="vertical-align: inherit;">How long does it take to complete each component and the whole process? </font><font style="vertical-align: inherit;">Unpacking? </font><font style="vertical-align: inherit;">Copy? </font><font style="vertical-align: inherit;">Log execution? </font><font style="vertical-align: inherit;">Testing?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The size. </font><font style="vertical-align: inherit;">How much space does a backup take, compressed and uncompressed?</font></font></li>
<li> .     ?</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This information will help you avoid bandwidth problems, which will help ensure the stability of the recovery process. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">New Nodes and Clusters in an Industrial Operating Environment</font></font><br>
</b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Whether your databases are part of an unchanging infrastructure or not, there are opportunities for regular rebuilds, in which recovery procedures will be used as necessary. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Databases are rarely included in the automatic scaling of systems due to the amount of time that may be required for the initial loading of a new node and its placement in a cluster. Nevertheless, there are no reasons preventing the team from creating a schedule for regularly adding new nodes to the cluster to test these processes. Chaos Monkey ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://bit.ly/2zy1qsE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) - a tool developed by Netflix that randomly shuts down systems, allows you to do this in such a way that you can test the entire process of monitoring, issuing notifications, sorting and restoring. If you have not already done so, you can include this in the plan of the checklist of processes that your operations department must perform at regular intervals so that all employees familiarize themselves with the procedure. These actions allow you to test not only full and incremental recovery, but also the inclusion of replication and the process of putting the node into operation. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Create different environments</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You will inevitably create development, integration and operational testing environments for demonstration and other purposes. Some of these environments require full data recovery, and they need to implement node recovery and full cluster recovery. Some environments have other requirements, such as partial recovery support for feature testing and data cleansing to ensure user privacy. This allows you to test data recovery at a specific point in time, as well as the recovery of specific objects. All this is very different from the standard full recovery and is useful for repairing damage caused by operator actions and application errors. By creating an API,that provide data recovery at the facility level and at a specific point in time, you can facilitate the automation and familiarization of employees with these processes.</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ETL and pipeline processes for data warehouses located further down the pipeline</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
As for the tasks of building an environment, processes and recovery APIs from snapshots or at the level of individual objects can be successfully applied when transferring data from working databases to pipelines for further analysis and to stream storage . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Field Testing</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
During the execution of various test scenarios, you will need copies of the data. Some tests, for example for capacity and load, require a full set of data, which is great for full recovery. Functional testing may require smaller datasets, which will allow recovery at a specific point in time and at the facility level.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Data recovery testing itself can be a continuous operation. </font><font style="vertical-align: inherit;">In addition to using data recovery processes in everyday scenarios, you can configure continuous recovery operations. </font><font style="vertical-align: inherit;">This will automate testing and validation in order to quickly identify any problems that may arise if the backup process is interrupted. </font><font style="vertical-align: inherit;">When it comes to implementing this process, many ask how to verify the success of a recovery. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When creating a backup, you can get a lot of data that you can then use for testing, for example:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The most recent identifier in the auto-increment sequence</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line counter for objects;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">checksums for subsets of data that are only inserted and therefore can be considered immutable;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">checksums in schema definition files.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As with any testing, the approach should be multilevel. </font><font style="vertical-align: inherit;">There are a number of tests that will either succeed or quickly fail. </font><font style="vertical-align: inherit;">This should be the first level of testing. </font><font style="vertical-align: inherit;">Examples are comparing checksums for metadata / object definitions, successfully starting a database instance, and successfully connecting to a replication stream. </font><font style="vertical-align: inherit;">Operations that may take longer, such as calculating checksums and counting tables, should be performed later during the check.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unplanned scripts</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Taking into account all the daily planned scenarios that can be used, the data recovery process should be well debugged, documented, worked out and sufficiently free from errors and problems. </font><font style="vertical-align: inherit;">Thanks to this, unplanned scenarios rarely turn out to be as frightening as they could be. </font><font style="vertical-align: inherit;">The team should not see the difference between planned and unplanned recovery. </font><font style="vertical-align: inherit;">We list and consider in detail situations that may require us to perform recovery processes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">user error</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">application error;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">availability of infrastructure services;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">operating system errors and hardware errors;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hardware failures;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data center failures.</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">User</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
error Ideally, user errors should rarely occur. By building a “railing” and a “barrier” for engineers, you can prevent many of these situations. However, there is always the possibility that the operator will accidentally cause damage. A typical example is the everywhere and for all forgotten WHERE clause when executing UPDATE or DELETE in a database client application. Or, for example, the execution of the data cleaning script is not in a test environment, but in a working "production" system. Often the operation is performed correctly, but at the wrong time or not for those hosts. All this relates to user errors. Often they are identified and corrected immediately. However, sometimes the consequences of such changes go unnoticed for several days or weeks. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Application errors</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Application errors are the worst of the scenarios discussed, as they can be very insidious. Applications are constantly changing the way they interact with data warehouses. Many applications also manage referential integrity and external pointers to resources such as files or third-party identifiers. It’s scary to imagine what will happen if you just make a change that spoils the data, deletes them or adds incorrect data in ways that can go unnoticed for quite some time. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Infrastructure Services</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In Chapter 6, we introduced the magic of infrastructure management services. Unfortunately, these systems can turn out to be as destructive as useful, which can lead to large-scale consequences related to editing a file, pointing to another environment or incorrect configuration settings. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OS errors and hardware errors</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The operating systems and equipment with which they interact are also systems created by people, and thus errors can occur in them that can have unexpected consequences due to undocumented or poorly known configurations. In the context of data recovery, this is especially true with respect to the way data is transferred from the database via OS caches to file systems, controllers, and eventually to disks. Damage or loss of data happens much more often than we think. Unfortunately, our trust in and reliance on these mechanisms gives rise to the expectation of data integrity instead of skepticism about it.</font></font><br>
<br>
<blockquote>  <br>
<br>
        Netflix  2008 .            (ECC). ECC       .  , ECC-   ,    ,    . ,    46     512-     92  . ,   ,    ,       « »  S.M.A.R.T.    92        .     . , ?<br>
<br>
             .        ,        ,      .        ,      .   —  .<br>
<br>
      ,   ZFS,      ,    .    RAID-,      ,     .<br>
</blockquote><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hardware failures</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Hardware components fail in principle, and in distributed systems this happens regularly. You constantly encounter disk, memory, processor, controller, and network device failures. The consequences of these hardware failures can be the failure of nodes or delays on nodes, which makes the system unusable. Shared systems, such as network devices, can affect entire clusters, making them inaccessible or breaking them into smaller clusters that are not aware that the network has been divided. This can lead to quick and significant discrepancies in the data that needs to be combined and corrected. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Data Center Failures</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sometimes hardware problems at the network level lead to crashes in the data center. </font><font style="vertical-align: inherit;">It happens that overloading the storage backplanes causes cascading failures, as was the case with Amazon web services in 2012 ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://bit.ly/2zxSpzR</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Sometimes hurricanes, earthquakes and other disasters lead to the failure of entire data centers. </font><font style="vertical-align: inherit;">Subsequent recovery will test even the most reliable recovery strategies for strength.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Script scope</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Having enumerated the planned and unplanned scenarios that may necessitate recovery, we add one more dimension to these events so that our presentation becomes voluminous. </font><font style="vertical-align: inherit;">This will be useful for choosing the most appropriate response method. </font><font style="vertical-align: inherit;">Consider the following options:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">failure localized within a single node;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">failure of the entire cluster;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A failure that affects the entire data center or multiple clusters.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the event of a local, or single-site, failure, recovery is limited to one host. </font><font style="vertical-align: inherit;">You may add a new node to the cluster to increase capacity or replace a failed node. </font><font style="vertical-align: inherit;">Or, the system implements continuous updating and then restoration will be performed node by node. </font><font style="vertical-align: inherit;">In any case, this is a local recovery. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At the cluster level, the need for recovery is global for all members of this cluster. </font><font style="vertical-align: inherit;">Perhaps there was a destructive change or deletion of data that cascaded to all nodes. </font><font style="vertical-align: inherit;">Or you need to introduce a new cluster to test capacity.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If there was a failure on the scale of the data center or several clusters, it means that it is necessary to restore all the data in the place of their physical location or throughout the area of ​​failure. </font><font style="vertical-align: inherit;">This may be due to a failure of the shared data warehouse or a failure that caused a catastrophic failure of the data center. </font><font style="vertical-align: inherit;">Such recovery may also be required during the planned deployment of a new secondary site. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition to the scope, there is a dataset scope. </font><font style="vertical-align: inherit;">Here you can list three possible options:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">one object;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">several objects;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">database metadata.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At the scale of one object, only this particular object requires data recovery - some or all. </font><font style="vertical-align: inherit;">The case discussed earlier, as a result of which when the DELETE operation was performed, more data was deleted than planned, refers to a failure within the same object. </font><font style="vertical-align: inherit;">If several objects fail, several or, possibly, all objects in a particular database are affected. </font><font style="vertical-align: inherit;">This can happen if the application is damaged, the update or segment migration fails. </font><font style="vertical-align: inherit;">Finally, there are crashes on the scale of the database metadata when everything is in order with the data stored in the database, but metadata is lost that makes it usable, such as user data, security privileges, or compliance with OS files.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Script consequences</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is important not only to identify the scenario requiring recovery and to identify the area of ​​failure, but also to determine the possible consequences, since they will be significant when choosing an approach to recovery. </font><font style="vertical-align: inherit;">If data loss does not affect SLO, you can choose a methodical and slow approach that minimizes the expansion of consequences. </font><font style="vertical-align: inherit;">The more global changes that lead to the disruption of SLO should be approached with caution, choosing a quick service recovery and only then moving on to a long-term cleanup. </font><font style="vertical-align: inherit;">All approaches can be divided into the following three categories.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Impact on SLO, application failure, affected most users.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Threat SLO, some users have suffered.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Functions not threatening SLO are affected.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">About the authors</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Campbell Lane</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Laine Campbell) is a senior manager (Senior Director) for the design company Fastly. She was also the founder and CEO of PalominoDB / Blackbird, a consulting service that maintains databases for several companies, including Obama for America, Activision Call of Duty, Adobe Echosign, Technorati, Livejournal, and Zendesk. She has 18 years of experience operating databases and scalable distributed systems. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cherity Majors</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Charity Majors) is the CEO and co-founder of honeycomb.io. Combining the accuracy of log aggregators, time series speed metrics, and the flexibility of Application Performance Metrics (APMs), honeycomb is the first truly new generation analytic service in the world. Cheriti was previously a Parse / Facebook operations specialist, managing a huge fleet of MongoDB replica sets, as well as Redis, Cassandra, and MySQL. She also worked closely with the RocksDB team on Facebook, participating in the development and deployment of the world's first Mongo + Rocks installation using the storage plug-in API. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
»More information on the book can be found on </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the publisher’s website</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
» </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contents</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
» </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Excerpt</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For Khabrozhiteley 25% discount on coupon - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Databases</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Upon payment of the paper version of the book, an electronic book is sent by e-mail.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en493828/index.html">How the interface tells stories in video games</a></li>
<li><a href="../en493830/index.html">What questions are asked by Junior iOS developer at the first interviews</a></li>
<li><a href="../en493832/index.html">Coronavirus COVID-19 Distribution Dashboard (React + Chart.js + BootstrapTable)</a></li>
<li><a href="../en493840/index.html">Reviews: Asana, Jira, Bitrix-24, Trello, YouGile. What do you like and what infuriates?</a></li>
<li><a href="../en493842/index.html">Secure remote access with Check Point solutions + free licenses</a></li>
<li><a href="../en493848/index.html">I want to start a blog, but I don’t have my own team. How to choose copywriting contractors?</a></li>
<li><a href="../en493850/index.html">Which of the developers living in the same city earns more: working remotely or in the office?</a></li>
<li><a href="../en493852/index.html">CloudFlare - Internet Cancer</a></li>
<li><a href="../en493856/index.html">Linux Strace: History, Design, and Usage</a></li>
<li><a href="../en493858/index.html">10 useful books on IT service management</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>