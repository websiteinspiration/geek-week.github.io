<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌅 💱 😑 DockerコンテナーでのEthereum Gethプライベートネットワークの作成 👨🏾‍🚒 🖐🏿 👩🏻‍🚒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Gethに基づくプライベートEthereumネットワークを展開する必要がある場合は、たとえば、物理サーバーまたは仮想マシン上にネットワークノードを作成することでこれを行うことができます。ただし、DockerハブリポジトリからGethコンテナを使用する方がはるかに簡単です。この場合、1つの仮想マシンま...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>DockerコンテナーでのEthereum Gethプライベートネットワークの作成</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/481052/"><img src="https://habrastorage.org/webt/bg/f3/as/bgf3asaindlkt8bxyfvzbrkwjl4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gethに基づくプライベートEthereumネットワークを展開する必要がある場合は、たとえば、物理サーバーまたは仮想マシン上にネットワークノードを作成することでこれを行うことができます。</font><font style="vertical-align: inherit;">ただし、DockerハブリポジトリからGethコンテナを使用する方がはるかに簡単です。</font><font style="vertical-align: inherit;">この場合、1つの仮想マシンまたは1つの物理サーバーにノードのネットワーク全体をインストールできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では、Debian 9（仮想または物理）を実行しているサーバーにDockerをインストールする方法、Gethを実行して複数のコンテナーを作成し、それらをプライベートネットワークに結合する方法について説明します。</font><font style="vertical-align: inherit;">コンテナで動作するGethノードにアクセスするNode.jsのサンプルスクリプトを提供します。</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dockerをインストールする</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dockerのインストールについては、公式Webサイトで説明されています。</font><font style="vertical-align: inherit;">Debian 9および10の場合、詳細な手順は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://docs.docker.com/install/linux/docker-ce/debian/にあります</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dockerをインストールする</font></font></b><div class="spoiler_text"> ,  :<br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># apt-get update</span></code></pre><br>
     :<br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># apt-get install apt-transport-https ca-certificates curl gnupg2 software-properties-common</span></code></pre><br>
   GPG:<br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add -</span></code></pre><br>
,       9DC8 5822 9FC7 DD38 854A E2D8 8D81 803C 0EBF CD88:<br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># apt-key fingerprint 0EBFCD88</span><font></font>
pub   4096R/0EBFCD88 2017-02-22<font></font>
Key fingerprint = 9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88<font></font>
uid  Docker Release (CE deb) docker@docker.com<font></font>
sub   4096R/F273FCD8 2017-02-22<font></font>
</code></pre><br>
   Docker:<br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/debian $(lsb_release -cs) stable"</span>
</code></pre><br>
    Docker:<br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># apt-get update</span>
<span class="hljs-comment"># apt-get install docker-ce docker-ce-cli containerd.io</span></code></pre><br>
   ,    .     (Image) hello-world:<br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># docker run hello-world</span></code></pre><br>
    ,    .    ,      «Hello from Docker!». <br>
<br>
 ,  !        Geth  ,   .<br>
</div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーザー、ディレクトリ、ファイルを作成する</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユーザーのサーバーに本を作成し、ホームディレクトリに次のサブディレクトリを作成します。 </font></font><br>
<br>
<pre><code class="plaintext hljs">/home/book/dock-test<font></font>
/home/book/dock-test/distr<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、/ home / book / dock-testディレクトリにDockerfileを作成します。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リスト1.ファイル/ホーム/本/ dock-test / Dockerfile</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">FROM ubuntu:16.04<font></font>
LABEL version="1.0"<font></font>
LABEL maintainer="alexandre@frolov.pp.ru"<font></font>
ENV DEBIAN_FRONTEND=noninteractive<font></font>
<font></font>
RUN apt-get update &amp;&amp; apt-get install --yes software-properties-common<font></font>
RUN add-apt-repository ppa:ethereum/ethereum<font></font>
RUN apt-get update &amp;&amp; apt-get install --yes geth<font></font>
RUN adduser --disabled-login --gecos "" eth_book<font></font>
<font></font>
COPY distr /home/eth_book/distr<font></font>
RUN chown -R eth_book:eth_book /home/eth_book/distr<font></font>
<font></font>
USER eth_book<font></font>
WORKDIR /home/eth_book<font></font>
RUN geth --nousb init distr/genesis.json<font></font>
ENTRYPOINT bash<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このファイルは、Dockerコンテナーを作成するときに使用されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、Ethereumネットワークノードの初期化に必要な/home/book/dock-test/distr/genesis.jsonファイルを作成する必要があります。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リスト2. /home/book/dock-test/distr/genesis.jsonファイル</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">{<font></font>
 "config": {<font></font>
 "chainId": 98760,<font></font>
 "homesteadBlock": 0,<font></font>
 "eip150Block": 0,<font></font>
 "eip155Block": 0,<font></font>
 "eip158Block": 0<font></font>
 },<font></font>
 "difficulty": "10",<font></font>
 "gasLimit": "5100000",<font></font>
 "alloc": {}<font></font>
}</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、プライベートネットワーク98760の識別子を設定します。マイニングを容易にするために、難易度パラメーターに10を指定しました。これにより、比較的少量のメモリ（たとえば、4 GB）の仮想マシンで作業できるようになります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネットワークとコンテナーを作成する</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ノード間でデータを交換するために、コンテナー間にネットワークを作成します。</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># docker network create PRIVATENET</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、Dockerfileがある現在のディレクトリ/ home / book / dock-testを作成する必要があります。</font><font style="vertical-align: inherit;">次に、必要な数、たとえば3つのコンテナーを作成します。</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># docker build -t node01 .</span>
<span class="hljs-comment"># docker build -t node02 .</span>
<span class="hljs-comment"># docker build -t node03 .</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初のコンテナの作成には比較的長い時間がかかります。</font><font style="vertical-align: inherit;">必要な画像をダウンロードする必要があります。</font><font style="vertical-align: inherit;">ただし、次のコンテナはほぼ瞬時に作成されます。仮想マシンの作成速度と比較してみてください。たとえクローン作成であってもです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、4つのコンソールウィンドウを開きます。</font><font style="vertical-align: inherit;">そのうちの3つではコンテナを扱い、4つ目ではコンテナとネットワークについて必要なデータを受け取ります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初のコンソールウィンドウで、次のコマンドを発行します。</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># docker run --rm -it -p 8545:8545 --net=PRIVATENET node01</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のようなプロンプトが表示されます。</font></font><br>
<br>
<pre><code class="bash hljs">eth_book@304bf4f09063:~$</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目と3番目のコンソールウィンドウで、それぞれ次のコマンドを入力します。</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># docker run --rm -it -p 8546:8546 --net=PRIVATENET node02</span>
<span class="hljs-comment"># docker run --rm -it -p 8547:8547 --net=PRIVATENET node03</span>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ethereumプライベートネットワークノードとアカウントの作成</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在、Gethには3つのコンテナがあります。</font><font style="vertical-align: inherit;">それぞれに私たちのプライベートEthereumネットワークとアカウントのノードを作成しましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の3つのコンソールウィンドウにコマンドを入力します。</font></font><br>
<br>
<pre><code class="bash hljs">$ geth account new</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パスワードを入力する必要があります。</font><font style="vertical-align: inherit;">簡単にするために、各ノードで同じパスワードをテストに使用しますが、どこかに書き留めます。</font><font style="vertical-align: inherit;">パスワードを忘れた場合、回復することはできません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンソールでアカウントを作成すると、次のような公開鍵アドレスが表示されます。</font></font><br>
<br>
<pre><code class="plaintext hljs">Public address of the key:   0xc5Df10a76Bb559332c385F8cA789C0F37dD77A54<font></font>
Public address of the key:   0x0C976006a5762779bA36AC590D1D8Ebac1Ca2981<font></font>
Public address of the key:   0xaB627feab4e962222a3333F3b09182dF68bB9422<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アドレスを保存します（他にもあります）。</font><font style="vertical-align: inherit;">ノードを実行するためにそれらが必要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、ノードの初期化を開始する必要があります。</font><font style="vertical-align: inherit;">これは、次のコマンドを使用して行われます。</font></font><br>
<br>
<pre><code class="bash hljs">$ geth --nousb init distr/genesis.json</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンテナのすべてのコンソールウィンドウでこのコマンドを入力します。</font><font style="vertical-align: inherit;">--nousbオプションは、USBデバイスとのすべての通信を無効にします。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gethノードの実行</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、各コンソールウィンドウを順番に開き、以下のコマンドを使用してそこでGethを実行します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初のウィンドウ：</font></font><br>
<br>
<pre><code class="bash hljs">$ geth --identity=<span class="hljs-string">"Node01"</span> --etherbase <span class="hljs-string">"0xc5Df10a76Bb559332c385F8cA789C0F37dD77A54"</span> --mine --minerthreads 1 --verbosity 3 --networkid 98760 --rpc --rpcaddr 127.0.0.1 --nousb --rpcapi=<span class="hljs-string">"db,eth,net,web3,personal,web3"</span> console
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目のウィンドウ：</font></font><br>
<br>
<pre><code class="bash hljs">$ geth --identity=<span class="hljs-string">"Node02"</span> --etherbase <span class="hljs-string">"0x0C976006a5762779bA36AC590D1D8Ebac1Ca2981"</span> --mine --minerthreads 1 --verbosity 3 --networkid 98760 --rpc --rpcaddr 127.0.0.1 --rpcport=8546 --nousb --rpcapi=<span class="hljs-string">"db,eth,net,web3,personal,web3"</span> console
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3番目のウィンドウ：</font></font><br>
<br>
<pre><code class="bash hljs">$ geth --identity=<span class="hljs-string">"Node03"</span> --etherbase <span class="hljs-string">"0xaB627feab4e962222a3333F3b09182dF68bB9422"</span> --mine --minerthreads 1 --verbosity 3 --networkid 98760 --rpc --rpcaddr 127.0.0.1 --rpcport=8547 --nousb --rpcapi=<span class="hljs-string">"db,eth,net,web3,personal,web3"</span> console</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開いている各ウィンドウに、DAG生成に関するメッセージが表示されます。</font></font><br>
<br>
<pre><code class="plaintext hljs">…<font></font>
INFO [12-19|17:57:44.072] Generating DAG in progress               epoch=0 percentage=34 elapsed=29.740s<font></font>
INFO [12-19|17:57:44.898] Generating DAG in progress               epoch=0 percentage=35 elapsed=30.566s<font></font>
INFO [12-19|17:57:45.671] Generating DAG in progress               epoch=0 percentage=36 elapsed=31.339s<font></font>
…<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
生成が完了するまで待ちます。</font><font style="vertical-align: inherit;">その後、eth.hashrateとeth.blockNumberは0とは異なります。</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; eth.hashrate<font></font>
4<font></font>
&gt; eth.blockNumber<font></font>
2<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のように当座預金残高を確認できます。</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; web3.fromWei( eth.getBalance(eth.coinbase) )</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンソールウィンドウでの新しいブロックの作成に関するメッセージやその他のメッセージに煩わされないようにするには、exitコマンドでGethを終了し、verbosityパラメーターを1に設定して再起動します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネットワークノード</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、実行中のコンテナのリストを確認します。</font><font style="vertical-align: inherit;">4番目のコンソールウィンドウから次のコマンドを発行します。</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># docker ps</span><font></font>
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                    NAMES<font></font>
fa70a5418618        node03              <span class="hljs-string">"/bin/sh -c bash"</span>   2 hours ago         Up 2 hours          0.0.0.0:8547-&gt;8547/tcp   gifted_curran<font></font>
49a028744b4b        node02              <span class="hljs-string">"/bin/sh -c bash"</span>   2 hours ago         Up 2 hours          0.0.0.0:8546-&gt;8546/tcp   reverent_wescoff<font></font>
5a9ade2947eb        node01              <span class="hljs-string">"/bin/sh -c bash"</span>   2 hours ago         Up 2 hours          0.0.0.0:8545-&gt;8545/tcp   clever_ellis
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、コンテナごとに、その識別子、イメージ名、コンテナ名などの情報が表示されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンテナをネットワークに統合するには、プライベートPRIVATENETネットワーク内のコンテナのIPアドレスが必要です。</font><font style="vertical-align: inherit;">たとえば、次のように、これらのアドレスをコンテナIDで取得できます。</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># docker inspect 5a9ade2947eb | grep IPAddress</span>
            <span class="hljs-string">"SecondaryIPAddresses"</span>: null,
            <span class="hljs-string">"IPAddress"</span>: <span class="hljs-string">""</span>,
                    <span class="hljs-string">"IPAddress"</span>: <span class="hljs-string">"172.21.0.2"</span>,</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
docker network inspect PRIVATENETコマンドを使用することもできます。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docker network inspect PRIVATENET</font></font></b><div class="spoiler_text"><pre><code class="xml hljs">[<font></font>
    {<font></font>
        "Name": "PRIVATENET",<font></font>
        "Id": "576ec7edba5b4c228740deaf7fabb5e2ba003d310086153dd7f15e2c7de0c1b2",<font></font>
        "Created": "2019-12-20T11:52:07.90695857+03:00",<font></font>
        "Scope": "local",<font></font>
        "Driver": "bridge",<font></font>
        "EnableIPv6": false,<font></font>
        "IPAM": {<font></font>
            "Driver": "default",<font></font>
            "Options": {},<font></font>
            "Config": [<font></font>
                {<font></font>
                    "Subnet": "172.21.0.0/16",<font></font>
                    "Gateway": "172.21.0.1"<font></font>
                }<font></font>
            ]<font></font>
        },<font></font>
        "Internal": false,<font></font>
        "Attachable": false,<font></font>
        "Ingress": false,<font></font>
        "ConfigFrom": {<font></font>
            "Network": ""<font></font>
        },<font></font>
        "ConfigOnly": false,<font></font>
        "Containers": {<font></font>
            "49a028744b4b6073f6dbca23e78625bc58fc0cdacadec7cded4bb0e888c7e37b": {<font></font>
                "Name": "reverent_wescoff",<font></font>
                "EndpointID": "11006b596b5a46df9bf9f95a9456784795d333a3e6901b15bd2db746fd4b5513",<font></font>
                "MacAddress": "02:42:ac:15:00:03",<font></font>
                "IPv4Address": "172.21.0.3/16",<font></font>
                "IPv6Address": ""<font></font>
            },<font></font>
            "5a9ade2947ebd8e55594ede9763aac71f5e6529c03e762ef723adb2c592c5ccd": {<font></font>
                "Name": "clever_ellis",<font></font>
                "EndpointID": "41ef69a0a93b5b1de495836028bac1742c303de92ffe42a0855ed32c93c28953",<font></font>
                "MacAddress": "02:42:ac:15:00:02",<font></font>
                "IPv4Address": "172.21.0.2/16",<font></font>
                "IPv6Address": ""<font></font>
            },<font></font>
            "fa70a54186185de01db3647e7333bf6c71250162fafefb78dbe9998e5ac93f34": {<font></font>
                "Name": "gifted_curran",<font></font>
                "EndpointID": "d368c032bc0886c27ad4895d1856e4f00cf1b25ce040f3b42393dbff778c18e5",<font></font>
                "MacAddress": "02:42:ac:15:00:04",<font></font>
                "IPv4Address": "172.21.0.4/16",<font></font>
                "IPv6Address": ""<font></font>
            }<font></font>
        },<font></font>
        "Options": {},<font></font>
        "Labels": {}<font></font>
    }<font></font>
]<font></font>
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのコマンドで受信したデータを比較して、コンテナーのIPアドレスのリストを作成します。</font></font><br>
<br>
<pre><code class="plaintext hljs">node01 - 172.21.0.2<font></font>
node02 - 172.21.0.3<font></font>
node03 - 172.21.0.4<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、異なるリストが作成され、コンテナを再起動すると、これらのアドレスが変更される場合があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アドレスのリストを受け取ったら、-rpcaddrパラメーターでコンテナーのアドレスを指定して、すべてのコンテナーでgethを再起動します。もちろん、アドレス0.0.0.0を設定することもできますが、これはセキュリティの観点からは悪いことです。ノードには誰でも何でも接続できます。たとえば、ノードのロックが解除されるのを待って、これらのノードからすべての資金を「引き出し」ようとするボットである可能性があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ノードをマージするには、admin.addPeerコマンドを使用する必要があります。このコマンドのパラメーターとして、URLをenode形式で渡す必要があります。 admin.nodeInfo.enodeコマンドを使用して、コンテナーごとにこのURLを取得します。</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; admin.nodeInfo.enode<font></font>
"enode://0a84e562c9b22e43269b7dca215cf2ed8c20bbf35da67bae8d5ee81b36d8bbb69e3ec704b9b6f7501059fe861843a836b2fbab641f36616cdd77365b1a522d5b@62.152.63.28:30303?discport=1350"<font></font>
<font></font>
"enode://ee49f69e25c068e006fec4a8d74370370b1d2be9715b86eddd99f97a3a5a9c692a265ab7d01fb36410d59c3f6e2b253a22f652ecbf1941eef0b3f1d30b19a535@62.152.63.28:30303?discport=1345"<font></font>
<font></font>
"enode://156d43648b47078439c7481e54f697bbf1c6b6e762029ba2969f1556ceb94e51ad03f8bd2bed35f466073165810600f52925d155f0fceef832ae86fc39a8c135@62.152.63.28:30303?discport=1348"<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
受信したアドレスを保存します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あるノードを別のノードに接続するには、最初のノードのコンソールウィンドウを開き、そこで次のコマンドを入力します。</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; admin.addPeer( "enode://0a84e562c9b22e43269b7dca215cf2ed8c20bbf35da67bae8d5ee81b36d8bbb69e3ec704b9b6f7501059fe861843a836b2fbab641f36616cdd77365b1a522d5b@172.21.0.3:30303")
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、接続されたホストのIPアドレスを示すURLアドレスを渡しました。</font><font style="vertical-align: inherit;">他のネットワークノードでも同じ手順に従います。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接続が確立されていることを確認するには、admin.peersコマンドを使用します。</font><font style="vertical-align: inherit;">接続がない場合、コマンドは空の結果を返します。</font></font><br>
<br>
<pre><code class="xml hljs">&gt; admin.peers<font></font>
[]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この例では、コマンドはアドレス172.21.0.2の最初のノードがアドレス172.21.0.3および172.21.0.4のノードに接続されていることを示しています。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接続があるときに結果を確認する</font></font></b><div class="spoiler_text"><pre><code class="xml hljs">&gt; admin.peers<font></font>
<font></font>
[{<font></font>
    caps: ["eth/63", "eth/64"],<font></font>
    enode: "enode://156d43648b47078439c7481e54f697bbf1c6b6e762029ba2969f1556ceb94e51ad03f8bd2bed35f466073165810600f52925d155f0fceef832ae86fc39a8c135@172.21.0.4:30303",<font></font>
    id: "4dac1d10cb6ae8bfc1fdebd3f5334b24ee62ec38a50bc92c89104cfc3251b5fc",<font></font>
    name: "Geth/Node03/v1.9.9-stable-01744997/linux-amd64/go1.13.4",<font></font>
    network: {<font></font>
      inbound: false,<font></font>
      localAddress: "172.21.0.2:40652",<font></font>
      remoteAddress: "172.21.0.4:30303",<font></font>
      static: true,<font></font>
      trusted: false<font></font>
    },<font></font>
    protocols: {<font></font>
      eth: {<font></font>
        difficulty: 98414119,<font></font>
        head: "0x6b31a5bb9cde06fab5a8cc1ae9b18bada30de0d1b76cb3286c1081e76dbf5b83",<font></font>
        version: 64<font></font>
      }<font></font>
    }<font></font>
}, {<font></font>
    caps: ["eth/63", "eth/64"],<font></font>
    enode: "enode://ee49f69e25c068e006fec4a8d74370370b1d2be9715b86eddd99f97a3a5a9c692a265ab7d01fb36410d59c3f6e2b253a22f652ecbf1941eef0b3f1d30b19a535@172.21.0.3:30303",<font></font>
    id: "b74277d278c15317fa7f7fa492daca60492ea22053bfc53281dd0071eba1c16b",<font></font>
    name: "Geth/Node02/v1.9.9-stable-01744997/linux-amd64/go1.13.4",<font></font>
    network: {<font></font>
      inbound: false,<font></font>
      localAddress: "172.21.0.2:42576",<font></font>
      remoteAddress: "172.21.0.3:30303",<font></font>
      static: true,<font></font>
      trusted: false<font></font>
    },<font></font>
    protocols: {<font></font>
      eth: {<font></font>
        difficulty: 99041423,<font></font>
        head: "0x0ec44735bbb425cb8db96103f52300dfaae1147ba0e03aa4892d041250ce4408",<font></font>
        version: 64<font></font>
      }<font></font>
    }<font></font>
}]<font></font>
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ノードが正常に結合および同期された後、eth.blockNumberコマンドは、3つのコンテナーのいずれかで起動されたときに同じ値を返します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
逆に、web3.fromWeiコマンド（eth.getBalance（eth.coinbase））では、ノードごとに異なるバランスが表示されます。</font><font style="vertical-align: inherit;">各ノードには独自のアカウントがあります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Node.jsを使用してホストを操作する</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リスト3では、Node.jsを実行する簡単なスクリプトを示しています。このスクリプトは、指定したノードのアカウントのリストと、それぞれの残高をコンソールに表示します。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リスト3.ファイル/ home / book / list_accounts.js</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword">var</span> Web3 = <span class="hljs-built_in">require</span>(<span class="hljs-string">'web3'</span>)
<span class="hljs-keyword">var</span> web3 = <span class="hljs-keyword">new</span> Web3(<span class="hljs-keyword">new</span> Web3.providers.HttpProvider(<span class="hljs-string">"http://172.21.0.2:8545"</span>));<font></font>
<font></font>
web3.eth.getAccounts()<font></font>
.then(<span class="hljs-function"><span class="hljs-params">accList</span> =&gt;</span> {
    <span class="hljs-keyword">return</span> accList;<font></font>
})<font></font>
.then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">accounts</span>) </span>{
  <span class="hljs-keyword">var</span> balancePromeses = [];
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; accounts.length; i++) {<font></font>
    balancePromeses[i] = web3.eth.getBalance(accounts[i]);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-built_in">Promise</span>.all(balancePromeses).then(<span class="hljs-function"><span class="hljs-params">values</span> =&gt;</span> {
     <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; values.length; i++) {
       <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Account: '</span>, accounts[i], <span class="hljs-string">'balance: '</span>, values[i], <span class="hljs-string">'wei, '</span>, web3.utils.fromWei(values[i], <span class="hljs-string">'ether'</span>), <span class="hljs-string">'ether'</span>);<font></font>
     }<font></font>
   });<font></font>
})<font></font>
.catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) </span>{
  <span class="hljs-built_in">console</span>.error(error);<font></font>
});</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このスクリプトは、4番目のコンソールウィンドウなど、別の場所で実行できます。</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># node list_accounts.js</span><font></font>
Account:  0x0C976006a5762779bA36AC590D1D8Ebac1Ca2981 balance:  3350000000000000000000 wei,  3350 ether<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次は何ですか</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
暗号通貨一般、特にイーサリアムのソフトウェア開発のトピックは非常に魅力的です。</font><font style="vertical-align: inherit;">この記事を読んだ後で質問があり、詳細を知りたい場合は、私の本</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「EthereumブロックチェーンのSolidityスマートコントラクトの作成」を</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">読んでください</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">。</font></a></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liters</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Publishing Houseから発行された</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">実用ガイド」</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、優れた</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dockerチートシート</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が必要になる場合もあり</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
記事や本へのコメントや追加に感謝します！</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja481036/index.html">30 Firefox開発ツールのユーティリティ</a></li>
<li><a href="../ja481038/index.html">デザイン中毒の告白。1か月でゲーム「IT Alchemy」を作成した方法</a></li>
<li><a href="../ja481042/index.html">私たちジャンゴの味は興奮し、魅了されます</a></li>
<li><a href="../ja481044/index.html">2020年に向けて何を発表するか：新年ガイドマドロボット</a></li>
<li><a href="../ja481048/index.html">デジタル回路の認識。一般化されたC要素</a></li>
<li><a href="../ja481054/index.html">YouTrack 2019.3：タスクリストの更新など</a></li>
<li><a href="../ja481056/index.html">Habrによると、10年間の主要な技術</a></li>
<li><a href="../ja481058/index.html">奇妙な（再び）そしてトランジスタの選択の問題へ</a></li>
<li><a href="../ja481066/index.html">Raspberry Pi 3でフィッシュアイを使用する：コンピュータービジョン用の事前トレーニング済みDLモデルを起動する</a></li>
<li><a href="../ja481070/index.html">Rust 1.40.0リリース：＃[non_exhaustive]、マクロの機能強化、およびその他の機能強化</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>