<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧜🏽 🔜 🔌 Arsitektur murni dengan naskah: DDD dan arsitektur berlapis 👨🏽‍🏫 🎞️ ⚾️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo, Habr! Baru-baru ini saya telah menaruh banyak perhatian pada arsitektur dan memutuskan untuk berbagi dengan komunitas terjemahan dari artikel Ar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Arsitektur murni dengan naskah: DDD dan arsitektur berlapis</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/486734/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Halo, Habr! </font><font style="vertical-align: inherit;">Baru-baru ini saya telah menaruh banyak perhatian pada arsitektur dan memutuskan untuk berbagi dengan komunitas terjemahan dari artikel </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arsitektur Bersih dengan naskah: DDD, Onion</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oleh </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">André Bazaglia</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pengantar</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selama lebih dari 6 tahun pengalaman profesional saya, saya memiliki kesempatan untuk bekerja di perusahaan teknologi keren yang memperhatikan ketersediaan tinggi dan kualitas kode. </font><font style="vertical-align: inherit;">Saya harus berurusan dengan situasi kritis ketika bug atau bahkan downtime kedua dari sistem tidak dapat diterima. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tujuan artikel ini bukan cakupan terperinci dari topik kompleks pada DDD dan arsitektur Layered, tetapi contoh implementasi dari dua pendekatan ini dalam naskah. </font><font style="vertical-align: inherit;">Proyek yang digunakan adalah dasar dan dapat disempurnakan dan diperluas, misalnya, menggunakan pendekatan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CQRS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengapa DDD?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Produk perangkat lunak yang dibuat harus menerapkan persyaratan bisnis yang ditetapkan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendekatan ini menyederhanakan pengujian lapisan domain, yang memungkinkan Anda untuk memastikan bahwa semua persyaratan bisnis diperhitungkan dan menulis kode tahan-kesalahan yang berumur panjang. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DDD dalam kombinasi dengan arsitektur berlapis menghindari efek domino ketika mengubah kode di satu tempat menyebabkan bug yang tak terhitung jumlahnya di tempat yang berbeda.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengapa arsitektur berlapis?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendekatan ini berjalan baik dengan DDD, karena seluruh sistem dibangun di sekitar model domain, yang merupakan lingkaran pusat pada gambar di bawah ini. Lapisan dalam tidak secara langsung tergantung pada yang luar dan menggunakannya dengan injeksi. Plus, kami mendapatkan fleksibilitas yang sangat baik, sehingga setiap lapisan memiliki area tanggung jawab masing-masing dan data yang masuk divalidasi oleh setiap lapisan sesuai dengan kebutuhannya. Dan oleh karena itu, lapisan dalam selalu menerima data yang valid dari lapisan luar. Belum lagi pengujian: pengujian unit menjadi lebih mudah dengan penggunaan mock ketergantungan berdasarkan antarmuka, yang memungkinkan Anda untuk abstrak dari bagian eksternal sistem, seperti database. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qs/at/ex/qsatexfqebsdg9n1gwlnga_vuuc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam kasus TypeScript dan Javascript, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inversi kontrol (via Dependency Inversion)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">berarti menyematkan (meneruskan) dependensi melalui parameter alih-alih impor eksplisit. </font><font style="vertical-align: inherit;">Dalam contoh kode berikut, kami akan menggunakan perpustakaan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inversify</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang memungkinkan kami untuk menjelaskan dependensi menggunakan dekorator sehingga kelas yang dibuat nanti dapat memiliki wadah yang dibuat secara dinamis untuk menyelesaikan dependensi.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arsitektur</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Untuk aplikasi sederhana ini ...</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami akan membuat aplikasi keranjang belanja sederhana yang dapat menangani penambahan produk ke keranjang. </font><font style="vertical-align: inherit;">Keranjang dapat memiliki beberapa aturan bisnis, seperti jumlah minimum atau maksimum untuk setiap item. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari selami kedalaman lapisan aplikasi, mulailah dengan lapisan paling dalam dan bergerak ke luar secara berurutan.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Domain</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lapisan domain, menurut definisi, adalah habitat aturan bisnis. Ia tidak tahu apa-apa tentang lapisan eksternal, tidak memiliki dependensi dan dapat dengan mudah diuji. Bahkan jika Anda mengubah seluruh aplikasi, domain akan tetap tidak tersentuh, karena hanya berisi aturan bisnis yang tersedia untuk memahami tujuannya bagi semua orang yang membaca kode ini. Lapisan ini harus ditutup sebanyak mungkin dengan tes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, kami memiliki kelas dasar Entity, yang dapat berisi logika tertentu yang umum untuk semua kelas domain. Dalam contoh ini, semua logika umum adalah untuk menghasilkan pengidentifikasi tahan-tabrakan yang cocok untuk penskalaan horizontal, dan semua objek akan menggunakan pendekatan ini.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> abstract <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Entity</span>&lt;<span class="hljs-title">T</span>&gt; </span>{<font></font>
  protected readonly _id: string<font></font>
  protected props: T<font></font>
<font></font>
  <span class="hljs-keyword">constructor</span>(props: T, id?: string) {
    <span class="hljs-keyword">this</span>._id = id ? id : UniqueEntityID()
    <span class="hljs-keyword">this</span>.props = props<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">// other common methods here...</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah menulis kelas Entity, Anda bisa mulai membuat kelas domain pusat kami yang memperluas kelas abstrak Entity. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tidak ada yang sangat rumit di kelas ini, tetapi ada beberapa poin menarik yang harus Anda perhatikan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama, konstruktor bersifat pribadi, yang berarti mengeksekusi </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cart baru ()</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> akan menyebabkan kesalahan, yang merupakan apa yang kita butuhkan. Dalam DDD, itu dianggap praktik yang baik untuk menjaga objek domain selalu dalam keadaan valid. Alih-alih secara langsung membuat objek Keranjang kosong, kami menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pola Pabrik</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yang mengembalikan instance selesai dari kelas Cart. Untuk memastikan bahwa prosedur pembuatan telah menerima semua atribut yang diperlukan, mereka dapat divalidasi. Demikian pula, getter dan setter digunakan untuk berinteraksi dengan domain, untuk alasan inilah keadaan internal kelas disimpan dalam objek </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alat peraga</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pribadi </font><font style="vertical-align: inherit;">. Getters menyediakan akses baca ke atribut yang seharusnya publik. Demikian pula, setter publik dan metode lain memungkinkan Anda untuk mengubah domain dengan jaminan konstan tentang keabsahan keadaan objek. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Untuk meringkas, kita dapat menekankan poin penting: logika domain harus difokuskan pada perilaku, dan bukan pada properti.</font></font></b><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cart</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Entity</span>&lt;<span class="hljs-title">ICartProps</span>&gt; </span>{<font></font>
  private <span class="hljs-keyword">constructor</span>({ id, ...data }: ICartProps) {
    <span class="hljs-keyword">super</span>(data, id)<font></font>
  }<font></font>
<font></font>
  public <span class="hljs-keyword">static</span> create(props: ICartProps): Cart {
    <span class="hljs-keyword">const</span> instance = <span class="hljs-keyword">new</span> Cart(props)
    <span class="hljs-keyword">return</span> instance<font></font>
  }<font></font>
<font></font>
  public unmarshal(): UnmarshalledCart {<font></font>
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">id</span>: <span class="hljs-keyword">this</span>.id,
      <span class="hljs-attr">products</span>: <span class="hljs-keyword">this</span>.products.map(<span class="hljs-function"><span class="hljs-params">product</span> =&gt;</span> ({
        <span class="hljs-attr">item</span>: product.item.unmarshal(),
        <span class="hljs-attr">quantity</span>: product.quantity<font></font>
      })),<font></font>
      <span class="hljs-attr">totalPrice</span>: <span class="hljs-keyword">this</span>.totalPrice<font></font>
    }<font></font>
  }<font></font>
<font></font>
  private <span class="hljs-keyword">static</span> validQuantity(quantity: number) {
    <span class="hljs-keyword">return</span> quantity &gt;= <span class="hljs-number">1</span> &amp;&amp; quantity &lt;= <span class="hljs-number">1000</span><font></font>
  }<font></font>
<font></font>
  private setProducts(products: CartItem[]) {<font></font>
    <span class="hljs-keyword">this</span>.props.products = products<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">get</span> <span class="hljs-title">id</span>(): <span class="hljs-title">string</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._id<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">get</span> <span class="hljs-title">products</span>(): <span class="hljs-title">CartItem</span>[] {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.props.products<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">get</span> <span class="hljs-title">totalPrice</span>(): <span class="hljs-title">number</span> {
    <span class="hljs-keyword">const</span> cartSum = <span class="hljs-function">(<span class="hljs-params">acc: number, product: CartItem</span>) =&gt;</span> {
      <span class="hljs-keyword">return</span> acc + product.item.price * product.quantity<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.products.reduce(cartSum, <span class="hljs-number">0</span>)<font></font>
  }<font></font>
<font></font>
  public add(item: Item, <span class="hljs-attr">quantity</span>: number) {
    <span class="hljs-keyword">if</span> (!Cart.validQuantity(quantity)) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ValidationError(
        <span class="hljs-string">'SKU needs to have a quantity between 1 and 1000'</span><font></font>
      )<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">const</span> index = <span class="hljs-keyword">this</span>.products.findIndex(
      <span class="hljs-function"><span class="hljs-params">product</span> =&gt;</span> product.item.sku === item.sku<font></font>
    )<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (index &gt; <span class="hljs-number">-1</span>) {
      <span class="hljs-keyword">const</span> product = {<font></font>
        ...this.products[index],<font></font>
        <span class="hljs-attr">quantity</span>: <span class="hljs-keyword">this</span>.products[index].quantity + quantity<font></font>
      }<font></font>
<font></font>
      <span class="hljs-keyword">if</span> (!Cart.validQuantity(product.quantity)) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ValidationError(<span class="hljs-string">'SKU exceeded allowed quantity'</span>)<font></font>
      }<font></font>
<font></font>
      <span class="hljs-keyword">const</span> products = [<font></font>
        ...this.products.slice(<span class="hljs-number">0</span>, index),<font></font>
        product,<font></font>
        ...this.products.slice(index + <span class="hljs-number">1</span>)<font></font>
      ]<font></font>
<font></font>
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.setProducts(products)<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">const</span> products = [...this.products, { item, quantity }]
    <span class="hljs-keyword">this</span>.setProducts(products)<font></font>
  }<font></font>
<font></font>
  public remove(itemId: string) {<font></font>
    <span class="hljs-keyword">const</span> products = <span class="hljs-keyword">this</span>.products.filter(<span class="hljs-function"><span class="hljs-params">product</span> =&gt;</span> product.item.id !== itemId)
    <span class="hljs-keyword">this</span>.setProducts(products)
    <span class="hljs-keyword">this</span>.emitCartMutation()<font></font>
  }<font></font>
<font></font>
  public empty() {<font></font>
    <span class="hljs-keyword">this</span>.setProducts([])<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meskipun objek Keranjang kami dapat digunakan oleh aplikasi menggunakan metode domain, dalam beberapa kasus, kami mungkin perlu "menyebarkan" ke objek bersih. </font><font style="vertical-align: inherit;">Misalnya, untuk menyimpan ke database atau mengirim ke klien sebagai objek JSON. </font><font style="vertical-align: inherit;">Ini dapat diimplementasikan menggunakan metode </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unmarshal ()</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk meningkatkan fleksibilitas arsitektur, lapisan domain juga dapat menjadi sumber peristiwa domain. </font><font style="vertical-align: inherit;">Di sini, pendekatan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pengadaan Acara</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dapat diterapkan </font><font style="vertical-align: inherit;">, dengan pembuatan acara saat entitas domain berubah.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Skrip pengguna</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini kita akan menggunakan metode dan objek domain yang diimplementasikan dari tingkat infrastruktur untuk menyimpan data. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menggunakan pustaka </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">terbalik</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk mengimplementasikan pendekatan Inversion of Management, yang menyuntikkan repositori dari lapisan infrastruktur ke dalam skenario ini, memberi kami kesempatan untuk memanipulasi keranjang menggunakan metode domain dan menyimpan perubahan ke database setelah itu.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { inject, injectable } <span class="hljs-keyword">from</span> <span class="hljs-string">'inversify'</span><font></font>
<font></font>
@injectable()<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CartService</span> </span>{<font></font>
  @inject(TYPES.CartRepository) private repository: CartRepository<font></font>
<font></font>
  private <span class="hljs-keyword">async</span> _getCart(id: string): <span class="hljs-built_in">Promise</span>&lt;Cart&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> cart = <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.repository.getById(id)
      <span class="hljs-keyword">return</span> cart<font></font>
    } <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-keyword">const</span> emptyCart = Cart.create({ id, <span class="hljs-attr">products</span>: [] })
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.repository.create(emptyCart)<font></font>
    }<font></font>
  }<font></font>
<font></font>
  public getById(id: string): <span class="hljs-built_in">Promise</span>&lt;Cart&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.repository.getById(id)<font></font>
  }<font></font>
<font></font>
  public <span class="hljs-keyword">async</span> add(cartId: string, <span class="hljs-attr">item</span>: Item, <span class="hljs-attr">sku</span>: number): <span class="hljs-built_in">Promise</span>&lt;Cart&gt; {
    <span class="hljs-keyword">const</span> cart = <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>._getCart(cartId)<font></font>
    cart.add(item, sku)<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.repository.update(cart)<font></font>
  }<font></font>
<font></font>
  public <span class="hljs-keyword">async</span> remove(cartId: string, <span class="hljs-attr">itemId</span>: string): <span class="hljs-built_in">Promise</span>&lt;Cart&gt; {
    <span class="hljs-keyword">const</span> cart = <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>._getCart(cartId)<font></font>
    cart.remove(itemId)<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.repository.update(cart)<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lapisan ini bertanggung jawab untuk pengoperasian aplikasi. </font><font style="vertical-align: inherit;">Perubahan kode pada lapisan ini tidak memengaruhi entitas domain atau dependensi eksternal seperti database.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Infrastruktur</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terlepas dari semua kejelasannya, lapisan infrastruktur berinteraksi dengan sistem eksternal, seperti database. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menyimpan data ke database, saya menggunakan Data mapper dan pendekatan Repositori. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mapper bisa mendapatkan sumber data dari database dan mengonversinya ke objek domain yang sesuai:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { Cart, CartItem } <span class="hljs-keyword">from</span> <span class="hljs-string">'src/domain/cart'</span><font></font>
<font></font>
<span class="hljs-keyword">const</span> getProducts = <span class="hljs-function">(<span class="hljs-params">products: CartItem[]</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> products.map(<span class="hljs-function"><span class="hljs-params">product</span> =&gt;</span> ({
    <span class="hljs-attr">item</span>: product.item,
    <span class="hljs-attr">quantity</span>: product.quantity<font></font>
  }))<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CartMapper</span> </span>{<font></font>
  public <span class="hljs-keyword">static</span> toDomain(raw: any): Cart {
    <span class="hljs-keyword">return</span> Cart.create({
      <span class="hljs-attr">id</span>: raw.id,
      <span class="hljs-attr">couponCode</span>: raw.couponCode,
      <span class="hljs-attr">products</span>: getProducts(raw.products || [])<font></font>
    })<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Repositori itu sendiri mungkin bergantung pada pustaka klien dari database tertentu. </font><font style="vertical-align: inherit;">Misalnya, dari penyimpanan di RAM, dan gunakan metode ini untuk mengelola data:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { injectable, inject } <span class="hljs-keyword">from</span> <span class="hljs-string">'inversify'</span>
<span class="hljs-keyword">import</span> { Cart } <span class="hljs-keyword">from</span> <span class="hljs-string">'src/domain/cart'</span>
<span class="hljs-keyword">import</span> { CartMapper } <span class="hljs-keyword">from</span> <span class="hljs-string">'../mappers/cart'</span><font></font>
<font></font>
interface ICartRepository {<font></font>
  getById(id: string): <span class="hljs-built_in">Promise</span>&lt;Cart&gt;<font></font>
  create(cart: Cart): <span class="hljs-built_in">Promise</span>&lt;Cart&gt;<font></font>
  update(cart: Cart): <span class="hljs-built_in">Promise</span>&lt;Cart&gt;<font></font>
}<font></font>
<font></font>
@injectable()<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CartRepository</span> <span class="hljs-title">implements</span> <span class="hljs-title">ICartRepository</span> </span>{<font></font>
  @inject(TYPES.Database) private _database: MemoryData<font></font>
<font></font>
  <span class="hljs-keyword">async</span> getById(id: string): <span class="hljs-built_in">Promise</span>&lt;Cart&gt; {
    <span class="hljs-keyword">const</span> cart = <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>._database.cart.getById(id)
    <span class="hljs-keyword">if</span> (!cart) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ResourceNotFound(<span class="hljs-string">'Cart'</span>, { id })<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> CartMapper.toDomain(cart)<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">async</span> create(cart: Cart): <span class="hljs-built_in">Promise</span>&lt;Cart&gt; {
    <span class="hljs-keyword">const</span> dtoCart = cart.unmarshal()
    <span class="hljs-keyword">const</span> inserted = <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>._database.cart.insert(dtoCart)
    <span class="hljs-keyword">return</span> CartMapper.toDomain(inserted)<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">async</span> update(cart: Cart): <span class="hljs-built_in">Promise</span>&lt;Cart&gt; {
    <span class="hljs-keyword">const</span> dtoCart = cart.unmarshal()
    <span class="hljs-keyword">const</span> updated = <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>._database.cart.update(cart.id, dtoCart)
    <span class="hljs-keyword">return</span> CartMapper.toDomain(updated)<font></font>
  }<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kesimpulan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada banyak ruang untuk perbaikan dan peningkatan. </font><font style="vertical-align: inherit;">Kode dibuat untuk demonstrasi visual ini, dan peningkatan pertama dalam arsitektur layered bisa berupa pengumuman antarmuka repositori di lapisan domain dan implementasinya di lapisan infrastruktur, yang bisa kita bahas lain kali. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode sumber tersedia di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id486734/">https://habr.com/ru/post/id486734/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id486714/index.html">Instagram api setidaknya</a></li>
<li><a href="../id486716/index.html">Apa yang dilakukan Moscow Exchange Free API di Google Sheets</a></li>
<li><a href="../id486722/index.html">Pengujian keamanan statis dengan alat sumber terbuka</a></li>
<li><a href="../id486726/index.html">Mendiagnosis koneksi jaringan pada router EDGE virtual</a></li>
<li><a href="../id486728/index.html">German Data Protection Authority: telemetri pada Windows 10 1909 Enterprise dapat sepenuhnya dinonaktifkan</a></li>
<li><a href="../id486736/index.html">Cara meningkatkan kecepatan dekode aliran video di FFmpeg</a></li>
<li><a href="../id486738/index.html">Konvensi Gaya Kode PHP</a></li>
<li><a href="../id486740/index.html">Menulis API di Rust menggunakan macro prosedural</a></li>
<li><a href="../id486742/index.html">Wawancara dengan Anatoly Wasserman tentang Masa Depan</a></li>
<li><a href="../id486744/index.html">Korektor postur dalam negeri yang cerdas mulai dijual. Kami melihat produk baru - IBACK</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>