<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌳 😴 👨🏼‍🔧 ディープラーニングがJavaになりました 👨🏽‍✈️ ⛸️ 🗣️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Javaが嫌いですか？はい、あなたはそれを調理する方法がわかりません！Mani Sarkarは、Javaでモデル研究を行うことを可能にするValohaiツールに慣れることを勧めています。
 
 
 
 翻訳者からの免責事項 , . Valohai. , . — . — . .
 
 前書き
 しばら...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ディープラーニングがJavaになりました</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/469405/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Javaが嫌いですか？</font><font style="vertical-align: inherit;">はい、あなたはそれを調理する方法がわかりません！</font><font style="vertical-align: inherit;">Mani Sarkarは、Javaでモデル研究を行うことを可能にするValohaiツールに慣れることを勧めています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/et/p-/se/etp-sezekre2qlznmvgdzlgds0a.png"><br>
<a name="habracut"></a><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">翻訳者からの免責事項</font></font></b><div class="spoiler_text"> ,     .     Valohai.    ,    .    —   .    —        .   .<br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前書き</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しばらく前に、私はValohaiと呼ばれるクラウドサービスに出会いました。そのユーザーインターフェイスと、デザインとレイアウトのシンプルさに満足しました。ヴァロハイのメンバーの一人にサービスを依頼し、デモ版を受け取りました。その前に、GNU Parallel、JavaScript、Python、Bashを使用した簡単なパイプラインを作成しました。また、GNU ParallelとBashのみを使用する別のパイプラインも作成しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、Jenkins X、Jenkins Pipeline、Concourse、Airflowなどのすぐに使えるタスク/ワークフロー管理ツールを使用することも考えましたが、さまざまな理由で使用しないことにしました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多くのValohaiの例とドキュメントがPythonとR、およびそれぞれのフレームワークとライブラリに基づいていることに気付きました。私は機会を逃さないようにし、例やドキュメントの不足を修正したいと思いました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Valohaiは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DL4J-Deep Learning for Java</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と呼ばれる有名なJavaライブラリを使用して何かを実装するように私に勧めました</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ヴァロハイでの私の最初の経験は、そのデザイン、レイアウト、ワークフローを通して感じた後、すでに私に良い印象を与えました。</font><font style="vertical-align: inherit;">クリエイターは、開発者のワークフローとインフラストラクチャの両方のさまざまな側面をすでに考慮しています。</font><font style="vertical-align: inherit;">私たちの世界では、インフラストラクチャ開発プロセスは主にDevOpsまたはSysOpsチームによって制御されており、それに関連するニュアンスと問題点を知っています。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">何が必要ですか？</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どの機械学習プロジェクトにも、2つの重要なコンポーネント（高レベルの観点から）があります。モデルで動作するコードと、プロジェクトのライフサイクル全体が実行されるインフラストラクチャで動作するコードです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、その前、最中、後に必要な手順とコンポーネントがありますが、簡単にするために、コードとインフラストラクチャが必要だとしましょう。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コード</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードについては</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、DL4J</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用した複雑な例を選択しました。これは</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">、</font></a><font style="vertical-align: inherit;"> 60,000画像のトレーニングセットと手書き数字の10,000画像のテストセットを</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">含むMNistプロジェクト</font></a><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">このデータセットは、DL4Jライブラリから入手できます（Kerasと同様）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
始める前に、使用するソースコードを確認することをお勧めします。</font><font style="vertical-align: inherit;">メインのJavaクラスは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">org.deeplearning4j.feedforward.mnist.MLPMnistSingleLayerRunner</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と呼ばれ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インフラ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実験（トレーニングとモデル評価）を実行するためのインフラストラクチャとしてValohaiを使用するJavaの例を試すことにしました。</font><font style="vertical-align: inherit;">Valohaiはgitリポジトリを認識してそれらに直接接続し、プラットフォームや言語に関係なくコードを実行できるようにします。その仕組みを確認します。</font><font style="vertical-align: inherit;">また、GitOpsまたはInfrastructure-As-Codeを使用すると、すべてがうまくいくことも意味します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これには、Valohaiのアカウントが必要です。</font><font style="vertical-align: inherit;">無料のアカウントを作成すると、さまざまな構成のいくつかのインスタンスにアクセスできます。</font><font style="vertical-align: inherit;">私たちがやりたいことについては、Free-Tierで十分です。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaとValohaiのディープラーニング</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dockerイメージへのすべての依存関係を提供し、それを使用してJavaアプリケーションをコンパイルし、モデルをトレーニングして</font><font style="vertical-align: inherit;">、プロジェクトリポジトリのルートフォルダーにある</font><font style="vertical-align: inherit;">シンプルな</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valohai.yaml</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルを使用してValohaiプラットフォームで評価し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Javaのディープラーニング：DL4J</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最も単純な部分。 jarファイルを収集してDockerコンテナーにデータセットを読み込むだけで、それほど多くのことを行う必要はありません。 Javaアプリケーションの作成に必要なすべての依存関係を含む、事前に作成されたDockerイメージがあります。このイメージをDocker Hubに配置し、dl4j-mnist-single-layerを検索することで見つけることができます（YAMLファイルで定義されている特別なタグを使用します）。このプロジェクトのビルドおよびランタイムJava環境としてGraalVM 19.1.1を使用することを決定し、それはDockerイメージに組み込まれています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コマンドラインからuber jarが呼び出されると、MLPMnistSingleLayerRunnerクラスが作成されます。これは、渡されたパラメーターに応じて、目的のアクションを通知します。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>{<font></font>
    MLPMnistSingleLayerRunner mlpMnistRunner = <span class="hljs-keyword">new</span> MLPMnistSingleLayerRunner();<font></font>
    JCommander.newBuilder()<font></font>
            .addObject(mlpMnistRunner)<font></font>
            .build()<font></font>
            .parse(args);<font></font>
    mlpMnistRunner.execute();<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
uber jarに渡されたパラメーターは、このクラスによって受け入れられ、execute（）メソッドによって処理されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
--action trainパラメータを使用してモデルを作成し、Javaアプリケーションに渡された--action evaluateパラメータを使用して作成したモデルを評価できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この作業を行うJavaアプリケーションの主要部分は、以下のセクションで説明する2つのJavaクラスにあります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モデルトレーニング</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コール</font></font><br>
<br>
<pre><code class="plaintext hljs">./runMLPMnist.sh --action train --output-dir ${VH_OUTPUTS_DIR}<font></font>
or<font></font>
java -Djava.library.path=""             \<font></font>
     -jar target/MLPMnist-1.0.0-bin.jar \<font></font>
     --action train --output-dir ${VH_OUTPUTS_DIR}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコマンドは、実行の開始時に渡される--output-dirパラメーターで指定されたフォルダーにmlpmnist-single-layer.pbという名前のモデルを作成します。</font><font style="vertical-align: inherit;">Valohaiの観点からは、$ {VH_OUTPUTS_DIR}に配置する必要があります（これは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valohai.yaml</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルを</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">参照</font></a><font style="vertical-align: inherit;">）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ソースコードについては、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MLPMNistSingleLayerTrain.java</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスを参照してください</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モデル評価</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コール</font></font><br>
<br>
<pre><code class="plaintext hljs">./runMLPMnist.sh --action evaluate --input-dir ${VH_INPUTS_DIR}/model<font></font>
or<font></font>
java -Djava.library.path=""             \<font></font>
     -jar target/MLPMnist-1.0.0-bin.jar \<font></font>
     --action evaluate --input-dir ${VH_INPUTS_DIR}/model<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アプリケーションの呼び出し時に渡された--input-dirパラメータで指定されたフォルダに、mlpmnist-single-layer.pbという名前のモデル（トレーニングフェーズ中に作成されたもの）が存在すると想定されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ソースコードについては、クラス</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MLPMNistSingleLayerEvaluate.javaを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参照してください</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この短い図が、モデルを教えて評価するJavaアプリケーションがどのように機能するかを明確にしたいと思います。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これが私たちに必要なすべてですが、残りの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソース</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">README.md</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">およびbashスクリプトと</font><font style="vertical-align: inherit;">一緒に）を</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">いじって</font></a><font style="vertical-align: inherit;">、これがどのように行われるかについての好奇心と理解を満たしてください。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヴァロハイ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下のYAMLファイル構造からわかるように、Valohaiを使用すると、ランタイム、コード、データセットを自由にリンクできます。したがって、さまざまなコンポーネントが互いに独立して開発できます。したがって、Dockerコンテナーにパッケージ化されているのはアセンブリーコンポーネントとランタイムコンポーネントのみです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実行時に、DockerコンテナーにUber JARを収集し、それを内部または外部ストレージにロードします。次に、他の実行ステップを使用して、ストレージ（または他の場所）からUber JARおよびデータセットをロードし、トレーニングを開始します。したがって、2つの実行ステップは切断されます。たとえば、jarを1回コンパイルして、1つのjarで何百ものトレーニングステップを完了することができます。アセンブリ環境とランタイム環境はそれほど頻繁に変更する必要がないため、それらをキャッシュして、コード、データセット、モデルに実行時に動的にアクセスできます。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valohai.yaml</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
JavaプロジェクトをValohaiインフラストラクチャと統合する主な部分は、プロジェクトフォルダーのルートにあるvalohai.yamlファイルの実行ステップの順序を決定することです。私たちのvalohai.yamlは次のようになります。</font></font><br>
<br>
<pre><code class="xml hljs">---<font></font>
- step:<font></font>
    name: Build-dl4j-mnist-single-layer-java-app<font></font>
    image: neomatrix369/dl4j-mnist-single-layer:v0.5<font></font>
    command:<font></font>
      - cd ${VH_REPOSITORY_DIR}<font></font>
      - ./buildUberJar.sh<font></font>
      - echo "~~~ Copying the build jar file into ${VH_OUTPUTS_DIR}"<font></font>
      - cp target/MLPMnist-1.0.0-bin.jar ${VH_OUTPUTS_DIR}/MLPMnist-1.0.0.jar<font></font>
      - ls -lash ${VH_OUTPUTS_DIR}<font></font>
    environment: aws-eu-west-1-g2-2xlarge<font></font>
- step:<font></font>
    name: Run-dl4j-mnist-single-layer-train-model<font></font>
    image: neomatrix369/dl4j-mnist-single-layer:v0.5<font></font>
    command:<font></font>
      - echo "~~~ Unpack the MNist dataset into ${HOME} folder"<font></font>
      - tar xvzf ${VH_INPUTS_DIR}/dataset/mlp-mnist-dataset.tgz -C ${HOME}<font></font>
      - cd ${VH_REPOSITORY_DIR}<font></font>
      - echo "~~~ Copying the build jar file from ${VH_INPUTS_DIR} to current location"<font></font>
      - cp ${VH_INPUTS_DIR}/dl4j-java-app/MLPMnist-1.0.0.jar .<font></font>
      - echo "~~~ Run the DL4J app to train model based on the the MNist dataset"<font></font>
      - ./runMLPMnist.sh {parameters}<font></font>
    inputs:<font></font>
      - name: dl4j-java-app<font></font>
        description: DL4J Java app file (jar) generated in the previous step 'Build-dl4j-mnist-single-layer-java-app'<font></font>
      - name: dataset<font></font>
        default: https://github.com/neomatrix369/awesome-ai-ml-dl/releases/download/mnist-dataset-v0.1/mlp-mnist-dataset.tgz<font></font>
        description: MNist dataset needed to train the model<font></font>
    parameters:<font></font>
      - name: --action<font></font>
        pass-as: '--action {v}'<font></font>
        type: string<font></font>
        default: train<font></font>
        description: Action to perform i.e. train or evaluate<font></font>
      - name: --output-dir<font></font>
        pass-as: '--output-dir {v}'<font></font>
        type: string<font></font>
        default: /valohai/outputs/<font></font>
        description: Output directory where the model will be created, best to pick the Valohai output directory<font></font>
    environment: aws-eu-west-1-g2-2xlarge<font></font>
- step:<font></font>
    name: Run-dl4j-mnist-single-layer-evaluate-model<font></font>
    image: neomatrix369/dl4j-mnist-single-layer:v0.5<font></font>
    command:<font></font>
      - cd ${VH_REPOSITORY_DIR}<font></font>
      - echo "~~~ Copying the build jar file from ${VH_INPUTS_DIR} to current location"<font></font>
      - cp ${VH_INPUTS_DIR}/dl4j-java-app/MLPMnist-1.0.0.jar .<font></font>
      - echo "~~~ Run the DL4J app to evaluate the trained MNist model"<font></font>
      - ./runMLPMnist.sh {parameters}<font></font>
    inputs:<font></font>
      - name: dl4j-java-app<font></font>
        description: DL4J Java app file (jar) generated in the previous step 'Build-dl4j-mnist-single-layer-java-app'    <font></font>
      - name: model<font></font>
        description: Model file generated in the previous step 'Run-dl4j-mnist-single-layer-train-model'<font></font>
    parameters:<font></font>
      - name: --action<font></font>
        pass-as: '--action {v}'<font></font>
        type: string<font></font>
        default: evaluate<font></font>
        description: Action to perform i.e. train or evaluate<font></font>
      - name: --input-dir<font></font>
        pass-as: '--input-dir {v}'<font></font>
        type: string<font></font>
        default: /valohai/inputs/model<font></font>
        description: Input directory where the model created by the previous step can be found created<font></font>
    environment: aws-eu-west-1-g2-2xlarge<font></font>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Build-dl4j-mnist-single-layer-java-appの仕組み</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
YAMLファイルから、最初にDockerイメージを使用し、次にスクリプトを実行してUber JARをビルドするこのステップを定義していることがわかります。</font><font style="vertical-align: inherit;">Dockerイメージには、Javaアプリケーションを作成するためのビルド環境の依存関係（GraalVM JDK、Mavenなど）のカスタマイズがあります。</font><font style="vertical-align: inherit;">これはアセンブリ段階であるため、入力やパラメータは提供していません。</font><font style="vertical-align: inherit;">ビルドが成功したら、MLPMnist-1.0.0-bin.jar（元の名前）という名前のuber jarを/ valohai /出力フォルダー（$ {VH_OUTPUTS_DIR}として表される）にコピーします。</font><font style="vertical-align: inherit;">このフォルダー内のすべてのものは、プロジェクトのストレージ（AWS S3ごみ箱など）に自動的に保存されます。</font><font style="vertical-align: inherit;">最後に、AWSの作業を定義します。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意</font></font></b><div class="spoiler_text">   Valohai        Docker (   ), ,    ,     (      ),       Maven      .<br>
</div></div><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Run-dl4j-mnist-single-layer-train-modelの仕組み</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
定義のセマンティクスは、2つの入力を指定することを除いて、前のステップと同様です。1つはuber jar（MLPMnist-1.0.0.jar）に対するもので、もう1つはデータセット（フォルダー$ {HOME} /。Deeplearning4jに解凍）に対するものです。</font><font style="vertical-align: inherit;">--action trainと--output-dir / valohai / outputの2つのパラメーターを渡します。</font><font style="vertical-align: inherit;">このステップで作成されたモデルは、組み込み/ valohai /出力/モデル（$ {VH_OUTPUTS_DIR} /モデルとして表されます）です。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意</font></font></b><div class="spoiler_text">     «» - Valohai        ,   , . . #1  #2,     URL- datum: //  http: //,            .<br>
</div></div><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Run-dl4j-mnist-single-layer -valu-modelの仕組み</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
繰り返しますが、このステップは前のステップと似ていますが、2つのパラメーター--action evaluateおよび--input-dir / valohai / inputs / modelを渡す点が異なります。</font><font style="vertical-align: inherit;">さらに、入力で再び示しました。YAMLファイルでdl4j-java-appという名前で定義されたセクションと、両方ともデフォルトなしのモデルです。</font><font style="vertical-align: inherit;">これにより、Webインターフェースを使用してRun-dl4j-mnist-single-layer-train-modelステップを使用して作成された、uber jarおよび評価するモデルを選択できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで上記の定義ファイルの手順が説明されたことを願っていますが、さらにヘルプが必要な場合は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメント</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チュートリアル</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をご覧ください</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valohai Webインターフェイス</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アカウントを受け取ったら、ログインしてmlpmnist-single-layerという名前でプロジェクトの作成を続行し、git repo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/valohai/mlpmnist-dl4j-example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をプロジェクトに</font><font style="vertical-align: inherit;">関連付け</font><font style="vertical-align: inherit;">てプロジェクトを保存します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、ステップを完了して、それがどのようになるかを確認できます。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DL4J Javaアプリケーションを構築する</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ウェブインターフェースの[実行]タブに移動し、既存の実行をコピーするか、[実行の作成]ボタンを使用して新しい実行を作成します。</font><font style="vertical-align: inherit;">必要なすべてのデフォルトパラメータが入力されます。</font><font style="vertical-align: inherit;">ステップBuild-dl4j-mnist-single-layer-java-appを選択します。</font><i><font style="vertical-align: inherit;">環境</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
については</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> AWS eu-west-1 g2.2xlargeを選択し、ページ下部の[実行の作成]ボタンをクリックして実行の開始を確認しました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/le/18/zo/le18zo_udbscmekflaux7kqfjcw.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モデルトレーニング</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Webインターフェースの「実行」タブに移動し、前のステップと同じようにして、Run-dl4j-mnist-single-layer-train-modelを選択します。</font><font style="vertical-align: inherit;">前のステップで作成したJavaアプリケーションを選択する必要があります（フィールドにjarを入力するだけです）。</font><font style="vertical-align: inherit;">データセットは既にvalohai.yamlファイルを使用して事前に入力されています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/md/ls/ov/mdlsovhg3vw9zjnpoeqhxwzgk7w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[実行を作成]をクリックして開始します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6n/mr/wm/6nmrwmveck6cgdughud1xgx7qdg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンソールに結果が表示されます。</font></font><br>
<br>
<pre><code class="plaintext hljs">[&lt;--- snipped ---&gt;]<font></font>
11:17:05 =======================================================================<font></font>
11:17:05 LayerName (LayerType) nIn,nOut TotalParams ParamsShape<font></font>
11:17:05 =======================================================================<font></font>
11:17:05 layer0 (DenseLayer) 784,1000 785000 W:{784,1000}, b:{1,1000}<font></font>
11:17:05 layer1 (OutputLayer) 1000,10 10010 W:{1000,10}, b:{1,10}<font></font>
11:17:05 -----------------------------------------------------------------------<font></font>
11:17:05  Total Parameters: 795010<font></font>
11:17:05  Trainable Parameters: 795010<font></font>
11:17:05  Frozen Parameters: 0<font></font>
11:17:05 =======================================================================<font></font>
[&lt;--- snipped ---&gt;]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
作成されたモデルは、実行中および実行後に「実行」メインタブの「出力」タブにあります。「出力」タブに</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pg/g2/-k/pgg2-kmsr85x87fedfoy24lreye.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いくつかのアーティファクト</font><font style="vertical-align: inherit;">が見られる</font><font style="vertical-align: inherit;">場合があります。</font><font style="vertical-align: inherit;">これは、各時代の終わりにコントロールポイントを維持するためです。</font><font style="vertical-align: inherit;">ログでこれを見てみましょう：</font></font><br>
<br>
<pre><code class="plaintext hljs">[&lt;--- snipped ---&gt;]<font></font>
11:17:14 o.d.o.l.CheckpointListener - Model checkpoint saved: epoch 0, iteration 469, path: /valohai/outputs/checkpoint_0_MultiLayerNetwork.zip<font></font>
[&lt;--- snipped ---&gt;]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
チェックポイントの3つのファイルには、モデルの状態が含まれています。</font></font><br>
<br>
<pre><code class="plaintext hljs">configuration.json<font></font>
coefficients.bin<font></font>
updaterState.bin<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モデルトレーニング。</font><font style="vertical-align: inherit;">メタデータ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実行ログでこれらのエントリに気づいたかもしれません：</font></font><br>
<br>
<pre><code class="plaintext hljs">[&lt;--- snipped ---&gt;]<font></font>
11:17:05 {"epoch": 0, "iteration": 0, "score (loss function)": 2.410047}<font></font>
11:17:07 {"epoch": 0, "iteration": 100, "score (loss function)": 0.613774}<font></font>
11:17:09 {"epoch": 0, "iteration": 200, "score (loss function)": 0.528494}<font></font>
11:17:11 {"epoch": 0, "iteration": 300, "score (loss function)": 0.400291}<font></font>
11:17:13 {"epoch": 0, "iteration": 400, "score (loss function)": 0.357800}<font></font>
11:17:14 o.d.o.l.CheckpointListener - Model checkpoint saved: epoch 0, iteration 469, path: /valohai/outputs/checkpoint_0_MultiLayerNetwork.zip<font></font>
[&lt;--- snipped ---&gt;]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このデータにより、Valohaiはこれらの値（JSON形式）を取得できるようになり、ExecutionsメインタブのMetadata追加タブで実行中および実行後に表示できるメトリックを作成するために使用されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/et/p-/se/etp-sezekre2qlznmvgdzlgds0a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、ValohaiMetadataCreatorクラスをモデルなので、トレーニング中にValohaiはこのクラスに目を向けます。</font><font style="vertical-align: inherit;">このクラスの場合、いくつかの時代、反復回数とスコア（損失関数の値）を導き出します。</font><font style="vertical-align: inherit;">これがクラスのコードスニペットです。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">iterationDone</span><span class="hljs-params">(Model model, <span class="hljs-keyword">int</span> iteration, <span class="hljs-keyword">int</span> epoch)</span> </span>{
        <span class="hljs-keyword">if</span> (printIterations &lt;= <span class="hljs-number">0</span>)<font></font>
            printIterations = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (iteration % printIterations == <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">double</span> score = model.score();<font></font>
            System.out.println(String.format(<font></font>
                    <span class="hljs-string">"{\"epoch\": %d, \"iteration\": %d, \"score (loss function)\": %f}"</span>,<font></font>
                    epoch,<font></font>
                    iteration,<font></font>
                    score)<font></font>
            );<font></font>
        }<font></font>
    }<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モデル評価</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前のステップでモデルが正常に作成されたら、評価する必要があります。以前と同じ方法で新しい実行を作成しますが、今回はRun-dl4j-mnist-single-layer -valu-modelステップを選択します。実行を開始する前に、Javaアプリケーション（MLPMnist-1.0.0.jar）と作成したモデル（mlpmnist-single-layer.pb）を再度選択する必要があります（以下を参照）：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/e9/_b/am/e9_bamnlhownoo40utziaqazg8e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
入力として目的のモデルを選択した後、[実行を作成]。前</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gp/0i/co/gp0icomuurv7a0gt-niye5hyri4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
のモデル</font><font style="vertical-align: inherit;">よりも高速に実行され、次の結果が</font><font style="vertical-align: inherit;">表示されます。「hello world」により、テストデータセットに基づいて約97％の精度のモデルが作成された</font><font style="vertical-align: inherit;">ことがわかります</font><font style="vertical-align: inherit;">。混同行列は、数字が別の数字として誤って予測された場合のケースを見つけるのに役立ちます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題は残っています（そしてこの投稿の範囲を超えています）-実際のデータに直面したときのモデルはどの程度優れていますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gitリポジトリのクローンを作成するには、次のことを行う必要があります。</font></font><br>
<br>
<pre><code class="plaintext hljs"> $ git clone https://github.com/valohai/mlpmnist-dl4j-example 
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、上記のセクションのWebインターフェイスを介して作成したValohaiプロジェクトを、ローカルマシン（先ほどクローンしたマシン）に保存されているプロジェクトにリンクする必要があります。</font><font style="vertical-align: inherit;">これを行うには、次のコマンドを実行します。</font></font><br>
<br>
<pre><code class="plaintext hljs">$ cd mlpmnist-dl4j-example<font></font>
$ vh project --help   ### to see all the project-specific options we have for Valohai<font></font>
$ vh project link<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のようなものが表示されます。</font></font><br>
<br>
<pre><code class="plaintext hljs">[  1] mlpmnist-single-layer<font></font>
...<font></font>
Which project would you like to link with /path/to/mlpmnist-dl4j-example?<font></font>
Enter [n] to create a new project.:<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1（または自分に合ったもの）を選択すると、次のメッセージが表示されます。</font></font><br>
<br>
<pre><code class="plaintext hljs">Success! Linked /path/to/mlpmnist-dl4j-example to mlpmnist-single-layer.
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もう1つ、先に進む前に、Valohaiプロジェクトが最新のgitプロジェクトと同期していることを確認してください。</font></font><br>
<br>
<pre><code class="plaintext hljs"> $ vh project fetch 
</code></pre><br>
<img src="https://habrastorage.org/webt/h0/l4/vb/h0l4vbe1eqis5kb9sd7gfslbozk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、CLIから以下の手順を完了できます。</font></font><br>
<br>
<pre><code class="plaintext hljs"> $ vh exec run Build-dl4j-mnist-single-layer-java-app
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実行が完了したら、次のコマンドで確認できます。</font></font><br>
<br>
<pre><code class="plaintext hljs">$ vh exec info<font></font>
$ vh exec logs<font></font>
$ vh exec watch<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これまで見てきたように、DL4JとValohaiを一緒に使用すると非常に便利です。</font><font style="vertical-align: inherit;">さらに、実験（研究）を構成するさまざまなコンポーネント、つまりビルド/ランタイム環境、コード、およびデータセットを開発し、それらをプロジェクトに統合することができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この投稿で使用されているサンプルテンプレートは、より複雑なプロジェクトの作成を開始するための良い方法です。</font><font style="vertical-align: inherit;">また、Webまたはコマンドラインインターフェイスを使用して、Valohaiで仕事をすることができます。</font><font style="vertical-align: inherit;">CLIを使用すると、CLIをインストールおよびスクリプト（またはCRONまたはCI / CDジョブ）と統合することもできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、AI / ML / DLに関連するプロジェクトに取り組んでいる場合、エンドツーエンドのパイプラインの作成と維持について心配する必要がないことは明らかです（これまで他の多くの人がしなければなりませんでした）。</font></font><br>
<br>
<h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参考文献</font></font></h5><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHubのmlpmnist-dl4j-examplesプロジェクト</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">素晴らしいAI / ML / DLリソース</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java AI / ML / DLリソース</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">深層学習とDL4Jリソース</font></font></a> </li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご清聴ありがとうございました！</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja469393/index.html">Flare-On 2019の記事</a></li>
<li><a href="../ja469395/index.html">マルチカラム（CSSカラム）を使用する場所と方法</a></li>
<li><a href="../ja469399/index.html">Arkhangelskoye Museum-EstateでのWi-Fi</a></li>
<li><a href="../ja469401/index.html">3CX WebMeetingサービスの更新、Elastixオンラインコンバーター、新しいビデオチュートリアル</a></li>
<li><a href="../ja469403/index.html">上級ソフトウェア開発者のポジションの候補者にインタビューしています</a></li>
<li><a href="../ja469407/index.html">ARIES PLC110 [M02] -MS4、HMI、OPC、SCADA、または人がカモミールティーをどれだけ必要とするか。パート1</a></li>
<li><a href="../ja469409/index.html">Performance Analyzerを使用したLinuxプロファイリング</a></li>
<li><a href="../ja469411/index.html">RE：スヴェルト3の痛みと涙</a></li>
<li><a href="../ja469413/index.html">先週フロントエンドの世界からの新鮮な食材のダイジェストNo.382（2019年9月22日〜29日）</a></li>
<li><a href="../ja469415/index.html">最小のトランザクション分離レベル</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>