<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíõ üëå üßëüèΩ‚Äçü§ù‚ÄçüßëüèΩ Actualizaci√≥n del proceso de CI / CD: preparaci√≥n y planificaci√≥n üë©üèΩ‚Äç‚öïÔ∏è üìΩÔ∏è üë∂üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En 2020, probablemente sea bastante dif√≠cil encontrar un proyecto en una descripci√≥n de pila que no tenga una de las siguientes palabras: IaC, microse...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Actualizaci√≥n del proceso de CI / CD: preparaci√≥n y planificaci√≥n</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/496204/"><img src="https://habrastorage.org/webt/vl/jg/11/vljg11dfzemfbyfy8oexvw73eyq.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En 2020, probablemente sea bastante dif√≠cil encontrar un proyecto en una descripci√≥n de pila que no tenga una de las siguientes palabras: IaC, microservicios, kubernetes, docker, aws / azure / gcloud, blockchain, ML, VR, etc. </font><font style="vertical-align: inherit;">¬°Y eso es genial! </font><font style="vertical-align: inherit;">El progreso no se detiene. </font><font style="vertical-align: inherit;">Estamos creciendo, nuestros proyectos est√°n creciendo con nosotros, aparecen herramientas m√°s convenientes y funcionales que resuelven problemas modernos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hola. Entonces quer√≠a comenzar este art√≠culo. Pero luego revis√© algunas cosas, habl√© con mis colegas y me di cuenta de que estar√≠a equivocado. Todav√≠a hay proyectos que ya tienen m√°s de 15 a√±os, con gerentes y participantes que son viejos creyentes, y en consecuencia estos proyectos tienen una pila de tecnolog√≠a antigua que es bastante dif√≠cil de mantener en un zool√≥gico existente. Y por alguna raz√≥n, este proyecto no se puede actualizar a nivel mundial (el cliente est√° estancado, no hay actualizaci√≥n, el proyecto es muy grande y la migraci√≥n se retrasa, o todos est√°n contentos con todo), y hay que apoyarlo. A√∫n m√°s desagradable cuando un proyecto similar todav√≠a se est√° desarrollando activamente. Es como una bola de nieve. El cliente y el p√∫blico requieren caracter√≠sticas, el c√≥digo requiere entrega, los servidores requieren atenci√≥n y cuidado ... Pero el bitpack, por lo tanto, en general, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dej√≥ de admitir mercurio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Se propone tal caso para su consideraci√≥n.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo que se considerar√°: convertir mercurial-git, mover CI de CruiseControl.NET a TeamCity, de git-implementaci√≥n a Octopus con una </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peque√±a</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> descripci√≥n de todo el proceso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El texto result√≥ mucho, por lo que se dividir√° en partes separadas para facilitar la percepci√≥n. </font><font style="vertical-align: inherit;">Habr√° una tabla de contenidos. </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 1: qu√© es, por qu√© no es as√≠, planificar, una peque√±a fiesta. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yo llamar√≠a a esta parte casi t√©cnica. </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 2: teamcity. </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 3: despliegue de pulpo. </font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parte 4: detr√°s de escena. </font><font style="vertical-align: inherit;">Momentos desagradables, planes para el futuro, posiblemente preguntas frecuentes. </font><font style="vertical-align: inherit;">Lo m√°s probable es que tambi√©n se le pueda llamar casi t√©cnico.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No llamar√≠a a esto una gu√≠a para la repetici√≥n por muchas razones: inmersi√≥n insuficiente en los procesos del proyecto debido a la falta de tiempo, pr√°ctica insuficiente de tales cosas, un enorme monolito en el que todos los subproyectos est√°n estrechamente entrelazados y un mont√≥n de otros matices que te hacen arder, preguntarte, soportarlos. , pero en ning√∫n caso no por favor. </font><font style="vertical-align: inherit;">Y tambi√©n, debido a las caracter√≠sticas del proyecto (es bastante √∫nico), algunos pasos se adaptar√°n exclusivamente para este caso.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introducci√≥n cl√°sica</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ten√≠amos un repositorio mercurial, m√°s de 300 (¬°abiertos!) Brunches, ccnet, otro ccnet + git (para implementaciones) y una gran cantidad de m√≥dulos de proyecto con nuestras propias configuraciones y clientes individuales, cuatro entornos y una gran cantidad de grupos en IIS, as√≠ como cmd scripts, SQL, m√°s de quinientos dominios, dos docenas de compilaciones y desarrollo activo adem√°s. No es que todo esto fuera necesario, pero funcion√≥, y fue inconveniente y largo. Lo √∫nico que me preocupaba era la presencia de otros proyectos que requer√≠an mi atenci√≥n. Nada en el proceso de trabajar con tareas de esta magnitud es m√°s peligroso que la falta de concentraci√≥n e interrupci√≥n.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sab√≠a que tarde o temprano tendr√≠a que prestar atenci√≥n a otras tareas, y es por eso que pas√© una gran cantidad de tiempo estudiando la infraestructura existente para que al menos no hubiera problemas sin resolver. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desafortunadamente, no puedo dar una descripci√≥n completa del proyecto, debido a la NDA, por lo que se considerar√°n los puntos t√©cnicos generales. Todos los nombres relacionados con el proyecto tambi√©n ser√°n pintados. Pido disculpas por la mancha negra en las capturas de pantalla.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una de las caracter√≠sticas clave del proyecto es que tiene una serie de m√≥dulos que tienen un n√∫cleo, pero difieren en sus configuraciones. Tambi√©n hay m√≥dulos con un enfoque "especial", dise√±ados para revendedores y especialmente para grandes clientes. Un m√≥dulo puede servir a m√°s de un cliente. Un cliente debe entenderse como una organizaci√≥n separada o grupo de personas que obtienen acceso a un m√≥dulo espec√≠fico. Cada cliente obtiene acceso en su propio dominio, tiene su propio dise√±o y su propia configuraci√≥n predeterminada √∫nica. El cliente se identifica por el dominio que utiliza. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El esquema general de esta parte del proyecto se puede representar de la siguiente manera:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ft/1p/jp/ft1pjp-5mnyfk2fu07salwryrew.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como puede ver, el n√∫cleo se usa igual en todas partes, y esto se puede usar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Razones por las cuales surgi√≥ la tarea de revisar y actualizar los procesos de CI / CD:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CruiseControl.NET se utiliz√≥ como sistema de compilaci√≥n. </font><font style="vertical-align: inherit;">Trabajar con √©l es un dudoso placer en principio. </font><font style="vertical-align: inherit;">Configuraciones XML en m√∫ltiples pantallas, un mont√≥n de dependencias y configuraciones de enlace entre s√≠, falta de soluciones modernas a problemas modernos.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algunos desarrolladores (principalmente clientes potenciales) en el proyecto deben tener acceso a los servidores de compilaci√≥n, y a veces les gusta cambiar las configuraciones de ccnet que no deben cambiarse. </font><font style="vertical-align: inherit;">Adivina qu√© pasa despu√©s. </font><font style="vertical-align: inherit;">Debe tener una administraci√≥n de derechos simple y conveniente en el sistema de CI, sin quitar el acceso de los desarrolladores al servidor. </font><font style="vertical-align: inherit;">En pocas palabras, no hay configuraci√≥n de texto: no hay ning√∫n lugar para escalar con manos juguetonas.</font></font></li>
<li>  - ‚Ä¶  CCNET,        git.         (. ).</li>
<li> ,      .     ,      .&nbsp;</li>
<li>-       ,        ‚Äî         (   )       .</li>
<li>   .        ?   ?     ?            .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uso sub√≥ptimo de recursos y un proceso desactualizado de construcci√≥n y entrega de c√≥digo.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Figura del p√°rrafo 3:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/hc/yk/kv/hcykkvp6zijbax7ykugimj3qwkq.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la etapa de planificaci√≥n, se decidi√≥ utilizar Teamcity como sistema de compilaci√≥n y Octopus como sistema de implementaci√≥n. </font><font style="vertical-align: inherit;">La infraestructura "de hierro" del cliente se ha mantenido sin cambios: servidores dedicados separados para desarrollo, prueba, preparaci√≥n y producci√≥n, as√≠ como servidores revendedores (principalmente entornos de producci√≥n). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El cliente recibi√≥ una Prueba de concepto en el ejemplo de uno de los m√≥dulos, se escribi√≥ un plan de acci√≥n, se llevaron a cabo trabajos preparatorios (instalaci√≥n, configuraci√≥n, etc.). </font><font style="vertical-align: inherit;">Probablemente no tenga sentido describir esto. </font><font style="vertical-align: inherit;">C√≥mo instalar Team City se puede leer en el sitio web oficial. </font><font style="vertical-align: inherit;">Me detendr√© por separado en algunos requisitos formulados para el nuevo sistema:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√°cil mantenimiento con todas las consecuencias (copias de seguridad, actualizaciones, resoluci√≥n de problemas, si las hay).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Universalidad </font><font style="vertical-align: inherit;">Idealmente, desarrolle un esquema general seg√∫n el cual todos los m√≥dulos se ensamblen y entreguen, y √∫selo como plantilla.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minimice el tiempo para agregar nuevas configuraciones de compilaci√≥n y mantenimiento. </font><font style="vertical-align: inherit;">Los clientes se agregan / eliminan. </font><font style="vertical-align: inherit;">A veces se hace necesario hacer nuevas configuraciones. </font><font style="vertical-align: inherit;">Es necesario que al crear un nuevo m√≥dulo no haya demoras en la configuraci√≥n de su entrega.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aproximadamente en este punto, recordamos la interrupci√≥n del soporte para repositorios mercuriales con un bitbucket, y se agreg√≥ el requisito de transferir el repositorio a git mientras se preservaban las ramas y el historial de confirmaciones.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Preparaci√≥n: conversi√≥n de repositorio</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parece que alguien claramente resolvi√≥ este problema antes que nosotros y en lugar de nosotros. </font><font style="vertical-align: inherit;">Solo necesita encontrar una soluci√≥n de trabajo preparada. </font><font style="vertical-align: inherit;">La exportaci√≥n r√°pida result√≥ no ser tan r√°pida. </font><font style="vertical-align: inherit;">Adem√°s, no funcion√≥. </font><font style="vertical-align: inherit;">Desafortunadamente, no quedan registros ni capturas de pantalla. </font><font style="vertical-align: inherit;">El hecho es que no pudo. </font><font style="vertical-align: inherit;">Bitbucket no proporciona su propio convertidor (pero podr√≠a). </font><font style="vertical-align: inherit;">Un par de m√©todos m√°s buscados en Google, y tambi√©n por. </font><font style="vertical-align: inherit;">Decid√≠ escribir mis propios scripts, de todos modos este no es el √∫nico repositorio mercurial, ser√° √∫til en el futuro. </font><font style="vertical-align: inherit;">Aqu√≠ se presentar√°n los primeros desarrollos (porque a√∫n permanecen en la misma forma). </font><font style="vertical-align: inherit;">La l√≥gica del trabajo se parece a esto:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tomamos la extensi√≥n mercurial hggit como base.&nbsp;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obtenemos una lista de todas las ramas del repositorio mercurial.&nbsp;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Convertimos los nombres de las ramas (gracias a mercurial y a los desarrolladores por los espacios en los nombres de las ramas, gracias especiales por las di√©resis y otros caracteres que agregan alegr√≠a a la vida).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Haga marcadores (marcador de hg) e inserte en el repositorio intermedio. </font><font style="vertical-align: inherit;">¬øPara qu√©? </font><font style="vertical-align: inherit;">Porque bitbucket, y porque no puede crear un marcador con el mismo nombre que el nombre de la rama (por ejemplo, puesta en escena).&nbsp;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En el nuevo repositorio (ya git), elimine el postfix del nombre de la rama y migre hgignore a gitignore.&nbsp;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Empuje al repositorio principal. </font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listado de comandos seg√∫n puntos:</font></font><br>
<br>
<ol>
<li><pre><code class="bash hljs">$ <span class="hljs-built_in">cd</span> /path/to/hg/repo<font></font>
$ cat &lt;&lt; EOF &gt;&gt; ./.hg/hgrc<font></font>
[extensions]<font></font>
hggit=<font></font>
EOF<font></font>
</code></pre></li>
<li><pre><code class="bash hljs">$ hg branches &gt; ../branches
</code></pre></li>
<li><pre><code class="bash hljs"><span class="hljs-meta">#!/usr/bin/env bash</span>
hgBranchList=<span class="hljs-string">"./branches"</span>
sed -i <span class="hljs-string">'s/:.*//g'</span> <span class="hljs-variable">${hgBranchList}</span>
symbolsToDelete=$(awk <span class="hljs-string">'{print $NF}'</span> FS=<span class="hljs-string">" "</span> <span class="hljs-variable">${hgBranchList}</span> &gt; sym_to_del.tmp)<font></font>
 <font></font>
i=0<font></font>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> hgBranch; <span class="hljs-keyword">do</span>
  hgBranches[<span class="hljs-variable">$i</span>]=<span class="hljs-variable">${hgBranch}</span>
  i=$((i+<span class="hljs-number">1</span>))
<span class="hljs-keyword">done</span> &lt;<span class="hljs-variable">${hgBranchList}</span><font></font>
 <font></font>
i=0<font></font>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> str; <span class="hljs-keyword">do</span>
  strToDel[<span class="hljs-variable">$i</span>]=<span class="hljs-variable">${str}</span>
  i=$((i+<span class="hljs-number">1</span>))
<span class="hljs-keyword">done</span> &lt; ./sym_to_del.tmp<font></font>
 <font></font>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-variable">${!strToDel[@]}</span>
<span class="hljs-keyword">do</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-variable">${hgBranches[$i]}</span> | sed <span class="hljs-string">"s/<span class="hljs-variable">${strToDel[$i]}</span>//"</span> &gt;&gt; result.tmp
<span class="hljs-keyword">done</span><font></font>
 <font></font>
sed -i <span class="hljs-string">'s/[ \t]*$//'</span> result.tmp<font></font>
sed <span class="hljs-string">'s/^/"/g'</span> result.tmp &gt; branches_hg<font></font>
sed -i <span class="hljs-string">'s/$/"/g'</span> branches_hg<font></font>
sed <span class="hljs-string">'s/ /-/g'</span> result.tmp &gt; branches_git<font></font>
sed -i <span class="hljs-string">'s/-\/-/\//g'</span> branches_git<font></font>
sed -i <span class="hljs-string">'s/-\//\//g'</span> branches_git<font></font>
sed -i <span class="hljs-string">'s/\/-/\//g'</span> branches_git<font></font>
sed -i <span class="hljs-string">'s/---/-/g'</span> branches_git<font></font>
sed -i <span class="hljs-string">'s/--/-/g'</span> branches_git<font></font>
rm sym_to_del.tmp<font></font>
rm result.tmp<font></font>
</code></pre></li>
<li><pre><code class="bash hljs"><span class="hljs-meta">#!/usr/bin/env bash</span>
gitBranchList=<span class="hljs-string">"./branches_git"</span>
hgBranchList=<span class="hljs-string">"./branches_hg"</span>
hgRepo=<span class="hljs-string">"/repos/reponame"</span><font></font>
 <font></font>
i=0<font></font>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> hgBranch; <span class="hljs-keyword">do</span>
  hgBranches[<span class="hljs-variable">$i</span>]=<span class="hljs-variable">${hgBranch}</span>
  i=$((i+<span class="hljs-number">1</span>))
<span class="hljs-keyword">done</span> &lt;<span class="hljs-variable">${hgBranchList}</span><font></font>
 <font></font>
i=0<font></font>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> gitBranch; <span class="hljs-keyword">do</span>
  gitBranches[<span class="hljs-variable">$i</span>]=<span class="hljs-variable">${gitBranch}</span>
  i=$((i+<span class="hljs-number">1</span>))
<span class="hljs-keyword">done</span> &lt;<span class="hljs-variable">${gitBranchList}</span><font></font>
 <font></font>
<span class="hljs-built_in">cd</span> <span class="hljs-variable">${hgRepo}</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-variable">${!gitBranches[@]}</span>
<span class="hljs-keyword">do</span>
  hg bookmark -r <span class="hljs-string">"<span class="hljs-variable">${hgBranches[$i]}</span>"</span> <span class="hljs-string">"<span class="hljs-variable">${gitBranches[$i]}</span>-cnv"</span>
<span class="hljs-keyword">done</span><font></font>
 <font></font>
hg push git+ssh://git@bitbucket.org:username/reponame-temp.git<font></font>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Done."</span>
</code></pre></li>
<li><pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># clone repo, run git branch -a, delete remotes/origin words to leave only branch names, delete -cnv postfix, delete default branch string because we can't delete it</span>
repo=<span class="hljs-string">"/repos/repo"</span>
gitBranchList=<span class="hljs-string">"./branches_git"</span>
defaultBranch=<span class="hljs-string">"default-cnv"</span>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> gitBranch; <span class="hljs-keyword">do</span>   gitBranches[<span class="hljs-variable">$i</span>]=<span class="hljs-variable">${gitBranch}</span>;   i=$((i+<span class="hljs-number">1</span>)); <span class="hljs-keyword">done</span> &lt; <span class="hljs-variable">$gitBranchList</span>
<span class="hljs-built_in">cd</span> <span class="hljs-variable">$repo</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-variable">${!gitBranches[@]}</span>; <span class="hljs-keyword">do</span> git checkout <span class="hljs-variable">${gitBranches[$i]}</span>-cnv; <span class="hljs-keyword">done</span>
git checkout <span class="hljs-variable">$defaultBranch</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-variable">${!gitBranches[@]}</span>; <span class="hljs-keyword">do</span>
    git branch -m <span class="hljs-variable">${gitBranches[$i]}</span>-cnv <span class="hljs-variable">${gitBranches[$i]}</span>
    git push origin :<span class="hljs-variable">${gitBranches[$i]}</span>-cnv <span class="hljs-variable">${gitBranches[$i]}</span>
    git push origin -u <span class="hljs-variable">${gitBranches[$i]}</span>
<span class="hljs-keyword">done</span>
</code></pre></li>
<li><pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># clone repo, run git branch -a, delete remotes/origin words to leave only branch names, delete -cnv postfix, delete default branch string because we can't delete it</span>
repo=<span class="hljs-string">"/repos/repo"</span>
gitBranchList=<span class="hljs-string">"./branches_git"</span>
defaultBranch=<span class="hljs-string">"default"</span>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> gitBranch; <span class="hljs-keyword">do</span>   gitBranches[<span class="hljs-variable">$i</span>]=<span class="hljs-variable">${gitBranch}</span>;   i=$((i+<span class="hljs-number">1</span>)); <span class="hljs-keyword">done</span> &lt; <span class="hljs-variable">$gitBranchList</span>
<span class="hljs-built_in">cd</span> <span class="hljs-variable">$repo</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-variable">${!gitBranches[@]}</span>; <span class="hljs-keyword">do</span>
    git checkout <span class="hljs-variable">${gitBranches[$i]}</span>
    sed -i <span class="hljs-string">'1d'</span> .hgignore<font></font>
    mv .hgignore .gitignore<font></font>
    git add .<font></font>
    git commit -m <span class="hljs-string">"Migrated ignore file"</span>
<span class="hljs-keyword">done</span>
</code></pre></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tratar√© de explicar el significado de algunas acciones, a saber, el uso de un repositorio intermedio. Inicialmente, en el repositorio despu√©s de la conversi√≥n, los nombres de las ramas contienen el postfix "-cnv". Esto se debe a la funci√≥n de marcador hg. Debe eliminar este postfix y tambi√©n crear archivos gitignore en lugar de hgignore. Todo esto agrega historia y, por lo tanto, aumenta el tama√±o del repositorio (e irrazonablemente). Como otro ejemplo, puedo citar lo siguiente: intente crear un repositorio y presione el primer commit a 300M con el c√≥digo. Luego agr√©guelo a gitignore y emp√∫jelo sin √©l. Permanecer√° en la historia. Ahora intenta eliminarlo del historial (git filter-branch). Con un cierto n√∫mero de confirmaciones, el tama√±o del repositorio resultante no disminuir√°, sino que aumentar√°. Esto se resuelve mediante la optimizaci√≥n, pero no se puede iniciar en bitbucket.Se lleva a cabo solo al importar el repositorio. Por lo tanto, todas las operaciones aproximadas se llevan a cabo con un intermedio, y luego se realiza la importaci√≥n a una nueva. El tama√±o del repositorio intermedio en la final fue de 1.15G, y el tama√±o de los 350M resultantes.&nbsp;</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusi√≥n</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo el proceso de migraci√≥n se dividi√≥ en varias etapas, a saber:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preparaci√≥n (demostraci√≥n al cliente utilizando un ejemplo de una compilaci√≥n, instalaci√≥n de software, conversi√≥n de repositorio, actualizaci√≥n de configuraciones ccnet existentes);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuraci√≥n de CI / CD para el entorno de desarrollo y sus pruebas (el sistema antiguo sigue funcionando en paralelo);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuraciones de CI / CD para los entornos restantes (en paralelo con el "bueno" existente) y pruebas;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desarrollo de migraci√≥n, puesta en escena y prueba;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Migraci√≥n de producci√≥n y transferencia de dominios de instancias IIS antiguas a nuevas.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La descripci√≥n de la fase preparatoria completada con √©xito se est√° completando actualmente. </font><font style="vertical-align: inherit;">Aqu√≠ no se logr√≥ un √©xito grandioso, excepto que el sistema existente no se descompuso y se migr√≥ el repositorio mercurial en git. </font><font style="vertical-align: inherit;">Sin embargo, sin una descripci√≥n de estos procesos, no habr√° contexto para m√°s partes t√©cnicas. </font><font style="vertical-align: inherit;">La siguiente parte describir√° el proceso de configuraci√≥n de un sistema de CI basado en teamcity.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es496190/index.html">Sobre Phrasal Verbs-2</a></li>
<li><a href="../es496192/index.html">Funciones de llamada de √≥xido desde Go</a></li>
<li><a href="../es496194/index.html">Sobre la binarizaci√≥n de im√°genes tomogr√°ficas de estructura fina</a></li>
<li><a href="../es496196/index.html">Conferencia DEFCON 26. Meneando la cola: vigilancia pasiva encubierta. Parte 1</a></li>
<li><a href="../es496198/index.html">Presentaciones del segundo ROS Meetup sobre robots de entrenamiento</a></li>
<li><a href="../es496206/index.html">Mil millones de operaciones en la base de datos en 0.3 segundos. No compare OLTP con OLAP, pero QuestDB con PostgreSQL</a></li>
<li><a href="../es496208/index.html">C√≥mo JIT integra nuestro c√≥digo C # (heur√≠stica)</a></li>
<li><a href="../es496210/index.html">La biodiversidad puede haber evolucionado desde el principio de jugar piedra, papel o tijera</a></li>
<li><a href="../es496212/index.html"># 04 - Y un byte completo no es suficiente ... | Toma a BK por los cuernos</a></li>
<li><a href="../es496214/index.html">AdColony: el 89% de los editores de aplicaciones y juegos m√≥viles usan videos promocionales</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>