<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêä üõ†Ô∏è üï¢ PEP 572 (expressions d'affectation en python 3.8) üíÉüèª ü•Ö üà≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, Habr. Cette fois, nous examinerons le PEP 572, qui parle d'expressions d'affectation. Si vous √™tes toujours sceptique vis-√†-vis de l'op√©rateu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>PEP 572 (expressions d'affectation en python 3.8)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/499666/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bonjour, Habr. </font><font style="vertical-align: inherit;">Cette fois, nous examinerons le PEP 572, qui parle d'expressions d'affectation. </font><font style="vertical-align: inherit;">Si vous √™tes toujours sceptique vis-√†-vis de l'op√©rateur ": =" ou si vous ne comprenez pas parfaitement les r√®gles de son utilisation, cet article est pour vous. </font><font style="vertical-align: inherit;">Vous trouverez ici de nombreux exemples et r√©ponses √† la question: ¬´Pourquoi en est-il ainsi?¬ª </font><font style="vertical-align: inherit;">Cet article s'est av√©r√© √™tre aussi complet que possible, et si vous avez peu de temps, alors regardez la section que j'ai √©crite. </font><font style="vertical-align: inherit;">√Ä ses d√©buts, les principales ¬´th√®ses¬ª sont rassembl√©es pour un travail confortable avec des expressions d'affectation. </font><font style="vertical-align: inherit;">Pardonnez-moi √† l'avance si vous trouvez des erreurs (√©crivez-moi, je vais les corriger). </font><font style="vertical-align: inherit;">Commen√ßons:</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PEP 572 - Expressions d'affectation</font></font></h2><div class="scrollable-table"><table>
<tbody><tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dynamisme</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">572</font></font></td>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Titre:</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Expressions d'affectation</font></font></td>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Auteurs:</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chris Angelico &lt;rosuav at gmail.com&gt;, Tim Peters &lt;tim.peters at gmail.com&gt;, Guido van Rossum &lt;guido at python.org&gt;</font></font></td>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Discussion:</font></font></b></td>
<td><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doc-sig sur python.org</font></font></a></td>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Statut:</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Accept√©</font></font></td>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un type:</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la norme</font></font></td>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cr√©√©:</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">28-f√©vr.-2018</font></font></td>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Version Python:</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.8</font></font></td>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Histoire de poste:</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">28-f√©vr.-2018, 02-mars-2018, 23-mars-2018, 04-avr-2018, 17-avr-2018, 25-avr-2018, 09-juil-2018, 05-ao√ªt-2019</font></font></td>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Autorisation d'adopter la norme:</font></font></b></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mail.python.org/pipermail/python-dev/2018-July/154601.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (avec VPN depuis longtemps, mais il se charge)</font></font></td>
</tr>
</tbody></table></div><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenu</font></font></b><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">annotation</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Justification</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Syntaxe et s√©mantique</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modifications des sp√©cifications lors de la mise en ≈ìuvre</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemples</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alternatives rejet√©es</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objections fr√©quentes</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recommandations de style</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Merci</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Annexe A: Conclusions de Tim Peters</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Annexe B: Un interpr√©teur de code approximatif pour les g√©n√©rateurs</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Annexe C: Aucun changement dans la s√©mantique de la port√©e</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©f√©rences</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">droits d'auteur</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ma partie</font></font></a></li>
</ul><br>
<a name="ann"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">annotation</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette convention parlera de la possibilit√© d'affectation √† l'int√©rieur des expressions, en utilisant la nouvelle notation NAME: = expr. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le cadre des innovations, la proc√©dure de calcul des g√©n√©rateurs de dictionnaire (compr√©hension de dictionnaire) a √©t√© mise √† jour. Cela garantit que l'expression de cl√© est √©valu√©e avant l'expression de valeur (cela vous permet de lier la cl√© √† une variable, puis de r√©utiliser la variable cr√©√©e dans le calcul de la valeur correspondant √† la cl√©). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au cours d'une discussion sur ce PEP, cet op√©rateur est devenu officieusement connu sous le nom d'op√©rateur de morse. Le nom officiel de la construction est ¬´Expression d'affectation¬ª (selon le titre PEP: Expressions d'affectation), mais il peut √™tre appel√© ¬´Expressions nomm√©es¬ª. Par exemple, l'impl√©mentation de r√©f√©rence dans CPython utilise ce m√™me nom.</font></font><br>
<br>
<a name="oboc"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Justification</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le nommage est une partie importante de la programmation qui vous permet d'utiliser un nom ¬´descriptif¬ª au lieu d'une expression plus longue, et facilite √©galement la r√©utilisation des valeurs. </font><font style="vertical-align: inherit;">Actuellement, cela ne peut se faire que sous forme d'instructions, ce qui rend cette op√©ration indisponible lors de la g√©n√©ration de listes (compr√©hension de liste), ainsi que dans d'autres expressions.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, le fait de nommer des parties d'une grande expression peut aider au d√©bogage interactif en fournissant des outils pour afficher des invites et des r√©sultats interm√©diaires. </font><font style="vertical-align: inherit;">Sans la possibilit√© de capturer les r√©sultats d'expressions imbriqu√©es, vous devrez modifier le code source, mais en utilisant les expressions d'affectation, il vous suffit d'ins√©rer quelques "marqueurs" du formulaire "nom: = expression". </font><font style="vertical-align: inherit;">Cela √©limine le refactoring inutile et r√©duit donc la probabilit√© de modifications de code involontaires pendant le d√©bogage (une cause courante des Heisenbugs est des erreurs qui modifient les propri√©t√©s du code pendant le d√©bogage et peuvent appara√Ætre de mani√®re inattendue en production]), et ce code sera plus compr√©hensible pour un autre au programmeur.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'importance du vrai code</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au cours de l'√©laboration de ce PEP, de nombreuses personnes (partisans et critiques) se sont trop concentr√©es sur les exemples de jouets d'une part et les exemples trop complexes de l'autre. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le danger des exemples de jouets est double: ils sont souvent trop abstraits pour faire dire √† quelqu'un "oh, c'est irr√©sistible", et ils sont aussi facilement rejet√©s avec les mots "je n'√©crirais jamais √ßa". Le danger d'exemples trop complexes est qu'ils fournissent un environnement pratique pour les critiques sugg√©rant que cette fonctionnalit√© soit supprim√©e (¬´C'est trop d√©routant¬ª, disent de telles personnes). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, ces exemples sont utiles: ils aident √† clarifier la s√©mantique voulue. Par cons√©quent, nous en donnerons certains ci-dessous. Cependant, pour √™tre </font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">convaincant</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , les exemples doivent √™tre bas√©s sur</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un vrai</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> code qui a √©t√© √©crit sans penser √† ce PEP. Autrement dit, le code qui fait partie d'une application vraiment utile (aucune diff√©rence: qu'il soit grand ou petit). Tim Peters nous a beaucoup aid√©s en consultant ses r√©pertoires personnels et en choisissant des exemples de code qu'il a √©crit, qui (√† son avis) seraient plus compr√©hensibles s'ils √©taient r√©√©crits (sans fanatisme) √† l'aide d'expressions d'affectation. Sa conclusion est la suivante: les changements actuels apporteraient une am√©lioration modeste mais √©vidente dans quelques morceaux de son code. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un autre exemple de code r√©el est l'observation indirecte de la fa√ßon dont les programmeurs appr√©cient la compacit√©. Guido van Rossum a v√©rifi√© la base de code Dropbox et a trouv√© des preuves que les programmeurs pr√©f√®rent √©crire moins de lignes de code que d'utiliser quelques petites expressions.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exemple: Guido a trouv√© plusieurs points illustratifs lorsqu'un programmeur r√©p√®te une sous-expression (ralentissant ainsi le programme), mais enregistre une ligne de code suppl√©mentaire. </font><font style="vertical-align: inherit;">Par exemple, au lieu d'√©crire:</font></font><br>
<br>
<pre><code class="python hljs">match = re.match(data)<font></font>
group = match.group(<span class="hljs-number">1</span>) <span class="hljs-keyword">if</span> match <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les programmeurs ont pr√©f√©r√© cette option:</font></font><br>
<br>
<pre><code class="python hljs">group = re.match(data).group(<span class="hljs-number">1</span>) <span class="hljs-keyword">if</span> re.match(data) <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici un autre exemple montrant que les programmeurs sont parfois pr√™ts √† faire plus de travail pour maintenir le ¬´niveau pr√©c√©dent¬ª d'indentation:</font></font><br>
<br>
<pre><code class="python hljs">match1 = pattern1.match(data)<font></font>
match2 = pattern2.match(data)<font></font>
<span class="hljs-keyword">if</span> match1:<font></font>
    result = match1.group(<span class="hljs-number">1</span>)
<span class="hljs-keyword">elif</span> match2:<font></font>
    result = match2.group(<span class="hljs-number">2</span>)
<span class="hljs-keyword">else</span>:<font></font>
    result = <span class="hljs-literal">None</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce code calcule pattern2, m√™me si pattern1 correspond d√©j√† (dans ce cas, la deuxi√®me sous-condition ne sera jamais remplie). </font><font style="vertical-align: inherit;">Par cons√©quent, la solution suivante est plus efficace, mais moins attrayante:</font></font><br>
<br>
<pre><code class="python hljs">match1 = pattern1.match(data)
<span class="hljs-keyword">if</span> match1:<font></font>
    result = match1.group(<span class="hljs-number">1</span>)
<span class="hljs-keyword">else</span>:<font></font>
    match2 = pattern2.match(data)<font></font>
    <span class="hljs-keyword">if</span> match2:<font></font>
        result = match2.group(<span class="hljs-number">2</span>)
    <span class="hljs-keyword">else</span>:<font></font>
        result = <span class="hljs-literal">None</span></code></pre><br>
<a name="sint"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Syntaxe et s√©mantique</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la plupart des cas o√π Python utilise des expressions arbitraires, vous pouvez d√©sormais utiliser des expressions d'affectation. </font><font style="vertical-align: inherit;">Ils ont la forme NAME: = expr, o√π expr est n'importe quelle expression Python valide, √† l'exception du tuple non parenth√©s√©, et NAME est l'identifiant. </font><font style="vertical-align: inherit;">La valeur d'une telle expression co√Øncide avec l'original, mais un effet suppl√©mentaire est l'attribution d'une valeur √† l'objet cible:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># Handle a matched regex</span>
<span class="hljs-keyword">if</span> (match := pattern.search(data)) <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
    <span class="hljs-comment"># Do something with match</span><font></font>
<font></font>
<span class="hljs-comment"># A loop that can't be trivially rewritten using 2-arg iter()</span>
<span class="hljs-keyword">while</span> chunk := file.read(<span class="hljs-number">8192</span>):<font></font>
   process(chunk)<font></font>
<font></font>
<span class="hljs-comment"># Reuse a value that's expensive to compute</span>
[y := f(x), y**<span class="hljs-number">2</span>, y**<span class="hljs-number">3</span>]<font></font>
<font></font>
<span class="hljs-comment"># Share a subexpression between a comprehension filter clause and its output</span>
filtered_data = [y <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> data <span class="hljs-keyword">if</span> (y := f(x)) <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>]</code></pre><br>
<a name="iskluch"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cas exceptionnels</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe plusieurs endroits o√π les expressions d'affectation ne sont pas autoris√©es afin d'√©viter toute ambigu√Øt√© ou confusion parmi les utilisateurs:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les expressions d'affectation non incluses entre parenth√®ses sont interdites au niveau ¬´sup√©rieur¬ª:</font></font><br>
<br>
<pre><code class="python hljs">y := f(x)  <span class="hljs-comment"># </span>
(y := f(x))  <span class="hljs-comment"># ,   </span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette r√®gle permettra au programmeur de choisir plus facilement entre un op√©rateur d'affectation et une expression d'affectation - il n'y aura pas de situation syntaxique dans laquelle les deux options sont √©quivalentes.</font></font></li>
<li>           . :<br>
<br>
<pre><code class="python hljs">y0 = y1 := f(x)  <span class="hljs-comment"># </span>
y0 = (y1 := f(x))  <span class="hljs-comment"># ,   </span></code></pre><br>
             . :<br>
<br>
<pre><code class="python hljs">foo(x = y := f(x))  <span class="hljs-comment"># </span>
foo(x=(y := f(x)))  <span class="hljs-comment"># ,     </span></code></pre><br>
 ,               .</li>
<li>           . :<br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo</span>(<span class="hljs-params">answer = p := <span class="hljs-number">42</span></span>):</span>  <span class="hljs-comment"># </span><font></font>
    ...<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo</span>(<span class="hljs-params">answer=(<span class="hljs-params">p := <span class="hljs-number">42</span></span>)</span>):</span>  <span class="hljs-comment"># Valid, though not great style</span>
    ...</code></pre><br>
        ,           (.    ,     ¬´¬ª     ).</li>
<li>           ,    . :<br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo</span>(<span class="hljs-params">answer: p := <span class="hljs-number">42</span> = <span class="hljs-number">5</span></span>):</span>  <span class="hljs-comment"># </span><font></font>
    ...<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo</span>(<span class="hljs-params">answer: (<span class="hljs-params">p := <span class="hljs-number">42</span></span>) = <span class="hljs-number">5</span></span>):</span>  <span class="hljs-comment"># ,  </span>
    ...</code></pre><br>
       : ,     "="  ":="   .</li>
<li>        -. :<br>
<br>
<pre><code class="python hljs">(<span class="hljs-keyword">lambda</span>: x := <span class="hljs-number">1</span>) <span class="hljs-comment"># </span>
<span class="hljs-keyword">lambda</span>: (x := <span class="hljs-number">1</span>) <span class="hljs-comment"># ,  </span>
(x := <span class="hljs-keyword">lambda</span>: <span class="hljs-number">1</span>) <span class="hljs-comment"># </span>
<span class="hljs-keyword">lambda</span> line: (m := re.match(pattern, line)) <span class="hljs-keyword">and</span> m.group(<span class="hljs-number">1</span>) <span class="hljs-comment"># Valid</span></code></pre><br>
-    ,  ":=".       .  ,     ,    ()  ,         .</li>
<li>   f-  . :<br>
<br>
<pre><code class="python hljs"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">f'<span class="hljs-subst">{(x:=<span class="hljs-number">10</span>)}</span>'</span>  <span class="hljs-comment"># ,  </span>
<span class="hljs-string">'10'</span>
<span class="hljs-meta">&gt;&gt;&gt; </span>x = <span class="hljs-number">10</span>
<span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">f'<span class="hljs-subst">{x:=<span class="hljs-number">10</span>}</span>'</span>    <span class="hljs-comment"># ,  ,  '=10'</span>
<span class="hljs-string">'        10'</span></code></pre><br>
 ,    ,     f-,  .  f-   ":"    .    ,      f-      .     ,      .</li>
</ul><br>
<h3> </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une expression d'affectation n'introduit pas de nouvelle √©tendue. Dans la plupart des cas, l'√©tendue dans laquelle la variable sera cr√©√©e ne n√©cessite aucune explication: elle sera √† jour. Si la variable a utilis√© les mots cl√©s non locaux ou globaux auparavant, l'expression d'affectation en tiendra compte. Seul lambda (√©tant une d√©finition anonyme d'une fonction) est consid√©r√© comme une port√©e distincte √† ces fins. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe un cas particulier: une expression d'affectation qui se produit dans les g√©n√©rateurs de listes, d'ensembles, de dictionnaires ou dans les ¬´expressions des g√©n√©rateurs¬ª eux-m√™mes (ci-apr√®s collectivement appel√©s ¬´g√©n√©rateurs¬ª (compr√©hensions)) lie la variable √† la port√©e que contient le g√©n√©rateur, en observant le modificateur globab ou non global, s'il en existe un.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La justification de ce cas sp√©cial est double. </font><font style="vertical-align: inherit;">Premi√®rement, cela nous permet de capturer facilement le ¬´membre¬ª dans les expressions any () et all (), par exemple:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">if</span> any((comment := line).startswith(<span class="hljs-string">'#'</span>) <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines):<font></font>
    print(<span class="hljs-string">"First comment:"</span>, comment)
<span class="hljs-keyword">else</span>:<font></font>
    print(<span class="hljs-string">"There are no comments"</span>)<font></font>
<font></font>
<span class="hljs-keyword">if</span> all((nonblank := line).strip() == <span class="hljs-string">''</span> <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines):<font></font>
    print(<span class="hljs-string">"All lines are blank"</span>)
<span class="hljs-keyword">else</span>:<font></font>
    print(<span class="hljs-string">"First non-blank line:"</span>, nonblank)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deuxi√®mement, il fournit un moyen compact de mettre √† jour une variable √† partir d'un g√©n√©rateur, par exemple:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># Compute partial sums in a list comprehension</span>
total = <span class="hljs-number">0</span>
partial_sums = [total := total + v <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> values]<font></font>
print(<span class="hljs-string">"Total:"</span>, total)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, le nom de la variable de l'expression d'affectation ne peut pas correspondre au nom d√©j√† utilis√© dans les g√©n√©rateurs par la boucle for pour it√©rer. </font><font style="vertical-align: inherit;">Les noms de famille sont locaux au g√©n√©rateur dans lequel ils apparaissent. </font><font style="vertical-align: inherit;">Il serait incoh√©rent si les expressions d'affectation faisaient √©galement r√©f√©rence √† la port√©e dans le g√©n√©rateur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, [i: = i + 1 pour i dans la plage (5)] n'est pas valide: la boucle for d√©termine que i est local au g√©n√©rateur, mais la partie ¬´i: = i + 1¬ª insiste sur le fait que i est une variable de l'ext√©rieur port√©e </font><font style="vertical-align: inherit;">Pour la m√™me raison, les exemples suivants ne fonctionneront pas:</font></font><br>
<br>
<pre><code class="python hljs">
[[(j := j) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>)] <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>)] <span class="hljs-comment"># </span>
[i := <span class="hljs-number">0</span> <span class="hljs-keyword">for</span> i, j <span class="hljs-keyword">in</span> stuff]                       <span class="hljs-comment"># </span>
[i+<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> (i := stuff)]                      <span class="hljs-comment"># </span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien qu'il soit techniquement possible d'attribuer une s√©mantique coh√©rente √† de tels cas, il est difficile de d√©terminer si la fa√ßon dont nous comprenons cette s√©mantique fonctionnera dans votre code r√©el. C'est pourquoi l'impl√©mentation de r√©f√©rence garantit que de tels cas d√©clenchent SyntaxError plut√¥t que d'√™tre ex√©cut√©s avec un comportement non d√©fini, selon l'impl√©mentation mat√©rielle particuli√®re. Cette restriction s'applique m√™me si une expression d'affectation n'est jamais ex√©cut√©e:</font></font><br>
<br>
<pre><code class="python hljs">[<span class="hljs-literal">False</span> <span class="hljs-keyword">and</span> (i := <span class="hljs-number">0</span>) <span class="hljs-keyword">for</span> i, j <span class="hljs-keyword">in</span> stuff]     <span class="hljs-comment"># </span>
[i <span class="hljs-keyword">for</span> i, j <span class="hljs-keyword">in</span> stuff <span class="hljs-keyword">if</span> <span class="hljs-literal">True</span> <span class="hljs-keyword">or</span> (j := <span class="hljs-number">1</span>)]  <span class="hljs-comment"># </span><font></font>
<font></font>
<span class="hljs-comment"># [.  . - ""   </span>
<span class="hljs-comment"># ,       </span>
<span class="hljs-comment"># ,    ,   ]</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour le corps du g√©n√©rateur (la partie avant le premier mot-cl√© ¬´pour¬ª) et l'expression de filtre (la partie apr√®s le ¬´si¬ª et avant tout ¬´pour¬ª imbriqu√©), cette restriction s'applique exclusivement aux noms de variable qui sont simultan√©ment utilis√©s comme variables it√©ratives. Comme nous l'avons d√©j√† dit, les expressions Lambda introduisent une nouvelle port√©e explicite de la fonction et peuvent donc √™tre utilis√©es dans les expressions des g√©n√©rateurs sans restrictions suppl√©mentaires. [environ. √† nouveau, sauf dans de tels cas: [i pour i dans la plage (2, (lambda: (s: = 2) ()))]]]</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En raison des limites de conception dans l'impl√©mentation de r√©f√©rence (l'analyseur de table de symboles ne peut pas reconna√Ætre si les noms de la partie gauche du g√©n√©rateur sont utilis√©s dans la partie restante o√π se trouve l'expression it√©rable), par cons√©quent, les expressions d'affectation sont compl√®tement interdites dans le cadre de l'it√©rable (dans la partie apr√®s chaque ¬´in¬ª et avant tout mot cl√© "si" ou "pour"). </font><font style="vertical-align: inherit;">Autrement dit, tous ces cas sont inacceptables:</font></font><br>
<br>
<pre><code class="python hljs">[i+<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> (j := stuff)]                    <span class="hljs-comment"># </span>
[i+<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>) <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> (k := stuff)]  <span class="hljs-comment"># </span>
[i+<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [j <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> (k := stuff)]]       <span class="hljs-comment"># </span>
[i+<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> (<span class="hljs-keyword">lambda</span>: (j := stuff))()]        <span class="hljs-comment"># </span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une autre exception se produit lorsqu'une expression d'affectation est utilis√©e dans des g√©n√©rateurs qui se trouvent dans la port√©e d'une classe. </font><font style="vertical-align: inherit;">Si, lors de l'utilisation des r√®gles ci-dessus, la cr√©ation d'une classe remesur√©e dans la port√©e devait se produire, alors une telle expression d'affectation n'est pas valide et entra√Ænera une SyntaxError:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Example</span>:</span>
    [(j := i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>)]  <span class="hljs-comment"># </span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(La raison de la derni√®re exception est la port√©e implicite de la fonction cr√©√©e par le g√©n√©rateur - il n'y a actuellement aucun m√©canisme d'ex√©cution pour que les fonctions se r√©f√®rent √† une variable situ√©e dans la port√©e de la classe, et nous ne voulons pas ajouter un tel m√©canisme. Si ce probl√®me est r√©solu, ce cas sp√©cial (√©ventuellement) sera supprim√© de la sp√©cification des expressions d'affectation. Notez que ce probl√®me se produira m√™me si vous avez cr√©√© une variable plus t√¥t dans la port√©e de la classe et essayez de la changer avec une expression d'affectation du g√©n√©rateur.) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voir l'annexe B pour des exemples de la fa√ßon dont les expressions d'affectation trouv√©es dans les g√©n√©rateurs sont converties en code √©quivalent.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Priorit√© relative: =</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'op√©rateur: = est group√© plus fort que la virgule dans toutes les positions syntaxiques lorsque cela est possible, mais plus faible que tous les autres op√©rateurs, y compris ou, et, non, et les expressions conditionnelles (A si C sinon B). Comme indiqu√© dans la section ¬´Cas exceptionnels¬ª ci-dessus, les expressions d'affectation ne fonctionnent jamais au m√™me ¬´niveau¬ª que l'affectation classique =. Si un ordre d'op√©rations diff√©rent est requis, utilisez des parenth√®ses. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'op√©rateur: = peut √™tre utilis√© directement lors de l'appel de l'argument positionnel d'une fonction. Cependant, cela ne fonctionnera pas directement dans l'argument. Quelques exemples clarifiant ce qui est techniquement autoris√© et ce qui n'est pas possible:</font></font><br>
<br>
<pre><code class="python hljs">x := <span class="hljs-number">0</span> <span class="hljs-comment"># </span><font></font>
<font></font>
(x := <span class="hljs-number">0</span>) <span class="hljs-comment">#  </span><font></font>
<font></font>
x = y := <span class="hljs-number">0</span> <span class="hljs-comment"># </span><font></font>
<font></font>
x = (y := <span class="hljs-number">0</span>) <span class="hljs-comment">#  </span><font></font>
<font></font>
len(lines := f.readlines()) <span class="hljs-comment"># </span><font></font>
<font></font>
foo(x := <span class="hljs-number">3</span>, cat=<span class="hljs-string">'vector'</span>) <span class="hljs-comment"># </span><font></font>
<font></font>
foo(cat=category := <span class="hljs-string">'vector'</span>) <span class="hljs-comment"># </span><font></font>
<font></font>
foo(cat=(category := <span class="hljs-string">'vector'</span>)) <span class="hljs-comment">#  </span></code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La plupart des exemples ¬´valides¬ª ci-dessus ne sont pas recommand√©s dans la pratique, car les personnes qui analysent rapidement votre code source peuvent ne pas comprendre correctement sa signification. </font><font style="vertical-align: inherit;">Mais dans des cas simples, cela est autoris√©:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># Valid</span>
<span class="hljs-keyword">if</span> any(len(longline := line) &gt;= <span class="hljs-number">100</span> <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines):<font></font>
    print(<span class="hljs-string">"Extremely long line:"</span>, longline)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce PEP vous recommande de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toujours</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mettre des espaces autour: =, similaire √† la recommandation du PEP 8 pour = pour une affectation classique. </font><font style="vertical-align: inherit;">(La diff√©rence de la derni√®re recommandation est qu'elle interdit les espaces autour de =, qui est utilis√© pour passer des arguments cl√©s √† la fonction.)</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modifiez l'ordre des calculs.</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afin d'avoir une s√©mantique bien d√©finie, cet accord n√©cessite que la proc√©dure d'√©valuation soit clairement d√©finie. </font><font style="vertical-align: inherit;">Techniquement, ce n'est pas une nouvelle exigence. </font><font style="vertical-align: inherit;">Python a d√©j√† une r√®gle selon laquelle les sous-expressions sont g√©n√©ralement √©valu√©es de gauche √† droite. </font><font style="vertical-align: inherit;">Cependant, les expressions d'affectation rendent ces ¬´effets secondaires¬ª plus visibles, et nous proposons un changement dans l'ordre de calcul actuel:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans les g√©n√©rateurs de dictionnaire {X: Y pour ...}, Y est actuellement √©valu√© avant X. Nous sugg√©rons de le changer pour que X soit calcul√© avant Y. (Dans un dict classique tel que {X: Y}, ainsi que dans dict ((X, Y) pour ...) ceci a d√©j√† √©t√© impl√©ment√©. Par cons√©quent, les g√©n√©rateurs de dictionnaire doivent respecter ce m√©canisme)</font></font></li>
</ul><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diff√©rences entre les expressions d'affectation et les instructions d'affectation.</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plus important encore, ": =" est une </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">expression</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ce qui signifie qu'elle peut √™tre utilis√©e dans les cas o√π les </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instructions</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ne </font><b><font style="vertical-align: inherit;">sont</font></b><font style="vertical-align: inherit;"> pas valides, y compris les fonctions lambda et les g√©n√©rateurs. </font><font style="vertical-align: inherit;">Inversement, les </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">expressions d'</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> affectation ne prennent pas en charge la fonctionnalit√© √©tendue qui peut √™tre utilis√©e dans les </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instructions d'</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> affectation:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'affectation en cascade n'est pas prise en charge directement</font></font><br>
<br>
<pre><code class="python hljs">x = y = z = <span class="hljs-number">0</span>  <span class="hljs-comment"># Equivalent: (z := (y := (x := 0)))</span></code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les "cibles" s√©par√©es, √† l'exception du nom de variable simple NAME, ne sont pas prises en charge:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># No equivalent</span><font></font>
a[i] = x<font></font>
self.rest = []</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La fonctionnalit√© et la priorit√© des virgules ¬´autour¬ª diff√®rent:</font></font><br>
<br>
<pre><code class="python hljs">x = <span class="hljs-number">1</span>, <span class="hljs-number">2</span>  <span class="hljs-comment"># Sets x to (1, 2)</span>
(x := <span class="hljs-number">1</span>, <span class="hljs-number">2</span>)  <span class="hljs-comment"># Sets x to 1</span></code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les valeurs de d√©ballage et d'emballage n'ont pas d'√©quivalence ¬´pure¬ª ou ne sont pas du tout prises en charge</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># Equivalent needs extra parentheses</span>
loc = x, y  <span class="hljs-comment"># Use (loc := (x, y))</span>
info = name, phone, *rest  <span class="hljs-comment"># Use (info := (name, phone, *rest))</span><font></font>
<font></font>
<span class="hljs-comment"># No equivalent</span><font></font>
px, py, pz = position<font></font>
name, phone, email, *other_info = contact</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les annotations de type en ligne ne sont pas prises en charge:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># Closest equivalent is "p: Optional[int]" as a separate declaration</span>
p: Optional[int] = <span class="hljs-literal">None</span></code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il n'y a pas d'op√©ration abr√©g√©e:</font></font><br>
<br>
<pre><code class="python hljs">total += tax  <span class="hljs-comment"># Equivalent: (total := total + tax)</span></code></pre></li>
</ul><br>
<a name="cpec"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modifications des sp√©cifications lors de la mise en ≈ìuvre</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les modifications suivantes ont √©t√© apport√©es sur la base de notre exp√©rience et d'une analyse suppl√©mentaire apr√®s la premi√®re r√©daction de ce PEP et avant la sortie de Python 3.8:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour garantir la coh√©rence avec d'autres exceptions similaires et pour ne pas introduire un nouveau nom qui pourrait ne pas convenir aux utilisateurs finaux, la sous-classe initialement propos√©e de TargetScopeError pour SyntaxError a √©t√© supprim√©e et r√©duite √† la SyntaxError habituelle. </font><font style="vertical-align: inherit;">[3]</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En raison des limitations de l'analyse de la table de caract√®res CPython, l'impl√©mentation de r√©f√©rence de l'expression d'affectation d√©clenche une SyntaxError pour toutes les utilisations au sein des it√©rateurs. </font><font style="vertical-align: inherit;">Auparavant, cette exception ne se produisait que si le nom de la variable en cours de cr√©ation co√Øncidait avec celui d√©j√† utilis√© dans l'expression it√©rative. </font><font style="vertical-align: inherit;">Ceci peut √™tre r√©vis√© s'il existe des exemples suffisamment convaincants, mais la complexit√© suppl√©mentaire semble inappropri√©e pour des cas d'utilisation purement ¬´hypoth√©tiques¬ª.</font></font></li>
</ul><br>
<a name="prim"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemples</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemples de biblioth√®ques standard Python</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">site.py</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
env_base est utilis√© uniquement dans une condition, de sorte que l'affectation peut √™tre plac√©e dans if, comme "en-t√™te" d'un bloc logique.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code actuel:</font></font><br>
<pre><code class="python hljs">env_base = os.environ.get(<span class="hljs-string">"PYTHONUSERBASE"</span>, <span class="hljs-literal">None</span>)
<span class="hljs-keyword">if</span> env_base:
    <span class="hljs-keyword">return</span> env_base</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code am√©lior√©:</font></font><br>
<pre><code class="python hljs"><span class="hljs-keyword">if</span> env_base := os.environ.get(<span class="hljs-string">"PYTHONUSERBASE"</span>, <span class="hljs-literal">None</span>):
    <span class="hljs-keyword">return</span> env_base</code></pre></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_pydecimal.py</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez √©viter les if imbriqu√©s, supprimant ainsi un niveau d'indentation.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code actuel:</font></font><br>
<pre><code class="python hljs"><span class="hljs-keyword">if</span> self._is_special:<font></font>
    ans = self._check_nans(context=context)<font></font>
    <span class="hljs-keyword">if</span> ans:
        <span class="hljs-keyword">return</span> ans</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code am√©lior√©:</font></font><br>
<pre><code class="python hljs"><span class="hljs-keyword">if</span> self._is_special <span class="hljs-keyword">and</span> (ans := self._check_nans(context=context)):
    <span class="hljs-keyword">return</span> ans</code></pre></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">copy.py</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code semble plus classique et √©vite √©galement l'imbrication multiple des instructions conditionnelles. </font><font style="vertical-align: inherit;">(Voir l'annexe A pour en savoir plus sur l'origine de cet exemple.)</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code actuel:</font></font><br>
<pre><code class="python hljs">reductor = dispatch_table.get(cls)
<span class="hljs-keyword">if</span> reductor:<font></font>
    rv = reductor(x)<font></font>
<span class="hljs-keyword">else</span>:<font></font>
    reductor = getattr(x, <span class="hljs-string">"__reduce_ex__"</span>, <span class="hljs-literal">None</span>)
    <span class="hljs-keyword">if</span> reductor:<font></font>
        rv = reductor(<span class="hljs-number">4</span>)
    <span class="hljs-keyword">else</span>:<font></font>
        reductor = getattr(x, <span class="hljs-string">"__reduce__"</span>, <span class="hljs-literal">None</span>)
        <span class="hljs-keyword">if</span> reductor:<font></font>
            rv = reductor()<font></font>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">raise</span> Error(
                <span class="hljs-string">"un(deep)copyable object of type %s"</span> % cls)</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code am√©lior√©:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">if</span> reductor := dispatch_table.get(cls):<font></font>
    rv = reductor(x)<font></font>
<span class="hljs-keyword">elif</span> reductor := getattr(x, <span class="hljs-string">"__reduce_ex__"</span>, <span class="hljs-literal">None</span>):<font></font>
    rv = reductor(<span class="hljs-number">4</span>)
<span class="hljs-keyword">elif</span> reductor := getattr(x, <span class="hljs-string">"__reduce__"</span>, <span class="hljs-literal">None</span>):<font></font>
    rv = reductor()<font></font>
<span class="hljs-keyword">else</span>:
    <span class="hljs-keyword">raise</span> Error(<span class="hljs-string">"un(deep)copyable object of type %s"</span> % cls)</code></pre></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">datetime.py</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
tz est utilis√© uniquement pour s + = tz. </font><font style="vertical-align: inherit;">Le d√©placer vers l'int√©rieur permet de montrer sa zone logique d'utilisation.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code actuel:</font></font><br>
<br>
<pre><code class="python hljs">s = _format_time(self._hour, self._minute,<font></font>
                 self._second, self._microsecond,<font></font>
                 timespec)<font></font>
tz = self._tzstr()<font></font>
<span class="hljs-keyword">if</span> tz:<font></font>
    s += tz<font></font>
<span class="hljs-keyword">return</span> s</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code am√©lior√©:</font></font><br>
<br>
<pre><code class="python hljs">s = _format_time(self._hour, self._minute,<font></font>
                 self._second, self._microsecond,<font></font>
                 timespec)<font></font>
<span class="hljs-keyword">if</span> tz := self._tzstr():<font></font>
    s += tz<font></font>
<span class="hljs-keyword">return</span> s</code></pre></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sysconfig.py</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'appel de fp.readline () en tant que ¬´condition¬ª dans la boucle while (ainsi que l'appel de la m√©thode .match ()) dans la condition if rend le code plus compact sans compliquer sa compr√©hension.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code actuel:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<font></font>
    line = fp.readline()<font></font>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> line:
        <span class="hljs-keyword">break</span><font></font>
    m = define_rx.match(line)<font></font>
    <span class="hljs-keyword">if</span> m:<font></font>
        n, v = m.group(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)
        <span class="hljs-keyword">try</span>:<font></font>
            v = int(v)<font></font>
        <span class="hljs-keyword">except</span> ValueError:
            <span class="hljs-keyword">pass</span><font></font>
        vars[n] = v<font></font>
    <span class="hljs-keyword">else</span>:<font></font>
        m = undef_rx.match(line)<font></font>
        <span class="hljs-keyword">if</span> m:<font></font>
            vars[m.group(<span class="hljs-number">1</span>)] = <span class="hljs-number">0</span></code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code am√©lior√©:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">while</span> line := fp.readline():
    <span class="hljs-keyword">if</span> m := define_rx.match(line):<font></font>
        n, v = m.group(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)
        <span class="hljs-keyword">try</span>:<font></font>
            v = int(v)<font></font>
        <span class="hljs-keyword">except</span> ValueError:
            <span class="hljs-keyword">pass</span><font></font>
        vars[n] = v<font></font>
    <span class="hljs-keyword">elif</span> m := undef_rx.match(line):<font></font>
        vars[m.group(<span class="hljs-number">1</span>)] = <span class="hljs-number">0</span></code></pre></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simplifier les g√©n√©rateurs de listes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, le g√©n√©rateur de liste peut √™tre efficacement filtr√© en "capturant" la condition:</font></font><br>
<br>
<pre><code class="python hljs">results = [(x, y, x/y) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> input_data <span class="hljs-keyword">if</span> (y := f(x)) &gt; <span class="hljs-number">0</span>]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s cela, la variable peut √™tre r√©utilis√©e dans une autre expression:</font></font><br>
<br>
<pre><code class="python hljs">stuff = [[y := f(x), x/y] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>)]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veuillez noter √† nouveau que dans les deux cas, la variable </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y a</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> la m√™me port√©e que les variables result et stuff.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Capturer des valeurs dans des conditions</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les expressions d'affectation peuvent √™tre utilis√©es efficacement dans les conditions d'une instruction if ou while:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># Loop-and-a-half</span>
<span class="hljs-keyword">while</span> (command := input(<span class="hljs-string">"&gt; "</span>)) != <span class="hljs-string">"quit"</span>:<font></font>
    print(<span class="hljs-string">"You entered:"</span>, command)<font></font>
<font></font>
<span class="hljs-comment"># Capturing regular expression match objects</span>
<span class="hljs-comment"># See, for instance, Lib/pydoc.py, which uses a multiline spelling</span>
<span class="hljs-comment"># of this effect</span>
<span class="hljs-keyword">if</span> match := re.search(pat, text):<font></font>
    print(<span class="hljs-string">"Found:"</span>, match.group(<span class="hljs-number">0</span>))
<span class="hljs-comment"># The same syntax chains nicely into 'elif' statements, unlike the</span>
<span class="hljs-comment"># equivalent using assignment statements.</span>
<span class="hljs-keyword">elif</span> match := re.search(otherpat, text):<font></font>
    print(<span class="hljs-string">"Alternate found:"</span>, match.group(<span class="hljs-number">0</span>))
<span class="hljs-keyword">elif</span> match := re.search(third, text):<font></font>
    print(<span class="hljs-string">"Fallback found:"</span>, match.group(<span class="hljs-number">0</span>))<font></font>
<font></font>
<span class="hljs-comment"># Reading socket data until an empty string is returned</span>
<span class="hljs-keyword">while</span> data := sock.recv(<span class="hljs-number">8192</span>):<font></font>
    print(<span class="hljs-string">"Received data:"</span>, data)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En particulier, cette approche peut √©liminer la n√©cessit√© de cr√©er une boucle infinie, l'affectation et la v√©rification des conditions. </font><font style="vertical-align: inherit;">Il vous permet √©galement de tracer un parall√®le harmonieux entre un cycle qui utilise un appel de fonction comme condition, ainsi qu'un cycle qui v√©rifie non seulement la condition, mais utilise √©galement la valeur r√©elle renvoy√©e par la fonction √† l'avenir.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fourchette</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un exemple du monde bas niveau d'UNIX: [env. </font><font style="vertical-align: inherit;">Fork () est un appel syst√®me sur les syst√®mes d'exploitation de type Unix qui cr√©e un nouveau sous-processus par rapport au parent.]</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">if</span> pid := os.fork():
    <span class="hljs-comment"># Parent code</span>
<span class="hljs-keyword">else</span>:
    <span class="hljs-comment"># Child code</span></code></pre><br>
<a name="otklon"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alternatives rejet√©es</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En g√©n√©ral, des suggestions similaires sont assez courantes dans la communaut√© python. </font><font style="vertical-align: inherit;">Vous trouverez ci-dessous un certain nombre de syntaxes alternatives pour les expressions d'affectation qui sont trop sp√©cifiques pour √™tre comprises et ont √©t√© rejet√©es en faveur de ce qui pr√©c√®de.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Changer la port√©e des g√©n√©rateurs</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans une version pr√©c√©dente de ce PEP, des modifications subtiles des r√®gles de port√©e pour les g√©n√©rateurs ont √©t√© propos√©es pour les rendre plus utilisables dans la port√©e de classe. </font><font style="vertical-align: inherit;">Cependant, ces propositions entra√Æneraient une incompatibilit√© en amont et ont donc √©t√© rejet√©es. </font><font style="vertical-align: inherit;">Par cons√©quent, ce PEP a pu se concentrer enti√®rement uniquement sur les expressions d'affectation.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Orthographes alternatives</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En g√©n√©ral, les expressions d'affectation propos√©es ont la m√™me s√©mantique, mais sont √©crites diff√©remment.</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXPR comme NOM:</font></font><br>
<br>
<pre><code class="python hljs">stuff = [[f(x) <span class="hljs-keyword">as</span> y, x/y] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>)]</code></pre><br>
   EXPR as NAME       import, except  with,         (,       ).<br>
<br>
( ,  ¬´with EXPR as VAR¬ª     EXPR  VAR,   EXPR.__enter__()        VAR.)<br>
<br>
 ,   ":="   :<br>
<ul>
<li>  ,  <b>if f(x) as y</b>     ,    ‚Äã‚Äã   <b>if f x blah-blah</b>,        <b>if f(x) and y</b>.</li>
<li>   ,  <b>as</b> ,           ,     : <ul>
<li>import foo as bar</li>
<li>except Exc as var</li>
<li>with ctxmgr() as var</li>
</ul><br>
 , <b>as</b>     if  while     ,   <b>as</b>  ¬´ ¬ª   .</li>
<li>  ¬´¬ª  <ul>
<li>NAME = EXPR</li>
<li>if NAME := EXPR</li>
</ul><br>
     .</li>
</ul></li>
<li>EXPR -&gt; NAME<br>
<br>
<pre><code class="python hljs">stuff = [[f(x) -&gt; y, x/y] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>)]</code></pre><br>
     ,  R  Haskell,     . ( ,    - <b>y &lt; ‚Äî f (x) </b>   Python,      -   .)       ¬´as¬ª   ,      import, except  with,      .             Python (    ),      ":=" (   Algol-58)     .</li>
<li>  ¬´¬ª    <br>
<br>
<pre><code class="python hljs">stuff = [[(f(x) <span class="hljs-keyword">as</span> .y), x/.y] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>)] <span class="hljs-comment"># with "as"</span>
stuff = [[(.y := f(x)), x/.y] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>)] <span class="hljs-comment"># with ":="</span></code></pre><br>
         .         Python,        ,   .</li>
<li> where:       :<br>
<br>
<pre><code class="python hljs">value = x**<span class="hljs-number">2</span> + <span class="hljs-number">2</span>*x where:<font></font>
    x = spam(<span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">7</span>, q)</code></pre><br>
   (    ,     ¬´¬ª).      ,   ¬´¬ª  (  with:). . PEP 3150,      (    <i>given:</i> ).</li>
<li>TARGET from EXPR:<br>
<br>
<pre><code class="python hljs">stuff = [[y <span class="hljs-keyword">from</span> f(x), x/y] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>)]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette syntaxe est moins en conflit avec les autres qu'en </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tant que</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (sauf si vous comptez l'augmentation des constructions Exc), mais sinon elle est comparable √† elles. </font><font style="vertical-align: inherit;">Au lieu d'un parall√®le avec avec expr comme cible: (ce qui peut √™tre utile, mais cela peut aussi pr√™ter √† confusion), cette option n'a aucun parall√®le avec quoi que ce soit, mais elle est √©tonnamment mieux m√©moris√©e.</font></font></li>
</ol><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cas particuliers dans les d√©clarations conditionnelles</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'un des cas d'utilisation les plus courants pour les expressions d'affectation est les instructions if et while. </font><font style="vertical-align: inherit;">Au lieu d'une solution plus g√©n√©rale, l'utilisation de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> am√©liore la syntaxe de ces deux instructions en ajoutant un moyen de capturer la valeur √† comparer:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">if</span> re.search(pat, text) <span class="hljs-keyword">as</span> match:<font></font>
    print(<span class="hljs-string">"Found:"</span>, match.group(<span class="hljs-number">0</span>))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela fonctionne bien, mais </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNIQUEMENT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lorsque la condition souhait√©e est bas√©e sur la ¬´justesse¬ª de la valeur de retour. </font><font style="vertical-align: inherit;">Ainsi, cette m√©thode est efficace pour des cas sp√©cifiques (recherche d'expressions r√©guli√®res, lecture de sockets, retour d'une cha√Æne vide √† la fin de l'ex√©cution), et est compl√®tement inutile dans des cas plus complexes (par exemple, lorsque la condition est f (x) &lt;0, et que vous voulez enregistrer la valeur de f (x)). </font><font style="vertical-align: inherit;">En outre, cela n'a aucun sens dans les g√©n√©rateurs de listes. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avantages</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Aucune ambigu√Øt√© syntaxique. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inconv√©nients</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : m√™me si vous ne l'utilisez que dans les instructions if / while, cela ne fonctionne bien que dans certains cas.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cas particuliers dans les g√©n√©rateurs</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un autre cas d'utilisation courant pour les expressions d'affectation est les g√©n√©rateurs (list / set / dict et genexps). </font><font style="vertical-align: inherit;">Comme ci-dessus, des suggestions ont √©t√© faites pour des solutions sp√©cifiques.</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o√π, lou√© ou donn√©:</font></font><br>
<br>
<pre><code class="python hljs">stuff = [(y, x/y) where y = f(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>)]<font></font>
stuff = [(y, x/y) let y = f(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>)]<font></font>
stuff = [(y, x/y) given y = f(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>)]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette m√©thode entra√Æne une sous-expression entre la boucle for et l'expression principale. </font><font style="vertical-align: inherit;">Il introduit √©galement un mot-cl√© de langue suppl√©mentaire, qui peut cr√©er des conflits. </font><font style="vertical-align: inherit;">Des trois options, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o√π</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est la plus propre et la plus lisible, mais des conflits potentiels existent toujours (par exemple, SQLAlchemy et numpy ont leurs m√©thodes where, ainsi que tkinter.dnd.Icon dans la biblioth√®que standard).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec NAME = EXPR:</font></font><br>
<br>
<pre><code class="python hljs">stuff = [(y, x/y) <span class="hljs-keyword">with</span> y = f(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>)]</code></pre><br>
  ,     ,     <b>with</b>.         .   ,           ¬´¬ª  for.    C,         ,    .   : ¬´  ¬´with NAME = EXPR:¬ª       ,   ?¬ª</li>
<li>with EXPR as NAME:<br>
<br>
<pre><code class="python hljs">stuff = [(y, x/y) <span class="hljs-keyword">with</span> f(x) <span class="hljs-keyword">as</span> y <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>)]</code></pre><br>
   ,    <b>as</b>,    .       ,        for.      with          </li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quelle que soit la m√©thode choisie, une nette diff√©rence s√©mantique sera introduite entre les g√©n√©rateurs et leurs versions d√©ploy√©es via une boucle for. </font><font style="vertical-align: inherit;">Il deviendrait impossible d'envelopper un cycle dans un g√©n√©rateur sans traiter l'√©tape de cr√©ation des variables. </font><font style="vertical-align: inherit;">Le seul mot-cl√© qui pourrait √™tre r√©orient√© pour cette t√¢che est le mot </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Mais cela lui donnera une s√©mantique diff√©rente dans diff√©rentes parties du code, ce qui signifie que vous devez cr√©er un nouveau mot-cl√©, mais cela implique beaucoup de co√ªts.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Priorit√© inf√©rieure de l'op√©rateur</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'op√©rateur: = a deux priorit√©s logiques. Ou il doit avoir une priorit√© aussi faible que possible (au m√™me niveau que l'op√©rateur d'affectation). Ou il doit avoir une priorit√© sup√©rieure aux op√©rateurs de comparaison. Placer sa priorit√© entre les op√©rateurs de comparaison et les op√©rations arithm√©tiques (pour √™tre pr√©cis: l√©g√®rement inf√©rieur √† OR au niveau du bit) vous permettra de vous passer de crochets dans la plupart des cas quand et si vous l'utilisez, car il est plus probable que vous souhaitiez conserver la valeur de quelque chose avant comment la comparaison sera effectu√©e dessus:</font></font><br>
<br>
<pre><code class="python hljs">pos = <span class="hljs-number">-1</span>
<span class="hljs-keyword">while</span> pos := buffer.find(search_term, pos + <span class="hljs-number">1</span>) &gt;= <span class="hljs-number">0</span>:<font></font>
    ...</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D√®s que find () renvoie -1, la boucle se termine. </font><font style="vertical-align: inherit;">Si: = lie les op√©randes aussi librement que =, alors le r√©sultat de find () sera d'abord ¬´captur√©¬ª dans l'op√©rateur de comparaison et retournera g√©n√©ralement True ou False, ce qui est moins utile. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien que ce comportement soit pratique en pratique dans de nombreuses situations, il serait plus difficile √† expliquer. </font><font style="vertical-align: inherit;">Et nous pouvons donc dire que "l'op√©rateur: = se comporte de la m√™me mani√®re que l'op√©rateur d'affectation habituel." </font><font style="vertical-align: inherit;">Autrement dit, la priorit√© pour: = a √©t√© s√©lectionn√©e le plus pr√®s possible de l'op√©rateur = (sauf que: = a une priorit√© sup√©rieure √† la virgule).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous donnez des virgules √† droite</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Certains critiques soutiennent que les expressions d'affectation devraient reconna√Ætre les tuples sans ajouter de crochets afin que les deux entr√©es soient √©quivalentes:</font></font><br>
<br>
<pre><code class="python hljs">(point := (x, y))<font></font>
(point := x, y)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(Dans la version actuelle de la norme, le dernier enregistrement sera √©quivalent √† l'expression ((point: = x), y).) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais il est logique que dans ce sc√©nario, lors de l'utilisation de l'expression d'affectation dans l'appel de fonction, il aurait √©galement une priorit√© inf√©rieure √† la virgule, nous avons donc obtenu serait l'√©quivalence d√©routante suivante:</font></font><br>
<br>
<pre><code class="python hljs">foo (x: = <span class="hljs-number">1</span>, y)<font></font>
foo (x: = (<span class="hljs-number">1</span>, y))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et nous obtenons la seule issue moins confuse: faire de l'op√©rateur: = une priorit√© inf√©rieure √† la virgule.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toujours besoin de supports</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il a toujours √©t√© propos√© de mettre entre crochets les expressions d'affectation. </font><font style="vertical-align: inherit;">Cela nous √©viterait bien des ambigu√Øt√©s. </font><font style="vertical-align: inherit;">En effet, des parenth√®ses seront souvent n√©cessaires pour extraire la valeur souhait√©e. </font><font style="vertical-align: inherit;">Mais dans les cas suivants, la pr√©sence de parenth√®ses nous a clairement paru superflue:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># Top level in if</span>
<span class="hljs-keyword">if</span> match := pattern.match(line):
    <span class="hljs-keyword">return</span> match.group(<span class="hljs-number">1</span>)<font></font>
<font></font>
<span class="hljs-comment"># Short call</span>
len(lines := f.readlines())</code></pre><br>
<a name="chast"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objections fr√©quentes</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourquoi ne pas simplement transformer les instructions d'affectation en expressions?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C et les langages similaires d√©finissent l'op√©rateur </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> comme une expression, et non comme une instruction, comme le fait Python. </font><font style="vertical-align: inherit;">Cela permet une affectation dans de nombreuses situations, y compris aux endroits o√π les variables sont compar√©es. </font><font style="vertical-align: inherit;">Les similitudes syntaxiques entre if (x == y) et if (x = y) contredisent leur s√©mantique tr√®s diff√©rente. </font><font style="vertical-align: inherit;">Ainsi, ce PEP introduit l'op√©rateur: = pour clarifier leurs diff√©rences.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourquoi s'emb√™ter avec des </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">expressions d'</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> affectation </font><font style="vertical-align: inherit;">s'il existe des </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instructions d'</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> affectation?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces deux formes ont des flexibilit√©s diff√©rentes. </font><font style="vertical-align: inherit;">L'op√©rateur: = peut √™tre utilis√© dans une expression plus grande, et dans l'op√©rateur = il peut √™tre utilis√© par la "famille des mini-op√©rateurs" de type "+ =". </font><font style="vertical-align: inherit;">Aussi = vous permet d'affecter des valeurs par attributs et index.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourquoi ne pas utiliser la port√©e locale et √©viter la pollution de l'espace de noms?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les versions pr√©c√©dentes de cette norme comprenaient une v√©ritable port√©e locale (limit√©e √† une instruction) pour les expressions d'affectation, emp√™chant la fuite de nom et la pollution de l'espace de nom. </font><font style="vertical-align: inherit;">Malgr√© le fait que dans certaines situations cela a donn√© un certain avantage, dans beaucoup d'autres cela complique la t√¢che, et les avantages ne sont pas justifi√©s par les avantages de l'approche existante. </font><font style="vertical-align: inherit;">Cela se fait dans l'int√©r√™t de la simplicit√© de la langue. </font><font style="vertical-align: inherit;">Vous n'avez plus besoin de cette variable? </font><font style="vertical-align: inherit;">Il existe une solution: supprimez la variable √† l'aide du mot cl√© del ou ajoutez un trait de soulignement inf√©rieur √† son nom. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(L'auteur tient √† remercier Guido van Rossum et Christophe Groth pour leurs suggestions visant √† faire avancer la norme PEP dans cette direction. [2])</font></font><br>
<br>
<a name="rekom"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recommandations de style</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√âtant donn√© que les expressions d'affectation peuvent parfois √™tre utilis√©es sur un pied d'√©galit√© avec un op√©rateur d'affectation, la question se pose, qu'est-ce qui est toujours pr√©f√©r√©? .. Conform√©ment √† d'autres conventions de style (comme PEP 8), il y a deux recommandations:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous pouvez utiliser les deux options d'affectation, privil√©giez les op√©rateurs. </font><font style="vertical-align: inherit;">Ils expriment le plus clairement vos intentions.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si l'utilisation d'expressions d'affectation entra√Æne une ambigu√Øt√© dans l'ordre d'ex√©cution, r√©√©crivez le code √† l'aide de l'op√©rateur classique.</font></font></li>
</ol><br>
<a name="blag"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Merci</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les auteurs de cette norme tiennent √† remercier Nick Coghlan et Steven D'Aprano pour leurs contributions significatives √† ce PEP, ainsi que les membres du Python Core Mentorship pour leur aide dans la mise en ≈ìuvre de celui-ci.</font></font><br>
<br>
<a name="prilA"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Annexe A: Conclusions de Tim Peters</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici un court essai que Tim Peters a √©crit sur ce sujet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je n'aime pas le code "confus", et je n'aime pas non plus mettre la logique sans rapport conceptuel sur une seule ligne. </font><font style="vertical-align: inherit;">Ainsi, par exemple, au lieu de:</font></font><br>
<br>
<pre><code class="python hljs">i = j = count = nerrors = <span class="hljs-number">0</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je pr√©f√®re √©crire:</font></font><br>
<br>
<pre><code class="python hljs">i = j = <span class="hljs-number">0</span>
count = <span class="hljs-number">0</span>
nerrors = <span class="hljs-number">0</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, je pense que je vais trouver plusieurs endroits o√π je veux utiliser des expressions d'affectation. </font><font style="vertical-align: inherit;">Je ne veux m√™me pas parler de leur utilisation dans des expressions qui sont d√©j√† √©tir√©es sur la moiti√© de l'√©cran. </font><font style="vertical-align: inherit;">Dans d'autres cas, des comportements tels que:</font></font><br>
<br>
<pre><code class="python hljs">mylast = mylast[<span class="hljs-number">1</span>]
<span class="hljs-keyword">yield</span> mylast[<span class="hljs-number">0</span>]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beaucoup mieux que cela:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">yield</span> (mylast := mylast[<span class="hljs-number">1</span>])[<span class="hljs-number">0</span>]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces deux codes ont des concepts compl√®tement diff√©rents et les m√©langer serait fou. </font><font style="vertical-align: inherit;">Dans d'autres cas, la combinaison d'expressions logiques rend le code plus difficile √† comprendre. </font><font style="vertical-align: inherit;">Par exemple, r√©√©criture:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<font></font>
    old = total<font></font>
    total += term<font></font>
    <span class="hljs-keyword">if</span> old == total:
        <span class="hljs-keyword">return</span> total<font></font>
    term *= mx2 / (i*(i+<span class="hljs-number">1</span>))<font></font>
    i += <span class="hljs-number">2</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans une forme plus courte, nous avons perdu la ¬´logique¬ª. </font><font style="vertical-align: inherit;">Vous devez comprendre comment ce code fonctionne. </font><font style="vertical-align: inherit;">Mon cerveau ne veut pas faire √ßa:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">while</span> total != (total := total + term):<font></font>
    term *= mx2 / (i*(i+<span class="hljs-number">1</span>))<font></font>
    i += <span class="hljs-number">2</span>
<span class="hljs-keyword">return</span> total</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais de tels cas sont rares. </font><font style="vertical-align: inherit;">La t√¢che de pr√©server le r√©sultat est tr√®s courante et ¬´clairsem√© vaut mieux que dense¬ª ne signifie pas que ¬´presque vide vaut mieux que clairsem√©¬ª [env. </font><font style="vertical-align: inherit;">une r√©f√©rence √† Zen Python]. </font><font style="vertical-align: inherit;">Par exemple, j'ai de nombreuses fonctions qui renvoient None ou 0 pour dire "Je n'ai rien d'utile, mais comme cela se produit souvent, je ne veux pas vous d√©ranger avec des exceptions." </font><font style="vertical-align: inherit;">En fait, ce m√©canisme est √©galement utilis√© dans les expressions r√©guli√®res qui renvoient None lorsqu'il n'y a pas de correspondance. </font><font style="vertical-align: inherit;">Par cons√©quent, dans cet exemple, beaucoup de code:</font></font><br>
<br>
<pre><code class="python hljs">result = solution(xs, n)
<span class="hljs-keyword">if</span> result:
    <span class="hljs-comment"># use result</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je trouve l'option suivante plus compr√©hensible et bien s√ªr plus lisible:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">if</span> result := solution(xs, n):
    <span class="hljs-comment"># use result</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au d√©but, je n'y attachais pas beaucoup d'importance, mais une construction si courte est apparue si souvent qu'elle a rapidement commenc√© √† m'ennuyer que je ne pouvais pas l'utiliser. </font><font style="vertical-align: inherit;">√áa m'a √©tonn√©! </font><font style="vertical-align: inherit;">[environ. </font><font style="vertical-align: inherit;">apparemment, cela a √©t√© √©crit avant la sortie officielle de Python 3.8.] </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a d'autres cas o√π les expressions d'affectation "tirent" vraiment. </font><font style="vertical-align: inherit;">Au lieu de fouiller √† nouveau dans mon code, Kirill Balunov a donn√© un bel exemple de la fonction copy () de la biblioth√®que copy.py standard:</font></font><br>
<br>
<pre><code class="python hljs">reductor = dispatch_table.get(cls)
<span class="hljs-keyword">if</span> reductor:<font></font>
    rv = reductor(x)<font></font>
<span class="hljs-keyword">else</span>:<font></font>
    reductor = getattr(x, <span class="hljs-string">"__reduce_ex__"</span>, <span class="hljs-literal">None</span>)
    <span class="hljs-keyword">if</span> reductor:<font></font>
        rv = reductor(<span class="hljs-number">4</span>)
    <span class="hljs-keyword">else</span>:<font></font>
        reductor = getattr(x, <span class="hljs-string">"__reduce__"</span>, <span class="hljs-literal">None</span>)
        <span class="hljs-keyword">if</span> reductor:<font></font>
            rv = reductor()<font></font>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">raise</span> Error(<span class="hljs-string">"un(shallow)copyable object of type %s"</span> % cls)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'indentation toujours croissante est trompeuse: apr√®s tout, la logique est plate: le premier test r√©ussi ¬´gagne¬ª:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">if</span> reductor := dispatch_table.get(cls):<font></font>
    rv = reductor(x)<font></font>
<span class="hljs-keyword">elif</span> reductor := getattr(x, <span class="hljs-string">"__reduce_ex__"</span>, <span class="hljs-literal">None</span>):<font></font>
    rv = reductor(<span class="hljs-number">4</span>)
<span class="hljs-keyword">elif</span> reductor := getattr(x, <span class="hljs-string">"__reduce__"</span>, <span class="hljs-literal">None</span>):<font></font>
    rv = reductor()<font></font>
<span class="hljs-keyword">else</span>:
    <span class="hljs-keyword">raise</span> Error(<span class="hljs-string">"un(shallow)copyable object of type %s"</span> % cls)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La simple utilisation des expressions d'affectation permet √† la structure visuelle du code de mettre en valeur le ¬´plan¬ª de la logique. </font><font style="vertical-align: inherit;">Mais l'indentation toujours croissante la rend implicite. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici un autre petit exemple de mon code, qui m'a fait tr√®s plaisir car il m'a permis de mettre une logique li√©e en interne sur une seule ligne et de supprimer le niveau d'indentation "artificiel" ennuyeux. </font><font style="vertical-align: inherit;">C'est exactement ce que je veux de l'instruction if et cela facilite la lecture. </font><font style="vertical-align: inherit;">Le code suivant:</font></font><br>
<br>
<pre><code class="python hljs">diff = x - x_base
<span class="hljs-keyword">if</span> diff:<font></font>
    g = gcd(diff, n)<font></font>
    <span class="hljs-keyword">if</span> g &gt; <span class="hljs-number">1</span>:
        <span class="hljs-keyword">return</span> g</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Transform√© en:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">if</span> (diff := x - x_base) <span class="hljs-keyword">and</span> (g := gcd(diff, n)) &gt; <span class="hljs-number">1</span>:
    <span class="hljs-keyword">return</span> g</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, dans la plupart des lignes o√π l'affectation de variable se produit, je n'utiliserais pas d'expressions d'affectation. </font><font style="vertical-align: inherit;">Mais cette conception est si fr√©quente qu'il y a encore de nombreux endroits o√π je saisirais cette opportunit√©. </font><font style="vertical-align: inherit;">Dans les cas les plus r√©cents, j'ai gagn√© un peu, comme ils apparaissaient souvent. </font><font style="vertical-align: inherit;">Dans la sous-partie restante, cela a conduit √† des am√©liorations moyennes ou importantes. </font><font style="vertical-align: inherit;">Ainsi, j'utiliserais des expressions d'affectation beaucoup plus souvent qu'un triple si, mais beaucoup moins souvent qu'une affectation augment√©e [env. </font><font style="vertical-align: inherit;">options courtes: * =, / =, + =, etc.].</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemple num√©rique</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai un autre exemple qui m'a frapp√© plus t√¥t. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si toutes les variables sont des entiers positifs et que la variable </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a est</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sup√©rieure √† la ni√®me racine de x, alors cet algorithme renvoie l'arrondi ¬´inf√©rieur¬ª de la ni√®me racine de x (et double approximativement le nombre de bits exacts par it√©ration):</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">while</span> a &gt; (d := x // a**(n<span class="hljs-number">-1</span>)):<font></font>
    a = ((n<span class="hljs-number">-1</span>)*a + d) // n
<span class="hljs-keyword">return</span> a</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On ne sait pas pourquoi, mais une telle variante de l'algorithme est moins √©vidente qu'une boucle infinie avec une rupture de branche conditionnelle (boucle et demie). Il est √©galement difficile de prouver l'exactitude de cette impl√©mentation sans s'appuyer sur un √©nonc√© math√©matique (¬´moyenne arithm√©tique - in√©galit√© moyenne g√©om√©trique¬ª) et ne pas savoir certaines choses non triviales sur la fa√ßon dont les fonctions d'arrondi imbriqu√©es se comportent vers le bas. Mais ici, le probl√®me est d√©j√† en math√©matiques et non en programmation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et si vous savez tout cela, alors l'option utilisant des expressions d'affectation est lue tr√®s facilement, comme une simple phrase: "V√©rifiez la" supposition "actuelle et si elle est trop grande, r√©duisez-la" et la condition vous permet d'enregistrer imm√©diatement la valeur interm√©diaire de la condition de boucle. √Ä mon avis, la forme classique est plus difficile √† comprendre:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<font></font>
    d = x // a**(n<span class="hljs-number">-1</span>)
    <span class="hljs-keyword">if</span> a &lt;= d:
        <span class="hljs-keyword">break</span>
    a = ((n<span class="hljs-number">-1</span>)*a + d) // n
<span class="hljs-keyword">return</span> a</code></pre><br>
<a name="prilB"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Annexe B: Un interpr√©teur de code approximatif pour les g√©n√©rateurs</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette annexe tente de clarifier (sans pr√©ciser) les r√®gles selon lesquelles une variable doit √™tre cr√©√©e dans les expressions de g√©n√©rateur. </font><font style="vertical-align: inherit;">Pour un certain nombre d'exemples illustratifs, nous montrons le code source o√π le g√©n√©rateur est remplac√© par une fonction √©quivalente en combinaison avec certains ¬´√©chafaudages¬ª. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puisque [x pour ...] est √©quivalent √† list (x pour ...), les exemples ne perdent pas leur g√©n√©ralit√©. </font><font style="vertical-align: inherit;">Et comme ces exemples ne visent qu'√† clarifier les r√®gles g√©n√©rales, ils ne pr√©tendent pas √™tre r√©alistes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Remarque: les g√©n√©rateurs sont d√©sormais impl√©ment√©s par la cr√©ation de fonctions g√©n√©ratrices imbriqu√©es (similaires √† celles donn√©es dans cette annexe). </font><font style="vertical-align: inherit;">Les exemples montrent la nouvelle partie, qui ajoute la fonctionnalit√© appropri√©e pour travailler avec la port√©e des expressions d'affectation (telle que la port√©e comme si l'affectation √©tait effectu√©e dans un bloc contenant le g√©n√©rateur le plus externe). </font><font style="vertical-align: inherit;">Pour simplifier l '¬´inf√©rence de type¬ª, ces exemples illustratifs ne prennent pas en compte le fait que les expressions d'affectation sont facultatives (mais elles prennent en compte la port√©e de la variable cr√©√©e √† l'int√©rieur du g√©n√©rateur). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rappelons d'abord quel code est g√©n√©r√© ¬´sous le capot¬ª pour les g√©n√©rateurs sans expressions d'affectation:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code source (EXPR utilise le plus souvent la variable VAR):</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">f</span>():</span>
    a = [EXPR <span class="hljs-keyword">for</span> VAR <span class="hljs-keyword">in</span> ITERABLE]</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le code converti (ne nous inqui√©tons pas des conflits de noms):</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">f</span>():</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">genexpr</span>(<span class="hljs-params">iterator</span>):</span>
        <span class="hljs-keyword">for</span> VAR <span class="hljs-keyword">in</span> iterator:
            <span class="hljs-keyword">yield</span> EXPR<font></font>
    a = list(genexpr(iter(ITERABLE)))</code></pre></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ajoutons une expression d'affectation simple.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La source:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">f</span>():</span>
    a = [TARGET := EXPR <span class="hljs-keyword">for</span> VAR <span class="hljs-keyword">in</span> ITERABLE]
</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code converti:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">f</span>():</span>
    <span class="hljs-keyword">if</span> <span class="hljs-literal">False</span>:<font></font>
        TARGET = <span class="hljs-literal">None</span>  <span class="hljs-comment"># Dead code to ensure TARGET is a local variable</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">genexpr</span>(<span class="hljs-params">iterator</span>):</span>
        <span class="hljs-keyword">nonlocal</span> TARGET
        <span class="hljs-keyword">for</span> VAR <span class="hljs-keyword">in</span> iterator:<font></font>
            TARGET = EXPR<font></font>
            <span class="hljs-keyword">yield</span> TARGET<font></font>
    a = list(genexpr(iter(ITERABLE)))</code></pre></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ajoutons maintenant l'instruction TARGET globale √† la d√©claration de la fonction f ().</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La source:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">f</span>():</span>
    <span class="hljs-keyword">global</span> TARGET<font></font>
    a = [TARGET := EXPR <span class="hljs-keyword">for</span> VAR <span class="hljs-keyword">in</span> ITERABLE]
</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code converti:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">f</span>():</span>
    <span class="hljs-keyword">global</span> TARGET
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">genexpr</span>(<span class="hljs-params">iterator</span>):</span>
        <span class="hljs-keyword">global</span> TARGET
        <span class="hljs-keyword">for</span> VAR <span class="hljs-keyword">in</span> iterator:<font></font>
            TARGET = EXPR<font></font>
            <span class="hljs-keyword">yield</span> TARGET<font></font>
    a = list(genexpr(iter(ITERABLE)))</code></pre></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou vice versa, ajoutons TARGET non local √† la d√©claration de la fonction f ().</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La source:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">g</span>():</span><font></font>
    TARGET = ...<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">f</span>():</span>
        <span class="hljs-keyword">nonlocal</span> TARGET<font></font>
        a = [TARGET := EXPR <span class="hljs-keyword">for</span> VAR <span class="hljs-keyword">in</span> ITERABLE]
</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code converti:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">g</span>():</span><font></font>
    TARGET = ...<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">f</span>():</span>
        <span class="hljs-keyword">nonlocal</span> TARGET
        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">genexpr</span>(<span class="hljs-params">iterator</span>):</span>
            <span class="hljs-keyword">nonlocal</span> TARGET
            <span class="hljs-keyword">for</span> VAR <span class="hljs-keyword">in</span> iterator:<font></font>
                TARGET = EXPR<font></font>
                <span class="hljs-keyword">yield</span> TARGET<font></font>
        a = list(genexpr(iter(ITERABLE)))</code></pre></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enfin, mettons deux g√©n√©rateurs.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La source:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">f</span>():</span>
    a = [[TARGET := i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">3</span>)] <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>)]
    <span class="hljs-comment"># I.e., a = [[0, 1, 2], [0, 1, 2]]</span>
    print(TARGET)  <span class="hljs-comment"># prints 2</span>
</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code converti:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">f</span>():</span>
    <span class="hljs-keyword">if</span> <span class="hljs-literal">False</span>:<font></font>
        TARGET = <span class="hljs-literal">None</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">outer_genexpr</span>(<span class="hljs-params">outer_iterator</span>):</span>
        <span class="hljs-keyword">nonlocal</span> TARGET
        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">inner_generator</span>(<span class="hljs-params">inner_iterator</span>):</span>
            <span class="hljs-keyword">nonlocal</span> TARGET
            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> inner_iterator:<font></font>
                TARGET = i<font></font>
                <span class="hljs-keyword">yield</span> i
        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> outer_iterator:
            <span class="hljs-keyword">yield</span> list(inner_generator(range(<span class="hljs-number">3</span>)))<font></font>
    a = list(outer_genexpr(range(<span class="hljs-number">2</span>)))<font></font>
    print(TARGET)</code></pre></li>
</ul><br>
<a name="prilC"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Annexe C: Aucun changement dans la s√©mantique de la port√©e</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notez qu'en Python, la s√©mantique des port√©es n'a pas chang√©. </font><font style="vertical-align: inherit;">L'√©tendue des fonctions locales est toujours d√©termin√©e au moment de la compilation et a une dur√©e ind√©finie au moment de l'ex√©cution (fermeture). </font><font style="vertical-align: inherit;">Exemple:</font></font><br>
<br>
<pre><code class="python hljs">a = <span class="hljs-number">42</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">f</span>():</span>
    <span class="hljs-comment"># `a` is local to `f`, but remains unbound</span>
    <span class="hljs-comment"># until the caller executes this genexp:</span>
    <span class="hljs-keyword">yield</span> ((a := i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">3</span>))
    <span class="hljs-keyword">yield</span> <span class="hljs-keyword">lambda</span>: a + <span class="hljs-number">100</span>
    print(<span class="hljs-string">"done"</span>)
    <span class="hljs-keyword">try</span>:<font></font>
        print(<span class="hljs-string">f"`a` is bound to <span class="hljs-subst">{a}</span>"</span>)
        <span class="hljs-keyword">assert</span> <span class="hljs-literal">False</span>
    <span class="hljs-keyword">except</span> UnboundLocalError:<font></font>
        print(<span class="hljs-string">"`a` is not yet bound"</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alors:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-meta">&gt;&gt;&gt; </span>results = list(f()) <span class="hljs-comment"># [genexp, lambda]</span><font></font>
done<font></font>
`a` <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> yet bound
<span class="hljs-comment"># The execution frame for f no longer exists in CPython,</span>
<span class="hljs-comment"># but f's locals live so long as they can still be referenced.</span>
<span class="hljs-meta">&gt;&gt;&gt; </span>list(map(type, results))<font></font>
[&lt;<span class="hljs-class"><span class="hljs-keyword">class</span> '<span class="hljs-title">generator</span>'&gt;, &lt;<span class="hljs-title">class</span> '<span class="hljs-title">function</span>'&gt;]
&gt;&gt;&gt; <span class="hljs-title">list</span>(<span class="hljs-params">results[<span class="hljs-number">0</span>]</span>)
[0, 1, 2]
&gt;&gt;&gt; <span class="hljs-title">results</span>[1]()
102
&gt;&gt;&gt; <span class="hljs-title">a</span>
42</span></code></pre><br>
<a name="ssilki"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©f√©rences</font></font></h2><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mise en ≈ìuvre de la preuve de concept</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Discussion de la s√©mantique des expressions d'affectation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (VPN est serr√© mais charg√©)</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Discussion de TargetScopeError dans PEP 572</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (charg√© de mani√®re similaire √† la pr√©c√©dente)</font></font></li>
</ol><br>
<a name="avtori"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">droits d'auteur</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce document a √©t√© rendu public. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Source: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/python/peps/blob/master/pep-0572.rst</font></font></a><br>
<br>
<a name="my"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ma partie</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour commencer, r√©sumons:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour que les </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gens n'essaient pas</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de supprimer la dualit√© s√©mantique, dans de nombreux endroits ¬´classiques¬ª o√π vous pouvez utiliser √† la fois ¬´=¬ª et ¬´: =¬ª, il y a des restrictions, donc l'op√©rateur :: = doit souvent √™tre plac√© entre crochets. </font><font style="vertical-align: inherit;">Ces cas devront √™tre examin√©s dans la section </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©crivant l'utilisation de base.</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La priorit√© des expressions d'affectation est l√©g√®rement sup√©rieure √† celle d'une virgule. </font><font style="vertical-align: inherit;">Pour cette raison, les tuples ne sont pas form√©s pendant l'affectation. </font><font style="vertical-align: inherit;">Il permet √©galement d'utiliser l'op√©rateur: = lors du passage d'arguments √† une fonction.</font></font></li>
<li> ,   ,    ,    .       .    lambda    ,    ¬´¬ª  .</li>
<li>        :   ,     </li>
<li>      ,   .</li>
<li>          /  .</li>
<li>   ,      .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au final, je tiens √† dire que j'ai aim√© le nouvel op√©rateur. </font><font style="vertical-align: inherit;">Il vous permet d'√©crire du code plus plat dans des conditions, de ¬´filtrer¬ª les listes, et aussi (enfin) de supprimer la ¬´m√™me¬ª ligne solitaire avant if. </font><font style="vertical-align: inherit;">Si les gens utilisent des expressions d'affectation pour leur objectif, ce sera un outil tr√®s pratique qui augmentera la lisibilit√© et la beaut√© du code (bien que cela puisse √™tre dit √† propos de n'importe quel langage fonctionnel ...)</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr499654/index.html">Comment impl√©menter CRM sur un site distant et gagner?</a></li>
<li><a href="../fr499656/index.html">Simulation de r√©gulateur de temp√©rature PID</a></li>
<li><a href="../fr499658/index.html">Un ouvrier au lieu d'un testeur? Vaut-il la peine d'√©tudier le s√©l√©nium en 2020?</a></li>
<li><a href="../fr499662/index.html">Racine de confiance pour l'IoT et les autres tendances de s√©curit√© IoT</a></li>
<li><a href="../fr499664/index.html">Portage d'API vers TypeScript comme solutionneur de probl√®mes</a></li>
<li><a href="../fr499668/index.html">D√©pendances JavaScript de Road to Hell</a></li>
<li><a href="../fr499670/index.html">–Ø –ø–µ—Ä–µ—Ö–æ–∂—É –Ω–∞ JavaScript</a></li>
<li><a href="../fr499674/index.html">Une autre √©tape vers les ordinateurs optiques</a></li>
<li><a href="../fr499676/index.html">Plus de 90 outils utiles pour Kubernetes: d√©ploiement, gestion, surveillance, s√©curit√© et plus</a></li>
<li><a href="../fr499680/index.html">Learning Kubernetes: Basic 14-16 May, Advanced 18-20 May</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>