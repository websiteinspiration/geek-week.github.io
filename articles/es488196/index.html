<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïê üë®üèº‚Äç‚úàÔ∏è üë∏üèª Inserciones de Android: lidiar con los miedos y prepararse para Android Q üë∑üèº üë©üèø‚Äçü§ù‚Äçüë©üèº üêô</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Android Q es la d√©cima versi√≥n de Android con API nivel 29. Una de las ideas principales de la nueva versi√≥n es el concepto de borde a borde, cuando l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Inserciones de Android: lidiar con los miedos y prepararse para Android Q</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/488196/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android Q es la d√©cima versi√≥n de Android con API nivel 29. </font><font style="vertical-align: inherit;">Una de las ideas principales de la nueva versi√≥n es el concepto de borde a borde, cuando las aplicaciones ocupan toda la pantalla, de abajo hacia arriba. </font><font style="vertical-align: inherit;">Esto significa que la barra de estado y la barra de navegaci√≥n deben ser transparentes. </font><font style="vertical-align: inherit;">Pero, si son transparentes, entonces no hay una interfaz de usuario del sistema: se superpone a los componentes interactivos de la aplicaci√≥n. </font><font style="vertical-align: inherit;">Este problema se resuelve con inserciones. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los desarrolladores m√≥viles evitan las inserciones, les causan miedo. </font><font style="vertical-align: inherit;">Pero en Android Q no ser√° posible evitar las inserciones: tendr√° que estudiarlas y aplicarlas. </font><font style="vertical-align: inherit;">De hecho, las inserciones no tienen nada de complicado: muestran qu√© elementos de la pantalla se cruzan con la interfaz del sistema y sugieren c√≥mo mover el elemento para que no entre en conflicto con la interfaz de usuario del sistema. </font><strong><font style="vertical-align: inherit;">Konstantin Tskhovrebov</font></strong><font style="vertical-align: inherit;"> contar√° sobre c√≥mo funcionan los insertos y c√≥mo son √∫tiles</font></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/6Djql74drwk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konstantin Tskhovrebov</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">terrakok</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) funciona en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redmadrobot</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ha estado involucrado en Android durante 10 a√±os y ha acumulado mucha experiencia en varios proyectos en los que no hab√≠a lugar para las inserciones, siempre lograron moverse de alguna manera. </font><font style="vertical-align: inherit;">Konstantin contar√° sobre una larga historia de evitar el problema de las inserciones, sobre estudiar y luchar contra Android. </font><font style="vertical-align: inherit;">Considerar√° las tareas t√≠picas de su experiencia en las que se podr√≠an aplicar inserciones, y mostrar√° c√≥mo dejar de temer al teclado, reconocer su tama√±o y responder a la apariencia. </font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota. </font><font style="vertical-align: inherit;">El art√≠culo fue escrito en base a un informe de Konstantin en </font></font></em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saint AppsConf 2019</font></font></em></a><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">El informe utiliz√≥ materiales de varios art√≠culos sobre inserciones. </font><font style="vertical-align: inherit;">Enlace a estos materiales al final.</font></font></em><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tareas t√≠picas</font></font></h2><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Barra de estado de color. </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En muchos proyectos, el dise√±ador dibuja una barra de estado de color. </font><font style="vertical-align: inherit;">Se puso de moda cuando lleg√≥ Android 5 junto con el nuevo Material Design. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9l/ii/76/9lii76jdfrbb5i0vq8-ecv2ikby.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øC√≥mo pintar la barra de estado? </font><font style="vertical-align: inherit;">Elemental: agrega </font></font><code>colorPrimaryDark</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y el color se sustituye.</font></font><br>
<br>
<pre><code class="kotlin hljs"> &lt;style name=<span class="hljs-string">"AppTheme"</span> parent=<span class="hljs-string">"Theme.AppCompat.Light.NoActionBar"</span>&gt;<font></font>
    ...<font></font>
    &lt;item name=<span class="hljs-string">"colorPrimaryDark"</span>&gt;<span class="hljs-meta">@color</span>/colorAccent&lt;/item&gt;<font></font>
    ...<font></font>
&lt;/style&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para Android por encima de la quinta versi√≥n (API de 21 y superior), puede establecer par√°metros especiales en el tema:</font></font><br>
<br>
<pre><code class="kotlin hljs">&lt;style name=<span class="hljs-string">"AppTheme"</span> parent=<span class="hljs-string">"Theme.AppCompat.Light.NoActionBar"</span>&gt;<font></font>
    ...<font></font>
    &lt;item name=<span class="hljs-string">"android:statusBarColor"</span>&gt;<span class="hljs-meta">@color</span>/colorAccent&lt;/item&gt;<font></font>
    ...<font></font>
&lt;/style&gt;</code></pre><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Barra de estado multicolor</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">A veces, los dise√±adores en diferentes pantallas dibujan la barra de estado en diferentes colores. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uo/ev/nl/uoevnldknz2rtfq5lcqpn1mpj4g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Est√° bien, la forma m√°s f√°cil de trabajar es con </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diferentes temas en diferentes actividades</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La forma m√°s interesante es cambiar los colores </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">directamente en tiempo de ejecuci√≥n</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreateView</span><span class="hljs-params">(...)</span></span>: View {<font></font>
    requireActivity().window.statusBarColor = requireContext().getColor(R.color.colorPrimary)<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El par√°metro se cambia a trav√©s de una bandera especial. </font><font style="vertical-align: inherit;">Pero lo principal es no olvidar cambiar el color cuando el usuario vuelve a salir de la pantalla. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Barra de estado transparente. </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esto es mas dificil. </font><font style="vertical-align: inherit;">La mayor√≠a de las veces, la transparencia est√° asociada con los mapas, porque es en los mapas donde se ve mejor la transparencia. </font><font style="vertical-align: inherit;">En este caso, como antes, establecemos un par√°metro especial:</font></font><br>
<br>
<pre><code class="kotlin hljs">&lt;style name=<span class="hljs-string">"AppTheme"</span> parent=<span class="hljs-string">"Theme.AppCompat.Light.NoActionBar"</span>&gt;    <font></font>
    ...<font></font>
    &lt;item name=<span class="hljs-string">"android:windowTranslucentStatus"</span>&gt;<span class="hljs-literal">true</span>&lt;/item&gt;<font></font>
    ...<font></font>
&lt;/style&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠, por supuesto, hay un truco bien conocido: sangrar m√°s alto, de lo contrario, la barra de estado se superpondr√° en el √≠cono y ser√° fea.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/49/8f/c8/498fc8wuip6i-o4eutfnviumuio.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero en otras pantallas todo se rompe. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/if/-0/0q/if-00qq6b7zidoz-_nfyehlev7s.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øComo resolver el problema? El primer m√©todo que viene a la mente son las diferentes actividades: tenemos diferentes temas, diferentes par√°metros, funcionan de manera diferente. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabaja con el teclado.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Evitamos las inserciones no solo con la barra de estado, sino tambi√©n cuando trabajamos con el teclado. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/s-/jk/mz/s-jkmzxzi-5xqr1ei0ku6pfubpy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A nadie le gusta la opci√≥n de la izquierda, pero para convertirla en una opci√≥n de la derecha, hay una soluci√≥n simple.</font></font><br>
<br>
<pre><code class="kotlin hljs">&lt;activity<font></font>
    ...<font></font>
    android:windowSoftInputMode=<span class="hljs-string">"adjustResize"</span>&gt;<font></font>
    ...<font></font>
&lt;/activity&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La actividad ahora puede cambiar de tama√±o cuando aparece el teclado. Funciona de manera simple y severa. Pero no olvides otro truco: envuelve todo </font></font><code>ScrollView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. De repente, el teclado ocupar√° toda la pantalla y habr√° una peque√±a franja en la parte superior. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay momentos m√°s dif√≠ciles cuando queremos cambiar el dise√±o cuando aparece el teclado. Por ejemplo, organice los botones u oculte el logotipo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/q3/ia/zl/q3iazltlnajt-cpvdzc0u2i8zcs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entrenamos tantas muletas con un teclado y una barra de estado transparente, ahora es dif√≠cil detenernos. Vaya a StackOverflow y copie el hermoso c√≥digo.</font></font><br>
<br>
<pre><code class="kotlin hljs">boolean isOpened = <span class="hljs-literal">false</span>;<font></font>
<font></font>
<span class="hljs-keyword">public</span> void setListenerToRootView() {
    <span class="hljs-keyword">final</span> View activityRootView = getWindow().getDecorView().findViewById(android.R.id.content);<font></font>
    activityRootView.getViewTreeObserver().addOnGlobalLayoutListener(new OnGlobalLayoutListener() {<font></font>
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> void onGlobalLayout() {<font></font>
    <font></font>
            int heightDiff = activityRootView.getRootView().getHeight() - activityRootView.getHeight();      <font></font>
            <span class="hljs-keyword">if</span> (heightDiff &gt; <span class="hljs-number">100</span>) { <span class="hljs-comment">// 99% of the time the height diff will be due to a keyboard.       </span>
                Toast.makeText(getApplicationContext(), <span class="hljs-string">"Gotcha!!! softKeyboardup"</span>, <span class="hljs-number">0</span>).show();<font></font>
<font></font>
                <span class="hljs-keyword">if</span> (isOpened == <span class="hljs-literal">false</span>) {
                   <span class="hljs-comment">//Do two things, make the view top visible and the editText smaller</span><font></font>
                }<font></font>
                isOpened = <span class="hljs-literal">true</span>;<font></font>
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isOpened == <span class="hljs-literal">true</span>) {<font></font>
                Toast.makeText(getApplicationContext(), <span class="hljs-string">"softkeyborad Down!!!"</span>, <span class="hljs-number">0</span>).show();<font></font>
                isOpened = <span class="hljs-literal">false</span>;<font></font>
            }    <font></font>
        }<font></font>
    });<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Incluso calcul√≥ la probabilidad de que aparezca un teclado. </font><font style="vertical-align: inherit;">El c√≥digo funciona, incluso en uno de los proyectos lo usamos, pero durante mucho tiempo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muchas muletas en los ejemplos est√°n asociadas con el uso de diferentes actividades. </font><font style="vertical-align: inherit;">Pero son malos no solo porque son muletas, sino tambi√©n por otras razones: el problema del "arranque en fr√≠o", la asincron√≠a. </font><font style="vertical-align: inherit;">Describ√≠ los problemas con m√°s detalle en el art√≠culo " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Licencia para conducir un autom√≥vil, o por qu√© las aplicaciones deber√≠an ser de actividad √∫nica</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". </font><font style="vertical-align: inherit;">Adem√°s, la documentaci√≥n de Google indica que el enfoque recomendado es una aplicaci√≥n de Actividad √∫nica.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øQu√© hicimos antes de Android 10?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nosotros (en Redmadrobot) estamos desarrollando aplicaciones de bastante alta calidad, pero hemos evitado las inserciones durante mucho tiempo. ¬øC√≥mo logramos evitarlos sin muletas grandes y en una sola actividad? </font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota. Capturas de pantalla y c√≥digo tomados de mi proyecto de mascota </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitFox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Imagina la pantalla de la aplicaci√≥n. Cuando desarrollamos nuestras aplicaciones, nunca pensamos que podr√≠a haber una barra de navegaci√≥n transparente a continuaci√≥n. ¬øHay una barra negra debajo? Y qu√©, los usuarios est√°n acostumbrados. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ce/ab/6v/ceab6v6m5dqnbl9zpotdi1vqmre.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la parte superior, inicialmente establecemos el par√°metro de que la barra de estado es negra con transparencia. ¬øC√≥mo se ve en t√©rminos de dise√±o y c√≥digo?</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0g/tu/of/0gtuoffisoeudtgxlnmqd-jicnk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La abstracci√≥n en la figura: el bloque rojo es la actividad de la aplicaci√≥n, el azul es el fragmento con el bot de navegaci√≥n (con pesta√±as), y dentro de √©l se cambian los fragmentos verdes con el contenido. Se puede ver que la barra de herramientas no est√° debajo de la barra de estado. ¬øC√≥mo logramos esto? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Android tiene una bandera dif√≠cil </font></font><code>fitSystemWindow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Si lo establece en verdadero, el contenedor agregar√° relleno para s√≠ mismo para que nada dentro de √©l caiga bajo la barra de estado. Creo que esta bandera es la muleta oficial de Google para aquellos que tienen miedo a las inserciones. Usar todo funcionar√° relativamente bien sin inserciones. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La bandera </font></font><code>FitSystemWindow=‚Äùtrue‚Äù</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">agrega relleno al contenedor que especific√≥. Pero la jerarqu√≠a es importante: si uno de los padres establece este indicador en "verdadero", entonces su distribuci√≥n no se tendr√° en cuenta, porque el contenedor ya ha aplicado la sangr√≠a.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La bandera funciona, pero aparece otro problema. </font><font style="vertical-align: inherit;">Imagine una pantalla con dos pesta√±as. </font><font style="vertical-align: inherit;">Al cambiar, se inicia una transacci√≥n, que causa un </font></font><code>replace</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fragmento uno sobre otro, y todo se rompe. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lv/02/_u/lv02_ui9sepxlvi7djz_xpem2sy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El segundo fragmento tambi√©n tiene un conjunto de banderas </font></font><code>FitSystemWindow=‚Äùtrue‚Äù</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, y esto no deber√≠a suceder. </font><font style="vertical-align: inherit;">Pero qu√© pas√≥, ¬øpor qu√©? </font><font style="vertical-align: inherit;">La respuesta es que esto es una muleta, y a veces no funciona. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero encontramos una soluci√≥n en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stack Overflow</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : use root para no fragmentos </font></font><code>FrameLayout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, sino </font></font><code>CoordinatorLayout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Fue creado para otros fines, pero funciona aqu√≠.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por que funciona</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veamos en la fuente lo que est√° sucediendo en </font></font><code>CoordinatorLayout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> void onAttachedToWindow() {   
    <span class="hljs-keyword">super</span>.onAttachedToWindow();<font></font>
    ...    <font></font>
    <span class="hljs-keyword">if</span> (mLastInsets == <span class="hljs-literal">null</span> &amp;&amp; ViewCompat.getFitsSystemWindows(<span class="hljs-keyword">this</span>)) {         
        <span class="hljs-comment">// We're set to fitSystemWindows but we haven't had any insets yet...</span>
        <span class="hljs-comment">// We should request a new dispatch of window insets</span>
        ViewCompat.requestApplyInsets(<span class="hljs-keyword">this</span>);<font></font>
    }     <font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vemos un hermoso comentario de que aqu√≠ se necesitan inserciones, pero no lo son. </font><font style="vertical-align: inherit;">Necesitamos volver a preguntarles cuando solicitamos una ventana. </font><font style="vertical-align: inherit;">Descubrimos que las inserciones de alguna manera funcionan dentro, pero no queremos trabajar con ellas e irnos </font></font><code>Coordinator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la primavera de 2019, desarrollamos la aplicaci√≥n, momento en el que Google I / O acaba de pasar. </font><font style="vertical-align: inherit;">Todav√≠a no hemos resuelto todo, as√≠ que seguimos aferr√°ndonos a los prejuicios. </font><font style="vertical-align: inherit;">Pero notamos que cambiar las pesta√±as en la parte inferior es de alguna manera lento, porque tenemos un dise√±o complejo, cargado con la interfaz de usuario. </font><font style="vertical-align: inherit;">Encontramos una manera simple de resolver esto: cambie </font></font><code>replace</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para </font></font><code>show/hide</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que cada vez que no vuelva a crear el dise√±o.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hx/7l/vz/hx7lvzsl8-kfv3qqac2pbvllt8q.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cambiamos, y de nuevo nada funciona, ¬°todo se ha roto! </font><font style="vertical-align: inherit;">Aparentemente no es posible esparcir muletas, debes entender por qu√© funcionaron. </font><font style="vertical-align: inherit;">Estudiamos el c√≥digo y resulta que cualquier ViewGroup tambi√©n puede trabajar con inserciones.</font></font><br>
<br>
<pre><code class="kotlin hljs">
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> WindowInsets dispatchApplyWindowInsets(WindowInsets insets) {    <font></font>
    insets = <span class="hljs-keyword">super</span>.dispatchApplyWindowInsets(insets);     
    <span class="hljs-keyword">if</span> (!insets.isConsumed()) {         
        <span class="hljs-keyword">final</span> int count = getChildCount();        
        <span class="hljs-keyword">for</span> (int i = <span class="hljs-number">0</span>; i &lt; count; i++) {<font></font>
            insets = getChildAt(i).dispatchApplyWindowInsets(insets);             <font></font>
            <span class="hljs-keyword">if</span> (insets.isConsumed()) {          
                <span class="hljs-keyword">break</span>;<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> insets;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existe una l√≥gica de este tipo: si al menos alguien ya ha procesado inserciones, todas las vistas posteriores dentro del ViewGroup no las recibir√°n. </font><font style="vertical-align: inherit;">¬øQu√© significa esto para nosotros? </font><font style="vertical-align: inherit;">D√©jame mostrarte un ejemplo de nuestro FrameLayout, que cambia las pesta√±as. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/h1/fo/nn/h1fonnc4qrqpmj_x-fc8m47ptci.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dentro hay el primer fragmento que tiene la bandera establecida </font></font><code>fitSystemWindow=‚Äùtrue‚Äù</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Esto significa que el primer fragmento procesa las inserciones. </font><font style="vertical-align: inherit;">Despu√©s de eso, llamamos al </font></font><code>HIDE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">primer fragmento y al </font></font><code>SHOW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">segundo. </font><font style="vertical-align: inherit;">Pero el primero permanece en el dise√±o: su vista se deja, solo oculta. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El contenedor pasa por su Vista: toma el primer fragmento, le da insertos, y de √©l </font></font><code>fitSystemWindow=‚Äùtrue‚Äù</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, los tom√≥ y los proces√≥. </font><font style="vertical-align: inherit;">Perfectamente, FrameLayout parec√≠a que los insertos fueron procesados, y no se lo dio al segundo fragmento. </font><font style="vertical-align: inherit;">Todo funciona como deberia. </font><font style="vertical-align: inherit;">Pero esto no nos conviene, ¬øqu√© debemos hacer?</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escribimos nuestro propio ViewGroup</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Venimos de Java, y hay POO en todo su esplendor, as√≠ que decidimos heredar. </font><font style="vertical-align: inherit;">Escribimos nuestro propio ViewGroup, desde el cual redefinimos el m√©todo </font></font><code>dispatchApplyWindowInsets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Funciona de la manera que lo necesitamos: siempre devuelve a los ni√±os las inserciones que vinieron, independientemente de si las procesamos o no.</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WindowInsetFrameLayout</span> <span class="hljs-meta">@JvmOverloads</span> <span class="hljs-keyword">constructor</span></span>(<font></font>
    context: Context,      <font></font>
    attrs: AttributeSet? = <span class="hljs-literal">null</span>,     <font></font>
    defStyleRes: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span><font></font>
) : FrameLayout(context, attrs, defStyleRes) {<font></font>
<font></font>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">dispatchApplyWindowInsets</span><span class="hljs-params">(insets: <span class="hljs-type">WindowInsets</span>)</span></span>: WindowInsets { 
        <span class="hljs-keyword">for</span> (child <span class="hljs-keyword">in</span> (<span class="hljs-number">0</span> until childCount)) {<font></font>
            getChildAt(child).dispatchApplyWindowInsets(insets)<font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> insets.consumeSystemWindowInsets()<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Custom ViewGroup funciona, el proyecto tambi√©n es todo lo que necesitamos. </font><font style="vertical-align: inherit;">Pero a√∫n no llega a una soluci√≥n general. </font><font style="vertical-align: inherit;">Cuando descubrimos lo que nos dijeron en Google IO, nos dimos cuenta de que ya no podremos actuar as√≠.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android 10</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Android 10 nos mostr√≥ dos conceptos importantes de IU a los que se recomienda cumplir estrictamente: borde a borde y navegaci√≥n gestual. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Borde a borde.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Este </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">concepto</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sugiere que el contenido de la aplicaci√≥n deber√≠a ocupar </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">todo el espacio posible</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en la pantalla. Para nosotros, como desarrolladores, esto significa que las aplicaciones deben colocarse </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bajo los paneles del sistema de la barra de estado y la barra de navegaci√≥n.</font></font></strong><br>
<br>
<img src="https://habrastorage.org/webt/cr/gl/nh/crglnh9iw__fu4lct0gavaibqey.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Anteriormente, de alguna manera pod√≠amos ignorar esto o colocarnos solo debajo de la Barra de estado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cuanto a las listas, deben desplazarse no solo hasta el √∫ltimo elemento, sino tambi√©n m√°s all√° </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para no permanecer debajo de la barra de navegaci√≥n.</font></font></strong><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/tl/pl/it/tlplit1o65rn55edkixuuojxtha.png" width="350"></div><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Navegaci√≥n gestual. </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este segundo concepto importante es la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">navegaci√≥n por gestos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Le permite controlar la aplicaci√≥n con los dedos desde el borde de la pantalla. </font><font style="vertical-align: inherit;">El modo de gestos no es est√°ndar, todo parece diferente, pero ahora no puede cambiar entre dos barras de navegaci√≥n diferentes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este momento, nos dimos cuenta de que no todo es tan simple. </font><font style="vertical-align: inherit;">No ser√° posible evitar m√°s inserciones si queremos desarrollar aplicaciones de calidad. </font><font style="vertical-align: inherit;">Es hora de estudiar la documentaci√≥n y comprender qu√© son los insertos.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inserciones </font><font style="vertical-align: inherit;">¬øQu√© necesitas saber sobre ellos?</font></font></h2><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las inserciones fueron creadas para asustar a los desarrolladores.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lo han estado haciendo perfectamente desde el momento en que apareci√≥ en Android 5. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por supuesto, no todo es tan aterrador. El concepto de insertos es simple: </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">informan una superposici√≥n de IU del sistema en la pantalla de la aplicaci√≥n.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Puede ser una barra de navegaci√≥n, una barra de estado o un teclado. El teclado tambi√©n es una interfaz de usuario del sistema normal, que se superpone en la parte superior de la aplicaci√≥n. No es necesario tratar de procesarlo con muletas, solo insertos. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El objetivo de las inserciones es resolver conflictos</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Por ejemplo, si hay otro elemento sobre nuestro bot√≥n, podemos mover el bot√≥n para que el usuario pueda continuar usando la aplicaci√≥n. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para manejar la inserci√≥n,</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> use </font></font><code>Windowlnsets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para Android 10 y </font></font><code>WindowInsetsCompat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para otras versiones. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay </font><strong><font style="vertical-align: inherit;">5 tipos diferentes de inserciones</font></strong><font style="vertical-align: inherit;"> en Android 10</font></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y un "bono", que se llama no insertado, sino de otro modo. </font><font style="vertical-align: inherit;">Nos ocuparemos de todos los tipos, porque la mayor√≠a solo sabe una cosa: Inserciones de ventanas del sistema.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sistema de ventanas</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Introducido en Android 5.0 (API 21). </font><font style="vertical-align: inherit;">Obtenido por el m√©todo </font></font><code>getSystemWindowInsets()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este es el tipo principal de inserciones con las que necesita aprender a trabajar, porque el resto funciona de la misma manera. </font><font style="vertical-align: inherit;">Son necesarios para procesar la barra de estado, en primer lugar, y luego la barra de navegaci√≥n y el teclado. </font><font style="vertical-align: inherit;">Por ejemplo, resuelven un problema cuando la barra de navegaci√≥n est√° por encima de la aplicaci√≥n. </font><font style="vertical-align: inherit;">Como en la imagen: el bot√≥n permaneci√≥ debajo de la barra de navegaci√≥n, el usuario no puede hacer clic en √©l y est√° muy descontento.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/nx/yj/tt/nxyjttdppbkrnrnqkspovzp4hko.png" width="350"></div><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inserciones de elementos que se pueden tocar</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apareci√≥ solo en Android 10. Obtenido por el m√©todo </font></font><code>getTappableElementInsets()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estas inserciones </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">solo</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> son √∫tiles </font><strong><font style="vertical-align: inherit;">para manejar varios modos de barra de navegaci√≥n</font></strong><font style="vertical-align: inherit;"> . Como dice el propio </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chris Bane</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , puede olvidarse de este tipo de inserciones y moverse solo por los recuadros de ventana del sistema. Pero si desea que la aplicaci√≥n sea 100% fresca, no 99.9% fresca, debe usarla. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mira la foto. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rl/yd/fk/rlydfkwy39pfrc7jfhizhqdkg0q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la parte superior, el color carmes√≠ indica los recuadros de la ventana del sistema, que vendr√°n en diferentes modos de la barra de navegaci√≥n. Se puede ver que a la derecha y a la izquierda son iguales a la barra de navegaci√≥n.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recuerde c√≥mo funciona la navegaci√≥n por gestos: en el modo correcto, nunca hacemos clic en un nuevo panel, sino que siempre arrastramos los dedos de abajo hacia arriba. </font><font style="vertical-align: inherit;">Esto significa que los botones no se pueden quitar. </font><font style="vertical-align: inherit;">Podemos continuar presionando nuestro bot√≥n FAB (bot√≥n de acci√≥n flotante), nadie interferir√°. </font><font style="vertical-align: inherit;">Por lo tanto, </font></font><code>TappableElementInsets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quedar√° vac√≠o porque no es necesario mover FAB. </font><font style="vertical-align: inherit;">Pero si nos movemos un poco m√°s arriba, est√° bien. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La diferencia aparece solo con la navegaci√≥n por gestos y la barra de navegaci√≥n transparente</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (adaptaci√≥n de color). </font><font style="vertical-align: inherit;">Esta no es una situaci√≥n muy agradable. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zv/ei/qz/zveiqz33n9dc290ib9yhrrjl09u.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo funcionar√°, pero se ve desagradable. </font><font style="vertical-align: inherit;">El usuario puede confundirse por la proximidad de los elementos. </font><font style="vertical-align: inherit;">Se puede explicar que uno es para gestos y el otro para presionar, pero a√∫n no es hermoso. </font><font style="vertical-align: inherit;">Por lo tanto, eleve el FAB m√°s alto o d√©jelo a la derecha.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inserciones gestuales del sistema</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apareci√≥ solo en Android 10. Obtenido por el m√©todo </font></font><code>getSystemGestureInsets()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estas inserciones est√°n relacionadas con la navegaci√≥n por gestos. Inicialmente, se supon√≠a que la IU del sistema se dibuja sobre la aplicaci√≥n, pero las Inserciones de gestos del sistema dicen que no se dibuja la IU, sino que el sistema mismo maneja los gestos. Describen d√≥nde el sistema manejar√° los gestos por defecto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las √°reas de estas inserciones son aproximadamente las marcadas en amarillo en el diagrama. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vv/8d/jl/vv8djlgxe4cnjchozbllrysagd0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero quiero advertirte: no siempre ser√°n as√≠. Nunca sabremos qu√© pantallas nuevas se le ocurrir√°n a Samsung y otros fabricantes. Ya hay dispositivos en los que la pantalla est√° en todos los lados. Quiz√°s las inserciones no estar√°n donde esperamos en absoluto. Por lo tanto, debe trabajar con ellos como con alguna abstracci√≥n: existen inserciones en los recuadros de gestos del sistema en los que el sistema mismo procesa los gestos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estas inserciones pueden ser anuladas. </font><font style="vertical-align: inherit;">Por ejemplo, est√° desarrollando un editor de fotos. </font><font style="vertical-align: inherit;">En algunos lugares, usted mismo quiere manejar los gestos, incluso si est√°n cerca del borde de la pantalla. </font><font style="vertical-align: inherit;">Indique al sistema que procesar√° el punto en la pantalla en la esquina de la foto usted mismo. </font><font style="vertical-align: inherit;">Se puede redefinir dici√©ndole al sistema: "Yo mismo siempre procesar√© el cuadrado alrededor del punto".</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inserciones obligatorias de gestos del sistema</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apareci√≥ solo en Android 10. Este es un subtipo de Inserciones de gestos del sistema, pero la aplicaci√≥n no puede anularlas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usamos el m√©todo </font></font><code>getMandatorySystemGestureInsets()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para determinar el √°rea donde no funcionar√°n. </font><font style="vertical-align: inherit;">Esto se hizo intencionalmente para que fuera imposible desarrollar una aplicaci√≥n "desesperada": redefinir el gesto de navegaci√≥n de abajo hacia arriba, lo que le permite salir de la aplicaci√≥n a la pantalla principal. </font><font style="vertical-align: inherit;">Aqu√≠, el </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sistema siempre procesa los gestos en s√≠</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/89/gl/df/89gldfknoq8z9dje_naytwp0pti.png" width="450"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No necesariamente estar√° en la parte inferior del dispositivo y no necesariamente de este tama√±o. </font><font style="vertical-align: inherit;">Trabaja con √©l como una abstracci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estos eran relativamente nuevos tipos de insertos. </font><font style="vertical-align: inherit;">Pero hay aquellos que aparecieron incluso antes de Android 5 y se llamaron de manera diferente.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Insertos estables</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Introducido con Android 5.0 (API 21). Obtenido por el m√©todo </font></font><code>getStableInsets()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Incluso los desarrolladores experimentados no siempre pueden decir por qu√© son necesarios. Te dir√© un secreto: estas inserciones solo son √∫tiles para aplicaciones de pantalla completa: reproductores de video, juegos. Por ejemplo, en el modo de reproducci√≥n, cualquier interfaz de usuario del sistema est√° oculta, incluida la barra de estado, que se mueve m√°s all√° del borde de la pantalla. Pero vale la pena tocar la pantalla ya que la barra de estado aparece en la parte superior. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si coloca cualquier bot√≥n "ATR√ÅS" en la parte superior de la pantalla, mientras procesa correctamente los recuadros de la ventana del sistema, entonces con cada pesta√±a aparece una IU en la parte superior de la pantalla, y el bot√≥n salta hacia abajo. Si no toca la pantalla durante un tiempo, la barra de estado desaparece, el bot√≥n se activa porque los recuadros de la ventana del sistema han desaparecido.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para tales casos, los recuadros estables son perfectos. </font><font style="vertical-align: inherit;">Dicen que ahora no se dibuja ning√∫n elemento en su aplicaci√≥n, pero puede hacerlo. </font><font style="vertical-align: inherit;">Con estas inserciones, puede conocer de antemano el valor de la barra de estado en este modo, por ejemplo, y colocar el bot√≥n donde desee. </font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota. </font><font style="vertical-align: inherit;">El m√©todo </font></font></em><code><em>getStableInsets()</em></code><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apareci√≥ solo con API 21. Anteriormente, hab√≠a varios m√©todos para cada lado de la pantalla.&nbsp;</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Examinamos 5 tipos de insertos, pero hay uno m√°s que no se aplica a los insertos directamente. </font><font style="vertical-align: inherit;">Ayuda a lidiar con flequillo y recortes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flequillo y escotes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las pantallas ya no son cuadradas. </font><font style="vertical-align: inherit;">Son oblongos, con uno o m√°s recortes para la c√°mara y golpes en todos los lados. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ls/kv/sc/lskvscp_j-hy2gesyynicb346cq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hasta 28 API no pudimos procesarlos. </font><font style="vertical-align: inherit;">Tuve que adivinar a trav√©s de las inserciones lo que estaba sucediendo all√≠. </font><font style="vertical-align: inherit;">Pero con la API 28 y m√°s all√° (desde el Android anterior), la clase apareci√≥ oficialmente </font></font><code>DisplayCutout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Est√° en las mismas inserciones de donde puede obtener todos los otros tipos. </font><font style="vertical-align: inherit;">La clase le permite averiguar la ubicaci√≥n y el tama√±o de los artefactos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s de la informaci√≥n de ubicaci√≥n, se proporciona un conjunto de indicadores y para el desarrollador </font></font><code>WindowManager.LayoutParams</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Le permiten incluir diferentes comportamientos en torno a los recortes. </font><font style="vertical-align: inherit;">Su contenido puede mostrarse a su alrededor, o puede no mostrarse: en modo horizontal y vertical de diferentes maneras. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Banderas</font></font><code>window.attributes.layoutInDisplayCutoutMode =</code><br>
<br>
<ul>
<li><code>LAYOUT_IN_DISPLAY_CUTOUT_MODE_DEFAULT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">En vertical, hay, y en horizontal, una barra negra por defecto.</font></font></li>
<li><code>LAYOUT_IN_DISPLAY_CUTOUT_MODE_NEVER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Para nada, una franja negra.</font></font></li>
<li><code>LAYOUT_IN_DISPLAY_CUTOUT_MODE_SHORT_EDGES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - siempre lo es.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La pantalla se puede controlar, pero trabajamos con ellos de la misma manera que con cualquier otro recuadro.</font></font><br>
<br>
<pre><code class="kotlin hljs">insets.displayCutout<font></font>
    .boundingRects<font></font>
    .forEach { rect -&gt; ... }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La devoluci√≥n de llamada con inserciones con una matriz nos llega </font></font><code>displayCutout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Luego podemos ejecutarlo, procesar todos los recortes y explosiones que se encuentran en la aplicaci√≥n. </font><font style="vertical-align: inherit;">Puede obtener m√°s informaci√≥n sobre c√≥mo trabajar con ellos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en el art√≠culo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entendido con 6 tipos de inserciones. </font><font style="vertical-align: inherit;">Ahora hablemos de c√≥mo funciona.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥mo funciona</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se necesitan inserciones, en primer lugar, cuando se dibuja algo en la parte superior de la aplicaci√≥n, por ejemplo, la barra de navegaci√≥n. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ft/ct/_w/ftct_wh_dc64t9rw6ir_7zpqg8m.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sin inserciones, la aplicaci√≥n no tendr√° una barra de navegaci√≥n y una barra de estado transparentes. </font><font style="vertical-align: inherit;">No te sorprendas de no venir </font></font><code>SystemWindowInsets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, esto sucede.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Separar inserciones</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toda la jerarqu√≠a de la interfaz de usuario se parece a un √°rbol con una vista en sus extremos. </font><font style="vertical-align: inherit;">Los nodos suelen ser un ViewGroup. </font><font style="vertical-align: inherit;">Tambi√©n heredan de View, por lo que las inserciones les llegan de una manera especial </font></font><code>dispatchApplyWindowInsets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">A partir de la Vista ra√≠z, el sistema env√≠a inserciones en todo el √°rbol. </font><font style="vertical-align: inherit;">Veamos c√≥mo funciona Ver en este caso.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/jy/rw/hk/jyrwhkavrimytpqs4je0ltfn7-w.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El sistema recurre al m√©todo </font></font><code>dispatchApplyWindowInsets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">por el cual entran las inserciones. </font><font style="vertical-align: inherit;">Volver esta vista deber√≠a devolver algo. </font><font style="vertical-align: inherit;">¬øQu√© hacer para manejar este comportamiento? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por simplicidad, solo consideramos WindowInsets.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Manejo de insertos</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En primer lugar, la redefinici√≥n del m√©todo </font></font><code>dispatchApplyWindowInsets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y la implementaci√≥n dentro de su propia l√≥gica </font><font style="vertical-align: inherit;">parece l√≥gica </font><font style="vertical-align: inherit;">: llegaron las inserciones, implementamos todo dentro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si abre la clase Ver y mira el Javadoc escrito sobre este m√©todo, puede ver: "¬°No anule este m√©todo!"</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Manejamos Insets a trav√©s de delegaci√≥n o herencia.</font></font></blockquote><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usar delegaci√≥n</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Google brind√≥ la oportunidad de exponer a su propio delegado, quien es responsable del manejo de las inserciones. </font><font style="vertical-align: inherit;">Puede instalarlo a trav√©s del m√©todo </font></font><code>setOnApplyWindowInsetsListener(listener)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Establecemos una devoluci√≥n de llamada que maneja estas inserciones. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si por alguna raz√≥n esto no nos conviene, puede </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">heredar de Ver y anular otro m√©todo</font></font></strong> <code>onApplyWindowInsets(WindowInsets insets)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Sustituimos nuestras propias inserciones. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Google no eligi√≥ entre delegaci√≥n y herencia, pero permiti√≥ hacer todo junto. </font><font style="vertical-align: inherit;">Esto es genial porque no tenemos que redefinir todas las barras de herramientas o ListView para manejar las inserciones. </font><font style="vertical-align: inherit;">Podemos tomar cualquier Vista ya preparada, incluso una de biblioteca, y establecer el delegado all√≠, que manejar√° las inserciones sin redefinir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øQu√© devolveremos?</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øPor qu√© devolver algo?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para hacer esto, debe comprender c√≥mo funciona la distribuci√≥n de inserciones, es decir, ViewGroup. </font><font style="vertical-align: inherit;">¬øQu√© est√° haciendo ella dentro de s√≠ misma? </font><font style="vertical-align: inherit;">Echemos un vistazo m√°s de cerca al comportamiento predeterminado usando el ejemplo que mostr√© anteriormente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las inserciones del sistema llegaron en la parte superior e inferior, por ejemplo, 100 p√≠xeles cada una. </font><font style="vertical-align: inherit;">ViewGroup los env√≠a a la primera vista que tiene. </font><font style="vertical-align: inherit;">Esta vista los manej√≥ de alguna manera y devuelve inserciones: en la parte superior disminuye a 0, pero en la parte inferior se va. </font><font style="vertical-align: inherit;">En la parte superior, agreg√≥ relleno o margen, pero en la parte inferior no toc√≥ e inform√≥ sobre esto. </font><font style="vertical-align: inherit;">A continuaci√≥n, ViewGroup pasa inserciones a la segunda vista. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tj/-a/rw/tj-arwxjkus-n6xnvl099lqbqqg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La siguiente Vista procesa y renderiza inserciones. </font><font style="vertical-align: inherit;">Ahora ViewGroup ve que las inserciones se procesan tanto arriba como abajo: no queda nada, todos los par√°metros son cero. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La tercera Vista ni siquiera sabe que hubo algunas inserciones y que algo estaba sucediendo</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ViewGroup devolver√° las inserciones a quien las expuso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando comenzamos a tratar este tema, escribimos la idea por nosotros mismos: siempre devolvemos las mismas inserciones que vinieron. </font><font style="vertical-align: inherit;">Quer√≠amos evitar tal situaci√≥n cuando alguna Vista ni siquiera reconoc√≠a que hab√≠a inserciones. </font><font style="vertical-align: inherit;">La idea parec√≠a l√≥gica. </font><font style="vertical-align: inherit;">Pero result√≥ que no. </font><font style="vertical-align: inherit;">Google no ha agregado en vano el comportamiento a las inserciones, como en el ejemplo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto es necesario para que las inserciones siempre lleguen a la jerarqu√≠a completa de la Vista y siempre pueda trabajar con ellas. </font><font style="vertical-align: inherit;">En este caso, no habr√° situaci√≥n cuando cambiemos dos fragmentos, uno ha procesado y el segundo a√∫n no ha recibido. </font><font style="vertical-align: inherit;">En la secci√≥n de pr√°ctica, volveremos a este punto.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pr√°ctica</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La teor√≠a est√° hecha. </font><font style="vertical-align: inherit;">Veamos c√≥mo se ve en el c√≥digo, porque en teor√≠a todo siempre es fluido. </font><font style="vertical-align: inherit;">Usaremos AndroidX. </font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota. </font><font style="vertical-align: inherit;">En </font></font></em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitFox,</font></font></em></a><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> todo ya est√° implementado en el c√≥digo, soporte completo para todos los extras del nuevo Android. </font><font style="vertical-align: inherit;">Para no verificar las versiones de Android y no buscar el tipo requerido de Insets, use siempre la </font></font></em><code><em>view.setOnApplyWindowInsetsListener { v, insets -&gt; ... }</em></code><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">versi√≥n de AndroidX </font></font></em><code><em>ViewCompat.setOnApplyWindowInsetsListener(view) { v, insets -&gt; ... }</em></code><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay una pantalla con una barra de navegaci√≥n oscura. </font><font style="vertical-align: inherit;">No se superpone a ning√∫n elemento en la parte superior. </font><font style="vertical-align: inherit;">Todo es como estamos acostumbrados.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/3r/wq/sp/3rwqspgcdlgie2m00lmedkwzgi8.png" width="350"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero resulta que ahora tenemos que hacerlo transparente. </font><font style="vertical-align: inherit;">¬øC√≥mo?</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Activar transparencia</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo m√°s simple es indicar en el tema que la barra de estado y la barra de navegaci√≥n son transparentes.</font></font><br>
<br>
<pre><code class="kotlin hljs">&lt;style name=<span class="hljs-string">"AppTheme"</span> parent=<span class="hljs-string">"Theme.MaterialComponents.Light"</span>&gt;<font></font>
    &lt;item name=<span class="hljs-string">"android:windowTranslucentStatus"</span>&gt;<span class="hljs-literal">true</span>&lt;/item&gt;<font></font>
    &lt;item name=<span class="hljs-string">"android:windowTranslucentNavigation"</span>&gt;<span class="hljs-literal">true</span>&lt;/item&gt;<font></font>
&lt;/style&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este momento, todo comienza a superponerse tanto desde arriba como desde abajo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Curiosamente, hay dos banderas, y siempre hay tres opciones: si especifica la transparencia para la barra de navegaci√≥n, la barra de estado se volver√° transparente por s√≠ misma, tal limitaci√≥n. </font><font style="vertical-align: inherit;">No puedes escribir la primera l√≠nea, pero siempre me encanta la claridad, as√≠ que escribo 2 l√≠neas para que los seguidores puedan entender lo que est√° sucediendo y no profundizar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si elige este m√©todo, la barra de navegaci√≥n y la barra de estado se volver√°n negras con transparencia. </font><font style="vertical-align: inherit;">Si la aplicaci√≥n es blanca, puede agregar colores solo desde el c√≥digo. </font><font style="vertical-align: inherit;">¬øC√≥mo hacerlo?</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Activa la transparencia con color</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es bueno que tengamos una aplicaci√≥n de Actividad √∫nica, por lo que ponemos dos banderas en una actividad.</font></font><br>
<br>
<pre><code class="kotlin hljs">rootView.systemUiVisibility = View.SYSTEM_UI_FLAG_LAYOUT_STABLE or  <font></font>
    View.SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION<font></font>
<font></font>
&lt;style name=<span class="hljs-string">"AppTheme"</span> parent=<span class="hljs-string">"Theme.MaterialComponents.Light"</span>&gt;<font></font>
    &lt;!-- Set the navigation bar to <span class="hljs-number">50</span>% translucent white --&gt;<font></font>
    &lt;item name=<span class="hljs-string">"android:navigationBarColor"</span>&gt;#<span class="hljs-number">80F</span>FFFFF&lt;/item&gt; <font></font>
&lt;/style&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay muchas banderas all√≠, pero son estas dos las que ayudar√°n a hacer transparencia en la Barra de navegaci√≥n y la Barra de estado. </font><font style="vertical-align: inherit;">El color se puede especificar a trav√©s del tema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este es el comportamiento extra√±o de Android: algo a trav√©s del tema y algo a trav√©s de las banderas. </font><font style="vertical-align: inherit;">Pero podemos especificar par√°metros tanto en el c√≥digo como en el tema. </font><font style="vertical-align: inherit;">Esto no es tan malo para Android, solo en versiones anteriores de Android se ignorar√° la bandera especificada en el tema. </font></font><code>navigationBarColor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Destacar√° que en Android 5 esto no es as√≠, pero todo se unir√°. </font><font style="vertical-align: inherit;">En GitFox, fue desde el c√≥digo que configur√© el color de la barra de navegaci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Realizamos fraudes: indicamos que la barra de navegaci√≥n es blanca con transparencia. </font><font style="vertical-align: inherit;">Ahora la aplicaci√≥n se ve as√≠.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/eo/vs/mz/eovsmz1tczlc9vl_kg2yihxs0u0.png" width="350"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øQu√© podr√≠a ser m√°s f√°cil que manipular insertos?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De hecho, primaria.</font></font><br>
<br>
<pre><code class="kotlin hljs">ViewCompat<font></font>
    .setOnApplyWindowInsetsListener(bottomNav) { view, insets -&gt;  <font></font>
        view.updatePadding(bottom = insets.systemWindowInsetBottom) <font></font>
        insets<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tomamos el m√©todo </font></font><code>setOnApplyWindowInsetsListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y se lo pasamos </font></font><code>bottomNav</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Decimos que cuando vienen las inserciones, instale el relleno inferior que entr√≥ </font></font><code>systemWindowInsetBottom</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Lo queremos debajo, pero todos nuestros elementos en los que se puede hacer clic est√°n en la parte superior. </font><font style="vertical-align: inherit;">Devolvemos las inserciones completas para que todas las dem√°s Vistas de nuestra jerarqu√≠a tambi√©n las reciban. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo se ve genial.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/zl/8e/ku/zl8ekuc_pvpc2wrmeop-khxmomg.png" width="350"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero hay una trampa. </font><font style="vertical-align: inherit;">Si en el dise√±o indicamos alg√∫n tipo de relleno en la barra de navegaci√≥n a continuaci√≥n, entonces aqu√≠ se elimin√≥: establezca las </font></font><code>updatePadding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inserciones iguales. </font><font style="vertical-align: inherit;">Nuestro dise√±o no se ve como nos gustar√≠a. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para guardar los valores del dise√±o, primero debe guardar lo que est√° en el relleno inferior. </font><font style="vertical-align: inherit;">M√°s tarde, cuando lleguen las inserciones, agregue y establezca los valores resultantes.</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">val</span> bottomNavBottomPadding = bottomNav.paddingBottom<font></font>
ViewCompat<font></font>
    .setOnApplyWindowInsetsListener(bottomNav) { view, insets -&gt;                 <font></font>
        view.updatePadding(<font></font>
        bottom = bottomNavBottomPadding + insets.systemWindowInsetBottom<font></font>
    )<font></font>
    Insets<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es un inconveniente escribir de esta manera: en todas partes del c√≥digo donde usa inserciones, debe guardar el valor del dise√±o y luego agregarlo a la interfaz de usuario. </font><font style="vertical-align: inherit;">Pero est√° Kotlin, y esto es maravilloso: puede escribir su propia extensi√≥n, que har√° todo esto por nosotros.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A√±adir Kotlin!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo recordamos </font></font><code>initialPadding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y se lo damos al manejador cuando aparecen nuevos insertos (junto con ellos). </font><font style="vertical-align: inherit;">Esto los ayudar√° de alguna manera a agregar o construir alg√∫n tipo de l√≥gica desde arriba.</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword">fun</span> View.<span class="hljs-title">doOnApplyWindowInsets</span><span class="hljs-params">(block: (<span class="hljs-type">View</span>, <span class="hljs-type">WindowInsetsCompat</span>, <span class="hljs-type">Rect</span>) -&gt; <span class="hljs-type">WindowInsetsCompat</span>)</span></span> {    <font></font>
<font></font>
    <span class="hljs-keyword">val</span> initialPadding = recordInitialPaddingForView(<span class="hljs-keyword">this</span>)<font></font>
<font></font>
    ViewCompat.setOnApplyWindowInsetsListener(<span class="hljs-keyword">this</span>) { v, insets -&gt;        <font></font>
        block(v, insets, initialPadding)<font></font>
    }<font></font>
    <font></font>
    requestApplyInsetsWhenAttached()<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">recordInitialPaddingForView</span><span class="hljs-params">(view: <span class="hljs-type">View</span>)</span></span> =<font></font>
   Rect(view.paddingLeft, view.paddingTop, view.paddingRight, view.paddingBottom)<font></font>
<font></font>
  .<font></font>
<font></font>
bottomNav.doOnApplyWindowInsets { view, insets, padding -&gt;   <font></font>
    view.updatePadding(<font></font>
        bottom = padding.bottom + insets.systemWindowInsetBottom<font></font>
    ) <font></font>
    insets<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tenemos que redefinir la lambda. </font><font style="vertical-align: inherit;">No solo tiene inserciones, sino tambi√©n acolchados. </font><font style="vertical-align: inherit;">Podemos agregarlos no solo desde abajo, sino tambi√©n desde arriba, si se trata de una barra de herramientas que procesa la barra de estado.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algo olvidado!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay un llamado a un m√©todo incomprensible.</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword">fun</span> View.<span class="hljs-title">doOnApplyWindowInsets</span><span class="hljs-params">(block: (<span class="hljs-type">View</span>, <span class="hljs-type">WindowInsetsCompat</span>, <span class="hljs-type">Rect</span>) -&gt; <span class="hljs-type">WindowInsetsCompat</span>)</span></span> {<font></font>
<font></font>
    <span class="hljs-keyword">val</span> initialPadding = recordInitialPaddingForView(<span class="hljs-keyword">this</span>)<font></font>
     <font></font>
    ViewCompat.setOnApplyWindowInsetsListener(<span class="hljs-keyword">this</span>) { v, insets -&gt;        <font></font>
        block(v, insets, initialPadding)<font></font>
    }<font></font>
      <font></font>
    requestApplyInsetsWhenAttached() <font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">recordInitialPaddingForView</span><span class="hljs-params">(view: <span class="hljs-type">View</span>)</span></span> =<font></font>
      Rect(view.paddingLeft, view.paddingTop, view.paddingRight, view.paddingBottom)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto se debe al hecho de que no puedes esperar que el sistema te env√≠e inserciones. </font><font style="vertical-align: inherit;">Si creamos una Vista desde el c√≥digo o la instalamos un </font></font><code>InsetsListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">poco m√°s tarde, el sistema en s√≠ mismo puede no pasar el √∫ltimo valor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Debemos verificar que cuando la Vista est√© en la pantalla, le hayamos dicho al sistema: "Los recuadros han llegado, queremos procesarlos". </font><font style="vertical-align: inherit;">Configuramos el oyente y debemos hacer una solicitud </font></font><code>requestsApplyInsets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">".</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword">fun</span> View.<span class="hljs-title">requestApplyInsetsWhenAttached</span><span class="hljs-params">()</span></span> {    
    <span class="hljs-keyword">if</span> (isAttachedToWindow) {        <font></font>
        requestApplyInsets()<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
        addOnAttachStateChangeListener(<span class="hljs-keyword">object</span> : View.OnAttachStateChangeListener {            
            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onViewAttachedToWindow</span><span class="hljs-params">(v: <span class="hljs-type">View</span>)</span></span> {<font></font>
                v.removeOnAttachStateChangeListener(<span class="hljs-keyword">this</span>)<font></font>
                v.requestApplyInsets()           <font></font>
            }<font></font>
<font></font>
            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onViewDetachedFromWindow</span><span class="hljs-params">(v: <span class="hljs-type">View</span>)</span></span> = <span class="hljs-built_in">Unit</span><font></font>
        })<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si creamos un c√≥digo de Vista y a√∫n no lo hemos adjuntado a nuestro dise√±o, entonces debemos suscribirnos al momento en que lo hacemos. </font><font style="vertical-align: inherit;">Solo entonces solicitamos inserciones. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero, de nuevo, est√° Kotlin: escribieron una extensi√≥n simple y ya no tenemos que pensar en eso.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Refinar RecyclerView</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora hablemos de finalizar RecyclerView. El √∫ltimo elemento se encuentra debajo de la barra de navegaci√≥n y permanece debajo, feo. Tambi√©n es inconveniente hacer clic en √©l. Si este no es un panel nuevo, sino el antiguo, uno grande, entonces, en general, todo el elemento puede desaparecer debajo de √©l. ¬øQu√© hacer? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jc/qa/f7/jcqaf7okahkrhrrnols54exqhdu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La primera idea es agregar un elemento a continuaci√≥n y establecer la altura para encajar en las inserciones. Pero si tenemos una aplicaci√≥n con cientos de listas, entonces de alguna manera tendremos que suscribir cada lista a inserciones, agregar un nuevo elemento all√≠ y establecer la altura. Adem√°s, RecyclerView es as√≠ncrono, no se sabe cu√°ndo funcionar√°. Hay muchos problemas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero hay otro truco oficial. Sorprendentemente, funciona de manera eficiente.</font></font><br>
<br>
<pre><code class="kotlin hljs">&lt;androidx.recyclerview.widget.RecyclerView <font></font>
        android:id=<span class="hljs-string">"@+id/recyclerView"</span>        
    android:layout_width=<span class="hljs-string">"match_parent"</span>    
    android:layout_height=<span class="hljs-string">"match_parent"</span>             
    android:clipToPadding=<span class="hljs-string">"false"</span> /&gt;<font></font>
<font></font>
recyclerView.doOnApplyWindowInsets { view, insets, padding -&gt;    <font></font>
    view.updatePadding(<font></font>
        bottom = padding.bottom + insets.systemWindowInsetBottom<font></font>
    )<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay una bandera en el dise√±o </font></font><code>clipToPadding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Por defecto, siempre es cierto. Esto sugiere que no necesita dibujar elementos que aparecen donde el relleno est√° expuesto. Pero si est√° configurado </font></font><code>clipToPadding="false"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, entonces puedes dibujar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora, si configura el relleno en la parte inferior, en RecyclerView funcionar√° as√≠: el relleno se configura en la parte inferior y el elemento se dibuja encima de √©l hasta que nos desplazamos. Una vez alcanzado el final, RecyclerView desplazar√° los elementos a la posici√≥n que necesitamos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al establecer uno de estos indicadores, podemos trabajar con RecyclerView como con una vista normal. No piense que hay elementos que se desplazan, simplemente configure el relleno a continuaci√≥n, como, por ejemplo, en la barra de navegaci√≥n inferior.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora siempre devolv√≠amos las inserciones como si no hubieran sido procesadas. </font><font style="vertical-align: inherit;">Los insertos enteros vinieron a nosotros, hicimos algo con ellos, colocamos el relleno y devolvimos todos los insertos enteros nuevamente. </font><font style="vertical-align: inherit;">Esto es necesario para que cualquier ViewGroup siempre pase estas inserciones a toda la Vista. </font><font style="vertical-align: inherit;">Funciona.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Error de aplicaci√≥n</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En muchas aplicaciones en Google Play que ya han procesado inserciones, not√© un peque√±o error. Ahora les contar√© sobre √©l. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay una pantalla con navegaci√≥n en el s√≥tano. A la derecha est√° la misma pantalla que muestra la jerarqu√≠a. El fragmento verde muestra el contenido en la pantalla, dentro tiene un RecyclerView. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hl/e6/jo/hle6jod0ws19fydq734lqnuaixu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øQui√©n manej√≥ las inserciones aqu√≠? Barra de herramientas: aplic√≥ relleno en la parte superior para que su contenido se mueva debajo de la barra de estado. En consecuencia, la barra de navegaci√≥n inferior aplic√≥ inserciones desde abajo y se elev√≥ por encima de la barra de navegaci√≥n. Pero RecyclerView no maneja las inserciones de ninguna manera, no cae debajo de ellas, no necesita procesar inserciones: todo se hace correctamente.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/r3/xc/qi/r3xcqipovgqu-zbbxruxsy-wqvk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero aqu√≠ resulta que queremos usar el fragmento verde RecyclerView en otro lugar donde la barra de navegaci√≥n inferior ya no est√° all√≠. En este punto, RecyclerView ya est√° comenzando a manejar inserciones desde abajo. Necesitamos aplicarle relleno para desplazarnos correctamente desde debajo de la barra de navegaci√≥n. Por lo tanto, en RecyclerView, tambi√©n agregamos procesamiento de inserciones. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ve/ws/m-/vewsm-_o80cw7mbn9tyk0bu_mfs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Volvemos a nuestra pantalla, donde todos procesan las inserciones. ¬øRecuerdas que nadie informa que los proces√≥? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/um/vd/x8/umvdx8faxxk48r-inx-cxhkjqdm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vemos esta situaci√≥n: RecyclerView proces√≥ las inserciones desde abajo, aunque no llega a la barra de navegaci√≥n, apareci√≥ un espacio en la parte inferior. Me di cuenta de esto en las aplicaciones, y bastante grande y popular.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/i9/3_/ar/i93_arxauyvbitayfpyonkxnudy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si este es el caso, recordamos que devolvemos todas las inserciones para procesar. Entonces (¬°resulta!) Es necesario informar que las inserciones se procesan: la barra de navegaci√≥n debe informar que las inserciones se procesaron. No deber√≠an llegar a RecyclerView. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jf/r2/vi/jfr2vi8jpsas_ptxjjqh_qhg1vk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para hacer esto, instale la barra de navegaci√≥n inferior </font></font><code>InsetsListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Resta dentro de </font></font><code>bottom + insets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que no se procesan, devuelve 0.</font></font><br>
<br>
<pre><code class="kotlin hljs">doOnApplyWindowInsets { view, insets, initialPadding -&gt;    <font></font>
    view.updatePadding(<font></font>
        bottom = initialPadding.bottom + insets.systemWindowInsetBottom<font></font>
    )<font></font>
    insets.replaceSystemWindowInsets(<font></font>
        Rect(<font></font>
            insets.systemWindowInsetLeft,            <font></font>
            insets.systemWindowInsetTop,            <font></font>
            insets.systemWindowInsetRight,<font></font>
            <span class="hljs-number">0</span><font></font>
        )<font></font>
    )<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Devolvemos nuevas inserciones, en las que todos los par√°metros antiguos son iguales, pero </font></font><code>bottom + insets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iguales a 0. Parece que todo est√° bien. </font><font style="vertical-align: inherit;">Comenzamos y nuevamente tonter√≠as: RecyclerView todav√≠a maneja inserciones por alguna raz√≥n. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lp/yw/ut/lpywut3fvlk5w-nwbd3-wnrceaw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entend√≠ de inmediato que el problema es que el contenedor de estas tres Vistas es LinearLayout. </font><font style="vertical-align: inherit;">Dentro de ellos hay una barra de herramientas, un fragmento con RecyclerView y en la parte inferior de la barra de navegaci√≥n inferior. </font><font style="vertical-align: inherit;">LinearLayout toma a sus hijos en orden y les aplica inserciones. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Resulta que la barra de navegaci√≥n inferior ser√° la √∫ltima. </font><font style="vertical-align: inherit;">Le dijo a alguien que proces√≥ todas las inserciones, pero ya era demasiado tarde. </font><font style="vertical-align: inherit;">Todos los insertos se procesaron de arriba a abajo, RecyclerView ya los recibi√≥, y esto no nos salva. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uj/mm/jd/ujmmjdgumv0bl6e0ewydx7ueq5g.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øQu√© hacer? </font><font style="vertical-align: inherit;">LinearLayout no funciona como yo quiero, los transfiere de arriba a abajo, y primero necesito obtener el inferior.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redefinir todo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El desarrollador de Java jug√≥ en m√≠, ¬° </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">todo</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> necesita ser </font><strong><font style="vertical-align: inherit;">redefinido</font></strong><font style="vertical-align: inherit;"> ! </font><font style="vertical-align: inherit;">Bueno, ahora </font></font><code>dispatchApplyWindowInsets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">redefinir, establecer </font></font><code>yLinearLayout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que siempre ir√° de abajo hacia arriba. </font><font style="vertical-align: inherit;">Primero enviar√° inserciones a la barra de navegaci√≥n inferior y luego a todos los dem√°s.</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> WindowInsets dispatchApplyWindowInsets(WindowInsets insets) {     <font></font>
    insets = <span class="hljs-keyword">super</span>.dispatchApplyWindowInsets(insets);     
    <span class="hljs-keyword">if</span> (!insets.isConsumed()) {        
        <span class="hljs-keyword">final</span> int count = getChildCount();
        <span class="hljs-keyword">for</span> (int i = <span class="hljs-number">0</span>; i &lt; count; i++) {<font></font>
            insets = getChildAt(i).dispatchApplyWindowInsets(insets);<font></font>
            <span class="hljs-keyword">if</span> (insets.isConsumed()) {
                <span class="hljs-keyword">break</span>;<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> insets;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero me detuve a tiempo, recordando el comentario de que no hab√≠a necesidad de redefinir este m√©todo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠, un poco m√°s alto es la salvaci√≥n: ViewGroup busca un delegado que procese las inserciones, luego llama al s√∫per m√©todo en View y habilita su propio procesamiento. </font><font style="vertical-align: inherit;">En este c√≥digo, obtenemos inserciones, y si a√∫n no se han procesado, comenzamos la l√≥gica est√°ndar para nuestros hijos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Escrib√≠ una extensi√≥n simple. </font><font style="vertical-align: inherit;">Permite, aplicando </font></font><code>InsetsListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a una Vista, decir a qui√©n pasan estas inserciones.</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword">fun</span> View.<span class="hljs-title">addSystemBottomPadding</span><span class="hljs-params">(    
    targetView: <span class="hljs-type">View</span> = this
)</span></span> {<font></font>
    doOnApplyWindowInsets { _, insets, initialPadding -&gt;           <font></font>
        targetView.updatePadding(<font></font>
            bottom = initialPadding.bottom + insets.systemWindowInsetBottom<font></font>
        )<font></font>
        insets.replaceSystemWindowInsets(<font></font>
            Rect(<font></font>
                insets.systemWindowInsetLeft,<font></font>
                insets.systemWindowInsetTop,     <font></font>
                insets.systemWindowInsetRight,<font></font>
                <span class="hljs-number">0</span><font></font>
            )<font></font>
        )<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ </font></font><code>targetView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">es igual por defecto a la misma Vista sobre la cual aplicamos </font></font><code>addSystemBottomPadding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Podemos redefinirlo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En mi dise√±o lineal colgu√© un controlador de este tipo, pasando como </font></font><code>targetView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: esta es mi barra de navegaci√≥n inferior.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primero le dar√° inserciones a la barra de navegaci√≥n inferior.&nbsp;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eso procesar√° las inserciones, devolver√° el fondo cero.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adem√°s, de manera predeterminada, ir√°n de arriba a abajo: barra de herramientas, fragmento con RecyclerView.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entonces, tal vez, enviar√° nuevamente insertos Barra de navegaci√≥n inferior. </font><font style="vertical-align: inherit;">Pero esto ya no es importante, todo funcionar√° muy bien.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Logr√© exactamente lo que quer√≠a: todas las inserciones se procesan en el orden en que se necesitan.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/s3/b0/nc/s3b0nc07bayude3nvrvevkxnwyc.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Importante</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algunas cosas importantes a tener en cuenta. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El teclado es la interfaz de usuario del sistema en la parte superior de su aplicaci√≥n.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> No hay necesidad de tratarla de una manera especial. Si observa el teclado de Google, no es solo un dise√±o con botones en los que puede hacer clic. Hay cientos de modos para este teclado: b√∫squeda de gifs y memes, entrada de voz, cambio de tama√±o de 10 p√≠xeles de altura a tama√±os de pantalla. No pienses en el teclado, sino suscr√≠bete a las inserciones. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El caj√≥n de navegaci√≥n a√∫n no admite la navegaci√≥n por gestos</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">En Google IO, prometieron que todo saldr√≠a de la caja. </font><font style="vertical-align: inherit;">Pero en Android 10, Navigation Drawer todav√≠a no es compatible con esto. </font><font style="vertical-align: inherit;">Si actualiza a Android 10 y habilita la navegaci√≥n con gestos, el caj√≥n de navegaci√≥n se caer√°. </font><font style="vertical-align: inherit;">Ahora debe hacer clic en el men√∫ de hamburguesas para que aparezca, o una combinaci√≥n de circunstancias aleatorias le permite estirarlo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la versi√≥n pre-alfa de Android, Navigation Drawer funciona, pero no me atrev√≠ a actualizarlo, esto es pre-alfa. </font><font style="vertical-align: inherit;">Por lo tanto, incluso si instala la √∫ltima versi√≥n de GitFox desde el repositorio, hay un caj√≥n de navegaci√≥n all√≠, pero no se puede extraer. </font><font style="vertical-align: inherit;">Tan pronto como salga el soporte oficial, actualizar√© y todo funcionar√° bien.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lista de verificaci√≥n de preparaci√≥n de Android 10</font></font></h2><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Establezca la transparencia de la barra de navegaci√≥n y la barra de estado desde el comienzo del proyecto</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Google recomienda encarecidamente mantener una barra de navegaci√≥n transparente. Para nosotros, esta es una parte pr√°ctica importante. Si el proyecto funciona, pero no lo activ√≥, t√≥mese el tiempo para admitir Android 10. Act√≠velo primero en el tema, como transl√∫cido, y corrija el dise√±o donde se rompi√≥. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agregue extensiones a Kotlin</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : es m√°s f√°cil con ellas. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A√±adir a toda la barra de herramientas en la parte superior del relleno.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Las barras de herramientas siempre est√°n en la parte superior, y eso es lo que debe hacer. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para todas las RecyclerViews, agregue relleno desde la parte inferior</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y la capacidad de desplazarse </font></font><code>clipToPadding="false"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Piense en todos los botones en los bordes de la pantalla </font></font></strong><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(FAB)</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Lo m√°s probable es que las FAB no est√©n donde esperabas.</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No anule ni realice sus propias implementaciones para todos LinearLayout</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y otros casos similares. Haz el truco, como en GitFox, o toma mi extensi√≥n ya preparada para ayudar. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verifique los gestos en los bordes de la pantalla para una vista personalizada</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Navigation Drawer no es compatible con esto. Pero no es tan dif√≠cil apoyarlo con las manos, redefinir las inserciones para los gestos en la pantalla con el caj√≥n de navegaci√≥n. Tal vez tienes editores de im√°genes donde funcionan los gestos. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desplazarse en ViewPager no funciona desde el borde, sino solo desde el centro hacia la derecha y hacia la izquierda</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Google dice que esto es normal. Si tira de ViewPager desde el borde, se percibe que presiona el bot√≥n "Atr√°s". </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En un nuevo proyecto, incluya de inmediato toda la transparencia.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Puede decirle a los dise√±adores que no tiene una barra de navegaci√≥n y una barra de estado. </font><font style="vertical-align: inherit;">Todo el cuadrado es el contenido de su aplicaci√≥n. </font><font style="vertical-align: inherit;">Y los desarrolladores ya descubrir√°n d√≥nde y qu√© recaudar. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enlaces √∫tiles:</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@rmr_spb en un telegrama: registros de mitaps internos de Redmadrobot SPb.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todo el c√≥digo fuente en este art√≠culo y a√∫n m√°s en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitFox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Hay una rama separada de Android 10, donde puedes ver confirmando c√≥mo llegu√© a todo esto y c√≥mo admit√≠ el nuevo Android.</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">biblioteca de</font></a><font style="vertical-align: inherit;"> Chris Bane </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">Insetter</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Contiene 5-6 extensiones que mostr√©. </font><font style="vertical-align: inherit;">Para usar en su proyecto, comun√≠quese con la biblioteca, lo m√°s probable es que se traslade a Android Jetpack. </font><font style="vertical-align: inherit;">Los desarroll√© en mi proyecto y, me parece, mejoraron.</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">art√≠culo de</font></a><font style="vertical-align: inherit;"> Chris Bane.</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>   FunCorn,    ,      .</li>
<li> ¬´<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Why would I want to fitsSystemWindows?</a>¬ª  .</li>
</ul><br>
<blockquote>    AppConf,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">youtube-</a>      .            ,     - .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">AppsConf</a>     ,            .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>, stay tuned!</blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es488160/index.html">Windows Server 2019 vs. Instant√°neas de VMware con inactividad: una soluci√≥n elegante al problema</a></li>
<li><a href="../es488162/index.html">Cuanto mayor sea la calificaci√≥n, m√°s dinero y viceversa.</a></li>
<li><a href="../es488164/index.html">Batalla de la SEC contra Telegram</a></li>
<li><a href="../es488190/index.html">Una vez m√°s sobre el agotamiento emocional</a></li>
<li><a href="../es488194/index.html">¬øPor qu√© estamos escribiendo programas de tan mala calidad?</a></li>
<li><a href="../es488198/index.html">¬øA qu√© le temen los Timlids y por qu√© deber√≠an dejar de hacerlo?</a></li>
<li><a href="../es488200/index.html">El debate sobre el primer lenguaje de programaci√≥n: la decisi√≥n final</a></li>
<li><a href="../es488202/index.html">PVS-Studio ahora est√° en Chocolatey: comprobando Chocolatey desde Azure DevOps</a></li>
<li><a href="../es488208/index.html">Aniversario DUMP2020 - 4 d√≠as que no olvidar√°</a></li>
<li><a href="../es488210/index.html">Reconocer objetos en Android usando TensorFlow: desde la preparaci√≥n de datos hasta el lanzamiento en el dispositivo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>