<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👾 👩🏾‍🔧 🤞🏼 Clavier CopyPaste DIY ou le clavier parfait dans un monde où chaque ligne de code est déjà écrite 🙍 ⚒️ 🔛</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Beaucoup de gens qui commencent tout juste à apprendre la programmation posent la question - est-ce correct de copier-coller le code de quelqu'un d'au...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Clavier CopyPaste DIY ou le clavier parfait dans un monde où chaque ligne de code est déjà écrite</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/502794/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beaucoup de gens qui commencent tout juste à apprendre la programmation posent la question - est-ce correct de copier-coller le code de quelqu'un d'autre? Étant donné qu'une personne est une créature paresseuse et que le temps d'un programmeur coûte de l'argent - la réponse, à mon avis, est évidente - oui. Mais à ceux qui portent ce principe au point d'absurdité, qui copient sans réfléchir ni comprendre </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ainsi qu'à ceux qui rédigent un diplôme, cet essai</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est dédié à ce clavier et cet article. Et oui, ce clavier contient exactement deux boutons - copier-coller. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jq/po/8y/jqpo8yy5wvanjaw-j2fbpzo--e4.jpeg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sous la coupe sera une histoire sur l'assemblage et le firmware - nous verrons même le rebond d'un analyseur logique</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai donc décidé d'assembler ce clavier. </font><font style="vertical-align: inherit;">J'ai décidé de commencer par les composants - digispark (une petite écharpe avec attiny85 et une liaison USB qui peut être insérée directement dans l'ordinateur), la laisser capturer les frappes et émuler le clavier. </font><font style="vertical-align: inherit;">Maintenant, je n'ai pas de boutons - je n'ai pas de boutons mécaniques normaux pour le clavier, mais je n'ai pas envie d'attendre, alors prenons les boutons smd. </font><font style="vertical-align: inherit;">Comme ceux-ci:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Boutons</font></font></b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/webt/ed/iq/jb/ediqjbcvhhffosgiw5tks8edazy.jpeg"><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir décidé des composants, nous allons maintenant dessiner le panneau avant pour l'imprimer sur une imprimante à l'avenir. Dimensions 45 mm * 21 mm, tailles de coussinets pour boutons 10 mm * 10 mm </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Écrivez quelque chose en haut et en bas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'est avéré quelque chose comme ceci: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/76/uj/vl/76ujvlzgjzrgtpq65heyw6rup0u.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le prochain problème est les boutons smd, donc ils doivent être soudés à une sorte de carte. Puisque l'empoisonnement de la planche pour une telle chose n'a pas de sens - nous rayons le textolite avec la lettre T: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gj/qe/mf/gjqemfz8nkkvz5mlzfyhnha44pm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La distance entre les centres des boutons est de 15 mm. Soudez-les sur une planche improvisée. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous soudons trois fils. Lorsque le bouton est enfoncé, il fermera l'un des fils les plus extérieurs au fil central.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ti/j-/7q/tij-7qh6in4fyzxxj4ozotirtly.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, prenez le premier morceau de plastique PVC qui vient et collez notre panneau avant dessus, et collez leurs buses sur les boutons. </font><font style="vertical-align: inherit;">La seule chose que je n'ai pas prise en compte, c'est que la partie elle-même qui appuie sur la membrane tourne sur les boutons tactiles. </font><font style="vertical-align: inherit;">Si vous souhaitez améliorer la conception - utilisez les </font><font style="vertical-align: inherit;">commutateurs </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">normaux</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le résultat devrait être ce que vous avez vu au début de l'article. </font><font style="vertical-align: inherit;">Un autre angle.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dx/c0/ws/dxc0wsjo9lv_zldkmwgx1crjgao.jpeg"><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ainsi, à l'aide d'appareils simples, vous pouvez créer un clavier à deux boutons, MAIS POURQUOI?</font></font></b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/webt/i2/xh/he/i2xhhe0bmisbdng5zckcm4a7ikc.jpeg"><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous connectons trois fils dans digispark. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3o/fh/gt/3ofhgtfecluon5m4j23zo6mpfck.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schéma du «clavier» </font></font><br>
<br>
<img src="https://habrastorage.org/webt/q8/rb/3u/q8rb3ukm9soz0jdcxmwx1ezla2s.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous devons faire semblant digispark d'être un clavier et envoyer CTRL + C / CTRL + V en appuyant sur le bouton.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, nous devons attraper le clic. Pour commencer, si vous connectez le fil central à + 5V et connectez les fils latéraux aux broches configurées pour l'entrée, alors lorsque le bouton est enfoncé, oui, il y aura 1 sur la broche, mais lorsque la broche n'est pas enfoncée, il interceptera les interférences et ne suivra pas ce qui est pressant, et quel obstacle. Ce problème est résolu étonnamment simple - vous devez tirer les broches au sol à travers une grande résistance (des dizaines d'ohms). En ouvrant la fiche technique sur le microcontrôleur, vous pouvez voir qu'à l'intérieur, vous pouvez allumer l'ascenseur, mais uniquement en VCC (+ alimentation). En fait, ce n'est pas un problème - il vous suffit de connecter la broche centrale à GND (masse) et d'inverser la logique de travail. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez l'imaginer de cette façon: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/l7/mb/g9/l7mbg9brlmkvgessopybebhbdcs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais il y a encore un problème. Nous vivons dans un monde imparfait où les boutons ont un contact mécanique.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et il est imparfait. </font><font style="vertical-align: inherit;">Et notre contrôleur est rapide - et il s'avère donc qu'au moment de la commutation, le bouton ne se ferme pas instantanément, mais sa résistance saute pendant quelques millisecondes - cela s'appelle le rebond. </font><font style="vertical-align: inherit;">En raison du rebond, le contrôleur peut décider d'appuyer sur le bouton plusieurs fois, mais, par exemple, 10. Voici une illustration de ce phénomène sur Internet: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gd/c5/go/gdc5gotfcoqhtr6olu6x5h6pclm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais ce n'est pas non plus intéressant! </font><font style="vertical-align: inherit;">Peut-être que nous n'avons pas de rebond. </font><font style="vertical-align: inherit;">Pour le découvrir, j'ai découvert un analyseur logique. </font><font style="vertical-align: inherit;">Voyons maintenant ... Nous assemblons une configuration de test - un élévateur 10-com, 16 millions de mesures par seconde</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installation</font></font></b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/webt/cd/qr/tt/cdqrtt-opdlyxqnthdqoqmk_wzm.jpeg"><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On voit que le pressage a duré 0,1176 ms. On se rapproche du </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ba/zm/nh/bazmnhv-ha-e9axyt_oxhddedsy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
moment de relâchement du bouton (surligné en rouge). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3z/ft/r7/3zftr7g_6xp1oexaizcaqwcwhao.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur le côté il y a quelques mesures des "émissions", et en tout le rebond a duré environ 0,1435 ms. </font><font style="vertical-align: inherit;">Oui, je sais que cela ne suffit pas, mais cela vaut la peine de considérer que je n'ai que des boutons de la bande, les contacts n'ont pas encore eu le temps de s'oxyder ou de changer de forme. </font><font style="vertical-align: inherit;">Et avec le temps, la situation ne fera qu'empirer. </font><font style="vertical-align: inherit;">Comment gérer le rebond? </font><font style="vertical-align: inherit;">Il existe trois façons principales:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Déclencheur Schmidt + circuit RC - vous permet d'obtenir le signal parfait</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Circuit RC - vous permet de faire un glissement hors des émissions (signal augmentant en douceur)</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais nous avons tout un microcontrôleur - et donc nous avons 3 méthodes disponibles: les retards </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une des façons de gérer le rebond est de vérifier si le bouton est toujours enfoncé après un certain rebond. </font><font style="vertical-align: inherit;">S'il est implémenté par des retards, le code sera bloquant, mais comment le faire correctement peut être vu dans des centaines d'articles sur la lutte contre le rebond et l'arduino. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons donc réalisé que le bouton était enfoncé - et ensuite? </font><font style="vertical-align: inherit;">Dites à l'ordinateur que CTRL + C / V est enfoncé. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela se fait à l'aide de la bibliothèque standard de digispark. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code résultant est sorti comme ceci:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"DigiKeyboard.h"</span> <span class="hljs-comment">// library for emulate keyboard</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> COPY 2 <span class="hljs-comment">// copy button pin</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PASTE 0<span class="hljs-comment">// paste button pin</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> GND 1<span class="hljs-comment">// center must be connected to ground</span></span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>{<font></font>
  pinMode(COPY, INPUT); <span class="hljs-comment">// set pin to input</span>
  digitalWrite(COPY, HIGH);<span class="hljs-comment">// turn on pullup</span><font></font>
  pinMode(PASTE, INPUT);<font></font>
  digitalWrite(PASTE, HIGH);<font></font>
  pinMode(GND, OUTPUT); <span class="hljs-comment">// set pin to output</span>
  digitalWrite(GND, LOW);<span class="hljs-comment">// and set on pin GND</span><font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-comment">// if something COPY or PASTE clicked</span>
  <span class="hljs-keyword">if</span> (!digitalRead(COPY) || !digitalRead(PASTE)) {<font></font>
    delay(<span class="hljs-number">30</span>); <span class="hljs-comment">// wait(debounce)</span>
    <span class="hljs-keyword">if</span> (!digitalRead(COPY)) { <span class="hljs-comment">// if copy still pressed send CTRL+C</span><font></font>
      DigiKeyboard.sendKeyStroke(KEY_C , MOD_CONTROL_LEFT);<font></font>
      delay(<span class="hljs-number">30</span>);<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!digitalRead(PASTE)) {<span class="hljs-comment">// if paste still pressed send CTRL+V</span><font></font>
      DigiKeyboard.sendKeyStroke(KEY_V , MOD_CONTROL_LEFT);<font></font>
      delay(<span class="hljs-number">200</span>);<font></font>
    }<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici un projet en 3 heures je l'ai eu. </font><font style="vertical-align: inherit;">N'ayez pas peur de copier le code de quelqu'un d'autre!</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Copier et coller à partir d'un débordement de pile</font></font></b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/webt/wp/hc/0v/wphc0vxkxwxcaxrynjt1okcq4ng.jpeg"><br>
</div>
                    </div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr502770/index.html">Nous dévoilons ProLock: analyse des actions des nouveaux opérateurs de ransomware utilisant la matrice MITRE ATT & CK</a></li>
<li><a href="../fr502772/index.html">Comment créer un serveur PostgreSQL sur Google Cloud Platform SQL</a></li>
<li><a href="../fr502782/index.html">Joel Spolsky: niveau d'abstraction pour les développeurs</a></li>
<li><a href="../fr502786/index.html">La rubrique «Lisez des articles pour vous». Avril 2020. Partie 1</a></li>
<li><a href="../fr502788/index.html">Hackathon en un ou vie après Mec</a></li>
<li><a href="../fr502812/index.html">Plus amusant. Je suis serieux</a></li>
<li><a href="../fr502816/index.html">Les mythes de la technologie sémantique</a></li>
<li><a href="../fr502818/index.html">Y Messenger: Messenger décentralisé sur la blockchain *</a></li>
<li><a href="../fr502826/index.html">Présentation du scanner 3D Creaform MetraSCAN 3D</a></li>
<li><a href="../fr502830/index.html">Hackathon en ligne "New Reality" VirusHack. Comment c'était</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>