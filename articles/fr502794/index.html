<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëæ üë©üèæ‚Äçüîß ü§ûüèº Clavier CopyPaste DIY ou le clavier parfait dans un monde o√π chaque ligne de code est d√©j√† √©crite üôç ‚öíÔ∏è üîõ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Beaucoup de gens qui commencent tout juste √† apprendre la programmation posent la question - est-ce correct de copier-coller le code de quelqu'un d'au...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Clavier CopyPaste DIY ou le clavier parfait dans un monde o√π chaque ligne de code est d√©j√† √©crite</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/502794/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beaucoup de gens qui commencent tout juste √† apprendre la programmation posent la question - est-ce correct de copier-coller le code de quelqu'un d'autre? √âtant donn√© qu'une personne est une cr√©ature paresseuse et que le temps d'un programmeur co√ªte de l'argent - la r√©ponse, √† mon avis, est √©vidente - oui. Mais √† ceux qui portent ce principe au point d'absurdit√©, qui copient sans r√©fl√©chir ni comprendre </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ainsi qu'√† ceux qui r√©digent un dipl√¥me, cet essai</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est d√©di√© √† ce clavier et cet article. Et oui, ce clavier contient exactement deux boutons - copier-coller. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jq/po/8y/jqpo8yy5wvanjaw-j2fbpzo--e4.jpeg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sous la coupe sera une histoire sur l'assemblage et le firmware - nous verrons m√™me le rebond d'un analyseur logique</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai donc d√©cid√© d'assembler ce clavier. </font><font style="vertical-align: inherit;">J'ai d√©cid√© de commencer par les composants - digispark (une petite √©charpe avec attiny85 et une liaison USB qui peut √™tre ins√©r√©e directement dans l'ordinateur), la laisser capturer les frappes et √©muler le clavier. </font><font style="vertical-align: inherit;">Maintenant, je n'ai pas de boutons - je n'ai pas de boutons m√©caniques normaux pour le clavier, mais je n'ai pas envie d'attendre, alors prenons les boutons smd. </font><font style="vertical-align: inherit;">Comme ceux-ci:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Boutons</font></font></b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/webt/ed/iq/jb/ediqjbcvhhffosgiw5tks8edazy.jpeg"><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir d√©cid√© des composants, nous allons maintenant dessiner le panneau avant pour l'imprimer sur une imprimante √† l'avenir. Dimensions 45 mm * 21 mm, tailles de coussinets pour boutons 10 mm * 10 mm </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√âcrivez quelque chose en haut et en bas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'est av√©r√© quelque chose comme ceci: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/76/uj/vl/76ujvlzgjzrgtpq65heyw6rup0u.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le prochain probl√®me est les boutons smd, donc ils doivent √™tre soud√©s √† une sorte de carte. Puisque l'empoisonnement de la planche pour une telle chose n'a pas de sens - nous rayons le textolite avec la lettre T: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gj/qe/mf/gjqemfz8nkkvz5mlzfyhnha44pm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La distance entre les centres des boutons est de 15 mm. Soudez-les sur une planche improvis√©e. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous soudons trois fils. Lorsque le bouton est enfonc√©, il fermera l'un des fils les plus ext√©rieurs au fil central.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ti/j-/7q/tij-7qh6in4fyzxxj4ozotirtly.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, prenez le premier morceau de plastique PVC qui vient et collez notre panneau avant dessus, et collez leurs buses sur les boutons. </font><font style="vertical-align: inherit;">La seule chose que je n'ai pas prise en compte, c'est que la partie elle-m√™me qui appuie sur la membrane tourne sur les boutons tactiles. </font><font style="vertical-align: inherit;">Si vous souhaitez am√©liorer la conception - utilisez les </font><font style="vertical-align: inherit;">commutateurs </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">normaux</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le r√©sultat devrait √™tre ce que vous avez vu au d√©but de l'article. </font><font style="vertical-align: inherit;">Un autre angle.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dx/c0/ws/dxc0wsjo9lv_zldkmwgx1crjgao.jpeg"><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ainsi, √† l'aide d'appareils simples, vous pouvez cr√©er un clavier √† deux boutons, MAIS POURQUOI?</font></font></b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/webt/i2/xh/he/i2xhhe0bmisbdng5zckcm4a7ikc.jpeg"><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous connectons trois fils dans digispark. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3o/fh/gt/3ofhgtfecluon5m4j23zo6mpfck.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sch√©ma du ¬´clavier¬ª </font></font><br>
<br>
<img src="https://habrastorage.org/webt/q8/rb/3u/q8rb3ukm9soz0jdcxmwx1ezla2s.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous devons faire semblant digispark d'√™tre un clavier et envoyer CTRL + C / CTRL + V en appuyant sur le bouton.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, nous devons attraper le clic. Pour commencer, si vous connectez le fil central √† + 5V et connectez les fils lat√©raux aux broches configur√©es pour l'entr√©e, alors lorsque le bouton est enfonc√©, oui, il y aura 1 sur la broche, mais lorsque la broche n'est pas enfonc√©e, il interceptera les interf√©rences et ne suivra pas ce qui est pressant, et quel obstacle. Ce probl√®me est r√©solu √©tonnamment simple - vous devez tirer les broches au sol √† travers une grande r√©sistance (des dizaines d'ohms). En ouvrant la fiche technique sur le microcontr√¥leur, vous pouvez voir qu'√† l'int√©rieur, vous pouvez allumer l'ascenseur, mais uniquement en VCC (+ alimentation). En fait, ce n'est pas un probl√®me - il vous suffit de connecter la broche centrale √† GND (masse) et d'inverser la logique de travail. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez l'imaginer de cette fa√ßon: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/l7/mb/g9/l7mbg9brlmkvgessopybebhbdcs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais il y a encore un probl√®me. Nous vivons dans un monde imparfait o√π les boutons ont un contact m√©canique.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et il est imparfait. </font><font style="vertical-align: inherit;">Et notre contr√¥leur est rapide - et il s'av√®re donc qu'au moment de la commutation, le bouton ne se ferme pas instantan√©ment, mais sa r√©sistance saute pendant quelques millisecondes - cela s'appelle le rebond. </font><font style="vertical-align: inherit;">En raison du rebond, le contr√¥leur peut d√©cider d'appuyer sur le bouton plusieurs fois, mais, par exemple, 10. Voici une illustration de ce ph√©nom√®ne sur Internet: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gd/c5/go/gdc5gotfcoqhtr6olu6x5h6pclm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais ce n'est pas non plus int√©ressant! </font><font style="vertical-align: inherit;">Peut-√™tre que nous n'avons pas de rebond. </font><font style="vertical-align: inherit;">Pour le d√©couvrir, j'ai d√©couvert un analyseur logique. </font><font style="vertical-align: inherit;">Voyons maintenant ... Nous assemblons une configuration de test - un √©l√©vateur 10-com, 16 millions de mesures par seconde</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installation</font></font></b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/webt/cd/qr/tt/cdqrtt-opdlyxqnthdqoqmk_wzm.jpeg"><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On voit que le pressage a dur√© 0,1176 ms. On se rapproche du </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ba/zm/nh/bazmnhv-ha-e9axyt_oxhddedsy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
moment de rel√¢chement du bouton (surlign√© en rouge). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3z/ft/r7/3zftr7g_6xp1oexaizcaqwcwhao.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur le c√¥t√© il y a quelques mesures des "√©missions", et en tout le rebond a dur√© environ 0,1435 ms. </font><font style="vertical-align: inherit;">Oui, je sais que cela ne suffit pas, mais cela vaut la peine de consid√©rer que je n'ai que des boutons de la bande, les contacts n'ont pas encore eu le temps de s'oxyder ou de changer de forme. </font><font style="vertical-align: inherit;">Et avec le temps, la situation ne fera qu'empirer. </font><font style="vertical-align: inherit;">Comment g√©rer le rebond? </font><font style="vertical-align: inherit;">Il existe trois fa√ßons principales:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> D√©clencheur Schmidt + circuit RC - vous permet d'obtenir le signal parfait</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Circuit RC - vous permet de faire un glissement hors des √©missions (signal augmentant en douceur)</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais nous avons tout un microcontr√¥leur - et donc nous avons 3 m√©thodes disponibles: les retards </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une des fa√ßons de g√©rer le rebond est de v√©rifier si le bouton est toujours enfonc√© apr√®s un certain rebond. </font><font style="vertical-align: inherit;">S'il est impl√©ment√© par des retards, le code sera bloquant, mais comment le faire correctement peut √™tre vu dans des centaines d'articles sur la lutte contre le rebond et l'arduino. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons donc r√©alis√© que le bouton √©tait enfonc√© - et ensuite? </font><font style="vertical-align: inherit;">Dites √† l'ordinateur que CTRL + C / V est enfonc√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela se fait √† l'aide de la biblioth√®que standard de digispark. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code r√©sultant est sorti comme ceci:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"DigiKeyboard.h"</span> <span class="hljs-comment">// library for emulate keyboard</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> COPY 2 <span class="hljs-comment">// copy button pin</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PASTE 0<span class="hljs-comment">// paste button pin</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> GND 1<span class="hljs-comment">// center must be connected to ground</span></span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>{<font></font>
  pinMode(COPY, INPUT); <span class="hljs-comment">// set pin to input</span>
  digitalWrite(COPY, HIGH);<span class="hljs-comment">// turn on pullup</span><font></font>
  pinMode(PASTE, INPUT);<font></font>
  digitalWrite(PASTE, HIGH);<font></font>
  pinMode(GND, OUTPUT); <span class="hljs-comment">// set pin to output</span>
  digitalWrite(GND, LOW);<span class="hljs-comment">// and set on pin GND</span><font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-comment">// if something COPY or PASTE clicked</span>
  <span class="hljs-keyword">if</span> (!digitalRead(COPY) || !digitalRead(PASTE)) {<font></font>
    delay(<span class="hljs-number">30</span>); <span class="hljs-comment">// wait(debounce)</span>
    <span class="hljs-keyword">if</span> (!digitalRead(COPY)) { <span class="hljs-comment">// if copy still pressed send CTRL+C</span><font></font>
      DigiKeyboard.sendKeyStroke(KEY_C , MOD_CONTROL_LEFT);<font></font>
      delay(<span class="hljs-number">30</span>);<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!digitalRead(PASTE)) {<span class="hljs-comment">// if paste still pressed send CTRL+V</span><font></font>
      DigiKeyboard.sendKeyStroke(KEY_V , MOD_CONTROL_LEFT);<font></font>
      delay(<span class="hljs-number">200</span>);<font></font>
    }<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici un projet en 3 heures je l'ai eu. </font><font style="vertical-align: inherit;">N'ayez pas peur de copier le code de quelqu'un d'autre!</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Copier et coller √† partir d'un d√©bordement de pile</font></font></b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/webt/wp/hc/0v/wphc0vxkxwxcaxrynjt1okcq4ng.jpeg"><br>
</div>
                    </div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr502770/index.html">Nous d√©voilons ProLock: analyse des actions des nouveaux op√©rateurs de ransomware utilisant la matrice MITRE ATT & CK</a></li>
<li><a href="../fr502772/index.html">Comment cr√©er un serveur PostgreSQL sur Google Cloud Platform SQL</a></li>
<li><a href="../fr502782/index.html">Joel Spolsky: niveau d'abstraction pour les d√©veloppeurs</a></li>
<li><a href="../fr502786/index.html">La rubrique ¬´Lisez des articles pour vous¬ª. Avril 2020. Partie 1</a></li>
<li><a href="../fr502788/index.html">Hackathon en un ou vie apr√®s Mec</a></li>
<li><a href="../fr502812/index.html">Plus amusant. Je suis serieux</a></li>
<li><a href="../fr502816/index.html">Les mythes de la technologie s√©mantique</a></li>
<li><a href="../fr502818/index.html">Y Messenger: Messenger d√©centralis√© sur la blockchain *</a></li>
<li><a href="../fr502826/index.html">Pr√©sentation du scanner 3D Creaform MetraSCAN 3D</a></li>
<li><a href="../fr502830/index.html">Hackathon en ligne "New Reality" VirusHack. Comment c'√©tait</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>