<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë® üçî üêö Organisation von Code in Microservices und mein Ansatz zur Verwendung von hexagonaler Architektur und DDD üëåüèΩ ‚è≤Ô∏è ‚¨áÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr! Im Monolith sollte der gesamte Code im gleichen Stil sein, und in verschiedenen Microservices k√∂nnen Sie verschiedene Ans√§tze, Programmier...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Organisation von Code in Microservices und mein Ansatz zur Verwendung von hexagonaler Architektur und DDD</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/493426/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ak/h6/c_/akh6c_safonprea6vtagzdaoy58.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hallo Habr! Im Monolith sollte der gesamte Code im gleichen Stil sein, und in verschiedenen Microservices k√∂nnen Sie verschiedene Ans√§tze, Programmiersprachen und Frameworks verwenden. F√ºr einfache Mikrodienste mit 1 bis 2 Controllern und 1 bis 10 Aktionen ist es nicht besonders sinnvoll, Abstraktionsebenen zu blockieren. F√ºr komplexe Mikrodienste mit unterschiedlichen Zust√§nden und der Logik des √úbergangs zwischen ihnen ist es im Gegenteil besser, anfangs nicht faul zu sein. Ich m√∂chte √ºber meine Erfahrungen mit der Organisation von Code und der Verwendung der DDD-, Ports- und Adapter-Ans√§tze f√ºr beide F√§lle sprechen. Es gibt eine kurze Zusammenfassung des Artikels: Juni - schreibt Code in die Steuerung. Mitte - schreibt eine Reihe von Abstraktionen. Senior - wei√ü, wann Code in den Controller geschrieben werden muss und wann Abstraktionen erforderlich sind.</font></font><a name="habracut"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hier m√ºssen Sie I - Ports in C # sofort beenden, die Schnittstelle oder abstrakt sind, und Adapter sind konkrete Implementierungen (Klasse, Struktur). </font><font style="vertical-align: inherit;">Als Referenz empfehle ich, diese √úbersetzung von </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DDD, Hexagonal, Onion, Clean, CQRS zu</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lesen </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">... wie ich alles zusammenstelle</font></a><font style="vertical-align: inherit;"> und diesen Artikel √ºber </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Missverst√§ndnisse in</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bezug </font><font style="vertical-align: inherit;">auf </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">saubere Architektur</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Denken Sie hier daran, dass der Ansatz f√ºr einen gro√üen und komplexen Monolithen beschrieben wird. </font><font style="vertical-align: inherit;">Ich m√∂chte √ºber die Variationen dieses Ansatzes in Microservices sprechen, von denen 80 Prozent einfach und 20 mittel oder hoch komplex sind.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terminologie</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1) Prim√§radapter </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Einf√ºhrung einer benutzerfreundlichen Oberfl√§che f√ºr ein externes </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anrufsystem</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Rufen Sie SecondaryApdapters und Logic auf und verwenden Sie sie. </font><font style="vertical-align: inherit;">Sie fordern die Anwendung auf, etwas zu tun. </font><font style="vertical-align: inherit;">Einstiegspunkte zu Ihrem Code. </font><font style="vertical-align: inherit;">Typische Vertreter: ItemsService, CreateItemCommandHandler. </font><font style="vertical-align: inherit;">Verwenden Sie Logic und SecondaryAdapters f√ºr ihre Arbeit.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2) Sekund√§radapter </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bietet eine Schnittstelle zu einem externen </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">angerufenen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> System, das f√ºr die Verwendung durch unser System bequem ist. </font><font style="vertical-align: inherit;">Er erh√§lt Befehle von der Anwendung. </font><font style="vertical-align: inherit;">Typische Vertreter: ItemsRepository, EmailSender, Logger, DistributedCache. </font><font style="vertical-align: inherit;">Sie verwenden Bibliotheken und Frameworks wie EntityFramework f√ºr ihre Arbeit.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3) Logik</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1) Unternehmen</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daten und Logik kombinieren. </font><font style="vertical-align: inherit;">Typische OOP-Objekte. </font><font style="vertical-align: inherit;">Gegenstand, Geld, Benutzer. </font><font style="vertical-align: inherit;">Es gibt auch ValueObjects und Events. </font><font style="vertical-align: inherit;">Es werden nur andere Objekte aus der Ebene "Entit√§ten" verwendet. </font><font style="vertical-align: inherit;">Theoretisch ist diese Schicht der Kern der Anwendung, der von niemandem abh√§ngt. </font><font style="vertical-align: inherit;">Alle h√§ngen von ihm ab.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2) DomainServices</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Naked Computing. </font><font style="vertical-align: inherit;">Sie werden f√ºr Logik ben√∂tigt, die nicht an eine bestimmte Entit√§t angeh√§ngt werden kann. </font><font style="vertical-align: inherit;">Verwenden Sie Entit√§ten oder andere DomainServices. </font><font style="vertical-align: inherit;">Verwenden </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> keine PrimaryAdapters (sie verwenden immer alle selbst) und SecondaryAdapters. </font><font style="vertical-align: inherit;">Normalerweise sind dies alle Arten von AmountCalculator, Validator und mehr. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Code-Aufruffluss sollte immer in eine Richtung erfolgen. PrimaryAdapters -&gt; Logic und SecondaryAdapters.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Domain</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist der Themenbereich, f√ºr den das System entwickelt wird. </font><font style="vertical-align: inherit;">F√ºr den Domain Online Store ist dies beispielsweise E-Commerce.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Begrenzter Kontext</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
BoundedContext wird verwendet, um das System mit einer bestimmten Verantwortung in isolierte Teile aufzuteilen. Eine M√∂glichkeit zum Erfolg beim Systemdesign besteht darin, alle darin enthaltenen BoundedContexts zu finden und hervorzuheben. In einer Microservice-Architektur ist 1 Microservice = 1 BoundedContext. Beispiel: In einem Online-Shop k√∂nnen ein BoundedContext-Warenkorb und BoundedContext mit Bestellungen und BoundedContext mit Dateien arbeiten. Und ein gro√üer BoundedContext kann im Inneren in kleine Teile zerlegt werden. F√ºr den BoundedContext des Warenkorbs k√∂nnen Sie beispielsweise eine Unterteilung in den Kontext des Hinzuf√ºgens von Waren zum Warenkorb und den Kontext des Entfernens von Waren aus dem Warenkorb vornehmen. In Monolith 1 ist ein gro√üer BoundedContext ein Modul. Hier muss angemerkt werden, dass alle Entit√§ten in einem bestimmten Kontext leben, d.h.Artikel aus dem Kontext des Warenkorbs und Artikel aus dem Kontext der Warenausstellung k√∂nnen unterschiedliche Klassen mit unterschiedlichen Feldern und Methoden sein. In einem Monolithen ordnen sie sich einfach zu und verwenden ein ItemDto, das EF f√ºr die Arbeit mit der Datenbank √ºbergibt und das Felder enth√§lt, die allen gemeinsam sind, dh wenn das Item aus dem Kontext (Modul) des Basket die Eigenschaft Property1 und das Item aus dem Showcase-Kontext hat von Waren hat Eigentum Property2, dann hat ItemDto sowohl Property1 als auch Property2. In jedem Kontext gibt es ein eigenes Repository, das das f√ºr diesen Kontext bereits charakteristische Element aus der Datenbank herausholt. In Microservices ist dies einfach. Jeder hat seine eigene Datenbank und sein eigenes Wesen. Jeder Weltdienst hat seine eigenen Klassen. EinfachIn einem Monolithen ordnen sie sich einfach zu und verwenden ein ItemDto, das EF f√ºr die Arbeit mit der Datenbank √ºbergibt und das Felder enth√§lt, die allen gemeinsam sind, dh wenn das Item aus dem Kontext (Modul) des Basket die Eigenschaft Property1 und das Item aus dem Showcase-Kontext hat von Waren hat Eigentum Property2, dann hat ItemDto sowohl Property1 als auch Property2. In jedem Kontext gibt es ein eigenes Repository, das das f√ºr diesen Kontext bereits charakteristische Element aus der Datenbank herausholt. In Microservices ist dies einfach. Jeder hat seine eigene Datenbank und sein eigenes Wesen. Jeder Weltdienst hat seine eigenen Klassen. EinfachIn einem Monolithen ordnen sie sich einfach zu und verwenden ein ItemDto, das EF f√ºr die Arbeit mit der Datenbank √ºbergibt und das Felder enth√§lt, die allen gemeinsam sind, dh wenn das Item aus dem Kontext (Modul) des Basket die Eigenschaft Property1 und das Item aus dem Showcase-Kontext hat von Waren hat Eigentum Property2, dann hat ItemDto sowohl Property1 als auch Property2. In jedem Kontext gibt es ein eigenes Repository, das das f√ºr diesen Kontext bereits charakteristische Element aus der Datenbank herausholt. In Microservices ist dies einfach. Jeder hat seine eigene Datenbank und sein eigenes Wesen. Jeder Weltdienst hat seine eigenen Klassen. EinfachIn jedem Kontext gibt es ein eigenes Repository, das das Element, das bereits f√ºr diesen Kontext charakteristisch ist, aus der Datenbank abruft. In Microservices ist dies einfach. Jeder hat seine eigene Datenbank und sein eigenes Wesen. Jeder Weltdienst hat seine eigenen Klassen. EinfachIn jedem Kontext gibt es ein eigenes Repository, das das f√ºr diesen Kontext bereits charakteristische Element aus der Datenbank herausholt. In Microservices ist dies einfach. Jeder hat seine eigene Datenbank und sein eigenes Wesen. Jeder Weltdienst hat seine eigenen Klassen. Einfach</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Denken Sie </font><b><font style="vertical-align: inherit;">daran,</font></b><font style="vertical-align: inherit;"> dass Item und ItemsRepository aus verschiedenen BoundedContext verschiedene Objekte mit unterschiedlichen Methoden und Eigenschaften sein k√∂nnen. </font><font style="vertical-align: inherit;">BoundedContext in Microservices wird h√§ufig durch die Einf√ºhrung einiger g√§ngiger Bibliotheken verletzt. </font><font style="vertical-align: inherit;">Das Ergebnis ist eine Klasse mit mehreren Dutzend Methoden oder Eigenschaften, und jeder Mikrodienst verwendet nur 1 - 2, die er ben√∂tigt. Daher m√ºssen Sie mit gemeinsam genutzten Bibliotheken in Mikrodiensten vorsichtig sein.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abh√§ngigkeiten zwischen Ebenen</font></font></h3><br>
<img src="https://habrastorage.org/webt/8g/kb/4y/8gkb4yjeoduvybjcxsyo77apjre.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option f√ºr einfache Mikrodienste, von denen das Pareto-Gesetz 80 Prozent betr√§gt</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Werfen Sie die Ebenen PrimaryAdatapters und SecondaryAdapters weg. Lassen Sie nur die Logikebene. Genauer gesagt verwenden wir in einer typischen ASP.NET-Anwendung: PimaryAdater ist Controller und SecondaryAdapter ist DbContext von EF. Wenn der Controller pl√∂tzlich zu gro√ü wird, schneiden wir ihn mit Partial in St√ºcke. Dies ist viel besser, als unn√∂tige Abstraktionen zu z√ºchten und Zeit damit zu verbringen. Microsoft hat dies beispielsweise f√ºr den BasketMicrotservice im Beispiel seiner EShop-Anwendung f√ºr Docker-Container durchgef√ºhrt. Ja, schreiben Sie einfach den Code in die Steuerung. Schreiben Sie einfach keinen Spaghetti-Code. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wichtig</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Denken Sie daran, dass die Logikschicht bei uns bleibt und wir weiterhin Entit√§ten mit ihrer Logik und DomainServices mit ihren Berechnungen verwenden und nicht nur eine Wand aus Spaghetti-Code in den Controller schreiben. </font><font style="vertical-align: inherit;">Wir werfen einfach den typischen ItemService und ItemRepository weg. </font><font style="vertical-align: inherit;">Der gute alte ItemValidator, ItemMapper, AmountCalculator usw. in diesem Sinne bleibt bei uns. </font><font style="vertical-align: inherit;">Da wir immer noch √ºber die Logikschicht verf√ºgen, k√∂nnen wir jederzeit zu einer komplexeren Option wechseln, indem wir zus√§tzliche Abstraktionen mit ItemsService, ItemsRepository, umschlie√üen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiel</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein Service, der den Endpreis eines Produkts mit einem Rabatt berechnet. </font><font style="vertical-align: inherit;">Theoretisch ist es Teil des Domain Online Store und repr√§sentiert seinen BoundedContext-Produktkatalog. </font><font style="vertical-align: inherit;">Der Einfachheit halber habe ich die gesamte Validierungslogik √ºbersprungen. </font><font style="vertical-align: inherit;">Es kann in einer Art ItemValidator und DiscountValidator beschrieben werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Logikordner: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1.1) Entit√§tsordner: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rabatt:</font></font><br>
<br>
<pre><code class="cs hljs">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Discount</span><font></font>
    {<font></font>
        [<span class="hljs-meta">Key</span>]
        <span class="hljs-keyword">public</span> Guid Id { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }<font></font>
<font></font>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">decimal</span> Value { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Geld:</font></font><br>
<br>
<pre><code class="cs hljs">    [<span class="hljs-meta">Owned</span>]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Money</span><font></font>
    {<font></font>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">decimal</span> Amount { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> Money <span class="hljs-title">Apply</span>(<span class="hljs-params">Discount discount</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> amount = Amount * (<span class="hljs-number">1</span> - discount.Value);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Money()<font></font>
            {<font></font>
                Amount = amount<font></font>
            };<font></font>
        }<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Produkt:</font></font><br>
<br>
<pre><code class="cs hljs">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Item</span><font></font>
    {<font></font>
        [<span class="hljs-meta">Key</span>]
        <span class="hljs-keyword">public</span> Guid Id { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }<font></font>
<font></font>
        <span class="hljs-keyword">public</span> Money Price { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">new</span> Money();<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1.2) DomainServices-Ordner Produktpreisrechner </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
, einschlie√ülich Rabatte:</font></font><br>
<br>
<pre><code class="cs hljs">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IPriceCalculator</span><font></font>
    {<font></font>
        <span class="hljs-function">Money <span class="hljs-title">WithDiscounts</span>(<span class="hljs-params">Item item, IEnumerable&lt;Discount&gt; discounts</span>)</span>;<font></font>
    }<font></font>
<font></font>
     <span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">PriceCalculator</span>:<span class="hljs-title">IPriceCalculator</span><font></font>
    {<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> Money <span class="hljs-title">WithDiscounts</span>(<span class="hljs-params">Item item, IEnumerable&lt;Discount&gt; discounts</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">return</span> discounts.Aggregate(item.Price, (m, d) =&gt; m.Apply(d));<font></font>
        }<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) DbContext </font></font><br>
<br>
<pre><code class="cs hljs">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ItemsDbContext</span> : <span class="hljs-title">DbContext</span><font></font>
    {<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ItemsDbContext</span>(<span class="hljs-params">DbContextOptions&lt;ItemsDbContext&gt; options</span>) : <span class="hljs-title">base</span>(<span class="hljs-params">options</span>)</span><font></font>
        {<font></font>
<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">public</span> DbSet&lt;Item&gt; Items { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }<font></font>
<font></font>
        <span class="hljs-keyword">public</span> DbSet&lt;Discount&gt; Discounts { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) Controller</font></font><br>
<br>
<pre><code class="cs hljs">    [<span class="hljs-meta">ApiController</span>]<font></font>
    [<span class="hljs-meta">Route(<span class="hljs-meta-string">"api/v1/items"</span>)</span>]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ItemsController</span> : <span class="hljs-title">ControllerBase</span><font></font>
    {<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ItemsDbContext _context;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IPriceCalculator _priceCalculator;<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ItemsController</span>(<span class="hljs-params">ItemsDbContext context, IPriceCalculator priceCalculator</span>)</span><font></font>
        {<font></font>
            _context = context;<font></font>
            _priceCalculator = priceCalculator;<font></font>
        }<font></font>
<font></font>
        [<span class="hljs-meta">HttpGet(<span class="hljs-meta-string">"{id}/price-with-discounts"</span>)</span>]
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;<span class="hljs-keyword">decimal</span>&gt; <span class="hljs-title">GetPriceWithDiscount</span>(<span class="hljs-params">Guid id</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> item = <span class="hljs-keyword">await</span> _context.Items.FindAsync(id);
            <span class="hljs-keyword">var</span> discounts = <span class="hljs-keyword">await</span> _context.Discounts.ToListAsync();
            <span class="hljs-keyword">return</span> _priceCalculator.WithDiscounts(item, discounts).Amount;<font></font>
        }<font></font>
    }<font></font>
</code></pre><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option f√ºr komplexe Mikrodienste, davon 20 Prozent und f√ºr die meisten Monolithen</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier verwenden wir einen Standardansatz mit maximaler Isolation der Schichten voneinander. </font><font style="vertical-align: inherit;">F√ºgen Sie eine Klasse f√ºr PrimaryAdapter (ItemService) und f√ºr SecondaryAdapter (ItemRepository) hinzu. </font><font style="vertical-align: inherit;">Im Logikordner bleibt alles wie zuvor.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiel</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Ordner "SecondaryAdapters"</font></font><br>
<br>
<pre><code class="cs hljs">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IItemsRepository</span><font></font>
    {<font></font>
        <span class="hljs-function">Task&lt;Item&gt; <span class="hljs-title">Get</span>(<span class="hljs-params">Guid id</span>)</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ItemsRepository</span> : <span class="hljs-title">IItemsRepository</span><font></font>
    {<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ItemsDbContext _context;<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ItemsRepository</span>(<span class="hljs-params">ItemsDbContext context</span>)</span><font></font>
        {<font></font>
            _context = context;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;Item&gt; <span class="hljs-title">Get</span>(<span class="hljs-params">Guid id</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> item = <span class="hljs-keyword">await</span> _context.Items.FindAsync(id);
            <span class="hljs-keyword">return</span> item;<font></font>
        }<font></font>
    }<font></font>
</code></pre><br>
<pre><code class="cs hljs">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IDiscountsRepository</span><font></font>
    {<font></font>
        Task&lt;List&lt;Discount&gt;&gt; Get();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DiscountsRepository</span> : <span class="hljs-title">IDiscountsRepository</span><font></font>
    {<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ItemsDbContext _context;<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DiscountsRepository</span>(<span class="hljs-params">ItemsDbContext context</span>)</span><font></font>
        {<font></font>
            _context = context;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">public</span> Task&lt;List&lt;Discount&gt;&gt; Get()<font></font>
        {<font></font>
            <span class="hljs-keyword">return</span> _context.Discounts.ToListAsync();<font></font>
        }<font></font>
    }<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) PrimaryAdapters-Ordner</font></font><br>
<br>
<pre><code class="cs hljs">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IItemService</span><font></font>
    {<font></font>
        <span class="hljs-function">Task&lt;<span class="hljs-keyword">decimal</span>&gt; <span class="hljs-title">GetPriceWithDiscount</span>(<span class="hljs-params">Guid id</span>)</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ItemService</span> : <span class="hljs-title">IItemService</span><font></font>
    {<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IItemsRepository _items;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IDiscountsRepository _discounts;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IPriceCalculator _priceCalculator;<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ItemService</span>(<span class="hljs-params">IItemsRepository items, IDiscountsRepository discounts, IPriceCalculator priceCalculator</span>)</span><font></font>
        {<font></font>
            _items = items;<font></font>
            _discounts = discounts;<font></font>
            _priceCalculator = priceCalculator;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;<span class="hljs-keyword">decimal</span>&gt; <span class="hljs-title">GetPriceWithDiscount</span>(<span class="hljs-params">Guid id</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> item = <span class="hljs-keyword">await</span> _items.Get(id);
            <span class="hljs-keyword">var</span> discounts = <span class="hljs-keyword">await</span> _discounts.Get();
            <span class="hljs-keyword">return</span> _priceCalculator.WithDiscounts(item, discounts).Amount;<font></font>
        }<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unser Controller verwendet jetzt unseren IItemService</font></font><br>
<br>
<pre><code class="cs hljs">    [<span class="hljs-meta">ApiController</span>]<font></font>
    [<span class="hljs-meta">Route(<span class="hljs-meta-string">"api/v1/items"</span>)</span>]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ItemsController</span> : <span class="hljs-title">ControllerBase</span><font></font>
    {<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IItemService _service;<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ItemsController</span>(<span class="hljs-params">IItemService service</span>)</span><font></font>
        {<font></font>
            _service = service;<font></font>
        }<font></font>
<font></font>
        [<span class="hljs-meta">HttpGet(<span class="hljs-meta-string">"{id}/price-with-discounts"</span>)</span>]
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;<span class="hljs-keyword">decimal</span>&gt; <span class="hljs-title">GetPriceWithDiscount</span>(<span class="hljs-params">Guid id</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">await</span> _service.GetPriceWithDiscount(id);
            <span class="hljs-keyword">return</span> result;<font></font>
        }<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es wurde viel zus√§tzlicher Code hinzugef√ºgt. Stattdessen erh√∂hte Systemflexibilit√§t. Jetzt ist es einfacher, den Contoller und allgemein den ASP.NET Core in etwas anderes zu √§ndern oder den DbContext und den EntityFramework Core in etwas anderes zu √§ndern oder Redis Caching hinzuzuf√ºgen. Der erste Ansatz gewinnt bei einfachen Mikrodiensten und sehr einfachen und kleinen Monolithen. Die zweite in allen anderen F√§llen, wenn Sie diesen Code l√§nger als ein Jahr hinzuf√ºgen und beenden m√ºssen. Nun, im zweiten Ansatz ist es zus√§tzlich zu Entity Item und Discount n√ºtzlich, separate DTOs zu erstellen, die DbContex EF verwenden, und separate DTOs (Modelle), die ASP.NET Controller verwendet, d. H. ItemDto und ItemModel. Dadurch werden Domain-Modelle noch unabh√§ngiger. Und schlie√ülich ein Beispiel f√ºr eine einfache Anwendung, die ich mit dem 2. </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">TestRuvds-</font></a><font style="vertical-align: inherit;"> Ansatz geschrieben habe</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Tats√§chlich ist er hier √ºberfl√ºssig, und all diese Abstraktionen sind hier als Beispiel.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementierungsbeispiel</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VirtualServersModule</font></font></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Danksagung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Danke </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">canxes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AndrewDemb</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> f√ºr grammatikalische Fehler gefunden.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de493412/index.html">Spiele mit Wifi auf ESP32</a></li>
<li><a href="../de493416/index.html">IDA Pro und Reverse Engineering-Techniken</a></li>
<li><a href="../de493418/index.html">Warum maschinelles Lernen ‚Äûsynthetische‚Äú Daten verwendet</a></li>
<li><a href="../de493420/index.html">Mein Weg, Sch√ºler der Mittelstufe in Python einzuf√ºhren</a></li>
<li><a href="../de493424/index.html">Wir implementieren Python-Code-Konvertierungen</a></li>
<li><a href="../de493428/index.html">"Wir werden keine Verschw√∂rungstheorien hervorbringen." Sprechen Sie √ºber ML-Konferenzen mit Menschen aus Wissenschafts- und IT-Unternehmen</a></li>
<li><a href="../de493430/index.html">Netzarchitektur f√ºr Webanwendungen</a></li>
<li><a href="../de493432/index.html">Warum nicht eine Karriere in einem kleinen Nicht-IT-Unternehmen beginnen?</a></li>
<li><a href="../de493436/index.html">Programm zum √Ñndern von Zugriffsrechten und zum Registrieren von Datei- / Verzeichnisnamen auf Bash</a></li>
<li><a href="../de493438/index.html">Anzeigen von Suchergebnissen und Leistungsproblemen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>