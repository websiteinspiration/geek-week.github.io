<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧛🏿 🎢 🛅 Using NAT Traversal to Connect Users Passively 🏂🏿 🤷🏽 ⛹🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is a free translation of one of the DC ++ Developer Blog Entries . 
 
 With the permission of the author (and also for the sake of clarit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Using NAT Traversal to Connect Users Passively</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/497944/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This article is a free translation of one of the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DC ++ Developer Blog</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Entries </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
With the permission of the author (and also for the sake of clarity and interest, for the sake of sake) I flourished it with links and supplemented it with some personal research.</font></font><a name="habracut"></a></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introduction</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Currently, at least one user from the pair of connecting must be in active mode. The NAT “bypass" mechanism will be useful if the active mode is not configured on either side. This usually happens because the incoming firewall or NAT device blocks incoming connections. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If both clients in active mode, the </font></font></b><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Initiating</font></a><font style="vertical-align: inherit;"> Client </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">sends the $ ConnectToMe</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
command containing its own IP address and port to </font><font style="vertical-align: inherit;">another client. Using this data, the client receiving the command establishes a connection with the initiator. </font><b><font style="vertical-align: inherit;">If one of the clients is in passive mode</font></b><font style="vertical-align: inherit;"> 
By means of the hub, passive client </font><b><font style="vertical-align: inherit;">A</font></b><font style="vertical-align: inherit;"> sends the </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">$ RevConnectToMe command to</font></a><font style="vertical-align: inherit;"> active client </font><b><font style="vertical-align: inherit;">B</font></b></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">which then responds with the $ ConnectToMe command. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/l7/vz/bn/l7vzbngdxp3yprlxzcymuutpvp4.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As the server </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in the case of the above acts DC hub </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If both clients in a passive mode, the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=http://h" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ADC hub</font></font></a></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
located behind different NAT clients </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> joined to the hub </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yz/li/l3/yzlil3rmvxyjvuz6sv0jqtar3dy.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So the connection to the hub looks from the client </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></b></i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;"> side. The</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
hub accepts connections on port 1511. Client </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> makes outgoing connections from its private network through port 50758. The hub, in turn, sees the address of the NAT device, works with it and broadcasts the clients according to their identifiers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Client </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sends to server </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a message asking for help to connect with the client </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bed and</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">
Being also in passive mode, client </font><b><font style="vertical-align: inherit;">B</font></b><font style="vertical-align: inherit;"> , having received this command, must inform its private port used to connect to the hub via NAT. </font><font style="vertical-align: inherit;">
After receiving this information, client </font><b><font style="vertical-align: inherit;">A</font></b><font style="vertical-align: inherit;"> immediately tries to establish a connection with client </font><b><font style="vertical-align: inherit;">B</font></b><font style="vertical-align: inherit;"> and reports its own private port.</font></font><br>
<br>
<code>Hub: [Outgoing][178.79.159.147:1511] D<b>RCM</b> AAAA BBBB ADCS/0.10 1649612991</code><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<code>Hub: [Incoming][178.79.159.147:1511] D<b>NAT</b> BBBB AAAA ADCS/0.10 <b>59566</b> 1649612991</code><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<code>Hub: [Outgoing][178.79.159.147:1511] D<b>RNT</b> AAAA BBBB ADCS/0.10 <b>50758</b> 1649612991</code><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What is the interest? </font><font style="vertical-align: inherit;">The interest is in shifting the endpoint of the same connection by creating a new connection to a public address through the already used private port.</font></font></blockquote><br>
<img src="https://habrastorage.org/webt/q3/up/g7/q3upg7hmlgqkvge0cvcfft6mmf0.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bingo!</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Of course, at the same time, the NAT of client </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> has the full right to reject the first connection request from client </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , but its own request already rushes into the “hole” created by this connection, and the connection is established. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/h1/f4/cd/h1f4cdqdozb75akwftzuxs49tce.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Illustration suitable for the whole process with the caveat that the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">protocol</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> does not use public ports opened by the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NAT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> session </font><font style="vertical-align: inherit;">, as well as private addresses. </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Epilogue</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
At the time of writing the (original) article, approximately half of DC clients are passive. This means that a quarter of all possible connections cannot be made. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the future, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DC ++ will be able to "bypass" NAT</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">using existing </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> – </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> – </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> connections to establish a direct client – ​​client connection, even if </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> are in passive mode.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en497930/index.html">Sinclair zx80 / ​​zx81 emulation</a></li>
<li><a href="../en497932/index.html">We study the Mediastreamer2 VoIP engine. Part 10</a></li>
<li><a href="../en497934/index.html">COVID-19: what they try to treat, what can be treated and some conspiracy theories</a></li>
<li><a href="../en497938/index.html">The Awakening of a Sleeping Institute: How We Remove Python Walkers from REAPER</a></li>
<li><a href="../en497940/index.html">Developer Heart: Sega Saturn Devkits</a></li>
<li><a href="../en497946/index.html">Was there life before an Audio CD? PCM software decoder</a></li>
<li><a href="../en497950/index.html">21 lessons learned in 21 years of programming</a></li>
<li><a href="../en497952/index.html">English abbreviations and IT titles that we mispronounce</a></li>
<li><a href="../en497956/index.html">Sars miraculous? Genealogy of Wuhan Coronavirus</a></li>
<li><a href="../en497958/index.html">They are among us: exploring vulnerabilities and malicious code in Zoom for Windows</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>