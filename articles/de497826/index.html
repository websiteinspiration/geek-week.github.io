<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîä ‚öìÔ∏è ü§∏üèΩ So erfassen Sie schnell die Welt oder verwalten ein Netzwerk von Windows-Computern mithilfe von OPSI üõ´ ü•ê üëë</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Haftungsausschluss: 
 Der Autor liebt kurze und gerade Kr√ºcken und liebt au√üerdem kostenlose offene Software f√ºr die Flexibilit√§t und Skalierbarkeit, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>So erfassen Sie schnell die Welt oder verwalten ein Netzwerk von Windows-Computern mithilfe von OPSI</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/497826/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Haftungsausschluss: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Autor liebt kurze und gerade Kr√ºcken und liebt au√üerdem kostenlose offene Software f√ºr die Flexibilit√§t und Skalierbarkeit, die sie bietet. </font><font style="vertical-align: inherit;">Der Zweck dieses Artikels ist der Wunsch, das im russischen Internet zu Unrecht unbekannte OPSI-Software-Managementsystem (Open PC Server Integration) zu f√∂rdern und dar√ºber zu sprechen.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich sa√ü im B√ºro und trank Kaffee, als Ilon Mask mich anrief und mir in reinem Russisch sagte, dass es genug ist, um es bereits zu ertragen. Es ist Zeit, die besten K√∂pfe zu sammeln, um einen bestimmten Virus zu bek√§mpfen, und daf√ºr bin ich jetzt, f√ºnf Minuten sp√§ter, da Das B√ºro wird 100 Computer mitbringen, die ich dringend f√ºr die Bereitstellung von Windows 10 ben√∂tige, und morgen fr√ºh werden Wissenschaftler aus aller Welt ins B√ºro kommen, um mit der Arbeit an dem Antivirenprogramm zu beginnen. </font><font style="vertical-align: inherit;">Nun, habe ich nicht mein ganzes Leben darauf gewartet? </font><font style="vertical-align: inherit;">Eine w√ºrdige Herausforderung f√ºr ein gutes Werkzeug.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zur Implementierung des Plans verwende ich das OPSI-System - Open PC Server Integration. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OPSI ist in Deutschland in Python geschrieben und anscheinend m√∂gen es auch Kr√ºcken, die kostenlos und skalierbar sind. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Grundlegende Systemfunktionen:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Automatische Softwarebereitstellung </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So funktioniert es: Sie analysieren das Installationsprogramm und erstellen daraus das opsi-Paket, mit dem das Programm ordnungsgem√§√ü installiert wird. </font><font style="vertical-align: inherit;">Es funktioniert am besten mit MSI-Paketen, es kennt einige weitere Formate, mit denen es auch fertig wird. </font><font style="vertical-align: inherit;">Es kann eine Bat-Datei oder ein Powershell-Skript ausf√ºhren, im Prinzip jedoch jeden Interpreter. </font><font style="vertical-align: inherit;">Es gibt eingebaute Registrierungssysteme, im Allgemeinen vollst√§ndige F√ºllung, wahrscheinlich der beste Teil des Systems.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Automatische Installation von Betriebssystemen </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich verwende nur die Installation von einem Image als die schnellste, aber es gibt Optionen f√ºr die Offline-Installation des Systems von Grund auf neu.</font></font></li>
<li>   <br>
<br>
         ,          ,       ,      ,      windows.  ,   ,    windows,    ,          . </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mehrere praktische Verwaltungsoberfl√§chen mit flexiblen Integrationsoptionen </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt ein Programm mit einer grafischen Oberfl√§che, es gibt eine http-Oberfl√§che, an die Sie Befehle senden k√∂nnen, Sie k√∂nnen OPSI √ºber die Serverkonsole steuern, Befehle in Ihre Skripte einbetten, Sie k√∂nnen von Python aus auf das Backend zugreifen, aber ich leider , w√§hrend ich solche Magie nicht besitze.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unterst√ºtzung f√ºr mehrere Depotserver (Server, die direkt die Software enthalten, von der aus die Bereitstellung ausgef√ºhrt wird). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie k√∂nnen jedem Subnetz oder jeder Gruppe von Computern viele Server hinzuf√ºgen, von denen jeder sein eigenes Netzwerk bedient.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Von Modulen implementierte Systemfunktionen (es gibt kostenlose und kostenpflichtige Module):</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LDAP-Connector (kostenpflichtig) Ein </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Connector, der eine Domain und opsi zu einem Ganzen verbindet</font></font></li>
<li>  ()<br>
<br>
     : , ...</li>
<li>MySQL  () <br>
<br>
  OPSI  mysql   ,  300 </li>
<li>Nagios  ()<br>
<br>
 </li>
<li>   ()<br>
<br>
 , opsi      ,   ,      .</li>
<li>    ()<br>
<br>
    .</li>
<li>  ()<br>
<br>
  ,   ,      ,  . ,    ansible  puppet,    .    linux  windows      .</li>
<li>WAN  ()<br>
<br>
        ,   . </li>
<li>   ()<br>
<br>
 </li>
<li>OTRS::ITSM  ()<br>
<br>
  </li>
<li>   ()<br>
<br>
 ,      ,            ,   ¬´   ¬ª,  ,  . </li>
</ol><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Weitere Informationen finden Sie hier. Das</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Monetarisierungsmodell lautet wie folgt: Sie verkaufen Module, bis sie den Betrag sammeln, um sie kostenlos zu machen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
W√§hrend Computer in mein B√ºro gebracht und zusammengebaut werden, installiere ich den AD-Server auf dem Windows-Server, erh√∂he die Dom√§ne domain.local darauf sowie DNS und DHCP. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie k√∂nnen OPSI in der Arbeitsgruppe und in der Dom√§ne installieren. Wir werden in der Dom√§ne installieren, jedoch ohne Bindung an den AD (LDAP-Connector).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden Windows 10 gem√§√ü dem folgenden Schema auf einem Computernetzwerk bereitstellen: Wir werden ein bereitstellbares Windows 10-Image mit allen Programmen vorbereiten, √ºber das Netzwerk √ºber opsi booten, es mit clonezilla automatisch in einer Datei speichern und dann alle Computer so einstellen, dass es automatisch √ºber opsi installiert wird, √ºber das Netzwerk und automatisch Wir werden diese Datei √ºber tftp auf allen Computern im Broadcast-Netzwerksegment versch√ºtten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setzen Sie dazu im DHCP-Serverbereich den Parameter 66 in der IP unseres zuk√ºnftigen opsi 192.168.1.229-Servers </font></font><br>
<br>
<img src="https://habrastorage.org/webt/at/sl/hj/atslhjfu6ebadvwdih0bcdzzg2q.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
und den Parameter 67 auf linux / pxelinux.0. F√ºgen Sie </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
in DNS opsiserver.domain.local unter seiner statischen Adresse 192.168.1.229 hinzu</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dann erstellen wir eine virtuelle Maschine f√ºr unseren Opsi-Server auf Eisen, die Ihren Belastungen standh√§lt und in Bezug auf die Geschwindigkeit zu Ihnen passt. SSD und mehrere Netzwerkkarten sind willkommen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Opsi unterst√ºtzt nicht alle Systeme. Die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kompatibilit√§tsliste finden Sie hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir installieren sofort im englischen Gebietsschema. Ich rate Ihnen dringend, das kyrillische Alphabet nirgendwo auf diesem Server zu verwenden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meine Lieblings-Debian-10-Distribution installiere ich in einer minimalen Konfiguration mit dem Namen opsiserver. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach der Installation und dem Neustart konfigurieren wir f√ºr alle F√§lle die Gebietsschemas:</font></font><br>
<br>
<pre><code class="bash hljs">dpkg-reconfigure locales</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich w√§hle alles aus, wo es de_en_ gibt und ru_ system en_US.UTF8 verl√§sst. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die weitere Installation ist eine Nacherz√§hlung </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dieses</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> an die Aufgabe angepassten </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Tutorials</font></a><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ñndern Sie den Servernamen, wenn er sich von dem unterscheidet, was wir ben√∂tigen:</font></font><br>
<br>
<pre><code class="bash hljs">hostname opsiserver.domain.local</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachpr√ºfung:</font></font><br>
<br>
<pre><code class="bash hljs">hostname -f</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bringen wir / etc / hosts in die folgende Form:</font></font><br>
<br>
<pre><code class="plaintext hljs">127.0.0.1 localhost<font></font>
127.1.1.1 localhost.localdomain<font></font>
192.168.1.229 opsiserver.domain.local opsiserver</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und wir werden seine Existenz f√ºr immer vergessen, da opsi den Inhalt dieser Datei fordert und wenn sie ge√§ndert wird, beginnt sie manchmal zu rebellieren und mit Fehlern zu bestreuen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Installieren Sie die erforderlichen Pakete:</font></font><br>
<br>
<pre><code class="bash hljs">apt install wget host pigz mc -y</code></pre> <br>
<pre><code class="bash hljs">apt install samba samba-common smbclient cifs-utils -y </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir installieren den MySQL-Server standardm√§√üig, Maria-DB steht f√ºr mich auf, es wird auch funktionieren.</font></font><br>
<br>
<pre><code class="bash hljs">apt install default-mysql-server -y</code></pre><br>
<pre><code class="bash hljs">sudo mysql_secure_installation</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir bejahen die Fragen, √§ndern das Root-Passwort und merken es uns. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºgen Sie dem System OPSI-Repositorys hinzu:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">echo</span> <span class="hljs-string">"deb http://download.opensuse.org/repositories/home:/uibmz:/opsi:/4.1:/stable/Debian_10/ /"</span> &gt; /etc/apt/sources.list.d/opsi.list</code></pre><br>
<pre><code class="bash hljs">wget -nv https://download.opensuse.org/repositories/home:uibmz:opsi:4.1:stable/Debian_10/Release.key -O Release.key<font></font>
apt-key add - &lt; Release.key</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aktualisiert:</font></font><br>
<br>
<pre><code class="bash hljs">apt update</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir entfernen tftpd, wenn dies der Fall ist, da OPSI damit in Konflikt steht:</font></font><br>
<br>
<pre><code class="bash hljs">apt remove tftpd</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir entfernen die TFTP-Unterst√ºtzung von inetd, da OPSI in Konflikt steht, wenn dies der Fall ist:</font></font><br>
<br>
<pre><code class="bash hljs">update-inetd --remove tftp<font></font>
apt install opsi-tftpd-hpa</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und installieren Sie den opsi Server direkt:</font></font><br>
<br>
<pre><code class="bash hljs">apt install opsi-server</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dabei werden sie nach den Daten gefragt, die zum Erstellen eines selbstsignierten Zertifikats erforderlich sind, das wiederum f√ºr die verschl√ºsselte Verbindung von Clients mit dem Server ben√∂tigt wird. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Installieren Sie die Windows-Unterst√ºtzung:</font></font><br>
<br>
<pre><code class="bash hljs">apt install opsi-windows-support</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Konfigurieren Sie das MySQL-Backend:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-setup --configure-mysql</code></pre><br>
<img src="https://habrastorage.org/webt/b0/7g/zh/b07gzhpoteem9-pgzopqghvkmga.png" width="600" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir setzen die Serveradresse (localhost), den Benutzer, von dem aus wir handeln (root), das root-Passwort in MySQL (an das wir uns fr√ºher erinnert haben), den Namen der Datenbank f√ºr opsi (opsi), den Namen des Benutzers, der in dieser Datenbank arbeiten wird (opsi), das Passwort f√ºr diesen Benutzer (wir erfinden) Neu). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als n√§chstes m√ºssen Sie f√ºr Debian 10 / usr / sbin zu PATH hinzuf√ºgen:</font></font><br>
<br>
<pre><code class="bash hljs">PATH=<span class="hljs-variable">$PATH</span>:/usr/sbin</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
und die gleiche Zeile sollte zu .bashrc in Ihrem Home-Verzeichnis hinzugef√ºgt werden. </font><font style="vertical-align: inherit;">Wenn dies nicht getan wird, erhalten Sie im n√§chsten Schritt den Fehler "chpasswd not found". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir initialisieren das System und legen die erforderlichen Rechte f√ºr die Dateien und Verzeichnisse des Systems fest:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-setup --init-current-config<font></font>
opsi-set-rights</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neustart des Dienstes:</font></font><br>
<br>
<pre><code class="bash hljs">systemctl restart opsiconfd.service<font></font>
systemctl restart opsipxeconfd.service</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Samba konfigurieren:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-setup --auto-configure-samba</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OPSI-Clients stellen √ºber https an Port 4447 eine Verbindung zum Hauptserver her. Wenn Sie eine Installation aufrufen m√ºssen, mounten die Clients den Samba-Ball vom Opsi-Server und installieren Software von diesem. </font><font style="vertical-align: inherit;">Um dies zu erm√∂glichen, erlauben wir OPSI, Samba neu zu konfigurieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Samba Neustart:</font></font><br>
<br>
<pre><code class="bash hljs">systemctl restart smbd.service<font></font>
systemctl restart nmbd.service</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Legen Sie das Administratorkennwort f√ºr den Benutzer des pcpatch-Systems fest: </font></font><br>
<br>
<pre><code class="bash hljs">opsi-admin -d task setPcpatchPassword</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erstellen Sie nun einen Benutzer zur Verwaltung des Systems:</font></font><br>
<br>
<pre><code class="bash hljs">useradd -m -s /bin/bash adminuser</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erstellen Sie ein Passwort f√ºr ihn:</font></font><br>
<br>
<pre><code class="bash hljs">passwd adminuser</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun das Passwort f√ºr Samba erstelle ich das gleiche wie im System:</font></font><br>
<br>
<pre><code class="bash hljs">smbpasswd -a adminuser</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zur Gruppe hinzuf√ºgen:</font></font><br>
<br>
<pre><code class="bash hljs">usermod -aG pcpatch adminuser</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn wir etwas mit OPSI unter der Wurzel tun wollen, m√ºssen wir die Wurzel zur Gruppe hinzuf√ºgen:</font></font><br>
<br>
<pre><code class="bash hljs">usermod -aG pcpatch root</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Noch ein paar Kr√ºcken:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-setup --patch-sudoers-file</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt k√∂nnen Sie Pakete auf das System herunterladen und w√§hrend des Ladens Kaffee trinken.</font></font><br>
<br>
<pre><code class="bash hljs">opsi-package-updater -v install</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anschlie√üend k√∂nnen die Pakete mit dem folgenden Befehl aktualisiert werden:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-package-updater -v update</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gehen Sie nun zu </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://download.uib.de/opsi4.1/misc/helper/</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , laden Sie die von opsi konfigurierte Verwaltungsoberfl√§che herunter und installieren Sie sie, </font></font><br>
<br>
<code>opsi-configed-setup.exe</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
um den Server einzugeben, geben Sie die Serveradresse, unseren Administratorbenutzer und sein Kennwort ein, </font></font><br>
<br>
<code>https://opsiserver.domain.local:4447/</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
und wir befinden uns im System. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zu diesem Zeitpunkt ist der Server installiert! </font></font><br>
<br>
<img src="https://habrastorage.org/webt/a-/yg/ft/a-ygftvat-_6wioezy6v7rmuszq.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1 - Alle mit diesem Server verbundenen Clients k√∂nnen in Gruppen, einschlie√ülich verschachtelter Clients, zerlegt werden. Die Zuweisung wird auf die gesamte Gruppe gleichzeitig angewendet. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2 - eine Registerkarte mit Clients, dies ist eine Liste der Computer, die von opsi gesteuert werden. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3 - Clients sind eine Liste. Hier k√∂nnen Sie sie in beliebiger Reihenfolge ausw√§hlen, um den Zweck </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4 - ‚ÄûProduktkonfiguration‚Äú - ein Opfer der √úbersetzung - </font><font style="vertical-align: inherit;">anzuwenden </font><font style="vertical-align: inherit;">. Tats√§chlich gibt es Pakete, die unter Windows in der Terminologie opsi - localboot products installiert werden k√∂nnen</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5 - Netboot-Produkte - Dies ist alles, was √ºber das Netzwerk heruntergeladen wird. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6 - opsi-mac-Adresse - Die Mohnblume des Computers wird beim Netzwerkstart ermittelt. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7 - opsiHostKey ist das ‚ÄûKennwort‚Äú des Clients im opsi-System, wenn Sie es von l√∂schen Computer opsi Client, und dann neu installieren, wird es nicht funktionieren, da das Passwort alt bleibt und nicht geeignet ist. Dies ist sowohl ein Fehler als auch eine Funktion. Und wie w√ºrdest du es machen? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt bereiten wir das Windows 10-Bild vor, das wir versch√ºtten werden. Clonezilla, das wir verwenden werden, ist nicht so gut wie die Akronis, aber es wei√ü immer noch, wie man das Bild von einer kleineren Festplatte auf dieselbe oder eine gr√∂√üere Festplatte versch√ºttet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben alle Programme, die wir ben√∂tigen, sowie die Remoteserver-Verwaltungstools f√ºr Windows 10 in das System integriert. Ich habe Windows 10 1903, ich habe es f√ºr 1803 installiert und alles, was gestartet werden muss. Sie k√∂nnen es hier herunterladen:</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.microsoft.com/en-us/download/details.aspx?id=45520</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Wir ben√∂tigen es f√ºr das Dienstprogramm netdom, mit dem Sie den Computer automatisch in die Dom√§ne eingeben k√∂nnen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dazu laden wir Dateien von hier </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/valmont2k/renamejoin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in das Verzeichnis c: \ renamejoin herunter. Wir erstellen einen Dom√§nenadministrator auf dem Dom√§nencontroller mit der M√∂glichkeit, Computer nur mit dem Joinadmin-Login mit dem Kennwort password1234QWE in die Dom√§ne einzugeben. Wenn ein Angreifer dieses Kennwort abf√§ngt, kann er nur Computer in unsere Dom√§ne bringen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºhren Sie die Zeile von createtesk.txt in der Administratorkonsole des vollst√§ndig vorbereiteten Windows aus, wodurch eine Aufgabe zum Starten beim Booten erstellt wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das gesamte Schema funktioniert wie folgt:</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn wir das Bild in alle Computer aufgeteilt, beim ersten Start wird Windows eine Aufgabe starten </font></font><code>C:\renamejoin\step1.cmd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die auf den Computer umbenennt </font></font><code>win-%random%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, den Computer neu starten, L√∂schen </font></font><code>C:\renamejoin\step1.cmd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und Umbenennen </font></font><code>C:\renamejoin\step2.cmd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zu </font></font><code>C:\renamejoin\step1.cmd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Beim n√§chsten Start wird Windows gestartet </font></font><code>C:\renamejoin\step1.cmd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, wodurch dieser Computer in die Dom√§ne eingegeben </font><font style="vertical-align: inherit;">, neu gestartet </font><font style="vertical-align: inherit;">und gel√∂scht wird </font></font><code>C:\renamejoin\step1.cmd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Wir k√∂nnen die potenziell gef√§hrliche Aufgabe sp√§ter von den Dom√§nencomputern entfernen. Nat√ºrlich √ºber OPSI! </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ft/58/nn/ft58nnalinh1dzsqyx2clhilaym.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist Zeit, das vorbereitete Windows in ein Image zu konvertieren.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºgen Sie unseren Computer √ºber das Computersymbol mit einem Pluszeichen zur von opsi opsi konfigurierten Verwaltungsoberfl√§che hinzu und legen Sie die Mohnadresse fest. </font><font style="vertical-align: inherit;">Speichern. </font><font style="vertical-align: inherit;">Wir gehen zu Netboot-Produkten √ºber, gegen√ºber von Clonezilla setzen wir "Setup". </font><font style="vertical-align: inherit;">In der Konfiguration f√ºr den Client machen wir alles wie im Screenshot verf√ºgbar: den Namen der Datei und den Befehl, mit dem wir die gesamte Festplatte in das Image f√ºllen. </font><font style="vertical-align: inherit;">Im BIOS des Computers mit Windows legen wir den Download aus dem Netzwerk fest. </font><font style="vertical-align: inherit;">Starten Sie den Comp neu. </font><font style="vertical-align: inherit;">Wenn Sie alles richtig gemacht haben, werden Sie sehen, wie Windows ohne die Hilfe von H√§nden in das Bild flie√üt. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wu/zi/e6/wuzie6bgshbkngnutgpsqw9lfz0.png" width="500" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der Zwischenzeit werden Computer zusammengebaut, aber sie m√ºssen zusammen mit ihren Mohnadressen als Clients in opsi hinzugef√ºgt werden. Das Hinzuf√ºgen mit Stiften ist √ºberhaupt keine Bojarenangelegenheit, oder? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die L√∂sung ist:</font></font><br>
<br>
<pre><code class="bash hljs">apt install tcpdump</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf opsiserver ausf√ºhren:</font></font><br>
<br>
<pre><code class="bash hljs">tcpdump -n udp -vvvvv -e port 69 &gt; /var/<span class="hljs-built_in">log</span>/tftp</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie die BIOS-Einstellungen f√ºr alle Computer so einstellen, dass sie √ºber das Netzwerk booten (und gleichzeitig von PCI-E-Ger√§ten √ºber das Netzwerk aufwachen, werden Sie sp√§ter verstehen, warum), laden Sie sie. Wenn das blaue Fenster des opsi-Startmen√ºs w√§hrend des Startvorgangs angezeigt wird, machen </font></font><br>
<br>
<img src="https://habrastorage.org/webt/po/7c/h7/po7ch7eco5daftbhmaqr3fspcjs.png" width="500" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie alles richtig. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beim Booten greifen Computer auf unseren Server zu, tcpdump schreibt ihre </font><font style="vertical-align: inherit;">Mohnadressen </font><font style="vertical-align: inherit;">in eine Datei </font></font><code>/var/log/tftp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und verwendet ein Repo-Skript </font></font><code>https://github.com/valmont2k/opsi-hosts-importer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, um auf opsiserver ausgef√ºhrt zu werden, nachdem alle Computer in opsi markiert sind und ihre Mohnadressen dort belassen. Dieses Skript verwendet die opsi-API von hier </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://download.uib.de/opsi4.1/experimental/documentation/html/opsi-api-documentation/opsi_API.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und ein bisschen Magie. Nach dem Start haben Sie Clients auf opsiserver der Form win% random32% .domain.local</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der n√§chste Schritt besteht darin, das Windows-Image (was bereits geschehen sein sollte) auf alle Computer zu √ºbertragen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yn/6g/ik/yn6gikht6l5aizhym_t839uk7mo.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
W√§hlen Sie dazu alle Computer aus, auf denen Sie Windows installieren m√ºssen, und stellen Sie gegen√ºber Clonezilla die Werte wie im Screenshot ein. Sie schalten die Computer aus, dann mehrere nacheinander ein und beobachten, wie Windows automatisch auf sie rollt. Sie selbst werden umbenannt und in die Dom√§ne eingegeben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie dies auch automatisieren m√∂chten, setzen Sie etherwake und schreiben Sie ein Skript, das mit einer bestimmten Verz√∂gerung die Mac-Adressen aus der Datei / tmp / newmacs √ºbernimmt und deren Hosts aktiviert, sodass sie abwechselnd Windows rollen. Siehe </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Update 1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich machte eine Geste von Ronaldo aus einer Werbung f√ºr Shampoo und packte bereits f√ºr Kaffee, als Ilon Mask erneut auf meinem Handy anrief und hinzuf√ºgte:</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Ja, ich habe vergessen zu sagen, es ist notwendig, dass die </font></font><code>%program%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">neueste Version </font><font style="vertical-align: inherit;">morgen auf allen Computern </font><font style="vertical-align: inherit;">verf√ºgbar ist. </font><font style="vertical-align: inherit;">K√∂nnen </font><font style="vertical-align: inherit;">Sie damit umgehen? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Nat√ºrlich wird alles morgen sein! </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich kann das Idol der Technokraten nicht ver√§rgern, also m√ºssen Sie Ihr Gehirn wieder in Ihre H√§nde legen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es w√§re sch√∂n, wenn sich die Computer beim Start einen opsi-Client namens opsi-client-agent einrichten w√ºrden. Dies kann √ºber Dom√§nengruppenrichtlinien erfolgen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Damit dies w√§hrend der Installation ohne Eingabe eines Kennworts geschieht, m√ºssen </font><font style="vertical-align: inherit;">
Sie das Kennwort Ihres Benutzers </font><font style="vertical-align: inherit;">in der </font><font style="vertical-align: inherit;">Datei </font></font><br>
<code>/var/lib/opsi/depot/opsi-client-agent/files/opsi/cfg/config.ini</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auf opsiserver </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">als Wert f√ºr service_hidden_password hinzuf√ºgen</font></font><code>adminuser</code><font style="vertical-align: inherit;"></font><code>base64</code><br>
<br>
<pre><code class="plaintext hljs">[installation]<font></font>
service_user=adminuser<font></font>
service_password=none<font></font>
service_hidden_password=base64HERE</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºgen Sie als N√§chstes die Gruppenrichtlinie in die setupOPSI-Dom√§ne ein und √ºbernehmen Sie das entsprechende Skript. </font></font><code>https://github.com/valmont2k/opsi-install-opsi-client-agent-over-active-directory-domain-policy</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Denken Sie daran, Ihre Werte in das Skript einzuf√ºgen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pi/bq/gr/pibqgrvntzwy6vlhvkwljjs4fki.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie alles richtig gemacht haben, werden die Clients beim ersten Neustart in der Dom√§ne installiert </font></font><code>opsi-client-agent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, neu gestartet und unter ihren Namen </font></font><code>win-%random%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in der OPSI-Verwaltungsoberfl√§che angezeigt. </font><font style="vertical-align: inherit;">Alte Kunden mit denselben Mohnadressen k√∂nnen gel√∂scht werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt k√∂nnen Sie mit der Installation fortfahren </font></font><code>%program%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir gehen hier </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://forum.opsi.org/viewtopic.php?f=22&amp;t=7573</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und finden einen Link zu dem Paket </font></font><code>*.opsi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mit dem Namen </font></font><code>packagebuilder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, so etwas wie </font></font><code>"opsi PackageBuilder Windows (opsi Paket)"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Laden Sie das Paket in das Verzeichnis </font></font><code>/var/lib/opsi/workbench</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auf opsiserver herunter</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> /var/lib/opsi/workbench</code></pre><br>
<pre><code class="bash hljs">wget https://opsipackagebuilder.s3.amazonaws.com/opsiPackageBuilder/python/opsipackagebuilder_8.4.4-1.opsi </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
und installieren Sie es:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-package-manager -d ALL -i opsipackagebuilder_8.4.4-1.opsi</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Klicken Sie nun in der Opsi-Verwaltungsoberfl√§che auf die Schaltfl√§che "Aktualisieren" und sehen Sie, dass wir neue Pakete </font></font><code>opsipackagebuilder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und haben </font></font><code>opsi-setup-detector</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben sie √ºber die Steueroberfl√§che auf einem Testcomputer unter Windows bereitgestellt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn das Programm </font></font><code>opsipackagebuilder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>opsi-setup-detector</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">etabliert, laufen </font></font><code>opsi-setup-detector</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und spielen off es auf das Installationsprogramm </font></font><code>windirstat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, von der offiziellen Website Pre-Programm heruntergeladen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vor der Installation m√ºssen Sie die Programmeinstellungen konfigurieren. Wir montieren den Ball auf der Testmaschine \\ opsiserver.domain.local \ opsi_workbench als Laufwerk z: Wir schreiben unseren Namen und unsere Mail in die angegebenen Felder: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/a3/zx/gz/a3zxgzhluvq6-vb6utpdveqfoqi.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OPSI kann ein Paket mit 32 und 64 Installationsprogrammen gleichzeitig erstellen und diese basierend auf der Systemkapazit√§t festlegen. Wir haben √ºberall 64 Bit, also klicken Sie auf "Einzelne Datei analysieren ...":</font></font><br>
<br>
<img src="https://habrastorage.org/webt/n-/ev/s9/n-evs94sic7qrqsafbish6zhjno.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir sehen, dass der Detektor das Installationsverzeichnis nicht verstanden hat. Wir k√∂nnen es selbst herausfinden, indem wir versuchen, das Programm √ºber das Installationsprogramm zu installieren. Er erkannte jedoch den Typ des Installationsprogramms, die Version des Programms, die Gr√∂√üe der Anwendung in zusammengesetzter und bereitgestellter Form, den Offline-Installationsschl√ºssel, den Offline-Entfernungsschl√ºssel und den Namen Deinstallationsprogramm. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vh/u7/ys/vhu7ysu1f6hjlkxbvuetosk2xcu.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir geben das Installationsverzeichnis selbst ein und klicken auf Weiter. Schritt: </font></font><br>
<img src="https://habrastorage.org/webt/wl/lx/nf/wllxnfx3gtvrhtdspigvxznyply.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier k√∂nnen Sie den Produktnamen, seine ID und Beschreibung hinzuf√ºgen und die Version des Pakets festlegen, dh den Versuch unternehmen, das Paket zusammenzustellen (in unserem Fall den ersten Versuch): </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ip/_g/fa/ip_gfarn7c49hwtnvhdy0cnxesm.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie k√∂nnen Abh√§ngigkeiten hinzuf√ºgen, dies bedeutet, dass f√ºr die Installation des aktuellen Pakets die Pakete selbst zur Installation bereitgestellt werden, die in den Anforderungen f√ºr unser </font></font><br>
<br>
<img src="https://habrastorage.org/webt/be/mn/os/bemnosq2zhjnugxp5ywu8ahysqi.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Paket angegeben sind: OPSI-Paket erstellen: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vd/s8/-2/vds8-2ho3zriw5pt7l4dtjouhpq.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben das Paket erstellt, jetzt m√ºssen wir zu opsiserver in gehen</font></font><code>/var/lib/opsi/workbench/windirstat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Paket sammeln:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-makepackage</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es installieren:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-package-manager -d ALL -i windirstat-1.1.2-1.opsi</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn alles gut gegangen ist, klicken Sie in der von opsi konfigurierten Verwaltungsoberfl√§che auf die Schaltfl√§che "Aktualisieren" und sehen Sie, dass wir ein neues Paket haben </font></font><code>windirstat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, das auf ausgew√§hlten Computern in unserem Netzwerk installiert werden kann. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bingo! </font><font style="vertical-align: inherit;">Das erste Paket ist zusammengebaut! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um unsere Aufgabe zu verkomplizieren, erstellen wir mithilfe von Powershell eine Regel in der Windows-Firewall, die dem Client Zugriff auf die Ports 4441 und 4447 gew√§hrt, und lassen diese Anwendung f√ºr den Benutzer durch die Registrierungsoptimierung automatisch laden, als w√§re es beispielsweise ein Messenger. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Opsi Package Builder </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ry/35/br/ry35brmfbx9wcefpvejn45ofq1i.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√∂ffnen </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">W√§hlen Sie diese Option, um das Paket zu √∂ffnen und unser Paket mit windirstat zu √∂ffnen:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7q/fi/tb/7qfitbgjqlx1kceksjhko2qokc0.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OPSI verh√§lt sich standardm√§√üig wie folgt: Wenn Sie ein Programm aus uninstall.opsiscript entfernen, wird delsub.opsiscript aufgerufen, wodurch das Programm entfernt wird. Bei der Installation eines Programms aus setup.opsiscript wird delsub.opsiscript aufgerufen, wodurch das Programm entfernt und dann durch setup.opsiscript installiert wird. Daher nehmen wir √Ñnderungen vor, um etwas in setup.opsiscript zu erstellen, und √Ñnderungen, um etwas in delsub.opsiscript zu l√∂schen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die ganze Magie dieser Skripte spiegelt sich in der Dokumentation wider. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Https://download.uib.de/opsi4.1/documentation/html/en/opsi-winst-manual/opsi-winst-manual.html</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
setup.opsiscript kann √ºber das Stiftsymbol ge√∂ffnet werden delsub.opsiscript √ºber Script Tree. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bk/_s/y_/bk_sy_fdgjsl6x4lbokjcrtjhc0.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier ist das komplette Dateimen√º. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/o9/wc/lb/o9wclbi4d3hob_bx9mdrlibnxwi.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jeder Versuch, ein Paket zu erstellen, sollte um eins erh√∂ht werden.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/km/8n/ry/km8nrypi8ie323expcio-ms0kum.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir f√ºgen das Programm √ºber opsi zum automatischen Laden hinzu. F√ºgen Sie dazu die Zeilen in setup.opsiscript ein:</font></font><br>
<br>
<pre><code class="plaintext hljs">Registry_changes  /AllNTUserdats /64bit<font></font>
[Registry_changes]<font></font>
OpenKey [Software\Microsoft\Windows\CurrentVersion\Run]<font></font>
Set "WinDirStat" = "C:\Program Files (x86)\WinDirStat\windirstat.exe"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºgen Sie in delsub.opsiscript die folgenden Zeilen ein:</font></font><br>
<br>
<pre><code class="plaintext hljs">Registry_changes  /AllNTUserdats /64bit<font></font>
[Registry_changes]<font></font>
OpenKey [HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run]<font></font>
;Set "WinDirStat" = "C:\Program Files (x86)\WinDirStat\windirstat.exe"<font></font>
DeleteVar "WinDirStat"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir f√ºgen der Firewall die Regel hinzu, indem wir das Powershell-Skript ausf√ºhren. F√ºgen Sie dazu die Zeilen in setup.opsiscript ein:</font></font><br>
<br>
<pre><code class="plaintext hljs">DosInAnIcon_PowerShell_ExecutionPolicy<font></font>
ExecWith_PowerShell_NichtPDCAktionen powershell.exe winst /sysnative<font></font>
[DosInAnIcon_PowerShell_ExecutionPolicy]<font></font>
echo "powershell set-executionpolicy RemoteSigned ..."<font></font>
powershell.exe set-executionpolicy RemoteSigned<font></font>
exit %ERRORLEVEL%<font></font>
<font></font>
[ExecWith_PowerShell_NichtPDCAktionen]<font></font>
; hier Dein PS-Code<font></font>
<font></font>
New-NetFirewallRule -DisplayName 'OPSI-Inbound' -Profile @('Domain', 'Private', 'Public') -Direction Inbound -Action Allow -Protocol TCP -LocalPort @('4441', '4447')</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºgen Sie in delsub.opsiscript die folgenden Zeilen ein:</font></font><br>
<br>
<pre><code class="plaintext hljs">DosInAnIcon_PowerShell_ExecutionPolicy<font></font>
ExecWith_PowerShell_NichtPDCAktionen powershell.exe winst /sysnative<font></font>
[DosInAnIcon_PowerShell_ExecutionPolicy]<font></font>
echo "powershell set-executionpolicy RemoteSigned ..."<font></font>
powershell.exe set-executionpolicy RemoteSigned<font></font>
exit %ERRORLEVEL%<font></font>
<font></font>
[ExecWith_PowerShell_NichtPDCAktionen]<font></font>
; hier Dein PS-Code<font></font>
Remove-NetFirewallRule -DisplayName 'OPSI-Inbound'</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der vollst√§ndige Code kann hier eingesehen werden: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/valmont2k/WinDirStatOpsiPackageTest</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ich habe mich bereits entspannt und beobachtet, wie opsi die </font></font><code>%program%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">neueste Version auf das gesamte Netzwerk √ºbertr√§gt, als Ilon meine Gedanken in der H√∂he erneut unterbrach. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - N√§chste Woche werden weitere 500 Personen kommen, B√ºros wurden bereits angemietet, Computer werden importiert, es gibt einen Netzwerker, Sie m√ºssen ein Windows-Netzwerk in sechs Filialen in der Stadt bereitstellen. K√∂nnen Sie damit umgehen? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Nun, das ist nat√ºrlich keine Raketenwissenschaft - ich scherzte m√ºde als Antwort. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir klonen unseren Opsiserver-Server mit dem Hypervisor und stellen ihn in der Zweigstelle bereit. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir gehen davon aus, dass die Zentrale √ºber ein VPN mit einer Geschwindigkeit von mindestens 10 Mbit / s mit Zweigstellen verbunden ist.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt erstellen wir einen Depotserver, dh einen Server zum Speichern von Paketen in der Verzweigung. </font><font style="vertical-align: inherit;">Clients in der Zweigstelle klopfen auf https an den Hauptserver. Wenn Sie Software installieren m√ºssen, mounten sie den Depotserver in Ihrer Zweigstelle und werden von dort aus installiert. Dies geschieht insbesondere, um den Internetkanal zwischen dem B√ºro und der Zweigstelle zu speichern. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir konfigurieren auf dem Zweigstellenserver opsiserver-2 eine statische Adresse aus dem lokalen Netzwerk, die die Datei </font></font><code>/etc/network/interfaces</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entsprechend dem neuen Netzwerk </font><font style="vertical-align: inherit;">√§ndert </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hostnamen und Hosts √§ndern:</font></font><br>
<br>
<pre><code class="bash hljs">sed -i <span class="hljs-string">'s/opsiserver/opsiserver-2/'</span> /etc/hostname<font></font>
sed -i <span class="hljs-string">'s/opsiserver/opsiserver-2/g'</span> /etc/hosts</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In / etc / hosts aktualisieren wir die Daten, indem wir eine neue IP-Adresse eingeben </font></font><br>
<br>
<pre><code class="bash hljs">reboot</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Benennen Sie den opsi-Server mit opsi um:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-admin --no-depot -d method host_renameOpsiDepotserver opsiserver.domain.local opsiserver-2.domain.local</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vom Server opsiserver-2.domain.local verbinden wir ihn als Depot mit opsiserver.domain.local:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-setup --register-depot</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Geben Sie den Namen des Hauptservers an, mit dem wir das neue Depot, den Administrator und das Kennwort verbinden: Hier </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yx/02/y_/yx02y_bcvpikxgkubku2-fl8try.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
m√ºssen </font><font style="vertical-align: inherit;">Sie </font><font style="vertical-align: inherit;">nichts √§ndern </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">Sie </font></font><br>
<br>
<img src="https://habrastorage.org/webt/n2/1j/_l/n21j_lmeiwlsn3ghmkcxr4yadgg.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
k√∂nnen √ºberpr√ºfen, ob in opsi-configed alles korrekt ausgef√ºhrt wurde: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6u/s9/nu/6us9nurw4d3rsetl0nemcy_x_re.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als N√§chstes m√ºssen Sie das System so konfigurieren, dass Clients den </font><font style="vertical-align: inherit;">Depotserver </font><font style="vertical-align: inherit;">f√ºr sich selbst ausw√§hlen. Wir w√§hlen alle Kunden aus und setzen ihnen ein dynamisches Depot. Standardm√§√üig √ºberpr√ºft der Client seine IP-Adresse und w√§hlt das Depot aus seinem Netzwerk aus. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vp/4v/mg/vp4vmg0czhi2vmkwobeddecf1dc.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt konfigurieren wir, dass alle zuk√ºnftigen Clients das Depot sofort dynamisch ausw√§hlen: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/h7/-j/c4/h7-jc4kpf-5vyavsz_mckjp44-a.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das ist alles, die Einrichtung des neuen Depotservers ist abgeschlossen. Sie k√∂nnen den opsi-client-agent f√ºr Computer im lokalen Netzwerk mit demselben Skript installieren, das wir zuvor im Hauptb√ºro installiert haben, nicht Vergessen, die IP-Adresse im Skript zu √§ndern.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In jedem Zweig legen wir einen Dom√§nencontroller fest (Sie k√∂nnen schreibgesch√ºtzt), f√ºhren unsere eigene Netzwerkadressierung durch und teilen den Standardstandort innerhalb der Windows-Dom√§ne in Unterstandorte auf, von denen jeder unser Subnetz, unsere Gruppenrichtlinie, mit seinem Installationsskript opsi-client-agent erstellt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dann wiederholen wir im neuen Zweig. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich trank meinen Kaffee aus und ging nach Hause. Die LED auf der Netzwerkkarte signalisierte, dass neue und neue Systeme im L√§rm von K√ºhlern eingef√ºhrt wurden ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Update 1: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie sich herausstellte, ist kein Skript erforderlich. Mit opsi-configed kann die Maus √ºber den Sheduler auf das Erwachen von Clients klicken.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de497814/index.html">F√ºnf Stufen, um das Unvermeidliche zu akzeptieren, oder wie wir ein Programm f√ºr die automatisierte Profilerstellung entwickelt haben</a></li>
<li><a href="../de497816/index.html">Die Russische Eisenbahn schickt mir die Tickets eines anderen</a></li>
<li><a href="../de497818/index.html">Remotezugriff auf VMs mit GPU √ºber Citrix</a></li>
<li><a href="../de497820/index.html">Statistische Regularisierung falscher inverser Probleme zu ihnen. Turchin (Teil 1)</a></li>
<li><a href="../de497822/index.html">Mann in einer Flasche</a></li>
<li><a href="../de497828/index.html">2 in 1: Verschl√ºsselung mit Sicherheitsschutz</a></li>
<li><a href="../de497830/index.html">OWASP Moskau 2020/1 Aufnahmen</a></li>
<li><a href="../de497832/index.html">Was steckt hinter VestaCP?</a></li>
<li><a href="../de497834/index.html">Erweitertes Ressourcenautorisierungssystem in Laravel. Teil 2. Gateways, Richtlinien</a></li>
<li><a href="../de497836/index.html">Vergleich der Geschwindigkeit von Programmiersprachen am Beispiel der L√∂sung des Problems des Trainings eines neuronalen Netzwerks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>