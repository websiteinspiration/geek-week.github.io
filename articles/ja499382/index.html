<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¨ğŸ¿â€ğŸ¤â€ğŸ‘¨ğŸ½ ğŸ‘¦ğŸ¼ ğŸ›ï¸ IDAPythonã®æ¦‚è¦ ğŸ•´ğŸ¼ ğŸš¿ ãŠ—ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ãƒ­ã‚·ã‚¢èªï¼ˆç‰¹ã«Habrï¼‰ã§ã®IDAPythonã®ä½¿ç”¨ã«é–¢ã™ã‚‹è¨˜äº‹ã¯å¤šãã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã®ã‚®ãƒ£ãƒƒãƒ—ã‚’åŸ‹ã‚ã‚‹ã‚ˆã†ã«åŠªã‚ã¾ã™ã€‚
 

èª°ã®ãŸã‚ã€‚IDA Proã§ã®ä½œæ¥­æ–¹æ³•ã¯ã™ã§ã«çŸ¥ã£ã¦ã„ã‚‹ãŒã€IDAPythonã§ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¨˜è¿°ã—ãŸã“ã¨ãŒãªã„äººå‘ã‘ã€‚IDAPythonç”¨ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½œæˆçµŒé¨“ãŒã‚ã‚‹å ´åˆã¯ã€ã“...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>IDAPythonã®æ¦‚è¦</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/inforion/blog/499382/"><p><img src="https://habrastorage.org/webt/b0/a_/8p/b0a_8p8ag-waoet-be1zrnkh_fy.png"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ­ã‚·ã‚¢èªï¼ˆç‰¹ã«Habrï¼‰ã§ã®IDAPythonã®ä½¿ç”¨ã«é–¢ã™ã‚‹è¨˜äº‹ã¯å¤šãã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã®ã‚®ãƒ£ãƒƒãƒ—ã‚’åŸ‹ã‚ã‚‹ã‚ˆã†ã«åŠªã‚ã¾ã™ã€‚</font></font></p><br>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èª°ã®ãŸã‚ã€‚</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IDA Proã§ã®ä½œæ¥­æ–¹æ³•ã¯ã™ã§ã«çŸ¥ã£ã¦ã„ã‚‹ãŒã€IDAPythonã§ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¨˜è¿°ã—ãŸã“ã¨ãŒãªã„äººå‘ã‘ã€‚</font><font style="vertical-align: inherit;">IDAPythonç”¨ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½œæˆçµŒé¨“ãŒã‚ã‚‹å ´åˆã¯ã€ã“ã“ã§æ–°ã—ã„ã‚‚ã®ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ã¯ã»ã¨ã‚“ã©ã‚ã‚Šã¾ã›ã‚“ã€‚</font></font></p><br>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã“ã«ã¯ãªã„ã‚‚ã®ã€‚</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IDA Proã§ã®Pythonãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã¨åŸºæœ¬çš„ãªä½œæ¥­ã«ã¤ã„ã¦ã¯èª¬æ˜ã—ã¾ã›ã‚“ã€‚</font></font></p><a name="habracut"></a><br>
<h2 id="0x00-znakomstvo"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x00ã€‚</font><font style="vertical-align: inherit;">çŸ¥ã‚Šåˆã„</font></font></h2><br>
<p>   , IDAPython â€”  -  Python,    IDA   .  IDAPython  ""  IDC ( -   IDA Pro).</p><br>
<p> , IDAPython     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>,       API        .  IDAPython    <em>python</em>  IDA (  <em>C:\Program Files\IDA 7.0\python</em>).</p><br>
<p>      IDA Pro  7.0. IDAPython    IDA     "" (   ).   IDA  7.4  <strong>Python 2.7 64-bit</strong>.</p><br>
<h3 id="primechanie"></h3><br>
<p>  7-   IDAPython  API,    7.4    API.  <em>idc_bc695.py</em>   ,   -   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>.        2017    API,        .</p><br>
<h2 id="0x01-v-pervom-priblizhenii">0x01.   </h2><br>
<p> IDAPython â€”   ,    <em></em>,       ,      .</p><br>
<p>      :</p><br>
<ul>
<li> ,</li>
<li> /,</li>
<li> / (  ,     ),</li>
<li> -   /,</li>
<li> .</li>
</ul><br>
<p>,      â€”    .</p><br>
<h3 id="prinyatye-oboznacheniya-i-soglasheniya">   </h3><br>
<p>   IDAPython    :</p><br>
<ul>
<li><code>ea</code> â€” Effective Address â€”    IDA,       ;</li>
<li> <code>here()</code>   ,     Disassembly-.    â€” <em>long</em>;</li>
<li>     <em>idc</em>,     .      ,        ;</li>
<li>  ""   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  </a>   ELF.</li>
</ul><br>
<h3 id="kak-vypolnit-kod">  </h3><br>
<p>  IDAPython   :</p><br>
<ul>
<li>      IDA;</li>
<li>    <strong>File â€” Script file (Alt + F7)</strong>;</li>
<li>    <strong>File â€” Script command (Shift + F2)</strong>;</li>
<li> IDA Pro      <em>-S</em>.</li>
</ul><br>
<p>   .</p><br>
<h3 id="komandnaya-stroka-ida-cli">  IDA CLI</h3><br>
<p>      IDA.   ,      ,       Python.</p><br>
<p><img src="https://habrastorage.org/webt/ze/yv/4g/zeyv4gkilkp0bfiv-u4a2l39qky.png"><br>
<em>   Python    CLI</em></p><br>
<h3 id="osobennosti-ida-cli"> IDA CLI</h3><br>
<ul>
<li>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  Python</a>.</li>
<li>   (, , )    ,      .</li>
<li>       Tab.</li>
<li>         .</li>
<li> <em>help</em>  <em>dir</em>     Python      .</li>
<li>      <strong>Output window</strong> (Alt + 0).</li>
</ul><br>
<h3 id="primer"></h3><br>
<p> <em>Segments</em>   <em>idautils</em>  ,       IDA.        <strong>Output window</strong>      IDA CLI:</p><br>
<pre><code class="plaintext hljs">Python&gt;import idautils<font></font>
Python&gt;help(idautils.Segments)<font></font>
Help on function Segments in module idautils:<font></font>
Segments()<font></font>
Get list of segments (sections) in the binary image<font></font>
@return: List of segment start addresses.<font></font>
Python&gt;for ea in idautils.Segments():<font></font>
Python&gt; print("%08x %s" % (ea, idc.get_segm_name(ea)))<font></font>
Python&gt;<font></font>
08000000 .isr_vector<font></font>
080000c0 .text<font></font>
08006f9c .rodata<font></font>
08007a14 .init_array<font></font>
08007a18 .fini_array<font></font>
20000000 .data<font></font>
200001f8 .bss<font></font>
200006c8 ._user_heap_stack<font></font>
200017f8 abs</code></pre><br>
<h3 id="script-file">Script File</h3><br>
<p>      <strong>File â€” Script file</strong> (Alt + F7)    . </p><br>
<p>                (Hex / Char / Decimal).       <code>op_</code>,    :</p><br>
<ul>
<li><code>op_bin(ea, n)</code> â€”     ;</li>
<li><code>op_dec(ea, n)</code> â€”     ;</li>
<li><code>op_oct(ea, n)</code> â€”     ;</li>
<li><code>op_hex(ea, n)</code> â€”    hex-;</li>
<li><code>op_chr(ea, n)</code> â€”     ;</li>
<li><code>op_seg(ea, n)</code> â€”       ;</li>
<li><code>op_stkvar(ea, n)</code> â€”     ;</li>
<li><code>op_stroff(ea, n)</code> â€”     ;</li>
<li><code>op_enum(ea, n)</code> â€”     ENUM-;</li>
<li><code>op_plain_offset(ea, n, base)</code> â€”       .</li>
</ul><br>
<p>:</p><br>
<ul>
<li><code>ea</code> â€” ,     ;</li>
<li><code>n</code> â€”     (  );     <code>mov eax, 0x10</code>:<br>
<ul>
<li><code>eax</code> â€” 0- ;</li>
<li><code>0x10</code> â€” 1- ;</li>
</ul></li>
<li><code>base</code> â€”    offset- () .</li>
</ul><br>
<p>  IDA 7.0  Python 2.7,          (   ).<br>
      :</p><br>
<pre><code class="python hljs"><span class="hljs-comment"># coding: utf-8</span>
<span class="hljs-string">""" 
File: transforms.py
   
"""</span><font></font>
<font></font>
START = <span class="hljs-number">0x08000038</span>
END = <span class="hljs-number">0x08000084</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">make_offsets32</span>(<span class="hljs-params">start_ea, end_ea</span>):</span>
    <span class="hljs-string">"""     """</span>
    <span class="hljs-keyword">for</span> ea <span class="hljs-keyword">in</span> xrange(start_ea, end_ea, <span class="hljs-number">4</span>):<font></font>
        idc.op_plain_offset(ea, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">make_dwords</span>(<span class="hljs-params">start_ea, end_ea</span>):</span>
    <span class="hljs-string">"""   32-   hex-"""</span>
    <span class="hljs-keyword">for</span> ea <span class="hljs-keyword">in</span> xrange(start_ea, end_ea, <span class="hljs-number">4</span>):<font></font>
        idc.op_hex(ea, <span class="hljs-number">0</span>)<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<font></font>
    make_dwords(START, END)</code></pre><br>
<p>      Python,          IDA.       <code>make_dwords</code>   START   END.    ,     ,         IDA CLI.</p><br>
<p>       IDA   <strong>Recent scripts</strong> ( View â€” Recent scripts <strong>Alt + F9</strong>):</p><br>
<p><img src="https://habrastorage.org/webt/sj/h9/jz/sjh9jz75rifjjf_l2kxyuhcwwoi.png"></p><br>
<p><strong> </strong>:      IDAPython-,     ,          IDA,   Python 2    ,  IDA      .</p><br>
<h3 id="script-command">Script Command</h3><br>
<p> <strong>File â€” Script command</strong> (Shift + F2)         IDA.  ,  ,           .       ,     .</p><br>
<p>      .       <strong>Run</strong>.</p><br>
<p><img src="https://habrastorage.org/webt/qc/xs/42/qcxs42tfl3lvnl-mcagus5brt2y.png"></p><br>
<h3 id="zapusk-ida-c-klyuchom--s"> IDA c  -S</h3><br>
<p>IDA Pro,    ,       .           (  F1)   <strong>Command line switches</strong>.</p><br>
<p>   ,     :</p><br>
<p><code>&gt; "C:\Program Files\IDA 7.0\ida.exe" -A -Sscript_name.py rhino.idb</code></p><br>
<ul>
<li><strong>-A</strong>        ,</li>
<li><strong>-S</strong>     script_name.py    IDB-.</li>
</ul><br>
<h3 id="vvodvyvod">/</h3><br>
<p>      :</p><br>
<ul>
<li> print     <strong>Output window</strong> (Alt + 0);</li>
<li>      <strong>Output window</strong>    Disassembly-     ,      IDA.     Output window   ,         Disassembly-.</li>
</ul><br>
<pre><code class="plaintext hljs">Python&gt;here()<font></font>
134239060         # 1.    <font></font>
Python&gt;hex(here())<font></font>
0x8005354L        # 2.    <font></font>
Python&gt;"%08x" % here()<font></font>
08005354          # 3.   <font></font>
Python&gt;get_name(here())<font></font>
aErrorWrongHead   # 4.   </code></pre><br>
<ul>
<li> <em>input</em>/<em>raw_input</em>  ;</li>
<li>     <em>ask_</em>-  <em>ida_kernwin</em>  <em>idaapi</em>.</li>
</ul><br>
<p><img src="https://habrastorage.org/webt/cd/rf/vz/cdrfvzz-e-mcewdbjmmsatzclrm.png"></p><br>
<h3 id="otladka-skriptov"> </h3><br>
<p>      IDAPython ,      "" IDA Pro. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>   IDA 7- .</p><br>
<p>    IDAPython-        (  â€” " ").</p><br>
<h3 id="idapyhelper">IDAPyHelper</h3><br>
<p>    ,          ,    .        IDAPython    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">IDAPyHelper</a>,        .</p><br>
<p><img src="https://habrastorage.org/webt/dv/it/cy/dvitcygm-yqfru1e-jfky5tnq2w.png"></p><br>
<h3 id="idapython-cheatsheet">IDAPython Cheatsheet</h3><br>
<p>    IDAPython    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>  .   â€”       .</p><br>
<p><img src="https://habrastorage.org/webt/vy/ti/5x/vyti5xszhtjeyivmgk_aiknxjcy.png"></p><br>
<h2 id="0x02-kommentirovanie-vyzova-funkcii">0x02.   </h2><br>
<p>      .</p><br>
<p>         . ,         ,           (Xrefs   X),      .</p><br>
<p><img src="https://habrastorage.org/webt/pg/rr/j7/pgrrj7xiq5alsa0c5oxv5heuil0.png"></p><br>
<p> ,      ,     .         IDAPython.</p><br>
<p>       <code>memcpy</code>.    ,     11   <code>memcpy</code>.</p><br>
<p><img src="https://habrastorage.org/webt/rk/uz/zf/rkuzzfjua_kes5j_-g-vsfa4tm4.png"></p><br>
<p>      :</p><br>
<ul>
<li>  -   <code>memcpy</code>;</li>
<li>     <code>memcpy</code>   ;</li>
<li>  ;</li>
<li> .</li>
</ul><br>
<p>        :</p><br>
<ul>
<li><code>idautils.CodeRefsTo(func_ea, flow)</code> â€”  ,   -     .  <code>flow</code> ( 0/1)    ,          .    <code>flow = 0</code>;</li>
<li><code>idc.prev_head(ea)</code> â€”       ,          ;</li>
<li><code>idc.get_operand_value(ea, n)</code> â€”   n-    .    ,          .   ARM   : <br>
<ul>
<li><em>R0</em> â€” 0; </li>
<li><em>R1</em> â€” 1; </li>
<li><em>R2</em> â€” 2   ;</li>
</ul></li>
<li><code>idc.get_operand_type(ea, n)</code> â€”   n-    .   : <br>
<ul>
<li><code>o_void = 0</code> â€”    (, NOP);</li>
<li><code>o_reg = 1</code> â€” ; </li>
<li><code>o_mem = 2</code> â€”   ;</li>
<li><code>o_phrase = 3</code> â€”   <em>[Base Reg + Index Reg]</em>, </li>
<li><code>o_displ = 4</code> â€”   <em>[Base Reg + Index Reg + Displacement]</em>;</li>
<li><code>o_imm = 5</code> â€” -;</li>
<li><code>o_far = 6</code> â€” FAR-;</li>
<li><code>o_near = 7</code> â€” NEAR-;</li>
<li>      ;</li>
</ul></li>
<li><code>idc.print_operand(ea, n)</code> â€”    ;</li>
<li><code>idc.set_cmt(ea, comment, repeat)</code> â€”      (. ).</li>
</ul><br>
<h3 id="argumenty-funkcii"> </h3><br>
<p>   ARM       (R0-R3),  :</p><br>
<ul>
<li>      ;</li>
<li> ,    <em>R0</em>, <em>R1</em>, <em>R2</em>   ( memcpy  3 );</li>
<li>      ,   hex-  ,         .</li>
</ul><br>
<h3 id="kommentarii-v-ida">  IDA</h3><br>
<p>   IDA   :</p><br>
<p><strong> </strong> â€”     ,   .   <code>idc.set_cmt(ea, comment, rpt)</code>   <code>repeat = 0</code>:</p><br>
<p><img src="https://habrastorage.org/webt/fs/jh/ky/fsjhkyuqz1creihptpn1xk_z_xg.png"></p><br>
<p><strong>  (repeatable)</strong> â€”       ,       .   <code>idc.set_cmt(ea, comment, rpt)</code>   <code>repeat = 1</code>:</p><br>
<p><img src="https://habrastorage.org/webt/rh/-h/al/rh-halxuz-baaeed2caz3buayzi.png"></p><br>
<p><strong>    ()</strong> â€”   <code>idc.update_extra_cmt(ea, n, comment)</code>:</p><br>
<p><img src="https://habrastorage.org/webt/h4/3d/gp/h43dgpakxlawh-uyvxbem98kx2y.png"></p><br>
<p>      .</p><br>
<h3 id="kod-dlya-kommentirovaniya-vyzovov-funkcii">    </h3><br>
<pre><code class="python hljs"><span class="hljs-comment"># coding: utf-8</span>
<span class="hljs-string">"""
File: funcargs.py
       
"""</span><font></font>
<font></font>
<span class="hljs-keyword">import</span> idautils<font></font>
<font></font>
MEMCPY = <span class="hljs-number">0x08006B26</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_function_arg</span>(<span class="hljs-params">ea, narg</span>):</span>
    <span class="hljs-string">"""  n-   """</span>
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<font></font>
        ea = idc.prev_head(ea)<font></font>
        <span class="hljs-keyword">if</span> idc.get_operand_value(ea, <span class="hljs-number">0</span>) == narg:
            <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">if</span> idc.get_operand_type(ea, <span class="hljs-number">1</span>) <span class="hljs-keyword">in</span> (idc.o_imm, idc.o_mem):<font></font>
        res = <span class="hljs-string">"0x%x"</span> % idc.get_operand_value(ea, <span class="hljs-number">1</span>)
    <span class="hljs-keyword">else</span>:<font></font>
        res = idc.print_operand(ea, <span class="hljs-number">1</span>)  
    <span class="hljs-keyword">return</span> res<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">set_comment_by_args</span>(<span class="hljs-params">func_ea, nargs</span>):</span>
    <span class="hljs-string">"""      """</span>
    <span class="hljs-keyword">for</span> ea <span class="hljs-keyword">in</span> idautils.CodeRefsTo(func_ea, flow=<span class="hljs-number">0</span>):<font></font>
        func_args = []<font></font>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>, nargs):<font></font>
            arg = get_function_arg(ea, i)<font></font>
            func_args.append(arg)<font></font>
        args = <span class="hljs-string">', '</span>.join(a <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> func_args)  <font></font>
        comment = <span class="hljs-string">"(%s)"</span> % args<font></font>
        idc.set_cmt(ea, comment, <span class="hljs-number">0</span>)<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<font></font>
    set_comment_by_args(MEMCPY, <span class="hljs-number">3</span>)</code></pre><br>
<p>        -:</p><br>
<p><img src="https://habrastorage.org/webt/a-/sg/aq/a-sgaq2a_vhvvhq-8zgzjaij0ay.png" title="memcpyé–¢æ•°ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¡¨ç¤ºã™ã‚‹"></p><br>
<h2 id="0x03-poluchenie-argumenta-funkcii">0x03.   </h2><br>
<p>,           <code>get_function_arg</code>:</p><br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_function_arg</span>(<span class="hljs-params">ea, narg</span>):</span>
    <span class="hljs-string">""" n-   (  )"""</span>
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<font></font>
        ea = idc.prev_head(ea)<font></font>
        <span class="hljs-keyword">if</span> idc.get_operand_value(ea, <span class="hljs-number">0</span>) == narg:
            <span class="hljs-keyword">break</span><font></font>
<font></font>
    <span class="hljs-keyword">if</span> idc.get_operand_type(ea, <span class="hljs-number">1</span>) <span class="hljs-keyword">in</span> (idc.o_imm, idc.o_mem):<font></font>
        res = <span class="hljs-string">"0x%x"</span> % idc.get_operand_value(ea, <span class="hljs-number">1</span>)
    <span class="hljs-keyword">else</span>:        <font></font>
        res = idc.print_operand(ea, <span class="hljs-number">1</span>)  <font></font>
<font></font>
    <span class="hljs-keyword">return</span> res</code></pre><br>
<p> ,          ,     .       x86,          .    n-       <code>push</code>   :</p><br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_function_arg_value</span>(<span class="hljs-params">ea, narg</span>):</span>
    <span class="hljs-string">""" 
     n-   (  ).
       .
    """</span>
    i = <span class="hljs-number">0</span>
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<font></font>
        ea = idc.prev_head(ea)<font></font>
        <span class="hljs-keyword">if</span> idc.print_insn_mnem(ea) == <span class="hljs-string">"push"</span>:
            <span class="hljs-keyword">if</span> i == narg: <span class="hljs-keyword">break</span>
            i += <span class="hljs-number">1</span><font></font>
<font></font>
    res = idc.get_operand_value(ea, <span class="hljs-number">0</span>)
    <span class="hljs-keyword">return</span> res</code></pre><br>
<h2 id="0x04-pereimenovanie-funkcii-po-stroke-loga">0x04.     </h2><br>
<p>    â€“        (  , ,    <em>assert</em>).    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  </a>     .          "sendMsg error %s", "recvMsg error"  "freeMsg error".</p><br>
<p><img src="https://habrastorage.org/webt/pc/c-/uy/pcc-uymuv90lbhf6ckuccjeftpa.png"></p><br>
<p>      ,   ,    ,    .    ,       .</p><br>
<p>   ,   ,            <code>sub_8006690</code>:</p><br>
<p><img src="https://habrastorage.org/webt/17/_q/jy/17_qjyx2pieweoltdq1fj862q1s.png"></p><br>
<p>   <code>x_printf</code>.</p><br>
<p>    <code>0x08005034</code>   R0    "sendMsg error %s\r\n".       :         ,     <code>0x08005040</code>:</p><br>
<pre><code class="plaintext hljs">Python&gt;"%08x" % get_operand_value(here(), 1)<font></font>
08005040</code></pre><br>
<p>     ARM     :</p><br>
<ul>
<li>   (   â€“ 2 );</li>
<li>  32-   ,      ,          (PC).</li>
</ul><br>
<p>IDA   ,    ,        .</p><br>
<p>  ,     :</p><br>
<ol>
<li>      <code>x_printf</code>  <code>idautils.CodeRefsTo</code></li>
<li>     ( <em>R0</em>)    <code>idc.get_operand_value</code> (    <code>get_function_arg</code>,   ).</li>
<li>    <code>idc.get_wide_dword</code>.</li>
<li>    <code>idc.get_strlit_contents</code>.</li>
<li>,     .</li>
<li>""       ,  <code>idc.set_name</code>.</li>
</ol><br>
<p>   :</p><br>
<pre><code class="python hljs"><span class="hljs-comment"># coding: utf-8</span><font></font>
<font></font>
<span class="hljs-keyword">import</span> idautils<font></font>
<font></font>
PRINTF = <span class="hljs-number">0x08006690</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_function_arg</span>(<span class="hljs-params">ea, narg</span>):</span>
    <span class="hljs-string">""" n-  """</span>
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<font></font>
        ea = idc.prev_head(ea)<font></font>
        <span class="hljs-keyword">if</span> idc.get_operand_value(ea, <span class="hljs-number">0</span>) == narg:
            <span class="hljs-keyword">break</span><font></font>
<font></font>
    <span class="hljs-keyword">if</span> idc.get_operand_type(ea, <span class="hljs-number">1</span>) == idc.o_mem:<font></font>
        res = idc.get_operand_value(ea, <span class="hljs-number">1</span>)
    <span class="hljs-keyword">else</span>:        <font></font>
        res = idc.BADADDR<font></font>
<font></font>
    <span class="hljs-keyword">return</span> res<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_func_name</span>(<span class="hljs-params">str_log</span>):</span>
    <span class="hljs-string">"""     """</span>
    words = str_log.split(<span class="hljs-string">' '</span>)
    <span class="hljs-keyword">if</span> len(words) &gt; <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> words[<span class="hljs-number">1</span>].startswith(<span class="hljs-string">"error"</span>):
        <span class="hljs-keyword">return</span> words[<span class="hljs-number">0</span>]
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rename_by_log_str</span>(<span class="hljs-params">log_func</span>):</span>
    <span class="hljs-string">""" ,   log_func   """</span>
    <span class="hljs-keyword">for</span> ea <span class="hljs-keyword">in</span> idautils.CodeRefsTo(log_func, <span class="hljs-number">0</span>):<font></font>
        arg = get_function_arg(ea, <span class="hljs-number">0</span>)
        <span class="hljs-keyword">if</span> arg == idc.BADADDR:
            <span class="hljs-keyword">continue</span><font></font>
        str_addr = idc.get_wide_dword(arg)<font></font>
        str_log = idc.get_strlit_contents(str_addr)<font></font>
        func_name = get_func_name(str_log)<font></font>
        <span class="hljs-keyword">if</span> func_name:<font></font>
            print(<span class="hljs-string">"0x%08x - 0x%08x - %s"</span> % (arg, str_addr, func_name))<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<font></font>
    rename_by_log_str(PRINTF)</code></pre><br>
<p>         ,       (   â€“ <code>get_func_name</code>)       .</p><br>
<h2 id="0x05-raskraska-koda-i-dannyh">0x05.    </h2><br>
<p>IDA          .     , , ,    . ,     ,    ,         .</p><br>
<p>   â€“        .</p><br>
<p>      :</p><br>
<ul>
<li><code>idc.get_color(ea, what)</code> â€“    ;</li>
<li><code>idc.set_color(ea, what, color)</code> â€“    ;<br>
<ul>
<li>   RGB   hex-   <strong>0xBBGGRR</strong> (--)</li>
<li> <code>what</code>  <em></em> :<br>
<ul>
<li><code>idc.CIC_ITEM = 1</code> â€“   ;</li>
<li><code>idc.CIC_FUNC = 2</code> â€“  ;</li>
<li><code>idc.CIC_SEGM = 3</code> â€“  .</li>
</ul></li>
</ul></li>
</ul><br>
<p> , </p><br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> i, ea <span class="hljs-keyword">in</span> enumerate(xrange(<span class="hljs-number">0x08005196</span>, <span class="hljs-number">0x080051AE</span>, <span class="hljs-number">2</span>)):<font></font>
    idc.set_color(ea, CIC_ITEM, <span class="hljs-number">0x0f</span> &lt;&lt; (<span class="hljs-number">2</span> * i))</code></pre><br>
<p>      <code>0x08005196</code>  <code>0x080051AE</code>   :</p><br>
<p><img src="https://habrastorage.org/webt/4v/6h/cy/4v6hcyq2pfqskp3pxxhxhf7r7t8.png"></p><br>
<p>  ,    ARM-  ,        ,      :</p><br>
<p><img src="https://habrastorage.org/webt/je/fm/an/jefmanuojywuyn8v-l801npflws.png"></p><br>
<p><strong> </strong>:          .</p><br>
<p>      :</p><br>
<ol>
<li>  .     <code>idautils.Segments()</code>,     .</li>
<li>       .     <code>idc.get_segm_attr(segm, attr)</code>,    .     <code>SEG_CODE</code> ( â€” <code>SEGATTR_TYPE</code>) .</li>
<li>     .    <code>idautils.Heads(start, end)</code>,      (, )     <code>start</code>  <code>end</code>.</li>
<li>   <code>idc.get_full_flags(ea)</code>  <code>is_code(flags)</code> ,       <code>ea</code>.</li>
<li>  .</li>
</ol><br>
<p>     :</p><br>
<pre><code class="python hljs">BLUE = <span class="hljs-number">0xF2D0AF</span>
PINK = <span class="hljs-number">0xAFD0F2</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">colored_code</span>():</span>
    <span class="hljs-string">"""        """</span><font></font>
<font></font>
    code_segmnets = filter(<span class="hljs-keyword">lambda</span> segm: \<font></font>
                          idc.get_segm_attr(segm, SEGATTR_TYPE) == SEG_CODE,\<font></font>
                          idautils.Segments())<font></font>
<font></font>
    <span class="hljs-keyword">for</span> segm <span class="hljs-keyword">in</span> code_segmnets:<font></font>
        end = idc.get_segm_end(segm)<font></font>
        <span class="hljs-keyword">for</span> ea <span class="hljs-keyword">in</span> idautils.Heads(segm, end):<font></font>
            flags = idc.get_full_flags(ea)<font></font>
            <span class="hljs-keyword">if</span> idc.is_code(flags):<font></font>
                idc.set_color(ea, CIC_ITEM, BLUE)<font></font>
            <span class="hljs-keyword">else</span>:<font></font>
                idc.set_color(ea, CIC_ITEM, PINK)</code></pre><br>
<h3 id="primechanie-1"></h3><br>
<p> ,   <code>is_code(flags)</code>  <strong>  </strong>,   .        <code>get_full_flags(ea)</code>.</p><br>
<p>   <code>colored_code</code>    :</p><br>
<p><img src="https://habrastorage.org/webt/4k/yg/uo/4kyguovmqf_st0ydcwujpcptrj0.png"></p><br>
<p>,         IDAPython     ,         ( <code>idautils.Segments</code>  <code>idautils.Heads</code>),   (<code>idc.set_color</code>),      (<code>idc.get_strlit_contents</code>)   (<code>idc.get_wide_dword</code>).</p><br>
<h3 id="ssylki"></h3><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">The Beginner's Guide to IDAPython by Alexander Hanel</a> (      v.5.0, API  IDA  7.x)</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">IDA + Python = IDAPython</a> ( API  IDA  6.x)</li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Using IDAPython to Make Your Life Easier</a>   Palo Alto Networks ( API  IDA  6.x)</li>
<li>-  IDAPython  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Reverse Engineering StackExchange</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  IDAPython</a></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja499370/index.html">ç§ã®ãŠæ°—ã«å…¥ã‚Šã®CSSè³ªå•ã¨è©³ç´°ãªå›ç­”</a></li>
<li><a href="../ja499374/index.html">ä¸€æ¬¡å·®ç•°ã‚’ä½¿ç”¨ã—ãŸCOVID-19å¢—æ®–ãƒ‡ãƒ¼ã‚¿ã®èª¿æŸ»ã€‚ãã—ã¦ã€ãã‚Œã‹ã‚‰æ¥ãŸã‚‚ã®</a></li>
<li><a href="../ja499376/index.html">HackRF Oneã‚’ä¾‹ã«ã—ãŸæœ€æ–°ã®ãƒ©ã‚¸ã‚ªã®ãƒ‡ãƒã‚¤ã‚¹ã«ã¤ã„ã¦å°‘ã—</a></li>
<li><a href="../ja499378/index.html">æœ€åˆã®ã‚µã‚¤ãƒ—ãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆã‚’æ§‹ç¯‰ã™ã‚‹</a></li>
<li><a href="../ja499380/index.html">å°‘ãªãã¨ã‚‚ã„ãã¤ã‹ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã§ï¼ˆä¿®æ­£ï¼šãƒ­ã‚·ã‚¢èªï¼‰æ¤œç´¢ã‚’ä½¿ç”¨ã—ãªã„1000ã®ç†ç”±</a></li>
<li><a href="../ja499386/index.html">æœ¬ã€Œãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã®ä½œæˆã€ã®æ¦‚è¦</a></li>
<li><a href="../ja499394/index.html">ITã‚¸ãƒ£ã‚¤ã‚¢ãƒ³ãƒˆã¨ã®é¢æ¥ã®æº–å‚™ï¼šã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ é¢æ¥ã®å‘ªã„ã‚’å…‹æœã™ã‚‹æ–¹æ³•</a></li>
<li><a href="../ja499396/index.html">1æ—¥ã§æ•°ãƒ˜ã‚¯ã‚¿ãƒ¼ãƒ«ã®ãƒ¡ãƒƒã‚·ãƒ¥ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½œæˆã™ã‚‹</a></li>
<li><a href="../ja499398/index.html">æµ·ã‚’ãã‚Œã„ã«ã™ã‚‹ï¼šæ—¥å…‰ã«ã‚ˆã‚‹ãƒ—ãƒ©ã‚¹ãƒãƒƒã‚¯ã®åˆ†è§£</a></li>
<li><a href="../ja499400/index.html">ç±³å›½éƒµæ”¿å…¬ç¤¾ã¯å†ã³ã‚¢ãƒã‚¾ãƒ³ã®ã›ã„ã§ç ´ç”£ã—ãŸã„ã¨æ€ã£ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã©ã®ã‚ˆã†ã«èµ·ã“ã‚Šã¾ã™ã‹</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>