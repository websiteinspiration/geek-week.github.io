<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë∑üèª üë©üèº‚Äçüéì üçá Sincronizaci√≥n horaria de Linux: NTP, Chrony y systemd-timesyncd üòî üë®‚Äçüç≥ üêç</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La mayor√≠a de la gente lleva la cuenta del tiempo. Nos levantamos a tiempo para realizar nuestros rituales matutinos e ir a trabajar, tomar un descans...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Sincronizaci√≥n horaria de Linux: NTP, Chrony y systemd-timesyncd</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vdsina/blog/505314/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/m-/ts/k3/m-tsk33gxcmkrlh4yuqdaxl4ytk.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La mayor√≠a de la gente lleva la cuenta del tiempo. </font><font style="vertical-align: inherit;">Nos levantamos a tiempo para realizar nuestros rituales matutinos e ir a trabajar, tomar un descanso para almorzar, cumplir con los plazos del proyecto, celebrar cumplea√±os y d√≠as festivos, abordar un avi√≥n, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s: algunos de nosotros estamos obsesionados con el tiempo. </font><font style="vertical-align: inherit;">Mi reloj funciona con energ√≠a solar y recibe la hora exacta del Instituto Nacional de Est√°ndares y Tecnolog√≠a ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NIST</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) en Fort Collins, Colorado a trav√©s de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WWVB Longwave Radio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Las se√±ales horarias se sincronizan con el reloj at√≥mico, tambi√©n ubicado en Fort Collins. </font><font style="vertical-align: inherit;">Mi Fitbit se sincroniza con mi tel√©fono, que se sincroniza con el servidor </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NTP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que finalmente se sincroniza con el reloj at√≥mico.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los dispositivos tambi√©n llevan un registro del tiempo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay muchas razones por las cuales nuestros dispositivos y computadoras necesitan un tiempo preciso. Por ejemplo, en la banca, los mercados de valores y otras empresas financieras, las transacciones deben realizarse en el orden correcto, y las secuencias de tiempo precisas son cr√≠ticas para esto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nuestros tel√©fonos, tabletas, autom√≥viles, sistemas GPS y computadoras requieren configuraciones precisas de hora y fecha. Quiero que el reloj en el escritorio de mi computadora muestre la hora correcta. Quiero que mi calendario local tenga recordatorios en el momento adecuado. La hora correcta tambi√©n garantiza que los trabajos cron y systemd se inicien en el momento adecuado.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fecha y la hora tambi√©n son importantes para el registro, por lo que es un poco m√°s f√°cil encontrar ciertos registros basados ‚Äã‚Äãen la fecha y la hora. </font><font style="vertical-align: inherit;">Por ejemplo, una vez trabaj√© en DevOps (no lo llamaban as√≠ en ese momento) y configur√© un sistema de correo electr√≥nico en Carolina del Norte. </font><font style="vertical-align: inherit;">Sol√≠amos procesar m√°s de 20 millones de correos electr√≥nicos al d√≠a. </font><font style="vertical-align: inherit;">El seguimiento del correo electr√≥nico a trav√©s de una serie de servidores o la determinaci√≥n de la secuencia exacta de eventos utilizando archivos de registro en hosts geogr√°ficamente dispersos puede ser mucho m√°s f√°cil si las computadoras se sincronizan a tiempo.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una vez, muchas horas</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los hosts de Linux deben tener en cuenta que hay una hora del sistema y una hora RTC. RTC (Real Time Clock) es un nombre un poco extra√±o y poco preciso para un reloj de hardware. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El reloj de hardware funciona continuamente incluso cuando la computadora est√° apagada usando la bater√≠a en la placa base del sistema. La funci√≥n principal de RTC es almacenar el tiempo cuando la conexi√≥n al servidor de tiempo no est√° disponible. En aquellos d√≠as en que era imposible conectarse al servidor horario a trav√©s de Internet, cada computadora ten√≠a que tener un reloj interno preciso. Los sistemas operativos ten√≠an que acceder a RTC en el momento del arranque, y el usuario ten√≠a que configurar manualmente la hora del sistema utilizando la interfaz de configuraci√≥n del BIOS del hardware para asegurarse de que fuera correcta.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los relojes de hardware no entienden el concepto de zonas horarias; </font><font style="vertical-align: inherit;">RTC solo almacena la hora, no la zona horaria o el desplazamiento de UTC (hora universal coordinada, que tambi√©n se conoce como GMT o hora media de Greenwich). </font><font style="vertical-align: inherit;">Puede instalar RTC utilizando la herramienta, que analizar√© m√°s adelante en este art√≠culo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La hora del sistema es la hora que el sistema operativo muestra en el reloj de la GUI de su escritorio, en la salida del comando de fecha, en las marcas de tiempo de los registros. </font><font style="vertical-align: inherit;">Esto tambi√©n se aplica a la hora en que se crearon, modificaron y abrieron los archivos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La p√°gina de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">manual de rtc</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tiene una descripci√≥n completa de RTC y el reloj del sistema.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øQu√© tiene NTP?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las computadoras de todo el mundo usan NTP (Protocolo de tiempo de red) para sincronizar su hora con relojes de referencia est√°ndar a trav√©s de Internet utilizando una jerarqu√≠a de servidores NTP. Los servidores horarios principales se encuentran en el nivel 1 y est√°n directamente conectados a varios servicios horarios nacionales en el nivel 0 a trav√©s de sat√©lite, radio o incluso m√≥dems a trav√©s de l√≠neas telef√≥nicas. Los servicios de tiempo en el nivel 0 pueden ser un reloj at√≥mico, un receptor de radio sintonizado a las se√±ales transmitidas por el reloj at√≥mico o un receptor GPS que utiliza se√±ales de reloj de alta precisi√≥n transmitidas por sat√©lites GPS.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la gran mayor√≠a de los servidores de referencia, hay varios miles de servidores p√∫blicos NTP stratum 2 abiertos, que est√°n disponibles para todos. </font><font style="vertical-align: inherit;">Muchas organizaciones y usuarios (incluido yo) con una gran cantidad de hosts que requieren un servidor NTP prefieren instalar sus propios servidores de hora, por lo que solo un host local llama al estrato 2 o 3. Luego configuran los nodos restantes en la red para usar el servidor de hora local. . </font><font style="vertical-align: inherit;">En el caso de mi red dom√©stica, este es un servidor de nivel 3.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diversas implementaciones de NTP </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La implementaci√≥n inicial de NTP es ntpd. Entonces dos nuevos se unieron a ella, chronyd y systemd-timesyncd. Los tres sincronizan la hora del host local con el servidor de hora NTP. El servicio systemd-timesyncd no es tan confiable como chronyd, pero esto es suficiente para la mayor√≠a de los prop√≥sitos. Si RTC no est√° sincronizado, puede ajustar gradualmente la hora del sistema para sincronizarse con el servidor NTP cuando la hora del sistema local se modifica ligeramente. El servicio systemd-timesync no se puede usar como servidor horario. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chrony</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es una implementaci√≥n NTP que contiene dos programas: el demonio chronyd y una interfaz de l√≠nea de comandos llamada chronyc. Chrony tiene algunas caracter√≠sticas que en muchos casos son simplemente irremplazables:</font></font><br>
<br>
<ul>
<li>Chrony       ,    ntpd.       ,    .</li>
<li>     , ,           ,      -   ,       .</li>
<li>    ,        .</li>
<li>    .</li>
<li>    Chrony    .             .</li>
<li>Chrony       .          .</li>
<li>Chrony     NTP-.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una vez m√°s: NTP es un protocolo que se puede implementar en un host Linux usando Chrony o systemd-timesyncd. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los paquetes RPM NTP, Chrony y systemd-timesyncd est√°n disponibles en repositorios est√°ndar de Fedora. </font><font style="vertical-align: inherit;">RPM systemd-udev es un administrador de eventos del kernel que se instala por defecto en Fedora pero no es obligatorio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede instalar los tres y cambiar entre ellos, pero esto crear√° un dolor de cabeza adicional. </font><font style="vertical-align: inherit;">Entonces es mejor no hacerlo. </font><font style="vertical-align: inherit;">Las versiones actuales de Fedora, CentOS y RHEL han migrado a Chrony como implementaci√≥n est√°ndar, y tambi√©n tienen systemd-timesyncd. </font><font style="vertical-align: inherit;">Creo que Chrony funciona bien, proporciona una mejor interfaz que el servicio NTP, proporciona mucha m√°s informaci√≥n y aumenta el control, que los administradores del sistema seguramente disfrutar√°n.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deshabilitar servicios NTP </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es posible que su host ya tenga el servicio NTP ejecut√°ndose. </font><font style="vertical-align: inherit;">Si es as√≠, debe deshabilitarlo antes de cambiar a otra cosa. </font><font style="vertical-align: inherit;">Ten√≠a Chronyd corriendo, as√≠ que us√© los siguientes comandos para detenerlo y deshabilitarlo. </font><font style="vertical-align: inherit;">Ejecute los comandos apropiados para cualquier demonio NTP que use en su host:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm1 ~]<span class="hljs-comment"># systemctl disable chronyd ; systemctl stop chronyd</span><font></font>
Removed /etc/systemd/system/multi-user.target.wants/chronyd.service.<font></font>
[root@testvm1 ~]<span class="hljs-comment">#</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verifique que el servicio est√© detenido y deshabilitado:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm1 ~]<span class="hljs-comment"># systemctl status chronyd</span><font></font>
‚óè chronyd.service - NTP client/server<font></font>
     Loaded: loaded (/usr/lib/systemd/system/chronyd.service; disabled; vendor preset: enabled)<font></font>
     Active: inactive (dead)<font></font>
       Docs: man:chronyd(8)<font></font>
             man:chrony.conf(5)<font></font>
[root@testvm1 ~]<span class="hljs-comment">#</span></code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verifique el estado antes del lanzamiento</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El estado del reloj del sistema le permite determinar si el servicio NTP se est√° ejecutando. </font><font style="vertical-align: inherit;">Como todav√≠a no ha iniciado NTP, el comando timesync-status le indicar√° esto:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm1 ~]<span class="hljs-comment"># timedatectl timesync-status</span>
Failed to query server: Could not activate remote peer.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una solicitud de estado directa proporciona informaci√≥n importante. </font><font style="vertical-align: inherit;">Por ejemplo, el comando timedatectl sin argumento o par√°metros ejecuta el subcomando de estado predeterminado:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm1 ~]<span class="hljs-comment"># timedatectl status</span><font></font>
           Local time: Fri 2020-05-15 08:43:10 EDT  <font></font>
           Universal time: Fri 2020-05-15 12:43:10 UTC  <font></font>
                 RTC time: Fri 2020-05-15 08:43:08      <font></font>
                Time zone: America/New_York (EDT, -0400)<font></font>
System clock synchronized: no                          <font></font>
              NTP service: inactive                    <font></font>
          RTC <span class="hljs-keyword">in</span> <span class="hljs-built_in">local</span> TZ: yes                    <font></font>
<font></font>
Warning: The system is configured to <span class="hljs-built_in">read</span> the RTC time <span class="hljs-keyword">in</span> the <span class="hljs-built_in">local</span> time zone.<font></font>
         This mode cannot be fully supported. It will create various problems<font></font>
         with time zone changes and daylight saving time adjustments. The RTC<font></font>
         time is never updated, it relies on external facilities to maintain it.<font></font>
         If at all possible, use RTC <span class="hljs-keyword">in</span> UTC by calling
         <span class="hljs-string">'timedatectl set-local-rtc 0'</span>.<font></font>
[root@testvm1 ~]<span class="hljs-comment">#</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces obtiene la hora local para su host, la hora UTC y la hora RTC. En este caso, la hora del sistema se establece en la zona horaria Am√©rica / Nueva_York (TZ), el RTC se establece en la hora en la zona horaria local y el servicio NTP no est√° activo. El tiempo RTC comenz√≥ a desviarse ligeramente del tiempo del sistema. Esto es normal para sistemas cuyos relojes no se han sincronizado. La cantidad de desplazamiento en el host depende del tiempo transcurrido desde la √∫ltima sincronizaci√≥n del sistema.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n recibimos una advertencia sobre el uso de la hora local para RTC; esto se aplica a los cambios en la zona horaria y la configuraci√≥n del horario de verano. </font><font style="vertical-align: inherit;">Si la computadora est√° apagada en el momento en que necesita hacer cambios, la hora RTC no cambiar√°. </font><font style="vertical-align: inherit;">Pero para los servidores u otros hosts que funcionan las 24 horas, esto no es un problema en absoluto. </font><font style="vertical-align: inherit;">Adem√°s, cualquier servicio que proporcione sincronizaci√≥n de hora NTP ajustar√° la hora del host en la etapa inicial de inicio, por lo que una vez que se complete el inicio, la hora volver√° a ser correcta.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajuste de zona horaria</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo general, especifica la zona horaria durante el procedimiento de instalaci√≥n y no tiene ninguna tarea para cambiarla en el futuro. Sin embargo, hay momentos en los que necesita cambiar la zona horaria. Hay varias herramientas que pueden ayudar. Linux usa archivos de zona horaria para determinar la zona horaria local del host. Estos archivos se encuentran en el </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">directorio / usr / share / zoneinfo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Por defecto, para mi zona horaria, el sistema escribe esto: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ etc / localtime -&gt; ../usr/share/zoneinfo/America/New_York</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Pero no necesita conocer tales sutilezas para cambiar la zona horaria. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo principal es saber el nombre oficial de la zona horaria de su ubicaci√≥n y el equipo correspondiente. Digamos que desea cambiar la zona horaria a Los √Ångeles:</font></font><br>
<br>
<pre><code class="bash hljs">
[root@testvm2 ~]<span class="hljs-comment"># timedatectl list-timezones | column</span><font></font>
&lt;SNIP&gt;<font></font>
America/La_Paz                  Europe/Budapest<font></font>
America/Lima                    Europe/Chisinau<font></font>
America/Los_Angeles             Europe/Copenhagen<font></font>
America/Maceio                  Europe/Dublin<font></font>
America/Managua                 Europe/Gibraltar<font></font>
America/Manaus                  Europe/Helsinki<font></font>
&lt;SNIP&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora puede configurar la zona horaria. </font><font style="vertical-align: inherit;">Us√© el comando date para verificar los cambios, pero tambi√©n puedes usar timedatectl:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm2 ~]<span class="hljs-comment"># date</span><font></font>
Tue 19 May 2020 04:47:49 PM EDT<font></font>
[root@testvm2 ~]<span class="hljs-comment"># timedatectl set-timezone America/Los_Angeles</span>
[root@testvm2 ~]<span class="hljs-comment"># date</span><font></font>
Tue 19 May 2020 01:48:23 PM PDT<font></font>
[root@testvm2 ~]<span class="hljs-comment">#</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora puede volver a cambiar la zona horaria de su host a la hora local.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-timesyncd</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El daemon systemd timesync proporciona una implementaci√≥n NTP que es f√°cil de administrar en el contexto de systemd. </font><font style="vertical-align: inherit;">Se instala por defecto en Fedora y Ubuntu. </font><font style="vertical-align: inherit;">Sin embargo, comienza por defecto solo en Ubuntu. </font><font style="vertical-align: inherit;">No estoy seguro de las otras distribuciones. </font><font style="vertical-align: inherit;">Puedes verificar por ti mismo:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm1 ~]<span class="hljs-comment"># systemctl status systemd-timesyncd</span></code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configurar systemd-timesyncd</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El archivo de configuraci√≥n para systemd-timesyncd es </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/timesyncd.conf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Este es un archivo simple con menos opciones incluidas que en los antiguos servicios NTP y chronyd. </font><font style="vertical-align: inherit;">Aqu√≠ est√° el contenido de este archivo (sin m√°s cambios) en mi m√°quina virtual Fedora:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment">#  This file is part of systemd.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  systemd is free software; you can redistribute it and/or modify it</span>
<span class="hljs-comment">#  under the terms of the GNU Lesser General Public License as published by</span>
<span class="hljs-comment">#  the Free Software Foundation; either version 2.1 of the License, or</span>
<span class="hljs-comment">#  (at your option) any later version.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Entries in this file show the compile time defaults.</span>
<span class="hljs-comment"># You can change settings by editing this file.</span>
<span class="hljs-comment"># Defaults can be restored by simply deleting this file.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># See timesyncd.conf(5) for details.</span><font></font>
<font></font>
[Time]<font></font>
<span class="hljs-comment">#NTP=</span>
<span class="hljs-comment">#FallbackNTP=0.fedora.pool.ntp.org 1.fedora.pool.ntp.org 2.fedora.pool.ntp.org 3.fedora.pool.ntp.org</span>
<span class="hljs-comment">#RootDistanceMaxSec=5</span>
<span class="hljs-comment">#PollIntervalMinSec=32</span>
<span class="hljs-comment">#PollIntervalMaxSec=2048</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La √∫nica secci√≥n que contiene, adem√°s de los comentarios, es [Hora]. </font><font style="vertical-align: inherit;">Todas las otras l√≠neas est√°n comentadas. </font><font style="vertical-align: inherit;">Estos son los valores predeterminados, no es necesario cambiarlos (a menos que tenga una raz√≥n para esto). </font><font style="vertical-align: inherit;">Si no tiene el servidor horario NTP definido en la l√≠nea NTP =, Fedora usa el servidor horario de respaldo de Fedora por defecto. </font><font style="vertical-align: inherit;">Usualmente agrego mi servidor de tiempo:</font></font><br>
<br>
<pre><code class="bash hljs">NTP=myntpserver</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Iniciar sincronizaci√≥n de tiempo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede iniciar y activar systemd-timesyncd de esta manera:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm2 ~]<span class="hljs-comment"># systemctl enable systemd-timesyncd.service</span><font></font>
Created symlink /etc/systemd/system/dbus-org.freedesktop.timesync1.service ‚Üí /usr/lib/systemd/system/systemd-timesyncd.service.<font></font>
Created symlink /etc/systemd/system/sysinit.target.wants/systemd-timesyncd.service ‚Üí /usr/lib/systemd/system/systemd-timesyncd.service.<font></font>
[root@testvm2 ~]<span class="hljs-comment"># systemctl start systemd-timesyncd.service</span>
[root@testvm2 ~]<span class="hljs-comment">#</span></code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instalaci√≥n de reloj de hardware</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As√≠ es como se ve la situaci√≥n despu√©s de ejecutar timesyncd:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm2 systemd]<span class="hljs-comment"># timedatectl</span><font></font>
               Local time: Sat 2020-05-16 14:34:54 EDT  <font></font>
           Universal time: Sat 2020-05-16 18:34:54 UTC  <font></font>
                 RTC time: Sat 2020-05-16 14:34:53      <font></font>
                Time zone: America/New_York (EDT, -0400)<font></font>
System clock synchronized: yes                          <font></font>
              NTP service: active                      <font></font>
          RTC <span class="hljs-keyword">in</span> <span class="hljs-built_in">local</span> TZ: no    </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inicialmente, la diferencia entre RTC y hora local (EDT) no excede un segundo, y la discrepancia aumenta en un par de segundos en los pr√≥ximos d√≠as. Como no hay un concepto de zonas horarias en RTC, el comando timedatectl debe realizar una comparaci√≥n para determinar la zona horaria deseada. Si el RTC no coincide exactamente con la hora local, entonces no coincide con la zona horaria local. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Buscando m√°s informaci√≥n, verifiqu√© el estado de systemd-timesync y encontr√© esto:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm2 systemd]<span class="hljs-comment"># systemctl status systemd-timesyncd.service</span><font></font>
‚óè systemd-timesyncd.service - Network Time Synchronization<font></font>
     Loaded: loaded (/usr/lib/systemd/system/systemd-timesyncd.service; enabled; vendor preset: disabled)<font></font>
     Active: active (running) since Sat 2020-05-16 13:56:53 EDT; 18h ago<font></font>
       Docs: man:systemd-timesyncd.service(8)<font></font>
   Main PID: 822 (systemd-timesyn)<font></font>
     Status: <span class="hljs-string">"Initial synchronization to time server 163.237.218.19:123 (2.fedora.pool.ntp.org)."</span>
      Tasks: 2 (<span class="hljs-built_in">limit</span>: 10365)<font></font>
     Memory: 2.8M<font></font>
        CPU: 476ms<font></font>
     CGroup: /system.slice/systemd-timesyncd.service<font></font>
             ‚îî‚îÄ822 /usr/lib/systemd/systemd-timesyncd<font></font>
<font></font>
May 16 09:57:24 testvm2.both.org systemd[1]: Starting Network Time Synchronization...<font></font>
May 16 09:57:24 testvm2.both.org systemd-timesyncd[822]: System clock time <span class="hljs-built_in">unset</span> or jumped backwards, restoring from recorded timestamp: Sat 2020-05-16 13:56:53 EDT<font></font>
May 16 13:56:53 testvm2.both.org systemd[1]: Started Network Time Synchronization.<font></font>
May 16 13:57:56 testvm2.both.org systemd-timesyncd[822]: Initial synchronization to time server 163.237.218.19:123 (2.fedora.pool.ntp.org).<font></font>
[root@testvm2 systemd]<span class="hljs-comment">#</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Preste atenci√≥n al mensaje de registro, que dice que la hora del sistema no est√° configurada o restablecida. </font><font style="vertical-align: inherit;">El servicio Timesync establece la hora del sistema en funci√≥n de una marca de tiempo. </font><font style="vertical-align: inherit;">Las marcas de tiempo son mantenidas por el demonio de sincronizaci√≥n de tiempo y se crean con cada sincronizaci√≥n exitosa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El comando timedatectl no puede tomar el valor del reloj de hardware del reloj del sistema. </font><font style="vertical-align: inherit;">Puede establecer la hora y la fecha solo desde el valor ingresado en la l√≠nea de comando. </font><font style="vertical-align: inherit;">Puede establecer RTC en el mismo valor que la hora del sistema con el comando hwclock:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm2 ~]<span class="hljs-comment"># /sbin/hwclock --systohc --localtime</span>
[root@testvm2 ~]<span class="hljs-comment"># timedatectl</span><font></font>
               Local time: Mon 2020-05-18 13:56:46 EDT  <font></font>
           Universal time: Mon 2020-05-18 17:56:46 UTC  <font></font>
                 RTC time: Mon 2020-05-18 13:56:46      <font></font>
                Time zone: America/New_York (EDT, -0400)<font></font>
System clock synchronized: yes                          <font></font>
              NTP service: active                      <font></font>
          RTC <span class="hljs-keyword">in</span> <span class="hljs-built_in">local</span> TZ: yes</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La opci√≥n --localtime indica que el reloj de hardware muestra la hora local, no UTC.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øPor qu√© necesitas RTC?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cualquier implementaci√≥n de NTP configurar√° el reloj del sistema al inicio. </font><font style="vertical-align: inherit;">¬øY entonces por qu√© RTC? </font><font style="vertical-align: inherit;">Esto no es del todo cierto: esto solo suceder√° si tiene una conexi√≥n de red a un servidor horario. </font><font style="vertical-align: inherit;">Sin embargo, muchos sistemas no tienen acceso constante a la conexi√≥n de red, por lo que el reloj de hardware es √∫til para que Linux establezca la hora del sistema seg√∫n ellos. </font><font style="vertical-align: inherit;">Esto es mejor que configurar el tiempo manualmente, incluso si puede desviarse del tiempo real.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusi√≥n</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este art√≠culo analiza algunas herramientas para administrar la fecha, la hora y las zonas horarias. La herramienta systemd-timesyncd proporciona un cliente NTP que puede sincronizar la hora en un host local con un servidor NTP. Sin embargo, systemd-timesyncd no proporciona un servicio de servidor, por lo que si necesita un servidor NTP en su red, debe usar algo m√°s, por ejemplo, Chrony, para trabajar como servidor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prefiero tener una implementaci√≥n √∫nica para cualquier servicio en mi red, as√≠ que uso Chrony. Si no necesita un servidor NTP local o si no le importa usar Chrony como servidor y systemd-timesyncd como cliente SNTP. Despu√©s de todo, no es necesario usar las caracter√≠sticas adicionales de Chrony como cliente, si est√° satisfecho con la funcionalidad de systemd-timesyncd.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una nota m√°s: no es necesario que use herramientas systemd para implementar NTP. </font><font style="vertical-align: inherit;">Puede usar la versi√≥n anterior de ntpd, Chrony u otra implementaci√≥n de NTP. </font><font style="vertical-align: inherit;">Despu√©s de todo, systemd consta de una gran cantidad de servicios; </font><font style="vertical-align: inherit;">muchos de ellos son opcionales, por lo que puede desactivarlos y usar otra cosa en su lugar. </font><font style="vertical-align: inherit;">Este no es un gran monstruo monol√≠tico. </font><font style="vertical-align: inherit;">Puede que no le guste systemd o partes de √©l, pero debe tomar una decisi√≥n informada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Me gusta la implementaci√≥n de NTP en systemd, pero prefiero Chrony porque se adapta mejor a mis necesidades. </font><font style="vertical-align: inherit;">Esto es Linux, baby -)</font></font><br>
<br>
<hr><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como un anuncio</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VDSina ofrece </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">servidores para cualquier tarea</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , una gran selecci√≥n de sistemas operativos para instalaci√≥n autom√°tica, es posible instalar cualquier sistema operativo desde su propio </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ISO</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">panel de control</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> conveniente </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">de</font></a><font style="vertical-align: inherit;"> su propio dise√±o y pago diario. </font><font style="vertical-align: inherit;">Recordemos que tenemos servidores eternos que definitivamente son eternos;)</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/9fa/cf4/a34/9facf4a348ef01048b4eb5e16ae66daa.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es505298/index.html">Flight of Crew Dragon en fotos y video</a></li>
<li><a href="../es505300/index.html">Industria petrolera para ingenieros, programadores, matem√°ticos y masas de trabajadores, parte 1</a></li>
<li><a href="../es505302/index.html">10 consejos de dise√±o de circuitos</a></li>
<li><a href="../es505306/index.html">Desde juegos hasta proyectos de comercio electr√≥nico. Cambiar el programa de dos a√±os de Technopark</a></li>
<li><a href="../es505310/index.html">Lo que distingue a las empresas tecnol√≥gicamente avanzadas y c√≥mo techlide puede ayudar a su equipo a crecer</a></li>
<li><a href="../es505322/index.html">Despachador del futuro: ¬øc√≥mo cambiar√° su papel en la empresa de servicios?</a></li>
<li><a href="../es505330/index.html">C√≥mo no crear una criptomoneda desde cero en 3 a√±os</a></li>
<li><a href="../es505336/index.html">¬øC√≥mo: Manet o Monet? La red neuronal responde</a></li>
<li><a href="../es505340/index.html">Los empleados de Walmart intentan demostrar que la IA antirrobo no funciona</a></li>
<li><a href="../es505342/index.html">La inyecci√≥n de dependencia y el principio de inversi√≥n de dependencia NO SON UNO Y MISMO</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>