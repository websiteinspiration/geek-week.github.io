<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸŒï¸ ğŸŒ ğŸ§š O livro "Terraform: infraestrutura no nÃ­vel do cÃ³digo" ğŸ‘ŠğŸ¾ ğŸŒ› ğŸ‘µğŸ¾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="OlÃ¡, habrozhiteli! O livro Ã© destinado a todos os responsÃ¡veis â€‹â€‹pelo cÃ³digo jÃ¡ escrito. Isso se aplica a administradores de sistemas, especialistas e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>O livro "Terraform: infraestrutura no nÃ­vel do cÃ³digo"</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/503858/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/el/eg/lp/eleglpt_bkgjd7cftgp1yrmg_gk.jpeg" align="left" alt="imagem"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OlÃ¡, habrozhiteli! O livro Ã© destinado a todos os responsÃ¡veis â€‹â€‹pelo cÃ³digo jÃ¡ escrito. Isso se aplica a administradores de sistemas, especialistas em operaÃ§Ãµes, engenheiros de release, SR, DevOps, desenvolvedores de infraestrutura, desenvolvedores de ciclo completo, lÃ­deres de equipes de engenharia e diretores tÃ©cnicos. Qualquer que seja sua posiÃ§Ã£o, se vocÃª estiver envolvido em infraestrutura, implantar cÃ³digo, configurar servidores, dimensionar clusters, fazer backup de dados, monitorar aplicativos e atender chamadas Ã s trÃªs da manhÃ£, este livro Ã© para vocÃª.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Juntas, essas responsabilidades sÃ£o comumente referidas como atividades operacionais (ou administraÃ§Ã£o do sistema). </font><font style="vertical-align: inherit;">Anteriormente, os desenvolvedores que sabiam escrever cÃ³digo, mas nÃ£o entendiam a administraÃ§Ã£o do sistema eram frequentemente atendidos; </font><font style="vertical-align: inherit;">os administradores de sistema geralmente se deparavam sem a capacidade de escrever cÃ³digo. </font><font style="vertical-align: inherit;">Uma vez que essa separaÃ§Ã£o era aceitÃ¡vel, mas no mundo moderno, que nÃ£o pode mais ser imaginado sem a computaÃ§Ã£o em nuvem e o movimento DevOps, quase todo desenvolvedor precisa de habilidades administrativas, e qualquer administrador de sistema deve poder programar.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VocÃª nÃ£o apenas aprenderÃ¡ como gerenciar a infraestrutura na forma de cÃ³digo usando o Terraform, mas tambÃ©m aprenderÃ¡ como ela se encaixa no conceito geral do DevOps. </font><font style="vertical-align: inherit;">Aqui estÃ£o algumas perguntas que vocÃª pode responder lendo este livro.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por que usar IaC?</font></font></li>
<li>    , ,     ?</li>
<li>   Terraform, Chef, Ansible, Puppet, Salt, CloudFormation, Docker, Packer  Kubernetes?</li>
<li>   Terraform       ?</li>
<li>   Terraform,    ?</li>
<li>    Terraform,       ?</li>
<li>     Terraform?</li>
<li>  Terraform     ?</li>
<li>    Terraform   ?</li>
</ul><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">    </b>
                        <div class="spoiler_text">    2017 .   2019-         ,      !                 .  ,        .<br>
<br>
        ,  ,     ,    Terraform,    .<br>
<br>
<ul>
<li>   Terraform.    ,   Terraform  0.8.     Terraform   0.12.       ,     .  ,   !</li>
<li>   .           Terraform.    , ,    ,  ,    ,  ,  ,    .</li>
<li>  .      Terraform   .  , ,               â€” ,      .</li>
<li>   .  8      ,      Terraform    . ,  ,      ,          : ,      .</li>
<li>HCL2.  Terraform 0.12   HCL   HCL2.        (       ${â€¦}!),   ,     ,   null, for_each  for,    .          HCL2,         5  6.</li>
<li>   .  Terraform 0.9    .        Terraform    .  Terraform 0.9     ,       ;     0.10      .       3.</li>
<li>    Terraform.  Terraform 0.10         (    AWS, GCP, Azure  . .).         ,         .          terraform init  ,       .       2  7.</li>
<li>   .  2016   Terraform        (AWS, GCP  Azure).      100,  ,  ,   1.               (,     Alicloud, Oracle Cloud Infrastructure, VMware vSphere  .),       ,     (GitHub, GitLab  BitBucket),   (MySQL, PostreSQL  InfluxDB),     ( DataDog, New Relic  Grafana),   Kubernetes, Helm, Heroku, Rundeck  Rightscale   .  ,       : ,   AWS     ,        ,   CloudFormation!</li>
<li>  Terraform.  2017   HashiCorp    Terraform (registry.terraform.io) â€”  ,         Terraform,  .  2018          .  Terraform 0.11        .       Â« Â»  . 153.</li>
<li>  .  Terraform 0.9    :         ,    ,   errored.tfstate.  Terraform 0.12    .    ,            ,     .</li>
<li>   .      ,     (.  Â«  Â»  . 144),  Â« Â»         (,  Â«  TerraformÂ»  . 242),  plan    apply (.  Â«  Â»  . 64),     create_before_destroy,    count,           (.  Â«Â»  . 160),    ,   provider   .</li>
</ul></div>
                    </div><br>
<h3>.    Terraform</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(muito mais atenÃ§Ã£o serÃ¡ dada Ã s questÃµes dos testes automÃ¡ticos no livro posteriormente) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O mundo do DevOps estÃ¡ cheio de medos diferentes: todo mundo tem medo de permitir que as coisas funcionem, percam dados ou sejam invadidas. Ao fazer qualquer alteraÃ§Ã£o, vocÃª sempre se pergunta quais as consequÃªncias que ela terÃ¡. ComportarÃ¡ o mesmo em todos os ambientes? CausarÃ¡ outra interrupÃ§Ã£o? E, se isso acontecer, quanto vocÃª precisarÃ¡ permanecer no trabalho dessa vez para consertÃ¡-lo? Ã€ medida que a empresa cresce, hÃ¡ mais em risco, tornando o processo de implantaÃ§Ã£o ainda pior e aumentando o risco de erros. Muitas empresas tentam minimizar esse risco por meio de implantaÃ§Ãµes menos frequentes, mas, como resultado, cada implantaÃ§Ã£o individual se torna maior e mais propensa a erros.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se vocÃª gerencia sua infraestrutura na forma de cÃ³digo, tem uma maneira melhor de minimizar os riscos: testes. </font><font style="vertical-align: inherit;">O objetivo deles Ã© dar a vocÃª confianÃ§a suficiente para fazer alteraÃ§Ãµes. </font><font style="vertical-align: inherit;">A palavra-chave aqui Ã© confianÃ§a: nenhum teste pode garantir nenhum erro; portanto, Ã© mais provÃ¡vel que vocÃª lide com a probabilidade. </font><font style="vertical-align: inherit;">Se vocÃª pode capturar toda a sua infraestrutura e processos de implantaÃ§Ã£o como cÃ³digo, pode testÃ¡-lo em um ambiente de teste. </font><font style="vertical-align: inherit;">Se for bem-sucedido, hÃ¡ uma grande chance de que o mesmo cÃ³digo funcione em um ambiente industrial. </font><font style="vertical-align: inherit;">Em um mundo de medo e incerteza, alta probabilidade e confianÃ§a sÃ£o caras. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neste capÃ­tulo, passaremos pelo processo de teste do cÃ³digo de infraestrutura, manual e automÃ¡tico, com Ãªnfase no Ãºltimo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Testes manuais:</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">noÃ§Ãµes bÃ¡sicas de teste manual;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">limpando recursos apÃ³s testes.</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Testes automatizados:</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">testes de unidade;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">testes de integraÃ§Ã£o;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">testes de ponta a ponta;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">outras abordagens de teste.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Testes manuais</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao pensar em como testar o cÃ³digo do Terraform, Ã© Ãºtil traÃ§ar alguns paralelos com o cÃ³digo de teste escrito em linguagens de programaÃ§Ã£o de uso geral, como Ruby. </font><font style="vertical-align: inherit;">Imagine que vocÃª estÃ¡ escrevendo um servidor Web Ruby simples no arquivo web-server.rb:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebServer</span> &lt; <span class="hljs-title">WEBrick</span>::<span class="hljs-title">HTTPServlet</span>::<span class="hljs-title">AbstractServlet</span>
  <span class="hljs-title">def</span> <span class="hljs-title">do_GET</span>(<span class="hljs-title">request</span>, <span class="hljs-title">response</span>)
     <span class="hljs-title">case</span> <span class="hljs-title">request</span>.<span class="hljs-title">path</span>
     <span class="hljs-title">when</span> "/"
         <span class="hljs-title">response</span>.<span class="hljs-title">status</span> </span>= <span class="hljs-number">200</span>
         response[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-string">'text/plain'</span>
         response.body = <span class="hljs-string">'Hello, World'</span>
     <span class="hljs-keyword">else</span>
         response.status = <span class="hljs-number">404</span>
         response[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-string">'text/plain'</span>
         response.body = <span class="hljs-string">'Not Found'</span><font></font>
     end<font></font>
  end<font></font>
end</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este cÃ³digo retornarÃ¡ uma resposta 200 OK com o corpo Hello, World para a URL /; </font><font style="vertical-align: inherit;">para qualquer outro endereÃ§o, a resposta serÃ¡ 404. Como vocÃª testaria esse cÃ³digo manualmente? </font><font style="vertical-align: inherit;">Normalmente, mais algum cÃ³digo Ã© adicionado para executar o servidor da web localmente:</font></font><br>
<br>
<pre><code class="java hljs">#   ,      <font></font>
#  ,       <font></font>
<span class="hljs-keyword">if</span> __FILE__ == $<span class="hljs-number">0</span>
  #      <span class="hljs-number">8000</span>
  server = WEBrick::HTTPServer.new :Port =&gt; <span class="hljs-number">8000</span>
  server.mount <span class="hljs-string">'/'</span>, WebServer<font></font>
<font></font>
  #    Ctrl+C<font></font>
  trap <span class="hljs-string">'INT'</span> <span class="hljs-keyword">do</span> server.shutdown end<font></font>
<font></font>
  #  <font></font>
  server.start<font></font>
end</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se vocÃª executar este arquivo no terminal, ele carregarÃ¡ o servidor web na porta 8000:</font></font><br>
<br>
<pre><code class="java hljs">$ ruby web-server.rb<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick <span class="hljs-number">1.3</span><span class="hljs-number">.1</span>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO ruby <span class="hljs-number">2.3</span><span class="hljs-number">.7</span> (<span class="hljs-number">2018</span>-<span class="hljs-number">03</span>-<span class="hljs-number">28</span>) [universal.x86_64-darwin17]<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick::HTTPServer#start: pid=<span class="hljs-number">19767</span> port=<span class="hljs-number">8000</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para verificar a operaÃ§Ã£o deste servidor, vocÃª pode usar o navegador ou fazer uma espiral:</font></font><br>
<br>
<pre><code class="java hljs">$ curl localhost:<span class="hljs-number">8000</span>/<font></font>
Hello, World<font></font>
<font></font>
$ curl localhost:<span class="hljs-number">8000</span>/invalid-path<font></font>
Not Found</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora imagine que alteramos esse cÃ³digo adicionando um ponto de entrada / api que retorna 201 Created e um corpo no formato JSON:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebServer</span> &lt; <span class="hljs-title">WEBrick</span>::<span class="hljs-title">HTTPServlet</span>::<span class="hljs-title">AbstractServlet</span>
  <span class="hljs-title">def</span> <span class="hljs-title">do_GET</span>(<span class="hljs-title">request</span>, <span class="hljs-title">response</span>)
     <span class="hljs-title">case</span> <span class="hljs-title">request</span>.<span class="hljs-title">path</span>
     <span class="hljs-title">when</span> "/"
         <span class="hljs-title">response</span>.<span class="hljs-title">status</span> </span>= <span class="hljs-number">200</span>
         response[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-string">'text/plain'</span>
         response.body = <span class="hljs-string">'Hello, World'</span>
     when <span class="hljs-string">"/api"</span>
         response.status = <span class="hljs-number">201</span>
         response[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-string">'application/json'</span>
         response.body = <span class="hljs-string">'{"foo":"bar"}'</span>
     <span class="hljs-keyword">else</span>
         response.status = <span class="hljs-number">404</span>
         response[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-string">'text/plain'</span>
         response.body = <span class="hljs-string">'Not Found'</span><font></font>
     end<font></font>
  end<font></font>
end</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para testar manualmente esse cÃ³digo atualizado, pressione Ctrl + C e reinicie o servidor da Web executando o script novamente:</font></font><br>
<br>
<pre><code class="java hljs">$ ruby web-server.rb<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick <span class="hljs-number">1.3</span><span class="hljs-number">.1</span>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO ruby <span class="hljs-number">2.3</span><span class="hljs-number">.7</span> (<span class="hljs-number">2018</span>-<span class="hljs-number">03</span>-<span class="hljs-number">28</span>) [universal.x86_64-darwin17]<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick::HTTPServer#start: pid=<span class="hljs-number">19767</span> port=<span class="hljs-number">8000</span><font></font>
^C<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">15</span>:<span class="hljs-number">54</span>] INFO going to shutdown ...<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">15</span>:<span class="hljs-number">54</span>] INFO WEBrick::HTTPServer#start done.<font></font>
<font></font>
$ ruby web-server.rb<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick <span class="hljs-number">1.3</span><span class="hljs-number">.1</span>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO ruby <span class="hljs-number">2.3</span><span class="hljs-number">.7</span> (<span class="hljs-number">2018</span>-<span class="hljs-number">03</span>-<span class="hljs-number">28</span>) [universal.x86_64-darwin17]<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick::HTTPServer#start: pid=<span class="hljs-number">19767</span> port=<span class="hljs-number">8000</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para verificar a nova versÃ£o, vocÃª pode novamente usar o comando curl:</font></font><br>
<br>
<pre><code class="java hljs">$ curl localhost:<span class="hljs-number">8000</span>/api<font></font>
{<span class="hljs-string">"foo"</span>:<span class="hljs-string">"bar"</span>}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NoÃ§Ãµes bÃ¡sicas de teste manual</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como serÃ¡ esse tipo de teste manual no Terraform? </font><font style="vertical-align: inherit;">Por exemplo, dos capÃ­tulos anteriores, vocÃª ainda tem o cÃ³digo para implantar o ALB. </font><font style="vertical-align: inherit;">Aqui estÃ¡ um trecho do arquivo modules / networking / alb / main.tf:</font></font><br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_lb"</span> <span class="hljs-string">"example"</span> {<font></font>
   name                     = <span class="hljs-keyword">var</span>.alb_name<font></font>
   load_balancer_type = <span class="hljs-string">"application"</span>
   subnets                  = <span class="hljs-keyword">var</span>.subnet_ids<font></font>
   security_groups      = [aws_security_group.alb.id]<font></font>
}<font></font>
<font></font>
resource <span class="hljs-string">"aws_lb_listener"</span> <span class="hljs-string">"http"</span> {<font></font>
   load_balancer_arn = aws_lb.example.arn<font></font>
   port                      = local.http_port<font></font>
   protocol                = <span class="hljs-string">"HTTP"</span><font></font>
<font></font>
   #      <span class="hljs-number">404</span><font></font>
   default_action {<font></font>
      type = <span class="hljs-string">"fixed-response"</span><font></font>
<font></font>
      fixed_response {<font></font>
        content_type = <span class="hljs-string">"text/plain"</span>
        message_body = <span class="hljs-string">"404: page not found"</span>
        status_code = <span class="hljs-number">404</span><font></font>
      }<font></font>
    }<font></font>
}<font></font>
<font></font>
resource <span class="hljs-string">"aws_security_group"</span> <span class="hljs-string">"alb"</span> {<font></font>
   name = <span class="hljs-keyword">var</span>.alb_name<font></font>
}<font></font>
<font></font>
# (...)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se vocÃª comparar essa listagem com o cÃ³digo Ruby, poderÃ¡ ver uma diferenÃ§a bastante Ã³bvia: o AWS ALB, grupos de destino, ouvintes, grupos de seguranÃ§a e outros recursos nÃ£o podem ser implantados em seu prÃ³prio computador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A principal conclusÃ£o sobre o teste nÃºmero 1 segue a partir disso: o teste de cÃ³digo Terraform nÃ£o pode ser realizado localmente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso se aplica nÃ£o apenas ao Terraform, mas tambÃ©m Ã  maioria das ferramentas de IaC. A Ãºnica maneira prÃ¡tica de fazer testes manuais no Terraform Ã© implantar o cÃ³digo em um ambiente real (ou seja, na AWS). Em outras palavras, iniciar de forma independente os comandos aplicar e destruir terraform que vocÃª trabalhou durante a leitura do livro Ã© um teste manual no Terraform.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse Ã© um dos motivos pelos quais Ã© tÃ£o importante ter exemplos fÃ¡ceis de implantar na pasta de exemplos de cada mÃ³dulo (consulte o capÃ­tulo 6). </font><font style="vertical-align: inherit;">Para testar o mÃ³dulo alb, a maneira mais fÃ¡cil Ã© usar o cÃ³digo de demonstraÃ§Ã£o que vocÃª criou nos exemplos / alb:</font></font><br>
<br>
<pre><code class="java hljs">provider <span class="hljs-string">"aws"</span> {<font></font>
   region = <span class="hljs-string">"us-east-2"</span><font></font>
<font></font>
   #     AWS  <span class="hljs-number">2</span>.x<font></font>
   version = <span class="hljs-string">"~&gt; 2.0"</span><font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">module</span> <span class="hljs-string">"alb"</span> {<font></font>
    source = <span class="hljs-string">"../../modules/networking/alb"</span><font></font>
<font></font>
    alb_name = <span class="hljs-string">"terraform-up-and-running"</span>
    subnet_ids = data.aws_subnet_ids.<span class="hljs-keyword">default</span>.ids<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para implantar este exemplo, vocÃª precisa executar o comando terraform apply, como fez repetidamente:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function">$ terraform <span class="hljs-title">apply</span>

<span class="hljs-params">(...)</span>

Apply complete! Resources: 5 added, 0 changed, 0 destroyed.

Outputs:

alb_dns_name </span>= hello-world-stage-<span class="hljs-number">477699288</span>.us-east-<span class="hljs-number">2</span>.elb.amazonaws.com</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No final da implantaÃ§Ã£o, vocÃª pode usar uma ferramenta como curl para, por exemplo, garantir que o ALB retorne 404 por padrÃ£o:</font></font><br>
<br>
<pre><code class="java hljs">$ curl \<font></font>
   -s \<font></font>
   -o /dev/<span class="hljs-keyword">null</span> \<font></font>
   -w <span class="hljs-string">"%{http_code}"</span> \<font></font>
hello-world-stage-<span class="hljs-number">477699288</span>.us-east-<span class="hljs-number">2</span>.elb.amazonaws.com<font></font>
<font></font>
<span class="hljs-number">404</span></code></pre><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VerificaÃ§Ã£o de infraestrutura</font></font><br>
<br>
      ,   HTTP, ,     ,   curl  HTTP-.        . ,        MySQL,       MySQL.      VPN-,      VPN.      ,      ,       SSH    - .    .   ,    ,      .       ,    .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deixe-me lembrÃ¡-lo: O ALB retorna 404 devido Ã  ausÃªncia de outras regras do ouvinte na configuraÃ§Ã£o, e a aÃ§Ã£o padrÃ£o no mÃ³dulo alb tem uma resposta 404:</font></font><br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_lb_listener"</span> <span class="hljs-string">"http"</span> {<font></font>
   load_balancer_arn = aws_lb.example.arn<font></font>
   port                      = local.http_port<font></font>
   protocol                = <span class="hljs-string">"HTTP"</span><font></font>
<font></font>
   #      <span class="hljs-number">404</span><font></font>
   default_action {<font></font>
      type = <span class="hljs-string">"fixed-response"</span><font></font>
<font></font>
      fixed_response {<font></font>
       content_type = <span class="hljs-string">"text/plain"</span>
       message_body = <span class="hljs-string">"404: page not found"</span>
       status_code = <span class="hljs-number">404</span><font></font>
      }<font></font>
   }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
EntÃ£o, vocÃª jÃ¡ sabe como executar e testar seu cÃ³digo. </font><font style="vertical-align: inherit;">Agora vocÃª pode comeÃ§ar a fazer alteraÃ§Ãµes. </font><font style="vertical-align: inherit;">Toda vez que vocÃª altera algo (para que, por exemplo, a aÃ§Ã£o padrÃ£o retorne 401), vocÃª precisa usar o comando terraform apply para implantar o novo cÃ³digo:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function">$ terraform <span class="hljs-title">apply</span>

<span class="hljs-params">(...)</span>

Apply complete! Resources: 0 added, 1 changed, 0 destroyed.

Outputs:

alb_dns_name </span>= hello-world-stage-<span class="hljs-number">477699288</span>.us-east-<span class="hljs-number">2</span>.elb.amazonaws.com</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para verificar a nova versÃ£o, vocÃª pode reiniciar o curl:</font></font><br>
<br>
<pre><code class="java hljs">$ curl \<font></font>
   -s \<font></font>
   -o /dev/<span class="hljs-keyword">null</span> \<font></font>
   -w <span class="hljs-string">"%{http_code}"</span> \<font></font>
   hello-world-stage-<span class="hljs-number">477699288</span>.us-east-<span class="hljs-number">2</span>.elb.amazonaws.com
<span class="hljs-number">401</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando terminar, execute o comando terraform destroy para remover os recursos:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function">$ terraform <span class="hljs-title">destroy</span>

<span class="hljs-params">(...)</span>

Apply complete! Resources: 0 added, 0 changed, 5 destroyed.</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em outras palavras, ao trabalhar com o Terraform, todo desenvolvedor precisa de boas amostras de cÃ³digo para testes e um ambiente de desenvolvimento real (como uma conta da AWS), que serve como o equivalente a um computador local e Ã© usado para executar testes. No processo de teste manual, vocÃª provavelmente precisarÃ¡ criar e remover um grande nÃºmero de componentes de infraestrutura, e isso pode levar a muitos erros. Nesse sentido, o ambiente deve ser completamente isolado de ambientes mais estÃ¡veis, destinados ao teste final e, em particular, para aplicaÃ§Ãµes industriais.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dado o exposto, recomendo vivamente que cada equipe de desenvolvimento prepare um ambiente isolado no qual vocÃª possa criar e remover qualquer infraestrutura sem consequÃªncias. </font><font style="vertical-align: inherit;">Para minimizar a probabilidade de conflitos entre diferentes desenvolvedores (imagine que dois desenvolvedores estejam tentando criar um balanceador de carga com o mesmo nome), a soluÃ§Ã£o ideal seria fornecer a cada membro da equipe um ambiente separado e completamente isolado. </font><font style="vertical-align: inherit;">Por exemplo, se vocÃª usa o Terraform em conjunto com a AWS, cada desenvolvedor deve idealmente ter sua prÃ³pria conta, onde pode testar tudo o que deseja.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Limpeza de recursos apÃ³s testes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A presenÃ§a de muitos ambientes isolados Ã© necessÃ¡ria para a alta produtividade dos desenvolvedores, mas se vocÃª nÃ£o tomar cuidado, poderÃ¡ acumular muitos recursos extras que atrapalharÃ£o todos os seus ambientes e custarÃ£o uma soma redonda. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para manter os custos sob controle, limpe regularmente sua mÃ­dia isolada. Esta Ã© a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">principal conclusÃ£o sobre o teste nÃºmero 2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VocÃª deve, no mÃ­nimo, criar essa cultura na equipe quando, apÃ³s o teste, os desenvolvedores excluÃ­rem tudo o que implementaram usando o comando terraform destroy. Pode ser possÃ­vel encontrar ferramentas para limpar recursos em excesso ou antigos que podem ser executados regularmente (por exemplo, usando cron). Aqui estÃ£o alguns exemplos para diferentes ambientes de implementaÃ§Ã£o.</font></font><br>
<br>
<ul>
<li>cloud-nuke (http://bit.ly/2OIgM9r).      ,         .        AWS ( Amazon EC2 Instances, ASG, ELB  . .).      (Google Cloud, Azure)   .    â€”    ,    . , cloud-nuke      cron,           .   ,   ,      ,      :<br>
<br>
<pre><code class="java hljs">$ cloud-nuke aws --older-than <span class="hljs-number">48</span>h</code></pre></li>
<li>Janitor Monkey (http://bit.ly/2M4GoLB).      ,   AWS  ,    (  â€”   ).    ,  ,    ,            .    Netflix Simian Army,      Chaos Monkey    .   ,    Simian Army    ,       : ,   Janitor Monkey   Swabbie (http://bit.ly/2OLrOLb).</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aws-nuke (http://bit.ly/2ZB8lOe). </font><font style="vertical-align: inherit;">Esta Ã© uma ferramenta de cÃ³digo aberto para excluir todo o conteÃºdo de uma conta da AWS. </font><font style="vertical-align: inherit;">As contas e os recursos a serem excluÃ­dos sÃ£o especificados no arquivo de configuraÃ§Ã£o no formato YAML:</font></font><br>
<br>
<pre><code class="java hljs">#   <font></font>
regions:<font></font>
- us-east-<span class="hljs-number">2</span><font></font>
<font></font>
#    <font></font>
accounts:<font></font>
   <span class="hljs-string">"111111111111"</span>: {}<font></font>
<font></font>
#    <font></font>
resource-types:<font></font>
   targets:<font></font>
   - S3Object<font></font>
   - S3Bucket<font></font>
   - IAMRole</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Aws-nuke comeÃ§a da seguinte maneira:</font></font><br>
<br>
<pre><code class="java hljs">$ aws-nuke -<span class="hljs-number">5</span>c config.yml</code></pre></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Testes automatizados</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O conceito de teste automÃ¡tico Ã© que os testes sÃ£o escritos para testar o comportamento do cÃ³digo real. </font><font style="vertical-align: inherit;">No CapÃ­tulo 8, vocÃª aprenderÃ¡ que, usando o servidor de IC, esses testes podem ser executados apÃ³s cada confirmaÃ§Ã£o individual. </font><font style="vertical-align: inherit;">Se nÃ£o forem concluÃ­das, a fixaÃ§Ã£o pode ser desfeita ou corrigida imediatamente. </font><font style="vertical-align: inherit;">Assim, seu cÃ³digo estarÃ¡ sempre operacional. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem trÃªs tipos de testes automatizados.</font></font><br>
<br>
<ul>
<li> .       â€” .    ,             .   (,  , -    )   mock-.       (, mock-     ,  )    ,        .</li>
<li> .      .          ,          .      mock-: ,     ,     ,      ,   , ,  ,  mock-.</li>
<li> .      (, ,  ,  )       .          : , Selenium        .         - mock-,          (        ,  ).</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada tipo de teste tem seu prÃ³prio objetivo e, com a ajuda deles, vocÃª pode identificar todos os tipos de erros, portanto eles devem ser usados â€‹â€‹juntos. Os testes de unidade sÃ£o rÃ¡pidos e permitem que vocÃª tenha uma idÃ©ia imediata das alteraÃ§Ãµes feitas e verifique uma variedade de combinaÃ§Ãµes. Isso lhe dÃ¡ confianÃ§a de que os componentes elementares do seu cÃ³digo (mÃ³dulos individuais) se comportam conforme o esperado. No entanto, o fato de os mÃ³dulos funcionarem corretamente separadamente nÃ£o significa que eles possam trabalhar juntos; portanto, para garantir que seus componentes elementares sejam compatÃ­veis, sÃ£o necessÃ¡rios testes de integraÃ§Ã£o. Por outro lado, o comportamento correto de diferentes partes do sistema nÃ£o garante que esse sistema funcione como deveria apÃ³s a implantaÃ§Ã£o em um ambiente industrial; portanto, sÃ£o necessÃ¡rios testes para testar seu cÃ³digo em condiÃ§Ãµes prÃ³ximas Ã s reais.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Â»Mais informaÃ§Ãµes sobre o livro podem ser encontradas no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">site da editora</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Â» </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ConteÃºdo</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Â» </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trecho</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Para Khabrozhiteley desconto de 25% no cupom - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terraform</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ApÃ³s o pagamento da versÃ£o impressa do livro, um livro eletrÃ´nico Ã© enviado por e-mail.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt503842/index.html">PrÃ³tese cerebral: sincronizaÃ§Ã£o de redes neurais artificiais e biolÃ³gicas</a></li>
<li><a href="../pt503844/index.html">Acelere a renderizaÃ§Ã£o do MatTable em poucas etapas</a></li>
<li><a href="../pt503846/index.html">Flash: "Se ele morre novamente Ã© desconhecido, mas as flores desaparecem ..."</a></li>
<li><a href="../pt503848/index.html">Convidamos vocÃª a webinars gratuitos sobre impressÃ£o SLS nos scanners Sinterit 26.05 e 3D Shining 28.05</a></li>
<li><a href="../pt503854/index.html">Use SIL ao mÃ¡ximo</a></li>
<li><a href="../pt503860/index.html">Configurando o ambiente de rede neural Mask R-CNN</a></li>
<li><a href="../zh-CN486176/index.html">ä¼ä¸šç”µå­é‚®ä»¶é€šè®¯å¤‡å¿˜å½•</a></li>
<li><a href="../zh-CN486178/index.html">FOSSæ–°é—»1-2020å¹´1æœˆ27æ—¥è‡³2æœˆ2æ—¥å…è´¹å’Œå¼€æºæ–°é—»çš„å›é¡¾</a></li>
<li><a href="../zh-CN486180/index.html">åˆ›å»ºæ— æœåŠ¡å™¨åº”ç”¨ç¨‹åºçš„æç¤ºå’Œèµ„æº</a></li>
<li><a href="../zh-CN486184/index.html">å¦‚ä½•æœ‰æ•ˆä½¿ç”¨æœç´¢</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>