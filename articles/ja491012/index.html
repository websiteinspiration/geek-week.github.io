<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💾 😙 🕛 async / awaitによる非同期プログラミング ☺️ 📬 🙁</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="こんにちは！
 
 比較的新しいJavaScriptの追加は、非同期関数とawaitキーワードです。これらの機能は基本的にはpromise（promise）に対する構文糖衣であり、非同期コードの書き込みと読み取りを容易にします。非同期コードを同期のように見せます。この記事は、何が何であるかを理解する...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>async / awaitによる非同期プログラミング</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/491012/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こんにちは！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
比較的新しいJavaScriptの追加は、非同期関数とawaitキーワードです。</font><font style="vertical-align: inherit;">これらの機能は基本的にはpromise（promise）に対する構文糖衣であり、非同期コードの書き込みと読み取りを容易にします。</font><font style="vertical-align: inherit;">非同期コードを同期のように見せます。</font><font style="vertical-align: inherit;">この記事は、何が何であるかを理解するのに役立ちます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
条件：基本的なコンピューターリテラシー、JSの基本に関する知識、非同期コードの基本と約束の理解。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
目的：約束がどのように作成され、どのように使用されるかを理解する。</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非同期/基本を待つ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
async / awaitの使用には2つの部分があります。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非同期キーワード</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず最初に、非同期にするために関数宣言の前に置くasyncキーワードがあります。</font><font style="vertical-align: inherit;">非同期関数は、awaitキーワードを使用して非同期コードを実行する機能を想定した関数です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ブラウザコンソールで次のように入力してみてください。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hello</span>(<span class="hljs-params"></span>)</span>{ <span class="hljs-keyword">return</span> <span class="hljs-string">'Hello'</span> }<font></font>
hello()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
関数は 'Hello'を返します。</font><font style="vertical-align: inherit;">異常なことはありませんか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、それを非同期関数にするとどうなるでしょうか。</font><font style="vertical-align: inherit;">以下を試してください：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hello</span>(<span class="hljs-params"></span>)</span>{ <span class="hljs-keyword">return</span> <span class="hljs-string">'Hello'</span> }<font></font>
hello()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、関数呼び出しはpromiseを返します。</font><font style="vertical-align: inherit;">これは非同期関数の機能の1つです-それらはpromiseに変換されることが保証されている値を返します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のように、非同期関数式を作成することもできます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> hello = <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{ <span class="hljs-keyword">return</span> hello() }<font></font>
hello()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
矢印関数を使用することもできます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> hello = <span class="hljs-keyword">async</span> () =&gt; { <span class="hljs-keyword">return</span> <span class="hljs-string">'Hello'</span> }
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらすべての関数は同じことを行います。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
完了したpromiseの値を取得するには、.then（）ブロックを使用できます。</font></font><br>
<br>
<pre><code class="javascript hljs">hello().then(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> <span class="hljs-built_in">console</span>.log(value))
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...またはそれでも：</font></font><br>
<br>
<pre><code class="javascript hljs">hello().then(<span class="hljs-built_in">console</span>.log)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、asyncキーワードを追加すると、関数は値ではなくpromiseを返します。</font><font style="vertical-align: inherit;">さらに、同期機能により、awaitの実行と使用に関連するオーバーヘッドを回避できます。</font><font style="vertical-align: inherit;">関数の前にasyncを追加するだけで、JSエンジンによる自動コード最適化が可能になります。</font><font style="vertical-align: inherit;">涼しい！</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キーワード待ち</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
非同期関数の利点は、awaitキーワードと組み合わせるとさらに明確になります。</font><font style="vertical-align: inherit;">これは、promiseベースの関数の前に追加して、promiseの完了を待機させ、結果を返すことができます。</font><font style="vertical-align: inherit;">その後、コードの次のブロックが実行されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Web API関数など、promiseを返す関数を呼び出すときにawaitを使用できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここに簡単な例があります：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hello</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">return</span> greeting = <span class="hljs-keyword">await</span> <span class="hljs-built_in">Promise</span>.resolve(<span class="hljs-string">'Hello'</span>)<font></font>
}<font></font>
<font></font>
hello().then(alert)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、上記のコードは役に立たず、構文のデモンストレーションとしてのみ機能します。</font><font style="vertical-align: inherit;">次に進んで、実際の例を見てみましょう。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">async / awaitを使用してpromiseのコードを書き換える</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前の記事のフェッチの例を見てみましょう。</font></font><br>
<br>
<pre><code class="javascript hljs">fetch(<span class="hljs-string">'coffee.jpg'</span>)<font></font>
.then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.blob())<font></font>
.then(<span class="hljs-function"><span class="hljs-params">myBlob</span> =&gt;</span> {
    <span class="hljs-keyword">let</span> objectURL = URL.createObjectURL(myBlob)
    <span class="hljs-keyword">let</span> image = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'img'</span>)<font></font>
    image.src = objectURL<font></font>
    <span class="hljs-built_in">document</span>.body.appendChild(image)<font></font>
})<font></font>
.catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'There has been a problem with your fetch operation: '</span> + e.message)<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あなたはすでに約束が何であるか、そしてそれらがどのように機能するかを理解しているはずですが、それがどれほど単純かを確認するためにasync / awaitを使用してこのコードを書き直しましょう：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myFetch</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">let</span> response = <span class="hljs-keyword">await</span> fetch(<span class="hljs-string">'coffee.jpg'</span>)
    <span class="hljs-keyword">let</span> myBlob = <span class="hljs-keyword">await</span> response.blob()<font></font>
<font></font>
    <span class="hljs-keyword">let</span> objectURL = URL.createObjectURL(myBlob)
    <span class="hljs-keyword">let</span> image = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'img'</span>)<font></font>
    image.src = objectURL<font></font>
    <span class="hljs-built_in">document</span>.body.appendChild(image)<font></font>
}<font></font>
<font></font>
myFetch().catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'There has been a problem with your fetch operation: '</span> + e.message)<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これにより、コードがはるかにシンプルでわかりやすくなります。.then（）ブロックはありません！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
asyncキーワードを使用すると、関数がpromiseに変わります。promiseとawaitの混合アプローチを使用して、柔軟性を高めるために、関数の2番目の部分を別のブロックで強調表示できます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myFetch</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">let</span> response = <span class="hljs-keyword">await</span> fetch(<span class="hljs-string">'coffee.jpg'</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> response.blob()<font></font>
}<font></font>
<font></font>
myFetch().then(<span class="hljs-function">(<span class="hljs-params">blob</span>) =&gt;</span> {
    <span class="hljs-keyword">let</span> objectURL = URL.createObjectURL(blob)
    <span class="hljs-keyword">let</span> image = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'image'</span>)<font></font>
    image.src = objectURL<font></font>
    <span class="hljs-built_in">document</span>.body.appendChild(image)<font></font>
}).catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(e))
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サンプルを書き直すか、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライブデモを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実行できます</font><font style="vertical-align: inherit;">（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソースコード</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">も参照</font><font style="vertical-align: inherit;">）。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">しかし、それはどのように機能しますか？</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
関数内にコードをラップし、functionキーワードの前にasyncキーワードを追加しました。非同期コードを実行するコードブロックを決定するには、非同期関数を作成する必要があります。 awaitは非同期関数内でのみ機能します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでも、awaitは非同期関数でのみ機能します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
myFetch（）関数の内部では、コードはpromiseのバージョンと非常によく似ていますが、いくつかの違いがあります。各promiseベースのメソッドの後に.then（）ブロックを使用する代わりに、メソッドを呼び出す前にawaitキーワードを追加して、変数に値を割り当てます。 awaitキーワードを使用すると、JSエンジンは指定された行でコードの実行を一時停止し、非同期関数が結果を返すまで別のコードを実行できます。実行されると、コードは次の行から実行を継続します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例えば：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> response = <span class="hljs-keyword">await</span> fetch(<span class="hljs-string">'coffee.jpg'</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fetch（）promiseによって返された値は、指定された値が利用可能になると応答変数に割り当てられ、パーサーはpromiseが完了するまでその行で停止します。</font><font style="vertical-align: inherit;">値が利用可能になるとすぐに、パーサーはBlobを作成する次のコード行に進みます。</font><font style="vertical-align: inherit;">この行はpromiseベースの非同期メソッドも呼び出すため、ここではawaitも使用しています。</font><font style="vertical-align: inherit;">操作の結果が返されると、myFetch（）関数から返されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、myFetch（）関数を呼び出すとpromiseが返されるので、それに.then（）を追加して、画面内での画像の表示を処理できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あなたはおそらく「それは素晴らしい！」と思うでしょう。そして、あなたは正しいです。コードをラップするための.then（）ブロックが少なく、すべて同期コードのように見えるので、直感的です。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エラー処理を追加する</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エラー処理を追加する場合は、いくつかのオプションがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
非同期のtry ... catch構造をasync / awaitで使用できます。</font><font style="vertical-align: inherit;">この例は、上記のコードの拡張バージョンです。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myFetch</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">try</span>{
        <span class="hljs-keyword">let</span> response = <span class="hljs-keyword">await</span> fetch(<span class="hljs-string">'coffee.jpg'</span>)
        <span class="hljs-keyword">let</span> myBlob = <span class="hljs-keyword">await</span> response.blob()<font></font>
<font></font>
        <span class="hljs-keyword">let</span> objectURL = URL.createObjectURL(myBlob)
        <span class="hljs-keyword">let</span> image = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'img'</span>)<font></font>
        image.src = objectURL<font></font>
        <span class="hljs-built_in">document</span>.body.appendChild(image)<font></font>
    } <span class="hljs-keyword">catch</span>(e){
        <span class="hljs-built_in">console</span>.log(e)<font></font>
    }<font></font>
}<font></font>
<font></font>
myFetch()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
catch（）{}ブロックは、「e」という名前のエラーオブジェクトを受け入れます。</font><font style="vertical-align: inherit;">これをコンソールに出力できるようになりました。これにより、コードでエラーが発生した場所に関するメッセージを受け取ることができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記のコードの2番目のバージョンを使用する場合は、次のように、ハイブリッドアプローチを継続して使用し、.catch（）ブロックを.then（）呼び出しの最後に追加するだけです。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myFetch</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">let</span> response = <span class="hljs-keyword">await</span> fecth(<span class="hljs-string">'coffee.jpg'</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> response.blob()<font></font>
}<font></font>
<font></font>
myFetch().then(<span class="hljs-function">(<span class="hljs-params">blob</span>) =&gt;</span> {
    <span class="hljs-keyword">let</span> objectURL = URL.createObjectURL
    <span class="hljs-keyword">let</span> image = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'img'</span>)<font></font>
    image.src = objectURL<font></font>
    <span class="hljs-built_in">document</span>.body.appendChild(image)<font></font>
}).catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(e))
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
.catch（）ブロックは、非同期関数とpromiseチェーンの両方で発生するエラーをキャッチするため、これが可能です。</font><font style="vertical-align: inherit;">ここでtry / catchブロックを使用すると、myFetch（）関数が呼び出されたときに発生するエラーを処理できなくなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
両方の例がGitHubにあります</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。simple-fetch-async-await-try-catch.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソースを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参照</font><font style="vertical-align: inherit;">）</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">simple-fetch-async-await-promise-catch.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソースを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参照</font><font style="vertical-align: inherit;">）</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Promise.all（）を待っています</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Async / awaitはpromiseに基づいているため、promiseを最大限に活用できます。</font><font style="vertical-align: inherit;">これらには特にPromise.all（）が含まれます-簡単にPromise.all（）にウェイトを追加して、同期コードと同様の方法ですべての戻り値を書き込むことができます。</font><font style="vertical-align: inherit;">もう一度、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前の記事の例を</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">見てみ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ましょ</font></a><font style="vertical-align: inherit;">う</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">タブを開いたままにし、以下に示すコードと比較します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
async / await（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライブデモ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソースコードを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参照</font><font style="vertical-align: inherit;">）を使用すると、次のようになります。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fetchAndDecode</span>(<span class="hljs-params">url, type</span>)</span>{
    <span class="hljs-keyword">let</span> repsonse = <span class="hljs-keyword">await</span> fetch(url)<font></font>
<font></font>
    <span class="hljs-keyword">let</span> content<font></font>
<font></font>
    <span class="hljs-keyword">if</span>(type === <span class="hljs-string">'blob'</span>){<font></font>
        content = <span class="hljs-keyword">await</span> response.blob()<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(type === <span class="hljs-string">'text'</span>){<font></font>
        content = <span class="hljs-keyword">await</span> response.text()<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> content<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">displayContent</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">let</span> coffee = fetchAndDecode(<span class="hljs-string">'coffee.jpg'</span>, <span class="hljs-string">'blob'</span>)
    <span class="hljs-keyword">let</span> tea = fetchAndDecode(<span class="hljs-string">'tea.jpg'</span>, <span class="hljs-string">'blob'</span>)
    <span class="hljs-keyword">let</span> description = fetchAndDecode(<span class="hljs-string">'description.txt'</span>, <span class="hljs-string">'text'</span>)<font></font>
<font></font>
    <span class="hljs-keyword">let</span> values = <span class="hljs-keyword">await</span> <span class="hljs-built_in">Promise</span>.all([coffee, tea, description])<font></font>
<font></font>
    <span class="hljs-keyword">let</span> objectURL1 = URL.createObjectURL(values[<span class="hljs-number">0</span>])
    <span class="hljs-keyword">let</span> objectURL2 = URL.createObjectURL(values[<span class="hljs-number">1</span>])
    <span class="hljs-keyword">let</span> descText = values[<span class="hljs-number">2</span>]<font></font>
<font></font>
    <span class="hljs-keyword">let</span> image1 = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'img'</span>)
    <span class="hljs-keyword">let</span> image2 = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'img'</span>)<font></font>
    image1.src = objectURL1<font></font>
    image2.src = objectURL2<font></font>
    <span class="hljs-built_in">document</span>.body.appendChild(image1)
    <span class="hljs-built_in">document</span>.body.appendChild(image2)<font></font>
<font></font>
    <span class="hljs-keyword">let</span> para = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'p'</span>)<font></font>
    para.textContent = descText<font></font>
    <span class="hljs-built_in">document</span>.body.appendChild(para)<font></font>
}<font></font>
<font></font>
displayContent()<font></font>
.catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(e))
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fetchAndDecode（）関数をいくつかの変更を加えて簡単に非同期にしました。</font><font style="vertical-align: inherit;">次の行に注意してください。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> values = <span class="hljs-keyword">await</span> <span class="hljs-built_in">Promise</span>.all([coffee, tea, description])
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
awaitを使用して、同期コードと同様の方法で、値変数の3つのpromiseの結果を取得します。</font><font style="vertical-align: inherit;">関数全体を新しい非同期関数displayContent（）でラップする必要があります。</font><font style="vertical-align: inherit;">強力なコード削減は実現しませんでしたが、.then（）ブロックからほとんどのコードを抽出することができました。これにより、便利な簡素化が提供され、コードが読みやすくなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エラーを処理するために、displayContent（）の呼び出しに.catch（）ブロックを追加しました。</font><font style="vertical-align: inherit;">両方の機能のエラーを処理します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
覚えておいてください。.finally（）ブロックを使用して、操作に関するレポートを取得することもできます— </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライブデモ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で動作を確認できます</font><font style="vertical-align: inherit;">（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソースコード</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">も参照</font><font style="vertical-align: inherit;">）。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非同期/デメリットを待つ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Async / awaitにはいくつかの欠陥があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Async / awaitは、コードを同期のように見せ、ある意味では、コードをより同期的に動作させます。 awaitキーワードは、同期操作で発生するように、promiseが完了するまで、それに続くコードの実行をブロックします。これにより、他のタスクを実行できますが、独自のコードはロックされます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、次々と続く多数の保留中のプロミスによってコードが遅くなる可能性があることを意味します。 await / awaitを使用していないかのように、約束が同時に満たされるようにしながら、各awaitは前のawaitの完了を待ちます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この問題を軽減するための設計パターンがあります。Promiseオブジェクトを変数に格納して待機することにより、すべてのpromiseプロセスを無効にします。</font><font style="vertical-align: inherit;">これがどのように実装されているか見てみましょう。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">自由に使える</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
2つの例：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">slow-async-await.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソースコードを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参照</font><font style="vertical-align: inherit;">）と</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fast-async-await.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソースコードを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参照</font><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">どちらの例も、setTimeout（）を使用して非同期操作を模倣するpromise関数で始まります。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">timeoutPromise</span>(<span class="hljs-params">interval</span>)</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {<font></font>
        setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<font></font>
            resolve(<span class="hljs-string">'done'</span>)<font></font>
        }, interval)<font></font>
    })<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、timeoutPromise（）への3つの呼び出しを期待する非同期関数timeTest（）に従います。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">timeTest</span>(<span class="hljs-params"></span>)</span>{<font></font>
    ...<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
timeTest（）への3つの呼び出しのそれぞれは、promiseを実行するためにかかった時間の記録で終了し、その後、操作全体を完了するためにかかった時間が記録されます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> startTime = <span class="hljs-built_in">Date</span>.now()<font></font>
timeTest().then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    <span class="hljs-keyword">let</span> finishTime = <span class="hljs-built_in">Date</span>.now()
    <span class="hljs-keyword">let</span> timeTaken = finishTime - startTime<font></font>
    alert(<span class="hljs-string">'Time taken in milliseconds: '</span> + timeTaken)<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いずれの場合も、timeTest（）関数は異なります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
slow-async-await.htmlでは、timeTest（）は次のようになります。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">timeTest</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">await</span> timeoutPromise(<span class="hljs-number">3000</span>)
    <span class="hljs-keyword">await</span> timeoutPromise(<span class="hljs-number">3000</span>)
    <span class="hljs-keyword">await</span> timeoutPromise(<span class="hljs-number">3000</span>)<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、timeoutPromiseへの3つの呼び出しを期待しています。毎回3秒の遅延を設定しています。</font><font style="vertical-align: inherit;">各呼び出しは、前の呼び出しの完了を待ちます。最初の例を実行すると、約9秒でモーダルウィンドウが表示されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fast-async-await.htmlでは、timeTest（）は次のようになります。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">timeTest</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">const</span> timeoutPromise1 = timeoutPromise(<span class="hljs-number">3000</span>)
    <span class="hljs-keyword">const</span> timeoutPromise2 = timeoutPromise(<span class="hljs-number">3000</span>)
    <span class="hljs-keyword">const</span> timeoutPromise3 = timeoutPromise(<span class="hljs-number">3000</span>)<font></font>
<font></font>
    <span class="hljs-keyword">await</span> timeoutPromise1
    <span class="hljs-keyword">await</span> timeoutPromise2
    <span class="hljs-keyword">await</span> timeoutPromise3<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、3つのPromiseオブジェクトを変数に保存します。これにより、それに関連付けられたプロセスが同時に実行されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、私たちは彼らの結果を期待しています-約束が同時に満たされ始めると、約束も同時に完了するでしょう。</font><font style="vertical-align: inherit;">2番目の例を実行すると、約3秒でモーダルウィンドウが表示されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードを注意深くテストし、パフォーマンスを低下させながらこれを覚えておく必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別のマイナーな不便な点は、非同期関数で期待される約束をラップする必要があることです。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスでasync / awaitを使用する</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結論として、クラスを作成するメソッドにも非同期を追加して、クラスがプロミスを返し、その中のプロミスを待機できることに注意してください。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オブジェクト指向のJSに関する記事</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">からコードを取得し、</font><font style="vertical-align: inherit;">それをasyncを使用して変更されたバージョンと比較します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span></span>{
    <span class="hljs-keyword">constructor</span>(first, last, age, gender, interests){
        <span class="hljs-keyword">this</span>.name = {<font></font>
            first,<font></font>
            last<font></font>
        }<font></font>
        <span class="hljs-keyword">this</span>.age = age
        <span class="hljs-keyword">this</span>.gender = gender
        <span class="hljs-keyword">this</span>.interests = interests<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">async</span> greeting(){
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-built_in">Promise</span>.resolve(<span class="hljs-string">`Hi! I'm <span class="hljs-subst">${<span class="hljs-keyword">this</span>.name.first}</span>`</span>)<font></font>
    }<font></font>
<font></font>
    farewell(){<font></font>
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">this</span>.name.first}</span> has left the building. Bye for now!`</span>)<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">let</span> han = <span class="hljs-keyword">new</span> Person(<span class="hljs-string">'Han'</span>, <span class="hljs-string">'Solo'</span>, <span class="hljs-number">25</span>, <span class="hljs-string">'male'</span>, [<span class="hljs-string">'Smuggling'</span>])
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスメソッドは次のように使用できます。</font></font><br>
<br>
<pre><code class="javascript hljs">han.greeting().then(<span class="hljs-built_in">console</span>.log)
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブラウザのサポート</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
async / awaitを使用する上での障害の1つは、古いブラウザーをサポートしていないことです。</font><font style="vertical-align: inherit;">この機能は、ほとんどすべての最新のブラウザーとPromiseで使用できます。</font><font style="vertical-align: inherit;">Internet ExplorerとOpera Miniにはいくつかの問題があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
async / awaitを使用したいが、古いブラウザーのサポートが必要な場合は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BabelJS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライブラリー</font><font style="vertical-align: inherit;">を使用できます。これにより、最新のJSを使用してブラウザー固有のJSに変換できます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Async / awaitを使用すると、読み取りと保守が簡単な非同期コードを記述できます。</font><font style="vertical-align: inherit;">async / awaitは、非同期コードを作成する他の方法よりもサポートが不十分ですが、検討する価値があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
清聴ありがとうございました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
幸せなコーディング！</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja490998/index.html">SIBURでのハードウェアテスト</a></li>
<li><a href="../ja491000/index.html">JavaScriptを使用しないSelect-Optionのスタイル設定（ほとんど）</a></li>
<li><a href="../ja491006/index.html">Unity3DのパスとしてのIntel NUC</a></li>
<li><a href="../ja491008/index.html">よく忘れられた古い</a></li>
<li><a href="../ja491010/index.html">機械学習に関する一連の記事：2020年2月の事例、ガイド、および研究</a></li>
<li><a href="../ja491016/index.html">問題＃32：ITトレーニング-主要企業の現在の問題と課題</a></li>
<li><a href="../ja491018/index.html">Nuxt.jsでのオンラインストアの作成2チュートリアルパート2</a></li>
<li><a href="../ja491028/index.html">蠅の王</a></li>
<li><a href="../ja491030/index.html">MediawikiをDebianにデプロイする（とても簡単です）</a></li>
<li><a href="../ja491032/index.html">「RTFM、おい！」または、チーズがいかに無料で5ドルかかるか。そしてそれは80ドルであったかもしれません+</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>