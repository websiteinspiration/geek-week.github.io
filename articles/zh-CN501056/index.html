<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😽 ℹ️ 👨🏿‍🤝‍👨🏽 为什么，何时以及如何在Python中使用多线程和多处理 🍚 🎲 👩🏽‍💼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="敬礼，哈布罗夫斯克。目前，OTUS已为机器学习课程开放了一套课程，与此相关的是，我们为您翻译了一个非常有趣的“童话”。走。
 
 
 
 从前，在一个遥远的星系中……一个
 
 聪明而强大的巫师生活在沙漠中间的一个小村庄。他们的名字叫邓布达夫。他不仅睿智而强大，而且还帮助来自遥远土地的人们向巫师寻求...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>为什么，何时以及如何在Python中使用多线程和多处理</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/501056/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">敬礼，哈布罗夫斯克。</font><font style="vertical-align: inherit;">目前，OTUS已为</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">机器学习</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">课程开放了一套课程</font><font style="vertical-align: inherit;">，与此相关的是，我们为您翻译了一个非常有趣的“童话”。</font><font style="vertical-align: inherit;">走。</font></font></i></b><br>
<br>
<img src="https://habrastorage.org/webt/mi/su/ev/misuevluvampqjc3br79pgtgscg.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从前，在一个遥远的星系中……一个</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
聪明而强大的巫师生活在沙漠中间的一个小村庄。</font><font style="vertical-align: inherit;">他们的名字叫邓布达夫。</font><font style="vertical-align: inherit;">他不仅睿智而强大，而且还帮助来自遥远土地的人们向巫师寻求帮助。</font><font style="vertical-align: inherit;">我们的故事始于一位旅行者为巫师带来了神奇的卷轴。</font><font style="vertical-align: inherit;">旅行者不知道卷轴里有什么，他只知道如果有人能揭开卷轴的所有秘密，那就是邓布达夫。</font></font><a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第1章：单线程，单进程</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您还没有猜到，我就对处理器及其功能进行类比。</font><font style="vertical-align: inherit;">我们的向导是一个处理器，滚动是一个链接列表，这些链接可导致Python掌握它的能力和知识。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一个向导毫不费力地破译清单的向导的第一个念头就是将他忠实的朋友（加里戈恩？我知道，我知道这听起来很糟糕）送到画卷中描述的每个地方，以便找到并带回他可以在那里找到的东西。</font></font><br>
<br>
<pre><code class="python hljs">In [<span class="hljs-number">1</span>]:
<span class="hljs-keyword">import</span> urllib.request
<span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> ThreadPoolExecutor<font></font>
In [<span class="hljs-number">2</span>]:<font></font>
urls = [<font></font>
  <span class="hljs-string">'http://www.python.org'</span>,
  <span class="hljs-string">'https://docs.python.org/3/'</span>,
  <span class="hljs-string">'https://docs.python.org/3/whatsnew/3.7.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/tutorial/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/library/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/reference/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/using/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/howto/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/installing/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/distributing/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/extending/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/c-api/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/faq/index.html'</span><font></font>
  ]<font></font>
In [<span class="hljs-number">3</span>]:<font></font>
%%time<font></font>
<font></font>
results = []<font></font>
<span class="hljs-keyword">for</span> url <span class="hljs-keyword">in</span> urls:
    <span class="hljs-keyword">with</span> urllib.request.urlopen(url) <span class="hljs-keyword">as</span> src:<font></font>
        results.append(src)<font></font>
<font></font>
CPU times: user <span class="hljs-number">135</span> ms, sys: <span class="hljs-number">283</span> µs, total: <span class="hljs-number">135</span> ms<font></font>
Wall time: <span class="hljs-number">12.3</span> s<font></font>
In [ ]:<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如您所见，我们只需使用for循环逐个迭代URL并读取答案。</font><font style="vertical-align: inherit;">多亏了</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">%%的时间</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPython</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的魔力</font><font style="vertical-align: inherit;">，我们可以看到我悲伤的互联网花费了大约12秒的时间。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2章：多线程</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
并非没有道理，巫师以他的智慧而闻名；他很快就能想出一种更有效的方法。与其将一个人按顺序送到每个地方，不如不聚集一群可靠的同伙并同时将他们发送到世界的不同地方！该向导将能够将他们带来的所有知识统一起来！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
没错，我们可以使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多线程</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一次访问多个URL </font><font style="vertical-align: inherit;">，而不必按顺序循环查看列表</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="python hljs">In [<span class="hljs-number">1</span>]:
<span class="hljs-keyword">import</span> urllib.request
<span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> ThreadPoolExecutor<font></font>
In [<span class="hljs-number">2</span>]:<font></font>
urls = [<font></font>
  <span class="hljs-string">'http://www.python.org'</span>,
  <span class="hljs-string">'https://docs.python.org/3/'</span>,
  <span class="hljs-string">'https://docs.python.org/3/whatsnew/3.7.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/tutorial/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/library/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/reference/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/using/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/howto/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/installing/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/distributing/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/extending/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/c-api/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/faq/index.html'</span><font></font>
  ]<font></font>
In [<span class="hljs-number">4</span>]:<font></font>
%%time<font></font>
<font></font>
<span class="hljs-keyword">with</span> ThreadPoolExecutor(<span class="hljs-number">4</span>) <span class="hljs-keyword">as</span> executor:<font></font>
    results = executor.map(urllib.request.urlopen, urls)<font></font>
<font></font>
CPU times: user <span class="hljs-number">122</span> ms, sys: <span class="hljs-number">8.27</span> ms, total: <span class="hljs-number">130</span> ms<font></font>
Wall time: <span class="hljs-number">3.83</span> s<font></font>
In [<span class="hljs-number">5</span>]:<font></font>
%%time<font></font>
<font></font>
<span class="hljs-keyword">with</span> ThreadPoolExecutor(<span class="hljs-number">8</span>) <span class="hljs-keyword">as</span> executor:<font></font>
    results = executor.map(urllib.request.urlopen, urls)<font></font>
<font></font>
CPU times: user <span class="hljs-number">122</span> ms, sys: <span class="hljs-number">14.7</span> ms, total: <span class="hljs-number">137</span> ms<font></font>
Wall time: <span class="hljs-number">1.79</span> s<font></font>
In [<span class="hljs-number">6</span>]:<font></font>
%%time<font></font>
<font></font>
<span class="hljs-keyword">with</span> ThreadPoolExecutor(<span class="hljs-number">16</span>) <span class="hljs-keyword">as</span> executor:<font></font>
    results = executor.map(urllib.request.urlopen, urls)<font></font>
<font></font>
CPU times: user <span class="hljs-number">143</span> ms, sys: <span class="hljs-number">3.88</span> ms, total: <span class="hljs-number">147</span> ms<font></font>
Wall time: <span class="hljs-number">1.32</span> s<font></font>
In [ ]:<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
好多了！几乎像...魔术。使用多个线程可以大大加快许多I / O任务。以我为例，花费在阅读URL上的大部分时间是由于网络延迟。您猜对了，与I / O关联的程序会花费大部分时间等待输入或输出（就像向导在等待其朋友从滚动条移到其他位置并返回）一样。可以从网络，数据库，文件或用户输入/输出。这样的I / O通常会花费很多时间，因为源可能需要在将数据传输到I / O之前执行预处理。例如，处理器的计数速度将比网络连接传输数据的速度快得多（速度约为例如Flash与您的祖母）。</font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><code>multithreading</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在清理网页等任务中非常有用。</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第三章：多处理</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多年过去了，好巫师的名声在增长，随之而来的是一个公正的黑暗巫师的嫉妒（Sarumort？或者Volandeman？）。</font><font style="vertical-align: inherit;">这位黑巫师手持不可估量的狡猾，羡慕不已，对邓布达夫施加了可怕的诅咒。</font><font style="vertical-align: inherit;">当诅咒超越了他时，邓布利夫意识到他只有片刻可以挡住他。</font><font style="vertical-align: inherit;">绝望的他翻遍了他的咒语书，很快找到了一个应该起作用的反咒语。</font><font style="vertical-align: inherit;">唯一的问题是向导需要计算所有小于1,000,000的素数之和，当然，这是一个奇怪的咒语，但我们拥有的咒语。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
巫师知道，如果他有足够的时间来计算价值，那将是微不足道的，但是他没有那么奢侈。尽管他是一个伟大的巫师，但他仍然受到人性的限制，一次只能检查一个数字。如果他决定简单地将素数相加，那将花费太多时间。在应用反咒语之前只剩几秒钟的时候，他突然想起了</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多处理</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">法术</font><font style="vertical-align: inherit;">，这是他多年前从魔术卷轴中学到的。此咒语将使他能够复制自己，以便在副本之间分配数字并同时检查多个副本。最后，他只需要简单地将他和他的副本会发现的数字相加即可。</font></font><br>
<br>
<pre><code class="python hljs">In [<span class="hljs-number">1</span>]:
<span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Pool<font></font>
In [<span class="hljs-number">2</span>]:
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">if_prime</span>(<span class="hljs-params">x</span>):</span>
    <span class="hljs-keyword">if</span> x &lt;= <span class="hljs-number">1</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
    <span class="hljs-keyword">elif</span> x &lt;= <span class="hljs-number">3</span>:
        <span class="hljs-keyword">return</span> x
    <span class="hljs-keyword">elif</span> x % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> x % <span class="hljs-number">3</span> == <span class="hljs-number">0</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
    i = <span class="hljs-number">5</span>
    <span class="hljs-keyword">while</span> i**<span class="hljs-number">2</span> &lt;= x:
        <span class="hljs-keyword">if</span> x % i == <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> x % (i + <span class="hljs-number">2</span>) == <span class="hljs-number">0</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
        i += <span class="hljs-number">6</span>
    <span class="hljs-keyword">return</span> x<font></font>
In [<span class="hljs-number">17</span>]:<font></font>
%%time<font></font>
<font></font>
answer = <span class="hljs-number">0</span><font></font>
<font></font>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1000000</span>):<font></font>
    answer += if_prime(i)<font></font>
<font></font>
CPU times: user <span class="hljs-number">3.48</span> s, sys: <span class="hljs-number">0</span> ns, total: <span class="hljs-number">3.48</span> s<font></font>
Wall time: <span class="hljs-number">3.48</span> s<font></font>
In [<span class="hljs-number">18</span>]:<font></font>
%%time<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    <span class="hljs-keyword">with</span> Pool(<span class="hljs-number">2</span>) <span class="hljs-keyword">as</span> p:<font></font>
        answer = sum(p.map(if_prime, list(range(<span class="hljs-number">1000000</span>))))<font></font>
<font></font>
CPU times: user <span class="hljs-number">114</span> ms, sys: <span class="hljs-number">4.07</span> ms, total: <span class="hljs-number">118</span> ms<font></font>
Wall time: <span class="hljs-number">1.91</span> s<font></font>
In [<span class="hljs-number">19</span>]:<font></font>
%%time<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    <span class="hljs-keyword">with</span> Pool(<span class="hljs-number">4</span>) <span class="hljs-keyword">as</span> p:<font></font>
        answer = sum(p.map(if_prime, list(range(<span class="hljs-number">1000000</span>))))<font></font>
<font></font>
CPU times: user <span class="hljs-number">99.5</span> ms, sys: <span class="hljs-number">30.5</span> ms, total: <span class="hljs-number">130</span> ms<font></font>
Wall time: <span class="hljs-number">1.12</span> s<font></font>
In [<span class="hljs-number">20</span>]:<font></font>
%%timeit<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    <span class="hljs-keyword">with</span> Pool(<span class="hljs-number">8</span>) <span class="hljs-keyword">as</span> p:<font></font>
        answer = sum(p.map(if_prime, list(range(<span class="hljs-number">1000000</span>))))<font></font>
<font></font>
<span class="hljs-number">729</span> ms ± <span class="hljs-number">3.02</span> ms per loop (mean ± std. dev. of <span class="hljs-number">7</span> runs, <span class="hljs-number">1</span> loop each)<font></font>
In [<span class="hljs-number">21</span>]:<font></font>
%%timeit<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    <span class="hljs-keyword">with</span> Pool(<span class="hljs-number">16</span>) <span class="hljs-keyword">as</span> p:<font></font>
        answer = sum(p.map(if_prime, list(range(<span class="hljs-number">1000000</span>))))<font></font>
<font></font>
<span class="hljs-number">512</span> ms ± <span class="hljs-number">39.8</span> ms per loop (mean ± std. dev. of <span class="hljs-number">7</span> runs, <span class="hljs-number">1</span> loop each)<font></font>
In [<span class="hljs-number">22</span>]:<font></font>
%%timeit<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    <span class="hljs-keyword">with</span> Pool(<span class="hljs-number">32</span>) <span class="hljs-keyword">as</span> p:<font></font>
        answer = sum(p.map(if_prime, list(range(<span class="hljs-number">1000000</span>))))<font></font>
<font></font>
<span class="hljs-number">518</span> ms ± <span class="hljs-number">13.3</span> ms per loop (mean ± std. dev. of <span class="hljs-number">7</span> runs, <span class="hljs-number">1</span> loop each)<font></font>
In [<span class="hljs-number">23</span>]:<font></font>
%%timeit<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    <span class="hljs-keyword">with</span> Pool(<span class="hljs-number">64</span>) <span class="hljs-keyword">as</span> p:<font></font>
        answer = sum(p.map(if_prime, list(range(<span class="hljs-number">1000000</span>))))<font></font>
<font></font>
<span class="hljs-number">621</span> ms ± <span class="hljs-number">10.5</span> ms per loop (mean ± std. dev. of <span class="hljs-number">7</span> runs, <span class="hljs-number">1</span> loop each)<font></font>
In [ ]:</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现代处理器具有多个核心，因此我们可以使用多进程处理模块</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">multiprocessing</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来加速任务</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">与处理器相关联的任务是程序，它们在大多数时间都在处理器上执行计算（简单的数学计算，图像处理等）。</font><font style="vertical-align: inherit;">如果计算可以彼此独立进行，我们就有机会在可用处理器内核之间进行划分，从而显着提高处理速度。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您要做的就是：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确定要应用的功能。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">准备要应用该功能的元素列表；</font></font></li>
<li>    <code>multiprocessing.Pool</code>. ,     <code>Pool()</code>,     .   <code>with</code> ,         .</li>
<li>     Pool    <code>map</code>.    map  ,    ,    .</li>
</ol><br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：可以定义一个函数来执行可以并行执行的任何任务。例如，一个函数可能包含将计算结果写入文件的代码。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
那么为什么我们需要分开</font></font><code>multiprocessing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>multithreading</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">？如果您曾经尝试使用多线程来提高处理器上任务的性能，那么结果恰恰相反。那太可怕了！让我们看看它是怎么发生的。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
正如向导本身受人性的限制并且每单位时间只能计算一个数字一样，Python附带了一个称为</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全局解释器锁定（GIL）的东西</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。 Python很乐意让您产生所需数量的线程，但是</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GIL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确保在任何给定时间仅执行这些线程之一。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于与I / O相关的任务，这种情况是完全正常的。一个线程将请求发送到一个URL并等待响应，然后才能将该线程替换为另一个线程，这会将另一个请求发送到另一个URL。由于线程在收到响应之前不需要执行任何操作，因此在给定时间仅运行一个线程没有任何区别。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于在处理器上执行的任务，拥有多个线程几乎与装甲中的乳头一样没用。由于每单位时间只能执行一个线程，因此即使您生成多个线程，每个线程都会分配一个数字以进行简单性检查，所以处理器仍然只能使用一个线程。实际上，这些数字仍将一一检查。使用多个线程的开销将有助于降低性能，您可以</font></font><code>multithreading</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在处理器上执行的任务中</font><font style="vertical-align: inherit;">观察</font><font style="vertical-align: inherit;">到这一点。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了避免这种“限制”，我们使用了</font></font><code>multiprocessing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。正如您所说，多处理使用了多个进程，而不是使用线程。每个进程都有自己的个人解释器和内存空间，因此GIL不会限制您。实际上，每个进程都将使用其自己的处理器内核并以其自己的唯一编号工作，并且这将与其他进程的工作同时执行。他们多么甜蜜！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可能会注意到，</font></font><code>multiprocessing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与常规for循环甚至相比，</font><font style="vertical-align: inherit;">使用CPU时的负载会更高</font></font><code>multithreading</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。发生这种情况是因为您的程序不是使用一个内核，而是使用多个内核。这很好！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
记住，</font></font><code>multiprocessing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它有自己的管理多个进程的开销，通常比多线程的开销要严重得多。 （多处理产生单独的解释器，并为每个进程分配其自己的内存区域，所以是的！）也就是说，通常，当您想以这种方式退出时最好使用轻量级的多线程版本（记住与I / O相关的任务）。但是当处理器上的计算成为瓶颈时，模块时间就到了</font></font><code>multiprocessing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。但是请记住，强大的力量伴随着巨大的责任。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果产生的进程多于处理器每单位时间可处理的进程，则您会注意到性能将开始下降。</font><font style="vertical-align: inherit;">发生这种情况的原因是，由于存在更多的进程，因此操作系统需要通过改组处理器内核之间的进程来做更多的工作。</font><font style="vertical-align: inherit;">实际上，一切可能比我今天告诉你的还要复杂，但是我传达了主要思想。</font><font style="vertical-align: inherit;">例如，在我的系统上，当进程数为16时，性能将下降。这是因为处理器中只有16个逻辑核心。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第四章：结论</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在与I / O相关的任务中，它</font></font><code>multithreading</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以提高性能。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在与I / O相关的任务中，</font></font><code>multiprocessing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它也可以提高生产率，但是通常来说，成本比使用时要高</font></font><code>multithreading</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python GIL的存在使我们很清楚，程序中的任何给定时间只能执行一个线程。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在与处理器有关的任务中，使用</font></font><code>multithreading</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会降低性能。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在与处理器相关的任务中，使用</font></font><code>multiprocessing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以提高性能。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">奇才很棒！</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这就是我们将结束我们的介绍</font></font><code>multithreading</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并</font></font><code>multiprocessing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在Python </font><font style="vertical-align: inherit;">今天</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">现在去赢！</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“使用图形分析和解析开放数据来建模COVID-19。” </font><font style="vertical-align: inherit;">免费课程。</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN501044/index.html">Не держите людей за идиотов или почему человек с инженерным образованием может сжечь вышку сотовой связи (видео)</a></li>
<li><a href="../zh-CN501046/index.html">围绕稳固的优势：C ++ Russia 2019 Piter会议的十大报告</a></li>
<li><a href="../zh-CN501048/index.html">在OpenVPN上组织远程工作SMB组织</a></li>
<li><a href="../zh-CN501050/index.html">安装并激活LabVIEW社区版</a></li>
<li><a href="../zh-CN501052/index.html">中国宇宙飞船的回归</a></li>
<li><a href="../zh-CN501058/index.html">Teamcenter快速启动解决方案可帮助工业设备制造商将设计时间缩短25％</a></li>
<li><a href="../zh-CN501060/index.html">5月13日至14日，JetBrains .NET天在线</a></li>
<li><a href="../zh-CN501062/index.html">PHP俄罗斯免费在线部分的所有报告（有外国演讲者）都可以翻译得到</a></li>
<li><a href="../zh-CN501064/index.html">飞往中国实验船。图表和拼贴。</a></li>
<li><a href="../zh-CN501068/index.html">深度假货和深度媒体：安全的新战场</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>