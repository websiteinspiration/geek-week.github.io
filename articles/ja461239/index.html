<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤳🏼 🆘 😌 例のフラッター。Flutterアプリケーションのディープリンク 🥉 🙎🏿 📯</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Googleの新しいマルチプラットフォームフレームワークであるFlutterは着実にファンを獲得しています。ますます多くの人々がこの技術に興味を持ち、ペットと商用プロジェクトの両方でそれを試します。 RuNetにはますます多くの記事と例が表示されますが、少し前に、Mediumとは異なり、テクノロジー...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>例のフラッター。Flutterアプリケーションのディープリンク</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/epam_systems/blog/461239/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Googleの新しいマルチプラットフォームフレームワークであるFlutterは着実にファンを獲得しています。ますます多くの人々がこの技術に興味を持ち、ペットと商用プロジェクトの両方でそれを試します。 RuNetにはますます多くの記事と例が表示されますが、少し前に、Mediumとは異なり、テクノロジー全体に焦点を当てたレビュー記事とその利点、または最新バージョンで提示された新しい記事がHabréで主流であることに気付きました。特定のケースに関するテキストはほとんどありません。そのため、現状を是正する必要があると判断しました。最初に、最も一般的なケースではなく、十分に使用されているディープリンクから始めます。</font></font><br>
<img src="https://habrastorage.org/getpro/habr/post_images/28d/92d/505/28d92d5054ae40ababa4463ca68e7632.png" alt="画像"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最近、ディープリンクを使用してFlutterアプリケーションを起動するタスクがありました。 Flutterでそれらを使用する方法について適切なアイデアを得るために、ドキュメントを調べて実験する必要がありました。今回はその結果をまとめてみましたので、同じ課題に直面している方がわかりやすくなりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ディープリンクは、iOSまたはAndroid上のモバイルアプリケーション内の特定のコンテンツに移動する機能をユーザーに提供するURLです。これは、アプリケーションがどのように開かれたかを追跡する必要があることを意味します。標準的な方法またはリンクを使用して、さらに、移行が完了したときにアプリケーションがすでに開いている場合があります。したがって、実行中のアプリケーションのバックグラウンドでクリックスルーを追跡する必要があります。 Flutterでこれを行うための最良の方法を見てみましょう。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">まず最初に設定です</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ネイティブ開発でディープリンクを使用するには、プロジェクトで適切な構成を準備する必要があります。</font><font style="vertical-align: inherit;">Flutterアプリケーションの場合、これはネイティブの場合とまったく同じ方法で行われます。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iOS</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Appleエコシステムでこのようなリンクを作成するには、「カスタムURLスキーム」と「ユニバーサルリンク」の2つの方法があります。</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カスタムURLスキーム</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -指定したホストに関係なく、カスタムスキームを使用できます。</font><font style="vertical-align: inherit;">このアプローチは最も簡単ですが、微妙な違いがあります。スキームが一意であることを確認する必要があります。さらに、アプリケーションがインストールされていないとリンクが機能しません。</font><font style="vertical-align: inherit;">カスタムURLスキームを使用する場合、次のようなリンクを使用できます。</font></font><code>your_scheme://any_host</code></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Universal Links</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は少し複雑なアプローチです。</font><font style="vertical-align: inherit;">httpsスキームと特定のホストでのみ作業できますが、このホストを使用する権限を確認する必要があります。このホストに対して、ファイルをサーバーに配置する必要があります-apple-app-site-association。</font><font style="vertical-align: inherit;">ユニバーサルリンクは、URLでアプリケーションを実行する機会を</font></font><code>https://your_host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供します。インストールされているアプリケーションがない場合は、ストアからインストールするか、ブラウザーでリンクを開くことを提案します。</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、カスタムURLスキームのアプローチを使用しています。</font><font style="vertical-align: inherit;">次の部分をInfo.plistファイルに追加します。</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>CFBundleURLTypes<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">array</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dict</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>CFBundleTypeRole<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>Editor<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>CFBundleURLName<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>deeplink.flutter.dev<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>CFBundleURLSchemes<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">array</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>poc<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">array</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dict</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">array</span>&gt;</span></code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アンドロイド</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Androidエコシステムには、ほぼ同じプロパティをリンクする2つの方法もあります。</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ディープリンク</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -（iOSのカスタムURLスキームと同様に）どのホストを指定しても、カスタムスキームを使用できます。</font></font><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アプリリンク</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -httpsスキームと特定のホスト（iOSのユニバーサルリンクと同様）でのみ作業できます。また、デジタルアセットリンクサーバーにJSONファイルを配置して、このホストを使用する権限を確認する必要があります。</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Androidの場合も、複雑にしないことを決定し、ディープリンクを使用しました。</font><font style="vertical-align: inherit;">これをAndroidManifest.xmlに追加します。</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">intent-filter</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.intent.action.VIEW"</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">category</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.intent.category.DEFAULT"</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">category</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.intent.category.BROWSABLE"</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">data</span>
    <span class="hljs-attr">android:scheme</span>=<span class="hljs-string">"poc"</span>
    <span class="hljs-attr">android:host</span>=<span class="hljs-string">"deeplink.flutter.dev"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">intent-filter</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、スキーム用に両方のプラットフォームのアプリケーションを構成し</font></font><code>poc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、それらのURLを処理できるようになります</font></font><code>poc://deeplink.flutter.dev</code><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クッキングプラットフォームチャネル</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、各プラットフォームのネイティブ構成の準備が整いました。</font><font style="vertical-align: inherit;">ただし、構成に加えて、ネイティブパーツがFlutterとやり取りするプラットフォームチャネルを準備する必要があります。</font><font style="vertical-align: inherit;">また、AndroidとiOSの両方で実装を準備する必要があります。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Androidから始めましょう。</font><font style="vertical-align: inherit;">何もする必要はありません。アプリケーションがディープリンクを介して実行されている場合は、onCreateメソッドで着信インテントを処理し、MethodChannelを作成して、それにURIを渡します。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String CHANNEL = <span class="hljs-string">"poc.deeplink.flutter.dev/channel"</span>;<font></font>
<font></font>
<span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> </span>{
  <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);<font></font>
  GeneratedPluginRegistrant.registerWith(<span class="hljs-keyword">this</span>);<font></font>
<font></font>
  Intent intent = getIntent();<font></font>
  Uri data = intent.getData();<font></font>
<font></font>
  <span class="hljs-keyword">new</span> MethodChannel(getFlutterView(), CHANNEL).setMethodCallHandler(
          <span class="hljs-keyword">new</span> MethodChannel.MethodCallHandler() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onMethodCall</span><span class="hljs-params">(MethodCall call, MethodChannel.Result result)</span> </span>{
              <span class="hljs-keyword">if</span> (call.method.equals(<span class="hljs-string">"initialLink"</span>)) {
                <span class="hljs-keyword">if</span> (startString != <span class="hljs-keyword">null</span>) {<font></font>
                  result.success(startString);<font></font>
                }<font></font>
              }<font></font>
            }<font></font>
          });<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (data != <span class="hljs-keyword">null</span>) {<font></font>
    startString = data.toString();<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
iOSでは、すべてが少し異なりますが、一般的には同じです。URIをMethodChannelを介してアプリケーションに渡します。</font><font style="vertical-align: inherit;">Objecttive-Cでは物事は私にはあまり良くないので、私はSwiftに実装することにしました。</font><font style="vertical-align: inherit;">次は変更されたAppDelegate.swiftです</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-meta">@UIApplicationMain</span>
<span class="hljs-meta">@objc</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppDelegate</span>: <span class="hljs-title">FlutterAppDelegate</span> </span>{<font></font>
  <font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> methodChannel: <span class="hljs-type">FlutterMethodChannel?</span><font></font>
  <font></font>
  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">application</span><span class="hljs-params">(
    <span class="hljs-number">_</span> application: UIApplication,
    didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: <span class="hljs-keyword">Any</span>]?
  )</span></span> -&gt; <span class="hljs-type">Bool</span> {<font></font>
    <font></font>
    <span class="hljs-keyword">let</span> controller = window.rootViewController <span class="hljs-keyword">as</span>! <span class="hljs-type">FlutterViewController</span>
    methodChannel = <span class="hljs-type">FlutterMethodChannel</span>(name: <span class="hljs-string">"poc.deeplink.flutter.dev/channel"</span>, binaryMessenger: controller)<font></font>
   <font></font>
    methodChannel?.setMethodCallHandler({ (call: <span class="hljs-type">FlutterMethodCall</span>, result: <span class="hljs-type">FlutterResult</span>) <span class="hljs-keyword">in</span>
      <span class="hljs-keyword">guard</span> call.method == <span class="hljs-string">"initialLink"</span> <span class="hljs-keyword">else</span> {<font></font>
        result(<span class="hljs-type">FlutterMethodNotImplemented</span>)
        <span class="hljs-keyword">return</span><font></font>
      }<font></font>
    })<font></font>
    <font></font>
    <font></font>
    <span class="hljs-type">GeneratedPluginRegistrant</span>.register(with: <span class="hljs-keyword">self</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.application(application, didFinishLaunchingWithOptions: launchOptions)<font></font>
  }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、Deep Linkを介してアプリケーションの起動を処理します。</font><font style="vertical-align: inherit;">しかし、アプリケーションがすでに実行されているときにリンクがたどった場合はどうなりますか？</font><font style="vertical-align: inherit;">この瞬間を考慮する必要があります。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Androidでは、このためにonNewIntentメソッドをオーバーライドし、着信する各インテントを処理します。</font><font style="vertical-align: inherit;">これがリンククリックの場合、特別に作成されたBroadcastReceiverを介して、このために作成されたEventChannelにイベントをスローします。</font></font><br>
<br>
<pre><code class="java hljs">  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String EVENTS = <span class="hljs-string">"poc.deeplink.flutter.dev/events"</span>;
  <span class="hljs-keyword">private</span> BroadcastReceiver linksReceiver;<font></font>
<font></font>
  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> </span>{
    <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);<font></font>
    GeneratedPluginRegistrant.registerWith(<span class="hljs-keyword">this</span>);<font></font>
<font></font>
    <span class="hljs-keyword">new</span> EventChannel(getFlutterView(), EVENTS).setStreamHandler(
            <span class="hljs-keyword">new</span> EventChannel.StreamHandler() {
              <span class="hljs-meta">@Override</span>
              <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onListen</span><span class="hljs-params">(Object args, <span class="hljs-keyword">final</span> EventChannel.EventSink events)</span> </span>{<font></font>
                linksReceiver = createChangeReceiver(events);<font></font>
              }<font></font>
<font></font>
              <span class="hljs-meta">@Override</span>
              <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCancel</span><span class="hljs-params">(Object args)</span> </span>{<font></font>
                linksReceiver = <span class="hljs-keyword">null</span>;<font></font>
              }<font></font>
            }<font></font>
    );<font></font>
  }<font></font>
<font></font>
  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onNewIntent</span><span class="hljs-params">(Intent intent)</span></span>{
    <span class="hljs-keyword">super</span>.onNewIntent(intent);
    <span class="hljs-keyword">if</span>(intent.getAction() == android.content.Intent.ACTION_VIEW &amp;&amp; linksReceiver != <span class="hljs-keyword">null</span>) {<font></font>
      linksReceiver.onReceive(<span class="hljs-keyword">this</span>.getApplicationContext(), intent);<font></font>
    }<font></font>
  }<font></font>
<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">private</span> BroadcastReceiver <span class="hljs-title">createChangeReceiver</span><span class="hljs-params">(<span class="hljs-keyword">final</span> EventChannel.EventSink events)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BroadcastReceiver() {
      <span class="hljs-meta">@Override</span>
      <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onReceive</span><span class="hljs-params">(Context context, Intent intent)</span> </span>{
        <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> assuming intent.getAction() is Intent.ACTION_VIEW</span><font></font>
<font></font>
        String dataString = intent.getDataString();<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (dataString == <span class="hljs-keyword">null</span>) {<font></font>
          events.error(<span class="hljs-string">"UNAVAILABLE"</span>, <span class="hljs-string">"Link unavailable"</span>, <span class="hljs-keyword">null</span>);<font></font>
        } <span class="hljs-keyword">else</span> {<font></font>
          events.success(dataString);<font></font>
        }<font></font>
        ;<font></font>
      }<font></font>
    };<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
iOSの部分でも同じことをしましょう。</font><font style="vertical-align: inherit;">Swiftでは、FlutterStreamHandlerを作成し、アプリケーションがバックグラウンドにある間に受け取ったリンクを処理する必要があります。</font><font style="vertical-align: inherit;">AppDelegate.swiftをもう一度変更する時が来ました</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-meta">@UIApplicationMain</span>
<span class="hljs-meta">@objc</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppDelegate</span>: <span class="hljs-title">FlutterAppDelegate</span> </span>{
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> eventChannel: <span class="hljs-type">FlutterEventChannel?</span><font></font>
  <font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> linkStreamHandler = <span class="hljs-type">LinkStreamHandler</span>()<font></font>
  <font></font>
  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">application</span><span class="hljs-params">(
    <span class="hljs-number">_</span> application: UIApplication,
    didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: <span class="hljs-keyword">Any</span>]?
  )</span></span> -&gt; <span class="hljs-type">Bool</span> {<font></font>
    <font></font>
    <span class="hljs-keyword">let</span> controller = window.rootViewController <span class="hljs-keyword">as</span>! <span class="hljs-type">FlutterViewController</span>
    eventChannel = <span class="hljs-type">FlutterEventChannel</span>(name: <span class="hljs-string">"poc.deeplink.flutter.dev/events"</span>, binaryMessenger: controller)<font></font>
       <font></font>
    <span class="hljs-type">GeneratedPluginRegistrant</span>.register(with: <span class="hljs-keyword">self</span>)<font></font>
    eventChannel?.setStreamHandler(linkStreamHandler)<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.application(application, didFinishLaunchingWithOptions: launchOptions)<font></font>
  }<font></font>
  <font></font>
  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">application</span><span class="hljs-params">(<span class="hljs-number">_</span> app: UIApplication, <span class="hljs-keyword">open</span> url: URL, options: [UIApplicationOpenURLOptionsKey : <span class="hljs-keyword">Any</span>] = [:])</span></span> -&gt; <span class="hljs-type">Bool</span> {<font></font>
    eventChannel?.setStreamHandler(linkStreamHandler)<font></font>
    <span class="hljs-keyword">return</span> linkStreamHandler.handleLink(url.absoluteString)<font></font>
  }<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LinkStreamHandler</span>:<span class="hljs-title">NSObject</span>, <span class="hljs-title">FlutterStreamHandler</span> </span>{<font></font>
  <font></font>
  <span class="hljs-keyword">var</span> eventSink: <span class="hljs-type">FlutterEventSink?</span><font></font>
  <font></font>
  <span class="hljs-comment">// links will be added to this queue until the sink is ready to process them</span>
  <span class="hljs-keyword">var</span> queuedLinks = [<span class="hljs-type">String</span>]()<font></font>
  <font></font>
  <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">onListen</span><span class="hljs-params">(withArguments arguments: <span class="hljs-keyword">Any</span>?, eventSink events: @escaping FlutterEventSink)</span></span> -&gt; <span class="hljs-type">FlutterError?</span> {
    <span class="hljs-keyword">self</span>.eventSink = events<font></font>
    queuedLinks.forEach({ events($<span class="hljs-number">0</span>) })<font></font>
    queuedLinks.removeAll()<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><font></font>
  }<font></font>
  <font></font>
  <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">onCancel</span><span class="hljs-params">(withArguments arguments: <span class="hljs-keyword">Any</span>?)</span></span> -&gt; <span class="hljs-type">FlutterError?</span> {
    <span class="hljs-keyword">self</span>.eventSink = <span class="hljs-literal">nil</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><font></font>
  }<font></font>
  <font></font>
  <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">handleLink</span><span class="hljs-params">(<span class="hljs-number">_</span> link: String)</span></span> -&gt; <span class="hljs-type">Bool</span> {
    <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> eventSink = eventSink <span class="hljs-keyword">else</span> {<font></font>
      queuedLinks.append(link)<font></font>
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><font></font>
    }<font></font>
    eventSink(link)<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
両方の部分（アプリケーションを起動する部分とアプリケーションのバックグラウンドでの部分）を組み合わせる場合、ディープリンクに対するすべてのユーザークリックを制御します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flutterでのディープリンクの処理</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プラットフォームパーツの準備が整ったので、Flutterパーツに移りましょう。</font><font style="vertical-align: inherit;">おそらくご存じのとおり、さまざまなアーキテクチャアプローチを使用してフラッター上にアプリケーションを作成できます。</font><font style="vertical-align: inherit;">このトピックについてはすでに多くの記事が書かれていますが（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">たとえば、この</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記事</font><font style="vertical-align: inherit;">）、個人的には純粋なBLoCが最も適切なアプローチであるように思えます。</font><font style="vertical-align: inherit;">したがって、これらのリンクを処理する別のBLoCを準備します。</font><font style="vertical-align: inherit;">その結果、UIにまったく関連付けられていないコードを取得し、都合の良い場所でリンクの受信を処理できます。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DeepLinkBloc</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Bloc</span> </span>{<font></font>
<font></font>
  <span class="hljs-comment">//Event Channel creation</span>
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> stream = <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-title">EventChannel</span><span class="hljs-params">(<span class="hljs-string">'poc.deeplink.flutter.dev/events'</span>)</span></span>;<font></font>
<font></font>
  <span class="hljs-comment">//Method channel creation</span>
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> platform = <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-title">MethodChannel</span><span class="hljs-params">(<span class="hljs-string">'poc.deeplink.flutter.dev/channel'</span>)</span></span>;<font></font>
<font></font>
  StreamController&lt;String&gt; _stateController = StreamController();<font></font>
<font></font>
  Stream&lt;String&gt; get state =&gt; _stateController.stream;<font></font>
<font></font>
  Sink&lt;String&gt; get stateSink =&gt; _stateController.sink;<font></font>
<font></font>
<font></font>
  <span class="hljs-comment">//Adding the listener into contructor</span><font></font>
  DeepLinkBloc() {<font></font>
    <span class="hljs-comment">//Checking application start by deep link</span><font></font>
    startUri().then(_onRedirected);<font></font>
    <span class="hljs-comment">//Checking broadcast stream, if deep link was clicked in opened appication</span><font></font>
    stream.receiveBroadcastStream().listen((d) =&gt; _onRedirected(d));<font></font>
  }<font></font>
<font></font>
<font></font>
  _onRedirected(String uri) {<font></font>
    <span class="hljs-comment">// Here can be any uri analysis, checking tokens etc, if it’s necessary</span>
    <span class="hljs-comment">// Throw deep link URI into the BloC's stream</span><font></font>
    stateSink.add(uri);<font></font>
  }<font></font>
<font></font>
<font></font>
  <span class="hljs-meta">@override</span>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dispose</span><span class="hljs-params">()</span> </span>{<font></font>
    _stateController.close();<font></font>
  }<font></font>
<font></font>
<font></font>
  <span class="hljs-function">Future&lt;String&gt; <span class="hljs-title">startUri</span><span class="hljs-params">()</span> async </span>{
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">return</span> platform.invokeMethod(<span class="hljs-string">'initialLink'</span>);<font></font>
    } <span class="hljs-function">on PlatformException <span class="hljs-title">catch</span> <span class="hljs-params">(e)</span> </span>{
      <span class="hljs-keyword">return</span> <span class="hljs-string">"Failed to Invoke: '${e.message}'."</span>;<font></font>
    }<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
特に、これまでにBLoCやStreamBuildersを使用したことがない人のために、このBLoCで動作するウィジェットの例を用意します。</font><font style="vertical-align: inherit;">ウィジェットはStreamBuilderに基づいています。StreamBuilderは、ストリームから受信したイベントに応じてUIを再構築します。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PocWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-meta">@override</span>
  <span class="hljs-function">Widget <span class="hljs-title">build</span><span class="hljs-params">(BuildContext context)</span> </span>{<font></font>
    DeepLinkBloc _bloc = Provider.of&lt;DeepLinkBloc&gt;(context);<font></font>
    <span class="hljs-keyword">return</span> StreamBuilder&lt;String&gt;(<font></font>
      stream: _bloc.state,<font></font>
      builder: (context, snapshot) {<font></font>
        <span class="hljs-keyword">if</span> (!snapshot.hasData) {
          <span class="hljs-keyword">return</span> Container(<font></font>
              child: Center(<font></font>
                  child: Text(<span class="hljs-string">'No deep link was used  '</span>)));<font></font>
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> Container(<font></font>
              child: Center(<font></font>
                  child: Padding(<font></font>
                      padding: EdgeInsets.all(<span class="hljs-number">20.0</span>),<font></font>
                      child: Text(<span class="hljs-string">'Redirected: ${snapshot.data}'</span>))));<font></font>
        }<font></font>
      },<font></font>
    );<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
タダム！</font><font style="vertical-align: inherit;">それで全部です。</font><font style="vertical-align: inherit;">今、すべてがうまくいきます！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テストするには、3つの異なる方法でアプリケーションを実行します。</font><font style="vertical-align: inherit;">ディープリンクを介して手動で、最初にURI </font></font><code>poc://deeplink.flutter.dev</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用し、次にを使用し</font></font><code>poc://deeplink.flutter.dev/parameter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/429/1a8/c10/4291a8c100fbc77a0e6cba5910ae9fca.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これが</font><font style="vertical-align: inherit;">何が起こったかのスクリーンショットです：</font><font style="vertical-align: inherit;">ディープリンクを操作する他の方法があります。</font><font style="vertical-align: inherit;">たとえば、このために</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Firebase Dynamic Links</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用できます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">Flutterでの使用方法に関する</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">優れた記事</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">があり</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">ディープリンクを接続するための</font><font style="vertical-align: inherit;">既製の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「ユニリンク」ライブラリ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">もあります。これを使用できます。</font><font style="vertical-align: inherit;">また、サードパーティのライブラリに依存したくない場合は、いつでも独自のライブラリを実装できます。</font><font style="vertical-align: inherit;">私の記事がこれに役立つことを願っています！</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソースコード</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記の例のソースコードは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちらで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">確認</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">できます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">役立つ情報</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここまでの記事を読んだら、おそらくFlutterの開発に興味があるでしょう）。</font><font style="vertical-align: inherit;">あなたに役立つかもしれないいくつかのリソースについてお話したいと思います。</font><font style="vertical-align: inherit;">少し前に、Flutterの開発に直接関連するロシア語を話すポッドキャストのペアが作成されました。</font><font style="vertical-align: inherit;">購読することをお勧めします</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。Flutter開発</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の書き込みに関する問題について説明する</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Flutter Dev Podcast</font></a><font style="vertical-align: inherit;">（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">電報</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">チャネル</font></a><font style="vertical-align: inherit;">）と、モバイル開発の問題をさまざまな観点から原理的に説明する</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mobile People Talks</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">電報のチャネル</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）です。</font><font style="vertical-align: inherit;">主要なモバイルピープルトークは、iOS、Android、ReactNative、Flutterです。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/c3e/9ec/3f1/c3e9ec3f1258cdf6656a156db6841ca3.png" alt="画像"></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja461223/index.html">IaaSダイジェスト：データセンター向けの高性能、データストレージ、新技術</a></li>
<li><a href="../ja461225/index.html">バルネオの漂流基地から北極への行き方</a></li>
<li><a href="../ja461227/index.html">Embarcadero RAD Studio 10.3.2がリリースされた、または何が死んだか...死亡</a></li>
<li><a href="../ja461229/index.html">ヘルシンキ。フィンランドのゲーム業界で仕事を見つける方法、許可なしに仕事を始める方法、ロシアの法律に違反しない方法</a></li>
<li><a href="../ja461231/index.html">そして、照合はどのような違いを選びますか？</a></li>
<li><a href="../ja461241/index.html">地球物理学におけるWolfram Mathematica</a></li>
<li><a href="../ja461243/index.html">アフリカに散歩に出かけないでください：黒大陸でのインターネット検閲はどうなっていますか</a></li>
<li><a href="../ja461249/index.html">映画ファンのためのAndroidアプリの作成-パート2（デザイン）</a></li>
<li><a href="../ja461251/index.html">Julia Evansからの便利なスライドの選択</a></li>
<li><a href="../ja461255/index.html">﻿CとC ++で足元に自分を撃つ方法。Haiku OSレシピコレクション</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>