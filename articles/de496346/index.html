<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📂 🆑 🚟 Wir fügen dem täglichen Skript einen Rootkit-Hunter-Hash-Check hinzu 🏴󠁧󠁢󠁷󠁬󠁳󠁿 👩🏾‍⚖️ 🧑🏽‍🤝‍🧑🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Aufgrund all dieser Udalenka stellte sich heraus, dass der zuvor halb leere Trainings-Laptop nun zur Hauptarbeitsmaschine geworden ist und es sich loh...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Wir fügen dem täglichen Skript einen Rootkit-Hunter-Hash-Check hinzu</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/496346/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aufgrund all dieser Udalenka stellte sich heraus, dass der zuvor halb leere Trainings-Laptop nun zur Hauptarbeitsmaschine geworden ist und es sich lohnt, ihn irgendwie nachdenklicher zu schützen. Was im Allgemeinen von den Behörden klar angedeutet wird. Auf dem Laptop ist jetzt Ubuntu 20.04 Beta. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alles begann mit klaren BIOS-Einstellungen und vollständiger Festplattenverschlüsselung, über die ich wahrscheinlich nicht schreiben sollte. Aber dann habe ich mich entschlossen zu verstehen, was das Dienstprogramm </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rkhunter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> („Rootkit, Backdoor, Sniffer und Exploit-Scanner“) </font><font style="vertical-align: inherit;">auf Dateiebene tun kann </font><font style="vertical-align: inherit;">.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich hatte keine großen Erwartungen an die Software, die seit einigen Jahren nicht mehr aktualisiert wurde. </font><font style="vertical-align: inherit;">Ich muss sofort sagen, dass ich die Verwendung von Signaturen vom Februar 2018 für die Suche nach Rootkits sehr bezweifle, aber eine der anderen Betriebsarten - das Überprüfen von Datei-Hashes - hat mich interessiert. </font><font style="vertical-align: inherit;">Wer interessiert sich für eine solche Erfahrung und was bisher passiert ist - willkommen bei cat.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Idee ist einfach - aber lassen Sie uns am Morgen ein Skript für nützliche Dinge hinzufügen, um festzustellen, ob sich die MD5-Hashes der Dateien, für die sie nicht geändert werden sollten, nicht geändert haben. </font><font style="vertical-align: inherit;">Zumindest bis Paketaktualisierungen sollten. </font><font style="vertical-align: inherit;">Solch eine sehr leichte, aber meiner Meinung nach nicht nutzlose Whitelist. </font><font style="vertical-align: inherit;">Die aktuelle Version, mit der die Hashes des Dienstprogramms berechnet und überprüft werden können, wird einfach vom Paketmanager festgelegt:</font></font><br>
<br>
<pre><code class="bash hljs">apt search rkhunter<font></font>
rkhunter/focal,focal,now 1.4.6-8 all [installed]<font></font>
  rootkit, backdoor, sniffer and exploit scanner</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Hauptkonfiguration des Jägers befindet sich in /etc/rkhunter.conf. Um mein Problem zu lösen, sind dies die Parameter, die ich dort festgelegt habe:</font></font><br>
<br>
<pre><code class="bash hljs">ENABLE_TESTS=hashes</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Denn außer Hashes interessiert mich noch nichts. </font><font style="vertical-align: inherit;">Die Liste anderer möglicher Tests kann mit dem Befehl abgerufen werden.</font></font><br>
<br>
<pre><code class="bash hljs">sudo rkhunter --list <span class="hljs-built_in">test</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich halte die MD5-ok-Kollision immer noch für mathematisch, aber nicht für die Praxis. </font><font style="vertical-align: inherit;">Ich bestehe nicht auf dieser Meinung, aber fast jeden Tag schaue ich auf gute Malware und bin bisher nicht auf solche Konflikte in freier Wildbahn gestoßen. </font><font style="vertical-align: inherit;">Also für den Moment reicht mir die Konfiguration.</font></font><br>
 <br>
<pre><code class="bash hljs">HASH_CMD=MD5</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dann gab er seinen Paketmanager und vor allem die Verzeichnisse an, Datei-Hashes, die mich interessieren. </font><font style="vertical-align: inherit;">Der Pfad lautet beispielsweise / bin und / usr / bin. </font><font style="vertical-align: inherit;">Bei Dateien, die in Verzeichnissen angezeigt wurden, aber zum Zeitpunkt der Berechnung nicht vorhanden waren, gibt der Jäger auch Warnungen aus.</font></font><br>
 <br>
<pre><code class="bash hljs">PKGMGR=DPKG<font></font>
USER_FILEPROP_FILES_DIRS=/bin/*<font></font>
USER_FILEPROP_FILES_DIRS=/usr/bin/*</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier ist ein wichtiger Punkt: Bei meinen Einstellungen basiert das Scannen nicht auf Paketen, sondern auf Verzeichnissen. Dies ist wahrscheinlich korrekter, da die Pakete viele nicht ausführbare Dateien enthalten und zuerst herausgefiltert werden müssen, z. B. durch eine Datei. Bisher habe ich den Weg gewählt, die Liste der Verzeichnisse und Ausnahmen zu erweitern. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben die Scannerkonfiguration jetzt abgeschlossen. Jetzt ist es an der Zeit, die Basis der korrekten Hashes in /var/lib/rkhunter/db/rkhunter.dat mit den neuen Einstellungen zu aktualisieren. Dazu benötigen Sie einen Befehl (es werden auch die Namen der Pakete benötigt, die der Datenbank hinzugefügt werden sollen, wenn Sie in die andere Richtung gehen).</font></font><br>
<br>
<pre><code class="bash hljs">sudo rkhunter --propupd</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Danach sollten alle für Sie interessanten Dateien und ihre Hashes in rkhunter.dat angezeigt werden. In meinem Fall sind dies 2847 Dateien, und der Indexer benötigte 9 Millionen 2.117 Sekunden. Es ist ein bisschen viel wie für dreitausend MD5s, wenn man bedenkt, dass md5sum für / bin / ls für 0,003s ist, aber es gibt es wirklich. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir sind bereit, eine Überprüfung durchzuführen. Noch nicht im Kampf, es ist unwahrscheinlich, dass einige Malware es bereits geschafft hat, die Hashes zu ändern.</font></font><br>
<br>
<pre><code class="bash hljs">sudo rkhunter -c</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier gibt es einen sehr nützlichen Schlüssel - rwo (nur Warnungen melden), der alle erfolgreichen Vergleiche überspringt und nur Warnungen ausgibt. </font><font style="vertical-align: inherit;">Sie müssen das Arbeitsergebnis in /var/log/rkhunter.log suchen. </font><font style="vertical-align: inherit;">Die Geschwindigkeit der Überprüfung betrug für meine fast dreitausend Binärdateien 10 m 27.489 s, vergleichbar mit der Indizierungszeit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben die Überprüfung aussortiert, aber es bleibt die Frage der Neuindizierung beim Aktualisieren von Paketen. </font><font style="vertical-align: inherit;">Jene. </font><font style="vertical-align: inherit;">Wir haben ein passendes Update durchgeführt und betrachten jetzt nicht alle aktualisierten Dateien als Malware. </font><font style="vertical-align: inherit;">Der Scanner verfügt über eine andere Konfiguration / etc / default / rkhunter zur Automatisierung von Aufgaben. </font><font style="vertical-align: inherit;">Darin setzen wir den Parameter.</font></font><br>
<br>
<pre><code class="bash hljs">APT_AUTOGEN=<span class="hljs-string">"yes"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und in /etc/apt/apt.conf.d/90rkhunter befindet sich ein Skript, das für die Nachindizierung verantwortlich ist:</font></font><br>
<br>
<pre><code class="bash hljs"><font></font>
 // Makes sure that rkhunter file properties database is updated after each remove or install only APT_AUTOGEN is enabled<font></font>
 DPkg::Post-Invoke { <span class="hljs-string">"if [ -x /usr/bin/rkhunter ] &amp;&amp; grep -qiE '^APT_AUTOGEN=.?(true|yes)' /etc/default/rkhunter; then /usr/share/rkhunter/scripts/rkhupd.sh; fi"</span>; };</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eigentlich sind alle, Ergänzungen gerne bereit zu akzeptieren. </font><font style="vertical-align: inherit;">Hoffe es war hilfreich.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de496336/index.html">Wofür sind intelligente Zähler?</a></li>
<li><a href="../de496338/index.html">Krise und das wars</a></li>
<li><a href="../de496340/index.html">Wir trainieren ein generativ-wettbewerbsfähiges Netzwerk für das Zeichnen von Bildern in Azure ML</a></li>
<li><a href="../de496342/index.html">CI / CD-Prozessaktualisierung: Teamcity</a></li>
<li><a href="../de496344/index.html">Ist die Quarantäne von Online-Hackathons der richtige Zeitpunkt?</a></li>
<li><a href="../de496348/index.html">Web Storage API-Fallstudien</a></li>
<li><a href="../de496350/index.html">Du darfst nicht passieren! - 3D-Drucker antworten auf Coronavirus</a></li>
<li><a href="../de496354/index.html">Ternäre Computerprogrammierung: Spielen Sie mit dem Emulator</a></li>
<li><a href="../de496356/index.html">Erstellen eines Navigators mit Augmented-Reality-Technologien und Methoden des maschinellen Lernens</a></li>
<li><a href="../de496358/index.html">Machen Sie sich bereit, um den Kosmonautik-Tag online zu feiern (die Liste wird aktualisiert)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>