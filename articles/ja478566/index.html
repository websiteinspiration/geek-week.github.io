<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©ğŸ¿â€ğŸ¤â€ğŸ‘©ğŸ» ğŸ‘¨ğŸ½â€ğŸ’¼ ğŸ¦ iOS ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ãªã„ã¨ãã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ğŸ‘©ğŸ¼â€ğŸ¤ ğŸ™ğŸ¾ ğŸšŸ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒã€Œé­”æ³•ã®ã‚ˆã†ã«ã€æ©Ÿèƒ½ã—ã€æ°—ä»˜ã‹ã‚Œã‚‹ã“ã¨ãªãå‹•ä½œã™ã‚‹ã“ã¨ã‚’æœŸå¾…ã—ã¦ã„ã¾ã™ã€‚ã“ã®é­”æ³•ã¯ã€ã‚·ã‚¹ãƒ†ãƒ ã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®é–‹ç™ºè€…ã«ä¾å­˜ã—ã¾ã™ã€‚ã‚·ã‚¹ãƒ†ãƒ ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹ã“ã¨ã¯é›£ã—ã„ãŸã‚ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«é™å®šã—ã¾ã™ã€‚
 

 . , . . , , .
 

 , .
 

 :
 

...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>iOS ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ãªã„ã¨ãã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/redmadrobot/blog/478566/"><p><img src="https://habrastorage.org/webt/ok/hf/in/okhfincdajhwvcffenwaoaj6wcs.png" alt="ç”»åƒ"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒã€Œé­”æ³•ã®ã‚ˆã†ã«ã€æ©Ÿèƒ½ã—ã€æ°—ä»˜ã‹ã‚Œã‚‹ã“ã¨ãªãå‹•ä½œã™ã‚‹ã“ã¨ã‚’æœŸå¾…ã—ã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®é­”æ³•ã¯ã€ã‚·ã‚¹ãƒ†ãƒ ã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®é–‹ç™ºè€…ã«ä¾å­˜ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚·ã‚¹ãƒ†ãƒ ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹ã“ã¨ã¯é›£ã—ã„ãŸã‚ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«é™å®šã—ã¾ã™ã€‚</font></font></p><br>
<p>       .  ,        .     .  ,   ,     .</p><a name="habracut"></a><br>
<p> ,   .</p><br>
<p>     :</p><br>
<ul>
<li><em>download</em> (,    ),</li>
<li><em>upload</em> (   ).</li>
</ul><br>
<p>   ,     . ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>,     :</p><br>
<ul>
<li><em>background</em> (  Â«Â»),</li>
<li><em>active</em> (  ,  ).</li>
</ul><br>
<p> : <em>callback</em>, <em>delegate</em> (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Cocoa Design Patterns&nbsp;</a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> callback  </a>).   , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>  URLSession</code></a> (          ,  ).</p><br>
<p>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Swift 5</a>,   iOS 11    (  iOS 11  12)     HTTP-.       ,   iOS 9,  Â« Â».</p><br>
<h2 id="obschaya-shema-raboty-s-setyu-urlsession">    . URLSession</h2><br>
<p>      :</p><br>
<ul>
<li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>URLSessionConfiguration</code></a>;</li>
<li>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>URLSession</code></a>;</li>
<li> task (   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>session.dataTask(â€¦)</code></a>  );</li>
<li>   .   ,    <em>delegate,</em>     ,    <em>callback,</em>     ;</li>
<li> ,   ,    .</li>
</ul><br>
<p>   :</p><br>
<pre><code class="swift hljs"><span class="hljs-keyword">let</span> session = <span class="hljs-type">URLSession</span>(configuration: .<span class="hljs-keyword">default</span>)
<span class="hljs-keyword">let</span> url = <span class="hljs-type">URL</span>(...)
<span class="hljs-keyword">let</span> dataTask = session.dataTask(with: url) { data, response, error <span class="hljs-keyword">in</span><font></font>
    ... <font></font>
    <span class="hljs-comment">//    </span>
    <span class="hljs-comment">//  callback,   </span>
}</code></pre><br>
<p>     ,   .    ,    ,       ,    ,   .</p><br>
<blockquote> ,       .      ,   , SSL-   .      .     background  -   .</blockquote><br>
<h2 id="sozdanie-sessii-dlya-raboty-v-background">     background</h2><br>
<p>  background <em>URLSession</em>  ?     , -  .    Â«Â»,    .   background- (,    ,   )    . , :</p><br>
<pre><code class="swift hljs"><span class="hljs-keyword">let</span> configuration = <span class="hljs-type">URLSessionConfiguration</span>.background(withIdentifier: <span class="hljs-string">"com.my.app"</span>)<font></font>
configuration.sessionSendsLaunchEvents = <span class="hljs-literal">true</span>
configuration.isDiscretionary = <span class="hljs-literal">true</span>
configuration.allowsCellularAccess = <span class="hljs-literal">true</span>
configuration.shouldUseExtendedBackgroundIdleMode = <span class="hljs-literal">true</span>
configuration.waitsForConnectivity = <span class="hljs-literal">true</span><font></font>
<font></font>
<span class="hljs-type">URLSession</span>(configuration: configuration, delegate: <span class="hljs-keyword">self</span>, delegateQueue: <span class="hljs-literal">nil</span>)</code></pre><br>
<p>    ,      background :</p><br>
<ul>
<li><em>identifier</em> (  ) â€”  ,     background    .   ,    background   ,      background ,       .    .    ,           ( , ,   <em>bundleId</em> );</li>
<li><em>sessionSendsLaunchEvents</em> ,&nbsp;  background   ,    .     <code>false,</code>    ,     ,      .   <code>true</code>,     ,        <code>AppDelegate: application(_:handleEventsForBackgroundURLSession:completionHandler:)</code>;</li>
<li><em>isDiscretionary</em>        . ,   ,    ,   â€”    .    . ,    ,           WiFi,     ,      (   ,   ).    ,     background,       <code>true</code>;</li>
<li><em>allowsCellularAccess</em> â€”&nbsp;,  ,         .      ,   ,  (    )    ;</li>
<li><em>shouldUseExtendedBackgroundIdleMode.</em>  ,  ,        ,     .      .</li>
<li><em>waitsForConnectivity</em>           .            ,     Â« Â».     .   <code>false,</code>          .  <code>true</code> â€”&nbsp;,    .</li>
<li>  ( )   , <em>delegate.</em>   â€”&nbsp; .</li>
</ul><br>
<h3 id="delegate-vs-callbacks">Delegate vs Callbacks</h3><br>
<p>    ,       / .  â€” <em>callback:</em></p><br>
<pre><code class="swift hljs">session.dataTask(with: request) { data, response, error <span class="hljs-keyword">in</span> <font></font>
    ...  <font></font>
}</code></pre><br>
<p>         ,   ,   ,       . </p><br>
<p>     â€”&nbsp; <em>delegate.</em>       ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>URLSessionDataDelegate</code></a>  ()    (      ).        ,          .      .    <code>self.</code></p><br>
<pre><code class="swift hljs"><span class="hljs-type">URLSession</span>(configuration: configuration, delegate: <span class="hljs-keyword">self</span>, delegateQueue: <span class="hljs-literal">nil</span>)</code></pre><br>
<p>     . Background     .</p><br>
<p>,  , ,    ,  - .</p><br>
<h2 id="obschaya-shema-skachivaniya-dannyh-v-fone">     </h2><br>
<p>  ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code> (URLRequest)</code></a>,     //,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>URLSessionDownloadTask</code></a>     .  :</p><br>
<pre><code class="swift hljs"><span class="hljs-keyword">var</span> request = <span class="hljs-type">URLRequest</span>(...)
<span class="hljs-comment">//  request,  </span><font></font>
<font></font>
<span class="hljs-keyword">let</span> task = session.downloadTask(with: request)
<span class="hljs-keyword">if</span> #available(iOS <span class="hljs-number">11</span>, *) {<font></font>
    task.countOfBytesClientExpectsToSend = [approximate size of request]<font></font>
    task.countOfBytesClientExpectsToReceive = [approximate size of response]<font></font>
}<font></font>
task.resume()</code></pre><br>
<p>           . , ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">countOfBytesClientExpectsToSend</a>/<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">countOfBytesClientExpectsToReceive</a>,    ,           .    ,         ,  ,  .       .</p><br>
<p> <code>resume()</code>    .        (  â€”&nbsp; ,    ),       .      :</p><br>
<pre><code class="swift hljs">urlSession(<span class="hljs-number">_</span>:downloadTask:didFinishDownloadingTo:)</code></pre><br>
<p>  ,      ,        -      - .        ,             .</p><br>
<p>     ,   ,   .   , <code>error</code>   <code>nil.</code></p><br>
<pre><code class="swift hljs">urlSession(<span class="hljs-number">_</span>:task:didCompleteWithError:)</code></pre><br>
<p>    ,        ?    ?   .</p><br>
<p>   -,    ,    <code>sessionSendsLaunchEvents</code>   ,     ( ),    <code>AppDelegate,</code>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">application(_:handleEventsForBackgroundURLSession:completionHandler:)</a>.</p><br>
<p>    :</p><br>
<ul>
<li> <code>completionHandler</code> (     ,     );</li>
<li>      ,    (       ,     );</li>
<li>        ( ,  , , <code>urlSession(_:downloadTask:didFinishDownloadingTo:)</code>),   ,  ,  ;</li>
<li> ,    ,     ,   <code>urlSessionDidFinishEvents(forBackgroundURLSession:)</code>         <code>completionHandler.</code></li>
</ul><br>
<blockquote>.  <code>completionHandler</code>     ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>DispatchQueue.main.async(...)</code></a>.</blockquote><p>   ,      ,    .   ,   ( ) .     ,         â€”&nbsp;  ,   .    , &nbsp;  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>UIApplication.beginBackgroundTask()</code></a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">BackgroundTasks</a>.</p><br>
<h2 id="obschaya-shema-fonovoy-otpravki-dannyh">    </h2><br>
<p>       . , ,   :  ,   (   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>URLSessionUploadTask)</code></a>,  .   ?</p><br>
<p>  ,    .     ,  <code>Data</code>. Background <code>URLSession,</code>     .     (<code>uploadTask(withStreamedRequest:)</code>)   .   ,   ,  ,      .  - :</p><br>
<pre><code class="swift hljs"><span class="hljs-keyword">var</span> fileUrl = methodThatSavesFileAndRetursItsUrl(...)<font></font>
<font></font>
<span class="hljs-keyword">var</span> request = <span class="hljs-type">URLRequest</span>(...)
<span class="hljs-keyword">let</span> task = session.uploadTask(with: request, fromFile: fileUrl)<font></font>
task.resume()</code></pre><br>
<p>    , <code>URLSession</code>    .        <code>urlSession(_:task:didCompleteWithError:)</code>,    .   ,           ,  <code>application(_:handleEventsForBackgroundURLSession:completionHandler:),</code>        ,     . </p><br>
<h2 id="chto-takoe-prilozhenie-zaversheno">  Â« Â»</h2><br>
<p>     ,     (     ,   ).   ?  â€”&nbsp;.      (, ) ,     . ,   .</p><br>
<ul>
<li>-,    (  Home    ) â€”&nbsp; .    ,      .     background   ,    ,   Â«-Â» ;</li>
<li>-, ,     (AppCode, Xcode   LLDB),            Â«Â»;</li>
<li>-,       (task manager,  Home    Â«Â»).       Â«Â»,          ,   ;</li>
<li>-,       .      (  )    . ,     ,  .     ,  ,   ,   .  ,   ;</li>
<li>    ,   â€”&nbsp; <code>exit(int)</code>.   ,      (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">   </a>),      â€”&nbsp; .        :<br>
<ul>
<li>     <code>AppDelegate.applicationDidEnterBackground(_:)</code>,        ;</li>
<li>    (, ,     ),    ,  <code>exit(...).</code><br>
   ,       . ,   ,     <code>application(_:handleEventsForBackgroundURLSession:completionHandler:).</code></li>
</ul></li>
</ul><br>
<h2 id="kak-protokolirovat-rabotu-prilozheniya-esli-nelzya-polzovatsya-otladochnoy-konsolyu-xcode">   ,      Xcode?</h2><br>
<p>,  . ,   .   Xcode ,    , ,    ,   (attach to process)    .     ,       - .</p><br>
<p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> (, logs)</a>.     :</p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>print.</code></a>  ,  Â«  - Â».     ,          ,  .</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>NSLog.</code></a>  ,     .</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>os_log.</code></a>   ,    ,    ,   ,    ,   .</li>
</ul><br>
<blockquote>!  <code>os_log</code>   (,  debug-),     ,      .  .</blockquote><p>  <code>os_log,</code> ,    ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> Apple</a>.  ,   <code>debug</code>  <code>info</code> , -  .</p><br>
<h2 id="otslezhivanie-progressa-skachivaniya-ili-otpravki-dannyh">     </h2><br>
<p>   ,  ,   ,   .     .  â€”   :</p><br>
<ul>
<li>    <code>urlSession(_:task:didSendBodyData:totalBytesSent:totalBytesExpectedToSend:)</code></li>
<li>     <code>urlSession(_:downloadTask:didWriteData:totalBytesWritten:totalBytesExpectedToWrite:)</code></li>
</ul><br>
<p>    ,       .        ,     ,      ,  ,  Â« Â»   .</p><br>
<p>   .   ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>Progress</code></a> (    <code>task.progress</code>),       ,       .   ?  :</p><br>
<ul>
<li>  <code>Progress</code>     ,     ,    ,    . ,      ,      ,   ,     ,    ,  ,     -  ;</li>
<li>      ,       ,    .</li>
</ul><br>
<p>        ? .    ,         .  background     .</p><br>
<h2 id="peredacha-zadach-iz-obychnoy-sessii-v-background-sessiyu">Â«Â»      background </h2><br>
<p>,  background   .    !     ,  -   ,  ,    background  ?</p><br>
<p> ,    ,  . , background   .        . -,       (    <code>isDiscretionary</code>, ,   ,  <code>true</code>  , ,      .</p><br>
<p>  ,    ,   ,    ,   ,     background .   ,  . Background â€”&nbsp;,  ,   ,    .</p><br>
<p>   ,       background  (, ,      ,    ),     :</p><br>
<ul>
<li>    .    <em>backgroundTask</em>,   ,       .   -  (  ,   iOS 13 -    ,    ),    . </li>
<li>   â€”&nbsp;   <em>backgroundTask</em>       ,    ,  ,  .</li>
</ul><br>
<p> ? .   (cancel)  ,    (   ) .     Â«Â»?    ?</p><br>
<p>     .   ,  .   ,  ,  ,     , .</p><br>
<p>   .  ,      .         , ,       .    ,         ( ). <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  ,</a>   .  ,    HTTP-,  ,   .</p><br>
<p>  ,   :</p><br>
<pre><code class="swift hljs"><span class="hljs-keyword">let</span> request = <span class="hljs-type">URLRequest</span>(url: url)
<span class="hljs-keyword">let</span> task = foregroundSession.downloadTask(with: request)
<span class="hljs-keyword">let</span> backgroundId = <span class="hljs-type">UIApplication</span>.shared.beginBackgroundTask {<font></font>
    task.cancel()<font></font>
    <span class="hljs-keyword">let</span> task = backgroundSession.downloadTask(with: request)<font></font>
    task.resume()<font></font>
}<font></font>
task.resume()</code></pre><br>
<p>   ,   <code>expirationHandler</code>,      <code>UIApplication.shared.endBackgroundTask(backgroundId)</code>.      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>.</p><br>
<p>     (,     ,      ,    ),   :</p><br>
<ul>
<li>  ,   ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">cancel(byProducingResumeData:)</a>;</li>
<li>  ,    : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">downloadTask(withResumeData:) -&gt; URLSessionDownloadTask</a>,   - :</li>
</ul><br>
<pre><code class="swift hljs"><span class="hljs-keyword">let</span> request = <span class="hljs-type">URLRequest</span>(url: url)
<span class="hljs-keyword">let</span> task = foregroundSession.downloadTask(with: request)
<span class="hljs-keyword">let</span> backgroundId = <span class="hljs-type">UIApplication</span>.shared.beginBackgroundTask {<font></font>
    task.cancel { data <span class="hljs-keyword">in</span>
        <span class="hljs-keyword">let</span> task: <span class="hljs-type">URLSessionDownloadTask</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> data = data {<font></font>
            task = backgroundSession.downloadTask(withResumeData: data)<font></font>
        } <span class="hljs-keyword">else</span> {<font></font>
            task = backgroundSession.downloadTask(with: request)<font></font>
        }<font></font>
        task.resume()<font></font>
    }<font></font>
}</code></pre><br>
<h2 id="grabli-na-kotorye-ya-nastupil">,    </h2><br>
<h3 id="logi"></h3><br>
<p>      â€”&nbsp; ,  .   â€”&nbsp; ,    .  background    ,    .</p><br>
<p>,  ,  background     -,       ,      ,          (   UI,      ). , ,    â€”&nbsp;.     ,   â€”&nbsp;,  ,  <code>os_log.</code> ( <code>NSLog)</code></p><br>
<h3 id="priostanovka-biznes-logiki"> -</h3><br>
<p>       -  ,         .         ,     -  .    ,      ,   ,      ( )     . ,    ,      -,  ,  .     â€”       â€”&nbsp;,    .   â€”&nbsp; ,       -  ( ),       ,      .</p><br>
<h3 id="testirovanie-na-ustroystve">  </h3><br>
<p>    .            (  ),    .  ,      ,    ,       .</p><br>
<h3 id="ogranicheniya"></h3><br>
<p>   :</p><br>
<ul>
<li>  ,  ;</li>
<li> â€”&nbsp; ,    ;</li>
<li>       ,     (,    â€¦);</li>
</ul><br>
<h3 id="melochi"></h3><br>
<ul>
<li>       ,    <code>(task.taskIdentifier)</code>  ,     (Dictionary).    ,          1,   .</li>
<li>  , <code>URLSession.getAllTasks</code>.    ,        background .  ,    .   ,    . Â¯\_(ãƒ„)_/Â¯</li>
<li>  ,  ,         ,    ,     .</li>
</ul><br>
<p>      ,      background ,      .      ,      -    .      : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">https://developer.apple.com/library/archive/documentation/General/Conceptual/ExtensibilityPG/ExtensionScenarios.html#//apple_ref/doc/uid/TP40014214-CH21-SW1</a>.   , :</p><br>
<blockquote>If your app extension initiates a background NSURLSession task, you must also set up a shared container that both the extension and its containing app can access. Use the sharedContainerIdentifier property of the NSURLSessionConfiguration class to specify an identifier for the shared container so that you can access it later.</blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja478550/index.html">æ™‚è¨ˆã®ç®¡ç†æ–¹æ³•ã¯ï¼Ÿç¬¬2å›ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ãƒãƒ£ãƒ³ãƒ”ã‚ªãƒ³ã‚·ãƒƒãƒ—ã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒˆãƒ©ãƒƒã‚¯ã®åˆ†æ</a></li>
<li><a href="../ja478552/index.html">2ç•ªç›®ã®ã‚¢ãƒ—ãƒ¬ãƒƒãƒˆã€Processing 3ã§é–‰ã˜ã€é€æ˜ãªãƒœã‚¿ãƒ³</a></li>
<li><a href="../ja478554/index.html">ã‚¦ã‚§ãƒ“ãƒŠãƒ¼ã€ŒSRE-èª‡å¤§å®£ä¼ã‹æœªæ¥ã‹ï¼Ÿã€12æœˆ12æ—¥11:00</a></li>
<li><a href="../ja478560/index.html">ç„¡æ–™ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ãƒˆãƒ¡ãƒƒã‚»ãƒ³ã‚¸ãƒ£ãƒ¼ã¯åŒ¿åã§ã™ã‹ï¼Ÿ</a></li>
<li><a href="../ja478564/index.html">TsIANãŒãƒ†ãƒ©ãƒã‚¤ãƒˆã®ãƒ­ã‚°ã‚’ã©ã®ã‚ˆã†ã«æ‰‹å…¥ã‚Œã—ãŸã‹</a></li>
<li><a href="../ja478572/index.html">ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã®ãƒœãƒƒãƒˆï¼šä»®æƒ³ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã®ã—ãã¿ã¨å­¦ç¿’æ–¹æ³•</a></li>
<li><a href="../ja478574/index.html">é‰„é“ãƒ–ãƒ¬ãƒ¼ã‚­ã®çœŸå®Ÿï¼šãƒ‘ãƒ¼ãƒˆ4-ä¹—å®¢ç”¨ãƒ–ãƒ¬ãƒ¼ã‚­</a></li>
<li><a href="../ja478580/index.html">ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ‹ãƒ³ãƒ†ãƒ³ãƒ‰ãƒ¼ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ãƒãƒƒãƒ—ã®ã—ãã¿ï¼šã‚¹ãƒ¼ãƒ‘ãƒ¼PPUã‚¬ã‚¤ãƒ‰</a></li>
<li><a href="../ja478582/index.html">2019å¹´ã®ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒã‚¤ã‚¹ã«é–¢ã™ã‚‹ã‚°ãƒ­ãƒ¼ãƒãƒ«VPNãƒ¬ãƒãƒ¼ãƒˆ</a></li>
<li><a href="../ja478584/index.html">JVMã®å†…éƒ¨ã€ãƒ‘ãƒ¼ãƒˆ2-ã‚¯ãƒ©ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹é€ </a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>