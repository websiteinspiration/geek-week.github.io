<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëçüèø üç∏ üò£ Outgrowing reverse proxy - technology for remote protection and site optimization without changing DNS A-records üè¶ üòÅ ‚õÖÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Over the past month, the average load on Internet resources has grown significantly due to the widespread transition to distance work and training (se...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Outgrowing reverse proxy - technology for remote protection and site optimization without changing DNS A-records</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ddosguard/blog/496006/"><img src="https://habrastorage.org/webt/v4/zy/qt/v4zyqtlznz2hqaffa6rvwggubkc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Over the past month, the average load on Internet resources has grown significantly due to the widespread transition to distance work and training (see exactly how to read our article </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúPandemic and traffic - a view from the telecom operator</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">‚Äù</font></a><font style="vertical-align: inherit;"> Online cinemas and games, online platforms are in great demand. ..? training services on request food delivery in such circumstances, the potential economic damage caused by the unavailability of the resource, including due to DDoS-attacks, especially high Which solution to choose to defend their project </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
in the material you will find:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Limitations of protection through the classic reverse proxy with the change of DNS A-records, which providers are often silent about.</font></font><br>
 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Which solution should you choose to avoid the risks associated with these limitations?</font></font><br>
 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A real case with the protection of a large project, without moving and changing A-records.</font></font><br>
 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> General recommendations for organizing the protection of the Internet resource.</font></font><br>
 </li>
</ul><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, first things first. </font><font style="vertical-align: inherit;">You decided to protect your growing project from DDoS attacks. </font><font style="vertical-align: inherit;">The basis of any protection is the analysis and filtering of incoming traffic. </font><font style="vertical-align: inherit;">But in order to clear the traffic, it must first be delivered to the cleaning center. </font><font style="vertical-align: inherit;">Hereinafter, under the ‚Äúprotection decision‚Äù we will mean a combination of technologies for the delivery and purification of traffic.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Most likely, the first solution that comes across to you will be based on reverse proxy technology with a change of DNS A-records. </font><font style="vertical-align: inherit;">Therefore, first we will consider the principle of the technology, its capabilities (if you are familiar with reverse proxy - feel free to skip these two sections) and the restrictions associated with the delivery of traffic (this should not be skipped). </font><font style="vertical-align: inherit;">Then we will show how these restrictions can be circumvented by the example of a real case. </font><font style="vertical-align: inherit;">In the end, we will give some general recommendations on how to protect the Internet resource.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reverse proxy - how it works</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here we look at reverse proxy as a means of delivering traffic. </font><font style="vertical-align: inherit;">The scheme of her work is well known to everyone, but it is simply impossible not to mention it here.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ju/uc/bj/juucbjvxeyzueu8y8tptqhg3hzo.jpeg"><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Changing DNS A-records - instead of the IP address of the web server, the IP address of the proxy server is indicated. </font><font style="vertical-align: inherit;">Distribution of changes around the world (DNS propagation).</font></font><br>
 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The visitor OS requests the IP address corresponding to the domain name of the site (DNS resolution).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The DNS server responds to the request by reporting the IP address of the proxy server.</font></font><br>
 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The visitor browser opens an HTTP (s) session and sends requests to the proxy server, which re-establishes a connection to the target web server and passes the requests to it.</font></font><br>
 </li>
</ol><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reverse proxy features</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What opportunities provide solutions working through reverse proxy with A-record change?</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Monitoring requests and protecting the site from attacks at the application level. </font><font style="vertical-align: inherit;">The technology allows you to process each application-level request arriving at the target server.</font></font><br>
 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reduce the load on the target web server and speed up the site. </font><font style="vertical-align: inherit;">On proxy servers, you can compress and cache data - this is the basis of the work of the Content Delivery Network (CDN).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flexible load balancing between multiple target web servers. </font><font style="vertical-align: inherit;">The technology allows you to distribute the load of processing requests between multiple machines. </font><font style="vertical-align: inherit;">This improves system resiliency and performance.</font></font><br>
 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Easy to connect. </font><font style="vertical-align: inherit;">To enable protection, just change the DNS A-records and wait for the changes to take effect. </font><font style="vertical-align: inherit;">Relocation, new hardware and software are not required.</font></font><br>
 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hiding the real IP address of the target web server. </font><font style="vertical-align: inherit;">The visitor uses the IP address of the proxy server to contact, and they receive answers from it, which ensures the anonymity of the target web resource.</font></font><br>
 </li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reverse proxy restrictions</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This technology has a number of pitfalls, which are not very customary to talk about. </font><font style="vertical-align: inherit;">Its limitations include:</font></font><br>
<br>
<ul>
<li>    DDoS-   -  .   IP-  -,     ,    DNS-.          DDoS-     .<br>
 </li>
<li>  IP-,      .    ,     IP-   .      IP-           ,   IP   . </li>
<li>    / .&nbsp;        DNS     (DNS propagation).       ,       .  DNS propagation     TTL (Time to Live) DNS-,         .<br>
 </li>
<li>     -,  TCP-,    80  443.  - , , UDP-,    .            .<br>
 </li>
</ul><br>
<img src="https://habrastorage.org/webt/li/hb/4h/lihb4h91krdejz7cgbtafzikxhy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The disadvantages of solutions for protection against DDoS attacks based on the ‚Äúclassic‚Äù Reverse Proxy are beginning to be felt as a growing project comes up against an increasing number of technology limitations. </font><font style="vertical-align: inherit;">What technical solutions can level or significantly reduce the risks of site inaccessibility due to the listed disadvantages? </font><font style="vertical-align: inherit;">- read below.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outgrowing reverse proxy</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's look at the problem with a real example from our practice. </font><font style="vertical-align: inherit;">Last year, a large client contacted us with a specific list of requirements for protection services. </font><font style="vertical-align: inherit;">We cannot disclose the name of the company for obvious reasons, but the needs of the client - please:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protect sites from application-level attacks.</font></font><br>
 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> To remove part of the load from the target web servers and speed up the loading of sites - the client has a lot of static content, and he is interested in caching and compressing data on CDN nodes. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Provide protection against direct attacks on the IP address / network (protection against DDoS attacks at the L3-L4 OSI levels).&nbsp;</font></font><br>
 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Services must connect without changing the external IP addresses of the resources. </font><font style="vertical-align: inherit;">The client has its own AS and address blocks.</font></font><br>
 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Management of traffic processing services and switching to backup channels should take place in real time - the level of resource availability is critical for the client.</font></font><br>
 </li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solutions based on the ‚Äúclassic‚Äù reverse proxy with changing DNS A-records allow you to close the first two items from the list. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Services like secure hosting, virtual and dedicated servers allow you to protect yourself from attacks at the L3-L7 OSI levels, but require relocation and mean using a single security provider. </font><font style="vertical-align: inherit;">What to do?</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DDoS protection within the network with protected services</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Installing filtering equipment in your network allows you to protect services at the L3-L7 OSI levels and freely manage filtering rules. </font><font style="vertical-align: inherit;">You incur substantial capital (CaPex) and operating expenses (OpEx) by choosing this solution. </font><font style="vertical-align: inherit;">These are expenses for:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">traffic filtering equipment + software licenses (CapEx);</font></font><br>
 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> renewal of software licenses (OpEx);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> full-time specialists for setting up equipment and monitoring its operation (OpEx);&nbsp;</font></font><br>
 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Internet access channels sufficient to receive attacks (CapEx + OpEx);</font></font><br>
 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> payment of incoming "junk" traffic (OpEx).</font></font><br>
 </li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result, the effective price per megabit of untreated traffic becomes unreasonably high. </font><font style="vertical-align: inherit;">In any case, the ability to filter traffic for such a solution will be lower than that of specialized providers. </font><font style="vertical-align: inherit;">Moreover, in order to increase the speed of the site, one way or another will have to resort to the services of CDN providers. </font><font style="vertical-align: inherit;">Of the advantages of the solution, it is worth noting that decrypted traffic does not leave the perimeter of the protected network. </font><font style="vertical-align: inherit;">We will discuss this issue in more detail later. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Even for large companies, such a solution is often not economically feasible, not to mention medium and small businesses. </font><font style="vertical-align: inherit;">It also did not suit our client.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Proxying without changing A records.</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To meet the needs of such customers, we developed a technology for intercepting web traffic and implemented it as part of the remote protection service without changing A records. </font><font style="vertical-align: inherit;">The solution is based on the principle: All connections between the client‚Äôs AS and public networks must be protected. </font><font style="vertical-align: inherit;">The client sends us announcements of its IP addresses / networks via BGP, and we announce them on the Internet. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9-/kx/ti/9-kxtisj5ciqiujxthzlwbveho0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All traffic destined for protected resources passes through our network. </font><font style="vertical-align: inherit;">The client can leave several backup connections and use them in case of unforeseen circumstances by removing the announcements from the DDoS-GUARD network. </font><font style="vertical-align: inherit;">In normal mode, we recommend using only our connections to access the Internet, so that we can guarantee the protection of client services.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The diagram below shows how traffic processing in our network is organized using the example of web traffic.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/w1/5o/xh/w15oxh6kwdebybadvjjif7b_1ns.jpeg"><br>
<br>
<ol>
<li>  IP-,   ,       L7.             API</li>
<li>         .           ¬´¬ª   L3-4  OSI.</li>
<li>           .    TCP   80  443 ,  HTTP ,    -,        .</li>
<li>-     .              .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All traffic specified by the client IP addresses / domains is processed at the L7 level. </font><font style="vertical-align: inherit;">Proxy servers filter traffic, optimize content and cache it.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rules for networks and domains can be created independently of each other. </font><font style="vertical-align: inherit;">When creating a rule for a domain, you do not need to specify the IP address of its web server. </font><font style="vertical-align: inherit;">This approach allows not to make changes to the filtering rules when migrating domains between web servers within the protected network. </font><font style="vertical-align: inherit;">At the client‚Äôs request, we can change the processing rules in such a way as to intercept traffic on any other ports.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now let's check if the developed DDoS-GUARD solution satisfies the list of requirements from the section ‚ÄúOutgrowing reverse proxy‚Äù.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The client receives protection against attacks at the L3-L7 OSI levels.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Content is compressed and cached on the nodes of our CDN, which reduces the load on the target web servers.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protection management takes place in real time. </font><font style="vertical-align: inherit;">The client manages traffic filtering rules for subnets, IP addresses and individual domains through a personal account or API. </font><font style="vertical-align: inherit;">Changes take effect within 1 minute. </font><font style="vertical-align: inherit;">In an emergency, the client can redirect all traffic to bypass the DDoS-GUARD network simply by removing BGP announcements.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The IP addresses owned by the company have remained unchanged. </font><font style="vertical-align: inherit;">The client does not need to purchase new equipment, software, hire additional staff and pay for untreated traffic.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition, it is possible to protect services and applications running on non-standard ports.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
General recommendations on how to protect your project:</font></font><br>
<br>
<ul>
<li> ,  ..        ‚Äî   MTU (Maximum Transmission Unit).   MTU,     , .. ,      )             .</li>
<li>       ‚Äî      ‚Äî ,    .</li>
<li>   (), , , .      DDoS  ¬´-¬ª,       . ,  100%   ,        I  II .</li>
<li>       -,         . ,  100%   ,        I  II .</li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en495990/index.html">Disclosure of telephone number and geolocation through vulnerability in Telegram</a></li>
<li><a href="../en495994/index.html">Beginning of the academic quarter or how I became the coordinator of distance learning</a></li>
<li><a href="../en495996/index.html">Raspberry Pi, Python and watering indoor plants</a></li>
<li><a href="../en495998/index.html">Creating a Dark Theme for Stack Overflow</a></li>
<li><a href="../en496004/index.html">New models of data search and analysis. WSDM 2020 through the eyes of the Yandex.Tolki team</a></li>
<li><a href="../en496010/index.html">What happens to transport during the crisis (first week of April)</a></li>
<li><a href="../en496014/index.html">IBM Weekly Seminars - April 2020</a></li>
<li><a href="../en496016/index.html">Search for bugs as a way of life: a review No. 3</a></li>
<li><a href="../en496018/index.html">DNS records for mail servers</a></li>
<li><a href="../en496020/index.html">Summer MVP. How flexible is Kotlin?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>