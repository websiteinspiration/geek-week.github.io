<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äç‚ù§Ô∏è‚Äçüë® ü§ì üßôüèª Programa√ß√£o ass√≠ncrona elegante com promessas üïù üôÉ üëñ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bom dia amigos 
 
 Promessas (promessas) s√£o um recurso relativamente novo do JavaScript que permite adiar a execu√ß√£o de uma a√ß√£o at√© a conclus√£o da a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Programa√ß√£o ass√≠ncrona elegante com promessas</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488762/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bom dia amigos </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Promessas (promessas) s√£o um recurso relativamente novo do JavaScript que permite adiar a execu√ß√£o de uma a√ß√£o at√© a conclus√£o da a√ß√£o anterior ou responder a uma a√ß√£o malsucedida. </font><font style="vertical-align: inherit;">Isso contribui para a determina√ß√£o correta da sequ√™ncia de opera√ß√µes ass√≠ncronas. </font><font style="vertical-align: inherit;">Este artigo discute como as promessas funcionam, como s√£o usadas na API da Web e como voc√™ pode escrever sua pr√≥pria promessa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Condi√ß√µes: conhecimentos b√°sicos de inform√°tica, conhecimento dos conceitos b√°sicos de JS. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Objetivo: entender o que s√£o promessas e como s√£o usadas.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quais s√£o as promessas?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Analisamos brevemente as </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">promessas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no primeiro artigo do curso, aqui as consideraremos com mais detalhes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em ess√™ncia, uma promessa √© um objeto que representa um estado intermedi√°rio de uma opera√ß√£o - ‚Äúpromete‚Äù que o resultado ser√° retornado no futuro. N√£o se sabe exatamente quando a opera√ß√£o ser√° conclu√≠da e quando o resultado ser√° retornado, mas h√° uma garantia de que, quando a opera√ß√£o for conclu√≠da, seu c√≥digo far√° algo com o resultado ou lidar√° com o erro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como regra, quanto tempo uma opera√ß√£o ass√≠ncrona leva (n√£o muito tempo!) √â menos interessante para n√≥s do que a possibilidade de uma resposta imediata √† sua conclus√£o. E, √© claro, √© bom saber que o restante do c√≥digo n√£o est√° bloqueado.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma das promessas mais comuns s√£o as APIs da Web que retornam promessas. Vejamos um aplicativo hipot√©tico de bate-papo por v√≠deo. O aplicativo possui uma janela com uma lista de amigos do usu√°rio. Ao clicar no bot√£o ao lado do nome (ou avatar) do usu√°rio, inicia uma videochamada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O manipulador de bot√£o chama </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">getUserMedia ()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para acessar a c√¢mera e o microfone do usu√°rio. A partir do momento, getUserMedia () entra em contato com o usu√°rio para obter permiss√£o (para usar dispositivos, qual dispositivo usar se o usu√°rio tiver v√°rios microfones ou c√¢meras, apenas uma chamada de voz, entre outras coisas), getUserMedia () espera n√£o apenas a decis√£o do usu√°rio, mas tamb√©m libera dispositivos, se estiverem em uso no momento. Al√©m disso, o usu√°rio pode n√£o responder imediatamente. Tudo isso pode levar a grandes atrasos no tempo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se uma solicita√ß√£o de permiss√£o para usar dispositivos for feita a partir do encadeamento principal, o navegador ser√° bloqueado at√© a conclus√£o de getUserMedia (). Isso √© inaceit√°vel. Sem promessas, tudo no navegador se torna "n√£o clic√°vel" at√© que o usu√°rio d√™ permiss√£o para usar o microfone e a c√¢mera. Portanto, em vez de aguardar a decis√£o do usu√°rio e retornar um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MediaStream</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para um fluxo criado a partir de fontes (c√¢mera e microfone), getUserMedia () retorna uma promessa que o MediaStream processa assim que dispon√≠vel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O c√≥digo do aplicativo de bate-papo por v√≠deo pode ter a seguinte apar√™ncia:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle</span> <span class="hljs-title">CallButton</span>(<span class="hljs-params">evt</span>)</span>{<font></font>
    setStatusMessage(<span class="hljs-string">'Calling...'</span>)<font></font>
    navigator.mediaDevices.getUserMedia({<span class="hljs-attr">video</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">audio</span>: <span class="hljs-literal">true</span>})<font></font>
    .then(<span class="hljs-function"><span class="hljs-params">chatStream</span> =&gt;</span> {<font></font>
        selfViewElem.srcObject = chatStream<font></font>
        chatStream.getTracks().forEach(<span class="hljs-function"><span class="hljs-params">track</span> =&gt;</span> myPeerConnection.addTrack(track, chatStream))<font></font>
        setStatusMessage(<span class="hljs-string">'Connected'</span>)<font></font>
    }).catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {<font></font>
        setStatusMessage(<span class="hljs-string">'Failed to connect'</span>)<font></font>
    })<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A fun√ß√£o come√ßa chamando setStatusMessage (), exibindo a mensagem 'Calling ...', que serve como um indicador de que est√° sendo feita uma tentativa de fazer uma chamada. Em seguida, getUserMedia () √© chamado, solicitando um fluxo que contenha faixas de v√≠deo e √°udio. Depois que o fluxo √© formado, um elemento de v√≠deo √© instalado para exibir o fluxo da c√¢mera chamado 'auto-visualiza√ß√£o', as faixas de √°udio s√£o adicionadas ao </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebRTC </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTCPeerConnection</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que √© uma conex√£o com outro usu√°rio. Depois disso, o status √© atualizado para 'Conectado'. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se getUserMedia () falhar, o bloco catch ser√° iniciado. Ele usa setStatusMessage () para exibir uma mensagem de erro.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Observe que a chamada para getUserMedia () √© retornada mesmo que o fluxo de v√≠deo ainda n√£o tenha sido recebido. </font><font style="vertical-align: inherit;">Mesmo que a fun√ß√£o handleCallButton () retornasse o controle ao c√≥digo que a chamou, assim que getUserMedia () conclu√≠sse a execu√ß√£o, chamaria o manipulador. </font><font style="vertical-align: inherit;">At√© que o aplicativo "entenda" que a transmiss√£o come√ßou, getUserMedia () ficar√° no modo de espera. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota: voc√™ pode aprender mais sobre isso no artigo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Sinais e videochamadas"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Este artigo fornece um c√≥digo mais completo que o que usamos no exemplo.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Problema nas fun√ß√µes de retorno de chamada</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para entender por que as promessas s√£o uma boa solu√ß√£o, √© √∫til recorrer √† maneira antiga de escrever retornos de chamada para ver quais eram seus problemas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como exemplo, considere pedir pizza. </font><font style="vertical-align: inherit;">Um pedido de pizza bem-sucedido consiste em v√°rias etapas que devem ser executadas em ordem, uma ap√≥s a outra:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escolha o recheio. </font><font style="vertical-align: inherit;">Isso pode levar algum tempo, se voc√™ pensar por um longo tempo, e falhar se mudar de id√©ia e pedir um curry.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√≥s fazemos um pedido. </font><font style="vertical-align: inherit;">Cozinhar pizza leva algum tempo e pode falhar se o restaurante n√£o tiver os ingredientes necess√°rios.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pegamos pizza e comemos. </font><font style="vertical-align: inherit;">O recebimento da pizza pode falhar se, por exemplo, n√£o pudermos pagar pelo pedido.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um pseudoc√≥digo √† moda antiga, usando </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fun√ß√µes de retorno de chamada,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pode ter esta apar√™ncia:</font></font><br>
<br>
<pre><code class="javascript hljs">chooseToppings(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">toppings</span>)</span>{<font></font>
    placeOrder(toppings, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">order</span>)</span>{<font></font>
        collectOrder(order, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">pizza</span>)</span>{<font></font>
            eatPizza(pizza)<font></font>
        }, failureCallback)<font></font>
    }, failureCallback)<font></font>
}, failureCallback)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â dif√≠cil ler e manter esse c√≥digo (geralmente chamado de "inferno de retornos de chamada" ou "inferno de retornos de chamada"). </font><font style="vertical-align: inherit;">A fun√ß√£o failCallback () deve ser chamada em cada n√≠vel de aninhamento. </font><font style="vertical-align: inherit;">Existem outros problemas.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usamos promessas</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As promessas tornam o c√≥digo mais limpo, mais f√°cil de entender e oferecer suporte. </font><font style="vertical-align: inherit;">Se reescrevermos o pseudoc√≥digo usando promessas ass√≠ncronas, obteremos o seguinte:</font></font><br>
<br>
<pre><code class="javascript hljs">chooseToppings()<font></font>
.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">toppings</span>)</span>{
    <span class="hljs-keyword">return</span> placeOrder(toppings)<font></font>
})<font></font>
.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">order</span>)</span>{
    <span class="hljs-keyword">return</span> collectOrder(order)<font></font>
})<font></font>
.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">pizza</span>)</span>{<font></font>
    eatPizza(pizza)<font></font>
})<font></font>
.catch(failureCallback)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso √© muito melhor - vemos o que acontece, usamos um bloco .catch () para lidar com todos os erros, a fun√ß√£o n√£o bloqueia o fluxo principal (para que possamos jogar videogames enquanto esperamos pela pizza), cada opera√ß√£o √© garantida para ser executada ap√≥s a conclus√£o da anterior. </font><font style="vertical-align: inherit;">Como toda promessa retorna uma promessa, podemos usar a cadeia .then. </font><font style="vertical-align: inherit;">√ìtimo, certo? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usando fun√ß√µes de seta, o pseudoc√≥digo pode ser ainda mais simplificado:</font></font><br>
<br>
<pre><code class="javascript hljs">chooseToppings()<font></font>
.then(<span class="hljs-function"><span class="hljs-params">toppings</span> =&gt;</span><font></font>
    placeOrder(toppings)<font></font>
)<font></font>
.then(<span class="hljs-function"><span class="hljs-params">order</span> =&gt;</span><font></font>
    collectOrder(order)<font></font>
)<font></font>
.then(<span class="hljs-function"><span class="hljs-params">pizza</span> =&gt;</span><font></font>
    eatPizza(pizza)     <font></font>
)<font></font>
.catch(failureCallback)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou mesmo assim:</font></font><br>
<br>
<pre><code class="javascript hljs">chooseToppings()<font></font>
.then(<span class="hljs-function"><span class="hljs-params">toppings</span> =&gt;</span> placeOrder(toppings))<font></font>
.then(<span class="hljs-function"><span class="hljs-params">order</span> =&gt;</span> collectOrder(order))<font></font>
.then(<span class="hljs-function"><span class="hljs-params">pizza</span> =&gt;</span> eatPizza(pizza))<font></font>
.catch(failureCallback)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso funciona porque () =&gt; x √© id√™ntico a () =&gt; {return x}. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode at√© fazer isso (como as fun√ß√µes simplesmente passam par√¢metros, n√£o precisamos de camadas):</font></font><br>
<br>
<pre><code class="javascript hljs">chooseToppings().then(placeOrder).then(collectOrder).then(eatPizza).catch(failureCallback)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse c√≥digo √© mais dif√≠cil de ler e n√£o pode ser usado com constru√ß√µes mais complexas do que no pseudoc√≥digo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota: o pseudoc√≥digo ainda pode ser aprimorado usando async / waitit, que ser√° discutido em um artigo futuro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No essencial, as promessas s√£o semelhantes aos ouvintes de eventos, mas com algumas diferen√ßas:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma promessa √© cumprida apenas uma vez (sucesso ou fracasso). </font><font style="vertical-align: inherit;">Ele n√£o pode ser executado duas vezes ou alternar de √™xito para falha ou vice-versa ap√≥s a conclus√£o da opera√ß√£o.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se a promessa for conclu√≠da e adicionarmos uma fun√ß√£o de retorno de chamada para processar seu resultado, essa fun√ß√£o ser√° chamada, apesar do evento ter ocorrido antes de adicionar a fun√ß√£o.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sintaxe b√°sica da promessa: um exemplo real</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Conhecer promessas √© importante porque muitas APIs da Web as utilizam em fun√ß√µes que executam tarefas potencialmente complexas. Trabalhar com modernas tecnologias da Web envolve o uso de promessas. Mais tarde, aprenderemos a escrever nossas pr√≥prias promessas, mas, por enquanto, vejamos alguns exemplos simples que podem ser encontrados na Web API. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No primeiro exemplo, usamos o m√©todo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fetch ()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para obter a imagem da rede, o m√©todo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">blob ()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para converter o conte√∫do do corpo da resposta em um objeto </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blob</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e exibir esse objeto dentro do elemento </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;img&gt;</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Este exemplo √© muito semelhante ao exemplo do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">primeiro artigo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mas faremos isso de maneira um pouco diferente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota: o exemplo a seguir n√£o funcionar√° se voc√™ simplesmente execut√°-lo a partir de um arquivo (ou seja, usando file: // URL). Voc√™ precisa execut√°-lo atrav√©s de um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">servidor local</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou usar solu√ß√µes on-line, como as </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">p√°ginas </font></a></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Glitch</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. Primeiro, fa√ßa o upload do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTML</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e da </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagem</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que receberemos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. Adicione o elemento </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;script&gt;</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ao final do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;body&gt;</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. Dentro do elemento &lt;script&gt;, adicione a seguinte linha:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> promise = fetch(<span class="hljs-string">'coffee.jpg'</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O m√©todo fetch (), que usa o URL da imagem como par√¢metro, √© usado para obter a imagem da rede. Como segundo par√¢metro, podemos especificar um objeto com configura√ß√µes, mas por enquanto nos restringiremos a uma op√ß√£o simples. Armazenamos a promessa retornada por fetch () na vari√°vel da promessa. Como observado anteriormente, uma promessa √© um objeto que representa um estado intermedi√°rio - o nome oficial de um determinado estado est√° pendente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4. Para trabalhar com o resultado da conclus√£o bem-sucedida da promessa (no nosso caso, quando o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Response</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> retornar </font><font style="vertical-align: inherit;">), chamamos o m√©todo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.then ()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">A fun√ß√£o de retorno de chamada dentro do bloco .then () (geralmente chamado de executor) √© iniciada apenas quando a promessa √© conclu√≠da com √™xito e o objeto Response √© retornado - eles dizem que a promessa foi conclu√≠da (cumprida, preenchida). </font><font style="vertical-align: inherit;">A resposta √© passada como um par√¢metro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota. </font><font style="vertical-align: inherit;">A opera√ß√£o do bloco .then () √© semelhante √† opera√ß√£o do ouvinte de evento AddEventListener (). </font><font style="vertical-align: inherit;">√â acionado somente ap√≥s o evento ocorrer (ap√≥s cumprir a promessa). </font><font style="vertical-align: inherit;">A diferen√ßa entre os dois √© que .then () pode ser chamado apenas uma vez, enquanto o ouvinte √© projetado para v√°rias chamadas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de receber a resposta, chamamos o m√©todo blob () para converter a resposta em um objeto Blob. </font><font style="vertical-align: inherit;">Se parece com isso:</font></font><br>
<br>
<pre><code class="javascript hljs">response =&gt; response.blob()
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... que √© uma entrada curta para:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>)</span>{
    <span class="hljs-keyword">return</span> response.blob()<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OK, palavras suficientes. </font><font style="vertical-align: inherit;">Adicione o seguinte ap√≥s a primeira linha:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> promise2 = promise.then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.blob())
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5. Cada chamada para .then () cria uma nova promessa. </font><font style="vertical-align: inherit;">Isso √© muito √∫til: como blob () tamb√©m retorna uma promessa, podemos processar o objeto Blob chamando .then () na segunda promessa. </font><font style="vertical-align: inherit;">Como queremos fazer algo mais complicado do que chamar o m√©todo e retornar o resultado, precisamos envolver o corpo da fun√ß√£o entre chaves (caso contr√°rio, uma exce√ß√£o ser√° lan√ßada): </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adicione o seguinte ao final do c√≥digo:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> promise3 = promise2.then(<span class="hljs-function"><span class="hljs-params">myBlob</span> =&gt;</span> {<font></font>
<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6. Vamos preencher o corpo da fun√ß√£o de execu√ß√£o. </font><font style="vertical-align: inherit;">Adicione as seguintes linhas aos chavetas:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> objectURL = URL.createObjectURL(myBlob)
<span class="hljs-keyword">let</span> image = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'img'</span>)<font></font>
image.src = objectURL<font></font>
<span class="hljs-built_in">document</span>.body.appendChild(image)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui chamamos o m√©todo URL.createObjectURL (), passando-o como um par√¢metro Blob, que retornou a segunda promessa. </font><font style="vertical-align: inherit;">N√≥s temos um link para o objeto. </font><font style="vertical-align: inherit;">Em seguida, criamos um elemento &lt;img&gt;, configuramos o atributo src com o valor do link do objeto e o adicionamos ao DOM para que a imagem apare√ßa na p√°gina. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ salvar o HTML e carreg√°-lo em um navegador, ver√° que a imagem √© exibida conforme o esperado. </font><font style="vertical-align: inherit;">Bom trabalho! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota. </font><font style="vertical-align: inherit;">Voc√™ provavelmente notou que esses exemplos s√£o um tanto artificiais. </font><font style="vertical-align: inherit;">Voc√™ poderia passar sem os m√©todos fetch () e blob () e atribuir a &lt;img&gt; URL correspondente, coffee.jpg. </font><font style="vertical-align: inherit;">Fomos por este caminho para demonstrar o trabalho com promessas com um exemplo simples.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resposta a Falhas</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esquecemos algo - n√£o temos um manipulador de erros caso uma das promessas falhe (ser√° rejeitada). </font><font style="vertical-align: inherit;">Podemos adicionar um manipulador de erros usando o m√©todo .catch (). </font><font style="vertical-align: inherit;">Vamos fazer isso:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> errorCase = promise3.catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'There has been a problem with your fetch operation: '</span> + e.message)<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para ver isso em a√ß√£o, especifique o URL da imagem errado e recarregue a p√°gina. </font><font style="vertical-align: inherit;">Uma mensagem de erro ser√° exibida no console. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse caso, se n√£o adicionarmos o bloco .catch (), uma mensagem de erro tamb√©m ser√° exibida no console. </font><font style="vertical-align: inherit;">No entanto, .catch () nos permite lidar com os erros da maneira que queremos. </font><font style="vertical-align: inherit;">Em um aplicativo real, seu bloco .catch () pode tentar recuperar a imagem ou exibir a imagem padr√£o, ou solicitar ao usu√°rio que selecione outra imagem ou fa√ßa outra coisa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota. </font><font style="vertical-align: inherit;">Assista a uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">demonstra√ß√£o ao vivo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√≥digo fonte</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bloquear fus√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De fato, a abordagem que usamos para escrever o c√≥digo n√£o √© ideal. </font><font style="vertical-align: inherit;">Deliberadamente, seguimos esse caminho para que voc√™ possa entender o que est√° acontecendo em cada est√°gio. </font><font style="vertical-align: inherit;">Como mostrado anteriormente, podemos combinar os blocos .then () (e .catch ()). </font><font style="vertical-align: inherit;">Nosso c√≥digo pode ser reescrito da seguinte maneira (veja tamb√©m </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">simple-fetch-chained.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no GitHub):</font></font><br>
<br>
<pre><code class="javascript hljs">fetch(<span class="hljs-string">'coffee.jpg'</span>)<font></font>
.then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.blob())<font></font>
.then(<span class="hljs-function"><span class="hljs-params">myBlob</span> =&gt;</span> {
    <span class="hljs-keyword">let</span> objectURL = URL.createObjectURL(myBlob)
    <span class="hljs-keyword">let</span> image = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'img'</span>)<font></font>
    image.src = objectURL<font></font>
    <span class="hljs-built_in">document</span>.body.appendChild(image)<font></font>
})<font></font>
.catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'There has been a problem with your fetch operation: '</span> + e.message)<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lembre-se de que o valor retornado pela promessa √© passado como par√¢metro para o pr√≥ximo executor da fun√ß√£o do bloco .then (). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota. </font><font style="vertical-align: inherit;">Os blocos .then () /. Catch () nas promessas s√£o equivalentes ass√≠ncronos do bloco try ... catch s√≠ncrono. </font><font style="vertical-align: inherit;">Lembre-se: tentativa s√≠ncrona ... catch n√£o funcionar√° em c√≥digo ass√≠ncrono.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√µes de terminologia promissora</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos fazer um balan√ßo e escrever um pequeno guia que voc√™ pode usar no futuro. </font><font style="vertical-align: inherit;">Para consolidar o conhecimento, recomendamos que voc√™ leia a se√ß√£o anterior v√°rias vezes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. Quando a promessa √© criada, eles dizem que est√° em um estado de expectativa. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. Quando a promessa √© devolvida, eles dizem que foi conclu√≠da (resolvida):</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Uma promessa cumprida com sucesso √© chamada cumprida. </font><font style="vertical-align: inherit;">Retorna o valor que pode ser obtido atrav√©s da cadeia a partir de .then () no final da promessa. </font><font style="vertical-align: inherit;">A fun√ß√£o de execu√ß√£o no bloco .then () cont√©m o valor retornado pela promessa.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Uma promessa cumprida sem sucesso √© chamada de rejeitada. </font><font style="vertical-align: inherit;">Retorna o motivo, a mensagem de erro que levou √† rejei√ß√£o da promessa. </font><font style="vertical-align: inherit;">Esse motivo pode ser obtido atrav√©s do bloco .catch () no final da promessa.</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Execute o c√≥digo ap√≥s v√°rias promessas</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aprendemos o b√°sico do uso de promessas. Agora vamos ver os recursos mais avan√ßados. A cadeia de .then () √© boa, mas e se quisermos chamar v√°rios blocos de promessas, um por um? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode fazer isso usando o m√©todo Promise.all () padr√£o. Esse m√©todo usa uma matriz de promessas como par√¢metro e retorna uma nova promessa quando todas as promessas na matriz s√£o cumpridas. Parece algo como isto:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-built_in">Promise</span>.all([a,b,c]).then(<span class="hljs-function"><span class="hljs-params">values</span> =&gt;</span> {<font></font>
        ...<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se todas as promessas forem cumpridas, o executor da matriz do bloco .then () ser√° passado como par√¢metro. Se pelo menos uma das promessas n√£o for cumprida, todo o bloco ser√° rejeitado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso pode ser muito √∫til. Imagine que recebemos informa√ß√µes para preencher dinamicamente a interface do usu√°rio com o conte√∫do de nossa p√°gina. Em muitos casos, √© mais razo√°vel receber todas as informa√ß√µes e exibi-las na p√°gina mais tarde do que exibir as informa√ß√µes em partes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vejamos outro exemplo: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. Fa√ßa o download de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">um modelo de p√°gina</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e coloque a tag &lt;script&gt; antes da tag de fechamento &lt;/body&gt;. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. Fa√ßa o download dos arquivos de origem ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coffee.jpg</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tea.jpg</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">description.txt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) ou substitua-os pelos seus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. No script, primeiro definimos uma fun√ß√£o que retorna as promessas que passamos para Promise.all (). </font><font style="vertical-align: inherit;">Isso ser√° f√°cil se executarmos Promise.all () ap√≥s concluir as tr√™s opera√ß√µes fetch (). </font><font style="vertical-align: inherit;">Podemos fazer o seguinte:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> a = fetch(url1)
<span class="hljs-keyword">let</span> b = fetch(url2)
<span class="hljs-keyword">let</span> c = fetch(url3)<font></font>
<font></font>
<span class="hljs-built_in">Promise</span>.all([a, b, c]).then(<span class="hljs-function"><span class="hljs-params">values</span> =&gt;</span> {<font></font>
    ...<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando a promessa for cumprida, a vari√°vel "values" conter√° tr√™s objetos Response, um de cada opera√ß√£o fetch () conclu√≠da. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, n√£o queremos isso. </font><font style="vertical-align: inherit;">N√£o importa para n√≥s quando as opera√ß√µes fetch () s√£o conclu√≠das. </font><font style="vertical-align: inherit;">O que realmente queremos s√£o os dados carregados. </font><font style="vertical-align: inherit;">Isso significa que queremos executar o bloco Promise.all () ap√≥s receber o blob v√°lido que representa imagens e cadeias de texto v√°lidas. </font><font style="vertical-align: inherit;">Podemos escrever uma fun√ß√£o que faz isso; </font><font style="vertical-align: inherit;">adicione o seguinte ao seu elemento &lt;script&gt;:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fetchAndDecode</span>(<span class="hljs-params">url, type</span>)</span>{
    <span class="hljs-keyword">return</span> fetch(url).then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
        <span class="hljs-keyword">if</span>(type === <span class="hljs-string">'blob'</span>){
            <span class="hljs-keyword">return</span> response.blob()<font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(type === <span class="hljs-string">'text'</span>){
            <span class="hljs-keyword">return</span> response.text()<font></font>
        }<font></font>
    }).catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'There has been a problem with your fetch operation '</span> + e.message)<font></font>
    })<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parece um pouco complicado, ent√£o vamos analisar o c√≥digo passo a passo: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. Primeiro, declaramos uma fun√ß√£o e passamos a URL e o tipo do arquivo resultante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. A estrutura da fun√ß√£o √© semelhante √† que vimos no primeiro exemplo - chamamos a fun√ß√£o fetch () para obter o arquivo em uma URL espec√≠fica e, em seguida, transferimos o arquivo para outra promessa que retorna o corpo de resposta decodificado (lido). </font><font style="vertical-align: inherit;">No exemplo anterior, sempre foi o m√©todo blob (). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. Existem duas diferen√ßas:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primeiro, a segunda promessa de retorno depende do tipo de valor. </font><font style="vertical-align: inherit;">Dentro da fun√ß√£o de execu√ß√£o, usamos a instru√ß√£o if ... else if para retornar a promessa, dependendo do tipo de arquivo que precisamos decodificar (nesse caso, escolhemos entre blob e texto, mas o exemplo pode ser facilmente estendido para trabalhar com outros tipos).</font></font></li>
<li>-,     ¬´return¬ª   fetch().       ,     (..   ,  blob()  text(),  ,  ,   ).  ,  return     .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4. No final, chamamos o m√©todo .catch () para lidar com quaisquer erros que possam ocorrer nas promessas na matriz passada para .all (). Se uma das promessas for rejeitada, o bloqueio de captura nos informar√° qual era a promessa do problema. O bloco .all () ainda ser√° executado, mas n√£o exibir√° os resultados para os quais houve erros. Se voc√™ quiser que .all () seja rejeitado, adicione um bloco .catch () no final. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O c√≥digo dentro da fun√ß√£o √© ass√≠ncrono e baseado em promessas; portanto, toda a fun√ß√£o funciona como uma promessa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4. Em seguida, chamamos nossa fun√ß√£o tr√™s vezes para iniciar o processo de recebimento e decodifica√ß√£o de imagens e texto e colocar cada uma das promessas em uma vari√°vel. Adicione o seguinte:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> coffee = fetchAndDecode(<span class="hljs-string">'coffee.jpg'</span>, <span class="hljs-string">'blob'</span>)
<span class="hljs-keyword">let</span> tea = fetchAndDecode(<span class="hljs-string">'tea.jpg'</span>, <span class="hljs-string">'blob'</span>)
<span class="hljs-keyword">let</span> description = fetchAndDecode(<span class="hljs-string">'description.txt'</span>, <span class="hljs-string">'text'</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5. Em seguida, declaramos um bloco Promise.all () para executar algum c√≥digo somente ap√≥s todas as tr√™s promessas terem sido cumpridas. </font><font style="vertical-align: inherit;">Adicione um bloco com uma fun√ß√£o executora vazia dentro de .then ():</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-built_in">Promise</span>.all([coffee, tea, description]).then(<span class="hljs-function"><span class="hljs-params">values</span> =&gt;</span> {<font></font>
<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode ver que √© preciso um conjunto de promessas como par√¢metro. </font><font style="vertical-align: inherit;">O contratado iniciar√° somente depois que todas as tr√™s promessas forem cumpridas; </font><font style="vertical-align: inherit;">Quando isso acontece, o resultado de cada promessa (o corpo de resposta decodificado) ser√° colocado em uma matriz, isso pode ser representado como [resultados de caf√©, resultados de ch√°, descri√ß√£o de resultados]. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6. Finalmente, adicione o seguinte ao executor (aqui usamos um c√≥digo s√≠ncrono bastante simples para colocar os resultados em vari√°veis ‚Äã‚Äã(criando objetos de URL a partir do blob) e exibir imagens e texto na p√°gina):</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-built_in">console</span>.log(values)
<span class="hljs-comment">//       </span>
<span class="hljs-keyword">let</span> objectURL1 = URL.createObjectURL(values[<span class="hljs-number">0</span>])
<span class="hljs-keyword">let</span> objectURL2 = URL.createObjectURL(values[<span class="hljs-number">1</span>])
<span class="hljs-keyword">let</span> descText = values[<span class="hljs-number">2</span>]<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-keyword">let</span> image1 = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'img'</span>)
<span class="hljs-keyword">let</span> image2 = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'img'</span>)<font></font>
image1.src = objectURL1<font></font>
image2.src = objectURL2<font></font>
<span class="hljs-built_in">document</span>.body.appendChild(image1)
<span class="hljs-built_in">document</span>.body.appendChild(image2)<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-keyword">let</span> para = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'p'</span>)<font></font>
para.textContent = descText<font></font>
<span class="hljs-built_in">document</span>.body.appendChild(para)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Salve as altera√ß√µes e recarregue a p√°gina. Voc√™ deve ver que todos os componentes da interface do usu√°rio est√£o carregando, embora isso n√£o pare√ßa muito atraente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota. Se voc√™ tiver alguma dificuldade, pode comparar sua vers√£o do c√≥digo com a nossa - aqui est√° uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">demonstra√ß√£o ao vivo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√≥digo-fonte</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota. Para melhorar esse c√≥digo, voc√™ pode percorrer os elementos exibidos, recebendo e decodificando cada um, e depois percorrer os resultados dentro de Promise.all (), iniciando diferentes fun√ß√µes para exibir cada resultado, dependendo do seu tipo. Isso permitir√° que voc√™ trabalhe com qualquer n√∫mero de elementos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, voc√™ pode determinar o tipo do arquivo resultante sem precisar especificar explicitamente a propriedade type. Isso, por exemplo, pode ser feito com</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">response.headers.get ('content-type')</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para verificar </font><font style="vertical-align: inherit;">o cabe√ßalho HTTP Protocol </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Content-Type</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Execute o c√≥digo ap√≥s cumprir / rejeitar a promessa</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Geralmente, pode ser necess√°rio executar o c√≥digo ap√≥s a conclus√£o de uma promessa, independentemente de ter sido executada ou rejeitada. </font><font style="vertical-align: inherit;">Anteriormente, t√≠nhamos que incluir o mesmo c√≥digo nos blocos .then () e .catch (), por exemplo:</font></font><br>
<br>
<pre><code class="javascript hljs">myPromise<font></font>
.then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {<font></font>
    doSomething(response)<font></font>
    runFinalCode()<font></font>
})<font></font>
.catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {<font></font>
    returnError(e)<font></font>
    runFinalCode()<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nos navegadores modernos, o m√©todo .finally () est√° dispon√≠vel, o que permite executar o c√≥digo ap√≥s a conclus√£o da promessa, o que evita a repeti√ß√£o e torna o c√≥digo mais elegante. </font><font style="vertical-align: inherit;">O c√≥digo do exemplo anterior pode ser reescrito da seguinte maneira:</font></font><br>
<br>
<pre><code class="javascript hljs">myPromise<font></font>
.then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {<font></font>
    doSomething(response)<font></font>
})<font></font>
.catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {<font></font>
    returnError(e)<font></font>
})<font></font>
.finally(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<font></font>
    runFinalCode()<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode ver o uso dessa abordagem com um exemplo real - a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">demonstra√ß√£o ao vivo promessa-finalmente.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√≥digo fonte</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Funciona da mesma forma que Promise.all () do exemplo anterior, exceto que adicionamos finalmente () no final da cadeia na fun√ß√£o fetchAndDecode ():</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fetchAndDecode</span>(<span class="hljs-params">url, type</span>)</span>{
    <span class="hljs-keyword">return</span> fetch(url).then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
        <span class="hljs-keyword">if</span>(type === <span class="hljs-string">'blob'</span>){
            <span class="hljs-keyword">return</span> response.blob()<font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(type === <span class="hljs-string">'text'</span>){
            <span class="hljs-keyword">return</span> response.text()<font></font>
        }<font></font>
    }).catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`There has been a problem with your fetch operation for resource "<span class="hljs-subst">${url}</span>": <span class="hljs-subst">${e.message}</span>`</span>)<font></font>
    }).finally(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`fetch attempt for "<span class="hljs-subst">${url}</span>" finished.`</span>)<font></font>
    })<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Receberemos uma mensagem sobre a conclus√£o de cada tentativa de obter o arquivo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota. </font><font style="vertical-align: inherit;">ent√£o () / catch () / finalmente () √© o equivalente ass√≠ncrono de tentativa s√≠ncrona () / catch () / finalmente ().</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escrevendo sua pr√≥pria promessa</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A boa not√≠cia √© que voc√™ j√° sabe como faz√™-lo. </font><font style="vertical-align: inherit;">Ao combinar v√°rias promessas com .then () ou combin√°-las para fornecer funcionalidade espec√≠fica, voc√™ cria suas pr√≥prias fun√ß√µes ass√≠ncronas e baseadas em promessas. </font><font style="vertical-align: inherit;">Tomemos, por exemplo, nossa fun√ß√£o fetchAndDecode () do exemplo anterior. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Combinar v√°rias APIs baseadas em promessas para criar funcionalidades espec√≠ficas √© a maneira mais comum de trabalhar com promessas, o que mostra a flexibilidade e o poder das APIs modernas. </font><font style="vertical-align: inherit;">No entanto, existe outro caminho.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Promessa do construtor ()</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode criar sua pr√≥pria promessa usando o construtor Promise (). Isso pode ser necess√°rio em uma situa√ß√£o em que voc√™ tenha c√≥digo da API ass√≠ncrona antiga que precisa ser "superdimensionada". Isso √© feito para poder trabalhar simultaneamente com c√≥digos antigos existentes, bibliotecas ou "estruturas" e com o novo c√≥digo baseado em promessas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vejamos um exemplo simples - aqui envolvemos a chamada setTimeout () em uma promessa - isso iniciar√° a fun√ß√£o em 2 segundos, o que cumprir√° a promessa (usando a chamada resolve () passada) com a string "Success!".</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> timeoutPromise = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {<font></font>
    setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<font></font>
        resolve(<span class="hljs-string">'Success!'</span>)<font></font>
    }, <span class="hljs-number">2000</span>)<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
resolve () e rejeita () s√£o fun√ß√µes chamadas para cumprir ou rejeitar uma nova promessa. </font><font style="vertical-align: inherit;">Nesse caso, a promessa √© cumprida com a string "Success!". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando voc√™ chama essa promessa, pode adicionar um bloco .then () a ele para continuar trabalhando com a linha ‚ÄúSuccess!‚Äù. </font><font style="vertical-align: inherit;">Ent√£o, podemos gerar uma linha na mensagem:</font></font><br>
<br>
<pre><code class="javascript hljs">timeoutPromise<font></font>
.then(<span class="hljs-function">(<span class="hljs-params">message</span>) =&gt;</span> {<font></font>
    alert(message)<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... ou ent√£o:</font></font><br>
<br>
<pre><code class="javascript hljs">timeoutPromise.then(alert)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assista a uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">demonstra√ß√£o ao vivo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√≥digo fonte</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O exemplo dado n√£o √© muito flex√≠vel - a promessa s√≥ pode ser cumprida com uma linha simples, n√£o temos um manipulador de erros - rejeite () (na verdade, setTimeout () n√£o precisa de um manipulador de erros, portanto, neste caso, n√£o importa). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota. </font><font style="vertical-align: inherit;">Por que resolver () ao inv√©s de cumprir ()? </font><font style="vertical-align: inherit;">No momento, a resposta √© esta: √© dif√≠cil de explicar.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabalhamos com a rejei√ß√£o de uma promessa</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Podemos criar uma promessa rejeitada usando o m√©todo reject () - assim como resolve (), rejeitar () assume um valor simples, mas, ao contr√°rio de resolve (), o valor simples n√£o √© o resultado, mas o motivo da rejei√ß√£o, ou seja, </font><font style="vertical-align: inherit;">um erro que √© passado para o bloco .catch (). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos expandir o exemplo anterior, adicionando uma condi√ß√£o para rejeitar uma promessa, bem como a capacidade de receber mensagens diferentes de uma mensagem de sucesso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pegue o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exemplo anterior</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e reescreva-o assim:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">timeoutPromise</span>(<span class="hljs-params">message, interval</span>)</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span>(message === <span class="hljs-string">''</span> || <span class="hljs-keyword">typeof</span> message !== <span class="hljs-string">'string'</span>){<font></font>
            reject(<span class="hljs-string">'Message is empty or not a string'</span>)<font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(interval &lt; <span class="hljs-number">0</span> || <span class="hljs-keyword">typeof</span> interval !== number){<font></font>
            reject(<span class="hljs-string">'Interval is negative or not a number'</span>)<font></font>
        } <span class="hljs-keyword">else</span>{<font></font>
            setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<font></font>
                resolve(message)<font></font>
            }, interval)<font></font>
        }<font></font>
    })<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui passamos dois argumentos para a fun√ß√£o - mensagem e intervalo (atraso de tempo). </font><font style="vertical-align: inherit;">Em uma fun√ß√£o, retornamos um objeto Promise. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No construtor Promise, realizamos v√°rias verifica√ß√µes usando estruturas if ... else:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primeiro, verificamos a mensagem. </font><font style="vertical-align: inherit;">Se estiver vazio ou n√£o for uma string, rejeitamos a promessa e relatamos um erro.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em segundo lugar, verificamos o atraso. </font><font style="vertical-align: inherit;">Se √© um n√∫mero negativo ou n√£o, tamb√©m rejeitamos a promessa e relatamos um erro.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por fim, se os dois argumentos estiverem OK, exiba a mensagem ap√≥s um certo tempo (intervalo) usando setTimeout ().</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como timeoutPromise () retorna uma promessa, podemos adicionar .then (), .catch () etc. a ele para melhorar sua funcionalidade. </font><font style="vertical-align: inherit;">Vamos fazer isso:</font></font><br>
<br>
<pre><code class="javascript hljs">timeoutPromise(<span class="hljs-string">'Hello there!'</span>, <span class="hljs-number">1000</span>)<font></font>
.then(<span class="hljs-function"><span class="hljs-params">message</span> =&gt;</span> {<font></font>
    alert(message)<font></font>
}).catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Error: '</span> + e)<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s salvar as altera√ß√µes e executar o c√≥digo, voc√™ ver√° uma mensagem ap√≥s um segundo. </font><font style="vertical-align: inherit;">Agora tente passar uma string vazia como uma mensagem ou um n√∫mero negativo como um intervalo. </font><font style="vertical-align: inherit;">Voc√™ ver√° uma mensagem de erro como resultado da rejei√ß√£o da promessa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota. </font><font style="vertical-align: inherit;">Voc√™ pode encontrar nossa vers√£o deste exemplo no GitHub - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">custom-promessa2.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fonte</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo mais realista.</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O exemplo que examinamos facilita a compreens√£o do conceito, mas n√£o √© verdadeiramente ass√≠ncrono. A assincronia no exemplo √© simulada usando setTimeout (), embora ainda mostre a utilidade das promessas para a cria√ß√£o de fun√ß√µes com um fluxo de trabalho razo√°vel, boa manipula√ß√£o de erros, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um exemplo de um aplicativo ass√≠ncrono √∫til que usa o construtor Promise () √© a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">biblioteca idb (IndexedDB with usabilidade)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jake Archibald. </font><font style="vertical-align: inherit;">Essa biblioteca permite que voc√™ use a API IndexedDB (com base nas fun√ß√µes de retorno de chamada da API para armazenar e recuperar dados no lado do cliente), escrita no estilo antigo, com promessas. </font><font style="vertical-align: inherit;">Se voc√™ olhar o arquivo principal da biblioteca, ver√° que ele usa as mesmas t√©cnicas que examinamos acima. </font><font style="vertical-align: inherit;">O c√≥digo a seguir converte o modelo de consulta b√°sico usado por muitos m√©todos do IndexedDB em um modelo compat√≠vel com promessa:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">promisifyRequest</span>(<span class="hljs-params">request</span>)</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">resolve, reject</span>)</span>{<font></font>
        request.onsuccess = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<font></font>
            resolve(request.result)<font></font>
        }<font></font>
<font></font>
        request.onerror = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<font></font>
            reject(request.error)<font></font>
        }<font></font>
    })<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso adiciona alguns manipuladores de eventos que cumprem ou rejeitam a promessa, conforme apropriado:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quando a solicita√ß√£o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© bem-sucedida</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o manipulador de √™xito cumpre a promessa com o resultado da solicita√ß√£o.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quando a solicita√ß√£o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">falha</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o manipulador onerror rejeita a promessa com o erro da solicita√ß√£o.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As promessas s√£o uma √≥tima maneira de criar aplicativos ass√≠ncronos quando n√£o sabemos qual valor a fun√ß√£o retornar√° ou quanto tempo levar√°. Eles permitem que voc√™ trabalhe com uma sequ√™ncia de opera√ß√µes ass√≠ncronas sem usar fun√ß√µes de retorno de chamada profundamente aninhadas e suportam o estilo de manipula√ß√£o de erros da instru√ß√£o try ... catch s√≠ncrona. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As promessas s√£o suportadas por todos os navegadores modernos. A √∫nica exce√ß√£o √© o Opera Mini e o IE11 e suas vers√µes anteriores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neste artigo, consideramos longe de todas as caracter√≠sticas das promessas, apenas as mais interessantes e √∫teis. Voc√™ conhecer√° outros recursos e t√©cnicas se quiser aprender mais sobre promessas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As APIs da Web mais modernas s√£o baseadas em promessas, portanto, essas promessas precisam ser conhecidas. </font><font style="vertical-align: inherit;">Entre essas APIs da Web, podemos nomear </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebRTC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API de √°udio da Web</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Captura de m√≠dia e fluxos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , etc. As promessas se tornar√£o cada vez mais populares; portanto, seu estudo e entendimento s√£o um passo importante para o dom√≠nio do JavaScript moderno. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consulte tamb√©m </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Erros comuns no JavaScript prometem que todos devem saber"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obrigado pela aten√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cr√≠ticas construtivas s√£o bem-vindas.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt488750/index.html">Passeio dos Dinossauros: Dois Grandes Computadores do S√©culo XX</a></li>
<li><a href="../pt488752/index.html">Golang + Phaser3 = MMORPG - Criamos a base para a gera√ß√£o infinita do mundo</a></li>
<li><a href="../pt488754/index.html">Tudo de uma vez: verifica√ß√£o autom√°tica do tamanho do pacote</a></li>
<li><a href="../pt488756/index.html">Como trabalhar com a API do Google Sheets (API do Google Sheets v4) no R usando o novo pacote googlesheets4</a></li>
<li><a href="../pt488758/index.html">Confer√™ncia DEFCON 27. Reconhecimento de fraudes na Internet</a></li>
<li><a href="../pt488766/index.html">Arte e Tecnologia: Universidade de Massachusetts em Lowell</a></li>
<li><a href="../pt488768/index.html">Inferno sangrento, ou Como jurar em ingl√™s ser confundido com uma pessoa culta</a></li>
<li><a href="../pt488776/index.html">Aprimoramentos de acessibilidade no Visual Studio 2019 para Mac</a></li>
<li><a href="../pt488778/index.html">Estruturas de dados: uma lista que pode fazer tudo *</a></li>
<li><a href="../pt488780/index.html">Mozilla perdeu na guerra dos navegadores, mas ainda acredita que poderia salvar a Internet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>