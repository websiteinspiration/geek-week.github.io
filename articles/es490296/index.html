<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>鮫勇 游녫游 游볽 Funciones de ventana con una "ventana" o c칩mo usar un marco 游눩 游냇 游녽游</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos. El 26 de febrero, las clases comenzaron en OTUS en un nuevo grupo en el curso "MS SQL Server Developer" . En este sentido, quiero compar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Funciones de ventana con una "ventana" o c칩mo usar un marco</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/490296/"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hola a todos. </font><font style="vertical-align: inherit;">El 26 de febrero, las clases comenzaron en OTUS en un nuevo grupo en el curso </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"MS SQL Server Developer"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">En este sentido, quiero compartir con ustedes mi publicaci칩n sobre las funciones de la ventana. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por cierto, en la pr칩xima semana todav칤a puedes unirte al grupo ;-).</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/vn/oa/u-/vnoau-jary7uq68zxw0rrueyfm8.png"><br>
<br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las funciones de ventana est치n bien establecidas en nuestra pr치ctica, pero pocas personas saben c칩mo funcionan los marcos RANGE y ROWS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quiz치s es por eso que son algo menos comunes. </font><font style="vertical-align: inherit;">El prop칩sito de este art칤culo es proporcionar ejemplos de uso para que definitivamente no tenga preguntas "쯈ui칠n es qui칠n?" </font><font style="vertical-align: inherit;">y "쮺칩mo aplicarlo?". </font><font style="vertical-align: inherit;">La pregunta "쯇or qu칠?" </font><font style="vertical-align: inherit;">El art칤culo permanecer치 apagado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veamos qu칠 es un marco y c칩mo lograr un efecto similar usando ORDER By en la cl치usula OVER ().</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para la demostraci칩n, utilizaremos una tabla simple para que pueda calcular ejemplos sin usar un compilador. </font><font style="vertical-align: inherit;">En general, lo recomiendo encarecidamente: mire y piense cu치l ser치 el resultado de la ejecuci칩n, y luego verif칤quese usted mismo, para que encuentre puntos blancos en la percepci칩n de las funciones de la ventana, lo que puede no ser obvio cuando lee los resultados finales.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mesa</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">Create</span> <span class="hljs-keyword">table</span> sales <font></font>
(sales_id <span class="hljs-built_in">INT</span> PRIMARY <span class="hljs-keyword">KEY</span>, sales_dt DATETIME2 <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">GETUTCDATE</span>(),  customer_id <span class="hljs-built_in">INT</span>, item_id <span class="hljs-built_in">INT</span>, cnt <span class="hljs-built_in">INT</span>, price_per_item <span class="hljs-built_in">DECIMAL</span>(<span class="hljs-number">19</span>,<span class="hljs-number">4</span>));<font></font>
<font></font>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> sales<font></font>
(sales_id, sales_dt, customer_id, item_id, cnt, price_per_item)<font></font>
<span class="hljs-keyword">VALUES</span>
(<span class="hljs-number">1</span>, <span class="hljs-string">'2020-01-10T10:00:00'</span>, <span class="hljs-number">100</span>, <span class="hljs-number">200</span>, <span class="hljs-number">2</span>, <span class="hljs-number">30.15</span>),<font></font>
(<span class="hljs-number">2</span>, <span class="hljs-string">'2020-01-11T11:00:00'</span>, <span class="hljs-number">100</span>, <span class="hljs-number">311</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5.00</span>),<font></font>
(<span class="hljs-number">3</span>, <span class="hljs-string">'2020-01-12T14:00:00'</span>, <span class="hljs-number">100</span>, <span class="hljs-number">400</span>, <span class="hljs-number">1</span>, <span class="hljs-number">50.00</span>),<font></font>
(<span class="hljs-number">4</span>, <span class="hljs-string">'2020-01-12T20:00:00'</span>, <span class="hljs-number">100</span>, <span class="hljs-number">311</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5.00</span>),<font></font>
(<span class="hljs-number">5</span>, <span class="hljs-string">'2020-01-13T10:00:00'</span>, <span class="hljs-number">150</span>, <span class="hljs-number">311</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5.00</span>),<font></font>
(<span class="hljs-number">6</span>, <span class="hljs-string">'2020-01-13T11:00:00'</span>, <span class="hljs-number">100</span>, <span class="hljs-number">315</span>, <span class="hljs-number">1</span>, <span class="hljs-number">17.00</span>),<font></font>
(<span class="hljs-number">7</span>, <span class="hljs-string">'2020-01-14T10:00:00'</span>, <span class="hljs-number">150</span>, <span class="hljs-number">200</span>, <span class="hljs-number">2</span>, <span class="hljs-number">30.15</span>),<font></font>
(<span class="hljs-number">8</span>, <span class="hljs-string">'2020-01-14T15:00:00'</span>, <span class="hljs-number">100</span>, <span class="hljs-number">380</span>, <span class="hljs-number">1</span>, <span class="hljs-number">8.00</span>),<font></font>
(<span class="hljs-number">9</span>, <span class="hljs-string">'2020-01-14T18:00:00'</span>, <span class="hljs-number">170</span>, <span class="hljs-number">380</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8.00</span>),<font></font>
(<span class="hljs-number">10</span>, <span class="hljs-string">'2020-01-15T09:30:00'</span>, <span class="hljs-number">100</span>, <span class="hljs-number">311</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5.00</span>),<font></font>
(<span class="hljs-number">11</span>, <span class="hljs-string">'2020-01-15T12:45:00'</span>, <span class="hljs-number">150</span>, <span class="hljs-number">311</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5.00</span>),<font></font>
(<span class="hljs-number">12</span>, <span class="hljs-string">'2020-01-15T21:30:00'</span>, <span class="hljs-number">170</span>, <span class="hljs-number">200</span>, <span class="hljs-number">1</span>, <span class="hljs-number">30.15</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comencemos con un momento simple: las diferencias en la funci칩n SUMA con y sin ordenar</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> sales_id, customer_id, <span class="hljs-keyword">count</span>, 
<span class="hljs-keyword">SUM</span>(<span class="hljs-keyword">count</span>) <span class="hljs-keyword">OVER</span> () <span class="hljs-keyword">as</span> total,
<span class="hljs-keyword">SUM</span>(<span class="hljs-keyword">count</span>) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> customer_id) <span class="hljs-keyword">AS</span> cum,
<span class="hljs-keyword">SUM</span>(<span class="hljs-keyword">count</span>) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> customer_id, sales_id) <span class="hljs-keyword">AS</span> cum_uniq
<span class="hljs-keyword">FROM</span> sales
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> customer_id, sales_id;</code></pre><br>
<img src="https://habrastorage.org/webt/da/d9/pz/dad9pzfa7cz9lvtcx_uj-8iulgs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veamos el primer rastrillo discreto, 쯖칩mo crees que cu치ntos desarrolladores piensan que cum y cum_uniq son iguales al leer el c칩digo? </font><font style="vertical-align: inherit;">Pensar un poco? </font><font style="vertical-align: inherit;">Quiz치s, pero porque aqu칤 es obvio, y es tan obvio al leer el c칩digo en la aplicaci칩n, e incluso con la no tan obvia falta de uniformidad del campo de clasificaci칩n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora abre nuestra maravillosa ventana. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La ventana, o m치s bien el marco es de 2 tipos de FILAS y RANGO, primero debe conocer las FILAS. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Opciones de restricci칩n de trama:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todo antes de la fila / rango actual y el valor real de la fila actual </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ENTRE PRECEDENTES SIN L칈MITES </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ENTRE PRECEDENTES SIN PROCESAR Y FILA ACTUAL</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fila / rango actual y todo lo dem치s, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ENTRE FILA ACTUAL Y SIGUIENTE SIN L칈MITES</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Especificar cu치ntas l칤neas antes y despu칠s de incluir (no admitidas para RANGO) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ENTRE N Precediendo Y N Siguiendo </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ENTRE FILA ACTUAL Y N Siguiendo </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ENTRE N </font><font style="vertical-align: inherit;">FILA ANTERIOR </font><font style="vertical-align: inherit;">Y ACTUAL</font></font><br>
</li>
</ol> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero veamos el marco en acci칩n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abrimos la "ventana" en la l칤nea actual y todas las anteriores, para la funci칩n SUMA, como puede ver, esto coincide con la clasificaci칩n ASC</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> sales_id, customer_id, cnt, 
<span class="hljs-keyword">SUM</span>(cnt) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> customer_id, sales_id) <span class="hljs-keyword">AS</span> cum_uniq,
<span class="hljs-keyword">SUM</span>(cnt) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> customer_id, sales_id <span class="hljs-keyword">ROWS</span> <span class="hljs-keyword">UNBOUNDED</span> <span class="hljs-keyword">PRECEDING</span>) <span class="hljs-keyword">AS</span> current_and_all_before,
<span class="hljs-keyword">SUM</span>(cnt) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> customer_id, sales_id <span class="hljs-keyword">ROWS</span> <span class="hljs-keyword">BETWEEN</span> <span class="hljs-keyword">UNBOUNDED</span> <span class="hljs-keyword">PRECEDING</span> <span class="hljs-keyword">AND</span> <span class="hljs-keyword">CURRENT</span> <span class="hljs-keyword">ROW</span>) <span class="hljs-keyword">AS</span> current_and_all_before2
<span class="hljs-keyword">FROM</span> sales
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> customer_id, sales_id;</code></pre><br>
<img src="https://habrastorage.org/webt/5s/xz/l7/5sxzl7aiaev0w_psmtrxfgd1uio.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al mismo tiempo, quiero recordarle que el orden de clasificaci칩n en la ventana (en la cl치usula OVER ()) no est치 relacionado con el orden de clasificaci칩n en la consulta en s칤, en el ejemplo es el mismo para simplificar el c치lculo si decide verificar el c치lculo y su comprensi칩n de c칩mo funciona la funci칩n</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> sales_id, customer_id, cnt, 
<span class="hljs-keyword">SUM</span>(cnt) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> customer_id, sales_id) <span class="hljs-keyword">AS</span> cum_uniq,
<span class="hljs-keyword">SUM</span>(cnt) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> customer_id, sales_id <span class="hljs-keyword">ROWS</span> <span class="hljs-keyword">UNBOUNDED</span> <span class="hljs-keyword">PRECEDING</span>) <span class="hljs-keyword">AS</span> current_and_all_before,
<span class="hljs-keyword">SUM</span>(cnt) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> customer_id, sales_id <span class="hljs-keyword">ROWS</span> <span class="hljs-keyword">BETWEEN</span> <span class="hljs-keyword">UNBOUNDED</span> <span class="hljs-keyword">PRECEDING</span> <span class="hljs-keyword">AND</span> <span class="hljs-keyword">CURRENT</span> <span class="hljs-keyword">ROW</span>) <span class="hljs-keyword">AS</span> current_and_all_before2
<span class="hljs-keyword">FROM</span> sales
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> cnt;</code></pre><br>
<img src="https://habrastorage.org/webt/9d/lf/ad/9dlfadjsfln70lj_rt0qdcdird4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora veamos la funcionalidad del marco cuando incluimos todas las l칤neas posteriores. </font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> sales_id, customer_id, cnt, 
<span class="hljs-keyword">SUM</span>(cnt) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> customer_id, sales_id <span class="hljs-keyword">ROWS</span> <span class="hljs-keyword">BETWEEN</span> <span class="hljs-keyword">CURRENT</span> <span class="hljs-keyword">ROW</span> <span class="hljs-keyword">AND</span> <span class="hljs-keyword">UNBOUNDED</span> <span class="hljs-keyword">FOLLOWING</span>) <span class="hljs-keyword">AS</span> current_and_all_frame,
<span class="hljs-keyword">SUM</span>(cnt) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> customer_id <span class="hljs-keyword">DESC</span>, sales_id <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> current_and_all_order_desc
<span class="hljs-keyword">FROM</span> sales
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> customer_id, sales_id;
</code></pre><br>
<img src="https://habrastorage.org/webt/zb/4z/b6/zb4zb6if36ixgxumfcxue7r-htw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como puede ver aqu칤, tambi칠n puede obtener el mismo resultado para una funci칩n agregada, si usa la clasificaci칩n inversa, pero ROWS es un poco m치s estable, porque si sus campos de clasificaci칩n no son 칰nicos, puede obtener una sorpresa en la forma de los mismos valores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y finalmente, una opci칩n que ya no puede ser imitada por tipos, cuando especificamos un n칰mero espec칤fico de l칤neas que deben incluirse en el marco</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> sales_id, customer_id, cnt, 
<span class="hljs-keyword">SUM</span>(cnt) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> customer_id, sales_id <span class="hljs-keyword">ROWS</span> <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">PRECEDING</span> <span class="hljs-keyword">AND</span> <span class="hljs-keyword">CURRENT</span> <span class="hljs-keyword">ROW</span>) <span class="hljs-keyword">AS</span> before_and_current,<font></font>
cnt,<font></font>
<span class="hljs-keyword">SUM</span>(cnt) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> customer_id, sales_id <span class="hljs-keyword">ROWS</span> <span class="hljs-keyword">BETWEEN</span> <span class="hljs-keyword">CURRENT</span> <span class="hljs-keyword">ROW</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">1</span> <span class="hljs-keyword">FOLLOWING</span>) <span class="hljs-keyword">AS</span> current_and_1_next,<font></font>
cnt,<font></font>
<span class="hljs-keyword">SUM</span>(cnt) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> customer_id, sales_id <span class="hljs-keyword">ROWS</span> <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">2</span> <span class="hljs-keyword">PRECEDING</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">2</span> <span class="hljs-keyword">FOLLOWING</span>) <span class="hljs-keyword">AS</span> before2_and_2_next
<span class="hljs-keyword">FROM</span> sales
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> customer_id, sales_id;</code></pre><br>
<img src="https://habrastorage.org/webt/x4/sw/h1/x4swh1lqz6fyyrmxzrxhc_5qhjw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En esta opci칩n, ya indica espec칤ficamente qu칠 l칤neas est치n en el rango, y en mi opini칩n, es m치s obvio por los resultados. </font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La diferencia entre ROWS y RANGE</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La diferencia es que ROWS opera en una fila y RANGE en un rango. Es cierto, esto es obvio por el nombre, pero explica poco en la pr치ctica? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veamos la imagen (fuente en la parte inferior del art칤culo) </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dx/ix/nv/dxixnvdxihdloazoiw6gqpafr6y.png"><br>
<br>
<img src="https://habrastorage.org/webt/rp/hg/do/rphgdok-lyuj0thbkbqektmp2rk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora, si miramos cuidadosamente, ser치 obvio que las filas con el mismo valor del par치metro de clasificaci칩n se denominan rango. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como ya se mencion칩 anteriormente, ROWS se limita a una cadena, mientras que RANGE captura todo el rango de valores coincidentes que especifique en la funci칩n de ventana ORDER BY.</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> sales_id, customer_id, cnt, 
<span class="hljs-keyword">SUM</span>(cnt) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> customer_id) <span class="hljs-keyword">AS</span> cum_uniq,<font></font>
cnt,<font></font>
<span class="hljs-keyword">SUM</span>(cnt) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> customer_id <span class="hljs-keyword">ROWS</span> <span class="hljs-keyword">UNBOUNDED</span> <span class="hljs-keyword">PRECEDING</span>) <span class="hljs-keyword">AS</span> current_and_all_before,<font></font>
customer_id,<font></font>
cnt,<font></font>
<span class="hljs-keyword">SUM</span>(cnt) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> customer_id <span class="hljs-keyword">RANGE</span> <span class="hljs-keyword">UNBOUNDED</span> <span class="hljs-keyword">PRECEDING</span>) <span class="hljs-keyword">AS</span> current_and_all_before2
<span class="hljs-keyword">FROM</span> sales
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-number">2</span>, sales_id;</code></pre><br>
<img src="https://habrastorage.org/webt/bp/g9/gv/bpg9gv3-kinq8vielngo1aowprq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FILAS: siempre opera en una l칤nea espec칤fica, incluso si la clasificaci칩n no es 칰nica, pero RANGO solo combina per칤odos en rangos con los valores coincidentes de los campos de clasificaci칩n. </font><font style="vertical-align: inherit;">En este sentido, la funcionalidad es muy similar al comportamiento de la funci칩n SUM () con la clasificaci칩n por un campo no 칰nico. </font><font style="vertical-align: inherit;">Veamos otro ejemplo.</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> sales_id, customer_id, price_per_item, cnt, 
<span class="hljs-keyword">SUM</span>(cnt) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> customer_id, price_per_item) <span class="hljs-keyword">AS</span> cum_uniq,<font></font>
cnt,<font></font>
<span class="hljs-keyword">SUM</span>(cnt) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> customer_id, price_per_item <span class="hljs-keyword">ROWS</span> <span class="hljs-keyword">UNBOUNDED</span> <span class="hljs-keyword">PRECEDING</span>) <span class="hljs-keyword">AS</span> current_and_all_before,<font></font>
customer_id,<font></font>
cnt,<font></font>
<span class="hljs-keyword">SUM</span>(cnt) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> customer_id, price_per_item <span class="hljs-keyword">RANGE</span> <span class="hljs-keyword">UNBOUNDED</span> <span class="hljs-keyword">PRECEDING</span>) <span class="hljs-keyword">AS</span> current_and_all_before2
<span class="hljs-keyword">FROM</span> sales
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-number">2</span>, price_per_item;</code></pre><br>
<br>
<img src="https://habrastorage.org/webt/mq/aw/h8/mqawh8dsjdtmhemt1zslc1uisnm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ya hay 2 campos y el rango est치 determinado por un rango con valores coincidentes para ambos campos, </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
y la opci칩n es cuando incluimos en el c치lculo todas las l칤neas posteriores de la actual, que en el caso de la funci칩n SUMA coincide con el valor que se puede obtener mediante la ordenaci칩n inversa:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> sales_id, customer_id, price_per_item, cnt, 
<span class="hljs-keyword">SUM</span>(cnt) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> customer_id <span class="hljs-keyword">DESC</span>, price_per_item <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> cum_uniq,<font></font>
cnt,<font></font>
<span class="hljs-keyword">SUM</span>(cnt) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> customer_id, price_per_item <span class="hljs-keyword">ROWS</span> <span class="hljs-keyword">BETWEEN</span> <span class="hljs-keyword">CURRENT</span> <span class="hljs-keyword">ROW</span> <span class="hljs-keyword">AND</span> <span class="hljs-keyword">UNBOUNDED</span> <span class="hljs-keyword">FOLLOWING</span>) <span class="hljs-keyword">AS</span> current_and_all_before,<font></font>
customer_id,<font></font>
cnt,<font></font>
<span class="hljs-keyword">SUM</span>(cnt) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> customer_id, price_per_item <span class="hljs-keyword">RANGE</span> <span class="hljs-keyword">BETWEEN</span> <span class="hljs-keyword">CURRENT</span> <span class="hljs-keyword">ROW</span> <span class="hljs-keyword">AND</span> <span class="hljs-keyword">UNBOUNDED</span> <span class="hljs-keyword">FOLLOWING</span>) <span class="hljs-keyword">AS</span> current_and_all_before2
<span class="hljs-keyword">FROM</span> sales
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-number">2</span>, price_per_item, sales_id <span class="hljs-keyword">desc</span>;</code></pre><br>
<img src="https://habrastorage.org/webt/ms/dd/cs/msddcsrra8xe2brharn8opjnni8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como puede ver, RANGE nuevamente captura todo el rango de pares coincidentes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A pesar de que la funcionalidad de ROWS y RANGE est치 lejos de ser nueva cada vez, surgen preguntas sobre c칩mo usarla. </font><font style="vertical-align: inherit;">Espero que este art칤culo haya agregado una comprensi칩n de c칩mo ROWS y RANGE son diferentes, y ahora no dudar치 en qu칠 caso se necesita este o aquel marco. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ilustraci칩n Fuente RANGO sobre la diferencia y las FILAS </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">las funciones de la ventana Con el SQL Server 2016, Mark Tabladillo </font></font></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">estar치 a tiempo para el curso</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es490282/index.html">Private SNAFU va a DBA</a></li>
<li><a href="../es490286/index.html">Siete conocidos por todas las reglas de vida desagradables, que pocos consideran</a></li>
<li><a href="../es490290/index.html">Ocho h치bitos importantes del programador</a></li>
<li><a href="../es490292/index.html">Gran venta rojo-azul</a></li>
<li><a href="../es490294/index.html">Entrevista de charco</a></li>
<li><a href="../es490298/index.html">Tipos sellados en Java</a></li>
<li><a href="../es490300/index.html">Let's Encrypt emiti칩 mil millones de certificados</a></li>
<li><a href="../es490302/index.html">Aprendiendo a implementar microservicios. Parte 3. Tim칩n</a></li>
<li><a href="../es490306/index.html">C칩mo hicimos maquetas de tecnolog칤a espacial para el Instituto de Aviaci칩n de Mosc칰</a></li>
<li><a href="../es490314/index.html">RE: 23 minutos. Justificaci칩n del ingenio lento</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>