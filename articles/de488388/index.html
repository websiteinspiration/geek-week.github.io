<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçô ü§∂üèΩ üëçüèª Relogin und HTTP Basic Auth ü¶Ñ üôçüèø üé≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Webentwickler sind sich seit langem des Problems der Anmeldung und Anmeldung bei Websites bewusst, die durch die HTTP-Basisautorisierung gesch√ºtzt sin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Relogin und HTTP Basic Auth</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488388/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Webentwickler sind sich seit langem des Problems der Anmeldung und Anmeldung bei Websites bewusst, die durch die HTTP-Basisautorisierung gesch√ºtzt sind. </font><font style="vertical-align: inherit;">Obwohl es andere Authentifizierungsmethoden gibt, bei denen dieses Problem nicht auftritt, ist die Basisautorisierung h√§ufig die beste Wahl. </font><font style="vertical-align: inherit;">Das Netzwerk verf√ºgt √ºber gen√ºgend Materialien, die verschiedene allgemeine und spezielle L√∂sungen beschreiben. </font><font style="vertical-align: inherit;">Aber alle, die ich leider gefunden habe, beschreiben nur einige Teill√∂sungen, die in einem Browser funktionieren und in einem anderen nicht funktionieren. </font><font style="vertical-align: inherit;">Unter Katze gebe ich ein allgemeines Endergebnis meiner Forschung zu diesem Problem</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich werde sofort reservieren, dass ich kein Front-End-Entwickler bin, und ich habe nicht auf die gesamte Vielfalt der Marken- und Browserversionen eingegangen. </font><font style="vertical-align: inherit;">Nur Mainstream mit zum Zeitpunkt des Schreibens relevanten Versionen. </font><font style="vertical-align: inherit;">F√ºr die meisten Webaufgaben reicht dies aus. </font><font style="vertical-align: inherit;">F√ºr Entwickler, die Unterst√ºtzung f√ºr den gesamten "Zoo" von Browsern ben√∂tigen, kann der Artikel ein guter Ausgangspunkt sein. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Problem besteht im Wesentlichen darin, dass der Standard f√ºr die HTTP-Basisautorisierung keine Protokollierung vorsieht. </font><font style="vertical-align: inherit;">Allgemein. </font><font style="vertical-align: inherit;">Wenn Sie zu einer durch die Basisautorisierung gesch√ºtzten Seite gehen, zeigt Ihnen der Browser selbst ein eigenes Fenster mit einer Anforderung f√ºr die Anmeldung / das Kennwort an und speichert diese bei erfolgreicher Anmeldung irgendwo in der Tiefe. </font><font style="vertical-align: inherit;">Bei allen nachfolgenden Anforderungen an andere gesch√ºtzte Seiten dieser Site werden diese Werte automatisch im Autorisierungsheader verwendet:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Autorisierung: Basic bm9uZTpub25l</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dabei ist bm9uZTpub25l der Base64-codierte Login- / Passwort-Link none: none (Ihr Benutzername und Passwort k√∂nnen unterschiedlich sein). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um sich anzumelden, m√ºssen Sie nur den alten Benutzernamen / das alte Passwort in diesen Tiefen des Browsers und auf diesen zur√ºcksetzen Ort, um neue aufzunehmen. </font><font style="vertical-align: inherit;">Hier erwartet uns eine √úberraschung. </font><font style="vertical-align: inherit;">Da kein Standard diese Aktion regelt, tut dies jeder Browser nach eigenem Verst√§ndnis.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schlimmer noch, da das Anmelde- / Kennwortanforderungsfenster ein eigenes Browserfenster ist, das bereits nur auf HTTP-Seitenkopfzeilen reagiert, wird dieses Fenster vor jeder Verarbeitung des Seitenk√∂rpers angezeigt. </font><font style="vertical-align: inherit;">Das hei√üt, das Ausf√ºhren von Javascript beim Empfang einer Serverantwort mit dem Status 401 funktioniert nicht. </font><font style="vertical-align: inherit;">Vor dem Benutzer wird dieses Fenster immer wieder mit einer wiederholten Anfrage nach Login / Passwort ge√∂ffnet.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der Tat ist dieser Punkt von entscheidender Bedeutung, da f√ºr fast alle Browser die einzige M√∂glichkeit zum Abmelden darin besteht, eine Anfrage mit offensichtlich falschem Login / Passwort an den Server zu senden, eine Serverantwort mit dem Status 401 zu erhalten und dann den Login / Passwort-Cache des Browsers zur√ºckzusetzen. </font><font style="vertical-align: inherit;">Wenn der Browser es Ihnen jedoch gleichzeitig nicht erlaubt, die Antwort 401 zu verarbeiten und den Anmeldevorgang bereits f√ºr den neuen Benutzer fortzusetzen, die Kontrolle bereits beim Lesen von HTTP-Headern zu √ºbernehmen und genau die Form der Autorisierung zu aktivieren, in die Sie sie eingeben, funktioniert dies nicht in Ihrem Gesicht schon ein problem. </font><font style="vertical-align: inherit;">Es spielt keine Rolle, ob dies eine normale Anforderung per Referenz oder XMLHttpRequest oder Abruf ist. </font><font style="vertical-align: inherit;">Der Browser √ºbernimmt weiterhin die Kontrolle beim Parsen der Header. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Damit‚Ä¶</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ausgangsdaten:</font></font></h4><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es gibt eine separate logout.html-Seite, auf der sich die gesamte Logik im Javascript-Skript befindet, von der Teile im Verlauf der Pr√§sentation angegeben werden</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">URL angegeben - Seitenadresse, die nach erfolgreicher Anmeldung umgeleitet werden soll</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Url401 wird angegeben - die Adresse der Seite, die immer den HTTP 401-Fehler zur√ºckgibt (nicht autorisiert)</font></font></li>
</ol><br>
<pre><code class="javascript hljs"><span class="hljs-comment">// file logout.html</span>
<span class="hljs-keyword">const</span> url = <span class="hljs-keyword">new</span> URL(<span class="hljs-string">"http://mysite.com/"</span>);
<span class="hljs-keyword">const</span> url401 = <span class="hljs-keyword">new</span> URL(<span class="hljs-string">"http://mysite.com/401"</span>);
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Internet Explorer</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unser Produkt ben√∂tigt keine Unterst√ºtzung f√ºr diesen Browser, daher habe ich die L√∂sung nicht pers√∂nlich getestet. </font><font style="vertical-align: inherit;">Trotzdem gibt es laut Google eine L√∂sung daf√ºr, und es ist vielleicht die einfachste und eleganteste von allen. </font><font style="vertical-align: inherit;">Au√üerdem habe ich nie Informationen dar√ºber erhalten, dass diese L√∂sung f√ºr Microsoft-Browser ihre Relevanz verloren hat:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">if</span> (<span class="hljs-built_in">document</span>.execCommand(<span class="hljs-string">"ClearAuthenticationCache"</span>)) {
    <span class="hljs-built_in">window</span>.location.assign(url);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im IE gibt es eine ClearAuthenticationCache-Methode, die "diese sehr tiefen Eingeweide" verwirft. </font><font style="vertical-align: inherit;">Einfach und elegant. </font><font style="vertical-align: inherit;">Und kein Tanzen mit der Hilfsseite 401. Ich wei√ü nicht, ob diese Methode in Edge funktioniert. </font><font style="vertical-align: inherit;">Wahrscheinlich ja. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Konstrukt document.execCommand gibt true zur√ºck, wenn die Methode vorhanden und "funktioniert" ist. </font><font style="vertical-align: inherit;">Anschlie√üend leitet window.location.assign (url) den Benutzer zur Eingabe eines neuen Benutzernamens und Kennworts weiter</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Firefox (72.0.1)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Rahmen unserer Aufgabe ist dies der problematischste Browser. </font><font style="vertical-align: inherit;">F√ºr ihn gibt es noch keine vollst√§ndige L√∂sung. </font><font style="vertical-align: inherit;">Seit 15 bis 20 Jahren h√§ngt eine Anfrage f√ºr das angegebene Problem im Bug-Tracker des Entwicklerteams. </font><font style="vertical-align: inherit;">Aber "die Dinge sind immer noch da." </font><font style="vertical-align: inherit;">Das Maximum, das erreicht werden kann, ist das Kurven-Razlogin. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eingabe: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Firefox setzt den Kennwortcache nicht zur√ºck, nachdem eine 401-Antwort √ºber XMLHttpRequest oder eine Abrufanforderung empfangen wurde. </font><font style="vertical-align: inherit;">Nur durch eine regelm√§√üige Anfrage mit dem Login / Passwort in der URL selbst. </font><font style="vertical-align: inherit;">Das hei√üt, so etwas wie</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http: // none: none@mysite.com/</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Der Code:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/firefox|iceweasel|fxios/i</span>.test(<span class="hljs-built_in">window</span>.navigator.userAgent)) {<font></font>
    url.username = <span class="hljs-string">'none'</span>;<font></font>
    url.password = <span class="hljs-string">'none'</span>;
    <span class="hljs-built_in">window</span>.location.assign(url);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Danach erh√§lt der Benutzer ein Anmelde- / Passworteingabeformular, in das alles, was Sie eingeben, immer wieder eingeblendet wird. </font><font style="vertical-align: inherit;">Tatsache ist, dass die eingegebenen Werte die in der URL angegebenen Anmelde- / Kennwortwerte nicht √ºberschreiben. </font><font style="vertical-align: inherit;">Das hei√üt, anstelle der eingegebenen Werte wird eine Reihe von none: none wird jedes Mal zum Server gesendet. </font><font style="vertical-align: inherit;">Um sich unter einem anderen Namen anzumelden, muss der Benutzer auf Abbrechen klicken, zur Startseite (http: //mysite.com/) gehen und dort ein neues Login / Passwort eingeben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Krumm? </font><font style="vertical-align: inherit;">Aber leider gibt es keine andere L√∂sung</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google Chrome (79.0.3945.88)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr Chrome funktioniert die Abrufmethode hervorragend. </font><font style="vertical-align: inherit;">XMLHttpRequest funktioniert jedoch nicht (((Der Cache wird nicht geleert und die Protokollierung findet nicht statt). Au√üerdem habe ich versucht, die Anmeldung / das Kennwort sowohl als Parameter f√ºr die Methode open als auch als Header festzulegen.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/chrome/i</span>.test(<span class="hljs-built_in">window</span>.navigator.userAgent)) {<font></font>
    fetch(url401, {<font></font>
      <span class="hljs-attr">credentials</span>: <span class="hljs-string">'include'</span>,
      <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">'Authorization'</span>: <span class="hljs-string">'Basic '</span> + btoa(<span class="hljs-string">'none:none'</span>),
        <span class="hljs-string">'X-Requested-With'</span>: <span class="hljs-string">'XMLHttpRequest'</span><font></font>
      }<font></font>
    }).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
      <span class="hljs-built_in">window</span>.location.assign(url);<font></font>
    }).catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-built_in">console</span>.error(err));<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir stellen eine Abrufanforderung an Seite 401 mit offensichtlich falschem Benutzernamen / Passwort, wir erhalten eine 401-Antwort vom Server, der Browser leert seinen Cache. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WICHTIG! </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Server sollte KEINEN </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WWW-Authenticate-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Header zur√ºckgeben </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Andernfalls √ºbernimmt der Browser die Kontrolle und Weiterleitungen von Seite 401 werden niemals stattfinden. </font><font style="vertical-align: inherit;">Konventionell sollte der Server diesen Header nicht zur√ºckgeben, wenn </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">X-Requested-With: XMLHttpRequest</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in der Anforderung angegeben ist </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Daher wurde der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anforderung</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> der </font><i><font style="vertical-align: inherit;">X-Requested-With-</font></i><font style="vertical-align: inherit;"> Header hinzugef√ºgt </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Safari (12)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei Safari ist die Situation genau umgekehrt: XMLHttpRequest funktioniert, aber das Abrufen funktioniert nicht</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">const</span> xhr = <span class="hljs-keyword">new</span> XMLHttpRequest();<font></font>
    xhr.open(<span class="hljs-string">"GET"</span>, url401, <span class="hljs-literal">true</span>, <span class="hljs-string">'none'</span>, <span class="hljs-string">'none'</span>);<font></font>
    xhr.setRequestHeader(<span class="hljs-string">'X-Requested-With'</span>, <span class="hljs-string">'XMLHttpRequest'</span>);<font></font>
    xhr.onerror = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>{
      <span class="hljs-built_in">console</span>.error(err);<font></font>
    };<font></font>
    xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-built_in">window</span>.location.assign(url);<font></font>
    };<font></font>
    xhr.send()<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Aktionen sind die gleichen wie in Chrome, nur √ºber XMLHttpRequest. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sollte f√ºr Versionen von Safari 6+ funktionieren. </font><font style="vertical-align: inherit;">Fr√ºhere Versionen hatten ihre eigenen Fehler. </font><font style="vertical-align: inherit;">Insbesondere in Versionen ab 5.1 hat der Browser beispielsweise bei jeder Weiterleitung die Autorisierung zwangsweise erneut angefordert, weshalb die Autorisierung mit Umleitung auf die letzte Seite im Prinzip nicht funktioniert hat. </font><font style="vertical-align: inherit;">In Versionen vor 5.0 funktionierte die Protokollierung nicht.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de488376/index.html">Wenn das Prinzip "zur H√∂lle mit allem, nimm es und mach es!" funktioniert nicht: Zaudernotizen</a></li>
<li><a href="../de488378/index.html">Kurz √ºber die Benennung in JS</a></li>
<li><a href="../de488380/index.html">Der einfachste Start in STM durch "einen Ort"</a></li>
<li><a href="../de488382/index.html">Ich f√ºge Websites, die ich besuche, eine Verz√∂gerung von 3 bis 25 Sekunden hinzu</a></li>
<li><a href="../de488386/index.html">F√§lle f√ºr die Anwendung von Tools zur Analyse von Netzwerkanomalien: Angriffe √ºber Browser-Plug-Ins</a></li>
<li><a href="../de488390/index.html">So machen Sie mit OpenId Connect Telegramm-Bot-Freunde</a></li>
<li><a href="../de488392/index.html">Produktionsbereite Bilder f√ºr k8s</a></li>
<li><a href="../de488404/index.html">Spiele, auf die es sich zu warten lohnt, im Jahr 2020</a></li>
<li><a href="../de488406/index.html">IPv6 - Sie machen es falsch</a></li>
<li><a href="../de488408/index.html">STM32 Ethernet-RS485 IoT Gateway</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>