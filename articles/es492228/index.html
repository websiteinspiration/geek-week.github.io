<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎾 🤰🏿 🤘🏿 Como Sports.ru escribió su editor WYSIWYG 👨🏿‍🚒 🚩 🦊</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A mediados de 2018, Sports.ru pensó en pasar a un nuevo editor de texto WYSIWYG para las publicaciones de los usuarios. Desde junio de 2019, el editor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Como Sports.ru escribió su editor WYSIWYG</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sports_ru/blog/492228/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A mediados de 2018, Sports.ru pensó en pasar a un nuevo </font></font><abbr title="Lo que ves, es lo que tienes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">editor de</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> texto </font><abbr title="Lo que ves, es lo que tienes"><font style="vertical-align: inherit;">WYSIWYG</font></abbr><font style="vertical-align: inherit;"> para las publicaciones de los usuarios. </font><font style="vertical-align: inherit;">Desde junio de 2019, el editor ha estado en modo beta. </font><font style="vertical-align: inherit;">Durante este tiempo, resolvimos muchos problemas asociados tanto con el diseño de la arquitectura de todo el servicio como con la implementación del editor en el navegador basado en la biblioteca </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ProseMirror</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , y decidimos compartir nuestra experiencia.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wc/2p/ag/wc2pagubhgtlo-bvev4wjyfmrsk.png"><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tabla de contenido</font></font></h1><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Introducción </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1. </font><font style="vertical-align: inherit;">¿Por qué necesitabas WYSIWYG </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.2? </font><font style="vertical-align: inherit;">Descripción de la tarea que enfrentaron los desarrolladores </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Cómo elegir la herramienta </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Qué sucedió </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1. </font><font style="vertical-align: inherit;">Arquitectura de servicio </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2. </font><font style="vertical-align: inherit;">Cuáles son los desafíos </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Resultados de la prueba beta</font></font></a><br>
<br>
<a name="Intro"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Introducción</font></font></h2><br>
<a name="Why"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1. </font><font style="vertical-align: inherit;">¿Por qué necesitabas WYSIWYG?</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sports.ru</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es un medio sobre deportes con una audiencia de 20 millones de usuarios por mes. Nuestras principales diferencias con los medios clásicos son la comunidad y </font></font><abbr title="Contenido generado por el usuario"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UGC</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . El contenido del usuario (calificaciones, comentarios, chats, publicaciones) no solo complementa el valor editorial, sino que también crea una plataforma para que los usuarios interactúen entre sí. Cada mes, nuestros usuarios escriben casi 10 mil publicaciones. Los mejores de ellos se envían a la página principal del sitio junto con los editoriales, enviados a aplicaciones móviles, redes sociales. El contenido del usuario representa aproximadamente el 40% de todas las lecturas en las páginas de Sports.ru. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Queremos ser la plataforma más conveniente para los autores deportivos, para ayudar a crear contenido y entregarlo a un público interesado. 10 años utilizamos el editor </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TinyMCE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- y al final quedó obsoleto, dejó de adaptarse tanto al equipo como a los usuarios que estaban acostumbrados a los editores modernos. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ff/ub/ig/ffubigpbednsp8phz7btg-icbm8.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. </font><font style="vertical-align: inherit;">1. La interfaz del antiguo editor basado en TinyMCE</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
De los autores de blogs recibidos regularmente sobre las siguientes quejas:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escribí durante mucho tiempo, luego accidentalmente cerré la pestaña y todo desapareció;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">escribir textos largos es muy inconveniente;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es molesto que para insertar cada imagen, primero debe cargarla en el alojamiento de imágenes.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El equipo también tenía sus propias quejas:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en TinyMCE no puede cargar imágenes directamente desde un archivo, solo puede adjuntar enlaces a imágenes, y debido a que los usuarios no pudieron cargar imágenes a nuestro almacenamiento, si los enlaces a ellos murieron, no podríamos hacer nada al respecto;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las posibilidades de editar y formatear el texto no están equilibradas. </font><font style="vertical-align: inherit;">Por un lado, no había suficientes estilos, por ejemplo, para encabezados internos en el texto. </font><font style="vertical-align: inherit;">Por otro lado, fue posible utilizar las herramientas disponibles en cualquier combinación. </font><font style="vertical-align: inherit;">Como resultado, las publicaciones no parecían uniformes (en Sports.ru, se comenzó a trabajar en la implementación del sistema de diseño y las publicaciones de los usuarios deberían verse de acuerdo con él);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el contenido se crea y almacena en HTML, por lo que es difícil administrar estilos en publicaciones en diferentes clientes, y solo hacer cambios en el diseño de las publicaciones.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuación hay una historia sobre cómo resolvimos el problema de crear un nuevo editor en el lado frontal. </font><font style="vertical-align: inherit;">Es cierto que también habrá algo sobre el producto, el diseño y las partes del backend, porque sin esto será difícil entender por qué se tomó una decisión particular en el front-end.</font></font><br>
<br>
<a name="Task"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.2. </font><font style="vertical-align: inherit;">Descripción de la tarea que enfrentan los desarrolladores.</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En resumen, la tesis de la que inicialmente nos basamos: bloguear en Sports.ru es un fastidio. </font><font style="vertical-align: inherit;">En principio, sería posible no crear un nuevo editor, sino simplemente agregar el autoguardado y la capacidad de cargar imágenes en su propio almacenamiento, y la mayoría de las quejas de los usuarios y empleados desaparecerían. </font><font style="vertical-align: inherit;">Pero todavía quería no apoyar la herramienta en tecnologías antiguas, sino crear un nuevo editor moderno que podamos desarrollar y escalar fácilmente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Además de la interfaz inconveniente, uno de los principales problemas técnicos del antiguo editor era que el contenido de la publicación se guardaba inmediatamente como una cadena HTML, y los cambios en la apariencia de la publicación requerían la intervención de desarrolladores de back-end o se implementaban en tiempo de ejecución en el cliente (por ejemplo, la colocación de bloques de anuncios). en el cuerpo del post). Nuestra tarea, entre otras cosas, era separar los datos de su presentación y, en consecuencia, dejar el diseño y la interfaz en el código del cliente, y trabajar con los datos en el código del servidor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como modelo a seguir, tomamos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Medium</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , a veces espiando ideas de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google Doc</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Además de resolver los problemas ya identificados, decidimos agregar varias características nuevas que harían más cómodo el uso del editor:</font></font><br>
<br>
<ul>
<li>  WYSIWYG, .. what you see is what you get (. « ,   »,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>),           ,     .     ,      ;</li>
<li>  (      ,       ,      ,   ,    ; ,           )     .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al mismo tiempo, el editor mismo no debería haber estado vinculado a las características de Sports.ru, porque Sports.ru, aunque es el proyecto principal de nuestra empresa, todavía no es el único. La compañía también está desarrollando los medios deportivos internacionales </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tribuna</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , una red social para los entusiastas de las apuestas Betting </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Insider</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , y recientemente lanzó su propio estudio de producción dedicado a proyectos publicitarios. Desarrollar un editor en línea es lo suficientemente costoso como para no querer reutilizar este código en otro sitio con diferentes tipos de letra y estilos, con su propio conjunto de herramientas para editar y formatear.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tenemos mucho contenido de texto, y antes de comenzar a trabajar en la creación de un nuevo editor de publicaciones, pensamos en cómo debería almacenarse este contenido. TinyMCE no nos dio una opción y el contenido tuvo que almacenarse solo en HTML, que, como se mencionó anteriormente, no era adecuado para el equipo. Como resultado, se nos ocurrió nuestro propio formato para almacenar datos de texto que cumplen con nuestros requisitos, y lo llamamos cuerpo estructurado.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El cuerpo estructurado es una matriz de objetos que refleja la estructura del contenido. En este caso, el contenido se divide en elementos que son bloques independientes, por ejemplo, párrafo, lista, imagen. Un elemento almacena información sobre qué tipo es y qué propiedades tiene. Por ejemplo, el bloque de subtítulos describe el título en el texto, debe contener el texto y los campos de nivel. En consecuencia, el texto contiene el texto de este encabezado y el nivel contiene el nivel (del 1 al 4). Un cuerpo estructurado, que consta de un encabezado de segundo nivel, podría verse, por ejemplo, así:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> structuredBody = [<font></font>
    {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="hljs-attr">type</span>: <span class="hljs-string">'subtitle'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="hljs-attr">value</span>: {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    <span class="hljs-attr">text</span>: <span class="hljs-string">'    '</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="hljs-attr">level</span>: <span class="hljs-number">2</span>,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  },<font></font>
    },<font></font>
];<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La transición al cuerpo estructurado nos permitió comenzar el proceso de separación de la lógica empresarial, los datos y su presentación. En última instancia, queremos que el servidor y los clientes intercambien solo datos. Y cómo y por qué mostrar estos datos al usuario final, cada cliente determinará de forma independiente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El contenido en el formato de cuerpo formatd se almacena en JSON, y para validar su contenido, creamos un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esquema JSON</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> llamado esquema de cuerpo estructurado. Este diagrama describe todos los elementos válidos y sus propiedades. Por lo tanto, podemos estar seguros de que donde sea que se necesite un cuerpo estructurado, se usa un conjunto de claves y valores.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Además, permite que diferentes equipos usen los mismos servicios para procesar contenido en este formato. Por ejemplo, un servicio para generar HTML a partir de un cuerpo estructurado para mostrar contenido o un editor para crear contenido. Esto reduce significativamente el costo de desarrollar y soportar todo el núcleo de servicios relacionados con la creación y visualización de contenido.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se supuso que el nuevo editor debería aceptar contenido de entrada y salida exclusivamente en el formato de cuerpo estructurado. Y aquí era necesario tener en cuenta el punto sutil: dado que anteriormente las publicaciones se guardaron inmediatamente en HTML, esta cadena HTML de la base de datos se transmitió al cliente para su visualización (en adelante, por el cliente nos referimos solo al navegador, a menos que se especifique lo contrario). Ahora queremos almacenar el contenido de todas las publicaciones en el cuerpo estructurado, pero los clientes solo pueden procesar HTML. Entonces, junto con la tarea de pasar a un nuevo editor, la tarea de implementar una nueva forma para que los clientes muestren publicaciones para leer directamente desde un cuerpo estructurado continúa simultáneamente. Decidimos que es mejor comer un elefante poco a poco, por lo que primero debe abandonar TinyMCE por completo, y solo entonces asumir la lógica de mostrar publicaciones para leer. Además,no todas las publicaciones antiguas lograron traducir el contenido a un nuevo formato, lo que significa que estas publicaciones siempre se almacenarán solo en HTML y es necesario que también conserven la capacidad de leer.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Total: parte de las publicaciones (todas las nuevas y antiguas que se transfirieron correctamente al nuevo formato) se almacenarán en dos formatos: HTML y cuerpo estructurado, hasta que se implemente la nueva lógica de visualización para la lectura, y el resto (la mayoría de las antiguas y muy antiguas) publicaciones) solo permanecerá en HTML.</font></font><br>
<br>
<a name="How"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Cómo elegir una herramienta</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tuvimos que darnos cuenta de la capacidad de editar y crear una publicación en el cliente, teniendo en cuenta las características y limitaciones anteriores. Como siempre, puede tomar una solución preparada, o puede encontrar la suya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para empezar, examinamos qué bibliotecas ya están preparadas para crear editores WYSIWYG y si son adecuadas para nosotros. Nos decidimos por </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Slate</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Draft.js</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ProseMirror</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Además de almacenar contenido en una estructura de datos, el momento crítico para nosotros también fue la capacidad de trabajar con Vue o JS puro, porque ya habíamos comenzado a mover el sitio a una nueva pila tecnológica usando Vue + Vuex. Además, me gustaría ampliar las capacidades de la biblioteca terminada con la ayuda de nuevos módulos (de terceros o autoescritos) si es necesario.</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lengüeta. </font><font style="vertical-align: inherit;">1. Comparación de las bibliotecas revisadas por los parámetros más importantes para Sports.ru</font></font></i><br>
<img src="https://habrastorage.org/webt/fw/hf/xa/fwhfxa6ozwkyfdpdj8t6j5lcbuy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Como puede ver en la tabla, ProseMirror cumplió completamente con nuestros requisitos, por lo tanto, ya no consideramos la idea de escribir nuestra propia biblioteca para editar contenido de texto, pero comenzamos a estudiar esta biblioteca con más detalle. </font><font style="vertical-align: inherit;">Todavía hay una </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pluma</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bastante popular </font><font style="vertical-align: inherit;">, que no entró en nuestra comparación solo porque honestamente lo olvidamos en la etapa de selección de una herramienta. </font><font style="vertical-align: inherit;">De acuerdo con nuestros requisitos clave, también pasa, pero sucedió. </font><font style="vertical-align: inherit;">Ya hablamos sobre qué es ProseMirror y cómo trabajar con él en otro </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">artículo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<a name="What"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Que paso</font></font></h2><br>
<a name="Architecture"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1. </font><font style="vertical-align: inherit;">Arquitectura de servicio</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El editor de contenido en el cliente está lejos de ser todo. </font><font style="vertical-align: inherit;">Debe colocar el editor en un proyecto existente, mostrarlo en algún lugar de la página web y también considerar la interacción con el backend, resolver el problema de admitir simultáneamente dos editores (no puede abandonar inmediatamente el anterior) y almacenar el contenido en dos formatos (HTML y estructurado cuerpo). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todas estas tareas se pueden dividir en aquellas relacionadas con el frontend, el backend y su integración. </font><font style="vertical-align: inherit;">Nos interesan principalmente los problemas de front-end y de integración, aunque también mencionamos algunos aspectos importantes de las tareas de back-end. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los servicios frontend para el editor se pueden dividir en varios niveles:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">página web para crear y editar una publicación;</font></font></li>
<li>Vue-app,    .  ,  ,   Vue,         -, , , ,       ..,    ,         ,      ;</li>
<li>WYSIWYG-   ProseMirror,      Vue.      ,   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a>;</li>
<li>SB2HTML –    HTML  structured body,    .    , structured body –       ,    .      ,   ,     ,      .    Sports.ru     HTML  structured body,  -     HTML  .       HTML    Node.Js,        JS-   .<br>
</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El proceso de guardar la publicación se muestra en la Fig. </font><font style="vertical-align: inherit;">2. El contenido de la publicación en el formato del cuerpo estructurado y sus metadatos se transfieren al backend. </font><font style="vertical-align: inherit;">El servidor envía contenido al servicio SB2HTML, recibe HTML listo en la respuesta, pone todo esto en la base de datos y le dice al cliente que la publicación se ha guardado correctamente o informa un error. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/of/fp/j8/offpj883_eq2swjl-ogb6jxprks.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. </font><font style="vertical-align: inherit;">2. Esquema para guardar una publicación al crear o editar en un editor WYSIWYG</font></font></i><br>
<br>
<a name="Difficulties"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2. </font><font style="vertical-align: inherit;">¿Qué dificultades enfrentaste?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hubo muchas dificultades, surgieron constantemente y con frecuencia en los momentos más inesperados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como ya dijimos, el editor de contenido se encuentra dentro del formulario, lo que le permite ingresar datos adicionales necesarios para crear una publicación, como título, anotación, etc. Como anotación, debería ser posible descargar imágenes de un archivo y a través de un enlace de Internet. Pero para el contenido también queremos cargar imágenes de un archivo y, por referencia, además, de acuerdo con las mismas reglas. Y aquí nos enfrentamos a un dilema: por un lado, el contenido de una publicación está aislado del formulario externo durante la edición y es atendido por ProseMirror, pero por otro lado, quiero observar el principio </font></font><abbr title="No te repitas"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DRY</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y no duplique el mismo código. Resolvimos esto de la siguiente manera: describimos la carga de imágenes como un conjunto de métodos en un objeto en el nivel de formulario Vue y pasamos este objeto como uno de los parámetros al constructor del editor WYSIWYG.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las entidades que describen el contenido (Nodo y Fragmento) se definen en el modelo ProseMirror. Sin embargo, solo se utilizan índices para una transacción para determinar el rango de caracteres a los que se aplica esta transacción (los índices se cuentan tanto desde el principio del documento como desde el principio del nodo principal). La indexación de caracteres es uno de los conceptos centrales de ProseMirror, pero al editar y formatear texto es mucho más conveniente pensar en entidades del modelo ProseMirror. Como resultado, para un trabajo cómodo con el contenido, escribimos nuestros ayudantes para simplificar la interacción con un documento para transacciones. Después del comienzo de nuestro trabajo, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apareció la</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> biblioteca de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">tiptap</font></a><font style="vertical-align: inherit;"> , que es un conjunto de ayudantes similares.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El siguiente problema fue que en la etapa de creación del esquema, nos dimos cuenta de que ya tenemos un formato interno aprobado para almacenar contenido, un cuerpo estructurado que satisface nuestras necesidades, y ProseMirror almacena el contenido en su propio formato en una historia. Cambiar al formato ProseMirror fue difícil y poco práctico. Nos encontramos en una situación en la que los datos en un formato llegan al cliente a través de la API, y es necesario mostrar otro. Una situación similar surge cuando es necesario guardar contenido modificado o creado. Para hacer esto, implementamos un convertidor que convierte formatos de un lado a otro. Escribieron una prueba simple para él, que toma el contenido de una publicación en formato de cuerpo formateado, lo traduce al formato ProseMirror, luego lo compara y compara la versión original con la recibida. Resultó rápida y fácilmente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Más tarde, a medida que el esquema del documento cambió y, como regla, se volvió más complicado, quedó claro que el más mínimo cambio podría conducir a errores en el editor, y tal prueba parece dar una cobertura muy pobre. Como resultado, tuve que escribir pruebas en casi todas las combinaciones de nodos y marcas en dos pequeños métodos de conversión. Ahora, sin estas pruebas, es imposible determinar si el próximo cambio en el circuito romperá algo o no.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El siguiente problema está nuevamente relacionado con la necesidad de compatibilidad con las tecnologías antiguas y nuevas. Nuestro editor WYSIWYG se implementa solo en navegadores (escritorio y, pronto, móvil). En consecuencia, para editar contenido en el cliente se da en JSON en el cuerpo estructurado de formato, sin embargo, la lectura de publicaciones en navegadores se realiza solo desde HTML. Al mismo tiempo, la mayoría de las aplicaciones móviles ya han cambiado para mostrar las publicaciones de los usuarios directamente desde el cuerpo estructurado.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para las aplicaciones móviles, era necesario prever el caso cuando el cliente no puede procesar algún elemento del cuerpo estructurado. Por ejemplo, si se agrega un nuevo elemento al cuerpo estructurado, cuya visualización se implementa solo en una versión más reciente de la aplicación. Como no todos los usuarios actualizan sus aplicaciones al mismo tiempo, era necesario proporcionar un plan "B" para versiones anteriores: en lugar de crear HTML a partir de un cuerpo estructurado, inserte un fragmento HTML listo para el elemento deseado. La presencia de fragmentos HTML para cada elemento no se proporcionó en el esquema del cuerpo estructurado, porque la idea misma de esta estructura era negarse a almacenar datos en HTML. Pero al final, llegamos a la conclusión de que necesitamos dos esquemas de cuerpo estructurados: uno para mostrar y otro para editar. Las diferencias entre los esquemas sonque el cuerpo estructurado para editar contiene solo el contenido del artículo, y para mostrarlo agregamos algunos elementos adicionales. En particular, se crea un fragmento HTML para cada elemento cuando se guarda una publicación en el servicio SB2HTML y se agrega solo al cuerpo estructurado para mostrar la publicación. Además, el cuerpo estructurado también muestra espacio publicitario en el contenido para su visualización.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando abrimos contenido para editarlo en un navegador, básicamente no podemos encontrar un elemento desconocido, porque todas las publicaciones se crean y se muestran de la misma manera. Pero decidieron prever tal caso para el futuro también. Para hacer esto, agregamos un elemento de código auxiliar predeterminado al esquema ProseMirror. Llamamos a este elemento sin soporteBlock. El trozo aparece en lugar de un elemento no admitido. Lo estilizamos como un rectángulo gris con texto que indica que este elemento no es compatible y no se puede editar. Cuando se guarda una publicación, dicho elemento permanece sin cambios en el cuerpo estructurado. El usuario puede cambiar su ubicación en relación con otros elementos, pero el contenido interno de un elemento desconocido no se puede cambiar ni editar. Sin embargo, el usuario puede eliminar dicho elemento, luego, por supuesto,no se guardará en el documento final.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos los problemas descritos estaban relacionados con las dificultades de implementar el editor WYSIWYG. Pero mientras existía en modo beta, no pudimos abandonar el antiguo editor en TinyMCE y nos vimos obligados a admitir ambos editores, proporcionando compatibilidad hacia atrás entre ellos. Por ejemplo, puede crear una publicación en el editor WYSIWYG, guardarla, luego editarla en TinyMCE, guardarla, abrirla nuevamente en WYSIWYG, etc. Como resultado, al abrir en WYSIWYG, vimos el mismo contenido que en el guardado anterior en TinyMCE. Para implementar la compatibilidad con versiones anteriores, era necesario enviar contenido HTML a TinyMCE, que ya aprendimos a crear desde un cuerpo estructurado y guardar en la base de datos mientras guardaba la publicación. Y al guardar una publicación a través de TinyMCE, el contenido creado en el servidor se ejecuta a través del servicio HTML2SB,Como resultado, podemos guardar tanto HTML fresco como cuerpo estructurado.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HTML2SB es lo opuesto a lo que SB2HTML hace, es decir, convierte contenido de HTML a cuerpo estructurado. </font><font style="vertical-align: inherit;">Cronológicamente, este servicio apareció antes que cualquier otra cosa, porque antes de la creación del editor WYSIWYG, la única forma de publicar contenido en formato de cuerpo estructurado era el análisis directo desde HTML. </font><font style="vertical-align: inherit;">HTML2SB era parte de la infraestructura de back-end alrededor del editor de publicaciones, pero después de abandonar TinyMCE, ya no era necesario.</font></font><br>
<br>
<a name="Results"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Resultados Beta</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora el editor WYSIWYG está disponible para todos los usuarios en versión beta, y pronto se convertirá en el editor principal de las publicaciones de Sports.ru. </font><font style="vertical-align: inherit;">Ya hemos recibido una herramienta para crear y editar publicaciones que cumple con la mayoría de nuestros requisitos:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la interfaz del editor se ha vuelto clara, concisa y moderna, escribir publicaciones largas se ha vuelto mucho más fácil;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ahora puede descargar imágenes de un archivo y mediante un enlace que se colocan inmediatamente en nuestro repositorio;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se agregó la opción de incrustar incrustaciones de las principales redes sociales y sitios de alojamiento de videos;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">limpiado estilos de formato de texto;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las aplicaciones móviles ya han pasado a mostrar publicaciones desde un cuerpo estructurado y pueden establecer sus propios estilos para el contenido.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por supuesto, el editor aún no está completamente depurado, detectamos periódicamente nuevos errores. </font><font style="vertical-align: inherit;">Vienen las siguientes actualizaciones:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">guardado automático</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Versión WYSIWYG para usuarios con derechos extendidos (administradores, editores de tiempo completo);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">crear y editar publicaciones desde navegadores móviles;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mensajes sobre la edición paralela de un documento por varios usuarios;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consejos e incorporación;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">widgets estadísticos para equipos deportivos, partidos y alineaciones.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el momento de escribir este artículo, ya se han publicado más de 13,000 publicaciones a través de la versión beta del editor, que es aproximadamente el 20% del número total de textos de usuarios en Sports.ru para el período comprendido entre junio de 2019 y febrero de 2020 inclusive. La proporción de publicaciones creadas y publicadas a través del nuevo editor está creciendo constantemente. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ad/2i/4b/ad2i4b4dubgv9--l-vl7ghh6cnw.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 3. La proporción de publicaciones de usuarios creadas y publicadas en el nuevo editor</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parece que el crecimiento orgánico en la proporción de publicaciones de usuarios creadas y publicadas a través del nuevo editor es una señal de que los usuarios están contentos con la actualización, que también se confirma mediante comentarios en el anuncio de su lanzamiento en las pruebas beta (algunas de ellas se muestran en la Fig.4). </font><font style="vertical-align: inherit;">Por lo tanto, en los próximos meses planeamos transferir completamente la creación de publicaciones al nuevo editor, para centrarnos solo en su soporte y desarrollo.&nbsp;</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por cierto, ¿qué funcionalidad agregarías a nuestro editor WYSIWYG? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/k-/bm/nz/k-bmnzzgoh5wi-nvq516-pca8uk.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. </font><font style="vertical-align: inherit;">4. Comentarios del usuario en una publicación con el anuncio de la actualización del editor WYSIWYG&nbsp;</font></font></i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es492216/index.html">Guardar valores en la aplicación .Net en la fase de construcción</a></li>
<li><a href="../es492218/index.html">Reglas de diseño de iconos para recordar</a></li>
<li><a href="../es492220/index.html">5 secretos poco conocidos de los pandas</a></li>
<li><a href="../es492222/index.html">Calificaciones CTFZone 2019: Pollo</a></li>
<li><a href="../es492226/index.html">Comparación de precios en Kubernetes gestionados (2020)</a></li>
<li><a href="../es492232/index.html">Cómo Smartcalls se convirtió en Voximplant Kit - características de cambio de marca y asesino</a></li>
<li><a href="../es492234/index.html">Investigación: por qué las personas están listas para recibir menos en proyectos sociales</a></li>
<li><a href="../es492242/index.html">M5Stack y sus contactos</a></li>
<li><a href="../es492244/index.html">Remoción por el período de coronavirus: ¿arresto domiciliario o tiempo de oportunidad?</a></li>
<li><a href="../es492246/index.html">Coronavirus: posibles implicaciones para la sociedad, la economía y la medicina</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>