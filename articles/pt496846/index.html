<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïØÔ∏è üë® üí¨ Mec√¢nica da linguagem de pilhas e ponteiros „Ä∞Ô∏è üë©üèª‚Äçü§ù‚Äçüë®üèº üåßÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Prel√∫dio
 Este √© o primeiro dos quatro artigos da s√©rie que fornecer√° informa√ß√µes sobre a mec√¢nica e o design de ponteiros, pilhas, pilhas, an√°lise de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Mec√¢nica da linguagem de pilhas e ponteiros</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/496846/"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prel√∫dio</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este √© o primeiro dos quatro artigos da s√©rie que fornecer√° informa√ß√µes sobre a mec√¢nica e o design de ponteiros, pilhas, pilhas, an√°lise de escape e sem√¢ntica de Go / ponteiro. </font><font style="vertical-align: inherit;">Este post √© sobre pilhas e indicadores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√çndice:</font></font><br>
<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mec√¢nica da linguagem em pilhas e ponteiros</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mec√¢nica da linguagem na an√°lise de escape</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tradu√ß√£o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mec√¢nica da linguagem no perfil de mem√≥ria</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Filosofia de Design em Dados e Sem√¢ntica</font></font></a></li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introdu√ß√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o vou dissimular - os ponteiros s√£o dif√≠ceis de entender. </font><font style="vertical-align: inherit;">Se usados ‚Äã‚Äãincorretamente, os ponteiros podem causar erros desagrad√°veis ‚Äã‚Äãe at√© problemas de desempenho. </font><font style="vertical-align: inherit;">Isto √© especialmente verdade ao escrever programas competitivos ou multithread. </font><font style="vertical-align: inherit;">N√£o √© de surpreender que muitas linguagens tentem ocultar indicadores de programadores. </font><font style="vertical-align: inherit;">No entanto, se voc√™ escrever no Go, n√£o poder√° escapar dos ponteiros. </font><font style="vertical-align: inherit;">Sem uma compreens√£o clara dos ponteiros, ser√° dif√≠cil escrever c√≥digo limpo, simples e eficiente.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bordas do quadro</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As fun√ß√µes s√£o executadas dentro dos limites dos quadros que fornecem um espa√ßo de mem√≥ria separado para cada fun√ß√£o correspondente. Cada quadro permite que a fun√ß√£o funcione em seu pr√≥prio contexto e tamb√©m fornece controle de fluxo. Uma fun√ß√£o tem acesso direto √† mem√≥ria dentro de seu quadro por meio de um ponteiro, mas o acesso √† mem√≥ria fora do quadro requer acesso indireto. Para uma fun√ß√£o acessar a mem√≥ria fora de seu quadro, essa mem√≥ria deve ser usada em conjunto com esta fun√ß√£o. A mec√¢nica e as limita√ß√µes estabelecidas por esses limites devem ser entendidas e estudadas primeiro.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando uma fun√ß√£o √© chamada, ocorre uma transi√ß√£o entre dois quadros. O c√≥digo vai do quadro da fun√ß√£o de chamada para o quadro da fun√ß√£o chamada. Se os dados forem necess√°rios para chamar a fun√ß√£o, esses dados dever√£o ser transferidos de um quadro para outro. A transfer√™ncia de dados entre dois quadros no Go √© feita "por valor". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A vantagem da transmiss√£o de dados "por valor" √© a legibilidade. O valor que voc√™ v√™ na chamada de fun√ß√£o √© o que √© copiado e aceito no outro lado. √â por isso que associo "passar por valor" a WYSIWYG, porque o que voc√™ v√™ √© o que recebe. Tudo isso permite que voc√™ escreva um c√≥digo que n√£o oculte o custo de alternar entre duas fun√ß√µes. Isso ajuda a manter um bom modelo mental de como cada chamada de fun√ß√£o afetar√° o programa durante a transi√ß√£o.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veja este pequeno programa que chama uma fun√ß√£o passando dados inteiros "por valor": </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listagem 1:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-number">01</span> <span class="hljs-keyword">package</span> main
<span class="hljs-number">02</span>
<span class="hljs-number">03</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
<span class="hljs-number">04</span>
<span class="hljs-number">05</span>    <span class="hljs-comment">// Declare variable of type int with a value of 10.</span>
<span class="hljs-number">06</span>    count := <span class="hljs-number">10</span>
<span class="hljs-number">07</span>
<span class="hljs-number">08</span>    <span class="hljs-comment">// Display the "value of" and "address of" count.</span>
<span class="hljs-number">09</span>    <span class="hljs-built_in">println</span>(<span class="hljs-string">"count:\tValue Of["</span>, count, <span class="hljs-string">"]\tAddr Of["</span>, &amp;count, <span class="hljs-string">"]"</span>)
<span class="hljs-number">10</span>
<span class="hljs-number">11</span>    <span class="hljs-comment">// Pass the "value of" the count.</span>
<span class="hljs-number">12</span>    increment(count)
<span class="hljs-number">13</span>
<span class="hljs-number">14</span>    <span class="hljs-built_in">println</span>(<span class="hljs-string">"count:\tValue Of["</span>, count, <span class="hljs-string">"]\tAddr Of["</span>, &amp;count, <span class="hljs-string">"]"</span>)
<span class="hljs-number">15</span> }
<span class="hljs-number">16</span>
<span class="hljs-number">17</span> <span class="hljs-comment">//go:noinline</span>
<span class="hljs-number">18</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">increment</span><span class="hljs-params">(inc <span class="hljs-keyword">int</span>)</span></span> {
<span class="hljs-number">19</span>
<span class="hljs-number">20</span>    <span class="hljs-comment">// Increment the "value of" inc.</span>
<span class="hljs-number">21</span>    inc++
<span class="hljs-number">22</span>    <span class="hljs-built_in">println</span>(<span class="hljs-string">"inc:\tValue Of["</span>, inc, <span class="hljs-string">"]\tAddr Of["</span>, &amp;inc, <span class="hljs-string">"]"</span>)
<span class="hljs-number">23</span> }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando o programa Go √© iniciado, o tempo de execu√ß√£o cria a goroutine principal para come√ßar a executar todo o c√≥digo, incluindo o c√≥digo dentro da fun√ß√£o principal. Gorutin √© o caminho de execu√ß√£o que se encaixa no encadeamento do sistema operacional, que finalmente roda em algum kernel. A partir da vers√£o 1.8, cada goroutine √© fornecida com um bloco inicial de mem√≥ria cont√≠nua de 2048 bytes de tamanho, que forma o espa√ßo da pilha. Esse tamanho inicial da pilha mudou ao longo dos anos e pode mudar no futuro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A pilha √© importante porque fornece espa√ßo de mem√≥ria f√≠sica para os limites do quadro que s√£o atribu√≠dos a cada fun√ß√£o individual. No momento em que a goroutine principal executa a fun√ß√£o principal na Listagem 1, a pilha de programas (em um n√≠vel muito alto) ter√° a seguinte apar√™ncia: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Figura 1:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/z4/7w/l0/z47wl0tm16nh5u-gf8u9m0kemba.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na Figura 1, voc√™ pode ver que parte da pilha foi "emoldurada" para a fun√ß√£o principal. </font><font style="vertical-align: inherit;">Esta se√ß√£o √© chamada de " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quadro de pilha</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " e √© esse quadro que denota o limite da fun√ß√£o principal na pilha. </font><font style="vertical-align: inherit;">O quadro √© definido como parte do c√≥digo que √© executado quando a fun√ß√£o √© chamada. </font><font style="vertical-align: inherit;">Voc√™ tamb√©m pode ver que a mem√≥ria da vari√°vel count foi alocada em 0x10429fa4 dentro do quadro para main. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° outro ponto interessante, ilustrado na Figura 1. Toda a mem√≥ria da pilha sob o quadro ativo n√£o √© v√°lida, mas a mem√≥ria do quadro ativo e acima √© v√°lida. </font><font style="vertical-align: inherit;">Voc√™ precisa entender claramente o limite entre a parte v√°lida e inv√°lida da pilha.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Endere√ßos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As vari√°veis ‚Äã‚Äãs√£o usadas para atribuir um nome a uma c√©lula de mem√≥ria espec√≠fica para melhorar a legibilidade do c√≥digo e ajud√°-lo a entender com quais dados voc√™ est√° trabalhando. </font><font style="vertical-align: inherit;">Se voc√™ tiver uma vari√°vel, ter√° um valor na mem√≥ria e, se tiver um valor na mem√≥ria, ele dever√° ter um endere√ßo. </font><font style="vertical-align: inherit;">Na linha 09, a fun√ß√£o principal chama a fun√ß√£o println interna para exibir o "valor" e o "endere√ßo" da vari√°vel count. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listagem 2:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-number">09</span>    <span class="hljs-built_in">println</span>(<span class="hljs-string">"count:\tValue Of["</span>, count, <span class="hljs-string">"]\tAddr Of["</span>, &amp;count, <span class="hljs-string">"]"</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O uso do "e" comercial "&amp;" para obter o endere√ßo da localiza√ß√£o de uma vari√°vel n√£o √© novo, outros idiomas tamb√©m usam esse operador. </font><font style="vertical-align: inherit;">A sa√≠da da linha 09 deve se parecer com a sa√≠da abaixo se voc√™ estiver executando o c√≥digo em uma arquitetura de 32 bits como o Go Playground: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listagem 3:</font></font><br>
<br>
<pre><code class="go hljs">count:  Value Of[ <span class="hljs-number">10</span> ]  Addr Of[ <span class="hljs-number">0x10429fa4</span> ]</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chamada de Fun√ß√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, na linha 12, a fun√ß√£o principal chama a fun√ß√£o de incremento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listagem 4:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-number">12</span>    increment(count)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fazer uma chamada de fun√ß√£o significa que o programa deve criar uma nova se√ß√£o de mem√≥ria na pilha. No entanto, tudo √© um pouco mais complicado. Para concluir com √™xito uma chamada de fun√ß√£o, espera-se que os dados sejam transferidos atrav√©s do limite do quadro e colocados em um novo quadro durante a transi√ß√£o. Em particular, espera-se que um valor inteiro seja copiado e transmitido durante a chamada. Voc√™ pode ver esse requisito observando a declara√ß√£o da fun√ß√£o de incremento na linha 18. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listagem 5:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-number">18</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">increment</span><span class="hljs-params">(inc <span class="hljs-keyword">int</span>)</span></span> {</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ olhar novamente para a chamada da fun√ß√£o de incremento na linha 12, ver√° que o c√≥digo passa o "valor" da contagem de vari√°veis. Este valor ser√° copiado, transferido e colocado em um novo quadro para a fun√ß√£o de incremento. Lembre-se de que a fun√ß√£o de incremento s√≥ pode ler e gravar na mem√≥ria em seu pr√≥prio quadro; portanto, √© necess√°rio que a vari√°vel inc receba, armazene e acesse sua pr√≥pria c√≥pia do valor do contador transmitido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pouco antes do c√≥digo dentro da fun√ß√£o de incremento come√ßar a ser executado, a pilha do programa (em um n√≠vel muito alto) ter√° a seguinte apar√™ncia: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Figura 2:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/2g/jw/n9/2gjwn96mbhikaxys6ftv3cf4s14.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode ver que agora existem dois quadros na pilha - um para o principal e um abaixo para o incremento. </font><font style="vertical-align: inherit;">Dentro do quadro para incremento, voc√™ pode ver a vari√°vel inc contendo o valor 10, que foi copiado e passado durante a chamada de fun√ß√£o. </font><font style="vertical-align: inherit;">O endere√ßo da vari√°vel inc √© 0x10429f98 e tem menos mem√≥ria porque os quadros s√£o colocados na pilha, que s√£o apenas detalhes de implementa√ß√£o que n√£o significam nada. </font><font style="vertical-align: inherit;">O importante √© que o programa recuperou o valor da contagem do quadro para main e colocou uma c√≥pia desse valor no quadro para aumentar usando a vari√°vel inc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O restante do c√≥digo dentro do incremento √© incrementado e exibe o "valor" e o "endere√ßo" da vari√°vel inc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listagem 6:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-number">21</span>    inc++
<span class="hljs-number">22</span>    <span class="hljs-built_in">println</span>(<span class="hljs-string">"inc:\tValue Of["</span>, inc, <span class="hljs-string">"]\tAddr Of["</span>, &amp;inc, <span class="hljs-string">"]"</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A sa√≠da da linha 22 no playground deve ser algo como isto: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listagem 7:</font></font><br>
<br>
<pre><code class="go hljs">inc:    Value Of[ <span class="hljs-number">11</span> ]  Addr Of[ <span class="hljs-number">0x10429f98</span> ]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√° a apar√™ncia da pilha ap√≥s executar as mesmas linhas de c√≥digo: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Figura 3: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/59/1o/kv/591okvkseze5gjqum4k8hp-qv34.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s executar as linhas 21 e 22, a fun√ß√£o de incremento termina e retorna o controle para a fun√ß√£o principal. </font><font style="vertical-align: inherit;">Em seguida, a fun√ß√£o principal novamente exibe o "valor" e o "endere√ßo" da contagem da vari√°vel local na linha 14. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listagem 8:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-number">14</span>    <span class="hljs-built_in">println</span>(<span class="hljs-string">"count:\tValue Of["</span>,count, <span class="hljs-string">"]\tAddr Of["</span>, &amp;count, <span class="hljs-string">"]"</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A sa√≠da completa do programa no playground deve ser algo como isto: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listagem 9:</font></font><br>
<br>
<pre><code class="go hljs">count:  Value Of[ <span class="hljs-number">10</span> ]  Addr Of[ <span class="hljs-number">0x10429fa4</span> ]<font></font>
inc:    Value Of[ <span class="hljs-number">11</span> ]  Addr Of[ <span class="hljs-number">0x10429f98</span> ]<font></font>
count:  Value Of[ <span class="hljs-number">10</span> ]  Addr Of[ <span class="hljs-number">0x10429fa4</span> ]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O valor da contagem no quadro para main √© o mesmo antes e depois da chamada para incrementar.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Retorno de fun√ß√µes</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que realmente acontece com a mem√≥ria na pilha quando a fun√ß√£o sai e o controle retorna √† fun√ß√£o de chamada? A resposta curta n√£o √© nada. Aqui est√° a apar√™ncia da pilha ap√≥s o retorno da fun√ß√£o de incremento: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Figura 4: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qq/ve/-n/qqve-nygmg0jnhsnwrubpchwfky.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A pilha parece exatamente a mesma da Figura 3, exceto que o quadro associado √† fun√ß√£o de incremento agora √© considerado mem√≥ria inv√°lida. Isso ocorre porque o quadro para main agora est√° ativo. A mem√≥ria criada para a fun√ß√£o de incremento permaneceu intocada.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A limpeza do quadro de mem√≥ria da fun√ß√£o de retorno ser√° uma perda de tempo, porque n√£o se sabe se essa mem√≥ria ser√° necess√°ria novamente. </font><font style="vertical-align: inherit;">Ent√£o a mem√≥ria permaneceu do jeito que estava. </font><font style="vertical-align: inherit;">Durante cada chamada de fun√ß√£o, quando um quadro √© capturado, a mem√≥ria da pilha para esse quadro √© limpa. </font><font style="vertical-align: inherit;">Isso √© feito inicializando quaisquer valores que se ajustem ao quadro. </font><font style="vertical-align: inherit;">Como todos os valores s√£o inicializados como seu "valor zero", as pilhas s√£o limpas corretamente a cada chamada de fun√ß√£o.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Partilha de Valor</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E se fosse importante para a fun√ß√£o de incremento trabalhar diretamente com a vari√°vel count que existe dentro do quadro para main? </font><font style="vertical-align: inherit;">√â aqui que chega a hora dos ponteiros. </font><font style="vertical-align: inherit;">Os ponteiros t√™m um prop√≥sito - compartilhar um valor com uma fun√ß√£o para que a fun√ß√£o possa ler e gravar esse valor, mesmo que o valor n√£o exista diretamente dentro de seu quadro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ acha que n√£o precisa "compartilhar" o valor, n√£o precisa usar um ponteiro. </font><font style="vertical-align: inherit;">Ao aprender dicas, √© importante pensar que usando um dicion√°rio limpo, n√£o operadores ou sintaxe. </font><font style="vertical-align: inherit;">Lembre-se de que os ponteiros devem ser compartilhados e, ao ler o c√≥digo, substitua o operador &amp; pela frase "compartilhamento".</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tipos de ponteiros</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para cada tipo que voc√™ declarou ou que foi declarado diretamente pelo pr√≥prio idioma, voc√™ obt√©m um tipo de ponteiro gratuito que pode ser usado para compartilhar. J√° existe um tipo interno chamado int, portanto, existe um tipo de ponteiro chamado * int. Se voc√™ declarar um tipo chamado Usu√°rio, receber√° um tipo de ponteiro chamado * Usu√°rio gratuitamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos os tipos de ponteiros t√™m duas caracter√≠sticas id√™nticas. Primeiro, eles come√ßam com o caractere *. Em segundo lugar, todos eles t√™m o mesmo tamanho na mem√≥ria e uma representa√ß√£o ocupando 4 ou 8 bytes que representam o endere√ßo. Em arquiteturas de 32 bits (por exemplo, no playground), os ponteiros requerem 4 bytes de mem√≥ria e, em arquiteturas de 64 bits (por exemplo, no seu computador), exigem 8 bytes de mem√≥ria. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na especifica√ß√£o, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tipos de ponteiro</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s√£o considerados </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">literais de tipo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o que significa que s√£o tipos sem nome compostos de um tipo existente.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acesso indireto √† mem√≥ria</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veja este pequeno programa que faz uma chamada de fun√ß√£o, passando o endere√ßo "por valor". </font><font style="vertical-align: inherit;">Isso dividir√° a vari√°vel count do quadro da pilha principal com a fun√ß√£o de incremento: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listagem 10:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-number">01</span> <span class="hljs-keyword">package</span> main
<span class="hljs-number">02</span>
<span class="hljs-number">03</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
<span class="hljs-number">04</span>
<span class="hljs-number">05</span>    <span class="hljs-comment">// Declare variable of type int with a value of 10.</span>
<span class="hljs-number">06</span>    count := <span class="hljs-number">10</span>
<span class="hljs-number">07</span>
<span class="hljs-number">08</span>    <span class="hljs-comment">// Display the "value of" and "address of" count.</span>
<span class="hljs-number">09</span>    <span class="hljs-built_in">println</span>(<span class="hljs-string">"count:\tValue Of["</span>, count, <span class="hljs-string">"]\t\tAddr Of["</span>, &amp;count, <span class="hljs-string">"]"</span>)
<span class="hljs-number">10</span>
<span class="hljs-number">11</span>    <span class="hljs-comment">// Pass the "address of" count.</span>
<span class="hljs-number">12</span>    increment(&amp;count)
<span class="hljs-number">13</span>
<span class="hljs-number">14</span>    <span class="hljs-built_in">println</span>(<span class="hljs-string">"count:\tValue Of["</span>, count, <span class="hljs-string">"]\t\tAddr Of["</span>, &amp;count, <span class="hljs-string">"]"</span>)
<span class="hljs-number">15</span> }
<span class="hljs-number">16</span>
<span class="hljs-number">17</span> <span class="hljs-comment">//go:noinline</span>
<span class="hljs-number">18</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">increment</span><span class="hljs-params">(inc *<span class="hljs-keyword">int</span>)</span></span> {
<span class="hljs-number">19</span>
<span class="hljs-number">20</span>    <span class="hljs-comment">// Increment the "value of" count that the "pointer points to". (dereferencing)</span>
<span class="hljs-number">21</span>    *inc++
<span class="hljs-number">22</span>    <span class="hljs-built_in">println</span>(<span class="hljs-string">"inc:\tValue Of["</span>, inc, <span class="hljs-string">"]\tAddr Of["</span>, &amp;inc, <span class="hljs-string">"]\tValue Points To["</span>, *inc, <span class="hljs-string">"]"</span>)
<span class="hljs-number">23</span> }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tr√™s mudan√ßas interessantes foram feitas no programa original. </font><font style="vertical-align: inherit;">A primeira altera√ß√£o est√° na linha 12: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listagem 11:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-number">12</span>    increment(&amp;count)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desta vez, na linha 12, o c√≥digo n√£o copia e passa o "valor" para a vari√°vel count, mas passa a contagem para o seu "endere√ßo". Agora voc√™ pode dizer: "Estou compartilhando" a contagem de vari√°veis ‚Äã‚Äãcom o incremento da fun√ß√£o. √â isso que o operador &amp; diz: "compartilhar". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entenda que isso ainda est√° "passando por valor" e a √∫nica diferen√ßa √© que o valor que voc√™ passa √© o endere√ßo, n√£o o n√∫mero inteiro. Endere√ßos tamb√©m s√£o valores; √© isso que √© copiado e passado atrav√©s da borda do quadro para chamar a fun√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como o valor do endere√ßo √© copiado e passado, voc√™ precisa de uma vari√°vel dentro do quadro de incremento para obter e salvar esse endere√ßo inteiro. Uma declara√ß√£o de vari√°vel de ponteiro inteiro est√° na linha 18. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listagem 12:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-number">18</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">increment</span><span class="hljs-params">(inc *<span class="hljs-keyword">int</span>)</span></span> {</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ passou o endere√ßo do valor do tipo Usu√°rio, a vari√°vel teria que ser declarada como * Usu√°rio. Apesar de todas as vari√°veis ‚Äã‚Äãde ponteiro armazenarem valores de endere√ßo, elas n√£o podem receber nenhum endere√ßo, apenas endere√ßos associados ao tipo de ponteiro. O princ√≠pio b√°sico de compartilhamento de um valor √© que a fun√ß√£o de recebimento deve ler ou gravar nesse valor. Voc√™ precisa de informa√ß√µes sobre o tipo de qualquer valor para ler e gravar nele. O compilador garantir√° que apenas os valores associados ao tipo de ponteiro correto sejam usados ‚Äã‚Äãcom esta fun√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√° a apar√™ncia da pilha depois de chamar a fun√ß√£o de incremento: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Figura 5:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/uk/ak/zj/ukakzj1mpr_9m3thjmv2i04e_hw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A Figura 5 mostra a apar√™ncia da pilha quando a "passagem por valor" √© realizada usando o endere√ßo como valor. A vari√°vel de ponteiro dentro do quadro para a fun√ß√£o de incremento agora aponta para a vari√°vel de contagem, localizada dentro do quadro para principal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, usando a vari√°vel ponteiro, a fun√ß√£o pode executar uma opera√ß√£o de leitura e altera√ß√£o indireta para a vari√°vel count localizada dentro do quadro para main. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listagem 13:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-number">21</span>    *inc++</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desta vez, o caractere * atua como um operador e √© aplicado √† vari√°vel do ponteiro. Usar * como operador significa "o valor que o ponteiro aponta". Uma vari√°vel de ponteiro fornece acesso indireto √† mem√≥ria fora do quadro da fun√ß√£o que a utiliza. √Äs vezes, essa leitura ou escrita indireta √© chamada de desreferenciamento de ponteiro. A fun√ß√£o de incremento ainda precisa ter uma vari√°vel de ponteiro em seu quadro, que ela pode ler diretamente para executar o acesso indireto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A Figura 6 mostra a apar√™ncia da pilha ap√≥s a linha 21. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Figura 6: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rn/ph/vi/rnphvi1x69rrhspljslmvxilauq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√° a sa√≠da final deste programa: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listagem 14:</font></font><br>
<br>
<pre><code class="go hljs">count:  Value Of[ <span class="hljs-number">10</span> ]              Addr Of[ <span class="hljs-number">0x10429fa4</span> ]<font></font>
inc:    Value Of[ <span class="hljs-number">0x10429fa4</span> ]      Addr Of[ <span class="hljs-number">0x10429f98</span> ]   Value Points To[ <span class="hljs-number">11</span> ]<font></font>
count:  Value Of[ <span class="hljs-number">11</span> ]              Addr Of[ <span class="hljs-number">0x10429fa4</span> ]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode perceber que o "valor" da vari√°vel inc ponteiro corresponde ao "endere√ßo" da vari√°vel count. </font><font style="vertical-align: inherit;">Isso estabelece um relacionamento de compartilhamento que permite acesso indireto √† mem√≥ria fora do quadro. </font><font style="vertical-align: inherit;">Assim que a fun√ß√£o de incremento grava no ponteiro, a altera√ß√£o fica vis√≠vel para a fun√ß√£o principal quando o controle √© retornado a ela.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vari√°veis ‚Äã‚Äãde ponteiro n√£o s√£o especiais</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vari√°veis ‚Äã‚Äãde ponteiro n√£o s√£o especiais porque s√£o as mesmas vari√°veis ‚Äã‚Äãque qualquer outra vari√°vel. </font><font style="vertical-align: inherit;">Eles t√™m uma aloca√ß√£o de mem√≥ria e cont√™m significado. </font><font style="vertical-align: inherit;">Aconteceu que todas as vari√°veis ‚Äã‚Äãde ponteiro, independentemente do tipo de valor para o qual possam apontar, sempre t√™m o mesmo tamanho e apresenta√ß√£o. </font><font style="vertical-align: inherit;">O que pode ser confuso √© que o caractere * atua como um operador dentro do c√≥digo e √© usado para declarar um tipo de ponteiro. </font><font style="vertical-align: inherit;">Se voc√™ pode distinguir uma declara√ß√£o de tipo de uma opera√ß√£o de ponteiro, isso pode ajudar a eliminar algumas confus√µes.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta postagem descreve o objetivo dos ponteiros, a opera√ß√£o da pilha e a mec√¢nica dos ponteiros no Go. </font><font style="vertical-align: inherit;">Este √© o primeiro passo para entender a mec√¢nica, os princ√≠pios de design e as t√©cnicas de uso necess√°rias para escrever c√≥digo coerente e leg√≠vel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No final, aqui est√° o que voc√™ aprendeu:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As fun√ß√µes s√£o executadas dentro dos limites do quadro, que fornecem um espa√ßo de mem√≥ria separado para cada fun√ß√£o correspondente.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quando uma fun√ß√£o √© chamada, ocorre uma transi√ß√£o entre dois quadros.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A vantagem da transmiss√£o de dados "por valor" √© a legibilidade.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A pilha √© importante porque fornece espa√ßo de mem√≥ria f√≠sica para os limites do quadro que s√£o atribu√≠dos a cada fun√ß√£o individual.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toda a mem√≥ria da pilha abaixo do quadro ativo √© inv√°lida, mas a mem√≥ria do quadro ativo e acima √© v√°lida.</font></font></li>
<li>   ,         .</li>
<li>    ,   ,      .</li>
<li>    ‚Äî    ,        ,         .</li>
<li>   ,  ,   ,     ,      .</li>
<li>-          ,   .</li>
<li>-   - ,      ,     .     ,    .</li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt496832/index.html">Tour fotogr√°fico: o que eles est√£o fazendo no laborat√≥rio de nanofot√¥nica h√≠brida e optoeletr√¥nica do New Physics Institute ITMO</a></li>
<li><a href="../pt496836/index.html">QSerializer: solu√ß√£o para serializa√ß√£o JSON / XML simples</a></li>
<li><a href="../pt496838/index.html">Metodologia de implanta√ß√£o de projeto usada pelo Slack</a></li>
<li><a href="../pt496840/index.html">Musk acredita que 12 mil sat√©lites n√£o interferir√£o nos astr√¥nomos. Sua opini√£o n√£o √© consistente com o modelo</a></li>
<li><a href="../pt496842/index.html">Um modelo epid√™mico simples com ferramentas b√°sicas de Python</a></li>
<li><a href="../pt496848/index.html">O resumo de materiais interessantes para o desenvolvedor m√≥vel n¬∫ 340 (de 6 a 12 de abril)</a></li>
<li><a href="../pt496850/index.html">Plugin Maven para JPackage a partir de Java 14</a></li>
<li><a href="../pt496852/index.html">Classifica√ß√£o suave</a></li>
<li><a href="../pt496856/index.html">Casa inteligente sem controles remotos, mas com um cubo</a></li>
<li><a href="../pt496858/index.html">FOSS News No. 11 - uma revis√£o do software livre e de c√≥digo aberto de 6 a 12 de abril de 2020</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>