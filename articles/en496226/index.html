<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë¥üèΩ üê® üë©üèΩ‚Äçüé§ How TeamViewer stores passwords ‚ùÑÔ∏è ‚úäüèø üë®üèº‚Äçüè≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TeamViewer is a popular program for remote access to the desktop. Therefore, it‚Äôs quite interesting to see how it stores passwords. In short, password...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>How TeamViewer stores passwords</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/globalsign/blog/496226/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/wf/27/n8/wf27n8w8o_y8gj1-btavtgpezry.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TeamViewer is a popular program for remote access to the desktop. Therefore, it‚Äôs quite interesting to see how it stores passwords. In short, passwords are encrypted in the Windows registry. For encryption, the AES-128-CBC algorithm and the secret key </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0602000000a400005253413100040000 are used</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This method of saving passwords and the associated privilege escalation were officially registered on February 7, 2020 as the vulnerability </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CVE-2019-18988</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (applies to all versions of TeamViewer up to and including 07/14/1965).</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The novice security specialist who unveiled this vulnerability stumbled upon it by accident. He </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">says</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> that he worked for the client and during the backup noticed the TeamViewer registry keys, which were called </font></font><code>OptionsPasswordAES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>SecurityPasswordAES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Subsequently, he became interested in what these keys were and how TeamViewer stores passwords in general. He imported them to a fresh system in a virtual machine and launched the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BulletPassView</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> scanner </font><font style="vertical-align: inherit;">, which collects passwords in the system. Scanner gave TeamViewer password in clear text.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/b9/sj/cd/b9sjcd_o_eap48qc-omonzznhvo.png"></div><br>
<font color="gray"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scanner BulletPassView</font></font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Then, using the Cheat Engine program (for hacking games under Windows), a specialist searched for this password in RAM - and found it again in plain text. Later it turned out that this vulnerability was already fixed two years ago as</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CVE-2018-14333</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then it‚Äôs time to check where the key is taken from in the TeamViewer client‚Äôs memory: from the server or from the local host. It turned out that there is no network traffic, but there is still a password in the memory. The reverse engineering of the TeamViewer binary using IDA Pro,</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> API Monitor</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> procdump</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Frida</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> took several weeks, but did not give anything, although the guy mastered several new tools along the way, so the process cannot be called useless.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
During the search for information, it turned out that quite a few people already wondered how to find AES keys for Unity games in the resources. It turned out that this is a very simple process, for which it is enough to </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">use a debugger</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Six hours later, he found a piece of TeamViewer code responsible for AES encryption:</font></font><br>
<br>
<pre><code class="plaintext hljs">=================================================<font></font>
"ServerPasswordAES"=hex:88,44,d7,0a,b2,96,2a,3d,63,16,3c,ff,e4,15,04,fb<font></font>
=================================================<font></font>
Takes 8844d70ab2962a3d63163cffe41504fb into xmm0<font></font>
Takes 5B659253E5E873D26723B7D5EAC06E3B into xmm1<font></font>
pxor xmm0, xmm1<font></font>
movdqa xmmword ptr ds:[eax],xmm0<font></font>
[eax] = D3214559577E59EF04358B2A0ED56AC0<font></font>
<font></font>
movdqa xmm1,xmmword ptr ds:[esi] | [esi] = 25C8C8BD4298BB32A57EECBDBD045BBB<font></font>
movdqa xmm0,xmmword ptr ds:[eax] | [eax] = D3214559577E59EF04358B2A0ED56AC0<font></font>
aesdec xmm0,xmm1 | One round of an AES decryption, using Equivalent Inverse Cipher, 128-bit data (state) from xmm1 with 128-bit round key from xmm2/m128; store the result in xmm1.<font></font>
movdqa xmmword ptr ds:[eax],xmm0 | [eax] = 6F AA 98 76 DE 11 7D 8D 7E B6 EE 61 2D 3D 15 52<font></font>
movdqa xmm1,xmmword ptr ds:[esi+10] | [esi+10]=[008FDE10]=79 DC 78 A6 67 50 73 8F E7 E6 57 8F 18 7A B7 06<font></font>
add esi,20 |<font></font>
dec ecx | ecx = 3<font></font>
aesdec xmm0,xmm1 | do the actual decryption<font></font>
movdqa xmmword ptr ds:[eax],xmm0 | [eax]=[008FDC90]=E3 58 26 46 A7 37 12 40 85 1C C0 43 7D 1F 1E 30<font></font>
<font></font>
Three more rounds of aesdec then<font></font>
aesdeclast xmm0, xmm1 .| Last round of AES decryption, using Equivalent Inverse Cipher, 128-bit data (state) from xmm2 with a 128-bit round key from xmm3/m128; store the result in xmm1.<font></font>
<font></font>
008FDC90 01 00 01 00 67 24 4F 43 6E 67 62 F2 5E A8 D7 04 ....g$OCngb√≤^¬®√ó.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This code takes a few bytes from the register </font></font><code>ServerPasswordAES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and decrypts them with the key obtained by XOR'a prescribed value </font></font><code>esi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>eax</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">The result is a key </font></font><code>0602000000a400005253413100040000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and the value of IV is equal </font></font><code>0100010067244F436E6762F25EA8D704</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In TeamViewer 14, the new scripting engine allows you to increase privileges by </font></font><code>NT AUTHORITY\SYSTEM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reading the TeamViewer password in the registry with user rights. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Well, you can also decrypt some other passwords by googling [SecurityPasswordAES], [OptionsPasswordAES], [SecurityPasswordExported] or [PermanentPassword] with the search parameter [filetype: reg]. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TeamViewer has closed this vulnerability in recent versions. </font><font style="vertical-align: inherit;">As the program now encrypts passwords, they have not figured it out yet.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en496212/index.html"># 04 - And a whole byte is not enough ... | Take BK by the horns</a></li>
<li><a href="../en496214/index.html">AdColony: 89% of publishers of mobile apps and games use promotional videos</a></li>
<li><a href="../en496216/index.html">Dark store: are you already thinking about this?</a></li>
<li><a href="../en496220/index.html">Provide udalenku and do not screw up. IT Director Tips</a></li>
<li><a href="../en496224/index.html">First Slurm Evening School on Kubernetes Webinar: What, Where, When, and Why?</a></li>
<li><a href="../en496228/index.html">Unpacking Huawei TaiShan 2280v2</a></li>
<li><a href="../en496232/index.html">How to improve the safety of industrial automation</a></li>
<li><a href="../en496234/index.html">The main reason why not Linux</a></li>
<li><a href="../en496236/index.html">How do we import outsourced testing. Step-by-step instruction</a></li>
<li><a href="../en496238/index.html">Twenty-eight Steps to Survive and Succeed in Crisis</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>