<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍👨‍👦 🎥 ⬆️ Server Game di MS Orleans - Bagian 3: Ringkasan 🙂 🧗🏽 📱</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo, Habr! Saya terus belajar MS Orleans dan membuat game online sederhana dengan klien konsol dan server yang bekerja dengan biji-bijian Orleans. Ka...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Server Game di MS Orleans - Bagian 3: Ringkasan</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/499556/"><img src="https://habrastorage.org/webt/2l/n1/j0/2ln1j0xw4cm-reechlymcdrx86q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Halo, Habr! </font><font style="vertical-align: inherit;">Saya terus belajar MS Orleans dan membuat game online sederhana dengan klien konsol dan server yang bekerja dengan biji-bijian Orleans. </font><font style="vertical-align: inherit;">Kali ini saya akan memberi tahu Anda bagaimana semuanya berakhir dan kesimpulan apa yang saya buat untuk diri saya sendiri. </font><font style="vertical-align: inherit;">Untuk detailnya, selamat datang di kucing.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi ya, jika Anda tertarik pada bagaimana server game untuk game dinamis dibuat, dan bukan eksperimen saya dengan MS Orleans, saya sarankan Anda melihat </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repositori ini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (UDP) dan baca artikel ini:</font></font><br>
<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">habr.com/en/post/303006</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">habr.com/en/post/328118</font></font></a> </li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">habr.com/en/company/pixonic/blog/499642</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">habr.com/en/company/pixonic/blog/420019</font></font></a> </li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kandungan</font></font></h2><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Game Server di MS Orleans - Bagian 1: Apa itu Aktor</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Game Server di MS Orleans - Bagian 2: Membuat Poin yang Dikelola</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Server Game di MS Orleans - Bagian 3: Ringkasan</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kode sumber</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MsOrleansOnlineGame </font></font></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tentang permainan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hasilnya adalah penembak sederhana. </font><font style="vertical-align: inherit;">Hijau # adalah lawan. </font><font style="vertical-align: inherit;">Kuning # adalah karakter Anda. </font><font style="vertical-align: inherit;">Red $ adalah sebuah peluru. </font><font style="vertical-align: inherit;">Pemotretan adalah arah yang Anda tuju. </font><font style="vertical-align: inherit;">Arah gerakan dikendalikan oleh tombol WASD atau panah. </font><font style="vertical-align: inherit;">Bilah spasi digunakan untuk pemotretan. </font><font style="vertical-align: inherit;">Saya tidak melihat titik menggambarkan kode klien secara rinci karena perlu diganti dengan yang normal. </font><font style="vertical-align: inherit;">Grafis.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tentang aktor (biji-bijian)</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Singkatnya: IMHO saya bahwa Orleans adalah gRPC tentang steroid yang diasah di bawah Azure, scaling dan bekerja dengan peringatan. Dengan cache misalnya. Meskipun tanpa status, seperti RPC biasa, dia tahu cara bekerja melalui Stateless Worker Grains. Grain (Aktor) di Orleans dapat bertindak sebagai titik masuk sebagai Pengontrol di Asp.Net. Tetapi tidak seperti Controller, butir memiliki satu contoh tunggal yang memiliki pengenal sendiri. Butir bagus ketika Anda perlu bekerja dengan beberapa kondisi pada saat yang sama dari beberapa utas atau dari beberapa pengguna. Mereka menyediakan operasi benang aman dengannya.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Misalnya, di sini ada aktor untuk sekeranjang barang. </font><font style="vertical-align: inherit;">Pada panggilan pertama, itu akan dibuat dan akan tergantung di memori memainkan peran cache. </font><font style="vertical-align: inherit;">Pada saat yang sama, ribuan pengguna dari ribuan aliran berbeda dapat secara bersamaan membuat permintaan untuk menambahkan dan menghapus item. </font><font style="vertical-align: inherit;">Semua pekerjaan dengan kondisinya di dalam dirinya akan benar-benar aman. </font><font style="vertical-align: inherit;">Dalam hal ini, tentu saja, akan berguna untuk membuat aktor Shop dengan metode List GetBaskets () untuk mendapatkan daftar semua keranjang yang tersedia dalam sistem. </font><font style="vertical-align: inherit;">Pada saat yang sama, Toko juga akan menggantung di memori sebagai cache dan semua bekerja dengannya akan aman.</font></font><br>
<br>
<pre><code class="cs hljs">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IBasket</span> : <span class="hljs-title">IGrainWithGuidKey</span><font></font>
    {<font></font>
        <span class="hljs-function">Task <span class="hljs-title">Add</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> item</span>)</span>;
        <span class="hljs-function">Task <span class="hljs-title">Remove</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> item</span>)</span>;<font></font>
        Task&lt;List&lt;<span class="hljs-keyword">string</span>&gt;&gt; GetItems();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">BasketGrain</span> : <span class="hljs-title">Grain</span>, <span class="hljs-title">IBasket</span><font></font>
    {<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ILogger&lt;BasketGrain&gt; _logger;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IPersistentState&lt;List&lt;<span class="hljs-keyword">string</span>&gt;&gt; _store;<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">BasketGrain</span>(<span class="hljs-params">
            ILogger&lt;BasketGrain&gt; logger,
            [PersistentState(<span class="hljs-string">"basket"</span>, <span class="hljs-string">"shopState"</span></span>)] IPersistentState&lt;List&lt;<span class="hljs-keyword">string</span>&gt;&gt; store
        )</span><font></font>
        {<font></font>
            _logger = logger;<font></font>
            _store = store;<font></font>
        }<font></font>
<font></font>
         <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> Task <span class="hljs-title">OnActivateAsync</span>(<span class="hljs-params"></span>)</span><font></font>
        {<font></font>
             <span class="hljs-keyword">var</span> shop = GrainFactory.GetGrain&lt;IShop&gt;();
           <span class="hljs-comment">//          .</span>
            <span class="hljs-keyword">await</span> shop.AddBasketIfNotContains(<span class="hljs-keyword">this</span>.GetPrimaryKey())
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">base</span>.OnActivateAsync();<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">OnDeactivateAsync</span>(<span class="hljs-params"></span>)</span><font></font>
        {<font></font>
          <span class="hljs-comment">//       </span>
         <span class="hljs-comment">//    Asp.Net  . </span>
        <span class="hljs-comment">//           - .</span>
        <span class="hljs-comment">//    -      .</span>
        <span class="hljs-comment">//         .</span>
     <span class="hljs-comment">//        </span>
            <span class="hljs-keyword">await</span> _store.WriteStateAsync();
            <span class="hljs-keyword">await</span> <span class="hljs-keyword">base</span>.OnDeactivateAsync();<font></font>
        }<font></font>
<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> Task <span class="hljs-title">Add</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> item</span>)</span><font></font>
        {<font></font>
            _store.State.Add(item);<font></font>
            <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> Task <span class="hljs-title">Remove</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> item</span>)</span><font></font>
        {<font></font>
            _store.State.Remove(item);<font></font>
            <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">public</span> Task&lt;List&lt;<span class="hljs-keyword">string</span>&gt;&gt; GetItems()<font></font>
        {<font></font>
           <span class="hljs-comment">//      .</span>
          <span class="hljs-comment">//        </span>
         <span class="hljs-comment">//           </span>
            <span class="hljs-keyword">return</span> Task.FromResult(<span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;(_store.State));<font></font>
        }<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Contoh penggunaan di beberapa aplikasi konsol:</font></font><br>
<br>
<pre><code class="cs hljs">         <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">DoClientWork</span>(<span class="hljs-params">IClusterClient client, Guid baskeId</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> basket = client.GetGrain&lt;IBasket&gt;(baskeId);
           <span class="hljs-comment">//   gRPC -                </span>
            <span class="hljs-keyword">await</span> basket.Add(<span class="hljs-string">"Apple"</span>);<font></font>
        }<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kode permainan</font></font></h2><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peta tempat para pemain bertarung:</font></font><br>
<br>
<pre><code class="cs hljs">   <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IFrame</span> : <span class="hljs-title">IGrainWithIntegerKey</span><font></font>
    {<font></font>
        <span class="hljs-function">Task <span class="hljs-title">Update</span>(<span class="hljs-params">Frame frame</span>)</span>;
        <span class="hljs-function">Task&lt;Frame&gt; <span class="hljs-title">GetState</span>(<span class="hljs-params"></span>)</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">FrameGrain</span> : <span class="hljs-title">Grain</span>, <span class="hljs-title">IFrame</span><font></font>
    {<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ILogger&lt;FrameGrain&gt; _logger;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IPersistentState&lt;Frame&gt; _store;<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">FrameGrain</span>(<span class="hljs-params">
            ILogger&lt;FrameGrain&gt; logger,
            [PersistentState(<span class="hljs-string">"frame"</span>, <span class="hljs-string">"gameState"</span></span>)] IPersistentState&lt;Frame&gt; store
        )</span><font></font>
        {<font></font>
            _logger = logger;<font></font>
            _store = store;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> Task <span class="hljs-title">OnActivateAsync</span>(<span class="hljs-params"></span>)</span><font></font>
        {<font></font>
            _logger.LogInformation(<span class="hljs-string">"ACTIVATED"</span>);
           <span class="hljs-comment">//    1  1      .</span>
            _store.State.GameId = <span class="hljs-keyword">this</span>.GetPrimaryKeyLong();
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">base</span>.OnActivateAsync();<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">OnDeactivateAsync</span>(<span class="hljs-params"></span>)</span><font></font>
        {<font></font>
            _logger.LogInformation(<span class="hljs-string">"DEACTIVATED"</span>);
            <span class="hljs-keyword">await</span> _store.WriteStateAsync();
            <span class="hljs-keyword">await</span> <span class="hljs-keyword">base</span>.OnDeactivateAsync();<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> Task <span class="hljs-title">Update</span>(<span class="hljs-params">Frame frame</span>)</span><font></font>
        {<font></font>
            _store.State = frame;<font></font>
            <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> Task&lt;Frame&gt; <span class="hljs-title">GetState</span>(<span class="hljs-params"></span>)</span> =&gt; Task.FromResult(_store.State.Clone());<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Butir game yang menyimpan keadaan umum game saat ini dan mengirimkannya ke klien 20 kali per detik melalui SignalR.</font></font><br>
<br>
<pre><code class="cs hljs">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IGame</span> : <span class="hljs-title">IGrainWithIntegerKey</span><font></font>
    {<font></font>
        <span class="hljs-function">Task <span class="hljs-title">Update</span>(<span class="hljs-params">Player player</span>)</span>;
        <span class="hljs-function">Task <span class="hljs-title">Update</span>(<span class="hljs-params">Bullet bullet</span>)</span>;<font></font>
        Task&lt;List&lt;Player&gt;&gt; GetAlivePlayers();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">GameGrain</span> : <span class="hljs-title">Grain</span>, <span class="hljs-title">IGame</span><font></font>
    {<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">byte</span> WIDTH = <span class="hljs-number">100</span>;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">byte</span> HEIGHT = <span class="hljs-number">50</span>;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ILogger&lt;GameGrain&gt; _logger;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IPersistentState&lt;Game&gt; _store;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IHubContext&lt;GameHub&gt; _hub;
        <span class="hljs-keyword">private</span> IDisposable _timer;
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">GameGrain</span>(<span class="hljs-params">
            ILogger&lt;GameGrain&gt; logger,
            [PersistentState(<span class="hljs-string">"game"</span>, <span class="hljs-string">"gameState"</span></span>)] IPersistentState&lt;Game&gt; store,
            IHubContext&lt;GameHub&gt; hub
            )</span><font></font>
        {<font></font>
            _logger = logger;<font></font>
            _store = store;<font></font>
            _hub = hub;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">OnActivateAsync</span>(<span class="hljs-params"></span>)</span><font></font>
        {<font></font>
            _store.State.Id = <span class="hljs-keyword">this</span>.GetPrimaryKeyLong();<font></font>
            _store.State.Frame = <span class="hljs-keyword">new</span> Frame(WIDTH, HEIGHT) { GameId = _store.State.Id };
            <span class="hljs-keyword">var</span> frame = GrainFactory.GetGrain&lt;IFrame&gt;(_store.State.Id);
            <span class="hljs-keyword">await</span> frame.Update(_store.State.Frame.Clone());<font></font>
            _logger.LogWarning(<span class="hljs-string">"ACTIVATED"</span>);
            <span class="hljs-comment">//      50      .       .</span>
            _timer = RegisterTimer(Draw, <span class="hljs-literal">null</span>, TimeSpan.FromMilliseconds(<span class="hljs-number">100</span>), TimeSpan.FromMilliseconds(<span class="hljs-number">50</span>));
            <span class="hljs-keyword">await</span> <span class="hljs-keyword">base</span>.OnActivateAsync();<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">OnDeactivateAsync</span>(<span class="hljs-params"></span>)</span><font></font>
        {<font></font>
            _logger.LogWarning(<span class="hljs-string">"DEACTIVATED"</span>);<font></font>
            _timer?.Dispose();<font></font>
            _timer = <span class="hljs-literal">null</span>;
            <span class="hljs-keyword">await</span> _store.WriteStateAsync();
            <span class="hljs-keyword">await</span> <span class="hljs-keyword">base</span>.OnDeactivateAsync();<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">Draw</span>(<span class="hljs-params"><span class="hljs-keyword">object</span> obj</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> state = _store.State;<font></font>
            state.Bullets.RemoveAll(b =&gt; !b.IsAlive);<font></font>
            state.Players.RemoveAll(p =&gt; !p.IsAlive);<font></font>
            <span class="hljs-keyword">try</span><font></font>
            {<font></font>
                <span class="hljs-keyword">await</span> _hub.Clients.All.SendAsync(<span class="hljs-string">"gameUpdated"</span>, state.Clone());<font></font>
            }<font></font>
            <span class="hljs-keyword">catch</span> (Exception e)<font></font>
            {<font></font>
                _logger.LogError(e, <span class="hljs-string">"Error on send s"</span>);<font></font>
            }<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> Task <span class="hljs-title">Update</span>(<span class="hljs-params">Player player</span>)</span><font></font>
        {<font></font>
            _store.State.Players.RemoveAll(x =&gt; x.Id == player.Id);<font></font>
            _store.State.Players.Add(player);<font></font>
            <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
        }<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> Task <span class="hljs-title">Update</span>(<span class="hljs-params">Bullet bullet</span>)</span><font></font>
        {<font></font>
            _store.State.Bullets.RemoveAll(x =&gt; x.Id == bullet.Id);<font></font>
            _store.State.Bullets.Add(bullet);<font></font>
            <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">public</span> Task&lt;List&lt;Player&gt;&gt; GetAlivePlayers() =&gt;<font></font>
            Task.FromResult(_store.State.Players.Where(p =&gt; p.IsAlive).Select(p =&gt; p.Clone()).ToList());<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SignalR adalah hub tempat kami berkomunikasi dengan klien. </font><font style="vertical-align: inherit;">Bertindak sebagai proksi antara klien WebGl dan Orleans. </font><font style="vertical-align: inherit;">Sejauh ini, kliennya adalah konsol dan dia sangat bodoh. </font><font style="vertical-align: inherit;">Saya ingin membuat klien web di masa depan di browser di Three.js dan karenanya saya memerlukan koneksi pada soket web SignalR. </font><font style="vertical-align: inherit;">Klien Orleans itu sendiri hanya dalam C #, tidak seperti gRPC, yang tersedia dalam banyak bahasa, oleh karena itu, untuk klien web, antara server Orleans dan klien Anda perlu menginstal proxy (inti Gateway asp.net).</font></font><br>
<br>
<pre><code class="cs hljs">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">GameHub</span> : <span class="hljs-title">Hub</span><font></font>
    {<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IGrainFactory _client;<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">GameHub</span>(<span class="hljs-params">IGrainFactory client</span>)</span><font></font>
        {<font></font>
            _client = client;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">GameInput</span>(<span class="hljs-params">Input input</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> player = _client.GetGrain&lt;IPlayer&gt;(input.PlayerId);
            <span class="hljs-keyword">await</span> player.Handle(input);<font></font>
        }<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pemain biji-bijian. </font><font style="vertical-align: inherit;">Secara otomatis bergerak sesuai dengan pengatur waktu dan merespons perintah pengguna. </font><font style="vertical-align: inherit;">Jika perintah tembak tiba, ia menciptakan peluru peluru dan menetapkan arah gerakan untuknya.</font></font><br>
<br>
<pre><code class="cs hljs">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">PlayerGrain</span> : <span class="hljs-title">Grain</span>, <span class="hljs-title">IPlayer</span><font></font>
    {<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ILogger&lt;PlayerGrain&gt; _logger;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IPersistentState&lt;Player&gt; _store;
        <span class="hljs-keyword">private</span> IDisposable _timer;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> Queue&lt;Input&gt; _inputs;
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PlayerGrain</span>(<span class="hljs-params">
            ILogger&lt;PlayerGrain&gt; logger,
            [PersistentState(<span class="hljs-string">"player"</span>, <span class="hljs-string">"gameState"</span></span>)] IPersistentState&lt;Player&gt; store
        )</span><font></font>
        {<font></font>
            _logger = logger;<font></font>
            _store = store;<font></font>
            _inputs = <span class="hljs-keyword">new</span> Queue&lt;Input&gt;();<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> Task <span class="hljs-title">OnActivateAsync</span>(<span class="hljs-params"></span>)</span><font></font>
        {<font></font>
            _logger.LogInformation(<span class="hljs-string">"ACTIVATED"</span>);
            <span class="hljs-comment">// State   POCO     . Entity Player   </span>
            _store.State.Id = <span class="hljs-keyword">this</span>.GetPrimaryKey();<font></font>
            _timer = RegisterTimer(Update, <span class="hljs-literal">null</span>, TimeSpan.FromMilliseconds(<span class="hljs-number">1</span>), TimeSpan.FromMilliseconds(<span class="hljs-number">200</span>));
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">base</span>.OnActivateAsync();<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">OnDeactivateAsync</span>(<span class="hljs-params"></span>)</span><font></font>
        {<font></font>
            _logger.LogInformation(<span class="hljs-string">"ACTIVATED"</span>);<font></font>
            _timer?.Dispose();<font></font>
            _timer = <span class="hljs-literal">null</span>;
            <span class="hljs-keyword">await</span> _store.WriteStateAsync();
            <span class="hljs-keyword">await</span> <span class="hljs-keyword">base</span>.OnDeactivateAsync();<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">Handle</span>(<span class="hljs-params">Input input</span>)</span><font></font>
        {<font></font>
            _store.State.GameId = input.GameId;<font></font>
            _inputs.Enqueue(input);<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">Update</span>(<span class="hljs-params"><span class="hljs-keyword">object</span> obj</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">if</span> (!_store.State.IsAlive)<font></font>
            {<font></font>
                <span class="hljs-keyword">await</span> _store.ClearStateAsync();
               <span class="hljs-comment">//          .</span>
             <span class="hljs-comment">//       .       .</span><font></font>
                DeactivateOnIdle();<font></font>
                <span class="hljs-keyword">return</span>;<font></font>
            }<font></font>
<font></font>
            <span class="hljs-keyword">while</span> (_inputs.Count &gt; <span class="hljs-number">0</span>)<font></font>
            {<font></font>
                <span class="hljs-keyword">var</span> input = _inputs.Dequeue();
                <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> direction <span class="hljs-keyword">in</span> input.Directions.Where(d =&gt; d != Direction.None))<font></font>
                {<font></font>
                    _store.State.Direction = direction;<font></font>
                }<font></font>
<font></font>
                <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> command <span class="hljs-keyword">in</span> input.Commands.Where(c =&gt; c != Command.None))<font></font>
                {<font></font>
                    <span class="hljs-keyword">if</span> (command == Command.Shoot)<font></font>
                    {<font></font>
                        <span class="hljs-keyword">var</span> bulletId = Guid.NewGuid();
                        <span class="hljs-keyword">var</span> bullet = GrainFactory.GetGrain&lt;IBullet&gt;(bulletId);
                        <span class="hljs-comment">//  Shot()           .</span>
                        bullet.Update(_store.State.Shot()).Ignore(); <span class="hljs-comment">//Ignore()        </span><font></font>
                    }<font></font>
                }<font></font>
            }<font></font>
            _store.State.Move();<font></font>
            <span class="hljs-keyword">if</span> (_store.State.GameId.HasValue)<font></font>
            {<font></font>
                <span class="hljs-keyword">var</span> frame = GrainFactory.GetGrain&lt;IFrame&gt;(_store.State.GameId.Value);
                <span class="hljs-keyword">var</span> fs = <span class="hljs-keyword">await</span> frame.GetState();
                <span class="hljs-keyword">if</span> (fs.Collide(_store.State))<font></font>
                    _store.State.MoveBack();<font></font>
                GrainFactory.GetGrain&lt;IGame&gt;(_store.State.GameId.Value)<font></font>
                    .Update(_store.State.Clone())<font></font>
                    .Ignore();<font></font>
            }<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">Die</span>(<span class="hljs-params"></span>)</span><font></font>
        {<font></font>
            _store.State.IsAlive = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">if</span> (_store.State.GameId.HasValue)
                <span class="hljs-keyword">await</span> GrainFactory.GetGrain&lt;IGame&gt;(_store.State.GameId.Value).Update(_store.State.Clone());
            <span class="hljs-keyword">await</span> _store.ClearStateAsync();<font></font>
            DeactivateOnIdle();<font></font>
        }<font></font>
    }<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Butir peluru. </font><font style="vertical-align: inherit;">Secara otomatis bergerak pada timer dan, jika bertemu pemain, memerintahkannya untuk mati. </font><font style="vertical-align: inherit;">Jika dia menemui hambatan di peta, dia mati sendiri.</font></font><br>
<pre><code class="cs hljs">  <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IBullet</span> : <span class="hljs-title">IGrainWithGuidKey</span><font></font>
    {<font></font>
        <span class="hljs-function">Task <span class="hljs-title">Update</span>(<span class="hljs-params">Bullet dto</span>)</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">BulletGrain</span> : <span class="hljs-title">Grain</span>, <span class="hljs-title">IBullet</span><font></font>
    {<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ILogger&lt;BulletGrain&gt; _logger;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IPersistentState&lt;Bullet&gt; _store;
        <span class="hljs-keyword">private</span> IDisposable _timer;
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">BulletGrain</span>(<span class="hljs-params">
            ILogger&lt;BulletGrain&gt; logger,
            [PersistentState(<span class="hljs-string">"bullet"</span>, <span class="hljs-string">"gameState"</span></span>)] IPersistentState&lt;Bullet&gt; store
        )</span><font></font>
        {<font></font>
            _logger = logger;<font></font>
            _store = store;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> Task <span class="hljs-title">Update</span>(<span class="hljs-params">Bullet dto</span>)</span><font></font>
        {<font></font>
            _store.State = dto;<font></font>
            _store.State.Id = <span class="hljs-keyword">this</span>.GetPrimaryKey();
            <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> Task <span class="hljs-title">OnActivateAsync</span>(<span class="hljs-params"></span>)</span><font></font>
        {<font></font>
            _logger.LogInformation(<span class="hljs-string">"ACTIVATED"</span>);<font></font>
            _timer = <span class="hljs-keyword">this</span>.RegisterTimer(Update, <span class="hljs-literal">null</span>, TimeSpan.FromMilliseconds(<span class="hljs-number">1</span>), TimeSpan.FromMilliseconds(<span class="hljs-number">50</span>));
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">base</span>.OnActivateAsync();<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">OnDeactivateAsync</span>(<span class="hljs-params"></span>)</span><font></font>
        {<font></font>
            _logger.LogInformation(<span class="hljs-string">"DEACTIVATED"</span>);<font></font>
            _timer?.Dispose();<font></font>
            _timer = <span class="hljs-literal">null</span>;
            <span class="hljs-keyword">await</span> _store.WriteStateAsync();
            <span class="hljs-keyword">await</span> <span class="hljs-keyword">base</span>.OnDeactivateAsync();<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">Update</span>(<span class="hljs-params"><span class="hljs-keyword">object</span> obj</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">if</span> (!_store.State.IsAlive)<font></font>
            {<font></font>
                <span class="hljs-keyword">await</span> _store.ClearStateAsync();<font></font>
                DeactivateOnIdle();<font></font>
                <span class="hljs-keyword">return</span>;<font></font>
            }<font></font>
            _store.State.Move();<font></font>
            <span class="hljs-keyword">if</span> (_store.State.GameId.HasValue)<font></font>
            {<font></font>
                <span class="hljs-keyword">var</span> frame = GrainFactory.GetGrain&lt;IFrame&gt;(_store.State.GameId.Value);
                <span class="hljs-keyword">var</span> fs = <span class="hljs-keyword">await</span> frame.GetState();
                <span class="hljs-keyword">if</span> (fs.Collide(_store.State))<font></font>
                    _store.State.IsAlive = <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">if</span> (_store.State.Point.X &gt; fs.Width || _store.State.Point.Y &gt; fs.Height)<font></font>
                    _store.State.IsAlive = <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">var</span> game = GrainFactory.GetGrain&lt;IGame&gt;(_store.State.GameId.Value);
                <span class="hljs-keyword">var</span> players = <span class="hljs-keyword">await</span> game.GetAlivePlayers();
                <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> player <span class="hljs-keyword">in</span> players)<font></font>
                {<font></font>
                    <span class="hljs-keyword">if</span> (player.Collide(_store.State))<font></font>
                    {<font></font>
                        _store.State.IsAlive = <span class="hljs-literal">false</span>;<font></font>
                        GrainFactory.GetGrain&lt;IPlayer&gt;(player.Id).Die().Ignore();<font></font>
                        <span class="hljs-keyword">break</span>;<font></font>
                    }<font></font>
                }<font></font>
                game.Update(_store.State.Clone()).Ignore();<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
</code></pre></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id499542/index.html">Fakapov Cyan Teratas</a></li>
<li><a href="../id499544/index.html">Pelajari jaringan saraf di Google Sheets</a></li>
<li><a href="../id499546/index.html">Pengembangan firmware untuk kamera video analog EVR-Y2022F</a></li>
<li><a href="../id499548/index.html">Topeng - merawat orang lain atau ilusi keamanan?</a></li>
<li><a href="../id499550/index.html">Solusi Kode Rendah Ekosistem</a></li>
<li><a href="../id499560/index.html">Korektor tata letak Xswitcher untuk linux: langkah kedua</a></li>
<li><a href="../id499562/index.html">Artikel yang gagal tentang percepatan refleksi</a></li>
<li><a href="../id499564/index.html">Coronavirus dalam video dan komentar YouTube</a></li>
<li><a href="../id499566/index.html">Augmentasi on the fly - alat penting dalam pelatihan jaringan saraf</a></li>
<li><a href="../id499570/index.html">Apa yang terjadi dengan transportasi pada akhir April dan kapan harus menunggu pemulihan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>