<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⬇️ 🀄️ 👩🏾‍🚀 C / C ++の確定的アセンブリの紹介。パート2 🔜 👧🏽 🤱</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="記事の翻訳は、コース「C ++ Developer」の学生のために特別に準備されました。
 
 
 
 → 最初の部分を読む
 
 
 アセンブリフォルダー情報はバイナリファイルで配布されます
 同じソースファイルが異なるフォルダーにコンパイルされている場合、フォルダー情報がバイナリファイルに転送さ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>C / C ++の確定的アセンブリの紹介。パート2</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/468555/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記事の翻訳は、コース</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「C ++ Developer」の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">学生のために特別に準備されました</font><font style="vertical-align: inherit;">。</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/it/uw/84/ituw84r955lsxlndkmfl5ggbahi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
→ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初の部分を読む</font></font></a><br>
<br>
<hr><a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アセンブリフォルダー情報はバイナリファイルで配布されます</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同じソースファイルが異なるフォルダーにコンパイルされている場合、フォルダー情報がバイナリファイルに転送されることがあります。</font><font style="vertical-align: inherit;">これは主に2つの理由で発生します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マクロなど、現在のファイルに関する情報を含むマクロの使用</font></font><code>__FILE__</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソースの場所に関する情報を格納するデバッグバイナリを作成します。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MacOSでのHello Worldの例を続けて、ソースを分割して、最終的なバイナリの場所の影響を示すことができるようにします。</font><font style="vertical-align: inherit;">プロジェクトの構造は次のようになります。</font></font><br>
<br>
<pre><code class="cpp hljs">.<font></font>
├── run_build.sh<font></font>
├── srcA<font></font>
│   ├── CMakeLists.txt<font></font>
│   ├── hello_world.cpp<font></font>
│   ├── hello_world.hpp<font></font>
│   └── main.cpp<font></font>
└── srcB<font></font>
    ├── CMakeLists.txt<font></font>
    ├── hello_world.cpp<font></font>
    ├── hello_world.hpp<font></font>
    └── main.cpp</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バイナリファイルをデバッグモードで収集してみましょう。</font></font><br>
<br>
<pre><code class="cpp hljs">cd srcA/build<font></font>
cmake -DCMAKE_BUILD_TYPE=Debug ..<font></font>
make<font></font>
cd .. &amp;&amp; cd ..<font></font>
cd srcB/build<font></font>
cmake -DCMAKE_BUILD_TYPE=Debug ..<font></font>
make<font></font>
cd .. &amp;&amp; cd ..<font></font>
md5sum srcA/build/hello<font></font>
md5sum srcB/build/hello<font></font>
md5sum srcA/build/CMakeFiles/HelloLib.dir/hello_world.cpp.o<font></font>
md5sum srcB/build/CMakeFiles/HelloLib.dir/hello_world.cpp.o<font></font>
md5sum srcA/build/libHelloLib.a<font></font>
md5sum srcB/build/libHelloLib.a<font></font>
    :<font></font>
<span class="hljs-number">3572</span>a95a8699f71803f3e967f92a5040  srcA/build/hello
<span class="hljs-number">7</span>ca693295e62de03a1bba14853efa28c  srcB/build/hello
<span class="hljs-number">76e0</span>ae7c4ef79ec3be821ccf5752730f  srcA/build/CMakeFiles/HelloLib.dir/hello_world.cpp.o
<span class="hljs-number">5</span>ef044e6dcb73359f46d48f29f566ae5  srcB/build/CMakeFiles/HelloLib.dir/hello_world.cpp.o<font></font>
dc941156608b578c91e38f8ecebfef6d  srcA/build/libHelloLib.a<font></font>
<span class="hljs-number">1f</span>9697ef23bf70b41b39ef3469845f76  srcB/build/libHelloLib.a</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フォルダーに関する情報は、オブジェクトファイルから最終的な実行可能ファイルに転送され、アセンブリが再現不能になります。</font><font style="vertical-align: inherit;">フォルダ情報が埋め込まれている場所を確認するために、ディフスコープを使用してバイナリ間の違いを見ることができます。</font></font><br>
<br>
<pre><code class="cpp hljs">&gt; diffoscope helloA helloB<font></font>
--- srcA/build/hello<font></font>
+++ srcB/build/hello<font></font>
@@ <span class="hljs-number">-1282</span>,<span class="hljs-number">20</span> +<span class="hljs-number">1282</span>,<span class="hljs-number">20</span> @@<font></font>
...<font></font>
 <span class="hljs-number">00005070</span>: <span class="hljs-number">5f</span>77 <span class="hljs-number">6f</span>72 <span class="hljs-number">6</span>c64 <span class="hljs-number">5f</span>64 <span class="hljs-number">6562</span> <span class="hljs-number">7567</span> <span class="hljs-number">2f</span>73 <span class="hljs-number">7263</span>  _world_debug/src
<span class="hljs-number">-00005080</span>: <span class="hljs-number">412f</span> <span class="hljs-number">006</span>d <span class="hljs-number">6169</span> <span class="hljs-number">6e2</span>e <span class="hljs-number">6370</span> <span class="hljs-number">7000</span> <span class="hljs-number">2f</span>55 <span class="hljs-number">7365</span>  A/.main.cpp./Use<font></font>
+<span class="hljs-number">00005080</span>: <span class="hljs-number">422f</span> <span class="hljs-number">006</span>d <span class="hljs-number">6169</span> <span class="hljs-number">6e2</span>e <span class="hljs-number">6370</span> <span class="hljs-number">7000</span> <span class="hljs-number">2f</span>55 <span class="hljs-number">7365</span>  B/.main.cpp./Use
 <span class="hljs-number">00005090</span>: <span class="hljs-number">7273</span> <span class="hljs-number">2f</span>63 <span class="hljs-number">6172</span> <span class="hljs-number">6</span>c6f <span class="hljs-number">732f</span> <span class="hljs-number">446f</span> <span class="hljs-number">6375</span> <span class="hljs-number">6</span>d65  rs/carlos/Docume
 <span class="hljs-number">000050</span>a0: <span class="hljs-number">6e74</span> <span class="hljs-number">732f</span> <span class="hljs-number">6465</span> <span class="hljs-number">7665</span> <span class="hljs-number">6</span>c6f <span class="hljs-number">7065</span> <span class="hljs-number">722f</span> <span class="hljs-number">7265</span>  nts/developer/re
 <span class="hljs-number">000050b</span>0: <span class="hljs-number">7072</span> <span class="hljs-number">6f</span>64 <span class="hljs-number">7563</span> <span class="hljs-number">6962</span> <span class="hljs-number">6</span>c65 <span class="hljs-number">2</span>d62 <span class="hljs-number">7569</span> <span class="hljs-number">6</span>c64  producible-build
 <span class="hljs-number">000050</span>c0: <span class="hljs-number">732f</span> <span class="hljs-number">7361</span> <span class="hljs-number">6e64</span> <span class="hljs-number">626f</span> <span class="hljs-number">782f</span> <span class="hljs-number">6865</span> <span class="hljs-number">6</span>c6c <span class="hljs-number">6f</span>5f  s/sandbox/hello_
<span class="hljs-number">-000050</span>d0: <span class="hljs-number">776f</span> <span class="hljs-number">726</span>c <span class="hljs-number">645f</span> <span class="hljs-number">6465</span> <span class="hljs-number">6275</span> <span class="hljs-number">672f</span> <span class="hljs-number">7372</span> <span class="hljs-number">6341</span>  world_debug/srcA<font></font>
+<span class="hljs-number">000050</span>d0: <span class="hljs-number">776f</span> <span class="hljs-number">726</span>c <span class="hljs-number">645f</span> <span class="hljs-number">6465</span> <span class="hljs-number">6275</span> <span class="hljs-number">672f</span> <span class="hljs-number">7372</span> <span class="hljs-number">6342</span>  world_debug/srcB
 <span class="hljs-number">000050e0</span>: <span class="hljs-number">2f</span>62 <span class="hljs-number">7569</span> <span class="hljs-number">6</span>c64 <span class="hljs-number">2f</span>43 <span class="hljs-number">4</span>d61 <span class="hljs-number">6b</span>65 <span class="hljs-number">4669</span> <span class="hljs-number">6</span>c65  /build/CMakeFile
 <span class="hljs-number">000050f</span>0: <span class="hljs-number">732f</span> <span class="hljs-number">6865</span> <span class="hljs-number">6</span>c6c <span class="hljs-number">6f</span>2e <span class="hljs-number">6469</span> <span class="hljs-number">722f</span> <span class="hljs-number">6</span>d61 <span class="hljs-number">696</span>e  s/hello.dir/main
 <span class="hljs-number">00005100</span>: <span class="hljs-number">2e63</span> <span class="hljs-number">7070</span> <span class="hljs-number">2e6</span>f <span class="hljs-number">005f</span> <span class="hljs-number">6</span>d61 <span class="hljs-number">696</span>e <span class="hljs-number">005f</span> <span class="hljs-number">5f</span>5a  .cpp.o._main.__Z<font></font>
...<font></font>
@@ <span class="hljs-number">-1336</span>,<span class="hljs-number">15</span> +<span class="hljs-number">1336</span>,<span class="hljs-number">15</span> @@<font></font>
...<font></font>
 <span class="hljs-number">000053</span>c0: <span class="hljs-number">6962</span> <span class="hljs-number">6</span>c65 <span class="hljs-number">2</span>d62 <span class="hljs-number">7569</span> <span class="hljs-number">6</span>c64 <span class="hljs-number">732f</span> <span class="hljs-number">7361</span> <span class="hljs-number">6e64</span>  ible-builds/sand
 <span class="hljs-number">000053</span>d0: <span class="hljs-number">626f</span> <span class="hljs-number">782f</span> <span class="hljs-number">6865</span> <span class="hljs-number">6</span>c6c <span class="hljs-number">6f</span>5f <span class="hljs-number">776f</span> <span class="hljs-number">726</span>c <span class="hljs-number">645f</span>  box/hello_world_
<span class="hljs-number">-000053e0</span>: <span class="hljs-number">6465</span> <span class="hljs-number">6275</span> <span class="hljs-number">672f</span> <span class="hljs-number">7372</span> <span class="hljs-number">6341</span> <span class="hljs-number">2f</span>62 <span class="hljs-number">7569</span> <span class="hljs-number">6</span>c64  debug/srcA/build<font></font>
+<span class="hljs-number">000053e0</span>: <span class="hljs-number">6465</span> <span class="hljs-number">6275</span> <span class="hljs-number">672f</span> <span class="hljs-number">7372</span> <span class="hljs-number">6342</span> <span class="hljs-number">2f</span>62 <span class="hljs-number">7569</span> <span class="hljs-number">6</span>c64  debug/srcB/build
 <span class="hljs-number">000053f</span>0: <span class="hljs-number">2f</span>6c <span class="hljs-number">6962</span> <span class="hljs-number">4865</span> <span class="hljs-number">6</span>c6c <span class="hljs-number">6f</span>4c <span class="hljs-number">6962</span> <span class="hljs-number">2e61</span> <span class="hljs-number">2868</span>  /libHelloLib.a(h
 <span class="hljs-number">00005400</span>: <span class="hljs-number">656</span>c <span class="hljs-number">6</span>c6f <span class="hljs-number">5f</span>77 <span class="hljs-number">6f</span>72 <span class="hljs-number">6</span>c64 <span class="hljs-number">2e63</span> <span class="hljs-number">7070</span> <span class="hljs-number">2e6</span>f  ello_world.cpp.o
 <span class="hljs-number">00005410</span>: <span class="hljs-number">2900</span> <span class="hljs-number">5f</span>5f <span class="hljs-number">5</span>a4e <span class="hljs-number">3130</span> <span class="hljs-number">4865</span> <span class="hljs-number">6</span>c6c <span class="hljs-number">6f</span>57 <span class="hljs-number">6f</span>72  ).__ZN10HelloWor<font></font>
...</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能な解決策</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
繰り返しになりますが、決定は使用するコンパイラによって異なります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msvcは、この情報をバイナリファイルに追加しないようにパラメーターを設定できません。</font><font style="vertical-align: inherit;">再現可能なバイナリを取得する唯一の方法は、修復ツールを再度使用して、ビルドフェーズ中にこの情報を削除することです。</font><font style="vertical-align: inherit;">バイナリを修正して再現可能なバイナリを生成するため、異なるアセンブリに使用されるフォルダは、文字数が同じである必要があります。</font></font></li>
<li><font style="vertical-align: inherit;"></font><code>gcc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この問題を回避するには、3つのコンパイラフラグ</font><font style="vertical-align: inherit;">があり</font><font style="vertical-align: inherit;">ます。</font></font><br>
<ul>
<li><code>-fdebug-prefix-map=OLD=NEW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> デバッグ情報からディレクトリプレフィックスを削除できます。</font></font></li>
<li><code>-fmacro-prefix-map=OLD=NEW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gcc 8以降で使用可能で、__ FILE__マクロを使用することで再現性の問題を解決します。</font></font></li>
<li><code>-ffile-prefix-map=OLD=NEW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gcc 8以降で使用可能で、-fdebug-prefix-mapと-fmacro-prefix-mapの結合です。</font></font></li>
</ul></li>
<li><code>clang</code><font style="vertical-align: inherit;"></font><code>-fdebug-prefix-map=OLD=NEW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バージョン3.8から</font><font style="vertical-align: inherit;">サポートさ</font><font style="vertical-align: inherit;">れ、将来のバージョンで他の2つのフラグのサポートに取り組んでいます。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この問題を解決する最良の方法は、コンパイラオプションにフラグを追加することです。</font><font style="vertical-align: inherit;">CMakeを使用する場合：</font></font><br>
<br>
<pre><code class="cpp hljs">target_compile_options(target PUBLIC <span class="hljs-string">"-ffile-prefix-map=${CMAKE_SOURCE_DIR}=."</span>)
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビルドシステムでのファイルの順序</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイルのリストを作成するためにディレクトリを読み取る場合、ファイルの順序が問題になることがあります。たとえば、Unixにはreaddir（）とlistdir（）がディレクトリのコンテンツを返す必要があるという確定的な順序がないため、これらの関数を信頼してアセンブリシステムにフィードすると、アセンブリが確定できない可能性があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、ビルドシステムがリンカーのファイルをコンテナー（たとえば、通常のpython辞書）に格納している場合、同じ問題が発生します。これにより、要素が非決定的な順序で返される可能性があります。これにより、ファイルは毎回異なる順序でリンクされ、異なるバイナリファイルが作成されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CMakeでファイルを再配置することにより、この問題をシミュレートできます。前の例を変更して、ライブラリに複数のソースファイルを含める場合：</font></font><br>
<br>
<pre><code class="cpp hljs">.<font></font>
├── CMakeLists.txt<font></font>
├── CMakeListsA.txt<font></font>
├── CMakeListsB.txt<font></font>
├── hello_world.cpp<font></font>
├── hello_world.hpp<font></font>
├── main.cpp<font></font>
├── sources0.cpp<font></font>
├── sources0.hpp<font></font>
├── sources1.cpp<font></font>
├── sources1.hpp<font></font>
├── sources2.cpp<font></font>
└── sources2.hpp</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
でファイルの順序を変更すると、コンパイル結果が異なることがわかります</font></font><code>CMakeLists.txt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs">cmake_minimum_required(VERSION <span class="hljs-number">3.0</span>)<font></font>
project(HelloWorld)<font></font>
<span class="hljs-built_in">set</span>(CMAKE_CXX_STANDARD <span class="hljs-number">11</span>)
<span class="hljs-built_in">set</span>(CMAKE_CXX_STANDARD_REQUIRED ON)<font></font>
add_library(HelloLib hello_world.cpp <font></font>
                     sources0.cpp <font></font>
                     sources1.cpp <font></font>
                     sources2.cpp)<font></font>
add_executable(hello main.cpp)<font></font>
target_link_libraries(hello HelloLib)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AとBという名前の2つの連続したアセンブリ、swapping </font></font><code>sources0.cpp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、および</font></font><code>sources1.cpp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルのリストを作成すると、次のチェックサムが得られます。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-number">30</span>ab264d6f8e1784282cd1a415c067f2  helloA<font></font>
cdf3c9dd968f7363dc9e8b40918d83af  helloB<font></font>
<span class="hljs-number">707</span>c71bc2a8def6885b96fb67b84d79c  hello_worldA.cpp.o
<span class="hljs-number">707</span>c71bc2a8def6885b96fb67b84d79c  hello_worldB.cpp.o
<span class="hljs-number">694f</span>f3765b688e6faeebf283052629a3  sources0A.cpp.o
<span class="hljs-number">694f</span>f3765b688e6faeebf283052629a3  sources0B.cpp.o
<span class="hljs-number">0</span>db24dc6a94da1d167c68b96ff319e56  sources1A.cpp.o
<span class="hljs-number">0</span>db24dc6a94da1d167c68b96ff319e56  sources1B.cpp.o<font></font>
fd0754d9a4a44b0fcc4e4f3c66ad187c  sources2A.cpp.o<font></font>
fd0754d9a4a44b0fcc4e4f3c66ad187c  sources2B.cpp.o<font></font>
baba9709d69c9e5fd51ad985ee328172  libHelloLibA.a<font></font>
<span class="hljs-number">72641</span>dc6fc4f4db04166255f62803353  libHelloLibB.a</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
オブジェクト</font></font><code>.o</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルは同一ですが、</font></font><code>.</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライブラリと実行可能</font><font style="vertical-align: inherit;">ファイルは同一で</font><font style="vertical-align: inherit;">はありません。</font><font style="vertical-align: inherit;">これは、ライブラリへの挿入の順序が、ファイルがリストされている順序に依存するためです。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンパイラーがランダム性を作成</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この問題は、たとえば、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リンク時最適化</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（フラグ</font></font><code>-flto</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）が</font><font style="vertical-align: inherit;">アクティブになって</font><font style="vertical-align: inherit;">いる</font><font style="vertical-align: inherit;">ときにgccで発生します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このオプションは、ランダムに生成された名前をバイナリファイルに挿入します。</font><font style="vertical-align: inherit;">この問題を回避する唯一の方法は、フラグを使用することです-</font></font><code>frandom-seed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このオプションは、乱数の代わりにgccが使用するシードを提供します。</font><font style="vertical-align: inherit;">特定のシンボル名を生成するために使用されます。これは、コンパイルされたファイルごとに異なる必要があります。</font><font style="vertical-align: inherit;">また、データカバレッジファイルとそれらを生成するオブジェクトファイルに一意のスタンプを配置するためにも使用されます。</font><font style="vertical-align: inherit;">このパラメーターは、ソースファイルごとに異なる必要があります。</font><font style="vertical-align: inherit;">1つのオプションは、ファイルのチェックサムを設定して、衝突の可能性が非常に低くなるようにすることです。</font><font style="vertical-align: inherit;">たとえば、CMakeでは、次の関数を使用してこれを実行できます。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-built_in">set</span>(LIB_SOURCES<font></font>
    ./src/source1.cpp<font></font>
    ./src/source2.cpp<font></font>
    ./src/source3.cpp)<font></font>
<font></font>
foreach(_file ${LIB_SOURCES})<font></font>
    file(SHA1 ${_file} checksum)<font></font>
    <span class="hljs-built_in">string</span>(SUBSTRING ${checksum} <span class="hljs-number">0</span> <span class="hljs-number">8</span> checksum)<font></font>
    set_property(SOURCE ${_file} APPEND_STRING PROPERTY COMPILE_FLAGS <span class="hljs-string">"-frandom-seed=0x${checksum}"</span>)<font></font>
endforeach()</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コナンを使用するためのいくつかのヒント</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conan </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">フック</font></a><font style="vertical-align: inherit;">は、ビルドを再現可能にするのに役立ちます。</font><font style="vertical-align: inherit;">この機能により、特定のポイントでのクライアントの動作を構成できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フックを使用する1つの方法は、ステップで環境変数を設定すること</font></font><code>pre_build</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">次の例では、関数が呼び出され</font></font><code>set_environment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、を</font></font><code>post_build</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">してステップの環境が復元され</font></font><code>reset_environment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">def <span class="hljs-title">set_environment</span><span class="hljs-params">(self)</span>:
    <span class="hljs-keyword">if</span> self._os </span>== <span class="hljs-string">"Linux"</span>:<font></font>
        self._old_source_date_epoch = os.environ.get(<span class="hljs-string">"SOURCE_DATE_EPOCH"</span>)<font></font>
        timestamp = <span class="hljs-string">"1564483496"</span>
        os.environ[<span class="hljs-string">"SOURCE_DATE_EPOCH"</span>] = timestamp<font></font>
        self._output.info(<font></font>
            <span class="hljs-string">"set SOURCE_DATE_EPOCH: {}"</span>.format(timestamp))<font></font>
    elif self._os == <span class="hljs-string">"Macos"</span>:<font></font>
        os.environ[<span class="hljs-string">"ZERO_AR_DATE"</span>] = <span class="hljs-string">"1"</span><font></font>
        self._output.info(<font></font>
            <span class="hljs-string">"set ZERO_AR_DATE: {}"</span>.format(timestamp))<font></font>
<font></font>
def reset_environment(self):<font></font>
    <span class="hljs-keyword">if</span> self._os == <span class="hljs-string">"Linux"</span>:
        <span class="hljs-keyword">if</span> self._old_source_date_epoch is None:<font></font>
            del os.environ[<span class="hljs-string">"SOURCE_DATE_EPOCH"</span>]
        <span class="hljs-keyword">else</span>:<font></font>
            os.environ[<span class="hljs-string">"SOURCE_DATE_EPOCH"</span>] = self._old_source_date_epoch<font></font>
    elif self._os == <span class="hljs-string">"Macos"</span>:<font></font>
        del os.environ[<span class="hljs-string">"ZERO_AR_DATE"</span>]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フックは、ステップでバイナリファイルを修正する場合にも役立ちます</font></font><code>post_build</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">そこのような異なるバイナリ解析と補正ツールは、ある</font></font><code>ducible</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>pefile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>pe-parse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">または</font></font><code>strip-nondeterminism</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">PEを使用してバイナリを修正するフックの例は</font></font><code>ducible</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次のとおりです。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">class <span class="hljs-title">Patcher</span><span class="hljs-params">(object)</span>:
...
    def <span class="hljs-title">patch</span><span class="hljs-params">(self)</span>:
        <span class="hljs-keyword">if</span> self._os </span>== <span class="hljs-string">"Windows"</span> <span class="hljs-keyword">and</span> self._compiler == <span class="hljs-string">"Visual Studio"</span>:
            <span class="hljs-keyword">for</span> root, _, filenames in os.walk(self._conanfile.build_folder):
                <span class="hljs-keyword">for</span> filename in filenames:<font></font>
                    filename = os.path.join(root, filename)<font></font>
                    <span class="hljs-keyword">if</span> <span class="hljs-string">".exe"</span> in filename <span class="hljs-keyword">or</span> <span class="hljs-string">".dll"</span> in filename:<font></font>
                        self._patch_pe(filename)<font></font>
<font></font>
    def _patch_pe(self, filename):<font></font>
        patch_tool_location = <span class="hljs-string">"C:/ducible/ducible.exe"</span>
        <span class="hljs-keyword">if</span> os.path.isfile(patch_tool_location):<font></font>
            self._output.info(<span class="hljs-string">"Patching {} with md5sum: {}"</span>.format(filename,md5sum(filename)))<font></font>
            self._conanfile.run(<span class="hljs-string">"{} {}"</span>.format(patch_tool_location, filename))<font></font>
            self._output.info(<span class="hljs-string">"Patched file: {} with md5sum: {}"</span>.format(filename,md5sum(filename)))<font></font>
...<font></font>
<font></font>
def pre_build(output, conanfile, **kwargs):<font></font>
    lib_patcher.init(output, conanfile)<font></font>
    lib_patcher.set_environment()<font></font>
<font></font>
def post_build(output, conanfile, **kwargs):<font></font>
    lib_patcher.patch()<font></font>
    lib_patcher.reset_environment()</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">調査結果</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
確定的アセンブリは、使用されるオペレーティングシステムとツールキットに密接に関連する複雑なタスクです。</font><font style="vertical-align: inherit;">この紹介は、決定論の欠如の最も一般的な原因とそれらに対処する方法を理解するのに役立つはずでした。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参考文献</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一般情報</font></font></h4><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.chromium.org/developers/testing/isolated-testing/deterministic-builds</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reproducible-builds.org</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wiki.yoctoproject.org/wiki/Reproducible_Builds</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stackoverflow.com/questions/1180852/deterministic-builds-under-windows</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docs.microsoft.com/en-us/windows/win32/debug/pe-format#archive-library-file-format</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devblogs.microsoft.com/oldnewthing/20180103-00/?p=97705</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.geoffchappell.com/studies/msvc/link/link/options/brepro.htm?tx=37&amp;ts=0</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、267</font></font></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ツール</font></font></h4><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バイナリ比較ツール</font></font></b><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diffoscope.org</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docs.microsoft.com/en-us/windows-server/administration/windows-commands/fc</font></font></a></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイル修復ツール</font></font></b><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">salsa.debian.org/reproducible-builds/strip-nondeterminism</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/erocarrera/pefile</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/trailofbits/pe-parse</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/smarttechnologies/peparser</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/google/syzygy</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/nh2/ar-timestamp-wiper</font></font></a></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイル分析ツール</font></font></b><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docs.microsoft.com/en-us/cpp/build/reference/dumpbin-reference?view=vs-2019</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sourceware.org/binutils/docs/binutils/readelf.html</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/llvm-mirror/llvm/tree/master/tools</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/lief-project/LIEF</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
→ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初の部分を読む</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja468543/index.html">平日プログラム委員会フロントエンド会議。セルゲイ・ポポフとのインタビュー</a></li>
<li><a href="../ja468545/index.html">「アリス、フロントエンドに行こう！」</a></li>
<li><a href="../ja468547/index.html">FrontendConfでの英語圏、CSS、グリッド、およびアクセシビリティ</a></li>
<li><a href="../ja468549/index.html">GPUバウンド。すべてをビデオカードに転送する方法など。アニメーション</a></li>
<li><a href="../ja468553/index.html">バージョン管理システムと同様のビジネスアプリケーションでのパラメーター管理</a></li>
<li><a href="../ja468557/index.html">WEB 3.0-発射物への2番目のアプローチ</a></li>
<li><a href="../ja468559/index.html">クラウドのバックアップ、友達</a></li>
<li><a href="../ja468561/index.html">セキュリティウィーク39：セキュリティと一般的なミス</a></li>
<li><a href="../ja468563/index.html">ウォッチメンウォッチ：宇宙追跡施設の現状</a></li>
<li><a href="../ja468565/index.html">ESP8266の自家製ガイガーカウンターとタッチスクリーン</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>