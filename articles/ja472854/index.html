<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧑🏼 👩🏿‍🤝‍👨🏾 👨‍👨‍👧‍👧 Unity UIプロファイリング：誰が私のバッチ処理を台無しにするか？ 🧣 ⏺️ 🎅</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Unity UIの最適化に無限の時間を費やしました。ただし、抑制を発生させるには、ほとんど見えないUI Canvas要素の小さな属性を少し変更するだけで十分です。そして、それが発生した場合でも、Unity UIをプロファイリングしても、FPSの低下を防ぐことはできません。長いバグ修正の準備はできてい...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Unity UIプロファイリング：誰が私のバッチ処理を台無しにするか？</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472854/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/r6/wn/1j/r6wn1jozbycrjiy7ddbrwfkrelm.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unity UIの最適化に無限の時間を費やしました。ただし、抑制を発生させるには、ほとんど見えないUI Canvas要素の小さな属性を少し変更するだけで十分です。そして、それが発生した場合でも、Unity UIをプロファイリングしても、FPSの低下を防ぐことはできません。長いバグ修正の準備はできていますか？</font></font></i><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これがまさに私の最後のプロジェクトで起こったことです...</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
私は</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oculus Questでの</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゲームの移植でいくつかのUIパネルの最適化に懸命に取り組みました</font><font style="vertical-align: inherit;">。基本的には、GPUが最も重要なこと、つまり実際の3Dレンダリングに対応できるように、オーバードローレベルを許容値に下げることがタスクでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
だから私は少なくとも1か月間Unity UIの最適化に取り組み、時間の経過とともにかなりの進歩を遂げました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ある時点で、UIは非常に最適化されたため、GPUタイミングにはほとんど影響しませんでした。私が実装した不透明なUIの減光技術は、UI（他の要素の上に描画される要素）を重ねることによって引き起こされるほとんどの再描画を補正しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのため、高度に最適化されたハイブリッドUIシステムを取得しました。これは、その下に描画された3D要素と本質的に重なっています。これらのオーバーラップしたフラグメントのレンダリングを破棄するのは非常に簡単になりました。</font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">しかし、作業はまだ完全ではありませんでした... </font></font></em><font style="vertical-align: inherit;"><em><font style="vertical-align: inherit;">Unity UIプロファイラー</font></em></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
を接続したとき</font><font style="vertical-align: inherit;">、1つのことに注意を向けました。</font><font style="vertical-align: inherit;">
過負荷のCPU </font><font style="vertical-align: inherit;">がUIのレンダリング</font><font style="vertical-align: inherit;">に各フレーム</font><font style="vertical-align: inherit;">で</font><em><font style="vertical-align: inherit;">1ミリ秒</font></em><font style="vertical-align: inherit;">以上を費やすことを確認しました</font><font style="vertical-align: inherit;">。これは、</font><em><font style="vertical-align: inherit;">13ミリ秒の</font></em><font style="vertical-align: inherit;">予算を提供するプラットフォームにとっては膨大な時間</font><em><font style="vertical-align: inherit;">です。</font></em></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゲーム全体を完了するには：物理学、ロジック、3Dレンダリング、入力、VR、ネットワークコード。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、UIがCPUのパフォーマンスをさらに低下させる場合がありました。</font></font><a name="habracut"></a><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/67c/3ba/b71/67c3bab71f90eccec18cd823ba554ce4.png"></div><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unity UI：コストのかかるビルドバッチ。</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
これは1つのことを言います：</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIはGPUに最適化できますが、これは必ずしもCPUの最適化を意味するわけではありません</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、Unity UIをレンダリングする場合、CPUタスクとGPUタスクは大きく異なります。当然のことながら、私はCPUとGPUの最適化に異なるアプローチをとることをお勧めします。これについては、以前の投稿で</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="external nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unity UI最適化</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">について説明しました</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unity UIをさらにプロファイリングすると、明らかな問題が明らかになりました。UIは新しいフレームごとに常に再作成されました。</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Canvas（Canvas Rebuild）は、各フレームで再構築されました</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><em><font style="vertical-align: inherit;">1ミリ秒</font></em></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
の間CPUに一定の負荷が</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">かかり</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます... oh-oh。</font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">しかし、なぜUnityは私にこれをしているのですか？</font></font></em> <em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UnityはすべてのCanvasインターフェースをキャッシュすると思いました...</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
実際、そうです。 UnityはCanvasを効果的にキャッシュして、1回だけ収集されるようにします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、問題は、キャンバス内の任意のUI要素のプロパティ（色、位置など）を変更するときに発生します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、私たちが大好きなすべてのアニメーション、たとえば、ホバーしたときのボタンの効果、生産性を殺したとき、おそらくそれを知らないでしょう。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIプロパティの変更が発生すると、Unityは有名なCanvas Rebuildを実行し、ゲームのパフォーマンスを台無しにします</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インターフェースのCanvas Rebuildは、UnityエンジンにCanvas UIのすべての要素を繰り返しトラバースして、描画呼び出し（多くの頂点、色、マテリアルなど）の最適化されたリストを生成します。</font><font style="vertical-align: inherit;">そしてCanvas Rebuildは、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seat Panda</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0から60 mph</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に加速</font><font style="vertical-align: inherit;">するのにかかる時間よりも長くかかります</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは常にCanvas Rebuildに苦しんでいることを認識して、質問をするのは理にかなっています... </font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なぜ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Canvas Rebuildに</font><em><font style="vertical-align: inherit;">苦しんでいるのですか？それについて何ができるのですか？</font></em></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この簡単な質問に答えるために、私は5時間以上かけてトピックを研究し、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unity UIプロファイラーを操作する必要がありました</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それを正しくしましょう。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Unity UIのプロファイリング：今のところすべて順調です...</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
単純なUIがあるとします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このUIは何も実行せず、画面に表示されるだけで、プレイヤーが何かを見ようとするのを邪魔します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グリッドレイアウトグループの350以上の画像のセットとして、次のようになります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dd4/426/32a/dd442632a007e73ae8bd5e61a166ccf1.jpg"></div><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unity UIプロファイリングの例</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
。350以上の画像にもかかわらず、これで問題ありません。</font><font style="vertical-align: inherit;">標準の場合、UIは2つの描画呼び出しでレンダリングされます。これは、スプライトアトラスにはない一意の画像が2つしかないためです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、プロファイラーでは、CPUの部分に実質的に負荷がかかっていないことがわかります。</font><font style="vertical-align: inherit;">UIに費やされる</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">時間のほとんどは</font></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.01ミリ秒</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未満</font><font style="vertical-align: inherit;">であり、これは非常に優れています。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/946/be0/f2f/946be0f2f42a4374467b4e8ea95d537e.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unity UIプロファイリング：不可解なバースト</font></font></i><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（ほとんどの場合）</font></font></em><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">少し待ってください。このCPUリソースのバーストは、グラフの最後でどこから発生したのですか。</font></font></em><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Unity UIプロファイリング：突然のキャンバスの再構築！</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unityプロファイルの最後に何が起こりましたか？</font><font style="vertical-align: inherit;">非常に奇妙なことですが、ほんの一瞬で、Unity UIのCPUオーバーヘッドは2倍以上になりました。</font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゲームをプレイしたい</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
以下の例で2つの違いを見つけ</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">てください（おそらく、見やすくするために、別のウィンドウで画像を開く必要があります）</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dd2/836/f9e/dd2836f9e617fe165c546d0644cf62bf.png"></div><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unity UIプロファイリング：低コストのキャンバス</font></font></em><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/df0/d11/69c/df0d1169cff9c9a2e6e76970a1cc9d7c.png"></div><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unity UIのプロファイリング：Canvas Rebuild</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
それを理解するのに5秒かかります。</font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5、4 ...わかりました、タスクを簡略化するためのヒントを次に示します。</font></font></em><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f4b/aad/439/f4baad43996f2b73f2f9003523d26e7f.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unity UIプロファイリング：過剰なキャンバスの再構築コストが</font></font></i><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すごい！</font></font></em><br>
<br>
<code>PostLateUpdate.UpdateRectTransform</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして</font></font><code>UGUI.Rendering.UpdateBatches</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、実際にこのショーの主役になりたいです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの領域は何をしますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1つ目は</font></font><code>UpdateRectTransform</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、一部のオブジェクトの変換が変更されたことを明確にするため、視覚的な変更を反映するためにUnityは高価なロジックを実行する必要があります。位置、回転、スケール、その他のプロパティであるかどうかはわかりません</font></font><code>RectTransform</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
地獄、それがただ一つの属性だったのか、それとも一度にすべてだったのかもわかりません。それは単一のオブジェクトですか、それとも複数ですか？そして、どれ？</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それが問題です：わかりません</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目のコストのかかるフラグメントは、</font></font><code>UpdateBatches</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Canvasジオメトリ全体を再構築する必要があるという事実に関連しています。このプロセスは</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キャンバスの再構築</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">Canvasを再構築するということは、UnityがCanvas階層全体を回って描画呼び出しのリストを生成することを意味します。</font><font style="vertical-align: inherit;">すべての要素の頂点、インデックス、色、およびuvが計算され、次に可能なパスの最大数を組み合わせて描画呼び出しが結合され、CPUへの過度の負荷が軽減されてグラフィックスドライバーに転送されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今、私たちは何が起こっているかを知っているようで、正しい軌道に乗っています。</font><font style="vertical-align: inherit;">しかし、このキャンバスのオーバーホールを回避するにはどうすればよいですか？</font><font style="vertical-align: inherit;">何が原因ですか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
より具体的な情報が必要です... </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要約するには</font></font></strong><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UI要素の属性を変更すると、要素自体がダーティとしてマークされます</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UI要素は完全に汚れている場合がありますが、部分的に汚れている場合もあります。汚れた上部、汚れたレイアウト、汚れたマテリアルなどです。</font><font style="vertical-align: inherit;">部分的にダーティな状態から回復する方が簡単です</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Canvas要素がダーティとしてマークされると、Unityはそれを完全に再構築します</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キャンバスの再構築はCPUにとってコストがかかるため、避けるべき最も重要なことは</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.害虫を探す：政治的に不正確な力ずくの方法</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、次の質問に答える必要があり</font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。これらのCanvas Rebuildの原因は何ですか？</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それはターン</font><font style="vertical-align: inherit;">何もありませんことを</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">素早く</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">見つけるための方法は、特に大きなキャンバスの階層で、。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、最初に、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Canvas Rebuildの理由を見つけるためのブルートフォースメソッドを</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">紹介します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/85c/595/242/85c5952429acc0a55f174400284dcf86.png"></div><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Unity UIプロファイラーに引き続き測定値を記録</font></font></strong><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
させ、レンダリング、スクリプト、UIなどの最も重要なものに集中できるように、メトリック</font><strong><font style="vertical-align: inherit;">を</font></strong><font style="vertical-align: inherit;">除外します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初のマークを追跡して、現在のスキームのコストを理解します。これには、コストのかかるCanvas Rebuildが含まれます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/127/b62/df2/127b62df2a89cb5d6bf94a79883a7547.png"></div><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. UIから</font></font></strong><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ゲームオブジェクトを非アクティブ化し、</font><strong><font style="vertical-align: inherit;">測定値を比較します。</font></strong><font style="vertical-align: inherit;">ゲームオブジェクトのグループを選択して非アクティブ化します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パフォーマンスメトリックを比較します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
読み取り値があまり改善されていない場合は、大幅な改善が見られるまでゲームオブジェクトを非アクティブ化し続けます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0ae/18c/c17/0ae18cc17731bebb6b83b2a42e99e192.png"></div><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.プロパティを変更するものを見つける</font></font></strong><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Canvas Rebuildを呼び出すオブジェクトを選択することができました。しかし、何が原因なのでしょうか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おそらく、そのスケールはスクリプトによって変化しますか？それとも彼の位置はアニメーションによって変化しているのでしょうか？</font><em><font style="vertical-align: inherit;">RectTransform</font></em></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
を右クリックし</font><font style="vertical-align: inherit;">て[ </font><em><font style="vertical-align: inherit;">シーン内の参照を検索</font></em><font style="vertical-align: inherit;"> ] </font><font style="vertical-align: inherit;">を選択</font><font style="vertical-align: inherit;">すると便利</font><font style="vertical-align: inherit;">
です</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">キャンバスの再構築の原因を見つけたら、アニメーションや変換をオフにするなど、何かを行います。</font><em><font style="vertical-align: inherit;">ルーベンですが、UIの巨大な階層でこのメソッドを使用するにはどうすればよいですか？</font></em><font style="vertical-align: inherit;"> 
このプロセスは迅速でも面白くも</font><em><font style="vertical-align: inherit;">ないと私が言ったナンセンス</font></em><font style="vertical-align: inherit;">を私に言わ</font><em><font style="vertical-align: inherit;">ないでください</font></em><font style="vertical-align: inherit;">、しかしプレーヤーはあなたに感謝します。</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<em><font style="vertical-align: inherit;"></font></em><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そこが肝心だ。</font><font style="vertical-align: inherit;">第一に、巨大な階層の存在は理想的な状況ではありません。</font><font style="vertical-align: inherit;">Canvas RebuildをCPUにとって非常に高価にするのは、このような大規模で深い階層です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、大規模でネストされたUI階層が発生する可能性があるので、Canvas Rebuildが最も重要なこと、つまりゲームプレイにヒットすることを期待してください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
総当たりの方法はCanvasオーバーホールの原因を見つけるのに役立ちますが、長期的にはうまくスケーリングしません。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIの最適化の専門家として、プロジェクトがプレイヤーの期待に応えられるように、必要なすべての答えを提供するツールを作成しました</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ...</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/16c/8a0/e91/16c8a0e91e1f4289bba8c314eb25562b.png"></div><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロファイリングキャンバスの再構築</font></font></em><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.ボーナス：UnityプロファイラーUI最適化機能の強化</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Canvas Rebuildがどれほど頻繁に発生し、不穏になるかをすでにご理解いただければ幸いです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私のゲームに感染したこれらのペレストロイカは、CPU全体の予算の10％も奪いました！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これまで見てきたように、Canvas Rebuildソースを見つけるためのブルートフォースメソッドがあります。おそらく、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="external nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unity UIの最適化</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に関する私の投稿にリストされている戦略を使用してそれらに対処できます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、そのようなエラーが発生しやすいプロセスは、本当の第一人者を満足させることは決してありません。 Canvas Rebuildに苦労して数日を過ごすことはできますが、最も予期しない瞬間には、Unity UIプロファイラーを接続するとすぐに消えてしまいます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VR用のゲームを開発している場合、これは重要になります。 CanvasがワールドスペースのUIで再構築されることを望まない。ペレストロイカを取り除くことができない場合、プレイヤーはそれに耐えられない可能性が高くなります。</font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さて、Canvas Rebuildsを取り除くというアイデアを思いつきました。しかし、Unityプロファイラーはそれらに関する情報をほとんど提供しません！何をアドバイスできますか？</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
よろしくお願いします。これは、ことが判明し</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、我々はUIのパフォーマンスを妨げるかについての有益な情報をご提供するために、ユニティプロファイラを説得することができます</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><em><font style="vertical-align: inherit;">Unity UIプロファイラーの</font></em></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
機能を拡張でき</font><font style="vertical-align: inherit;">ます。これを行うには、公開されているUnity UIソースコードを変更する必要があります。ソースコードに到達し</font><strong><font style="vertical-align: inherit;">たら、Canvas Rebuildsが発生するコード関数</font></strong><font style="vertical-align: inherit;">を</font><strong><font style="vertical-align: inherit;">見つける</font></strong><font style="vertical-align: inherit;">必要があり</font><strong><font style="vertical-align: inherit;">ます。</font></strong></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">その後、我々は持つAPIの魔法必要</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="external nofollow"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BeginSample</font></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="external nofollow"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EndSample</font></font></em></a><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロファイラを</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unity 2019.1以前を実行している場合、Unity UIのソースコード</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="external nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はBitbucketリポジトリにあります</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ダウンロード、インストール、変更のためのガイドもあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は何をアドバイスしますか？</font><font style="vertical-align: inherit;">2019.2.0以上の新しいバージョンのUnityを使用してください。</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しいバージョンのUnity</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">には、UIシステムがパッケージマネージャーの一部となっているため、</font><strong><font style="vertical-align: inherit;">デフォルトでソースUIが付属しています</font></strong><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは最も手間のかからない方法です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、プロファイリングAPI呼び出しを追加できる調査中に発見したコードのリストです。</font></font><br>
<br>
<ul>
<li><em><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CanvasUpdateRegistry.cs</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="external nofollow"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PerformUpdate関数</font></font></em></a></em><br>
 </li>
<li> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Graphic.cs</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="external nofollow"><font style="vertical-align: inherit;">SetAllDirty</font></a><font style="vertical-align: inherit;">関数</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="external nofollow"><font style="vertical-align: inherit;"></font></a><br>
 </li>
<li> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Graphic.cs</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="external nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SetVerticesDirty</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="external nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SetMaterialDirty</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">などの</font><font style="vertical-align: inherit;">他の関数</font><font style="vertical-align: inherit;">...</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/92c/cfa/f5a/92ccfaf5ad950c1236f2b68c24cc3295.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unity UI：ソースコードのプロファイリングは</font></font></i> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
役に立ちましたか？</font><font style="vertical-align: inherit;">はい。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アーティスト/デザイナーにとって便利ですか？</font><font style="vertical-align: inherit;">番号。</font><strong><font style="vertical-align: inherit;">Unityプロファイラーの機能を</font></strong><strong><em><font style="vertical-align: inherit;">拡張</font></em></strong><strong><font style="vertical-align: inherit;">する小さな</font></strong><strong><font style="vertical-align: inherit;">オープンソースの</font></strong><strong><em><font style="vertical-align: inherit;">Unity拡張機能</font></em></strong></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
を</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">書いたの</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は詩人でした</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f7d/675/185/f7d675185b4e9e2196ef32a0b6362255.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この無料のツールを使用すると、さまざまなプロファイリングモードをすばやく切り替えて、最大のゲームパフォーマンスを確保できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このUnityプロファイラーエキスパンダーの最も良い点は何ですか？</font><font style="vertical-align: inherit;">これはエディターの外部で機能し、Androidおよびその他のプラットフォームのUIをプロファイリングする際の基本的な悩みから解放されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、そのすべての電力は2つのボタンだけで制御されます。</font></font><br>
<br>
<ul>
<li> <em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unityプロファイラーのバフ</font></font></em><br>
 </li>
<li> <em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私のユニティプロファイラポイントでNerf</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このツールは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="external nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちらから</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">入手でき</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="external nofollow"><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja472838/index.html">実際には、80〜90％のケースで、フロントエンドが原因でWebアプリケーションが遅くなっています。IvanAkulovへのインタビュー</a></li>
<li><a href="../ja472840/index.html">ソフトウェアデファインドストレージ、または何が恐竜を殺したのか？</a></li>
<li><a href="../ja472848/index.html">ITキャリアについての考察</a></li>
<li><a href="../ja472850/index.html">職業または生活：恐れることがなければ、Netologyコースを勝ち取ってください</a></li>
<li><a href="../ja472852/index.html">GitLabはクラウドおよび商用製品のユーザーのために変更を加えます</a></li>
<li><a href="../ja472856/index.html">テーブルとスティックから品質管理サービスを作成する方法</a></li>
<li><a href="../ja472858/index.html">Pythonおよび高速HTTPクライアント</a></li>
<li><a href="../ja472860/index.html">カスケードキャッシュの無効化。パート1</a></li>
<li><a href="../ja472862/index.html">カスケードキャッシュの無効化。パート2</a></li>
<li><a href="../ja472864/index.html">チェックポイント：CPUとRAMの最適化</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>