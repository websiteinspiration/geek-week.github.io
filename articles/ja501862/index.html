<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍❤️‍👨 🍟 📼 フードの下でフラッター 🕵🏾 🏊 🏢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="みなさん、こんにちは！私の名前はミハイルゾティエフです。サーフでFlutter開発者として働いています。私は、おそらくFlutterを使用する他の開発者の大多数と同様に、何よりも、その助けを借りて美しく便利なアプリケーションを作成するのがいかに簡単かが好きです。 Flutterの開発に取り掛かるのに...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>フードの下でフラッター</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/surfstudio/blog/501862/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">みなさん、こんにちは！私の名前はミハイルゾティエフです。サーフでFlutter開発者として働いています。私は、おそらくFlutterを使用する他の開発者の大多数と同様に、何よりも、その助けを借りて美しく便利なアプリケーションを作成するのがいかに簡単かが好きです。 Flutterの開発に取り掛かるのにほとんど時間はかかりません。私は最近ゲーム開発で働いていましたが、今ではFlutterでクロスプラットフォームのモバイル開発に完全に切り替えました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
シンプルさは何ですか？</font><font style="vertical-align: inherit;">ダースの基本的なウィジェットを使用すると、かなりまともなユーザーインターフェイスを構築できます。</font><font style="vertical-align: inherit;">そして、時間の経過とともに使用される手荷物がかなりまともな場合、珍しいデザインであれ洗練されたアニメーションであれ、なんらかのタスクによって停止することはまずありません。</font><font style="vertical-align: inherit;">そして、最も興味深いのは、「どのように機能するのか」という質問を考えなくても使用できることです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Flutterにはオープンソースがあるので、フードの下（フォースのダート側）を把握し、あなたと共有することにしました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lg/ln/q6/lglnq6t8sbc8gq-emifhx1dxjwu.png"><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウィジェット</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは皆、フレームワーク開発チームから</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「Flutterのすべてがウィジェットである」</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">というフレーズを何度も聞いてい</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これが本当にそうかどうか見てみましょう。</font><font style="vertical-align: inherit;">これを行うには、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウィジェット</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラス</font><font style="vertical-align: inherit;">（以下-ウィジェット）を使用して、コンテンツに徐々に慣れていきます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスのドキュメントで最初に読むこと：</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[要素]の構成について説明します。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ウィジェット自体は、いくつかの</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要素</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（以下、要素）の</font><font style="vertical-align: inherit;">単なる説明であることが</font><b><font style="vertical-align: inherit;">わかり</font></b><font style="vertical-align: inherit;">ます。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウィジェットは、Flutterフレームワークの中心的なクラス階層です。</font><font style="vertical-align: inherit;">ウィジェットは、ユーザーインターフェイスの一部の不変の説明です。</font><font style="vertical-align: inherit;">ウィジェットは要素にインフレートでき、基盤となるレンダーツリーを管理します。</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要約すると、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「Flutterのすべてがウィジェットです」</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">というフレーズ</font><font style="vertical-align: inherit;">は、Flutterを使用するためにすべてがどのように配置されているかを理解するための最小レベルです。</font><font style="vertical-align: inherit;">ウィジェットはFlutter階層の中心クラスです。</font><font style="vertical-align: inherit;">同時に、フレームワークがそのタスクに対処するのを助ける多くの追加のメカニズムがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そこで、さらにいくつかの事実を学びました。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウィジェット-ユーザーインターフェイスの一部の不変の説明。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウィジェットは、要素と呼ばれる高度なビューに関連付けられています。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要素は、Render Treeのエンティティを制御します。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
奇妙なことに気づいたに違いない。</font><font style="vertical-align: inherit;">ユーザーインターフェイスと不変性の適合性は非常に低く、これらは完全に互換性のない概念です。</font><font style="vertical-align: inherit;">ただし、Flutterの世界のデバイスのより完全な画像が表示されたら、これに戻りますが、今のところ、ウィジェットのドキュメントについては引き続き理解します。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウィジェット自体には変更可能な状態はありません（すべてのフィールドはfinalでなければなりません）。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可変状態をウィジェットに関連付けたい場合は、[StatefulWidget]を使用することを検討してください。[StatefulWidget]は、[StatefulWidget.createState]を介して[State]オブジェクトを作成します。</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この段落は、最初の段落を少し補足します。変更可能な構成が必要な場合は</font><font style="vertical-align: inherit;">、このウィジェットの現在の状態を説明する</font><font style="vertical-align: inherit;">特別な</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">State</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エンティティ</font><font style="vertical-align: inherit;">（以下、状態と呼び</font><font style="vertical-align: inherit;">ます）を使用し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">ただし、状態はウィジェットに関連付けられているのではなく、その要素表現に関連付けられています。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定のウィジェットは、ツリーに0回以上含めることができます。</font><font style="vertical-align: inherit;">特に、特定のウィジェットをツリーに複数回配置できます。</font><font style="vertical-align: inherit;">ウィジェットがツリーに配置されるたびに、[要素]にインフレートされます。つまり、ツリーに複数回組み込まれたウィジェットは、複数回インフレートされます。</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同じウィジェットをウィジェットツリーに何度も含めることも、まったく含めないこともできます。</font><font style="vertical-align: inherit;">ただし、ウィジェットがウィジェットツリーに含まれるたびに、要素がそれにマッピングされます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、この段階でウィジェットはほぼ完成しています。要約しましょう。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウィジェット-階層の中心クラス。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウィジェットはいくつかの設定です。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウィジェット-ユーザーインターフェイスの一部の不変の説明。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウィジェットは、何らかの方法でレンダリングを制御する要素に関連付けられています。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウィジェットの変化する状態は、エンティティによって記述できますが、ウィジェットとは関連付けられていませんが、このウィジェットを表す要素と関連付けられています。</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">素子</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちが学んだことから、質問は「すべてを支配するこれらの要素は何ですか？」</font><font style="vertical-align: inherit;">同じことを行います-Elementクラスのドキュメントを開きます。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ツリー内の特定の場所にある[ウィジェット]のインスタンス化。</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要素は、ツリー内の特定の場所にあるウィジェットを表現したものです。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウィジェットはサブツリーの構成方法を記述しますが、ウィジェットは不変であるため、同じウィジェットを使用して複数のサブツリーを同時に構成できます。</font><font style="vertical-align: inherit;">[要素]は、ウィジェットを使用してツリー内の特定の場所を構成することを表します。</font><font style="vertical-align: inherit;">時間の経過とともに、たとえば、親ウィジェットがこの場所の新しいウィジェットを再構築して作成した場合など、特定の要素に関連付けられたウィジェットは変更される可能性があります。</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウィジェットはユーザーインターフェースの一部の構成を記述しますが、すでに知っているように、同じウィジェットをツリーのさまざまな場所で使用できます。そのような場所はそれぞれ、対応する要素によって表されます。ただし、時間の経過とともに、アイテムに関連付けられているウィジェットが変更される可能性があります。つまり、要素はより粘り強く、引き続き使用され、それらの接続のみが更新されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これはかなり合理的な決定です。上記で既に定義したように、ウィジェットは不変の構成であり、インターフェースの特定の部分を単に記述するだけです。つまり、ウィジェットは非常に軽量でなければなりません。そして、コントロールの領域の要素ははるかに重いですが、それらは不必要に再作成されていません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これがどのように行われるかを理解するために、要素のライフサイクルを考慮してください：</font></font><br>
<br>
<ul>
<li>     Widget.createElement    ,     .</li>
<li>   mount        .              .</li>
<li>       .</li>
<li>   ,    (,    ),     .       runtimeType  key,     .   ,     ,           .</li>
<li> ,       ,    ,             ,      (  deactivate).</li>
<li>   ,     .           ,       ,   (unmount),           .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">たとえば、要素またはその祖先にグローバルキーがある場合、ツリーに要素を再度含めると、その要素は非アクティブな要素のリストから削除され、activateメソッドが呼び出され、この要素に関連付けられているレンダリングオブジェクトが再びRender Treeに埋め込まれます。</font><font style="vertical-align: inherit;">これは、アイテムが画面に再び表示されることを意味します。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラス宣言では、要素がBuildContextインターフェースを実装していることがわかります。</font><font style="vertical-align: inherit;">BuildContextは、ウィジェットツリーでのウィジェットの位置を制御するものです。</font><font style="vertical-align: inherit;">商品説明とほぼ完全に一致します。</font><font style="vertical-align: inherit;">このインターフェースは、要素の直接操作を回避するために使用されますが、同時に必要なコンテキストメソッドへのアクセスを提供します。</font><font style="vertical-align: inherit;">たとえば、この要素に対応するレンダーツリーオブジェクトを検索できるfindRenderObject。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レンダダーオブジェクト</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このトライアドの最後のリンクである</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RenderObjectを処理する必要があり</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。名前が示すように、これは視覚化ツリーのオブジェクトです。親オブジェクトと、このオブジェクト自体に関する特定の情報（位置など）を格納するために親オブジェクトが使用するデータフィールドがあります。このオブジェクトは、基本的なレンダリングおよびレイアウトプロトコルの実装を担当します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RenderObjectは、子オブジェクトの使用モデルを制限しません。存在しない場合も、1つまたは多数の場合もあります。</font><font style="vertical-align: inherit;">また、ポジショニングシステムは、デカルトシステム、極座標、これらすべてに限定されず、さらに多くのものが使用可能です。</font><font style="vertical-align: inherit;">ロケーションプロトコルの使用に関する制限はありません。幅または高さの調整、サイズの制限、親のサイズと場所の指定、または必要に応じて親オブジェクトのデータの使用。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フラッターワールドピクチャー</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてがどのように連携するかについての全体像を構築してみましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すでに前述したように、ウィジェットは不変の説明ですが、ユーザーインターフェイスは静的ではありません。</font><font style="vertical-align: inherit;">この不一致は、3レベルのオブジェクトに分割し、責任ゾーンを分割することで解消されます。</font></font><br>
<br>
<ul>
<li> ,          . </li>
<li> ,               . </li>
<li>  ,   — ,     .</li>
</ul><br>
<img src="https://habrastorage.org/webt/j_/n_/og/j_n_ogui1a0iawbuoq5vxclsnne.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのツリーがどのように見えるかを簡単な例で見てみましょう</font></font><br>
<br>
<img src="https://habrastorage.org/webt/u7/0o/wk/u70owkgirs6krcos85rwn-acli8.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。この場合、Paddingウィジェットにラップされ、内部にテキストを含むいくつかのStatelessWidgetがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Flutterの代わりに自分自身を置きましょう-このウィジェットツリーが与えられました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Flutter：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「ねえ、パディング、あなたの要素が必要です」</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
パディング：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「もちろん、SingleChildRenderObjectElementを保持してください」</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/jj/u7/zn/jju7znfat7skocfex74adc4cu7o.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Flutter：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「要素、ここがあなたの場所です、落ち着いてください」</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
SingleChildRenderObjectElement：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「みんな、大丈夫ですが、RenderObjectが必要です」</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Flutter：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「パディングなどあなたを引き付けるのですか？」</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
パディング：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「それを保持し、RenderPadding」</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
SingleChildRenderObjectElement：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「すばらしい、仕事に</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">取り掛かる</font><i><font style="vertical-align: inherit;">」</font></i></font><br>
<br>
<img src="https://habrastorage.org/webt/zk/ty/se/zktyse7pgo6jdd6x7impyivfhy0.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Flutter：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「次は誰ですか？」 StatelessWidget、</font></font></i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">ここで</font></i><i><font style="vertical-align: inherit;">要素を許可します»</font></i></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
StatelessWidget：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«ここでStatelessElement»</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Flutter：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«StatelessElement、これはSingleChildRenderObjectElementの影響を受けます、ここに着陸します»</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
StatelessElement：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«OK»</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/7w/tb/ke/7wtbkebtfn_xeq1ieqxqbarpkro.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Flutter：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«RichText、</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
elementik存在します</font><i><font style="vertical-align: inherit;">»</font></i><font style="vertical-align: inherit;"> RichTextはMultiChildRenderObjectElement </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Flutter </font><font style="vertical-align: inherit;">を提供します</font><font style="vertical-align: inherit;">：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「MultiChildRenderObjectElement、これから始めましょう」</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
MultiChildRenderObjectElement：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「仕事用のレンダーが必要です」</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Flutter：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「RichText、レンダーオブジェクトが必要です」</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
RichText：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「ここがRenderParagraphです」</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Flutter：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「RenderParagraphは、RenderPaddingの指示を受け取り、MultiChildRenderObjectElementを制御します」</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
MultiChildRenderObjectElement：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「これで、すべてが大丈夫です。準備が整いました」</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/s4/24/fn/s424fnivo4j2tb4sv9pcirmxov0.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
正当な質問をします。ディスプレイ付き？」</font><font style="vertical-align: inherit;">ライフサイクルの説明のこのセクションで説明した、mountメソッドの基本的な実装に注目してみましょう。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">void</span> mount(Element parent, dynamic newSlot) {<font></font>
    assert(_debugLifecycleState == _ElementLifecycle.initial);<font></font>
    assert(widget != <span class="hljs-literal">null</span>);<font></font>
    assert(_parent == <span class="hljs-literal">null</span>);<font></font>
    assert(parent == <span class="hljs-literal">null</span> || parent._debugLifecycleState == _ElementLifecycle.active);<font></font>
    assert(slot == <span class="hljs-literal">null</span>);<font></font>
    assert(depth == <span class="hljs-literal">null</span>);<font></font>
    assert(!_active);<font></font>
    _parent = parent;<font></font>
    _slot = newSlot;<font></font>
    _depth = _parent != <span class="hljs-literal">null</span> ? _parent.depth + <span class="hljs-number">1</span> : <span class="hljs-number">1</span>;<font></font>
    _active = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (parent != <span class="hljs-literal">null</span>)<font></font>
        _owner = parent.owner;<font></font>
    <span class="hljs-keyword">if</span> (widget.key is GlobalKey) {<font></font>
        final GlobalKey key = widget.key;<font></font>
        key._register(<span class="hljs-keyword">this</span>);<font></font>
    }<font></font>
    _updateInheritance();<font></font>
    assert(() {<font></font>
        _debugLifecycleState = _ElementLifecycle.active;<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
    }());<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
レンダリングオブジェクトの作成は表示されません。</font><font style="vertical-align: inherit;">ただし、要素は、次のゲッターにつながるfindRenderObject視覚化オブジェクト検索メソッドを持つBuildContextを実装します。</font></font><br>
<br>
<pre><code class="javascript hljs">RenderObject get renderObject {<font></font>
    RenderObject result;<font></font>
    <span class="hljs-keyword">void</span> visit(Element element) {<font></font>
        assert(result == <span class="hljs-literal">null</span>); 
        <span class="hljs-keyword">if</span> (element is RenderObjectElement)<font></font>
            result = element.renderObject;<font></font>
        <span class="hljs-keyword">else</span><font></font>
            element.visitChildren(visit);<font></font>
    }<font></font>
    visit(<span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">return</span> result;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
基本的なケースでは、要素がレンダリングオブジェクトを作成しない場合があります。これを行うには、RenderObjectElementとその子孫のみが必要ですが、この場合、ネストレベルの要素には、レンダリングオブジェクトを持つ子要素が必要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
なぜこれらすべての困難なのでしょう。 3本の木、責任の異なる分野など答えは非常に簡単です。ここでFlutterのパフォーマンスが構築されます。ウィジェットは不変の構成であるため、多くの場合再作成されますが、同時に非常に軽量であり、パフォーマンスに影響を与えません。しかしFlutterは可能な限り重い要素を再利用しようとしています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例を考えてみましょう。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">画面中央のテキスト。この場合のコードは次のようになります。</font></font></i><br>
<br>
<pre><code class="javascript hljs">body: Center(<font></font>
    child: Text(“Hello world!”)<font></font>
),</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場合、ウィジェットツリーは次のようになります</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lc/wt/fa/lcwtfazdhkpaprcu9tqvhssvck4.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。Flutterが3つすべてのツリーを構築すると、次の画像</font></font><br>
<br>
<img src="https://habrastorage.org/webt/uc/vx/ph/ucvxphu5r2ds-6_kmoizgyoczo8.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
が表示されます。表示するテキストを変更するとどうなりますか？</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_u/8b/do/_u8bdowthfzx9jshpbprfnpj1ai.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで新しいウィジェットツリーができました。上記では、要素の最大限の再利用について説明しました。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">canUpdate</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">という名前のWidgetクラスメソッドを見て</font><i><font style="vertical-align: inherit;">ください</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">static</span> bool canUpdate(Widget oldWidget, Widget newWidget) {
    <span class="hljs-keyword">return</span> oldWidget.runtimeType == newWidget.runtimeType &amp;&amp; oldWidget.key == newWidget.key;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以前のウィジェットと新しいウィジェットのタイプ、およびそれらのキーを確認します。同じであれば、アイテムを変更する必要はありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、アップグレード前の最初の要素はCenterであり、アップグレード後もCenterです。どちらにもキーはなく、完全に一致しています。アイテムのリンクを新しいウィジェットに更新できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/he/tr/s4/hetrs4cgzrimhibqeilfoja5xzi.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、タイプとキーに加えて、ウィジェットは説明と構成であり、表示に必要なパラメーターの値は変更される可能性があります。そのため、ウィジェットへのリンクを更新した後、要素はレンダリングオブジェクトの更新を開始する必要があります。センターの場合、何も変わっていないので、さらに比較を続けます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もう一度、タイプとキーは、要素を再作成しても意味がないことを示しています。テキストはStatelessWidgetの子孫であり、直接表示オブジェクトはありません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dp/yy/6m/dpyy6mckv6cddryb0_yu5asy_uy.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リッチテキストに移動します。ウィジェットもそのタイプを変更していないため、キーに不一致はありません。アイテムは、新しいウィジェットとの関連付けを更新します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hw/vh/95/hwvh952jekjwhudyj6czju3hq6a.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接続が更新され、プロパティを更新するためだけに残ります。その結果、RenderParagraphは新しいテキスト値を表示します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lv/_p/g-/lv_pg-n6wlmcmlunokumb60nqw0.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、次の描画フレームの時間が来るとすぐに、期待する結果が表示されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このような作業のおかげで、Flutterはそのような高いパフォーマンスを実現しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記の例は、ウィジェット構造自体が変更されていない場合を示しています。しかし、構造が変化するとどうなりますか？もちろん、Flutterは、ライフサイクルの説明から理解できるように、既存のオブジェクトを最大限に活用し続けますが、すべての新しいウィジェットに対して新しい要素が作成され、古くて不要な要素はフレームの最後で削除されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いくつかの例を見てみましょう。</font><font style="vertical-align: inherit;">上記を確認するために、Android StudioツールのFlutter Inspectorを使用します。</font></font><br>
<br>
<pre><code class="javascript hljs">@override<font></font>
Wid<span class="hljs-keyword">get</span> <span class="hljs-title">build</span>(<span class="hljs-params">BuildContext context</span>) {
    <span class="hljs-keyword">return</span> Scaffold(<font></font>
        body: Center(<font></font>
            child: _isFirst ? first() : second(),<font></font>
        ),<font></font>
        <span class="hljs-attr">floatingActionButton</span>: FloatingActionButton(<font></font>
            child: Text(<span class="hljs-string">"Switch"</span>),
            <span class="hljs-attr">onPressed</span>: () {<font></font>
                setState(() {<font></font>
                    _isFirst = !_isFirst;<font></font>
                });<font></font>
            },<font></font>
        ),<font></font>
    );<font></font>
}<font></font>
<font></font>
Wid<span class="hljs-keyword">get</span> <span class="hljs-title">first</span>() =&gt; <span class="hljs-title">Row</span>(<span class="hljs-params">
    mainAxisAlignment: MainAxisAlignment.center,
    children: &lt;Widget&gt;[
        Text(
            <span class="hljs-string">"test"</span>,
            style: TextStyle(fontSize: <span class="hljs-number">25</span></span>),<font></font>
        ),<font></font>
        <span class="hljs-title">SizedBox</span>(<span class="hljs-params">
            width: <span class="hljs-number">5</span>,
        </span>),
        <span class="hljs-title">Icon</span>(<span class="hljs-params">
            Icons.error,
        </span>),<font></font>
    ],<font></font>
);<font></font>
<font></font>
<span class="hljs-title">Widget</span> <span class="hljs-title">second</span>() =&gt; <span class="hljs-title">Row</span>(<span class="hljs-params">
    mainAxisAlignment: MainAxisAlignment.center,
    children: &lt;Widget&gt;[
        Text(
            <span class="hljs-string">"one more test"</span>,
            style: TextStyle(fontSize: <span class="hljs-number">25</span></span>),<font></font>
        ),<font></font>
        <span class="hljs-title">Padding</span>(<span class="hljs-params">
            padding: EdgeInsets.only(left: <span class="hljs-number">5</span></span>),<font></font>
        ),<font></font>
        <span class="hljs-title">Icon</span>(<span class="hljs-params">
            Icons.error,
        </span>),<font></font>
    ],<font></font>
);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場合、ボタンをクリックすると、ウィジェットの1つが変更されます。</font><font style="vertical-align: inherit;">インスペクターが何を示しているか見てみましょう。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wi/vt/vt/wivtvtojhv4uq3l7ouoje3le-u0.png" alt="画像"><br>
<br>
<img src="https://habrastorage.org/webt/f4/rb/0a/f4rb0avn7pombux2ct6pkap2edi.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のように、FlutterはPaddingのみのレンダーを再作成し、残りは再利用しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
構造がよりグローバルな方法で変化するもう1つのオプションを検討してください-ネストのレベルを変更します。</font></font><br>
<br>
<pre><code class="javascript hljs">Wid<span class="hljs-keyword">get</span> <span class="hljs-title">second</span>() =&gt; <span class="hljs-title">Container</span>(<span class="hljs-params">child: first(</span>),);</code></pre><br>
<img src="https://habrastorage.org/webt/yt/8i/gs/yt8igsxt3r3b-ofhkrlcyjaqryc.png" alt="画像"><br>
<br>
<img src="https://habrastorage.org/webt/j7/na/qw/j7naqwq6060sh-tw_atxna_umpa.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ツリーが視覚的にまったく変化しなかったという事実にもかかわらず、レンダリングツリーの要素とオブジェクトが再作成されました。</font><font style="vertical-align: inherit;">これは、Flutterがレベルで比較するため（この場合、ツリーのほとんどが変更されていないことは問題ではない）、コンテナと行を比較するときにこの部分のふるい分けが行われたために発生しました。</font><font style="vertical-align: inherit;">ただし、この状況から抜け出すことができます。</font><font style="vertical-align: inherit;">これは、GlobalKeyに役立ちます。</font><font style="vertical-align: inherit;">そのようなキーを行に追加します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">var</span> _key = GlobalKey(debugLabel: <span class="hljs-string">"testLabel"</span>);<font></font>
<font></font>
Wid<span class="hljs-keyword">get</span> <span class="hljs-title">first</span>() =&gt; <span class="hljs-title">Row</span>(<span class="hljs-params">
    key: _key,
    …
</span>);</code></pre><br>
<img src="https://habrastorage.org/webt/gg/jp/zj/ggjpzjlpox-ijhgtwxy-i6rvcsk.png" alt="画像"><br>
<br>
<img src="https://habrastorage.org/webt/zy/br/zy/zybrzywy-_ixs_apl7j1fiqsrco.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パーツを再利用できることをFlutterに伝えたらすぐに、彼はその機会を利用しました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論 </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Flutterマジックについて少し詳しく知りましたが、これはウィジェットだけではないことがわかりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Flutterは、独自の階層、責任の領域を備えた、よく考え抜かれたよく調整されたメカニズムであり、美しいだけでなく生産的なアプリケーションも作成できます。</font><font style="vertical-align: inherit;">もちろん、デバイスのかなり重要ではありますが、小さい部分のみを調べたので、今後の記事でフレームワークの内部作業のさまざまな側面を分析し続けます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事の情報がFlutterの内部動作の理解に役立ち、開発中にエレガントで生産的なソリューションを見つけるのに役立つことを願っています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご清聴ありがとうございました！</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">資源</font></font></h4><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フラッター</font></font></i><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"フラッターがウィジェットをレンダリングする方法"アンドリュー・フィッツギボン、マットサリバン</font></font></i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja501850/index.html">EMアルゴリズムを小さなレンガに分解します</a></li>
<li><a href="../ja501854/index.html">プログラミングを中止して実行を開始する方法</a></li>
<li><a href="../ja501856/index.html">Tarantool：アナリストルック</a></li>
<li><a href="../ja501858/index.html">すべてのドットを「psi」に置く</a></li>
<li><a href="../ja501860/index.html">5月15日RU-Centerは、お客様の参加なしに有料サービスを追加する場合があります</a></li>
<li><a href="../ja501864/index.html">アシスタントまたはインスペクター：ロボットは誰を呼び出していますか？</a></li>
<li><a href="../ja501866/index.html">ロボットが破壊するジョブの数</a></li>
<li><a href="../ja501868/index.html">会計士に自分を投げ込ませない方法、または1Cをクラウドに転送する方法。ステップバイステップの説明</a></li>
<li><a href="../ja501870/index.html">列挙型パートIIの値の最大数</a></li>
<li><a href="../ja501872/index.html">サイバネティックシステムの研究場所</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>