<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§‘ğŸ¿â€ğŸ¤â€ğŸ§‘ğŸ½ ğŸ‘ğŸ½ ğŸ‘ƒğŸ¿ Kerasã‚’ä½¿ç”¨ã—ãŸãƒªã‚«ãƒ¬ãƒ³ãƒˆãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼ˆRNNï¼‰ ğŸ¤³ğŸ» ğŸ¦ ğŸ§ğŸ»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tensorflow.orgã‹ã‚‰ã®å†å¸°çš„ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¬ã‚¤ãƒ‰ã®ç¿»è¨³ã€‚ã“ã®è³‡æ–™ã§ã¯ã€ã‚¯ã‚¤ãƒƒã‚¯ãƒ¡ãƒƒã‚·ãƒ¥ã®ãŸã‚ã®Keras / Tensorflow 2.0ã®çµ„ã¿è¾¼ã¿æ©Ÿèƒ½ã¨ã€ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚„ã‚»ãƒ«ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹å¯èƒ½æ€§ã«ã¤ã„ã¦èª¬æ˜ã—ã¦ã„ã¾ã™ã€‚CuDNNã‚³ã‚¢ã®ä½¿ç”¨ã®ã‚±ãƒ¼ã‚¹ã¨åˆ¶é™ã‚‚è€ƒæ…®ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Kerasã‚’ä½¿ç”¨ã—ãŸãƒªã‚«ãƒ¬ãƒ³ãƒˆãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼ˆRNNï¼‰</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487808/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tensorflow.orgã‹ã‚‰ã®å†å¸°çš„ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¬ã‚¤ãƒ‰ã®ç¿»è¨³ã€‚</font><font style="vertical-align: inherit;">ã“ã®è³‡æ–™ã§ã¯ã€ã‚¯ã‚¤ãƒƒã‚¯ãƒ¡ãƒƒã‚·ãƒ¥ã®ãŸã‚ã®Keras / Tensorflow 2.0ã®çµ„ã¿è¾¼ã¿æ©Ÿèƒ½ã¨ã€ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚„ã‚»ãƒ«ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹å¯èƒ½æ€§ã«ã¤ã„ã¦èª¬æ˜ã—ã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">CuDNNã‚³ã‚¢ã®ä½¿ç”¨ã®ã‚±ãƒ¼ã‚¹ã¨åˆ¶é™ã‚‚è€ƒæ…®ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®å­¦ç¿’ãƒ—ãƒ­ã‚»ã‚¹ã‚’åŠ é€Ÿã§ãã¾ã™ã€‚</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/xt/_q/nj/xt_qnjgfjengqoqd4gizkq4j_wk.png"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å†å¸°çš„ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼ˆRNNï¼‰ã¯ã€æ™‚ç³»åˆ—ã‚„è‡ªç„¶è¨€èªãªã©ã®ã‚·ãƒªã‚¢ãƒ«ãƒ‡ãƒ¼ã‚¿ã®ãƒ¢ãƒ‡ãƒªãƒ³ã‚°ã«é©ã—ãŸãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ã‚¯ãƒ©ã‚¹ã§ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¦‚ç•¥çš„ã«è¨€ãˆã°ã€RNNãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ãƒ«ãƒ¼ãƒ—</font></font><code>for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚’</font><font style="vertical-align: inherit;">ä½¿ç”¨</font><font style="vertical-align: inherit;">ã—ã¦æ™‚é–“é †ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’åå¾©ã—ã€å†…éƒ¨çŠ¶æ…‹ã§ã€å½¼ãŒã™ã§ã«è¦‹ãŸã‚¹ãƒ†â€‹â€‹ãƒƒãƒ—ã«é–¢ã™ã‚‹ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸæƒ…å ±ã‚’ä¿å­˜ã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Keras RNN APIã¯ã€æ¬¡ã®ã“ã¨ã«é‡ç‚¹ã‚’ç½®ã„ã¦è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ã„ã‚„ã™ã•</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šçµ„ã¿è¾¼ã¿ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã€ã€</font></font><code>tf.keras.layers.RNN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã«ã‚ˆã‚Š</font></font><code>tf.keras.layers.LSTM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€</font></font><code>tf.keras.layers.GRU</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¤‡é›‘ãªæ§‹æˆè¨­å®šã‚’è¡Œã‚ãªãã¦ã‚‚ã€å†å¸°ãƒ¢ãƒ‡ãƒ«ã‚’ã™ã°ã‚„ãæ§‹ç¯‰ã§ãã¾ã™ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°¡å˜ãªã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šRNNã‚»ãƒ«ã®ç‹¬è‡ªã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å®šç¾©ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ï¼ˆãƒ«ãƒ¼ãƒ—ã®å†…éƒ¨ï¼‰</font></font><code>for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ã‚«ã‚¹ã‚¿ãƒ å‹•ä½œã‚’ä½¿ç”¨ã—ã¦ã€ `tf.keras.layers.RNN`ã®å…±é€šãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆthe` for`ãƒ«ãƒ¼ãƒ—è‡ªä½“ï¼‰ã§ä½¿ç”¨ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã‚Œã«ã‚ˆã‚Šã€æœ€å°é™ã®ã‚³ãƒ¼ãƒ‰ã§ã€æŸ”è»Ÿãªæ–¹æ³•ã§ã•ã¾ã–ã¾ãªç ”ç©¶ã‚¢ã‚¤ãƒ‡ã‚¢ã®ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã‚’ã™ã°ã‚„ãä½œæˆã§ãã¾ã™ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å–ã‚Šä»˜ã‘</font></font></h2><br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> absolute_import, division, print_function, unicode_literals<font></font>
<font></font>
<span class="hljs-keyword">import</span> collections
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<font></font>
<font></font>
<span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<font></font>
<font></font>
<span class="hljs-keyword">from</span> tensorflow.keras <span class="hljs-keyword">import</span> layers</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å˜ç´”ãªãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã™ã‚‹</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kerasã«ã¯3ã¤ã®çµ„ã¿è¾¼ã¿RNNãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒã‚ã‚Šã¾ã™ã€‚</font></font><br>
<br>
<ol>
<li><code>tf.keras.layers.SimpleRNN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€å®Œå…¨ã«æ¥ç¶šã•ã‚ŒãŸRNNã€‚å‰ã®ã‚¿ã‚¤ãƒ ã‚¹ãƒ†ãƒƒãƒ—ã®å‡ºåŠ›ã‚’æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã«æ¸¡ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font></font></li>
<li><code>tf.keras.layers.GRU</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€è¨˜äº‹ã€Œ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">çµ±è¨ˆçš„æ©Ÿæ¢°ç¿»è¨³ã®ãŸã‚ã®RNNã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ãŸãƒ•ãƒ¬ãƒ¼ã‚ºã®å­¦ç¿’ã€</font></a><font style="vertical-align: inherit;">ã§æœ€åˆã«ææ¡ˆã•ã‚Œã¾ã—ãŸ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a></li>
<li><code>tf.keras.layers.LSTM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€è¨˜äº‹ã€Œ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">é•·æœŸçŸ­æœŸè¨˜æ†¶ã€</font></a><font style="vertical-align: inherit;">ã§æœ€åˆã«ææ¡ˆã•ã‚Œã¾ã—ãŸ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2015å¹´ã®åˆã‚ã«ã€Kerasã¯æœ€åˆã®å†åˆ©ç”¨å¯èƒ½ãªã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®PythonãŠã‚ˆã³LSTMã¨GRUã®å®Ÿè£…ã‚’å°å…¥ã—ã¾ã—ãŸã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»¥ä¸‹ã¯ã€</font></font><code>Sequential</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å„æ•´æ•°ã‚’64æ¬¡å…ƒãƒ™ã‚¯ãƒˆãƒ«ã«ãƒã‚¹ãƒˆã—ã¦æ•´æ•°ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’å‡¦ç†ã—ã€æ¬¡ã«ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ãƒ™ã‚¯ãƒˆãƒ«ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’å‡¦ç†</font><font style="vertical-align: inherit;">ã™ã‚‹</font><font style="vertical-align: inherit;">ãƒ¢ãƒ‡ãƒ«ã®</font><font style="vertical-align: inherit;">ä¾‹ã§ã™</font></font><code>LSTM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="python hljs">model = tf.keras.Sequential()
<span class="hljs-comment">#   Embedding      1000, </span>
<span class="hljs-comment">#     64.</span>
model.add(layers.Embedding(input_dim=<span class="hljs-number">1000</span>, output_dim=<span class="hljs-number">64</span>))<font></font>
<font></font>
<span class="hljs-comment">#   LSTM  128  .</span>
model.add(layers.LSTM(<span class="hljs-number">128</span>))<font></font>
<font></font>
<span class="hljs-comment">#   Dense  10    softmax.</span>
model.add(layers.Dense(<span class="hljs-number">10</span>))<font></font>
<font></font>
model.summary()</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡ºåŠ›ã¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€RNNãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å‡ºåŠ›ã«ã¯è¦ç´ ã”ã¨ã«1ã¤ã®ãƒ™ã‚¯ãƒˆãƒ«ãŒå«ã¾ã‚Œã¾ã™ã€‚ã“ã®ãƒ™ã‚¯ãƒˆãƒ«ã¯ã€å…¥åŠ›ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å…¨ä½“ã«é–¢ã™ã‚‹æƒ…å ±ã‚’å«ã‚€æœ€å¾Œã®RNNã‚»ãƒ«ã®å‡ºåŠ›ã§ã™ã€‚ã“ã®å‡ºåŠ›ã®æ¬¡å…ƒ</font></font><code>(batch_size, units)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚ã“ã“ã§</font><font style="vertical-align: inherit;">ã€ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼ã«æ¸¡ã•ã‚Œã‚‹</font></font><code>units</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¼•æ•°</font><font style="vertical-align: inherit;">ã«</font><font style="vertical-align: inherit;">å¯¾å¿œã—ã¾ã™</font></font><code>units</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RNNãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ã€ã‚’æŒ‡å®šã—</font></font><code>return_sequences=True</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãŸ</font><font style="vertical-align: inherit;">å ´åˆã€å„è¦ç´ ã®å‡ºåŠ›ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å…¨ä½“ï¼ˆå„ã‚¹ãƒ†ãƒƒãƒ—ã«1ã¤ã®ãƒ™ã‚¯ãƒˆãƒ«ï¼‰ã‚’è¿”ã™ã“ã¨ã‚‚ã§ãã¾ã™</font><font style="vertical-align: inherit;">ã€‚ã“ã®å‡ºåŠ›ã®æ¬¡å…ƒã¯</font></font><code>(batch_size, timesteps, units)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã§ã™ã€‚</font></font><br>
<br>
<pre><code class="python hljs">model = tf.keras.Sequential()<font></font>
model.add(layers.Embedding(input_dim=<span class="hljs-number">1000</span>, output_dim=<span class="hljs-number">64</span>))<font></font>
<font></font>
<span class="hljs-comment">#  GRU  3D   (batch_size, timesteps, 256)</span>
model.add(layers.GRU(<span class="hljs-number">256</span>, return_sequences=<span class="hljs-literal">True</span>))<font></font>
<font></font>
<span class="hljs-comment">#  SimpleRNN  2D   (batch_size, 128)</span>
model.add(layers.SimpleRNN(<span class="hljs-number">128</span>))<font></font>
<font></font>
model.add(layers.Dense(<span class="hljs-number">10</span>))<font></font>
<font></font>
model.summary()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã•ã‚‰ã«ã€RNNãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯æœ€çµ‚çš„ãªå†…éƒ¨çŠ¶æ…‹ã‚’è¿”ã™ã“ã¨ãŒã§ãã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿”ã•ã‚ŒãŸçŠ¶æ…‹ã‚’å¾Œã§ä½¿ç”¨ã—ã¦ã€RNNã®å®Ÿè¡Œã‚’å†é–‹ã—ãŸã‚Š</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€åˆ¥ã®RNNã‚’åˆæœŸåŒ–ã—</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãŸã‚Š</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ã§ãã¾ã™</font></a><font style="vertical-align: inherit;">ã€‚ã“ã®è¨­å®šã¯é€šå¸¸ã€ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼-ãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼ãƒ¢ãƒ‡ãƒ«ã§ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã”ã¨ã«ä½¿ç”¨ã•ã‚Œã€ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã®æœ€çµ‚çŠ¶æ…‹ãŒãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼ã®åˆæœŸçŠ¶æ…‹ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RNNãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒå†…éƒ¨çŠ¶æ…‹ã‚’è¿”ã™ãŸã‚ã«ã¯</font><font style="vertical-align: inherit;">ã€ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä½œæˆæ™‚ã«</font><font style="vertical-align: inherit;">ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼</font></font><code>return_state</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚’å€¤</font></font><code>True</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã«</font><font style="vertical-align: inherit;">è¨­å®šã—ã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font></font><code>LSTM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2ã¤ã®çŠ¶æ…‹ãƒ†ãƒ³ã‚½ãƒ«ãŒã‚ã‚Š</font></font><code>GRU</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€1ã¤ã ã‘</font><font style="vertical-align: inherit;">ã§ã‚ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®åˆæœŸçŠ¶æ…‹ã‚’èª¿æ•´ã™ã‚‹ã«ã¯ã€è¿½åŠ ã®å¼•æ•°ã‚’æŒ‡å®šã—ã¦ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å‘¼ã³å‡ºã™ã ã‘</font></font><code>initial_state</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã§ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¬¡ã®ä¾‹ã®ã‚ˆã†ã«ã€å¯¸æ³•ã¯ãƒ¬ã‚¤ãƒ¤ãƒ¼è¦ç´ ã®å¯¸æ³•ã¨ä¸€è‡´ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚</font></font><br>
<br>
<pre><code class="python hljs">encoder_vocab = <span class="hljs-number">1000</span>
decoder_vocab = <span class="hljs-number">2000</span><font></font>
<font></font>
encoder_input = layers.Input(shape=(<span class="hljs-literal">None</span>, ))<font></font>
encoder_embedded = layers.Embedding(input_dim=encoder_vocab, output_dim=<span class="hljs-number">64</span>)(encoder_input)<font></font>
<font></font>
<span class="hljs-comment">#       </span><font></font>
output, state_h, state_c = layers.LSTM(<font></font>
    <span class="hljs-number">64</span>, return_state=<span class="hljs-literal">True</span>, name=<span class="hljs-string">'encoder'</span>)(encoder_embedded)<font></font>
encoder_state = [state_h, state_c]<font></font>
<font></font>
decoder_input = layers.Input(shape=(<span class="hljs-literal">None</span>, ))<font></font>
decoder_embedded = layers.Embedding(input_dim=decoder_vocab, output_dim=<span class="hljs-number">64</span>)(decoder_input)<font></font>
<font></font>
<span class="hljs-comment">#  2     LSTM    </span><font></font>
decoder_output = layers.LSTM(<font></font>
    <span class="hljs-number">64</span>, name=<span class="hljs-string">'decoder'</span>)(decoder_embedded, initial_state=encoder_state)<font></font>
output = layers.Dense(<span class="hljs-number">10</span>)(decoder_output)<font></font>
<font></font>
model = tf.keras.Model([encoder_input, decoder_input], output)<font></font>
model.summary()<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RNNãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨RNNã‚»ãƒ«</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RNN APIã¯ã€çµ„ã¿è¾¼ã¿ã®RNNãƒ¬ã‚¤ãƒ¤ãƒ¼ã«åŠ ãˆã¦ã€ã‚»ãƒ«ãƒ¬ãƒ™ãƒ«ã®APIã‚‚æä¾›ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">å…¥åŠ›ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã®ãƒ‘ã‚±ãƒƒãƒˆå…¨ä½“ã‚’å‡¦ç†ã™ã‚‹RNNãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã¯ç•°ãªã‚Šã€RNNã‚»ãƒ«ã¯1ã¤ã®ã‚¿ã‚¤ãƒ ã‚¹ãƒ†ãƒƒãƒ—ã®ã¿ã‚’å‡¦ç†ã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚»ãƒ«ã¯ã€</font></font><code>for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RNNãƒ¬ã‚¤ãƒ¤ãƒ¼ã®</font><font style="vertical-align: inherit;">ã‚µã‚¤ã‚¯ãƒ«å†…ã«ã‚ã‚Šã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ã‚»ãƒ«ã‚’ãƒ©ãƒƒãƒ—ã™ã‚‹ã¨ã€</font></font><code>tf.keras.layers.RNN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ãƒ‘ã‚±ãƒƒãƒˆã‚’å‡¦ç†ã§ãã‚‹</font><font style="vertical-align: inherit;">ãƒ¬ã‚¤ãƒ¤ãƒ¼</font><font style="vertical-align: inherit;">ãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚</font></font><code>RNN(LSTMCell(10))</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ•°å­¦çš„ã«</font></font><code>RNN(LSTMCell(10))</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¯ã€ã¨åŒã˜çµæœã«ãªã‚Š</font></font><code>LSTM(10)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã™ã€‚</font><font style="vertical-align: inherit;">å®Ÿéš›ã€TF v1.xå†…ã§ã®ã“ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å®Ÿè£…ã¯ã€å¯¾å¿œã™ã‚‹RNNã‚»ãƒ«ã‚’ä½œæˆã—ã¦RNNãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ãƒ©ãƒƒãƒ—ã™ã‚‹ã“ã¨ã ã‘ã§ã—ãŸã€‚</font><font style="vertical-align: inherit;">ãŸã ã—ã€åŸ‹ã‚è¾¼ã¿ãƒ¬ã‚¤ãƒ¤ãƒ¼</font></font><code>GRU</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚’</font></font><code>LSTM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨ã™ã‚‹ã¨ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹CuDNNã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3ã¤ã®çµ„ã¿è¾¼ã¿RNNã‚»ãƒ«ãŒã‚ã‚Šã€ãã‚Œãã‚ŒãŒç‹¬è‡ªã®RNNå±¤ã«å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚</font></font><br>
<br>
<ul>
<li><code>tf.keras.layers.SimpleRNNCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ä¸€è‡´ã—</font></font><code>SimpleRNN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã™ã€‚</font></font></li>
<li><code>tf.keras.layers.GRUCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ä¸€è‡´ã—</font></font><code>GRU</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã™ã€‚</font></font></li>
<li><code>tf.keras.layers.LSTMCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ä¸€è‡´ã—</font></font><code>LSTM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã™ã€‚</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚»ãƒ«ã‚’æŠ½è±¡åŒ–ã—ã€å…±é€šã®ã‚¯ãƒ©ã‚¹ã‚’ä½¿ç”¨</font></font><code>tf.keras.layers.RNN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã™ã‚‹ã¨ã€ç ”ç©¶ç”¨ã®ã‚«ã‚¹ã‚¿ãƒ RNNã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ¼ã‚’éå¸¸ã«ç°¡å˜ã«å®Ÿè£…ã§ãã¾ã™ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¯ãƒ­ã‚¹ãƒãƒƒãƒä¿å­˜çŠ¶æ…‹</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é•·ã„ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ï¼ˆå ´åˆã«ã‚ˆã£ã¦ã¯ç„¡é™ï¼‰ã‚’å‡¦ç†ã™ã‚‹ã¨ãã¯ã€</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¯ãƒ­ã‚¹ãƒãƒƒãƒã‚¹ãƒ†ãƒ¼ãƒˆãƒ•ãƒ«ãƒã‚¹</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ç”¨ã§ãã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é€šå¸¸ã€RNNãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å†…éƒ¨çŠ¶æ…‹ã¯ã€æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚±ãƒƒãƒˆã”ã¨ã«ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ï¼ˆã¤ã¾ã‚Šã€ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ç¢ºèªã™ã‚‹å„ä¾‹ã¯ã€éå»ã‹ã‚‰ç‹¬ç«‹ã—ã¦ã„ã‚‹ã¨è¦‹ãªã•ã‚Œã¾ã™ï¼‰ã€‚ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ã€ã“ã®è¦ç´ ã‚’å‡¦ç†ã—ã¦ã„ã‚‹é–“ã ã‘çŠ¶æ…‹ã‚’ç¶­æŒã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãŸã ã—ã€éå¸¸ã«é•·ã„ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ãŒã‚ã‚‹å ´åˆã¯ã€ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’ã‚ˆã‚ŠçŸ­ã„ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã«åˆ†å‰²ã—ã€ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆã›ãšã«é †ç•ªã«RNNãƒ¬ã‚¤ãƒ¤ãƒ¼ã«è»¢é€ã™ã‚‹ã¨ä¾¿åˆ©ã§ã™ã€‚ã—ãŸãŒã£ã¦ã€ä¸€åº¦ã«1ã¤ã®ã‚µãƒ–ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã—ã‹è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ãŒã€ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å…¨ä½“ã«é–¢ã™ã‚‹æƒ…å ±ã‚’æ ¼ç´ã§ãã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã‚Œã‚’è¡Œã†ã«ã¯ã€ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§ã€Œstateful = Trueã€ã‚’è¨­å®šã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ `s = [t0ã€t1ã€... t1546ã€t1547]`ãŒã‚ã‚‹å ´åˆã¯ã€ãŸã¨ãˆã°æ¬¡ã®ã‚ˆã†ã«åˆ†å‰²ã§ãã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="python hljs">s1 = [t0, t1, ... t100]<font></font>
s2 = [t101, ... t201]<font></font>
...<font></font>
s16 = [t1501, ... t1547]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã®å¾Œã€æ¬¡ã®ã‚ˆã†ã«å‡¦ç†ã§ãã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="python hljs">lstm_layer = layers.LSTM(<span class="hljs-number">64</span>, stateful=<span class="hljs-literal">True</span>)
<span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> sub_sequences:<font></font>
  output = lstm_layer(s)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
çŠ¶æ…‹ã‚’ãã‚Œã„ã«ã—ãŸã„å ´åˆã¯ã€ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„</font></font><code>layer.reset_states()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<blockquote><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ³¨ï¼š</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã®å ´åˆã€</font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ä¾‹ã¯ã€</font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‰ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®</font><font style="vertical-align: inherit;">ä¾‹ã®ç¶šãã§ã‚ã‚‹</font><font style="vertical-align: inherit;">ã¨æƒ³å®šã•ã‚Œã¦</font><font style="vertical-align: inherit;">ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã¤ã¾ã‚Šã€ã™ã¹ã¦ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«åŒã˜æ•°ã®è¦ç´ ï¼ˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚µã‚¤ã‚ºï¼‰ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãŸã¨ãˆã°ã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ãŒå«ã¾ã‚Œã¦ã„ã‚‹</font></font><code>[sequence_A_from_t0_to_t100, sequence_B_from_t0_to_t100]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å ´åˆã€æ¬¡ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã¯ãŒå«ã¾ã‚Œã¦</font></font><code>[sequence_A_from_t101_to_t200, sequence_B_from_t101_to_t200]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã„ã‚‹</font><font style="vertical-align: inherit;">å¿…è¦ãŒã‚ã‚Šã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥ä¸‹ã¯å®Œå…¨ãªä¾‹ã§ã™ã€‚</font></font><br>
<br>
<pre><code class="python hljs">paragraph1 = np.random.random((<span class="hljs-number">20</span>, <span class="hljs-number">10</span>, <span class="hljs-number">50</span>)).astype(np.float32)<font></font>
paragraph2 = np.random.random((<span class="hljs-number">20</span>, <span class="hljs-number">10</span>, <span class="hljs-number">50</span>)).astype(np.float32)<font></font>
paragraph3 = np.random.random((<span class="hljs-number">20</span>, <span class="hljs-number">10</span>, <span class="hljs-number">50</span>)).astype(np.float32)<font></font>
<font></font>
lstm_layer = layers.LSTM(<span class="hljs-number">64</span>, stateful=<span class="hljs-literal">True</span>)<font></font>
output = lstm_layer(paragraph1)<font></font>
output = lstm_layer(paragraph2)<font></font>
output = lstm_layer(paragraph3)<font></font>
<font></font>
<span class="hljs-comment"># reset_states()      initial_state.</span>
<span class="hljs-comment">#  initial_state   ,      .</span>
lstm_layer.reset_states()</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŒæ–¹å‘RNN</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ™‚ç³»åˆ—ä»¥å¤–ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ï¼ˆãƒ†ã‚­ã‚¹ãƒˆãªã©ï¼‰ã®å ´åˆã€ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’æœ€åˆã‹ã‚‰æœ€å¾Œã¾ã§å‡¦ç†ã™ã‚‹ã ã‘ã§ãªãã€ãã®é€†ã‚‚å‡¦ç†ã™ã‚‹ã¨ã€RNNãƒ¢ãƒ‡ãƒ«ãŒã‚ˆã‚Šã‚ˆãæ©Ÿèƒ½ã™ã‚‹ã“ã¨ãŒã‚ˆãã‚ã‚Šã¾ã™ã€‚ãŸã¨ãˆã°ã€æ–‡ã®æ¬¡ã®å˜èªã‚’äºˆæ¸¬ã™ã‚‹ã«ã¯ã€å˜èªã®å‰ã«ã‚ã‚‹å˜èªã ã‘ã§ãªãã€å˜èªã®å‰å¾Œã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’çŸ¥ã£ã¦ãŠãã¨ä¾¿åˆ©ã§ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kerasã¯ã€ãã®ã‚ˆã†ãªåŒæ–¹å‘RNNã‚’ä½œæˆã™ã‚‹ãŸã‚ã®å˜ç´”ãªAPIã€ãƒ©ãƒƒãƒ‘ãƒ¼ã‚’æä¾›ã—ã¾ã™</font></font><code>tf.keras.layers.Bidirectional</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="python hljs">model = tf.keras.Sequential()<font></font>
<font></font>
model.add(layers.Bidirectional(layers.LSTM(<span class="hljs-number">64</span>, return_sequences=<span class="hljs-literal">True</span>), <font></font>
                               input_shape=(<span class="hljs-number">5</span>, <span class="hljs-number">10</span>)))<font></font>
model.add(layers.Bidirectional(layers.LSTM(<span class="hljs-number">32</span>)))<font></font>
model.add(layers.Dense(<span class="hljs-number">10</span>))<font></font>
<font></font>
model.summary()</code></pre><br><font style="vertical-align: inherit;"></font><code>Bidirectional</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å†…éƒ¨</font><font style="vertical-align: inherit;">
ã§ã¯ã€</font><font style="vertical-align: inherit;">è»¢é€ã•ã‚ŒãŸRNNãƒ¬ã‚¤ãƒ¤ãƒ¼</font></font><code>go_backwards</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãŒã‚³ãƒ”ãƒ¼ã•ã‚Œ</font><font style="vertical-align: inherit;">ã€</font><font style="vertical-align: inherit;">æ–°ã—ãã‚³ãƒ”ãƒ¼ã•ã‚ŒãŸãƒ¬ã‚¤ãƒ¤ãƒ¼ã®</font><font style="vertical-align: inherit;">ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒ</font><font style="vertical-align: inherit;">åè»¢ã—ã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã¯é€†ã®é †åºã§å‡¦ç†ã•ã‚Œã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
` </font></font><code>Bidirectional</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RNN </font><font style="vertical-align: inherit;">ã®å‡ºåŠ›ã¯</font><font style="vertical-align: inherit;">ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å‡ºåŠ›ã¨ãƒªãƒãƒ¼ã‚¹ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å‡ºåŠ›ã®åˆè¨ˆã«ãªã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ä»–ã®ãƒãƒ¼ã‚¸å‹•ä½œãŒå¿…è¦ãªå ´åˆã€‚</font><font style="vertical-align: inherit;">é€£çµã™ã‚‹ã«ã¯ã€ `Bidirectional`ãƒ©ãƒƒãƒ‘ãƒ¼ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼ã®` merge_mode`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’å¤‰æ›´ã—ã¾ã™ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TensorFlow 2.0ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã¨CuDNNã‚³ã‚¢</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TensorFlow 2.0ã§ã¯ã€ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ãƒ—ãƒ­ã‚»ãƒƒã‚µãŒåˆ©ç”¨å¯èƒ½ãªå ´åˆã€çµ„ã¿è¾¼ã¿ã®LSTMå±¤ã¨GRUå±¤ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®CuDNNã‚³ã‚¢ã§ã®ä½¿ç”¨ã«é©ã—ã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®å¤‰æ›´ã«ã‚ˆã‚Šã€ä»¥å‰ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼</font></font><code>keras.layers.CuDNNLSTM/CuDNNGRU</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¯å¤ããªã‚Šã€æ©Ÿèƒ½ã™ã‚‹æ©Ÿå™¨ã‚’æ°—ã«ã™ã‚‹ã“ã¨ãªããƒ¢ãƒ‡ãƒ«ã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CuDNNã‚«ãƒ¼ãƒãƒ«ã¯ã„ãã¤ã‹ã®å‰æã§æ§‹ç¯‰ã•ã‚Œã¦ã„ã‚‹</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãŸã‚ã€çµ„ã¿è¾¼ã¿ã®LSTMã¾ãŸã¯GRUãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’å¤‰æ›´ã™ã‚‹ã¨ã€ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯CuDNNã‚«ãƒ¼ãƒãƒ«ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½¿ç”¨ã§ããªããªã‚Šã¾ã™</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä¾‹ãˆã°ã€‚</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é–¢æ•°</font></font><code>activation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚’</font></font><code>tanh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ¥ã®ã‚‚ã®ã«</font><font style="vertical-align: inherit;">å¤‰æ›´ã™ã‚‹</font><font style="vertical-align: inherit;">ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é–¢æ•°</font></font><code>recurrent_activation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚’</font></font><code>sigmoid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ¥ã®ã‚‚ã®ã«</font><font style="vertical-align: inherit;">å¤‰æ›´ã™ã‚‹</font><font style="vertical-align: inherit;">ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨é‡</font></font><code>recurrent_dropout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt; 0ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã‚Œ</font></font><code>unroll</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚’Trueã«</font><font style="vertical-align: inherit;">è¨­å®šã™ã‚‹</font><font style="vertical-align: inherit;">ã¨ã€LSTM / GRUã¯å†…éƒ¨</font></font><code>tf.while_loop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚’å±•é–‹ã•ã‚ŒãŸãƒ«ãƒ¼ãƒ—</font><font style="vertical-align: inherit;">ã«åˆ†è§£ã—</font><font style="vertical-align: inherit;">ã¾ã™</font></font><code>for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"></font><code>use_bias</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Falseã«</font><font style="vertical-align: inherit;">è¨­å®š</font><font style="vertical-align: inherit;">ã—ã¾ã™ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ãŒå³æƒãˆã•ã‚Œã¦ã„ãªã„å ´åˆã«ãƒã‚¹ã‚¯ã‚’ä½¿ç”¨ã—ã¾ã™ï¼ˆãƒã‚¹ã‚¯ãŒå³å¯†ã«æ•´åˆ—ã•ã‚ŒãŸæ­£ã—ã„ãƒ‡ãƒ¼ã‚¿ã¨ä¸€è‡´ã™ã‚‹å ´åˆã§ã‚‚ã€CuDNNã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚ã“ã‚ŒãŒæœ€ã‚‚ä¸€èˆ¬çš„ãªã‚±ãƒ¼ã‚¹ã§ã™ï¼‰ã€‚</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯èƒ½ãªå ´åˆã¯CuDNNã‚«ãƒ¼ãƒãƒ«ã‚’ä½¿ç”¨ã™ã‚‹</font></font></h3><br>
<pre><code class="python hljs">batch_size = <span class="hljs-number">64</span>
<span class="hljs-comment">#    MNIST    (batch_size, 28, 28).</span>
<span class="hljs-comment">#     (28, 28) (   ).</span>
input_dim = <span class="hljs-number">28</span><font></font>
<font></font>
units = <span class="hljs-number">64</span>
output_size = <span class="hljs-number">10</span>  <span class="hljs-comment">#   0  9</span><font></font>
<font></font>
<span class="hljs-comment">#  RNN </span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_model</span>(<span class="hljs-params">allow_cudnn_kernel=True</span>):</span>
  <span class="hljs-comment"># CuDNN     ,     .</span>
  <span class="hljs-comment">#   `LSTM(units)`    CuDNN,</span>
  <span class="hljs-comment">#   RNN(LSTMCell(units))   non-CuDNN .</span>
  <span class="hljs-keyword">if</span> allow_cudnn_kernel:
    <span class="hljs-comment">#  LSTM      CuDNN.</span>
    lstm_layer = tf.keras.layers.LSTM(units, input_shape=(<span class="hljs-literal">None</span>, input_dim))
  <span class="hljs-keyword">else</span>:
    <span class="hljs-comment">#  LSTMCell  RNN    CuDNN.</span><font></font>
    lstm_layer = tf.keras.layers.RNN(<font></font>
        tf.keras.layers.LSTMCell(units),<font></font>
        input_shape=(<span class="hljs-literal">None</span>, input_dim))<font></font>
  model = tf.keras.models.Sequential([<font></font>
      lstm_layer,<font></font>
      tf.keras.layers.BatchNormalization(),<font></font>
      tf.keras.layers.Dense(output_size)]<font></font>
  )<font></font>
  <span class="hljs-keyword">return</span> model
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MNISTãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®èª­ã¿è¾¼ã¿</font></font></h3><br>
<pre><code class="python hljs">mnist = tf.keras.datasets.mnist<font></font>
<font></font>
(x_train, y_train), (x_test, y_test) = mnist.load_data()<font></font>
x_train, x_test = x_train / <span class="hljs-number">255.0</span>, x_test / <span class="hljs-number">255.0</span>
sample, sample_label = x_train[<span class="hljs-number">0</span>], y_train[<span class="hljs-number">0</span>]</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¢ãƒ‡ãƒ«ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã¦ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹</font></font></h3><br><font style="vertical-align: inherit;"></font><code>sparse_categorical_crossentropy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æå¤±ã®é–¢æ•°ã¨ã—ã¦</font><font style="vertical-align: inherit;">
é¸æŠã—</font><font style="vertical-align: inherit;">ã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ãƒ¢ãƒ‡ãƒ«ã®å‡ºåŠ›ã«ã¯ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ãŒã‚ã‚Š</font></font><code>[batch_size, 10]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ¢ãƒ‡ãƒ«ã®ç­”ãˆã¯æ•´æ•°ãƒ™ã‚¯ãƒˆãƒ«ã§ã€å„æ•°å€¤ã¯0ã€œ9ã®ç¯„å›²ã§ã™ã€‚</font></font><br>
<br>
<pre><code class="python hljs">model = build_model(allow_cudnn_kernel=<span class="hljs-literal">True</span>)<font></font>
<font></font>
model.compile(loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=<span class="hljs-literal">True</span>), <font></font>
              optimizer=<span class="hljs-string">'sgd'</span>,<font></font>
              metrics=[<span class="hljs-string">'accuracy'</span>])
</code></pre><br>
<pre><code class="python hljs">model.fit(x_train, y_train,<font></font>
          validation_data=(x_test, y_test),<font></font>
          batch_size=batch_size,<font></font>
          epochs=<span class="hljs-number">5</span>)</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CuDNNã‚³ã‚¢ãªã—ã§æ–°ã—ã„ãƒ¢ãƒ‡ãƒ«ã‚’æ§‹ç¯‰ã™ã‚‹</font></font></h3><br>
<pre><code class="python hljs">slow_model = build_model(allow_cudnn_kernel=<span class="hljs-literal">False</span>)<font></font>
slow_model.set_weights(model.get_weights())<font></font>
slow_model.compile(loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=<span class="hljs-literal">True</span>), <font></font>
                   optimizer=<span class="hljs-string">'sgd'</span>, <font></font>
                   metrics=[<span class="hljs-string">'accuracy'</span>])<font></font>
slow_model.fit(x_train, y_train, <font></font>
               validation_data=(x_test, y_test), <font></font>
               batch_size=batch_size,<font></font>
               epochs=<span class="hljs-number">1</span>)  <span class="hljs-comment">#         .</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã”è¦§ã®ã‚ˆã†ã«ã€CuDNNã§æ§‹ç¯‰ã•ã‚ŒãŸãƒ¢ãƒ‡ãƒ«ã¯ã€é€šå¸¸ã®TensorFlowã‚³ã‚¢ã‚’ä½¿ç”¨ã™ã‚‹ãƒ¢ãƒ‡ãƒ«ã‚ˆã‚Šã‚‚ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãŒã¯ã‚‹ã‹ã«é«˜é€Ÿã§ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CuDNNã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹åŒã˜ãƒ¢ãƒ‡ãƒ«ã‚’ã€ã‚·ãƒ³ã‚°ãƒ«ãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼ç’°å¢ƒã§ã®å‡ºåŠ›ã«ä½¿ç”¨ã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">æ³¨é‡ˆ</font></font><code>tf.device</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¯ã€å˜ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒã‚¤ã‚¹ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">GPUãŒåˆ©ç”¨ã§ããªã„å ´åˆã€ãƒ¢ãƒ‡ãƒ«ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§CPUã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½œæ¥­ã—ã¦ã„ã‚‹ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã«ã¤ã„ã¦å¿ƒé…ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</font><font style="vertical-align: inherit;">ã‹ã£ã“ã„ã„ã§ã™ã‹ï¼Ÿ</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">with</span> tf.device(<span class="hljs-string">'CPU:0'</span>):<font></font>
  cpu_model = build_model(allow_cudnn_kernel=<span class="hljs-literal">True</span>)<font></font>
  cpu_model.set_weights(model.get_weights())<font></font>
  result = tf.argmax(cpu_model.predict_on_batch(tf.expand_dims(sample, <span class="hljs-number">0</span>)), axis=<span class="hljs-number">1</span>)<font></font>
  print(<span class="hljs-string">'Predicted result is: %s, target result is: %s'</span> % (result.numpy(), sample_label))<font></font>
  plt.imshow(sample, cmap=plt.get_cmap(<span class="hljs-string">'gray'</span>))
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒªã‚¹ãƒˆ/è¾æ›¸å…¥åŠ›ã€ã¾ãŸã¯ãƒã‚¹ãƒˆã•ã‚ŒãŸå…¥åŠ›ã‚’æŒã¤RNN</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒã‚¹ãƒˆã•ã‚ŒãŸæ§‹é€ ã«ã‚ˆã‚Šã€1ã¤ã®ã‚¿ã‚¤ãƒ ã‚¹ãƒ†ãƒƒãƒ—ã«ã‚ˆã‚Šå¤šãã®æƒ…å ±ã‚’å«ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãŸã¨ãˆã°ã€ãƒ“ãƒ‡ã‚ªãƒ•ãƒ¬ãƒ¼ãƒ ã«ã¯ã€ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã¨ãƒ“ãƒ‡ã‚ªã®å…¥åŠ›ãŒåŒæ™‚ã«å«ã¾ã‚Œã¦ã„ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®å ´åˆã®ãƒ‡ãƒ¼ã‚¿ã®æ¬¡å…ƒã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="plaintext hljs">[batch, timestep, {\"video\": [height, width, channel], \"audio\": [frequency]}]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åˆ¥ã®ä¾‹ã§ã¯ã€æ‰‹æ›¸ããƒ‡ãƒ¼ã‚¿ã¯ã€ç¾åœ¨ã®ãƒšãƒ³ä½ç½®ã®xåº§æ¨™ã¨yåº§æ¨™ã€ãŠã‚ˆã³åœ§åŠ›æƒ…å ±ã‚’æŒã¤ã“ã¨ãŒã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã—ãŸãŒã£ã¦ã€ãƒ‡ãƒ¼ã‚¿ã¯æ¬¡ã®ã‚ˆã†ã«è¡¨ã™ã“ã¨ãŒã§ãã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="plaintext hljs">[batch, timestep, {\"location\": [x, y], \"pressure\": [force]}]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã¯ã€ã“ã®ã‚ˆã†ãªæ§‹é€ åŒ–å…¥åŠ›ã§æ©Ÿèƒ½ã™ã‚‹ã‚«ã‚¹ã‚¿ãƒ RNNã‚»ãƒ«ã®ä¾‹ã‚’ä½œæˆã—ã¾ã™ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒã‚¹ãƒˆã•ã‚ŒãŸå…¥åŠ›/å‡ºåŠ›ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚»ãƒ«ã‚’å®šç¾©ã™ã‚‹</font></font></h3><br>
<pre><code class="python hljs">NestedInput = collections.namedtuple(<span class="hljs-string">'NestedInput'</span>, [<span class="hljs-string">'feature1'</span>, <span class="hljs-string">'feature2'</span>])<font></font>
NestedState = collections.namedtuple(<span class="hljs-string">'NestedState'</span>, [<span class="hljs-string">'state1'</span>, <span class="hljs-string">'state2'</span>])<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NestedCell</span>(<span class="hljs-params">tf.keras.layers.Layer</span>):</span><font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, unit_1, unit_2, unit_3, **kwargs</span>):</span><font></font>
    self.unit_1 = unit_1<font></font>
    self.unit_2 = unit_2<font></font>
    self.unit_3 = unit_3<font></font>
    self.state_size = NestedState(state1=unit_1, <font></font>
                                  state2=tf.TensorShape([unit_2, unit_3]))<font></font>
    self.output_size = (unit_1, tf.TensorShape([unit_2, unit_3]))<font></font>
    super(NestedCell, self).__init__(**kwargs)<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build</span>(<span class="hljs-params">self, input_shapes</span>):</span>
    <span class="hljs-comment"># #  input_shape  2 , [(batch, i1), (batch, i2, i3)]</span>
    input_1 = input_shapes.feature1[<span class="hljs-number">1</span>]<font></font>
    input_2, input_3 = input_shapes.feature2[<span class="hljs-number">1</span>:]<font></font>
<font></font>
    self.kernel_1 = self.add_weight(<font></font>
        shape=(input_1, self.unit_1), initializer=<span class="hljs-string">'uniform'</span>, name=<span class="hljs-string">'kernel_1'</span>)<font></font>
    self.kernel_2_3 = self.add_weight(<font></font>
        shape=(input_2, input_3, self.unit_2, self.unit_3),<font></font>
        initializer=<span class="hljs-string">'uniform'</span>,<font></font>
        name=<span class="hljs-string">'kernel_2_3'</span>)<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">call</span>(<span class="hljs-params">self, inputs, states</span>):</span>
    <span class="hljs-comment">#     [(batch, input_1), (batch, input_2, input_3)]</span>
    <span class="hljs-comment">#     [(batch, unit_1), (batch, unit_2, unit_3)]</span><font></font>
    input_1, input_2 = tf.nest.flatten(inputs)<font></font>
    s1, s2 = states<font></font>
<font></font>
    output_1 = tf.matmul(input_1, self.kernel_1)<font></font>
    output_2_3 = tf.einsum(<span class="hljs-string">'bij,ijkl-&gt;bkl'</span>, input_2, self.kernel_2_3)<font></font>
    state_1 = s1 + output_1<font></font>
    state_2_3 = s2 + output_2_3<font></font>
<font></font>
    output = [output_1, output_2_3]<font></font>
    new_states = NestedState(state1=state_1, state2=state_2_3)<font></font>
<font></font>
    <span class="hljs-keyword">return</span> output, new_states
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…¥ã‚Œå­ã®å…¥åŠ›/å‡ºåŠ›ã‚’æŒã¤RNNãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã™ã‚‹</font></font></h3><br><font style="vertical-align: inherit;"></font><code>tf.keras.layers.RNN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…ˆã»ã©å®šç¾©</font><font style="vertical-align: inherit;">
ã—ãŸãƒ¬ã‚¤ãƒ¤ãƒ¼</font><font style="vertical-align: inherit;">ã¨ã‚«ã‚¹ã‚¿ãƒ ã‚»ãƒ«ã‚’</font><font style="vertical-align: inherit;">ä½¿ç”¨ã™ã‚‹Kerasãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã—ã¦ã¿ã¾ã—ã‚‡ã†</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="python hljs">unit_1 = <span class="hljs-number">10</span>
unit_2 = <span class="hljs-number">20</span>
unit_3 = <span class="hljs-number">30</span><font></font>
<font></font>
input_1 = <span class="hljs-number">32</span>
input_2 = <span class="hljs-number">64</span>
input_3 = <span class="hljs-number">32</span>
batch_size = <span class="hljs-number">64</span>
num_batch = <span class="hljs-number">100</span>
timestep = <span class="hljs-number">50</span><font></font>
<font></font>
cell = NestedCell(unit_1, unit_2, unit_3)<font></font>
rnn = tf.keras.layers.RNN(cell)<font></font>
<font></font>
inp_1 = tf.keras.Input((<span class="hljs-literal">None</span>, input_1))<font></font>
inp_2 = tf.keras.Input((<span class="hljs-literal">None</span>, input_2, input_3))<font></font>
<font></font>
outputs = rnn(NestedInput(feature1=inp_1, feature2=inp_2))<font></font>
<font></font>
model = tf.keras.models.Model([inp_1, inp_2], outputs)<font></font>
<font></font>
model.compile(optimizer=<span class="hljs-string">'adam'</span>, loss=<span class="hljs-string">'mse'</span>, metrics=[<span class="hljs-string">'accuracy'</span>])unit_1 = <span class="hljs-number">10</span>
unit_2 = <span class="hljs-number">20</span>
unit_3 = <span class="hljs-number">30</span><font></font>
<font></font>
input_1 = <span class="hljs-number">32</span>
input_2 = <span class="hljs-number">64</span>
input_3 = <span class="hljs-number">32</span>
batch_size = <span class="hljs-number">64</span>
num_batch = <span class="hljs-number">100</span>
timestep = <span class="hljs-number">50</span><font></font>
<font></font>
cell = NestedCell(unit_1, unit_2, unit_3)<font></font>
rnn = tf.keras.layers.RNN(cell)<font></font>
<font></font>
inp_1 = tf.keras.Input((<span class="hljs-literal">None</span>, input_1))<font></font>
inp_2 = tf.keras.Input((<span class="hljs-literal">None</span>, input_2, input_3))<font></font>
<font></font>
outputs = rnn(NestedInput(feature1=inp_1, feature2=inp_2))<font></font>
<font></font>
model = tf.keras.models.Model([inp_1, inp_2], outputs)<font></font>
<font></font>
model.compile(optimizer=<span class="hljs-string">'adam'</span>, loss=<span class="hljs-string">'mse'</span>, metrics=[<span class="hljs-string">'accuracy'</span>])
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ©ãƒ³ãƒ€ãƒ ã«ç”Ÿæˆã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã§ãƒ¢ãƒ‡ãƒ«ã‚’ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã™ã‚‹</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã®ãƒ¢ãƒ‡ãƒ«ã«ã¯é©åˆ‡ãªãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆãŒãªã„ãŸã‚ã€Numpyãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚ŒãŸãƒ©ãƒ³ãƒ€ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¦ãƒ‡ãƒ¢ã‚’è¡Œã„ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="python hljs">input_1_data = np.random.random((batch_size * num_batch, timestep, input_1))<font></font>
input_2_data = np.random.random((batch_size * num_batch, timestep, input_2, input_3))<font></font>
target_1_data = np.random.random((batch_size * num_batch, unit_1))<font></font>
target_2_data = np.random.random((batch_size * num_batch, unit_2, unit_3))<font></font>
input_data = [input_1_data, input_2_data]<font></font>
target_data = [target_1_data, target_2_data]<font></font>
<font></font>
model.fit(input_data, target_data, batch_size=batch_size)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ¬ã‚¤ãƒ¤ãƒ¼</font></font><code>tf.keras.layers.RNN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å†…ã®å˜ä¸€ã‚¹ãƒ†ãƒƒãƒ—ã®æ•°å­¦çš„ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ±ºå®šã™ã‚‹ã ã‘</font><font style="vertical-align: inherit;">ã§</font><font style="vertical-align: inherit;">ã‚ˆã</font><font style="vertical-align: inherit;">ã€ãƒ¬ã‚¤ãƒ¤ãƒ¼</font><font style="vertical-align: inherit;">ã¯ã‚·ãƒ¼ã‚±ãƒ³ã‚¹</font></font><code>tf.keras.layers.RNN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã®åå¾©ã‚’å‡¦ç†ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã‚Œã¯ã€æ–°ã—ã„ã‚¿ã‚¤ãƒ—ã®RNNï¼ˆLSTMãƒãƒªã‚¢ãƒ³ãƒˆãªã©ï¼‰ã‚’ã™ã°ã‚„ããƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—åŒ–ã™ã‚‹ãŸã‚ã®éå¸¸ã«å¼·åŠ›ãªæ–¹æ³•ã§ã™ã€‚</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¤œè¨¼å¾Œã€ç¿»è¨³ã¯Tensorflow.orgã«ã‚‚è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">Tensorflow.orgã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ãƒ­ã‚·ã‚¢èªã¸ã®ç¿»è¨³ã«å‚åŠ ã—ãŸã„å ´åˆã¯ã€å€‹äººã¾ãŸã¯ã‚³ãƒ¡ãƒ³ãƒˆã§ã”é€£çµ¡ãã ã•ã„ã€‚</font><font style="vertical-align: inherit;">ä¿®æ­£ã‚„ã‚³ãƒ¡ãƒ³ãƒˆã¯ã‚ã‚ŠãŒãŸã„ã§ã™ã€‚</font></font></i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja487798/index.html">Oracle JDKãŠã‚ˆã³Java Web Startã‹ã‚‰AdoptOpenJDKãŠã‚ˆã³OpenWebStartã¸ã®ç§»è¡Œæ–¹æ³•</a></li>
<li><a href="../ja487800/index.html">é¢æ¥ä¸­ã«ä½•ãŒã†ã¾ãã„ã‹ãªã‹ã£ãŸã®ã‹ï¼ˆãã—ã¦ãã‚Œã‚’æ­£ã—ãè¡Œã†æ–¹æ³•ï¼‰ã‚’ç”³è«‹è€…ã«ä¼ãˆã‚‹ã“ã¨ãŒé‡è¦ãªã®ã¯ãªãœã§ã™ã‹</a></li>
<li><a href="../ja487802/index.html">ç„¡åœé›»APCã‚¹ãƒãƒ¼ãƒˆUPSã¨ãã®èª¿ç†æ–¹æ³•</a></li>
<li><a href="../ja487804/index.html">Raiffeisenbankã§ã®æˆé•·ãƒãƒ¼ãƒ ã®ãƒŸãƒ¼ãƒˆã‚¢ãƒƒãƒ—</a></li>
<li><a href="../ja487806/index.html">å°ã•ãªDeno APIã‚’ä½œæˆã™ã‚‹</a></li>
<li><a href="../ja487812/index.html">E27ã‚’å°ã„ãŸãƒãƒ¼ãƒ©ãƒ³ãƒ‰ã®LEDã‚¹ãƒšã‚¯ãƒˆãƒ«ã®ãƒ†ã‚¹ãƒˆ</a></li>
<li><a href="../ja487814/index.html">é€Ÿåº¦ã¨ä¿¡é ¼æ€§ãŒé«˜ãã€ä¾¡æ ¼ãŒä½ããªã£ã¦ã„ã¾ã™ã€‚æ–°ã—ã„ã‚­ãƒ³ã‚°ã‚¹ãƒˆãƒ³KC2000ã‚½ãƒªãƒƒãƒ‰ã‚¹ãƒ†ãƒ¼ãƒˆãƒ‰ãƒ©ã‚¤ãƒ–</a></li>
<li><a href="../ja487822/index.html">AvitoTech On Tourï¼šNizhny Novgorodã§ã®Androidäº¤æµä¼š</a></li>
<li><a href="../ja487824/index.html">LEDãƒ©ãƒ³ãƒ—ã®æ¦‚è¦ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ã‹ã‚‰ã®ã‚¹ãƒšã‚¯ãƒˆãƒ«Led GU10</a></li>
<li><a href="../ja487826/index.html">ãƒãƒ¼ãƒ©ãƒ³ãƒ‰ã®LEDãƒ©ãƒ³ãƒ—ã®æ¦‚è¦Spectrum Led E14</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>