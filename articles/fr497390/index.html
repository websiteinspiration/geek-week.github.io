<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👹 🧔🏿 🍅 Comment nous avons appris à recommander des films et pourquoi vous ne devriez pas vous fier uniquement aux notes 🙋🏼 🎹 🎂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Imaginez que vous vouliez passer la soirée à regarder un film, mais vous ne savez pas lequel choisir. Les utilisateurs de Yandex se retrouvent souvent...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Comment nous avons appris à recommander des films et pourquoi vous ne devriez pas vous fier uniquement aux notes</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/497390/"><img src="https://habrastorage.org/webt/vu/_4/oo/vu_4oolbpa8pde7nsycpg5vpokq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imaginez que vous vouliez passer la soirée à regarder un film, mais vous ne savez pas lequel choisir. Les utilisateurs de Yandex se retrouvent souvent dans la même situation, donc notre équipe élabore des recommandations qui peuvent être trouvées sur Search et Air. Il semblerait que cela soit compliqué: nous prenons les notes des utilisateurs, avec leur aide, nous entraînons la voiture à trouver des films susceptibles de donner 5 points, nous obtenons une liste de films prête à l'emploi. Mais cette approche ne fonctionne pas. Pourquoi? C’est ce dont je vais vous parler aujourd’hui.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un peu d'histoire. En 2006, Netflix a lancé le concours d'apprentissage automatique du prix Netflix. Si vous avez soudainement oublié, la société n'a pas encore diffusé sur Internet, mais a loué des films sur DVD. Mais même alors, il était important pour elle de prédire la note de l'utilisateur afin de lui recommander quelque chose. Donc, l'essence de la concurrence: prédire les notes des téléspectateurs est 10% mieux (selon la métrique RMSE) que Cinematch, le système de recommandation Netflix. Ce fut l'une des premières compétitions de masse de ce type. L'intérêt a chauffé un énorme ensemble de données (plus de 100 millions de notes), ainsi qu'un prix de 1 million de dollars.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le concours s'est terminé en 2009. </font><font style="vertical-align: inherit;">Les équipes de BellKor Pragmatic Chaos et de l'Ensemble ont atteint la ligne d'arrivée avec le même résultat (RMSE = 0,8567), mais l'Ensemble a pris la deuxième place car il a envoyé la solution 20 minutes plus tard que les concurrents. </font><font style="vertical-align: inherit;">Les résultats et les travaux peuvent être trouvés </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Mais la chose la plus intéressante est différente. </font><font style="vertical-align: inherit;">Si vous croyez aux histoires répétées lors de conférences spécialisées, les algorithmes gagnants ne sont pas apparus en production dans le service de streaming vidéo qui a été lancé bientôt. </font><font style="vertical-align: inherit;">Je ne peux pas parler des raisons des décisions des autres, mais je vais vous expliquer pourquoi nous avons fait de même.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Évaluation personnelle</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depuis un certain temps maintenant, les utilisateurs de Yandex peuvent évaluer les films qu'ils ont regardés. Et pas seulement chez KinoPoisk, mais aussi dans les résultats de recherche. Au fil du temps, nous avons accumulé des centaines de millions d'estimations de dizaines de millions de personnes. À un moment donné, nous avons décidé d'utiliser ces données pour aider les utilisateurs à comprendre à quel point ils aimeraient un film. En fait, nous avons résolu le même problème qu'au concours du prix Netflix, c'est-à-dire que nous avions prédit quelle note l'utilisateur attribuerait au film. À cette époque, il existait déjà des notations KinoPoisk et IMDB, construites sur la base des notations des personnes. Nous avons construit une note personnelle, nous avons donc décidé d'utiliser une échelle séparée en pourcentage afin d'éviter les similitudes visuelles et la confusion.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dd/tk/h7/ddtkh7i3ud_9q5lmqtvw-4ambgc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Soit dit en passant, la nécessité de corréler l'échelle des points et le pourcentage est un casse-tête distinct et non évident, alors j'en parlerai brièvement. </font><font style="vertical-align: inherit;">Il semblerait que pour une échelle de 10 points, prenez 10% pour chaque point - et le point est dans le chapeau. </font><font style="vertical-align: inherit;">Mais non. </font><font style="vertical-align: inherit;">La raison en est la psychologie et les habitudes. </font><font style="vertical-align: inherit;">Par exemple, du point de vue des utilisateurs, une note de 8/10 est bien meilleure que 80%. </font><font style="vertical-align: inherit;">Comment corréler cela? </font><font style="vertical-align: inherit;">Avec le crowdsourcing! </font><font style="vertical-align: inherit;">Et c'est ce que nous avons fait: nous avons lancé la tâche à Tolok, dans laquelle les tireurs décrivaient les attentes des films avec un certain score ou pourcentage de note personnelle. </font><font style="vertical-align: inherit;">Sur la base de ce balisage, nous avons sélectionné une fonction qui traduit la prédiction du score du point au pourcentage afin que les attentes des utilisateurs soient maintenues.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemples de quêtes à Tolok</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/webt/tw/fv/ux/twfvuxxkjd7rnkave0yuudmzs5q.png"><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est utile de prévoir les attentes du film, mais il serait également utile de formuler des recommandations. </font><font style="vertical-align: inherit;">Autrement dit, montrez immédiatement à la personne une liste de bons films. </font><font style="vertical-align: inherit;">À ce moment-là, beaucoup d'entre vous pourraient penser: «Et disons simplement trier les films que l'utilisateur n'a pas regardés par classement personnel.» </font><font style="vertical-align: inherit;">Nous l'avons pensé aussi au début. </font><font style="vertical-align: inherit;">Mais j'ai dû résoudre deux problèmes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Problème d'outil</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsqu'un utilisateur recherche un film particulier (ou souhaite louer un DVD spécifique), le service doit prédire la note de ce film particulier. Exactement, ce problème a été résolu lors du concours du prix Netflix, où la métrique RMSE a été utilisée. Mais les recommandations résolvent un problème différent: vous n'avez pas besoin de deviner la note, mais de trouver un film qui sera finalement regardé. Et la métrique RMSE fait un mauvais travail. Par exemple, la pénalité pour prédire une note de 2 au lieu de 1 est exactement la même que pour 5 au lieu de 4. Mais notre système ne devrait jamais recommander des films auxquels l'utilisateur met 2! Les métriques basées sur des listes conviennent beaucoup mieux à cette tâche, telles que Precision @ K, Recall @ K, MRR ou NDCG. Je ne peux pas m'empêcher de vous en dire un peu plus à leur sujet (mais si vous n'êtes pas intéressé par les statistiques, sautez simplement le paragraphe suivant). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Commençons par la métrique.</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MRR</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (rang réciproque moyen). Nous verrons quelle position dans le classement sera le film avec lequel l'utilisateur a interagi (par exemple, regardé ou félicité) pendant la période de test. La métrique MRR est la position inverse moyenne d'un utilisateur d'un tel film. C'est à dire</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>M</mi><mi>R</mi><mi>R</mi><mo>=</mo><mfrac><mn>1</mn><mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>U</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow></mrow></mfrac><munderover><mo>&amp;#x2211;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>u</mi><mo>=</mo><mn>1</mn></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>U</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow></mrow></munderover><mfrac><mn>1</mn><mrow><mi>r</mi><mi>a</mi><mi>n</mi><msub><mi>k</mi><mi>u</mi></msub></mrow></mfrac></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="23.7ex" height="4.259ex" viewBox="0 -1132.2 10204.2 1833.9" role="img" focusable="false" style="vertical-align: -1.63ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMATHI-4D" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMATHI-52" x="1051" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMATHI-52" x="1811" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMAIN-3D" x="2848" y="0"></use><g transform="translate(3626,0)"><g transform="translate(397,0)"><rect stroke="none" width="1056" height="60" x="0" y="220"></rect><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMAIN-31" x="496" y="582"></use><g transform="translate(60,-442)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMAIN-7C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMATHI-55" x="278" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMAIN-7C" x="1046" y="0"></use></g></g></g><g transform="translate(5367,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJSZ1-2211" x="0" y="0"></use><g transform="translate(1056,521)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMAIN-7C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMATHI-55" x="278" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMAIN-7C" x="1046" y="0"></use></g><g transform="translate(1056,-308)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMATHI-75" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMAIN-3D" x="572" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMAIN-31" x="1351" y="0"></use></g></g><g transform="translate(7833,0)"><g transform="translate(286,0)"><rect stroke="none" width="1964" height="60" x="0" y="220"></rect><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMAIN-31" x="1138" y="582"></use><g transform="translate(60,-403)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMATHI-72" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMATHI-61" x="451" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMATHI-6E" x="981" y="0"></use><g transform="translate(1118,0)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMATHI-6B" x="0" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMATHI-75" x="737" y="-213"></use></g></g></g></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi><mi>R</mi><mi>R</mi><mo>=</mo><mfrac><mn>1</mn><mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>U</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow></mrow></mfrac><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>u</mi><mo>=</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>U</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow></mrow></munderover><mfrac><mn>1</mn><mrow><mi>r</mi><mi>a</mi><mi>n</mi><msub><mi>k</mi><mi>u</mi></msub></mrow></mfrac></math></span></span><script type="math/tex" id="MathJax-Element-1">MRR = \frac{1}{|U|} \sum_{u=1}^{|U|} \frac{1}{rank_u}</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Une telle métrique, contrairement à RMSE, évalue la liste entière, mais, malheureusement, ne regarde que le premier élément deviné. Cependant, il est facile de modifier la métrique pour supprimer cet inconvénient. Nous pouvons calculer la somme des positions inverses de tous les films avec lesquels l'utilisateur a interagi. Cette métrique est appelée Classement réciproque moyen. Cette métrique prend en compte tous les films devinés dans le numéro. Notez que la position k dans le paiement reçoit un poids de 1 / k pour un film deviné et un poids de 0 pour un autre film. Souvent, 1 / log (k) est utilisé au lieu de 1 / k: cela correspond plus probablement à la probabilité que l'utilisateur défile jusqu'à la position k. Le résultat est une métrique DCG (gain cumulé actualisé)</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>D</mi><mi>C</mi><mi>G</mi><mo>=</mo><mfrac><mn>1</mn><mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>U</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow></mrow></mfrac><munderover><mo>&amp;#x2211;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>u</mi><mo>=</mo><mn>1</mn></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>U</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow></mrow></munderover><munderover><mo>&amp;#x2211;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>p</mi><mi>o</mi><mi>s</mi><mo>=</mo><mn>1</mn></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi></mrow></munderover><mfrac><mrow><mi>g</mi><mi>a</mi><mi>i</mi><msub><mi>n</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>p</mi><mi>o</mi><mi>s</mi></mrow></msub></mrow><mrow><mo movablelimits=&quot;true&quot; form=&quot;prefix&quot;>max</mo><mo stretchy=&quot;false&quot;>(</mo><mn>1</mn><mo>,</mo><mi>log</mi><mo>&amp;#x2061;</mo><mo stretchy=&quot;false&quot;>(</mo><mi>p</mi><mi>o</mi><mi>s</mi><mo stretchy=&quot;false&quot;>)</mo><mo stretchy=&quot;false&quot;>)</mo></mrow></mfrac></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="37.927ex" height="4.384ex" viewBox="0 -1186 16329.6 1887.7" role="img" focusable="false" style="vertical-align: -1.63ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMATHI-44" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMATHI-43" x="828" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMATHI-47" x="1589" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMAIN-3D" x="2653" y="0"></use><g transform="translate(3431,0)"><g transform="translate(397,0)"><rect stroke="none" width="1056" height="60" x="0" y="220"></rect><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMAIN-31" x="496" y="582"></use><g transform="translate(60,-442)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMAIN-7C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMATHI-55" x="278" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMAIN-7C" x="1046" y="0"></use></g></g></g><g transform="translate(5172,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJSZ1-2211" x="0" y="0"></use><g transform="translate(1056,521)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMAIN-7C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMATHI-55" x="278" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMAIN-7C" x="1046" y="0"></use></g><g transform="translate(1056,-308)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMATHI-75" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMAIN-3D" x="572" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMAIN-31" x="1351" y="0"></use></g></g><g transform="translate(7805,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJSZ1-2211" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMATHI-4E" x="1494" y="675"></use><g transform="translate(1056,-287)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMATHI-6F" x="503" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMATHI-73" x="989" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMAIN-3D" x="1458" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMAIN-31" x="2237" y="0"></use></g></g><g transform="translate(10897,0)"><g transform="translate(286,0)"><rect stroke="none" width="5025" height="60" x="0" y="220"></rect><g transform="translate(1421,614)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMATHI-67" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMATHI-61" x="480" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMATHI-69" x="1010" y="0"></use><g transform="translate(958,0)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMATHI-6E" x="0" y="0"></use><g transform="translate(424,-107)"><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMATHI-6F" x="503" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMATHI-73" x="989" y="0"></use></g></g></g><g transform="translate(60,-442)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMAIN-6D"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMAIN-61" x="833" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMAIN-78" x="1334" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMAIN-28" x="1862" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMAIN-31" x="2252" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMAIN-2C" x="2752" y="0"></use><g transform="translate(2143,0)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMAIN-6C"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMAIN-6F" x="278" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMAIN-67" x="779" y="0"></use></g><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMAIN-28" x="4310" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMATHI-70" x="4700" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMATHI-6F" x="5203" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMATHI-73" x="5689" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMAIN-29" x="6158" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/yandex/blog/497390/&amp;usg=ALkJrhg79eH-SgVbZyvJS0dKMqff6ntpqA#MJMAIN-29" x="6548" y="0"></use></g></g></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi><mi>C</mi><mi>G</mi><mo>=</mo><mfrac><mn>1</mn><mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>U</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow></mrow></mfrac><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>u</mi><mo>=</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>U</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow></mrow></munderover><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>p</mi><mi>o</mi><mi>s</mi><mo>=</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>N</mi></mrow></munderover><mfrac><mrow><mi>g</mi><mi>a</mi><mi>i</mi><msub><mi>n</mi><mrow class="MJX-TeXAtom-ORD"><mi>p</mi><mi>o</mi><mi>s</mi></mrow></msub></mrow><mrow><mo movablelimits="true" form="prefix">max</mo><mo stretchy="false">(</mo><mn>1</mn><mo>,</mo><mi>log</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>p</mi><mi>o</mi><mi>s</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mfrac></math></span></span><script type="math/tex" id="MathJax-Element-2">DCG = \frac{1}{|U|} \sum_{u=1}^{|U|} \sum_{pos=1}^{N} \frac{gain_{pos}}{\max(1, \log(pos))}</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Mais la contribution des différents utilisateurs à la métrique est différente: pour quelqu'un, nous avons deviné tous les films, pour quelqu'un, nous n'avons rien deviné. </font><font style="vertical-align: inherit;">Par conséquent, en règle générale, cette métrique est normalisée. </font><font style="vertical-align: inherit;">Divisez le DCG de chaque utilisateur en le DCG le mieux classé pour cet utilisateur. </font><font style="vertical-align: inherit;">La mesure résultante est appelée </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NDCG</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (gain cumulatif actualisé normalisé). </font><font style="vertical-align: inherit;">Il est largement utilisé pour évaluer la qualité du classement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, chaque tâche a sa propre métrique. </font><font style="vertical-align: inherit;">Mais le problème suivant n'est pas si évident.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Problème de choix</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est déjà assez difficile à décrire, mais je vais essayer. Il s'avère que les gens accordent des notes élevées non pas aux films qu'ils </font><font style="vertical-align: inherit;">regardent </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">habituellement</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Les chefs-d'œuvre de films rares, les classiques, l'art et l'art obtiennent les meilleures notes, mais cela n'empêche pas les gens le soir après le travail de regarder avec plaisir une bonne comédie, un nouveau film d'action ou un opéra spatial spectaculaire. Ajoutez à cela que les utilisateurs de Yandex n'ont pas apprécié tous les films qu'ils ont regardés une fois et quelque part. Et si nous nous concentrons uniquement sur les notes les plus élevées, nous courons le risque d'obtenir un flux de film recommandé qui semblera logique, les utilisateurs peuvent même reconnaître sa qualité, mais à la fin ils ne regarderont rien.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, voici à quoi ressemblerait mon flux de film si nous le classions par note personnelle et si nous ne savions rien de mes vues par le passé. Grands films. Mais je ne veux pas les revoir aujourd'hui.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5y/gz/ot/5ygzotyougvrodtwyb_nlbp03va.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'avère que dans les conditions de cotes éparses et d'une pénurie de films avec des cotes élevées, il vaut la peine de regarder non seulement la cote. Eh bien, nous formons la voiture pour prédire le visionnement du film recommandé, et non la note. Cela semblerait logique, car l'utilisateur le souhaite. Qu'est-ce qui pourrait mal se passer? Le problème est que la bande sera remplie de films, dont chacun est tout à fait adapté à un passe-temps facile le soir, mais leur cote personnelle sera faible. Les utilisateurs, bien sûr, feront attention au fait qu'il n'y a pas de «chefs-d'œuvre» dans le flux, ce qui signifie que la crédibilité des recommandations sera compromise, ils ne regarderont pas ce qu'ils verraient autrement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conséquence, nous avons compris qu'un équilibre entre les deux extrêmes était nécessaire. Il est nécessaire de former la machine afin que le potentiel de visualisation et la perception de la recommandation par une personne soient pris en compte.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment fonctionnent nos recommandations</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notre système fait partie de la recherche, nous devons donc formuler des recommandations très rapidement: le temps de réponse du service doit être inférieur à 100 millisecondes. </font><font style="vertical-align: inherit;">Par conséquent, nous essayons d'effectuer autant d'opérations lourdes que possible hors ligne, au stade de la préparation des données. </font><font style="vertical-align: inherit;">Tous les films et utilisateurs du système de recommandation sont représentés par des profils (il est important de ne pas les confondre avec le compte), qui incluent des clés d'objet, des compteurs et des incorporations (en d'autres termes, des vecteurs dans un certain espace). </font><font style="vertical-align: inherit;">Des profils de films sont préparés chaque jour sur YT ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lire «Yt»</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) et chargés dans la RAM des machines qui répondent aux demandes. </font><font style="vertical-align: inherit;">Mais avec les utilisateurs, tout est un peu plus compliqué.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chaque jour, nous créons également le profil utilisateur principal sur YT et l'envoyons au magasin Yandex, à partir duquel vous pouvez obtenir le profil en quelques dizaines de millisecondes. Mais les données deviennent rapidement obsolètes si une personne regarde et évalue activement la vidéo. Ce n'est pas bon si les recommandations commencent à prendre du retard. Par conséquent, nous lisons le flux d'événements utilisateur et formons la partie dynamique du profil. Lorsqu'une personne saisit une demande, nous combinons le profil du référentiel avec un profil dynamique et obtenons un profil unique, qui peut être en retard sur la réalité pendant quelques secondes seulement.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela se produit hors ligne (c'est-à-dire à l'avance), et maintenant nous passons directement à l'exécution. Ici, le système de recommandation comprend deux étapes. Le classement de la base de données complète des films est trop long, donc à la première étape, nous sélectionnons simplement plusieurs centaines de candidats, c'est-à-dire que nous trouvons des films qui peuvent intéresser le spectateur. Cela inclut à la fois les peintures populaires et celles proches de l'utilisateur dans certaines intégrations. Il existe plusieurs algorithmes pour trouver rapidement les voisins les plus proches, nous utilisons HNSW (Hierarchical Navigable Small World). Avec lui, nous trouvons les films les plus proches de l'utilisateur en seulement quelques millisecondes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la deuxième étape, nous extrayons des fonctionnalités (parfois elles sont également appelées facteurs) par films, utilisateur et paire utilisateur / film et </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">classons les</font></a><font style="vertical-align: inherit;"> candidats à l'aide de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CatBoost</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Permettez-moi de vous rappeler: nous avons déjà réalisé que nous devons nous concentrer non seulement sur les vues, mais également sur d'autres caractéristiques de qualité des recommandations, donc pour le classement, nous sommes arrivés à une combinaison de plusieurs modèles CatBoost formés pour différentes cibles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour trouver des candidats, nous utilisons des plongements à partir de plusieurs décompositions matricielles: de la version classique d'ALS, qui prédit l'évaluation, aux variations plus complexes basées sur SVD ++. </font><font style="vertical-align: inherit;">En tant que fonctionnalités de classement, des compteurs d'événements et des films utilisateur simples, des CTR pour divers événements, ainsi que des modèles pré-formés plus complexes sont utilisés. </font><font style="vertical-align: inherit;">Par exemple, la prédiction ALS agit également comme une fonctionnalité. </font><font style="vertical-align: inherit;">L'un des modèles les plus utiles est le réseau neuronal Recommender DSSM, dont je parlerai probablement un peu plus.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recommender DSSM</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DSSM est un réseau neuronal à deux tours. Chaque tour construit son propre encastrement, puis la distance cosinus est prise en compte entre les encastrements, ce nombre est la sortie du réseau. Autrement dit, le réseau apprend à évaluer la proximité d'objets dans les tours gauche et droite. Des réseaux de neurones similaires sont utilisés, par exemple, dans une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recherche</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur le </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">Web</font></a><font style="vertical-align: inherit;"> pour trouver des documents pertinents pour une requête. Pour la tâche de recherche, une demande est envoyée à l'une des tours et un document à l'autre. Pour notre réseau, le rôle de la demande est joué par l'utilisateur, et les films agissent comme des documents.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La tour du film construit une intégration basée sur les données du film: c'est le titre, la description, le genre, le pays, les acteurs, etc. Cette partie du réseau est assez similaire à la recherche. Cependant, pour le spectateur, nous voulons utiliser son histoire. Pour ce faire, nous agrégons l'intégration des films de l'histoire avec le fondu dans le temps depuis le moment de l'événement. Ensuite, en plus de l'incorporation totale, nous appliquons plusieurs couches du réseau et, par conséquent, nous obtenons une incorporation de taille 400.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lt/3k/v0/lt3kv0xtsbzqiyxq_333j3sgkua.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous prenez immédiatement en compte l'intégralité de l'historique de l'utilisateur dans l'intégration, cela ralentira considérablement la formation. </font><font style="vertical-align: inherit;">Par conséquent, nous allons à l'astuce et apprenons le réseau en deux étapes. </font><font style="vertical-align: inherit;">Tout d'abord, apprenez le InnerDSSM plus simple. </font><font style="vertical-align: inherit;">A l'entrée, il ne reçoit que les 50 derniers événements de l'historique de l'utilisateur sans se diviser en types d'événements (vues, notes ...). </font><font style="vertical-align: inherit;">Ensuite, nous recyclons l'InnerDSSM résultant tout au long de l'historique de l'utilisateur, mais avec une ventilation en types d'événements. </font><font style="vertical-align: inherit;">Nous obtenons donc OuterDSSM, qui est utilisé lors de l'exécution. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'utilisation d'un réseau d'exécution dans le front nécessite beaucoup de ressources informatiques. </font><font style="vertical-align: inherit;">Par conséquent, nous enregistrons les incorporations de la tour de cinéma dans la base de données et les intégrations en fonction de l'historique des utilisateurs sont mises à jour presque en temps réel. </font><font style="vertical-align: inherit;">Ainsi, lors du traitement de la demande, il suffit d'appliquer une petite partie d'OuterDSSM et de calculer les cosinus, cela ne prend pas beaucoup de temps.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, nos recommandations sont déjà disponibles dans notre recherche (par exemple, sur demande </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[que voir]</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), dans le service Yandex.Air, et une version adaptée de cette technologie est également utilisée dans Yandex.Stations. </font><font style="vertical-align: inherit;">Mais cela ne signifie pas que nous pouvons nous détendre. </font><font style="vertical-align: inherit;">Nous formons constamment de nouveaux modèles, appliquons de plus en plus de données, essayons de nouvelles approches de formation et de nouvelles métriques de qualité. </font><font style="vertical-align: inherit;">À mon avis, plus la zone est ancienne, plus elle est difficile à développer. </font><font style="vertical-align: inherit;">Mais c'est le principal intérêt des spécialistes.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr497376/index.html">Que faire avec les joues rouges pour que votre nez ne grossisse pas</a></li>
<li><a href="../fr497382/index.html">8 difficultés des équipes Agile pendant la pandémie: «Ndagwurugwu nke anya mmiri», ụjọ, oke iwe, agọnar, COVID-19</a></li>
<li><a href="../fr497384/index.html">Comment établir un accès sécurisé aux serveurs en mode distant</a></li>
<li><a href="../fr497386/index.html">Les boursiers VK Fellowship parlent de l'avenir de l'enseignement à distance, de la discipline et de la socialisation</a></li>
<li><a href="../fr497388/index.html">Un millionième tireur à partir de zéro: un parcours de développeur indépendant</a></li>
<li><a href="../fr497392/index.html">Comment évoluer d'un étudiant ingénieur logiciel?</a></li>
<li><a href="../fr497394/index.html">Dix ressources avec des cours d'informatique disponibles gratuitement en avril</a></li>
<li><a href="../fr497396/index.html">Collègues: ni ami ni ennemi, mais comment?</a></li>
<li><a href="../fr497398/index.html">Processeurs serveurs AMD EPYC Rome 7x32 - Enregistrer des performances monocœur</a></li>
<li><a href="../fr497402/index.html">Comment créer un langage de programmation Python?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>