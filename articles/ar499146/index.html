<!doctype html>
<html class="no-js" lang="ar">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🖖🏾 ⏫ 😇 طريقة سهلة لحماية Mikrotik من الهجمات 🕺🏽 👨🏽‍🚀 🈶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="أريد أن أشارك مع المجتمع طريقة بسيطة وعملية في كيفية استخدام Mikrotik لحماية شبكتي والخدمات التي "تنظر" بسببها من الهجمات الخارجية. وبالتحديد بثلاث قو...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>طريقة سهلة لحماية Mikrotik من الهجمات</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/499146/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">أريد أن أشارك مع المجتمع طريقة بسيطة وعملية في كيفية استخدام Mikrotik لحماية شبكتي والخدمات التي "تنظر" بسببها من الهجمات الخارجية. وبالتحديد بثلاث قواعد ، قم بتنظيم مصيدة على Mikrotik. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لذا ، دعونا نتخيل أن لدينا مكتب صغير ، وعنوان IP خارجي خلفه خادم RDP ، للموظفين للعمل عن بعد. القاعدة الأولى بالطبع هي تغيير المنفذ 3389 على الواجهة الخارجية إلى أخرى. ولكن هذا ليس لفترة طويلة ، بعد يومين ، سيبدأ سجل تدقيق خادم المحطة الطرفية في إظهار العديد من التفويضات الفاشلة في الثانية من عملاء غير معروفين.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
موقف آخر ، لديك علامة النجمة مخفية خلف Mikrotik ، بالطبع ، ليس على منفذ 5060 UDP ، وبعد يومين من تخمين كلمة المرور يبدأ أيضًا ... نعم نعم ، أعلم ، fail2ban هو كل شيء لدينا ، ولكن لا يزال يتعين علي النفخ عليه ... على سبيل المثال ، رفعته مؤخرًا إلى ubuntu في 18 أبريل ، فوجئت عندما اكتشفت أنه من خارج الصندوق لا يحتوي على الإعدادات الفعلية للعلامة النجمية من نفس المربع من نفس توزيع أوبونتو ... ولكن لا تستطيع Google الإعدادات السريعة لـ "الوصفات" الجاهزة ، وعدد الإصدارات ينمو على مر السنين ، والمقالات مع " وصفات "للنسخ القديمة لم تعد تعمل ، ولكن لا توجد وصفات جديدة تقريبًا ... لكن شيئًا أتناوله ...</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لذا ، ما هو مصيدة اختصار - هو شرك ، في حالتنا ، بعض المنافذ الشائعة على IP خارجي ، أي طلب لهذا المنفذ من عميل خارجي يرسل عنوان src إلى القائمة السوداء. </font><font style="vertical-align: inherit;">الكل.</font></font><br>
 <br>
<pre><code class="plaintext hljs">/ip firewall filter<font></font>
add action=add-src-to-address-list address-list="Honeypot Hacker" \<font></font>
    address-list-timeout=30d0h0m chain=input comment="block honeypot ssh rdp winbox" \<font></font>
    connection-state=new dst-port=22,3389,8291 in-interface=\<font></font>
    ether4-wan protocol=tcp<font></font>
add action=add-src-to-address-list address-list="Honeypot Hacker" \<font></font>
    address-list-timeout=30d0h0m chain=input comment=\<font></font>
    "block honeypot asterisk" connection-state=new dst-port=5060 \<font></font>
    in-interface=ether4-wan protocol=udp <font></font>
/ip firewall raw<font></font>
add action=drop chain=prerouting in-interface=ether4-wan src-address-list=\<font></font>
    "Honeypot Hacker"<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ترسل القاعدة الأولى على منافذ TCP الشائعة 22 و 3389 و 8291 من واجهة ether4-wan الخارجية عنوان IP الضيف إلى قائمة Honeypot Hacker (يتم تعطيل منافذ ssh و rdp و winbox مقدمًا أو يتم تغييرها إلى الآخرين). والثاني يفعل الشيء نفسه مع UDP 5060 المشهور </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
. والقاعدة الثالثة في مرحلة ما قبل التوجيه تسقط حزم "الضيوف" الذين دخل عنوانهم في "Honeypot Hacker". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
بعد أسبوعين من العمل في منزلي Mikrotik ، تضمنت قائمة Honeypot Hacker حوالي ألف ونصف عنوان IP من المعجبين الصديقين للضرع من موارد شبكتي (الاتصال الهاتفي المنزلي ، والبريد ، و nextcloud ، و rdp). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في العمل ، لم يكن كل شيء بسيطًا جدًا ، فهم يواصلون كسر خادم rdp بكلمات مرور القوة الغاشمة.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
على ما يبدو ، تم تحديد رقم المنفذ من قبل الماسح الضوئي قبل تشغيل المصيدة بفترة طويلة ، وأثناء العزل ليس من السهل إعادة تكوين أكثر من 100 مستخدم ، 20٪ منهم تجاوزوا 65 عامًا. </font><font style="vertical-align: inherit;">في حالة عدم إمكانية تغيير المنفذ ، هناك وصفة عمل صغيرة. </font><font style="vertical-align: inherit;">لقد التقيت بالمثل على الإنترنت ، ولكن هناك تعديل نهائي:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">قواعد تكوين Port Knocking</font></font></b>
                        <div class="spoiler_text"> <pre><code class="plaintext hljs"> /ip firewall filter<font></font>
add action=add-src-to-address-list address-list=rdp_blacklist \<font></font>
    address-list-timeout=15m chain=forward comment=rdp_to_blacklist \<font></font>
    connection-state=new dst-port=3389 protocol=tcp src-address-list=\<font></font>
    rdp_stage12<font></font>
add action=add-src-to-address-list address-list=rdp_stage12 \<font></font>
    address-list-timeout=4m chain=forward connection-state=new dst-port=3389 \<font></font>
    protocol=tcp src-address-list=rdp_stage11<font></font>
add action=add-src-to-address-list address-list=rdp_stage11 \<font></font>
    address-list-timeout=4m chain=forward connection-state=new dst-port=3389 \<font></font>
    protocol=tcp src-address-list=rdp_stage10<font></font>
add action=add-src-to-address-list address-list=rdp_stage10 \<font></font>
    address-list-timeout=4m chain=forward connection-state=new dst-port=3389 \<font></font>
    protocol=tcp src-address-list=rdp_stage9<font></font>
add action=add-src-to-address-list address-list=rdp_stage9 \<font></font>
    address-list-timeout=4m chain=forward connection-state=new dst-port=3389 \<font></font>
    protocol=tcp src-address-list=rdp_stage8<font></font>
add action=add-src-to-address-list address-list=rdp_stage8 \<font></font>
    address-list-timeout=4m chain=forward connection-state=new dst-port=3389 \<font></font>
    protocol=tcp src-address-list=rdp_stage4<font></font>
add action=add-src-to-address-list address-list=rdp_stage7 \<font></font>
    address-list-timeout=4m chain=forward connection-state=new dst-port=3389 \<font></font>
    protocol=tcp src-address-list=rdp_stage6<font></font>
add action=add-src-to-address-list address-list=rdp_stage6 \<font></font>
    address-list-timeout=4m chain=forward connection-state=new dst-port=3389 \<font></font>
    protocol=tcp src-address-list=rdp_stage5<font></font>
add action=add-src-to-address-list address-list=rdp_stage5 \<font></font>
    address-list-timeout=2m chain=forward connection-state=new dst-port=\<font></font>
    3389 protocol=tcp src-address-list=rdp_stage4<font></font>
add action=add-src-to-address-list address-list=rdp_stage4 \<font></font>
    address-list-timeout=2m chain=forward connection-state=new dst-port=\<font></font>
    3389 protocol=tcp src-address-list=rdp_stage3<font></font>
add action=add-src-to-address-list address-list=rdp_stage3 \<font></font>
    address-list-timeout=2m chain=forward connection-state=new dst-port=3389 \<font></font>
    protocol=tcp src-address-list=rdp_stage2<font></font>
add action=add-src-to-address-list address-list=rdp_stage2 \<font></font>
    address-list-timeout=2m chain=forward connection-state=new dst-port=3389 \<font></font>
    protocol=tcp src-address-list=rdp_stage1<font></font>
add action=add-src-to-address-list address-list=rdp_stage1 \<font></font>
    address-list-timeout=2m chain=forward connection-state=new dst-port=3389 \<font></font>
    protocol=tcp <font></font>
/ip firewall raw<font></font>
add action=drop chain=prerouting in-interface=ether4-wan src-address-list=\<font></font>
rdp_blacklist<font></font>
</code></pre> </div>
                    </div> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في 4 دقائق ، يُسمح للعميل البعيد بإجراء 12 طلبًا جديدًا فقط إلى خادم RDP. </font><font style="vertical-align: inherit;">محاولة تسجيل دخول واحدة تتراوح من 1 إلى 4 "طلبات". </font><font style="vertical-align: inherit;">عند "الطلب" الثاني عشر - قفل لمدة 15 دقيقة. </font><font style="vertical-align: inherit;">في حالتي ، لم يتوقف المهاجمون عن اختراق الخادم ، فقد تكيفوا مع المؤقتات والآن يفعلون ذلك ببطء شديد ، سرعة التحديد هذه تقلل من كفاءة الهجوم إلى الصفر. </font><font style="vertical-align: inherit;">لا يعاني موظفو المنشأة عمليا من أي إزعاج في العمل الذي تم القيام به.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">خدعة صغيرة أخرى</font></font></b>
                        <div class="spoiler_text">            5,     ,     .<br>
<br>
<pre><code class="plaintext hljs">/ip firewall filter <font></font>
add action=add-src-to-address-list address-list=rdp_blacklist \<font></font>
    address-list-timeout=1w0d0h0m chain=forward comment=\<font></font>
    "night_rdp_blacklist" connection-state=new disabled=\<font></font>
    yes dst-port=3389 protocol=tcp src-address-list=rdp_stage8</code></pre><br>
  8    IP       . !<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
حسنًا ، بالإضافة إلى ما سبق ، سأضيف رابطًا إلى مقالة Wiki ، مع إعداد العمل لحماية Mikrotik من الماسحات الضوئية للشبكة. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wiki.mikrotik.com/wiki/Drop_port_scanners</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
على </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">أجهزتي</font></a><font style="vertical-align: inherit;"> ، يعمل هذا الإعداد جنبًا إلى جنب مع قواعد المصائد الموصوفة أعلاه ، ويكملها بشكل جيد. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPD: كما هو مقترح في التعليقات ، تم نقل قاعدة إسقاط الحزمة إلى RAW لتقليل الحمل على جهاز التوجيه.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar499130/index.html">هندسة BlockAdBlock للإعلانات المضادة للحظر العكسي</a></li>
<li><a href="../ar499134/index.html">4 خطوات لزيادة منتج LTV من خلال اتصال المستخدم</a></li>
<li><a href="../ar499136/index.html">#BeeFree ، أو ... Beeline - أنت لا تستطيع المقاومة؟</a></li>
<li><a href="../ar499138/index.html">الفرز الطوبولوجي</a></li>
<li><a href="../ar499140/index.html">جيل تحت السيطرة: كيفية كبح نماذج اللغة القوية</a></li>
<li><a href="../ar499148/index.html">الهباء وثاني أكسيد الكلور (ClO2): ما علاقة ذلك؟</a></li>
<li><a href="../ar499150/index.html">ومحارب واحد في الميدان: هل من الممكن تقديم خدمات استضافة عالية الجودة بدون فريق</a></li>
<li><a href="../ar499152/index.html">DLL و Python</a></li>
<li><a href="../ar499154/index.html">ملخص المواد المثيرة للاهتمام لمطور # 342 للجوال (في 20 - 26 أبريل)</a></li>
<li><a href="../ar499160/index.html">Российский SCRUM. Бессмысленный и беспощадный</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>