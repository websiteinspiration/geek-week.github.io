<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚲 📮 👩🏿‍🤝‍👨🏼 やかんからのAndroid Camera2 API 🌗 🕺🏾 🚻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="少し前まで、私はロボットマシンで忙しくて、Androidスマートフォンを載せようとしていました。私、つまり彼の仕事は、カートを進化的に進化させることでした。彼女は、いわば、彼のセンサーで世界を感じ、目（カメラ）で彼を見て、マイクで聞いて、スピーカーフォンで誓うことができるように。もちろん、AVRリソ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>やかんからのAndroid Camera2 API</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468083/"><img src="https://habrastorage.org/webt/kk/8_/gf/kk8_gf5d1vt1kyxcb_vkbjqwpnk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
少し前まで、私はロボットマシンで忙しくて、Androidスマートフォンを載せようとしていました。私、つまり彼の仕事は、カートを進化的に進化させることでした。彼女は、いわば、彼のセンサーで世界を感じ、目（カメラ）で彼を見て、マイクで聞いて、スピーカーフォンで誓うことができるように。もちろん、AVRリソースはこれには十分ではなかったため、カートに乗っていたマイクロコントローラーは、脊髄領域のどこかに、モーターとさまざまな無条件反射を制御するために、より低いレベルに移動しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、奇妙なことに、スマートフォン用のアプリケーションを書き始めたとき、悪いIDE ANDROID STUDIOが絶えずコードを取り消して、古いコードと呼んでいました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
カメラ= </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カメラ。</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">開いた （）;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
特に、ご覧のように、私がカメラを操作しようとした部分です。私は、インターネット上で読んで、Androidとカメラの操作について多くの教訓を学んだので、それは非常に残念だった</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここでは</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここでは</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">も</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。そこには何も抹消されませんでした。そして、それはカメラAPIと呼ばれていました。そこにあるものはすべてシンプルで論理的でした。しかし、Googleは頑固に私をある種の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Camera2 API</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">向かわせました</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はそこを見て、デモコードの各行のさまざまなコールバック、ビルダー、ハンドラー、およびルーパーの数を単純に扱いました。あなたがアンドロイド開発者ではなく普通のアマチュアである場合、これにどのように取り組むかは完全に理解できませんでした。さらに、このアップデートは4年前のようですが、今日でもネットワーク上のCamera2 APIに関する記事がいくつかあります。しかし、私が見つけたのは2016年のハッカーの記事、同じ年のウクライナの兄弟からの3部構成の投稿、2017年のハブレに関する二重の投稿、そして日本のメガホン今井智昭のカメラ2の理解記事です。そして、これは構造化され、形式化された情報を意味し、「どうやって見る」などのコードの断片やスタイルのシートではなく、インターネット上に散在する「コードplizを見て、何も機能しない」という意味です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、あなたがまだ</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2019 </font><font style="vertical-align: inherit;">にこのトピックに関する私の投稿をカットする必要がある理由をまだ疑問に思っているなら</font><font style="vertical-align: inherit;">、猫へようこそ。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、ハッカーの記事が気に入ったのは、カメラを操作する新しいパラダイムが導入された理由が少なくとも一目でわかるためです。以前のAPIにはなかったいくつかの新しいメソッドが必要な理由も明らかになりました。しかし、作者は明らかに本当のハッカーのように、メソッドの名前だけを引用しているため、この記事で動作するプログラムを作成することは完全に不可能でした。まあ、まだ数行の追加コードがあるかもしれません。しかし、これは断固として私には十分ではありませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Habréに関する投稿は良かったと私は主張しませんが、最初のいくつかの段落さえ理解しましたが、投稿の作成者がRxJava2を使用してカメラを打ち負かしたため、自動的に他の読者から除外されました。私は通常OOPを扱いますが、これはある種の反応型プログラミングです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
日本の記事は、母国語で書いていない場合でも、さらに優れていました。しかし、私はKotlinも知りませんが、もちろん、Googleの開発者向けページにあるJAVAの春雨とは対照的に、国内の開発者たちには嬉しく、その構文の簡潔さを高く評価しました（ちなみに、このページでは、そこにも明らかでした）あまり明確ではありません）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私に実際的な利益をもたらした最後の記事は、兄弟のウクライナからの3部構成の投稿でした。私はそこで何かを立ち上げ、そこに何かを見ました。しかし、残念ながら、第3部では、記事の著者は非常に疲れていて、私の作業全体に足りないフラグメントでコードを発行し始めました。さらに、結局、作者は自分が数えていた間違ったカラーパレットのイメージを取得したため、完全に動揺しました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/de/zn/rn/deznrnniikuzh8w4k1fdmxxbikq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、Lollipopのバージョンが5.0であり、バグがあるためです。 Lollipop 5.1にアップグレードする必要があります。そうすれば、すべてがうまくいきます。しかし、どういうわけかまだです。また、JAVA SCRIPTの記事に有害なウクライナ人が固定されており、コードをコピーすると、大量のゴミがプログラムテキストに流し込まれました。皆さん、それはできません。Firefoxに特別なプラグインをインストールする必要がありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのため、落ちたバナーを拾い、最後までやり遂げなければなりませんでした。もちろん、精神的な努力が必要でした。</font><font style="vertical-align: inherit;">そして、作業結果が得られたという実感に満足できてなんとなく残念だったので、アマチュアティーポットと共有したかった。</font><font style="vertical-align: inherit;">さらに、これは物語の終わりから遠いです。</font><font style="vertical-align: inherit;">私はまだライブビデオをandroidカメラからコンピューターに転送する方法を学ぶ必要があります（ロボットトロリーを開発する必要があります。これは進化の法則です）。私が盲検化したようにバラバラにではなく、スムーズに。</font><font style="vertical-align: inherit;">そして、メディアコーデックなどの形でこのようなモンブランの障害があり、それは単なるブリキです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、その一方で、全体が完全に失望するかもしれません。</font><font style="vertical-align: inherit;">モンブランに登れないからではありません。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして今、スマートフォンのメーカーはカメラ製造への完全に新しいアプローチを開発しています。</font></font></b><div class="spoiler_text"><i>         Nokia    .    ?        ?       , Nokia                 .  Light L16   2015   16- ,   , ,     .   ,     .<br>
<br>
 ,   Huawei P20 Pro   ,           ,         . ,    –     ?<br>
     ?<br>
<br>
,    ,     ,     ,    .    , ,      ,        ?<br>
<br>
  ,       .            .  ,             .       ,       -   .  ,         .         ,   .<br>
<br>
Huawei P20 Pro     ,       ,    .      Huawei,  Monochrome  Hybrid Zoom.      ,    RGB   - .  Hybrid Zoom    :      ,        .  ,  P20 Pro 8 M  -      10 M  3x  5x .<br>
  —  <br>
<br>
  Light L16   ,   ,       .        28, 70  150 ,     .        52 ,   10   ,      5x.   ,   ,   5-9 .       64- .<br>
<br>
               HDR    .                .<br>
<br>
Light L16  ,     .        - .  ,       ,         .<br>
<br>
    ,    Nokia     ,       Pelican Imaging  2013 .    Light,    .         ,      ,       .  , Tessera    2016,          Nokia.<br>
<br>
Zeiss,   Nokia  ,     ,             . ,      Nokia, FIH Mobile.    Foxconn,   Nokia     Light  2015,      .<br>
<br>
   ,     Nokia    Light   ,   .     Foxconn.      Nokia ,     Light?<br>
    ?<br>
<br>
  —   . 2014   Oppo Find 7   ,  Hybrid Zoom  Huawei      .        ,    .          ,  DSP       ,     .<br>
<br>
 ,              ,          .          —           .<br>
<br>
   Light   ,         .     — ,        .</i><br>
</div></div><br>
<img src="https://habrastorage.org/webt/ln/qn/nu/lnqnnu7rqgiqupxpqtveattncmw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プログラムにハンドルを備えたカメラからそのようなアセンブリを構成することは簡単ではありません。おそらく、サークルは閉じられ、写真を撮るために、「カメラ、できる限り自分で写真を撮ってください。美しく、そして私の活動の中で私に返してください」などの内容で、明示的な意図を再度書く必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、今のところ、まだ少し残っています。したがって、私たちはすぐに進みます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なぜこのすべてのグーグルが必要でしたか？</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてが安全で適切なマルチスレッド化されているように見えます（また、あらゆる種類のエフェクトやフィルタを直接実行することも可能になります）。さて、バニラJAVAの場合、必要に応じて、ミューテックス、同期、セマフォをあらゆる場所に適切にプッシュする必要があります。ここで、Googleがほぼすべてを引き継ぎます。必要に応じて呼び出されるプログラムテキストにコールバックを書き留めるだけです。つまり、たとえば、カメラをオンにするリクエストを送信します。</font></font><br>
<br>
<pre><code class="java hljs">mCameraManager.openCamera()
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、これはチームではなく、これは要求です。カメラですぐに作業を開始することはできません。第一に、彼女は電源を入れるのに時間が必要です。第二に、Androidには重要なことがたくさんあり、あなたの願いはかなり大きなキューに入れられます。ただし、メインスレッドのループでカメラが開いてアプリケーション全体がハングするのを待つ必要はありません（UIスレッドで実行できることと実行できないことを覚えています）。したがって、私たちは願いを送り、ビジネスに取り掛かっている間に、ビューを開き、「hello world」と書き込み、ボタンハンドラーなどを構成します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一方、数十から数百ミリ秒後、オペレーティングシステムは最終的にカメラの手に届き、初期化します。そして、カメラの準備ができるとすぐに、同じコールバックがトリガーされます（もちろん、事前に登録していない限り）</font></font><br>
<br>
<pre><code class="java hljs"> <span class="hljs-keyword">private</span> CameraDevice.StateCallback mCameraCallback = <span class="hljs-keyword">new</span> CameraDevice.StateCallback() {<font></font>
<font></font>
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onOpened</span><span class="hljs-params">(CameraDevice camera)</span> </span>{<font></font>
               <font></font>
    mCameraDevice = camera;<font></font>
          <font></font>
                createCameraPreviewSession();<font></font>
…..<font></font>
            }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、カメラが開いて、そこで何かを行うことができます。カメラからの画像をビューに表示したり、保存のためにさらに転送したりします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果として、実際のところ、カメラでのすべての作業は、あらゆる種類のコールバックを規定することになります。</font><font style="vertical-align: inherit;">しかし、彼らの高貴な努力の中で、グーグルの開発者たちは少し行き過ぎ、そして日本の同志が正しく指摘したように：</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Camera2が困惑する理由の1つは、1つのショットを撮るために使用する必要があるコールバックの数です。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、これでは十分ではありません。カメラの操作の全体的なスキームは</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ko/kb/ju/kokbjuymle88yzzedcutreymxks.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
非常に</font><font style="vertical-align: inherit;">素晴らしい外観を持っていますが</font><font style="vertical-align: inherit;">、幸いなことに、</font></font><br>
<br>
<img src="https://habrastorage.org/webt/h4/zh/fs/h4zhfsjakuuzgsnil1sfjo44vla.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初は</font><font style="vertical-align: inherit;">もっと魅力的な写真に縮小できます。</font><font style="vertical-align: inherit;">すべて英語で書かれていますが、言葉がなくてもはっきりしています。手始めに、このデザインは十分です。カメラを開き、スマートフォンの画面に画像を表示し、写真を撮ります。準備ができると（コールバックが再び）、このイベントのリスナーが機能し、写真をファイルに書き込みます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コード</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
の作成を</font><b><font style="vertical-align: inherit;">開始</font></b><font style="vertical-align: inherit;">するAndroid Studio IDEで新しいプロジェクトを作成し、SDK 22の最小バージョンを選択して、緑色の画像を避け、空のアクティビティを注文します（さらに、バージョン23を使用します。そうしないと、権限で問題が発生する可能性があります）。開始するには十分です。マニフェストの権限でさえ、まだ行う必要はありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、CameraManagerクラスのインスタンスを作成します。</font><font style="vertical-align: inherit;">これは、使用可能なカメラを検索し、作業に必要なカメラの特性を取得し、カメラの撮影設定を行うことができるシステムサービスマネージャーです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、特性を次のように見ていきます：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
カメラが向けられているカメラ識別子（0、1、2 ....）</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
方向カメラの</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
解像度</font><font style="vertical-align: inherit;">（</font><font style="vertical-align: inherit;">ピクセル）</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
カメラのリストを文字列配列の形式で取得し、必要な特性をループに表示して書き込みますログに。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">package</span> com.example.camera;
<span class="hljs-keyword">import</span> android.content.Context;
<span class="hljs-keyword">import</span> androidx.annotation.RequiresApi;
<span class="hljs-keyword">import</span> androidx.appcompat.app.AppCompatActivity;<font></font>
<font></font>
<span class="hljs-keyword">import</span> android.graphics.ImageFormat;
<span class="hljs-keyword">import</span> android.hardware.camera2.CameraAccessException;
<span class="hljs-keyword">import</span> android.hardware.camera2.CameraCharacteristics;
<span class="hljs-keyword">import</span> android.hardware.camera2.CameraManager;
<span class="hljs-keyword">import</span> android.hardware.camera2.params.StreamConfigurationMap;
<span class="hljs-keyword">import</span> android.os.Build;
<span class="hljs-keyword">import</span> android.os.Bundle;
<span class="hljs-keyword">import</span> android.util.Log;
<span class="hljs-keyword">import</span> android.util.Size;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AppCompatActivity</span> </span>{<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String LOG_TAG = <span class="hljs-string">"myLogs"</span>;<font></font>
    String[] myCameras = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">private</span> CameraManager mCameraManager    = <span class="hljs-keyword">null</span>;<font></font>
<font></font>
<font></font>
    <span class="hljs-meta">@RequiresApi(api = Build.VERSION_CODES.M)</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> </span>{
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);<font></font>
        setContentView(R.layout.activity_main);<font></font>
<font></font>
        mCameraManager = (CameraManager) getSystemService(Context.CAMERA_SERVICE);<font></font>
        <span class="hljs-keyword">try</span>{
            <span class="hljs-comment">//     </span><font></font>
<font></font>
            myCameras = <span class="hljs-keyword">new</span> String[mCameraManager.getCameraIdList().length];<font></font>
<font></font>
            <span class="hljs-comment">//    </span>
            <span class="hljs-keyword">for</span> (String cameraID : mCameraManager.getCameraIdList()) {<font></font>
                Log.i(LOG_TAG, <span class="hljs-string">"cameraID: "</span>+cameraID);
                <span class="hljs-keyword">int</span> id = Integer.parseInt(cameraID);<font></font>
<font></font>
           <span class="hljs-comment">// e  </span><font></font>
                CameraCharacteristics cc = mCameraManager.getCameraCharacteristics(cameraID);<font></font>
           <span class="hljs-comment">//    ,   </span><font></font>
                StreamConfigurationMap configurationMap =<font></font>
                        cc.get(CameraCharacteristics.SCALER_STREAM_CONFIGURATION_MAP);<font></font>
<font></font>
          <span class="hljs-comment">//      </span>
                <span class="hljs-keyword">int</span> Faceing = cc.get(CameraCharacteristics.LENS_FACING);<font></font>
<font></font>
                <span class="hljs-keyword">if</span> (Faceing ==  CameraCharacteristics.LENS_FACING_FRONT)<font></font>
                {<font></font>
                    Log.i(LOG_TAG,<span class="hljs-string">"Camera with ID: "</span>+cameraID +  <span class="hljs-string">"  is FRONT CAMERA  "</span>);<font></font>
                }<font></font>
<font></font>
                <span class="hljs-keyword">if</span> (Faceing ==  CameraCharacteristics.LENS_FACING_BACK)<font></font>
                {<font></font>
                    Log.i(LOG_TAG,<span class="hljs-string">"Camera with: ID "</span>+cameraID +  <span class="hljs-string">" is BACK CAMERA  "</span>);<font></font>
                }<font></font>
<font></font>
<font></font>
         <span class="hljs-comment">//        jpeg</span><font></font>
                Size[] sizesJPEG = configurationMap.getOutputSizes(ImageFormat.JPEG);<font></font>
<font></font>
                <span class="hljs-keyword">if</span> (sizesJPEG != <span class="hljs-keyword">null</span>) {
                    <span class="hljs-keyword">for</span> (Size item:sizesJPEG) {<font></font>
                        Log.i(LOG_TAG, <span class="hljs-string">"w:"</span>+item.getWidth()+<span class="hljs-string">" h:"</span>+item.getHeight());<font></font>
                    }<font></font>
                }  <span class="hljs-keyword">else</span> {<font></font>
                    Log.i(LOG_TAG, <span class="hljs-string">"camera don`t support JPEG"</span>);<font></font>
                }<font></font>
            }<font></font>
        }<font></font>
        <span class="hljs-keyword">catch</span>(CameraAccessException e){<font></font>
            Log.e(LOG_TAG, e.getMessage());<font></font>
            e.printStackTrace();<font></font>
        }<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ログは次のようになります。</font></font></b><div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.489</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: cameraID: <span class="hljs-number">0</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.504</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: Camera with: ID <span class="hljs-number">0</span> is BACK CAMERA  
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.506</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">4000</span> h:<span class="hljs-number">3000</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.506</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">4000</span> h:<span class="hljs-number">2250</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.506</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">3840</span> h:<span class="hljs-number">2160</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.506</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">2592</span> h:<span class="hljs-number">1944</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.506</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">2592</span> h:<span class="hljs-number">1940</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.506</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">2048</span> h:<span class="hljs-number">1536</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.506</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">1920</span> h:<span class="hljs-number">1080</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.506</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">1600</span> h:<span class="hljs-number">1200</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.506</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">1440</span> h:<span class="hljs-number">1080</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.506</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">1440</span> h:<span class="hljs-number">720</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.506</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">1280</span> h:<span class="hljs-number">960</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.506</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">1280</span> h:<span class="hljs-number">768</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.506</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">1280</span> h:<span class="hljs-number">720</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.506</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">1280</span> h:<span class="hljs-number">480</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.506</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">1280</span> h:<span class="hljs-number">400</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.506</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">800</span> h:<span class="hljs-number">480</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.506</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">720</span> h:<span class="hljs-number">480</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.506</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">640</span> h:<span class="hljs-number">480</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.506</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">480</span> h:<span class="hljs-number">640</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.506</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">480</span> h:<span class="hljs-number">360</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.506</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">480</span> h:<span class="hljs-number">320</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.506</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">352</span> h:<span class="hljs-number">288</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.506</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">320</span> h:<span class="hljs-number">240</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.506</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">240</span> h:<span class="hljs-number">320</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.507</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">176</span> h:<span class="hljs-number">144</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.507</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">144</span> h:<span class="hljs-number">176</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.507</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: cameraID: <span class="hljs-number">1</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.514</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: Camera with ID: <span class="hljs-number">1</span>  is FRONT CAMERA  
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.515</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">4224</span> h:<span class="hljs-number">3136</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.515</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">4224</span> h:<span class="hljs-number">2376</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.516</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">4160</span> h:<span class="hljs-number">3120</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.516</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">4160</span> h:<span class="hljs-number">2340</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.516</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">4000</span> h:<span class="hljs-number">3000</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.516</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">4000</span> h:<span class="hljs-number">2250</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.516</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">3840</span> h:<span class="hljs-number">2160</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.516</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">2592</span> h:<span class="hljs-number">1944</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.516</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">2592</span> h:<span class="hljs-number">1940</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.516</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">2048</span> h:<span class="hljs-number">1536</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.516</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">1920</span> h:<span class="hljs-number">1080</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.516</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">1600</span> h:<span class="hljs-number">1200</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.516</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">1440</span> h:<span class="hljs-number">1080</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.516</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">1440</span> h:<span class="hljs-number">720</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.516</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">1280</span> h:<span class="hljs-number">960</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.516</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">1280</span> h:<span class="hljs-number">768</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.516</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">1280</span> h:<span class="hljs-number">720</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.516</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">1280</span> h:<span class="hljs-number">480</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.516</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">1280</span> h:<span class="hljs-number">400</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.516</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">800</span> h:<span class="hljs-number">480</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.516</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">720</span> h:<span class="hljs-number">480</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.516</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">640</span> h:<span class="hljs-number">480</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.516</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">480</span> h:<span class="hljs-number">640</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.516</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">480</span> h:<span class="hljs-number">360</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.516</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">480</span> h:<span class="hljs-number">320</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.516</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">352</span> h:<span class="hljs-number">288</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.516</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">320</span> h:<span class="hljs-number">240</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.516</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">240</span> h:<span class="hljs-number">320</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.516</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">176</span> h:<span class="hljs-number">144</span>
<span class="hljs-number">2019</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">10</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31.516</span> <span class="hljs-number">11130</span>-<span class="hljs-number">11130</span>/? I/myLogs: w:<span class="hljs-number">144</span> h:<span class="hljs-number">176</span>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
原則として、この情報は実際には必要ありません。以前のAPIによるティーポットでも、カメラの識別子がゼロ以上であることはすでにわかっているため、1920 x 1080の解像度を持つ人を驚かせることはありません。実際、このデータは、生産準備が整った「大人の」アプリケーションによってすでに必要とされており、これに基づいて、ユーザーなどが選択するメニューを作成します。最も単純なケースでは、一般に、すべてが明確です。しかし、すべての記事はこれで始まるので、それから始めます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フロントカメラの識別子番号が「1」とリアが「0」であることを確認し（文字列形式で何らかの形で指定されています）、1920 x 1080の解像度とJPGファイルの保存が利用できることを確認した後、攻撃を続行します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要な権限を取得します</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初は、いくつかの権限について心配する必要があります。</font><font style="vertical-align: inherit;">これを行うには、マニフェストで次のように記述する必要があります。</font></font><br>
<br>
<pre><code class="java hljs">    &lt;uses-permission android:name=<span class="hljs-string">"android.permission.CAMERA"</span> /&gt;<font></font>
    &lt;uses-permission android:name=<span class="hljs-string">"android.permission.WRITE_EXTERNAL_STORAGE"</span> /&gt;<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
第一、第二は、ファイル内の画像を記録するためである（そして、それは言葉EXTERNALの意味から見えるかもしれないので、これは、外部メモリカードではなく、かなりのスマートフォンの独自のメモリ）、カメラの理解</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、アンドロイドも規定の権限のロリポップのバージョンで始まる、それゆえ、私たちを気にマニフェストではもはや十分ではありません。</font><font style="vertical-align: inherit;">今度は、ユーザーがペンを使用してカメラを開き、データをメモリに書き込むことに同意する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このため、最も単純なケースでは、これを追加する必要があります。</font></font><br>
<br>
<pre><code class="java hljs">
 <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> </span>{
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);<font></font>
        setContentView(R.layout.activity_main);<font></font>
……...<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (checkSelfPermission(Manifest.permission.CAMERA) != PackageManager.PERMISSION_GRANTED<font></font>
                ||<font></font>
                (ContextCompat.checkSelfPermission(MainActivity.<span class="hljs-keyword">this</span>, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED)<font></font>
        )<font></font>
        {<font></font>
            requestPermissions(<span class="hljs-keyword">new</span> String[]{Manifest.permission.CAMERA,Manifest.permission.WRITE_EXTERNAL_STORAGE}, <span class="hljs-number">1</span>);<font></font>
        }<font></font>
…..<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
なぜ最も単純なのですか？</font><font style="vertical-align: inherit;">UIストリームでそのようなことをする必要がないからです。</font><font style="vertical-align: inherit;">1つは、ユーザーが不器用な指で画面をつついているときにスレッドがハングアップすること、もう1つは、カメラをさらに初期化すると、アプリケーションが通常クラッシュする可能性があることです。</font><font style="vertical-align: inherit;">このデモのケースではすべてが問題ありませんが、通常、このケースでは目的のコールバックタイプを使用することが規定されています。</font></font><br>
<br>
<pre><code class="java hljs">
 <span class="hljs-meta">@Override</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onRequestPermissionsResult</span><span class="hljs-params">(<span class="hljs-keyword">int</span> requestCode, String[] permissions, <span class="hljs-keyword">int</span>[] grantResults)</span> </span>{<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (requestCode == MY_REQUEST_CODE_FOR_CAMERA) {
            <span class="hljs-keyword">if</span> (grantResults[<span class="hljs-number">0</span>] == PackageManager.PERMISSION_GRANTED) {<font></font>
<font></font>
             startCameraActivity(); <span class="hljs-comment">//     (  )</span><font></font>
        }<font></font>
      }<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はこれまですべてを知りませんでしたが、AsyncTaskを介して目的のアクティビティを起動し、さらに以前はJavaのように新しいスレッドをスカルプトしました。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カメラの準備</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
便宜上、カメラに関連するすべてのものを、賢い人々のアドバイスに基づいて別のクラスで取り出し、CameraServiceクラスを作成します。</font><font style="vertical-align: inherit;">そこで、カメラの初期化を行い、必要なすべてのコールバックを書き留めます。</font></font><br>
<br>
<pre><code class="java hljs">…..<font></font>
<font></font>
  CameraService[] myCameras = <span class="hljs-keyword">null</span>;<font></font>
<font></font>
    <span class="hljs-keyword">private</span> CameraManager mCameraManager    = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> CAMERA1   = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> CAMERA2   = <span class="hljs-number">1</span>;<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> </span>{
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);<font></font>
        setContentView(R.layout.activity_main);<font></font>
<font></font>
…..<font></font>
<font></font>
}<font></font>
<font></font>
   <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CameraService</span> </span>{
        <span class="hljs-keyword">private</span> String mCameraID;
        <span class="hljs-keyword">private</span> CameraDevice mCameraDevice = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">private</span> CameraCaptureSession mCaptureSession;<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CameraService</span><span class="hljs-params">(CameraManager cameraManager, String cameraID)</span> </span>{<font></font>
<font></font>
            mCameraManager = cameraManager;<font></font>
            mCameraID = cameraID;<font></font>
        }<font></font>
<font></font>
   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isOpen</span><span class="hljs-params">()</span> </span>{<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (mCameraDevice == <span class="hljs-keyword">null</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<font></font>
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<font></font>
            }<font></font>
        }<font></font>
<font></font>
<font></font>
   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">openCamera</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">if</span> (checkSelfPermission(Manifest.permission.CAMERA) == PackageManager.PERMISSION_GRANTED) {<font></font>
<font></font>
                mCameraManager.openCamera(mCameraID,mCameraCallback,<span class="hljs-keyword">null</span>);<font></font>
                }<font></font>
            }<font></font>
           <span class="hljs-keyword">catch</span> (CameraAccessException e) {<font></font>
                Log.i(LOG_TAG,e.getMessage());<font></font>
            }<font></font>
        }<font></font>
<font></font>
<font></font>
 <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">closeCamera</span><span class="hljs-params">()</span> </span>{<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (mCameraDevice != <span class="hljs-keyword">null</span>) {<font></font>
                mCameraDevice.close();<font></font>
                mCameraDevice = <span class="hljs-keyword">null</span>;<font></font>
            }<font></font>
        }<font></font>
}<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メインスレッドで、mCameraManagerのインスタンスを作成し、それを使用してmyCamerasオブジェクトの配列を設定します。</font><font style="vertical-align: inherit;">この場合、フロントカメラと自撮りカメラの2つしかありません。</font></font><br>
<br>
<pre><code class="java hljs">     mCameraManager = (CameraManager) getSystemService(Context.CAMERA_SERVICE);
        <span class="hljs-keyword">try</span>{<font></font>
<font></font>
            <span class="hljs-comment">//     </span><font></font>
<font></font>
            myCameras = <span class="hljs-keyword">new</span> CameraService[mCameraManager.getCameraIdList().length];<font></font>
<font></font>
            <span class="hljs-keyword">for</span> (String cameraID : mCameraManager.getCameraIdList()) {<font></font>
                Log.i(LOG_TAG, <span class="hljs-string">"cameraID: "</span>+cameraID);
                <span class="hljs-keyword">int</span> id = Integer.parseInt(cameraID);<font></font>
<font></font>
                <span class="hljs-comment">//    </span>
                myCameras[id] = <span class="hljs-keyword">new</span> CameraService(mCameraManager,cameraID);<font></font>
            }<font></font>
        }<font></font>
        <span class="hljs-keyword">catch</span>(CameraAccessException e){<font></font>
            Log.e(LOG_TAG, e.getMessage());<font></font>
            e.printStackTrace();<font></font>
        }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
public void openCamera（）メソッドで、次の行を確認できます。</font></font><br>
<br>
<pre><code class="java hljs"> mCameraManager.openCamera(mCameraID,mCameraCallback,<span class="hljs-keyword">null</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここから、パスが</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CameraDevice</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カメラ</font><b><font style="vertical-align: inherit;">ステータスの</font></b><font style="vertical-align: inherit;">最初のコールバックに</font><b><font style="vertical-align: inherit;">つながります。</font></b><b><font style="vertical-align: inherit;">StateCallback。</font></b><font style="vertical-align: inherit;">カメラが開いているか閉じているか、または何もない場合は、エラーが表示されます。</font><font style="vertical-align: inherit;">CameraServiceクラスのメソッドに記述します。</font></font><br>
<br>
<pre><code class="java hljs">   <span class="hljs-keyword">private</span> CameraDevice.StateCallback mCameraCallback = <span class="hljs-keyword">new</span> CameraDevice.StateCallback() {<font></font>
<font></font>
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onOpened</span><span class="hljs-params">(CameraDevice camera)</span> </span>{<font></font>
                mCameraDevice = camera;<font></font>
                Log.i(LOG_TAG, <span class="hljs-string">"Open camera  with id:"</span>+mCameraDevice.getId());<font></font>
<font></font>
                createCameraPreviewSession();<font></font>
            }<font></font>
<font></font>
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onDisconnected</span><span class="hljs-params">(CameraDevice camera)</span> </span>{<font></font>
                mCameraDevice.close();<font></font>
<font></font>
                Log.i(LOG_TAG, <span class="hljs-string">"disconnect camera  with id:"</span>+mCameraDevice.getId());<font></font>
                mCameraDevice = <span class="hljs-keyword">null</span>;<font></font>
            }<font></font>
<font></font>
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onError</span><span class="hljs-params">(CameraDevice camera, <span class="hljs-keyword">int</span> error)</span> </span>{<font></font>
                Log.i(LOG_TAG, <span class="hljs-string">"error! camera id:"</span>+camera.getId()+<span class="hljs-string">" error:"</span>+error);<font></font>
            }<font></font>
        };<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、カメラが操作可能である場合（public void onOpened（CameraDevice camera）{}メソッドが機能している場合）、そこでcreateCameraPreviewSession（）メソッドを呼び出すなどのアクションをそこに記述します。それは私たちにカメラからビューに画像をもたらし、それをさらに操作するのに役立ちます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateCameraPreviewSession</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ここでは、レイアウトで既に定義されているmImageViewテクスチャに画像（データストリーム）を表示しようとしています。ピクセルの解像度で判断することもできます。</font></font><br>
<br>
<pre><code class="java hljs">       <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">createCameraPreviewSession</span><span class="hljs-params">()</span> </span>{<font></font>
<font></font>
            SurfaceTexture texture = mImageView.getSurfaceTexture();<font></font>
   <span class="hljs-comment">// texture.setDefaultBufferSize(1920,1080);</span>
            Surface surface = <span class="hljs-keyword">new</span> Surface(texture);<font></font>
<font></font>
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">final</span> CaptureRequest.Builder builder =<font></font>
                        mCameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_PREVIEW);<font></font>
<font></font>
                builder.addTarget(surface);<font></font>
                mCameraDevice.createCaptureSession(Arrays.asList(surface),<font></font>
                        <span class="hljs-keyword">new</span> CameraCaptureSession.StateCallback() {<font></font>
<font></font>
                            <span class="hljs-meta">@Override</span>
                            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onConfigured</span><span class="hljs-params">(CameraCaptureSession session)</span> </span>{<font></font>
                                mCaptureSession = session;<font></font>
                                <span class="hljs-keyword">try</span> {<font></font>
                                    mCaptureSession.setRepeatingRequest(builder.build(),<span class="hljs-keyword">null</span>,<span class="hljs-keyword">null</span>);<font></font>
                                } <span class="hljs-keyword">catch</span> (CameraAccessException e) {<font></font>
                                    e.printStackTrace();<font></font>
                                }<font></font>
                            }<font></font>
<font></font>
                            <span class="hljs-meta">@Override</span>
                            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onConfigureFailed</span><span class="hljs-params">(CameraCaptureSession session)</span> </span>{ }}, <span class="hljs-keyword">null</span> );<font></font>
            } <span class="hljs-keyword">catch</span> (CameraAccessException e) {<font></font>
                e.printStackTrace();<font></font>
            }<font></font>
        }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この同じセッションの準備ができると、前述のコールバックが呼び出され、googlodelsの表現「カメラプレビューの表示」から始めます。</font><font style="vertical-align: inherit;">ここでは、オートフォーカスとフラッシュの設定を調整できますが、ここではデフォルト設定で問題ありません。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちはレイアウトを作成します</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
さて、いわばキャンバスに色をスケッチし、スタイルに鮮やかな画像を作成する必要があります</font></font><div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「3つの画面ボタンと1つのビュー。」</font></font></b><div class="spoiler_text"><pre><code class="java hljs">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;<font></font>
&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span>
    xmlns:app=<span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span>
    xmlns:tools=<span class="hljs-string">"http://schemas.android.com/tools"</span>
    android:layout_width=<span class="hljs-string">"match_parent"</span>
    android:layout_height=<span class="hljs-string">"match_parent"</span>
    tools:context=<span class="hljs-string">".MainActivity"</span>&gt;<font></font>
<font></font>
    &lt;TextureView<font></font>
        android:id=<span class="hljs-string">"@+id/textureView"</span>
        android:layout_width=<span class="hljs-string">"356dp"</span>
        android:layout_height=<span class="hljs-string">"410dp"</span>
        android:layout_marginTop=<span class="hljs-string">"32dp"</span>
        app:layout_constraintEnd_toEndOf=<span class="hljs-string">"parent"</span>
        app:layout_constraintHorizontal_bias=<span class="hljs-string">"0.49"</span>
        app:layout_constraintStart_toStartOf=<span class="hljs-string">"parent"</span>
        app:layout_constraintTop_toTopOf=<span class="hljs-string">"parent"</span> /&gt;<font></font>
<font></font>
    &lt;LinearLayout<font></font>
        android:layout_width=<span class="hljs-string">"292dp"</span>
        android:layout_height=<span class="hljs-string">"145dp"</span>
        android:layout_marginStart=<span class="hljs-string">"16dp"</span>
        android:orientation=<span class="hljs-string">"vertical"</span>
        app:layout_constraintBottom_toBottomOf=<span class="hljs-string">"parent"</span>
        app:layout_constraintEnd_toEndOf=<span class="hljs-string">"parent"</span>
        app:layout_constraintStart_toStartOf=<span class="hljs-string">"parent"</span>
        app:layout_constraintTop_toBottomOf=<span class="hljs-string">"@+id/textureView"</span>
        app:layout_constraintVertical_bias=<span class="hljs-string">"0.537"</span>&gt;<font></font>
<font></font>
        &lt;Button<font></font>
            android:id=<span class="hljs-string">"@+id/button4"</span>
            android:layout_width=<span class="hljs-string">"match_parent"</span>
            android:layout_height=<span class="hljs-string">"wrap_content"</span>
            android:text=<span class="hljs-string">" "</span> /&gt;<font></font>
<font></font>
        &lt;Button<font></font>
            android:id=<span class="hljs-string">"@+id/button5"</span>
            android:layout_width=<span class="hljs-string">"match_parent"</span>
            android:layout_height=<span class="hljs-string">"wrap_content"</span>
            android:text=<span class="hljs-string">" "</span> /&gt;<font></font>
<font></font>
        &lt;Button<font></font>
            android:id=<span class="hljs-string">"@+id/button6"</span>
            android:layout_width=<span class="hljs-string">"match_parent"</span>
            android:layout_height=<span class="hljs-string">"wrap_content"</span>
            android:text=<span class="hljs-string">" "</span> /&gt;<font></font>
    &lt;/LinearLayout&gt;<font></font>
<font></font>
&lt;/androidx.constr<font></font>
</code></pre><br>
</div></div><br>
<img src="https://habrastorage.org/webt/lr/nb/31/lrnb31_wiadanevvo9e_o79jfky.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロセスは非常に簡単であり、誰でも彼が望むようにここで向きを変えることができます。</font><font style="vertical-align: inherit;">しかし、ボタンの名前をレイアウトに直接書き込むこともマナーが悪いので、作業バージョンではそうする必要はありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、アクティビティ自体で、リスナー、つまりボタンとビューのリスナーを作成します。</font></font><br>
<br>
<pre><code class="java hljs">    <span class="hljs-keyword">private</span> Button mButtonOpenCamera1 = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">private</span> Button mButtonOpenCamera2 = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">private</span> Button mButtonToMakeShot = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">private</span> TextureView mImageView = <span class="hljs-keyword">null</span>;<font></font>
<font></font>
    <span class="hljs-meta">@RequiresApi(api = Build.VERSION_CODES.M)</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> </span>{
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);<font></font>
        setContentView(R.layout.activity_main);<font></font>
<font></font>
……...<font></font>
<font></font>
        mButtonOpenCamera1 =  findViewById(R.id.button1);<font></font>
        mButtonOpenCamera2 =  findViewById(R.id.button2);<font></font>
        mButtonToMakeShot =findViewById(R.id.button3);<font></font>
        mImageView = findViewById(R.id.textureView);<font></font>
<font></font>
        mButtonOpenCamera1.setOnClickListener(<span class="hljs-keyword">new</span> View.OnClickListener() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span><span class="hljs-params">(View v)</span> </span>{
                <span class="hljs-keyword">if</span> (myCameras[CAMERA2].isOpen()) myCameras[CAMERA2].closeCamera();
                <span class="hljs-keyword">if</span> (myCameras[CAMERA1] != <span class="hljs-keyword">null</span>) {
                    <span class="hljs-keyword">if</span> (!myCameras[CAMERA1].isOpen()) myCameras[CAMERA1].openCamera();<font></font>
                }<font></font>
            }<font></font>
        });<font></font>
<font></font>
        mButtonOpenCamera2.setOnClickListener(<span class="hljs-keyword">new</span> View.OnClickListener() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span><span class="hljs-params">(View v)</span> </span>{
                <span class="hljs-keyword">if</span> (myCameras[CAMERA1].isOpen()) myCameras[CAMERA1].closeCamera();
                <span class="hljs-keyword">if</span> (myCameras[CAMERA2] != <span class="hljs-keyword">null</span>) {
                    <span class="hljs-keyword">if</span> (!myCameras[CAMERA2].isOpen()) myCameras[CAMERA2].openCamera();<font></font>
                }<font></font>
            }<font></font>
        });<font></font>
<font></font>
<font></font>
        mButtonToMakeShot.setOnClickListener(<span class="hljs-keyword">new</span> View.OnClickListener() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span><span class="hljs-params">(View v)</span>
            </span>{<font></font>
<font></font>
             <span class="hljs-comment">//   </span><font></font>
<font></font>
            }<font></font>
        });<font></font>
<font></font>
<font></font>
……..<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ボタンの割り当ては名前から明らかです。3番目のボタンは将来の写真のために残します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのコードをまとめると</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下を取得します。</font></font></b><div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-keyword">package</span> com.example.camera;
<span class="hljs-keyword">import</span> androidx.annotation.RequiresApi;
<span class="hljs-keyword">import</span> androidx.appcompat.app.AppCompatActivity;
<span class="hljs-keyword">import</span> androidx.core.content.ContextCompat;
<span class="hljs-keyword">import</span> android.Manifest;
<span class="hljs-keyword">import</span> android.content.Context;
<span class="hljs-keyword">import</span> android.content.pm.PackageManager;
<span class="hljs-keyword">import</span> android.graphics.SurfaceTexture;
<span class="hljs-keyword">import</span> android.hardware.camera2.CameraAccessException;
<span class="hljs-keyword">import</span> android.hardware.camera2.CameraCaptureSession;
<span class="hljs-keyword">import</span> android.hardware.camera2.CameraDevice;
<span class="hljs-keyword">import</span> android.hardware.camera2.CameraManager;
<span class="hljs-keyword">import</span> android.hardware.camera2.CaptureRequest;
<span class="hljs-keyword">import</span> android.os.Build;
<span class="hljs-keyword">import</span> android.os.Bundle;
<span class="hljs-keyword">import</span> android.util.Log;
<span class="hljs-keyword">import</span> android.view.Surface;
<span class="hljs-keyword">import</span> android.view.TextureView;
<span class="hljs-keyword">import</span> android.view.View;
<span class="hljs-keyword">import</span> android.widget.Button;<font></font>
<font></font>
<span class="hljs-keyword">import</span> java.util.Arrays;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AppCompatActivity</span> </span>{<font></font>
<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String LOG_TAG = <span class="hljs-string">"myLogs"</span>;<font></font>
<font></font>
<font></font>
    CameraService[] myCameras = <span class="hljs-keyword">null</span>;<font></font>
<font></font>
    <span class="hljs-keyword">private</span> CameraManager mCameraManager    = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> CAMERA1   = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> CAMERA2   = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">private</span> Button mButtonOpenCamera1 = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">private</span> Button mButtonOpenCamera2 = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">private</span> Button mButtonToMakeShot = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">private</span> TextureView mImageView = <span class="hljs-keyword">null</span>;<font></font>
<font></font>
<font></font>
    <span class="hljs-meta">@RequiresApi(api = Build.VERSION_CODES.M)</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> </span>{
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);<font></font>
        setContentView(R.layout.activity_main);<font></font>
<font></font>
<font></font>
        Log.d(LOG_TAG, <span class="hljs-string">" "</span>);
        <span class="hljs-keyword">if</span> (checkSelfPermission(Manifest.permission.CAMERA) != PackageManager.PERMISSION_GRANTED<font></font>
                ||<font></font>
                (ContextCompat.checkSelfPermission(MainActivity.<span class="hljs-keyword">this</span>, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED)<font></font>
        )<font></font>
        {<font></font>
            requestPermissions(<span class="hljs-keyword">new</span> String[]{Manifest.permission.CAMERA,Manifest.permission.WRITE_EXTERNAL_STORAGE},<span class="hljs-number">1</span>);<font></font>
        }<font></font>
<font></font>
<font></font>
        mButtonOpenCamera1 =  findViewById(R.id.button1);<font></font>
        mButtonOpenCamera2 =  findViewById(R.id.button2);<font></font>
        mButtonToMakeShot =findViewById(R.id.button3);<font></font>
        mImageView = findViewById(R.id.textureView);<font></font>
<font></font>
        mButtonOpenCamera1.setOnClickListener(<span class="hljs-keyword">new</span> View.OnClickListener() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span><span class="hljs-params">(View v)</span> </span>{
                <span class="hljs-keyword">if</span> (myCameras[CAMERA2].isOpen()) {myCameras[CAMERA2].closeCamera();}
                <span class="hljs-keyword">if</span> (myCameras[CAMERA1] != <span class="hljs-keyword">null</span>) {
                    <span class="hljs-keyword">if</span> (!myCameras[CAMERA1].isOpen()) myCameras[CAMERA1].openCamera();<font></font>
                }<font></font>
            }<font></font>
        });<font></font>
<font></font>
        mButtonOpenCamera2.setOnClickListener(<span class="hljs-keyword">new</span> View.OnClickListener() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span><span class="hljs-params">(View v)</span> </span>{
                <span class="hljs-keyword">if</span> (myCameras[CAMERA1].isOpen()) {myCameras[CAMERA1].closeCamera();}
                <span class="hljs-keyword">if</span> (myCameras[CAMERA2] != <span class="hljs-keyword">null</span>) {
                    <span class="hljs-keyword">if</span> (!myCameras[CAMERA2].isOpen()) myCameras[CAMERA2].openCamera();<font></font>
                }<font></font>
            }<font></font>
        });<font></font>
<font></font>
<font></font>
        mButtonToMakeShot.setOnClickListener(<span class="hljs-keyword">new</span> View.OnClickListener() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span><span class="hljs-params">(View v)</span>
            </span>{<font></font>
<font></font>
<font></font>
            <span class="hljs-comment">//    if (myCameras[CAMERA1].isOpen()) myCameras[CAMERA1].makePhoto();</span>
           <span class="hljs-comment">//     if (myCameras[CAMERA2].isOpen()) myCameras[CAMERA2].makePhoto();</span><font></font>
<font></font>
            }<font></font>
        });<font></font>
<font></font>
<font></font>
        mCameraManager = (CameraManager) getSystemService(Context.CAMERA_SERVICE);<font></font>
        <span class="hljs-keyword">try</span>{
            <span class="hljs-comment">//     </span><font></font>
<font></font>
<font></font>
            myCameras = <span class="hljs-keyword">new</span> CameraService[mCameraManager.getCameraIdList().length];<font></font>
<font></font>
<font></font>
<font></font>
            <span class="hljs-keyword">for</span> (String cameraID : mCameraManager.getCameraIdList()) {<font></font>
                Log.i(LOG_TAG, <span class="hljs-string">"cameraID: "</span>+cameraID);
                <span class="hljs-keyword">int</span> id = Integer.parseInt(cameraID);<font></font>
<font></font>
<font></font>
                <span class="hljs-comment">//    </span>
                myCameras[id] = <span class="hljs-keyword">new</span> CameraService(mCameraManager,cameraID);<font></font>
<font></font>
<font></font>
<font></font>
<font></font>
            }<font></font>
        }<font></font>
        <span class="hljs-keyword">catch</span>(CameraAccessException e){<font></font>
            Log.e(LOG_TAG, e.getMessage());<font></font>
            e.printStackTrace();<font></font>
        }<font></font>
<font></font>
    }<font></font>
<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CameraService</span> </span>{<font></font>
<font></font>
<font></font>
        <span class="hljs-keyword">private</span> String mCameraID;
        <span class="hljs-keyword">private</span> CameraDevice mCameraDevice = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">private</span> CameraCaptureSession mCaptureSession;<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CameraService</span><span class="hljs-params">(CameraManager cameraManager, String cameraID)</span> </span>{<font></font>
<font></font>
            mCameraManager = cameraManager;<font></font>
            mCameraID = cameraID;<font></font>
<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">private</span> CameraDevice.StateCallback mCameraCallback = <span class="hljs-keyword">new</span> CameraDevice.StateCallback() {<font></font>
<font></font>
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onOpened</span><span class="hljs-params">(CameraDevice camera)</span> </span>{<font></font>
                mCameraDevice = camera;<font></font>
                Log.i(LOG_TAG, <span class="hljs-string">"Open camera  with id:"</span>+mCameraDevice.getId());<font></font>
<font></font>
                createCameraPreviewSession();<font></font>
            }<font></font>
<font></font>
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onDisconnected</span><span class="hljs-params">(CameraDevice camera)</span> </span>{<font></font>
                mCameraDevice.close();<font></font>
<font></font>
                Log.i(LOG_TAG, <span class="hljs-string">"disconnect camera  with id:"</span>+mCameraDevice.getId());<font></font>
                mCameraDevice = <span class="hljs-keyword">null</span>;<font></font>
            }<font></font>
<font></font>
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onError</span><span class="hljs-params">(CameraDevice camera, <span class="hljs-keyword">int</span> error)</span> </span>{<font></font>
                Log.i(LOG_TAG, <span class="hljs-string">"error! camera id:"</span>+camera.getId()+<span class="hljs-string">" error:"</span>+error);<font></font>
            }<font></font>
        };<font></font>
<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">createCameraPreviewSession</span><span class="hljs-params">()</span> </span>{<font></font>
<font></font>
<font></font>
<font></font>
            SurfaceTexture texture = mImageView.getSurfaceTexture();<font></font>
<font></font>
           texture.setDefaultBufferSize(<span class="hljs-number">1920</span>,<span class="hljs-number">1080</span>);<font></font>
            Surface surface = <span class="hljs-keyword">new</span> Surface(texture);<font></font>
<font></font>
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">final</span> CaptureRequest.Builder builder =<font></font>
                        mCameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_PREVIEW);<font></font>
<font></font>
                builder.addTarget(surface);<font></font>
<font></font>
<font></font>
<font></font>
<font></font>
                mCameraDevice.createCaptureSession(Arrays.asList(surface),<font></font>
                        <span class="hljs-keyword">new</span> CameraCaptureSession.StateCallback() {<font></font>
<font></font>
                            <span class="hljs-meta">@Override</span>
                            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onConfigured</span><span class="hljs-params">(CameraCaptureSession session)</span> </span>{<font></font>
                                mCaptureSession = session;<font></font>
                                <span class="hljs-keyword">try</span> {<font></font>
                                    mCaptureSession.setRepeatingRequest(builder.build(),<span class="hljs-keyword">null</span>,<span class="hljs-keyword">null</span>);<font></font>
                                } <span class="hljs-keyword">catch</span> (CameraAccessException e) {<font></font>
                                    e.printStackTrace();<font></font>
                                }<font></font>
                            }<font></font>
<font></font>
                            <span class="hljs-meta">@Override</span>
                            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onConfigureFailed</span><span class="hljs-params">(CameraCaptureSession session)</span> </span>{ }}, <span class="hljs-keyword">null</span> );<font></font>
            } <span class="hljs-keyword">catch</span> (CameraAccessException e) {<font></font>
                e.printStackTrace();<font></font>
            }<font></font>
<font></font>
        }<font></font>
<font></font>
<font></font>
<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isOpen</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">if</span> (mCameraDevice == <span class="hljs-keyword">null</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<font></font>
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<font></font>
            }<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">openCamera</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">try</span> {<font></font>
<font></font>
                <span class="hljs-keyword">if</span> (checkSelfPermission(Manifest.permission.CAMERA) == PackageManager.PERMISSION_GRANTED) {<font></font>
<font></font>
<font></font>
                    mCameraManager.openCamera(mCameraID,mCameraCallback,<span class="hljs-keyword">null</span>);<font></font>
<font></font>
                }<font></font>
<font></font>
<font></font>
<font></font>
            } <span class="hljs-keyword">catch</span> (CameraAccessException e) {<font></font>
                Log.i(LOG_TAG,e.getMessage());<font></font>
<font></font>
            }<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">closeCamera</span><span class="hljs-params">()</span> </span>{<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (mCameraDevice != <span class="hljs-keyword">null</span>) {<font></font>
                mCameraDevice.close();<font></font>
                mCameraDevice = <span class="hljs-keyword">null</span>;<font></font>
            }<font></font>
        }<font></font>
<font></font>
<font></font>
<font></font>
    }<font></font>
<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onPause</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span>(myCameras[CAMERA1].isOpen()){myCameras[CAMERA1].closeCamera();}
        <span class="hljs-keyword">if</span>(myCameras[CAMERA2].isOpen()){myCameras[CAMERA2].closeCamera();}
        <span class="hljs-keyword">super</span>.onPause();<font></font>
    }<font></font>
<font></font>
<font></font>
}<font></font>
</code></pre><br>
</div></div> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
読み込み、起動、作業！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般に、これで十分でない場合は、撮影プロセス自体を大幅に多様化できます。</font><font style="vertical-align: inherit;">私たちの日本の友明は、美しい図を示しながら、その方法を示し説明します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kq/ac/qv/kqacqvz6ctvbapmm3bzg-f1hcy8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、カメラの焦点を合わせる必要があります。</font><font style="vertical-align: inherit;">これは通常問題を引き起こしませんが、コールバックを介して実装されるいくつかの試行が必要な場合があります。</font></font><br>
<br>
<pre><code class="java hljs">CameraCaptureSession.StateCallback().
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、カメラはPRECAPTUREプレビューモードに入ります。この段階で、カメラは露出、ホワイトバランス、絞りを計算します（私は子供の頃のことを知っていましたが、この知識は失われました）。コールバックがCONTROL_AE_STATE_FLASH_REQUIREDリクエストを返すことがあります。これは、「フラッシュをオンにしておくとよい」という意味です。方法-setAutoFlash（mPreviewRequestBuilder）で自動的にオンにすることができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
撮影に必要なすべてのパラメーターが定義されると、コールバックはCONTROL_AE_STATE_CONVERGED状態を返し、カメラが写真を撮る準備ができていることを通知します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グーグロイドのページでは、これらすべてがすでに例に含まれています。これらの地雷原とワイヤーフェンスを突破する忍耐力がある場合は、名誉があなたに与えられます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">写真を撮ってファイルに保存する</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここから問題が始まりました。いいえ、上のブロック図（日本語ではなく、前のブロック図）から判断すると、すべてはそれほど複雑ではないようです。カメラが画像をキャプチャするのを待っています。 CamerCaptureSessionクラスで処理した後、それはSurfaceオブジェクトとして使用可能になり、ImageReaderクラスを使用して処理できるようになります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実は、ImageReaderオブジェクトを再度作成するには時間がかかります。 OnImageAvailableListenerと呼ばれる次のリスナーでこの時間を待っています。最後に、最後のImageSaverクラスのインスタンスを使用して、画像をファイルに保存します。もちろん、ここでもImageSaverがRunnableであるため、非同期に保存します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題は、コールバックCameraCaptureSession.StateCallback（）がビデオをスマートフォンのビューにブロードキャストするのにすでにビジーであったため、このImageReaderをどこにも接続できないことでした。</font><font style="vertical-align: inherit;">そして、もし私が新しいセッションをすると、Androidは予想通り呪われ、アプリケーションをクラッシュさせました。</font><font style="vertical-align: inherit;">その結果（質問はしないでください）、1つのcreateCameraPreviewSession（）メソッドで馬と震えている雌犬をなんとか横断しました。これは、カメラからの画像のみをビューに出力するために使用されていました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これが以前のこのコードです：</font></font><br>
<br>
<pre><code class="java hljs">
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">createCameraPreviewSession</span><span class="hljs-params">()</span> </span>{<font></font>
<font></font>
            SurfaceTexture texture = mImageView.getSurfaceTexture();<font></font>
            Surface surface = <span class="hljs-keyword">new</span> Surface(texture);<font></font>
<font></font>
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">final</span> CaptureRequest.Builder builder =<font></font>
                        mCameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_PREVIEW);<font></font>
<font></font>
                builder.addTarget(surface);<font></font>
<font></font>
                mCameraDevice.createCaptureSession(Arrays.asList(surface),<font></font>
                        <span class="hljs-keyword">new</span> CameraCaptureSession.StateCallback() …….
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そしてここに彼は後です：</font></font><br>
<br>
<pre><code class="java hljs"> <span class="hljs-keyword">private</span> ImageReader mImageReader;<font></font>
<font></font>
 <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">createCameraPreviewSession</span><span class="hljs-params">()</span> </span>{<font></font>
<font></font>
            mImageReader = ImageReader.newInstance(<span class="hljs-number">1920</span>,<span class="hljs-number">1080</span>,ImageFormat.JPEG,<span class="hljs-number">1</span>);<font></font>
            mImageReader.setOnImageAvailableListener(mOnImageAvailableListener, <span class="hljs-keyword">null</span>);<font></font>
<font></font>
            SurfaceTexture texture = mImageView.getSurfaceTexture();<font></font>
            Surface surface = <span class="hljs-keyword">new</span> Surface(texture);<font></font>
<font></font>
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">final</span> CaptureRequest.Builder builder =<font></font>
                        mCameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_PREVIEW);<font></font>
<font></font>
                builder.addTarget(surface);<font></font>
<font></font>
                mCameraDevice.createCaptureSession(Arrays.asList(surface, mImageReader.getSurface()),<font></font>
                        <span class="hljs-keyword">new</span> CameraCaptureSession.StateCallback() ……
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一番上のImageReaderインスタンス定義とは異なり、違いはほとんどわかりません。</font><font style="vertical-align: inherit;">単に表面に追加され、コンマで区切られたmImageReader.getSurface（）で終わりです。</font><font style="vertical-align: inherit;">しかし、あなたがそれに到達するまで... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その瞬間から物事はより楽しくなり、3番目の画面のボタン「写真を撮る」を使用することができました。</font><font style="vertical-align: inherit;">それが押されると、makePhoto（）メソッドが呼び出されます（まあ、だれが考えたでしょう）。</font></font><br>
<br>
<pre><code class="java hljs"> mButtonToMakeShot.setOnClickListener(<span class="hljs-keyword">new</span> View.OnClickListener() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span><span class="hljs-params">(View v)</span>
            </span>{
                <span class="hljs-keyword">if</span> (myCameras[CAMERA1].isOpen()) myCameras[CAMERA1].makePhoto();
                <span class="hljs-keyword">if</span> (myCameras[CAMERA2].isOpen()) myCameras[CAMERA2].makePhoto();<font></font>
            }<font></font>
        });<font></font>
<font></font>
……<font></font>
<font></font>
     <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CameraService</span> </span>{
     <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">makePhoto</span> <span class="hljs-params">()</span></span>{
            <span class="hljs-keyword">try</span> {<font></font>
<font></font>
                <span class="hljs-comment">// This is the CaptureRequest.Builder that we use to take a picture.</span>
                <span class="hljs-keyword">final</span> CaptureRequest.Builder captureBuilder =<font></font>
                        mCameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_STILL_CAPTURE);<font></font>
                captureBuilder.addTarget(mImageReader.getSurface());<font></font>
                CameraCaptureSession.CaptureCallback CaptureCallback = <span class="hljs-keyword">new</span> CameraCaptureSession.CaptureCallback() {<font></font>
<font></font>
                    <span class="hljs-meta">@Override</span>
                    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCaptureCompleted</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> CameraCaptureSession session,
                                                   <span class="hljs-meta">@NonNull</span> CaptureRequest request,
                                                   <span class="hljs-meta">@NonNull</span> TotalCaptureResult result)</span> </span>{<font></font>
                      }<font></font>
                };<font></font>
<font></font>
                   mCaptureSession.stopRepeating();<font></font>
                   mCaptureSession.abortCaptures();<font></font>
                   mCaptureSession.capture(captureBuilder.build(), CaptureCallback, <span class="hljs-keyword">null</span>);<font></font>
            }<font></font>
            <span class="hljs-keyword">catch</span> (CameraAccessException e) {<font></font>
                e.printStackTrace();<font></font>
            }<font></font>
      }<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、その直後にOnImageAvailableListenerリスナーを登録します。</font></font><br>
<br>
<pre><code class="java hljs">   <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ImageReader.OnImageAvailableListener mOnImageAvailableListener<font></font>
                = <span class="hljs-keyword">new</span> ImageReader.OnImageAvailableListener() {<font></font>
<font></font>
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onImageAvailable</span><span class="hljs-params">(ImageReader reader)</span> </span>{<font></font>
<font></font>
                { Toast.makeText(MainActivity.<span class="hljs-keyword">this</span>,<span class="hljs-string">"   "</span>, Toast.LENGTH_SHORT).show();}<font></font>
           }<font></font>
        };<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼は何もしていませんが、トーストですべてが順調に進んでいることを伝えるだけなので、画像をファイルに保存できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このためには、ファイル自体が必要です。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CameraService</span> </span>{<font></font>
<font></font>
<span class="hljs-keyword">private</span> File mFile = <span class="hljs-keyword">new</span> File(Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DCIM), <span class="hljs-string">"test1.jpg"</span>);;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、ImageSaverクラスの特別なオブジェクト。画像からバイトバッファーに、そこからバイナリファイルにデータをすばやく転送します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このクラスは静的でRunnableです。</font><font style="vertical-align: inherit;">したがって、MainActivity自体に配置します。</font></font><br>
<br>
<pre><code class="java hljs"> <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ImageSaver</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>{<font></font>
<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> File mFile;<font></font>
<font></font>
        ImageSaver(Image image, File file) {<font></font>
            mImage = image;<font></font>
            mFile = file;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-meta">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>{<font></font>
            ByteBuffer buffer = mImage.getPlanes()[<span class="hljs-number">0</span>].getBuffer();
            <span class="hljs-keyword">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[buffer.remaining()];<font></font>
            buffer.get(bytes);<font></font>
            FileOutputStream output = <span class="hljs-keyword">null</span>;
            <span class="hljs-keyword">try</span> {<font></font>
                output = <span class="hljs-keyword">new</span> FileOutputStream(mFile);<font></font>
                output.write(bytes);<font></font>
            } <span class="hljs-keyword">catch</span> (IOException e) {<font></font>
                e.printStackTrace();<font></font>
            } <span class="hljs-keyword">finally</span> {<font></font>
                mImage.close();<font></font>
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> != output) {
                    <span class="hljs-keyword">try</span> {<font></font>
                        output.close();<font></font>
                    } <span class="hljs-keyword">catch</span> (IOException e) {<font></font>
                        e.printStackTrace();<font></font>
                    }<font></font>
                }<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、それが機能するように、OnImageAvailableListenerリスナーに次のように書き込みます。</font></font><br>
<br>
<pre><code class="java hljs">mBackgroundHandler.post(<span class="hljs-keyword">new</span> ImageSaver(reader.acquireNextImage(), mFile));
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">待つ！</font><font style="vertical-align: inherit;">ああ、くそ ！！</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mBackgroundHandlerとは何ですか？</font><font style="vertical-align: inherit;">それでも、それは彼なしで完全に機能しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、実際、正しい質問は、それなしではどのように機能するのかということです。</font><font style="vertical-align: inherit;">Googleの例で述べたように、BackgroundHandlerはBackgroundThreadを提供します。BackgroundThreadはバックグラウンドで動作するスレッドであり、実際にカメラのアクティビティを担当します。</font><font style="vertical-align: inherit;">そして実際には、アクティビティの最初に登録する必要があります。</font></font><br>
<br>
<pre><code class="java hljs">   <span class="hljs-keyword">private</span> HandlerThread mBackgroundThread;
   <span class="hljs-keyword">private</span> Handler mBackgroundHandler = <span class="hljs-keyword">null</span>;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">startBackgroundThread</span><span class="hljs-params">()</span> </span>{<font></font>
        mBackgroundThread = <span class="hljs-keyword">new</span> HandlerThread(<span class="hljs-string">"CameraBackground"</span>);<font></font>
        mBackgroundThread.start();<font></font>
        mBackgroundHandler = <span class="hljs-keyword">new</span> Handler(mBackgroundThread.getLooper());<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">stopBackgroundThread</span><span class="hljs-params">()</span> </span>{<font></font>
        mBackgroundThread.quitSafely();<font></font>
        <span class="hljs-keyword">try</span> {<font></font>
            mBackgroundThread.join();<font></font>
            mBackgroundThread = <span class="hljs-keyword">null</span>;<font></font>
            mBackgroundHandler = <span class="hljs-keyword">null</span>;<font></font>
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {<font></font>
            e.printStackTrace();<font></font>
        }<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それだけでなく、BackgroundThreadの開始と停止もここに追加する必要があります。</font></font><br>
<br>
<pre><code class="java hljs">  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onPause</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">super</span>.onPause();<font></font>
        stopBackgroundThread();<font></font>
   }<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onResume</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">super</span>.onResume();<font></font>
        startBackgroundThread();<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mBackgroundHandlerについては、ハンドラを必要とするすべてのコールバックに追加する必要があり、心配せずに代わりにnullを書き込んだ場所。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最も興味深いのは、プログラムのテキストから簡単に確認できるため、アプリケーションを開くときにこのバックグラウンドスレッドを開始しないことです。</font><font style="vertical-align: inherit;">つまり、それは暗黙のうちに、私たちの助けなしに始まります。</font><font style="vertical-align: inherit;">しかし、それを停止してonPause（）およびonResume（）モードで実行する必要があります。</font><font style="vertical-align: inherit;">ここでは、何らかの矛盾が生じます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、画像は正常にファイルに保存されます。</font><font style="vertical-align: inherit;">これは、アプリケーションを実行することで簡単に確認できます。</font><font style="vertical-align: inherit;">ことわざにあるように、労働の冠は何よりも賞です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ax/lu/rq/axlurqxeo1_oba674iz9uos8hp0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
確かに、絵はどういうわけかその側にありますが、この問題を解決することは将来の世代の仕事です。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プログラムの完全なリスト</font></font></b><div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-keyword">package</span> com.example.camera;
<span class="hljs-keyword">import</span> androidx.annotation.NonNull;
<span class="hljs-keyword">import</span> androidx.annotation.RequiresApi;
<span class="hljs-keyword">import</span> androidx.appcompat.app.AppCompatActivity;
<span class="hljs-keyword">import</span> androidx.core.content.ContextCompat;
<span class="hljs-keyword">import</span> android.Manifest;
<span class="hljs-keyword">import</span> android.content.Context;
<span class="hljs-keyword">import</span> android.content.pm.PackageManager;
<span class="hljs-keyword">import</span> android.graphics.ImageFormat;
<span class="hljs-keyword">import</span> android.graphics.SurfaceTexture;
<span class="hljs-keyword">import</span> android.hardware.camera2.CameraAccessException;
<span class="hljs-keyword">import</span> android.hardware.camera2.CameraCaptureSession;
<span class="hljs-keyword">import</span> android.hardware.camera2.CameraDevice;
<span class="hljs-keyword">import</span> android.hardware.camera2.CameraManager;
<span class="hljs-keyword">import</span> android.hardware.camera2.CaptureRequest;
<span class="hljs-keyword">import</span> android.hardware.camera2.TotalCaptureResult;
<span class="hljs-keyword">import</span> android.media.Image;
<span class="hljs-keyword">import</span> android.media.ImageReader;
<span class="hljs-keyword">import</span> android.os.Build;
<span class="hljs-keyword">import</span> android.os.Bundle;
<span class="hljs-keyword">import</span> android.os.Environment;
<span class="hljs-keyword">import</span> android.os.Handler;
<span class="hljs-keyword">import</span> android.os.HandlerThread;
<span class="hljs-keyword">import</span> android.util.Log;
<span class="hljs-keyword">import</span> android.view.Surface;
<span class="hljs-keyword">import</span> android.view.TextureView;
<span class="hljs-keyword">import</span> android.view.View;
<span class="hljs-keyword">import</span> android.widget.Button;
<span class="hljs-keyword">import</span> android.widget.Toast;<font></font>
<font></font>
<span class="hljs-keyword">import</span> java.io.File;
<span class="hljs-keyword">import</span> java.io.FileOutputStream;
<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.nio.ByteBuffer;
<span class="hljs-keyword">import</span> java.util.Arrays;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AppCompatActivity</span> </span>{<font></font>
<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String LOG_TAG = <span class="hljs-string">"myLogs"</span>;<font></font>
<font></font>
<font></font>
    CameraService[] myCameras = <span class="hljs-keyword">null</span>;<font></font>
<font></font>
    <span class="hljs-keyword">private</span> CameraManager mCameraManager    = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> CAMERA1   = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> CAMERA2   = <span class="hljs-number">1</span>;<font></font>
<font></font>
    <span class="hljs-keyword">private</span> Button mButtonOpenCamera1 = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">private</span> Button mButtonOpenCamera2 = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">private</span> Button mButtonToMakeShot = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">private</span> TextureView mImageView = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">private</span> HandlerThread mBackgroundThread;
    <span class="hljs-keyword">private</span> Handler mBackgroundHandler = <span class="hljs-keyword">null</span>;<font></font>
<font></font>
<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">startBackgroundThread</span><span class="hljs-params">()</span> </span>{<font></font>
        mBackgroundThread = <span class="hljs-keyword">new</span> HandlerThread(<span class="hljs-string">"CameraBackground"</span>);<font></font>
        mBackgroundThread.start();<font></font>
        mBackgroundHandler = <span class="hljs-keyword">new</span> Handler(mBackgroundThread.getLooper());<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">stopBackgroundThread</span><span class="hljs-params">()</span> </span>{<font></font>
        mBackgroundThread.quitSafely();<font></font>
        <span class="hljs-keyword">try</span> {<font></font>
            mBackgroundThread.join();<font></font>
            mBackgroundThread = <span class="hljs-keyword">null</span>;<font></font>
            mBackgroundHandler = <span class="hljs-keyword">null</span>;<font></font>
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {<font></font>
            e.printStackTrace();<font></font>
        }<font></font>
    }<font></font>
<font></font>
<font></font>
<font></font>
<font></font>
    <span class="hljs-meta">@RequiresApi(api = Build.VERSION_CODES.M)</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> </span>{
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);<font></font>
        setContentView(R.layout.activity_main);<font></font>
<font></font>
<font></font>
        Log.d(LOG_TAG, <span class="hljs-string">" "</span>);
        <span class="hljs-keyword">if</span> (checkSelfPermission(Manifest.permission.CAMERA) != PackageManager.PERMISSION_GRANTED<font></font>
                ||<font></font>
                (ContextCompat.checkSelfPermission(MainActivity.<span class="hljs-keyword">this</span>, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED)<font></font>
        )<font></font>
        {<font></font>
            requestPermissions(<span class="hljs-keyword">new</span> String[]{Manifest.permission.CAMERA,Manifest.permission.WRITE_EXTERNAL_STORAGE},<span class="hljs-number">1</span>);<font></font>
        }<font></font>
<font></font>
<font></font>
        mButtonOpenCamera1 =  findViewById(R.id.button1);<font></font>
        mButtonOpenCamera2 =  findViewById(R.id.button2);<font></font>
        mButtonToMakeShot =findViewById(R.id.button3);<font></font>
        mImageView = findViewById(R.id.textureView);<font></font>
<font></font>
        mButtonOpenCamera1.setOnClickListener(<span class="hljs-keyword">new</span> View.OnClickListener() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span><span class="hljs-params">(View v)</span> </span>{
                <span class="hljs-keyword">if</span> (myCameras[CAMERA2].isOpen()) {myCameras[CAMERA2].closeCamera();}
                <span class="hljs-keyword">if</span> (myCameras[CAMERA1] != <span class="hljs-keyword">null</span>) {
                    <span class="hljs-keyword">if</span> (!myCameras[CAMERA1].isOpen()) myCameras[CAMERA1].openCamera();<font></font>
                }<font></font>
            }<font></font>
        });<font></font>
<font></font>
        mButtonOpenCamera2.setOnClickListener(<span class="hljs-keyword">new</span> View.OnClickListener() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span><span class="hljs-params">(View v)</span> </span>{
                <span class="hljs-keyword">if</span> (myCameras[CAMERA1].isOpen()) {myCameras[CAMERA1].closeCamera();}
                <span class="hljs-keyword">if</span> (myCameras[CAMERA2] != <span class="hljs-keyword">null</span>) {
                    <span class="hljs-keyword">if</span> (!myCameras[CAMERA2].isOpen()) myCameras[CAMERA2].openCamera();<font></font>
                }<font></font>
            }<font></font>
        });<font></font>
<font></font>
<font></font>
        mButtonToMakeShot.setOnClickListener(<span class="hljs-keyword">new</span> View.OnClickListener() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span><span class="hljs-params">(View v)</span>
            </span>{<font></font>
<font></font>
<font></font>
<font></font>
<font></font>
                <span class="hljs-keyword">if</span> (myCameras[CAMERA1].isOpen()) myCameras[CAMERA1].makePhoto();
                <span class="hljs-keyword">if</span> (myCameras[CAMERA2].isOpen()) myCameras[CAMERA2].makePhoto();<font></font>
<font></font>
            }<font></font>
        });<font></font>
<font></font>
<font></font>
        mCameraManager = (CameraManager) getSystemService(Context.CAMERA_SERVICE);<font></font>
        <span class="hljs-keyword">try</span>{
            <span class="hljs-comment">//     </span><font></font>
<font></font>
<font></font>
            myCameras = <span class="hljs-keyword">new</span> CameraService[mCameraManager.getCameraIdList().length];<font></font>
<font></font>
<font></font>
<font></font>
            <span class="hljs-keyword">for</span> (String cameraID : mCameraManager.getCameraIdList()) {<font></font>
                Log.i(LOG_TAG, <span class="hljs-string">"cameraID: "</span>+cameraID);
                <span class="hljs-keyword">int</span> id = Integer.parseInt(cameraID);<font></font>
<font></font>
<font></font>
                <span class="hljs-comment">//    </span>
                myCameras[id] = <span class="hljs-keyword">new</span> CameraService(mCameraManager,cameraID);<font></font>
<font></font>
<font></font>
<font></font>
<font></font>
            }<font></font>
        }<font></font>
        <span class="hljs-keyword">catch</span>(CameraAccessException e){<font></font>
            Log.e(LOG_TAG, e.getMessage());<font></font>
            e.printStackTrace();<font></font>
        }<font></font>
<font></font>
<font></font>
    }<font></font>
<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CameraService</span> </span>{<font></font>
<font></font>
        <span class="hljs-keyword">private</span> File mFile = <span class="hljs-keyword">new</span> File(Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DCIM), <span class="hljs-string">"test1.jpg"</span>);;
        <span class="hljs-keyword">private</span> String mCameraID;
        <span class="hljs-keyword">private</span> CameraDevice mCameraDevice = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">private</span> CameraCaptureSession mCaptureSession;
        <span class="hljs-keyword">private</span> ImageReader mImageReader;<font></font>
<font></font>
<font></font>
<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CameraService</span><span class="hljs-params">(CameraManager cameraManager, String cameraID)</span> </span>{<font></font>
<font></font>
            mCameraManager = cameraManager;<font></font>
            mCameraID = cameraID;<font></font>
<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">makePhoto</span> <span class="hljs-params">()</span></span>{<font></font>
<font></font>
<font></font>
<font></font>
<font></font>
<font></font>
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// This is the CaptureRequest.Builder that we use to take a picture.</span>
                <span class="hljs-keyword">final</span> CaptureRequest.Builder captureBuilder =<font></font>
                        mCameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_STILL_CAPTURE);<font></font>
                captureBuilder.addTarget(mImageReader.getSurface());<font></font>
                CameraCaptureSession.CaptureCallback CaptureCallback = <span class="hljs-keyword">new</span> CameraCaptureSession.CaptureCallback() {<font></font>
<font></font>
                    <span class="hljs-meta">@Override</span>
                    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCaptureCompleted</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> CameraCaptureSession session,
                                                   <span class="hljs-meta">@NonNull</span> CaptureRequest request,
                                                   <span class="hljs-meta">@NonNull</span> TotalCaptureResult result)</span> </span>{<font></font>
<font></font>
<font></font>
                    }<font></font>
                };<font></font>
<font></font>
                mCaptureSession.stopRepeating();<font></font>
                mCaptureSession.abortCaptures();<font></font>
                mCaptureSession.capture(captureBuilder.build(), CaptureCallback, mBackgroundHandler);<font></font>
            }<font></font>
            <span class="hljs-keyword">catch</span> (CameraAccessException e) {<font></font>
                e.printStackTrace();<font></font>
<font></font>
<font></font>
            }<font></font>
<font></font>
<font></font>
<font></font>
<font></font>
        }<font></font>
<font></font>
<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ImageReader.OnImageAvailableListener mOnImageAvailableListener<font></font>
                = <span class="hljs-keyword">new</span> ImageReader.OnImageAvailableListener() {<font></font>
<font></font>
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onImageAvailable</span><span class="hljs-params">(ImageReader reader)</span> </span>{<font></font>
<font></font>
                mBackgroundHandler.post(<span class="hljs-keyword">new</span> ImageSaver(reader.acquireNextImage(), mFile));<font></font>
<font></font>
<font></font>
            }<font></font>
<font></font>
        };<font></font>
<font></font>
<font></font>
        <span class="hljs-keyword">private</span> CameraDevice.StateCallback mCameraCallback = <span class="hljs-keyword">new</span> CameraDevice.StateCallback() {<font></font>
<font></font>
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onOpened</span><span class="hljs-params">(CameraDevice camera)</span> </span>{<font></font>
                mCameraDevice = camera;<font></font>
                Log.i(LOG_TAG, <span class="hljs-string">"Open camera  with id:"</span>+mCameraDevice.getId());<font></font>
<font></font>
                createCameraPreviewSession();<font></font>
            }<font></font>
<font></font>
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onDisconnected</span><span class="hljs-params">(CameraDevice camera)</span> </span>{<font></font>
                mCameraDevice.close();<font></font>
<font></font>
                Log.i(LOG_TAG, <span class="hljs-string">"disconnect camera  with id:"</span>+mCameraDevice.getId());<font></font>
                mCameraDevice = <span class="hljs-keyword">null</span>;<font></font>
            }<font></font>
<font></font>
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onError</span><span class="hljs-params">(CameraDevice camera, <span class="hljs-keyword">int</span> error)</span> </span>{<font></font>
                Log.i(LOG_TAG, <span class="hljs-string">"error! camera id:"</span>+camera.getId()+<span class="hljs-string">" error:"</span>+error);<font></font>
            }<font></font>
        };<font></font>
<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">createCameraPreviewSession</span><span class="hljs-params">()</span> </span>{<font></font>
<font></font>
            mImageReader = ImageReader.newInstance(<span class="hljs-number">1920</span>,<span class="hljs-number">1080</span>, ImageFormat.JPEG,<span class="hljs-number">1</span>);<font></font>
            mImageReader.setOnImageAvailableListener(mOnImageAvailableListener, <span class="hljs-keyword">null</span>);<font></font>
<font></font>
            SurfaceTexture texture = mImageView.getSurfaceTexture();<font></font>
<font></font>
           texture.setDefaultBufferSize(<span class="hljs-number">1920</span>,<span class="hljs-number">1080</span>);<font></font>
            Surface surface = <span class="hljs-keyword">new</span> Surface(texture);<font></font>
<font></font>
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">final</span> CaptureRequest.Builder builder =<font></font>
                        mCameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_PREVIEW);<font></font>
<font></font>
                builder.addTarget(surface);<font></font>
<font></font>
<font></font>
<font></font>
<font></font>
                mCameraDevice.createCaptureSession(Arrays.asList(surface,mImageReader.getSurface()),<font></font>
                        <span class="hljs-keyword">new</span> CameraCaptureSession.StateCallback() {<font></font>
<font></font>
                            <span class="hljs-meta">@Override</span>
                            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onConfigured</span><span class="hljs-params">(CameraCaptureSession session)</span> </span>{<font></font>
                                mCaptureSession = session;<font></font>
                                <span class="hljs-keyword">try</span> {<font></font>
                                    mCaptureSession.setRepeatingRequest(builder.build(),<span class="hljs-keyword">null</span>,mBackgroundHandler);<font></font>
                                } <span class="hljs-keyword">catch</span> (CameraAccessException e) {<font></font>
                                    e.printStackTrace();<font></font>
                                }<font></font>
                            }<font></font>
<font></font>
                            <span class="hljs-meta">@Override</span>
                            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onConfigureFailed</span><span class="hljs-params">(CameraCaptureSession session)</span> </span>{ }}, mBackgroundHandler);<font></font>
            } <span class="hljs-keyword">catch</span> (CameraAccessException e) {<font></font>
                e.printStackTrace();<font></font>
            }<font></font>
<font></font>
        }<font></font>
<font></font>
<font></font>
<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isOpen</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">if</span> (mCameraDevice == <span class="hljs-keyword">null</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<font></font>
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<font></font>
            }<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">openCamera</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">try</span> {<font></font>
<font></font>
                <span class="hljs-keyword">if</span> (checkSelfPermission(Manifest.permission.CAMERA) == PackageManager.PERMISSION_GRANTED) {<font></font>
<font></font>
<font></font>
                    mCameraManager.openCamera(mCameraID,mCameraCallback,mBackgroundHandler);<font></font>
<font></font>
                }<font></font>
<font></font>
<font></font>
<font></font>
            } <span class="hljs-keyword">catch</span> (CameraAccessException e) {<font></font>
                Log.i(LOG_TAG,e.getMessage());<font></font>
<font></font>
            }<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">closeCamera</span><span class="hljs-params">()</span> </span>{<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (mCameraDevice != <span class="hljs-keyword">null</span>) {<font></font>
                mCameraDevice.close();<font></font>
                mCameraDevice = <span class="hljs-keyword">null</span>;<font></font>
            }<font></font>
        }<font></font>
<font></font>
<font></font>
<font></font>
    }<font></font>
<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onPause</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span>(myCameras[CAMERA1].isOpen()){myCameras[CAMERA1].closeCamera();}
        <span class="hljs-keyword">if</span>(myCameras[CAMERA2].isOpen()){myCameras[CAMERA2].closeCamera();}<font></font>
        stopBackgroundThread();<font></font>
        <span class="hljs-keyword">super</span>.onPause();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onResume</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">super</span>.onResume();<font></font>
        startBackgroundThread();<font></font>
<font></font>
<font></font>
    }<font></font>
<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ImageSaver</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>{<font></font>
<font></font>
        <span class="hljs-comment">/**
         * The JPEG image
         */</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Image mImage;
        <span class="hljs-comment">/**
         * The file we save the image into.
         */</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> File mFile;<font></font>
<font></font>
        ImageSaver(Image image, File file) {<font></font>
            mImage = image;<font></font>
            mFile = file;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-meta">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>{<font></font>
            ByteBuffer buffer = mImage.getPlanes()[<span class="hljs-number">0</span>].getBuffer();
            <span class="hljs-keyword">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[buffer.remaining()];<font></font>
            buffer.get(bytes);<font></font>
            FileOutputStream output = <span class="hljs-keyword">null</span>;
            <span class="hljs-keyword">try</span> {<font></font>
                output = <span class="hljs-keyword">new</span> FileOutputStream(mFile);<font></font>
                output.write(bytes);<font></font>
            } <span class="hljs-keyword">catch</span> (IOException e) {<font></font>
                e.printStackTrace();<font></font>
            } <span class="hljs-keyword">finally</span> {<font></font>
                mImage.close();<font></font>
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> != output) {
                    <span class="hljs-keyword">try</span> {<font></font>
                        output.close();<font></font>
                    } <span class="hljs-keyword">catch</span> (IOException e) {<font></font>
                        e.printStackTrace();<font></font>
                    }<font></font>
                }<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
</div></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja468073/index.html">Andrei Terekhov：「アメリカ人の方がいいと言っていいほど話せますが、車は故障しません」</a></li>
<li><a href="../ja468075/index.html">検索におけるシャムニューラルネットワークの使用</a></li>
<li><a href="../ja468077/index.html">大人の方法でテストを行います。スペクトル分析</a></li>
<li><a href="../ja468079/index.html">何度も節約してくれたGoogle Analyticsのカスタムディメンション</a></li>
<li><a href="../ja468081/index.html">「匿名データ」または152-FZで計画されているもの</a></li>
<li><a href="../ja468085/index.html">「Safe DevOps」という本。効率的なシステム運用」</a></li>
<li><a href="../ja468087/index.html">試験における二分割法</a></li>
<li><a href="../ja468089/index.html">エディションベースの再定義：本番環境で可能ですか？</a></li>
<li><a href="../ja468091/index.html">市民のデータを含む単一のデータベースの作成に関する法案は、最初の読書で州下院で採択されました</a></li>
<li><a href="../ja468093/index.html">製品の硝酸塩：スイスの店とロシアの店と夏の別荘</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>