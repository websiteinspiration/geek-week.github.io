<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº‚Äçüè≠ üèçÔ∏è üñ≤Ô∏è Verwenden der Parallelisierung bei der Verarbeitung von Daten in C # üôà üó∫Ô∏è ü§òüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Guten Tag allerseits! Ich bin ein technischer Spezialist, der in einem internen Audit-System arbeitet. Zu meinen Aufgaben geh√∂rt die Erstellung von ET...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Verwenden der Parallelisierung bei der Verarbeitung von Daten in C #</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/502868/"><img src="https://habrastorage.org/webt/mr/xs/_r/mrxs_ryliqoncau3bzm0xdxj4g4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Guten Tag allerseits! </font><font style="vertical-align: inherit;">Ich bin ein technischer Spezialist, der in einem internen Audit-System arbeitet. Zu meinen Aufgaben geh√∂rt die Erstellung von ETL-Tools in der Programmiersprache C #.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In regelm√§√üigen Abst√§nden sind Datenquellen eng strukturierte Dateien in XML, CSV, JSON oder einem anderen Format. Manchmal wird ihre Anzahl ziemlich gro√ü und nimmt st√§ndig zu. Beispielsweise stieg bei einer meiner Aufgaben die Anzahl der Dateien mit einer durchschnittlichen Aktualisierungsrate von ungef√§hr 150.000 Dateien pro Tag. Wenn die Verarbeitung einer einzelnen Datei (Lesen eines Arrays von Bytes von der Festplatte in den Speicher, Transformieren der heruntergeladenen Daten und Schreiben in die Datenbank) gleichzeitig eine Sekunde dauert, wird klar, dass die Verarbeitung aller Dateien mehr als 40 Stunden dauert. In diesem Fall k√∂nnen wir diese Dateien nicht bis zum Ende verarbeiten, da die Geschwindigkeit der Erh√∂hung der Anzahl der Dateien deutlich h√∂her ist als die Geschwindigkeit ihrer Verarbeitung.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine L√∂sung f√ºr dieses Problem besteht darin, eine Anwendung zu entwickeln, in der ein Pool von Threads unabh√§ngig voneinander erstellt werden kann. Die Threads verarbeiten Dateien, die aus der allgemeinen Warteschlange ausgew√§hlt wurden. In diesem Fall treten jedoch Schwierigkeiten bei der Synchronisierung von Arbeitsabl√§ufen und der gemeinsamen Nutzung von Ressourcen auf, da gegenseitige Sperren sehr wahrscheinlich sind. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um diese Schwierigkeiten zu vermeiden, hat Microsoft die TPL-Bibliothek zum .NET-Framework hinzugef√ºgt (ab Version 4.0). Ich werde Ihnen sagen, wie Sie diese Bibliothek verwenden k√∂nnen, um dieses Problem zu l√∂sen.</font></font><br>
<br>
<a name="habracut"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daher sieht der Operationsalgorithmus zun√§chst wie folgt aus: Ein </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dateispeicherverzeichnis wird gescannt und eine Liste (z. B. Liste) mit Daten zu allen Dateien wird zur√ºckgegeben. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Es beginnt ein Zyklus (f√ºr oder f√ºr jeden), in dem Daten aus der n√§chsten Datei bei Bedarf in den Speicher eingelesen, transformiert und in die Datenbank geschrieben werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Offensichtlich sind die zeitaufw√§ndigsten Vorg√§nge das Lesen von Daten von der Festplatte in den Speicher und das Schreiben von Daten aus dem Speicher in die Datenbank. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Versuchen wir, unseren Algorithmus mithilfe der TPL-Bibliothek zu optimieren: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schritt 1. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ñndern Sie die zur√ºckgegebene Liste, indem Sie das Dateispeicherverzeichnis von List in ConcurrentQueue scannen.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Warum machen wir das? Tatsache ist, dass die ConcurrentQueue-Klasse threadsicher ist. Wenn also zwei Threads gleichzeitig versuchen, Daten aus dieser Liste zu extrahieren oder Daten in diese Liste zu schreiben, werden keine Ausnahmen ausgel√∂st (Ausnahme). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Punkt 1 unseres Algorithmus sieht folgenderma√üen aus: Das Dateispeicherverzeichnis wird gescannt und die ConcurrentQueue-Liste mit Daten zu allen Dateien wird zur√ºckgegeben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Punkt 2: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lassen Sie uns das Design √§ndern, das einen Zyklus der Datenverarbeitung aus einer Datei bildet. Ersetzen Sie durch Parallel.For oder Parallel.ForEach. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was ist der Unterschied zwischen dem Neubau und f√ºr? Aus dem Namen des Sprachkonstrukts ist alles einfach und grunds√§tzlich klar. Alle Iterationen der Schleife werden in parallelen Threads ausgef√ºhrt. Als Beispiel werde ich die Organisation der Schleife mit dem Parallel.ForEach-Konstrukt zeigen:</font></font><br>
<br>
<pre><code class="plaintext hljs">Parallel.ForEach(listFiles, (currentFile) =&gt;<font></font>
       	  {<font></font>
              	var dataFile = getDataFile(currentFile.FullName);<font></font>
		TransformData(dataFile);<font></font>
		WriteToDB(dataFile);<font></font>
               });</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dabei gilt </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Folgendes </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">listFiles ist eine Sammlung vom Typ ConcurrentQueue, die eine Liste der Dateien im Verzeichnis enth√§lt. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 currentFile - ein Element der listFiles-Auflistung, das vom ForEach-Konstrukt zur√ºckgegeben wird. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 dataFile - eine bedingte Datenstruktur im Speicher, die durch Einlesen des Inhalts der Datei in den Speicher erhalten wird; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 getDataFile - eine bedingte Funktion, die den Inhalt einer Datei in Form einer Datenstruktur zur√ºckgibt; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 TransformData - bedingte Prozedur zum Transformieren empfangener Daten; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 WriteToDB ist eine bedingte Prozedur zum Schreiben von Daten in die Datenbank.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Beispiel organisieren wir die Schleife mithilfe des Konstrukts Parallel.ForEach. In diesem Zyklus werden in parallelen Streams Daten von der Festplatte gelesen, transformiert und in die Datenbank geschrieben. Gleichzeitig gibt es keine Probleme bei der Organisation der Arbeit paralleler Fl√ºsse. Die Anzahl der parallelen Threads h√§ngt von der Anzahl der Prozessorkerne und ihrer Arbeitslast ab. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit dem vorgeschlagenen Algorithmus beschleunigen wir die Dateiverarbeitung um mindestens das Zweifache. Diese Zahl h√§ngt nat√ºrlich von der Anzahl der Kerne und dem Speicher des Computers ab, auf dem das Programm ausgef√ºhrt wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um das Programm zu beschleunigen, m√ºssen Sie den Datensatz in der Datenbank in einem separaten Stream ablegen, der unabh√§ngig vom Haupt-Stream funktioniert. Dies kann mithilfe der ConcurrentQueue-Auflistung erfolgen, um Konflikte beim Hinzuf√ºgen von Daten zur Warteschlange zu vermeiden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir schreiben das obige Beispiel neu und ber√ºcksichtigen dabei die Optimierung des Schreibens in die Datenbank. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Angenommen, ein Dateireader gibt Daten in einer Datentabelle an uns zur√ºck:</font></font><br>
<br>
<pre><code class="plaintext hljs">Parallel.ForEach(listFiles, (currentFile) =&gt;<font></font>
       	  {<font></font>
              	DataTable dataFile = getDataFile(currentFile.FullName);<font></font>
		TransformData(dataFile);<font></font>
		threadWriteToDB.ListData.Enqueue(dataFile);<font></font>
               });<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie sehen k√∂nnen, f√ºgen wir anstelle einer Zeile mit einem Aufruf der Schreibprozedur in der Datenbank einfach die ConcurrentQueue ListData-Auflistung hinzu, die in einem separaten Thread beschrieben und initialisiert wurde, dessen Instanz threadWriteToDB in unserer Schleife verwendet wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Schreiben in die Datenbank erfolgt bereits in einem separaten Stream. </font><font style="vertical-align: inherit;">Das Schreiben in die Datenbank kann √§hnlich wie das Arbeiten mit Dateien mit den Konstruktionen Parallel.For und / oder Paral-lel.Foreach organisiert werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In meiner Aufgabe, in der eine vergleichbare Anzahl von Dateien verarbeitet werden musste, kann jetzt durchschnittlich 200.000 bis 400.000 Dateien pro Tag verarbeitet werden, und die Geschwindigkeit wird durch Laden der Datenbank und der Breite des Datenkanals begrenzt.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de502846/index.html">Zuckerberg startete Gesch√§fte. Instagram und Facebook werden nach und nach zu L√§den.</a></li>
<li><a href="../de502852/index.html">Warum widersetzen sich Menschen Ver√§nderungen und wie k√∂nnen sie ihnen beim Wiederaufbau helfen?</a></li>
<li><a href="../de502854/index.html">Warum schlagen ERP-Implementierungen fehl?</a></li>
<li><a href="../de502860/index.html">Transport am 20. Mai: Eine rasche Erholung der Luftfahrt ist sichtbar</a></li>
<li><a href="../de502862/index.html">LabVIEW NXG - Grundlagen der Frontplatte - Bedienelemente und Anzeigen</a></li>
<li><a href="../de502870/index.html">Was passiert mit der Popularit√§t von MySQL und PostgreSQL? Mitap Diskussion</a></li>
<li><a href="../de502872/index.html">Wie man die Immunit√§t st√§rkt und vor SARS und wahrscheinlich COVID-19 sch√ºtzt. Wissenschaftlicher Beweis</a></li>
<li><a href="../de502874/index.html">√úber eine starke Matrix und Atmosph√§re im Entwicklungsteam</a></li>
<li><a href="../de502876/index.html">Workflow auf Google Drive?</a></li>
<li><a href="../de502880/index.html">Geschichte von AtariTel. Telefone und Bildtelefone aus der Geheimabteilung des Unternehmens</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>