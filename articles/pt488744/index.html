<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌷 📣 👃🏽 Guia para trabalhar com o OpenAL em C ++. Parte 1: reproduzir som 🖕🏻 🎁 🤰🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Seu jogo precisa de som! Você provavelmente já usou o OpenGL para desenhar na tela. Você descobriu sua API e, portanto, recorreu ao OpenAL porque o no...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Guia para trabalhar com o OpenAL em C ++. Parte 1: reproduzir som</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488744/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seu jogo precisa de som! </font><font style="vertical-align: inherit;">Você provavelmente já usou o OpenGL para desenhar na tela. </font><font style="vertical-align: inherit;">Você descobriu sua API e, portanto, recorreu ao </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenAL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> porque o nome parece familiar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bem, a boa notícia é que o OpenAL também possui uma API muito familiar. </font><font style="vertical-align: inherit;">Foi originalmente projetado para simular a API de especificação OpenGL. </font><font style="vertical-align: inherit;">Foi por isso que o escolhi entre os muitos sistemas de som para jogos; </font><font style="vertical-align: inherit;">além disso, é multiplataforma. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neste artigo, falarei em detalhes sobre qual código é necessário para usar o OpenAL em um jogo escrito em C ++. </font><font style="vertical-align: inherit;">Discutiremos sons, músicas e posicionamento de sons no espaço 3D com exemplos de código.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">História do OpenAL</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vou tentar ser breve. Como mencionado acima, ele foi intencionalmente projetado como uma imitação da API do OpenGL, e há uma razão para isso. Essa é uma API conveniente que é conhecida por muitos e, se os gráficos forem um dos lados do mecanismo do jogo, o som deverá ser diferente. Inicialmente, o OpenAL deveria ser de código aberto, mas algo aconteceu ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As pessoas não estão tão interessadas em som quanto em gráficos, então a Creative acabou tornando o OpenAL sua propriedade, e a </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">implementação de referência</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> agora </font><em><font style="vertical-align: inherit;">é</font></em><font style="vertical-align: inherit;"> proprietária e não é gratuita. Mas! </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A especificação</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> OpenAL ainda é um padrão "aberto", ou seja, é </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">publicada</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Periodicamente, as especificações são alteradas, mas não muitas. O som não muda tão rápido quanto os gráficos, porque não há necessidade específica disso.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A especificação aberta permitiu que outras pessoas criassem uma implementação de código aberto da especificação. Uma dessas implementações é o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenAL Soft</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e, francamente, não faz sentido procurar outras. Esta é a implementação que vou usar e recomendo que você a use também.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ela é multiplataforma. </font><font style="vertical-align: inherit;">É implementado com muita curiosidade - na verdade, dentro da biblioteca, são usadas outras APIs de som presentes no seu sistema. </font><font style="vertical-align: inherit;">No Windows, ele usa o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DirectSound</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , no Unix, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OSS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Graças a isso, ela conseguiu se tornar multiplataforma; </font><font style="vertical-align: inherit;">Em essência, esse é um grande nome para a API do wrapper. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Você pode estar preocupado com a velocidade dessa API. </font><font style="vertical-align: inherit;">Mas não se preocupe. </font><font style="vertical-align: inherit;">Esse é o mesmo som e não cria uma carga grande; portanto, não requer as grandes otimizações exigidas pela API gráfica. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas já chega de história, vamos para a tecnologia.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que você precisa para escrever código no OpenAL?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Você precisa criar o OpenAL Soft na cadeia de ferramentas de sua escolha. Este é um processo muito simples que você pode seguir de acordo com as instruções </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na seção Instalação de origem</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Nunca tive problemas com isso, mas se você tiver alguma dificuldade, escreva um comentário no artigo original ou </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">escreva para a lista de discussão do OpenAL Soft</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, você precisará de alguns arquivos de som e uma maneira de baixá-los. O carregamento de dados de áudio em buffers e detalhes sutis de vários formatos de áudio estão fora do escopo deste artigo, mas você pode ler sobre o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">download e o streaming de arquivos Ogg / Vorbis</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Baixar arquivos WAV é muito simples, já existem centenas de artigos na Internet sobre isso.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A tarefa de encontrar arquivos de áudio você precisa decidir por si mesmo. </font><font style="vertical-align: inherit;">Existem muitos ruídos e explosões na Internet que você pode baixar. </font><font style="vertical-align: inherit;">Se você tem um boato, pode tentar </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">escrever sua própria música de chiptune</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tradução</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> em Habré]. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Além disso, mantenha o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Guia do Programador do OpenALSoft à mão</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Esta documentação é muito melhor em pdf com especialização "oficial". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso, de fato, é tudo. </font><font style="vertical-align: inherit;">Assumiremos que você já sabe escrever código, usar o IDE e a cadeia de ferramentas.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Visão geral da API OpenAL</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como eu disse várias vezes, é semelhante à API do OpenGL. A semelhança está no fato de ser baseado em estados e você interagir com descritores / identificadores, e não com os próprios objetos diretamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem discrepâncias entre as convenções da API no OpenGL e OpenAL, mas elas não são significativas. No OpenGL, você precisa fazer chamadas especiais do sistema operacional para gerar um contexto de renderização. Estes desafios são diferentes para diferentes sistemas operacionais e </font><font style="vertical-align: inherit;">não são </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">realmente</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parte da especificação OpenGL. No OpenAL, tudo é diferente - as funções de criação de contexto fazem parte da especificação e são as mesmas, independentemente do sistema operacional. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao interagir com a API, existem três tipos principais de objetos com os quais você interage. </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ouvintes</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">("Ouvintes") é a localização dos "ouvidos" localizados no espaço 3D (sempre há apenas um ouvinte). </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fontes</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ("fontes") são "alto-falantes" que produzem som, novamente no espaço 3D. </font><font style="vertical-align: inherit;">O ouvinte e as fontes podem ser movidos no espaço e, dependendo disso, o que você ouve através dos alto-falantes do jogo muda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os últimos objetos são </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffers</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Eles armazenam amostras de sons que as fontes tocam para os ouvintes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem também </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modos</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que o jogo usa para alterar a maneira como o áudio é processado através do OpenAL.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fontes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como mencionado acima, esses objetos são fontes de sons. </font><font style="vertical-align: inherit;">Eles podem ser definidos como posição e direção e estão associados a um buffer de dados de áudio de reprodução.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ouvinte</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O único conjunto de "orelhas" no jogo. </font><font style="vertical-align: inherit;">O que o ouvinte ouve é reproduzido pelos alto-falantes do computador. </font><font style="vertical-align: inherit;">Ele também tem uma posição.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Buffers</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No OpenGL, seu equivalente é Texture2D. </font><font style="vertical-align: inherit;">Em essência, esses são os dados de áudio que a fonte reproduz.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tipos de dados</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para poder oferecer suporte a código de plataforma cruzada, o OpenAL executa uma certa sequência de ações e define alguns tipos de dados. </font><font style="vertical-align: inherit;">De fato, segue o OpenGL com tanta precisão que podemos converter diretamente tipos OpenAL em tipos OpenGL. </font><font style="vertical-align: inherit;">A tabela abaixo lista eles e seus equivalentes.</font></font><br>
<br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Digite openal</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Digite openalc</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tipo opengl</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C ++ Typedef</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descrição</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ALboolean</code></td>
<td><code>ALCboolean</code></td>
<td><code>GLboolean</code></td>
<td><code>std::int8_t</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valor booleano de 8 bits</font></font></td>
</tr>
<tr>
<td><code>ALbyte</code></td>
<td><code>ALCbyte</code></td>
<td><code>GLbyte</code></td>
<td><code>std::int8_t</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valor inteiro de 8 bits do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">código adicional</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> com um sinal</font></font></td>
</tr>
<tr>
<td><code>ALubyte</code></td>
<td><code>ALCubyte</code></td>
<td><code>GLubyte</code></td>
<td><code>std::uint8_t</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valor inteiro não assinado de 8 bits</font></font></td>
</tr>
<tr>
<td><code>ALchar</code></td>
<td><code>ALCchar</code></td>
<td><code>GLchar</code></td>
<td><code>char</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">símbolo</font></font></td>
</tr>
<tr>
<td><code>ALshort</code></td>
<td><code>ALCshort</code></td>
<td><code>GLshort</code></td>
<td><code>std::int16_t</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valor inteiro assinado de 16 bits</font></font></td>
</tr>
<tr>
<td><code>ALushort</code></td>
<td><code>ALCushort</code></td>
<td><code>GLushort</code></td>
<td><code>std::uint16_t</code></td>
<td>16-    </td>
</tr>
<tr>
<td><code>ALint</code></td>
<td><code>ALCint</code></td>
<td><code>GLint</code></td>
<td><code>std::int32_t</code></td>
<td>32-      </td>
</tr>
<tr>
<td><code>ALuint</code></td>
<td><code>ALCuint</code></td>
<td><code>GLuint</code></td>
<td><code>std::uint32_t</code></td>
<td>32-    </td>
</tr>
<tr>
<td><code>ALsizei</code></td>
<td><code>ALCsizei</code></td>
<td><code>GLsizei</code></td>
<td><code>std::int32_t</code></td>
<td> 32-   </td>
</tr>
<tr>
<td><code>ALenum</code></td>
<td><code>ALCenum</code></td>
<td><code>GLenum</code></td>
<td><code>std::uint32_t</code></td>
<td> 32- </td>
</tr>
<tr>
<td><code>ALfloat</code></td>
<td><code>ALCfloat</code></td>
<td><code>GLfloat</code></td>
<td><code>float</code></td>
<td>32-     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">IEEE 754</a></td>
</tr>
<tr>
<td><code>ALdouble</code></td>
<td><code>ALCdouble</code></td>
<td><code>GLdouble</code></td>
<td><code>double</code></td>
<td>64-     IEEE 754</td>
</tr>
<tr>
<td><code>ALvoid</code></td>
<td><code>ALCvoid</code></td>
<td><code>GLvoid</code></td>
<td><code>void</code></td>
<td> </td>
</tr>
</tbody>
</table></div><br>
<h2>  OpenAL</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Há um artigo sobre como </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">simplificar o reconhecimento de erros OpenAL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mas por uma questão de integridade, repetirei aqui. Existem dois </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tipos</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de chamadas à API do OpenAL: regular e contextual. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As chamadas de contexto que começam com </font></font><code>alc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">são semelhantes às chamadas do OpenGL win32 para obter o contexto de renderização ou suas contrapartes no Linux. O som é bastante simples para todos os sistemas operacionais terem as mesmas chamadas. As chamadas comuns começam com </font></font><code>al</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Para obter erros em chamadas contextuais, chamamos </font></font><code>alcGetError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; no caso de ligações regulares, ligamos </font></font><code>alGetError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Eles retornam um valor </font></font><code>ALCenum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou um valor </font></font><code>ALenum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que simplesmente lista possíveis erros.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora consideraremos apenas um caso, mas em todo o resto eles são quase os mesmos. </font><font style="vertical-align: inherit;">Vamos assumir os desafios habituais </font></font><code>al</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Primeiro, crie uma macro de pré-processador para fazer o trabalho chato de passar detalhes:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> alCall(function, ...) alCallImpl(__FILE__, __LINE__, function, __VA_ARGS__)</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Teoricamente, o compilador pode não suportar </font></font><code>__FILE__</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tanto </font></font><code>__LINE__</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mas, para ser honesto, eu ficaria surpreso se isso acabou por ser assim. </font></font><code>__VA_ARGS__</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indica um número variável de argumentos que podem ser passados ​​para essa macro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, implementamos uma função que recebe manualmente o último erro relatado e exibe um valor claro para o fluxo de erros padrão.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">check_al_errors</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; filename, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint_fast32_t</span> line)</span>
</span>{<font></font>
    ALenum error = alGetError();<font></font>
    <span class="hljs-keyword">if</span>(error != AL_NO_ERROR)<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"***ERROR*** ("</span> &lt;&lt; filename &lt;&lt; <span class="hljs-string">": "</span> &lt;&lt; line &lt;&lt; <span class="hljs-string">")\n"</span> ;
        <span class="hljs-keyword">switch</span>(error)<font></font>
        {<font></font>
        <span class="hljs-keyword">case</span> AL_INVALID_NAME:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"AL_INVALID_NAME: a bad name (ID) was passed to an OpenAL function"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> AL_INVALID_ENUM:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"AL_INVALID_ENUM: an invalid enum value was passed to an OpenAL function"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> AL_INVALID_VALUE:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"AL_INVALID_VALUE: an invalid value was passed to an OpenAL function"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> AL_INVALID_OPERATION:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"AL_INVALID_OPERATION: the requested operation is not valid"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> AL_OUT_OF_MEMORY:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"AL_OUT_OF_MEMORY: the requested operation resulted in OpenAL running out of memory"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">default</span>:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"UNKNOWN AL ERROR: "</span> &lt;&lt; error;<font></font>
        }<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Não há muitos erros possíveis. </font><font style="vertical-align: inherit;">As explicações que escrevi no código são as únicas informações que você receberá sobre esses erros, mas a especificação explica por que uma função específica pode retornar um erro específico. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, implementamos duas funções de modelo diferentes que agrupam todas as nossas chamadas OpenGL.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> alFunction, <span class="hljs-keyword">typename</span>... Params&gt;
<span class="hljs-keyword">auto</span> <span class="hljs-title">alCallImpl</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* filename, 
                <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint_fast32_t</span> line, 
                alFunction function, 
                Params... params)</span>
-&gt;<span class="hljs-keyword">typename</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">enable_if_t</span>&lt;!<span class="hljs-built_in">std</span>::is_same_v&lt;<span class="hljs-keyword">void</span>,<span class="hljs-title">decltype</span><span class="hljs-params">(function(params...))</span>&gt;,<span class="hljs-title">decltype</span><span class="hljs-params">(function(params...))</span>&gt;
</span>{
    <span class="hljs-keyword">auto</span> ret = function(<span class="hljs-built_in">std</span>::forward&lt;Params&gt;(params)...);<font></font>
    check_al_errors(filename,line);<font></font>
    <span class="hljs-keyword">return</span> ret;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> alcFunction, <span class="hljs-keyword">typename</span>... Params&gt;
<span class="hljs-keyword">auto</span> <span class="hljs-title">alcCallImpl</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* filename, 
                 <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint_fast32_t</span> line, 
                 alcFunction function, 
                 ALCdevice* device, 
                 Params... params)</span>
-&gt;<span class="hljs-keyword">typename</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">enable_if_t</span>&lt;<span class="hljs-built_in">std</span>::is_same_v&lt;<span class="hljs-keyword">void</span>,<span class="hljs-title">decltype</span><span class="hljs-params">(function(params...))</span>&gt;,<span class="hljs-keyword">bool</span>&gt;
</span>{<font></font>
    function(<span class="hljs-built_in">std</span>::forward&lt;Params&gt;(params)...);
    <span class="hljs-keyword">return</span> check_alc_errors(filename,line,device);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem dois deles, porque o primeiro é usado para funções OpenAL que retornam </font></font><code>void</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e o segundo é usado quando a função retorna um valor não vazio. </font><font style="vertical-align: inherit;">Se você não está familiarizado com os modelos de metaprogramação em C ++, consulte as partes do código c </font></font><code>std::enable_if</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Eles determinam quais dessas funções de modelo são implementadas pelo compilador para cada chamada de função. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E agora o mesmo para chamadas </font></font><code>alc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> alcCall(function, device, ...) alcCallImpl(__FILE__, __LINE__, function, device, __VA_ARGS__)</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">check_alc_errors</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; filename, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint_fast32_t</span> line, ALCdevice* device)</span>
</span>{<font></font>
    ALCenum error = alcGetError(device);<font></font>
    <span class="hljs-keyword">if</span>(error != ALC_NO_ERROR)<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"***ERROR*** ("</span> &lt;&lt; filename &lt;&lt; <span class="hljs-string">": "</span> &lt;&lt; line &lt;&lt; <span class="hljs-string">")\n"</span> ;
        <span class="hljs-keyword">switch</span>(error)<font></font>
        {<font></font>
        <span class="hljs-keyword">case</span> ALC_INVALID_VALUE:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ALC_INVALID_VALUE: an invalid value was passed to an OpenAL function"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> ALC_INVALID_DEVICE:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ALC_INVALID_DEVICE: a bad device was passed to an OpenAL function"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> ALC_INVALID_CONTEXT:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ALC_INVALID_CONTEXT: a bad context was passed to an OpenAL function"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> ALC_INVALID_ENUM:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ALC_INVALID_ENUM: an unknown enum value was passed to an OpenAL function"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> ALC_OUT_OF_MEMORY:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ALC_OUT_OF_MEMORY: an unknown enum value was passed to an OpenAL function"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">default</span>:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"UNKNOWN ALC ERROR: "</span> &lt;&lt; error;<font></font>
        }<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> alcFunction, <span class="hljs-keyword">typename</span>... Params&gt;
<span class="hljs-keyword">auto</span> <span class="hljs-title">alcCallImpl</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* filename, 
                 <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint_fast32_t</span> line, 
                 alcFunction function, 
                 ALCdevice* device, 
                 Params... params)</span>
-&gt;<span class="hljs-keyword">typename</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">enable_if_t</span>&lt;<span class="hljs-built_in">std</span>::is_same_v&lt;<span class="hljs-keyword">void</span>,<span class="hljs-title">decltype</span><span class="hljs-params">(function(params...))</span>&gt;,<span class="hljs-keyword">bool</span>&gt;
</span>{<font></font>
    function(<span class="hljs-built_in">std</span>::forward&lt;Params&gt;(params)...);
    <span class="hljs-keyword">return</span> check_alc_errors(filename,line,device);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> alcFunction, <span class="hljs-keyword">typename</span> ReturnType, <span class="hljs-keyword">typename</span>... Params&gt;
<span class="hljs-keyword">auto</span> <span class="hljs-title">alcCallImpl</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* filename,
                 <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint_fast32_t</span> line,
                 alcFunction function,
                 ReturnType&amp; returnValue,
                 ALCdevice* device, 
                 Params... params)</span>
-&gt;<span class="hljs-keyword">typename</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">enable_if_t</span>&lt;!<span class="hljs-built_in">std</span>::is_same_v&lt;<span class="hljs-keyword">void</span>,<span class="hljs-title">decltype</span><span class="hljs-params">(function(params...))</span>&gt;,<span class="hljs-keyword">bool</span>&gt;
</span>{<font></font>
    returnValue = function(<span class="hljs-built_in">std</span>::forward&lt;Params&gt;(params)...);
    <span class="hljs-keyword">return</span> check_alc_errors(filename,line,device);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A maior mudança é a inclusão </font></font><code>device</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que todas as chamadas usam </font></font><code>alc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, bem como o uso correspondente de erros de estilo </font></font><code>ALCenum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>ALC_</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Eles parecem muito semelhantes, e por um tempo muito longo pequenas mudanças de </font></font><code>al</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que </font></font><code>alc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">muito danificado meu código e compreensão, então eu continuei lendo direito em cima dela </font></font><code>c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso é tudo. </font><font style="vertical-align: inherit;">Normalmente, uma chamada OpenAL em C ++ se parece com uma das seguintes opções:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">/* example #1 */</span>
alGenSources(<span class="hljs-number">1</span>, &amp;source);<font></font>
ALenum error = alGetError();<font></font>
<span class="hljs-keyword">if</span>(error != AL_NO_ERROR)<font></font>
{<font></font>
    <span class="hljs-comment">/* handle different possibilities */</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/* example #2 */</span><font></font>
alcCaptureStart(&amp;device);<font></font>
ALCenum error = alcGetError();<font></font>
<span class="hljs-keyword">if</span>(error != ALC_NO_ERROR)<font></font>
{<font></font>
    <span class="hljs-comment">/* handle different possibilities */</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/* example #3 */</span>
<span class="hljs-keyword">const</span> ALchar* sz = alGetString(param);<font></font>
ALenum error = alGetError();<font></font>
<span class="hljs-keyword">if</span>(error != AL_NO_ERROR)<font></font>
{<font></font>
    <span class="hljs-comment">/* handle different possibilities */</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/* example #4 */</span>
<span class="hljs-keyword">const</span> ALCchar* sz = alcGetString(&amp;device, param);<font></font>
ALCenum error = alcGetError();<font></font>
<span class="hljs-keyword">if</span>(error != ALC_NO_ERROR)<font></font>
{<font></font>
    <span class="hljs-comment">/* handle different possibilities */</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas agora podemos fazer assim:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">/* example #1 */</span>
<span class="hljs-keyword">if</span>(!alCall(alGenSources, <span class="hljs-number">1</span>, &amp;source))<font></font>
{<font></font>
    <span class="hljs-comment">/* error occurred */</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/* example #2 */</span>
<span class="hljs-keyword">if</span>(!alcCall(alcCaptureStart, &amp;device))<font></font>
{<font></font>
    <span class="hljs-comment">/* error occurred */</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/* example #3 */</span>
<span class="hljs-keyword">const</span> ALchar* sz;
<span class="hljs-keyword">if</span>(!alCall(alGetString, sz, param))<font></font>
{<font></font>
    <span class="hljs-comment">/* error occurred */</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/* example #4 */</span>
<span class="hljs-keyword">const</span> ALCchar* sz;
<span class="hljs-keyword">if</span>(!alcCall(alcGetString, sz, &amp;device, param))<font></font>
{<font></font>
    <span class="hljs-comment">/* error occurred */</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pode parecer estranho para você, mas é mais conveniente para mim. </font><font style="vertical-align: inherit;">Claro, você pode escolher uma estrutura diferente.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Baixar arquivos .wav</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Você pode baixá-los você mesmo ou usar a biblioteca. </font><font style="vertical-align: inherit;">Aqui está uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">implementação de código aberto do carregamento de arquivos .wav</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Eu sou louco, então eu mesmo faço:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-built_in">std</span>::<span class="hljs-keyword">int32_t</span> <span class="hljs-title">convert_to_int</span><span class="hljs-params">(<span class="hljs-keyword">char</span>* buffer, <span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> len)</span>
</span>{
    <span class="hljs-built_in">std</span>::<span class="hljs-keyword">int32_t</span> a = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">std</span>::endian::native == <span class="hljs-built_in">std</span>::endian::little)
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">memcpy</span>(&amp;a, buffer, len);
    <span class="hljs-keyword">else</span>
        <span class="hljs-keyword">for</span>(<span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; len; ++i)
            <span class="hljs-keyword">reinterpret_cast</span>&lt;<span class="hljs-keyword">char</span>*&gt;(&amp;a)[<span class="hljs-number">3</span> - i] = buffer[i];
    <span class="hljs-keyword">return</span> a;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">load_wav_file_header</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::ifstream&amp; file,
                          <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint8_t</span>&amp; channels,
                          <span class="hljs-built_in">std</span>::<span class="hljs-keyword">int32_t</span>&amp; sampleRate,
                          <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint8_t</span>&amp; bitsPerSample,
                          ALsizei&amp; size)</span>
</span>{
    <span class="hljs-keyword">char</span> buffer[<span class="hljs-number">4</span>];
    <span class="hljs-keyword">if</span>(!file.is_open())
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
<font></font>
    <span class="hljs-comment">// the RIFF</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read RIFF"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">strncmp</span>(buffer, <span class="hljs-string">"RIFF"</span>, <span class="hljs-number">4</span>) != <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: file is not a valid WAVE file (header doesn't begin with RIFF)"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// the size of the file</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read size of file"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// the WAVE</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read WAVE"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">strncmp</span>(buffer, <span class="hljs-string">"WAVE"</span>, <span class="hljs-number">4</span>) != <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: file is not a valid WAVE file (header doesn't contain WAVE)"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// "fmt/0"</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read fmt/0"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// this is always 16, the size of the fmt data chunk</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read the 16"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// PCM should be 1?</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">2</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read PCM"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// the number of channels</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">2</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read number of channels"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    channels = convert_to_int(buffer, <span class="hljs-number">2</span>);<font></font>
<font></font>
    <span class="hljs-comment">// sample rate</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read sample rate"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    sampleRate = convert_to_int(buffer, <span class="hljs-number">4</span>);<font></font>
<font></font>
    <span class="hljs-comment">// (sampleRate * bitsPerSample * channels) / 8</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read (sampleRate * bitsPerSample * channels) / 8"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// ?? dafaq</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">2</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read dafaq"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// bitsPerSample</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">2</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read bits per sample"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    bitsPerSample = convert_to_int(buffer, <span class="hljs-number">2</span>);<font></font>
<font></font>
    <span class="hljs-comment">// data chunk header "data"</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read data chunk header"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">strncmp</span>(buffer, <span class="hljs-string">"data"</span>, <span class="hljs-number">4</span>) != <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: file is not a valid WAVE file (doesn't have 'data' tag)"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// size of data</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read data size"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    size = convert_to_int(buffer, <span class="hljs-number">4</span>);<font></font>
<font></font>
    <span class="hljs-comment">/* cannot be at the end of file */</span>
    <span class="hljs-keyword">if</span>(file.eof())<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: reached EOF on the file"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(file.fail())<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: fail state set on the file"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">char</span>* <span class="hljs-title">load_wav</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; filename,
               <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint8_t</span>&amp; channels,
               <span class="hljs-built_in">std</span>::<span class="hljs-keyword">int32_t</span>&amp; sampleRate,
               <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint8_t</span>&amp; bitsPerSample,
               ALsizei&amp; size)</span>
</span>{
    <span class="hljs-function"><span class="hljs-built_in">std</span>::ifstream <span class="hljs-title">in</span><span class="hljs-params">(filename, <span class="hljs-built_in">std</span>::ios::binary)</span></span>;
    <span class="hljs-keyword">if</span>(!in.is_open())<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: Could not open \""</span> &lt;&lt; filename &lt;&lt; <span class="hljs-string">"\""</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(!load_wav_file_header(in, channels, sampleRate, bitsPerSample, size))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: Could not load wav header of \""</span> &lt;&lt; filename &lt;&lt; <span class="hljs-string">"\""</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">char</span>* data = <span class="hljs-keyword">new</span> <span class="hljs-keyword">char</span>[size];<font></font>
<font></font>
    in.read(data, size);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> data;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Não explicarei o código, porque isso não está inteiramente no assunto do nosso artigo; </font><font style="vertical-align: inherit;">mas é muito óbvio se você ler em paralelo com a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">especificação do arquivo WAV</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inicialização e Destruição</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro, precisamos inicializar o OpenAL e, como qualquer bom programador, finalizá-lo quando terminarmos de trabalhar com ele. </font><font style="vertical-align: inherit;">É usado durante a inicialização </font></font><code>ALCdevice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(observe que </font><i><font style="vertical-align: inherit;">não</font></i></font><code>ALC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é </font><font style="vertical-align: inherit;">), o que representa essencialmente algo no seu computador para reproduzir música de fundo e a utiliza </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">semelhante à escolha de uma placa gráfica. </font><font style="vertical-align: inherit;">no qual seu jogo OpenGL será renderizado. </font><font style="vertical-align: inherit;">semelhante ao contexto de renderização que você deseja criar (exclusivo para o sistema operacional) para o OpenGL.</font></font><i><font style="vertical-align: inherit;"></font></i> <code>AL</code><font style="vertical-align: inherit;"></font><code>ALCcontext</code><font style="vertical-align: inherit;"></font><br>
<br>
<code>ALCdevice</code><font style="vertical-align: inherit;"></font><code>ALCcontext</code><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alcdevice</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um dispositivo OpenAL é o que o som é transmitido, seja uma placa de som ou um chip, mas teoricamente pode haver muitas coisas diferentes. Semelhante a como a saída padrão </font></font><code>iostream</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pode ser uma impressora em vez de uma tela, um dispositivo pode ser um arquivo ou mesmo um fluxo de dados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, para jogos de programação, será um dispositivo de som e, geralmente, queremos que seja um dispositivo de saída de som padrão no sistema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para obter uma lista de dispositivos disponíveis no sistema, você pode solicitá-los com esta função:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">get_available_devices</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt;&amp; devicesVec, ALCdevice* device)</span>
</span>{
    <span class="hljs-keyword">const</span> ALCchar* devices;
    <span class="hljs-keyword">if</span>(!alcCall(alcGetString, devices, device, <span class="hljs-literal">nullptr</span>, ALC_DEVICE_SPECIFIER))
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
<font></font>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* ptr = devices;<font></font>
<font></font>
    devicesVec.clear();<font></font>
<font></font>
    <span class="hljs-keyword">do</span><font></font>
    {<font></font>
        devicesVec.push_back(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>(ptr));<font></font>
        ptr += devicesVec.back().size() + <span class="hljs-number">1</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">while</span>(*(ptr + <span class="hljs-number">1</span>) != <span class="hljs-string">'\0'</span>);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na verdade, é apenas um invólucro em torno de um invólucro em torno de uma chamada </font></font><code>alcGetString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. O valor de retorno é um ponteiro para uma lista de cadeias separadas por um valor </font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e terminadas com dois valores </font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Aqui, o invólucro simplesmente o transforma em um vetor conveniente para nós. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Felizmente, não precisamos fazer isso! No caso geral, como suspeito, a maioria dos jogos pode simplesmente emitir som para o dispositivo por padrão, seja ele qual for. Raramente vejo as opções para alterar o dispositivo de áudio através do qual você deseja emitir som. Portanto, para inicializar o dispositivo OpenAL, usamos uma chamada </font></font><code>alcOpenDevice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Essa chamada é um pouco diferente de tudo o mais, porque não especifica o estado de erro que pode ser obtido </font></font><code>alcGetError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font><font style="vertical-align: inherit;">por </font><font style="vertical-align: inherit;">isso, chamamos isso de uma função normal:</font></font><br>
<br>
<pre><code class="cpp hljs">ALCdevice* openALDevice = alcOpenDevice(<span class="hljs-literal">nullptr</span>);
<span class="hljs-keyword">if</span>(!openALDevice)<font></font>
{<font></font>
    <span class="hljs-comment">/* fail */</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se você listou os dispositivos como mostrado acima, e deseja que o usuário selecione um deles, será necessário transferir o nome para </font></font><code>alcOpenDevice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ele </font></font><code>nullptr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Enviar </font></font><code>nullptr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pedidos </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para abrir o dispositivo por padrão</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . O valor de retorno é o dispositivo correspondente ou </font></font><code>nullptr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se ocorrer um erro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dependendo se você completou a enumeração ou não, um erro pode parar o programa nas faixas. No device = No OpenAL; sem OpenAL = sem som; sem som = sem jogo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A última coisa que fazemos ao fechar um programa é finalizá-lo corretamente.</font></font><br>
<br>
<pre><code class="cpp hljs">ALCboolean closed;
<span class="hljs-keyword">if</span>(!alcCall(alcCloseDevice, closed, openALDevice, openALDevice))<font></font>
{<font></font>
    <span class="hljs-comment">/* do we care? */</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse estágio, se a conclusão não foi possível, isso não é mais importante para nós. Antes de fechar o dispositivo, devemos fechar todos os contextos criados; no entanto, na minha experiência, essa chamada também completa o contexto. Mas nós faremos isso direito. Se você concluir tudo antes de fazer uma chamada </font></font><code>alcCloseDevice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, não deverá haver erros e, por algum motivo, eles surgiram, não será possível fazer nada a respeito. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Você deve ter notado que as chamadas de </font></font><code>alcCall</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enviam duas cópias do dispositivo. Isso aconteceu por causa de como a função de modelo funciona - uma é necessária para verificação de erros e a segunda é usada como parâmetro de função.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Teoricamente, posso melhorar a função de modelo para que ele passe o primeiro parâmetro para verificação de erros e ainda o envie para a função; </font><font style="vertical-align: inherit;">mas tenho preguiça de fazê-lo. </font><font style="vertical-align: inherit;">Vou deixar isso como sua lição de casa.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nosso contexto da ALC</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A segunda parte da inicialização é o contexto. </font><font style="vertical-align: inherit;">Como antes, é semelhante ao contexto de renderização do OpenGL. </font><font style="vertical-align: inherit;">Pode haver vários contextos em um programa e podemos alternar entre eles, mas não precisaremos disso. </font><font style="vertical-align: inherit;">Cada contexto tem seu próprio </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ouvinte</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fontes</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , e eles não podem ser transmitidos entre contextos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Talvez isso seja útil em software de processamento de som. </font><font style="vertical-align: inherit;">No entanto, para jogos em 99,9% dos casos, apenas um contexto é suficiente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Criar um novo contexto é muito simples:</font></font><br>
<br>
<pre><code class="cpp hljs">ALCcontext* openALContext;
<span class="hljs-keyword">if</span>(!alcCall(alcCreateContext, openALContext, openALDevice, openALDevice, <span class="hljs-literal">nullptr</span>) || !openALContext)<font></font>
{<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: Could not create audio context"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
    <span class="hljs-comment">/* probably exit program */</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Precisamos nos comunicar para o </font></font><code>ALCdevice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que queremos criar um contexto; </font><font style="vertical-align: inherit;">também podemos passar uma lista opcional de chaves e valores </font></font><code>ALCint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que </font><font style="vertical-align: inherit;">terminam com zero </font><font style="vertical-align: inherit;">, que são atributos com os quais o contexto deve ser criado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Honestamente, eu nem sei em que situação a passagem de atributos é útil. </font><font style="vertical-align: inherit;">Seu jogo será executado em um computador comum com os recursos habituais de som. </font><font style="vertical-align: inherit;">Os atributos têm valores padrão, dependendo do computador, portanto isso não é particularmente importante. </font><font style="vertical-align: inherit;">Mas caso você ainda precise:</font></font><br>
<br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nome do Atributo</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descrição</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ALC_FREQUENCY</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Frequência de mistura no buffer de saída, medida em Hz</font></font></td>
</tr>
<tr>
<td><code>ALC_REFRESH</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intervalos de atualização, medidos em Hz</font></font></td>
</tr>
<tr>
<td><code>ALC_SYNC</code></td>
<td><code>0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indicar se deve ser um contexto síncrono ou assíncrono</font></font></td>
</tr>
<tr>
<td><code>ALC_MONO_SOURCES</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um valor que ajuda a dizer quantas fontes você usará que exigem a capacidade de processar dados de áudio mono. </font><font style="vertical-align: inherit;">Não limita a quantidade máxima, apenas permite que você seja mais eficaz quando você sabe disso com antecedência.</font></font></td>
</tr>
<tr>
<td><code>ALC_STEREO_SOURCES</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O mesmo, mas para dados estéreo.</font></font></td>
</tr>
</tbody>
</table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se você receber erros, provavelmente isso ocorre porque os atributos que você deseja são impossíveis ou você não pode criar outro contexto para o dispositivo suportado; </font><font style="vertical-align: inherit;">isso resultará em um erro </font></font><code>ALC_INVALID_VALUE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Se você passar um dispositivo inválido, receberá um erro </font></font><code>ALC_INVALID_DEVICE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mas, é claro, já estamos verificando esse erro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Criar contexto não é suficiente. </font><font style="vertical-align: inherit;">Ainda precisamos atualizá-lo - parece um contexto de renderização do Windows OpenGL, certo? </font><font style="vertical-align: inherit;">É o mesmo.</font></font><br>
<br>
<pre><code class="cpp hljs">ALCboolean contextMadeCurrent = <span class="hljs-literal">false</span>;
<span class="hljs-keyword">if</span>(!alcCall(alcMakeContextCurrent, contextMadeCurrent, openALDevice, openALContext)<font></font>
   || contextMadeCurrent != ALC_TRUE)<font></font>
{<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: Could not make audio context current"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
    <span class="hljs-comment">/* probably exit or give up on having sound */</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
É necessário tornar o contexto atual para quaisquer operações adicionais com o contexto (ou com fontes e ouvintes nele). </font><font style="vertical-align: inherit;">A operação retornará </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, o único valor de erro possível transmitido </font></font><code>alcGetError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é aquele </font></font><code>ALC_INVALID_CONTEXT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que é claro no nome. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finalizando com o contexto, ou seja, </font><font style="vertical-align: inherit;">ao sair do programa, é necessário que o contexto não seja mais atual e destrua-o.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">if</span>(!alcCall(alcMakeContextCurrent, contextMadeCurrent, openALDevice, <span class="hljs-literal">nullptr</span>))<font></font>
{<font></font>
    <span class="hljs-comment">/* what can you do? */</span><font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">if</span>(!alcCall(alcDestroyContext, openALDevice, openALContext))<font></font>
{<font></font>
    <span class="hljs-comment">/* not much you can do */</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O único erro possível de </font></font><code>alcDestroyContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é o mesmo de </font></font><code>alcMakeContextCurrent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><code>ALC_INVALID_CONTEXT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">se você fizer tudo certo, não conseguirá, mas se fizer, nada poderá ser feito.</font></font><br>
<br>
<blockquote><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por que verificar erros com os quais nada pode ser feito? </font></font></strong><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Porque quero que as mensagens sobre eles apareçam pelo menos no fluxo de erros, o que, para nós, </font></font><code>alcCall</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">suponha que nunca nos dê erros, mas será útil saber que esse erro ocorre no computador de outra pessoa. </font><font style="vertical-align: inherit;">Graças a isso, podemos estudar o problema e, possivelmente, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reportar um bug aos desenvolvedores do OpenAL Soft</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></blockquote><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toque nosso primeiro som</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bem, chega de tudo isso, vamos tocar o som. </font><font style="vertical-align: inherit;">Para começar, obviamente precisamos de um arquivo de som. </font><font style="vertical-align: inherit;">Por exemplo, este, de um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jogo que eu terminarei</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div class="oembed"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://indiegamedev.net/wp-content/uploads/2020/02/iamtheprotectorofthissystem.wav</font></font></a></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eu sou o protetor deste sistema!</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Então, abra o IDE e use o seguinte código. Lembre-se de conectar o OpenAL Soft e adicionar o código de upload do arquivo e o código de verificação de erros mostrado acima.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{<font></font>
    ALCdevice* openALDevice = alcOpenDevice(<span class="hljs-literal">nullptr</span>);
    <span class="hljs-keyword">if</span>(!openALDevice)
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
<font></font>
    ALCcontext* openALContext;<font></font>
    <span class="hljs-keyword">if</span>(!alcCall(alcCreateContext, openALContext, openALDevice, openALDevice, <span class="hljs-literal">nullptr</span>) || !openALContext)<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: Could not create audio context"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
    }<font></font>
    ALCboolean contextMadeCurrent = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">if</span>(!alcCall(alcMakeContextCurrent, contextMadeCurrent, openALDevice, openALContext)<font></font>
       || contextMadeCurrent != ALC_TRUE)<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: Could not make audio context current"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint8_t</span> channels;
    <span class="hljs-built_in">std</span>::<span class="hljs-keyword">int32_t</span> sampleRate;
    <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint8_t</span> bitsPerSample;
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">char</span>&gt; soundData;
    <span class="hljs-keyword">if</span>(!load_wav(<span class="hljs-string">"iamtheprotectorofthissystem.wav"</span>, channels, sampleRate, bitsPerSample, soundData))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: Could not load wav"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
    }<font></font>
<font></font>
    ALuint buffer;<font></font>
    alCall(alGenBuffers, <span class="hljs-number">1</span>, &amp;buffer);<font></font>
<font></font>
    ALenum format;<font></font>
    <span class="hljs-keyword">if</span>(channels == <span class="hljs-number">1</span> &amp;&amp; bitsPerSample == <span class="hljs-number">8</span>)<font></font>
        format = AL_FORMAT_MONO8;<font></font>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(channels == <span class="hljs-number">1</span> &amp;&amp; bitsPerSample == <span class="hljs-number">16</span>)<font></font>
        format = AL_FORMAT_MONO16;<font></font>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(channels == <span class="hljs-number">2</span> &amp;&amp; bitsPerSample == <span class="hljs-number">8</span>)<font></font>
        format = AL_FORMAT_STEREO8;<font></font>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(channels == <span class="hljs-number">2</span> &amp;&amp; bitsPerSample == <span class="hljs-number">16</span>)<font></font>
        format = AL_FORMAT_STEREO16;<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span>
            &lt;&lt; <span class="hljs-string">"ERROR: unrecognised wave format: "</span>
            &lt;&lt; channels &lt;&lt; <span class="hljs-string">" channels, "</span>
            &lt;&lt; bitsPerSample &lt;&lt; <span class="hljs-string">" bps"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
    }<font></font>
<font></font>
    alCall(alBufferData, buffer, format, soundData.data(), soundData.size(), sampleRate);<font></font>
    soundData.clear(); <span class="hljs-comment">// erase the sound in RAM</span><font></font>
<font></font>
    ALuint source;<font></font>
    alCall(alGenSources, <span class="hljs-number">1</span>, &amp;source);<font></font>
    alCall(alSourcef, source, AL_PITCH, <span class="hljs-number">1</span>);<font></font>
    alCall(alSourcef, source, AL_GAIN, <span class="hljs-number">1.0f</span>);<font></font>
    alCall(alSource3f, source, AL_POSITION, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<font></font>
    alCall(alSource3f, source, AL_VELOCITY, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<font></font>
    alCall(alSourcei, source, AL_LOOPING, AL_FALSE);<font></font>
    alCall(alSourcei, source, AL_BUFFER, buffer);<font></font>
<font></font>
    alCall(alSourcePlay, source);<font></font>
<font></font>
    ALint state = AL_PLAYING;<font></font>
<font></font>
    <span class="hljs-keyword">while</span>(state == AL_PLAYING)<font></font>
    {<font></font>
        alCall(alGetSourcei, source, AL_SOURCE_STATE, &amp;state);<font></font>
    }<font></font>
<font></font>
    alCall(alDeleteSources, <span class="hljs-number">1</span>, &amp;source);<font></font>
    alCall(alDeleteBuffers, <span class="hljs-number">1</span>, &amp;buffer);<font></font>
<font></font>
    alcCall(alcMakeContextCurrent, contextMadeCurrent, openALDevice, <span class="hljs-literal">nullptr</span>);<font></font>
    alcCall(alcDestroyContext, openALDevice, openALContext);<font></font>
<font></font>
    ALCboolean closed;<font></font>
    alcCall(alcCloseDevice, closed, openALDevice, openALDevice);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Compilando! </font><font style="vertical-align: inherit;">Nós compomos! </font><font style="vertical-align: inherit;">Lançamento! </font></font><em><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eu sou o prrrootetor deste sistema</font></font></strong></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Se você não ouvir o som, verifique tudo novamente. </font><font style="vertical-align: inherit;">Se algo estiver escrito na janela do console, essa deve ser a saída padrão do fluxo de erros e isso é importante. </font><font style="vertical-align: inherit;">Nossas funções de relatório de erros devem nos dizer a linha do código fonte que gerou o erro. </font><font style="vertical-align: inherit;">Se você encontrar um </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
erro, leia o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Guia</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">Programador</font></a><font style="vertical-align: inherit;"> e a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">especificação</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para entender as condições sob as quais esse erro pode ser gerado por uma função. </font><font style="vertical-align: inherit;">Isso irá ajudá-lo a descobrir. </font><font style="vertical-align: inherit;">Se não der certo, deixe um comentário no artigo original e tentarei ajudar.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Download dos dados do RIFF WAVE</font></font></h3><br>
<pre><code class="cpp hljs"><span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint8_t</span> channels;
<span class="hljs-built_in">std</span>::<span class="hljs-keyword">int32_t</span> sampleRate;
<span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint8_t</span> bitsPerSample;
<span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">char</span>&gt; soundData;
<span class="hljs-keyword">if</span>(!load_wav(<span class="hljs-string">"iamtheprotectorofthissystem.wav"</span>, channels, sampleRate, bitsPerSample, soundData))<font></font>
{<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: Could not load wav"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso se refere ao código de inicialização do wave. </font><font style="vertical-align: inherit;">O importante é que recebamos dados, como um ponteiro, ou coletados em um vetor: o número de canais, a taxa de amostragem e o número de bits por amostra.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Geração de buffer</font></font></h3><br>
<pre><code class="cpp hljs">ALuint buffer;<font></font>
alCall(alGenBuffers, <span class="hljs-number">1</span>, &amp;buffer);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Provavelmente lhe parece familiar se você já gerou buffers de dados de textura no OpenGL. Em essência, geramos um buffer e fingimos que ele existirá apenas na placa de som. De fato, provavelmente será armazenado na RAM comum, mas a especificação OpenAL abstrai todas essas operações. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, o valor </font></font><code>ALuint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é um </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">identificador para</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nosso buffer. Lembre-se de que o </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é essencialmente um som na memória da placa de som. Não temos mais </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">acesso direto</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a esses dados, pois os retiramos do programa (da RAM comum) e os movemos para uma placa de som / chip, etc. O OpenGL funciona de maneira semelhante, movendo dados de textura da RAM para a VRAM. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">descritor</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gera </font></font><code>alGenBuffers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ele tem alguns possíveis valores de erro, o mais importante dos quais é </font></font><code>AL_OUT_OF_MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, o que significa que não podemos mais adicionar dados de som à placa de som. </font><font style="vertical-align: inherit;">Você não receberá </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esse</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erro se, por exemplo, usar um único buffer, mas precisará considerá-lo se estiver </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">criando um mecanismo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Determinar o formato dos dados de áudio</font></font></h3><br>
<pre><code class="cpp hljs">ALenum format;<font></font>
<font></font>
<span class="hljs-keyword">if</span>(channels == <span class="hljs-number">1</span> &amp;&amp; bitsPerSample == <span class="hljs-number">8</span>)<font></font>
    format = AL_FORMAT_MONO8;<font></font>
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(channels == <span class="hljs-number">1</span> &amp;&amp; bitsPerSample == <span class="hljs-number">16</span>)<font></font>
    format = AL_FORMAT_MONO16;<font></font>
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(channels == <span class="hljs-number">2</span> &amp;&amp; bitsPerSample == <span class="hljs-number">8</span>)<font></font>
    format = AL_FORMAT_STEREO8;<font></font>
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(channels == <span class="hljs-number">2</span> &amp;&amp; bitsPerSample == <span class="hljs-number">16</span>)<font></font>
    format = AL_FORMAT_STEREO16;<font></font>
<span class="hljs-keyword">else</span><font></font>
{<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span>
        &lt;&lt; <span class="hljs-string">"ERROR: unrecognised wave format: "</span>
        &lt;&lt; channels &lt;&lt; <span class="hljs-string">" channels, "</span>
        &lt;&lt; bitsPerSample &lt;&lt; <span class="hljs-string">" bps"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os dados de som funcionam assim: existem vários </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">canais</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e há um tamanho de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bit por amostra</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Os dados consistem em muitas </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">amostras</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para determinar o número de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">amostras</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nos dados de áudio, fazemos o seguinte:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-built_in">std</span>::<span class="hljs-keyword">int_fast32_t</span> numberOfSamples = dataSize / (numberOfChannels * (bitsPerSample / <span class="hljs-number">8</span>));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que pode ser convenientemente convertido para calcular a </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">duração dos</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dados </font><em><font style="vertical-align: inherit;">de</font></em><font style="vertical-align: inherit;"> áudio:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> duration = numberOfSamples / sampleRate;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas, embora não precisemos saber </font></font><code>numberOfSamples</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nem </font></font><code>duration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, no entanto, é importante saber como todas essas informações são usadas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voltar para </font></font><code>format</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- precisamos informar ao OpenAL o formato dos dados de áudio. Isso parece óbvio, certo? Semelhante à forma como preenchemos o buffer de textura do OpenGL, dizendo que os dados estão em uma sequência BGRA e são compostos por valores de 8 bits, precisamos fazer o mesmo no OpenAL. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para dizer ao OpenAL como interpretar os dados apontados pelo ponteiro que passaremos adiante, precisamos definir o formato dos dados. Sob o </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">formato</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ele é entendido pelo OpenAL. Existem apenas quatro significados possíveis. Existem dois valores possíveis para o número de canais: um para mono e dois para estéreo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Além do número de canais, temos o número de bits por amostra. </font><font style="vertical-align: inherit;">É igual a ou </font></font><code>8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ou </font></font><code>16</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, e é essencialmente a qualidade do som. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, usando os valores dos canais e bits por amostra, sobre os quais a função de carga de onda nos informou, podemos determinar qual deles </font></font><code>ALenum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usar para o parâmetro futuro </font></font><code>format</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enchimento do tampão</font></font></h3><br>
<pre><code class="cpp hljs">alCall(alBufferData, buffer, format, soundData.data(), soundData.size(), sampleRate);<font></font>
soundData.clear(); <span class="hljs-comment">// erase the sound in RAM</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com isso, tudo deve ser simples. </font><font style="vertical-align: inherit;">Carregamos no OpenAL Buffer, para o qual o </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">descritor</font></font></em> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aponta </font></font><code>buffer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">os dados apontados por ptr </font></font><code>soundData.data()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no tamanho do </font></font><code>size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">especificado </font></font><code>sampleRate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Nós também irá informar OpenAL o formato desses dados através do parâmetro </font></font><code>format</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No final, simplesmente excluímos os dados que o carregador de ondas recebeu. </font><font style="vertical-align: inherit;">Por quê? </font><font style="vertical-align: inherit;">Porque nós já os copiamos para a placa de som. </font><font style="vertical-align: inherit;">Não precisamos armazená-los em dois lugares e gastar recursos preciosos. </font><font style="vertical-align: inherit;">Se a placa de som perder dados, basta fazer o download novamente do disco e não precisaremos copiá-la para a CPU ou outra pessoa.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuração de origem</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lembre-se de que o OpenAL é essencialmente um </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ouvinte</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que ouve sons emitidos por uma ou mais </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fontes</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Bem, agora é a hora de criar uma fonte de som.</font></font><br>
<br>
<pre><code class="cpp hljs">ALuint source;<font></font>
alCall(alGenSources, <span class="hljs-number">1</span>, &amp;source);<font></font>
alCall(alSourcef, source, AL_PITCH, <span class="hljs-number">1</span>);<font></font>
alCall(alSourcef, source, AL_GAIN, <span class="hljs-number">1.0f</span>);<font></font>
alCall(alSource3f, source, AL_POSITION, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<font></font>
alCall(alSource3f, source, AL_VELOCITY, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<font></font>
alCall(alSourcei, source, AL_LOOPING, AL_FALSE);<font></font>
alCall(alSourcei, source, AL_BUFFER, buffer);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Honestamente, não é necessário definir alguns desses parâmetros, porque os valores padrão são bastante adequados para nós. Mas isso nos mostra alguns aspectos com os quais você pode experimentar e ver o que eles fazem (você pode até agir astuciosamente e alterá-los ao longo do tempo). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro, geramos código-fonte - lembre-se, isso é novamente um </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">identificador</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para algo dentro da API OpenAL. Nós definimos o tom (tom) para que não mude, o ganho (volume) é igual ao valor original dos dados de áudio, a posição e a velocidade são redefinidas; nós </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">não repetir o</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> som, porque senão o nosso programa nunca vai acabar, e indicar o buffer.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lembre-se de que fontes diferentes podem usar o mesmo buffer. </font><font style="vertical-align: inherit;">Por exemplo, inimigos atirando em um jogador de lugares diferentes podem tocar o mesmo som de tiro, por isso não precisamos de muitas cópias dos dados do som, mas apenas de alguns lugares no espaço 3D a partir dos quais o som é produzido.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tocar música</font></font></h3><br>
<pre><code class="cpp hljs">alCall(alSourcePlay, source);<font></font>
<font></font>
ALint state = AL_PLAYING;<font></font>
<font></font>
<span class="hljs-keyword">while</span>(state == AL_PLAYING)<font></font>
{<font></font>
    alCall(alGetSourcei, source, AL_SOURCE_STATE, &amp;state);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro, precisamos começar a reproduzir a fonte. </font><font style="vertical-align: inherit;">Basta ligar </font></font><code>alSourcePlay</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, criamos um valor para armazenar o estado atual da </font></font><code>AL_SOURCE_STATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fonte e atualizá-lo infinitamente. </font><font style="vertical-align: inherit;">Quando não é mais igual, </font></font><code>AL_PLAYING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">podemos continuar. </font><font style="vertical-align: inherit;">Você pode alterar o estado para </font></font><code>AL_STOPPED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quando terminar de emitir som do buffer (ou quando ocorrer um erro). </font><font style="vertical-align: inherit;">Se você definir o valor do loop </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, o som será reproduzido para sempre. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Então podemos mudar o buffer da fonte e tocar outro som. </font><font style="vertical-align: inherit;">Ou reproduza o mesmo som, etc. </font><font style="vertical-align: inherit;">Basta definir o buffer, usá- </font></font><code>alSourcePlay</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lo e </font></font><code>alSourceStop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font><font style="vertical-align: inherit;">talvez </font><font style="vertical-align: inherit;">, se necessário. </font><font style="vertical-align: inherit;">Nos seguintes artigos, consideraremos isso com mais detalhes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Limpeza</font></font></h3><br>
<pre><code class="cpp hljs">alCall(alDeleteSources, <span class="hljs-number">1</span>, &amp;source);<font></font>
alCall(alDeleteBuffers, <span class="hljs-number">1</span>, &amp;buffer);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como simplesmente reproduzimos os dados de áudio uma vez e saímos, excluiremos a fonte e o buffer criados anteriormente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O restante do código é compreensível sem explicação.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para onde ir a seguir?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sabendo tudo descrito neste artigo, você já pode criar um pequeno jogo! </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tente criar Pong</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">algum outro jogo clássico</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , para eles não é necessário mais. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas lembre-se! </font><font style="vertical-align: inherit;">Esses buffers são adequados apenas para sons curtos, provavelmente por alguns segundos. </font><font style="vertical-align: inherit;">Se você precisar de música ou dublagem, precisará transmitir áudio para o OpenAL. </font><font style="vertical-align: inherit;">Falaremos sobre isso em uma das seguintes partes de uma série de tutoriais.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt488730/index.html">Novos padrões russos para a Internet das coisas, fabricação inteligente e cidade inteligente</a></li>
<li><a href="../pt488732/index.html">Talented Mr. Simon: Como habilidades únicas e impressão 3D podem mudar o processo de produção</a></li>
<li><a href="../pt488736/index.html">O trabalho remoto está ganhando força</a></li>
<li><a href="../pt488740/index.html">Guia de tags HTML personalizadas para o Gerenciador de tags do Google por Simo Ahava</a></li>
<li><a href="../pt488742/index.html">Veja a arquitetura? E eu não vejo, mas ela é</a></li>
<li><a href="../pt488748/index.html">Crie um aplicativo Todo usando o Django. Parte 1</a></li>
<li><a href="../pt488750/index.html">Passeio dos Dinossauros: Dois Grandes Computadores do Século XX</a></li>
<li><a href="../pt488752/index.html">Golang + Phaser3 = MMORPG - Criamos a base para a geração infinita do mundo</a></li>
<li><a href="../pt488754/index.html">Tudo de uma vez: verificação automática do tamanho do pacote</a></li>
<li><a href="../pt488756/index.html">Como trabalhar com a API do Google Sheets (API do Google Sheets v4) no R usando o novo pacote googlesheets4</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>