<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤴🏿 👂🏿 👨‍🎨 “Let's use Kubernetes!” You now have 8 problems 🔪 👨🏿‍🏫 ⛄️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you use Docker, the next logical step seems to be switching to Kubernetes, it's K8s, right? Well, suppose. However, solutions designed for 500 soft...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>“Let's use Kubernetes!” You now have 8 problems</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/it-grad/blog/493142/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you use Docker, the next logical step seems to be switching to Kubernetes, it's K8s, right? </font><font style="vertical-align: inherit;">Well, suppose. </font><font style="vertical-align: inherit;">However, solutions designed for 500 software engineers simultaneously developing a single application are quite different from solutions for 50 people. </font><font style="vertical-align: inherit;">And the solution for a team of 5 programmers is another story altogether. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you work in a small team, Kubernetes is most likely not for you. </font><font style="vertical-align: inherit;">It will bring you a lot of pain in exchange for extremely modest benefits. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's see why this can happen.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Everyone likes the “moving parts”</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetes is moving and changing a lot: concepts, subsystems, processes, machines, code ... And all this means a lot of difficulties.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Several cars</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetes is a distributed system: it has a host machine that controls the rest, workers. </font><font style="vertical-align: inherit;">Each machine performs work in containers. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, we are already talking about at least two physical or virtual machines, which are necessary only to make it work. </font><font style="vertical-align: inherit;">But in fact you get ... just one car. </font><font style="vertical-align: inherit;">If you are going to scale (that's where the dog is buried!), You will need three, four, or maybe as many as seventeen virtual machines.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Very, very much code</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The Kubernetes code base at the beginning of March 2020 includes more than 580,000 lines of code on Go. And this is just clean code, excluding comments, blank lines, and vendor packages. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The 2019 security review</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> describes the code base as follows: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
“The Kubernetes code base has significant room for improvement. It is large and complex, contains large sections of code with minimal documentation and a huge number of dependencies, including systems that are not part of Kubernetes. Also in the code base there are many cases of re-implementation of logic that could be centralized in supporting libraries, which would reduce complexity, simplify corrections and reduce document load in various areas of the code base. ”</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To be honest, the same can be said about many other large projects, but all this code should function correctly if you do not want your application to fail.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Architectural, operational, configuration, and conceptual complexity</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetes is a comprehensive system with many different services, systems and more. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Before you can launch your only application, you will have to provide the following, greatly simplified architecture (the original image is taken from the Kubernetes documentation): </font></font><br>
<br>
<img src="https://habrastorage.org/webt/w2/rx/h8/w2rxh88tfa7n3dmfhvyrahxjd0k.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The K8s concept documentation includes many purely “educational” things, such as the following snippet:</font></font><br>
<blockquote>In Kubernetes, an EndpointSlice contains references to a set of network endpoints. The EndpointSlice controller automatically creates EndpointSlices for a Kubernetes Service when a selector is specified. These EndpointSlices will include references to any Pods that match the Service selector. EndpointSlices group network endpoints together by unique Service and Port combinations.<br>
By default, EndpointSlices managed by the EndpointSlice controller will have no more than 100 endpoints each. Below this scale, EndpointSlices should map 1:1 with Endpoints and Services and have similar performance.</blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Actually, I understand what this is about, but pay attention to how many concepts you need to learn: EndpointSlice, Service, selector, Pod, Endpoint. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And - yes, most of the time you will not use all these features. Therefore, most of the time you will not need Kubernetes at all. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here is another random snippet:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">By default, traffic sent to a ClusterIP or NodePort Service may be routed to any backend address for the Service. </font><font style="vertical-align: inherit;">Since Kubernetes 1.7 it has been possible to route “external” traffic to the Pods running on the Node that received the traffic, but this is not supported for ClusterIP Services, and more complex topologies - such as routing zonally - have not been possible. </font><font style="vertical-align: inherit;">The Service Topology feature resolves this by allowing the Service creator to define a policy for routing traffic based upon the Node labels for the originating and destination Nodes.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here's what Security review says about this:</font></font><br>
<blockquote>Kubernetes —   ,    .   ,     Kubernetes —  ,       ,    ,     .</blockquote><br>
<h3>  </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The more you get at Kubernetes, the harder the normal development process becomes: you need all these concepts (Pod, Deployment, Service, etc.) just to make your code work. Thus, you need to promote a full-fledged K8s system, even just for testing through a virtual machine or nested Docker containers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And, since your application becomes more difficult to run locally, the development is complicated by many options for solving this problem, from a bench environment to proxying a local process to a cluster (I wrote </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this tool a</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> couple of years ago </font><font style="vertical-align: inherit;">) and proxying a remote process to a local machine ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can choose any option, but none of them will be perfect. The easiest way to not use Kubernetes at all.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microservices (this is a bad idea)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A secondary problem is that since your system allows you to run many services, you have to write these many services. </font><font style="vertical-align: inherit;">Bad idea. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Distributed application is hard to write quality. </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In fact</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , the more moving parts, the more these problems interfere with the work. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Distributed applications are hard to debug. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You will need a completely new type of debugging and logging tools, which will still give you less than the logs of a monolithic application.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Microservices are one of the scaling techniques in organizations: when you have 500 developers who serve one productive website, it makes sense to come to terms with the cost of a large-scale distributed system if it allows development teams to work independently. </font><font style="vertical-align: inherit;">Thus, each team of 5 people receives a single microservice, and pretends that all other microservices are external services that you should not trust. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If your whole team consists of 5 people, you have 20 microservices and force majeure circumstances do not force you to create a distributed system, then somewhere you miscalculated. </font><font style="vertical-align: inherit;">Instead of 5 people per 1 microservice, as in large companies, you get 0.25 people. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isn't Kubernetes useful at all?</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scaling</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetes might come in handy if you need serious scalability. </font><font style="vertical-align: inherit;">However, let's see what alternatives you have:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can purchase VMs in the cloud, and they will have up to 416 virtual CPUs and 8 TB of RAM, that is, completely unflattering power. </font><font style="vertical-align: inherit;">It will cost you a pretty penny, but it will be extremely simple to do.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Many simple web applications can be scaled in a fairly easy way with services such as Heroku.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is assumed, of course, that an increase in the number of working VMs will also play into your hands:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Most applications do not require significant scaling, they will have enough high-quality optimization.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The bottleneck for scaling most web applications is databases, not web workers</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reliability</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The more moving parts, the greater the potential for an error to occur. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetes capabilities, sharpened by increased reliability (health checks, rolling deploys), in many cases can be already built-in or implemented much easier. For example, nginx can do health checks on worker processes, and you can also use </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docker-autoheal</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or something similar to automatically restart these processes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you are particularly concerned about downtime, the first thought that will visit you should not be “how do I reduce downtime when deploying from 1 second to 1 millisecond), but it should be“ how do I make sure that </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">changes to the database schema allow rollback</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> if I somewhere somewhere? ”</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And if you need reliable web workers without a single machine as a point of failure, there are many ways to implement this without Kubernetes. </font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Best practics?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In fact, no Best Practices exist in nature. </font><font style="vertical-align: inherit;">There are only best practices for each specific situation. </font><font style="vertical-align: inherit;">Therefore, if something is in trend and is popular, this does not mean at all that it is the right choice for you specifically. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In some cases, Kubernetes is the best option. </font><font style="vertical-align: inherit;">The rest is a waste of time. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unless you feel the urgent need for all these complexities, you have a wide selection of tools that will solve your problems: Docker Compose for one machine, Hashicorp's </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nomad</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for orchestration, Heroku and similar systems for scaling, and something like </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shakemake</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for computing pipelines.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Afterword from the Editor</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a cloud provider, we regularly encounter a wide variety of clients, from small startups to large organizations with complex business processes and related infrastructure requests. </font><font style="vertical-align: inherit;">Regardless of how good the technology is, there will always be precedents in which its application will result in unnecessary difficulties. </font><font style="vertical-align: inherit;">You should always proceed from the situation and carefully weigh the pros and cons of the available options. </font><font style="vertical-align: inherit;">The author of the article has somewhat thickened his colors, but his message is quite clear: sometimes, in order to make the right decision, it is worth turning away from trends and unbiasedly evaluate your project. </font><font style="vertical-align: inherit;">This will save the developers strength, and the use of company resources will make it more appropriate.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en493130/index.html">Почему не стоит бояться коронавируса: мифы и почти правда о COVID-2019</a></li>
<li><a href="../en493132/index.html">Around data.table</a></li>
<li><a href="../en493136/index.html">FAST VP in Unity Storage: How It Works</a></li>
<li><a href="../en493138/index.html">Talk to me: what voice bots can do today</a></li>
<li><a href="../en493140/index.html">The Adventures of Cipollino: Quarantine IT Quest from Flant</a></li>
<li><a href="../en493146/index.html">Exciting side projects that you can do today</a></li>
<li><a href="../en493150/index.html">"Remote" with a Cisco router</a></li>
<li><a href="../en493152/index.html">Neural networks and Process Mining: trying to make friends</a></li>
<li><a href="../en493158/index.html">Loghouse 0.3 - the long-awaited update of our logging system in Kubernetes</a></li>
<li><a href="../en493160/index.html">How we improved Smart Search on hh.ru in 2019: infographics</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>