<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº‚Äç‚öñÔ∏è üëàüèæ üîé ESP-NOW is an alternative communication protocol for ESP8266 and ESP32. Basic concepts üôÖüèΩ üë©üèΩ‚Äçüíº üîª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ESP-NOW is a simplified WiFi protocol for transferring short packets between pairs of paired devices, developed and released by Espressif in 2016.07 f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ESP-NOW is an alternative communication protocol for ESP8266 and ESP32. Basic concepts</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/502260/"><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESP-NOW is a simplified WiFi protocol for transferring short packets between pairs of paired devices, developed and released by </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Espressif</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in 2016.07 for the ESP8266 and ESP32 microcontrollers. </font><font style="vertical-align: inherit;">At the same time, additional procedures related to WiFi protocol support are not used, which speeds up the process of exchanging packets. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESP-NOW can be used on the Internet of Things to control intelligent light sources, relays, sockets, other remote control devices, receive information from sensors and other applications.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP-NOW supports the following features</font></font></h4><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encrypted and unencrypted communication between paired devices.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mixed encrypted and unencrypted communication between paired devices. </font></font><br>
 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transfer up to 250 bytes of useful information.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setting up a callback function to inform the application layer, in particular, about the success or failure of the transmission.</font></font></li>
</ul><br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP-NOW also has the following features and limitations.</font></font></h4><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transmission speed - no more than 1 Mbps at a frequency of 2.4 GHz, i.e. </font><font style="vertical-align: inherit;">ESP-NOW operates on the same frequency and channels as your WiFi router.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WiFi protocol not used</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Similar to the low-power protocol used in a 2.4 GHz wireless mouse.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Only initial pairing is required.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After pairing, the connection does not break.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Broadcast is not supported - only multiple distribution to paired device pairs.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A maximum of 20 pairs, including encrypted ones, are supported on one device, including encrypted pairs.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A maximum of 10 encrypted pairs are supported in Station mode.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maximum 6 in SoftAP or SoftAP + Station mode.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Multicast encryption is not supported.</font></font></li>
</ul><br>
<u><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Safety</font></font></h2></u><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESP-NOW adopts the IEEE802.11 Action Vendor frame technology with the IE function developed by Espressif and CCMP encryption technology, providing a secure, connection-free communication solution. </font><font style="vertical-align: inherit;">A Wi-Fi device supports a primary master key (PMK) and multiple local master keys (LMK)</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PMK is</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> used to encrypt LMK using the AES-128 algorithm.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The LMK</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> paired device is used to encrypt user information using CCMP. </font><font style="vertical-align: inherit;">The maximum number of different LMKs is 6. If no LMK is set for the paired device, user data will not be encrypted.</font></font></li>
</ul><br>
<u><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A basic level of</font></font></h2></u><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At the lower level of the ESP_NOW protocol, a linked list is maintained containing information about the local device and the paired device, including MAC addresses and keys. </font><font style="vertical-align: inherit;">ESP-NOW also stores frequently used data for the application layer to avoid the overhead of reprocessing the linked list. </font><font style="vertical-align: inherit;">Information about devices is used to send and receive data and includes </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Information about the local device:</font></font></u> <br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PMK</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 16 bytes - the main master key that is used to encrypt the key on the attached device (KOK in the API) ESP_NOW supports PMK by default, so no configuration is required. </font><font style="vertical-align: inherit;">If necessary, you can verify that the PMK value matches the local device.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mode</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 1 byte - the local device mode that defines the transmitting WiFi interface (SoftAP or STA) ESP-NOW. </font><font style="vertical-align: inherit;">The paired device mode does not affect any function, but only saves mode information for the application layer. </font><font style="vertical-align: inherit;">In STA WiFi mode, only Station is applicable and SoftAP WiFi is only SoftAP.</font></font><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Local device operation modes ESP_NOW</font></font></b>
                        <div class="spoiler_text"><blockquote><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th></th>
<th> WiFi</th>
</tr>
<tr>
<td><b>IDLE</b></td>
<td> </td>
<td>   </td>
</tr>
<tr>
<td><b>CONTROLLER</b></td>
<td></td>
<td>STA</td>
</tr>
<tr>
<td><b>SLAVE</b></td>
<td></td>
<td>SoftAP‚Ä®</td>
</tr>
<tr>
<td><b>COMBO</b></td>
<td>&amp;</td>
<td>SoftAP</td>
</tr>
</tbody></table></div></blockquote><br>
</div>
                    </div></li>
</ul><br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paired device</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> information (including frequently used information and other user information):</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LMK</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 16 bytes - a local master key that is used to encrypt the key of useful information during communication in this pair.</font></font></li>
<li><b>MAC-</b>: 6  ‚Äî   ,    . ,     Station, MAC-     Station.</li>
<li><b></b>: 1  ‚Äî       (SoftAP  STA) ESP-NOW.</li>
<li><b></b>: 1  ‚Äî ,     ,   .   0..255.       ,         .    . , 0 ,    ; 1 ~ 14   ;       ,    .</li>
</ul><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Espressif</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> does not recommend the use of lengthy operations in callback functions when sending / sending packets, which is presumably related to the implementation of algorithms using the interrupt mechanism. </font><font style="vertical-align: inherit;">This assumption is also supported by the problems associated with dynamic memory allocation in callback functions, which is solved by the preferred use of static variables, as well as the ambiguity of using the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MicroPython</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> exception </font><i><font style="vertical-align: inherit;">mechanism</font></i><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The implementation of the asynchrony of the start / end processes, pairing, receiving / transmitting </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Espressif</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> packets is </font><font style="vertical-align: inherit;">not described, which also does not facilitate the application of the </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">asyncio</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MicroPython</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ideology </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP-NOW Package Format</font></font></h4><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MAC Header</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 24 bytes.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Category</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 1 byte indicating the category of the package creator. </font><font style="vertical-align: inherit;">The value is set (127).</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Organization ID</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 3 bytes, contains a unique identifier, which is the first three bytes of the MAC address used by Espressif. </font><font style="vertical-align: inherit;">Set value (0x18fe34)</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Random value</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 4 bytes, used to protect data.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Package Creator Data</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 7-255Bytes</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The package creator data contains the following fields:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 1 byte, Set to (221).</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Length</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 1 byte, total length of organization ID, type, version, and user data.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Organization ID</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 3 bytes, contains a unique identifier, which is the first three bytes of the MAC address used by Espressif. </font><font style="vertical-align: inherit;">Set value (0x18fe34)</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 1 byte, ESP-NOW protocol. </font><font style="vertical-align: inherit;">Set value (4)</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Version</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 1 byte, current version of ESP-NOW. </font><font style="vertical-align: inherit;">Installed (1)</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Content</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 0-250 bytes user data.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FCS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 4 bytes, checksum</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since ESP-NOW does not use WiFi, the MAC header is slightly different from the standard packet header. </font><font style="vertical-align: inherit;">The FromDS and ToDS bits of the FrameControl field are 0. The destination address is specified in the first address field. </font><font style="vertical-align: inherit;">The second address field shows the source address. </font><font style="vertical-align: inherit;">The third address field is set as the broadcast address (0xff: 0xff: 0xff: 0xff: 0xff: 0xff).</font></font><br>
<br>
<u><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Basic application algorithm</font></font></h2></u><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Start and end</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Before using ESP-NOW, it is recommended that you set the Wi-Fi interface in the desired mode. </font><font style="vertical-align: inherit;">Typically, the Station interface is set for </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CONTROLLER</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , the SoftAP interface for </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SLAVE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COMBO</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">It is also advisable to stop Wi-Fi after using ESP-NOW. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To start ESP-NOW, call </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_init ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_deinit ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to complete. </font><font style="vertical-align: inherit;">When </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_deinit ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is called </font><font style="vertical-align: inherit;">, all information about paired devices is deleted.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Binding Callback Functions</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The call processing function when sending the packet </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_register_send_cb ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> can be used to inform the application level of the sending party in a pair about the success or failure of the transmission, for example, if the information on the MAC sublayer is transmitted successfully. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When using </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_register_send_cb ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , consider the following: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In a linked pair:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If the application layer did not receive the packet, but the callback function returned "success", the reason could be: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - attacks from a fraudulent device </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - encrypted key installation errors </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - packet loss at the Espressif application level</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If the application layer received the packet, but the callback function returns an error, the cause may be: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - The channel is busy and the ACK is not received.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
With multiple communication with all pairs of the local device:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If the callback returns ‚Äúsuccess‚Äù, it means the packet was sent successfully.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If the callback function returns an error, it means that the packet was not sent successfully.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The call processing function upon receipt of the packet </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_register_receive_cb ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> returns information including the MAC address of the sending device in a pair and useful information. </font><font style="vertical-align: inherit;">It can also be used to inform the application layer of the sending device paired with the receiver that the packet was successfully received.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adding a pair of paired devices</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Before sending data, you must add the device to the list of pairs of paired devices by calling </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_add_peer ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Before sending data to a group of established pairs, you must add a device with a multicast MAC address. </font><font style="vertical-align: inherit;">The channel range of paired devices is from 0 to 14. If the channel is set to 0, data will be sent on the current channel. </font><font style="vertical-align: inherit;">Otherwise, the channel must be set as the channel on which the local device is located.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Safety</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the key needs to be encrypted, you can call </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_set_pmk ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to configure it </font><font style="vertical-align: inherit;">to set PMK. </font><font style="vertical-align: inherit;">If PMK is not installed, PMK will be used by default and select the same key for all devices. </font><font style="vertical-align: inherit;">Also set LMK for selected pairs.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sending Data with ESP-NOW Packages</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Use </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_send ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to send ESP-NOW data </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">At the same time, the function set earlier in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_register_send_cb ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> will return </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP_NOW_SEND_SUCCESS</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> when sending a callback function if the data was successfully received at the MAC level. </font><font style="vertical-align: inherit;">Otherwise, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP_NOW_SEND_FAIL</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> will return </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Several reasons may cause ESP-NOW to not be able to send data. </font><font style="vertical-align: inherit;">In particular,</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">target device does not exist;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">device channels do not match;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data is lost during transmission.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is not guaranteed that the application layer will necessarily accept data. If necessary, you can send a confirmation when you receive ESP-NOW data. If a confirmation timeout occurs, the ESP-NOW data transmission should be repeated. A sequence number can also be assigned to ESP-NOW data to remove duplicate data. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When sending ESP-NOW data via </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_send (),</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> please note that no more than 250 bytes of information can be sent at a time.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ATTENTION! Too short an interval between sending two ESP-NOW packets can lead to errors in the execution of the callback function, therefore it is recommended to send the next data packet ESP-NOW after the callback function has successfully completed the processing of the previous sending. The callback function is sent from a high priority Wi-Fi task. Therefore, it is not recommended to perform lengthy operations in the callback function. Instead, you can place the necessary data in a static queue and process it from a process with a lower priority.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the send function returns a MAC address, then it will be sent to the device with this MAC address. </font><font style="vertical-align: inherit;">If the send function returns NULL, then the packet will be sent to all devices attached to the sending one, which may lead to transmission failure or delay due to network congestion.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP-NOW Receive Data</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The callback function also starts from a Wi-Fi task. </font><font style="vertical-align: inherit;">Therefore, it is not recommended to perform lengthy operations in the callback function. </font><font style="vertical-align: inherit;">Instead, you can place the necessary data in a static queue and process it with a lower priority process.</font></font><br>
<br>
<u><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In conclusion, the foregoing</font></font></h2></u><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
My experience in building the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Espressif IDE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MicroPython</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> with ESP-NOW, describing the errors that I encountered during the assembly and going to fix them after I achieve a stable result. Then I‚Äôll make a description of the ESP-NOW library on MicroPython with the errors detected, and ways to resolve them. Unfortunately, due to the fact that the source code of ESP-NOW is closed and distributed only in binary form, the understanding of the algorithms of the ESP-NOW protocol is empirical and there are a number of problems that have already been identified, for which there are not always options for overcoming them logically, but in general ESP -NOW is successfully used in the community of both C-users and Pythonists based on more than 300 applications presented on GitHub. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description of the ESP-NOW C Library by </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Espressif</font></font></i></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">MicroPython</font></i><font style="vertical-align: inherit;"> ESP-NOW Description and Open Sources</font></font><i><font style="vertical-align: inherit;"></font></i></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en502248/index.html">A new GOST for digital resources came into force: all platforms should be accessible for people with disabilities</a></li>
<li><a href="../en502250/index.html">Civil Aviation Today: Important Aspects and Challenges in Training</a></li>
<li><a href="../en502252/index.html">Remote control and drones</a></li>
<li><a href="../en502254/index.html">PostgreSQL: Server-side programming in the human language (PL / Perl, PL / Python, PL / v8)</a></li>
<li><a href="../en502256/index.html">How to visualize a Spring Integration graph using Neo4j?</a></li>
<li><a href="../en502262/index.html">Why AIOps and umbrella monitoring for the bank, or on what are customer relations built</a></li>
<li><a href="../en502264/index.html">Public Key Infrastructure. Issue of certificates in conditions of self-isolation</a></li>
<li><a href="../en502266/index.html">Aurora on Intel platform. Dawn of the Exaflops Era</a></li>
<li><a href="../en502268/index.html">HackTheBox. Passing Patents. XXE via DOCX, LFI to RCE, GIT, and ROP-chain files</a></li>
<li><a href="../en502272/index.html">Do not say ‚ÄúI feel myself,‚Äù and other English rules that drive into a stupor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>