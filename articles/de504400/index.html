<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>◻️ 📿 👧🏿 Caching. Teil 2: 60 Tage vor der Veröffentlichung 🤱🏾 🛃 🐻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo! Ich habe Ihnen bereits geschrieben, wie Sie Initiativen in einem Unternehmen fördern können. Genauer gesagt, wie (manchmal) dies gelingt und we...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Caching. Teil 2: 60 Tage vor der Veröffentlichung</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sportmaster_lab/blog/504400/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hallo! </font><font style="vertical-align: inherit;">Ich habe Ihnen bereits geschrieben, wie Sie Initiativen in einem Unternehmen fördern können. </font><font style="vertical-align: inherit;">Genauer gesagt, wie (manchmal) dies gelingt und welche Schwierigkeiten auftreten können: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eine Rake-Retrospektive. </font><font style="vertical-align: inherit;">Wie sich herausstellte, dass eine selbst erstellte Lösung cooler ist als eine bezahlte</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wie wir uns für ein Caching-System entschieden haben. </font><font style="vertical-align: inherit;">Teil 1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Heute möchte ich fortfahren und über den psychisch stressigsten Moment in diesem Projekt sprechen, über den die ersten beiden Artikel - als das Ergebnis des Projekts weniger von den technischen Fähigkeiten des Teams als vielmehr vom Vertrauen in ihre Berechnungen und der Bereitschaft, bis zum Ende zu gehen - bestimmt wurden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich muss sagen - ich denke , </font><font style="vertical-align: inherit;">dass das Projekt zu einem </font><font style="vertical-align: inherit;">solchen intensiven Moment zu bringen - es ist </font><font style="vertical-align: inherit;">ein Fehler weit verwendet </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">etwa</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lshaya als jeder Heroismus durch das Projekt ausstreckt dieses Problem ....</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber ich verstecke diese Erfahrung nicht und teile sie gerne - weil ich überlege:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gerade Problembereiche sind Wachstumspunkte</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die größten Probleme "kommen" genau dort an, wo Sie es nicht erwarten</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Kombination dieser Punkte verpflichtet Sie lediglich dazu, die wunderbare Erfahrung zu teilen, "wie man aus heiterem Himmel eine Dachrinne verdient". </font><font style="vertical-align: inherit;">Es ist jedoch anzumerken, dass eine ähnliche Situation bei der Firma Sportmaster außergewöhnlich ist. </font><font style="vertical-align: inherit;">Das heißt, es ist möglich, dass diese Situation erneut auftritt - Planung und Definition der Verantwortung jetzt - auf einer völlig anderen Ebene. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es scheint also, dass die Einführung ausreicht, wenn Sie bereit sind - willkommen bei cat.</font></font><br>
 <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/sa/3o/8k/sa3o8kskmgz_ptdsflpadmiycra.png"></a><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Juni 2017 </font><font style="vertical-align: inherit;">Wir ändern das Admin-Panel. </font><font style="vertical-align: inherit;">Das Admin-Panel besteht nicht nur aus einer Reihe von Formularen und Tabellen in der Weboberfläche. Die eingegebenen Werte müssen mit Dutzenden anderer Daten verknüpft werden, die wir von Systemen von Drittanbietern erhalten. </font><font style="vertical-align: inherit;">Verwandeln Sie es außerdem irgendwie und senden Sie es letztendlich an die Verbraucher (die wichtigste davon ist die ElasticSearch-Website von Sportmaster). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Hauptschwierigkeit besteht darin, nur zu konvertieren und zu senden. </font><font style="vertical-align: inherit;">Nämlich:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie müssen Daten in Form von json mit einem Gewicht von jeweils 100 KB bereitstellen und einige werden für 10 MB angezeigt (scannen Sie nach Verfügbarkeit und Kriterien für die Lieferung von Waren an Geschäfte).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es gibt JSON mit einer Struktur, die rekursive Anhänge jeder Verschachtelungsebene enthält (z. B. ein Menü innerhalb eines Menüelements, in dem sich wieder Menüelemente befinden usw.).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die endgültige Aussage wird nicht genehmigt und ändert sich ständig (z. B. wird die Arbeit mit Waren nach Modellen durch einen Ansatz ersetzt, wenn wir nach Farbmodellen arbeiten). </font><font style="vertical-align: inherit;">Ständig - dies ist mehrmals pro Woche, mit einer Spitzenrate von 2 mal pro Tag für eine Woche.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn die ersten beiden Punkte rein technisch sind und von der Aufgabe selbst vorgegeben werden, müssen Sie sich beim dritten Punkt natürlich organisatorisch damit befassen. </font><font style="vertical-align: inherit;">Aber die reale Welt ist alles andere als ideal, also arbeiten wir mit dem, was wir haben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie haben nämlich herausgefunden, wie Webformulare und ihre Objekte auf der Serverseite schnell vernietet werden können. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine Person aus dem Team wurde in die Rolle eines professionellen „Form Slap“ berufen und führte mithilfe vorbereiteter Webkomponenten eine Demo für die Benutzeroberfläche schneller ein, als die Analysten die Zeichnungen dieser Benutzeroberfläche korrigierten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um jedoch das Transformationsschema zu ändern, entstand hier Komplexität.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zuerst gingen wir den üblichen Weg - um die Transformation in der SQL-Abfrage zu Oracle durchzuführen. Es gab einen DB-Spezialisten im Team. Es dauerte bis zu dem Moment, als die Anfrage 2 Seiten fortlaufenden SQL-Text umfasste. Ich könnte weiter und weiter machen, aber als die Änderungen von den Analysten kamen - objektiv gesehen war es am schwierigsten, den Ort zu finden, an dem die Änderungen vorgenommen werden konnten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Analysten ausgedrückt Regel in den Systemen, die, obwohl sie in etwas von dem Code (etwas von einem visio / draw.io / Gliffy) abgelöst gemalt wurden, aber es gab </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">so</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ähnlich wie Quadrate und Pfeile in ETL-Systemen (zum Beispiel Pentaho Kettle, der zu dieser Zeit zur Bereitstellung von Daten für die Sportmaster-Website verwendet wurde). Wenn wir keine SQL-Abfrage hätten, sondern ein ETL-Schema! Dann würden die Anweisung und die Lösung topologisch identisch ausgedrückt, was bedeutet, dass das Bearbeiten des Codes genauso lange dauern kann wie das Bearbeiten der Anweisung!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei ETL-Systemen gibt es jedoch eine andere Schwierigkeit. Der gleiche Pentaho-Wasserkocher - eignet sich hervorragend, wenn Sie in ElasticSearch einen neuen Index erstellen müssen, in den alle aus mehreren Quellen geklebten Daten geschrieben werden können (Anmerkung: Tatsächlich funktioniert der Pentaho-Wasserkocher nicht sehr gut, da er bei Transformationen kein Javascript verwendet in Verbindung mit Java-Klassen, über die der Verbraucher auf Daten zugreift. Aus diesem Grund können Sie etwas schreiben, das Sie später nicht in die erforderlichen Pojo-Objekte umwandeln können. Dies ist jedoch ein separates Thema, das vom Hauptgang des Artikels abweicht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber was tun, wenn der Benutzer im Admin-Bereich ein Feld in einem Dokument korrigiert hat? Um diese Änderung auf die ElasticSearch-Website von Sportmaster zu übertragen, erstellen Sie keinen neuen Index, in den alle Dokumente dieses Typs, einschließlich eines aktualisierten, eingetragen werden können.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich wollte, dass, wenn sich ein Objekt in den Eingabedaten ändert, ein Update </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nur</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> für das entsprechende Ausgabedokument </font><font style="vertical-align: inherit;">an ElasticSearch </font><i><font style="vertical-align: inherit;">der</font></i><font style="vertical-align: inherit;"> Site gesendet wird </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Okay, das Eingabedokument selbst, aber schließlich könnte es gemäß dem Transformationsschema durch Join an Dokumente eines anderen Typs angehängt werden! Sie müssen also das Transformationsschema analysieren und berechnen, welche Ausgabedokumente von der Änderung der Daten in den Quellen betroffen sind. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Suche nach verpackten Produkten zur Lösung dieses Problems führte zu nichts. Nicht gefunden. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und als sie verzweifelt waren, fanden sie es heraus, aber wie sollte es im Inneren funktionieren und wie kann dies getan werden? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Idee entstand sofort.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn die endgültige ETL in ihre Bestandteile zerlegt werden kann, von denen jeder einen bestimmten Typ aus einer endlichen Menge (z. B. Filter, Join usw.) hat, ist es möglich, dieselbe endliche Menge spezieller Knoten zu erstellen, die den ursprünglichen Knoten entsprechen mit dem Unterschied, dass sie nicht mit den Daten selbst arbeiten, sondern mit ihrer Veränderung? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Detail, mit Beispielen und Schlüsselpunkten in der Implementierung, unsere Lösung - ich möchte in einem separaten Artikel behandeln. Um mit unterstützenden Positionen fertig zu werden, ist ein ernsthaftes Eintauchen erforderlich, die Fähigkeit, abstrakt zu denken und sich auf das zu verlassen, was noch nicht manifestiert wurde. In der Tat wird es gerade aus mathematischer Sicht interessant sein und ist nur für diejenigen Habroviten interessant, die an </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">technischen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Details </font><font style="vertical-align: inherit;">interessiert sind </font><font style="vertical-align: inherit;">.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier kann ich nur sagen, dass wir ein mathematisches Modell erstellt haben, in dem wir 7 Knotentypen beschrieben und gezeigt haben, dass dieses System vollständig ist - dh unter Verwendung dieser 7 Knotentypen und der Verbindungen zwischen ihnen -, dass jedes Datentransformationsschema ausgedrückt werden kann. </font><font style="vertical-align: inherit;">Die Implementierung basiert auf der aktiven Nutzung des Erhaltens und Aufzeichnens von Daten nach Schlüssel (nämlich nach Schlüssel ohne zusätzliche Bedingungen). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher hatte unsere Lösung eine Stärke in Bezug auf alle Einführungsschwierigkeiten:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Daten müssen in Form von JSON geliefert werden -&gt; Wir arbeiten mit Pojo-Objekten (einfaches altes Java-Objekt, wenn jemand die Zeiten, in denen eine solche Bezeichnung verwendet wurde, nicht gefunden hat), die in JSON leicht zu überholen sind</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es gibt JSON mit einer Struktur, die rekursive Einbettungen jeder Verschachtelungsebene enthält -&gt; wieder Pojo (Hauptsache, es gibt keine Schleifen, aber wie viele Verschachtelungsebenen nicht wichtig sind, ist in Java durch Rekursion einfach zu verarbeiten.)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die endgültige Aussage ändert sich ständig -&gt; ausgezeichnet, da wir das Transformationsschema schneller ändern, als Analysten (in den Diagrammen) Wünsche für Experimente formulieren</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Von den riskanten Momenten nur einer - wir schreiben die Lösung von Grund auf selbst. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eigentlich ließen die Fallen nicht lange auf sich warten.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Besonderer Moment N1. </font><font style="vertical-align: inherit;">Falle. </font><font style="vertical-align: inherit;">"Gut extrapoliert"</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine weitere organisatorische Überraschung war, dass gleichzeitig mit unserer Entwicklung das Haupt-Master-Repository auf eine neue Version umgestellt wurde und sich das Format, in dem dieses Repository Daten bereitstellt, änderte. Und es wäre schön, wenn unser System sofort mit dem neuen Speicher und nicht mit dem alten arbeiten würde. Der neue Speicher ist jedoch noch nicht fertig. Aber dann sind die Datenstrukturen bekannt und sie können uns einen Demo-Stand geben, auf den eine kleine Menge verwandter Daten gegossen wird. Geht? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier im Produktansatz wird bei der Arbeit mit dem Wertschöpfungsstrom eindeutig eine Warnung an alle Optimisten gehämmert: Es gibt einen Blocker -&gt; die Aufgabe funktioniert nicht, Punkt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber eine solche Abhängigkeit erregte nicht einmal Verdacht. In der Tat waren wir vom Erfolg mit dem Delta-Prozessor-Prototyp - einem System zur Verarbeitung von Daten auf Deltas (Implementierung eines mathematischen Modells, wenn Änderungen der Ausgabedaten unter Verwendung des Transformationsschemas als Reaktion auf eine Änderung der Eingabedaten berechnet werden) euphorisch. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unter allen Transformationsschemata war eines das wichtigste. Zusätzlich zu der Tatsache, dass die Schaltung selbst die größte und komplexeste war, bestand auch eine strikte Anforderung, dass die Transformation gemäß dieser Schaltung durchgeführt werden musste - eine zeitliche Begrenzung für die Ausführung der gesamten Datenmenge. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Transformation sollte also 15 Minuten und keine Sekunde länger durchgeführt werden. Die Haupteingabe ist eine Tabelle mit 5,5 Millionen Datensätzen. In der Entwicklungsphase ist die Tabelle noch nicht gefüllt. Genauer gesagt ist es mit einem kleinen Testdatensatz in Höhe von 10.000 Zeilen gefüllt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, fangen wir an. In der ersten Implementierung arbeitete der Delta-Prozessor an der HashMap als Schlüsselwertspeicher (ich möchte Sie daran erinnern, dass wir Objekte viel nach Schlüssel lesen und schreiben müssen). Natürlich passen auf Produktionsvolumina im Speicher nicht alle Zwischenobjekte - daher wechseln wir anstelle von HashMap zu Hazelcast. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Warum genau Hazelcast - also weil dieses Produkt bekannt war, wurde es im Backend zur Site des Sportmasters verwendet. Außerdem ist dies ein verteiltes System, und wie es uns schien - wenn ein Freund etwas mit der Leistung falsch macht - fügen wir einigen Computern weitere Instanzen hinzu, und das Problem ist behoben. Im Extremfall - ein Dutzend Autos. Horizontale Skalierung und alles.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deshalb starten wir unseren Delta-Prozessor für eine gezielte Transformation. Es funktioniert fast sofort. Das ist verständlich - die Daten sind nur 10 Tausend statt 5,5 Millionen. Daher multiplizieren wir die gemessene Zeit mit 550 und erhalten das Ergebnis: etwa 2 Minuten. Fein! In der Tat - ein Sieg! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies war ganz am Anfang der Projektarbeit - genau dann, wenn Sie sich für die Architektur entscheiden müssen, die Hypothesen bestätigen (Tests durchführen, die sie bestätigen), die Pilotlösung vertikal integrieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da die Tests ein hervorragendes Ergebnis zeigten - das heißt, wir haben alle Hypothesen bestätigt und den Piloten schnell umgedreht -, haben wir ein vertikal integriertes „Skelett“ für ein kleines Stück Funktionalität zusammengestellt. Und sie begannen mit der Hauptcodierung - das "Skelett mit Fleisch füllen".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was erfolgreich und energisch engagiert. Bis zu diesem schönen Tag, an dem ein </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vollständiger</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Datensatz </font><font style="vertical-align: inherit;">in den Master Store hochgeladen wurde </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Führen Sie den Test für dieses Set aus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach 2 Minuten hat nicht funktioniert. Ich habe auch nach 5, 10, 15 Minuten nicht gearbeitet. Das heißt, sie passten nicht in den notwendigen Rahmen. Aber mit wem es nicht passiert, wird es notwendig sein, etwas im Detail zu optimieren und zu passen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber der Test funktionierte eine Stunde später nicht. Und selbst nach 2 Stunden gab es Hoffnung, dass er arbeiten würde, und wir werden suchen, was wir festziehen können. Hoffnungsreste waren auch nach 5 Stunden noch vorhanden. Aber nach 10 Stunden, als sie nach Hause gingen, funktionierte der Test immer noch nicht - es gab keine Hoffnung mehr. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Problem war, dass der Test am nächsten Tag, als sie ins Büro kamen, immer noch fleißig weiter funktionierte. Infolgedessen wurde 30 Stunden lang gescrollt, nicht gewartet, ausgeschaltet.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Katastrophe! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Problem wurde schnell genug lokalisiert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hazelcast hat - wenn er an einer kleinen Datenmenge arbeitet - tatsächlich alles im Speicher gescrollt. </font><font style="vertical-align: inherit;">Wenn jedoch Daten auf einer Festplatte gespeichert werden mussten, sank die Leistung tausende Male. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Programmieren wäre langweilig und geschmacklos, wenn nicht die Behörden und die Verpflichtung, das fertige Produkt zu liefern. </font><font style="vertical-align: inherit;">Wir müssen also buchstäblich einen Tag später, nachdem wir einen vollständigen Datensatz erhalten haben, mit einem Bericht an die Behörden gehen, wie der Test des Produktionsvolumens bestanden hat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist eine sehr ernste und schwierige Wahl:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sagen Sie "wie es ist" = geben Sie das Projekt auf</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sagen Sie "wie ich möchte" = zu riskieren, vielleicht ist nicht bekannt, ob wir das Problem beheben können</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um zu verstehen, welche Gefühle in diesem Fall entstehen, ist es nur möglich, vollständig in die Idee zu investieren, den Plan für ein halbes Jahr umzusetzen und ein Produkt zu entwickeln, das Kollegen bei der Lösung einer großen Schicht von Problemen hilft. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und so ist es sehr schwierig, deine geliebte Schöpfung aufzugeben. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist charakteristisch für alle Menschen - wir lieben das, in das wir uns viel Mühe gegeben haben. Daher ist Kritik schwer zu hören - Sie müssen sich bewusst bemühen, Feedback angemessen wahrzunehmen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Allgemeinen haben wir festgestellt, dass es immer noch sehr, sehr viele verschiedene Systeme gibt, die als Schlüsselwertspeicher verwendet werden können. Wenn Hazelcast nicht passt, funktioniert definitiv etwas. </font><font style="vertical-align: inherit;">Das heißt, sie beschlossen, ein Risiko einzugehen. </font><font style="vertical-align: inherit;">Zu unserer Rechtfertigung können wir sagen, dass es noch keine „blutige Frist“ war - im Allgemeinen gab es noch eine gewisse Zeitspanne, um zu einer Backup-Lösung zu „wechseln“. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei diesem Treffen mit den Vorgesetzten gab unser Manager an, dass „der Test gezeigt hat, dass das System bei Produktionsmengen stabil funktioniert und nicht abstürzt“. </font><font style="vertical-align: inherit;">In der Tat funktionierte das System stabil. </font><u><font style="vertical-align: inherit;">60</font></u><font style="vertical-align: inherit;"> Tage </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bis zur Veröffentlichung </font><font style="vertical-align: inherit;">.</font></font><u><font style="vertical-align: inherit;"></font></u><font style="vertical-align: inherit;"></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Besonderer Moment N2. </font><font style="vertical-align: inherit;">Keine Falle, aber keine Entdeckung. </font><font style="vertical-align: inherit;">"Weniger ist mehr"</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um einen Ersatz für Hazelcast mit der Key-Value-Data-Warehouse-Rolle zu finden, haben wir eine Liste aller Kandidaten zusammengestellt - wir haben eine Liste mit 31 Produkten. Das ist alles, was ich geschafft habe, zu googeln und von meinen Freunden herauszufinden. Darüber hinaus gab Google einige absolut obszöne Optionen heraus, beispielsweise die Hausarbeit eines Studenten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Kandidaten schneller zu testen, haben wir einen kleinen Test vorbereitet, der in wenigen Minuten nach dem Start die Leistung auf den richtigen Volumes zeigte. Und sie haben die Arbeit parallelisiert - jeder hat das nächste System von der Liste genommen, konfiguriert, den Test ausgeführt und das nächste genommen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie arbeiteten schnell und schnappten mehrere Systeme pro Tag.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beim 18. System wurde klar, dass dies sinnlos war. Unter unserem Lastprofil ist keines dieser Systeme geschärft. Sie haben viele Rüschen und Knicks, um die Verwendung zu vereinfachen, viele schöne Ansätze zur horizontalen Skalierung - aber das bringt uns keinen Gewinn. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir brauchen ein System, das den Schlüssel schnell auf einem Objekt auf der Festplatte speichert und den Schlüssel schnell liest. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Fall skizzieren wir den Algorithmus, wie dies implementiert werden kann. Im Allgemeinen scheint dies durchaus machbar zu sein - wenn gleichzeitig: a) die Datenmenge geopfert wird, die die Festplatte belegt, b) ungefähr Schätzungen der Menge und der charakteristischen Größe der Daten in jeder Tabelle vorliegen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Weisen Sie etwas mit Stil Speicher (auf der Festplatte) für Objekte mit einem Rand zu, Teile eines festen maximalen Volumens. Dann mit den Indextabellen ... und so weiter ...</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es war ein Glück, dass es nicht dazu kam. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Erlösung erfolgte in Form von RocksDB. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist ein Produkt von Facebook, das zum schnellen Lesen und Speichern einer Reihe von Bytes auf der Festplatte entwickelt wurde. Gleichzeitig wird der Zugriff auf Dateien über eine Schnittstelle bereitgestellt, die dem Schlüsselwertspeicher ähnelt. Tatsächlich ist der Schlüssel ein Array von Bytes, der Wert ist ein Array von Bytes. Optimiert, um diese Aufgabe schnell und zuverlässig zu erledigen. Alle. Wenn Sie etwas Schöneres und Hochwertigeres brauchen, schrauben Sie es selbst auf. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Genau das, was wir brauchen!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RocksDB, in der Rolle des Schlüsselwertspeichers verankert, brachte den Zieltestindikator auf das Niveau von 5 Stunden. </font><font style="vertical-align: inherit;">Es war weit von 15 Minuten entfernt, aber die Hauptsache war erledigt. </font><font style="vertical-align: inherit;">Die Hauptsache war zu verstehen, was geschah, zu verstehen, dass das Schreiben auf die Festplatte so schnell wie möglich, schneller als unmöglich war. </font><font style="vertical-align: inherit;">Auf SSD drückte RocksDB in verfeinerten Tests 400 MBit / s, und das war genug für unsere Aufgabe. </font><font style="vertical-align: inherit;">Verzögerungen - irgendwo in unserem, in einem verbindlichen Code. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unserem</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Code bedeutet dies, dass wir damit umgehen können. </font><font style="vertical-align: inherit;">Nehmen wir es auseinander, aber wir können damit umgehen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Besonderer Moment N3. </font><font style="vertical-align: inherit;">Unterstützung. </font><font style="vertical-align: inherit;">"Theoretische Berechnung"</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben einen Algorithmus und eine Eingabe. Wir nehmen den Bereich der Eingabedaten, berechnen, wie viele Aktionen das System ausführen soll, wie diese Aktionen in den JVM-Laufzeitkosten ausgedrückt werden (einer Variablen einen Wert zuweisen, eine Methode eingeben, ein Objekt erstellen, ein Array von Bytes kopieren usw.) sowie wie viele Aufrufe an RocksDB sollte gehalten werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berechnungen zufolge sollten sie 2 Minuten dauern (ungefähr, wie der Test für HashMap am Anfang gezeigt hat, aber dies ist nur ein Zufall - der Algorithmus hat sich seitdem geändert). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und doch läuft der Test 5 Stunden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und jetzt vor der Veröffentlichung von </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tagen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist ein besonderes Datum - jetzt kann es nicht mehr zusammenbrechen - wir haben keine Zeit mehr, zur Sicherungsoption zu wechseln.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Natürlich wird an diesem Tag der Projektmanager zu den Behörden gerufen. Die Frage ist die gleiche - Zeit haben, ist alles in Ordnung? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ip/ci/ps/ipcipst6tfldoo7vmigaxcmsmta.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier ist der beste Weg, um diese Situation zu beschreiben - ein erweitertes Titelbild für diesen Artikel. Das heißt, den Chefs wird der Teil des Bildes angezeigt, der im Titel gerendert wird. Aber in Wirklichkeit - so. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obwohl in Wirklichkeit natürlich - wir waren überhaupt nicht lustig. Und sagen Sie: "Alles ist cool!" - Dies ist nur für eine Person mit einer sehr starken Fähigkeit zur Selbstbeherrschung möglich. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Großer, großer Respekt für den Manager, für das Vertrauen in die Entwickler. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wirklich, wirklich verfügbarer Code - zeigt 5 Stunden. Eine theoretische Berechnung - zeigt 2 Minuten. Wie kann man das glauben?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist jedoch möglich, wenn: das Modell klar formuliert ist, wie zu zählen verständlich ist und welche zu ersetzenden Werte ebenfalls verständlich sind. Das heißt, die Tatsache, dass die Ausführung in der Realität mehr Zeit in Anspruch nimmt, bedeutet, dass in der Realität nicht genau der Code ausgeführt wird, den wir dort ausführen möchten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die zentrale Aufgabe besteht darin, "Ballast" im Code zu finden. Das heißt, einige Aktionen werden zusätzlich zum Hauptstrom zum Erstellen der endgültigen Daten ausgeführt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eilte davon. Unit-Tests, funktionale Zusammensetzungen, Fragmentierung von Funktionen und Lokalisierung von Orten mit unverhältnismäßig viel Zeitaufwand für die Ausführung. Es wurden viele Dinge getan. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unterwegs haben wir solche Stellen formuliert, an denen Sie sich ernsthaft verschärfen können.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zum Beispiel Serialisierung. </font><font style="vertical-align: inherit;">Zuerst wurde der Standard java.io verwendet. </font><font style="vertical-align: inherit;">Wenn wir Cryo jedoch befestigen, erhalten wir in unserem Fall eine 2,5-fache Erhöhung der Serialisierungsgeschwindigkeit und eine 3-fache Verringerung der Menge serialisierter Daten (was bedeutet, dass IO dreimal kleiner ist, was nur die Hauptressourcen verschlingt). </font><font style="vertical-align: inherit;">Im Detail ist dies jedoch ein Thema für einen separaten technischen Artikel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber der entscheidende Punkt oder „wo sich der Elefant versteckt hat“ - ich werde versuchen, ihn in einem Absatz zu beschreiben.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Besonderer Punkt 4. Empfang zur Lösungsfindung. </font><font style="vertical-align: inherit;">"Problem = Lösung"</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn wir nach Schlüssel abrufen / setzen - in den Berechnungen ging es um 1 Operation, wirkt sich auf die E / A in dem Volumen aus, das Schlüssel + Objektwert entspricht (natürlich in serialisierter Form). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was aber, wenn das Objekt selbst, auf dem wir get / set aufrufen, eine Map ist, die wir auch durch get / set von der Festplatte erhalten. Wie viel wird das IO in diesem Fall tun? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In unseren Berechnungen wurde diese Funktion nicht berücksichtigt. Das heißt, es wurde als 1 E / A für Schlüssel + Objektwert betrachtet. Aber in der Tat?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beispielsweise gibt es im Schlüsselwertspeicher nach Schlüssel 1 ein Objekt obj-1 vom Typ Map, in dem ein bestimmtes Objekt obj-2 unter dem Schlüssel Schlüssel-2 gespeichert werden muss. Hier dachten wir, dass die Operation eine E / A für Schlüssel-2 + obj-2 erfordern würde. In Wirklichkeit müssen Sie jedoch obj-1 in Betracht ziehen, manipulieren und an IO senden: key-1 + obj-1. Und wenn es sich um eine Karte handelt, auf der sich 1000 Objekte befinden, ist der E / A-Verbrauch etwa 1000-mal höher. Und wenn 10.000 Objekte, dann ... so haben sie den "Ballast" bekommen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn ein Problem identifiziert wird, ist die Lösung normalerweise offensichtlich.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In unserem Fall ist dies eine spezielle Struktur für Manipulationen in verschachtelten Karten geworden. </font><font style="vertical-align: inherit;">Das heißt, ein solcher Schlüsselwert, der für get / set zwei Schlüssel gleichzeitig benötigt, die nacheinander angewendet werden sollten: Schlüssel-1, Schlüssel-2 - das heißt, für die erste Ebene und für die verschachtelte. </font><font style="vertical-align: inherit;">Wie man eine solche Struktur implementiert - ich werde es Ihnen gerne ausführlich erläutern, aber auch hier in einem separaten technischen Artikel. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier aus dieser Episode betone und bewerbe ich eine solche Funktion: Ein äußerst detailliertes Problem ist eine gute Lösung.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fertigstellung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Artikel habe ich versucht, die organisatorischen Punkte und Fallen aufzuzeigen, die auftreten können. </font><font style="vertical-align: inherit;">Solche Fallen sind „von der Seite“ oder im Laufe der Zeit sehr gut sichtbar, aber es ist sehr einfach, in sie hineinzukommen, wenn Sie sich zum ersten Mal neben ihnen befinden. </font><font style="vertical-align: inherit;">Ich hoffe, jemand wird sich an eine solche Beschreibung erinnern und im richtigen Moment wird die Erinnerung funktionieren: "Ich habe so etwas schon einmal gehört." </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und vor allem - jetzt, wo alles über den Prozess erzählt wird, über psychologische Momente, über organisatorische. </font><font style="vertical-align: inherit;">Jetzt haben wir eine Vorstellung davon, welche Aufgaben und unter welchen Bedingungen das System erstellt wurde. </font><font style="vertical-align: inherit;">Nun - Sie können und sollten von der technischen Seite über das System erzählen - was für ein mathematisches Modell dies ist, welche Tricks im Code wir verwendet haben und an welche innovativen Lösungen wir gedacht haben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Darüber im nächsten Artikel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der Zwischenzeit Happy New Code!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de504374/index.html">Einfache Diagrammdurchquerung: Tiefensuche und Breitensuche am Beispiel von JavaScript</a></li>
<li><a href="../de504382/index.html">Wie ich (PhD Neurobiology) in 6 Monaten Data Scientist wurde</a></li>
<li><a href="../de504384/index.html">Führen Sie TypeScript schrittweise in Ihr React-Projekt ein</a></li>
<li><a href="../de504386/index.html">Virtuelle Variablen der Klasse Vassbotn H.</a></li>
<li><a href="../de504392/index.html">Wie viele Programmierer und Wörter benötigen Sie, um einen handschriftlichen Pass zu erkennen?</a></li>
<li><a href="../de504402/index.html">29. Mai Java Digest</a></li>
<li><a href="../de504408/index.html">Einfache und bequeme Testframework-Vorlage auf Selenide für UI-Autotests</a></li>
<li><a href="../de504412/index.html">Online-Programmiermeisterschaft "Open Finals of Moscow Training"</a></li>
<li><a href="../de504414/index.html">Wie Microsoft AppGet getötet hat</a></li>
<li><a href="../de504420/index.html">Schreiben einer rundenbasierten PvP-Arena mit gleichzeitigen Bewegungen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>