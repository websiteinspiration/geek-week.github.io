<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥊 👨🏾‍🌾 🎐 Unity Terrane et Mesh Blending 🕟 🧗 💓</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour à tous, en juin, OTUS lancera à nouveau le cours Unity Games Developer . En prévision du début du cours, nous avons préparé une traduction de ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Unity Terrane et Mesh Blending</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/504554/"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bonjour à tous, en juin, OTUS lancera à nouveau le cours </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unity Games Developer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">En prévision du début du cours, nous avons préparé une traduction de matériel intéressant sur le sujet.</font></font></b></i><br>
<br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aujourd'hui, nous allons parler de la façon de mélanger un maillage de terrane (ou autre maillage) dans Unity. </font><font style="vertical-align: inherit;">Ce guide est assez avancé, mais j'ai essayé de le décomposer en étapes distinctes. </font><font style="vertical-align: inherit;">On suppose que vous avez des compétences générales sur Unity et des connaissances de base en C #. </font><font style="vertical-align: inherit;">Le guide est conçu pour amplifier, mais je pense qu'il peut également être appliqué au Shader Graph. </font><font style="vertical-align: inherit;">Ceci est mon premier guide, j'espère donc qu'il sera suffisamment clair. </font><font style="vertical-align: inherit;">Si vous souhaitez ajouter quelque chose, faites-le moi savoir. </font><font style="vertical-align: inherit;">J'ai inclus un kit de démarrage ici, qui a quelques shaders supplémentaires pour ce projet, ainsi qu'un kit de base pour commencer. </font><font style="vertical-align: inherit;">Tous les fichiers de projet du manuel d'aujourd'hui sont disponibles pour mes clients pour 5 $, mais dans un proche avenir, ils seront disponibles pour tout le monde.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
→ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kit de démarrage</font></font></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
→ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'ensemble du projet</font></font></a><br>
<br>
<blockquote><i><b>:</b>    ,    ,         .       .      ,        ,  ,      .                (      )     unity    .       ,       ,      .</i> </blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Commençons donc. </font><font style="vertical-align: inherit;">Pour commencer, je vais identifier le problème et approfondir la théorie sur laquelle la solution sera basée. </font><font style="vertical-align: inherit;">Pour faire un mélange entre le terrane et d'autres maillages, vous devez en quelque sorte dire au shader où se produit l'intersection avec le terrane. </font><font style="vertical-align: inherit;">Dire est plus facile que faire, mais il existe un moyen. </font><font style="vertical-align: inherit;">Et en quoi cela consiste-t-il? </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Render Texture</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous aidera </font><font style="vertical-align: inherit;">!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qu'est-ce qu'une texture de rendu?</font></font></h3><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La texture de rendu</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est, en fait, la position de la caméra, qui est enregistrée dans le fichier d'actif. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La texture de rendu</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans les jeux est le plus souvent utilisée pour des choses comme la création d'écrans de surveillance vidéo. </font><font style="vertical-align: inherit;">Nous pouvons utiliser la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">texture de rendu</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour enregistrer la vue de la caméra dans l'éditeur afin que cette texture puisse ensuite être utilisée comme shader. </font><font style="vertical-align: inherit;">Ceci est utile car nous pouvons créer des informations sur notre terrain, telles que la hauteur, les normales et les couleurs, dans une texture qui peut ensuite être utilisée en runtime pour se fondre entre les mailles et le terran.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/hv/iw/e8/hviwe8looo3tctln-egumqcolwu.jpeg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rendu de texture utilisé pour afficher des images d'oie sur les téléviseurs dans Untitled Goose Game</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Personnalisation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour commencer, créons une nouvelle scène et terrane. Définissez une taille pratique pour le travail, par exemple 200x200. Vous pouvez maintenant organiser la terrane comme vous le souhaitez. Créez ensuite un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nouveau calque</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et nommez-le «Terrain» et attribuez un terrain à ce calque. Cela est nécessaire pour que le masque de la caméra puisse enregistrer le terrane dans la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">texture de rendu</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/2u/h9/gt/2uh9gtaovl48lp8cvi2sswsnvc8.jpeg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mon chef-d'œuvre terrane</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Les fichiers source du projet ont un préfabriqué appelé </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"BlendBakingCamera"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - faites-le glisser sur la scène. </font><font style="vertical-align: inherit;">Vous obtiendrez une simple caméra orthographique. </font><font style="vertical-align: inherit;">À la caméra, vous devez mettre un </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">masque d'abattage</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur une nouvelle couche de terrane. </font><font style="vertical-align: inherit;">Positionnez la caméra au centre de la terrane légèrement au-dessus du point le plus haut du terrain. </font><font style="vertical-align: inherit;">Ajustez ensuite le </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plan du clip éloigné</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour que la caméra voit le sol de la terrane. </font><font style="vertical-align: inherit;">En fin de compte, la scène devrait ressembler à ceci:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/5b/u_/kr/5bu_krp8iertv5bgpzy0vtsuki4.png"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shader de remplacement</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Maintenant que la caméra est configurée, vous devez trouver un moyen d'enregistrer les données de terrane. Pour cela, nous avons besoin </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de Shaders de remplacement. Le Replacement Shader</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> semble être une perspective douteuse; je n'ai pas compris moi-même comment cela fonctionne depuis longtemps. Mais en fait, tout est très simple et efficace. L’utilisation du </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shader de remplacement</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> signifie essentiellement le rendu de chaque objet dans le champ de vision de la caméra avec un seul shader, quel que soit le shader superposé aux objets. En conséquence, tous les objets seront rendus à l'aide du </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shader de remplacement</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sélectionné </font><font style="vertical-align: inherit;">, qui n'est en fait qu'un shader ordinaire.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le shader dont nous avons besoin pour le mélange est le shader de profondeur. </font><font style="vertical-align: inherit;">Il rend la profondeur de la scène et est un élément clé dans la création de notre effet de fusion, car il écrit les valeurs de profondeur de notre appareil photo dans la texture afin que nous puissions les lire plus tard. </font><font style="vertical-align: inherit;">Pour en savoir plus sur ce shader et le </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shader de remplacement</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en général, je vous recommande de lire </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ce manuel de Making Stuff Look Good in Unity</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/rc/71/5e/rc715exr4enoh7vf-lmhx3b9oei.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemple de shader de profondeur</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Commençons la cuisson</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Créons une nouvelle classe et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">appelons-la «TerrainBlendingBaker»</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Commençons par implémenter un masque de profondeur pour le terrane de base. </font><font style="vertical-align: inherit;">Plus tard, nous reviendrons sur ce script pour ajouter des couleurs et des normales. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Définissez plusieurs variables.</font></font><br>
 <br>
<pre><code class="cs hljs"><span class="hljs-comment">//Shader that renders object based on distance to camera</span>
<span class="hljs-keyword">public</span> Shader depthShader;
<span class="hljs-comment">//The render texture which will store the depth of our terrain</span>
<span class="hljs-keyword">public</span> RenderTexture depthTexture;
<span class="hljs-comment">//The camera this script is attached to</span>
<span class="hljs-keyword">private</span> Camera cam;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Créons maintenant une nouvelle méthode et appelons-la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«UpdateBakingCamera»</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dans cette méthode, nous déterminerons les données de caméra dont le shader peut avoir besoin pour rendre le mélange dans les variables globales.</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">UpdateBakingCamera</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        <span class="hljs-comment">//if the camera hasn't been assigned then assign it</span>
        <span class="hljs-keyword">if</span> (cam == <span class="hljs-literal">null</span>)<font></font>
        {<font></font>
            cam = GetComponent&lt;Camera&gt;();<font></font>
        }<font></font>
 <font></font>
        <span class="hljs-comment">//the total width of the bounding box of our cameras view</span>
        Shader.SetGlobalFloat(<span class="hljs-string">"TB_SCALE"</span>, GetComponent&lt;Camera&gt;().orthographicSize * <span class="hljs-number">2</span>);
        <span class="hljs-comment">//find the bottom corner of the texture in world scale by subtracting the size of the camera from its x and z position</span>
        Shader.SetGlobalFloat(<span class="hljs-string">"TB_OFFSET_X"</span>, cam.transform.position.x - cam.orthographicSize);<font></font>
        Shader.SetGlobalFloat(<span class="hljs-string">"TB_OFFSET_Z"</span>, cam.transform.position.z - cam.orthographicSize);
        <span class="hljs-comment">//we'll also need the relative y position of the camera, lets get this by subtracting the far clip plane from the camera y position</span>
        Shader.SetGlobalFloat(<span class="hljs-string">"TB_OFFSET_Y"</span>, cam.transform.position.y - cam.farClipPlane);
        <span class="hljs-comment">//we'll also need the far clip plane itself to know the range of y values in the depth texture</span>
        Shader.SetGlobalFloat(<span class="hljs-string">"TB_FARCLIP"</span>, cam.farClipPlane);<font></font>
 <font></font>
        <span class="hljs-comment">//<span class="hljs-doctag">NOTE:</span> some of the arithmatic here could be moved to the shader but keeping it here makes the shader cleaner so ¯\_(ツ)_/¯</span>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Maintenant, faisons cuire la profondeur de la terrane dans la texture.</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-comment">// The context menu tag allows us to run methods from the inspector (https://docs.unity3d.com/ScriptReference/ContextMenu.html)</span>
[<span class="hljs-meta">ContextMenu(<span class="hljs-meta-string">"Bake Depth Texture"</span>)</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">BakeTerrainDepth</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-comment">//call our update camera method </span><font></font>
    UpdateBakingCamera();<font></font>
 <font></font>
    <span class="hljs-comment">//Make sure the shader and texture are assigned in the inspector</span>
    <span class="hljs-keyword">if</span> (depthShader != <span class="hljs-literal">null</span> &amp;&amp; depthTexture != <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
        <span class="hljs-comment">//Set the camera replacment shader to the depth shader that we will assign in the inspector </span>
        cam.SetReplacementShader(depthShader, <span class="hljs-string">"RenderType"</span>);
        <span class="hljs-comment">//set the target render texture of the camera to the depth texture </span><font></font>
        cam.targetTexture = depthTexture;<font></font>
        <span class="hljs-comment">//set the render texture we just created as a global shader texture variable</span>
        Shader.SetGlobalTexture(<span class="hljs-string">"TB_DEPTH"</span>, depthTexture);<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
        Debug.Log(<span class="hljs-string">"You need to assign the depth shader and depth texture in the inspector"</span>);<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Les valeurs deviendront plus claires lorsque nous commencerons à travailler avec le shader. </font><font style="vertical-align: inherit;">Voici une petite image qui peut nous éclairer:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/pm/hj/i2/pmhji2hicayyxh7plycoopbx1x4.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous allons transférer la terrane à la texture de profondeur afin de la lire plus tard et de comprendre où faire le mélange.Nous</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
avons maintenant tout ce dont nous avons besoin pour créer l'effet de mélange de base dans le shader. À ce stade, le script ressemble à ceci: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pastebin.com/xNusLJfh</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
D'accord, maintenant que nous avons le script, nous pouvons l'ajouter à la caméra de cuisson que nous avons ajoutée plus tôt. Les actifs initiaux ont un shader appelé </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'DepthShader' (Inresin / Shaders / DepthShader)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et une </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">texture de rendu</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> appelée </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'DepthTerrainRT' (Inresin / RenderTextures / DepthTextureRT)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , vous devez les mettre dans les champs appropriés dans l'inspecteur.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après cela, exécutez simplement la méthode dans le menu contextuel pour cuire la profondeur de votre terrain dans la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">texture de rendu</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/qh/dl/tm/qhdltmjap9-flgdtvl0twazylyi.gif"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shader</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Créons enfin un shader pour le mélange. Créez un nouveau </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shader d'amplification</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> standard </font><font style="vertical-align: inherit;">et ouvrez-le, nommez-le </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'TerrainBlending'</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou ainsi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous devons maintenant créer un UV pour la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">texture de rendu</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ce sera la différence entre le point en cours de rendu et la position de la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">caméra de cuisson</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mise à l'échelle par rapport à la zone totale. Les trois variables globales ici sont celles que nous venons de déclarer dans le code. Nous définissons également </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">worldY</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> comme une variable locale, nous en aurons besoin plus tard. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ei/ml/lm/eimllmdyi94c2_9tdwv_8orv9u8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prenons la texture de profondeur que nous avons affectée en tant que variable globale (pour cela, ajoutez un </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nœud d'échantillon de texture</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , rendez-le global et nommez-le </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'TB_DEPTH'</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), si nous mettons la sortie dans le champ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debug amplify shader</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , nous pouvons voir ce qui se passe. Créez un plan avec le matériau auquel notre nouveau shader sera appliqué.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/pz/hu/_i/pzhu_i59oxdberrgviej7cvbvci.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Donc, dans le shader, nous avons des informations sur la profondeur, maintenant nous devons ajouter un décalage en y pour obtenir le mélange. </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/ly/jy/lf/lyjylfsocd6cjfm46nu0z1xmjvg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce bloc met à l'échelle la position y du masque du </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plan</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de délimitation </font><i><font style="vertical-align: inherit;">éloigné</font></i><font style="vertical-align: inherit;"> , soustrait cette valeur de la position mondiale le long de l'axe y du point en cours de rendu, puis la déplace finalement vers le côté inférieur du cadre de délimitation de la caméra (position y de la caméra moins le </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plan farclip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Déjà quelque chose! Nous voyons comment les bords de l'avion fusionnent avec la terrane. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rb/fv/zu/rbfvzuc3sccy_dtknu6uitu-wns.gif"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Ok, rendons le mélange plus contrôlé. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uq/0o/1p/uq0o1prljhkkeiuxii5xmsnk5hm.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Nous pouvons maintenant contrôler l'épaisseur et la surface du terrane de mélange. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zc/tv/_b/zctv_bwpjihiwxpehsdokdbidry.gif"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Je pense qu'on peut même ajouter un peu de bruit. Utilisons la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">position mondiale</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour générer du bruit à partir de la texture.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xk/cv/po/xkcvpov6owwyfc7nxehrcmtyhiq.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Les textures de bruit se trouvent dans le dossier de texture du projet de démarrage, elles peuvent être affectées dans l'inspecteur ou en tant que constante dans le shader lui-même. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est enfin temps d'ajouter quelques textures! Pour commencer, utilisons des textures simples d'une seule couleur, j'ai ajouté deux textures au dossier avec des actifs de texture. Faites de la </font><font style="vertical-align: inherit;">texture </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«SingleColorGrass»</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> une texture de terrane. Ensuite, dans le shader, vous devez créer une texture de terrane et un </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nœud de texture d'objet</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Nous basculerons entre eux sur le canal rouge du masque que nous venons de créer. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4f/ny/8d/4fny8dg2v4godrj_khbragcc62s.png"><br>
<img src="https://habrastorage.org/webt/mw/6a/_v/mw6a_vyko0crhqvwgmqodlk46xa.png"><br>
 <br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et voici le shader complet.</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/cf/lr/ut/cflrutnc9-qxa2e9v3kpxnidta0.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
 Ajout personnalisée </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toon</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> éclairage </font><font style="vertical-align: inherit;">ou </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éclairage non éclairés</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> modèles </font><i><font style="vertical-align: inherit;">seront</font></i><font style="vertical-align: inherit;"> les meilleurs résultats pour ce shader. Je me suis </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éteint</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shader terrane et </font><font style="vertical-align: inherit;">version </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">non éclairée</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> du shader dans le package complet disponible pour les sponsors.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/vn/to/17/vnto17ss8bwcmfk3o_e0iguuxh8.png"></div> <br>
 <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terrane non éclairé et mailles</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Je recommande également d'ajouter un shader triplanaire à la terrane et éventuellement à d'autres mailles. </font><font style="vertical-align: inherit;">Je peux considérer cette question dans le prochain guide. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, nous avons presque fini avec le thème principal du guide d'aujourd'hui. </font><font style="vertical-align: inherit;">J'ai ajouté quelques sections qui peuvent aider avec l'extension du shader.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Extension de shader - Normal</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 J'ai ajouté un shader régulier aux fichiers, vous pouvez l'utiliser pour écrire des normales sur la surface de la terrane et également utiliser le mélange. Pour mon jeu, je n'ai pas besoin d'un mélange normal, donc j'ai juste expérimenté un peu et il semble que l'expérience ait été un succès, et mon idée fonctionne bien pour le terrain sans un haut degré de changement de hauteur. J'ai inclus le shader de mappage normal dans le répertoire avec les shaders de l'ensemble de départ. Ici, vous pouvez voir mon implémentation de base de la carte normale: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vw/lt/l1/vwltl1vedanxqwo5w0ofn4puf7k.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Le code est presque le même qu'avec la carte de profondeur, mais cette fois, nous utiliserons la carte normale comme </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shader de remplacement</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . J'ai également ajouté un ensemble de texture de rendu pour l'enregistrement normal (ici, vous aurez peut-être besoin d'une configuration supplémentaire).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour que les normales fonctionnent bien, cela peut prendre un peu plus d'efforts liés au réglage, et il peut également y avoir une restriction associée aux terranes de bas niveau (mais je n'ai pas effectué suffisamment de tests pour le confirmer).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Extension Shader - Toutes les couleurs</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Je ne vais pas entrer dans les détails de ce sujet, car il va au-delà de ce qui est requis pour mon jeu, mais j'y ai pensé en écrivant ce guide. Pour ajouter un mélange de nombreuses couleurs, nous pouvons sélectionner des </font><font style="vertical-align: inherit;">couleurs de terrane </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">non éclairées</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et les enregistrer en tant que textures. Dans ce cas, nous sommes limités par une résolution assez faible, mais cette méthode fonctionne bien lorsque vous utilisez des textures de terrain monochromes et des textures basse résolution, ou lorsque vous utilisez un </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fond perdu faible</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Avec des ajustements mineurs, ils peuvent également être appliqués aux mailles de terrane. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici le code de l'option multicolore:</font></font><br>
<br>
<pre><code class="cs hljs">[<span class="hljs-meta">Header(<span class="hljs-meta-string">"The following settings are only if using the multi-color terrain shader"</span>)</span>]
<span class="hljs-comment">//Shader that renders the unlit terraom of an object</span>
<span class="hljs-keyword">public</span> Shader unlitTerrainShader;
<span class="hljs-comment">//The render texture which will store the normals of our terrain</span>
<span class="hljs-keyword">public</span> RenderTexture surfaceTexture;
<span class="hljs-comment">//An unlit terrain material used to capture the texture of our terrain without any lighting</span>
<span class="hljs-keyword">public</span> Material unlitTerrainMaterial;
<span class="hljs-comment">//The terrain you want to capture the textures of</span>
<span class="hljs-keyword">public</span> Terrain yourTerrain;<font></font>
 <font></font>
[<span class="hljs-meta">ContextMenu(<span class="hljs-meta-string">"Bake Surface Texture"</span>)</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">BakeTerrainSurface</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    UpdateBakingCamera();<font></font>
 <font></font>
    <span class="hljs-comment">//return if there is no terrain assigned</span>
    <span class="hljs-keyword">if</span> (yourTerrain == <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
        Debug.Log(<span class="hljs-string">"You need to assign a terrain to capture surface texture"</span>);
        <span class="hljs-keyword">return</span>;<font></font>
    }<font></font>
 <font></font>
    StartCoroutine(BakeColors());<font></font>
}<font></font>
 <font></font>
<span class="hljs-function">IEnumerator <span class="hljs-title">BakeColors</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    Material tempTerrainMaterial = yourTerrain.materialTemplate;<font></font>
 <font></font>
    yourTerrain.materialTemplate = unlitTerrainMaterial;<font></font>
 <font></font>
    <span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
 <font></font>
    cam.SetReplacementShader(unlitTerrainShader, <span class="hljs-string">"RenderType"</span>);<font></font>
    cam.targetTexture = surfaceTexture;<font></font>
    Shader.SetGlobalTexture(<span class="hljs-string">"TB_SURFACE"</span>, surfaceTexture);<font></font>
 <font></font>
    <span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
 <font></font>
    cam.targetTexture = <span class="hljs-literal">null</span>;<font></font>
    yourTerrain.materialTemplate = tempTerrainMaterial;<font></font>
 <font></font>
    <span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
 <font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Le seul changement dans le shader est qu'au lieu d'utiliser une texture prédéfinie, nous utilisons une texture de surface de terrain définie globalement qui utilisera la position relative comme UV. </font><font style="vertical-align: inherit;">Une extension supplémentaire vous permet d'obtenir un mélange de textures plus agréable. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wl/ts/xe/wltsxewq-f-2ymxewxjfuew5wk4.png"> <br>
 <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mélange de textures multiples </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici un graphique multicolore complet avec un shader de mélange normal:</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/jw/bx/vp/jwbxvprh_o3wt9iaw7mmh6vjufa.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Félicitations si vous avez lu jusqu'ici! </font><font style="vertical-align: inherit;">Comme je l'ai dit, c'est mon premier guide, donc j'apprécierais vraiment les commentaires. </font><font style="vertical-align: inherit;">Si vous souhaitez m'aider à créer des jeux et des tutoriels, jetez un œil </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou abonnez-vous à mon </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Twitter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En savoir plus sur le cours</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr504510/index.html">Programmez-vous. Comment trouver un emploi en informatique</a></li>
<li><a href="../fr504516/index.html">Tactiques hacker préférées</a></li>
<li><a href="../fr504520/index.html">Comment faire 70 publications gratuites sur un projet inconnu en une semaine</a></li>
<li><a href="../fr504522/index.html">Que voir en quarantaine? Une sélection de matériaux de Technostream (partie 6)</a></li>
<li><a href="../fr504524/index.html">Modèle typique de développement d'épidémie COVID-19</a></li>
<li><a href="../hi486176/index.html">कॉर्पोरेट ईमेल पत्राचार मेमो</a></li>
<li><a href="../hi486178/index.html">FOSS News No. 1 - 27 जनवरी - 2 फरवरी, 2020 के लिए स्वतंत्र और मुक्त स्रोत समाचार की समीक्षा</a></li>
<li><a href="../hi486180/index.html">सर्वर रहित एप्लिकेशन बनाने के लिए सुझाव और स्रोत</a></li>
<li><a href="../hi486184/index.html">प्रभावी ढंग से खोज का उपयोग कैसे करें</a></li>
<li><a href="../hi486186/index.html">प्रलयकारी बादल: यह कैसे काम करता है</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>