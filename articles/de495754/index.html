<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😁 👊🏿 🕘 Sim-Sim Open oder Reverse Engineering Smart Intercom 👩🏿‍🤝‍👩🏽 ☁️ 🧘🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nach dem Lesen des Beitrags KrupnikasEs gab eine Idee, sich mit Mitmproxy zu befassen und zu sehen, wie das Backend der täglich verwendeten mobilen An...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Sim-Sim Open oder Reverse Engineering Smart Intercom</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495754/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nach dem Lesen des </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beitrags</font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Krupnikas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es gab eine Idee, sich mit Mitmproxy zu befassen und zu sehen, wie das Backend der täglich verwendeten mobilen Anwendungen angeordnet ist. </font><font style="vertical-align: inherit;">Die Wahl fiel auf die Intercom-Anwendung. </font><font style="vertical-align: inherit;">Nach der Autorisierung können Sie Türen öffnen und Videoanrufe beantworten. </font><font style="vertical-align: inherit;">Was dabei herauskam und welche Löcher ich gefunden habe, werde ich unter dem Schnitt erzählen.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/cd/rc/hu/cdrchuiued3otgzhrka3gqtgdqa.jpeg"></div><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Proxy-Einstellungen</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um den Verkehr zu analysieren, wird häufig ein Ansatz verwendet, der als Mann in der Mitte bezeichnet wird. Es besteht darin, dass bei einer Verbindung mit einem lokalen Netzwerk der Datenverkehr vom analysierten Gerät zuerst zu dem Computer geleitet wird, auf dem er entschlüsselt und analysiert wird, und dann zurück verschlüsselt und an den Server gesendet wird. Am beliebtesten zum Entschlüsseln des Datenverkehrs ist das Mitmproxy-Programm. Die Installation von Mitmproxy war keine große Sache.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um den Datenverkehr von einem mobilen Gerät anzuzeigen, müssen Sie von Ihrem Telefon und Computer aus eine Verbindung zu Ihrem Heim-WLAN herstellen. </font><font style="vertical-align: inherit;">Installieren Sie mitmproxy auf dem Computer und führen Sie es aus. </font><font style="vertical-align: inherit;">Legen Sie auf dem Telefon in den WLAN-Einstellungen die lokale Adresse und den Computeranschluss als Proxyserver fest. </font><font style="vertical-align: inherit;">Gehen Sie als Nächstes vom Telefon zu mitm.it und installieren Sie ein Zertifikat, mit dem Sie https-Anforderungen entschlüsseln können. </font><font style="vertical-align: inherit;">Nach diesen Schritten wurden Anforderungen vom Browser sichtbar. </font><font style="vertical-align: inherit;">Hurra! </font><font style="vertical-align: inherit;">Der nächste Schritt war jedoch die Enttäuschung:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/js/ot/7e/jsot7e1q5qkrqftcgvxvwy2h1mq.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Suche führte zu einem offenen Problem auf dem </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Github</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Es stellte sich heraus, dass Anwendungen ab API Level 24 Benutzerzertifikaten nicht mehr vertrauen. </font><font style="vertical-align: inherit;">Glücklicherweise können Sie dies umgehen, indem Sie apk entpacken und AndroidManifest.xml die folgende Konfiguration hinzufügen:</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">network-security-config</span>&gt;</span>  
     <span class="hljs-tag">&lt;<span class="hljs-name">debug-overrides</span>&gt;</span>  
          <span class="hljs-tag">&lt;<span class="hljs-name">trust-anchors</span>&gt;</span>  
               <span class="hljs-comment">&lt;!-- Trust preinstalled CAs --&gt;</span>  
               <span class="hljs-tag">&lt;<span class="hljs-name">certificates</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"system"</span> /&gt;</span>  
               <span class="hljs-comment">&lt;!-- Additionally trust user added CAs --&gt;</span>  
               <span class="hljs-tag">&lt;<span class="hljs-name">certificates</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"user"</span> /&gt;</span>  
          <span class="hljs-tag">&lt;/<span class="hljs-name">trust-anchors</span>&gt;</span>  
     <span class="hljs-tag">&lt;/<span class="hljs-name">debug-overrides</span>&gt;</span>  
<span class="hljs-tag">&lt;/<span class="hljs-name">network-security-config</span>&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Darüber hinaus gibt es auf dem Github ein vorgefertigtes </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Skript</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , das dies automatisch </font><font style="vertical-align: inherit;">ausführt </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Also, laden Sie apk herunter, patchen Sie das Skript, setzen Sie den Befehl adb install und voila alles funktioniert.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verkehrsanalyse</font></font></h2> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir sehen, dass Anfragen an Adressen des Formulars gestellt werden:</font></font><br>
<br>
<pre><code class="bash hljs">https://{intercom-company-url}/api/
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Header werden zwei Parameter übergeben: </font></font><br>
<pre><code class="python hljs"><span class="hljs-string">'api-version'</span>: <span class="hljs-string">'2'</span>,
<span class="hljs-string">'authorization'</span>:&nbsp; <span class="hljs-string">'Bearer&nbsp;your.jwt.token’
</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der erste Parameter ist die API-Version und der zweite ist das Autorisierungstoken. </font><font style="vertical-align: inherit;">Für die Autorisierung wird ein JSON-Web-Token verwendet, das aus drei Teilen besteht: Header, Nutzlast und Signatur. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dekodiere es mit dem Befehl:</font></font><br>
<br>
<pre><code class="bash hljs">pyjwt decode --no-verify your.jwt.token
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sehen Sie, dass Payload account_id und exp enthält. </font><font style="vertical-align: inherit;">Das Feld exp entspricht dem Zeitpunkt, zu dem das Token erstellt wurde. Auf diese Weise können Sie Token für verschiedene Geräte aus einem Konto generieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Am interessantesten für uns sind Anfragen nach einer Liste der verfügbaren Gegensprechanlagen und zum Öffnen von Türen. </font><font style="vertical-align: inherit;">Beim Senden einer Anfrage (ich habe Python und die Anforderungsbibliothek verwendet) an</font></font><br>
<br>
<pre><code class="bash hljs">https://{intercom-company-url}/api/customers/properties/{account_id}/intercoms 
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir bekommen json mit einer Liste von Türtelefonen mit Feldern:</font></font><br>
<br>
<pre><code class="json hljs">[<font></font>
    {<font></font>
        'id': ID,<font></font>
        'mode': MODE, <font></font>
        'sip_account': {'ex_user': USER_ID, 'proxy': PROXY,  'password': PSWD}, <font></font>
        'video': [{'quality': 'low', 'source': 'rtsp:<span class="hljs-comment">//LINK }]</span><font></font>
    }<font></font>
]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In json id - Türsprecherkennung, Modus - welche Tür geöffnet werden kann (mögliche Werte sind one_door, left_door, right_door), sip account und ein Link zur Videoübertragung. Beeindruckend! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unter Verwendung des Sitzungsinitiierungsprotokolls (sip) werden Videoanrufe über die Gegensprechanlage getätigt. Im Feld sip_account haben wir id'shniki und Passwörter für Gegensprechanlagen erhalten, auf die unser Konto Zugriff hat. Es funktioniert nicht, sie trotzdem anzurufen, da sie sich im internen Netzwerk befinden. Aber das Videofeld ist interessant. Es enthält einen externen Link zum Senden von Videos von der Kamera. Es reicht aus, vlc zu öffnen, den Link zu kopieren und auf der Türkamera rund um die Uhr zu schauen. Es ist nicht gut, solche Links zu zerstreuen! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als nächstes werden wir herausfinden, wie man die Tür öffnet. Wenn Sie auf die Schaltfläche zum Öffnen der Tür klicken, sendet die Anwendung eine Abrufanforderung:</font></font><br>
<br>
<pre><code class="bash hljs">https://{intercom-company-url}/api/customers/intercoms/{intercom_id}/unlock?door=left_door&amp;id={intercom_id}
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es stellte sich heraus, dass das Vorhandensein oder Fehlen des ID-Parameters nichts beeinflusst, aber die Tür ermöglicht im Fall eines Türsprechers mit zwei Türen, nicht nur Ihre eigene, sondern auch die nächste Tür Ihrer Wahl zu öffnen. </font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sim-Sim offen!</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem ich die API herausgefunden hatte, beschloss ich, etwas Nützliches zu tun. </font><font style="vertical-align: inherit;">Das Ergebnis ist eine Android-Anwendung, die Sprachbefehle erkennt. Wenn vordefinierte Befehle wie "sim-sim open" erkannt werden, wird eine Anforderung zum Öffnen der entsprechenden Tür gesendet.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ergebnisse</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine intelligente Gegensprechanlage ist gut, aber eine sichere und intelligente Gegensprechanlage ist noch besser.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de495732/index.html"># 03 - Und ein ganzes Byte reicht nicht ... | 2B oder nicht 2B</a></li>
<li><a href="../de495740/index.html">Da wir eine Woche lang kein Geld hatten, haben Verbindungen und Software einen Lieferservice für Lebensmittel gestartet und es fast nicht vermasselt</a></li>
<li><a href="../de495746/index.html">Wir bilden View in SwiftUI, ausgehend von den Bedingungen</a></li>
<li><a href="../de495748/index.html">Neuer Punto Switcher für Linux: xswitcher</a></li>
<li><a href="../de495752/index.html">Wann wird die Pandemie abnehmen? Auswertung in Python mit Pandas</a></li>
<li><a href="../de495756/index.html">Schlüsselprinzipien für die Verwendung von ECS in der Spieleentwicklung</a></li>
<li><a href="../de495758/index.html">Feuer und Strategie</a></li>
<li><a href="../de495760/index.html">Heller als die Sterne: HGST-Rebranding und Nachschub der Ultrastar-Linie</a></li>
<li><a href="../de495762/index.html">Prosto: Entfernen Sie die Boilerplate, wenn Sie mit RecyclerView arbeiten</a></li>
<li><a href="../de495764/index.html">CSI Linux: Linux-Distribution für Cyber-Untersuchungen und OSINT</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>