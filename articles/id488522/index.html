<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíî üë®üèª‚Äçüíª üï∂Ô∏è JOOQ dan lubang kelincinya. Cara bertahan hidup tanpa hibernasi üç¶ üéÅ üë®üèø‚Äçüî¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dalam artikel ini saya tidak akan tenggelam untuk JOOQ. Saya lebih suka Hibernate dan semua kekuatan Spring Data JPA di belakangnya. Tetapi artikel it...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>JOOQ dan lubang kelincinya. Cara bertahan hidup tanpa hibernasi</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488522/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam artikel ini saya tidak akan tenggelam untuk JOOQ. </font><font style="vertical-align: inherit;">Saya lebih suka Hibernate dan semua kekuatan Spring Data JPA di belakangnya. </font><font style="vertical-align: inherit;">Tetapi artikel itu tidak akan membahas tentang mereka. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wt/-0/co/wt-0condklmkd6zkb2ag_a46vb4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat kami menggunakan Hibernate dan Spring Data JPA, kami tidak perlu memikirkan proses internal - ketahui anotasi dan tulis nama metode yang benar dalam repositori - kedua monster ini akan melakukan sisanya untuk Anda. </font><font style="vertical-align: inherit;">Dalam kasus JOOQ, sayangnya bagi banyak orang, ini akan membutuhkan sedikit usaha dan menulis lebih banyak daripada </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">findAllByUserId (Long userId)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apa itu JOOQ?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita menulis kueri SQL sederhana:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> countries c <span class="hljs-keyword">where</span> c.population &gt; <span class="hljs-number">10000000</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami dapat menjalankan permintaan ini di konsol. </font><font style="vertical-align: inherit;">baik </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami tidak merasa seperti di konsol. </font><font style="vertical-align: inherit;">Kami ingin aplikasi kami mengirim permintaan ini. </font><font style="vertical-align: inherit;">Bahwa itu bukan skrip satu kali dan itu divalidasi setidaknya untuk sintaksis. </font><font style="vertical-align: inherit;">Kami melakukan ini melalui Spring Data JPA:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function">List&lt;Country&gt; <span class="hljs-title">findAllByPopulationAfter</span><span class="hljs-params">(Long amount)</span></span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Permintaan yang sama dijalankan seperti di atas, tetapi pada Musim Semi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa keuntungan nyata dari pendekatan ini? </font><font style="vertical-align: inherit;">Itu dilakukan oleh kerangka kerja yang kuat, itu juga memvalidasi permintaan untuk kesalahan. </font><font style="vertical-align: inherit;">Tetapi manajemen kueri menangani framework. </font><font style="vertical-align: inherit;">Dan kami ingin sepenuhnya mengelola permintaan, tetapi pada saat yang sama, sehingga permintaan sepenuhnya divalidasi. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menggunakan</font></font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pertanyaan</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Query("select c from Country c where c.population &gt; :amount")</span>
<span class="hljs-function">List&lt;Country&gt; <span class="hljs-title">findAllPopulationGreaterThan</span><span class="hljs-params">(<span class="hljs-meta">@Param("amount")</span> Long amount)</span></span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertukaran antara SQL dan DSL juga bagus. </font><font style="vertical-align: inherit;">Tetapi jika kita tidak ingin mengacaukan dengan SQL, kita akan senang melihat sesuatu seperti:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">return</span> dsl.selectFrom(COUNTRIES)<font></font>
                .where(COUNTRIES.POPULATION.greaterThan(amount))<font></font>
                .fetch();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beberapa perpustakaan cocok untuk ini: </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QueryDSL </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
JOOQ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Speedment</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Tentang QueryDSL Saya </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menulis</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> beberapa tahun yang lalu. </font><font style="vertical-align: inherit;">Saya tidak menggali Speedment, tetapi tampaknya lebih dari sekadar generator DSL sederhana, ditambah lagi saya harus mempelajari metode yang digunakan untuk mengenkripsi perintah kueri SQL. </font><font style="vertical-align: inherit;">Secara umum, hari ini kita akan berbicara tentang JOOQ.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pertanyaan JOOQ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ya, kami telah melihat salah satu pertanyaan di atas:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">return</span> dsl.selectFrom(COUNTRIES)<font></font>
                .where(COUNTRIES.POPULATION.greaterThan(amount))<font></font>
                .fetch();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa lagi yang ada di sana? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Misalnya, permintaan dapatkan sederhana:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">return</span> dsl.selectFrom(Countries.COUNTRIES)<font></font>
                .where(Countries.COUNTRIES.ID.eq(id))<font></font>
                .fetchAny();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Atau masukkan permintaan:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">return</span> dsl.insertInto(Countries.COUNTRIES)<font></font>
                .set(Countries.COUNTRIES.NAME, country.getName())<font></font>
                .set(Countries.COUNTRIES.POPULATION, country.getPopulation())<font></font>
                .set(Countries.COUNTRIES.GOVERNMENT_FORM, nameOrNull(country.getGovernmentForm()))<font></font>
                .returning()<font></font>
                .fetchOne();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang Anda lihat, semuanya jelas, tidak lebih. </font><font style="vertical-align: inherit;">Tapi ini hanya sekilas. </font><font style="vertical-align: inherit;">Mencari tahu seberapa dalam lubang kelinci ini bisa memakan waktu beberapa minggu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tapi mari kita mulai dari awal.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ya itu akan menjadi pakar</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya lebih suka Gradle. </font><font style="vertical-align: inherit;">Tetapi untuk beberapa alasan, pengembang JOOQ kurang memperhatikan Gradle, menawarkan untuk pergi untuk plugin pihak ketiga. </font><font style="vertical-align: inherit;">Oke, proyek pelatihan akan di Maven. </font><font style="vertical-align: inherit;">Tetapi jika Anda, pembaca yang budiman, mencari-cari sebagaimana mestinya di kedalaman github dan siap untuk mengungkapkan proyek yang sepenuhnya disesuaikan pada Gradle - menulis kepada saya dan Anda akan menjadi co-penulis artikel ini. </font><font style="vertical-align: inherit;">Hal yang sama berlaku untuk H2 (proyek pelatihan akan di PostgreSQL).</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengapa saya tidak berhasil dengan Gradle dan H2</font></font></b><div class="spoiler_text">    ,      Gradle.           jooq-generator .          H2,  ¬´  ¬ª   H2         ,   ,  ,     .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketergantungan maven yang diperlukan:</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><font></font>
<font></font>
        <span class="hljs-comment">&lt;!-- Spring Starters --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-jooq<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><font></font>
<font></font>
        <span class="hljs-comment">&lt;!-- Database --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.flywaydb<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>flyway-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.postgresql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>postgresql<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><font></font>
<font></font>
        <span class="hljs-comment">&lt;!-- Helpers --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-lang3<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${commons.lang3.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><font></font>
<font></font>
        <span class="hljs-comment">&lt;!--Test --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.junit.vintage<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit-vintage-engine<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><font></font>
<font></font>
        <span class="hljs-comment">&lt;!-- JOOQ Generator --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.jooq<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jooq<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${jooq.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.jooq<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jooq-meta<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${jooq.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.jooq<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jooq-codegen<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${jooq.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><font></font>
<font></font>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Spring sudah memiliki starter JOOQ yang akan mengkonfigurasi sendiri DataSource sesuai dengan pengaturan yang ditentukan dari application.yml. </font><font style="vertical-align: inherit;">Tetapi untuk kerja penuh JOOQ, ini tidak cukup. </font><font style="vertical-align: inherit;">Entitas harus dihasilkan. </font><font style="vertical-align: inherit;">Ya, ya, kami tidak menulis entitas, tetapi menghasilkannya. </font><font style="vertical-align: inherit;">Yang disebut pendekatan table-first. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Struktur aplikasi yang biasa dengan fokus untuk bekerja dengan basis data terlihat seperti ini: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/c-/pz/tp/c-pztpdxbkn5kxot-s_08tzlzbk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sampai lapisan layanan, data bergerak melalui aplikasi dalam bentuk model datar (DTO). </font><font style="vertical-align: inherit;">Lebih jauh, ketika layanan perlu bekerja dengan database, ia mengubah DTO menjadi entitas, mengirimkannya ke repositori, dan sudah menyimpannya ke database. </font><font style="vertical-align: inherit;">Pengembang JOOQ melihat semuanya secara berbeda: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vv/wy/4b/vvwy4bbp1ox57f4j0edmulfe7ni.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang dapat kita lihat, JOOQ secara serius merevisi pola standar dan memutuskan untuk melakukannya sendiri. </font><font style="vertical-align: inherit;">Perbedaannya signifikan:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konversi DTO menjadi entitas sudah terjadi di repositori. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami tidak menulis entitas seperti itu. </font><font style="vertical-align: inherit;">Ini ditulis untuk kita oleh generator JOOQ.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini sudah cukup untuk menyimpulkan bahwa JOOQ tidak begitu sederhana. </font><font style="vertical-align: inherit;">Entitas yang dihasilkan sangat mudah disesuaikan, pemetaan yang tidak dapat dipahami dalam DTO dan kesulitan lainnya akan membuat takut banyak orang. </font><font style="vertical-align: inherit;">Tetapi dalam kasus-kasus di mana tidak ada tempat untuk pergi, studi terfokus pada aspek-aspek JOOQ ini dapat dengan serius dilakukan dan memakan waktu berhari-hari, atau bahkan berminggu-minggu. </font><font style="vertical-align: inherit;">Saya yakin posting saya akan sangat menghemat waktu Anda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami akan membahas aspek-aspek bekerja dengan JOOQ berikut:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Generasi Entitas. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menulis Pertanyaan CRUD. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Optimalisasi permintaan CRUD. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dan optimasi permintaan CRUD lain. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Memetakan entitas menggunakan perpustakaan JOOQ standar. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan diskusikan mengapa semua ini perlu. </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ayo pergi.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apa yang kita tulis</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Proyek kami akan memiliki dua entitas: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Negara:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Country</span> </span>{<font></font>
<font></font>
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> GovernmentForm governmentForm;
    <span class="hljs-keyword">private</span> Integer population;<font></font>
<font></font>
    <span class="hljs-keyword">private</span> List&lt;City&gt; cities;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kota:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">City</span> </span>{<font></font>
<font></font>
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> Long countryId;
    <span class="hljs-keyword">private</span> String name;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hubungan satu ke banyak. </font><font style="vertical-align: inherit;">Negara berisi banyak Kota terkait. </font><font style="vertical-align: inherit;">City mengandung countryId. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Migrasi jalur terbang terlihat seperti ini:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> countries<font></font>
(<font></font>
    <span class="hljs-keyword">id</span>              bigserial primary <span class="hljs-keyword">key</span>,
    <span class="hljs-keyword">name</span>            <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>),<font></font>
    government_form <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>),<font></font>
    population      <span class="hljs-built_in">int</span><font></font>
);<font></font>
<font></font>
<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> cities<font></font>
(<font></font>
    <span class="hljs-keyword">id</span>         bigserial primary <span class="hljs-keyword">key</span>,<font></font>
    country_id <span class="hljs-built_in">bigint</span>,
    <span class="hljs-keyword">name</span>       <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>)<font></font>
);</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mari kita mulai dengan pembuatan entitas.</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entitas, seperti yang saya katakan, dihasilkan secara terpisah. </font><font style="vertical-align: inherit;">Ada dua cara untuk melakukan ini.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Melalui plugin Maven. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam kode Java. </font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menghasilkan Entitas di Maven</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika proyek dibangun, Maven memulai generator dan menghasilkan entitas. </font><font style="vertical-align: inherit;">Dan Anda dapat memanggil generator kapan saja dan menghasilkan entitas. </font><font style="vertical-align: inherit;">Ini diperlukan pada saat-saat ketika, katakanlah, struktur pangkalan telah berubah. </font><font style="vertical-align: inherit;">Plugin di Maven terlihat seperti ini:</font></font><br>
<br>
<pre><code class="xml hljs">            <span class="hljs-comment">&lt;!-- JOOQ Generator Plugin --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.jooq<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jooq-codegen-maven<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${jooq.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>generate-sources<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>generate<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">jdbc</span>&gt;</span>  <span class="hljs-comment">&lt;!--    --&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">driver</span>&gt;</span>${db.driver}<span class="hljs-tag">&lt;/<span class="hljs-name">driver</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>${db.url}<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span>${db.username}<span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>${db.password}<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">jdbc</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">generator</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">database</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">includes</span>&gt;</span>.*<span class="hljs-tag">&lt;/<span class="hljs-name">includes</span>&gt;</span>  <span class="hljs-comment">&lt;!--     --&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">excludes</span>&gt;</span>  <span class="hljs-comment">&lt;!--     --&gt;</span><font></font>
                                flyway_schema_history<font></font>
                            <span class="hljs-tag">&lt;/<span class="hljs-name">excludes</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">inputSchema</span>&gt;</span>public<span class="hljs-tag">&lt;/<span class="hljs-name">inputSchema</span>&gt;</span>  <span class="hljs-comment">&lt;!--  --&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">database</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">generate</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">records</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">records</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">generate</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>
                            <span class="hljs-comment">&lt;!--      --&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">packageName</span>&gt;</span>ru.xpendence.jooqexample.domain<span class="hljs-tag">&lt;/<span class="hljs-name">packageName</span>&gt;</span>
                            <span class="hljs-comment">&lt;!--  .    target. --&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>target/generated-sources/jooq<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">generator</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda melakukan semuanya dengan benar, perbarui Maven dan di antara plugin Anda akan melihat jooq-codegen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1n/ch/pv/1nchpvafnxml7qle_dfsq1zsuje.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menjalankannya. Ini akan menghasilkan entitas untuk Anda. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cs/kf/la/cskfla2pzxfkm-vkot_dcggqoia.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini adalah entitas yang akan Anda gunakan untuk mengakses database. Gangguan pertama: mereka tidak berubah. Yaitu, mereka bisa berubah, tetapi perubahan jenis terjadi sedemikian rupa sehingga deskripsi proses ini akan ditarik ke artikel terpisah. Oleh karena itu, cobalah untuk memikirkan jenis data pada tahap pembuatan tabel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entitas terlihat aneh. Di sini, misalnya, adalah tanda tangan dari kelas CountriesRecord:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CountriesRecord</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">UpdatableRecordImpl</span>&lt;<span class="hljs-title">CountriesRecord</span>&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title">Record4</span>&lt;<span class="hljs-title">Long</span>, <span class="hljs-title">String</span>, <span class="hljs-title">String</span>, <span class="hljs-title">Integer</span>&gt; </span>{
    <span class="hljs-comment">//...</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang bisa kita lihat, CountriesRecord mengimplementasikan Record4, yang diketik oleh 4 jenis. </font><font style="vertical-align: inherit;">Tabel negara memiliki 4 kolom, oleh karena itu Record4. </font><font style="vertical-align: inherit;">Ada 3 kolom di kota, jadi Record3. </font><font style="vertical-align: inherit;">Mengapa ini ditemukan, saya tidak tahu. </font><font style="vertical-align: inherit;">Ada 22 catatan seperti itu di perpustakaan JOOQ, Record1 ... Record22. </font><font style="vertical-align: inherit;">Dari mana kita dapat menyimpulkan bahwa kemampuan JOOQ terbatas pada pemrosesan tabel dengan maksimum 22 kolom, tetapi tidak demikian halnya. </font><font style="vertical-align: inherit;">Saya memiliki tabel dengan lusinan kolom, dan JOOQ segera mengimplementasikan Record. </font><font style="vertical-align: inherit;">Ya, itu ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menghasilkan entitas JOOQ dalam kode Java terlihat seperti ini:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AfterStartupApplicationListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ApplicationListener</span>&lt;<span class="hljs-title">ContextRefreshedEvent</span>&gt; </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Value("${spring.datasource.driver-class-name}")</span>
    <span class="hljs-keyword">private</span> String driver;<font></font>
<font></font>
    <span class="hljs-meta">@Value("${spring.datasource.url}")</span>
    <span class="hljs-keyword">private</span> String url;<font></font>
<font></font>
    <span class="hljs-meta">@Value("${spring.datasource.username}")</span>
    <span class="hljs-keyword">private</span> String username;<font></font>
<font></font>
    <span class="hljs-meta">@Value("${spring.datasource.password}")</span>
    <span class="hljs-keyword">private</span> String password;<font></font>
<font></font>
    <span class="hljs-meta">@Value("${jooq.generator.database.name}")</span>
    <span class="hljs-keyword">private</span> String databaseName;<font></font>
<font></font>
    <span class="hljs-meta">@Value("${jooq.generator.database.with-includes}")</span>
    <span class="hljs-keyword">private</span> String databaseWithIncludes;<font></font>
<font></font>
    <span class="hljs-meta">@Value("${jooq.generator.database.with-input-schema}")</span>
    <span class="hljs-keyword">private</span> String databaseWithInputSchema;<font></font>
<font></font>
    <span class="hljs-meta">@Value("${jooq.generator.target.package-name}")</span>
    <span class="hljs-keyword">private</span> String targetPackageName;<font></font>
<font></font>
    <span class="hljs-meta">@Value("${jooq.generator.target.directory}")</span>
    <span class="hljs-keyword">private</span> String targetDirectory;<font></font>
<font></font>
    <span class="hljs-meta">@SneakyThrows</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onApplicationEvent</span><span class="hljs-params">(ContextRefreshedEvent contextRefreshedEvent)</span> </span>{
        <span class="hljs-keyword">new</span> GenerationTool().run(configureGenerator());<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> Configuration <span class="hljs-title">configureGenerator</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Configuration()<font></font>
                .withJdbc(<span class="hljs-keyword">new</span> Jdbc()<font></font>
                        .withDriver(driver)<font></font>
                        .withUrl(url)<font></font>
                        .withUser(username)<font></font>
                        .withPassword(password))<font></font>
                .withGenerator(<span class="hljs-keyword">new</span> Generator()<font></font>
                        .withDatabase(<span class="hljs-keyword">new</span> Database()<font></font>
                                .withName(databaseName)<font></font>
                                .withIncludes(databaseWithIncludes)<font></font>
                                .withExcludes(<span class="hljs-string">""</span>)<font></font>
                                .withInputSchema(databaseWithInputSchema))<font></font>
                        .withTarget(<span class="hljs-keyword">new</span> Target()<font></font>
                                .withPackageName(targetPackageName)<font></font>
                                .withDirectory(targetDirectory)));<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam kasus saya, generator dimulai setelah aplikasi sepenuhnya dimulai, ketika semua migrasi baru digulung dan database diperbarui. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, kita punya model, kita punya entitas, kita punya basis. </font><font style="vertical-align: inherit;">Saatnya membuat repositori dan menulis kueri.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Buat Repositori</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semua permintaan melalui DslContext. </font><font style="vertical-align: inherit;">Ulangi DslContext.</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Repository</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CountryRepository</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">Country</span>&gt; </span>{<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DSLContext dsl;<font></font>
<font></font>
} </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Repositori sudah siap.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menulis Pertanyaan CRUD</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Memasukkan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika kami menggunakan SQL, permintaan untuk menambahkan negara lain adalah:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> countries(<span class="hljs-keyword">name</span>, government_form, population)
<span class="hljs-keyword">values</span> (<span class="hljs-string">' -'</span>, <span class="hljs-string">'UNITARY'</span>, <span class="hljs-number">100500</span>) <span class="hljs-keyword">returning</span> *;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di JOOQ, kueri sedekat mungkin dengan sintaks SQL:</font></font><br>
<br>
<pre><code class="java hljs">    <span class="hljs-function"><span class="hljs-keyword">public</span> Country <span class="hljs-title">insertValues</span><span class="hljs-params">(Country country)</span> </span>{
        <span class="hljs-keyword">return</span> dsl.insertInto(Countries.COUNTRIES)  <span class="hljs-comment">//insert into countries</span>
                .values(country.getId(), country.getName(), country.getPopulation(), nameOrNull(country.getGovernmentForm()))  <span class="hljs-comment">//values (? ? ? ?)</span>
                .returning()  <span class="hljs-comment">//returning</span>
                .fetchOne()  <span class="hljs-comment">//*</span><font></font>
                .into(Country.class);<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang kita lihat, tidak ada yang rumit. </font><font style="vertical-align: inherit;">Namun, permintaan semacam itu tidak sesuai dengan kami, karena dalam kasus kami ID dihasilkan dalam database dan kami harus mempertimbangkannya. </font><font style="vertical-align: inherit;">Jika kita menulis sesuatu seperti:</font></font><br>
<br>
<pre><code class="java hljs">.values(<span class="hljs-keyword">null</span>, country.getName(), country.getPopulation(), nameOrNull(country.getGovernmentForm()))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
kita akan mendapatkan </font></font><br>
<br>
<pre><code class="java hljs">org.postgresql.util.PSQLException: :     <span class="hljs-string">"id"</span>   NOT NULL</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Namun, jika kami membuat ID di sisi aplikasi, permintaan seperti itu akan menjadi tumpangan. </font><font style="vertical-align: inherit;">Kami harus menulis ulang permintaan, memberikan masing-masing bidang nilai tertentu. </font><font style="vertical-align: inherit;">Jadi kamu bisa:</font></font><br>
<br>
<pre><code class="java hljs">    <span class="hljs-function"><span class="hljs-keyword">public</span> Country <span class="hljs-title">insert</span><span class="hljs-params">(Country country)</span> </span>{
        <span class="hljs-keyword">return</span> dsl.insertInto(Countries.COUNTRIES)<font></font>
                .set(Countries.COUNTRIES.NAME, country.getName())<font></font>
                .set(Countries.COUNTRIES.POPULATION, country.getPopulation())<font></font>
                .set(Countries.COUNTRIES.GOVERNMENT_FORM, nameOrNull(country.getGovernmentForm()))<font></font>
                .returning()<font></font>
                .fetchOne()<font></font>
                .into(Country.class);<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam hal ini, kami secara manual mengatur objek di bidang. </font><font style="vertical-align: inherit;">Opsi ini cukup berhasil, tetapi ada yang lebih baik. </font><font style="vertical-align: inherit;">Akan ideal untuk mengirim seluruh objek untuk disimpan, seperti yang dilakukan di Spring Data JPA:</font></font><br>
<br>
<pre><code class="java hljs">repository.save(country);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bisa jadi begitu. </font><font style="vertical-align: inherit;">Untuk melakukan ini, kita perlu memetakan model kita ke entitas Record yang diperluas dan mengirimkannya untuk disimpan:</font></font><br>
<br>
<pre><code class="java hljs">    <span class="hljs-function"><span class="hljs-keyword">public</span> Country <span class="hljs-title">insert</span><span class="hljs-params">(Country country)</span> </span>{
        <span class="hljs-keyword">return</span> dsl.insertInto(Countries.COUNTRIES)<font></font>
                .set(dsl.newRecord(Countries.COUNTRIES, country))  <span class="hljs-comment">//   </span><font></font>
                .returning()<font></font>
                .fetchOptional()<font></font>
                .orElseThrow(() -&gt; <span class="hljs-keyword">new</span> DataAccessException(<span class="hljs-string">"Error inserting entity: "</span> + country.getId()))<font></font>
                .into(Country.class);<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode ini adalah yang paling sederhana dan paling dapat dipahami untuk kasus-kasus tersebut ketika kita tidak perlu mengkonfigurasi pemetaan. </font><font style="vertical-align: inherit;">Namun pengaturan pemetaan akan lebih rendah. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang kami perhatikan, permintaan ini mengembalikan seluruh entitas. </font><font style="vertical-align: inherit;">Anda dapat menentukan apa yang sebenarnya Anda butuhkan untuk kembali dalam metode fetch (). </font><font style="vertical-align: inherit;">Ini terlihat seperti ini:</font></font><br>
<br>
<pre><code class="java hljs">    <span class="hljs-function"><span class="hljs-keyword">public</span> Long <span class="hljs-title">insertAndReturnId</span><span class="hljs-params">(Country country)</span> </span>{
        <span class="hljs-keyword">return</span> dsl.insertInto(Countries.COUNTRIES)<font></font>
                .set(dsl.newRecord(Countries.COUNTRIES, country))<font></font>
                .returning(Countries.COUNTRIES.ID) <span class="hljs-comment">//  Record    - id</span><font></font>
                .fetchOptional()<font></font>
                .orElseThrow(() -&gt; <span class="hljs-keyword">new</span> DataAccessException(<span class="hljs-string">"Error inserting entity: "</span> + country.getId()))<font></font>
                .get(Countries.COUNTRIES.ID); <span class="hljs-comment">// id</span>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agak rumit, tapi, lagi, dengan apa yang harus dibandingkan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami akan menulis sisa metode CRUD.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Memperbarui</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Permintaan SQL:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">update</span> countries
<span class="hljs-keyword">set</span> <span class="hljs-keyword">name</span>            = <span class="hljs-string">''</span>,<font></font>
    government_form = <span class="hljs-string">'CONFEDERATE'</span>,<font></font>
    population      = <span class="hljs-number">100500</span>
<span class="hljs-keyword">where</span> <span class="hljs-keyword">id</span> = <span class="hljs-number">1</span>
<span class="hljs-keyword">returning</span> *;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Permintaan JOOQ:</font></font><br>
<br>
<pre><code class="java hljs">    <span class="hljs-function"><span class="hljs-keyword">public</span> Country <span class="hljs-title">update</span><span class="hljs-params">(Country country)</span> </span>{
        <span class="hljs-keyword">return</span> dsl.update(Countries.COUNTRIES)<font></font>
                .set(dsl.newRecord(Countries.COUNTRIES, country))<font></font>
                .where(Countries.COUNTRIES.ID.eq(country.getId()))<font></font>
                .returning()<font></font>
                .fetchOptional()<font></font>
                .orElseThrow(() -&gt; <span class="hljs-keyword">new</span> DataAccessException(<span class="hljs-string">"Error updating entity: "</span> + country.getId()))<font></font>
                .into(Country.class);<font></font>
    }</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pilih</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kueri dalam SQL adalah:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">select</span> *
<span class="hljs-keyword">from</span> countries c
<span class="hljs-keyword">where</span> <span class="hljs-keyword">id</span> = ?;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di JOOQ, kueri akan terlihat sesuai:</font></font><br>
<br>
<pre><code class="java hljs">    <span class="hljs-function"><span class="hljs-keyword">public</span> Country <span class="hljs-title">find</span><span class="hljs-params">(Long id)</span> </span>{
        <span class="hljs-keyword">return</span> dsl.selectFrom(Countries.COUNTRIES) <span class="hljs-comment">//select * from countries</span>
                .where(Countries.COUNTRIES.ID.eq(id))  <span class="hljs-comment">//where id = ?</span>
                .fetchAny()  <span class="hljs-comment">// ,    </span><font></font>
                .into(Country.class);<font></font>
    }</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menghapus</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada permintaan yang tidak ada balasannya. </font><font style="vertical-align: inherit;">Kueri tersebut mengembalikan jumlah baris yang terpengaruh. </font><font style="vertical-align: inherit;">Dalam menghapus, kami tidak memiliki apa pun untuk dikembalikan, tetapi informasi yang kami terima masih bermanfaat bagi kami.</font></font><br>
<br>
<pre><code class="java hljs">    <span class="hljs-function"><span class="hljs-keyword">public</span> Boolean <span class="hljs-title">delete</span><span class="hljs-params">(Long id)</span> </span>{
        <span class="hljs-keyword">return</span> dsl.deleteFrom(Countries.COUNTRIES)<font></font>
                .where(Countries.COUNTRIES.ID.eq(id))<font></font>
                .execute() == <span class="hljs-number">1</span>;<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menghapus satu baris. </font><font style="vertical-align: inherit;">Jadi query SQL akan mengembalikan sesuatu seperti:</font></font><br>
<br>
<pre><code class="sql hljs">1 row affected in 5 ms</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah menerima jawaban seperti itu, kami tahu pasti bahwa baris tersebut telah dihapus. </font><font style="vertical-align: inherit;">Ini akan cukup untuk menyatakan operasi berhasil.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Itu bukan dongeng. </font><font style="vertical-align: inherit;">Itu hanya pelumas. </font><font style="vertical-align: inherit;">Menggunakan maper biasa untuk pemetaan tipis suatu entitas dalam Record dan sebaliknya</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Oke," katamu, pembaca, "di mana satu-ke-banyak, emoe?" Sesuatu yang tidak saya lihat saat di mana Country tumbuh dengan banyak City. ‚Äù </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan kamu akan benar. Ini bukan Hibernate, di sini Anda harus secara manual. Yang perlu Anda lakukan adalah mendapatkan daftar Kota yang id = country.getId (). Saya sudah menunjukkan metode into (), yang menggunakan mapper biasa untuk memetakan Rekaman ke entitas. Tetapi JOOQ memiliki metode map () tambahan yang memungkinkan kita melakukan apa pun yang kita inginkan dengan Record. Mari kita lihat fungsinya dan tambahkan penambahan kota:</font></font><br>
<br>
<pre><code class="java hljs">    <span class="hljs-function"><span class="hljs-keyword">public</span> Country <span class="hljs-title">find</span><span class="hljs-params">(Long id)</span> </span>{
        <span class="hljs-keyword">return</span> dsl.selectFrom(Countries.COUNTRIES)<font></font>
                .where(Countries.COUNTRIES.ID.eq(id))<font></font>
                .fetchAny()<font></font>
                .map(r -&gt; {<font></font>
                    Country country = r.into(Country.class);<font></font>
                    country.setCities(cityRepository.findAll(Cities.CITIES.COUNTRY_ID.eq(country.getId())));<font></font>
                    <span class="hljs-keyword">return</span> country;<font></font>
                });<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang kita lihat, sekarang kita pertama-tama memetakan Catatan di Negara, dan kemudian kita membuat permintaan lain di kota-kota, kita mendapatkan semua Kota untuk Negara ini dan mengaturnya menjadi esensi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi bisa ada puluhan set seperti itu, yang berarti bisa ada puluhan permintaan. </font><font style="vertical-align: inherit;">Dan untuk menggambarkan permintaan ini secara langsung dalam metode seperti itu. </font><font style="vertical-align: inherit;">Solusi yang benar adalah dengan menulis mapper terpisah dan meletakkan semua permintaan ini di sana.</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CountryRecordMapper</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">RecordMapper</span>&lt;<span class="hljs-title">CountriesRecord</span>, <span class="hljs-title">Country</span>&gt; </span>{<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CityRepository cityRepository;<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Country <span class="hljs-title">map</span><span class="hljs-params">(CountriesRecord record)</span> </span>{<font></font>
        Country country = record.into(Country.class);<font></font>
        country.setCities(cityRepository.findAll(Cities.CITIES.COUNTRY_ID.eq(country.getId())));<font></font>
        <span class="hljs-keyword">return</span> country;<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kueri sekarang akan terlihat seperti ini:</font></font><br>
<br>
<pre><code class="java hljs">    <span class="hljs-function"><span class="hljs-keyword">public</span> Country <span class="hljs-title">findWithCustomMapper</span><span class="hljs-params">(Long id)</span> </span>{
        <span class="hljs-keyword">return</span> dsl.selectFrom(Countries.COUNTRIES)<font></font>
                .where(Countries.COUNTRIES.ID.eq(id))<font></font>
                .fetchAny()<font></font>
                .map(r -&gt; countryRecordMapper.map((CountriesRecord) r));<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Itu lebih ringkas, dan tidak mengandung logika tambahan.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oke, kami belajar cara memetakan Rekaman ke entitas, tetapi bagaimana dengan menyempurnakan pemetaan entitas di Record?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sejauh ini kami memiliki desain ini:</font></font><br>
<br>
<pre><code class="java hljs">.set(dsl.newRecord(Countries.COUNTRIES, country))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sudah bagus, tetapi bagaimana jika kita perlu memetakan bidang secara khusus? </font><font style="vertical-align: inherit;">Sebagai contoh, kita memiliki LocalDateTime di sana, dan generator untuk PostgreSQL seperti Timestamp menghasilkan OffsetDateTime. </font><font style="vertical-align: inherit;">Dalam kasus ini, bidang tidak akan dipetakan dan tidak direkam dalam database. </font><font style="vertical-align: inherit;">Untuk kasus seperti itu, kita akan membutuhkan mapper lain yang akan melakukan hal yang sama, tetapi dalam arah yang berlawanan.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ya, untuk setiap mapper, kami memiliki mapper</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dia disebut itu. </font><font style="vertical-align: inherit;">Mari kita tulis ahli warisnya.</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Component</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CountryRecordUnmapper</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">RecordUnmapper</span>&lt;<span class="hljs-title">Country</span>, <span class="hljs-title">CountriesRecord</span>&gt; </span>{<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DSLContext dsl;<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> CountriesRecord <span class="hljs-title">unmap</span><span class="hljs-params">(Country country)</span> <span class="hljs-keyword">throws</span> MappingException </span>{<font></font>
        CountriesRecord record = dsl.newRecord(Countries.COUNTRIES, country);<font></font>
        record.setPopulation(-<span class="hljs-number">1</span>);
        <span class="hljs-keyword">return</span> record;<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Masukkan dengan aplikasinya akan terlihat seperti ini:</font></font><br>
<br>
<pre><code class="java hljs">    <span class="hljs-function"><span class="hljs-keyword">public</span> Country <span class="hljs-title">insertWithUnmapper</span><span class="hljs-params">(Country country)</span> </span>{
        <span class="hljs-keyword">return</span> dsl.insertInto(Countries.COUNTRIES)<font></font>
                .set(countryRecordUnmapper.unmap(country))<font></font>
                .returning()<font></font>
                .fetchOptional()<font></font>
                .orElseThrow(() -&gt; <span class="hljs-keyword">new</span> DataAccessException(<span class="hljs-string">"Error inserting entity: "</span> + country.getId()))<font></font>
                .into(Country.class);<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang kita lihat, juga cukup.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kesimpulan dan Kesimpulan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara pribadi, saya lebih suka Hibernate. </font><font style="vertical-align: inherit;">Mungkin, untuk 90+% aplikasi penggunaannya akan lebih dibenarkan. </font><font style="vertical-align: inherit;">Tetapi jika Anda, pembaca, ingin mengontrol setiap permintaan, JOOQ atau perpustakaan serupa lainnya lebih cocok untuk Anda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti biasa, saya memposting proyek pelatihan. </font><font style="vertical-align: inherit;">Dia berbaring di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id488498/index.html">Laboratorium Universitas ITMO: Pencahayaan LED, optoelektronika gelombang mikro, dan telekomunikasi optik</a></li>
<li><a href="../id488504/index.html">Kami menghubungkan kalender produksi di Zabbix</a></li>
<li><a href="../id488514/index.html">Android Remote Debugger - debugging aplikasi Android jarak jauh</a></li>
<li><a href="../id488516/index.html">Panduan tag iframe lengkap</a></li>
<li><a href="../id488518/index.html">Tinjauan komparatif dari e-book ONYX BOOX Livingstone dan Amazon Kindle Paperwhite (2018)</a></li>
<li><a href="../id488528/index.html">Menggunakan mekanisme token kriptografi PKCS # 11 pada platform Android</a></li>
<li><a href="../id488530/index.html">Apa itu reaktivitas?</a></li>
<li><a href="../id488534/index.html">Lampu UV DIY 400-405 nm untuk polimerisasi model photopolymer 3D</a></li>
<li><a href="../id488536/index.html">Pikirkan baik-baik sebelum menggunakan Docker-in-Docker untuk CI atau lingkungan pengujian.</a></li>
<li><a href="../id488540/index.html">Pistol Gauss</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>