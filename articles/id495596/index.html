<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©â€ğŸ³ ğŸ‡ğŸ¿ ğŸ‘“ Pekerjaan jauh di kantor. RDP, Port Knocking, Mikrotik: sederhana dan aman ğŸ”¥ ğŸ‘¨ğŸ¼â€ğŸ¨ ğŸ¤˜ğŸ¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sehubungan dengan pandemi virus covid-19 dan karantina universal di banyak negara, satu-satunya jalan keluar dari banyak perusahaan untuk terus bekerj...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Pekerjaan jauh di kantor. RDP, Port Knocking, Mikrotik: sederhana dan aman</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495596/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sehubungan dengan pandemi virus covid-19 dan karantina universal di banyak negara, satu-satunya jalan keluar dari banyak perusahaan untuk terus bekerja adalah akses jarak jauh ke pekerjaan melalui Internet. Ada banyak metode yang relatif aman untuk pekerjaan jarak jauh - tetapi mengingat skala masalahnya, Anda memerlukan metode sederhana bagi pengguna mana pun untuk terhubung dari jarak jauh ke kantor dan tanpa perlu pengaturan tambahan, penjelasan, konsultasi yang membosankan dan instruksi panjang. Metode ini adalah favorit banyak admin RDP (Remote Desktop Protocol). Menghubungkan langsung ke tempat kerja melalui RDP idealnya memecahkan masalah kita, kecuali satu lompatan besar dalam salep - menjaga port RDP terbuka untuk Internet sangat tidak aman. Oleh karena itu, di bawah ini saya mengusulkan metode perlindungan yang sederhana namun dapat diandalkan.</font></font><img src="https://habrastorage.org/webt/yv/o3/ut/yvo3utx5cj_wwte6jja-pe6swfw.jpeg" alt="gambar"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Karena saya sering menjumpai organisasi kecil di mana perangkat Mikrotik digunakan sebagai akses Internet, maka akan diperlihatkan di bawah ini bagaimana menerapkan ini pada Mikrotik, tetapi metode perlindungan Port Knocking mudah diimplementasikan pada perangkat kelas tinggi lainnya dengan pengaturan yang sama untuk input router dan firewall </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Secara singkat tentang Port Knocking</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Perlindungan eksternal yang ideal untuk jaringan yang terhubung ke Internet adalah ketika semua sumber daya dan porta ditutup secara eksternal oleh firewall. Dan meskipun router dengan firewall yang dikonfigurasikan tidak bereaksi dengan cara apa pun terhadap paket yang datang dari luar, ia tetap mendengarkannya. Oleh karena itu, Anda dapat mengkonfigurasi router sehingga ketika Anda menerima urutan (kode) tertentu dari paket jaringan pada port yang berbeda, itu (router) untuk IP dari mana paket berasal membuka akses ke sumber daya tertentu (port, protokol, dll.).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang to the point. </font><font style="vertical-align: inherit;">Saya tidak akan melakukan deskripsi terperinci tentang pengaturan firewall di Mikrotik - Internet penuh dengan sumber berkualitas tinggi untuk ini. </font><font style="vertical-align: inherit;">Idealnya, firewall memblokir semua paket yang masuk, tetapi</font></font><br>
 <br>
<pre><code class="plaintext hljs">/ip firewall filter<font></font>
add action=accept chain=input comment="established and related accept" connection-state=established,related</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mengizinkan lalu lintas masuk dari koneksi yang dibuat (terkait). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang konfigurasikan Port Knocking di Mikrotik:</font></font><br>
<br>
<pre><code class="plaintext hljs">/ip firewall filter<font></font>
add action=drop chain=input dst-port=19000 protocol=tcp src-address-list="Black_scanners" comment=RemoteRules<font></font>
add action=drop chain=input dst-port=16000 protocol=tcp src-address-list="Black_scanners" comment=RemoteRules<font></font>
add action=add-src-to-address-list address-list="remote_port_1" address-list-timeout=1m chain=input dst-port=19000 protocol=tcp comment=RemoteRules<font></font>
add action=add-src-to-address-list address-list="Black_scanners" address-list-timeout=60m chain=input dst-port=19001 protocol=tcp src-address-list="remote_port_1" comment=RemoteRules<font></font>
add action=add-src-to-address-list address-list="Black_scanners" address-list-timeout=60m chain=input dst-port=18999 protocol=tcp src-address-list="remote_port_1" comment=RemoteRules<font></font>
add action=add-src-to-address-list address-list="Black_scanners" address-list-timeout=60m chain=input dst-port=16001 protocol=tcp src-address-list="remote_port_1" comment=RemoteRules<font></font>
add action=add-src-to-address-list address-list="Black_scanners" address-list-timeout=60m chain=input dst-port=15999 protocol=tcp src-address-list="remote_port_1" comment=RemoteRules<font></font>
add action=add-src-to-address-list address-list="allow_remote_users" address-list-timeout=1m chain=input dst-port=16000 protocol=tcp src-address-list="remote_port_1" comment=RemoteRules<font></font>
move [/ip firewall filter find comment=RemoteRules] 1<font></font>
/ip firewall nat<font></font>
add action=dst-nat chain=dstnat comment="remote_rdp" src-address-list="allow_remote_users" dst-port=33890 in-interface-list=WAN protocol=tcp to-addresses=192.168.1.33 to-ports=3389</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang lebih banyak: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
dua aturan pertama</font></font><br>
<br>
<pre><code class="plaintext hljs">/ip firewall filter<font></font>
add action=drop chain=input dst-port=19000 protocol=tcp src-address-list="Black_scanners" comment=RemoteRules<font></font>
add action=drop chain=input dst-port=16000 protocol=tcp src-address-list="Black_scanners" comment=RemoteRules</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
melarang paket masuk dari alamat IP yang masuk daftar hitam saat memindai port; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aturan ketiga:</font></font><br>
<br>
<pre><code class="plaintext hljs">add action=add-src-to-address-list address-list="remote_port_1" address-list-timeout=1m chain=input dst-port=19000 protocol=tcp comment=RemoteRules</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menambahkan ip ke daftar host yang membuat ketukan pertama yang benar pada port yang diinginkan (19000); </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Empat aturan berikut:</font></font><br>
<br>
<pre><code class="plaintext hljs">add action=add-src-to-address-list address-list="Black_scanners" address-list-timeout=60m chain=input dst-port=19001 protocol=tcp src-address-list="remote_port_1" comment=RemoteRules<font></font>
add action=add-src-to-address-list address-list="Black_scanners" address-list-timeout=60m chain=input dst-port=18999 protocol=tcp src-address-list="remote_port_1" comment=RemoteRules<font></font>
add action=add-src-to-address-list address-list="Black_scanners" address-list-timeout=60m chain=input dst-port=16001 protocol=tcp src-address-list="remote_port_1" comment=RemoteRules<font></font>
add action=add-src-to-address-list address-list="Black_scanners" address-list-timeout=60m chain=input dst-port=15999 protocol=tcp src-address-list="remote_port_1" comment=RemoteRules</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
buat port jebakan bagi mereka yang ingin memindai port Anda, dan ketika upaya tersebut terdeteksi, masukkan ip mereka ke daftar hitam selama 60 menit, di mana selama dua aturan pertama akan mencegah host tersebut mengetuk port yang benar; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aturan berikut:</font></font><br>
<br>
<pre><code class="plaintext hljs">add action=add-src-to-address-list address-list="allow_remote_users" address-list-timeout=1m chain=input dst-port=16000 protocol=tcp src-address-list="remote_port_1" comment=RemoteRules</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
menempatkan ip dalam daftar diizinkan selama 1 menit (cukup untuk membuat koneksi), karena ketukan kedua yang benar dilakukan ke port yang diinginkan (16000); </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perintah selanjutnya:</font></font><br>
<br>
<pre><code class="plaintext hljs">move [/ip firewall filter find comment=RemoteRules] 1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
memindahkan aturan kita ke atas rantai pemrosesan firewall, karena kemungkinan besar kita sudah memiliki aturan larangan yang berbeda yang dikonfigurasi yang akan mencegah aturan yang baru kita buat untuk bekerja. Aturan pertama di Mikrotik dimulai dari nol, tetapi di perangkat saya nol ditempati oleh aturan bawaan dan tidak mungkin untuk dipindahkan - saya pindah ke 1. Oleh karena itu, kami melihat pengaturan kami - di mana Anda dapat memindahkan dan menentukan nomor yang diinginkan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pengaturan berikut:</font></font><br>
<br>
<pre><code class="plaintext hljs">/ip firewall nat<font></font>
add action=dst-nat chain=dstnat comment="remote_rdp_to_33" src-address-list="allow_remote_users" dst-port=33890 in-interface-list=WAN protocol=tcp to-addresses=192.168.1.33 to-ports=3389</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
meneruskan port 33890 yang dipilih secara acak ke port RDP biasa 3389 dan ip dari komputer atau terminal server yang kita butuhkan. </font><font style="vertical-align: inherit;">Kami membuat aturan seperti itu untuk semua sumber daya internal yang diperlukan, lebih disukai mengekspos port eksternal non-standar (dan berbeda). </font><font style="vertical-align: inherit;">Secara alami, ip sumber daya internal harus statis atau diamankan ke server DHCP. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang Mikrotik kami telah dikonfigurasi dan kami memerlukan prosedur sederhana bagi pengguna untuk terhubung ke RDP internal kami. </font><font style="vertical-align: inherit;">Karena kami memiliki sebagian besar pengguna Windows, kami membuat file bat sederhana dan menyebutnya StartRDP.bat:</font></font><br>
<br>
<pre><code class="plaintext hljs">1.htm<font></font>
1.rdp</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sesuai 1.htm berisi kode berikut:</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"http://my_router.sn.mynetname.net:19000/1.jpg"</span>&gt;</span><font></font>
       RDP<font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"http://my_router.sn.mynetname.net:16000/2.jpg"</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 itu berisi dua tautan ke gambar imajiner yang terletak di alamat my_router.sn.mynetname.net - kami mengambil alamat ini dari sistem DDNS Mikrotik dengan pra-mengaktifkannya di Mikrotik kami: buka IP-&gt; menu Cloud - centang kotak DDNS Diaktifkan, klik kotak centang Diaktifkan DDNS, klik Terapkan dan salin nama dns dari router kami. Tetapi ini hanya diperlukan ketika ip eksternal router dinamis atau konfigurasi dengan beberapa penyedia Internet digunakan.</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Port di tautan pertama: 19000 sesuai dengan port pertama tempat Anda perlu mengetuk, di kedua, masing-masing, yang kedua. Di antara tautan ada instruksi singkat yang menunjukkan apa yang harus dilakukan jika tiba-tiba koneksi kami terputus karena masalah jaringan pendek - kami menyegarkan halaman, port RDP terbuka untuk kami lagi selama 1 menit dan sesi kami dipulihkan. Juga, teks di antara tag img membentuk penundaan mikro untuk browser, yang mengurangi kemungkinan paket pertama dikirim ke port kedua (16000) - sejauh ini tidak ada kasus seperti itu dalam dua minggu penggunaan (30 orang). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berikutnya adalah file 1.rdp, yang dapat kita konfigurasikan satu untuk semua atau secara terpisah untuk setiap pengguna (saya melakukannya - lebih mudah untuk menghabiskan 15 menit tambahan daripada beberapa jam untuk berkonsultasi dengan mereka yang tidak bisa mengetahuinya)</font></font><br>
<br>
<pre><code class="plaintext hljs">screen mode id:i:2<font></font>
use multimon:i:1<font></font>
.....<font></font>
connection type:i:6<font></font>
networkautodetect:i:0<font></font>
.....<font></font>
disable wallpaper:i:1<font></font>
.....<font></font>
full address:s:my_router.sn.mynetname.net:33890<font></font>
.....<font></font>
username:s:myuserlogin<font></font>
domain:s:mydomain</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pengaturan menarik di sini menggunakan multimon: i: 1 - ini termasuk penggunaan beberapa monitor - beberapa memerlukannya, tetapi mereka tidak akan berpikir untuk menyalakannya sendiri. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
jenis koneksi: i: 6 dan deteksi jaringan: i: 0 - karena sebagian besar Internet di atas 10 Mbps, kemudian nyalakan tipe koneksi 6 (jaringan lokal 10Mbps ke atas) dan nonaktifkan deteksi jaringan, karena jika itu (otomatis) secara default, maka itu bahkan jarang terjadi keterlambatan jaringan secara otomatis menetapkan kecepatan yang diremehkan untuk sesi kami, yang dapat membuat penundaan nyata dalam pekerjaan, terutama dalam program grafik. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
nonaktifkan wallpaper: i: 1 - nonaktifkan </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
username </font><font style="vertical-align: inherit;">gambar desktop </font><font style="vertical-align: inherit;">: s: myuserlogin - tentukan nama pengguna, karena sebagian besar pengguna kami tidak tahu nama pengguna mereka</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
domain: s: mydomain - tentukan domain atau nama komputer </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi jika kita ingin menyederhanakan tugas membuat prosedur koneksi, kita juga dapat menggunakan PowerShell - StartRDP.ps1</font></font><br>
<br>
<pre><code class="plaintext hljs">Test-NetConnection -ComputerName my_router.sn.mynetname.net -Port 19000<font></font>
Test-NetConnection -ComputerName my_router.sn.mynetname.net -Port 16000<font></font>
mstsc /v:my_router.sn.mynetname.net:33890</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Juga sedikit tentang klien RDP di Windows: MS telah berupaya keras untuk mengoptimalkan protokol dan sisi server dan kliennya, telah menerapkan banyak fitur yang bermanfaat - seperti bekerja dengan perangkat keras 3D, mengoptimalkan resolusi layar untuk monitor Anda, multi-layar, dan banyak lagi. Tetapi tentu saja, semuanya diimplementasikan dalam mode kompatibilitas ke belakang dan jika klien adalah Windows 7 dan PC jarak jauh adalah Windows 10, maka RDP akan bekerja menggunakan protokol versi 7.0. Tetapi manfaatnya adalah Anda dapat memutakhirkan versi RDP ke versi yang lebih baru - misalnya, Anda dapat memutakhirkan versi protokol dari 7.0 (Windows 7) ke 8.1. Oleh karena itu, untuk kenyamanan klien, perlu untuk memaksimalkan versi sisi server, serta membuang tautan untuk memutakhirkan ke versi baru klien protokol RDP.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai hasilnya, kami memiliki teknologi sederhana dan relatif aman untuk koneksi jarak jauh ke PC atau server terminal yang berfungsi. </font><font style="vertical-align: inherit;">Tetapi untuk koneksi yang lebih aman, metode Port Knocking kami dapat menjadi rumit untuk serangan dengan beberapa urutan besarnya, dengan menambahkan port untuk memeriksa - Anda dapat menambahkan 3,4,5,6 ... logika yang sama dan dalam hal ini intrusi langsung ke jaringan Anda hampir tidak mungkin . </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">File kosong untuk membuat koneksi jarak jauh ke RDP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id495576/index.html">Platform self-propelled pada esp8266 MK dengan micropython</a></li>
<li><a href="../id495580/index.html">Mentimun JVM - Bukan Hanya BDD</a></li>
<li><a href="../id495588/index.html">Membuat roguelike di Unity dari awal: generator penjara bawah tanah</a></li>
<li><a href="../id495592/index.html">Cara menggunakan kamus (dan tidak hanya)</a></li>
<li><a href="../id495594/index.html">Mulailah menghasilkan uang dari perangkat lunak: menciptakan bisnis mini-digital</a></li>
<li><a href="../id495602/index.html">Dimulai dengan Data Inti! Sulit dalam kata-kata sederhana [Bagian 2]</a></li>
<li><a href="../id495604/index.html">Lokalisasi sementara pada Symfony 4 + Twig</a></li>
<li><a href="../id495606/index.html">"Pemantauan sosial." Skor 1: 0 menguntungkan kita</a></li>
<li><a href="../id495608/index.html">[Infografis] Visualisasi pandemi dalam sejarah umat manusia</a></li>
<li><a href="../id495610/index.html">Mengapa masa depan bukan untuk Python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>