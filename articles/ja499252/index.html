<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📛 🚲 🗄️ 疑似3次元レーシングゲームの作成 👩🏽‍🎤 📑 🤑</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="子供の頃、私はアーケードアーケードホールにめったに行きませんでした。なぜなら、実際にはそれらを必要としなかったからです。なぜなら、自宅ではC64の素晴らしいゲームがあったからです...しかし、常にお金を持っていた3つのアーケードゲームがありました-ドンキーコング、ドラゴンズレア、アウトラン... 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>疑似3次元レーシングゲームの作成</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/499252/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d16/6e3/cff/d166e3cff9c2a3cefeb68f5c1ddc02d1.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
子供の頃、私はアーケードアーケードホールにめったに行きませんでした。なぜなら、実際にはそれらを必要としなかったからです。なぜなら、自宅ではC64の素晴らしいゲームがあったからです...しかし、常にお金を持っていた3つのアーケードゲームがありました-ドンキーコング、ドラゴンズレア、アウトラン... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...そして、C64の弱いバージョンでも、スピード、丘、ヤシの木、音楽など、Outrunは本当に気に入りました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/48e/aee/56f/48eaee56f43d8a25e840c6ae13268db4.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そこで私は、アウトラン、ピットストップ、またはポールポジションのスタイルで、昔ながらの疑似3次元レーシングゲームを書いてみることにしました。</font><font style="vertical-align: inherit;">私は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完全な</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゲームを</font><font style="vertical-align: inherit;">完全にまとめるつもりはありません</font><font style="vertical-align: inherit;">が、これらのゲームがトリックを実現したメカニズムを再検討することは興味深いと</font><font style="vertical-align: inherit;">思います</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">曲線、丘、スプライト、そしてスピード感... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
だから、これが最終的に週末に5〜6週間かかった私の「週末プロジェクト」です。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7ec/27b/d28/7ec27bd28630dbbaf7b81c87233c28ac.png"></div><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゲームをする</font></font></a></li>
<li><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ソースコードを</font></a><font style="vertical-align: inherit;">見る</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プレイ可能なバージョンは、実際のゲームというよりはテクニカルデモに似ています。</font><font style="vertical-align: inherit;">実際、本物の疑似3次元のレースを作成したい場合、これは、徐々にゲームに変えるために必要な最低限の基盤になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
洗練されていません、少し醜いですが、完全に機能します。</font><font style="vertical-align: inherit;">自分で実装する方法を4つの簡単なステップで示します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あなたも遊ぶことができます</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接道路のデモ</font></font></a></li>
<li><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">カーブの</font></a><font style="vertical-align: inherit;">ある</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デモで</font></font></a></li>
<li><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">丘</font></a><font style="vertical-align: inherit;">の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デモで</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完成版</font></font></a></li>
</ul><a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パフォーマンスについて</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このゲームのパフォーマンスは</font><font style="vertical-align: inherit;">、マシン/ブラウザー</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に大きく</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">依存します。</font><font style="vertical-align: inherit;">最近のブラウザーでは、特にキャンバスGPUアクセラレーションを備えたブラウザーではうまく機能しますが、悪いグラフィックスドライバーが原因でフリーズする可能性があります。</font><font style="vertical-align: inherit;">ゲームでは、レンダリング解像度とレンダリング距離を変更できます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コード構造について</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たまたま、プロジェクトはJavascriptで実装された（プロトタイピングが単純なため）が、Javascriptの手法や推奨手法を示すことは意図されていません。</font><font style="vertical-align: inherit;">実際、理解を容易にするために、各例のJavaScriptはHTMLページに直接埋め込まれています（ホラー！）。</font><font style="vertical-align: inherit;">さらに悪いことに、それはグローバル変数と関数を使用します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際のゲームを作成する場合、コードははるかに構造化されて合理化されますが、これはレーシングゲームのテクニカルデモなので、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KISS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用することにしました</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート1.まっすぐな道路。</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それでは、疑似3次元のレーシングゲームの作成をどのように始めますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まあ、私たちは必要です</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">三角法を繰り返す</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3Dプロジェクションの基本を思い出してください</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゲームループを作成する</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スプライト画像をダウンロードする</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">道路ジオメトリを構築する</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背景をレンダリング</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">道路をレンダリングする</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">車をレンダリングする</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">機械制御用のキーボードサポートを実装する</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、始める前に、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Louの疑似3dページ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">翻訳</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Habré]を</font><font style="vertical-align: inherit;">読んでみましょう</font><font style="vertical-align: inherit;">。psevdotrohmernuyuレーシングゲームの作成方法に関する唯一の情報源（私が見つけたもの）です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ルーの記事を読み終えましたか？</font><font style="vertical-align: inherit;">いいね！</font><font style="vertical-align: inherit;">3D投影セグメントテクニックを使用して、彼のリアルな丘のバリエーションを作成します。</font><font style="vertical-align: inherit;">これを次の4つのパートで徐々に行います。</font><font style="vertical-align: inherit;">ただし、バージョンv1から始めて、HTML5のcanvas要素に投影することで、非常に単純な直線道路ジオメトリを作成します。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デモは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で見ることができ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font></blockquote><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">少し三角法</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実装に入る前に、三角法の基本を使用して、3Dワールドのポイントを2D画面に投影する方法を覚えておきましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最も単純なケースでは、ベクトルや行列に触れない場合、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">類似した三角形</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の法則が3D投影に使用され</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の表記を使用します。</font></font><br>
<br>
<ul>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> =カメラの高さ</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> =カメラから画面までの距離</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">z</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> =カメラから車までの距離</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> =画面の</font><strong><font style="vertical-align: inherit;">y</font></strong><font style="vertical-align: inherit;">座標</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、同様の三角形の法則を使用して計算できます </font></font><br>
<br>
<blockquote><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y = h * d / z</font></font></strong></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
図に示すように：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/949/0ab/47b/9490ab47bb570b61218e46e5913c18bb.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、側面図ではなく上面図に同様の図を描画し、</font><font style="vertical-align: inherit;">画面の</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">X</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">座標を計算するために同様の方程式を導き出すこともでき</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<blockquote><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x = w * d / z</font></font></strong></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> =道路の幅の半分（カメラから道路の端まで）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のように、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">について、係数でスケーリングします</font></font><br>
<br>
<blockquote><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d / z</font></font></strong></blockquote><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">座標系</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ダイアグラムの形式では、見た目は美しくシンプルですが、コーディングを開始するときに少し混乱する可能性があります。これは、任意の名前を選択したためです。また、3Dワールドの座標と2D画面の座標が何であるかが明確ではありません。</font><font style="vertical-align: inherit;">また、カメラは世界の原点の中心にあると想定しますが、実際にはカメラを追跡します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
より正式にアプローチする場合は、以下を実行する必要があります。</font></font><br>
<br>
<ol>
<li><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">世界座標から画面座標への</font><strong><font style="vertical-align: inherit;">変換</font></strong></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">突出</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正規化投影面にカメラ座標</font></font></li>
<li><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">投影された座標を物理画面の座標に</font><strong><font style="vertical-align: inherit;">スケーリングする</font></strong><font style="vertical-align: inherit;">（この場合、これはキャンバスです）</font></font></li>
</ol><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b59/5d2/30f/b595d230f4f45b9b0c9409266d5804d8.png"></div><br>
<blockquote><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：現在の3Dシステム</font><font style="vertical-align: inherit;">では、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回転</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステージはステージ1と2の間で実行されます</font><font style="vertical-align: inherit;">が、カーブをシミュレートするため、回転は必要ありません。</font></font></em></blockquote><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">投影</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
形式的な射影方程式は、次のように表すことができます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/edb/246/e18/edb246e187e7fe0eb027b53c58790c34.png"></div><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変換方程式（</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変換</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）ポイントは、チャンバーを基準に計算されます</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">射影方程式（</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）は、上記の「相似三角形の法則」の変形です。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スケーリング方程式（</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">scale</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）では、以下の違いを考慮に入れます。</font></font><br>
<ul>
<li><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">math</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ここで、0,0は中央にあり、y軸は上にあり、</font></font></li>
<li><em></em>,  0,0     ,   y  :</li>
</ul></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/11f/050/aad/11f050aadea0d1c537baefcb06f7c2f0.png"></div><br>
<blockquote><em>:   3d-         <code>Vector</code>  <code>Matrix</code>     3d-,      ,      WebGL (  )…       .           Outrun.</em></blockquote><br>
<h2>  </h2><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3b7/27b/1bd/3b727b1bdb285d874bd659c29db13522.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パズルの最後のピースは、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d-</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カメラから投影面までの距離</font><font style="vertical-align: inherit;">を計算する方法になります</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ハードセット値</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dを</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">書き込むだけでなく</font><font style="vertical-align: inherit;">、目的の垂直方向の視野から計算する方が便利です。</font><font style="vertical-align: inherit;">これにより、必要に応じてカメラを「ズーム」することができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
座標が-1から+1の範囲にある正規化された投影面に投影していると仮定すると、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は次のように計算できます。</font></font><br>
<br>
<blockquote><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = 1 / tan（fov / 2）</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（多くの）変数の1つとして</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fov</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><strong><font style="vertical-align: inherit;">定義する</font></strong><font style="vertical-align: inherit;"> 
ことにより</font><font style="vertical-align: inherit;">、スコープを調整してレンダリングアルゴリズムを微調整できます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaScriptコードの構造</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事の冒頭で、コードはJavascriptを作成するためのガイドラインに完全には準拠していないことをすでに述べました。これは、単純なグローバル変数と関数を使用した「迅速かつダーティ」なデモです。</font><font style="vertical-align: inherit;">ただし、4つの異なるバージョン（ストレート、カーブ、ヒル、スプライト）を作成するので</font></font><code>common.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、次のモジュール内に</font><font style="vertical-align: inherit;">いくつかの再利用可能なメソッドを格納し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<ul>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dom</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、いくつかのマイナーなDOMヘルパー関数です。</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Util-</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一般的なユーティリティ、主に補助的な数学関数。</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゲーム</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -画像ダウンローダーやゲームループなどの一般的なゲームサポート機能。</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レンダリング</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -キャンバス上のヘルパーレンダリング関数。</font></font></li>
</ul><br><font style="vertical-align: inherit;"></font><code>common.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それらがゲーム自体に関係し、単なる補助的な数学またはDOM関数ではない場合にのみ、</font><font style="vertical-align: inherit;">
メソッドを詳細に説明し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">名前とコンテキストからうまくいけば、メソッドが何をすべきか明確になります。</font></font><br>
<br>
<blockquote><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いつものように、ソースコードは最終的なドキュメントにあります。</font></font></em></blockquote><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">単純なゲームループ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
何かをレンダリングする前に、ゲームループが必要です。</font><font style="vertical-align: inherit;">ゲームに関する以前の記事（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ピンポン</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブレイクアウト</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テトリス</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヘビ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ボルダーダッシュ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）を</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">読んだら</font></a><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">固定タイムステップ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の私のお気に入りのゲームサイクルの例を既に見たことがあるでしょう</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
詳細については説明しません。前のゲームのコードの一部を再利用して、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requestAnimationFrame</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用して固定タイムステップのゲームループを作成し</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
原則は、私の4つの例のそれぞれが</font></font><code>Game.run(...)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">独自のバージョンを</font><font style="vertical-align: inherit;">呼び出し</font><font style="vertical-align: inherit;">て使用</font><font style="vertical-align: inherit;">できること</font><font style="vertical-align: inherit;">です。</font></font><br>
<br>
<ul>
<li><code>update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -一定の時間ステップでゲームの世界を更新します。</font></font></li>
<li><code>render</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -ブラウザが許可するときにゲームの世界を更新します。</font></font></li>
</ul><br>
<pre><code class="javascript hljs">run: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">options</span>) </span>{<font></font>
<font></font>
  Game.loadImages(options.images, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">images</span>) </span>{<font></font>
<font></font>
    <span class="hljs-keyword">var</span> update = options.update,    <span class="hljs-comment">// method to update game logic is provided by caller</span>
        render = options.render,    <span class="hljs-comment">// method to render the game is provided by caller</span>
        step   = options.step,      <span class="hljs-comment">// fixed frame step (1/fps) is specified by caller</span>
        now    = <span class="hljs-literal">null</span>,<font></font>
        last   = Util.timestamp(),<font></font>
        dt     = <span class="hljs-number">0</span>,<font></font>
        gdt    = <span class="hljs-number">0</span>;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">frame</span>(<span class="hljs-params"></span>) </span>{<font></font>
      now = Util.timestamp();<font></font>
      dt  = <span class="hljs-built_in">Math</span>.min(<span class="hljs-number">1</span>, (now - last) / <span class="hljs-number">1000</span>); <span class="hljs-comment">// using requestAnimationFrame have to be able to handle large delta's caused when it 'hibernates' in a background or non-visible tab</span><font></font>
      gdt = gdt + dt;<font></font>
      <span class="hljs-keyword">while</span> (gdt &gt; step) {<font></font>
        gdt = gdt - step;<font></font>
        update(step);<font></font>
      }<font></font>
      render();<font></font>
      last = now;<font></font>
      requestAnimationFrame(frame);<font></font>
    }<font></font>
    frame(); <span class="hljs-comment">// lets get this party started</span><font></font>
  });<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
繰り返しますが、これは以前のキャンバスゲームからのアイデアをリメイクしたものです。したがって、ゲームループのしくみがわからない場合は、以前の記事の1つに戻ってください。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">画像とスプライト</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ゲームサイクルが始まる前に、2つの別々のスプライトシート（スプライトシート）を読み込みます。</font></font><br>
<br>
<ul>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背景</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -空、丘、木の3つの視差レイヤー</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スプライト</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -マシンスプライト（さらに、最終バージョンに追加されるツリーとビルボード）</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f6f/111/acc/f6f111accbba448459e25c6fe761ff05.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スプライトシートは、Rakeおよび</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ruby Gemの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">小さなタスク</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">sprite-factory</font></a><font style="vertical-align: inherit;">を使用して生成されました</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このタスクは、結合されたスプライトシートと、定数xおよびyに格納される座標x、y、w、h </font></font><code>BACKGROUND</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を生成し</font></font><code>SPRITES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<blockquote><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：背景はInkscapeを使用して作成しました。ほとんどのスプライトは</font><font style="vertical-align: inherit;">、Genesisの古いOutrunバージョンから</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">取得</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">した</font><font style="vertical-align: inherit;">グラフィックで</font><font style="vertical-align: inherit;">、トレーニング例として使用されています。</font></font></em></blockquote><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゲーム変数</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
背景とスプライトの画像に加えて、いくつかのゲーム変数が必要になります。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">var</span> fps           = <span class="hljs-number">60</span>;                      <span class="hljs-comment">// how many 'update' frames per second</span>
<span class="hljs-keyword">var</span> step          = <span class="hljs-number">1</span>/fps;                   <span class="hljs-comment">// how long is each frame (in seconds)</span>
<span class="hljs-keyword">var</span> width         = <span class="hljs-number">1024</span>;                    <span class="hljs-comment">// logical canvas width</span>
<span class="hljs-keyword">var</span> height        = <span class="hljs-number">768</span>;                     <span class="hljs-comment">// logical canvas height</span>
<span class="hljs-keyword">var</span> segments      = [];                      <span class="hljs-comment">// array of road segments</span>
<span class="hljs-keyword">var</span> canvas        = Dom.get(<span class="hljs-string">'canvas'</span>);       <span class="hljs-comment">// our canvas...</span>
<span class="hljs-keyword">var</span> ctx           = canvas.getContext(<span class="hljs-string">'2d'</span>); <span class="hljs-comment">// ...and its drawing context</span>
<span class="hljs-keyword">var</span> background    = <span class="hljs-literal">null</span>;                    <span class="hljs-comment">// our background image (loaded below)</span>
<span class="hljs-keyword">var</span> sprites       = <span class="hljs-literal">null</span>;                    <span class="hljs-comment">// our spritesheet (loaded below)</span>
<span class="hljs-keyword">var</span> resolution    = <span class="hljs-literal">null</span>;                    <span class="hljs-comment">// scaling factor to provide resolution independence (computed)</span>
<span class="hljs-keyword">var</span> roadWidth     = <span class="hljs-number">2000</span>;                    <span class="hljs-comment">// actually half the roads width, easier math if the road spans from -roadWidth to +roadWidth</span>
<span class="hljs-keyword">var</span> segmentLength = <span class="hljs-number">200</span>;                     <span class="hljs-comment">// length of a single segment</span>
<span class="hljs-keyword">var</span> rumbleLength  = <span class="hljs-number">3</span>;                       <span class="hljs-comment">// number of segments per red/white rumble strip</span>
<span class="hljs-keyword">var</span> trackLength   = <span class="hljs-literal">null</span>;                    <span class="hljs-comment">// z length of entire track (computed)</span>
<span class="hljs-keyword">var</span> lanes         = <span class="hljs-number">3</span>;                       <span class="hljs-comment">// number of lanes</span>
<span class="hljs-keyword">var</span> fieldOfView   = <span class="hljs-number">100</span>;                     <span class="hljs-comment">// angle (degrees) for field of view</span>
<span class="hljs-keyword">var</span> cameraHeight  = <span class="hljs-number">1000</span>;                    <span class="hljs-comment">// z height of camera</span>
<span class="hljs-keyword">var</span> cameraDepth   = <span class="hljs-literal">null</span>;                    <span class="hljs-comment">// z distance camera is from screen (computed)</span>
<span class="hljs-keyword">var</span> drawDistance  = <span class="hljs-number">300</span>;                     <span class="hljs-comment">// number of segments to draw</span>
<span class="hljs-keyword">var</span> playerX       = <span class="hljs-number">0</span>;                       <span class="hljs-comment">// player x offset from center of road (-1 to 1 to stay independent of roadWidth)</span>
<span class="hljs-keyword">var</span> playerZ       = <span class="hljs-literal">null</span>;                    <span class="hljs-comment">// player relative z distance from camera (computed)</span>
<span class="hljs-keyword">var</span> fogDensity    = <span class="hljs-number">5</span>;                       <span class="hljs-comment">// exponential fog density</span>
<span class="hljs-keyword">var</span> position      = <span class="hljs-number">0</span>;                       <span class="hljs-comment">// current camera Z position (add playerZ to get player's absolute Z position)</span>
<span class="hljs-keyword">var</span> speed         = <span class="hljs-number">0</span>;                       <span class="hljs-comment">// current speed</span>
<span class="hljs-keyword">var</span> maxSpeed      = segmentLength/step;      <span class="hljs-comment">// top speed (ensure we can't move more than 1 segment in a single frame to make collision detection easier)</span>
<span class="hljs-keyword">var</span> accel         =  maxSpeed/<span class="hljs-number">5</span>;             <span class="hljs-comment">// acceleration rate - tuned until it 'felt' right</span>
<span class="hljs-keyword">var</span> breaking      = -maxSpeed;               <span class="hljs-comment">// deceleration rate when braking</span>
<span class="hljs-keyword">var</span> decel         = -maxSpeed/<span class="hljs-number">5</span>;             <span class="hljs-comment">// 'natural' deceleration rate when neither accelerating, nor braking</span>
<span class="hljs-keyword">var</span> offRoadDecel  = -maxSpeed/<span class="hljs-number">2</span>;             <span class="hljs-comment">// off road deceleration is somewhere in between</span>
<span class="hljs-keyword">var</span> offRoadLimit  =  maxSpeed/<span class="hljs-number">4</span>;             <span class="hljs-comment">// limit when off road deceleration no longer applies (e.g. you can always go at least this speed even when off road)</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それらのいくつかは、UIコントロールを使用してカスタマイズでき、プログラムの実行中に重要な値を変更して、道路のレンダリングにどのように影響するかを確認できます。</font><font style="vertical-align: inherit;">その他は、メソッドのカスタムUI値から再計算されます</font></font><code>reset()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フェラーリを運営</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
のキーバインディングを実行します</font></font><code>Game.run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。これは、プレーヤーの現在のアクションを報告する変数を設定またはリセットする簡単なキーボード入力を提供します。</font></font><br>
<br>
<pre><code class="javascript hljs">Game.run({<font></font>
  ...<font></font>
  keys: [<font></font>
    { <span class="hljs-attr">keys</span>: [KEY.LEFT,  KEY.A], <span class="hljs-attr">mode</span>: <span class="hljs-string">'down'</span>, <span class="hljs-attr">action</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ keyLeft   = <span class="hljs-literal">true</span>;  } },<font></font>
    { <span class="hljs-attr">keys</span>: [KEY.RIGHT, KEY.D], <span class="hljs-attr">mode</span>: <span class="hljs-string">'down'</span>, <span class="hljs-attr">action</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ keyRight  = <span class="hljs-literal">true</span>;  } },<font></font>
    { <span class="hljs-attr">keys</span>: [KEY.UP,    KEY.W], <span class="hljs-attr">mode</span>: <span class="hljs-string">'down'</span>, <span class="hljs-attr">action</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ keyFaster = <span class="hljs-literal">true</span>;  } },<font></font>
    { <span class="hljs-attr">keys</span>: [KEY.DOWN,  KEY.S], <span class="hljs-attr">mode</span>: <span class="hljs-string">'down'</span>, <span class="hljs-attr">action</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ keySlower = <span class="hljs-literal">true</span>;  } },<font></font>
    { <span class="hljs-attr">keys</span>: [KEY.LEFT,  KEY.A], <span class="hljs-attr">mode</span>: <span class="hljs-string">'up'</span>,   <span class="hljs-attr">action</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ keyLeft   = <span class="hljs-literal">false</span>; } },<font></font>
    { <span class="hljs-attr">keys</span>: [KEY.RIGHT, KEY.D], <span class="hljs-attr">mode</span>: <span class="hljs-string">'up'</span>,   <span class="hljs-attr">action</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ keyRight  = <span class="hljs-literal">false</span>; } },<font></font>
    { <span class="hljs-attr">keys</span>: [KEY.UP,    KEY.W], <span class="hljs-attr">mode</span>: <span class="hljs-string">'up'</span>,   <span class="hljs-attr">action</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ keyFaster = <span class="hljs-literal">false</span>; } },<font></font>
    { <span class="hljs-attr">keys</span>: [KEY.DOWN,  KEY.S], <span class="hljs-attr">mode</span>: <span class="hljs-string">'up'</span>,   <span class="hljs-attr">action</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ keySlower = <span class="hljs-literal">false</span>; } }<font></font>
  ],<font></font>
  ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プレーヤーの状態は、次の変数によって制御されます：</font></font><br>
<br>
<ul>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">速度</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -現在の速度。</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">position-</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トラック上の現在のZ位置。</font><font style="vertical-align: inherit;">これはカメラの位置であり、フェラーリではないことに注意してください。</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">playerX-</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">道路上のX上のプレーヤーの現在の位置。</font><font style="vertical-align: inherit;">実際の値に依存しないように、-1から+1の範囲で正規化されます</font></font><code>roadWidth</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの変数はメソッド内で設定され</font></font><code>update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、次のアクションを実行します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"></font><code>position</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">現在のに基づいて</font><font style="vertical-align: inherit;">更新します</font></font><code>speed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"></font><code>playerX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">左または右のキーを押すと</font><font style="vertical-align: inherit;">更新さ</font><font style="vertical-align: inherit;">れます。</font></font></li>
<li><font style="vertical-align: inherit;"></font><code>speed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上キーを押すと</font><font style="vertical-align: inherit;">増加</font><font style="vertical-align: inherit;">します。</font></font></li>
<li><font style="vertical-align: inherit;"></font><code>speed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下キーを押すと</font><font style="vertical-align: inherit;">減少</font><font style="vertical-align: inherit;">します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">削減</font></font><code>speed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アップおよびキーダウンが押されていない場合。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">減少し</font></font><code>speed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">た場合</font></font><code>playerX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、道路の端を切り、草の上に位置しています。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
直接道路の場合、方法は</font></font><code>update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非常に明確でシンプルです。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update</span>(<span class="hljs-params">dt</span>) </span>{<font></font>
<font></font>
  position = Util.increase(position, dt * speed, trackLength);<font></font>
<font></font>
  <span class="hljs-keyword">var</span> dx = dt * <span class="hljs-number">2</span> * (speed/maxSpeed); <span class="hljs-comment">// at top speed, should be able to cross from left to right (-1 to 1) in 1 second</span><font></font>
<font></font>
  <span class="hljs-keyword">if</span> (keyLeft)<font></font>
    playerX = playerX - dx;<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (keyRight)<font></font>
    playerX = playerX + dx;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (keyFaster)<font></font>
    speed = Util.accelerate(speed, accel, dt);<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (keySlower)<font></font>
    speed = Util.accelerate(speed, breaking, dt);<font></font>
  <span class="hljs-keyword">else</span><font></font>
    speed = Util.accelerate(speed, decel, dt);<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (((playerX &lt; <span class="hljs-number">-1</span>) || (playerX &gt; <span class="hljs-number">1</span>)) &amp;&amp; (speed &gt; offRoadLimit))<font></font>
    speed = Util.accelerate(speed, offRoadDecel, dt);<font></font>
<font></font>
  playerX = Util.limit(playerX, <span class="hljs-number">-2</span>, <span class="hljs-number">2</span>);     <span class="hljs-comment">// dont ever let player go too far out of bounds</span>
  speed   = Util.limit(speed, <span class="hljs-number">0</span>, maxSpeed); <span class="hljs-comment">// or exceed maxSpeed</span><font></font>
<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
心配しないでください。完成したバージョンでスプライトと衝突認識を追加すると、はるかに難しくなります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">道路形状</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ゲームの世界をレンダリングする前</font></font><code>segments</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に、メソッドでinの</font><font style="vertical-align: inherit;">配列を作成する必要があり</font></font><code>resetRoad()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
道路のこれらの各セグメントは、最終的にはその世界座標から投影され、画面座標の2Dポリゴンに変わります。</font><font style="vertical-align: inherit;">各セグメントについて、2つのポイントを保存します</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。p1</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はカメラに最も近いエッジの中心であり、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p2</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はカメラから最も遠いエッジの中心です。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/53a/fa4/076/53afa40768a00b49833703b1457a6941.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
厳密に言うと、</font><font style="vertical-align: inherit;">各セグメントの</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p2は</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前のセグメントの</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p1</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と同じです</font><strong><font style="vertical-align: inherit;">が、</font></strong><font style="vertical-align: inherit;">それらを別々のポイントとして保存し、各セグメントを別々に変換する方が簡単に思えます。</font><font style="vertical-align: inherit;">細かい曲線や丘を美しくすることができるが、同時に横縞があるので</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
、分離して</font></font><code>rumbleLength</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いる。後続の各セグメントの色が異なると、ストロボ効果が悪くなります。したがって、多くの小さなセグメントが必要ですが、それらをグループ化して個別の水平ストライプを形成します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resetRoad</span>(<span class="hljs-params"></span>) </span>{<font></font>
  segments = [];<font></font>
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> n = <span class="hljs-number">0</span> ; n &lt; <span class="hljs-number">500</span> ; n++) { <span class="hljs-comment">// arbitrary road length</span><font></font>
    segments.push({<font></font>
       <span class="hljs-attr">index</span>: n,
       <span class="hljs-attr">p1</span>: { <span class="hljs-attr">world</span>: { <span class="hljs-attr">z</span>:  n   *segmentLength }, <span class="hljs-attr">camera</span>: {}, <span class="hljs-attr">screen</span>: {} },
       <span class="hljs-attr">p2</span>: { <span class="hljs-attr">world</span>: { <span class="hljs-attr">z</span>: (n+<span class="hljs-number">1</span>)*segmentLength }, <span class="hljs-attr">camera</span>: {}, <span class="hljs-attr">screen</span>: {} },
       <span class="hljs-attr">color</span>: <span class="hljs-built_in">Math</span>.floor(n/rumbleLength)%<span class="hljs-number">2</span> ? COLORS.DARK : COLORS.LIGHT<font></font>
    });<font></font>
  }<font></font>
<font></font>
  trackLength = segments.length * segmentLength;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直線道路のみが必要なため、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p1</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p2</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を世界座標</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">z</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">のみ</font><font style="vertical-align: inherit;">
初期化します</font><font style="vertical-align: inherit;">。</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">座標</font><font style="vertical-align: inherit;">は常に0であり、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">座標</font><font style="vertical-align: inherit;">は常にスケーリングされた値に依存します</font></font><code>+/- roadWidth</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。後で曲線や丘を追加すると、この部分が変化します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
空のオブジェクトを設定して、これらのポイントの表現をカメラと画面に格納し、それぞれに一時的なオブジェクトの束を作成しないようにします</font></font><code>render</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。ガベージコレクションを最小限に抑えるには、ゲームループ内でオブジェクトを割り当てないようにする必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
車が道路の終わりに到達したら、サイクルの最初に戻ります。</font><font style="vertical-align: inherit;">これを簡略化するために、道路の長さを超えている場合でも、Zの任意の値のセグメントを見つけるメソッドを作成します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">findSegment</span>(<span class="hljs-params">z</span>) </span>{
  <span class="hljs-keyword">return</span> segments[<span class="hljs-built_in">Math</span>.floor(z/segmentLength) % segments.length];<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背景のレンダリング</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このメソッド</font></font><code>render()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、背景画像をレンダリングすることから始まります。</font><font style="vertical-align: inherit;">曲線と丘を追加する次の部分では、視差スクロールを実行するために背景が必要になるため、この方向に移動し始め、背景を3つの別々のレイヤーとしてレンダリングします。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span>(<span class="hljs-params"></span>) </span>{<font></font>
<font></font>
  ctx.clearRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, width, height);<font></font>
<font></font>
  Render.background(ctx, background, width, height, BACKGROUND.SKY);<font></font>
  Render.background(ctx, background, width, height, BACKGROUND.HILLS);<font></font>
  Render.background(ctx, background, width, height, BACKGROUND.TREES);<font></font>
<font></font>
  ...</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">道路レンダリング</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、render関数はすべてのセグメントを反復処理し</font><strong><font style="vertical-align: inherit;">、</font></strong><font style="vertical-align: inherit;">各セグメントの</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p1</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p2を</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">世界座標から画面座標に</font><font style="vertical-align: inherit;">投影し</font><font style="vertical-align: inherit;">、必要に応じてセグメントをトリミングし、それ以外の場合はレンダリングします。</font></font><br>
<br>
<pre><code class="javascript hljs">  <span class="hljs-keyword">var</span> baseSegment = findSegment(position);
  <span class="hljs-keyword">var</span> maxy        = height;
  <span class="hljs-keyword">var</span> n, segment;
  <span class="hljs-keyword">for</span>(n = <span class="hljs-number">0</span> ; n &lt; drawDistance ; n++) {<font></font>
<font></font>
    segment = segments[(baseSegment.index + n) % segments.length];<font></font>
<font></font>
    Util.project(segment.p1, (playerX * roadWidth), cameraHeight, position, cameraDepth, width, height, roadWidth);<font></font>
    Util.project(segment.p2, (playerX * roadWidth), cameraHeight, position, cameraDepth, width, height, roadWidth);<font></font>
<font></font>
    <span class="hljs-keyword">if</span> ((segment.p1.camera.z &lt;= cameraDepth) || <span class="hljs-comment">// behind us</span>
        (segment.p2.screen.y &gt;= maxy))          <span class="hljs-comment">// clip by (already rendered) segment</span>
      <span class="hljs-keyword">continue</span>;<font></font>
<font></font>
    Render.segment(ctx, width, lanes,<font></font>
                   segment.p1.screen.x,<font></font>
                   segment.p1.screen.y,<font></font>
                   segment.p1.screen.w,<font></font>
                   segment.p2.screen.x,<font></font>
                   segment.p2.screen.y,<font></font>
                   segment.p2.screen.w,<font></font>
                   segment.color);<font></font>
<font></font>
    maxy = segment.p2.screen.y;<font></font>
  }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記では、ポイントを投影するために必要な計算をすでに見てきました。 JavaScriptバージョンは、変換、投影、スケーリングを1つのメソッドに結合します。</font></font><br>
<br>
<pre><code class="javascript hljs">project: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">p, cameraX, cameraY, cameraZ, cameraDepth, width, height, roadWidth</span>) </span>{<font></font>
  p.camera.x     = (p.world.x || <span class="hljs-number">0</span>) - cameraX;<font></font>
  p.camera.y     = (p.world.y || <span class="hljs-number">0</span>) - cameraY;<font></font>
  p.camera.z     = (p.world.z || <span class="hljs-number">0</span>) - cameraZ;<font></font>
  p.screen.scale = cameraDepth/p.camera.z;<font></font>
  p.screen.x     = <span class="hljs-built_in">Math</span>.round((width/<span class="hljs-number">2</span>)  + (p.screen.scale * p.camera.x  * width/<span class="hljs-number">2</span>));<font></font>
  p.screen.y     = <span class="hljs-built_in">Math</span>.round((height/<span class="hljs-number">2</span>) - (p.screen.scale * p.camera.y  * height/<span class="hljs-number">2</span>));<font></font>
  p.screen.w     = <span class="hljs-built_in">Math</span>.round(             (p.screen.scale * roadWidth   * width/<span class="hljs-number">2</span>));<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各点</font><strong><font style="vertical-align: inherit;">p1</font></strong><font style="vertical-align: inherit;">と</font><strong><font style="vertical-align: inherit;">p2</font></strong><font style="vertical-align: inherit;"> 
のスクリーン</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を計算することに加えて</font><font style="vertical-align: inherit;">、同じ投影計算を使用して</font><font style="vertical-align: inherit;">、セグメントの</font><font style="vertical-align: inherit;">投影幅（</font><strong><font style="vertical-align: inherit;">w</font></strong><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">を計算</font><font style="vertical-align: inherit;">します。</font><font style="vertical-align: inherit;">ポイント</font><strong><font style="vertical-align: inherit;">p1</font></strong><font style="vertical-align: inherit;">と</font><strong><font style="vertical-align: inherit;">p2</font></strong><font style="vertical-align: inherit;"> 
の画面座標</font><strong><font style="vertical-align: inherit;">x</font></strong><font style="vertical-align: inherit;">と</font><strong><font style="vertical-align: inherit;">y、</font></strong><font style="vertical-align: inherit;">および</font><font style="vertical-align: inherit;">道路の投影幅</font><strong><font style="vertical-align: inherit;">wが</font></strong><font style="vertical-align: inherit;">あるため、一般的な補助関数を使用して、草、道路、横縞、分割線のレンダリングに必要なすべてのポリゴンを</font><font style="vertical-align: inherit;">補助関数を使用して非常に簡単に計算でき</font><font style="vertical-align: inherit;">ます</font><em><font style="vertical-align: inherit;">（ 。</font></em><em><font style="vertical-align: inherit;">）</font></em><font style="vertical-align: inherit;">。</font></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><code>Render.segment</code><font style="vertical-align: inherit;"></font><code>Render.polygon</code> <em><font style="vertical-align: inherit;"></font><code>common.js</code><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">車のレンダリング</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、メソッドが必要</font></font><code>render</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">とする</font><font style="vertical-align: inherit;">最後のものは</font><font style="vertical-align: inherit;">フェラーリレンダリングです。</font></font><br>
<br>
<pre><code class="javascript hljs">  Render.player(ctx, width, height, resolution, roadWidth, sprites, speed/maxSpeed,<font></font>
                cameraDepth/playerZ,<font></font>
                width/<span class="hljs-number">2</span>,<font></font>
                height);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このメソッドは</font></font><code>player</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ではなく</font><font style="vertical-align: inherit;">と呼ばれます。これ</font></font><code>car</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、ゲームの最終バージョンでは道路上に他の車が存在するため、プレイヤーのフェラーリを他の車から分離するためです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ヘルパー関数</font></font><code>Render.player</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、</font></font><code>drawImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スプライトをレンダリングするために</font><font style="vertical-align: inherit;">呼び出されるcanvasメソッド</font><font style="vertical-align: inherit;">を使用し、以前に使用されたのと同じプロジェクションスケーリングを使用して以前にスケーリングしました。</font></font><br>
<br>
<blockquote><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">z</font></font></strong></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Z</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、この場合には、変数に格納され、カメラの機械からの相対距離である</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">playerZ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、この関数は高速で車を少し「シェイク」し、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">speed / maxSpeedに</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">応じて、スケーリング方程式にランダム性を少し追加します</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そしてここに私たちが得たものがあります：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/845/dfd/3e8/845dfd3e88ef0a22b2c9fd021140ff3b.png"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
直線道路のシステムを作成するためだけに、かなりの量の作業を行いました。</font><font style="vertical-align: inherit;">追加しました</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">汎用ヘルパーモジュール</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dom</font></font></strong></li>
<li><font style="vertical-align: inherit;"><strong><font style="vertical-align: inherit;">Util</font></strong><font style="vertical-align: inherit;">一般的な数学モジュール</font></font><strong><font style="vertical-align: inherit;"></font></strong></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一般的なキャンバスヘルパーモジュールの</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レンダリング</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ...</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...を含む</font></font><code>Render.segment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>Render.polygon</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><code>Render.sprite</code></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">固定ピッチのゲームサイクル</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">画像ダウンローダー</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キーボードハンドラー</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">視差の背景</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">車、木、看板のあるスプライトシート</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">道路の基本的な形状</font></font></li>
<li><font style="vertical-align: inherit;"></font><code>update()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">機械の制御</font><font style="vertical-align: inherit;">方法</font></font></li>
<li><font style="vertical-align: inherit;"></font><code>render()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背景、道路、プレイヤーの車をレンダリングする</font><font style="vertical-align: inherit;">方法</font></font></li>
<li><font style="vertical-align: inherit;"></font><code>&lt;audio&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レーシングミュージック付き</font><font style="vertical-align: inherit;">HTML5タグ</font><font style="vertical-align: inherit;">（隠しボーナス！）</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...それは私たちにさらなる発展のための良い基盤を与えました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート2.カーブ。</font></font></h2><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/98f/c3d/6d1/98fc3d6d13cc16f12847d253e112fcb2.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このパートでは、曲線がどのように機能するかを詳しく説明します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前のパートでは、道路のジオメトリをセグメントの配列の形式でコンパイルしました。それぞれのセグメントには、カメラに関連して変換され、画面に投影される世界座標があります。</font><font style="vertical-align: inherit;">直線道路では</font><strong><font style="vertical-align: inherit;">x</font></strong><font style="vertical-align: inherit;">と</font><strong><font style="vertical-align: inherit;">yの</font></strong><font style="vertical-align: inherit;">両方</font><font style="vertical-align: inherit;">がゼロに等しい</font><font style="vertical-align: inherit;">ため、各ポイントに</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
必要なのは世界座標</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">z</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">だけでした</font><font style="vertical-align: inherit;">。</font></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c78/551/359/c78551359ef7c11e4af48b4285d61842.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
完全に機能する3Dシステムを作成する場合、</font><font style="vertical-align: inherit;">上に示したポリゴンの</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zの</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ストライプを</font><font style="vertical-align: inherit;">計算することにより、曲線を実装できます</font><font style="vertical-align: inherit;">。ただし、このタイプのジオメトリは計算がかなり難しくなるため、3D回転ステージを射影方程式に追加する必要があります</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... ...このようにすると、WebGLまたはその類似物を使用した方がよいでしょうが、このプロジェクトには、プロジェクトに他のタスクはありません。昔ながらの疑似3次元トリックを使用して曲線をシミュレートしたいだけです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、</font><font style="vertical-align: inherit;">道路セグメントの</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">座標がまったく計算されないことを知って驚かれることでしょう</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
代わりに、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Luのアドバイス</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<blockquote><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「道路をカーブさせるには、カーブ形状の中心線の位置を変更するだけです。画面の下部から開始して、道路の中心の左または右へのシフト量が徐々に増加し</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><em><font style="vertical-align: inherit;">」</font></em></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちの場合、中心線は</font></font><code>cameraX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">投影計算に渡される</font><font style="vertical-align: inherit;">値</font><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">これは</font></font><code>render()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、道路の各セグメント</font><font style="vertical-align: inherit;">を実行するときに</font></font><code>cameraX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、徐々に増加する値で値を</font><font style="vertical-align: inherit;">シフトすること</font><font style="vertical-align: inherit;">によって</font><font style="vertical-align: inherit;">曲線をシミュレートできること</font><font style="vertical-align: inherit;">を意味し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c8a/569/19e/c8a56919e67d6f19cc737074ce92fffb.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どれだけシフトするかを知るには、各セグメントに値を格納する必要があります</font></font><code>curve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">この値は、セグメントをカメラの中心線からどれだけシフトするかを示します。</font><font style="vertical-align: inherit;">彼女は〜になるだろう：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">左折曲線の場合は負</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カーブが右折する場合はプラス</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">滑らかな曲線の場合は少ない</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">急カーブにはもっと</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
自分自身の値はかなり任意に選択されます。</font><font style="vertical-align: inherit;">試行錯誤により、曲線が「正しい」と思われる適切な値を見つけることができます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">var</span> ROAD = {
  <span class="hljs-attr">LENGTH</span>: { <span class="hljs-attr">NONE</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">SHORT</span>:  <span class="hljs-number">25</span>, <span class="hljs-attr">MEDIUM</span>:  <span class="hljs-number">50</span>, <span class="hljs-attr">LONG</span>:  <span class="hljs-number">100</span> }, <span class="hljs-comment">// num segments</span>
  <span class="hljs-attr">CURVE</span>:  { <span class="hljs-attr">NONE</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">EASY</span>:    <span class="hljs-number">2</span>, <span class="hljs-attr">MEDIUM</span>:   <span class="hljs-number">4</span>, <span class="hljs-attr">HARD</span>:    <span class="hljs-number">6</span> }<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
曲線に適切な値を選択することに加えて、ラインが曲線に変わるとき（またはその逆の場合）に、遷移のギャップを回避する必要があります。</font><font style="vertical-align: inherit;">これは</font><font style="vertical-align: inherit;">、カーブに出入りするときに</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">柔らかく</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">する</font><font style="vertical-align: inherit;">ことで実現できます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これを行うには、</font></font><code>curve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">従来の平滑化関数を使用して、各セグメント</font><font style="vertical-align: inherit;">の値</font><font style="vertical-align: inherit;">を目的の値に達するまで</font><font style="vertical-align: inherit;">徐々に増加（または減少）し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="javascript hljs">easeIn:    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a,b,percent</span>) </span>{ <span class="hljs-keyword">return</span> a + (b-a)*<span class="hljs-built_in">Math</span>.pow(percent,<span class="hljs-number">2</span>);                           },
<span class="hljs-attr">easeOut</span>:   <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a,b,percent</span>) </span>{ <span class="hljs-keyword">return</span> a + (b-a)*(<span class="hljs-number">1</span>-<span class="hljs-built_in">Math</span>.pow(<span class="hljs-number">1</span>-percent,<span class="hljs-number">2</span>));                     },
<span class="hljs-attr">easeInOut</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a,b,percent</span>) </span>{ <span class="hljs-keyword">return</span> a + (b-a)*((-<span class="hljs-built_in">Math</span>.cos(percent*<span class="hljs-built_in">Math</span>.PI)/<span class="hljs-number">2</span>) + <span class="hljs-number">0.5</span>);        },</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、今、1つのセグメントをジオメトリに追加する機能を考慮に入れています...</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addSegment</span>(<span class="hljs-params">curve</span>) </span>{
  <span class="hljs-keyword">var</span> n = segments.length;<font></font>
  segments.push({<font></font>
     <span class="hljs-attr">index</span>: n,
        <span class="hljs-attr">p1</span>: { <span class="hljs-attr">world</span>: { <span class="hljs-attr">z</span>:  n   *segmentLength }, <span class="hljs-attr">camera</span>: {}, <span class="hljs-attr">screen</span>: {} },
        <span class="hljs-attr">p2</span>: { <span class="hljs-attr">world</span>: { <span class="hljs-attr">z</span>: (n+<span class="hljs-number">1</span>)*segmentLength }, <span class="hljs-attr">camera</span>: {}, <span class="hljs-attr">screen</span>: {} },
     <span class="hljs-attr">curve</span>: curve,
     <span class="hljs-attr">color</span>: <span class="hljs-built_in">Math</span>.floor(n/rumbleLength)%<span class="hljs-number">2</span> ? COLORS.DARK : COLORS.LIGHT<font></font>
  });<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
曲がりくねった道路からスムーズに進入し、見つけてスムーズに退出するための方法を作成できます</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addRoad</span>(<span class="hljs-params">enter, hold, leave, curve</span>) </span>{
  <span class="hljs-keyword">var</span> n;
  <span class="hljs-keyword">for</span>(n = <span class="hljs-number">0</span> ; n &lt; enter ; n++)<font></font>
    addSegment(Util.easeIn(<span class="hljs-number">0</span>, curve, n/enter));
  <span class="hljs-keyword">for</span>(n = <span class="hljs-number">0</span> ; n &lt; hold  ; n++)<font></font>
    addSegment(curve);<font></font>
  <span class="hljs-keyword">for</span>(n = <span class="hljs-number">0</span> ; n &lt; leave ; n++)<font></font>
    addSegment(Util.easeInOut(curve, <span class="hljs-number">0</span>, n/leave));<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...さらに、S字カーブなどの追加のジオメトリを課すことができます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addSCurves</span>(<span class="hljs-params"></span>) </span>{<font></font>
  addRoad(ROAD.LENGTH.MEDIUM, ROAD.LENGTH.MEDIUM, ROAD.LENGTH.MEDIUM,  -ROAD.CURVE.EASY);<font></font>
  addRoad(ROAD.LENGTH.MEDIUM, ROAD.LENGTH.MEDIUM, ROAD.LENGTH.MEDIUM,   ROAD.CURVE.MEDIUM);<font></font>
  addRoad(ROAD.LENGTH.MEDIUM, ROAD.LENGTH.MEDIUM, ROAD.LENGTH.MEDIUM,   ROAD.CURVE.EASY);<font></font>
  addRoad(ROAD.LENGTH.MEDIUM, ROAD.LENGTH.MEDIUM, ROAD.LENGTH.MEDIUM,  -ROAD.CURVE.EASY);<font></font>
  addRoad(ROAD.LENGTH.MEDIUM, ROAD.LENGTH.MEDIUM, ROAD.LENGTH.MEDIUM,  -ROAD.CURVE.MEDIUM);<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">update（）メソッドの変更</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この方法に必要な唯一の変更は</font></font><code>update()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、マシンがカーブに沿って移動するときに一種の遠心力を加えることです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
好みに応じて調整できる任意の係数を設定します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">var</span> centrifugal = <span class="hljs-number">0.3</span>;   <span class="hljs-comment">// centrifugal force multiplier when going around curves</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に</font></font><code>playerX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、現在の速度、曲線の値、遠心力の乗数に基づい</font><font style="vertical-align: inherit;">て位置</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">更新し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="javascript hljs">playerX = playerX - (dx * speedPercent * playerSegment.curve * centrifugal);</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カーブレンダリング</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記のとおり</font></font><code>cameraX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>render()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各道路セグメントの</font><font style="vertical-align: inherit;">実行中に投影計算で使用される</font><font style="vertical-align: inherit;">値をシフトすることにより、シミュレートされた曲線をレンダリングできます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c8a/569/19e/c8a56919e67d6f19cc737074ce92fffb.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを行う</font><font style="vertical-align: inherit;">ために、プロジェクション計算で使用される</font><font style="vertical-align: inherit;">値のオフセットとして使用される</font><font style="vertical-align: inherit;">変数</font><strong><font style="vertical-align: inherit;">x</font></strong><font style="vertical-align: inherit;">と同様に</font><font style="vertical-align: inherit;">、値ごとにセグメントごとに増加</font><font style="vertical-align: inherit;">するドライブ変数</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dx</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を格納し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">
曲線を実装するには、次のものが必要です。</font></font><code>curve</code><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><code>cameraX</code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各セグメントの</font><font style="vertical-align: inherit;">投影</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p1を</font></font></strong><font style="vertical-align: inherit;"><strong><font style="vertical-align: inherit;">xだけ</font></strong><font style="vertical-align: inherit;">シフトする</font></font><strong><font style="vertical-align: inherit;"></font></strong></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各セグメントの</font><font style="vertical-align: inherit;">投影</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p2を</font></font></strong><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + </font><strong><font style="vertical-align: inherit;">dxだけ</font></strong><font style="vertical-align: inherit;">シフトする</font></font><strong><font style="vertical-align: inherit;"></font></strong></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次のセグメントの</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><strong><font style="vertical-align: inherit;">dxだけ</font></strong><font style="vertical-align: inherit;">増やす</font></font><strong><font style="vertical-align: inherit;"></font></strong></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、セグメントの境界を越えるときに引き裂かれた遷移を回避するため</font><font style="vertical-align: inherit;">に、現在のベースセグメントの曲線の補間された値で初期化された</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dx</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を作成する必要があり</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メソッド</font></font><code>render()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を次のように</font><font style="vertical-align: inherit;">変更</font><font style="vertical-align: inherit;">します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">var</span> baseSegment = findSegment(position);
<span class="hljs-keyword">var</span> basePercent = Util.percentRemaining(position, segmentLength);
<span class="hljs-keyword">var</span> dx = - (baseSegment.curve * basePercent);
<span class="hljs-keyword">var</span> x  = <span class="hljs-number">0</span>;
<span class="hljs-keyword">for</span>(n = <span class="hljs-number">0</span> ; n &lt; drawDistance ; n++) {<font></font>
<font></font>
  ...<font></font>
<font></font>
  Util.project(segment.p1, (playerX * roadWidth) - x,      cameraHeight, position - (segment.looped ? trackLength : <span class="hljs-number">0</span>), cameraDepth, width, height, roadWidth);<font></font>
  Util.project(segment.p2, (playerX * roadWidth) - x - dx, cameraHeight, position - (segment.looped ? trackLength : <span class="hljs-number">0</span>), cameraDepth, width, height, roadWidth);<font></font>
<font></font>
  x  = x + dx;<font></font>
  dx = dx + segment.curve;<font></font>
<font></font>
  ...<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">視差スクロールの背景</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、各レイヤーのオフセットを保存して、視差の背景レイヤーをスクロールする必要があります...</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">var</span> skySpeed    = <span class="hljs-number">0.001</span>; <span class="hljs-comment">// background sky layer scroll speed when going around curve (or up hill)</span>
<span class="hljs-keyword">var</span> hillSpeed   = <span class="hljs-number">0.002</span>; <span class="hljs-comment">// background hill layer scroll speed when going around curve (or up hill)</span>
<span class="hljs-keyword">var</span> treeSpeed   = <span class="hljs-number">0.003</span>; <span class="hljs-comment">// background tree layer scroll speed when going around curve (or up hill)</span>
<span class="hljs-keyword">var</span> skyOffset   = <span class="hljs-number">0</span>;     <span class="hljs-comment">// current sky scroll offset</span>
<span class="hljs-keyword">var</span> hillOffset  = <span class="hljs-number">0</span>;     <span class="hljs-comment">// current hill scroll offset</span>
<span class="hljs-keyword">var</span> treeOffset  = <span class="hljs-number">0</span>;     <span class="hljs-comment">// current tree scroll offset</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... </font></font><code>update()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">現在のプレーヤーセグメントのカーブ値とその速度に応じて、</font><font style="vertical-align: inherit;">時間をかけて増加させ</font><font style="vertical-align: inherit;">ます...</font></font><br>
<br>
<pre><code class="javascript hljs">skyOffset  = Util.increase(skyOffset,  skySpeed  * playerSegment.curve * speedPercent, <span class="hljs-number">1</span>);<font></font>
hillOffset = Util.increase(hillOffset, hillSpeed * playerSegment.curve * speedPercent, <span class="hljs-number">1</span>);<font></font>
treeOffset = Util.increase(treeOffset, treeSpeed * playerSegment.curve * speedPercent, <span class="hljs-number">1</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...そして、</font></font><code>render()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バックグラウンドレイヤーを</font><font style="vertical-align: inherit;">行うときにこのオフセットを使用するために使用します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="javascript hljs">Render.background(ctx, background, width, height, BACKGROUND.SKY,   skyOffset);<font></font>
Render.background(ctx, background, width, height, BACKGROUND.HILLS, hillOffset);<font></font>
Render.background(ctx, background, width, height, BACKGROUND.TREES, treeOffset);</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、ここでは偽の疑似3次元曲線を取得します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/98f/c3d/6d1/98fc3d6d13cc16f12847d253e112fcb2.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
追加したコードの主要部分は、対応する値で道路のジオメトリを構築すること</font></font><code>curve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。それを実現すると、その間に遠心力を加えることは</font></font><code>update()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はるかに簡単です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
曲線のレンダリングは数行のコードで実行されますが、ここで何が起こっているのかを正確に理解（および説明）するのは難しい場合があります。曲線をシミュレートするには多くの方法があり、それらが行き止まりに実装されている場合は、非常に簡単にさまよっています。外部のタスクに夢中になって、すべてを「正しく」実行する方が簡単です。これを理解する前に、行列、回転、および実際の3Dジオメトリを備えた完全に機能する3Dシステムの作成を開始します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事を書いたとき、曲線の実装に問題があることは間違いありませんでした。</font><font style="vertical-align: inherit;">アルゴリズムを視覚化しようとすると、私は2つの値が必要な理由を私は理解していなかった</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DX</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">X</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドライブを</font><font style="vertical-align: inherit;">代わりに1の...と私は完全に何かを説明することはできません場合は、何かが間違ってどこかに行ってきました... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...しかし、プロジェクトの時間</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「に週末」は</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ほぼ期限切れになり、率直に言って、曲線は私には非常に美しく見え、結局、これが最も重要です。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja499240/index.html">星へのとげ、または天国でのデータ分析</a></li>
<li><a href="../ja499242/index.html">研究者はテーブル上の振動を通じてデスクトップPCからデータを送信しました</a></li>
<li><a href="../ja499244/index.html">相乗効果のある組織。パートII</a></li>
<li><a href="../ja499246/index.html">産業発展の法則としてのロジスティック機能の調査</a></li>
<li><a href="../ja499248/index.html">個人用保護具の認識方法</a></li>
<li><a href="../ja499254/index.html">PyConRu 2020プログラム委員会メンバーがPythonに関する質問に回答します：最新の外観とちょっとしたパーセルタン</a></li>
<li><a href="../ja499262/index.html">自営業のSMZhackの最後のオンラインハッカソン：人々にヒットするプロジェクト</a></li>
<li><a href="../ja499268/index.html">空間認識：Hololensメガネは何ができますか？</a></li>
<li><a href="../ja499272/index.html">Пайка компонентов 0201. Слабонервных просьба удалиться от экранов</a></li>
<li><a href="../ja499274/index.html">新しいカプセルを分解しました。マイクの数と機能を知っています</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>