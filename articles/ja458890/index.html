<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💆 😶 #⃣ サンプリングと計算の精度 🗺️ 👩‍👩‍👦 🤠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="私の同僚の多くは、コンバージョン率などのある種のメトリックを計算するために、データベース全体を検証する必要があるという問題に直面しています。または、何百万もの顧客がいるクライアントごとに詳細な調査を行う必要があります。この種類のケリーは、このために特別に作成されたリポジトリでさえ、長期間機能します。...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>サンプリングと計算の精度</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458890/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私の同僚の多くは、コンバージョン率などのある種のメトリックを計算するために、データベース全体を検証する必要があるという問題に直面しています。</font><font style="vertical-align: inherit;">または、何百万もの顧客がいるクライアントごとに詳細な調査を行う必要があります。</font><font style="vertical-align: inherit;">この種類のケリーは、このために特別に作成されたリポジトリでさえ、長期間機能します。</font><font style="vertical-align: inherit;">何かを計算したり、何か追加したりする必要があることが単純な測定基準で考慮されるまで5〜15〜40分待つのはあまり面白くありません。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この問題の1つの解決策はサンプリングです。データ配列全体でメトリックを計算するのではなく、必要なメトリックを代表的に表すサブセットを取ります。</font><font style="vertical-align: inherit;">このサンプルはデータ配列より1000倍小さいかもしれませんが、必要な数を表示するには十分です。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この記事では、サンプルサイズのサンプリングが最終的なメトリックエラーにどのように影響するかを示すことにしました。 </font></font></p><a name="habracut"></a><br>
<h2 id="problema"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題</font></font></h2><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重要な質問：サンプルは「人口」をどの程度説明していますか？共通の配列からサンプルを取得するため、受け取るメトリックはランダム変数になります。サンプルが異なれば、測定結果も異なります。違う、何も意味しない。確率論は、サンプリングメトリック値は、特定のエラーレベルで（サンプル全体にわたって作成された）真のメトリック値の周りにグループ化する必要があることを示しています。さらに、別のエラーレベルを省略できる問題がよく発生します。コンバージョンが50％と10％のどちらであるかを把握することも、50.02％と比較して50.01％の精度で結果を取得することもできます。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">理論的には、サンプル全体で観測された変換係数も確率変数であることは興味深いです。 「理論的な」変換率は、無限サイズのサンプルでのみ計算できます。つまり、これらの計算された数値は完全に正確であるように見えますが、データベース内のすべての観測値でも、実際には正確な変換推定値が得られます。これはまた、今日のコンバージョン率が昨日と異なっていても、何かが変わったことを意味するのではなく、現在のサンプル（データベース内のすべての観測値）が一般的な母集団（すべてこの日の観測は、発生したものと発生しなかったもの）は、昨日とは少し異なる結果をもたらしました。いずれにせよ、正直な製品やアナリストにとって、これは基本的な仮説であるべきです。</font></font></p><br>
<h2 id="formulirovka-zadachi"> </h2><br>
<p>   1 000 000     0/1,     ,     .       1   1 .</p><br>
<p>:      N,                ?</p><br>
<h2 id="teoreticheskie-rassuzhdeniya"> </h2><br>
<p>              .</p><br>
<p>       :<br>
S = sqrt(p * (1 — p) /N)</p><br>
<p><br>
p —  <br>
N —  <br>
S —  </p><br>
<p>        .      ,           . </p><br>
<p>  ""     :</p><br>
<ol>
<li>   ,   .        , ..    4      2 .  ,   -        ,    ,         .</li>
</ol><br>
<p><img src="https://habrastorage.org/webt/gw/e-/mc/gwe-mczmjmsdsq8ezxuulsf6ito.png"></p><br>
<ol>
<li>      .   (..      )  ""    ,    :</li>
</ol><br>
<p><img src="https://habrastorage.org/webt/4x/9y/0t/4x9y0t_ornj-056s43ejtdovfle.png"></p><br>
<ol>
<li>  ,  ""      .  ,      ,      ,         .</li>
</ol><br>
<h2 id="modelirovanie"></h2><br>
<p>          " ".   R     .    ,       ,       ,    . </p><br>
<p> : </p><br>
<ol>
<li>    ( 0.01%  50%).</li>
<li> 1000   10, 100, 1000, 10000, 50000, 100000, 250000, 500000   </li>
<li>       (1000 )</li>
<li>       ,     60%, 80%  90%   .</li>
</ol><br>
<p>  R  :</p><br>
<pre><code class="plaintext hljs">sample.size &lt;- c(10, 100, 1000, 10000, 50000, 100000, 250000, 500000)<font></font>
bootstrap = 1000<font></font>
Error &lt;- NULL<font></font>
len = 1000000<font></font>
<font></font>
for (prob in c(0.0001, 0.001, 0.01, 0.1, 0.5)){<font></font>
<font></font>
  CRsub &lt;- data.table(sample_size = 0, CR = 0)<font></font>
<font></font>
  v1 = seq(1,len)<font></font>
  v2 = rbinom(len, 1, prob)<font></font>
<font></font>
  set = data.table(index = v1, conv = v2)<font></font>
  print(paste('probability is: ', prob))<font></font>
<font></font>
  for (j in 1:length(sample.size)){<font></font>
<font></font>
    for(i in 1:bootstrap){<font></font>
      ss &lt;- sample.size[j]<font></font>
      subset &lt;-  set[round(runif(ss, min = 1, max = len),0),]<font></font>
      CRsample &lt;- sum(subset$conv)/dim(subset)[1]<font></font>
      CRsub &lt;- rbind(CRsub, data.table(sample_size = ss, CR  = CRsample))<font></font>
    }<font></font>
<font></font>
    print(paste('sample size is:', sample.size[j]))<font></font>
<font></font>
    q &lt;- quantile(CRsub[sample_size == ss, CR], probs = c(0.05,0.1, 0.2, 0.8, 0.9, 0.95))<font></font>
    Error &lt;- rbind(Error, cbind(prob,ss,t(q)))<font></font>
}</code></pre><br>
<p>      (  ,      ).</p><br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th> </th>
<th> </th>
<th>5%</th>
<th>10%</th>
<th>20%</th>
<th>80%</th>
<th>90%</th>
<th>95%</th>
</tr>
</thead>
<tbody>
<tr>
<td>0.0001</td>
<td>10</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>0.0001</td>
<td>100</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>0.0001</td>
<td>1000</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.001</td>
</tr>
<tr>
<td>0.0001</td>
<td>10000</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0002</td>
<td>0.0002</td>
<td>0.0003</td>
</tr>
<tr>
<td>0.0001</td>
<td>50000</td>
<td>0.00004</td>
<td>0.00004</td>
<td>0.00006</td>
<td>0.00014</td>
<td>0.00016</td>
<td>0.00018</td>
</tr>
<tr>
<td>0.0001</td>
<td>100000</td>
<td>0.00005</td>
<td>0.00006</td>
<td>0.00007</td>
<td>0.00013</td>
<td>0.00014</td>
<td>0.00016</td>
</tr>
<tr>
<td>0.0001</td>
<td>250000</td>
<td>0.000072</td>
<td>0.0000796</td>
<td>0.000088</td>
<td>0.00012</td>
<td>0.000128</td>
<td>0.000136</td>
</tr>
<tr>
<td>0.0001</td>
<td>500000</td>
<td>0.00008</td>
<td>0.000084</td>
<td>0.000092</td>
<td>0.000114</td>
<td>0.000122</td>
<td>0.000128</td>
</tr>
<tr>
<td>0.001</td>
<td>10</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>0.001</td>
<td>100</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.01</td>
</tr>
<tr>
<td>0.001</td>
<td>1000</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.002</td>
<td>0.002</td>
<td>0.003</td>
</tr>
<tr>
<td>0.001</td>
<td>10000</td>
<td>0.0005</td>
<td>0.0006</td>
<td>0.0007</td>
<td>0.0013</td>
<td>0.0014</td>
<td>0.0016</td>
</tr>
<tr>
<td>0.001</td>
<td>50000</td>
<td>0.0008</td>
<td>0.000858</td>
<td>0.00092</td>
<td>0.00116</td>
<td>0.00122</td>
<td>0.00126</td>
</tr>
<tr>
<td>0.001</td>
<td>100000</td>
<td>0.00087</td>
<td>0.00091</td>
<td>0.00095</td>
<td>0.00112</td>
<td>0.00116</td>
<td>0.0012105</td>
</tr>
<tr>
<td>0.001</td>
<td>250000</td>
<td>0.00092</td>
<td>0.000948</td>
<td>0.000972</td>
<td>0.001084</td>
<td>0.001116</td>
<td>0.0011362</td>
</tr>
<tr>
<td>0.001</td>
<td>500000</td>
<td>0.000952</td>
<td>0.0009698</td>
<td>0.000988</td>
<td>0.001066</td>
<td>0.001086</td>
<td>0.0011041</td>
</tr>
<tr>
<td>0.01</td>
<td>10</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.1</td>
</tr>
<tr>
<td>0.01</td>
<td>100</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.02</td>
<td>0.02</td>
<td>0.03</td>
</tr>
<tr>
<td>0.01</td>
<td>1000</td>
<td>0.006</td>
<td>0.006</td>
<td>0.008</td>
<td>0.013</td>
<td>0.014</td>
<td>0.015</td>
</tr>
<tr>
<td>0.01</td>
<td>10000</td>
<td>0.0086</td>
<td>0.0089</td>
<td>0.0092</td>
<td>0.0109</td>
<td>0.0114</td>
<td>0.0118</td>
</tr>
<tr>
<td>0.01</td>
<td>50000</td>
<td>0.0093</td>
<td>0.0095</td>
<td>0.0097</td>
<td>0.0104</td>
<td>0.0106</td>
<td>0.0108</td>
</tr>
<tr>
<td>0.01</td>
<td>100000</td>
<td>0.0095</td>
<td>0.0096</td>
<td>0.0098</td>
<td>0.0103</td>
<td>0.0104</td>
<td>0.0106</td>
</tr>
<tr>
<td>0.01</td>
<td>250000</td>
<td>0.0097</td>
<td>0.0098</td>
<td>0.0099</td>
<td>0.0102</td>
<td>0.0103</td>
<td>0.0104</td>
</tr>
<tr>
<td>0.01</td>
<td>500000</td>
<td>0.0098</td>
<td>0.0099</td>
<td>0.0099</td>
<td>0.0102</td>
<td>0.0102</td>
<td>0.0103</td>
</tr>
<tr>
<td>0.1</td>
<td>10</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.2</td>
<td>0.2</td>
<td>0.3</td>
</tr>
<tr>
<td>0.1</td>
<td>100</td>
<td>0.05</td>
<td>0.06</td>
<td>0.07</td>
<td>0.13</td>
<td>0.14</td>
<td>0.15</td>
</tr>
<tr>
<td>0.1</td>
<td>1000</td>
<td>0.086</td>
<td>0.0889</td>
<td>0.093</td>
<td>0.108</td>
<td>0.1121</td>
<td>0.117</td>
</tr>
<tr>
<td>0.1</td>
<td>10000</td>
<td>0.0954</td>
<td>0.0963</td>
<td>0.0979</td>
<td>0.1028</td>
<td>0.1041</td>
<td>0.1055</td>
</tr>
<tr>
<td>0.1</td>
<td>50000</td>
<td>0.098</td>
<td>0.0986</td>
<td>0.0992</td>
<td>0.1014</td>
<td>0.1019</td>
<td>0.1024</td>
</tr>
<tr>
<td>0.1</td>
<td>100000</td>
<td>0.0987</td>
<td>0.099</td>
<td>0.0994</td>
<td>0.1011</td>
<td>0.1014</td>
<td>0.1018</td>
</tr>
<tr>
<td>0.1</td>
<td>250000</td>
<td>0.0993</td>
<td>0.0995</td>
<td>0.0998</td>
<td>0.1008</td>
<td>0.1011</td>
<td>0.1013</td>
</tr>
<tr>
<td>0.1</td>
<td>500000</td>
<td>0.0996</td>
<td>0.0998</td>
<td>0.1</td>
<td>0.1007</td>
<td>0.1009</td>
<td>0.101</td>
</tr>
<tr>
<td>0.5</td>
<td>10</td>
<td>0.2</td>
<td>0.3</td>
<td>0.4</td>
<td>0.6</td>
<td>0.7</td>
<td>0.8</td>
</tr>
<tr>
<td>0.5</td>
<td>100</td>
<td>0.42</td>
<td>0.44</td>
<td>0.46</td>
<td>0.54</td>
<td>0.56</td>
<td>0.58</td>
</tr>
<tr>
<td>0.5</td>
<td>1000</td>
<td>0.473</td>
<td>0.478</td>
<td>0.486</td>
<td>0.513</td>
<td>0.52</td>
<td>0.525</td>
</tr>
<tr>
<td>0.5</td>
<td>10000</td>
<td>0.4922</td>
<td>0.4939</td>
<td>0.4959</td>
<td>0.5044</td>
<td>0.5061</td>
<td>0.5078</td>
</tr>
<tr>
<td>0.5</td>
<td>50000</td>
<td>0.4962</td>
<td>0.4968</td>
<td>0.4978</td>
<td>0.5018</td>
<td>0.5028</td>
<td>0.5036</td>
</tr>
<tr>
<td>0.5</td>
<td>100000</td>
<td>0.4974</td>
<td>0.4979</td>
<td>0.4986</td>
<td>0.5014</td>
<td>0.5021</td>
<td>0.5027</td>
</tr>
<tr>
<td>0.5</td>
<td>250000</td>
<td>0.4984</td>
<td>0.4987</td>
<td>0.4992</td>
<td>0.5008</td>
<td>0.5013</td>
<td>0.5017</td>
</tr>
<tr>
<td>0.5</td>
<td>500000</td>
<td>0.4988</td>
<td>0.4991</td>
<td>0.4994</td>
<td>0.5006</td>
<td>0.5009</td>
<td>0.5011</td>
</tr>
</tbody>
</table></div><br>
<p>   10%     0.01% , ..         .</p><br>
<p> 10%     :</p><br>
<p><img src="https://habrastorage.org/webt/qz/n-/k7/qzn-k7kgvtlilgfg1yqjfuj7vog.png"></p><br>
<p> —   5-95%  , ..      90%   CR     .   —   ( ),  —   .   — "" CR.</p><br>
<p>    ,      :       ,      ""       "".   1000    8.6% — 11.7%,      .   10   9.5% — 10.55%.</p><br>
<p>           :</p><br>
<p><img src="https://habrastorage.org/webt/bu/rt/cy/burtcyycddxkmqy4kmgyoirmboc.png"></p><br>
<p>     0.01%      1  ,       .    .    10 000     . ,    10     1000   0 ,    1 .  100      0.005%  0.0016%, .          .</p><br>
<p>  ,          1  ,       .   ,                   ,     .</p><br>
<p>:</p><br>
<ol>
<li>     </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サンプル精度は、サンプルサイズが大きくなると向上し、変換率が低下すると低下します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">見積もりの​​精度は、タスクに合わせてモデル化できるため、自分に最適なサンプリングを選択できます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">まれなイベントがうまくサンプリングされないことを覚えておくことは重要です</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一般的に、まれなイベントは分析が困難であり、サンプルなしの大きなデータサンプルが必要です。</font></font></li>
</ol></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja458880/index.html">WSLおよびVisual Studio Code Remoteを使用したWindowsでのLinux開発</a></li>
<li><a href="../ja458882/index.html">公演。主なことについて簡単に</a></li>
<li><a href="../ja458884/index.html">宇宙通信規格について少し</a></li>
<li><a href="../ja458886/index.html">最も有用なMail.ru Design Conf×Dribbble Meetup 2019論文by True Engineering</a></li>
<li><a href="../ja458888/index.html">夏のドロイドのMeetup</a></li>
<li><a href="../ja458892/index.html">機械学習モデルの脆弱性と保護に関する提案</a></li>
<li><a href="../ja458894/index.html">典型的な人々と彼らが住んでいるネットワーク</a></li>
<li><a href="../ja458896/index.html">関数型JavaScript：高次関数とは何ですか？なぜそれらが必要なのですか？</a></li>
<li><a href="../ja458900/index.html">モデムとしてのコンソールカートリッジ</a></li>
<li><a href="../ja458902/index.html">5つの一般的な初心者のPythonの間違い</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>