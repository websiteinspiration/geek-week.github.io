<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÜüèª ‚ú°Ô∏è üñ±Ô∏è L'histoire de l'oiseau Dodo du genre Phoenix. La grande chute de Dodo EST üëèüèª ü§æüèΩ üë®‚Äçüë®‚Äçüëß‚Äçüëß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Chaque ann√©e le 21 avril, nous rappelons l'histoire de la Grande Chute de Dodo IS en 2018. Le pass√© est un enseignant cruel mais juste. Il vaut la pei...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>L'histoire de l'oiseau Dodo du genre Phoenix. La grande chute de Dodo EST</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dodopizzadev/blog/498280/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chaque ann√©e le 21 avril, nous rappelons l'histoire de la Grande Chute de Dodo IS en 2018. </font><font style="vertical-align: inherit;">Le pass√© est un enseignant cruel mais juste. </font><font style="vertical-align: inherit;">Il vaut la peine de s'en souvenir, de r√©p√©ter les le√ßons, de transmettre les connaissances accumul√©es aux nouvelles g√©n√©rations et de se r√©f√©rer avec reconnaissance √† ce que nous sommes devenus. </font><font style="vertical-align: inherit;">Sous la coupe, nous voulons vous raconter une histoire et comment partager les conclusions. </font><font style="vertical-align: inherit;">Vous ne pouvez m√™me pas souhaiter une telle situation √† l'ennemi.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sy/r0/jj/syr0jjrgnwuubuusucjvag6ot-o.png"><br>
<a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grande histoire d'automne</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jour 1. L'accident qui nous a co√ªt√© des millions de roubles</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le samedi 21 avril 2018, le syst√®me Dodo IS est tomb√©. Tomb√© tr√®s mal. Pendant plusieurs heures, nos clients n'ont pu passer de commande ni via le site ni via l'application mobile. La ligne d'appels vers le centre d'appels a atteint un tel niveau que la voix automatique du r√©pondeur indique: "Nous vous rappellerons dans 4 heures." </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ek/ha/ac/ekhaac2m8owflsjdblpfmnksux8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce jour-l√†, nous avons connu l'une des chutes les plus graves de Dodo IS. Le pire, c'est que la veille, nous avons lanc√© la premi√®re campagne de publicit√© t√©l√©vis√©e f√©d√©rale avec un budget de 100 millions de roubles. Ce fut un grand √©v√©nement pour Dodo Pizza. L'√©quipe informatique √©tait √©galement bien pr√©par√©e pour la campagne. Nous avons automatis√© et simplifi√© le d√©ploiement - maintenant, √† l'aide d'un seul bouton dans TeamCity, nous pouvions d√©ployer un monolithe dans 12 pays. Nous n'avons pas fait tout ce qui √©tait possible et avons donc foir√©.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La campagne publicitaire √©tait incroyable. Nous avons re√ßu 100 √† 150 commandes par minute. C'√©taient de bonnes nouvelles. La mauvaise nouvelle: Dodo IS n'a pas pu supporter une telle charge et est d√©c√©d√©. Nous avons atteint la limite de la mise √† l'√©chelle verticale et ne pouvions plus traiter les commandes. Le syst√®me a √©t√© instable pendant environ trois heures, r√©cup√©rant p√©riodiquement, mais est imm√©diatement tomb√© √† nouveau. Chaque minute d'arr√™t nous a co√ªt√© des dizaines de milliers de roubles, sans compter la perte de respect des clients en col√®re. L'√©quipe de d√©veloppement a laiss√© tomber tout le monde: clients, partenaires, gars des pizzerias et centre d'appels. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nu/te/kw/nutekwrugivxr0ns__zlnzxo74a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous n'avions pas d'autre choix que de retrousser nos manches et de nous asseoir pour corriger la situation. Depuis dimanche 22 avril, nous avons travaill√© en mode dur, nous n'avons pas eu le droit de nous tromper.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce qui suit est notre r√©sum√© de l'exp√©rience sur la fa√ßon de nous retrouver dans une telle situation et comment en sortir plus tard. </font><font style="vertical-align: inherit;">Amis, ne faites pas nos erreurs.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deux √©checs qui ont lanc√© l'effet Domino</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela vaut la peine de commencer par la fa√ßon dont tout a commenc√© et o√π nous avons foir√©. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/_h/qh/yy/_hqhyy80kusheiqap3xwfchwjvk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le samedi 21 avril 2018, vers 17 h, nous avons remarqu√© que le nombre de verrous dans la base de donn√©es commen√ßait √† augmenter - signe avant-coureur de probl√®mes. </font><font style="vertical-align: inherit;">Nous avions un runbook pr√™t √† r√©soudre, car nous comprenions d'o√π venaient ces verrous. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout s'est mal pass√© apr√®s l'√©chec du runbook √† deux reprises. </font><font style="vertical-align: inherit;">Pendant quelques minutes, la base est revenue √† la normale, puis a recommenc√© √† s'√©touffer avec les serrures. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H√©las, la base de donn√©es master rollback_on_timeout avait 600 secondes, c'est pourquoi tous les verrous s'accumulaient. </font><font style="vertical-align: inherit;">Il s'agit du premier fichier important de cette histoire. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une configuration simple pourrait tout sauver.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, il y a eu des tentatives pour ramener le syst√®me √† la vie √† bien des √©gards, mais aucune n'a r√©ussi. </font><font style="vertical-align: inherit;">Jusqu'√† ce que nous r√©alisions qu'il y a une diff√©rence dans le sch√©ma de r√©ception des commandes dans l'application mobile et sur le nouveau site. </font><font style="vertical-align: inherit;">En les coupant √† leur tour, nous avons pu comprendre o√π se trouvaient les trous dans l'ancien sch√©ma de prise de commande. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le syst√®me d'acceptation des commandes a √©t√© r√©dig√© il y a longtemps. </font><font style="vertical-align: inherit;">√Ä cette √©poque, il √©tait d√©j√† en cours de traitement et il a √©t√© d√©ploy√© sur le nouveau site dodopizza.ru. </font><font style="vertical-align: inherit;">Il n'√©tait pas utilis√© dans l'application mobile. </font><font style="vertical-align: inherit;">Initialement, les raisons de la cr√©ation d'un nouveau syst√®me de commande √©taient li√©es √† des r√®gles purement commerciales; les probl√®mes de performance n'√©taient m√™me pas √† l'ordre du jour. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il s'agit du deuxi√®me fichier important - nous ne connaissions pas les limites de notre syst√®me.</font></font></b><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jour 2. √âlimination des accidents </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La r√©ponse de l'√©quipe a √©t√© tr√®s r√©v√©latrice. Notre station-service a √©crit un article sur Slack, et tout le monde est venu le lendemain - le 22 avril, le travail a commenc√© √† 8h30 du matin. Personne n'avait besoin d'√™tre persuad√© ou invit√© √† venir son jour de cong√©. Tout le monde a tout compris: ce qui doit √™tre pris en charge, aid√©, avec ses mains, avec sa t√™te, dans les tests, l'optimisation des requ√™tes, les infrastructures. Certains sont m√™me venus avec toute la famille! Les gars des √©quipes voisines, non li√©es √† l'informatique, sont venus au bureau avec de la nourriture, et le centre d'appels a apport√© des forces suppl√©mentaires au cas o√π. Toutes les √©quipes r√©unies dans un m√™me objectif - se lever! </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4u/sv/nt/4usvntb_mitqlbh7sya9rltxoqq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une nouvelle r√©ception de la commande √©tait le principal objectif du dimanche 22 avril. Nous avons compris que le pic des commandes serait comparable √† samedi. Nous avions le d√©lai le plus s√©v√®re - √† 17 heures, une nouvelle vague de commandes tombera.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce jour-l√†, nous avons agi selon le plan "pour nous assurer qu'il ne tombe pas", que nous avons √©labor√© la veille du 21e jour en fin de soir√©e, alors que nous avions d√©j√† soulev√© le syst√®me et compris ce qui s'√©tait pass√©. </font><font style="vertical-align: inherit;">Le plan √©tait conditionnellement divis√© en 2 parties:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mise en place du sch√©ma avec une nouvelle commande dans l'application mobile.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Optimisation du processus de cr√©ation de commande.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En impl√©mentant ces choses, nous pouvons √™tre s√ªrs que Dodo IS ne tombera pas. </font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous d√©terminons le front du travail et le travail</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La mise en ≈ìuvre du programme avec une nouvelle commande dans une application mobile √©tait la plus haute priorit√©. Nous ne disposions pas de chiffres exacts pour l'ensemble du syst√®me, mais dans certaines parties, le nombre et la qualit√© des requ√™tes vers la base de donn√©es, nous avons savamment compris que cela augmenterait la productivit√©. Une √©quipe de 15 personnes a travaill√© sur la t√¢che jour apr√®s jour. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien qu'en fait l'introduction d'un nouveau sch√©ma de commande, nous avons commenc√© avant la chute du 21/04, mais n'avons pas termin√© la transaction. Il y avait encore des bogues actifs et la t√¢che se bloquait dans un √©tat semi-actif. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'√©quipe a divis√© la r√©gression en plusieurs parties: r√©gression √† partir de deux plateformes mobiles, plus gestion de pizzeria. Nous avons pass√© beaucoup de temps manuellement √† pr√©parer des pizzerias de test, mais une s√©paration claire a permis de parall√©liser la r√©gression manuelle.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D√®s qu'un changement a √©t√© introduit, il a √©t√© imm√©diatement d√©ploy√© dans l'environnement de pr√©-production et test√© instantan√©ment. L'√©quipe √©tait toujours en contact les uns avec les autres, ils √©taient vraiment assis dans une grande salle avec des lieux de rencontre. Les gars de Nizhny Novgorod et Syktyvkar √©taient √©galement toujours en contact. S'il y avait une prise, il a imm√©diatement d√©cid√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Habituellement, nous sortons progressivement de nouvelles fonctionnalit√©s: 1 pizzeria, 5 pizzerias, 10 pizzerias, 20 pizzerias et ainsi de suite sur l'ensemble du r√©seau. Cette fois, nous devions agir de mani√®re plus d√©cisive. Nous n'avions pas le temps - √† 17 heures un nouveau pic a commenc√©. Nous ne pouvions tout simplement pas manquer de l'attraper.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vers 15h00, la mise √† jour a √©t√© d√©ploy√©e sur la moiti√© du r√©seau (environ 200 pizzerias). √Ä 15h30, nous nous sommes assur√©s que tout fonctionnait bien et avons allum√© l'ensemble du r√©seau. Les fonctions bascule, les d√©ploiements rapides, la r√©gression divis√©e en parties et l'API fixe ont aid√© √† faire tout cela. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le reste de l'√©quipe a trait√© diff√©rentes options d'optimisation lors de la cr√©ation d'une commande. Le nouveau sch√©ma n'√©tait pas enti√®rement nouveau, il utilisait toujours la partie h√©rit√©e. Enregistrer des adresses, appliquer des codes promotionnels, g√©n√©rer des num√©ros de commande - ces pi√®ces √©taient et sont rest√©es courantes. Leur optimisation a √©t√© r√©duite soit √† la r√©√©criture des requ√™tes SQL elles-m√™mes, soit √† leur suppression dans le code, soit √† l'optimisation de leurs appels. Quelque chose s'est pass√© en mode asynchrone, quelque chose, comme il s'est av√©r√©, a √©t√© appel√© plusieurs fois au lieu d'une.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'√©quipe d'infrastructure s'est engag√©e √† allouer une partie des composants √† des instances distinctes simplement pour ne pas traverser la charge. </font><font style="vertical-align: inherit;">Notre principal probl√®me √©tait la fa√ßade Legacy, qui est all√©e √† la base Legacy. </font><font style="vertical-align: inherit;">Tout le travail lui √©tait consacr√©, y compris la division des instances.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Organisez le processus</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le matin, nous avons eu la seule synchronisation de la journ√©e, nous sommes entr√©s en √©quipes et sommes partis travailler. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au d√©but, nous avons conserv√© l'int√©gralit√© du journal des modifications et des t√¢ches directement dans Slack, car au d√©but, il n'y avait pas tellement de t√¢ches. Mais leur nombre augmentait, nous avons donc rapidement d√©m√©nag√© √† Trello. L'int√©gration configur√©e entre Slack et Trello a notifi√© tout changement d'√©tat dans le puzzle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, il √©tait important pour nous de voir l'int√©gralit√© du journal des changements de production. La version √©lectronique √©tait √† Trello, la version de sauvegarde √©tait sur la carte d'infrastructure sous forme de cartes. En cas de probl√®me, nous devions trouver rapidement les modifications √† annuler. La r√©gression compl√®te ne concernait que le sch√©ma avec un nouvel ordre, les autres modifications ont √©t√© test√©es plus fid√®lement.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les t√¢ches ont vol√© √† la production √† une vitesse de balle. Au total, nous avons mis √† jour le syst√®me 15 fois ce jour-l√†. Les gars ont √©t√© d√©ploy√©s sur des bancs d'essai, un par √©quipe. D√©veloppement, contr√¥le rapide, d√©ploiement en production. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En plus du processus CTO principal, Sasha Andronov a constamment rencontr√© des √©quipes avec la question ¬´Comment aider?¬ª. Cela a permis de redistribuer les efforts et de ne pas perdre de temps sur le fait que quelqu'un n'a pas pens√© √† demander de l'aide. Gestion du d√©veloppement semi-manuel, un minimum de distractions et un travail √† la limite. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s cette journ√©e, il fallait sortir avec le sentiment que nous faisions tout ce que nous pouvions. Et encore plus. Et nous l'avons fait! A 15h30, un nouveau sch√©ma d'acceptation des commandes a √©t√© d√©ploy√© pour l'application mobile sur l'ensemble du r√©seau. Mode Hackathon, moins de 20 d√©ploiements par production par jour!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La soir√©e du 22 avril fut calme et claire. </font><font style="vertical-align: inherit;">Ni les chutes ni le moindre indice n'est que le syst√®me peut √™tre mauvais. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vers 22 heures, nous nous sommes √† nouveau r√©unis et avons d√©fini un plan d'action hebdomadaire. </font><font style="vertical-align: inherit;">Limitation, tests de performances, ordre asynchrone et bien plus encore. </font><font style="vertical-align: inherit;">Ce fut une longue journ√©e, et il y avait de longues semaines √† venir.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Renaissance</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La semaine du 23 avril a √©t√© infernale. </font><font style="vertical-align: inherit;">Apr√®s cela, nous nous sommes dit que nous avions fait de notre mieux √† 200% et fait tout ce que nous pouvions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons d√ª sauver Dodo IS et avons d√©cid√© d'appliquer une analogie m√©dicale. </font><font style="vertical-align: inherit;">En g√©n√©ral, c'est le premier vrai cas d'utilisation d'une m√©taphore (comme dans le XP d'origine), qui a vraiment aid√© √† comprendre ce qui se passait:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©animation - lorsque vous devez sauver un patient mourant. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Traitement - lorsqu'il y a des sympt√¥mes, mais que le patient est toujours en vie.</font></font></li>
</ul><br>
<br>
<img src="https://habrastorage.org/webt/1a/jm/_r/1ajm_re5g-xgtcik_ykvtdlewmu.jpeg"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©animation</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La premi√®re √©tape de la r√©animation est le runbook standard pour restaurer le syst√®me en cas de panne selon certains param√®tres. </font><font style="vertical-align: inherit;">Une chose est tomb√©e - nous le faisons, celle-l√† est tomb√©e - nous le faisons et ainsi de suite. </font><font style="vertical-align: inherit;">En cas de plantage, nous trouvons rapidement le runbook souhait√©, ils se trouvent tous sur GitHub et sont structur√©s par probl√®mes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La deuxi√®me √©tape de la r√©animation est la limitation des commandes. </font><font style="vertical-align: inherit;">Nous avons adopt√© cette pratique √† partir de nos propres pizzerias. </font><font style="vertical-align: inherit;">Lorsque de nombreuses commandes sont d√©vers√©es √† la pizzeria et qu‚Äôelles comprennent qu‚Äôelles ne peuvent pas les faire cuire rapidement, elles s'arr√™tent pendant 5 minutes. Juste pour effacer la ligne de commande. </font><font style="vertical-align: inherit;">Nous avons fait un sch√©ma similaire pour Dodo IS. </font><font style="vertical-align: inherit;">Nous avons d√©cid√© que si cela devenait vraiment mauvais, nous allumerions la limite g√©n√©rale et informerions les clients, disent-ils, les gars, 5 minutes et nous prendrions votre commande. </font><font style="vertical-align: inherit;">Nous avons d√©velopp√© cette mesure au cas o√π, mais en cons√©quence, nous ne l'avons jamais utilis√©e. </font><font style="vertical-align: inherit;">Pas utile. </font><font style="vertical-align: inherit;">Et gentil.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Traitement</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afin de commencer le traitement, il est n√©cessaire de faire un diagnostic, nous nous sommes donc concentr√©s sur les tests de performance. Une partie de l'√©quipe est all√©e collecter un profil de charge r√©el de la production en utilisant GoReplay, une partie de l'√©quipe s'est concentr√©e sur les tests synth√©tiques sur sc√®ne. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les tests synth√©tiques ne refl√©taient pas le profil de charge r√©el, mais ils ont donn√© lieu √† des am√©liorations, ont montr√© certaines faiblesses du syst√®me. Par exemple, peu de temps avant, nous d√©placions le connecteur MySQL d'Oracle </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vers un nouveau</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dans la version du connecteur, il y avait un bug avec les sessions de mise en commun, ce qui a conduit au fait que les serveurs ont simplement atteint le plafond du processeur et ont cess√© de servir les demandes. Nous l'avons reproduit avec des tests Stage, con√ßu et mis en production en silence. Il y a eu une douzaine de cas de ce type.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsqu'ils diagnostiquent et identifient les causes des probl√®mes, ils sont corrig√©s de fa√ßon ponctuelle. </font><font style="vertical-align: inherit;">Nous avons en outre compris que notre moyen id√©al est la r√©ception asynchrone d'une commande. </font><font style="vertical-align: inherit;">Nous avons commenc√© √† travailler sur son introduction dans une application mobile.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hell semaines: organisation des processus</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une √©quipe de 40 personnes a travaill√© sur un seul grand objectif: la stabilisation du syst√®me. Toutes les √©quipes ont travaill√© ensemble. Je ne sais pas quoi faire? Aidez les autres √©quipes. Se concentrer sur des objectifs sp√©cifiques a aid√© √† ne pas se faire asperger et √† ne pas se livrer √† des b√™tises qui n'√©taient pas n√©cessaires pour nous. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zu/3e/ik/zu3eikvdviql0uyvqabv3w18axi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trois fois par jour, il y avait la synchronisation, un stand-up commun, comme dans une m√™l√©e classique. Pour 40 personnes. Seulement deux fois en trois semaines (pour pr√®s de 90 synchronisations), nous n'avons pas rencontr√© 30 minutes. La synchronisation la plus longue a dur√© 57 minutes. Bien que cela prenne g√©n√©ralement 20 √† 30 minutes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le but des synchronisations: comprendre o√π l'aide est n√©cessaire et quand nous allons mettre ces t√¢ches en production. Les gars se sont unis dans les √©quipes de projet, si une aide aux infrastructures √©tait n√©cessaire, une personne est venue sur place, tous les probl√®mes ont √©t√© r√©solus rapidement, moins de discussions √©taient plus importantes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le soir, afin de soutenir les gars, notre laboratoire R&amp;D a pr√©par√© de la nourriture pour les d√©veloppeurs pour la soir√©e. Recettes de pizza folles, ailes de poulet, pommes de terre! C'√©tait vraiment cool! Un tel soutien a motiv√© autant que possible les gars. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ms/pz/3f/mspz3f9matohgpx7z9sk9bf8pzu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Travailler dans un tel mode non-stop √©tait sacr√©ment difficile. Le mercredi 25 avril, vers 17 heures, Oleg Blokhin, l'un de nos d√©veloppeurs, a approch√© CTO, qui figurait samedi sans s'arr√™ter. Il y avait une fatigue inhumaine dans ses yeux: "Je suis rentr√© chez moi, je ne peux plus le supporter." Il dormait bien et le lendemain √©tait copieux. Vous pouvez donc d√©crire l'√©tat g√©n√©ral de nombreux gars.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le samedi suivant, le 28 avril (c'√©tait un samedi de travail pour tout le monde en Russie) √©tait plus calme. </font><font style="vertical-align: inherit;">On ne pouvait rien changer, on regardait le syst√®me, les gars se reposaient un peu du rythme. </font><font style="vertical-align: inherit;">Tout s'est bien pass√©. </font><font style="vertical-align: inherit;">La charge n'√©tait pas si √©norme, mais elle l'√©tait. </font><font style="vertical-align: inherit;">Ils ont surv√©cu sans probl√®me, ce qui donne confiance que nous allons dans la bonne direction. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les deuxi√®me et troisi√®me semaines apr√®s la chute √©taient d√©j√† dans un mode plus calme, le rythme infernal jusque tard dans la soir√©e avait disparu, mais le processus g√©n√©ral de la loi martiale √©tait rest√©.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jour suivant X: test de r√©sistance</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le lendemain, X √©tait le 9 mai! </font><font style="vertical-align: inherit;">Quelqu'un √©tait assis √† la maison et surveillait l'√©tat du syst√®me. </font><font style="vertical-align: inherit;">Ceux d'entre nous qui sont all√©s se promener ont pris des ordinateurs portables avec nous pour √™tre compl√®tement arm√©s en cas de probl√®me. </font><font style="vertical-align: inherit;">Sasha Andronov, notre station-service, s'est rapproch√©e du pic du soir d'une des pizzerias afin de tout voir en personne en cas de probl√®me. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce jour-l√†, nous avons re√ßu 91500 commandes en Russie (√† l'√©poque le deuxi√®me r√©sultat de l'histoire du Dodo). </font><font style="vertical-align: inherit;">Il n'y avait m√™me pas la moindre trace de probl√®me. </font><font style="vertical-align: inherit;">Le 9 mai a confirm√© que nous √©tions sur la bonne voie! </font><font style="vertical-align: inherit;">Concentrez-vous sur la stabilit√©, les performances, la qualit√©. </font><font style="vertical-align: inherit;">La restructuration du processus nous attendait davantage, mais c'est une toute autre histoire.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grand automne r√©tro et 6 pratiques</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans les situations critiques, de bonnes pratiques sont d√©velopp√©es qui peuvent et doivent √™tre transf√©r√©es √† un moment de tranquillit√©. Concentration, aide inter-√©quipes, d√©ploiement rapide en production sans attendre une r√©gression compl√®te. Nous avons commenc√© avec r√©tro, puis d√©velopp√© le cadre du processus. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wp/md/ty/wpmdtygdhvy93ufctatnfmxypms.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les deux premiers jours se sont √©coul√©s sur une discussion des pratiques. Nous ne nous √©tions pas fix√© pour objectif de "mettre une r√©trospective √† 14 heures". Apr√®s une telle situation, nous √©tions pr√™ts √† prendre le temps d'√©laborer nos id√©es et notre nouveau processus en d√©tail. Tout le monde a particip√©. Tous ceux qui ont particip√© d'une mani√®re ou d'une autre aux travaux de restauration. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qf/52/qu/qf52qu_y6lojoqjjcxw3lrronny.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, il y a 6 pratiques importantes dont j'aimerais parler plus en d√©tail.</font></font><br>
<br>
<ol>
<li><b>Top N .</b>   ,  .      Product Owners ,  ,     ,         .    .      ,   .        ,  ,  ,   .   ,         .   N         ‚Äì  Lead Time    . </li>
<li><b> .</b>    .     -,      ,        .         ,        ,  ,     .   . </li>
<li><b> .</b>    ,   ¬´    ¬ª    . ,        . ,     ,     .  ,         -   .       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">       Dodo IS.</a>         .</li>
<li><b> Pull Request.</b>      ,     Pull Request,      -   .    .   ,   ,   ,   ,  -   .            , . ,  .  15          .</li>
<li><b>Performance- ‚Äî  .</b>  performance-     .   ,   . Performance-    .   baseline   ,    PR   .       ,   . </li>
<li><b>Performance     .</b>     ‚Äî      .  , , -,  , ,       .         .        ,    . </li>
</ol><br>
<br>
<h2></h2><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">1.    </b>
                        <div class="spoiler_text"><h4><b>21.04.2018 ‚Äì    Dodo IS.     ? </b></h4><br>
<img src="https://habrastorage.org/webt/4l/3r/6-/4l3r6-lc2cgut1u8ec3gdawjdma.png" align="left" width="60"> <u><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a> (Site Reliability Engineering)</b></u>:      .  ,    . <br>
<br>
<img src="https://habrastorage.org/webt/lj/ov/je/ljovjerpqe5mx5j5w9nsxer5xxq.png" align="right" width="60"> <u><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a> (Site Reliability Engineering, Product Owner   Dodo IS)</b></u>:      . ,    ,   . <br>
<br>
     auth‚Äô,       .         .      ,        . <br>
<br>
   ,    ()   :<br>
<br>
<img src="https://habrastorage.org/webt/_h/qh/yy/_hqhyy80kusheiqap3xwfchwjvk.jpeg"><br>
<br>
        .     ,    . <br>
<br>
      .       ,      .       .     -.  ,         ,      . -  ,  ,    .     ,        -,    ,    . <br>
<br>
         .           redis,      .    .      - ,   .       .<br>
<br>
     Dodo IS   .        .      ,     . ,        , , ,   .     ,      ‚Äî     . <br>
<br>
     .                ¬´ ¬ª.  ¬´  ,   ¬ª    . <br>
<br>
<h4><b> -   ?</b></h4><br>
<img src="https://habrastorage.org/webt/4l/3r/6-/4l3r6-lc2cgut1u8ec3gdawjdma.png" align="left" width="60"> <u><b> </b></u>:<br>
<br>
   ‚Äì    .       .         . ,             .      .   .<br>
<br>
<img src="https://habrastorage.org/webt/lj/ov/je/ljovjerpqe5mx5j5w9nsxer5xxq.png" align="right" width="60"> <u><b> </b></u>:<br>
<br>
     .     ,       .   (  ), -       .   .<br>
<br>
       .  :<br>
<br>
<ol>
<li>      .</li>
<li>     .</li>
<li>       ,     . </li>
</ol><br>
<h4><b>      ?</b></h4><br>
<br>
<img src="https://habrastorage.org/webt/4l/3r/6-/4l3r6-lc2cgut1u8ec3gdawjdma.png" align="left" width="60"> <u><b> </b></u>:<br>
<br>
,        ,  ,      .<br>
<br>
<img src="https://habrastorage.org/webt/lj/ov/je/ljovjerpqe5mx5j5w9nsxer5xxq.png" align="right" width="60"> <u><b> </b></u>:<br>
<br>
 ,            ,    .     ,     .<br>
<br>
<h4><b>    ?               ?</b></h4><br>
<br>
<img src="https://habrastorage.org/webt/4l/3r/6-/4l3r6-lc2cgut1u8ec3gdawjdma.png" align="left" width="60"> <u><b> </b></u>:  ,      ‚Äì  . <br>
<br>
<img src="https://habrastorage.org/webt/lj/ov/je/ljovjerpqe5mx5j5w9nsxer5xxq.png" align="right" width="60"> <u><b> </b></u>:<br>
<br>
<ol>
<li> ‚Äî     . -     -   . <br>
<br>
          ,       .  2018       ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PerformanceLab</a>,      .</li>
<li>     ,          .      Less-. </li>
<li>         .   2018         -,     .      ,    .    - 2018   .</li>
<li>  async  . ,   21.04.2018     .    ,     .     async. </li>
<li> . ,    SaveOrder  async-await.   ,     .      :          ,       LF,         20   .       ,       .  ,         .    !<br>
<br>
    ,   ,           ,     . <br>
<br>
         ,    ,  .          ‚Äî -.       . </li>
<li>     .         ,   (, ).      ,        .  ¬´¬ª    .   nginx   ,    -  ,       . <br>
<br>
    : innodb_lock_wait_timeout = 5; innodb_rollback_on_timeout = ON.         .   ,     ,       ,    ,       . </li>
</ol><br>
<h4><b>   ,       ?</b></h4><br>
<img src="https://habrastorage.org/webt/4l/3r/6-/4l3r6-lc2cgut1u8ec3gdawjdma.png" align="left" width="60"> <u><b> </b></u>:<br>
<br>
<ol>
<li>   ,   ,     ,   .   ,     .</li>
<li>    ,     .</li>
<li>      ,   ,    ,    .         ‚Äì    .</li>
</ol><br>
<img src="https://habrastorage.org/webt/lj/ov/je/ljovjerpqe5mx5j5w9nsxer5xxq.png" align="right" width="60"> <u><b> </b></u>:<br>
<br>
<ol>
<li>   .</li>
<li>    .        , ,    -.          .</li>
<li>    .   ,   -    ,    .</li>
</ol><br>
<h4><b>   ,       ?</b></h4><br>
<img src="https://habrastorage.org/webt/4l/3r/6-/4l3r6-lc2cgut1u8ec3gdawjdma.png" align="left" width="60"> <u><b> </b></u>:<br>
<br>
  ¬´¬ª   ,   ¬´¬ª. ,      ,     .    . <br>
<br>
<img src="https://habrastorage.org/webt/lj/ov/je/ljovjerpqe5mx5j5w9nsxer5xxq.png" align="right" width="80"> <u><b> </b></u>:<br>
<br>
  ,      .   , ,     .     .<br>
</div>
                    </div><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">2. ,        (Dodo IS Architect)</b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/webt/ge/pg/qm/gepgqmcioq9qqndtdk9dbz8njjo.png" align="left" width="60">              ‚Äî ,     .       ,      ‚Äî             . <br>
<br>
        ,        ,           . ,         (, ,    )        .<br>
<br>
        IT-.       Dodo IS,         .              ‚Ä¶<br>
<br>
 X ,  .      . Dodo IS  ,         ,   ,        .      ,  , ,    .    .     146%,     .     ,    Dodo IS  ?<br>
<br>
    ,  .    ,    ,         .                  ,       .       ,      !<br>
<br>
     ,   .   ¬´ ¬ª: 11-  ,  ,  2 .  ¬´¬ª       .  3-4     ,          .          ,     .   .<br>
<br>
  , ,            .         . Dodo IS     ,   ¬´ ¬ª.     ! (    ). <br>
<br>
     ,     Dodo IS      ,      .   Dodo IS .       ¬´ ¬ª, ,    .             (   ),         loadtest,   ,   .<br>
</div>
                    </div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr498268/index.html">API Mosbirge gratuite dans les formules Microsoft Excel</a></li>
<li><a href="../fr498270/index.html">Quels professionnels de l'informatique sont embauch√©s pendant la crise √©conomique et la pand√©mie?</a></li>
<li><a href="../fr498272/index.html">Gagnez du temps et des efforts sur la mise en ≈ìuvre de normes de d√©veloppement s√©curis√©es avec OWASP SAMM</a></li>
<li><a href="../fr498276/index.html">Championnat de programmation sportive en ligne RuCode</a></li>
<li><a href="../fr498278/index.html">Editeur Peter. Soldes de printemps</a></li>
<li><a href="../fr498282/index.html">[instruction] Cr√©ation d'un compte et d'un site sur la plateforme Google Site</a></li>
<li><a href="../fr498284/index.html">Comment optimiser l'apprentissage de l'anglais</a></li>
<li><a href="../fr498288/index.html">Votre ville a besoin d'un bus de m√©tro</a></li>
<li><a href="../fr498290/index.html">Hydrologie proc√©durale: simulation dynamique des rivi√®res et des lacs</a></li>
<li><a href="../fr498292/index.html">√âconomisez beaucoup d'argent sur de gros volumes dans PostgreSQL</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>