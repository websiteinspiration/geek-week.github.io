<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëï üèÄ üçä Dependency injection and the dependency inversion principle are NOT ONE AND SAME üõ§Ô∏è üòô üßëüèø‚Äçü§ù‚Äçüßëüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The translation of the article was prepared in advance of the start of the course "C ++ Developer" .
 
 
 
 Once upon a time, when I started blogging ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Dependency injection and the dependency inversion principle are NOT ONE AND SAME</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/505342/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The translation of the article was prepared in advance of the start of the course </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"C ++ Developer"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sa/sl/j7/saslj70zbwjvfx4rubfcof0jouo.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Once upon a time, when I started blogging on LosTechies, I wrote several articles about </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dependency Inversion (DI)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , Dependency Injection (also DI), and, of course, about </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">how I finally I began to understand the essence of dependency injection</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">At that time, I thought that both DIs were just variations of the name of the same technique ‚Äî whether you called it ‚Äúinjection‚Äù or ‚Äúinversion‚Äù.</font></font><a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Injection! = Inversion</font></font></h3><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">About</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
a year after these two publications, </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">I wrote an article for Code Magazine on the principles of SOLID software development</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">In the process of writing, I asked my then collaborator </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Derek Greer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Be a reviewer of this article. This turned out to be the best thing I've ever done for my understanding of SOLID, because Derek was kind enough (and patient with my stubbornness) to show me where my understanding of dependency inversion was different from the right one. He took the time to guide me through Uncle Bob's original articles, explain where I mixed dependency injection with inversion, and finally clarified this topic for me. As a result, I got a great article, which is still quite popular - and I am very grateful to Derek for help in correcting my understanding. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, to this day I continue to see how other people make the same mistake - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">even in ruby</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Therefore, to help others understand what dependency inversion is and what it is not, I am republishing a section about it here from my SOLID article. </font><font style="vertical-align: inherit;">I understand that part of the text will not make sense outside the context of the rest of the article. </font><font style="vertical-align: inherit;">However, the general principle should be obvious, and you have the opportunity at any time to follow the link to the article to clarify your points. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Legal formality: the following text originally appeared in the </font><font style="vertical-align: inherit;">January / February 2010 </font><font style="vertical-align: inherit;">issue of </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CODE Magazine</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and is reproduced here with their permission)</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dependency Inversion Principle</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The Dependency Inversion Principle (DIP) consists of two parts:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Upper level modules should not be dependent on lower level modules. </font><font style="vertical-align: inherit;">Both those and others should depend on abstractions.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abstractions should not depend on the details. </font><font style="vertical-align: inherit;">Details should depend on abstractions.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Refresh the last time you wanted to turn on the lamp to illuminate part of the room. </font><font style="vertical-align: inherit;">Was it necessary to cut a hole in the wall, dig around in search of wiring, expose it and solder the lamp directly into the wiring of the house? </font><font style="vertical-align: inherit;">Of course not (at least I hope not!). </font><font style="vertical-align: inherit;">An electrical outlet provides a standard interface for this. </font><font style="vertical-align: inherit;">No one in most industrialized countries expects a conventional lamp to solder it directly into a building‚Äôs electrical wiring. </font><font style="vertical-align: inherit;">In addition, no one expects to be able to insert only one lamp into the outlet. </font><font style="vertical-align: inherit;">We are used to connecting lamps, computers, televisions, vacuum cleaners and other devices. </font><font style="vertical-align: inherit;">A standard 120 volt, 60 hertz electrical outlet has become a ubiquitous part of society in the United States.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The same principle applies in software development. </font><font style="vertical-align: inherit;">Instead of working with a set of classes that are tightly interconnected, you would like to work with a standard interface. </font><font style="vertical-align: inherit;">Moreover, you would like to guarantee that you can replace the implementation without violating the expectations of this interface, according to the LSP (Liskov Substitution Principle). </font><font style="vertical-align: inherit;">Thus, if you work with an interface and want to be able to replace it, you need to make sure that you work only with the interface, and not with a specific implementation. </font><font style="vertical-align: inherit;">That is, code that relies on an interface should know the details only about that interface. </font><font style="vertical-align: inherit;">He should not be aware of any specific classes that implement this interface.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Relationships of Policies, Details, and Abstractions</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Paraphrasing the principle of inversion a little, we can say that the policy (high level) should not depend on the detail (implementation), and the detail should depend on the policy. A higher-level policy should define the abstraction to which it will refer, where some implementation of the part performs the requested action. This perspective helps illustrate why it is the principle of </font><font style="vertical-align: inherit;">dependency </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inversion</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and not just the principle of dependency abstraction.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As an example of why a part‚Äôs dependency on a policy is an inverse of a dependency, consider the code we wrote in FormatReaderService. </font><font style="vertical-align: inherit;">The formatted file reader service is a policy. </font><font style="vertical-align: inherit;">It defines what the IFileFormatReader interface should do ‚Äî the expected behavior of these methods. </font><font style="vertical-align: inherit;">This allows you to focus on the policy itself, determining how the reading service works, without taking into account the implementation of details - readers of individual formats. </font><font style="vertical-align: inherit;">Thus, readers are dependent on the abstraction provided by the reader service. </font><font style="vertical-align: inherit;">In the end, both the service and individual readers depend on the abstraction of the format reader interface.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reducing connectivity by inverting dependencies</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You know that having no dependencies (having zero connectivity) is impractical for a class. You would not have a usable set of classes if you had zero connectivity. However, you would also like to get rid of direct connectedness whenever possible. You would like to divide your system so that it allows you to change its individual parts without changing anything other than these very parts. The principle of dependency inversion is the key to this concept. Relying only on an abstraction, such as an interface or a base class, you can reduce the connectivity between different parts of your system. This allows you to rebuild the system with various implementations.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consider the many classes that need to be instantiated in a clear hierarchy so that you can get some of the functionality you need. The easiest way is to create an instance of the class one level lower using the class of the highest level (the one you want to call), using it to instantiate the class even lower, and so on. Figure 14 shows a graph of objects in which an object of a higher level (policy) depends on and is directly connected with an object of a lower level (detail). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7i/zd/jv/7izdjvplld2jiet956hwk3ttlte.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 14: Policy associated with the part.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This implements the necessary hierarchy, but directly binds classes. You cannot use Foo without dragging Bar. If you want to separate these classes, you can easily enter an interface that Bar will implement, and on which Foo will depend. Figure 15 shows a simple IBar interface that you can create based on the public Bar class API. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gi/ed/cx/giedcxlbprh_liaxhbew-59rggg.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 15: Separation using abstraction.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
In this scenario, you can separate the implementation of Bar from its use in Foo by introducing an interface. However, you only separate the implementation by selecting the interface from it. You have not yet inverted the dependency structure and have not fixed all the connectivity problems in this schema.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What happens when in this scenario you want to change Bar? Depending on what changes you want to make, you can provoke a chain reaction that forces you to change the IBar interface. Foo depends on the IBar interface, so you must also change the implementation of Foo. You may have separated the implementation of Bar, but left Foo dependent on changes to Bar. That is, the policy still depends on the details. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you want to invert the structure of dependencies so that the Part becomes dependent on the Policy, then first of all you must change your perspective. The developer working with this system should understand that you have not only abstracted the implementation from the interface. Yes, this separation is necessary, but not enough. You need to understand who the abstraction belongs to - Politics or Details.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The dependency inversion principle states that details must be dependent on policies. This means that you must have a policy that defines and owns the abstraction that the part implements. In the script Foo-&gt; IBar-&gt; Bar, you need to consider IBar as part of Foo, and not just as a wrapper for Bar. Although nothing has changed structurally, the perspective of ownership has changed, as shown in Figure 16. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dv/x8/13/dvx813ddp0l2nuaqdj6z_nsm5sm.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 16: Politics owns abstraction. Detail depends on the policy.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If Foo has an IBar abstraction, you can put these two constructs in a package independent of Bar. You can put them in your own namespace, in your own assembly, etc. This can greatly increase the visibility of which class or module depends on which one. If you see that AssemblyA contains Foo and IBar, and AssemblyB provides an implementation of IBar, then it‚Äôs easier for you to notice that the granularity of Bar depends on the policy defined by Foo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you correctly invert the structure of dependencies, the chain reaction to changes in policy and / or details will now also be correct. </font><font style="vertical-align: inherit;">When you change the implementation of Bar, you no longer observe an upward chain of changes. </font><font style="vertical-align: inherit;">This is because Bar needs to conform to the abstraction provided by Foo - the details no longer dictate a change in policy. </font><font style="vertical-align: inherit;">Then, when you change the needs of Foo, causing changes in the IBar interface, your changes will spread throughout the structure. </font><font style="vertical-align: inherit;">Bar (detail) will be forced to change depending on policy changes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Separation and inversion of email sending system dependencies</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Looking through our code base, you may notice that IFileFormatReader is already an example of dependency inversion. The FormatReaderService class owns a format reader interface definition. If the needs of the formatted file reader service change, you will most likely see a chain of changes descending to format readers. However, if the reader of a specific file format changes, you are unlikely to see that these changes will affect the reading service of formatted files. This makes you wonder where else you can invert system dependencies.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first thing you want to do is to separate the logic of receiving log messages and sending it by e-mail from the sending form. You do not mind the links to the two email reading and sending services, but the question of when and what to cause raises doubts. You realize that the process is actually duplicated in the form: once for sending from a file and once for sending from a database. And then you recall all the other departments that also use this, and start to wonder about the real extent of the duplication process. In addition, some of your friends recently talked about "unit testing." They say that you must make sure that the real logic of the process you are testing is encapsulated in objects that do not have references to external systems.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And with that all in mind, you decide to create an object called ProcessingService. After a few minutes of shuffling the code back and forth in order to try to consolidate the process, you realize that you do not want the processing service to be directly connected to the database reader or file read services. After a little thought, you notice a pattern between them: the GetMessageBody method. Using this method as a basis, you create a new IMessageInfoRetriever interface and implement it both as a database reader and as a file reader.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">public</span> interface IMessageInfoRetriever<font></font>
{ <font></font>
  <span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">GetMessageBody</span><span class="hljs-params">()</span></span>; <font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileReaderService</span>:</span> IMessageInfoRetriever<font></font>
{<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetMessageBody</span><span class="hljs-params">()</span> </span>{<span class="hljs-comment">/* ... */</span>}<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DatabaseReaderService</span>:</span> IMessageInfoRetriever<font></font>
{<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetMessageBody</span><span class="hljs-params">()</span> </span>{<span class="hljs-comment">/* ... */</span>}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This interface allows you to provide any implementation for processing services that you need. </font><font style="vertical-align: inherit;">Then you pay attention to the email service, which is currently directly linked to the processing service. </font><font style="vertical-align: inherit;">The simple IEmailService interface solves this problem. </font><font style="vertical-align: inherit;">Figure 17 shows the resulting structure. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nv/np/aa/nvnpaagcxk8lp-aupfuydbylwu0.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 17: Inverting the dependencies of the processing service and the file reading service. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Passing message retrieval interfaces and e-mail services to the processing service ensures that there is an instance of any class that implements these interfaces, without the need to know about specific types of instances.</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Learn more about the course.</font></font></a><br>
<br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en505314/index.html">Linux time synchronization: NTP, Chrony, and systemd-timesyncd</a></li>
<li><a href="../en505322/index.html">Dispatcher of the future: how will his role in the service company change?</a></li>
<li><a href="../en505330/index.html">How to not create a cryptocurrency from scratch in 3 years</a></li>
<li><a href="../en505336/index.html">How to: Manet or Monet? Neural network responds</a></li>
<li><a href="../en505340/index.html">Walmart employees try to prove that anti-theft AI doesn't work</a></li>
<li><a href="../en505362/index.html">Vite - lead development without bundles on Vue</a></li>
<li><a href="../en505378/index.html">All this marketing: how to work with contact points in an IT company?</a></li>
<li><a href="../en505386/index.html">Installing Debian on Netgear Stora</a></li>
<li><a href="../en505388/index.html">Treezor - Leader in Banking Services at Soci√©t√© G√©n√©rale</a></li>
<li><a href="../en505390/index.html">F # community founder: ‚ÄúOOP and AF of the brain must die‚Äù // We are doomed # 7</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>