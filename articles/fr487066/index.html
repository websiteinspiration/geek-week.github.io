<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤟🏽 ⛑️ 🌘 Travailler avec la puce chinoise ADC Hx711 😮 🎌 🍖</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La raison de la rédaction de cet article est le désir de traiter le convertisseur ADC sigma delta 24 bits basé sur la puce Hx711. Le convertisseur lui...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Travailler avec la puce chinoise ADC Hx711</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487066/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La raison de la rédaction de cet article est le désir de traiter le convertisseur ADC sigma delta 24 bits basé sur la puce Hx711. </font><font style="vertical-align: inherit;">Le convertisseur lui-même est assemblé sous la forme d'un module prêt à l'emploi selon le circuit de commutation recommandé par le constructeur (????). </font><font style="vertical-align: inherit;">Il y a des commentaires sur le fonctionnement de ce module sur ce site Web dans le blog d'Andrey Gerasimenko </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"ADC NX711 de 3,3V - ne croyez pas la documentation chinoise et pas seulement ..."</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour tester ce module, un circuit basé sur le microcontrôleur ATmega16, le module ADC, le LCD BC1602 à deux lignes, sur la base du contrôleur HD44780, quatre boutons ont été assemblés. Comme environnement de développement, nous avons utilisé le programme Code Vision AVR, version 1.25.9 professional, AVR Studio 4, Version 4.09.0.338, le programmeur USB AVR JTAG, qui permet non seulement de programmer le cristal, mais aussi de suivre pas à pas, si nécessaire, l'exécution du programme dans le microcontrôleur, presque en temps réel.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dn/yi/hh/dnyihhcg8d2ckj5tzu68ae5f_cg.jpeg"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une cellule de pesée de fabrication chinoise avec une limite de poids maximale de 40 kg a été choisie comme source de signal pour l'ADC. et unité d'insertion de capteur standard. Il convient de noter que l'utilisation d'unités d'intégration «natives» vous permet d'obtenir toutes les données de sortie postulées à partir d'une jauge de contrainte à point unique, modèle CZL A6. Ainsi, les jauges de contrainte de type Single Point, lorsque vous utilisez la taille spécifiée dans les spécifications techniques de la plate-forme pour l'emplacement de la charge pesée, sont conçues de sorte que le signal de déséquilibre de la jauge de contrainte ne dépend pas de la position de la charge sur la plate-forme. Ce sont les propriétés MÉCANIQUES du corps du capteur: les dimensions géométriques, l'emplacement des films collés de jauge de contrainte, en particulier la découpe «osseuse» au milieu du corps du capteur, la taille de la plate-forme qui affecte le couple appliqué au corps du capteur détermine cette indépendance.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/k1/jp/zw/k1jpzwxmwwbmdko-l2o7tj_bfbc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, la dernière source est "GOST 29329-92. Balances pour pesage statique. Exigences techniques générales. " Ce GOST définit les propriétés des instruments de mesure de poids. Il est également important de travailler avec le programme de bureau EXCEL. J'utilise EXCEL 2003 XP3. Cela vous permet de traiter rapidement les résultats à l'aide de méthodes prêtes à l'emploi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'espère que toutes les informations nécessaires pour répéter mes expériences seront pleinement données. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, le programme lui-même que j'utilise pour travailler avec le module. Le programme est axé sur CHECK, et à peine directement, c'est-à-dire sans modifications, il peut être appliqué pour certains besoins appliqués. Bien que, comme on dit, "en fonction de l'endroit où appliquer".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le programme lui-même est une structure de blocs. Il se compose de 4 routines et de la cinquième principale principale. Le premier sous-programme: ReadCount, lit les données du module ADC et les génère dans la variable Count. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CreatInput, génère un tableau d'entrée de données de conversion à partir de 32 valeurs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CreatOutput, génère un tableau de sortie de données de conversion ADC en organisant une moyenne mobile avec une taille de fenêtre de 16 données. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Keys, un programme simple pour répondre aux frappes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voilà donc tout. Les variables sont globalement toutes globales, d'autant plus que les méga ressources sont autorisées.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/md/z4/xz/mdz4xz4rpghbubo4yfc4luas2y4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le programme principal commence par créer le tableau d'entrée CreatInput, puis les données d'entrée sont filtrées à l'aide de la méthode de la moyenne mobile. La sélection de ce filtre est basée sur les éléments suivants. Lorsque le programme est en cours d'exécution, les données affichées changent de valeur dans une plage assez large. J'ai pris les valeurs de l'ADC sans effort sur la plate-forme et tabulé. Les valeurs ont été obtenues en utilisant le débogueur JATAG USB dans l'environnement AVR Studio. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8w/x7/ne/8wx7ne82a80fp4ofgryytwhza7s.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le fichier Excel «Acquisition de données», dans l'onglet «Moyenne mobile», le résultat du filtrage des données d'entrée fluctuantes InputBuff (plage d'oscillation 436 unités) avec une fenêtre de moyenne à intervalles de 3,12,16 est affiché. Le résultat est affiché dans les cellules A37-A40. D'où on voit que la plus efficace, dans ce cas, est une moyenne mobile avec une fenêtre de 16 échantillons.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les graphiques construits le montrent clairement. </font><font style="vertical-align: inherit;">Les données sont prises à partir d'un contrôleur de travail, arrêté au moment de la transition vers la procédure d'affichage des données. </font><font style="vertical-align: inherit;">Des exemples illustratifs d'une telle capture de données sont montrés sur les images. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/li/d2/5s/lid25s7vqelzw_hlumiy2uol9qa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aucune méthode de filtrage des données, grâce à l'utilisation de divers filtres numériques, ne pourrait en aucun cas «apprivoiser» les fluctuations d'entrée. </font><font style="vertical-align: inherit;">Si vous regardez le graphique des données d'entrée, la distribution gaussienne ici ne «sent» même pas. </font><font style="vertical-align: inherit;">Comme confirmé par l'utilisateur Nikopol_86 dans le blog "... ne croyez pas la documentation chinoise"</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nikopol_86 5 février 2019 à 09:27 0</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour être honnête, il a suffisamment de bruit à tous les rapports. J'ai fait quelques recherches sur la densité de distribution des codes ADC émis avec des circuits d'entrée court-circuités, et donc il y a une propagation jusqu'à 1000 1_5V et nifiga n'est pas une loi de distribution normale, ce qui suggère que le câblage de la carte est en difficulté, ou avec l'ADC, ou tous pris ensemble . J'ai également remarqué qu'il n'a pas non plus de stabilisation de la température et que la plage de températures de fonctionnement revendiquée ne correspond pas à la réalité. Ne serait-ce que parce que lorsque vous connectez une jauge de contrainte de 5 kg à l'ADC, la modification de la température dans la pièce de 1 degré prendra les lectures de 2 grammes, et si vous chauffez le microcircuit avec votre doigt, les lectures s'envolent à 5-7 grammes. En général, j'ai conclu par moi-même que seul un distributeur de nourriture pour chat peut être fabriqué sur cet appareil,où la précision dans un arrêt de tramway sera plus que suffisante. Et hélas, les solutions normales ne sont pas bon marché, car vous devez utiliser des ADC de haute qualité AO ou T1.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le constater, les conclusions ont été confirmées. C'est vrai, la même chose est vraie: </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jushabrauser le 4 février 2019 à 12 h 52.</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Avec un rapport signal / bruit &lt;1, cela n'aidera jamais. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Même avec un circuit en pont. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par conséquent, dans des conditions normales (sans mathématiques et / ou circuits spéciaux), au moins 8 bits de poids faible donnent un non-sens (le plus probable). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
24 morceaux chinois honnêtes pour 350 roubles? Ne le dites pas à mes pantoufles. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si le fer lui-même "ment" - que pouvez-vous faire? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, même un filtre non linéaire du troisième ordre n'aidera pas, car les données source ne sont pas un gâteau. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est à partir de cet endroit que j'ai voulu voir de quoi ce module est capable dans la composition des gammes. La recherche sur le réseau de problèmes avec la gigue des derniers bits de l'ADC, a conduit au forum </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kazus.ru/forums/showthread.php?t=105320&amp;page=4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Voici toute une discussion sur la stabilisation des lectures. Cependant, aucune des méthodes mathématiques proposées n'a «calmé» les données d'entrée que je reçois. Du «hardware» lui-même, pour stabiliser les lectures, il a été introduit: la connexion de la masse numérique et analogique, ainsi que le court-circuit de l'entrée B à la masse. Nous avons utilisé un blindage complet et alimenté le module à partir d'une batterie 6v (suivie d'un stabilisateur 7805) séparément des circuits du contrôleur. Il n'y a aucun résultat, les données d'entrée oscillent ...</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, la 24ème catégorie «propre» ne peut pas être obtenue et la raison ici me semble être un m / circuit de mauvaise qualité. Vous devez donc réduire la plage de conversion résultante. Pour cela, dans le programme ReadCount, une ligne a été introduite avec la division des données par 100. 100 est un peu moins de 2 à 8 degrés. À. La conversion AD est disponible en 16 bits. Cependant, même une telle limitation n'a pas rendu le témoignage fiable. Et la raison ici est les propriétés de la jauge de contrainte.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, après avoir appliqué le processus d'étalonnage (reliant la valeur de l'ADC et le poids sur la plate-forme), le poids est affiché en grammes. Il affiche 500 grammes comme le nombre 500, un kg comme 1000. Le prix de la division est de 1 gramme. Ceux. nous obtenons avec un capteur de 40 kg 40 000 divisions. Selon les données techniques de la cellule de pesée, on ne peut obtenir du capteur que 3000 divisions (symbole C3 au nom du capteur). Le prix de la division devrait donc être (40000/3000) = 13,3 grammes. Cependant, selon GOST 29329, la métrologie des poids ne fonctionne pas avec le nombre 3. Les chiffres doivent être utilisés: </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1.3 La valeur de l'échelle d'étalonnage (e), le prix de division de l'échelle (d) et la résolution d'échantillonnage (dd) en unités de masse doivent être sélectionnés parmi les suivants: 1X10a; 2X10a; 5X10a, où a est un entier positif, négatif ou zéro.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À. le prix de division pour ce capteur, garanti par le fabricant 10 grammes. Autrement dit, le format de sortie doit être de 0,0x kg. où x = 1,2,3, ... .0. Essayons de faire le prix de division de 5 grammes. Les actions programmatiques pertinentes sont répertoriées. Après une telle restriction, nous «prélevons» sur le capteur 40 000/5 = 8 000 divisions, soit 2,6 fois plus que ce qui est permis. Après ces hypothèses, les échelles résultantes fonctionnent assez régulièrement.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La remarque ci-dessus sur la cellule de charge appliquée et sa «résolution» ne nous permet pas d'affirmer de manière concluante que ce module ne peut pas produire une conversion 24 bits. Cependant, j'ai testé ce capteur pour un fonctionnement avec une résolution de 1 gramme, sur un autre appareil, avec un convertisseur AD différent. Sur cet appareil, le fonctionnement du capteur et la conversion peuvent être considérés comme satisfaisants, car la fluctuation de poids n'était pas supérieure à 3 grammes. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qu'est-ce qui ne permet pas l'utilisation de cet ADC dans le commerce?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Eh bien, la première chose et la plus importante est la dépendance de la mesure sur la température. Deuxièmement, en utilisant les opérations de division et de multiplication intégrées à ATMEGA, en particulier pour 8 bits, il est difficile d'étalonner les balances sur toute la plage de poids dans ces conditions. Il convient de garder à l'esprit que le programme ne réagit en aucune façon à la surcharge du capteur.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment surmonter ces inconvénients. Tout d'abord, entrez le capteur de température et ajustez la lecture du poids à partir de la valeur de température. Ce qui est assez compliqué. «Moins cher» consiste à introduire l'option d'étalonnage, pour différentes charges et en fonction de l'erreur causée par la température, étalonner le poids utilisé dans le travail. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le second est plus difficile. Remplacer la procédure de multiplication et de division par des opérations tabulaires et de cisaillement. Je pense que c'est la meilleure façon d'utiliser ce module dans la pratique de la construction de poids. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour compléter la description des exigences de création d'un programme de balances, il est nécessaire d'utiliser le "Programme d'étalonnage métrologique (certification) des balances" joint à chaque balance. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La création d'échelles à base de m / s Hx711 est possible sous réserve de toutes les exigences métrologiques des échelles. </font><font style="vertical-align: inherit;">L'introduction de corrections pour la dépendance en température de la conversion doit être prévue dans une procédure distincte. </font><font style="vertical-align: inherit;">L'utilisation d'un module avec une résolution de plus de 16 bits nécessite une approche et un contrôle séparés.</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr487056/index.html">Est-il dangereux de garder RDP ouvert sur Internet?</a></li>
<li><a href="../fr487058/index.html">"Hadoop. ZooKeeper »de la série Technostream de Mail.Ru Group« Traitement distribué de grandes données dans Hadoop »</a></li>
<li><a href="../fr487060/index.html">Vous utilisez Google Chrome? Ainsi, Google collecte vos données via X-client-data</a></li>
<li><a href="../fr487062/index.html">CBS a permis aux utilisateurs de Linux de regarder la série Star Trek, grâce à elle pour cela</a></li>
<li><a href="../fr487064/index.html">Ma deuxième année en tant que développeur indépendant</a></li>
<li><a href="../fr487068/index.html">Carte de visite APEC: une alternative au visa d'affaires pour la Chine et d'autres pays</a></li>
<li><a href="../fr487072/index.html">Je veux me marier</a></li>
<li><a href="../fr487074/index.html">Comment ABLYY NLP Technologies apprend à suivre les actualités et à gérer les risques</a></li>
<li><a href="../fr487076/index.html">Annonces Google / Yandex non affichées: 15 raisons</a></li>
<li><a href="../fr487078/index.html">Как мы приучили коллег брать вещи без спроса</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>