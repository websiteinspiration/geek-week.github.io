<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏼‍🤝‍👨🏻 🤥 🀄️ 内部でのビデオ通話：1日あたり数百万から1つの会議の100人の参加者まで 🐾 🎻 👨🏼‍🎤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="今、通話機能なしでメッセンジャーを見つけることは不可能のようです。これは、すべての通信を1つのアプリケーションで実行できるため、ユーザーにとって便利です。メディアで利用可能なすべての統計情報を組み合わせると、人々は1日に10億分以上インターネットを介して話していることがわかります。また、テクノロジー...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>内部でのビデオ通話：1日あたり数百万から1つの会議の100人の参加者まで</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/odnoklassniki/blog/479852/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">今、通話機能なしでメッセンジャーを見つけることは不可能のようです。</font><font style="vertical-align: inherit;">これは、すべての通信を1つのアプリケーションで実行できるため、ユーザーにとって便利です。</font><font style="vertical-align: inherit;">メディアで利用可能なすべての統計情報を組み合わせると、人々は1日に10億分以上インターネットを介して話していることがわかります。</font><font style="vertical-align: inherit;">また、テクノロジーの発達に伴い、ビデオは対話者の感情をよりよく伝え、プレゼンスの効果を生み出すことができるため、ビデオコミュニケーションのシェアが高まっています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビデオコールサービスの新たな課題は、世界中のさまざまな場所にいる家族全員または友人のグループ、または同じプロジェクトでリモートで作業している同僚をまとめて計画することです。</font></font><br>
<img src="https://habrastorage.org/webt/mh/zl/8a/mhzl8ar7wkjk2akfni3vzzbiufi.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プラットフォームおよびビデオ開発マネージャーAlexander Tobol（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アラトボル</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）は、内部にはビデオ通話サービスがあり、会議サーバーを作成するために使用するテクノロジーとハック、およびビデオを正しく転送する方法を示します。</font><font style="vertical-align: inherit;">1対1の通話サービスを100人のグループ通話に転送する方法と、非常に多くの参加者のサポートが必要な理由を学びましょう。</font></font><br>
<a name="habracut"></a><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/2z4XO3fyn3U" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HighLoad ++ Siberia</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に関するレポートに基づいています。このレポート</font><font style="vertical-align: inherit;">では、Alexander Tobolが</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">全体像を描こ</font></a><font style="vertical-align: inherit;">うとします。</font><font style="vertical-align: inherit;">このトピックに関する他の資料（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビデオ伝送の機能</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">や</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネットワークプロトコルなど</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）に</font><font style="vertical-align: inherit;">既に精通している場合は</font><font style="vertical-align: inherit;">、理論的な部分をスキップして、直接</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソリューションに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">進むことができます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記事の概要：</font></font></strong><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">履歴とデバイスの呼び出し。</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1対1の通話からグループ通話への移行。</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DIYグループ通話サービス。</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会議サーバー：競合他社を探索し、成果を上げましょう。</font></font></a></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通話履歴</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通話用の最初のよく知られたアプリケーション、およびビデオとともに、Skypeが2006年に登場しました。</font><font style="vertical-align: inherit;">Odnoklassnikiでは、2010年から2012年にアドビのソリューションに基づいて通話を開始しました...数年前にWebRTCで完全にやり直しました（この開始の詳細については</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちら</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。昨年はグループ通話を追加しました。</font><font style="vertical-align: inherit;">この移行については、記事で説明します。</font></font><br>
<img src="https://habrastorage.org/webt/5v/-d/9o/5v-d9oc0kvmij7u43f4q8dihyoa.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを行う方法を説明できると思いますか？</font><font style="vertical-align: inherit;">通話を使用する月間視聴者数は1,000万人を超え、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1日あたりの通話数は200万回を超えているため</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">さらに、それらの半分以上がモバイルプラットフォーム経由で発生しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グループ通話は最も急速に成長しているサービスであり、私たちの目標は100人の同時会議参加者です。</font><font style="vertical-align: inherit;">なぜそんなに？</font><font style="vertical-align: inherit;">まず、友達やクラスメートと美しいショットを共有したり、セミナーを開催したりすることがあります。</font><font style="vertical-align: inherit;">第二に、あなたのサービスが何かを必要としないと思っても、すべてが変わる可能性があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今では100人の参加者のビデオ会議は必要ないように思えるかもしれません。5年前に、なぜ4Kでビデオをローンチするのかと尋ねられました。</font><font style="vertical-align: inherit;">今では4Kテレビが当たり前になり、2014年に準備が整いました。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事前ではありません。</font><font style="vertical-align: inherit;">優れたサービスを提供したい場合は、要件の基準を高くしてください。</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あなたが50-100人のためにうまく機能する電話をかけることができれば、6-10人のユーザーにとってはすべてうまくいくでしょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各コールサービスには、4つの比較的独立したコンポーネントがあります。</font></font><br>
<br>
<ul>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シグナリング </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タスクは、加入者を呼び出し、初期データを交換し、各加入者が実行できることを通知してから、ビデオデータを送信できるチャネルを確立することです。</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビデオ/オーディオ。</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビデオおよびオーディオデータはコーデックを使用して圧縮されます。</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通信網。</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不良ネットワークでの作業の提供、パケットの回復、p2p接続などの実装が必要です。</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トポロジ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -グループ通話の場合に追加されます。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの部分は個別に話すことができます。</font><font style="vertical-align: inherit;">しかし、私は通話がどのように機能するかについての全体像を伝えたいので、すべてを1つのストーリーに収めようとします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービスの作業を開始する前に、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要件</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を特定する必要があり</font><strong><font style="vertical-align: inherit;">ます</font></strong><font style="vertical-align: inherit;">。</font></font><br>
<br>
<ul>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接続をすばやく確立して</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、対話者が電話に出た直後に接続が確立されるようにします。</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通話品質が高い</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ため、ビデオが崩れず、フリーズしません。</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通話の参加者数</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。最大100人の参加者がいるチャットルームで通話できます。</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼び出し元間の低遅延。</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポリコムが1.3 sのレイテンシは私たちにまったく適していません。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グループコールに関するこれらの要件が表される具体的な意味は次のとおりです。コールの開始は1秒以内。</font><font style="vertical-align: inherit;">300 Kbpsビデオが安定して機能するネットワーク。</font><font style="vertical-align: inherit;">呼び出し元からリスナーまでの待ち時間は0.5秒以内。</font><font style="vertical-align: inherit;">1回の通話で100人のユーザー。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">何が邪魔ですか？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご存知のように、ネットワーク内のデータはパケットで送信されます。ソケットがあり、そこにデータストリームを送信すると、ブラックボックスのようにすべてが飛んで、収集されて機能します。</font></font><br>
<img src="https://habrastorage.org/webt/e4/pa/vy/e4pavyyaikufar_cl4sqw1karxe.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、ネットワークは異なります。</font><font style="vertical-align: inherit;">通話の半分はモバイルネットワーク経由で行われ、常に高速道路のように見えるわけではありません。</font></font><br>
<img src="https://habrastorage.org/webt/ck/62/va/ck62vamogxhsgqdjuvvmoa1jlrq.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ネットワークが過負荷になると、データが失われ、ネットワークをさらにロードして復元する必要があります。</font><font style="vertical-align: inherit;">すべてが順調に見えるように見えるネットワークがありますが、たとえばWi-Fiルーターが鉄筋コンクリートの壁の後ろに配置されているために、パケットはまだ消えています。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネットワーク機能</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ネットワークの品質を表す主な特性を分析しましょう。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTT</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
往復時間-サーバーがクライアントにデータを送信してから確認応答を受信するまでの時間。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1秒で接続を確立する必要があることを忘れないでください。</font><font style="vertical-align: inherit;">ラウンドトリップ時間が200ミリ秒の場合、たとえば、TCPと一部のTLSを</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介して接続が確立されて</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いると</font><strong><font style="vertical-align: inherit;">、接続が確立されたときにのみ500ミリ秒を失う可能性があり</font></strong><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">500ミリ秒しか残りません。</font><font style="vertical-align: inherit;">さらにいくつかの要求。その後、接続が確立されます。</font><font style="vertical-align: inherit;">したがって、RTTで追加のリクエストを行う場合は、非常に注意深く作業する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例：</font></font><br>
<br>
<pre><code class="xml hljs">$ ping google.com <font></font>
64 bytes from 173.194.73.139: icmp_seq=5 ttl=44 time=211.847 ms<font></font>
round-trip min/avg/max/stddev = 209.471/220.238/266.304/19.062 ms<font></font>
RTT = 220ms <font></font>
<font></font>
$ curl -o /dev/null -w "HTTP time taken: %{time_connect}\nHTTPS time taken: <font></font>
%{time_appconnect}\n" -s https://www.google.com <font></font>
HTTP time taken: 0.231 <font></font>
HTTPS time taken: 0.797<font></font>
HTTP = 230ms <font></font>
HTTPS = 800ms</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RTT = 220ミリ秒の場合、httpsを介した応答の受信には最大800ミリ秒かかります。</font><font style="vertical-align: inherit;">したがって、Webソケットのセキュリティで保護された接続がある場合、そのようなpingを使用すると、2番目の接続はすべて消えます。</font></font><br>
<img src="https://habrastorage.org/webt/h7/jz/fz/h7jzfzctyl9uto140qct-vu05um.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の表は、モバイルネットワークで測定されたハンドシェイクの遅延を示しています（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レポートでは、モバイルネットワークでのアプリケーションの動作について詳しく説明しています）。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スループット</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パケットは好きなようにネットワークに送信できます。バッチで、またはバッファ内のすべてをすぐにハンマーで処理しても、クライアントに均等に届きます。</font><font style="vertical-align: inherit;">1秒あたりのパケット数またはデータ数は、帯域幅または帯域幅です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題は</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、モバイルネットワークの帯域幅が常に変化していること</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">急激に低下し、データが同じビットレートで送信された場合、データは明らかに失われ、ユーザーの通話は「ハング」します。</font><font style="vertical-align: inherit;">これも戦わなければならないでしょう。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パケットロス</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データを転送すると、パケットが失われる可能性があります。</font><font style="vertical-align: inherit;">この場合、選択肢があります。パケットの一部をスキップして歪みを取得するか、パケットを再送信してフリーズフレームを取得します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ジッタ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際のところ、パケットは一度に1つずつではなく、一定の間隔でバンドルされたパケットで到着します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zs/hc/fu/zshcfujfcg6helcc8rnx8pyfor4.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ジッタは簡単に測定できます。</font></font><br>
<br>
<pre><code class="xml hljs">PING highload.ru (178.248.233.16): 56 data bytes<font></font>
icmp_seq=11 ttl=43 time=117.177 ms<font></font>
icmp_seq=12 ttl=43 time=132.868 ms<font></font>
icmp_seq=13 ttl=43 time=176.413 ms<font></font>
icmp_seq=14 ttl=43 time=225.981 ms</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pinganuli highload.ruを数回（ping-不安定な値、平均化する必要があります）、平均ジッターを受け取りました：</font></font><code>((132-117)+(176-132)+(225-176)) / 3 = (14 + 44 + 79) / 3 = 46 </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<img src="https://habrastorage.org/webt/zj/4n/wp/zj4nwpcfmrefzo989lg_ipmbffy.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビデオを送信し、1つのフレームがネットワークパケットであるとします。</font><font style="vertical-align: inherit;">いくつかのフレームが中断されることなく再生されますが、3番目の鳥はジッターのために遅延します-フリーズフレームを取得します。</font><font style="vertical-align: inherit;">したがって、パッケージをどこかに蓄積し、この効果を均等化する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、ワイヤレスネットワークを特徴付けるには、次の値を知っていれば十分です。RTT（往復時間）。</font><font style="vertical-align: inherit;">帯域幅BW（帯域幅）; </font><font style="vertical-align: inherit;">パケット損失率。</font><font style="vertical-align: inherit;">ジッタ。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーザーはどのように見えますか？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ネットワークでの作業を最適化する前に、ユーザーが使用しているインターネットの種類を確認する必要があります。おそらく誰もが完璧なネットワークを持っているので、どのようなソリューションでも機能します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
80％の場合、エンドユーザーはワイヤレス接続を使用します。これはモバイルネットワークまたはWi-Fiのいずれかです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ub/_w/ep/ub_wepc3hzha5g1vmnbcuvu5758.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ロシアの西部地域と大都市以外の平均的なネットワーク特性は、RTT-200ミリ秒、帯域幅-1.1メガビット/秒、パケット損失-0.6％、ジッター-5ミリ秒です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの値をネットワークのタイプで分割し、これに取り組むための学習が必要であることを認識しました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vb/mk/6u/vbmk6ue1tjohnzk9dmybx7jgiq4.jpeg"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通話開発機能</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多くの人は忘れますが、LTEと3Gは非対称の通信チャネルです。ダウンリンクは常にアップリンクよりも重要です。</font><font style="vertical-align: inherit;">プロトコルのタイプに応じて、この比率は15/85から30/70まで変化します。</font><font style="vertical-align: inherit;">コールを設計する場合、これは重要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
顧客がどのチャネルを持っているかを確認する方法は？</font></font><br>
<br>
<img src="https://habrastorage.org/webt/9y/kz/pj/9ykzpjasmaqko3glxox9ps6tkgs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あなたはspeedtestを見ることができます、モバイルと固定インターネット間の世界の速度の比は何ですか。</font><font style="vertical-align: inherit;">世界中で固定インターネットも非対称であることが判明しました。</font><font style="vertical-align: inherit;">ロシアでは幸いにも対称的であることがわかりました。ロシアのWi-Fiを介した固定インターネットのアップリンク/ダウンリンク比は50/50です。</font><font style="vertical-align: inherit;">そのような価値観に焦点を当てます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/al/6o/zb/al6ozb-zf_b_f8vecacwryr-gce.jpeg"><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ワイヤレスネットワークは人気があり、不安定です。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">顧客の80％以上が無線インターネットを使用しています。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ワイヤレス設定は動的に変化しています。</font></font></li>
<li>     packet loss, jitter, reordering.</li>
<li>  uplink/downlink   30/70.</li>
</ul><br>
<h2></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この知識のストアで、グループ呼び出しの実装に戻りましょう。単純なグループ呼び出しのアルゴリズムを考えてみましょう。その後、これを調整します。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップ1.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> AliceはBorisに電話をかけ、オファーを送信します。その中で、プロトコル、設定などをサポートすることができるすべてを報告します。</font></font><br>
<img src="https://habrastorage.org/webt/k-/gr/xz/k-grxzwigzw4xaqgctisb27xalq.jpeg"><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップ2.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> BorisがAliceに応答すると、トランスポート接続が確立されます。</font></font><br>
<img src="https://habrastorage.org/webt/qf/yp/my/qfypmyzwq5sjl8et0tg2ju6vddm.jpeg"><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップ3.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">その後、オーディオ/ビデオデータの交換が始まります。</font></font><br>
<img src="https://habrastorage.org/webt/rb/7w/hh/rb7whhnevjv6s15l0nmvftyx2lq.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
呼び出しのアーキテクチャは、次の図のようになります。</font></font><br>
<img src="https://habrastorage.org/webt/_n/6g/7o/_n6g7ohpbtl7wonvxjfrdcb8w2a.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
共有サーバーは常に存在しますが、接続が確立されると、ユーザーは既にp2pデータを転送したり、サードパーティのサーバーを介して転送したりできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データは、デバイス上でエンコードしてソケット接続に送信するカメラによって取得されます。</font><font style="vertical-align: inherit;">それらはネットワークを通過し、コーデックによって反対側で再生され、画面に表示されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アルゴリズムのすべてのステップを詳細に検討し、1対1呼び出しからグループ呼び出しに切り替えてみてください。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シグナリング</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
タスク：通話を報告し、データ接続を確立します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてが非常に簡単です：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アリスが電話すると、モバイルデバイスまたはブラウザでBorisに通知が送信されます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Webソケットまたはその他の接続が確立されています。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この後、交渉が行われます-アリスとボリスは同意します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ハンドセットが1つのデバイスでオフフックの場合、通話はもう一方のデバイスで自動的に終了します。</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/x8/p8/4a/x8p84akywewgezvufnt64jqfmp8.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Odnoklassnikiの通話プラットフォームは、さまざまなクライアントとトランスポートをサポートしています。それらはすべて、通話の処理とメッセージの転送に従事しているサーバーでロックアップします。</font></font><br>
<img src="https://habrastorage.org/webt/on/3v/9s/on3v9swzgtmfub9c_ru18qwjl1m.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サーバーに障害が発生した場合や更新をインストールした場合は、すべてのメッセージが記録される永続的なストレージがあります。サーバーが失われた場合、簡単に別のサーバーに切り替えることができます。これがZooKeeperの機能です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
唯一の困難は</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、「1回だけ」</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。一部のメッセージを2回適用したくありません。この問題は簡単に解決されます。すべてのメッセージにシリアル番号が付けられます-単一のメッセージが2回到着しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、通話を作成するときは注意が必要です。</font><font style="vertical-align: inherit;">人は電話をかけ、電話を切り、別の電話をかけることができます。</font><font style="vertical-align: inherit;">または、ハングしなくても、別のものを作成します。</font><font style="vertical-align: inherit;">これらの呼び出しはすべて一意ではありません。これがリレーなのか、ユーザーが呼び出しボタンをダブルクリックしたのかは明らかではありません。</font><font style="vertical-align: inherit;">簡単に修復できます。クライアントで一意のIDが生成され、重複排除が実行されます。</font><font style="vertical-align: inherit;">原則として</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、シグナリングに問題はありません</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グループへのp2pシグナリングは簡単に終了します。</font></font><br>
<img src="https://habrastorage.org/webt/7q/y6/zh/7qy6zhw2z72nbjcazwlx681hrau.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同じ提案と回答が、アリスからボリスだけでなくディマにも送信されます。</font><font style="vertical-align: inherit;">彼らはそれらを受け取り、同意し、それらの間にデータ交換チャネルが出現します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オーディオビデオ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グループ通話に対応し、必要なテクノロジーを理解するには、ビデオとは何かについて少し話す必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビデオは24または60フレーム/秒です。</font><font style="vertical-align: inherit;">それらを圧縮するために、コーデックが使用されます。</font><font style="vertical-align: inherit;">コーデックの主な本質は、数フレームごとに参照フレーム（JPEGなど）が存在し、中間フレームが変更によって決定されることです。</font></font><br>
<img src="https://habrastorage.org/webt/yl/2d/fs/yl2dfs-nsm6cmuifnpaykbyhnkg.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上の画像では、機械の最初のフレームが参照フレームであり、次のフレームでは変更（機械の動き）のみがエンコードされ、次回は変更のみが行われます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは画像グループと呼ばれ、デコード可能な相互接続されたフレームの独立したセットです。</font><font style="vertical-align: inherit;">コーデックは、フレーム間の変換アルゴリズムです。</font><font style="vertical-align: inherit;">コーデックが急であるほど、データの圧縮率が高くなり、必要なリソースが増えます。</font></font><br>
<div class="scrollable-table"><table>
<tbody>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">品質</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解決</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最小ビットレート</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フルHD</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1920x1080</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 Mbps</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HD</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1280x720</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.5 Mbps</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">低い</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">640x360</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">600 kbps</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">426x240</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">300 kbps</font></font></td>
</tr>
</tbody>
</table></div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コーデックのビットレートの比率については、一般的な規則があります（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リンクを参照</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通話に使用される最も一般的なコーデックは</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H.264とVP8</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">H.264は、どこでも動作し、バッテリーを消費しないので、優れています。</font><font style="vertical-align: inherit;">しかし、通常、電話では1つのエンコーダー（エンコーダー）と4つのデコーダーです。</font><font style="vertical-align: inherit;">それ以外の場合は、バッテリーを消費するソフトウェアVP8が必要です。</font><font style="vertical-align: inherit;">グループ通話の優先度をH.264に変更する価値があります（</font><font style="vertical-align: inherit;">これを行う方法</font><font style="vertical-align: inherit;">の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リンク</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">参照</font><font style="vertical-align: inherit;">）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コーデックは、変数（可変ビットレート）または一定ビットレート（一定ビットレート）でエンコードできます。</font><font style="vertical-align: inherit;">デバイスの多くのコーデックは一定のビットレートをサポートしていないため、左側の画像を使用する必要があります。</font></font><br>
<img src="https://habrastorage.org/webt/6r/ej/mt/6rejmtldwpgvu2an6bbjwu7-xoq.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オーディオコーデック</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
G711など、オーディオ用のさまざまなレガシーコーデックがあります。 Opusコーデックは非常に人気があります。内部にはSkypeのSILKと音楽用のCELTコーデックが含まれているため、低ビットレートと高ビットレートの両方でコーディングの問題を解決します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OpusにはForward Error Correction（FEC）のプロアクティブなエラー訂正アルゴリズムがあることは言うまでもありません。オーディオの場合、このアルゴリズムは次のように機能します。各パケットには、高品質のデータと、以前のフレームのデータがしばらくの間低品質で含まれています。したがって、以前のパッケージを紛失した場合、以前のパッケージのデータを低品質で取得でき、何らかの形で紛失する可能性があります。平均して、それはかなり良いことがわかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
オーディオコーデックを使用する場合、入力信号の品質とビットレートの比率を示すグラフを見ると興味深いです。</font></font><br>
<img src="https://habrastorage.org/webt/_r/wd/em/_rwdemfrce5rw2njez4pge9wgr0.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Opusがほとんどすべての問題を解決することがわかります。</font><font style="vertical-align: inherit;">さまざまなホスティングサービスでビデオをエンコードするときに使用されるAACと、オーディオ専用に使用されて最大32 Kbpsで動作する古いSpeexコーデックに注意を払うのは興味深いことです。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メディア病理学データ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
トポロジのしくみ、トポロジの機能を理解するには、ビデオコーデックが損失を処理する方法を理解する必要があります。</font></font><br>
<img src="https://habrastorage.org/webt/vt/dn/zm/vtdnzmfdmc8n8bxq_rmmfoscpls.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初のケースでは、何も失われず、良い画像が表示されます。 2行目では、1つのランダムなフレームが失われています-画像に小さなアーティファクトがあります。 3番目のケースでは、参照フレームが消えたため、次の参照フレームまで、ランダムに重なり合う変化が表示されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
明らかに、ビットレートが増加しているため、参照フレームを作成することはしばしば高価です。したがって、ほとんどすべてのコールサービスは、何らかの方法で、損失が発生した場合に参照フレームを要求する機能をサポートしています。 WebRTCでは、これは完全なイントラフレームと呼ばれます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最も単純なトポロジは、すべてのビデオを他のすべての会議参加者に送信することです。</font></font><br>
<img src="https://habrastorage.org/webt/st/mt/bu/stmtbu09eze8vg6letvekimnosu.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1つのコーデックを開始し、ビデオの転送を開始します。</font><font style="vertical-align: inherit;">アリスはカメラのコーデックをオンにして、彼女のビデオをボリスとディマに送信します。</font><font style="vertical-align: inherit;">しかし、Dimaのインターネット環境が悪い場合、ビデオ全体の品質を下げる必要があるため、Borisは苦しみます。</font><font style="vertical-align: inherit;">そして、ディマがショットを失い、サポートショットを要求した場合、ボリスは彼を必要としませんでしたが、それも取得します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一方、1つのストリームですべての動画を接着できます。</font><font style="vertical-align: inherit;">これには特別な機器が必要であり、追加の遅延が発生する可能性がありますが、そのような解決策も存在します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最小限の遅延でビデオとオーディオを転送または配信</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TCPまたはUDPプロトコルを選択できます。</font></font><br>
<div class="scrollable-table"><table>
<tbody>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UDP</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信頼性のある</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信頼できない</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接続指向</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コネクションレス</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウィンドウ処理によるセグメントの再送信とフロー制御</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウィンドウ処理または再送信なし</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セグメントシーケンス</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シーケンスなし</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">確認シーケンス</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">謝辞なし</font></font></td>
</tr>
</tbody>
</table></div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">おそらく誰もが、TCPは信頼できるプロトコルであることを覚えています。そのため、次の図のように、このフレームの順序が可能です。</font></font><br>
<img src="https://habrastorage.org/webt/si/qm/rc/siqmrcta6lzauazsdsbitbkifvo.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パケットでフレームが欠落している場合、ビデオの24フレームのうちのこの1つを自由にスキップできますが、TCPは、失われたフレームを送信するまで、次のものを受信できません。</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP経由でビデオを配信することは非常に非効率的です。</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このようなタスクにはUDPが推奨されており、すべてのコールサービスで使用されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記事で</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、両方のプロトコルのすべての機能を提供し、すべてのストリーミングがUDPで機能する理由を説明します。今日のトピックの一部として、UDPがどこでも利用できるわけではなく、ネットワークの3％では機能しないことを知るだけで十分です。</font></font><br>
<img src="https://habrastorage.org/webt/tv/ky/jz/tvkyjzwzytjo2pgxmfgek1afv_8.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般に、ユーザーは自分自身の間にP2P接続を確立できます。</font></font><br>
<img src="https://habrastorage.org/webt/xe/nj/ew/xenjewfqamelio5eqywflbiyn54.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これが最も収益性が高いのは、ノボシビルスクでお互いに電話をかける場合は、直接通信し、レバレッジを提供する追加のサーバーを使用しない方がはるかに良いためです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、NATが存在し、97％以上のユーザーが背後にいます。外部IPを持っているユーザーはほとんどいません。</font><font style="vertical-align: inherit;">一方では、この問題は遅かれ早かれIPv6によって解決されます。</font><font style="vertical-align: inherit;">ちなみに、ロシアでは、MTSが最初に発表されました。</font><font style="vertical-align: inherit;">現在、IPv6を完全にサポートしており、すべてのクライアントにホワイトIPがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NATは突破する可能性がありますが、突破しない可能性があり、その場合はサーバーを介したフォールバックを使用する必要があります。</font><font style="vertical-align: inherit;">NATを突破する方法についての</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記事</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">もあります</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トランスポートとフレーム間のジッターバッファー</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
先に進みます。次に、ジッターの影響を平準化するためのジッターバッファーが必要になります。</font></font><br>
<img src="https://habrastorage.org/webt/od/eb/m5/odebm5kla1eprghttikfis_tzm8.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
少し遅れてフレームを積極的に表示し始め、その間、バッファー内に同じ間隔でフレームを並べます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バッファは動的に増加します。</font></font><br>
<img src="https://habrastorage.org/webt/_q/-s/o4/_q-so4lqgyenwyrlcbk2u141h2k.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フレームがなくなり、画像がフリーズした場合、バッファーが増加し、このサイズのバッファーで既に作業しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、バッファを減らす必要がある場合は、逆の状況になることがあります。たとえば、ネットワークが安定し、時間を追いかける必要があります。単純にバッファを減らすとばかげて、人々はノームの声で非常に速く話し始めるでしょう。したがって、音声の速度を目立たないように調整する特別なアルゴリズムがあります。言葉の間の一時停止を取り除くか、音声が長すぎる音を折りたたみます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビデオをトランスコードして何かを修正したい場合は、最初にジッターバッファーを用意する必要があり、その遅延はこのネットワークの遅延ジッター以上になります。</font><font style="vertical-align: inherit;">つまり、レイテンシは確実に増加しますが、0.5秒以内に維持したいことを覚えています。</font></font><br>
<img src="https://habrastorage.org/webt/um/vs/2i/umvs2isu-bjnd2sp4u7ke7sqyv4.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
呼気-理論は終わりました！</font></font><br>
<br>
<h2><a name="ok-call"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OKの呼び出し</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グループコールの前に、p2pコールがあり、WebRTCライブラリが使用され、Webおよびモバイルクライアントが収集され、シグナリングが作成されていました。</font></font><br>
<img src="https://habrastorage.org/webt/kj/sl/uo/kjsluoez0wxxhsya9ttbfaev--k.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">競合他社の分析</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
何をすべきかわからないときは、競合他社を見てください。参考までに、Skype、WhatsApp、ハングアウト、ICQ、ズームのセットを選択しました。グループ通話の最大参加者数、待ち時間、バッテリー消費量、品質を測定しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最も興味深いのは、遅延を決定することです。タイマーをオンにして、ビデオの撮影を開始し、電話をかけます。</font></font><br>
<img src="https://habrastorage.org/webt/0k/_q/ct/0k_qctbyc9_eenat32mcm3zbz10.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
100ミリ秒-ビデオがレンズに当たってから、スマートフォンのマトリックスに描画されるまでのカメラ遅延。その後、ビデオがネットワークに送信され、すでに通話中に310ミリ秒の遅延が発生しています。</font></font><br>
<img src="https://habrastorage.org/webt/eg/oi/g5/egoig53tzrzn-1byodqkwmfcfsq.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デバイスのCPU使用率を測定することを忘れないでください。 iOS 12以降、体系的にこれを行うことが可能になりましたが、私たちは古い方法で高温計を使用しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の結果を得た：</font></font><br>
<img src="https://habrastorage.org/webt/mk/tu/1s/mktu1se2wjoa_lwb842wsfkyouk.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WhatsAppとICQには最大4人の通話参加者がいて、Skypeには25人（Skype for Business 250）、それぞれ100個のハングアウトとズームがあります。</font><font style="vertical-align: inherit;">ハングアウトには約35人のメンバーがいましたが、今では100人以上のセクションにジャンプしました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ズームの遅延はわずかに長くなりますが、ハングアウトはより多くのバッテリーを消費します。</font><font style="vertical-align: inherit;">ズームの方が品質が良いように思えましたが、反対のことを言う記事があります-これは主観的な測定基準です。</font></font><br>
<img src="https://habrastorage.org/webt/mu/sa/9b/musa9bet2chfnzj55svmkj5j9qk.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一部のサービスはオープンWebRTCを使用し、他のサービスは独自のプロトコルを使用します。</font><font style="vertical-align: inherit;">ただし、以下で使用するトランスポートの種類が通話の参加者数に影響しないことは明らかです。</font><font style="vertical-align: inherit;">100件の呼び出しと独自のプロトコル（ズーム）、およびWebRTC（ハングアウト）を使用したソリューションがあります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2からNにスケーリング</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
興味深いケースを考えてみましょう：非対称チャネル、入力3 Mbit / s、出力1.5 Mbit / s、パケット損失0.6％、ジッター50 msのクライアントがあります。 1.5 MbpsのビットレートのHD（1280x720）のビデオと、600 Kbpsの解像度が640x360（LOWとしましょう）のビデオがあります。クールな動画を発信したい。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2人がp2pを呼び出す場合、すべてが簡単です。チャネルが非対称であり、コーデックに問題がないため、すべてのコーデックは無料です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グループ通話を開始するときは、全員を再接続する必要があります。トポロジの最も単純なバージョンは、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メッシュ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">または「すべてからすべて」です。</font></font><br>
<img src="https://habrastorage.org/webt/xt/zk/th/xtzkthwsqgph-xmvnpzufncfl6o.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
中間サーバーが不要なのは素晴らしいことですが、そのような特性を持つクライアントにすべてのビデオを提供することは問題になっています。また、クライアントがビデオを一人で配信できない場合は、共通のストリームがすべてのユーザー用にエンコードされているため、品質を下げる必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この実施形態では、５人の参加者にとって、３または４Ｍｂｐｓのいずれでも十分ではない。</font></font><br>
<img src="https://habrastorage.org/webt/ah/h5/rf/ahh5rfvgcjjkm70qhzv1ruduaws.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのため、グループコールのWhatsAppには最大4人の参加者がいて、メッシュを使用している限りは参加できなくなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別のオプションは</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、サーバー上で</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全体像</font><strong><font style="vertical-align: inherit;">を収集する</font></strong><font style="vertical-align: inherit;">こと</font><font style="vertical-align: inherit;">です。これはクライアントにとって最も有益です。サーバーへの接続が1つあり、サーバーが画像を収集し、クライアントがそれを受け取ります。</font></font><br>
<img src="https://habrastorage.org/webt/bg/_3/qh/bg_3qhrgkt1izvjkwciy4pfegbm.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、ペトロパブロフスクカムチャツキー、コムソモルスクオンアムール、ノボシビルスクのユーザーがモスクワのサーバーを介してチャットしたいとします。当然、それは非常に悪い結果になります。 CDNの存在は少し役立ちますが、とにかく大量のジッターバッファーを取得します。これにより、合計で遅延がまともなものになります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のトポロジ- </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">混合の終了</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -では、これらの遅延を回避するためにサーバーで一般的な画像を収集せず、単にパケットをスローすることを提案しています。</font></font><br>
<img src="https://habrastorage.org/webt/1k/aj/cc/1kajccrtduezyvharoklxqwlv0e.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、このトポロジのサーバーは、データを転送する単なるリレーです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてが少し良くなっています。ユーザーは通話の他のすべての参加者のストリームを受信し、自分のストリームを1回だけ送信します。しかし、再び問題があります：</font></font><br>
<br>
<ul>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">品質。</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ストリームのすべての受信者が異なるネットワークを使用しています。</font><font style="vertical-align: inherit;">インターネットに接続できない人が接続すると、ビデオを低解像度で配信する必要があるため、画像がすべての人に悪影響を及ぼします。</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ストーム参照フレーム</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">インターネットが苦手な人が常に参照フレームを要求すると、誰もがopornikiを受信し始めます。</font><font style="vertical-align: inherit;">これはビットレートの非効率的な使用であり、品質は再び低下します。</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/26/wj/bv/26wjbvlg4tlfijnuif4dwzpfc8m.jpeg"><br><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集中システムが使用されている</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
場合</font><font style="vertical-align: inherit;">、つまり、すべてのビデオがサーバーで収集されます。</font><font style="vertical-align: inherit;">これにはコーディングの多くの段階が必要で、レイテンシが追加され、追加のハードウェアが必要になります。</font><font style="vertical-align: inherit;">逆に、エンドミキシングでは、すべてが迅速かつ簡単です。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">短所トポロジー：</font></font></strong><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メッシュ-最大4メンバー。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一元化-トランスコーディングとジッターの問題。</font></font></li>
<li>End mixing —       .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メッシュトポロジで機能するのはICQとSkypeだけで、残りはすべて終了混合です。しかし、私たちが覚えているように、すべてのサービスは特性の点で異なります。つまり、Endのミキシングだけではなく、他の何かがあるということです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ハングアウトは、エンドミキシングでトリックを行いました。</font></font><br>
<img src="https://habrastorage.org/webt/pm/uy/25/pmuy25cx0untfvn3gbk0qmcehay.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各クライアントで2つのエンコーダーが起動されます。高品質のH.264と低品質のVP8です。したがって、インターネットが良好なユーザーの場合、サーバーは高品質のビデオを送信します。インターネットの質が低いユーザーにはサーバーの品質が低下し、品質の悪さが最悪のネットワークに適応します。 2つの品質は良好ですが、これは顧客からの余分なトラフィックとバッテリー消費です。しかし、ジッターバッファーはありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
表からわかるように、ハングアウトの実行中は電話が最も熱くなるため、遅延は最小限に抑えられますが、品質が低下します。これは、低品質でも高いビットレートが消費されるためです。</font></font><br>
<img src="https://habrastorage.org/webt/na/6n/2f/na6n2fs0u3ebkqez1jjntk3kel0.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに一歩進んで、このゲームをプレイすることにしました。それでも、クライアントからソフトウェアコーデックを実行せず、H.264をエンコードし、1つのストリームの下でチャネルを最大限に使用して（バッテリーとトラフィックを節約します）、高品質のEndミキシングスキームを使用します。また、品質が低い場合は、集中方式を使用しますが、共通の画像を収集するのではなく、サーバーは高品質のビデオをすべての特定のユーザーが必要とするものにエンコードします。</font></font><br>
<img src="https://habrastorage.org/webt/db/15/pw/db15pwl1tkdxpxd4xpz8gp-sba4.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
確かに、サポートフレームの嵐に対処する必要があります。高品質のために、それらを抑制します。つまり、ユーザーが高品質を受け取ることができる場合、おそらくパッケージの不足がほとんどなく、どういうわけかこれらのopornikがなくても対処できると考えています。実際には、これは、1秒に1回よりも頻繁に参照フレームを要求することを許可しないことを意味します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、さまざまなトポロジに対して次のオプションが用意されました。</font></font><br>
<img src="https://habrastorage.org/webt/0o/9y/6b/0o9y6bt7zahjvydljkpnkvaxvyk.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、私たちのオプションが最も成功しているように見えますが、ネットワークが貧弱な顧客の場合、レイテンシが大きくなる可能性があります。クライアントのビデオ品質が低い場合、ビデオディストリビューターに2番目の肩がない場合は、クライアントにとってより有利になる可能性があるため、これを無視することにしました。このトポロジでは、集中型トポロジのクライアントとサーバーの間の間隔でパケット損失が修復されます。つまり、解析し、独自のジッタバッファとトランスコードを持つサーバーがあります。サーバーは個人的な参照フレームを提供したり、特定のフレームを復元したりできます。パケットを復元するこれらのすべての手順は、ビデオストリームを提供する人物には影響しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
正式には、列のクライアント数は「無限」ですが、アスタリスクが付いています。これは、一度に100人、50人、または20人さえ表示できないためです。画面には通常、1人の発言者と他の参加者のリストがあります。</font></font><br>
<img src="https://habrastorage.org/webt/du/88/yt/du88ytnejvtsgryudgkdfntv7pg.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのクライアントは異なるネットワークと異なるデバイスを持っています-5つを超えるビデオストリームをデコードできないものがあります。各デバイスには個人的なアプローチが必要です。この方法で行います。デバイスはストリームをどれだけ失う可能性があるかを通知し、サーバーで収集します。バックパックの問題と同様に、可能な限りネットワークにプッシュできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最も「大規模」なユーザーを高品質で、小さなウィンドウにいるユーザーを低品質で配布します。</font><font style="vertical-align: inherit;">コーデックセットアップモードもあります。参加者が離れた場所に表示されていることがわかった場合は、低fpsを有効にします。</font><font style="vertical-align: inherit;">原則として、画像の下部にあるサムネイルが毎秒1回更新される場合-これは正常です。</font><font style="vertical-align: inherit;">ユーザーが少なくともなんとかカサカサ音を立てると、音が追加されます。</font><font style="vertical-align: inherit;">これが不可能な場合は、一切触れません。</font></font><br>
<br>
<h2><a name="fin"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最終決定</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最大3〜4人の参加者のメッシュトポロジは、レイテンシ、バッテリー、およびその他すべての点で非常にうまく機能するため、混乱しており、ある程度メッシュをサポートしています。</font><font style="vertical-align: inherit;">その後、スムーズにサーバートポロジーに切り替えます。サーバートポロジーでは、HDをエンドミキシングに、SDを集中化します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、ズームに近い特性を得ました。</font></font><br>
<img src="https://habrastorage.org/webt/h9/5q/2q/h95q2que4mihuktnf2mz18zsjua.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼らが、Zoomが独自のソリューションを持っているという違いと同様のことをしていると仮定します。これは、WebRTCと部分的に互換性がありません。</font><font style="vertical-align: inherit;">また</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、WebRTC</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">との</font><strong><font style="vertical-align: inherit;">互換性を維持し</font></strong><font style="vertical-align: inherit;">て</font><strong><font style="vertical-align: inherit;">いるため</font></strong><font style="vertical-align: inherit;">、ブラウザでのグループ呼び出しもサポートしています。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レーキ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それらなしで開発中。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPUがネットワークよりも弱い可能性があります。</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちはサーバーから最大ストリームを転送しました-それがネットワークに入るのと同じくらいですが、ネットワークよりもCPUが弱いデバイスがあることがすぐに明らかになりました。その後、エンコーダーは再生されているようですが、電話の速度が低下したり、過熱したりします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
追加情報：電話は対応できないと言うことができ、送信されたビデオの品質を下げるよう要求することができます。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">画面共有では、低品質では不十分です。</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">画面共有のビットレートを下げると、文字や数字が見えなくなり、ポイント全体が消えます。したがって、画面共有が優先されます。さらに、fpsを低くすることは理にかなっています。マウスをゆっくり動かす方が良いですが、すべてが表示されていました。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1つのサーバーがすべてのクライアントのビデオをトランスコードすることはできません。</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">別の機能-集中方式で作業している場合、遅かれ早かれサーバーがすべてのクライアントをトランスコードできない状況が発生します。</font><font style="vertical-align: inherit;">いくつになるか予測するのは不可能だからです。</font></font><br>
<img src="https://habrastorage.org/webt/kd/b4/zt/kdb4ztkg9daqyfjryhpzg4u7uac.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、すべての着信ストリームは1つまたは別のサーバーによってトランスコードされ、トランスコードされたすべてのビデオを収集する配信サーバーがあります。</font><font style="vertical-align: inherit;">すべてを1つの全体像に収めるのではなく、別々のストリームで配布するため、このようなスキームを利用でき、トポロジでトランスコーディングするときに1台のサーバーのリソースに制限されません。</font></font><br>
<br>
<h2><a name="server"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会議サーバー</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
会議サーバーを作成する場合は、サーバーの作成方法を説明します。</font><font style="vertical-align: inherit;">トポロジに対するすべての主張で、準備ができているものは見つからず、自分で行うことにしました。</font></font><br>
<img src="https://habrastorage.org/webt/ga/ve/43/gave43pdwqyaly4pm7b1amurzxc.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パケットペーシング</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、UDPソケットを開いて書き込みを開始します。</font><font style="vertical-align: inherit;">デフォルトでは、UDPには常にペーシングが必要です。</font><font style="vertical-align: inherit;">UDPパケットを失わないようにする場合は、大きなパケットで送信しないでください。</font></font><br>
<img src="https://habrastorage.org/webt/mc/mb/t3/mcmbt33ngipgrs1xlf3hvhbx6d8.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グラフは、パケットがUDPを介して継続的に送信される場合、21パケットまでに損失の確率が100％に近いことを示しています。</font><font style="vertical-align: inherit;">パケットは少なくとも1ミリ秒または1ナノ秒に1回間引きする必要があります。この距離は経験的に計算する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
他に何が必要ですか？</font><font style="vertical-align: inherit;">すでに述べたように、コーデックに強制的に一定のビットレートを生成することはできません（ただし、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">エミュレート</font></a><font style="vertical-align: inherit;">できる場合もあります）</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）-画像が変化すると、ビットレートが増加します。</font><font style="vertical-align: inherit;">したがって、チャネルでほぼ一定のビットレートが確立された後、カメラを振ると、変更の数が多いためにビットレートが増加し、データがチャネル帯域幅に侵入しないため、反対側の画像が崩れる可能性があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2つのオプションがあります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ペーシングを適用すると、ビデオが少し遅くなります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ペーシングを使用しないでください。そうすると、ほとんどの場合、過剰なパケットが失われ、再送信が始まり、歪みが発生します。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、クライアントを確認するのに最適な方法です。反対側の電話を振ると、速度が低下し、ペーシングが発生します（パケットがシャワーを浴びている場合）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パケットペーシングは他に何に役立ちますか？</font></font><br>
<img src="https://habrastorage.org/webt/wp/y3/vx/wpy3vxtcvgzvn8lukrnrpm2sx2w.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際には、あなた（および他の人が一緒にいる）が単位時間あたりに大量のデータを送信すると、キューがオーバーフローし、誰かがドロップされます。</font><font style="vertical-align: inherit;">したがって、すべてを注意深く汚すと、誰とも交差せず、パッケージが消える可能性が低くなると考えられます（証明されていません）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
唯一確立されている事実は、ペーシングがある場合のパケット損失が少ないことです。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MTU</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TCPは私たちを台無しにしました、あなたはMTUに悩む必要は決してありません。ただし、UDPサーバーを作成している場合は、少なくともMTUがネットワーク上で送信できる最大パケットサイズであることを覚えておく必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MTU 1500のネットワークを介してデータが送信され、途中でMTU 1100のネットワークに遭遇した場合、パケットはフラグメント化されます。もちろん、それは回収されますが、このパッケージの1つの部分が失われた場合、すべてのパッケージ（および元のパッケージ全体）が失われることを考慮してください。したがって、ネットワークのMTUに対応するパケットサイズで作業するのが最適です。</font></font><br>
<img src="https://habrastorage.org/webt/rc/r7/jv/rcr7jvrykz5mtbajkmskh-s9if0.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TCPには、接続を確立するときにこのパラメーターを定義するアルゴリズムがあります。</font><font style="vertical-align: inherit;">それを繰り返すことができます。MTUを選択してみてください。デフォルト値から開始し、並列プロセスを開始します。たとえば、バイナリ検索を使用してMTUを選択します。</font><font style="vertical-align: inherit;">MTUのサイズより大きいサイズのフラグメンテーションを禁止するフラグを付けてパケットを送信すると、パケットはフラグメント化されずにドロップされます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その絵は面白いでしょう。</font></font><br>
<img src="https://habrastorage.org/webt/mp/fx/ct/mpfxctwu5bck6fnp2_nr_lsmugc.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのため、このような実験を行うだけで十分であることがわかりました。フラグメンテーション禁止フラグを付けてパケットを送信し、サーバーに到達したパケットの数を数えます。</font><font style="vertical-align: inherit;">98％のケースでは、フラグメンテーション禁止のパケットは最大1350のサイズで渡されます。MTU </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1350に</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全に設定し</font><font style="vertical-align: inherit;">、フラグメンテーション禁止フラグをクリアして、2％のケースでパケットをフラグメント化することができます-運が悪い、大したことはありません。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エラー訂正</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WebRTCはSACK、NACK、FECをサポートしています。仕様を読み、修正方法を学ぶ必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
肝心なことは、ワイヤレスネットワークでパケットの1〜3％が失われるのは正常なことであり、それを処理できる必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WebRTCでは、否定応答（NACK）アプローチが最も一般的なストリーミングアプローチです。</font></font><br>
<img src="https://habrastorage.org/webt/n4/ik/zh/n4ikzhbxffmdjuf-a79snq2vaum.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場合、パケットの順序は受信側によって監視されており、一部のパケットがスキップされたことを理解している場合は、再度要求します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご存知のように、TCPは選択的確認応答を含む確認応答で機能します。否定応答の特異性は、このタイプの応答がFEC（Forward Error Correction）でうまく機能することです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SACK、NACK、FECの記述方法の詳細に興味がある場合は、この</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レポートを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参照してください</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FECテクノロジーは、ネットワークが悪いことが事前にわかっている場合に適用されます。これは次のように機能します。追加のパケットがデータストリームに埋め込まれ、エラーが検出された場合、修正することができ、再送信に時間を無駄にしません。データを再確認して送信している間は遅すぎるため、画像がフリーズします。</font></font><br>
<img src="https://habrastorage.org/webt/fo/dw/-s/fodw-s_sepjc4qkhonlbr_k-6pq.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最も単純なFECオプションはXORですが、ソロモンシリーズなどのより複雑なオプションがより一般的に使用されます。冗長性保護パッケージがパケットパケットに追加され、パケットが失われた場合、何かを復元できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チップ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドラフト中ですが、プロトコルで使用します。</font><font style="vertical-align: inherit;">チャネルの品質がより良く変化する可能性があると想定している場合、これを正確に検証するには、最初に冗長FECパケットを追加できます。</font><font style="vertical-align: inherit;">それらが消えても残念ではありませんが、データチャネルを安定して通過する場合は、コーデックのビットレートを上げて、より広いチャネルを使用できることを意味します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記のすべてに加えて、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">グループ通話を開始しました</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">稼働中のサービスの特性を測定したところ、次のことがわかりました。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーザーの90％が500 Kbps以上の速度を持っています。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参加者の平均数は3〜4人であるため、メッシュとエンドのミキシングを切り替えても無駄ではありませんでした。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参加者の1日あたりの平均最大人数は約27人です（たとえば、1クラス）。</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チェックリスト</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グループコールサーバーを作成する際の注意事項：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パケットペーシング。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MTUディスカバリー。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エラー訂正。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クライアントから最大のログを収集します。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後の項目は非常に重要です。すべてのシグナリング、すべてのWebRTC状態、送信されたすべての制御コマンドのログを収集したため、後で何かをデバッグできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ネットワークに関して多くの問題があり、それぞれについてソリューションを選択しました。</font></font><br>
<br>
<ul>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パケット損失：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再送信、パケットペーシング、FEC、MTU構成。</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネットワーク帯域幅の変更：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コーデックのバックプレッシャーを修正することを忘れないでください。また、ビットレートを反転させるには、FECパケットで帯域幅を確認します。</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ジッタ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はジッタバッファでのみ処理されますが、レイテンシは増加します。</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTT：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常に保存し、シグナリングのリクエスト数を最小限に抑えるようにしてください。</font></font></li>
</ul><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将来または時々待つ必要がある</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WebRTCは最も便利なものではありません。</font><font style="vertical-align: inherit;">これはRTPであり、その上には、多くのフラグとさまざまな拡張機能があり、一部のブラウザーではサポートされていますが、他のブラウザーではサポートされていません。</font><font style="vertical-align: inherit;">実際、WebRTCは扱いにくいものです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、Zoom、Skype、Lineなどの多くの通話サービスは、独自のプロトコルを記述しています。</font><font style="vertical-align: inherit;">そんな思いもありました。</font><font style="vertical-align: inherit;">しかしその後、ブラウザからの呼び出しの機能が失われます。</font><font style="vertical-align: inherit;">したがって、</font><font style="vertical-align: inherit;">独自のUDPプロトコルを作成した</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">経験</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">があっても</font><font style="vertical-align: inherit;">（このプロトコルでのストリーミングはWebRTCよりもうまく機能するようになりました）、待つことにしました。</font><font style="vertical-align: inherit;">それは本当に難しいことであり、今のところ私たちは急ぐべきではないと決定しました。</font><font style="vertical-align: inherit;">たとえば、Google STADIAがあるからです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
STADIAは、リモートサーバーでオンラインでプレイできるゲームコンソールです。</font><font style="vertical-align: inherit;">WebRTCの上で実行され、フレームの半分が失われると言われています。</font><font style="vertical-align: inherit;">したがって、Googleは現在、WebRTCを非常に積極的に扱っています。</font><font style="vertical-align: inherit;">WebRTC拡張ソリューションの中で、SRTP WebRTCをQUICに切り替えるアイデアさえ提供されています。</font><font style="vertical-align: inherit;">どのように機能するかはわかりませんが、活発に議論されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
QUICといえば、すでに多く使われています。</font><font style="vertical-align: inherit;">Chromeまたはc Androidを使用してGoogleまたはYouTubeにアクセスする場合、TCPは使用しません。GoogleからのUDP経由のQUICがあります。</font><font style="vertical-align: inherit;">携帯電話事業者は、QUIC / UDP経由のトラフィックの30％以上を占めています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
貧弱なモバイルネットワークでは、QUICはTCPよりも20〜30％高速にデータを配信します。</font><font style="vertical-align: inherit;">したがって、どこかでQUICをオンにするか、QUICに移動するだけで、ユーザーに優れたアクセラレーションを提供できます。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">調査結果</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では、インターネット経由の通話がどのように機能するか、および会議サーバーを作成する方法を検討しました。</font><font style="vertical-align: inherit;">コールは次の要素で構成されていることを学びました。</font><font style="vertical-align: inherit;">ビデオ/オーディオエンコーダー; </font><font style="vertical-align: inherit;">ネットワークとトポロジ。</font><font style="vertical-align: inherit;">これがどのように機能するかについての共通のパズルがあることを願っています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これをどうするか</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">まだチャットが行われていない場所やチャットがある場合は、通話を締めます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会議サーバーを作成するか、グループ通話が必要な場合は既成のサーバーを使用します。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
とにかく、ネットワークとビデオ/オーディオコーデックの知識が役に立つでしょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今日私たちが発見した最も重要なことは、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あらゆる特性を改善できること</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">通話のユーザー数の増加、待ち時間の短縮、品質の向上を含みます。</font><font style="vertical-align: inherit;">完璧には限界がないことを忘れないでください！</font><font style="vertical-align: inherit;">しかし、ある時点でまだ停止する必要があります:)</font></font><br>
<br>
<blockquote>   HighLoad++     . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a> (      )   ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>   6-7  2020   .    ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>. </blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja479836/index.html">下院は、マイクロ発電に関する電力法の改正を採択した。代替案は幸せですか？</a></li>
<li><a href="../ja479842/index.html">バース大学は電子アナログニューロンを作成しました</a></li>
<li><a href="../ja479844/index.html">UXデザイナーのチームを集め、採用ミスにより700万人を失う</a></li>
<li><a href="../ja479848/index.html">2019年第4象限に登場！Gartnerミーティングソリューションのビデオ会議分析レポートが5年間でどのように変化するか</a></li>
<li><a href="../ja479850/index.html">Windows Server Core 2019にExchange 2019をインストールする</a></li>
<li><a href="../ja479854/index.html">12月12日モーニングジャバダイジェスト</a></li>
<li><a href="../ja479858/index.html">LD_PRELOADを探しています</a></li>
<li><a href="../ja479860/index.html">生命モデリングのトピックのバリエーション。パート2</a></li>
<li><a href="../ja479862/index.html">ソフトウェアを登録するときに15000ルーブルを節約する方法</a></li>
<li><a href="../ja479864/index.html">WinForms + C＃でのゲーム16（パート2）</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>