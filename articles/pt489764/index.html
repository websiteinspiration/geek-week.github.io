<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçç üï¢ üÖ±Ô∏è "O destino tem muitas formas ..." ou automatizamos o controle de uma l√¢mpada usando CANNY 3 tiny e um fotorresistor üï∫üèΩ üç¥ üîñ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No √∫ltimo artigo sobre Habr, falei sobre como recebi o pequeno controlador Canny3 como presente. N√≥s "piscamos" o LED, apertamos um bot√£o. Sobre isso,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>"O destino tem muitas formas ..." ou automatizamos o controle de uma l√¢mpada usando CANNY 3 tiny e um fotorresistor</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/489764/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√∫ltimo artigo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre Habr, falei sobre como recebi o pequeno controlador Canny3 como presente. N√≥s "piscamos" o LED, apertamos um bot√£o. Sobre isso, em princ√≠pio, foi poss√≠vel finalizar os experimentos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, durante as √∫ltimas duas semanas, tenho ouvido livros de √°udio sobre The </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Witcher</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e, portanto, tornaram-se muito mais s√©rios sobre </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Destination</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . De acordo com as informa√ß√µes indicadas no site do fabricante, a fam√≠lia de controladores CANNY se destina principalmente √† automa√ß√£o de v√°rios sistemas automotivos e equipamentos especiais.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O problema √© que ningu√©m me deixa dar uma espiada em um carro real com minhas ‚Äúm√£os de ouro‚Äù e, em geral, tenho medo de carros. </font><font style="vertical-align: inherit;">Portanto, tive que comprar uma pequena l√¢mpada de carro e um fotorresistor especialmente para este artigo. </font><font style="vertical-align: inherit;">O que voc√™ n√£o far√° para n√£o irritar o Destino. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hoje, conectaremos o controlador e a l√¢mpada do carro a uma fonte de alimenta√ß√£o de 12V, enviaremos uma mensagem √† porta COM, automatizaremos a inclus√£o da l√¢mpada dependendo da luz e tentaremos o controlador PWM de alta frequ√™ncia. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ tamb√©m acredita no poder do destino? </font><font style="vertical-align: inherit;">Ent√£o voc√™ √© bem-vindo sob gato.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yt/kd/tj/ytkdtjul2i1qbdrqllt278lszck.png"><br>
<a name="habracut"></a><br>
<br>
<a name="I"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Parte I: Introdu√ß√£o</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte I: Introdu√ß√£o </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte II: Componentes e precau√ß√µes </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte III: Como gravar dados na porta COM </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte IV: Conecte e programe o autolamp e o fotorresistor </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte V: Tentando diminuir o brilho da l√¢mpada usando o PWM </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte VI: Conclus√£o</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
No in√≠cio do artigo, lembro-lhe N√£o tenho muita experi√™ncia em eletr√¥nicos de bricolage. </font><font style="vertical-align: inherit;">Muitos anos atr√°s, me envolvi com o CraftDuino - o clone dom√©stico do Arduino. </font><font style="vertical-align: inherit;">E al√©m daqueles "artesanatos" que ele fez por mim</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Drzugrik</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esta √© realmente a minha experi√™ncia em eletr√¥nica DIY √© limitada. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aparentemente, conhecendo meu amor pelos desenvolvimentos dom√©sticos, eles decidiram me dar o Canny 3.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Mesmo no processo de prepara√ß√£o do √∫ltimo artigo, fiquei surpreso que o controlador possa ser alimentado n√£o apenas a 5V, mas tamb√©m a 12V, enquanto a tens√£o nas sa√≠das ser√° a mesma que em entrada e a corrente m√°xima por canal √© de at√© 100mA. Pareceu-me interessante, porque meu velho CraftDuino n√£o podia. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por c√°lculos simples usando a f√≥rmula</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>P</mi><mo>=</mo><mi>U</mi><mo>&amp;#x2217;</mo><mi>I</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.993ex" height="2.009ex" viewBox="0 -755.5 4302.5 865.1" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhg7Y2fbuz-KQi_pMyY1E2ZA5_MxlQ#MJMATHI-50" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhg7Y2fbuz-KQi_pMyY1E2ZA5_MxlQ#MJMAIN-3D" x="1029" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhg7Y2fbuz-KQi_pMyY1E2ZA5_MxlQ#MJMATHI-55" x="2085" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhg7Y2fbuz-KQi_pMyY1E2ZA5_MxlQ#MJMAIN-2217" x="3075" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhg7Y2fbuz-KQi_pMyY1E2ZA5_MxlQ#MJMATHI-49" x="3798" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi><mo>=</mo><mi>U</mi><mo>‚àó</mo><mi>I</mi></math></span></span><script type="math/tex" id="MathJax-Element-1">P=U*I</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Percebi que a pot√™ncia m√°xima por sa√≠da do controlador ser√° de cerca de 1,2 watts. Decidiu-se pegar uma l√¢mpada com uma reserva de energia, por precau√ß√£o. A escolha caiu em uma l√¢mpada LED de 0,9 W. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, eu ainda n√£o queria gravar ingloriamente o presente de Ano Novo e, antes de conect√°-lo, decidi perguntar aos desenvolvedores se entendia tudo corretamente. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para minha grande surpresa, eles n√£o apenas me responderam, mas tamb√©m sugeriram que, se voc√™ combinar v√°rias sa√≠das, a pot√™ncia aumentar√° proporcionalmente. Depois disso, decidiu-se comprar algo mais poderoso que a l√¢mpada e a escolha caiu no ventilador do carro, que √© inserido no isqueiro. No entanto, para n√£o fazer ‚Äúvinagrete‚Äù do artigo, decidi adiar as manipula√ß√µes com o ventilador do autom√≥vel at√© a pr√≥xima vez.</font></font><br>
<br>
<a name="II"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Parte II: Equipamento e Precau√ß√µes </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o, no in√≠cio dos experimentos, eu tinha o seguinte:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dispositivo de carregamento e lan√ßamento "Orion Vympel-55". </font><font style="vertical-align: inherit;">Eu j√° o tinha e, felizmente, ele pode n√£o apenas carregar as baterias, mas tamb√©m ser uma fonte de energia em uma ampla faixa (incluindo 12 V);</font></font><br>
<br>
<img src="https://habrastorage.org/webt/uj/fi/_i/ujfi_iwx1hku88fcb2trgbdhvqu.jpeg"><br>
<br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Autolamp LED "Skyway H3. </font><font style="vertical-align: inherit;">SH3-9SMD-5050 W. " </font><font style="vertical-align: inherit;">Pelo que entendi, a l√¢mpada pode ser usada em v√°rios far√≥is, mas como n√£o tenho onde fix√°-la, escolhi a pot√™ncia e a facilidade da conex√£o sem solda; </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zw/vm/yi/zwvmyih0_5t0grxn5elq4j1zvfe.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A prop√≥sito, voltando √† f√≥rmula de c√°lculo de pot√™ncia, decidi medir as correntes e garantir que caiba nos 100 mA permitidos. </font><font style="vertical-align: inherit;">Em teoria, a corrente da l√¢mpada deve ser</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>I</mi><mo>=</mo><mi>P</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>/</mo></mrow><mi>U</mi><mo>=</mo><mn>0.9</mn><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>/</mo></mrow><mn>12</mn><mo>=</mo><mn>0</mn><mo>,</mo><mn>075</mn><mi>A</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="29.044ex" height="2.634ex" viewBox="0 -809.3 12504.8 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhg7Y2fbuz-KQi_pMyY1E2ZA5_MxlQ#MJMATHI-49" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhg7Y2fbuz-KQi_pMyY1E2ZA5_MxlQ#MJMAIN-3D" x="782" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhg7Y2fbuz-KQi_pMyY1E2ZA5_MxlQ#MJMATHI-50" x="1838" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhg7Y2fbuz-KQi_pMyY1E2ZA5_MxlQ#MJMAIN-2F" x="2590" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhg7Y2fbuz-KQi_pMyY1E2ZA5_MxlQ#MJMATHI-55" x="3090" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhg7Y2fbuz-KQi_pMyY1E2ZA5_MxlQ#MJMAIN-3D" x="4135" y="0"></use><g transform="translate(5192,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhg7Y2fbuz-KQi_pMyY1E2ZA5_MxlQ#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhg7Y2fbuz-KQi_pMyY1E2ZA5_MxlQ#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhg7Y2fbuz-KQi_pMyY1E2ZA5_MxlQ#MJMAIN-39" x="779" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhg7Y2fbuz-KQi_pMyY1E2ZA5_MxlQ#MJMAIN-2F" x="6471" y="0"></use><g transform="translate(6972,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhg7Y2fbuz-KQi_pMyY1E2ZA5_MxlQ#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhg7Y2fbuz-KQi_pMyY1E2ZA5_MxlQ#MJMAIN-32" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhg7Y2fbuz-KQi_pMyY1E2ZA5_MxlQ#MJMAIN-3D" x="8250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhg7Y2fbuz-KQi_pMyY1E2ZA5_MxlQ#MJMAIN-30" x="9307" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhg7Y2fbuz-KQi_pMyY1E2ZA5_MxlQ#MJMAIN-2C" x="9807" y="0"></use><g transform="translate(10252,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhg7Y2fbuz-KQi_pMyY1E2ZA5_MxlQ#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhg7Y2fbuz-KQi_pMyY1E2ZA5_MxlQ#MJMAIN-37" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhg7Y2fbuz-KQi_pMyY1E2ZA5_MxlQ#MJMAIN-35" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhg7Y2fbuz-KQi_pMyY1E2ZA5_MxlQ#MJMATHI-41" x="11754" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi><mo>=</mo><mi>P</mi><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mi>U</mi><mo>=</mo><mn>0.9</mn><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mn>12</mn><mo>=</mo><mn>0</mn><mo>,</mo><mn>075</mn><mi>A</mi></math></span></span><script type="math/tex" id="MathJax-Element-2">I=P/U=0.9/12=0,075A</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas, a julgar pela medida, ficou um pouco menos. </font><font style="vertical-align: inherit;">Embora talvez eu tenha feito algo errado.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gl/fw/qv/glfwqvsyuybaay2nr5bdftlk2n8.png"><br>
<br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fotoresistor FR-765. </font><font style="vertical-align: inherit;">Eu o escolhi simplesmente porque n√£o havia mais nada na loja.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/h9/zq/gq/h9zqgqgqp4vfwhhoreh_qxmo5aa.png"></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bem, √© claro que eu tinha: um controlador, uma t√°bua de p√£o, fios, crocodilos etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em um artigo anterior sobre o Canny 3, eu realmente elogiei o controlador, mas aconteceu que h√° uma mosca na pomada. </font><font style="vertical-align: inherit;">Na √∫ltima vez, n√£o usei o pacote de cabos fornecido com o kit, mas desta vez n√£o pude ficar sem ele. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como eu uso muito pouco um ferro de soldar, eu queria reduzir seu uso a um m√≠nimo vital. </font><font style="vertical-align: inherit;">Portanto, no final, coletei todos os circuitos em conex√µes destac√°veis. </font><font style="vertical-align: inherit;">Usei fios especiais (pai-pai, m√£e-m√£e, pai-m√£e), t√°buas de p√£o e clipes de crocodilo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E se os desenvolvedores do controlador n√£o s√£o os culpados pelo fato de que, no processo de descascar o cabo, recebi alguns cortes, ent√£o os momentos em que toda a minha estrutura caiu no ch√£o devido ao fato de eu ter enganchado o chicote "de madeira", em parte em sua consci√™ncia. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por um lado, um torniquete √© uma coisa boa. Para instalar o controlador dentro do carro, acho que o chicote de cabos est√° correto. Os fios est√£o presos e, se est√£o bem torcidos, encaixam-se completamente nos conectores "m√£e", na minha "t√°bua de p√£o". Por outro lado, como n√£o √© conveniente fazer experimentos com o cabo com a placa de ensaio, at√© mesmo uma foto bonita com o controlador virado para o rosto foi dif√≠cil de fazer por causa dos ‚Äúfios de carvalho‚Äù. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu disse um pouco mais alto que n√£o queria usar um ferro de soldar, mas pelo menos uma vez eles teriam que se armar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para medir o sinal do fotorresistor, precisamos ‚Äúinseri-lo‚Äù no conversor anal√≥gico-digital (ADC) do controlador. </font><font style="vertical-align: inherit;">Mas o fato √© que, ao contr√°rio, por exemplo, do meu antigo Craftduino. </font><font style="vertical-align: inherit;">No caso de Canny, foi necess√°rio colocar um jumper. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No come√ßo, n√£o li atentamente a documenta√ß√£o e pensei que as sa√≠das 5 e 6 do controlador s√£o as sa√≠das de A5 e A6. </font><font style="vertical-align: inherit;">At√© escrevi um programa e tentei durante muito tempo fazer leituras. </font><font style="vertical-align: inherit;">Naturalmente, n√£o tive √™xito porque, por padr√£o, sem prepara√ß√£o preliminar, os canais 5 e 6 funcionam como uma entrada discreta normal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de ler a documenta√ß√£o do controlador com uma "mente renovada", percebi que ainda precisava soldar. </font><font style="vertical-align: inherit;">Voc√™ n√£o tem ideia de como eu tinha medo de estragar tudo.</font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A √∫ltima vez que tentei soldar algo no circuito que fiz por mim </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Drzugrik</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Consegui preencher todos os capacitores com solda perto do local de solda. </font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desta vez, o processo de soldagem foi simples. </font><font style="vertical-align: inherit;">Foi o suficiente para colocar com cuidado uma gota de solda na pista. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A apar√™ncia do meu jumper de solda pode ser vista na foto abaixo:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/pv/r9/vd/pvr9vdryjakzmbjalenhh6wrn9a.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Liguei apenas a sexta sa√≠da ao canal A6, n√£o ousei soldar o quinto canal, para n√£o encher acidentalmente os dois jumpers com solda. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teoricamente, era poss√≠vel ficar sem um ferro de soldar conectando o orif√≠cio e o terminal n¬∫ 6 com um fio. </font><font style="vertical-align: inherit;">Mas isso seria terrivelmente inconveniente. </font></font></i> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A foto abaixo mostra a conex√£o do pino n¬∫ 5 e do pino ADC n¬∫ A5 com um fio pai para pai: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qu/l6/hb/qul6hbndz9lv1jwj8rq-m34sipe.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
a √∫ltima coisa que voc√™ deve prestar aten√ß√£o antes de come√ßar a trabalhar. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aten√ß√£o!</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o repita de um para um, o que descreverei mais adiante no texto. </font><font style="vertical-align: inherit;">N√£o tenha pregui√ßa de substituir as conex√µes de plug-in por solda, pegue fios mais grossos, leia a documenta√ß√£o. </font><font style="vertical-align: inherit;">N√£o sou especialista nesses assuntos, por isso reuni tudo "da melhor maneira poss√≠vel". </font><font style="vertical-align: inherit;">Tamb√©m aconselho que voc√™ monitore cuidadosamente o risco de inc√™ndio e n√£o deixe o equipamento sem vigil√¢ncia. </font><font style="vertical-align: inherit;">Consegui cheirar alguns fios fumegantes algumas vezes. </font><font style="vertical-align: inherit;">Bem, mesmo na fonte de alimenta√ß√£o havia prote√ß√£o contra curto-circuito (eu tamb√©m organizei). </font><font style="vertical-align: inherit;">Portanto - tenha cuidado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, n√£o esque√ßa que, apesar de as tens√µes e correntes que temos s√£o pequenas, ainda tocar as partes vivas sob tens√£o pode ser doloroso </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(especialmente se voc√™ as cutucar com uma parte ferida do corpo)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<a name="III"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Parte III: Como gravar dados na porta COM</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para, de alguma forma, calibrar nosso sensor de luz ambiente, precisamos entender quais valores ele envia ao controlador, dependendo do n√≠vel de luz. Para fazer isso, precisamos enviar dados do ADC para o monitor. Ao trabalhar com o Arduino e seus clones para resolver esses problemas, usei um monitor de porta COM. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No caso do Canny 3 tiny, o processo de leitura de dados de uma porta COM virtual n√£o √© muito mais complicado do que para o Arduino. Mas h√° uma diferen√ßa fundamental. O ambiente de desenvolvimento CannyLab n√£o possui seu pr√≥prio monitor de porta COM. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu usei o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hterm</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> porque √© multiplataforma, leve e n√£o requer instala√ß√£o. Mas voc√™ pode usar qualquer outro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vou dizer ainda mais, nada nos impedir√° de usar o monitor de porta COM do Arduino IDE.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo funcionou imediatamente no meu sistema Windows 10 e eu n√£o precisei instalar drivers para a porta COM virtual separadamente. Mas, por precau√ß√£o, direi que o driver parece estar inclu√≠do no ambiente de desenvolvimento CannyLab (est√° na pasta drv \ canny3tiny_vcp). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para n√£o explicar melhor como funcionam os blocos do gr√°fico associados ao envio de dados para a porta COM virtual USB, darei um exemplo simples. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hoje, como exerc√≠cio, enviaremos a mensagem "HABR" usando o controlador. Primeiro, voc√™ precisa baixar o IDE CannyLab. Pode ser facilmente encontrado no site oficial do desenvolvedor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A prop√≥sito, usei o CannyLab v 1.42, mas acho que nas vers√µes anteriores n√£o haver√° problemas com o desempenho dos diagramas.</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O processo de grava√ß√£o de software no novo controlador e os princ√≠pios b√°sicos do trabalho com o Cannylab I descritos no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cap√≠tulo 3 do √∫ltimo artigo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Crie um novo gr√°fico, selecione Canny 3 tiny na caixa de di√°logo. E transferimos blocos, constantes e registros para o diagrama, como na imagem abaixo. Obviamente, n√£o √© necess√°rio transferir r√≥tulos de texto; nada depende deles durante a execu√ß√£o do diagrama. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rz/st/g9/rzstg9zmltxsf2ekndo4orydcnu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ n√£o gosta de mover blocos, pode fazer o download dos diagramas deste artigo usando o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub.</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Observe que o envio de uma mensagem para a porta COM √© um pouco estranho e √© necess√°rio escrever letras em um par de caracteres no espelho, mas voc√™ pode se acostumar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vou explicar em partes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No bloco </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Parameter Setting"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">definimos as configura√ß√µes do driver USB VCP. Primeiro, ative o modo de transfer√™ncia na porta COM virtual e defina o comprimento da mensagem transmitida. No nosso caso - 6 caracteres, incluindo feed de linha. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No bloco </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Texto da mensagem",</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> escrevemos o texto da mensagem em constantes (n√£o esque√ßa de mudar para o modo "chr") e transferimos essas constantes para os registros de driver correspondentes. Mais uma vez, chamo a aten√ß√£o para o fato de escrevermos a mensagem na ordem inversa, tanto nos pares de s√≠mbolos como nos registros dos condutores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√öltimo bloco </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Transfer√™ncia de mensagens"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Envia com uma frequ√™ncia especificada nossa mensagem para a porta COM. Para isso, usamos um bloco PWM. N√£o confunda com o RF PWM, que usaremos ao conectar a l√¢mpada. Nesse caso, o bloco gera metade do tempo "0" e a segunda metade "1". Voc√™ pode "brincar" com o tamanho do per√≠odo e preencher para aumentar ou diminuir a frequ√™ncia do envio de mensagens. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â necess√°rio conectar um LED verde neste bloco PWM para verificar a opera√ß√£o do controlador. Se tudo estiver em ordem, o LED piscar√° com a frequ√™ncia do envio de uma mensagem. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como escrever um programa para o controlador, eu j√° disse </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em um artigo anterior</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . No entanto, nos √∫ltimos tempos, aprendi outro truque interessante.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando conectamos o controlador ao computador, ele entra no modo de grava√ß√£o do programa. Anteriormente, para entrar no modo de tempo de execu√ß√£o, removi o controlador do computador e prendi o carregamento USB nele. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Descobriu-se que existe uma maneira mais f√°cil. Depois de conectar o controlador √† porta USB do computador e clicar no bot√£o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Conectar"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no CannyLab </font><font style="vertical-align: inherit;">, v√° para o </font><font style="vertical-align: inherit;">menu </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Dispositivo"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e selecione </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Executar"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/b-/dt/bv/b-dtbvog9sirji-opbj-ehor-hm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O controlador come√ßa a executar o programa gravado, recebendo energia da porta USB. Depois disso, o controlador ficar√° dispon√≠vel no monitor da porta COM. √â verdade que, para voltar ao modo de grava√ß√£o de programa, o controlador precisar√° ser removido e reinserido na porta USB do computador.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E aqui est√° o nosso "HABR" no monitor de porta Hterm COM. </font><font style="vertical-align: inherit;">Preste aten√ß√£o √† velocidade de transfer√™ncia de dados e outras configura√ß√µes. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ls/lh/yu/lslhyucpy7cxrmexfqnn3l5swgi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E este √© o monitor da porta COM do Arduino IDE: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ab/zd/vl/abzdvlqwpn6jaw0q0uuzx06ltzo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A foto mostra como o controlador funciona ap√≥s a grava√ß√£o do diagrama: o </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qv/4n/zu/qv4nzuowx6saogj5xskvkn7dt3w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LED vermelho indica que a energia est√° sendo recebida pela porta USB do computador e o verde "pisca" com o ritmo das mensagens transmitidas pela porta COM USB virtual.</font></font><br>
<br>
<a name="IV"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte IV: Conectamos e programamos uma l√¢mpada de carro e um fotorresistor.</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para come√ßar, consideraremos a op√ß√£o mais simples. Basta conectar a l√¢mpada ao terminal n¬∫ 1 do controlador e o fotorresistor ao terminal n¬∫ 6 (ADC). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo √© bem simples, mas, para o caso, eu desenhei um diagrama: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sv/un/pm/svunpmu3hc-n4agrotbzy2rquea.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas aqui parece ao vivo: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ap/az/z8/apazz8ybxdpnfnaxf9y3c-daabc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Äú-‚Äù e ‚Äú+‚Äù da fonte de energia que conectamos aos terminais correspondentes do Canny 3 min√∫sculo, pino n¬∫ 1, √© conectado ao alojamento da l√¢mpada e a ‚Äúcauda‚Äù da l√¢mpada com uma vantagem na t√°bua de p√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com um fotorresistor, tudo tamb√©m √© simples. Al√©m disso, levamos a t√°bua de p√£o do barramento para a t√°bua de p√£o e o sinal de menos vai para o pino n¬∫ 6 do controlador, que anteriormente conectamos com o jumper ao ADC. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eu j√° escrevi acima que toda a minha estrutura caiu algumas vezes da tabela. Portanto, mais adiante nas fotos, pode haver pequenas diferen√ßas em termos de cores dos condutores e pontos de entrada na t√°bua de p√£o.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora vamos escrever um programa. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/n1/7s/l8/n17sl8exoem1_jl54mqgb-bapeg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considere o novo dia nos blocos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos come√ßar com o bloco </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Obtendo o valor do ADC e convertendo-o em su√≠tes"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neste bloco, traduzimos os valores que o ADC (0 a 1023) pode nos fornecer em ilumina√ß√£o (lux). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Precisamos fazer uma medida de ilumina√ß√£o quando est√° clara e uma medida em condi√ß√µes mais escuras. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim, no </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äúvalor de‚Äù</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> registrei a leitura m√≠nima do ADC ‚Äú0‚Äù e no </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äúresultado de‚Äù o</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> valor zero do n√≠vel de ilumina√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äúvalor para‚Äù</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , registrei as leituras do ADC = 20 e a ilumina√ß√£o correspondente igual a 300 lux, entrei no </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äúresultado para‚Äù</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o tenho uma descri√ß√£o detalhada dos par√¢metros do fotorresistor, mas suspeito que ele n√£o tenha uma caracter√≠stica completamente linear, mas isso √© suficiente para n√≥s agora. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verifique previamente como o diagrama √© realizado no simulador. Em mais detalhes sobre o trabalho no simulador CannyLab que escrevi </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√° o que eu acabei com: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mp/yw/no/mpywnolxlvzxyaqqkeyy3oh2m-u.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imagine que o fotorresistor passou um valor de 10 para o ADC.O bloco </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Display (MAP)"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">isso √© essencialmente escala linear. Dez √© exatamente metade da escala da nossa escala, o que significa que a sa√≠da ser√° metade da faixa de 0 a 300, ou seja, 150. Isso est√° abaixo do n√≠vel especificado de 300 lux. Portanto, um √© enviado para o registro de canal n ¬∞ 1 (sa√≠da n ¬∞ 1) e a l√¢mpada acende . Mas ele n√£o liga imediatamente, mas apenas se estiver escuro por pelo menos um segundo (1000 milissegundos). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para entender qual mensagem receberemos na porta COM, mudei a exibi√ß√£o dos valores no simulador para o formato hexadecimal. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mq/nr/rk/mqnrrkxyzudcput-yez77oke13a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considere o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äúregistro de configura√ß√£o de mensagens VCP D1: D0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o valor 3130 entra nele. Como lembramos, esse √© um par de caracteres, cada parte representando um c√≥digo de caracteres hexadecimal. Acontece que 31h √© o c√≥digo de caractere "1" em ASCII, 30 √© o c√≥digo zero em ASCII.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">registro de instala√ß√£o da mensagem "VCP D3: D2"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , teremos os caracteres "0" e "5". Coletamos os valores dos pares de caracteres na ordem de D0 a D3 e obtemos: "0", "1", "5", "0". Ent√£o, adquirimos nosso 0150 lux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas como se costuma dizer "nem um √∫nico simulador ...". Vamos ver o que acontece na pr√°tica. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Medi√ß√£o sob a luz do candelabro e luz natural (ilumina√ß√£o combinada): As </font></font><br>
<br>
<img src="https://habrastorage.org/webt/of/ze/ps/ofzepsndi0bepg1hwoxzursk7my.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
leituras do medidor de luz de f√°brica e do nosso caseiro coincidem quase perfeitamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Medi√ß√£o √† luz do dia: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/w_/kz/aq/w_kzaqulbnhvr-pq2tsdcy7pqu8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Extremamente pior.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Provavelmente, isso se deve √† n√£o linearidade das caracter√≠sticas do fotorresistor e tamb√©m ao definirmos o limite inferior de escala para zero, mas n√£o complicaremos o diagrama para aumentar a precis√£o da medi√ß√£o. No nosso exemplo, o principal era entender o princ√≠pio geral de obter valores de ilumina√ß√£o. </font><font style="vertical-align: inherit;">E o aumento da precis√£o pode ser adiado at√© a implementa√ß√£o desses projetos no carro ou em casa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verificamos a opera√ß√£o do circuito, fechamos o sensor com um dedo e, em seguida, removemos o dedo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4f/nh/qd/4fnhqd-jpxmvsbj5wtvwnokgybg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E agora h√° uma op√ß√£o quando est√° escuro na sala: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/5r/d7/lc/5rd7lcy5_cdx339o6z6c39r3y5i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
a l√¢mpada est√° acesa. </font><font style="vertical-align: inherit;">Tudo funciona como deveria.</font></font><br>
<br>
<a name="V"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Parte V: Tentando diminuir o brilho da l√¢mpada usando PWM</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos complicar um pouco o esquema alterando o brilho da l√¢mpada. Para fazer isso, precisamos de um PWM de alta frequ√™ncia (RF PWM), no Canny 3 tiny √© implementado nas sa√≠das 3 e 4. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Decidi usar a sa√≠da 4. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O esquema de conex√£o permanecer√° praticamente inalterado. Simplesmente, em vez da sa√≠da n¬∫ 1, conectamos a sa√≠da n¬∫ 4 √† l√¢mpada, e </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qp/bg/b-/qpbgb-a7whds1vugbizqoyr3its.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√© assim que fica na montagem. Toda a diferen√ßa √© que, em vez de um fio branco, o quadro agora √© azul. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2t/z3/nl/2tz3nldjplnly2tzmo7ttrb0he0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O diagrama tamb√©m n√£o mudou muito. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/or/fx/wl/orfxwlbv1adspw_c0fv2ouenqhy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o vou pintar o diagrama em detalhes. As principais mudan√ßas na configura√ß√£o da sa√≠da 4, que usamos para o PWM. Nesta se√ß√£o, devemos definir o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Registro de configura√ß√£o de preenchimento"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">leva valores de 2 a 255 microssegundos, decidi n√£o arriscar e escolhi 254. Observe que ele √© instalado para dois canais ao mesmo tempo (n¬∫ 3 e n¬∫ 4). Em seguida, escrevemos "1" no </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"registro de habilita√ß√£o de canal PWM No. 4"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , incluindo o PWM de nossa l√¢mpada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No bloco </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúLigando a l√¢mpada no modo PWM (com baixo brilho)‚Äù, o</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> novo para n√≥s √© apenas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúRegistre-se para definir o canal de preenchimento n ¬∞ 4, Œºs‚Äù</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Escreveremos o valor ‚Äú10‚Äù, desde que o n√≠vel de ilumina√ß√£o acima do fotossensor seja inferior a 250 lux, em dentro de 1 segundo. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A foto abaixo mostra que a l√¢mpada acende, mas brilha pouco.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/om/pp/_t/ompp_teo-f76yagfthj5qylheus.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ deseja que a l√¢mpada brilhe mais, √© necess√°rio alterar apenas o valor da constante "10" para qualquer n√∫mero maior. Por exemplo, voc√™ pode pegar o n√∫mero 127; no nosso caso, √© metade do tempo necess√°rio para preencher o per√≠odo de RF PWM, o que significa cerca da metade do brilho da l√¢mpada. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lx/ni/3t/lxni3tbt3zw1y6lyqthoqqufc1w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deve-se notar que o RF PWM com esta l√¢mpada funciona de maneira not√°vel. Aqui est√£o tr√™s fotos: na primeira, definimos o </font><font style="vertical-align: inherit;">valor </font><font style="vertical-align: inherit;">em </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Registre-se para preencher o n√∫mero do canal 4"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para 10 Œºs, na segunda - 110 Œºs, √† direita - 210 Œºs. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ud/os/_w/udos_wpczlgn2m1naf4nc5053da.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em princ√≠pio, o autolamp do nosso exemplo, como eu o entendo, √© usado em sinais de posi√ß√£o e, √†s vezes, em far√≥is de nevoeiro de carros.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penso que, se refinarmos o esquema e o diagrama, seria poss√≠vel implementar a inclus√£o da luz de fundo com pouca luz em m√°quinas mais antigas. </font><font style="vertical-align: inherit;">√â verdade que voc√™ precisa considerar o efeito da ilumina√ß√£o artificial √† noite. </font><font style="vertical-align: inherit;">De modo que nas estradas, nos t√∫neis e nos far√≥is dos carros que se aproximam, a l√¢mpada n√£o se apaga. </font><font style="vertical-align: inherit;">Ou seria poss√≠vel controlar a l√¢mpada no compartimento de passageiros para que, por exemplo, as l√¢mpadas nas portas do Zhiguli ou Niva nem sempre acendessem quando abertas.</font></font><br>
<br>
<a name="VI"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Parte VI: Conclus√£o </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No processo de escrever este artigo, experimentei um forte senso de nostalgia. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enquanto estudava no instituto, meu amigo e colega de classe Seryoga tinha um chique sedan azul da marca VAZ 2107. O que ele simplesmente n√£o fez com ele: ele conectar√° algum tipo de mangueira (para aumentar o impulso), instalar√° um ventilador no compartimento de passageiros para que ele ligue com um bot√£o separado e, em seguida, iniciar√° o carro com o pressionar de um bot√£o (apenas com a chave girada igni√ß√£o). Em geral, ele simplesmente n√£o ‚Äúsintonizou‚Äù sua ‚Äúandorinha‚Äù. Muitos anos se passaram desde ent√£o, meu amigo mudou-se para um carro mais s√≥lido, mas tenho medo de imaginar o que ele faria com seu Zhiguli se ele adquirisse esse controle h√° 10 anos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gra√ßas a este artigo, tamb√©m me lembrei do meu destino. Afinal, estudei por muitos anos como engenheiro de automa√ß√£o, mas n√£o trabalhei um dia apenas na minha especialidade. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acontece que √© t√£o legal mergulhar no mundo DIY. No processo de montagem dos circuitos mais de uma vez "preso", ligue e desligue a l√¢mpada e o LED com um bot√£o. √â uma sensa√ß√£o agrad√°vel quando algo funciona como pretendido. Tamb√©m me peguei com a ideia de que programar um controlador usando diagramas √© uma tarefa mais meditativa do que escrever c√≥digo no IDE do Arduino. Uma percep√ß√£o completamente diferente do programa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enquanto escrevia este artigo, pedi uma vers√£o do Canny 3 tiny sem o chicote de cabos. Agora vou descansar um pouco e escrever um artigo sobre a instala√ß√£o desse controlador em uma t√°bua de p√£o e, por si s√≥, analisaremos mais alguns exemplos de automa√ß√£o de ilumina√ß√£o com sua ajuda.</font></font><br>
<br>
<i>   ,  ,    . </i><br>
<br>
<i>UPD:<br>
,       ,            :</i><br>
<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">¬´, ,  ‚Äì  !¬ª       CANNY 3 tiny</a>.<br>
</li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">¬´  ...¬ª         (CANNY  Arduino)  Raspberry PI</a>.<br>
</li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">¬´ ?¬ª     bluetooth      Xamarin (Android)</a>.<br>
</li>
</ol></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt489754/index.html">20 sistemas de gerenciamento de projetos, vis√£o geral de 100 chips</a></li>
<li><a href="../pt489756/index.html">Criar um efeito de l√°pis no SVG</a></li>
<li><a href="../pt489758/index.html">Angular: um exemplo de uso do NGRX</a></li>
<li><a href="../pt489760/index.html">Consci√™ncia e exist√™ncia. Mec√¢nica qu√¢ntica sem paradoxos</a></li>
<li><a href="../pt489762/index.html">Um exemplo simples de an√°lise e an√°lise de dados para o World of Tanks</a></li>
<li><a href="../pt489768/index.html">Como œÄ combina blocos de colis√£o e um algoritmo de pesquisa qu√¢ntica</a></li>
<li><a href="../pt489770/index.html">V√≠deo do MinskJS mitap: meu relat√≥rio sobre extens√µes do navegador</a></li>
<li><a href="../pt489772/index.html">Hackathon em Simferopol, Yandex Di√°logos e leis da tecnologia de chat-bot</a></li>
<li><a href="../pt489774/index.html">A hist√≥ria de como automatizei o apartamento usando o Node-RED. parte II</a></li>
<li><a href="../pt489776/index.html">The Ember Times - Edi√ß√£o 136</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>