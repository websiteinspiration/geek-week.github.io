<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë£ üë®‚Äç‚öïÔ∏è üëã Why don't we write code in controllers? ‚úÖ üë©üèΩ‚Äç‚öñÔ∏è üí†</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I think many of you have heard the opinion that there should be no code in the controllers, and therefore a controller with methods in one line is con...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Why don't we write code in controllers?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/505708/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I think many of you have heard the opinion that there should be no code in the controllers, and therefore a controller with methods in one line is considered ‚ÄúBest Practice.‚Äù I, in turn, doubt that the benefits of this are so great. </font><font style="vertical-align: inherit;">If you had similar thoughts, I ask under kat.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/8de/142/358/8de1423581455ddfe4a47f5af5693d62.png" alt="image"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hello everyone! </font><font style="vertical-align: inherit;">I want to say right away that my opinion is not true, and the purpose of this post is to express my opinion and hear the comments of others. </font><font style="vertical-align: inherit;">All of the above applies to the implementation of the API, if you have MVC with views, then this case will not work, because in this case it is better to write only the logic with View in the controllers</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What's wrong?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I'm sure that many of you are working with a typical CRUD application with 3-layer architecture (by the way, there are no more layers, but more about that next time). </font><font style="vertical-align: inherit;">And in this architecture, you have a layer for working with data (further DA), a layer of business logic (further BL), and a view layer (further VL). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
BL can be done in different ways, I met 2 options:</font></font><br>
<br>
<ul>
<li>Class ‚Äî         .    -  ,    , , .         IRepository    ,  API       ,             .</li>
<li>CQS ‚Äî      DTO (Command\Query) ,       .                  .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
These methods have a number of rules of their own and one of them is that the handlers cannot call other handlers, they must be completely independent, the exact same situation in the implementation through an ordinary class with a bunch of methods, the methods are so attached to the feature that they cannot be reused. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consider a couple of implementations in this style, and then I will transfer the code to the controllers and we will analyze what we have lost. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/94a/cec/90b/94acec90b37d7d50e3d2b8154ada6495.png" alt="image"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/94a/a11/236/94aa11236a0675ae51802682b917003b.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this form, we implement all the methods and then simply call them at the API level: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/57a/c90/589/57ac905897f3c4ddfe4807d5e0e2d3f0.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I hope you understand that the code with Command -&gt; Handler will be similar, just more divided. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And it always haunts me, why am I doing this extra work?</font></font><br>
<br>
<ul>
<li>  ? ‚Äî ,         .<br>
<br>
 -       2 ,     ‚Äî   </li>
<li>      ? ‚Äî ,     ?      ,         IUserService?</li>
<li>?     ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">TestServer</a>    end2end .</li>
</ul><br>
<h2>     </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's remove the excess. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/ff0/05d/bcd/ff005dbcd0122ff451e06541214630f3.png" alt="image"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/80b/44d/fb2/80b44dfb21071c0ebb8ef2e1e1199d42.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Miraculously, the service code does not differ from the controller, we just added a couple of attributes and are ready to catch http requests. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I believe that ASP NET has perfectly abstracted us from working with HTTP, we have the best place where we operate with our types. </font><font style="vertical-align: inherit;">I repeat, if you have views, then in controllers it is better to write code only for View, and in services write </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reused</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> methods to get data for View. </font><font style="vertical-align: inherit;">But in current realities, more and more often we have API + SPA.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Validation?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ASP NET Core Pipeline is very well tuned and has a lot of solutions, take a look at FluentValidation, you will add validation without even changing the code in the controllers.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Want more separation?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Separate the interface and if you need an implementation too. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/a19/389/bca/a19389bca07fbf6521fd5683a861bad5.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a bonus, the service interface becomes a top-level contract, and within the framework of one process it is just a direct call of the code from the controller, as part of client-server communication, a simple implementation of the same interface using HttpClient is substituted.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connect other channels</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If they tell me that we can have another channel, for example, through a queue, I can just get an instance of the controller and use it in another channel. </font><font style="vertical-align: inherit;">This controller easily resolves from DI. </font><font style="vertical-align: inherit;">In addition, ASP NET is quite flexible and you can teach some channels to process it yourself, again modifying the pipeline.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/95d/b6d/75e/95db6d75e8fe8cd3bc3fcd4101a821ad.png" alt="image"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fun fact</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A test task in this style will be thrown out and rejected, but you have a lot of reasons why you did it, but if you go to an interview and discuss why you‚Äôre designing the code, then this is probably a good place and you have the same specialist who understands that programming is </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">multifaceted</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Total</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can reuse only services by type of repository, cache, client api, etc., but reuse the logic of processing a single request is a very rare case, and most likely a bad one. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This approach, like others, needs to be applied in the right places, it saves time, and is very convenient for APIs (microservices) that are closed to public access. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I believe that the controllers are the very BL Service or Command \ QueryHandler, and in my projects I practice this approach and the controllers do very well, I recommend that you try. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We did not increase the responsibility of the framework, it had a task:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Accept requests</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Map them in a model</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Call the code we specified according to some rules</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Give answers</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
She stayed with him. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I really do not see critical problems why this should not be done, therefore I invite you to comment. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If I‚Äôm not thrown much, then the next article will be about the interfaces on each service class of the system, and is this necessary? </font><font style="vertical-align: inherit;">Is it worth writing a solution in order to make it easier to </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fart</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wet.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en505698/index.html">7 sites for site design. What to choose?</a></li>
<li><a href="../en505700/index.html">I will interview Java programmers. One set of questions for any level</a></li>
<li><a href="../en505702/index.html">Clumsy (almost literally) copy protection</a></li>
<li><a href="../en505704/index.html">Work on a remote control - a well-forgotten old</a></li>
<li><a href="../en505706/index.html">FOSS News No. 19 - a review of free and open source news for June 1-7, 2020</a></li>
<li><a href="../en505710/index.html">WebSockets and Spring WebFlux</a></li>
<li><a href="../en505720/index.html">Spring Boot + Apache Kafka and SSL in the Docker container</a></li>
<li><a href="../en505724/index.html">Russian fair use: where is the copyright border?</a></li>
<li><a href="../en505736/index.html">Run, PHPUnit, run: how I optimized test execution time</a></li>
<li><a href="../en505738/index.html">A bit about periodograms of time series</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>