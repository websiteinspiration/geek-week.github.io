<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏻‍🍳 🌍 🤶 PVS-Studioがクラウドに移行：Azure DevOps ⛹🏿 🅿️ 💆🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="これは、クラウドCIシステムでのPVS-Studio静的アナライザーの使用に関する2番目の記事です。今回は、Azure DevOpsプラットフォーム（MicrosoftのクラウドCI \ CDソリューション）について検討します。今回の分析プロジェクトとして、ShareXを検討してください。
 
 3...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>PVS-Studioがクラウドに移行：Azure DevOps</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/467359/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b53/5ba/6e6/b535ba6e6cf6250ad0c89d5315918d38.png" alt="写真9"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、クラウドCIシステムでのPVS-Studio静的アナライザーの使用に関する2番目の記事です。今回は、Azure DevOpsプラットフォーム（MicrosoftのクラウドCI \ CDソリューション）について検討します。</font><font style="vertical-align: inherit;">今回の分析プロジェクトとして、ShareXを検討してください。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3つのコンポーネントが必要です。 1つはPVS-Studio静的アナライザーです。 2つ目はAzure DevOpsで、アナライザーを統合します。 3番目は、クラウドで作業するときにPVS-Studioの機能を示すために確認するプロジェクトです。それでは始めましょう。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、エラーやセキュリティの欠陥を検索するための静的コードアナライザーです。 C、C ++、C＃、およびJavaでコード分析を実行します。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Azure DevOps</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。 Azure DevOpsプラットフォームには、Azure Pipeline、Azure Board、Azure Artifactsなどのツールが含まれており、ソフトウェアの作成プロセスを加速して品質を向上させます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ShareXは、画面の任意の部分をキャプチャして記録できる無料のアプリケーションです。</font><font style="vertical-align: inherit;">プロジェクトはC＃で記述されており、静的アナライザーの実行方法を示すのに最適です。</font><font style="vertical-align: inherit;">プロジェクトのソースコード</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はGitHubで入手できます</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ShareXプロジェクトのclocコマンドの出力：</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">言語</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイル</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブランク</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コメント</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コード</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C＃</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">696</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20658</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24423</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">102565</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MSBuildスクリプト</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">十一</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">77</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5859</font></font><br>
</td>
</tr>
</tbody></table></div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">つまり、プロジェクトは小規模ですが、クラウドプラットフォームと組み合わせたPVS-Studioの動作を示すのに十分です。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セットアップしましょう</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Azure DevOpsを開始するには、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リンク</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をクリックし、[GitHubで無料で開始]ボタンをクリックします。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0dc/3d3/8d0/0dc3d38d0375af0a89db1b7be1b4f284.png" alt="写真2"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MicrosoftアプリケーションにGitHubアカウントのデータへのアクセスを許可します。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b38/543/12b/b3854312bb046df2c1dd50d2025a0b25.png" alt="写真1"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
登録を完了するには、Microsoftアカウントを作成する必要があります。 </font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8f5/7a9/878/8f57a9878354a257a8ca68261b5b472a.png" alt="写真12"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
登録後、プロジェクトを作成します。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e69/a61/59a/e69a6159ac5c51089e075c37fc5e2465.png" alt="写真5"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、「パイプライン」-「ビルド」セクションに移動して、新しいビルドパイプラインを作成する必要があります</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2fa/4d2/751/2fa4d27513aaf869962e11b9ea37214b.png" alt="写真8"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちのコードがどこにあるかという質問に答えます-GitHub。 </font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a80/787/363/a80787363d8b260b9aac0ac64c66aeaf.png" alt="写真13"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Azure Pipelinesアプリケーションを承認し、静的アナライザーの起動を構成するプロジェクトを含むリポジトリを選択します</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1c1/df6/47e/1c1df647e46b8445c43b9cf39968d7ed.png" alt="写真7"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テンプレート選択ウィンドウで、「スターターパイプライン」を選択します。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8ac/11d/09f/8ac11d09f180433fe9e14a6279f2a059.png" alt="写真17"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロジェクトコードの静的分析は、2つの方法で実行できます。Microsoftがホストするエージェントまたは自己がホストするエージェントを使用します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初のバージョンでは、マイクロソフトがホストするエージェントを使用します。このようなエージェントは、パイプラインの開始時に開始され、タスクの終了後に削除される通常の仮想マシンです。このようなエージェントを使用すると、エージェントのサポートと更新に時間を浪費することがなくなりますが、プロジェクトのビルドに使用される追加のソフトウェアをインストールできないなど、いくつかの制限が課されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Microsoftがホストするエージェントを使用するには、デフォルトの構成を次のように置き換えます。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-meta">#   </span>
<span class="hljs-meta">#      master-</span><font></font>
trigger:<font></font>
- master<font></font>
<font></font>
<span class="hljs-meta">#         </span>
<span class="hljs-meta"># ,   Docker-,</span>
<span class="hljs-meta">#      Windows Server 1803</span><font></font>
pool:<font></font>
  vmImage: <span class="hljs-string">'win1803'</span>
container: microsoft/dotnet-framework:<span class="hljs-number">4.7</span><span class="hljs-number">.2</span>-sdk-windowsservercore<span class="hljs-number">-1803</span><font></font>
           <font></font>
steps:<font></font>
<span class="hljs-meta">#   </span>
- task: PowerShell@<span class="hljs-number">2</span><font></font>
  inputs:<font></font>
    targetType: <span class="hljs-string">'inline'</span>
    script: <span class="hljs-string">'Invoke-WebRequest 
               -Uri https://files.viva64.com/PVS-Studio_setup.exe 
               -OutFile PVS-Studio_setup.exe'</span>
- task: CmdLine@<span class="hljs-number">2</span><font></font>
  inputs:<font></font>
    workingDirectory: $(System.DefaultWorkingDirectory)<font></font>
    script: |<font></font>
<span class="hljs-meta">#     </span><font></font>
      nuget restore .\ShareX.sln<font></font>
<span class="hljs-meta">#  ,       </span><font></font>
      md .\PVSTestResults<font></font>
<span class="hljs-meta">#  </span><font></font>
      PVS-Studio_setup.exe /VERYSILENT /SUPPRESSMSGBOXES <font></font>
                     /NORESTART /COMPONENTS=Core<font></font>
<span class="hljs-meta">#       </span>
      <span class="hljs-string">"C:\Program Files (x86)\PVS-Studio\PVS-Studio_Cmd.exe"</span> <font></font>
          credentials <font></font>
    -u $(PVS_USERNAME) <font></font>
    -n $(PVS_KEY)<font></font>
<font></font>
<span class="hljs-meta">#        html. </span>
      <span class="hljs-string">"C:\Program Files (x86)\PVS-Studio\PVS-Studio_Cmd.exe"</span> <font></font>
         -t .\ShareX.sln  <font></font>
         -o .\PVSTestResults\ShareX.plog<font></font>
      <span class="hljs-string">"C:\Program Files (x86)\PVS-Studio\PlogConverter.exe"</span> <font></font>
         -t html <font></font>
         -o .\PVSTestResults\ <font></font>
         .\PVSTestResults\ShareX.plog<font></font>
    <font></font>
<span class="hljs-meta">#   </span>
- task: PublishBuildArtifacts@<span class="hljs-number">1</span><font></font>
  inputs:<font></font>
    pathToPublish: PVSTestResults<font></font>
    artifactName: PVSTestResults<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：</font></font></b><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメント</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">よると、</font><font style="vertical-align: inherit;">使用するコンテナは仮想マシンのイメージにキャッシュする必要がありますが、この記事の執筆時点では機能せず、タスクが開始するたびにコンテナがダウンロードされるため、実行時間に悪影響を及ぼします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パイプラインを保存し、ライセンスファイルの作成に使用される変数を作成します。これを行うには、パイプライン編集ウィンドウを開き、右上隅にある[変数]ボタンをクリックします。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/be8/bc0/e1c/be8bc0e1c3555c6375eac94465d27b9d.png" alt="写真14"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2つの変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-PVS_USERNAME</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS_KEY</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を追加し</font><font style="vertical-align: inherit;">ます。これらには、それぞれユーザー名とライセンスキーが含まれています。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS_KEY</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数を作成するとき</font><font style="vertical-align: inherit;">は、「この値を秘密にする」項目をチェックして、変数値を2048ビットのRSA鍵で暗号化し、変数の値がタスク実行ログに出力されないようにすることを忘れないでください。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/996/1e3/35e/9961e335e18b368820d930f14f01d796.png" alt="写真15"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変数を保存し、「実行」ボタンでパイプラインを開始します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分析を実行する2番目のオプションは、自己ホストエージェントを使用することです。セルフホストエージェントは、私たちが自分で構成および管理するエージェントです。このようなエージェントは、ソフトウェアをインストールする機会を提供します。これは、ソフトウェア製品の組み立てとテストに必要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このようなエージェントを使用する前に、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指示</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に従ってエージェントを構成</font><font style="vertical-align: inherit;">し、</font><font style="vertical-align: inherit;">静的アナライザーを</font><font style="vertical-align: inherit;">インストールして</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">構成する</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要が</font><font style="vertical-align: inherit;">あり</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
セルフホストエージェントでタスクを開始するために、提案されたデフォルト構成を次のように置き換えます。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-meta">#   </span>
<span class="hljs-meta">#    master-</span><font></font>
trigger:<font></font>
- master<font></font>
<font></font>
<span class="hljs-meta">#    self-hosted    'MyPool' </span>
pool: <span class="hljs-string">'MyPool'</span><font></font>
<font></font>
steps:<font></font>
- task: CmdLine@<span class="hljs-number">2</span><font></font>
  inputs:<font></font>
    workingDirectory: $(System.DefaultWorkingDirectory)<font></font>
    script: |<font></font>
<span class="hljs-meta">#     </span><font></font>
      nuget restore .\ShareX.sln<font></font>
<span class="hljs-meta">#  ,       </span><font></font>
      md .\PVSTestResults<font></font>
<span class="hljs-meta">#        html. </span>
      <span class="hljs-string">"C:\Program Files (x86)\PVS-Studio\PVS-Studio_Cmd.exe"</span> <font></font>
         -t .\ShareX.sln<font></font>
         -o .\PVSTestResults\ShareX.plog<font></font>
      <span class="hljs-string">"C:\Program Files (x86)\PVS-Studio\PlogConverter.exe"</span><font></font>
         -t html<font></font>
         -o .\PVSTestResults\<font></font>
         .\PVSTestResults\ShareX.plog<font></font>
<span class="hljs-meta">#   </span>
- task: PublishBuildArtifacts@<span class="hljs-number">1</span><font></font>
  inputs:<font></font>
    pathToPublish: PVSTestResults<font></font>
    artifactName: PVSTestResults</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
タスクが完了したら、アナライザーレポートを含むアーカイブを[概要]タブからダウンロードできます。または、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メール送信</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拡張機能</font><font style="vertical-align: inherit;">を使用して、電子メールの送信を構成したり、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Marketplaceで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">便利なツールを探したりできます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/529/df2/932/529df29320ae9e253462e42fe2bfd596.png" alt="画像21"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析結果について</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
チェックされたプロジェクト-ShareXで見つかったエラーのいくつかを見てみましょう。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">冗長チェック</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ウォームアップするために、コードの単純な欠陥から始めましょう。つまり、冗長チェックです。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">PbThumbnail_MouseMove</span>(<span class="hljs-params"><span class="hljs-keyword">object</span> sender, MouseEventArgs e</span>)</span><font></font>
{<font></font>
  ....<font></font>
  IDataObject dataObject <font></font>
    = <span class="hljs-keyword">new</span> DataObject(DataFormats.FileDrop,
                     <span class="hljs-keyword">new</span> <span class="hljs-keyword">string</span>[] { Task.Info.FilePath });<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (dataObject != <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    Program.MainForm.AllowDrop = <span class="hljs-literal">false</span>;<font></font>
    dragBoxFromMouseDown = Rectangle.Empty;<font></font>
    pbThumbnail.DoDragDrop(dataObject, <font></font>
        DragDropEffects.Copy | DragDropEffects.Move);<font></font>
    Program.MainForm.AllowDrop = <span class="hljs-literal">true</span>;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio </font></font></b><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">V3022</font></a><font style="vertical-align: inherit;"> [CWE-571]式 'dataObject！= Null'は常にtrueです。 TaskThumbnailPanel.cs 415 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dataObject</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nullの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チェックに注意してみましょう</font><font style="vertical-align: inherit;">。彼女は何のためにここにいるの？</font><font style="vertical-align: inherit;">この場合、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dataObject</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は作成されたオブジェクトへの参照で初期化されるため、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">することはできません</font><font style="vertical-align: inherit;">。その結果、冗長な検証があります。それは重要ですか？番号。簡潔に見えますか？番号。このチェックは、コードを散らかさないようにするために、明らかにより適切に削除されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同様のコメントを作成できる別のコードを見てみましょう。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Image <span class="hljs-title">GetDIBImage</span>(<span class="hljs-params">MemoryStream ms</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">try</span><font></font>
  {<font></font>
    ....<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Bitmap(bmp);<font></font>
    ....<font></font>
  }<font></font>
  <span class="hljs-keyword">finally</span><font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (gcHandle != IntPtr.Zero)<font></font>
    {<font></font>
      GCHandle.FromIntPtr(gcHandle).Free();<font></font>
    }<font></font>
  }<font></font>
  ....<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Image <span class="hljs-title">GetImageAlternative</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">using</span> (MemoryStream ms = dataObject.GetData(format) <span class="hljs-keyword">as</span> MemoryStream)<font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (ms != <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
      <span class="hljs-keyword">try</span><font></font>
      {<font></font>
        Image img = GetDIBImage(ms);<font></font>
        <span class="hljs-keyword">if</span> (img != <span class="hljs-literal">null</span>)<font></font>
        {<font></font>
          <span class="hljs-keyword">return</span> img;<font></font>
        }<font></font>
      }<font></font>
      <span class="hljs-keyword">catch</span> (Exception e)<font></font>
      {<font></font>
        DebugHelper.WriteException(e);<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio </font></font></b><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">V3022</font></a><font style="vertical-align: inherit;"> [CWE-571]式 'img！= Null'は常にtrueです。 ClipboardHelpers.cs 289 </font><i><font style="vertical-align: inherit;">GetImageAlternative</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
メソッド</font><font style="vertical-align: inherit;">は、</font><i><font style="vertical-align: inherit;">Bitmap</font></i><font style="vertical-align: inherit;">クラスの新しいインスタンスを作成した直後に</font><font style="vertical-align: inherit;">、</font><i><font style="vertical-align: inherit;">img</font></i><font style="vertical-align: inherit;">変数が</font><i><font style="vertical-align: inherit;">null</font></i><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">ない</font><font style="vertical-align: inherit;">ことを再度チェックし</font><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。ここでの前の例との違いは、</font><i><font style="vertical-align: inherit;">img</font></i><font style="vertical-align: inherit;">変数</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">初期化</font><font style="vertical-align: inherit;">するために、コンストラクタではなく</font><i><font style="vertical-align: inherit;">GetDIBImage</font></i><font style="vertical-align: inherit;">メソッドを使用すること</font><font style="vertical-align: inherit;">です。コードの作成者は、このメソッドで例外が発生する可能性があると想定していますが、</font><i><font style="vertical-align: inherit;">try</font></i><font style="vertical-align: inherit;">と</font><i><font style="vertical-align: inherit;">finalの</font></i><font style="vertical-align: inherit;">ブロックのみを宣言し</font><font style="vertical-align: inherit;">、</font><i><font style="vertical-align: inherit;">catchを</font></i><font style="vertical-align: inherit;">省略しています</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。例外が発生した場合そのため、呼び出す方法</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font></i> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetImageAlternativeは</font></font></i> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">型のオブジェクトへの参照受信しません</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビットマップを、</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それ自身で例外を処理することを余儀なくされる</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">catchブロック</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。この場合、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">img</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数</font><font style="vertical-align: inherit;">は初期化されず、実行のスレッドはチェック</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">img！= Null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">も到達しませんが、</font><font style="vertical-align: inherit;">すぐに</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">catchブロック</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に分類され</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。したがって、アナライザーは冗長な検証を示しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コード</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用した次の警告例を考えてみます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">btnCopyLink_Click</span>(<span class="hljs-params"><span class="hljs-keyword">object</span> sender, EventArgs e</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (lvClipboardFormats.SelectedItems.Count == <span class="hljs-number">0</span>)<font></font>
  {<font></font>
    url = lvClipboardFormats.Items[<span class="hljs-number">0</span>].SubItems[<span class="hljs-number">1</span>].Text;<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (lvClipboardFormats.SelectedItems.Count &gt; <span class="hljs-number">0</span>)<font></font>
  {<font></font>
    url = lvClipboardFormats.SelectedItems[<span class="hljs-number">0</span>].SubItems[<span class="hljs-number">1</span>].Text;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [CWE-571]式 'lvClipboardFormats.SelectedItems.Count&gt; 0'は常にtrueです。 AfterUploadForm.cs 155 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目の条件式を見てみましょう。そこで、</font><font style="vertical-align: inherit;">読み取り専用の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Count</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロパティの値を確認します</font><font style="vertical-align: inherit;">。このプロパティは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SelectedItems</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コレクションのインスタンス内の要素の数を示します</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Count</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロパティが</font><font style="vertical-align: inherit;">ゼロより大きい</font><font style="vertical-align: inherit;">場合にのみ、条件が満たされ</font><font style="vertical-align: inherit;">ます。すべてうまく</font><font style="vertical-align: inherit;">いきます</font><font style="vertical-align: inherit;">が</font><font style="vertical-align: inherit;">、</font><i><font style="vertical-align: inherit;">Count</font></i><font style="vertical-align: inherit;">が</font><font style="vertical-align: inherit;">既にチェックさ</font><font style="vertical-align: inherit;">れているのは外部の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ifステートメント</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">だけ</font><font style="vertical-align: inherit;">です。</font><i><font style="vertical-align: inherit;">SelectedItems</font></i><font style="vertical-align: inherit;">コレクションのインスタンスは、</font><font style="vertical-align: inherit;">ゼロ未満の要素数を持つことはできません。したがって、</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カウント</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はゼロまたはゼロより大きい値を取ります。</font><i><font style="vertical-align: inherit;">Count</font></i><font style="vertical-align: inherit;">がゼロ</font><font style="vertical-align: inherit;">であるという最初の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ifステートメント</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">チェックを既に実行してい</font><font style="vertical-align: inherit;">て、結果がfalseであることが判明したため、</font><i><font style="vertical-align: inherit;">Countが</font></i><font style="vertical-align: inherit;">ゼロより大きい</font><font style="vertical-align: inherit;">elseブランチで別のチェックを書き込んでも意味がありません</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">
エラー番号</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">V3022</font></a><font style="vertical-align: inherit;">の最後の例</font><font style="vertical-align: inherit;">は、次のコードフラグメントです。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DrawCursorGraphics</span>(<span class="hljs-params">Graphics g</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">int</span> cursorOffsetX = <span class="hljs-number">10</span>, cursorOffsetY = <span class="hljs-number">10</span>, itemGap = <span class="hljs-number">10</span>, itemCount = <span class="hljs-number">0</span>;<font></font>
  Size totalSize = Size.Empty;<font></font>
<font></font>
  <span class="hljs-keyword">int</span> magnifierPosition = <span class="hljs-number">0</span>;<font></font>
  Bitmap magnifier = <span class="hljs-literal">null</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (Options.ShowMagnifier)<font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (itemCount &gt; <span class="hljs-number">0</span>) totalSize.Height += itemGap;<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">式 'itemCount&gt; 0'は常にfalseです。 RegionCaptureForm.cs1100。</font><font style="vertical-align: inherit;">少し高い宣言が実行され、同時に</font><i><font style="vertical-align: inherit;">itemCount</font></i><font style="vertical-align: inherit;">変数が</font><font style="vertical-align: inherit;">ゼロ</font><font style="vertical-align: inherit;">に</font><i><font style="vertical-align: inherit;">設定される</font></i><font style="vertical-align: inherit;">ため、</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザーは、条件</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itemCount&gt; 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が常にfalseになる</font><font style="vertical-align: inherit;">ことに気付き</font><font style="vertical-align: inherit;">ました</font><font style="vertical-align: inherit;">。まさにその条件まで、この変数はどこでも使用されず、変更されません。したがって、アナライザーは条件式について正しい結論を出しました。その値は常にfalseです。</font><font style="vertical-align: inherit;">
さて、ここで本当に面白いものを見てみましょう。</font><b><font style="vertical-align: inherit;">バグを理解するための最良の方法は、バグを視覚化することです。</font></b><font style="vertical-align: inherit;"> 
ここでは、かなり興味深いエラーが見つかりました。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Pixelate</span>(<span class="hljs-params">Bitmap bmp, <span class="hljs-keyword">int</span> pixelSize</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">float</span> r = <span class="hljs-number">0</span>, g = <span class="hljs-number">0</span>, b = <span class="hljs-number">0</span>, a = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">float</span> weightedCount = <span class="hljs-number">0</span>;<font></font>
<font></font>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> y2 = y; y2 &lt; yLimit; y2++)<font></font>
  {<font></font>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> x2 = x; x2 &lt; xLimit; x2++)<font></font>
    {<font></font>
      ColorBgra color = unsafeBitmap.GetPixel(x2, y2);<font></font>
<font></font>
      <span class="hljs-keyword">float</span> pixelWeight = color.Alpha / <span class="hljs-number">255</span>;<font></font>
<font></font>
      r += color.Red * pixelWeight;<font></font>
      g += color.Green * pixelWeight;<font></font>
      b += color.Blue * pixelWeight;<font></font>
      a += color.Alpha * pixelWeight;<font></font>
<font></font>
      weightedCount += pixelWeight;<font></font>
    }<font></font>
  }<font></font>
  ....<font></font>
  ColorBgra averageColor = <span class="hljs-keyword">new</span> ColorBgra((<span class="hljs-keyword">byte</span>)(b / weightedCount),<font></font>
    (<span class="hljs-keyword">byte</span>)(g / weightedCount), (<span class="hljs-keyword">byte</span>)(r / weightedCount),<font></font>
    (<span class="hljs-keyword">byte</span>)(a / pixelCount));<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのカードをすぐに明らかにして、アナライザーがここで見つけたものを表示したくないので、この瞬間を少し延期しましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メソッドの名前から、それが何をするかを推測するのは簡単です。入力として画像または画像のフラグメントを送信し、ピクセル化を実行します。メソッドコードは非常に長いため、ここでは全体を説明することはしませんが、アルゴリズムを説明し、PVS-Studioがここで見つけたバグの種類を説明してください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このメソッドは、2つのパラメーターを入力として受け取ります。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビットマップ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タイプのオブジェクトと</font><font style="vertical-align: inherit;">ピクセル化のサイズを示す</font><font style="vertical-align: inherit;">タイプ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">intの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値です</font><font style="vertical-align: inherit;">。操作アルゴリズムは非常に単純です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1）入力で受け取った画像の断片を、ピクセレーションのサイズに等しい辺を持つ正方形に分割します。たとえば、ピクセル化サイズが15の場合、15x15 = 225ピクセルを含む正方形になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2）次に、この正方形の各ピクセルを回って、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Red</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Green</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blue</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、および</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alpha</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールドの値</font><font style="vertical-align: inherit;">を中間変数に</font><font style="vertical-align: inherit;">累積し</font><font style="vertical-align: inherit;">、対応するカラー値とアルファチャネル値に</font><font style="vertical-align: inherit;">、</font><i><font style="vertical-align: inherit;">Alpha</font></i><font style="vertical-align: inherit;">値</font><font style="vertical-align: inherit;">を255で</font><font style="vertical-align: inherit;">割って得られる</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pixelWeight</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数を</font><i><font style="vertical-align: inherit;">掛け</font></i><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">（</font><i><font style="vertical-align: inherit;">Alpha</font></i><font style="vertical-align: inherit;">変数</font><font style="vertical-align: inherit;">はタイプ</font><i><font style="vertical-align: inherit;">バイト</font></i><font style="vertical-align: inherit;">）。また、ピクセルをトラバースするとき、記録された値を要約します</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pixelWeightを</font></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">weightedCount</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">という変数</font><i><font style="vertical-align: inherit;">に</font></i><font style="vertical-align: inherit;">入れます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記の手順を実行するコードスニペットは次のとおりです。</font></font><br>
<br>
<pre><code class="cs hljs">ColorBgra color = unsafeBitmap.GetPixel(x2, y2);<font></font>
<font></font>
<span class="hljs-keyword">float</span> pixelWeight = color.Alpha / <span class="hljs-number">255</span>;<font></font>
<font></font>
r += color.Red * pixelWeight;<font></font>
g += color.Green * pixelWeight;<font></font>
b += color.Blue * pixelWeight;<font></font>
a += color.Alpha * pixelWeight;<font></font>
<font></font>
weightedCount += pixelWeight;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ちなみに、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alpha</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数の値が</font><font style="vertical-align: inherit;">ゼロの場合、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pixelWeight</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font><font style="vertical-align: inherit;">このピクセルの</font><font style="vertical-align: inherit;">変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">weightedCountに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値</font><font style="vertical-align: inherit;">を追加しないことに</font><i><font style="vertical-align: inherit;">注意してください</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは将来必要になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3）現在の正方形のすべてのピクセルをバイパスした後、この正方形の全体的な「平均」色を作成できます。</font><font style="vertical-align: inherit;">これらのアクションを実行するコードは次のとおりです。</font></font><br>
<br>
<pre><code class="cs hljs">ColorBgra averageColor = <span class="hljs-keyword">new</span> ColorBgra((<span class="hljs-keyword">byte</span>)(b / weightedCount),<font></font>
    (<span class="hljs-keyword">byte</span>)(g / weightedCount), (<span class="hljs-keyword">byte</span>)(r / weightedCount),<font></font>
    (<span class="hljs-keyword">byte</span>)(a / pixelCount));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4）これで、最終的な色が取得され、変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">averageColorに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記録されたので</font><font style="vertical-align: inherit;">、正方形の各ピクセルを再度移動して、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">averageColorの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値を割り当てることができます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5）未加工の正方形が残っている限り、ステップ2に戻ります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでも、変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">weightedCountが</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">二乗されたすべてのピクセルの数と等しくない</font><font style="vertical-align: inherit;">ことに注意してください</font><font style="vertical-align: inherit;">。たとえば、画像で完全に透明なピクセルが発生する場合（値はアルファチャネル</font><font style="vertical-align: inherit;">でゼロです）、このピクセル</font><font style="vertical-align: inherit;">の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pixelWeight</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数</font><font style="vertical-align: inherit;">はゼロになります（</font><i><font style="vertical-align: inherit;">0/255</font></i><font style="vertical-align: inherit;"> = 0）。したがって、このピクセルは、</font><i><font style="vertical-align: inherit;">weightedCount</font></i><font style="vertical-align: inherit;">変数の値の形成に</font><i><font style="vertical-align: inherit;">影響し</font></i><font style="vertical-align: inherit;">ません。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは論理的です-完全に透明なピクセルの色を考慮することは意味がありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてがかなり合理的です-ピクセレーションは正しく動作するはずです。</font><font style="vertical-align: inherit;">そして、それは本当に正しく機能します。</font><font style="vertical-align: inherit;">これは、アルファチャネルの値が255未満でゼロに等しくないピクセルを含むpng画像には当てはまりません。</font><font style="vertical-align: inherit;">以下のピクセル化された画像に注意してください。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/460/17b/7b5/46017b7b58a5206d0a51620fcce1a16f.png" alt="写真3"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ピクセレーションを見ましたか？</font><font style="vertical-align: inherit;">そして、私たちはそうではありません。</font><font style="vertical-align: inherit;">では、この小さな陰謀を明らかにし、このメソッドのどこにバグが隠されているのかを説明しましょう。</font><font style="vertical-align: inherit;">エラーは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pixelWeight</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数の値を計算するためのラインに侵入しました</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">float</span> pixelWeight = color.Alpha / <span class="hljs-number">255</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際のところ、コードの作成者は、変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pixelWeight</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">floatの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">型</font><i><font style="vertical-align: inherit;">として</font></i><font style="vertical-align: inherit;">宣言しているため</font><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alpha</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールド</font><font style="vertical-align: inherit;">を255で除算すると、0と1に加えて、小数も取得する必要があることを</font><font style="vertical-align: inherit;">暗示していました</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alpha</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数</font><font style="vertical-align: inherit;">の型が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">byte</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">であり、これを255で除算すると整数値が得られる</font><font style="vertical-align: inherit;">ので、ここに問題があり</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。その場合のみ、暗黙的に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">float</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">キャストされ</font><font style="vertical-align: inherit;">、小数部分が失われます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ある程度の透明度を持つPNG画像をピクセル化できないことは簡単に説明できます。これらのピクセルのアルファチャネル値は0 &lt;Alpha &lt;255の範囲にあるため、</font><i><font style="vertical-align: inherit;">Alpha</font></i><font style="vertical-align: inherit;">変数を除算すると</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数値255の場合、常に0になります。したがって、変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pixelWeight</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">weightedCountの値</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">も常にゼロになります。結果として、我々の平均色</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">averageColorが</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゼロすべてのチャネルにわたって値であろう： - 0、青- 0、緑- 0、アルファ-赤この色の正方形を充填して0ので、我々は、ピクセルの元の色を変更しない</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">averageColorが</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">絶対に透明です。このエラーを修正するには、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alpha</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールド</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">明示的</font><font style="vertical-align: inherit;">に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">float</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> typeに</font><font style="vertical-align: inherit;">キャストする必要があります</font><font style="vertical-align: inherit;">。修正されたコード行は次のようになります。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">float</span> pixelWeight = (<span class="hljs-keyword">float</span>)color.Alpha / <span class="hljs-number">255</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、PVS-Studioが誤ったコードに渡したメッセージを引用します</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">。PVS </font></a></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-Studio </font></font></b><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">V3041</font></a><font style="vertical-align: inherit;"> [CWE-682]式が暗黙的に「int」型から「float」型にキャストされました。</font><font style="vertical-align: inherit;">小数部の損失を回避するために、明示的な型キャストの利用を検討してください。</font><font style="vertical-align: inherit;">例：double A =（double）（X）/ Y;。</font><font style="vertical-align: inherit;">ImageHelpers.cs1119。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして比較のために、アプリケーションの修正バージョンで取得した実際にピクセル化された画像のスクリーンショットを示します。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/977/0bc/e73/9770bce73229e72b6781f0349128aa3e.png" alt="写真6"></div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">潜在的なNullReferenceException</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">AddMetadata</span>(<span class="hljs-params">Image img, <span class="hljs-keyword">int</span> id, <span class="hljs-keyword">string</span> text</span>)</span><font></font>
{<font></font>
  ....<font></font>
  pi.Value = bytesText;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (pi != <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    img.SetPropertyItem(pi);<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告：</font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [CWE-476] nullに対して検証される前に「pi」オブジェクトが使用されました。チェック行：801、803。ImageHelpers.cs 801 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコードフラグメントは、作成者が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pi</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数</font><font style="vertical-align: inherit;">が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">になる</font><font style="vertical-align: inherit;">可能性があることを</font><font style="vertical-align: inherit;">予期していたことを示して</font><font style="vertical-align: inherit;">い</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">そのため、</font><i><font style="vertical-align: inherit;">SetPropertyItem</font></i><font style="vertical-align: inherit;">メソッドを呼び出す前に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pi！= Null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チェックが実行され</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。このチェックの前に</font><font style="vertical-align: inherit;">、バイトの配列が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pi.Value</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロパティに割り当てられているのは奇妙です。これは</font><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pi</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nullの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">型の例外がスローされるため</font><font style="vertical-align: inherit;">です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
他の場所でも同様の状況が見られました。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Task_TaskCompleted</span>(<span class="hljs-params">WorkerTask task</span>)</span><font></font>
{<font></font>
  ....<font></font>
  task.KeepImage = <span class="hljs-literal">false</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (task != <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (task.RequestSettingUpdate)<font></font>
    {<font></font>
      Program.MainForm.UpdateCheckStates();<font></font>
    }<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告：</font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [CWE-476]「タスク」オブジェクトは、nullであることが確認される前に使用されました。チェック行：268、270。TaskManager.cs 268 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studioが別の同様のエラーを検出しました。意味は同じなので、コードフラグメントを与える必要はあまりありません。アナライザーメッセージに限定します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告：</font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [CWE-476]「Config.PhotobucketAccountInfo」オブジェクトは、nullであることが確認される前に使用されました。チェック行：</font><i><font style="vertical-align: inherit;">216、219。UploadersConfigForm.cs</font></i><font style="vertical-align: inherit;"> 216 </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1つの同じ戻り値</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
疑わしいコードがメソッド</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EvalWindows</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラス</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WindowsList</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">発見され、</font><font style="vertical-align: inherit;">いずれの場合も</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trueに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">戻り</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">WindowsList</span><font></font>
{<font></font>
  <span class="hljs-keyword">public</span> List&lt;IntPtr&gt; IgnoreWindows { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }<font></font>
  ....<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">WindowsList</span>(<span class="hljs-params"></span>)</span><font></font>
  {<font></font>
    IgnoreWindows = <span class="hljs-keyword">new</span> List&lt;IntPtr&gt;();<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">WindowsList</span>(<span class="hljs-params">IntPtr ignoreWindow</span>) : <span class="hljs-title">this</span>(<span class="hljs-params"></span>)</span><font></font>
  {<font></font>
    IgnoreWindows.Add(ignoreWindow);<font></font>
  }<font></font>
  ....<font></font>
  <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">EvalWindows</span>(<span class="hljs-params">IntPtr hWnd, IntPtr lParam</span>)</span><font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (IgnoreWindows.Any(window =&gt; hWnd == window))<font></font>
    {<font></font>
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  <span class="hljs-comment">// &lt;=</span><font></font>
    }<font></font>
<font></font>
    windows.Add(<span class="hljs-keyword">new</span> WindowInfo(hWnd));<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  <span class="hljs-comment">// &lt;=</span><font></font>
  }<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告：</font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3009</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このメソッドが常に1つの同じ値「true」を返すのは奇妙です。 WindowsList.cs 82 </font><i><font style="vertical-align: inherit;">hWnd</font></i><font style="vertical-align: inherit;">と同じ値のポインターが</font><i><font style="vertical-align: inherit;">IgnoreWindows</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
という名前のリストで</font><font style="vertical-align: inherit;">見つかっ</font><font style="vertical-align: inherit;">た</font><font style="vertical-align: inherit;">場合、メソッドは</font><i><font style="vertical-align: inherit;">false</font></i><font style="vertical-align: inherit;">を返すはず</font><font style="vertical-align: inherit;">です。</font><i><font style="vertical-align: inherit;">IgnoreWindows</font></i><font style="vertical-align: inherit;"> 
リスト</font><font style="vertical-align: inherit;">は、</font><i><font style="vertical-align: inherit;">WindowsList</font></i><font style="vertical-align: inherit;">コンストラクター</font><i><font style="vertical-align: inherit;">（IntPtr ignoreWindow）を</font></i><font style="vertical-align: inherit;">呼び出すか、</font><i><font style="vertical-align: inherit;">パブリックである</font></i><font style="vertical-align: inherit;">ため、プロパティへのアクセスを介して直接入力できます。 Visual Studioによると、現時点では、このリストはコードに入力されていません。これは、このメソッドの別の奇妙な場所です。</font><b><font style="vertical-align: inherit;">イベントハンドラへの安全でない呼び出し</font></b></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnNewsLoaded</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (NewsLoaded != <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    NewsLoaded(<span class="hljs-keyword">this</span>, EventArgs.Empty);<font></font>
  }<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告：</font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3083</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [CWE-367]イベント 'NewsLoaded'の安全でない呼び出し、NullReferenceExceptionが発生する可能性があります。イベントを呼び出す前に、ローカル変数にイベントを割り当てることを検討してください。 NewsListControl.cs 111 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場合、次の不愉快な状況が</font><font style="vertical-align: inherit;">発生する</font><font style="vertical-align: inherit;">可能性</font><font style="vertical-align: inherit;">があり</font><font style="vertical-align: inherit;">ます</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。NewsLoaded</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数</font><font style="vertical-align: inherit;">の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不等式を</font><font style="vertical-align: inherit;">確認した後</font><font style="vertical-align: inherit;">、イベントを処理するメソッドを、たとえば別のスレッドでサブスク</font><i><font style="vertical-align: inherit;">ライブ</font></i><font style="vertical-align: inherit;">解除し、条件付き</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ifステートメントの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本文に入ると</font><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsLoaded</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数</font><i><font style="vertical-align: inherit;">は</font></i><font style="vertical-align: inherit;">すでに</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nullに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なり</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font><i><font style="vertical-align: inherit;">nullの</font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsLoaded</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">イベント</font><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">サブスクライバーを呼び出そうとし</font><font style="vertical-align: inherit;">てい</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をスローし</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">null条件演算子を使用して上記のコードを次のように書き直す方がはるかに安全です。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnNewsLoaded</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  NewsLoaded?.Invoke(<span class="hljs-keyword">this</span>, EventArgs.Empty);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザーは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">68の</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">より</font><font style="vertical-align: inherit;">類似した場所を</font><font style="vertical-align: inherit;">示しました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ここではそれらについては説明しません-それらのイベント呼び出しのパターンは似ています。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToStringからnullを返す</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
少し前のことですが、</font><font style="vertical-align: inherit;">同僚の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">興味深い記事</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">から、オーバーライドされた</font><i><font style="vertical-align: inherit;">ToString</font></i><font style="vertical-align: inherit;">メソッドから</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">返すことはマイクロソフトが推奨していないことがわかりました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">PVS-Studioはこれをよく認識しています。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">string</span> <span class="hljs-title">ToString</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">lock</span> (loggerLock)<font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (sbMessages != <span class="hljs-literal">null</span> &amp;&amp; sbMessages.Length &gt; <span class="hljs-number">0</span>)<font></font>
    {<font></font>
      <span class="hljs-keyword">return</span> sbMessages.ToString();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
   }<font></font>
 }</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告：</font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3108</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「ToSting（）」メソッドから「null」を返すことはお勧めしません。 Logger.cs 167 </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用しない場合に割り当てる理由</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> SeafileCheckAccInfoResponse <span class="hljs-title">GetAccountInfo</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">string</span> url = URLHelpers.FixPrefix(APIURL);<font></font>
  url = URLHelpers.CombineURL(APIURL, <span class="hljs-string">"account/info/?format=json"</span>);<font></font>
....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告：</font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3008</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「url」変数には、2回続けて値が割り当てられます。</font><font style="vertical-align: inherit;">おそらくこれは間違いです。</font><font style="vertical-align: inherit;">チェック行：197、196。Seafile.cs 197 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例からわかるように、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">url</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数を宣言すると</font><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FixPrefix</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドから返された値が割り当てられます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">次の行では、どこでも使用せずに、結果の値を「研磨」します。</font><font style="vertical-align: inherit;">「デッドコード」に似たものが得られます-それは機能しますが、最終結果には影響しません。</font><font style="vertical-align: inherit;">同様のコードフラグメントがさらに9つのメソッドで見つかるので、このエラーはおそらくコピーペーストの結果です。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例として、最初の行が似ている2つのメソッドを示します。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">CheckAuthToken</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">string</span> url = URLHelpers.FixPrefix(APIURL);<font></font>
  url = URLHelpers.CombineURL(APIURL, <span class="hljs-string">"auth/ping/?format=json"</span>);<font></font>
  ....<font></font>
}<font></font>
....<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">CheckAPIURL</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">string</span> url = URLHelpers.FixPrefix(APIURL);<font></font>
  url = URLHelpers.CombineURL(APIURL, <span class="hljs-string">"ping/?format=json"</span>);<font></font>
  ....<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">合計</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のように、アナライザーによる自動チェックの設定の複雑さは、選択したCIシステムに依存しません。わずか15分でマウスを数回クリックするだけで、静的アナライザーによるプロジェクトコードの検証を設定します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結論として、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アナライザー</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ダウンロード</font></a><font style="vertical-align: inherit;">してプロジェクトで</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">試す</font></a><font style="vertical-align: inherit;">ことをお勧めします</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/c78/30f/70c/c7830f70c5577c3d6704f254d7cad6a3.png" align="left"></a></p><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事を英語を話す視聴者と共有したい場合は、翻訳へのリンクを使用してください：Oleg Andreev、Ilya Gainulin。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio in the Clouds：Azure DevOps</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja467345/index.html">ITブログと4層のトレーニングにアクセス：MosigraのSergey Abdulmanovへのインタビュー</a></li>
<li><a href="../ja467347/index.html">ブック「Creating Solidity smart contracts for the Ethereum blockchain。実用ガイド</a></li>
<li><a href="../ja467349/index.html">プログラマーをエストニアに移す：仕事、お金、生活費</a></li>
<li><a href="../ja467353/index.html">Reddのコード最適化メソッド。パート1：キャッシュ効果</a></li>
<li><a href="../ja467355/index.html">中央および東ヨーロッパの市場調査員およびソフトウェア開発動向のインタビュー、Eugene Schwab-Chesaru</a></li>
<li><a href="../ja467361/index.html">JavaScriptでの委任について忘れていました。反応中のイベント委任</a></li>
<li><a href="../ja467363/index.html">Kerasでカスタム損失関数と学習品質メトリックを使用する</a></li>
<li><a href="../ja467365/index.html">住宅用電圧監視リレー</a></li>
<li><a href="../ja467369/index.html">RubyRussia2019。MikhailPronyakin：Rubyは安全ですか？</a></li>
<li><a href="../ja467371/index.html">Google就職の面接解析：関係を見つける</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>