<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😁 🐐 👃 ﻿CとC ++で足元に自分を撃つ方法。Haiku OSレシピコレクション 🤳🏼 👩🏼‍✈️ 👩🏾‍🏭</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="PVS-Studio静的アナライザーとHaikuオペレーティングシステムのコードとの出会いの物語は2015年にさかのぼります。これは興味深い実験であり、両方のプロジェクトのチームにとって有益な経験でした。なぜ実験なのか？Linux用のアナライザーはありませんでしたし、もう1年半はありません。しかし、...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>﻿CとC ++で足元に自分を撃つ方法。Haiku OSレシピコレクション</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/461255/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio静的アナライザーとHaikuオペレーティングシステムのコードとの出会いの物語は2015年にさかのぼります。</font><font style="vertical-align: inherit;">これは興味深い実験であり、両方のプロジェクトのチームにとって有益な経験でした。</font><font style="vertical-align: inherit;">なぜ実験なのか？</font><font style="vertical-align: inherit;">Linux用のアナライザーはありませんでしたし、もう1年半はありません。</font><font style="vertical-align: inherit;">しかし、私たちのチームの愛好家の仕事は報われました：私たちはHaiku開発者と会い、コードの品質を改善し、データベースにまれなプログラマーエラーを補充し、アナライザーを改良しました。</font><font style="vertical-align: inherit;">Haikuのコードにエラーがないかどうかを確認するのが迅速かつ簡単になりました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3a8/3b6/925/3a83b6925fff10cf8924920b96996e8d.png" alt="写真3"></div><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前書き</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちの歴史のヒーローは、</font><font style="vertical-align: inherit;">オープンソースの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Haiku</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オペレーティングシステム</font><font style="vertical-align: inherit;">と、</font><font style="vertical-align: inherit;">C、C ++、C＃およびJava用の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">静的アナライザー</font><font style="vertical-align: inherit;">です。 4.5年前にプロジェクトの分析を開始したときは、コンパイルされたアナライザーの実行可能ファイルを使用するだけで済みました。コンパイルパラメータの解析、プリプロセッサの起動、分析の並列化などのインフラストラクチャ全体。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">コンパイラ監視UI</font></a><font style="vertical-align: inherit;">ユーティリティから取得された</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linuxで実行するためにMonoプラットフォームに部分的に移植されたC＃で。</font><font style="vertical-align: inherit;">Haikuプロジェクト自体は、Windows以外のさまざまなオペレーティングシステムでクロスコンパイラを使用してアセンブルされます。</font><font style="vertical-align: inherit;">繰り返しになりますが、私はHaikuアセンブリドキュメントの利便性と完全性に注目したいと思います。また、プロジェクトの構築にご協力いただいたHaiku開発者にも感謝します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分析がはるかに簡単になりました。</font><font style="vertical-align: inherit;">プロジェクトをビルドおよび分析するためのすべてのコマンドのリストは、次のようになります。</font></font><br>
<br>
<pre><code class="cpp hljs">cd /opt<font></font>
git clone https:<span class="hljs-comment">//review.haiku-os.org/buildtools</span>
git clone https:<span class="hljs-comment">//review.haiku-os.org/haiku</span><font></font>
cd ./haiku<font></font>
mkdir generated.x86_64; cd generated.x86_64<font></font>
../configure --distro-compatibility official -j12 \<font></font>
  --build-cross-tools x86_64 ../../buildtools<font></font>
cd ../../buildtools/jam<font></font>
make all<font></font>
cd /opt/haiku/generated.x86_64<font></font>
pvs-studio-analyzer trace -- /opt/buildtools/jam/bin.linuxx86/jam \<font></font>
  -q -j1 @nightly-anyboot<font></font>
pvs-studio-analyzer analyze -l /mnt/svn/PVS-Studio.lic -r /opt/haiku \<font></font>
   -C x86_64-unknown-haiku-gcc -o /opt/haiku/haiku.<span class="hljs-built_in">log</span> -j12</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ちなみに、プロジェクトの分析はDockerコンテナーで行われました。</font><font style="vertical-align: inherit;">最近、このトピックに関する新しいドキュメントを作成しました：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DockerでのPVS-Studioの実行</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これにより、一部の企業では静的プロジェクト分析手法の使用を大幅に簡略化できます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初期化されていない変数</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V614</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初期化されていない変数 'rval'が使用されています。</font><font style="vertical-align: inherit;">fetch.c 1727</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span>
<span class="hljs-title">auto_fetch</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span>
</span>{
  <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">int</span>  argpos;
  <span class="hljs-keyword">int</span>    rval;                  <span class="hljs-comment">// &lt;=</span>
  argpos = <span class="hljs-number">0</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (sigsetjmp(toplevel, <span class="hljs-number">1</span>)) {
    <span class="hljs-keyword">if</span> (connected)<font></font>
      disconnect(<span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>);
    <span class="hljs-keyword">if</span> (rval &gt; <span class="hljs-number">0</span>)               <span class="hljs-comment">// &lt;=</span>
      rval = argpos + <span class="hljs-number">1</span>;
    <span class="hljs-keyword">return</span> (rval);<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rval</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
変数</font><i><font style="vertical-align: inherit;">は</font></i><font style="vertical-align: inherit;">宣言時に初期化</font><i><font style="vertical-align: inherit;">され</font></i><font style="vertical-align: inherit;">なかったため、null値と比較すると、未定義の結果が生じます。</font><font style="vertical-align: inherit;">一連の失敗した状況では、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rval</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数の未定義の値が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auto_fetch</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数の戻り値になることがあります</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V614</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初期化されていないポインタ 'res'が使用されています。</font><font style="vertical-align: inherit;">コマンド.c 2873</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">addrinfo</span> {</span>
 <span class="hljs-keyword">int</span> ai_flags;
 <span class="hljs-keyword">int</span> ai_family;
 <span class="hljs-keyword">int</span> ai_socktype;
 <span class="hljs-keyword">int</span> ai_protocol;
 <span class="hljs-keyword">socklen_t</span> ai_addrlen;
 <span class="hljs-keyword">char</span> *ai_canonname;
 <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr</span> *<span class="hljs-title">ai_addr</span>;</span>
 <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">addrinfo</span> *<span class="hljs-title">ai_next</span>;</span><font></font>
};<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span>
<span class="hljs-title">sourceroute</span><span class="hljs-params">(struct addrinfo *ai, <span class="hljs-keyword">char</span> *arg, <span class="hljs-keyword">char</span> **cpp,
            <span class="hljs-keyword">int</span> *lenp, <span class="hljs-keyword">int</span> *protop, <span class="hljs-keyword">int</span> *optp)</span>
</span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">char</span> buf[<span class="hljs-number">1024</span> + ALIGNBYTES];
  <span class="hljs-keyword">char</span> *cp, *cp2, *lsrp, *ep;
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr_in</span> *_<span class="hljs-title">sin</span>;</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> INET6</span>
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr_in6</span> *<span class="hljs-title">sin6</span>;</span>
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ip6_rthdr</span> *<span class="hljs-title">rth</span>;</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">addrinfo</span> <span class="hljs-title">hints</span>, *<span class="hljs-title">res</span>;</span>     <span class="hljs-comment">// &lt;=</span>
  <span class="hljs-keyword">int</span> error;
  <span class="hljs-keyword">char</span> c;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (cpp == <span class="hljs-literal">NULL</span> || lenp == <span class="hljs-literal">NULL</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
  <span class="hljs-keyword">if</span> (*cpp != <span class="hljs-literal">NULL</span>) {
    <span class="hljs-keyword">switch</span> (res-&gt;ai_family) {      <span class="hljs-comment">// &lt;=</span>
    <span class="hljs-keyword">case</span> AF_INET:
      <span class="hljs-keyword">if</span> (*lenp &lt; <span class="hljs-number">7</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
      <span class="hljs-keyword">break</span>;<font></font>
      ....<font></font>
    }<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
初期化されていない変数を使用する同様の場合、初期化されていないポインタ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">res</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のみがここにあります</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V506</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ローカル変数「正規化」へのポインタは、この変数のスコープ外に格納されています。</font><font style="vertical-align: inherit;">このようなポインタは無効になります。</font><font style="vertical-align: inherit;">TextView.cpp 5596</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">void</span>
BTextView::_ApplyStyleRange(...., <span class="hljs-keyword">const</span> BFont* font, ....)<font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (font != <span class="hljs-literal">NULL</span>) {<font></font>
    BFont normalized = *font;<font></font>
    _NormalizeFont(&amp;normalized);<font></font>
    font = &amp;normalized;<font></font>
  }<font></font>
  ....<font></font>
  fStyles-&gt;SetStyleRange(fromOffset, toOffset, fText-&gt;Length(), mode,<font></font>
    font, color);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おそらく、プログラマーは中間変数を介してオブジェクトを正規化する必要がありました。</font><font style="vertical-align: inherit;">しかし今、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フォント</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポインター</font><font style="vertical-align: inherit;">で、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正規化された</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一時オブジェクトへのポインターが</font><i><font style="vertical-align: inherit;">保存</font></i><font style="vertical-align: inherit;">されました。これは、この一時オブジェクトが作成されたスコープを離れると破棄されます。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V603</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オブジェクトは作成されましたが、使用されていません。</font><font style="vertical-align: inherit;">コンストラクタを呼び出したい場合は、「this-&gt; BUnicodeChar :: BUnicodeChar（....）」を使用する必要があります。</font><font style="vertical-align: inherit;">UnicodeChar.cpp 27</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">int8
<span class="hljs-title">BUnicodeChar::Type</span><span class="hljs-params">(uint32 c)</span>
</span>{<font></font>
  BUnicodeChar();<font></font>
  <span class="hljs-keyword">return</span> u_charType(c);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C ++プログラマーの間でよくある間違いは、コンストラクター呼び出しを使用してクラスフィールドを初期化またはゼロ化することです。</font><font style="vertical-align: inherit;">この場合、クラスのフィールドは変更されませんが、このクラスの名前のない新しいオブジェクトが作成され、すぐに破棄されます。</font><font style="vertical-align: inherit;">残念ながら、そのような場所はたくさんあります：</font></font><br>
<br>
<ul>
<li>V603 The object was created but it is not being used. If you wish to call constructor, 'this-&gt;BUnicodeChar::BUnicodeChar(....)' should be used. UnicodeChar.cpp 37</li>
<li>V603 The object was created but it is not being used. If you wish to call constructor, 'this-&gt;BUnicodeChar::BUnicodeChar(....)' should be used. UnicodeChar.cpp 49</li>
<li>V603 The object was created but it is not being used. If you wish to call constructor, 'this-&gt;BUnicodeChar::BUnicodeChar(....)' should be used. UnicodeChar.cpp 58</li>
<li>V603 The object was created but it is not being used. If you wish to call constructor, 'this-&gt;BUnicodeChar::BUnicodeChar(....)' should be used. UnicodeChar.cpp 67</li>
<li>V603 The object was created but it is not being used. If you wish to call constructor, 'this-&gt;BUnicodeChar::BUnicodeChar(....)' should be used. UnicodeChar.cpp 77</li>
<li>V603 The object was created but it is not being used. If you wish to call constructor, 'this-&gt;BUnicodeChar::BUnicodeChar(....)' should be used. UnicodeChar.cpp 89</li>
<li>V603 The object was created but it is not being used. If you wish to call constructor, 'this-&gt;BUnicodeChar::BUnicodeChar(....)' should be used. UnicodeChar.cpp 103</li>
<li>V603 The object was created but it is not being used. If you wish to call constructor, 'this-&gt;BUnicodeChar::BUnicodeChar(....)' should be used. UnicodeChar.cpp 115</li>
<li>V603 The object was created but it is not being used. If you wish to call constructor, 'this-&gt;BUnicodeChar::BUnicodeChar(....)' should be used. UnicodeChar.cpp 126</li>
<li>V603 The object was created but it is not being used. If you wish to call constructor, 'this-&gt;BUnicodeChar::BUnicodeChar(....)' should be used. UnicodeChar.cpp 142</li>
<li>V603 The object was created but it is not being used. If you wish to call constructor, 'this-&gt;BUnicodeChar::BUnicodeChar(....)' should be used. UnicodeChar.cpp 152</li>
<li>V603 The object was created but it is not being used. If you wish to call constructor, 'this-&gt;BUnicodeChar::BUnicodeChar(....)' should be used. UnicodeChar.cpp 163</li>
<li>V603 The object was created but it is not being used. If you wish to call constructor, 'this-&gt;BUnicodeChar::BUnicodeChar(....)' should be used. UnicodeChar.cpp 186</li>
<li>V603 The object was created but it is not being used. If you wish to call constructor, 'this-&gt;BUnicodeChar::BUnicodeChar(....)' should be used. UnicodeChar.cpp 196</li>
<li>V603 The object was created but it is not being used. If you wish to call constructor, 'this-&gt;BUnicodeChar::BUnicodeChar(....)' should be used. UnicodeChar.cpp 206</li>
<li>V603 The object was created but it is not being used. If you wish to call constructor, 'this-&gt;BUnicodeChar::BUnicodeChar(....)' should be used. UnicodeChar.cpp 214</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V603オブジェクトは作成されましたが、使用されていません。</font><font style="vertical-align: inherit;">コンストラクタを呼び出したい場合は、「this-&gt; BUnicodeChar :: BUnicodeChar（....）」を使用する必要があります。</font><font style="vertical-align: inherit;">UnicodeChar.cpp 222</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V603オブジェクトは作成されましたが、使用されていません。</font><font style="vertical-align: inherit;">コンストラクタを呼び出したい場合は、「this-&gt; BUnicodeChar :: BUnicodeChar（....）」を使用する必要があります。</font><font style="vertical-align: inherit;">UnicodeChar.cpp 230</font></font></li>
</ul><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V670</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初期化されていないクラスメンバー 'fPatternHandler'は、 'fInternal'メンバーを初期化するために使用されます。</font><font style="vertical-align: inherit;">メンバーは、クラス内の宣言順に初期化されることに注意してください。</font><font style="vertical-align: inherit;">Painter.cpp 184</font></font><br>
<br>
<pre><code class="cpp hljs">Painter::Painter()<font></font>
  :<font></font>
  fInternal(fPatternHandler),<font></font>
  ....<font></font>
  fPatternHandler(),<font></font>
  ....<font></font>
{<font></font>
  ....<font></font>
};<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Painter</span> {</span><font></font>
  ....<font></font>
<span class="hljs-keyword">private</span>:
  <span class="hljs-keyword">mutable</span> PainterAggInterface fInternal; <span class="hljs-comment">// line 336</span><font></font>
<font></font>
  <span class="hljs-keyword">bool</span> fSubpixelPrecise : <span class="hljs-number">1</span>;
  <span class="hljs-keyword">bool</span> fValidClipping : <span class="hljs-number">1</span>;
  <span class="hljs-keyword">bool</span> fDrawingText : <span class="hljs-number">1</span>;
  <span class="hljs-keyword">bool</span> fAttached : <span class="hljs-number">1</span>;
  <span class="hljs-keyword">bool</span> fIdentityTransform : <span class="hljs-number">1</span>;<font></font>
<font></font>
  Transformable fTransform;<font></font>
  <span class="hljs-keyword">float</span> fPenSize;
  <span class="hljs-keyword">const</span> BRegion* fClippingRegion;<font></font>
  drawing_mode fDrawingMode;<font></font>
  source_alpha fAlphaSrcMode;<font></font>
  alpha_function fAlphaFncMode;<font></font>
  cap_mode fLineCapMode;<font></font>
  join_mode fLineJoinMode;<font></font>
  <span class="hljs-keyword">float</span> fMiterLimit;<font></font>
<font></font>
  PatternHandler fPatternHandler;        <span class="hljs-comment">// line 355</span>
  <span class="hljs-keyword">mutable</span> AGGTextRenderer fTextRenderer;<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
正しくない初期化の別の例。</font><font style="vertical-align: inherit;">クラスフィールドは、クラス自体で宣言された順序で初期化されます。</font><font style="vertical-align: inherit;">この例では</font><font style="vertical-align: inherit;">、初期化されていない値</font><i><font style="vertical-align: inherit;">fPatternHandler</font></i><font style="vertical-align: inherit;">を使用して、</font><font style="vertical-align: inherit;">まず</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fInternal</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールドが初期化</font><font style="vertical-align: inherit;">されます</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">疑わしい#define</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V523</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'then'ステートメントは、 'else'ステートメントと同等です。</font><font style="vertical-align: inherit;">subr_gtaskqueue.c 191</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span>  TQ_LOCK(tq)              \
  do {                \
    <span class="hljs-meta-keyword">if</span> ((tq)-&gt;tq_spin)          \
      mtx_lock_spin(&amp;(tq)-&gt;tq_mutex);      \
    <span class="hljs-meta-keyword">else</span>              \
      mtx_lock(&amp;(tq)-&gt;tq_mutex);      \
  } while (0)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span>  TQ_ASSERT_LOCKED(tq)  mtx_assert(&amp;(tq)-&gt;tq_mutex, MA_OWNED)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span>  TQ_UNLOCK(tq)              \
  do {                \
    <span class="hljs-meta-keyword">if</span> ((tq)-&gt;tq_spin)          \
      mtx_unlock_spin(&amp;(tq)-&gt;tq_mutex);    \
    <span class="hljs-meta-keyword">else</span>              \
      mtx_unlock(&amp;(tq)-&gt;tq_mutex);      \
  } while (0)</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span>
<span class="hljs-title">grouptask_block</span><span class="hljs-params">(struct grouptask *grouptask)</span>
</span>{<font></font>
  ....<font></font>
  TQ_LOCK(<span class="hljs-built_in">queue</span>);<font></font>
  gtask-&gt;ta_flags |= TASK_NOENQUEUE;<font></font>
  gtaskqueue_drain_locked(<span class="hljs-built_in">queue</span>, gtask);<font></font>
  TQ_UNLOCK(<span class="hljs-built_in">queue</span>);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードスニペットは、プリプロセッサの結果を確認するまで疑わしく見えません。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span>
<span class="hljs-title">grouptask_block</span><span class="hljs-params">(struct grouptask *grouptask)</span>
</span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">do</span> { <span class="hljs-keyword">if</span> ((<span class="hljs-built_in">queue</span>)-&gt;tq_spin) mtx_lock(&amp;(<span class="hljs-built_in">queue</span>)-&gt;tq_mutex);
       <span class="hljs-keyword">else</span> mtx_lock(&amp;(<span class="hljs-built_in">queue</span>)-&gt;tq_mutex); } <span class="hljs-keyword">while</span> (<span class="hljs-number">0</span>);<font></font>
  gtask-&gt;ta_flags |= <span class="hljs-number">0x4</span>;<font></font>
  gtaskqueue_drain_locked(<span class="hljs-built_in">queue</span>, gtask);
   <span class="hljs-keyword">do</span> { <span class="hljs-keyword">if</span> ((<span class="hljs-built_in">queue</span>)-&gt;tq_spin) mtx_unlock(&amp;(<span class="hljs-built_in">queue</span>)-&gt;tq_mutex);
        <span class="hljs-keyword">else</span> mtx_unlock(&amp;(<span class="hljs-built_in">queue</span>)-&gt;tq_mutex); } <span class="hljs-keyword">while</span> (<span class="hljs-number">0</span>);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザは本当に正しいです- </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">や</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、他</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の支店があり</font><font style="vertical-align: inherit;">、同一。</font><font style="vertical-align: inherit;">しかし、ここでなかった</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mtx_lock_spin</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mtx_unlock_spin</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">機能が</font><i><font style="vertical-align: inherit;">行きますか</font></i><font style="vertical-align: inherit;">？</font><font style="vertical-align: inherit;">マクロ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TQ_LOCK</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TQ_UNLOCK</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、および</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">grouptask_block</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数</font><i><font style="vertical-align: inherit;">が</font></i><font style="vertical-align: inherit;">同じファイルで宣言され、ほぼ並んでいますが、どこかに置換がありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイルの内容を検索する</font><font style="vertical-align: inherit;">と、次の内容の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mutex.h</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のみが見つかりました</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">/* on FreeBSD these are different functions */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> mtx_lock_spin(x)   mtx_lock(x)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> mtx_unlock_spin(x) mtx_unlock(x)</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのような置換が正しいかどうかは、プロジェクト開発者に確認する価値があります。</font><font style="vertical-align: inherit;">私はLinuxでプロジェクトをチェックしましたが、そのような置換は疑わしいものでした。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フリー機能のエラー</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V575</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> NULLポインターが「フリー」関数に渡されます。</font><font style="vertical-align: inherit;">最初の引数を調べます。</font><font style="vertical-align: inherit;">setmime.cpp 727</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">void</span><font></font>
MimeType::_PurgeProperties()<font></font>
{<font></font>
  fShort.Truncate(<span class="hljs-number">0</span>);<font></font>
  fLong.Truncate(<span class="hljs-number">0</span>);<font></font>
  fPrefApp.Truncate(<span class="hljs-number">0</span>);<font></font>
  fPrefAppSig.Truncate(<span class="hljs-number">0</span>);<font></font>
  fSniffRule.Truncate(<span class="hljs-number">0</span>);<font></font>
<font></font>
  <span class="hljs-keyword">delete</span> fSmallIcon;<font></font>
  fSmallIcon = <span class="hljs-literal">NULL</span>;<font></font>
<font></font>
  <span class="hljs-keyword">delete</span> fBigIcon;<font></font>
  fBigIcon = <span class="hljs-literal">NULL</span>;<font></font>
<font></font>
  fVectorIcon = <span class="hljs-literal">NULL</span>;            <span class="hljs-comment">// &lt;=</span>
  <span class="hljs-built_in">free</span>(fVectorIcon);             <span class="hljs-comment">// &lt;=</span><font></font>
<font></font>
  fExtensions.clear();<font></font>
  fAttributes.clear();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null </font><font style="vertical-align: inherit;">
関数を</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">free</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数</font><font style="vertical-align: inherit;">に渡す</font><font style="vertical-align: inherit;">ことができますが</font><font style="vertical-align: inherit;">、そのようなエントリは明らかに疑わしいものです。</font><font style="vertical-align: inherit;">そのため、アナライザーはコードの混乱した行を見つけました。</font><font style="vertical-align: inherit;">最初に、ポインタ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fVectorIcon</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用してメモリを解放し、</font><font style="vertical-align: inherit;">それを</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NULLに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">設定する必要がありました</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V575</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> NULLポインターが「フリー」関数に渡されます。</font><font style="vertical-align: inherit;">最初の引数を調べます。</font><font style="vertical-align: inherit;">driver_settings.cpp 461</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> settings_handle *
<span class="hljs-title">load_driver_settings_from_file</span><span class="hljs-params">(<span class="hljs-keyword">int</span> file, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *driverName)</span>
</span>{<font></font>
  ....<font></font>
  handle = new_settings(text, driverName);<font></font>
  <span class="hljs-keyword">if</span> (handle != <span class="hljs-literal">NULL</span>) {
    <span class="hljs-comment">// everything went fine!</span>
    <span class="hljs-keyword">return</span> handle;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-built_in">free</span>(handle);           <span class="hljs-comment">// &lt;=</span><font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
null関数を</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">free</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数に明示的に渡す別の例</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">この行は、</font><font style="vertical-align: inherit;">ポインタを正常に受信すると、関数は終了します。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V575</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> NULLポインターが「フリー」関数に渡されます。</font><font style="vertical-align: inherit;">最初の引数を調べます。</font><font style="vertical-align: inherit;">PackageFileHeapWriter.cpp 166</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">void</span>* _GetBuffer()<font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">void</span>* buffer = <span class="hljs-built_in">malloc</span>(fBufferSize);
  <span class="hljs-keyword">if</span> (buffer == <span class="hljs-literal">NULL</span> &amp;&amp; !fBuffers.AddItem(buffer)) {
    <span class="hljs-built_in">free</span>(buffer);
    <span class="hljs-keyword">throw</span> <span class="hljs-built_in">std</span>::bad_alloc();<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> buffer;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここに間違いがあります。</font><font style="vertical-align: inherit;">&amp;&amp;演算子の代わりに、||演算子を使用する必要があります。</font><i><font style="vertical-align: inherit;">malloc</font></i><font style="vertical-align: inherit;">関数を使用してメモリを割り当てることができなかった</font><font style="vertical-align: inherit;">場合にのみ、この場合に例外がスローされます</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">std :: bad_alloc（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">削除演算子のエラー</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V611</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メモリは 'new T []'演算子を使用して割り当てられましたが、 'delete'演算子を使用して解放されました。</font><font style="vertical-align: inherit;">このコードを調べることを検討してください。</font><font style="vertical-align: inherit;">おそらく 'delete [] fMsg;'を使用する方が良いでしょう。</font><font style="vertical-align: inherit;">Err.cpp 65</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Err</span> {</span>
<span class="hljs-keyword">public</span>:<font></font>
 ....<font></font>
<span class="hljs-keyword">private</span>:
 <span class="hljs-keyword">char</span> *fMsg;
 <span class="hljs-keyword">ssize_t</span> fPos;<font></font>
};<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span>
<span class="hljs-title">Err::Unset</span><span class="hljs-params">()</span> </span>{
 <span class="hljs-keyword">delete</span> fMsg;                                   <span class="hljs-comment">// &lt;=</span><font></font>
 fMsg = __null;<font></font>
 fPos = <span class="hljs-number">-1</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span>
<span class="hljs-title">Err::SetMsg</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *msg)</span> </span>{
 <span class="hljs-keyword">if</span> (fMsg) {
  <span class="hljs-keyword">delete</span> fMsg;                                  <span class="hljs-comment">// &lt;=</span><font></font>
  fMsg = __null;<font></font>
 }<font></font>
 <span class="hljs-keyword">if</span> (msg) {<font></font>
  fMsg = <span class="hljs-keyword">new</span>(<span class="hljs-built_in">std</span>::nothrow) <span class="hljs-keyword">char</span>[<span class="hljs-built_in">strlen</span>(msg)+<span class="hljs-number">1</span>]; <span class="hljs-comment">// &lt;=</span>
  <span class="hljs-keyword">if</span> (fMsg)
   <span class="hljs-built_in">strcpy</span>(fMsg, msg);<font></font>
 }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fMsg</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ポインタ</font><i><font style="vertical-align: inherit;">は</font></i><font style="vertical-align: inherit;">、文字の配列を格納するためのメモリの割り当てに使用され、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">delete</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">演算子は</font><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">delete []</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ではなく、</font><font style="vertical-align: inherit;">メモリを解放するために使用され</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V611</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メモリは 'new'演算子を使用して割り当てられましたが、 'free'関数を使用して解放されました。</font><font style="vertical-align: inherit;">'wrapperPool'変数の背後にある操作ロジックを調べることを検討してください。</font><font style="vertical-align: inherit;">vm_page.cpp 3080</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">status_t</span>
<span class="hljs-title">vm_page_write_modified_page_range</span><span class="hljs-params">(....)</span>
</span>{<font></font>
  ....<font></font>
  PageWriteWrapper* wrapperPool<font></font>
    = <span class="hljs-keyword">new</span>(malloc_flags(allocationFlags)) PageWriteWrapper[maxPages + <span class="hljs-number">1</span>];<font></font>
  PageWriteWrapper** wrappers<font></font>
    = <span class="hljs-keyword">new</span>(malloc_flags(allocationFlags)) PageWriteWrapper*[maxPages];
  <span class="hljs-keyword">if</span> (wrapperPool == <span class="hljs-literal">NULL</span> || wrappers == <span class="hljs-literal">NULL</span>) {
    <span class="hljs-built_in">free</span>(wrapperPool);                              <span class="hljs-comment">// &lt;=</span>
    <span class="hljs-built_in">free</span>(wrappers);                                 <span class="hljs-comment">// &lt;=</span><font></font>
    wrapperPool = stackWrappersPool;<font></font>
    wrappers = stackWrappers;<font></font>
    maxPages = <span class="hljs-number">1</span>;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">malloc_flags</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">malloc</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を作成する</font><i><font style="vertical-align: inherit;">関数</font></i><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">そして、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">placement-new</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はここでオブジェクトを構築します。</font><font style="vertical-align: inherit;">また、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PageWriteWrapper</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラス</font><i><font style="vertical-align: inherit;">は</font></i><font style="vertical-align: inherit;">次のように実装されています。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PageWriteWrapper</span> {</span>
<span class="hljs-keyword">public</span>:<font></font>
 PageWriteWrapper();<font></font>
 ~PageWriteWrapper();<font></font>
 <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SetTo</span><span class="hljs-params">(vm_page* page)</span></span>;
 <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">Done</span><span class="hljs-params">(<span class="hljs-keyword">status_t</span> result)</span></span>;<font></font>
<font></font>
<span class="hljs-keyword">private</span>:<font></font>
 vm_page* fPage;<font></font>
 <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">VMCache</span>* <span class="hljs-title">fCache</span>;</span>
 <span class="hljs-keyword">bool</span> fIsActive;<font></font>
};<font></font>
<font></font>
PageWriteWrapper::PageWriteWrapper()<font></font>
 :<font></font>
 fIsActive(<span class="hljs-literal">false</span>)<font></font>
{<font></font>
}<font></font>
<font></font>
PageWriteWrapper::~PageWriteWrapper()<font></font>
{<font></font>
 <span class="hljs-keyword">if</span> (fIsActive)<font></font>
  panic(<span class="hljs-string">"page write wrapper going out of scope but isn't completed"</span>);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、</font><font style="vertical-align: inherit;">メモリを</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解放</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">する</font><font style="vertical-align: inherit;">ためにfree </font><font style="vertical-align: inherit;">関数</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">使用するため、このクラスのオブジェクトのデストラクタは呼び出されません</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V611</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メモリは 'new T []'演算子を使用して割り当てられましたが、 'delete'演算子を使用して解放されました。このコードを調べることを検討してください。 'delete [] fOutBuffer;'を使用する方が良いでしょう。チェック行：26、45。PCL6Rasterizer.h 26</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PCL6Rasterizer</span> :</span> <span class="hljs-keyword">public</span> Rasterizer<font></font>
{<font></font>
<span class="hljs-keyword">public</span>:<font></font>
  ....<font></font>
  ~PCL6Rasterizer()<font></font>
  {<font></font>
    <span class="hljs-keyword">delete</span> fOutBuffer;<font></font>
    fOutBuffer = <span class="hljs-literal">NULL</span>;<font></font>
  }<font></font>
  ....<font></font>
  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">InitializeBuffer</span><span class="hljs-params">()</span>
  </span>{<font></font>
    fOutBuffer = <span class="hljs-keyword">new</span> uchar[fOutBufferSize];<font></font>
  }<font></font>
<span class="hljs-keyword">private</span>:<font></font>
  uchar* fOutBuffer;<font></font>
  <span class="hljs-keyword">int</span>    fOutBufferSize;<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">削除[]の</font></i><font style="vertical-align: inherit;">代わりに</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">削除</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
演算子を使用すること</font><font style="vertical-align: inherit;">は、よくある間違いです。</font><font style="vertical-align: inherit;">クラスを書くときに間違いを犯す最も簡単な方法は、</font><font style="vertical-align: inherit;">デストラクタコードは、多くの場合、メモリ割り当て場所から遠く離れています。</font><font style="vertical-align: inherit;">ここで、プログラマーはポインター</font><i><font style="vertical-align: inherit;">fOutBuffer</font></i><font style="vertical-align: inherit;">によってデストラクタのメモリを誤って解放します</font><font style="vertical-align: inherit;">。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">V772</font></a><font style="vertical-align: inherit;"> voidポインターに対して「削除」演算子を呼び出すと、未定義の動作が発生します。</font><font style="vertical-align: inherit;">Hashtable.cpp 207</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span>
<span class="hljs-title">Hashtable::MakeEmpty</span><span class="hljs-params">(int8 keyMode,int8 valueMode)</span>
</span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">for</span> (entry = fTable[index]; entry; entry = next) {
    <span class="hljs-keyword">switch</span> (keyMode) {
      <span class="hljs-keyword">case</span> HASH_EMPTY_DELETE:
        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> destructors are not called!</span>
        <span class="hljs-keyword">delete</span> (<span class="hljs-keyword">void</span>*)entry-&gt;key;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> HASH_EMPTY_FREE:
        <span class="hljs-built_in">free</span>((<span class="hljs-keyword">void</span>*)entry-&gt;key);
        <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">switch</span> (valueMode) {
      <span class="hljs-keyword">case</span> HASH_EMPTY_DELETE:
        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> destructors are not called!</span>
        <span class="hljs-keyword">delete</span> entry-&gt;value;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> HASH_EMPTY_FREE:
        <span class="hljs-built_in">free</span>(entry-&gt;value);
        <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
    next = entry-&gt;next;<font></font>
    <span class="hljs-keyword">delete</span> entry;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">delete</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">delete []</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">free</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
の誤った選択に加えて、</font><font style="vertical-align: inherit;">別の方法でプログラムに未定義の動作を追加できます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">未定義の型へのポインタ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（void *）を</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用してメモリをクリアしてみてください</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">戻り値のない関数</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V591</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非void関数は値を返す必要があります。</font><font style="vertical-align: inherit;">Referenceable.h 228</font></font><br>
<br>
<pre><code class="cpp hljs">BReference&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-keyword">const</span> BReference&lt;<span class="hljs-keyword">const</span> Type&gt;&amp; other)<font></font>
{<font></font>
  fReference = other.fReference;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
オーバーライドされた代入演算子には十分な戻り値がありません。</font><font style="vertical-align: inherit;">この場合、オペレーターはランダムな値を返すため、奇妙なエラーが発生する可能性があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このクラスの他のコードスニペットでの同様の問題：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V591非void関数は値を返す必要があります。</font><font style="vertical-align: inherit;">Referenceable.h 233</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V591非void関数は値を返す必要があります。</font><font style="vertical-align: inherit;">Referenceable.h 239</font></font></li>
</ul><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V591</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非void関数は値を返す必要があります。</font><font style="vertical-align: inherit;">main.c 1010</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">errx</span><span class="hljs-params">(<span class="hljs-keyword">int</span>, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *, ...)</span> </span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">char</span> *
<span class="hljs-title">getoptionvalue</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *name)</span>
</span>{
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">option</span> *<span class="hljs-title">c</span>;</span><font></font>
<font></font>
  <span class="hljs-keyword">if</span> (name == <span class="hljs-literal">NULL</span>)<font></font>
    errx(<span class="hljs-number">1</span>, <span class="hljs-string">"getoptionvalue() invoked with NULL name"</span>);<font></font>
  c = getoption(name);<font></font>
  <span class="hljs-keyword">if</span> (c != <span class="hljs-literal">NULL</span>)
    <span class="hljs-keyword">return</span> (c-&gt;value);<font></font>
  errx(<span class="hljs-number">1</span>, <span class="hljs-string">"getoptionvalue() invoked with unknown option '%s'"</span>, name);
  <span class="hljs-comment">/* NOTREACHED */</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでのNOTREACHEDユーザーコメントは、何も意味しません。</font><font style="vertical-align: inherit;">このようなシナリオのコードを正しく作成するには、noreturnなどの関数をマークアップする必要があります。</font><font style="vertical-align: inherit;">これには戻り属性はありません。標準およびコンパイラ固有です。</font><font style="vertical-align: inherit;">まず第一に、このような属性は、警告を使用して適切なコードを生成したり、特定のタイプのエラーを通知したりするために、コンパイラーによって考慮されます。</font><font style="vertical-align: inherit;">さまざまな静的分析ツールも属性を考慮して、分析の品質を向上させます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例外処理</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V596</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オブジェクトは作成されましたが、使用されていません。</font><font style="vertical-align: inherit;">「throw」キーワードが欠落している可能性があります。ParseException（FOO）をスローします。</font><font style="vertical-align: inherit;">Response.cpp 659</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">size_t</span>
<span class="hljs-title">Response::ExtractNumber</span><span class="hljs-params">(BDataIO&amp; stream)</span>
</span>{<font></font>
  BString <span class="hljs-built_in">string</span> = ExtractString(stream);<font></font>
<font></font>
  <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* end;
  <span class="hljs-keyword">size_t</span> number = strtoul(<span class="hljs-built_in">string</span>.String(), (<span class="hljs-keyword">char</span>**)&amp;end, <span class="hljs-number">10</span>);
  <span class="hljs-keyword">if</span> (end == <span class="hljs-literal">NULL</span> || end[<span class="hljs-number">0</span>] != <span class="hljs-string">'\0'</span>)<font></font>
    ParseException(<span class="hljs-string">"Invalid number!"</span>);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> number;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">throw</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キーワードが誤って忘れられてい</font><font style="vertical-align: inherit;">ます。したがって、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ParseException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font><i><font style="vertical-align: inherit;">スローされず</font></i><font style="vertical-align: inherit;">、このクラスのオブジェクトは、スコープを離れると破棄されます。その後、関数は、何も起こらなかったかのように、正しい番号が入力されたかのように、処理を続行します。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V1022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポインターによって例外がスローされました。代わりに値でスローすることを検討してください。 gensyscallinfos.cpp 316</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span>
<span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span>
</span>{
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">return</span> Main().Run(argc, argv);<font></font>
  } <span class="hljs-keyword">catch</span> (Exception&amp; exception) {                                         <span class="hljs-comment">// &lt;=</span>
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"%s\n"</span>, exception.what());
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Run</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span>
</span>{<font></font>
  ....<font></font>
  _ParseSyscalls(argv[<span class="hljs-number">1</span>]);<font></font>
  ....<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">void</span> _ParseSyscalls(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* filename)<font></font>
{<font></font>
  <span class="hljs-function">ifstream <span class="hljs-title">file</span><span class="hljs-params">(filename, ifstream::in)</span></span>;
  <span class="hljs-keyword">if</span> (!file.is_open())
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IOException(<span class="hljs-built_in">string</span>(<span class="hljs-string">"Failed to open '"</span>) + filename + <span class="hljs-string">"'."</span>);   <span class="hljs-comment">// &lt;=</span><font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザー</font><font style="vertical-align: inherit;">は、ポインターによってスローさ</font><font style="vertical-align: inherit;">れた</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IOExceptionを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">検出しました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ポインタをスローすると例外がキャッチされないため、最終的に例外は参照によってキャッチされます。</font><font style="vertical-align: inherit;">また、ポインターを使用すると、インターセプターは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">削除</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">演算子</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">呼び出して</font><font style="vertical-align: inherit;">、作成されたオブジェクトを破棄しますが、これも行われません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードのさらに2つの問題領域：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V1022ポインターによって例外がスローされました。</font><font style="vertical-align: inherit;">代わりに値でスローすることを検討してください。</font><font style="vertical-align: inherit;">gensyscallinfos.cpp 347</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V1022ポインターによって例外がスローされました。</font><font style="vertical-align: inherit;">代わりに値でスローすることを検討してください。</font><font style="vertical-align: inherit;">gensyscallinfos.cpp 413</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正式な安全</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V597</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンパイラーは、「f_key」オブジェクトをフラッシュするために使用される「memset」関数呼び出しを削除できます。</font><font style="vertical-align: inherit;">memset_s（）関数を使用して、プライベートデータを消去する必要があります。</font><font style="vertical-align: inherit;">dst_api.c 1018</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> SAFE_FREE</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SAFE_FREE(a) \
do{<span class="hljs-meta-keyword">if</span>(a != NULL){memset(a,0, sizeof(*a)); free(a); a=NULL;}} while (0)</span><font></font>
....<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
<span class="hljs-function">DST_KEY *
<span class="hljs-title">dst_free_key</span><span class="hljs-params">(DST_KEY *f_key)</span>
</span>{
  <span class="hljs-keyword">if</span> (f_key == <span class="hljs-literal">NULL</span>)
    <span class="hljs-keyword">return</span> (f_key);
  <span class="hljs-keyword">if</span> (f_key-&gt;dk_func &amp;&amp; f_key-&gt;dk_func-&gt;destroy)<font></font>
    f_key-&gt;dk_KEY_struct =<font></font>
      f_key-&gt;dk_func-&gt;destroy(f_key-&gt;dk_KEY_struct);<font></font>
  <span class="hljs-keyword">else</span> {<font></font>
    EREPORT((<span class="hljs-string">"dst_free_key(): Unknown key alg %d\n"</span>,<font></font>
       f_key-&gt;dk_alg));<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (f_key-&gt;dk_KEY_struct) {
    <span class="hljs-built_in">free</span>(f_key-&gt;dk_KEY_struct);<font></font>
    f_key-&gt;dk_KEY_struct = <span class="hljs-literal">NULL</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (f_key-&gt;dk_key_name)<font></font>
    SAFE_FREE(f_key-&gt;dk_key_name);<font></font>
  SAFE_FREE(f_key);<font></font>
  <span class="hljs-keyword">return</span> (<span class="hljs-literal">NULL</span>);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザーは、プライベートデータを安全にクリーンアップするために設計された不審なコードを検出しました。</font><font style="vertical-align: inherit;">残念ながら、</font><i><font style="vertical-align: inherit;">memset</font></i><font style="vertical-align: inherit;">、</font><i><font style="vertical-align: inherit;">フリー</font></i><font style="vertical-align: inherit;">コール</font><font style="vertical-align: inherit;">、および</font><i><font style="vertical-align: inherit;">NULL</font></i><font style="vertical-align: inherit;">割り当て</font><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">展開されて</font><font style="vertical-align: inherit;">いる</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SAFE_FREE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マクロ</font><font style="vertical-align: inherit;">は</font><font style="vertical-align: inherit;">、コードをより安全にしません。</font><font style="vertical-align: inherit;">これらすべては、</font><i><font style="vertical-align: inherit;">O2</font></i><font style="vertical-align: inherit;">最適化中にコンパイラによって削除され</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">
ちなみに、これは</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">CWE-14</font></a><font style="vertical-align: inherit;">：バッファをクリアするためのコンパイラによるコードの削除とは異なります。</font><font style="vertical-align: inherit;">
バッファが実際にクリアされない場所のリスト全体：</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li>V597 The compiler could delete the 'memset' function call, which is used to flush 'encoded_block' buffer. The memset_s() function should be used to erase the private data. dst_api.c 446</li>
<li>V597 The compiler could delete the 'memset' function call, which is used to flush 'key_st' object. The memset_s() function should be used to erase the private data. dst_api.c 685</li>
<li>V597 The compiler could delete the 'memset' function call, which is used to flush 'in_buff' buffer. The memset_s() function should be used to erase the private data. dst_api.c 916</li>
<li>V597 The compiler could delete the 'memset' function call, which is used to flush 'ce' object. The memset_s() function should be used to erase the private data. fs_cache.c 1078</li>
</ul><br>
<h2>   </h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V547</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">式 'remaining &lt;0'は常にfalseです。</font><font style="vertical-align: inherit;">符号なしの型の値が0未満になることはありません。DwarfFile.cpp1947</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">status_t</span><font></font>
DwarfFile::_UnwindCallFrame(....)<font></font>
{<font></font>
  ....<font></font>
  uint64 remaining = lengthOffset + length - dataReader.Offset();<font></font>
  <span class="hljs-keyword">if</span> (remaining &lt; <span class="hljs-number">0</span>)
    <span class="hljs-keyword">return</span> B_BAD_DATA;<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザーは、負の値を持つ符号なし変数の明示的な比較を検出しました。</font><font style="vertical-align: inherit;">おそらく、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">残りの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数</font><i><font style="vertical-align: inherit;">を</font></i><font style="vertical-align: inherit;">ゼロのみ</font><i><font style="vertical-align: inherit;">と</font></i><font style="vertical-align: inherit;">比較する</font><font style="vertical-align: inherit;">か、オーバーフローチェックを実装する必要があります。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V547</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">式「sleep（（unsigned）secs）&lt;0」は常にfalseです。</font><font style="vertical-align: inherit;">符号なしの型の値が0になることはありません。misc.cpp 56</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">status_t</span>
<span class="hljs-title">snooze</span><span class="hljs-params">(<span class="hljs-keyword">bigtime_t</span> amount)</span>
</span>{
  <span class="hljs-keyword">if</span> (amount &lt;= <span class="hljs-number">0</span>)
    <span class="hljs-keyword">return</span> B_OK;<font></font>
<font></font>
  int64 secs = amount / <span class="hljs-number">1000000L</span>L;<font></font>
  int64 usecs = amount % <span class="hljs-number">1000000L</span>L;
  <span class="hljs-keyword">if</span> (secs &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">if</span> (sleep((<span class="hljs-keyword">unsigned</span>)secs) &lt; <span class="hljs-number">0</span>)     <span class="hljs-comment">// &lt;=</span>
      <span class="hljs-keyword">return</span> errno;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (usecs &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">if</span> (usleep((<span class="hljs-keyword">useconds_t</span>)usecs) &lt; <span class="hljs-number">0</span>)
      <span class="hljs-keyword">return</span> errno;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> B_OK;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エラーが何かを理解するために、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sleep</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数</font><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usleep</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数のシグネチャを見てみましょう</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">extern</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">sleep</span> <span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> __seconds)</span></span>;
<span class="hljs-function"><span class="hljs-keyword">extern</span> <span class="hljs-keyword">int</span> <span class="hljs-title">usleep</span> <span class="hljs-params">(<span class="hljs-keyword">__useconds_t</span> __useconds)</span></span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
見てのとおり、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sleep</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数</font><font style="vertical-align: inherit;">は符号なしの型の値を返し、コードでのその使用は正しくありません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">危険なポインタ</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V774</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メモリが解放された後、「デバイス」ポインタが使用されました。</font><font style="vertical-align: inherit;">xhci.cpp 1572</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span>
<span class="hljs-title">XHCI::FreeDevice</span><span class="hljs-params">(Device *device)</span>
</span>{<font></font>
  uint8 slot = fPortSlots[device-&gt;HubPort()];<font></font>
  TRACE(<span class="hljs-string">"FreeDevice() port %d slot %d\n"</span>, device-&gt;HubPort(), slot);<font></font>
<font></font>
  <span class="hljs-comment">// Delete the device first, so it cleans up its pipes and tells us</span>
  <span class="hljs-comment">// what we need to destroy before we tear down our internal state.</span>
  <span class="hljs-keyword">delete</span> device;<font></font>
<font></font>
  DisableSlot(slot);<font></font>
  fDcba-&gt;baseAddress[slot] = <span class="hljs-number">0</span>;<font></font>
  fPortSlots[device-&gt;HubPort()] = <span class="hljs-number">0</span>;            <span class="hljs-comment">// &lt;=</span><font></font>
  delete_area(fDevices[slot].trb_area);<font></font>
  delete_area(fDevices[slot].input_ctx_area);<font></font>
  delete_area(fDevices[slot].device_ctx_area);<font></font>
<font></font>
  <span class="hljs-built_in">memset</span>(&amp;fDevices[slot], <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(xhci_device));<font></font>
  fDevices[slot].state = XHCI_STATE_DISABLED;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デバイス</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
オブジェクト</font><font style="vertical-align: inherit;">は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">削除</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">演算子によってクリアされ</font><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FreeDevice</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と呼ばれる関数の論理アクションです</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">しかし、何らかの理由で、コード内の他のリソースを解放するために、すでにリモートのオブジェクトに対する魅力があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このようなコードは非常に危険であり、他のいくつかの場所で見つかります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V774「セルフ」ポインタは、メモリが解放された後に使用されました。</font><font style="vertical-align: inherit;">TranslatorRoster.cpp 884</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V774 'string'ポインタは、メモリが解放された後に使用されました。</font><font style="vertical-align: inherit;">RemoteView.cpp 1269</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V774メモリが解放された後、「bs」ポインタが使用されました。</font><font style="vertical-align: inherit;">mkntfs.c 4291</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V774メモリが解放された後、「bs」ポインタが使用されました。</font><font style="vertical-align: inherit;">mkntfs.c 4308</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V774メモリが再割り当てされた後、「al」ポインタが使用されました。</font><font style="vertical-align: inherit;">inode.c 1155</font></font></li>
</ul><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V522</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> NULLポインター「データ」の</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">逆</font></a><font style="vertical-align: inherit;">参照が行われる可能性があります。</font><font style="vertical-align: inherit;">nullポインターが 'malo_hal_send_helper'関数に渡されます。</font><font style="vertical-align: inherit;">3番目の引数を調べます。</font><font style="vertical-align: inherit;">チェック行：350、394。if_malohal.c 350</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span>
<span class="hljs-title">malo_hal_fwload_helper</span><span class="hljs-params">(struct malo_hal *mh, <span class="hljs-keyword">char</span> *helper)</span>
</span>{<font></font>
  ....<font></font>
  <span class="hljs-comment">/* tell the card we're done and... */</span>
  error = malo_hal_send_helper(mh, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, MALO_NOWAIT); <span class="hljs-comment">// &lt;= NULL</span><font></font>
  ....<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span>
<span class="hljs-title">malo_hal_send_helper</span><span class="hljs-params">(struct malo_hal *mh, <span class="hljs-keyword">int</span> bsize,
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *data, <span class="hljs-keyword">size_t</span> dsize, <span class="hljs-keyword">int</span> waitfor)</span>
</span>{<font></font>
  mh-&gt;mh_cmdbuf[<span class="hljs-number">0</span>] = htole16(MALO_HOSTCMD_CODE_DNLD);<font></font>
  mh-&gt;mh_cmdbuf[<span class="hljs-number">1</span>] = htole16(bsize);
  <span class="hljs-built_in">memcpy</span>(&amp;mh-&gt;mh_cmdbuf[<span class="hljs-number">4</span>], data , dsize);                   <span class="hljs-comment">// &lt;= data</span><font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
手続き間の分析により、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NULLが</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数に渡され、</font><font style="vertical-align: inherit;">この値を持つ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポインター</font><font style="vertical-align: inherit;">が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memcpy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数で逆参照さ</font><font style="vertical-align: inherit;">れる状況が明らかになりました</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V773</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数は、「inputFileFile」ポインタを解放せずに終了しました。</font><font style="vertical-align: inherit;">メモリリークの可能性があります。</font><font style="vertical-align: inherit;">command_recompress.cpp 119</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span>
<span class="hljs-title">command_recompress</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* <span class="hljs-keyword">const</span>* argv)</span>
</span>{<font></font>
  ....<font></font>
  BFile* inputFileFile = <span class="hljs-keyword">new</span> BFile;<font></font>
  error = inputFileFile-&gt;SetTo(inputPackageFileName, O_RDONLY);<font></font>
  <span class="hljs-keyword">if</span> (error != B_OK) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Error: Failed to open input file \"%s\": %s\n"</span>,<font></font>
      inputPackageFileName, strerror(error));<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
  }<font></font>
  inputFile = inputFileFile;<font></font>
  ....<font></font>
}</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studioはメモリリークを検出できます</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">何らかのエラーが発生した場合、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inputFileFile</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のメモリ</font><font style="vertical-align: inherit;">は</font><i><font style="vertical-align: inherit;">ここ</font></i><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">は解放されません</font><font style="vertical-align: inherit;">。エラーが発生した場合、メモリを解放することに煩わされることができないと誰かが信じています-プログラムはまだ終了します。しかし、常にそうであるとは限りません。エラーを正しく処理し、作業を続行します-非常に多くのプログラムの要件。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V595</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nullptrに対して検証される前に、 'fReply'ポインターが使用されました。チェック行：49、52。ReplyBuilder.cpp 49</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">RPC::CallbackReply*
<span class="hljs-title">ReplyBuilder::Reply</span><span class="hljs-params">()</span>
</span>{<font></font>
  fReply-&gt;Stream().InsertUInt(fStatusPosition, _HaikuErrorToNFS4(fStatus));<font></font>
  fReply-&gt;Stream().InsertUInt(fOpCountPosition, fOpCount);<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (fReply == <span class="hljs-literal">NULL</span> || fReply-&gt;Stream().Error() == B_OK)
    <span class="hljs-keyword">return</span> fReply;
  <span class="hljs-keyword">else</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開発者がチェックする前にポインタを逆参照する頻度。</font><font style="vertical-align: inherit;">Diagnostics </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V595は、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ほとんどの場合、プロジェクトの警告数のリーダーです。</font><font style="vertical-align: inherit;">このコード</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スニペット</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">での</font><i><font style="vertical-align: inherit;">fReply</font></i><font style="vertical-align: inherit;">ポインタの危険な使用</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V595</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nullptrに対して検証される前に、 ' </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">mq</font></a><font style="vertical-align: inherit;"> 'ポインターが使用されました。</font><font style="vertical-align: inherit;">チェック行：782、786。oce_queue.c 782</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span>
<span class="hljs-title">oce_mq_free</span><span class="hljs-params">(struct oce_mq *mq)</span>
</span>{<font></font>
  POCE_SOFTC sc = (POCE_SOFTC) mq-&gt;parent;<font></font>
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">oce_mbx</span> <span class="hljs-title">mbx</span>;</span>
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">mbx_destroy_common_mq</span> *<span class="hljs-title">fwcmd</span>;</span><font></font>
<font></font>
  <span class="hljs-keyword">if</span> (!mq)
    <span class="hljs-keyword">return</span>;<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同様の例。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mg</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポインターは</font><font style="vertical-align: inherit;">、null値のチェックよりも数行早く参照解除されます。</font><font style="vertical-align: inherit;">プロジェクトには多くの類似した場所があります。</font><font style="vertical-align: inherit;">一部の場所では、ポインターの使用とチェックが互いにかけ離れているため、記事には2つの例が含まれています。</font><font style="vertical-align: inherit;">残りは完全なアナライザーレポートで開発者を見ることができます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">その他のエラー</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V645</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「strncat」関数呼び出しは、「出力」バッファオーバーフローを引き起こす可能性があります。境界には、バッファーのサイズではなく、バッファーが保持できる文字数を含める必要があります。 NamespaceDump.cpp 101</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span>
<span class="hljs-title">dump_acpi_namespace</span><span class="hljs-params">(acpi_ns_device_info *device, <span class="hljs-keyword">char</span> *root, <span class="hljs-keyword">int</span> indenting)</span>
</span>{
  <span class="hljs-keyword">char</span> output[<span class="hljs-number">320</span>];
  <span class="hljs-keyword">char</span> tabs[<span class="hljs-number">255</span>] = <span class="hljs-string">""</span>;<font></font>
  ....<font></font>
  strlcat(tabs, <span class="hljs-string">"|--- "</span>, <span class="hljs-keyword">sizeof</span>(tabs));<font></font>
  ....<font></font>
  <span class="hljs-keyword">while</span> (....) {<font></font>
    uint32 type = device-&gt;acpi-&gt;get_object_type(result);<font></font>
    <span class="hljs-built_in">snprintf</span>(output, <span class="hljs-keyword">sizeof</span>(output), <span class="hljs-string">"%s%s"</span>, tabs, result + depth);
    <span class="hljs-keyword">switch</span>(type) {
      <span class="hljs-keyword">case</span> ACPI_TYPE_INTEGER:
        <span class="hljs-built_in">strncat</span>(output, <span class="hljs-string">"     INTEGER"</span>, <span class="hljs-keyword">sizeof</span>(output));
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> ACPI_TYPE_STRING:
        <span class="hljs-built_in">strncat</span>(output, <span class="hljs-string">"     STRING"</span>, <span class="hljs-keyword">sizeof</span>(output));
        <span class="hljs-keyword">break</span>;<font></font>
      ....<font></font>
    }<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strlcat </font></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font><i><font style="vertical-align: inherit;">strncat関数</font></i><font style="vertical-align: inherit;"> 
の違いは、</font><font style="vertical-align: inherit;">これらの関数の説明に</font><i><font style="vertical-align: inherit;">不慣れな人には</font></i><font style="vertical-align: inherit;">完全には明らかで</font><i><font style="vertical-align: inherit;">はあり</font></i><font style="vertical-align: inherit;">ません。関数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strlcat</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3番目の引数は受信</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バッファ全体のサイズ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、および機能</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strncat</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フリーバッファスペースの量</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の関数呼び出しの前に、所望の値の計算を必要とします。しかし、開発者はそれを忘れたり、知らないことがよくあります。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strncat</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数</font><i><font style="vertical-align: inherit;">を</font></i><font style="vertical-align: inherit;">バッファ全体</font><i><font style="vertical-align: inherit;">の</font></i><font style="vertical-align: inherit;">サイズに</font><font style="vertical-align: inherit;">渡す</font><font style="vertical-align: inherit;">と、バッファオーバーフローが発生する可能性があります。関数は、この値をコピーに許可されている文字数と見なします。</font><i><font style="vertical-align: inherit;">strlcat</font></i><font style="vertical-align: inherit;">関数</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この問題はありませんが、正しく動作させるには、端子ゼロで終わるラインを転送する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
行のある危険な場所のリスト全体：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V645「strncat」関数呼び出しは、「出力」バッファオーバーフローを引き起こす可能性があります。</font><font style="vertical-align: inherit;">境界には、バッファーのサイズではなく、バッファーが保持できる文字数を含める必要があります。</font><font style="vertical-align: inherit;">NamespaceDump.cpp 104</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V645「strncat」関数呼び出しは、「出力」バッファオーバーフローを引き起こす可能性があります。</font><font style="vertical-align: inherit;">境界には、バッファーのサイズではなく、バッファーが保持できる文字数を含める必要があります。</font><font style="vertical-align: inherit;">NamespaceDump.cpp 107</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V645「strncat」関数呼び出しは、「出力」バッファオーバーフローを引き起こす可能性があります。</font><font style="vertical-align: inherit;">境界には、バッファーのサイズではなく、バッファーが保持できる文字数を含める必要があります。</font><font style="vertical-align: inherit;">NamespaceDump.cpp 110</font></font></li>
<li>V645 The 'strncat' function call could lead to the 'output' buffer overflow. The bounds should not contain the size of the buffer, but a number of characters it can hold. NamespaceDump.cpp 113</li>
<li>V645 The 'strncat' function call could lead to the 'output' buffer overflow. The bounds should not contain the size of the buffer, but a number of characters it can hold. NamespaceDump.cpp 118</li>
<li>V645 The 'strncat' function call could lead to the 'output' buffer overflow. The bounds should not contain the size of the buffer, but a number of characters it can hold. NamespaceDump.cpp 119</li>
<li>V645 The 'strncat' function call could lead to the 'output' buffer overflow. The bounds should not contain the size of the buffer, but a number of characters it can hold. NamespaceDump.cpp 120</li>
<li>V645 The 'strncat' function call could lead to the 'output' buffer overflow. The bounds should not contain the size of the buffer, but a number of characters it can hold. NamespaceDump.cpp 123</li>
<li>V645 The 'strncat' function call could lead to the 'output' buffer overflow. The bounds should not contain the size of the buffer, but a number of characters it can hold. NamespaceDump.cpp 126</li>
<li>V645 The 'strncat' function call could lead to the 'output' buffer overflow. The bounds should not contain the size of the buffer, but a number of characters it can hold. NamespaceDump.cpp 129</li>
<li>V645 The 'strncat' function call could lead to the 'output' buffer overflow. The bounds should not contain the size of the buffer, but a number of characters it can hold. NamespaceDump.cpp 132</li>
<li>V645 The 'strncat' function call could lead to the 'output' buffer overflow. The bounds should not contain the size of the buffer, but a number of characters it can hold. NamespaceDump.cpp 135</li>
<li>V645 The 'strncat' function call could lead to the 'output' buffer overflow. The bounds should not contain the size of the buffer, but a number of characters it can hold. NamespaceDump.cpp 138</li>
<li>V645 The 'strncat' function call could lead to the 'output' buffer overflow. The bounds should not contain the size of the buffer, but a number of characters it can hold. NamespaceDump.cpp 141</li>
<li>V645 The 'strncat' function call could lead to the 'output' buffer overflow. The bounds should not contain the size of the buffer, but a number of characters it can hold. NamespaceDump.cpp 144</li>
<li>V645 The 'strncat' function call could lead to the 'features_string' buffer overflow. The bounds should not contain the size of the buffer, but a number of characters it can hold. VirtioDevice.cpp 283</li>
<li>V645 The 'strncat' function call could lead to the 'features_string' buffer overflow. The bounds should not contain the size of the buffer, but a number of characters it can hold. VirtioDevice.cpp 284</li>
<li>V645 The 'strncat' function call could lead to the 'features_string' buffer overflow. The bounds should not contain the size of the buffer, but a number of characters it can hold. VirtioDevice.cpp 285</li>
</ul><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V792</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">演算子 '|'の右側にある 'SetDecoratorSettings'関数 </font><font style="vertical-align: inherit;">左のオペランドの値に関係なく呼び出されます。</font><font style="vertical-align: inherit;">おそらく、 '||'を使用する方が良いでしょう。</font><font style="vertical-align: inherit;">DesktopListener.cpp 324</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DesktopListener</span> :</span> <span class="hljs-keyword">public</span> DoublyLinkedListLinkImpl&lt;DesktopListener&gt; {
<span class="hljs-keyword">public</span>:<font></font>
 ....<font></font>
 <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">SetDecoratorSettings</span><span class="hljs-params">(Window* window,
         <span class="hljs-keyword">const</span> BMessage&amp; settings)</span> </span>= <span class="hljs-number">0</span>;<font></font>
 ....<font></font>
};<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">bool</span>
<span class="hljs-title">DesktopObservable::SetDecoratorSettings</span><span class="hljs-params">(Window* window,
  <span class="hljs-keyword">const</span> BMessage&amp; settings)</span>
</span>{
  <span class="hljs-keyword">if</span> (fWeAreInvoking)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  <span class="hljs-function">InvokeGuard <span class="hljs-title">invokeGuard</span><span class="hljs-params">(fWeAreInvoking)</span></span>;<font></font>
<font></font>
  <span class="hljs-keyword">bool</span> changed = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">for</span> (DesktopListener* listener = fDesktopListenerList.First();<font></font>
    listener != <span class="hljs-literal">NULL</span>; listener = fDesktopListenerList.GetNext(listener))<font></font>
    changed = changed | listener-&gt;SetDecoratorSettings(window, settings);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> changed;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おそらく、演算子 '|' </font><font style="vertical-align: inherit;">および '||'。</font><font style="vertical-align: inherit;">このようなエラーは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SetDecoratorSettings</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数の不要な呼び出しに</font><i><font style="vertical-align: inherit;">つながり</font></i><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V627</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">式の検査を検討してください。</font><font style="vertical-align: inherit;">sizeof（）の引数は、数値に展開するマクロです。</font><font style="vertical-align: inherit;">device.c 72</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PCI_line_size 0x0c <span class="hljs-comment">/* (1 byte) cache line size in 32 bit words */</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">status_t</span>
<span class="hljs-title">wb840_open</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* name, uint32 flags, <span class="hljs-keyword">void</span>** cookie)</span>
</span>{<font></font>
  ....<font></font>
  data-&gt;wb_cachesize = gPci-&gt;read_pci_config(data-&gt;pciInfo-&gt;bus,<font></font>
    data-&gt;pciInfo-&gt;device, data-&gt;pciInfo-&gt;function, PCI_line_size,<font></font>
    <span class="hljs-keyword">sizeof</span>(PCI_line_size)) &amp; <span class="hljs-number">0xff</span>;<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値</font><i><font style="vertical-align: inherit;">0x0c</font></i><font style="vertical-align: inherit;"> 
を</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sizeof</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">演算子に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">渡す</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font><font style="vertical-align: inherit;">疑わしいようです。</font><font style="vertical-align: inherit;">おそらく、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">などのオブジェクトのサイズを計算する必要があり</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V562</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bool型の値を18の値と比較するのは奇妙です：0x12 == IsProfessionalSpdif（）。</font><font style="vertical-align: inherit;">CEchoGals_mixer.cpp 533</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">bool</span> BOOL;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">virtual</span> BOOL <span class="hljs-title">IsProfessionalSpdif</span><span class="hljs-params">()</span> </span>{ ... }<font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ECHOSTATUS_DSP_DEAD 0x12</span><font></font>
<font></font>
<span class="hljs-function">ECHOSTATUS <span class="hljs-title">CEchoGals::ProcessMixerFunction</span><span class="hljs-params">(....)</span>
</span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> ( ECHOSTATUS_DSP_DEAD == IsProfessionalSpdif() ) <span class="hljs-comment">// &lt;=</span><font></font>
  {<font></font>
    Status = ECHOSTATUS_DSP_DEAD;<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span><font></font>
  {<font></font>
    pMixerFunction-&gt;Data.bProfSpdif = IsProfessionalSpdif();<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IsProfessionalSpdif</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
関数</font><font style="vertical-align: inherit;">は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bool</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">型の値を返しますが、</font><font style="vertical-align: inherit;">この状態では、関数の結果は数値</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x12</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と比較され</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
去年の秋、最初のHaikuベータのリリースを逃しました。 Java言語用のPVS-Studioのリリースで忙しかった。ただし、プログラミングエラーの性質上、ユーザーがエラーを探し、コードの品質にまったく注意を払わない限り、エラーは発生しません。開発者は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Coverity Scan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用しようとしました</font><font style="vertical-align: inherit;">が、分析の最後の実行はほぼ2年前でした。これはHaikuユーザーを混乱させるはずです。 Coverityを使用した分析は2014年に構成されましたが、2015年にエラーレビュー付きの2つの大きな記事を書くことを止めることはできませんでした（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後まで読んだ人は、新しいタイプのエラーを含む、同じくらいの量のHaikuコードの別のレビューを待っています。</font><font style="vertical-align: inherit;">コードレビューを公開する前に、完全なアナライザーレポートが開発者に送信されるため、いくつかのエラーを修正できます。</font><font style="vertical-align: inherit;">出版物の間隔を</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空けるため</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に、プロジェクトで</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">PVS-Studio</font></a><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">ダウンロードして試してみることをお勧め</font><font style="vertical-align: inherit;">します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
俳句を試してみて、質問がありますか？</font><font style="vertical-align: inherit;">Haiku開発者が</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">電報チャンネルに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">招待します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/c78/30f/70c/c7830f70c5577c3d6704f254d7cad6a3.png" align="left"></a></p><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事を英語を話す視聴者と共有したい場合は、翻訳へのリンクを使用してください：Svyatoslav Razmyslov。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CとC ++で足元に自分を撃つ方法。</font><font style="vertical-align: inherit;">Haiku OSクックブック</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja461239/index.html">例のフラッター。Flutterアプリケーションのディープリンク</a></li>
<li><a href="../ja461241/index.html">地球物理学におけるWolfram Mathematica</a></li>
<li><a href="../ja461243/index.html">アフリカに散歩に出かけないでください：黒大陸でのインターネット検閲はどうなっていますか</a></li>
<li><a href="../ja461249/index.html">映画ファンのためのAndroidアプリの作成-パート2（デザイン）</a></li>
<li><a href="../ja461251/index.html">Julia Evansからの便利なスライドの選択</a></li>
<li><a href="../ja461257/index.html">Seleniumを使用したテスト自動化からROIを計算する方法は？</a></li>
<li><a href="../ja461259/index.html">ストレージパーティー、8月8日、モスクワ</a></li>
<li><a href="../ja461261/index.html">RRC製品に関する有用なRRC Webセミナーのチェックリスト</a></li>
<li><a href="../ja461265/index.html">マイクロコントローラー向けプロジェクトでのオペレーティングシステムの使用の乱用について</a></li>
<li><a href="../ja461267/index.html">チップパッケージング向けの新しいIntelテクノロジー</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>