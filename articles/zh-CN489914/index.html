<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚛 🏀 🗽 Proxmox VE中的群集 🕷️ ♋️ 🖼️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在过去的文章中，我们开始讨论什么是Proxmox VE及其工作原理。今天，我们将讨论如何使用群集功能并展示其优点。
 
 什么是集群，为什么需要集群？群集（来自英语群集）是通过高速通信通道连接的一组服务器，它们在整个用户范围内工作并代表着整个用户。有几种使用群集的基本方案：
 
 

- 提供容错能...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Proxmox VE中的群集</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/selectel/blog/489914/"><img src="https://habrastorage.org/webt/ba/4_/p0/ba4_p0pjj8nlzulpcdlsdbez4mo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在过去的文章中，我们开始讨论什么是Proxmox VE及其工作原理。</font><font style="vertical-align: inherit;">今天，我们将讨论如何使用群集功能并展示其优点。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
什么是集群，为什么需要集群？</font><font style="vertical-align: inherit;">群集（来自英语群集）是通过高速通信通道连接的一组服务器，它们在整个用户范围内工作并代表着整个用户。</font><font style="vertical-align: inherit;">有几种使用群集的基本方案：</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供容错能力</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（高可用性）。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">负载均衡</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Load Balancing）。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提高生产率</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（高性能）。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分布式计算</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
每个方案都对群集组件提出了自己的要求。</font><font style="vertical-align: inherit;">例如，对于执行分布式计算的群集，主要要求是浮点运算的高速和网络的低延迟。</font><font style="vertical-align: inherit;">这样的集群通常用于研究目的。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
既然我们谈到了分布式计算的主题，我想指出的是，仍然存在诸如</font><b><font style="vertical-align: inherit;">网格系统之</font></b><font style="vertical-align: inherit;">类的东西</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（来自英语。grid-格子，网络）。</font><font style="vertical-align: inherit;">尽管总体上相似，但不要混淆网格系统和群集。</font><font style="vertical-align: inherit;">网格不是通常意义上的集群。</font><font style="vertical-align: inherit;">与集群相反，网格中包含的节点通常是异构的，并且具有较低的可用性。</font><font style="vertical-align: inherit;">这种方法简化了分布式计算问题的解决方案，但不允许从节点创建单个整体。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网格系统的一个显着示例是流行的计算平台</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BOINC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（用于网络计算的伯克利开放基础结构）。</font><font style="vertical-align: inherit;">该平台最初是为</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SETI @ home项目</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">在家</font></a><font style="vertical-align: inherit;">中搜索外星智能）</font><font style="vertical-align: inherit;">创建的，该</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">项目</font></a><font style="vertical-align: inherit;">通过分析无线电信号来解决搜索外星智能的问题。</font></font></blockquote><div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">怎么运行的</font></font></b><div class="spoiler_text">  ,   ,     ,      - (  SETI@home      ).              SETI.       ,        .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
既然我们对集群是什么有了一个清晰的了解，我们建议考虑如何创建和部署它。</font><font style="vertical-align: inherit;">我们将使用</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Proxmox VE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开源虚拟化系统</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在开始创建集群之前，特别重要的是要清楚地了解Proxmox的局限性和系统要求，即：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集群中的最大节点数为</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有节点必须具有</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相同版本的Proxmox</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（有例外，但不建议在生产中使用）；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果将来计划使用高可用性功能，则集群必须</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">至少具有3个节点</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了使节点之间能够相互通信，必须打开端口</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UDP / 5404</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">用于corosync的</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UDP / 5405</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">用于SSH的</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP / 22</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">节点之间的网络延迟不应超过</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 ms</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集群创建</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重要！</font><font style="vertical-align: inherit;">以下配置是测试之一。</font><font style="vertical-align: inherit;">确保检查</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">官方</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Proxmox VE </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">文档</font></a><font style="vertical-align: inherit;">。</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了启动测试集群，我们使用了三台服务器，它们安装了具有相同配置（2核，2 GB RAM）的Proxmox虚拟机管理程序。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您想知道如何安装Proxmox，我们建议您阅读上一篇文章- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虚拟化</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">魔力：Proxmox VE入门课程</font></a><font style="vertical-align: inherit;">。</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初，在安装操作系统后，单个服务器将以</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Standalone-mode运行</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
 <br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/2l/b9/1x/2lb91xdrokvieydn63rr9fb7ndo.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通过单击</font><font style="vertical-align: inherit;">相应部分中</font><font style="vertical-align: inherit;">的</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建集群</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按钮来</font><b><font style="vertical-align: inherit;">创建集群</font></b><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/4k/sr/me/4ksrmekzntmzfig-2ymdwx7oahs.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们命名将来的群集，然后选择活动的网络连接。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/cy/ww/bt/cywwbtaea7ogttm77ebrwtwo7f8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
单击创建按钮。</font><font style="vertical-align: inherit;">服务器将生成一个2048位密钥，并将其与新集群的参数一起写入配置文件。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/qv/r3/wy/qvr3wyzqfxrgscstbwz0mzxztv0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
题为</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TASK OK的任务</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表明操作成功。</font><font style="vertical-align: inherit;">现在，查看有关系统的常规信息，很明显服务器已切换到群集模式。</font><font style="vertical-align: inherit;">到目前为止，集群仅由一个节点组成，也就是说，它不具备集群所需的功能。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/cv/zl/17/cvzl17xrzcnv4tbjlgcgutbd6vc.png"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加入集群</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在连接到创建的集群之前，我们需要获取信息以完成连接。</font><font style="vertical-align: inherit;">为此，请转到“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">群集”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分</font><font style="vertical-align: inherit;">，然后单击“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加入信息”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按钮</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/7g/se/mi/7gsemira1cy79g3f9yxopfxc_mo.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在打开的窗口中，我们对同名字段的内容感兴趣。</font><font style="vertical-align: inherit;">它将需要复制。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/rw/-i/7h/rw-i7hhyo_yqrqy-o9oh2jxmi9g.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
所有必需的连接参数都在此处编码：用于连接的服务器地址和指纹。</font><font style="vertical-align: inherit;">我们传递给需要包含在集群中的服务器。</font><font style="vertical-align: inherit;">单击</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加入群集</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按钮，</font><font style="vertical-align: inherit;">然后在打开的窗口中粘贴复制的内容。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/bt/fh/0v/btfh0vp9foxegb2lcca-d-kww1c.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等地址</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指纹</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段</font><font style="vertical-align: inherit;">将自动填写。</font><font style="vertical-align: inherit;">从节点号1输入root密码，选择网络连接，然后单击</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Join</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按钮</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/v-/um/i3/v-umi3rqffairr3yhnn2tz2uafi.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当您加入群集时，GUI网页可能会停止更新。</font><font style="vertical-align: inherit;">这很正常，只需重新加载页面即可。</font><font style="vertical-align: inherit;">以完全相同的方式，我们添加了一个以上的节点，因此，我们收到了由3个工作节点组成的完整集群。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/tc/wb/mx/tcwbmxrp1umdagapsce7tv4qfie.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，我们可以通过一个GUI控制所有群集节点。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/e4/at/cb/e4atcbt-_ihvdai9jjjmiamgrds.png"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高可用性组织</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
开箱即用的Proxmox支持虚拟机和LXC容器的HA组织功能。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ha-manager</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实用程序</font><font style="vertical-align: inherit;">通过执行从故障节点到工作节点的故障转移来检测并处理错误和故障。</font><font style="vertical-align: inherit;">为了使该机制正常工作，虚拟机和容器必须具有公共文件存储。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
激活高可用性功能后，ha-manager软件堆栈将开始连续监视虚拟机或容器的状态，并与群集中的其他节点进行异步交互。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附加共享存储</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例如，我们在192.168.88.18部署了一个小的NFS文件存储。</font><font style="vertical-align: inherit;">为了使集群的所有节点都可以使用它，您需要执行以下操作。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们在Web界面的菜单中选择</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datacenter-Storage-Add-NFS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/vr/pd/3u/vrpd3uedlwasqpg0m19g8pvtb2o.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
填写</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Server</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">导出”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下拉列表中，</font><font style="vertical-align: inherit;">从可用目录中选择所需的目录，然后在“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内容”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列表</font><font style="vertical-align: inherit;">中选择所需的数据类型。</font><font style="vertical-align: inherit;">单击</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按钮后，</font><font style="vertical-align: inherit;">存储将连接到集群的所有节点。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/6d/mu/fy/6dmufyavxpq4dcxaqxarozuughm.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在任何节点上创建虚拟机和容器时，我们将</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定</font><font style="vertical-align: inherit;">为存储。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定制HA</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例如，使用Ubuntu 18.04创建一个容器并为其配置高可用性。</font><font style="vertical-align: inherit;">创建和启动容器后，转到“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据中心-HA-添加”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在打开的字段中，指定虚拟机/容器的ID以及在节点之间重新启动和移动的最大尝试次数。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果超过此数量，则管理程序将虚拟机标记为失败，并将其转移到错误状态，此后它将停止对其执行任何操作。</font></font></blockquote><div style="text-align:center;"><img src="https://habrastorage.org/webt/p4/h9/ng/p4h9nglzk5gtsojtebmvlny9cvq.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
单击</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按钮后，</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ha-manager</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实用程序将</font><font style="vertical-align: inherit;">通知所有群集节点当前正在监视具有指定ID的VM，如果该VM掉落，则必须在另一个节点上重新启动它。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ni/6x/q5/ni6xq5soctxwt3-abx9bs0gvo8o.png"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">撞车</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了了解切换机制的工作原理，让我们正常地偿还节点1的电源。</font><font style="vertical-align: inherit;">我们从另一个节点看集群发生了什么。</font><font style="vertical-align: inherit;">我们看到系统记录了一个故障。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/df/wc/ve/dfwcve9i2iplppnbexfsomn0w40.png"></div><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HA机制的运行并不意味着VM的继续运行。</font><font style="vertical-align: inherit;">节点“掉落”后，VM操作会暂时停止，直到在另一个节点上自动重新启动。</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">至此，“魔术”开始了：集群自动将节点重新分配给运行我们的VM，并在120秒内自动恢复了工作。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/sl/ep/j6/slepj6ytjfwkdkfx--i7kvrxega.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们熄灭node2上的营养。</font><font style="vertical-align: inherit;">让我们看看集群是否可以承受并且虚拟机将自动返回工作状态。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/7c/ge/k6/7cgek6uuanswhta3osmoshozk10.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
las，正如我们所看到的，我们有一个问题，那就是唯一的幸存节点不再具有仲裁，这将自动禁用HA。</font><font style="vertical-align: inherit;">我们给出命令以强制在控制台中安装仲裁。</font></font><br>
<br>
<pre><code class="plaintext hljs">pvecm expected 1</code></pre><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/qk/n6/jw/qkn6jwdgtovfx9ns7kt2veahb0w.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2分钟后，高可用性机制正常运行，但未找到节点2，因此在节点3上启动了我们的VM。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/6s/z2/xm/6sz2xmx1djx-_rm6k_y3uz6xcpu.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一旦重新打开node1和node2，群集就完全恢复了。</font><font style="vertical-align: inherit;">请注意，VM不会迁移回node1，但是可以手动完成。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总结一下</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们向您介绍了Proxmox中的群集机制如何工作，还介绍了如何为虚拟机和容器配置HA。</font><font style="vertical-align: inherit;">正确使用群集和HA可以大大提高基础架构的可靠性，并提供灾难恢复。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在创建集群之前，您需要立即计划将其用于什么目的以及将来需要扩展多少。</font><font style="vertical-align: inherit;">您还需要以最小的延迟检查网络基础结构的可用性，以便将来的群集正常运行。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
告诉我们-您是否在Proxmox中使用集群功能？</font><font style="vertical-align: inherit;">在评论中见。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以前有关Proxmox VE虚拟机管理程序的文章：</font></font></i><br>
<br>
<ul>
<li><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虚拟化的魔力：Proxmox VE入门课程</font></font></a></i></li>
<li><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于Proxmox VE中的备份</font></font></a></i></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN489900/index.html">PostgreSQL反模式：绕过触发器更改数据</a></li>
<li><a href="../zh-CN489902/index.html">如何衡量投资组合的有效性：3种实用方法</a></li>
<li><a href="../zh-CN489904/index.html">我们为什么以及如何测试更新</a></li>
<li><a href="../zh-CN489906/index.html">OpenCV中的虚拟试衣间</a></li>
<li><a href="../zh-CN489912/index.html">在Web开发中调试微服务时的痛苦和痛苦</a></li>
<li><a href="../zh-CN489916/index.html">Protobuf还是JSON结构的前端通信协议？</a></li>
<li><a href="../zh-CN489918/index.html">我们如何实施虚拟加油卡项目</a></li>
<li><a href="../zh-CN489920/index.html">站点，转到IPv6，两个</a></li>
<li><a href="../zh-CN489924/index.html">Elasticsearch从哪里开始</a></li>
<li><a href="../zh-CN489926/index.html">黑色星期五：通过开发人员的眼光看负荷</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>