<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üà∂ üéÆ üï∂Ô∏è Free Telegram bot hosting on Google Cloud Platform üòü ü§∂üèª üà∑Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Why GCP?
 When writing telegrams to bots, I came across the question of how to quickly and free make the bot work constantly. Options with Heroku and ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Free Telegram bot hosting on Google Cloud Platform</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488560/"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Why GCP?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When writing telegrams to bots, I came across the question of how to quickly and free make the bot work constantly. </font><font style="vertical-align: inherit;">Options with Heroku and Pythonanywhere have too small limits if you have more than one bot. </font><font style="vertical-align: inherit;">So I decided to use GCP. </font><font style="vertical-align: inherit;">The platform provides free $ 300 per year + huge discounts on the use of these funds (up to 94%).</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/fh/5b/er/fh5berp5_jloo2cwrafuc1u6rbm.png"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How to host your bot?</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 1. Register for GCP</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Go to the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GCP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> website </font><font style="vertical-align: inherit;">and click </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Get started for free</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><a name="habracut"></a><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ae/ec/-l/aeec-l-p1uivtoqefb1wxujftau.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enter your data and card. </font><font style="vertical-align: inherit;">Money from the card will not be debited if you yourself do not activate a paid subscription.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/fy/7-/5w/fy7-5wvxsisp3cfvgz8pz2zmhbg.png"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 2. Create a virtual machine</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After registration, you will be on the main page of the service. </font><font style="vertical-align: inherit;">You need to select the Compute Engine tab in the Resources section.</font></font><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/sy/xt/ni/syxtniyd4afrtypvhxkqw1oeggy.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You must create a new instance.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/y-/ug/vy/y-ugvym1bziz4uhx4q-8yirw_wu.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you will not deploy the database in a virtual machine, then you can take g1-small, otherwise I advise n1-standart. </font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ek/vy/ne/ekvyneszbfujubfrkvlma93h5we.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You will also need to choose an OS. </font><font style="vertical-align: inherit;">I chose Debian GNU / Linux 9 (stretch).</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/9q/hb/kv/9qhbkv1pxybpl4e84mpbs2nvpyy.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All VM created. </font><font style="vertical-align: inherit;">Conventional deployment takes 1 to 5 minutes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 3. Configure the virtual machine</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can connect via SSH from your PC or interact through the platform. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To do this, click on SSH.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/uy/rv/md/uyrvmdlv5m2mufx2tvebio0igqc.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Your Linux terminal will open in a new window.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/39/we/jc/39wejcl8770mwzyhasapvwkgypg.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now let's move on to setting up. </font><font style="vertical-align: inherit;">First, enter the command:</font></font><br>
<br>
<pre><code class="bash hljs">sudo apt-get update</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
to update information on the latest package versions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After we enter:</font></font><br>
<br>
<pre><code class="bash hljs">sudo apt-get install python3-setuptools<font></font>
sudo apt-get install python3-pip</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Python itself does not need to be installed, it already exists. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now you need to install all the necessary libraries. </font><font style="vertical-align: inherit;">There is a small nuance, all libraries must be installed twice:</font></font><br>
<br>
<pre><code class="bash hljs">pip3 install ‚Äòname_of_package‚Äô</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
for use via python3 command, and </font></font><br>
<br>
<pre><code class="bash hljs">sudo pip3 install ‚Äòname_of_package‚Äô</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
for systemd. </font><font style="vertical-align: inherit;">This utility will help you launch the bot and restart it if it crashes. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The easiest way to run the bot through python3, but it will turn off if you disconnect. </font><font style="vertical-align: inherit;">You can use screen, but the bot will not restart itself. </font><font style="vertical-align: inherit;">You can also use crontab with port checking, but it seems to me that this option is more complicated than systemd.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 4. Fill the bot to the server</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are two ways to fill your bot. </font><font style="vertical-align: inherit;">If you are not friends with Git, you can simply archive the bot in .tar and upload it to the server:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/m2/hh/xf/m2hhxf1n6kx6mf9eyfhv6id8osm.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After that, unzip it with the command:</font></font><br>
<br>
<pre><code class="bash hljs">tar -xvf yourfile.tar</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now your bot is stored in a folder with the name of the archive. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The second way is through Git. </font><font style="vertical-align: inherit;">I think it‚Äôs not worth explaining how to do this to people who know how to use it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After installing it with the command:</font></font><br>
<br>
<pre><code class="bash hljs">sudo apt install git</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can clone it on your VM. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After that, let's move on to setting up systemd. </font><font style="vertical-align: inherit;">To do this, go to his directory:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> /etc/systemd/system</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And create the bot.service file:</font></font><br>
<br>
<pre><code class="bash hljs">sudo nano bot.service</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enter the following in the window that opens:</font></font><br>
<br>
<pre><code class="bash hljs"><font></font>
[Unit]<font></font>
Description=Telegram bot <span class="hljs-string">' '</span><font></font>
After=syslog.target<font></font>
After=network.target<font></font>
<font></font>
[Service]<font></font>
Type=simple<font></font>
User=root<font></font>
WorkingDirectory=/home/  /     <font></font>
ExecStart=/usr/bin/python3 /home/  /     /bot.py<font></font>
<font></font>
RestartSec=10<font></font>
Restart=always<font></font>
<font></font>
[Install]<font></font>
WantedBy=multi-user.target<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Close and save the file. </font><font style="vertical-align: inherit;">Closes with the command Ctrl + X. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After that, enter the commands in turn:</font></font><br>
<br>
<pre><code class="bash hljs">sudo systemctl daemon-reload<font></font>
sudo systemctl <span class="hljs-built_in">enable</span> bot<font></font>
sudo systemctl start bot<font></font>
sudo systemctl status bot<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If all goes well, you will see something like the following:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ar/tn/jf/artnjfgehjf5m03nqtuatyhk-rq.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That's it, now your bot works independently. </font><font style="vertical-align: inherit;">I hope my article will help you host your bot.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.Check your bot for errors</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Launch your bot and test its operation before launching it through systemd. </font><font style="vertical-align: inherit;">To do this, go to the folder with the bot and run through python.</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> &lt;  &gt;<font></font>
python3 bot.py</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Add encoding to the files with py scripts</font></font></h3><br>
<pre><code class="python hljs"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-comment"># -*- coding: utf-8 -*-</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Insert at the beginning of the file.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.Errors in systemd </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you checked the bot for errors and it worked fine, but it does not want to start in systemd, then you can look at the logs and understand what the error is by looking at the file:</font></font><br>
<br>
<pre><code class="bash hljs">sudo nano /var/<span class="hljs-built_in">log</span>/syslog</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can download this file and view it on your computer through Notepad ++.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.Bot update</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you want to add or upload a new version of the bot, enter the command:</font></font><br>
<br>
<pre><code class="bash hljs">sudo systemctl stop bot</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Provide all necessary manipulations. </font><font style="vertical-align: inherit;">And then enter the following commands so that it works again:</font></font><br>
<br>
<pre><code class="bash hljs">sudo systemctl daemon-reload<font></font>
sudo systemctl start bot<font></font>
sudo systemctl status bot</code></pre></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en488546/index.html">Hack The Box. JSON walkthrough. Vulnerability in Json.Net and LPE via SeImpersonatePrivilege</a></li>
<li><a href="../en488548/index.html">Experiment: how to learn to create popular texts in English (and why the English-speaking Habrists read so little)</a></li>
<li><a href="../en488550/index.html">Who wants to make cooperatives out of IT giants</a></li>
<li><a href="../en488552/index.html">Apple FAS and Parental Control Developers</a></li>
<li><a href="../en488558/index.html">Ensuring high availability of applications with Kafka Streams</a></li>
<li><a href="../en488564/index.html">Your first neural network on a graphics processing unit (GPU). Beginner's Guide</a></li>
<li><a href="../en488566/index.html">How a QA engineer saved an entire day by linking AutoTests in Visual Studio and Test IT</a></li>
<li><a href="../en488568/index.html">Do neural networks dream of electric money?</a></li>
<li><a href="../en488570/index.html">How the US Secret Service confused cyberpunk RPG with a textbook for hackers</a></li>
<li><a href="../en488572/index.html">Unity Analyzers Now Open-Source</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>